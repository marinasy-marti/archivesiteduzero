<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/creer-un-systeme-de-newsletter.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 19:55:39 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/creer-un-systeme-de-newsletter.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:40:44 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Créer un système de newsletter</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/creer-un-systeme-de-newsletter.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Créer un système de newsletter</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Crerunsystmedenewsletter">Créer un système de newsletter</a><br/><a href="#Prsentation">Présentation</a><br/><a href="#Lesdiffrentsfichiers">Les différents fichiers</a><br/><a href="#Amliorations">Améliorations</a><br/></div>
<a name="Crerunsystmedenewsletter"></a><h2>Créer un système de newsletter</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter/presentation-107">
<span class="next">Présentation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-404766" data-claire-element-id="404766">C'est inévitable, vous avez tous déjà eu l'envie de créer un système de newsletter. :p</p><div id="r-404768" data-claire-element-id="404768" data-claire-semantic="question"><p id="r-404767" data-claire-element-id="404767">C'est quoi, un système de newsletter ?</p></div><p id="r-404769" data-claire-element-id="404769">Ah ! Comme son nom l'indique, <strong><em>news</em></strong> : nouveautés, et <strong><em>letter</em></strong> : lettre. Ces mots proviennent de l'anglais. C'est un système permettant d'envoyer à une liste de membres les nouveautés de votre site. Voilà ! :D <br/> Bon, avant de commencer la lecture de ce tutoriel, je vous conseille d'abord <a href="http://www.siteduzero.com/tuto-3-4-0-un-site-dynamique-avec-php.html">d'apprendre le PHP grâce au tuto de <strong>M@teo21</strong></a>.<br/> On va alors pouvoir commencer ! ;)</p>
</div><a name="Prsentation"></a><h2>Présentation</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter/les-differents-fichiers">
<span class="next">Les différents fichiers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-404770" data-claire-element-id="404770">Alors, pour réaliser un système de newsletter, on va avoir besoin de plusieurs choses :</p><ul id="r-404779" data-claire-element-id="404779"><li id="r-404772" data-claire-element-id="404772"><p id="r-404771" data-claire-element-id="404771">la fonction mail (elle est indispensable pour l'envoi) ;</p></li><li id="r-404774" data-claire-element-id="404774"><p id="r-404773" data-claire-element-id="404773">une base de données MySQL ;</p></li><li id="r-404776" data-claire-element-id="404776"><p id="r-404775" data-claire-element-id="404775">des cookies ;</p></li><li id="r-404778" data-claire-element-id="404778"><p id="r-404777" data-claire-element-id="404777"><a href="http://www.siteduzero.com/tuto-3-152-1-proteger-un-dossier-avec-un-htaccess.html">un fichier .htaccess</a>.</p></li></ul><p id="r-404780" data-claire-element-id="404780">Bon, on va pouvoir commencer.<br/> Votre système se décomposera en plusieurs pages.<br/> Il y aura 2 répertoires :</p><ul id="r-404785" data-claire-element-id="404785"><li id="r-404782" data-claire-element-id="404782"><p id="r-404781" data-claire-element-id="404781">le répertoire public, accessible à tout le monde ;</p></li><li id="r-404784" data-claire-element-id="404784"><p id="r-404783" data-claire-element-id="404783">le répertoire privé, protégé par un mot de passe.</p></li></ul><p id="r-404786" data-claire-element-id="404786">Voici ce que contient le répertoire public :</p><figure id="r-404788" data-claire-element-id="404789"><img id="r-404787" data-claire-element-id="404787" src="medias/uploads.siteduzero.com_files_52001_53000_52552.gif" alt="Image utilisateur"/></figure><p id="r-404790" data-claire-element-id="404790">(Si si, les couleurs sont superbes ! :p )<br/> Et voici ce que contient le répertoire privé (que vous devez <a href="http://www.siteduzero.com/tuto-3-152-1-proteger-un-dossier-avec-un-htaccess.html">protéger avec un fichier .htaccess</a>) :</p><figure id="r-404792" data-claire-element-id="404793"><img id="r-404791" data-claire-element-id="404791" src="medias/uploads.siteduzero.com_files_52001_53000_52354.gif" alt="Image utilisateur"/></figure><p id="r-404794" data-claire-element-id="404794">Je vais vous expliquer le fonctionnement ultra simple de ce système.<br/> La personne va sur la page index.php. Là, l'utilisateur entre son adresse e-mail et choisit s'il veut s'inscrire ou se désinscrire. Ensuite, il reçoit un mail, avec un lien vers la page inscription.php ou desinscription.php, pour vérifier que l'adresse entrée était bien la sienne.<br/> Sur la page inscription.php ou desinscription.php, il entre de nouveau son adresse e-mail pour vérifier ; si c'est la même, il est ajouté à la liste des inscrits ou en est retiré.</p><p id="r-404795" data-claire-element-id="404795">La base de données, elle, se compose de cette façon :</p><figure id="r-404797" data-claire-element-id="404798"><img id="r-404796" data-claire-element-id="404796" src="medias/uploads.siteduzero.com_files_70001_71000_70083.png" alt="Image utilisateur"/></figure><p id="r-404799" data-claire-element-id="404799">Le champ email contient l'adresse e-mail de la personne. Quand elle se désinscrit, l'adresse est supprimée de la BDD.</p><p id="r-404800" data-claire-element-id="404800">Si vous avez tout compris, on va pouvoir passer à la suite. :soleil:</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter">Créer un système de newsletter</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter/presentation-107">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter/les-differents-fichiers">
Les différents fichiers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter/ameliorations-22">
Améliorations
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter/les-differents-fichiers">
<span class="next">Les différents fichiers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesdiffrentsfichiers"></a><h2>Les différents fichiers</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter/presentation-107">
<span class="arrow"></span>
<span class="next">Présentation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter/ameliorations-22">
<span class="next">Améliorations</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-index-php-2" data-claire-element-id="404824">index.php</h2><p id="r-404802" data-claire-element-id="404802">Nous allons commencer avec la page index.php, le fichier où l'on rentrera son adresse e-mail et qui enverra le mail de validation.<br/> La première chose que l'on va étudier est le fonctionnement de ce fichier.</p><p id="r-404803" data-claire-element-id="404803">Une fois qu'on a rempli les champs, on vérifie si l'on souhaite s'inscrire. Puis on envoie un e-mail contenant le lien vers inscription.php, avec en variable l'adresse e-mail. On fait de même si l'on veut se désinscrire, mais cette fois-ci le lien pointera vers desinscription.php. :p</p><p id="r-404804" data-claire-element-id="404804">Si l'on détaille tout ça, on aura…</p><p id="r-404805" data-claire-element-id="404805">En premier, on va vérifier si les champs ont bien été remplis.</p><pre id="r-404806" data-claire-element-id="404806"><code data-claire-semantic="html+php">&lt;?php
if(isset($_GET['email'])) // On vérifie que la variable $_GET['email'] existe.
    {
 
        if( !empty($_POST['email']) AND $_GET['email']==1 AND isset($_POST['new'])) /* On vérifie que la variable $_POST['email'] contient bien quelque chose, que la variable $_GET['email'] est égale à 1 et que la variable $_POST['new'] existe. */
        {
?&gt;</code></pre><p id="r-404807" data-claire-element-id="404807">On vérifie ensuite si $_POST['email'] contient bien une adresse, avec une regex.</p><pre id="r-404808" data-claire-element-id="404808"><code data-claire-semantic="html+php">&lt;?php
if (preg_match(&quot;#^[a-z0-9._-]+@[a-z0-9._-]{2,}\.[a-z]{2,4}$#&quot;, $_POST['email']))
        {
?&gt;</code></pre><p id="r-404809" data-claire-element-id="404809">Ensuite, on va regarder si l'on veut s'inscrire.</p><pre id="r-404810" data-claire-element-id="404810"><code data-claire-semantic="html+php">&lt;?php
if($_POST['new']==0) // Si la variable $_POST['new'] est égale à 0, cela signifie qu'on veut s'inscrire.
            {
?&gt;</code></pre><p id="r-404811" data-claire-element-id="404811">Puis, on envoie le mail avec le lien pour valider l'inscription.</p><pre id="r-404812" data-claire-element-id="404812"><code data-claire-semantic="html+php">&lt;?php
//On définit les paramètres de l'e-mail.
            $email = $_POST['email'];
            $message = 'Pour valider votre inscription à la newsletter de MonSite.fr, &lt;a href=&quot;http://www.monsite.fr/inscription.php?tru=1&amp;amp;email='.$email.'&quot;&gt;cliquez ici&lt;/a&gt;.';
 
            $destinataire = $email;
            $objet = &quot;Inscription à la newsletter de MonSite.fr&quot; ;
 
            $headers  = 'MIME-Version: 1.0' . &quot;\r\n&quot;;
            $headers .= 'Content-type: text/html; charset=iso-8859-1' . &quot;\r\n&quot;;
            $headers .= 'From: <a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="a2cfcdccd1cbd6c7e2cfcdccd1cbd6c78cc4d0">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>' . &quot;\r\n&quot;;
                if ( mail($destinataire, $objet, $message, $headers) ) // On envoie l'e-mail.
                {
 
                echo &quot;Pour valider votre inscription, veuillez cliquer sur le lien dans l'e-mail que nous venons de vous envoyer.&quot;;
                }
                else
                {
                echo &quot;Il y a eu une erreur lors de l'envoi du mail pour votre inscription.&quot;;
                }
?&gt;</code></pre><p id="r-404813" data-claire-element-id="404813">Ensuite, si $_POST['new'] ne vaut pas 0, cela signifie que l'on veut se désinscrire.</p><pre id="r-404814" data-claire-element-id="404814"><code data-claire-semantic="html+php">&lt;?php
elseif($_POST['new']==1) // Si la variable $_POST['new'] est égale à 1, cela signifie qu'on veut se désinscrire.
            {
?&gt;</code></pre><p id="r-404815" data-claire-element-id="404815">Et on envoie le mail avec le lien pour valider la désinscription.</p><pre id="r-404816" data-claire-element-id="404816"><code data-claire-semantic="html+php">&lt;?php
// On définit les paramètres de l'e-mail.
            $email = $_POST['email'];
            $message = 'Pour valider votre désinscription de la newsletter de MonSite.fr, &lt;a href=&quot;http://www.monsite.fr/desinscription.php?tru=1&amp;amp;email='.$email.'&quot;&gt;cliquez ici&lt;/a&gt;.';
 
            $destinataire = $email;
            $objet = &quot;Désinscription de la newsletter de MonSite.fr&quot; ;
 
            $headers  = 'MIME-Version: 1.0' . &quot;\r\n&quot;;
            $headers .= 'Content-type: text/html; charset=iso-8859-1' . &quot;\r\n&quot;;
            $headers .= 'From: <a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="4e2321203d273a2b0e2321203d273a2b60283c">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>' . &quot;\r\n&quot;;
                if ( mail($destinataire, $objet, $message, $headers) ) 
                {
 
                echo &quot;Pour valider votre désinscription, veuillez cliquer sur le lien dans l'e-mail que nous venons de vous envoyer.&quot;;
                }</code></pre><p id="r-404817" data-claire-element-id="404817">Sinon, si ce qui a été rentré n'est pas une adresse e-mail, on le signale.</p><pre id="r-404818" data-claire-element-id="404818"><code data-claire-semantic="html+php">&lt;?php
        else // Si on n'a pas rentré d'adresse e-mail.
        {
        echo 'Vous n\'avez pas entré une adresse e-mail valide ! Veuillez recommencer !';
        }
?&gt;</code></pre><p id="r-404819" data-claire-element-id="404819">Et sinon, si les champs ne sont pas remplis, on affiche le formulaire.</p><pre id="r-404820" data-claire-element-id="404820"><code data-claire-semantic="html+php">&lt;?php
else
    {
?&gt;
La newsletter :
&lt;form method=&quot;post&quot; action=&quot;index.php?email=1&quot;&gt;
Adresse e-mail : &lt;input type=&quot;text&quot; name=&quot;email&quot; size=&quot;25&quot; /&gt;&lt;br /&gt;
&lt;input type=&quot;radio&quot; name=&quot;new&quot; value=&quot;0&quot; /&gt;S'inscrire
&lt;input type=&quot;radio&quot; name=&quot;new&quot; value=&quot;1&quot; /&gt;Se désinscrire&lt;br /&gt;
&lt;input type=&quot;submit&quot; value=&quot;Envoyer&quot; name=&quot;submit&quot; /&gt; &lt;input type=&quot;reset&quot; name=&quot;reset&quot; value=&quot;Effacer&quot; /&gt;
&lt;/form&gt;
&lt;?php
    }
?&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-404821" data-claire-element-id="404821">Et voici (enfin ^^ ) le fichier complet :</p><pre id="r-404822" data-claire-element-id="404822"><code data-claire-semantic="html+php">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot; &gt;
&lt;head&gt;
    &lt;title&gt;La newsletter de MonSite.fr&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
 &lt;?php
    if(isset($_GET['email'])) // On vérifie que la variable $_GET['email'] existe.
    {
 
        if( !empty($_POST['email']) AND $_GET['email']==1 AND isset($_POST['new'])) /* On vérifie que la variable $_POST['email'] contient bien quelque chose, que la variable $_GET['email'] est égale à 1 et que la variable $_POST['new'] existe. */
        {
        if (preg_match(&quot;#^[a-z0-9._-]+@[a-z0-9._-]{2,}\.[a-z]{2,4}$#&quot;, $_POST['email'])) // On vérifie qu'on a bien rentré une adresse e-mail valide.
        {
 
            if($_POST['new']==0) // Si la variable $_POST['new'] est égale à 0, cela signifie que l'on veut s'inscrire.
            {
 
            // On définit les paramètres de l'e-mail.
            $email = $_POST['email'];
            $message = 'Pour valider votre inscription à la newsletter de MonSite.fr, &lt;a href=&quot;http://www.monsite.fr/inscription.php?tru=1&amp;amp;email='.$email.'&quot;&gt;cliquez ici&lt;/a&gt;.';
 
            $destinataire = $email;
            $objet = &quot;Inscription à la newsletter de MonSite.fr&quot; ;
 
            $headers  = 'MIME-Version: 1.0' . &quot;\r\n&quot;;
            $headers .= 'Content-type: text/html; charset=iso-8859-1' . &quot;\r\n&quot;;
            $headers .= 'From: <a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="8fe2e0e1fce6fbeacfe2e0e1fce6fbeaa1e9fd">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>' . &quot;\r\n&quot;;
                if ( mail($destinataire, $objet, $message, $headers) ) // On envoie l'e-mail.
                {
 
                echo &quot;Pour valider votre inscription, veuillez cliquer sur le lien dans l'e-mail que nous venons de vous envoyer.&quot;;
                }
                else
                {
                echo &quot;Il y a eu une erreur lors de l'envoi du mail pour votre inscription.&quot;;
                }
            }
            elseif($_POST['new']==1) // Si la variable $_POST['new'] est égale à 1, cela signifie que l'on veut se désinscrire.
            {
 
            // On définit les paramètres de l'e-mail.
            $email = $_POST['email'];
            $message = 'Pour valider votre désinscription de la newsletter de MonSite.fr, &lt;a href=&quot;http://www.monsite.fr/desinscription.php?tru=1&amp;amp;email='.$email.'&quot;&gt;cliquez ici&lt;/a&gt;.';
 
            $destinataire = $email;
            $objet = &quot;Désinscription de la newsletter de MonSite.fr&quot; ;
 
            $headers  = 'MIME-Version: 1.0' . &quot;\r\n&quot;;
            $headers .= 'Content-type: text/html; charset=iso-8859-1' . &quot;\r\n&quot;;
            $headers .= 'From: <a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="3a57555449534e5f7a57555449534e5f145c48">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>' . &quot;\r\n&quot;;
                if ( mail($destinataire, $objet, $message, $headers) ) 
                {
 
                echo &quot;Pour valider votre désinscription, veuillez cliquer sur le lien dans l'e-mail que nous venons de vous envoyer.&quot;;
                }
                else
                {
                echo &quot;Il y a eu une erreur lors de l'envoi du mail pour votre désinscription.&quot;;
                }
            }
            else
            {
            echo &quot;Il y a eu une erreur !&quot;;
            }
        }
        else
        {
        echo &quot;Vous n\'avez pas entré une adresse e-mail valide ! Veuillez recommencer !&quot;;
        }
        }
        else
        {
        echo &quot;Il y a eu une erreur.&quot;;
        }
    }
    else // Si les champs n'ont pas été remplis.
    {
?&gt;
La newsletter :
&lt;form method=&quot;post&quot; action=&quot;index.php?email=1&quot;&gt;
Adresse e-mail : &lt;input type=&quot;text&quot; name=&quot;email&quot; size=&quot;25&quot; /&gt;&lt;br /&gt;
&lt;input type=&quot;radio&quot; name=&quot;new&quot; value=&quot;0&quot; /&gt;S''inscrire
&lt;input type=&quot;radio&quot; name=&quot;new&quot; value=&quot;1&quot; /&gt;Se désinscrire&lt;br /&gt;
&lt;input type=&quot;submit&quot; value=&quot;Envoyer&quot; name=&quot;submit&quot; /&gt; &lt;input type=&quot;reset&quot; name=&quot;reset&quot; value=&quot;Effacer&quot; /&gt;
&lt;/form&gt;
&lt;?php
    }
?&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-404823" data-claire-element-id="404823"><a href="http://membres.lycos.fr/balzac61/zero/index.php">Voir un exemple</a><br/> Et maintenant, on peut passer aux autres fichiers. :D</p><h2 id="r-inscription-php-et-desinscription-php" data-claire-element-id="404843">inscription.php et desinscription.php</h2><p id="r-404825" data-claire-element-id="404825">Alors là, c'est la grosse partie de ce tutoriel. Ce sont les fichiers qui ajoutent les adresses e-mail dans la base de données.</p><h3 id="r-inscription-php" data-claire-element-id="404837">inscription.php</h3><p id="r-404826" data-claire-element-id="404826">On commence donc par créer un cookie qui contient l'adresse e-mail pour le vérifier par la suite, et ce cookie est créé si $_GET['tru'] est égale à 1 : dans le lien pour l'inscription, il y a cette variable qui signifie que l'on vient de cliquer sur le lien de l'e-mail.</p><pre id="r-404827" data-claire-element-id="404827"><code data-claire-semantic="html+php">&lt;?php
    if($_GET['tru']==1)
    {
 
    setcookie(&quot;email&quot;, $_GET['email'], time()+25); // On crée un cookie qui expirera 25 secondes plus tard pour des raisons de sécurité.
    }
?&gt;</code></pre><p id="r-404828" data-claire-element-id="404828">Puis on commence la page. Dans l'en-tête, il y a une redirection vers votre page d'accueil. Pour deux raisons : si on tarde à entrer son adresse e-mail ou si on l'a déjà entrée, donc si $_GET['tru'] est égale à 2 (on verra ça après).</p><pre id="r-404829" data-claire-element-id="404829"><code data-claire-semantic="html+php">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot; &gt;
&lt;head&gt;
    &lt;meta http-equiv=Content-Type content=&quot;text/html; charset=iso-8859-1&quot;&gt;
 
&lt;?php
    if($_GET['tru']==2)
    {
?&gt;
    &lt;meta http-equiv=&quot;refresh&quot; content=&quot;1; url=http://www.MonSite.fr/&quot; /&gt; &lt;!-- Redirection vers la page d'accueil du site si on a entré son e-mail. --&gt;
 
&lt;?php
    }
    else
    {
?&gt;
 
    &lt;meta http-equiv=&quot;refresh&quot; content=&quot;25; url=http://www.MonSite.fr/&quot; /&gt; &lt;!-- Redirection vers la page d'accueil du site si on tarde trop à entrer son e-mail. --&gt;
 
&lt;?php
    }
?&gt;
 
    &lt;title&gt;Validation de votre inscription à la newsletter de MonSite.fr&lt;/title&gt;
 
&lt;/head&gt;</code></pre><p id="r-404830" data-claire-element-id="404830">Ensuite, si $_GET['tru'] est égale à 1, on affiche donc le formulaire.</p><pre id="r-404831" data-claire-element-id="404831"><code data-claire-semantic="html+php">&lt;body&gt;
&lt;p align=&quot;center&quot;&gt;&lt;font size=&quot;5&quot;&gt;Validation de votre inscription&lt;/font&gt;&lt;/p&gt;
&lt;?php
    if($_GET['tru']==1) //s Si la variable $_GET['tru'] est égale à 1.
    // On affiche le formulaire.
    {
?&gt;
&lt;font color=&quot;red&quot;&gt;Attention, vous avez 25 secondes pour remplir le formulaire. Passé ce délai, celui-ci ne sera plus valide.&lt;/font&gt;
&lt;form method=&quot;post&quot; action=&quot;inscription.php?tru=2&quot;&gt;
Entrez votre adresse e-mail : &lt;input type=&quot;text&quot; name=&quot;email&quot; size=&quot;25&quot; /&gt;&lt;br /&gt;
&lt;input type=&quot;submit&quot; value=&quot;Envoyer&quot; name=&quot;submit&quot; /&gt; &lt;input type=&quot;reset&quot; name=&quot;reset&quot; value=&quot;Effacer&quot; /&gt;
&lt;/form&gt;
&lt;?php
    }</code></pre><p id="r-404832" data-claire-element-id="404832">Et sinon, si $_GET['tru'] est égale à 2, cela signifie qu'on a rempli le formulaire, on vérifie que l'email du cookie est identique à l'email entré. Si c'est la cas, on enregistre l'adresse e-mail dans la base de données.</p><pre id="r-404833" data-claire-element-id="404833"><code data-claire-semantic="html+php">&lt;?php
elseif($_GET['tru']==2) // Sinon, si la variable $_GET['tru'] est égale à 2.
    {
    mysql_connect(&quot;localhost&quot;, &quot;login&quot;, &quot;pass&quot;);
    mysql_select_db(&quot;db&quot;);
    $email_mail = mysql_real_escape_string($_COOKIE['email']);
    $email_entre = mysql_real_escape_string($_POST['email']);
 
        if($email_entre==$email_mail) // Si les deux adresses e-mail sont identiques.
        {
        mysql_query(&quot;INSERT INTO newsletter VALUES('&quot; . $email_entre . &quot;')&quot;); // On l'inscrit dans la base de données MySQL.
 
        echo &quot;Vous avez bien été inscrit à la newsletter de MonSite.fr ! Vous allez être redirigé dans 1 seconde.&quot;;
 
        }
        else
        {
 
        echo &quot;Vous n'avez pas entré la bonne adresse e-mail !&quot;;
 
        }
    }
    else
    {
    echo &quot;Il y a eu une erreur.&quot;;
    }
?&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-404834" data-claire-element-id="404834">Et voici maintenant le code complet de la page inscription.php :</p><pre id="r-404835" data-claire-element-id="404835"><code data-claire-semantic="html+php">&lt;?php
    if($_GET['tru']==1)
    {
 
    setcookie(&quot;email&quot;, $_GET['email'], time()+25); // On crée un cookie qui expirera 25 secondes plus tard pour des raisons de sécurité.
    }
?&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot; &gt;
&lt;head&gt;
    &lt;meta http-equiv=Content-Type content=&quot;text/html; charset=iso-8859-1&quot;&gt;
 
&lt;?php
    if($_GET['tru']==2)
    {
?&gt;
    &lt;meta http-equiv=&quot;refresh&quot; content=&quot;1; url=http://www.MonSite.fr/&quot; /&gt; &lt;!-- Redirection vers la page d'accueil du site si on a entré son e-mail. --&gt;
 
&lt;?php
    }
    else
    {
?&gt;
 
    &lt;meta http-equiv=&quot;refresh&quot; content=&quot;25; url=http://www.MonSite.fr/&quot; /&gt; &lt;!-- Redirection vers la page d'accueil du site si on tarde trop à entrer son e-mail. --&gt;
 
&lt;?php
    }
?&gt;
 
    &lt;title&gt;Validation de votre inscription à la newsletter de MonSite.fr&lt;/title&gt;
 
&lt;/head&gt;
&lt;body&gt;
&lt;p align=&quot;center&quot;&gt;&lt;font size=&quot;5&quot;&gt;Validation de votre inscription&lt;/font&gt;&lt;/p&gt;
&lt;?php
    if($_GET['tru']==1) //Si la variable $_GET['tru'] est égale à 1.
    // On affiche le formulaire
    {
?&gt;
&lt;font color=&quot;red&quot;&gt;Attention, vous avez 25 secondes pour remplir le formulaire. Passé ce délai, celui-ci ne sera plus valide.&lt;/font&gt;
&lt;form method=&quot;post&quot; action=&quot;inscription.php?tru=2&quot;&gt;
Entrez votre e-mail : &lt;input type=&quot;text&quot; name=&quot;email&quot; size=&quot;25&quot; /&gt;&lt;br /&gt;
&lt;input type=&quot;submit&quot; value=&quot;Envoyer&quot; name=&quot;submit&quot; /&gt; &lt;input type=&quot;reset&quot; name=&quot;reset&quot; value=&quot;Effacer&quot; /&gt;
&lt;/form&gt;
&lt;?php
    }
elseif($_GET['tru']==2) // Sinon, si la variable $_GET['tru'] est égale à 2.
    {
    mysql_connect(&quot;localhost&quot;, &quot;login&quot;, &quot;pass&quot;);
    mysql_select_db(&quot;db&quot;);
    $email_mail = mysql_real_escape_string($_COOKIE['email']);
    $email_entre = mysql_real_escape_string($_POST['email']);
 
        if($email_entre==$email_mail) // Si les deux adresses e-mail sont identiques.
        {
        mysql_query(&quot;INSERT INTO newsletter VALUES('&quot; . $email_entre . &quot;')&quot;); // On l'inscrit dans la base de données MySQL.
 
        echo &quot;Vous avez bien été inscrit à la newsletter de MonSite.fr ! Vous allez être redirigé dans 1 seconde.&quot;;
 
        }
        else
        {
 
        echo &quot;Vous n'avez pas entré la bonne adresse e-mail !&quot;;
 
        }
    }
    else
    {
echo &quot;Il y a eu une erreur.&quot;;
    }
?&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-404836" data-claire-element-id="404836">Pour voir un exemple, vous devez recevoir l'e-mail et cliquer sur le lien.</p><h3 id="r-desinscription-php" data-claire-element-id="404842">desinscription.php</h3><p id="r-404838" data-claire-element-id="404838">desinscription.php fonctionne exactement de la même façon. En voici donc le code source :</p><pre id="r-404839" data-claire-element-id="404839"><code data-claire-semantic="html+php">&lt;?php
    if($_GET['tru']==1)
    {
 
    setcookie(&quot;email&quot;, $_GET['email'], time()+25); // On crée un cookie qui expirera 25 secondes plus tard pour des raisons de sécurité.
 
    }
?&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot; &gt;
&lt;head&gt;
    &lt;meta http-equiv=Content-Type content=&quot;text/html; charset=iso-8859-1&quot;&gt;
&lt;?php
    if($_GET['tru']==2)
    {
?&gt;
 
    &lt;meta http-equiv=&quot;refresh&quot; content=&quot;1; url=http://www.MonSite.fr/&quot; /&gt; &lt;!-- Redirection vers la page d'accueil du site si on a entré son e-mail. --&gt;
 
&lt;?php
    }
    else
    {
?&gt;
 
    &lt;meta http-equiv=&quot;refresh&quot; content=&quot;25; url=http://www.MonSite.fr/&quot; /&gt; &lt;!-- Redirection vers la page d'accueil du site si on tarde trop à entrer son e-mail. --&gt;
 
&lt;?php
    }
?&gt;
    &lt;title&gt;Validation de votre désinscription de la newsletter de MonSite.fr&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p align=&quot;center&quot;&gt;&lt;font size=&quot;5&quot;&gt;Validation de votre désinscription&lt;/font&gt;&lt;/p&gt;
 
&lt;?php
    if($_GET['tru']==1) //si la variable $_GET['tru'] est égale à 1
    // On affiche le formulaire.
    {
?&gt;
&lt;font color=&quot;red&quot;&gt;Attention, vous avez 25 secondes pour remplir le formulaire. Passé ce délai, celui-ci ne sera plus valide.&lt;/font&gt;
&lt;form method=&quot;post&quot; action=&quot;desinscription.php?tru=2&quot;&gt;
Entrez votre adresse e-mail : &lt;input type=&quot;text&quot; name=&quot;email&quot; size=&quot;25&quot; /&gt;&lt;br /&gt;
&lt;input type=&quot;submit&quot; value=&quot;Envoyer&quot; name=&quot;submit&quot; /&gt; &lt;input type=&quot;reset&quot; name=&quot;reset&quot; value=&quot;Effacer&quot; /&gt;
&lt;/form&gt;
&lt;?php
    }
    elseif($_GET['tru']==2) // Sinon, si la variable $_GET['tru'] est égale à 2.
    {
    mysql_connect(&quot;localhost&quot;, &quot;login&quot;, &quot;pass&quot;);
    mysql_select_db(&quot;db&quot;);
    $email_mail = mysql_real_escape_string($_COOKIE['email']);
    $email_entre = mysql_real_escape_string($_POST['email']);
 
        if($email_entre==$email_mail) // Si les deux adresses e-mail sont identiques.
        {
        mysql_query(&quot;DELETE FROM newsletter WHERE email='&quot; . $email_entre .&quot;'&quot;); //On supprime l'adresse de la BDD.
 
        echo &quot;Vous avez bien été désinscrit de la newsletter de MonSite.fr ! Vous allez être redirigé dans 1 seconde.&quot;;
 
        }
        else
        {
        echo &quot;Vous n'avez pas entré la bonne adresse e-mail !!&quot;;
        }
    }
    else
    {
    echo &quot;Il y a eu une erreur.&quot;;
    }
?&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-404840" data-claire-element-id="404840">Pour voir un exemple, vous devez recevoir l'e-mail et cliquer sur le lien.</p><p id="r-404841" data-claire-element-id="404841">Eh voilà. :p</p><h2 id="r-newsletter-php" data-claire-element-id="404854">newsletter.php</h2><p id="r-404844" data-claire-element-id="404844">Ah, enfin. C'est le fichier qui envoie le mail.<br/> Son fonctionnement est ultra simple. On récupère les dernières news et on les ajoute au message.<br/> Les news sont récupérées dans une table du nom de news. Sa structure est la même que <a href="http://www.siteduzero.com/tuto-3-184-1-tp-des-news-sur-votre-site.html">celle utilisée dans le tuto de M@teo21</a>. Si vous avez suivi son tuto, vous pouvez donc ajouter ce système de newsletter ! :) Sinon, consultez le lien précédent, et créez une table selon la même structure que dans le tuto. :)</p><p id="r-404845" data-claire-element-id="404845">Pour les destinataires, on sépare par une virgule :</p><pre id="r-404846" data-claire-element-id="404846"><code data-claire-semantic="html+php">&lt;?php
// On définit la liste des inscrits.
$liste = '<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="54393b3a273d203114393b3a273d20317a3226">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>';
    while ($donnees = mysql_fetch_assoc($liste_vrac))
    {
    $liste .= ','; //On sépare les adresses par une virgule.
    $liste .= $donnees['email'];
    }
?&gt;</code></pre><p id="r-404847" data-claire-element-id="404847">Les inscrits sont en copie invisible (le destinataire étant l'admin) afin qu'ils ne puissent pas voir pas les adresses des autres.</p><pre id="r-404848" data-claire-element-id="404848"><code data-claire-semantic="html+php">&lt;?php
$headers .= 'Bcc:' . $liste . '' . &quot;\r\n&quot;; //On définit les destinataires en copie cachée pour qu'ils ne puissent pas voir les adresses des autres inscrits.
?&gt;</code></pre><p id="r-404849" data-claire-element-id="404849">On affiche aussi à la fin la liste des inscrits (rien de compliqué, on récupère les données de la BDD et on fait une boucle avec un array).<br/> On ajoute également la date au sujet du message.</p><pre id="r-404850" data-claire-element-id="404850"><code data-claire-semantic="html+php">&lt;?php
$date = date(&quot;d/m/Y&quot;);
 
$objet = &quot;Newsletter de MonSite.fr du $date&quot;; // On définit l'objet qui contient la date.
?&gt;</code></pre><p id="r-404851" data-claire-element-id="404851">Ce qui nous donne finalement :</p><pre id="r-404852" data-claire-element-id="404852"><code data-claire-semantic="html+php">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot; &gt;
&lt;head&gt;
    &lt;title&gt;Envoi de la newsletter&lt;/title&gt;
    &lt;style type=&quot;text/css&quot;&gt;
            h2, th, td
            {
                text-align:center;
            }
            table
            {
                border-collapse:collapse;
                border:2px solid white;
                margin:auto;
            }
            th, td
            {
                border:1px solid black;
            }
        &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p align=center&gt;&lt;font size=&quot;6&quot;&gt;&lt;font color=&quot;red&quot;&gt;Envoi de la newsletter&lt;/font&gt;&lt;/font&gt;&lt;/p&gt;
 
&lt;?php
// On se connecte.
mysql_connect(&quot;localhost&quot;, &quot;login&quot;, &quot;pass&quot;);
mysql_select_db(&quot;db&quot;);
 
// On récupère les 5 dernières news.
$news = mysql_query('SELECT contenu,timestamp FROM news ORDER BY id DESC LIMIT 0, 5');
 
$fichier_message = '&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Newsletter de MonSite.fr&lt;/title&gt;
&lt;/head&gt;
&lt;body bgcolor=&quot;black&quot;&gt;
&lt;font face=&quot;verdana&quot;&gt;&lt;font color=&quot;white&quot;&gt;&lt;font size=&quot;5&quot;&gt;&lt;p align=&quot;center&quot;&gt;&lt;font color=&quot;red&quot;&gt;&lt;u&gt;Balzac61&lt;/u&gt;&lt;/font&gt;&lt;/p&gt;&lt;/font&gt;
&lt;font size=&quot;3&quot;&gt;
&lt;p align=&quot;left&quot;&gt;Voici les dernières news de MonSite.fr :&lt;br /&gt;&lt;ul&gt;'; //On définit le message.
 
    while($donnee = mysql_fetch_assoc($news)) 
    {
    $fichier_message .= '&lt;li&gt;'.$donnee[&quot;contenu&quot;].'(le'.date(&quot;D, d M Y H:i:s&quot;,$donnee[&quot;timestamp&quot;]).')&lt;/li&gt;'; //On ajoute les news au message.
    }
 
$fichier_message .= '&lt;/ul&gt;&lt;/body&gt;
&lt;/html&gt;'; // On termine le message.
 
 
// On récupère de la table newsletter les personnes inscrites.
$liste_vrac = mysql_query(&quot;SELECT email FROM newsletter&quot;);
 
// On définit la liste des inscrits.
$liste = '<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="b0dddfdec3d9c4d5f0dddfdec3d9c4d59ed6c2">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>';
    while ($donnees = mysql_fetch_assoc($liste_vrac))
    {
    $liste .= ','; //On sépare les adresses par une virgule.
    $liste .= $donnees['email'];
    }
$message = $fichier_message;
$destinataire = $liste; 
 
$date = date(&quot;d/m/Y&quot;);
 
$objet = &quot;Newsletter de MonSite.fr du $date&quot;; // On définit l'objet qui contient la date.
 
// On définit le reste des paramètres.
$headers  = 'MIME-Version: 1.0' . '\r\n';
$headers .= 'Content-type: text/html; charset=iso-8859-1' . '\r\n';
$headers .= 'From: <a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="5a37353429332e3f1a37353429332e3f743c28">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>' . '\r\n'; // On définit l'expéditeur.
$headers .= 'Bcc:' . $liste . '' . '\r\n'; // On définit les destinataires en copie cachée pour qu'ils ne puissent pas voir les adresses des autres inscrits.
 
    // On envoie l'e-mail.
    if ( mail($destinataire, $objet, $fichier_message, $headers) ) 
    {
?&gt;
Envoi de la newsletter réussi.
&lt;?php
    }
    else
    {
?&gt;
Échec de l'envoi de la newsletter.
&lt;?php
    }
?&gt;
&lt;br /&gt;&lt;br /&gt;&lt;u&gt;Liste des inscrits :&lt;/u&gt;&lt;br /&gt;
&lt;table&gt;
&lt;tr&gt;
&lt;th&gt;e-mail&lt;/th&gt;
&lt;/tr&gt;
&lt;?php
 
$liste_inscrits_vrac = mysql_query(&quot;SELECT email FROM newsletter&quot;); //On récupère la table newsletter en vrac.
    while ($donnees = mysql_fetch_assoc($liste_inscrits_vrac))
    {
?&gt;
 
&lt;tr&gt;
&lt;td&gt;&lt;?php echo ($donnees['email']); ?&gt;&lt;/td&gt;
&lt;/tr&gt;
 
&lt;?php
    }
?&gt;
&lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-404853" data-claire-element-id="404853">Eh voilà. On a vu tous les fichiers indispensables. :D</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter">Créer un système de newsletter</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter/presentation-107">
Présentation
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter/les-differents-fichiers">
Les différents fichiers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter/ameliorations-22">
Améliorations
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter/presentation-107">
<span class="arrow"></span>
<span class="next">Présentation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter/ameliorations-22">
<span class="next">Améliorations</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Amliorations"></a><h2>Améliorations</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter/les-differents-fichiers">
<span class="arrow"></span>
<span class="next">Les différents fichiers</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-404856" data-claire-element-id="404856">Bon, voici les améliorations possibles :</p><ul id="r-404880" data-claire-element-id="404880"><li id="r-404858" data-claire-element-id="404858"><p id="r-404857" data-claire-element-id="404857">comme d'habitude, le style est minimaliste. On peut sans problème ajouter une feuille de style ;</p></li><li id="r-404860" data-claire-element-id="404860"><p id="r-404859" data-claire-element-id="404859">on peut ajouter un lien de désinscription dans l'e-mail ;</p></li><li id="r-404862" data-claire-element-id="404862"><p id="r-404861" data-claire-element-id="404861">on peut aussi afficher les dernières modifications du site ;</p></li><li id="r-404864" data-claire-element-id="404864"><p id="r-404863" data-claire-element-id="404863">on peut ajouter du BBCode dans les messages ;</p></li><li id="r-404879" data-claire-element-id="404879"><p id="r-404865" data-claire-element-id="404865">vous pouvez aussi ajouter un textarea pour ajouter à la newsletter un message en plus des news.</p><div id="r-404878" data-claire-element-id="404878"><aside id="r-404867" data-claire-element-id="404867" data-claire-semantic="information"><p id="r-404866" data-claire-element-id="404866">Ceci se passe sur la page newsletter.php.</p></aside><p id="r-404868" data-claire-element-id="404868">Il faudrait tout d'abord ajouter une condition pour que le mail ne s'envoie qu'une fois le formulaire validé :</p><pre id="r-404869" data-claire-element-id="404869"><code data-claire-semantic="html+php">&lt;?php
if(isset($_POST['message'])) //On a tapé le message.
{
?&gt;</code></pre><p id="r-404870" data-claire-element-id="404870">Puis, il faut ajouter ce qui a été tapé au message envoyé ;) :</p><pre id="r-404871" data-claire-element-id="404871"><code data-claire-semantic="html+php">&lt;?php
$fichier_message = '&lt;html&gt;
&lt;head&gt;
   &lt;title&gt;Newsletter de MonSite.fr&lt;/title&gt;
&lt;/head&gt;
&lt;body bgcolor=&quot;black&quot;&gt;
&lt;font face=&quot;verdana&quot;&gt;&lt;font color=&quot;white&quot;&gt;&lt;font size=&quot;5&quot;&gt;&lt;p align=&quot;center&quot;&gt;&lt;font color=&quot;red&quot;&gt;&lt;u&gt;MonSite&lt;/u&gt;&lt;/font&gt;&lt;/p&gt;&lt;/font&gt;
&lt;font size=&quot;3&quot;&gt;
&lt;p align=&quot;left&quot;&gt;' . $_POST['message'] . '&lt;br /&gt;&lt;br /&gt;Voici les dernières news de MonSite.fr :&lt;br /&gt;&lt;ul&gt;'; //On définit le message.
?&gt;</code></pre><p id="r-404872" data-claire-element-id="404872">Voilà pour le PHP. ;)</p><p id="r-404873" data-claire-element-id="404873">Sinon, il faut bien évidemment ajouter le formulaire html : ^^</p><pre id="r-404874" data-claire-element-id="404874"><code data-claire-semantic="html">&lt;h3&gt;Message ajouté à la newsletter&lt;/h3&gt;
&lt;form method=&quot;post&quot; action=&quot;newsletter.php&quot;&gt;
&lt;textarea cols=&quot;30&quot; rows=&quot;10&quot; name=&quot;message&quot;&gt;&lt;/textarea&gt;
&lt;input type=&quot;submit&quot; value=&quot;Envoyer la newsletter&quot; /&gt;
&lt;/form&gt;</code></pre><p id="r-404875" data-claire-element-id="404875">Voilà, le fichier modifié :D (les lignes rajoutées sont colorées) :</p><pre id="r-404876" data-claire-element-id="404876"><code data-claire-semantic="html+php">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot; &gt;
&lt;head&gt;
    &lt;title&gt;Envoi de la newsletter&lt;/title&gt;
    &lt;style type=&quot;text/css&quot;&gt;
            h2, th, td
            {
                text-align:center;
            }
            table
            {
                border-collapse:collapse;
                border:2px solid white;
                margin:auto;
            }
            th, td
            {
                border:1px solid black;
            }
        &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p align=center&gt;&lt;font size=&quot;6&quot;&gt;&lt;font color=&quot;red&quot;&gt;Envoi de la newsletter&lt;/font&gt;&lt;/font&gt;&lt;/p&gt;
 
&lt;?php
// On se connecte.
mysql_connect(&quot;localhost&quot;, &quot;login&quot;, &quot;pass&quot;);
mysql_select_db(&quot;db&quot;);
if(isset($_POST['message'])) //On a tapé le message.
{ 
// On récupère les 5 dernières news
$news = mysql_query('SELECT contenu,timestamp FROM news ORDER BY id DESC LIMIT 0, 5');
 
$fichier_message = '&lt;html&gt;
&lt;head&gt;
   &lt;title&gt;Newsletter de MonSite.fr&lt;/title&gt;
&lt;/head&gt;
&lt;body bgcolor=&quot;black&quot;&gt;
&lt;font face=&quot;verdana&quot;&gt;&lt;font color=&quot;white&quot;&gt;&lt;font size=&quot;5&quot;&gt;&lt;p align=&quot;center&quot;&gt;&lt;font color=&quot;red&quot;&gt;&lt;u&gt;Balzac61&lt;/u&gt;&lt;/font&gt;&lt;/p&gt;&lt;/font&gt;
&lt;font size=&quot;3&quot;&gt;' . $_POST['message'] . '&lt;br /&gt;&lt;br /&gt;
&lt;p align=&quot;left&quot;&gt;Voici les dernières news de MonSite.fr :&lt;br /&gt;&lt;ul&gt;'; //On définit le message.
 
    while($donnee = mysql_fetch_assoc($news)) 
    {
    $fichier_message .= '&lt;li&gt;'.$donnee[&quot;contenu&quot;].'(le'.date(&quot;D, d M Y H:i:s&quot;,$donnee[&quot;timestamp&quot;]).')&lt;/li&gt;'; //On ajoute les news au message.
    }
 
$fichier_message .= '&lt;/ul&gt;&lt;/body&gt;
&lt;/html&gt;'; //On termine le message.
 
 
//On récupère de la table newsletter les personnes inscrites.
$liste_vrac = mysql_query(&quot;SELECT email FROM newsletter&quot;);
 
//On définit la liste des inscrits.
$liste = '<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="a8c5c7c6dbc1dccde8c5c7c6dbc1dccd86ceda">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>';
    while ($donnees = mysql_fetch_assoc($liste_vrac))
    {
    $liste .= ','; //On sépare les adresses par une virgule.
    $liste .= $donnees['email'];
    }
$message = $fichier_message;
$destinataire = '<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="096466677a607d6c496466677a607d6c276f7b">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>'; //On adresse une copie a l'administrateur.
 
$date = date(&quot;d/m/Y&quot;);
 
$objet = &quot;Newsletter de MonSite.fr du $date&quot;; //On définit l'objet qui contient la date.
 
//On définit le reste des paramètres.
$headers  = 'MIME-Version: 1.0' . '\r\n';
$headers .= 'Content-type: text/html; charset=iso-8859-1' . '\r\n';
$headers .= 'From: <a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="0b66646578627f6e4b66646578627f6e256d79">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>' . '\r\n'; //On définit l'expéditeur.
$headers .= 'Bcc:' . $liste . '' . '\r\n'; //On définit les destinataires en copie cachée pour qu'ils ne puissent pas voir les adresses des autres inscrits.
 
    //On envoie l'e-mail.
    if ( mail($destinataire, $objet, $fichier_message, $headers) ) 
    {
?&gt;
Envoi de la newsletter réussi.
&lt;?php
    }
    else
    {
?&gt;
Échec lors de l'envoi de la newsletter.
&lt;?php
    }
} //Fin de la condition de validité du formulaire.
?&gt;
&lt;br /&gt;
&lt;h3&gt;Message ajouté à la newsletter&lt;/h3&gt;
&lt;form method=&quot;post&quot; action=&quot;newsletter.php&quot;&gt;
&lt;textarea cols=&quot;30&quot; rows=&quot;10&quot; name=&quot;message&quot;&gt;&lt;/textarea&gt;
&lt;input type=&quot;submit&quot; value=&quot;Envoyer la newsletter&quot; /&gt;
&lt;/form&gt;
&lt;br /&gt;&lt;br /&gt;&lt;u&gt;Liste des inscrits :&lt;/u&gt;&lt;br /&gt;
&lt;table&gt;
&lt;tr&gt;
&lt;th&gt;e-mail&lt;/th&gt;
&lt;/tr&gt;
&lt;?php
 
$liste_inscrits_vrac = mysql_query(&quot;SELECT email FROM newsletter&quot;); //On récupère la table newsletter en vrac.
    while ($donnees = mysql_fetch_assoc($liste_inscrits_vrac))
    {
?&gt;
 
&lt;tr&gt;
&lt;td&gt;&lt;?php echo ($donnees['email']); ?&gt;&lt;/td&gt;
&lt;/tr&gt;
 
&lt;?php
    }
?&gt;
&lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-404877" data-claire-element-id="404877">Voilà, vous pouvez maintenant ajouter un message à vos newsletters en plus des news ! :soleil:</p></div></li></ul><p id="r-404881" data-claire-element-id="404881">Mais je suis sûr que vous pouvez trouver plein d'autres améliorations. :D</p><p id="r-404882" data-claire-element-id="404882">N'hésitez pas à <a href="http://www.siteduzero.com/mp-273-42297.html">m'envoyer un MP</a> si vous en trouvez d'autres ! :p</p><p id="r-404883" data-claire-element-id="404883">Bon, ben voilà. J'espère que ce tuto vous a rendu service et que vous allez créer un système de newsletter.<br/> Je ne peux pas mettre d'exemple pour newsletter.php parce que sinon, cela enverrait un mail à plein de gens qui ne veulent pas le recevoir.<br/> À bientôt ! :) Et merci d'avoir lu ce tutoriel jusqu'au bout ! :p</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter">Créer un système de newsletter</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter/presentation-107">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter/les-differents-fichiers">
Les différents fichiers
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter/ameliorations-22">
Améliorations
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-systeme-de-newsletter/les-differents-fichiers">
<span class="arrow"></span>
<span class="next">Les différents fichiers</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/creer-un-systeme-de-newsletter.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 19:55:40 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/creer-un-systeme-de-newsletter.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:40:46 GMT -->
</html>