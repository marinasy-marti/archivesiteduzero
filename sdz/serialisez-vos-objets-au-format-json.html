<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/serialisez-vos-objets-au-format-json.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 03:48:37 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/serialisez-vos-objets-au-format-json.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:45:32 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Sérialisez vos objets au format JSON !</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/serialisez-vos-objets-au-format-json.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Sérialisez vos objets au format JSON !</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#SrialisezvosobjetsauformatJSON">Sérialisez vos objets au format JSON !</a><br/><a href="#PrsentationduformatJSON">Présentation du format JSON</a><br/><a href="#Prsentationdumodule">Présentation du module</a><br/><a href="#Srialisonsnospropresclasses">Sérialisons nos propres classes !</a><br/><a href="#Annexe">Annexe</a><br/></div>
<a name="SrialisezvosobjetsauformatJSON"></a><h2>Sérialisez vos objets au format JSON !</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/presentation-du-format-json">
<span class="next">Présentation du format JSON</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-537223" data-claire-element-id="537223">Ah, la POO… Quel plaisir de créer et de manipuler des objets aussi facilement ! Mais comment les sauvegarder simplement ou les faire transiter sur un réseau ?<br/> En utilisant la <a href="http://fr.wikipedia.org/wiki/Sérialisation">sérialisation</a>, pardi ! :pirate:</p><p id="r-537224" data-claire-element-id="537224">Dans le tutoriel officiel de ce site concernant Python, les auteurs abordent <a href="http://www.siteduzero.com/tutoriel-3-277215-les-fichiers.html#ss_part_3">l'utilisation du module <em>pickle</em></a> pour mener à bien la sérialisation de vos classes.<br/> Je tiens à vous présenter le module JSON qui a le même objectif : sauvegarder et restaurer les attributs de vos classes.</p><p id="r-537225" data-claire-element-id="537225">Tout au long de ce tutoriel, on distinguera bien <strong>le format de fichier JSON</strong> représentant la manière dont laquelle sont organisées les données dans le fichier et <strong>le module Python <code data-claire-semantic="python">json</code></strong> qui permet, quant à lui, de manipuler cette représentation de données.</p>
</div><a name="PrsentationduformatJSON"></a><h2>Présentation du format JSON</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/presentation-du-module">
<span class="next">Présentation du module</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-537226" data-claire-element-id="537226">Dans cette partie, je vais vous présenter le format JSON et ses spécificités.</p><h2 id="r-introduction-au-format-json" data-claire-element-id="537235">Introduction au format JSON</h2><p id="r-537227" data-claire-element-id="537227"><cite>Citation : Wikipédia</cite></p><blockquote id="r-537229" data-claire-element-id="537229"><p id="r-537228" data-claire-element-id="537228">JSON (<em>JavaScript Object Notation</em>) est un format de données textuel, générique, dérivé de la notation des objets du langage ECMAScript. Il permet de représenter de l'information structurée.</p></blockquote><div id="r-537231" data-claire-element-id="537231" data-claire-semantic="question"><p id="r-537230" data-claire-element-id="537230">Euh… J'ai lu « <em>JavaScript Object Notation</em> ». Pourquoi venir nous parler de JavaScript dans un tutoriel concernant Python ?<br/> C'est quoi cette histoire ? :o</p></div><p id="r-537232" data-claire-element-id="537232">En fait, JSON est un format permettant de représenter des données. On peut comparer son usage à celui du XML.</p><aside id="r-537234" data-claire-element-id="537234" data-claire-semantic="information"><p id="r-537233" data-claire-element-id="537233">Tout comme le XML, le JSON peut être lu par de nombreux langages de programmation (33 à l'heure actuelle) dont le Python et même… l'humain !<br/> En effet, il s'agit d'un format texte et contrairement au format binaire (<strong>utilisé par <em>pickle</em></strong>), vous pourrez voir et modifier facilement des valeurs avec un quelconque éditeur de texte.</p></aside><h2 id="r-presentation-du-format-json-par-l-exemple" data-claire-element-id="537256">Présentation du format JSON par l'exemple</h2><p id="r-537236" data-claire-element-id="537236">Je vais ici vous présenter deux exemples de fichiers représentant les caractéristiques d'une <em>playlist</em> : l'un en XML et l'autre en JSON.<br/> Voici sa représentation « humaine ».</p><p id="r-537237" data-claire-element-id="537237">La <em>playlist</em> nommée <strong>MeshowRandom</strong> est composée de :</p><ul id="r-537242" data-claire-element-id="537242"><li id="r-537239" data-claire-element-id="537239"><p id="r-537238" data-claire-element-id="537238"><em><strong>Best Improvisation Ever 2</strong></em> de <strong>David Meshow</strong> avec une note de <strong>5/5</strong> ;</p></li><li id="r-537241" data-claire-element-id="537241"><p id="r-537240" data-claire-element-id="537240"><em><strong>My Theory</strong></em> de <strong>David Meshow</strong> avec une note de <strong>4/5</strong>.</p></li></ul><p id="r-537243" data-claire-element-id="537243">Voyons maintenant sa représentation « informatique » en examinant les fichiers correspondants à cette description.</p><h3 id="r-tout-d-abord-en-xml" data-claire-element-id="537246">Tout d'abord, en XML !</h3><p id="r-537244" data-claire-element-id="537244">Le format de balisage XML est très répandu (le zCode est dérivé du XML !).</p><pre id="r-537245" data-claire-element-id="537245"><code data-claire-semantic="xml">&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;playlist nom=&quot;MeshowRandom&quot;&gt;
    &lt;chanson&gt;
        &lt;titre&gt;Best Improvisation Ever 2&lt;/titre&gt;
        &lt;auteur&gt;David Meshow&lt;/auteur&gt;
        &lt;note&gt;5&lt;/note&gt;
    &lt;/chanson&gt;
    &lt;chanson&gt;
        &lt;titre&gt;My Theory (Bonus)&lt;/titre&gt;
        &lt;auteur&gt;David Meshow&lt;/auteur&gt;
        &lt;note&gt;4&lt;/note&gt;
    &lt;/chanson&gt;
&lt;/playlist&gt;</code></pre><h3 id="r-et-en-json-ca-donne-quoi" data-claire-element-id="537249">Et en JSON, ça donne quoi ?</h3><p id="r-537247" data-claire-element-id="537247">Voici les mêmes informations contenues dans un fichier JSON.</p><pre id="r-537248" data-claire-element-id="537248"><code data-claire-semantic="javascript">{
    &quot;nom&quot; : &quot;MeshowRandom&quot;,
    
    &quot;chansons&quot; : [
        {
            &quot;titre&quot; : &quot;Best Improvisation Ever 2&quot;,
            &quot;auteur&quot; : &quot;David Meshow&quot;,
            &quot;note&quot; : 5
        },     
        {
            &quot;titre&quot; : &quot;My Theory&quot;,
            &quot;auteur&quot; : &quot;David Meshow&quot;,
            &quot;note&quot; : 4
        }
    ]
}</code></pre><h3 id="r-bilan-7" data-claire-element-id="537255">Bilan</h3><p id="r-537250" data-claire-element-id="537250">À partir de cette comparaison, on peut clairement voir émerger l'avantage principal du format JSON par rapport au format XML : <strong>il est minimaliste</strong>.</p><aside id="r-537252" data-claire-element-id="537252" data-claire-semantic="information"><p id="r-537251" data-claire-element-id="537251">En effet, JSON se base plus sur un modèle clé/valeur que sur un format de balisage. Cela permet d'éviter les balises de fermeture, la répétition et cela peut éventuellement représenter un gain de place sur de très gros fichiers (16 caractères économisés ici en comptant les espaces, soit 95% de la taille originale).</p></aside><aside id="r-537254" data-claire-element-id="537254" data-claire-semantic="warning"><p id="r-537253" data-claire-element-id="537253">Attention cependant : le format JSON ne possède pas de spécification <strong>concernant les commentaires</strong>. Vous pouvez en rajouter de la même manière qu'en JavaScript avec <code data-claire-semantic="javascript">// Commentaire</code> ou <code data-claire-semantic="javascript">/* Commentaire */</code> mais rien ne garantit qu'ils seront pris en compte et ils pourraient (dans le pire des cas) faire planter votre programme selon votre parseur.<br/> Dans le doute, <strong>évitez les commentaires dans vos fichiers JSON</strong> histoire de rester conforme à la norme officielle.</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json">Sérialisez vos objets au format JSON !</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/presentation-du-format-json">
Présentation du format JSON
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/presentation-du-module">
Présentation du module
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/serialisons-nos-propres-classes">
Sérialisons nos propres classes !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/annexe-12">
Annexe
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/presentation-du-module">
<span class="next">Présentation du module</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Prsentationdumodule"></a><h2>Présentation du module</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/presentation-du-format-json">
<span class="arrow"></span>
<span class="next">Présentation du format JSON</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/serialisons-nos-propres-classes">
<span class="next">Sérialisons nos propres classes !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-537258" data-claire-element-id="537258">Eh bien tout d'abord, comme tout module, il faut l'inclure. Pour ce faire, rien de plus simple :</p><pre id="r-537259" data-claire-element-id="537259"><code data-claire-semantic="python">import json</code></pre><aside id="r-537261" data-claire-element-id="537261" data-claire-semantic="information"><p id="r-537260" data-claire-element-id="537260">En important le module de cette manière, cela m'oblige à ajouter à chaque fois le préfixe <code data-claire-semantic="python">json</code> devant les fonctions du module.<br/> Je trouve cela plus rigoureux ; mais libre à vous d'utiliser <code data-claire-semantic="python">from json import *</code> si cela vous dérange (même si c'est <a href="http://stackoverflow.com/questions/2360724/in-python-what-exactly-does-import-import">très</a><a href="http://stackoverflow.com/questions/2386714/in-python-why-is-import-bad">déconseillé</a>).</p></aside><p id="r-537262" data-claire-element-id="537262">Sachez que ce module est déjà capable de sérialiser tous les types standards de Python hormis les <em>tuples</em> et les entrées binaires (en même temps, pour un format texte…).</p><h2 id="r-premier-exemple-serialiser-dans-une-chaine-de-caracteres" data-claire-element-id="537277">Premier exemple : sérialiser dans une chaîne de caractères</h2><aside id="r-537264" data-claire-element-id="537264" data-claire-semantic="information"><p id="r-537263" data-claire-element-id="537263">Dans cet exemple, je vais tenter de reproduire la <em>playlist</em> que je vous ai montrée dans la partie de découverte du format JSON.<br/> Cependant, pour plus de commodité, je vais seulement enregistrer les titres des musiques ; nous verrons dans l'annexe comment procéder avec une classe <code data-claire-semantic="python">Musique</code>. ;)</p></aside><p id="r-537265" data-claire-element-id="537265">Tout d'abord, on inclut le module JSON :</p><pre id="r-537266" data-claire-element-id="537266"><code data-claire-semantic="pycon">&gt;&gt;&gt; import json</code></pre><p id="r-537267" data-claire-element-id="537267">Ensuite, on peuple la <em>playlist</em> :</p><pre id="r-537268" data-claire-element-id="537268"><code data-claire-semantic="pycon">&gt;&gt;&gt; playlist = {}
&gt;&gt;&gt; playlist[&quot;nom&quot;] = &quot;MeshowRandom&quot;
&gt;&gt;&gt; playlist[&quot;musiques&quot;] = []
&gt;&gt;&gt; playlist[&quot;musiques&quot;].append(&quot;Best Improvisation Ever 2&quot;)
&gt;&gt;&gt; playlist[&quot;musiques&quot;].append(&quot;My Theory (Bonus)&quot;)
&gt;&gt;&gt; 
&gt;&gt;&gt; print(playlist)
{'musiques': ['Best Improvisation Ever 2', 'My Theory (Bonus)'], 'nom': 'MeshowRandom'}</code></pre><p id="r-537269" data-claire-element-id="537269">Voici à présent la partie intéressante : on va demander au module de transposer notre dictionnaire au format JSON.<br/> Pour cela, on va se servir de la fonction <code data-claire-semantic="python">json.dumps(objet)</code> (le <em>s</em> signifie ici <em>string</em>).</p><pre id="r-537270" data-claire-element-id="537270"><code data-claire-semantic="pycon">&gt;&gt;&gt; print(json.dumps(playlist))
{&quot;musiques&quot;: [&quot;Best Improvisation Ever 2&quot;, &quot;My Theory (Bonus)&quot;], &quot;nom&quot;: &quot;MeshowRandom&quot;}</code></pre><p id="r-537271" data-claire-element-id="537271">Vous pouvez constater que la fonction nous retourne une chaîne de caractères décrivant bien notre <em>playlist</em> au format JSON !</p><div id="r-537273" data-claire-element-id="537273" data-claire-semantic="question"><p id="r-537272" data-claire-element-id="537272">Mais le code est sur une seule ligne et n'est pas indenté…<br/> C'est illisible ! :o</p></div><p id="r-537274" data-claire-element-id="537274">En effet, ce n'est pas très lisible pour nous, mortels.<br/> On peut heureusement procéder comme ceci pour indenter automatiquement la sortie de la fonction :</p><pre id="r-537275" data-claire-element-id="537275"><code data-claire-semantic="pycon">&gt;&gt;&gt; print(json.dumps(playlist, indent=4))
{
    &quot;musiques&quot;: [
        &quot;Best Improvisation Ever 2&quot;,
        &quot;My Theory (Bonus)&quot;
    ],
    &quot;nom&quot;: &quot;MeshowRandom&quot;
}</code></pre><p id="r-537276" data-claire-element-id="537276">C'est déjà plus clair. :)</p><h2 id="r-deuxieme-exemple-serialiser-dans-un-fichier" data-claire-element-id="537290">Deuxième exemple : sérialiser dans un fichier</h2><div id="r-537279" data-claire-element-id="537279" data-claire-semantic="question"><p id="r-537278" data-claire-element-id="537278">Eh bien, il suffit de sauvegarder la chaîne retournée par <code data-claire-semantic="python">json.dumps(objet)</code> dans un fichier, non ?<br/> Pourquoi ce deuxième exemple ?</p></div><p id="r-537280" data-claire-element-id="537280">On pourrait le faire, mais il est plus pratique d'utiliser une fonction du module dédiée à l'écriture dans les fichiers : la fonction <code data-claire-semantic="python">json.dump(objet, flux)</code>.<br/> Celle-ci va directement écrire dans le flux de données (ici notre fichier), sans passer par une chaîne de caractères intermédiaire.</p><p id="r-537281" data-claire-element-id="537281">On va conserver la <em>playlist</em> remplie précédemment et utiliser cette fonction :</p><pre id="r-537282" data-claire-element-id="537282"><code data-claire-semantic="pycon">&gt;&gt;&gt; with open('Test.json', 'w', encoding='utf-8') as f:
...    json.dump(playlist, f, indent=4)</code></pre><p id="r-537283" data-claire-element-id="537283">Voici ce que j'obtiens :</p><pre id="r-537284" data-claire-element-id="537284"><code data-claire-semantic="javascript">{
    &quot;musiques&quot;: [
        &quot;Best Improvisation Ever 2&quot;, 
        &quot;My Theory (Bonus)&quot;
    ], 
    &quot;nom&quot;: &quot;MeshowRandom&quot;
}</code></pre><p id="r-537285" data-claire-element-id="537285">C'est beau, n'est-ce pas ?</p><aside id="r-537287" data-claire-element-id="537287" data-claire-semantic="information"><p id="r-537286" data-claire-element-id="537286">On remarquera que les clés ont été rangées un peu n'importe comment ; cela est dû au fait que Python range les paires de façon arbitraire.<br/> Si vous voulez que les attributs soient sérialisés dans le même ordre que celui que vous avez indiqué, alors utilisez un <code data-claire-semantic="python">OrderedDict</code> fourni dans le module <code data-claire-semantic="python">collections</code>.</p></aside><p id="r-537288" data-claire-element-id="537288">Voici un exemple :</p><pre id="r-537289" data-claire-element-id="537289"><code data-claire-semantic="pycon">&gt;&gt;&gt; from collections import OrderedDict
&gt;&gt;&gt; dct = OrderedDict()
&gt;&gt;&gt; dct[&quot;__class__&quot;] = &quot;Playlist&quot;
&gt;&gt;&gt; dct[&quot;name&quot;] = &quot;MeshowRandom&quot;
&gt;&gt;&gt; dct[&quot;description&quot;] = &quot;Cool stuff.&quot;
&gt;&gt;&gt;
&gt;&gt;&gt; import json
&gt;&gt;&gt; print(json.dumps(dct, indent=&quot;4&quot;))
{
    &quot;__class__&quot;: &quot;Playlist&quot;,
    &quot;name&quot;: &quot;MeshowRandom&quot;,
    &quot;description&quot;: &quot;Cool stuff.&quot;
}</code></pre><h2 id="r-et-apres-9" data-claire-element-id="537293">Et après ?</h2><p id="r-537291" data-claire-element-id="537291">Désormais, vous savez sérialiser les principaux objets de Python au format JSON, et ce, dans des fichiers.<br/> Cependant, avant de vous quitter, j'aimerais aborder la sérialisation d'instances de classes inconnues du module <code data-claire-semantic="python">json</code> telles que la classe <code data-claire-semantic="python">Playlist</code> ou la classe <code data-claire-semantic="python">Musique</code>.</p><p id="r-537292" data-claire-element-id="537292">Pour cela, rendez-vous dans la partie suivante. ;)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json">Sérialisez vos objets au format JSON !</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/presentation-du-format-json">
Présentation du format JSON
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/presentation-du-module">
Présentation du module
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/serialisons-nos-propres-classes">
Sérialisons nos propres classes !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/annexe-12">
Annexe
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/presentation-du-format-json">
<span class="arrow"></span>
<span class="next">Présentation du format JSON</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/serialisons-nos-propres-classes">
<span class="next">Sérialisons nos propres classes !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Srialisonsnospropresclasses"></a><h2>Sérialisons nos propres classes !</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/presentation-du-module">
<span class="arrow"></span>
<span class="next">Présentation du module</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/annexe-12">
<span class="next">Annexe</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-537295" data-claire-element-id="537295">Nous allons maintenant nous attaquer au vif du sujet : comment sérialiser nos classes avec le module <code data-claire-semantic="python">json</code>.<br/> Prenons cette classe comme exemple : la classe <em>Playlist</em> (encore et toujours :p ).</p><pre id="r-537296" data-claire-element-id="537296"><code data-claire-semantic="python">class Playlist:
    def __init__(self, nom):
        nom = nom
        musiques = []</code></pre><aside id="r-537298" data-claire-element-id="537298" data-claire-semantic="information"><p id="r-537297" data-claire-element-id="537297">Dans cet exemple, les entrées dans <code data-claire-semantic="python">musiques</code> seront de simples chaînes de caractères représentant les titres des chansons.<br/> Libre à vous de les remplacer par des dictionnaires ou, mieux, des instances de la classe Musique qui contient son auteur, sa note, etc. (Il faudra néanmoins que la classe Musique soit également sérialisable en JSON pour pouvoir sérialiser la <em>playlist</em>).</p></aside><h2 id="r-serialisation-1" data-claire-element-id="537313">Sérialisation</h2><p id="r-537299" data-claire-element-id="537299">Voici la fonction qui va sérialiser notre objet :</p><pre id="r-537300" data-claire-element-id="537300"><code data-claire-semantic="python">def serialiseur_perso(obj):
    if isinstance(obj, Playlist):
        return {&quot;__class__&quot;: &quot;Playlist&quot;
                &quot;nom&quot;: obj.nom,
                &quot;musiques&quot;: obj.musiques}
    raise TypeError(repr(obj) + &quot; n'est pas sérialisable !&quot;)</code></pre><p id="r-537301" data-claire-element-id="537301">Je vais vous décrire pas à pas ce que produit ce code :</p><ul id="r-537308" data-claire-element-id="537308"><li id="r-537303" data-claire-element-id="537303"><p id="r-537302" data-claire-element-id="537302">d'abord, on vérifie que l'objet passé est bien de type <em>Playlist</em> ;</p></li><li id="r-537305" data-claire-element-id="537305"><p id="r-537304" data-claire-element-id="537304">si l'objet est bien une instance de la classe <em>Playlist</em>, <strong>on retourne un type sérialisable par le module</strong> (ici un dictionnaire) contenant les attributs à sauvegarder de notre classe ;</p></li><li id="r-537307" data-claire-element-id="537307"><p id="r-537306" data-claire-element-id="537306">sinon, on lance une exception disant que l'objet passé n'est pas sérialisable.</p></li></ul><p id="r-537309" data-claire-element-id="537309">Ingénieux, non ?</p><div id="r-537311" data-claire-element-id="537311" data-claire-semantic="question"><p id="r-537310" data-claire-element-id="537310">Euh… c'est quoi, l'entrée <code data-claire-semantic="python">&quot;__class__&quot;</code> dans le dictionnaire ?<br/> Ça se mange ?</p></div><p id="r-537312" data-claire-element-id="537312">Il s'agit en fait d'une entrée qui n'est pas contenue dans l'objet en lui-même mais elle va nous permettre de savoir de quel type est la représentation JSON de l'objet. Vous comprendrez mieux son utilité lors de la désérialisation.</p><h2 id="r-deserialisation" data-claire-element-id="537324">Désérialisation</h2><p id="r-537314" data-claire-element-id="537314">Nous allons maintenant faire l'inverse de la fonction <code data-claire-semantic="python">serialiser_json</code> : convertir le dictionnaire obtenu par le module json en <em>playlist</em> :</p><pre id="r-537315" data-claire-element-id="537315"><code data-claire-semantic="python">def deserialiseur_perso(obj_dict):
    if &quot;__class__&quot; in obj_dict:
        if obj_dict[&quot;__class__&quot;] == &quot;Playlist&quot;:
            obj = Playlist(objet[&quot;nom&quot;])
            obj.musiques = objet[&quot;musiques&quot;]
            return obj
    return objet</code></pre><p id="r-537316" data-claire-element-id="537316">Voici ce que fait le code :</p><ul id="r-537323" data-claire-element-id="537323"><li id="r-537318" data-claire-element-id="537318"><p id="r-537317" data-claire-element-id="537317">on regarde si <code data-claire-semantic="python">&quot;__class__&quot;</code> est défini dans le dictionnaire <code data-claire-semantic="python">obj_dict</code> ;</p></li><li id="r-537320" data-claire-element-id="537320"><p id="r-537319" data-claire-element-id="537319">si oui, on vérifie si <code data-claire-semantic="python">&quot;__class__&quot; == &quot;Playlist&quot;</code> et on retourne l'objet <code data-claire-semantic="python">obj</code> créé à l'aide du contenu du dictionnaire ;</p></li><li id="r-537322" data-claire-element-id="537322"><p id="r-537321" data-claire-element-id="537321">sinon, on retourne le dictionnaire.</p></li></ul><h2 id="r-utilisation-77" data-claire-element-id="537330">Utilisation</h2><h3 id="r-serialiser-un-objet" data-claire-element-id="537326">Sérialiser un objet</h3><pre id="r-537325" data-claire-element-id="537325"><code data-claire-semantic="python"># On crée un objet de type Playlist et on le peuple.
playlist = Playlist(&quot;MeshowRandom&quot;)
playlist.musiques.append(&quot;Best improvisation ever 2&quot;)
playlist.musiques.append(&quot;My Theory&quot;)

# On l'enregistre dans un fichier JSON avec notre sérialiseur perso.
with open(&quot;MaPlaylist.json&quot;, &quot;w&quot;, encoding=&quot;utf-8&quot;) as fichier:
    json.dump(playlist, fichier, default=serialiseur_perso)</code></pre><h3 id="r-deserialiser-un-objet" data-claire-element-id="537329">Désérialiser un objet</h3><pre id="r-537327" data-claire-element-id="537327"><code data-claire-semantic="python"># On crée un objet vide.
playlist = Playlist(&quot;untitled&quot;)

# On le peuple à l'aide du fichier JSON.
with open(&quot;MaPlaylist.json&quot;, &quot;r&quot;, encoding=&quot;utf-8&quot;) as fichier:
    playlist = json.load(fichier, object_hook=deserialiseur_perso)</code></pre><p id="r-537328" data-claire-element-id="537328">Ça y est, vous êtes désormais capable de sérialiser toutes vos classes dans des fichiers JSON !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json">Sérialisez vos objets au format JSON !</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/presentation-du-format-json">
Présentation du format JSON
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/presentation-du-module">
Présentation du module
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/serialisons-nos-propres-classes">
Sérialisons nos propres classes !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/annexe-12">
Annexe
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/presentation-du-module">
<span class="arrow"></span>
<span class="next">Présentation du module</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/annexe-12">
<span class="next">Annexe</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Annexe"></a><h2>Annexe</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/serialisons-nos-propres-classes">
<span class="arrow"></span>
<span class="next">Sérialisons nos propres classes !</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-serialiser-plusieurs-objets" data-claire-element-id="537339">Sérialiser plusieurs objets</h2><h3 id="r-contexte-5" data-claire-element-id="537333">Contexte</h3><p id="r-537332" data-claire-element-id="537332">Supposons que vous ne vouliez pas sérialiser une seule <em>playlist</em> mais plusieurs situées dans un tableau.<br/> Eh bien, étant donné que les tableaux Python sont sérialisables par défaut avec le module, il ne devrait pas y avoir de problème !</p><h3 id="r-resultat-15" data-claire-element-id="537338">Résultat</h3><p id="r-537334" data-claire-element-id="537334">On peuple deux <em>playlists</em> et on les ajoute dans un tableau puis on enregistre ce même tableau :</p><pre id="r-537335" data-claire-element-id="537335"><code data-claire-semantic="python">pl1 = Playlist(&quot;MeshowRandom&quot;)
pl1.musiques.append(&quot;Best improvisation ever 2&quot;)
pl1.musiques.append(&quot;My theory&quot;)

pl2 = Playlist(&quot;MeshowRandom2&quot;)
pl2.musiques.append(&quot;Corolla song&quot;)
pl2.musiques.append(&quot;Best guitar improvisation ever&quot;)

liste_playlists = []
liste_playlists.append(pl1)
liste_playlists.append(pl2)

with open('Test.json', 'w', encoding='utf-8') as f:
    json.dump(liste_playlists, f, indent=4, default=serialiseur_perso)</code></pre><p id="r-537336" data-claire-element-id="537336">Et voici ce que ça donne :</p><pre id="r-537337" data-claire-element-id="537337"><code data-claire-semantic="javascript">[
    {
        &quot;musiques&quot;: [
            &quot;Best improvisation ever 2&quot;, 
            &quot;My theory&quot;
        ], 
        &quot;nom&quot;: &quot;MeshowRandom&quot;, 
        &quot;__class__&quot;: &quot;Playlist&quot;
    }, 
    {
        &quot;musiques&quot;: [
            &quot;Corolla song&quot;, 
            &quot;Best guitar improvisation ever&quot;
        ], 
        &quot;nom&quot;: &quot;MeshowRandom2&quot;, 
        &quot;__class__&quot;: &quot;Playlist&quot;
    }
]</code></pre><h2 id="r-serialiser-plusieurs-classes-differentes" data-claire-element-id="537350">Sérialiser plusieurs classes différentes</h2><h3 id="r-contexte-6" data-claire-element-id="537344">Contexte</h3><p id="r-537340" data-claire-element-id="537340">Supposons que vous vouliez sérialiser votre <em>playlist</em> qui contient elle-même des instances de la classe <code data-claire-semantic="python">Musique</code> :</p><pre id="r-537341" data-claire-element-id="537341"><code data-claire-semantic="python">class Playlist:
    def __init__(self, nom):
        self.nom = nom
        self.musiques = []

class Musique:
    def __init__(self, titre, auteur, note = 3):
        self.titre = titre
        self.auteur = auteur
        self.note = note</code></pre><p id="r-537342" data-claire-element-id="537342">Il va donc falloir étendre la fonction <code data-claire-semantic="python">serialiseur_perso</code> en lui indiquant comment sérialiser la classe <code data-claire-semantic="python">Playlist</code><strong>et</strong> la classe <code data-claire-semantic="python">Musique</code>.<br/> Voici ce que ça donne :</p><pre id="r-537343" data-claire-element-id="537343"><code data-claire-semantic="python">def serialiseur_perso(obj):

    # Si c'est une musique.
    if isinstance(obj, Musique):
        return {&quot;__class__&quot;: &quot;Musique&quot;,
                &quot;titre&quot;: obj.titre,
                &quot;auteur&quot;: obj.auteur,
                &quot;note&quot;: obj.note}
    
    # Si c'est une playlist.
    if isinstance(obj, Playlist):
        return {&quot;__class__&quot;: &quot;Playlist&quot;,
                &quot;nom&quot;: obj.nom,
                &quot;musiques&quot;: obj.musiques}

    # Sinon le type de l'objet est inconnu, on lance une exception.
    raise TypeError(repr(obj) + &quot; n'est pas sérialisable !&quot;)</code></pre><h3 id="r-resultat-16" data-claire-element-id="537349">Résultat</h3><p id="r-537345" data-claire-element-id="537345">Voici le code d'exemple, dans lequel on va peupler la <em>playlist</em> d'instances de la classe <code data-claire-semantic="python">Musique</code> :</p><pre id="r-537346" data-claire-element-id="537346"><code data-claire-semantic="python">playlist = Playlist(&quot;MeshowRandom&quot;)
playlist.musiques.append(Musique(&quot;Best Improvisation Ever 2&quot;, &quot;David Meshow&quot;, 5))
playlist.musiques.append(Musique(&quot;My Theory&quot;, &quot;David Meshow&quot;, 4))

with open('Test.json', 'w', encoding='utf-8') as f:
    json.dump(playlist, f, indent=4, default=serialiseur_perso)</code></pre><p id="r-537347" data-claire-element-id="537347">Et enfin le contenu du fichier :</p><pre id="r-537348" data-claire-element-id="537348"><code data-claire-semantic="javascript">{
    &quot;musiques&quot;: [
        {
            &quot;note&quot;: 5, 
            &quot;titre&quot;: &quot;Best Improvisation Ever 2&quot;, 
            &quot;auteur&quot;: &quot;David Meshow&quot;, 
            &quot;__class__&quot;: &quot;Musique&quot;
        }, 
        {
            &quot;note&quot;: 4, 
            &quot;titre&quot;: &quot;My Theory&quot;, 
            &quot;auteur&quot;: &quot;David Meshow&quot;, 
            &quot;__class__&quot;: &quot;Musique&quot;
        }
    ], 
    &quot;nom&quot;: &quot;MeshowRandom&quot;, 
    &quot;__class__&quot;: &quot;Playlist&quot;
}</code></pre><h2 id="r-utilisation-avec-l-heritage" data-claire-element-id="537383">Utilisation avec l'héritage</h2><h3 id="r-contexte-7" data-claire-element-id="537362">Contexte</h3><p id="r-537351" data-claire-element-id="537351">Supposons que certaines de vos <em>playlists</em> peuvent être imagées, voici alors ce que l'on pourrait avoir :</p><pre id="r-537352" data-claire-element-id="537352"><code data-claire-semantic="python">class Playlist:
    def __init__(self, nom):
        self.nom = nom
        self.musiques = []
        
class ImagedPlaylist(Playlist):
    def __init__(self, nom):
        Playlist.__init__(self, nom)
        self.image = &quot;&quot;</code></pre><p id="r-537353" data-claire-element-id="537353">La classe <code data-claire-semantic="python">ImagedPlaylist</code> hérite donc de la classe <code data-claire-semantic="python">Playlist</code>, mais comment faire pour sérialiser le tout ?</p><p id="r-537354" data-claire-element-id="537354">Nous allons tout d'abord enregistrer les attributs de la classe <code data-claire-semantic="python">ImagedPlaylist</code> puis ensuite, dans un champ nommé <code data-claire-semantic="python">&quot;__parent__&quot;</code>, nous transformeront cet objet de type <code data-claire-semantic="python">ImagedPlaylist</code> en objet de type <code data-claire-semantic="python">Playlist</code> (<em>downcasting</em>) pour pouvoir enregistrer les attributs hérités de l'objet parent (comme l'attribut <code data-claire-semantic="python">musiques</code> par exemple).</p><p id="r-537355" data-claire-element-id="537355">Voici le code Python qui vous permettra d'effectuer un <em>downcasting</em> :</p><pre id="r-537356" data-claire-element-id="537356"><code data-claire-semantic="python">import copy

def ImagedPlaylist2Playlist(obj):
    obj_cpy = copy.copy(obj)          # On copie l'objet
    obj_cpy.__class__ = Playlist      # On change son attribut __class__ pour le convertir

    return obj_cpy</code></pre><p id="r-537357" data-claire-element-id="537357">Pour les plus sceptiques, voici la preuve en image :</p><pre id="r-537358" data-claire-element-id="537358"><code data-claire-semantic="pycon">&gt;&gt;&gt; import copy
&gt;&gt;&gt; obj = ImagedPlaylist(&quot;MeshowRandom&quot;)
&gt;&gt;&gt;
&gt;&gt;&gt; obj_cpy = copy.copy(obj)
&gt;&gt;&gt; obj_cpy.__class__ = Playlist
&gt;&gt;&gt;
&gt;&gt;&gt; print(obj)
&lt;__main__.ImagedPlaylist object at 0x0000000003380630&gt;
&gt;&gt;&gt; print(obj_cpy)
&lt;__main__.Playlist object at 0x0000000003385DD8&gt;</code></pre><p id="r-537359" data-claire-element-id="537359">Ainsi nous allons pouvoir directement le rajouter dans notre fonction <code data-claire-semantic="python">serialiseur_perso</code> :</p><pre id="r-537360" data-claire-element-id="537360"><code data-claire-semantic="python">import copy
def serialiseur_perso(obj):
    if isinstance(obj, ImagedPlaylist):
        obj_cpy = copy.copy(obj)
        obj_cpy.__class__ = Playlist
        return {&quot;__class__&quot;: &quot;ImagedPlaylist&quot;,
                &quot;image&quot;: obj.image,
                &quot;__parent__&quot;: obj_cpy}
    
    if isinstance(obj, Playlist):
        return {&quot;__class__&quot;: &quot;Playlist&quot;,
                &quot;nom&quot;: obj.nom,
                &quot;musiques&quot;: obj.musiques}</code></pre><p id="r-537361" data-claire-element-id="537361">A la ligne 8, on va demander au module de sérialiser un objet de type Playlist, il va donc en interne rappeler cette fonction avec l'objet de type Playlist que nous venons de convertir !</p><h3 id="r-resultat-17" data-claire-element-id="537382">Résultat</h3><p id="r-537363" data-claire-element-id="537363">Le tout marche très bien, voici ce que l'on peut obtenir :</p><pre id="r-537364" data-claire-element-id="537364"><code data-claire-semantic="javascript">{
    &quot;image&quot;: &quot;Test.png&quot;, 
    &quot;__class__&quot;: &quot;ImagedPlaylist&quot;, 
    &quot;__parent__&quot;: {
        &quot;musiques&quot;: [], 
        &quot;nom&quot;: &quot;MeshowRandom&quot;, 
        &quot;__class__&quot;: &quot;Playlist&quot;
    }
}</code></pre><p id="r-537365" data-claire-element-id="537365">Nous voilà arrivés au terme de ce tutoriel. Vous pouvez à présent supprimer les <em>parseurs</em> faits maison de fichiers texte et utiliser le format JSON ainsi que son module Python sans modération. :p</p><p id="r-537366" data-claire-element-id="537366"><strong>Sources :</strong></p><ul id="r-537373" data-claire-element-id="537373"><li id="r-537368" data-claire-element-id="537368"><p id="r-537367" data-claire-element-id="537367"><a href="http://fr.wikipedia.org/wiki/Json">JSON sur Wikipédia</a> (pour la présentation du format JSON) ;</p></li><li id="r-537370" data-claire-element-id="537370"><p id="r-537369" data-claire-element-id="537369"><a href="http://diveintopython3.net/serializing.html"><em>Serializing Python objects</em></a> tiré du fameux livre <em><a href="http://diveintopython3.net/">Dive into Python 3</a></em> pour les fonctions <code data-claire-semantic="python">serialiseur_perso</code> et <code data-claire-semantic="python">deserialiseur_perso</code> ;</p></li><li id="r-537372" data-claire-element-id="537372"><p id="r-537371" data-claire-element-id="537371">et évidemment <a href="http://docs.python.org/release/3.1.3/library/json.html">la doc du module</a> !</p></li></ul><p id="r-537374" data-claire-element-id="537374"><strong>Remerciements :</strong></p><ul id="r-537381" data-claire-element-id="537381"><li id="r-537376" data-claire-element-id="537376"><p id="r-537375" data-claire-element-id="537375"><a href="http://www.siteduzero.com/membres-294-1398.html">Thunderseb</a> pour ses conseils ;</p></li><li id="r-537378" data-claire-element-id="537378"><p id="r-537377" data-claire-element-id="537377"><a href="http://www.zcorrecteurs.fr/">L'équipe des zCorrecteurs</a> et plus particulièrement <a href="http://www.siteduzero.com/membres-294-63057.html">Guill@um€</a> et <a href="http://www.siteduzero.com/membres-294-39073.html">Stylla</a> pour leur relecture attentive ;</p></li><li id="r-537380" data-claire-element-id="537380"><p id="r-537379" data-claire-element-id="537379">Et <a href="http://www.siteduzero.com/membres-294-18977.html">Zopieux</a> pour ses précisions.</p></li></ul>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json">Sérialisez vos objets au format JSON !</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/presentation-du-format-json">
Présentation du format JSON
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/presentation-du-module">
Présentation du module
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/serialisons-nos-propres-classes">
Sérialisons nos propres classes !
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/annexe-12">
Annexe
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/serialisez-vos-objets-au-format-json/serialisons-nos-propres-classes">
<span class="arrow"></span>
<span class="next">Sérialisons nos propres classes !</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/serialisez-vos-objets-au-format-json.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 03:48:37 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/serialisez-vos-objets-au-format-json.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:45:32 GMT -->
</html>