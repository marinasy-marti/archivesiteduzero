<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/faire-des-animations-avec-sdlp-anim.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:12:37 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/faire-des-animations-avec-sdlp-anim.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:31:31 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Faire des animations avec SDLP_Anim</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/faire-des-animations-avec-sdlp-anim.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Faire des animations avec SDLP_Anim</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#FairedesanimationsavecSDLP_Anim">Faire des animations avec SDLP_Anim</a><br/><a href="#Tlchargement">Téléchargement</a><br/><a href="#Animationnormale">Animation normale</a><br/><a href="#Animationparvnement">Animation par événement</a><br/></div>
<a name="FairedesanimationsavecSDLP_Anim"></a><h2>Faire des animations avec SDLP_Anim</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim/telechargement-44">
<span class="next">Téléchargement</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-589963" data-claire-element-id="589963">Bienvenue dans mon tutoriel !</p><p id="r-589964" data-claire-element-id="589964">Ce dernier a pour but de vous apprendre à gérer des animations simplement grâce à un outil dont je suis l'auteur : <code data-claire-semantic="c">SDLP_Anim</code>.<br/> Les utilisateurs de Dev-C++ auront une petite surprise dans ce tutoriel (ils ont quand même de la chance ceux-là) ! Les autres, eh bien, tant pis pour eux, na ! :D <br/> Pour utiliser cet outil, vous aurez besoin d'avoir lu tout le tutoriel de M@teo21 sur le C/C++ (y compris la partie sur SDL).</p>
</div><a name="Tlchargement"></a><h2>Téléchargement</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim/animation-normale">
<span class="next">Animation normale</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-589965" data-claire-element-id="589965">La première chose à faire est de télécharger le fichier ZIP qui contient le <em>header</em> pour que nos fonctions fonctionnent. :p <br/> C'est ici : <a href="http://tikado.3dom.fr/SDLP_Anim v2.0.zip">SDLP_Anim.zip</a> !<br/> Version actuelle de SDLP_Anim.h : <strong>2.0 (2012)</strong>.</p><p id="r-589966" data-claire-element-id="589966"><em>Il se peut qu'une nouvelle version sorte et que vous ne le remarquiez pas. Dans ce cas, de nouvelles fonctions ajoutées dans ce tutoriel ne fonctionneront pas ! Il faudra alors remplacer l'ancien fichier par le nouveau qui est en téléchargement à côté de SDLP_Anim.zip.</em></p><aside id="r-589968" data-claire-element-id="589968" data-claire-semantic="information"><p id="r-589967" data-claire-element-id="589967">Dès la version 2.0, la méthode de la bibliothèque change et nous passerons désormais avec la méthode standard dites &quot;Static Library&quot; soit l'installation d'un fichier .a et .h</p></aside><h2 id="r-windows-16" data-claire-element-id="589997">Windows</h2><h3 id="r-code-blocks-5" data-claire-element-id="589972">Code::Blocks</h3><p id="r-589969" data-claire-element-id="589969">Ouvrez le fichier compressé que vous avez téléchargé à l'aide de WinZip ou WinRar selon ce que vous avez. ;) <br/> Commencez par prendre en compte le fichier de license (GNU GPL). Je sais que vous ne le lirez pas mais par principe, il est là.<br/> Nous pouvons voir également 3 images différentes, conservez les car nous les utiliserons toutes pendant ce tutoriel. ;) <br/> Finalement il ne nous reste plus que les fichiers qui vous permettront de faire des animations !</p><p id="r-589970" data-claire-element-id="589970">Plaçons d'abord le fichier d'en tête SDLP_Anim.h !<br/> Vous allez placer ce fichier comme suit :<br/>..\mingw32\include\SDLP_Anim.h<br/> Ensuite, prenons notre deuxième fichier d'extension .a pour le mettre comme suit :<br/>..\mingw32\lib\libSDLP_Anim.a</p><p id="r-589971" data-claire-element-id="589971">Et c'est tout ! :euh: :D</p><h3 id="r-dev-c-3" data-claire-element-id="589983">Dev-C++</h3><p id="r-589973" data-claire-element-id="589973">La manipulation d'installation avec Dev-C++ est la même que celle de Code::Block. Vous devez placer vos deux fichiers dans le dossier mingw32 comme indiqué précédemment.</p><aside id="r-589975" data-claire-element-id="589975" data-claire-semantic="information"><p id="r-589974" data-claire-element-id="589974">J'ai créé un template compatible avec Dev-C++ qui vous permettra de créer des projets SDL rapidement presque sans configuration ! <br/> Le fichier ZIP est disponible <a href="http://tikado.3dom.fr/SDL.zip">ici</a>.<br/> Décompressez le fichier et insérez le tout dans le dossier Templates.<br/> Pour actionner le bouton, cliquez sur Nouveau projet. Puis, vous aurez le choix entre plusieurs types de programme comme la console. Cherchez Projet SDL puis cliquez dessus. Un code en SDL typique vient d'apparaître. Et ce n'est pas tout ! Avant, vous deviez mettre dans l'éditeur de lien -lmingw32, -lSDL, etc. Eh bien là, c'est déjà fait !</p></aside><aside id="r-589977" data-claire-element-id="589977" data-claire-semantic="warning"><p id="r-589976" data-claire-element-id="589976">L'éditeur de liens contient ces fichiers: -lmingw32 -lSDLmain -lSDL -lSDL_image -lFMOD -lSDL_ttf ../../mingw32/lib/sdlgfx.lib.<br/> Il se peut que vous n'ayez pas tout installé ; retirez les fichiers que vous n'avez pas installés.</p></aside><p id="r-589978" data-claire-element-id="589978">Après l'installation de l'astuce, voilà ce que ça donne :</p><figure id="r-589980" data-claire-element-id="589981"><img id="r-589979" data-claire-element-id="589979" src="medias/uploads.siteduzero.com_files_108001_109000_108838.png" alt="Image utilisateur"/></figure><p id="r-589982" data-claire-element-id="589982">Bon certes, il n'y a pas d'icône mais c'est très pratique car on n'a pas besoin d'inclure à la main -lmingw32 -lSDLmain et surtout d'en rappeler.</p><h3 id="r-visual-c-2010-express" data-claire-element-id="589987">Visual C++ 2010 Express</h3><p id="r-589984" data-claire-element-id="589984">Il n'y a pas grand-chose qui change si ce n'est que nous n'utilisons plus <em>mingw32</em> mais <em>VC</em>.<br/> Mettez le <em>header</em> dans : ..\Microsoft Visual Studio 10\VC\include\SDLP_Anim.h<br/> Et le fichier <em>.a</em> dans ..\Microsoft Visual Studio 10\VC\lib\libSDLP_Anim.a</p><aside id="r-589986" data-claire-element-id="589986" data-claire-semantic="warning"><p id="r-589985" data-claire-element-id="589985">Je ne connais pas bien cet IDE. Si un problème survient chez un bon nombre de Zéros, merci de me contacter par <strong>MP</strong>.</p></aside><h3 id="r-en-general-1" data-claire-element-id="589996">En général</h3><p id="r-589988" data-claire-element-id="589988">Maintenant, nous allons configurer notre IDE favori. :) <br/> Pour se faire, il suffit de créer un projet, et comme avec M@théo21, de &quot;linker&quot; notre fichier .a !<br/> Allez dans les configurations de votre projet, et à l'endroit correspondant où l'on rentre les fichiers .lib et .a.<br/> Vous pouvez maintenant ajouter le fichier .a dans cette liste.<br/> Ou copiez-collez cette ligne permettant de configurer les bibliothèques pour la SDL, SDL_image et SDLP_Anim :<br/>-lmingw32 -lSDLP_Anim -lSDLmain -lSDL -lSDL_image<br/> Enregistrez et le tour est joué ! ^^</p><aside id="r-589990" data-claire-element-id="589990" data-claire-semantic="warning"><p id="r-589989" data-claire-element-id="589989">Il est important de placer -lSDLP_Anim avant -lSDLmain et le reste</p></aside><p id="r-589991" data-claire-element-id="589991">Vous aurez ceci après vos manipulations (j'ai utilisé Dev-C++ mais ça devrait être presque pareil pour les autres) :</p><figure id="r-589993" data-claire-element-id="589994"><img id="r-589992" data-claire-element-id="589992" src="medias/uploads.siteduzero.com_files_402001_403000_402550.png" alt="Image utilisateur"/></figure><p id="r-589995" data-claire-element-id="589995">Exemple de placement des fichiers .a et .h pour mingw32</p><h2 id="r-mac-os-xcode-linux" data-claire-element-id="589999">Mac OS (Xcode) &amp; Linux</h2><p id="r-589998" data-claire-element-id="589998">Je ne sais pas comment vous aider si vous êtes dans ce cas. :(</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim">Faire des animations avec SDLP_Anim</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim/telechargement-44">
Téléchargement
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim/animation-normale">
Animation normale
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim/animation-par-evenement">
Animation par événement
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim/animation-normale">
<span class="next">Animation normale</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Animationnormale"></a><h2>Animation normale</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim/telechargement-44">
<span class="arrow"></span>
<span class="next">Téléchargement</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim/animation-par-evenement">
<span class="next">Animation par événement</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-590001" data-claire-element-id="590001">Nous allons maintenant commencer les choses sérieuses !</p><p id="r-590002" data-claire-element-id="590002">Je vous demande de créer un nouveau projet et de le compléter tout au long du chapitre. Normalement, votre fichier .c est vide en ce moment.</p><p id="r-590003" data-claire-element-id="590003">Accrochez-vous, ça va secouer !</p><h2 id="r-les-fonctions-nous-en-raffolons" data-claire-element-id="590095">Les fonctions, nous en raffolons</h2><p id="r-590004" data-claire-element-id="590004">Prenons un code SDL de base (ayant inclus SDL_image). Recopiez-le dans votre fichier .c.</p><pre id="r-590005" data-claire-element-id="590005"><code data-claire-semantic="c">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;SDL.h&gt;
#include &lt;SDL_image.h&gt;
 
int main(int argc, char *argv[])
{
    SDL_Surface *ecran = NULL;
    SDL_Event event;
    int continuer = 1;
 
    SDL_Init(SDL_INIT_VIDEO);
 
    ecran = SDL_SetVideoMode(200, 200, 32, SDL_HWSURFACE);
    SDL_WM_SetCaption(&quot;Animations en SDL !&quot;, NULL);
    
    while (continuer)
    {
        SDL_WaitEvent(&amp;event);
        switch(event.type)
        {
            case SDL_QUIT:
                continuer = 0;
            break;
        }
    
    SDL_FillRect(ecran, NULL, SDL_MapRGB(ecran-&gt;format, 0, 0, 0));    
 
 
    SDL_Flip(ecran);
    }
    
    SDL_Quit();
 
    return EXIT_SUCCESS;
}</code></pre><p id="r-590006" data-claire-element-id="590006">On va partir du tout début pour que vous n'oubliiez rien. Complétez votre fichier .c à l'aide de toutes les fonctions présentes.</p><pre id="r-590007" data-claire-element-id="590007"><code data-claire-semantic="c">ecran = SDL_SetVideoMode(200, 200, 32, SDL_HWSURFACE);</code></pre><p id="r-590008" data-claire-element-id="590008">Vous avez tous remarqué que si, avec ce code, on <em>blitte</em> une image, elle va scintiller (si vous doutez, essayez :p ) !<br/> On va régler tout ça en mettant en place le double <em>buffering</em>. :)</p><pre id="r-590009" data-claire-element-id="590009"><code data-claire-semantic="c">ecran = SDL_SetVideoMode(200, 200, 32, SDL_HWSURFACE | SDL_DOUBLEBUF);</code></pre><pre id="r-590010" data-claire-element-id="590010"><code data-claire-semantic="c">SDL_WaitEvent(&amp;event);</code></pre><p id="r-590011" data-claire-element-id="590011">Nous allons mettre SDL_PollEvent car une animation n'a pas besoin d'événement pour se mettre à fonctionner.</p><pre id="r-590012" data-claire-element-id="590012"><code data-claire-semantic="c">SDL_PollEvent(&amp;event);</code></pre><aside id="r-590014" data-claire-element-id="590014" data-claire-semantic="information"><p id="r-590013" data-claire-element-id="590013">Heu... Tu n'aurais pas oublié le <em>header</em> par hasard ? :-°</p></aside><p id="r-590015" data-claire-element-id="590015">Bien vu. ;) <br/> Dans l'exemple du tutoriel, on trouve ceci dans l'en-tête du fichier .c.</p><pre id="r-590016" data-claire-element-id="590016"><code data-claire-semantic="c">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;SDL.h&gt;
#include &lt;SDL_image.h&gt;
#include &lt;SDLP_Anim.h&gt;</code></pre><p id="r-590017" data-claire-element-id="590017">Vous n'allez devoir retenir qu'<strong>une</strong> seule structure. Voici un exemple de son utilisation.</p><pre id="r-590018" data-claire-element-id="590018"><code data-claire-semantic="c">SDLP_Anim *Anim;</code></pre><p id="r-590019" data-claire-element-id="590019">On a créé notre surface <code data-claire-semantic="cpp">Anim</code>. Ça serait bien de libérer sa mémoire, non ?<br/> Pour cela, on va utiliser <code data-claire-semantic="cpp">SDLP_FreeAnim</code> !<br/> Placez-le juste avant le <code data-claire-semantic="cpp">SDL_Quit();</code>.</p><pre id="r-590020" data-claire-element-id="590020"><code data-claire-semantic="c">SDLP_FreeAnim(Anim);</code></pre><p id="r-590021" data-claire-element-id="590021">Et le tour est joué ! ;)</p><p id="r-590022" data-claire-element-id="590022">Maintenant, nous allons charger l'animation. Reprenez les images qui étaient dans le dossier compressé. Nous allons utiliser Feu.bmp. Je vais vous présenter le prototype de la fonction de chargement d'animation.</p><aside id="r-590024" data-claire-element-id="590024" data-claire-semantic="warning"><p id="r-590023" data-claire-element-id="590023">Mettez l'image dans le dossier de l'exécutable. Sinon, elle ne pourra pas être chargée avec l'exemple qui va suivre.</p></aside><pre id="r-590025" data-claire-element-id="590025"><code data-claire-semantic="c">SDLP_Anim* SDLP_LoadAnim(char *SurfaceAnim, int nbPicture, int coter, long temps, int Loop, int Actif, int Util);</code></pre><p id="r-590026" data-claire-element-id="590026">Vous allez définir <strong>toutes</strong> les options de l'animation :</p><ul id="r-590043" data-claire-element-id="590043"><li id="r-590028" data-claire-element-id="590028"><p id="r-590027" data-claire-element-id="590027"><code data-claire-semantic="cpp">char *SurfaceAnim</code> : entrez ici le chemin de l'exécutable à l'image ;</p></li><li id="r-590030" data-claire-element-id="590030"><p id="r-590029" data-claire-element-id="590029"><code data-claire-semantic="cpp">int nbPicture</code> : nombre d'images à séparer dans celle qui a été déclarée plus haut (l'image sera coupé en parts égales) ;</p></li><li id="r-590032" data-claire-element-id="590032"><p id="r-590031" data-claire-element-id="590031"><code data-claire-semantic="cpp">int coter</code> : définir ici le sens de défilement. Utilisez les <em>defines</em><code data-claire-semantic="cpp">SDLP_GAUCHE</code>, <code data-claire-semantic="cpp">SDLP_DROITE</code>, <code data-claire-semantic="cpp">SDLP_HAUT</code> ou <code data-claire-semantic="cpp">SDLP_BAS</code>. Si je prends SDLP_HAUT par exemple, l'animation sera coupée et animée de l'image tout en bas vers l'image tout en haut (on monte) ;</p></li><li id="r-590034" data-claire-element-id="590034"><p id="r-590033" data-claire-element-id="590033"><code data-claire-semantic="cpp">long temps</code> : définir ici le temps entre chaque image (en millisecondes) ;</p></li><li id="r-590036" data-claire-element-id="590036"><p id="r-590035" data-claire-element-id="590035"><code data-claire-semantic="cpp">int Loop</code> : choisir ici le nombre de fois où l'image va être animée. Utilisez <code data-claire-semantic="cpp">SDLP_INFINI</code> ou un nombre supérieur ou égal à 1. ;</p></li><li id="r-590038" data-claire-element-id="590038"><p id="r-590037" data-claire-element-id="590037"><code data-claire-semantic="cpp">int Actif</code> : définir ici l'état de l'animation en utilisant <code data-claire-semantic="cpp">SDLP_ARRETER</code>, <code data-claire-semantic="cpp">SDLP_PAUSE</code> ou <code data-claire-semantic="cpp">SDLP_LANCER</code> ;</p></li><li id="r-590040" data-claire-element-id="590040"><p id="r-590039" data-claire-element-id="590039"><code data-claire-semantic="cpp">int Util</code> : stipulez ici si l'animation doit se jouer seule ou à l'appui sur une touche. Utilisez les <em>defines</em><code data-claire-semantic="cpp">SDLP_NORMAL</code> ou <code data-claire-semantic="cpp">SDLP_TOUCHE</code>.</p></li><li id="r-590042" data-claire-element-id="590042"><p id="r-590041" data-claire-element-id="590041">N'oubliez pas que cette fonction retourne vos configurations vers une variable de type SDLP_Anim.</p></li></ul><aside id="r-590045" data-claire-element-id="590045" data-claire-semantic="information"><p id="r-590044" data-claire-element-id="590044">Nous verrons comment utiliser l'animation par événement plus tard.</p></aside><p id="r-590046" data-claire-element-id="590046">Voici les détails des différents états dont peuvent être assignés l'animation :</p><table id="r-590063" data-claire-element-id="590063"><tbody id="r-590062" data-claire-element-id="590062"><tr id="r-590051" data-claire-element-id="590051"><td id="r-590048" data-claire-element-id="590048"><p id="r-590047" data-claire-element-id="590047"><code data-claire-semantic="c">SDLP_ARRETER</code></p></td><td id="r-590050" data-claire-element-id="590050"><p id="r-590049" data-claire-element-id="590049">Votre animation n'apparait pas/disparait.<br/> Celle-ci s'arrête et reviens à la 1ère image découpée.<br/> Si le nombre de boucles n'est pas infini, celui-ci revient au début.</p></td></tr><tr id="r-590056" data-claire-element-id="590056"><td id="r-590053" data-claire-element-id="590053"><p id="r-590052" data-claire-element-id="590052"><code data-claire-semantic="c">SDLP_PAUSE</code></p></td><td id="r-590055" data-claire-element-id="590055"><p id="r-590054" data-claire-element-id="590054">Votre animation reste présente mais se fige sur l'instant où elle était.<br/> Il n'y a pas d'écarts de temps et quand l'animation reprend, elle reprend là où elle s'était arrêtée.<br/> Le nombre de boucles est conservée.</p></td></tr><tr id="r-590061" data-claire-element-id="590061"><td id="r-590058" data-claire-element-id="590058"><p id="r-590057" data-claire-element-id="590057"><code data-claire-semantic="c">SDLP_LANCER</code></p></td><td id="r-590060" data-claire-element-id="590060"><p id="r-590059" data-claire-element-id="590059">Permet de lancer l'animation depuis n'importe quelle état.</p></td></tr></tbody></table><pre id="r-590064" data-claire-element-id="590064"><code data-claire-semantic="c">Anim=SDLP_LoadAnim(&quot;Feu.bmp&quot;, 4, SDLP_DROITE, 1000, SDLP_INFINI, SDLP_LANCER, SDLP_NORMAL);</code></pre><p id="r-590065" data-claire-element-id="590065">Ça va ? Vous suivez ? N'hésitez pas à relire si cela s'avère nécessaire !<br/> Ça devient intéressant, non ? :p</p><p id="r-590066" data-claire-element-id="590066">Maintenant, il faut définir la position de l'animation dans la fenêtre.<br/> Déclarez une variable du type <code data-claire-semantic="cpp">SDL_Rect</code> ! Faites comme moi, appelez-la <code data-claire-semantic="cpp">pAnim</code>.</p><pre id="r-590067" data-claire-element-id="590067"><code data-claire-semantic="c">SDL_Rect pAnim;
/* Chargement de l'animation. */
pAnim.x=0;
pAnim.y=0;</code></pre><p id="r-590068" data-claire-element-id="590068">Nous avons chargé notre animation. Mais ce n'est que dans la « tête » de l'ordinateur ça. Nous, on veut que ça s'affiche, non ? NON ? :lol: <br/> Nous allons utiliser la fonction de <em>blittage</em> la plus simple qui n'ait jamais existé. :D <br/> Son prototype l'est aussi :</p><pre id="r-590069" data-claire-element-id="590069"><code data-claire-semantic="c">void SDLP_BlitAnim(SDLP_Anim *str, SDL_Surface *ecran, SDL_Rect pos);</code></pre><ul id="r-590076" data-claire-element-id="590076"><li id="r-590071" data-claire-element-id="590071"><p id="r-590070" data-claire-element-id="590070"><code data-claire-semantic="cpp">SDLP_Anim *str</code> : entrez ici votre variable d'animation ;</p></li><li id="r-590073" data-claire-element-id="590073"><p id="r-590072" data-claire-element-id="590072"><code data-claire-semantic="cpp">SDL_Surface *ecran</code> : surface qui gère la fenêtre, souvent appelée <em>ecran</em> ou <em>screen</em> ;</p></li><li id="r-590075" data-claire-element-id="590075"><p id="r-590074" data-claire-element-id="590074"><code data-claire-semantic="cpp">SDL_Rect pos</code> : inscrivez ici votre variable de position.</p></li></ul><div id="r-590078" data-claire-element-id="590078" data-claire-semantic="question"><p id="r-590077" data-claire-element-id="590077">Mais si je charge une animation avec comme état SDLP_ARRETER, l'animation n'apparaîtra jamais ?!</p></div><p id="r-590079" data-claire-element-id="590079">Qu'ouïe-je ? Effectivement, il faut bien une fonction pour changer l'état de notre animation ! ^^ <br/> Là voici avec son prototype :</p><pre id="r-590080" data-claire-element-id="590080"><code data-claire-semantic="c">void SDLP_SetEtatAnim(SDLP_Anim *str, int Etat);</code></pre><ul id="r-590085" data-claire-element-id="590085"><li id="r-590082" data-claire-element-id="590082"><p id="r-590081" data-claire-element-id="590081"><code data-claire-semantic="cpp">SDLP_Anim *str</code> : entrez ici votre variable d'animation ;</p></li><li id="r-590084" data-claire-element-id="590084"><p id="r-590083" data-claire-element-id="590083"><code data-claire-semantic="cpp">int Etat</code> : Entrez votre variable d'état (voir ci-dessus, il y en a trois seulement).</p></li></ul><p id="r-590086" data-claire-element-id="590086">Il serait utile de savoir dans quel état est l'animation, voici la fonction qui permet de vous renseigner sur cela :</p><pre id="r-590087" data-claire-element-id="590087"><code data-claire-semantic="c">int SDLP_GetEtatAnim(SDLP_Anim *str);</code></pre><ul id="r-590093" data-claire-element-id="590093"><li id="r-590089" data-claire-element-id="590089"><p id="r-590088" data-claire-element-id="590088"><code data-claire-semantic="cpp">SDLP_Anim *str</code> : entrez ici votre variable d'animation ;</p></li><li id="r-590092" data-claire-element-id="590092"><p id="r-590090" data-claire-element-id="590090">Renvoi une valeur de type INT. Comparez les comme ceci :</p><pre id="r-590091" data-claire-element-id="590091"><code data-claire-semantic="c">if (SDLP_GetEtatAnim(Anim)==SDLP_LANCER)</code></pre></li></ul><p id="r-590094" data-claire-element-id="590094">Voilà ! Nous avons nos fonctions maintenant. ;) <br/> Maintenant que vous savez faire des animations, nous allons mettre vos talents en pratique ! :p</p><h2 id="r-fonctions-annexes" data-claire-element-id="590148">Fonctions annexes</h2><p id="r-590096" data-claire-element-id="590096">Ne grillez pas cette partie ! Plusieurs fonctions vous seront bien utiles (indispensables) pour gérer vos animations correctement.<br/> Imaginons-nous un problème. Vous savez comme moi que la largeur/hauteur d'une surface en SDL s'écrit de cette facon :</p><pre id="r-590097" data-claire-element-id="590097"><code data-claire-semantic="c">SDL_Surface *Surface = NULL;
Surface-&gt;w // Largeur
Surface-&gt;h // Hauteur</code></pre><p id="r-590098" data-claire-element-id="590098">Cependant, nous ne connaissons pas la largeur/hauteur de notre image d'animation.<br/> Il existe trois fonctions différentes pour répondre à ce problème :</p><pre id="r-590099" data-claire-element-id="590099"><code data-claire-semantic="c">void SDLP_GetWHSurfaceAnim(SDLP_Anim *str, int *w, int *h);</code></pre><ul id="r-590106" data-claire-element-id="590106"><li id="r-590101" data-claire-element-id="590101"><p id="r-590100" data-claire-element-id="590100"><code data-claire-semantic="cpp">SDLP_Anim *str</code> : Entrez ici votre variable d'animation ;</p></li><li id="r-590103" data-claire-element-id="590103"><p id="r-590102" data-claire-element-id="590102"><code data-claire-semantic="cpp">int *w</code> : Entrez votre pointeur qui retournera la largeur ;</p></li><li id="r-590105" data-claire-element-id="590105"><p id="r-590104" data-claire-element-id="590104"><code data-claire-semantic="cpp">int *h</code> : Entrez votre pointeur qui retournera la hauteur.</p></li></ul><p id="r-590107" data-claire-element-id="590107">Cette fonction est utile si vous devez capter ces variables pour les traiter.</p><pre id="r-590108" data-claire-element-id="590108"><code data-claire-semantic="c">int SDLP_GetWSurfaceAnim(SDLP_Anim *str);
int SDLP_GetHSurfaceAnim(SDLP_Anim *str);</code></pre><ul id="r-590111" data-claire-element-id="590111"><li id="r-590110" data-claire-element-id="590110"><p id="r-590109" data-claire-element-id="590109"><code data-claire-semantic="cpp">SDLP_Anim *str</code> : Entrez ici votre variable d'animation.</p></li></ul><p id="r-590112" data-claire-element-id="590112">Ces fonctions sont très utiles puisqu'elles permettent de récupérer la largeur/hauteur.<br/> Voici un exemple de leur utilisation :</p><pre id="r-590113" data-claire-element-id="590113"><code data-claire-semantic="c">SDL_Rect p;
SDLP_Anim *Anim;
p.x = SDLP_GetWSurfaceAnim(Anim)/2;
p.y = SDLP_GetHSurfaceAnim(Anim)/2;</code></pre><aside id="r-590115" data-claire-element-id="590115" data-claire-semantic="warning"><p id="r-590114" data-claire-element-id="590114">Ces fonctions retournent la largeur/hauteur non pas de l'image initiale mais de <strong>l'image découpée</strong></p></aside><p id="r-590116" data-claire-element-id="590116">Imaginons-nous un autre problème à présent : Nous voudrions qu'au feu vert (pour reprendre l'exemple précédent), des voitures quelconques puissent passer, et pas au rouge, ni au orange. Il faudrait pouvoir savoir à quelle instance en est l'animation. Les fonctions suivantes vont répondre à notre problème :</p><pre id="r-590117" data-claire-element-id="590117"><code data-claire-semantic="c">int SDLP_GetIDAnim(SDLP_Anim *str);
int SDLP_GetIDMaxAnim(SDLP_Anim *str);</code></pre><ul id="r-590120" data-claire-element-id="590120"><li id="r-590119" data-claire-element-id="590119"><p id="r-590118" data-claire-element-id="590118"><code data-claire-semantic="cpp">SDLP_Anim *str</code> : Entrez ici votre variable d'animation.</p></li></ul><p id="r-590121" data-claire-element-id="590121"><code data-claire-semantic="c">SDLP_GetIDAnim</code> Retourne l'instance à laquelle est l'animation, alors que <code data-claire-semantic="c">SDLP_GetIDMaxAnim</code> retourne la valeur de la dernière instance existante (qui est égale au nombre de découpage).</p><p id="r-590122" data-claire-element-id="590122">Voici une image pour schématiser tout ça, à partir de notre feu habituel :</p><figure id="r-590124" data-claire-element-id="590125"><img id="r-590123" data-claire-element-id="590123" src="medias/uploads.siteduzero.com_files_408001_409000_408315.jpg" alt="Image utilisateur"/></figure><aside id="r-590127" data-claire-element-id="590127" data-claire-semantic="warning"><p id="r-590126" data-claire-element-id="590126">La valeur de la première instance est <strong>1</strong> et non 0</p></aside><p id="r-590128" data-claire-element-id="590128">J'espère que ca sera plus clair pour vous avec cette image. ;)</p><p id="r-590129" data-claire-element-id="590129">Encore et toujours des problèmes ! Je voudrais bien que mon animation subisse la gestion de la transparence ! Tout d'abord, n'oubliez pas qu'il faut que votre image soit du format <strong>.bmp</strong>.<br/> Voici la fonction qui va vous sauver. N'oubliez pas de l'appeler après la déclaration de l'animation.</p><pre id="r-590130" data-claire-element-id="590130"><code data-claire-semantic="c">void SDLP_SetColorKeyAnim(SDLP_Anim *str, int R, int V, int B);</code></pre><ul id="r-590139" data-claire-element-id="590139"><li id="r-590132" data-claire-element-id="590132"><p id="r-590131" data-claire-element-id="590131"><code data-claire-semantic="cpp">SDLP_Anim *str</code> : Entrez ici votre variable d'animation ;</p></li><li id="r-590134" data-claire-element-id="590134"><p id="r-590133" data-claire-element-id="590133"><code data-claire-semantic="cpp">int R</code> : Entrez ici la valeur de la couleur rouge sur laquelle il faudra pratiquer la transparence ;</p></li><li id="r-590136" data-claire-element-id="590136"><p id="r-590135" data-claire-element-id="590135"><code data-claire-semantic="cpp">int V</code> : Entrez ici la valeur de la couleur verte sur laquelle il faudra pratiquer la transparence ;</p></li><li id="r-590138" data-claire-element-id="590138"><p id="r-590137" data-claire-element-id="590137"><code data-claire-semantic="cpp">int B</code> : Entrez ici la valeur de la couleur bleue sur laquelle il faudra pratiquer la transparence.</p></li></ul><p id="r-590140" data-claire-element-id="590140">C'est l'accouplement des trois couleurs qui formera la couleur finale sur laquelle la transparence doit s'effectuer.</p><p id="r-590141" data-claire-element-id="590141">Dernière fonction qui peut être utile. Lorsque vous chargez une animation, vous indiquez le temps de défilement entre chaque image. Le programme va vérifier si il doit blitter l'image correspondante. Pour éviter une surcharge du CPU, la fonction <code data-claire-semantic="c">SDL_Delay</code> est utilisée et est de valeur par défaut à <strong>5ms</strong>. Comme tout le monde possède un ordinateur à peu près potable de notre temps, 5ms suffisent largement à ne pas tout faire ramer. Il existe cependant une fonction pour modifier ce temps de &quot;Delay&quot; :</p><pre id="r-590142" data-claire-element-id="590142"><code data-claire-semantic="c">void SDLP_SetWaitAnim(SDLP_Anim *str, int t);</code></pre><ul id="r-590147" data-claire-element-id="590147"><li id="r-590144" data-claire-element-id="590144"><p id="r-590143" data-claire-element-id="590143"><code data-claire-semantic="cpp">SDLP_Anim *str</code> : Entrez ici votre variable d'animation ;</p></li><li id="r-590146" data-claire-element-id="590146"><p id="r-590145" data-claire-element-id="590145"><code data-claire-semantic="cpp">int t</code> : Entrez ici le temps en millisecondes d'attente entre chaque boucle.</p></li></ul><h2 id="r-exercice-63" data-claire-element-id="590150">Exercice</h2><p id="r-590149" data-claire-element-id="590149">Maintenant, au boulot !<br/> Je vous demande, à partir de Feu.bmp, de me faire un joli feu tricolore qui s'anime toutes les secondes, de sens DROITE et de durée infinie. Le feu tricolore doit être au centre de la fenêtre. De plus, je veux que quand on appuie sur la touche &quot;entrée&quot;, l'animation se mette en pause et reprenne selon l'état.<br/> Vous êtes fins prêts, c'est parti ! :D</p><h2 id="r-correction-202" data-claire-element-id="590157">Correction</h2><div id="r-590152" data-claire-element-id="590153"><img id="r-590153" data-claire-element-id="590152" src="medias/uploads.siteduzero.com_files_402001_403000_402566.png" alt="Image utilisateur"/><pre id="r-590151" data-claire-element-id="590151"><code data-claire-semantic="c">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;SDL.h&gt;
#include &lt;SDL_image.h&gt;
#include &lt;SDLP_Anim.h&gt;
 
/*                          SDLP_ANIM.C                                      
                     Créé par Syndrome5 (POPOP99O0)       
                               Site du Zér0                                               
*/

int main(int argc, char *argv[])
{
    SDL_Surface *ecran = NULL;
    SDL_Rect pAnim;
    SDLP_Anim *Anim = NULL;
    SDL_Event event;
    int continuer = 1, NoRepeat=0;
 
    SDL_Init(SDL_INIT_VIDEO);
 
    ecran = SDL_SetVideoMode(200, 200, 32, SDL_HWSURFACE | SDL_DOUBLEBUF);
    SDL_WM_SetCaption(&quot;Animations en SDL !&quot;, NULL);
    
    Anim=SDLP_LoadAnim(&quot;Feu.bmp&quot;, 4, SDLP_DROITE, 1000, SDLP_INFINI, SDLP_LANCER, SDLP_NORMAL);

    pAnim.x=ecran-&gt;w / 2 - SDLP_GetWSurfaceAnim(Anim) / 2;
    pAnim.y=ecran-&gt;h / 2 - SDLP_GetHSurfaceAnim(Anim) / 2;
   
    while (continuer)
    {
        SDL_PollEvent(&amp;event);
        switch(event.type)
        {
        case SDL_QUIT:
            continuer = 0;
            break;
        case SDL_KEYDOWN:
            switch (event.key.keysym.sym)
            {
            case SDLK_RETURN:
                if (NoRepeat == 0)
                {
                    if (SDLP_GetEtatAnim(Anim)==SDLP_ARRETER || SDLP_GetEtatAnim(Anim)==SDLP_PAUSE)
                        SDLP_SetEtatAnim(Anim, SDLP_LANCER);
                    else
                        SDLP_SetEtatAnim(Anim, SDLP_PAUSE);
                    NoRepeat=1;
                }
                break;
            }
            break;
        case SDL_KEYUP:
            NoRepeat=0;
            break;
        }
    
        SDL_FillRect(ecran, NULL, SDL_MapRGB(ecran-&gt;format, 0, 0, 0));    
        SDLP_BlitAnim(Anim, ecran, pAnim);
        SDL_Flip(ecran);
    }
    
    SDLP_FreeAnim(Anim);
    
    SDL_Quit();
 
    return EXIT_SUCCESS;
}</code></pre></div><p id="r-590154" data-claire-element-id="590154"><a href="http://tikado.3dom.fr/FeuTricolore.zip">Télécharger le projet.</a></p><p id="r-590155" data-claire-element-id="590155">Notez que pour éviter la répétition de l'action de la touche en appuyant qu'une seule fois, j'ai fais ce petit système de boolean avec la variable <code data-claire-semantic="c">NoRepeat</code>.</p><p id="r-590156" data-claire-element-id="590156">Ce chapitre se termine ! Nous avons vu une forme d'animation automatisée par le temps.<br/> Dans le prochain chapitre, nous verrons un nouveau type d'animation : l'animation par évènement !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim">Faire des animations avec SDLP_Anim</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim/telechargement-44">
Téléchargement
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim/animation-normale">
Animation normale
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim/animation-par-evenement">
Animation par événement
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim/telechargement-44">
<span class="arrow"></span>
<span class="next">Téléchargement</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim/animation-par-evenement">
<span class="next">Animation par événement</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Animationparvnement"></a><h2>Animation par événement</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim/animation-normale">
<span class="arrow"></span>
<span class="next">Animation normale</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-faisons-courir-le-chaton" data-claire-element-id="590210">Faisons courir le chaton</h2><p id="r-590159" data-claire-element-id="590159">Nous allons à présent utiliser les deux images qui restaient dans SDLP_Anim.zip :</p><figure id="r-590161" data-claire-element-id="590162"><img id="r-590160" data-claire-element-id="590160" src="medias/uploads.siteduzero.com_files_108001_109000_108937.png" alt="Image utilisateur"/></figure><p id="r-590163" data-claire-element-id="590163"><strong>et</strong></p><figure id="r-590165" data-claire-element-id="590166"><img id="r-590164" data-claire-element-id="590164" src="medias/uploads.siteduzero.com_files_108001_109000_108938.png" alt="Image utilisateur"/></figure><p id="r-590167" data-claire-element-id="590167">On va animer ce chat quand on appuiera <strong>sur une touche</strong>.<br/> C'est-à-dire que, quand on appuiera sur une touche, l'image s'animera. Je prends l'exemple de Zozor qui se déplace dans le tutoriel sur les événements de M@teo21. Il est statique quand il se déplace, l'image pourrait bouger et cela donnerait « vie » à l'image.<br/> C'est ce que j'appelle une <strong>animation par événement</strong>.</p><div id="r-590169" data-claire-element-id="590169" data-claire-semantic="question"><p id="r-590168" data-claire-element-id="590168">Mais j'y pense, on peut combiner plusieurs <code data-claire-semantic="c">SDLP_SetEtatAnim</code> pour gérer nous-même ces évènements !</p></div><p id="r-590170" data-claire-element-id="590170">Bravo si vous y avez pensé tout seul. Il est en effet possible par le biais de cette fonction de gérer des animations avec les évènements. Mais imaginons que vous ayez besoin ne serait-ce que cinq animations de ce type, imaginez le nombre de ligne de code pour ne gérer que l'affichage de ce dernier !</p><p id="r-590171" data-claire-element-id="590171">Pour pallier à ce problème, nous avons intégrer un système d'animation par évènement très simple d'utilisation et prenant peu d'espace (dans l'éditeur de texte, mais aussi dans votre mémoire).</p><p id="r-590172" data-claire-element-id="590172">Vous vous souvenez dans le chapitre précédent, nous déclarions nos animations de cette façon :</p><pre id="r-590173" data-claire-element-id="590173"><code data-claire-semantic="c">Anim=SDLP_LoadAnim(&quot;Feu.bmp&quot;, 4, SDLP_DROITE, 1000, SDLP_INFINI, SDLP_LANCER, SDLP_NORMAL);</code></pre><p id="r-590174" data-claire-element-id="590174">Vous connaissez chaque paramètre de la fonction, mais nous sommes passé très rapidement sur le dernier sans le détailler. Sachez que c'est d'abord ici que vous allez dire à votre programme &quot;Je veux une animation par évènement&quot;.</p><p id="r-590175" data-claire-element-id="590175">Pour se faire, c'est très simple. Nous allons remplacer <code data-claire-semantic="c">SDLP_NORMAL</code> par <code data-claire-semantic="c">SDLP_TOUCHE</code>. Ceci fait, vous deviez avoir cette ligne :</p><pre id="r-590176" data-claire-element-id="590176"><code data-claire-semantic="c">Anim=SDLP_LoadAnim(&quot;Feu.bmp&quot;, 4, SDLP_DROITE, 1000, SDLP_INFINI, SDLP_LANCER, SDLP_TOUCHE);</code></pre><p id="r-590177" data-claire-element-id="590177">Si vous compilez maintenant votre code, à votre grande surprise, l'image s'affiche à l'instance 0 (première image) mais ne défile plus. Rien de plus normal ! L'animation attend maintenant un évènement pour se lancer.</p><p id="r-590178" data-claire-element-id="590178">Revenons à présent sur notre exemple du chat souhaitant courir. :) <br/> Pour nous simplifier la vie, nous ne prendrons pour le moment que l'image du chat qui regarde vers la droite. De plus, on modifie la déclaration de l'animation pour indiquer que l'on va utiliser la gestion par évènement.</p><pre id="r-590179" data-claire-element-id="590179"><code data-claire-semantic="c">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;SDL.h&gt;
#include &lt;SDL_image.h&gt;
#include &lt;SDLP_Anim.h&gt;
 
/*                          SDLP_ANIM.C                                      
                     Créé par Syndrome5 (POPOP99O0)       
                               Site du Zér0                                               
*/

int main(int argc, char *argv[])
{
    SDL_Surface *ecran = NULL;
    SDL_Rect pAnim;
    SDLP_Anim *Anim = NULL;
    SDL_Event event;
    int continuer = 1;
 
    SDL_Init(SDL_INIT_VIDEO);
 
    ecran = SDL_SetVideoMode(400, 400, 32, SDL_HWSURFACE | SDL_DOUBLEBUF);
    SDL_WM_SetCaption(&quot;Animations en SDL !&quot;, NULL);
    
    Anim=SDLP_LoadAnim(&quot;CatD.png&quot;, 4, SDLP_GAUCHE, 200, SDLP_INFINI, SDLP_LANCER, SDLP_TOUCHE);

    pAnim.x=0;
    pAnim.y=ecran-&gt;h - SDLP_GetHSurfaceAnim(Anim);
   
    while (continuer)
    {
        SDL_PollEvent(&amp;event);
        switch(event.type)
        {
            case SDL_QUIT:
                continuer = 0;
            break;
            case SDL_KEYDOWN:
            switch (event.key.keysym.sym)
            {
            }
            break;
        }
    
        SDL_FillRect(ecran, NULL, SDL_MapRGB(ecran-&gt;format, 255, 255, 255));
        SDLP_BlitAnim(Anim, ecran, pAnim);
        SDL_Flip(ecran);
    }
    
    SDLP_FreeAnim(Anim);
    
    SDL_Quit();
 
    return EXIT_SUCCESS;
}</code></pre><p id="r-590180" data-claire-element-id="590180">Vous pouvez également compiler ce code, qui ne donnera rien qu'une image fixe !<br/> Nous allons par contre reprendre cet exemple tout au long du chapitre. Je vous conseille donc de copier/coller ce bout de code.</p><div id="r-590182" data-claire-element-id="590182" data-claire-semantic="question"><p id="r-590181" data-claire-element-id="590181">Bon, comment on l'anime cette image finalement ?!</p></div><p id="r-590183" data-claire-element-id="590183">Je vois que vous commencez à vous vous impatienter. :D <br/> Alors on est parti !</p><p id="r-590184" data-claire-element-id="590184">À l'aide d'une fonction appelée <code data-claire-semantic="cpp">SDLP_Touch</code>, vous allez pouvoir gérer l'événement sans rien faire ; la fonction fait tout. ;)</p><pre id="r-590185" data-claire-element-id="590185"><code data-claire-semantic="c">void SDLP_Touch(SDL_Event event, SDLP_Anim *str);</code></pre><ul id="r-590190" data-claire-element-id="590190"><li id="r-590187" data-claire-element-id="590187"><p id="r-590186" data-claire-element-id="590186"><code data-claire-semantic="cpp">SDL_Event event</code> : variable de type <code data-claire-semantic="cpp">SDL_Event</code> qui gère tous les événements ;</p></li><li id="r-590189" data-claire-element-id="590189"><p id="r-590188" data-claire-element-id="590188"><code data-claire-semantic="cpp">SDLP_Anim *str</code> : variable de type <code data-claire-semantic="cpp">SDLP_Anim</code>.</p></li></ul><p id="r-590191" data-claire-element-id="590191">Voilà, il ne reste plus qu'à placer la fonction et le tour est joué !<br/> Puisque cette fonction agit en fonction des évènements, vous devrez la placer <strong>après</strong> le <code data-claire-semantic="cpp">switch event.type</code> comme ceci :</p><pre id="r-590192" data-claire-element-id="590192"><code data-claire-semantic="c">switch (event.type)
   {
      /* Événements */
   }
  SDLP_Touch(event, Anim);</code></pre><p id="r-590193" data-claire-element-id="590193">Résultat : Lorsqu'on reste appuyé sur n'importe quelle touche, le chat s'anime bien !<br/> Faisons maintenant en sorte que lorsqu'on appuie sur les touches directionnelles gauche et droite, il se déplace dans le sens correspondant à la touche !</p><p id="r-590194" data-claire-element-id="590194">Je suis gentil, alors je donne ce petit bout de code misérable.</p><pre id="r-590195" data-claire-element-id="590195"><code data-claire-semantic="c">case SDL_KEYDOWN:
switch (event.key.keysym.sym)
{
    case SDLK_RIGHT:
         pAnim.x+=2;
    break;
    case SDLK_LEFT:
         pAnim.x-=2;
    break;
    default:
    break;
}
break;</code></pre><p id="r-590196" data-claire-element-id="590196">Ajoutez ceci à votre code. Vous pouvez maintenant observer que notre chat se déplace bien en effectuant son animation et, quand on relâche la touche, l'animation revient au départ. On peut même voir que notre chat fait du moonwalk ! :p</p><div id="r-590198" data-claire-element-id="590198" data-claire-semantic="question"><p id="r-590197" data-claire-element-id="590197">C'est bien gentil tout ça, mais je vois qu'il y a un problème, quand j'appuie sur une autre touche que gauche ou droite, l'animation se met en route quand même !</p></div><p id="r-590199" data-claire-element-id="590199">Vous avez de l’œil dites moi aujourd'hui ! Heureusement, une fonction va vous sauver :</p><pre id="r-590200" data-claire-element-id="590200"><code data-claire-semantic="c">void SDLP_BlockTouch(SDLP_Anim *str);</code></pre><ul id="r-590203" data-claire-element-id="590203"><li id="r-590202" data-claire-element-id="590202"><p id="r-590201" data-claire-element-id="590201"><code data-claire-semantic="cpp">SDLP_Anim *str</code> : variable de type SDLP_Anim.</p></li></ul><div id="r-590205" data-claire-element-id="590205" data-claire-semantic="question"><p id="r-590204" data-claire-element-id="590204">Mais je la place où cette fonction moi ?</p></div><p id="r-590206" data-claire-element-id="590206">A chaque endroit où vous ne voulez pas que l'animation se produise.<br/> En l'occurrence, ce sera souvent dans votre <code data-claire-semantic="c">default:</code> puisque l'on choisis la réalisation de l'évènement sur quelques touches uniquement. On exclut donc toutes les touches sauf celles précédés du <code data-claire-semantic="c">default:</code> !</p><p id="r-590207" data-claire-element-id="590207">Finalement, on obtient ceci :</p><pre id="r-590208" data-claire-element-id="590208"><code data-claire-semantic="c">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;SDL.h&gt;
#include &lt;SDL_image.h&gt;
#include &lt;SDLP_Anim.h&gt;
 
/*                          SDLP_ANIM.C                                      
                     Créé par Syndrome5 (POPOP99O0)       
                               Site du Zér0                                               
*/

int main(int argc, char *argv[])
{
    SDL_Surface *ecran = NULL;
    SDL_Rect pAnim;
    SDLP_Anim *Anim = NULL;
    SDL_Event event;
    int continuer = 1;
 
    SDL_Init(SDL_INIT_VIDEO);
 
    ecran = SDL_SetVideoMode(400, 400, 32, SDL_HWSURFACE | SDL_DOUBLEBUF);
    SDL_WM_SetCaption(&quot;Animations en SDL !&quot;, NULL);
    
    Anim=SDLP_LoadAnim(&quot;CatD.png&quot;, 4, SDLP_GAUCHE, 150, SDLP_INFINI, SDLP_LANCER, SDLP_TOUCHE);

    pAnim.x=0;
    pAnim.y=ecran-&gt;h - SDLP_GetHSurfaceAnim(Anim);
   
    while (continuer)
    {
        SDL_PollEvent(&amp;event);
        switch(event.type)
        {
            case SDL_QUIT:
                continuer = 0;
            break;
            case SDL_KEYDOWN:
            switch (event.key.keysym.sym)
            {
                case SDLK_RIGHT:
                     pAnim.x+=2;
                break;
                case SDLK_LEFT:
                     pAnim.x-=2;
                break;
                default:
                     SDLP_BlockTouch(Anim);
                break;
            }
            break;
        }
        SDLP_Touch(event, Anim);
    
        SDL_FillRect(ecran, NULL, SDL_MapRGB(ecran-&gt;format, 255, 255, 255));
        SDLP_BlitAnim(Anim, ecran, pAnim);
        SDL_Flip(ecran);
    }
    
    SDLP_FreeAnim(Anim);
    
    SDL_Quit();
 
    return EXIT_SUCCESS;
}</code></pre><p id="r-590209" data-claire-element-id="590209">Bon c'est bien beau tout ça, mais est-ce vraiment réaliste que notre chat fasse le moonwalk ?<br/> Ceux qui me réponde &quot;oui&quot;, je leur conseille d'arrêter le cannabis tout de suite. ;) <br/> Et comme moi j'ai assez travaillé pour aujourd'hui, c'est vous qui allez me faire ce chat qui marche normalement.</p><h2 id="r-exercice-1-terminer-le-programme" data-claire-element-id="590212">Exercice 1 : terminer le programme</h2><p id="r-590211" data-claire-element-id="590211">Il faut penser à utiliser la deuxième image à votre disposition.<br/> Vous pouvez changer le code comme vous voulez et même tout recommencer ; c'est ce que je vous conseille d'ailleurs ! À vous de voir. Au moins, vous aurez le mérite d'avoir tout fait tout seul.<br/> A vos curseurs ! Vous avez tout pour y arriver, alors faites-moi ce chat, et plus vite que ça !</p><h2 id="r-correction-203" data-claire-element-id="590218">Correction</h2><p id="r-590213" data-claire-element-id="590213">Voilà la correction de mon casse-tête.<br/> Vous n'étiez pas obligés de faire exactement la même chose.<br/> Si vous ne comprenez pas mon code, relisez le chapitre avec plus de concentration.</p><p id="r-590214" data-claire-element-id="590214"></p><div id="r-590216" data-claire-element-id="590216"><pre id="r-590215" data-claire-element-id="590215"><code data-claire-semantic="c">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;SDL.h&gt;
#include &lt;SDL_image.h&gt;
#include &lt;SDLP_Anim.h&gt;
 
/*                          SDLP_ANIM.C                                      
                     Créé par Syndrome5 (POPOP99O0)       
                               Site du Zér0                                               
*/

enum {DROITE,GAUCHE};

int main(int argc, char *argv[])
{
    SDL_Surface *ecran = NULL;
    SDL_Rect pCat;
    SDLP_Anim *Cat[2] = {NULL};
    SDL_Event event;
    int continuer = 1, Regarde = DROITE;
 
    SDL_Init(SDL_INIT_VIDEO);
 
    ecran = SDL_SetVideoMode(400, 400, 32, SDL_HWSURFACE | SDL_DOUBLEBUF);
    SDL_WM_SetCaption(&quot;Animations en SDL !&quot;, NULL);
    
    Cat[DROITE]=SDLP_LoadAnim(&quot;CatD.png&quot;, 4, SDLP_GAUCHE, 150, SDLP_INFINI, SDLP_LANCER, SDLP_TOUCHE);
    Cat[GAUCHE]=SDLP_LoadAnim(&quot;CatG.png&quot;, 4, SDLP_GAUCHE, 150, SDLP_INFINI, SDLP_LANCER, SDLP_TOUCHE);

    pCat.x=ecran-&gt;w/2 - SDLP_GetWSurfaceAnim(Cat[DROITE])/2;
    pCat.y=ecran-&gt;h - SDLP_GetHSurfaceAnim(Cat[DROITE]);
   
    while (continuer)
    {
        SDL_PollEvent(&amp;event);
        switch(event.type)
        {
            case SDL_QUIT:
                continuer = 0;
            break;
            case SDL_KEYDOWN:
            switch (event.key.keysym.sym)
            {
                case SDLK_RIGHT:
                     pCat.x+=2;
                     Regarde = DROITE;
                break;
                case SDLK_LEFT:
                     pCat.x-=2;
                     Regarde = GAUCHE;
                break;
                default:
                     SDLP_BlockTouch(Cat[DROITE]);
                     SDLP_BlockTouch(Cat[GAUCHE]);
                break;
            }
            break;
        }
        SDLP_Touch(event, Cat[DROITE]);
        SDLP_Touch(event, Cat[GAUCHE]);
        
        SDL_FillRect(ecran, NULL, SDL_MapRGB(ecran-&gt;format, 255, 255, 255));
        
        switch (Regarde)
        {
            case DROITE:
                 SDLP_BlitAnim(Cat[DROITE], ecran, pCat);
            break;
            case GAUCHE:
                 SDLP_BlitAnim(Cat[GAUCHE], ecran, pCat);
            break;
            default:
            break;
        }
        SDL_Flip(ecran);
    }
    
    SDLP_FreeAnim(Cat[DROITE]);
    SDLP_FreeAnim(Cat[GAUCHE]);
    
    SDL_Quit();
 
    return EXIT_SUCCESS;
}</code></pre></div><p id="r-590217" data-claire-element-id="590217"><a href="http://tikado.3dom.fr/Exercice 1 SDLP_Anim.zip">Télécharger le projet.</a></p><h2 id="r-exercice-2-melons-les-2-types-d-animation" data-claire-element-id="590223">Exercice 2 : Mêlons les 2 types d'animation</h2><p id="r-590219" data-claire-element-id="590219">Vous avez réussi l'exercice 1 sans problème ? Alors nous allons maintenant mêler nos connaissances.<br/> L'idée est la suivante : Notre chat va faire une course seul ( o_O ). Il démarre à gauche de la fenêtre et son but est d'arriver à droite. Lorsqu'il arrive, le feu disparait. Cependant, celui-ci ne doit partir qu'au feu vert. Sinon il est bloqué.<br/> Là aussi vous avez les capacités pour y arriver sans aide supplémentaire ! Au travail !<br/> Conseil : Basez vous à partir du code de l'exercice 1.<br/> Petit screen du résultat possible :</p><figure id="r-590221" data-claire-element-id="590222"><img id="r-590220" data-claire-element-id="590220" src="medias/uploads.siteduzero.com_files_408001_409000_408307.png" alt="Image utilisateur"/></figure><h2 id="r-correction-204" data-claire-element-id="590231">Correction</h2><p id="r-590224" data-claire-element-id="590224">Je relève les copies. :p <br/> Pour ma part, voici mon code :</p><div id="r-590226" data-claire-element-id="590226"><pre id="r-590225" data-claire-element-id="590225"><code data-claire-semantic="c">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;SDL.h&gt;
#include &lt;SDL_image.h&gt;
#include &lt;SDLP_Anim.h&gt;
 
/*                          SDLP_ANIM.C                                      
                     Créé par Syndrome5 (POPOP99O0)       
                               Site du Zér0                                               
*/

enum {DROITE,GAUCHE};

int main(int argc, char *argv[])
{
    SDL_Surface *ecran = NULL;
    SDL_Rect pCat, pFeu;
    SDLP_Anim *Cat[2] = {NULL}, *Feu = NULL;
    SDL_Event event;
    int continuer = 1, Regarde = DROITE;
 
    SDL_Init(SDL_INIT_VIDEO);
 
    ecran = SDL_SetVideoMode(800, 400, 32, SDL_HWSURFACE | SDL_DOUBLEBUF);
    SDL_WM_SetCaption(&quot;Animations en SDL !&quot;, NULL);
    
    Cat[DROITE]=SDLP_LoadAnim(&quot;CatD.png&quot;, 4, SDLP_GAUCHE, 150, SDLP_INFINI, SDLP_LANCER, SDLP_TOUCHE);
    Cat[GAUCHE]=SDLP_LoadAnim(&quot;CatG.png&quot;, 4, SDLP_GAUCHE, 150, SDLP_INFINI, SDLP_LANCER, SDLP_TOUCHE);
    Feu=SDLP_LoadAnim(&quot;Feu.bmp&quot;, 4, SDLP_DROITE, 2000, 1, SDLP_LANCER, SDLP_NORMAL);
    
    pCat.x=0;
    pCat.y=ecran-&gt;h - SDLP_GetHSurfaceAnim(Cat[DROITE]);
    
    pFeu.x=ecran-&gt;w - SDLP_GetWSurfaceAnim(Feu) - 5;
    pFeu.y=5;
    
    while (continuer)
    {
        SDL_PollEvent(&amp;event);
        
        if (SDLP_GetIDAnim(Feu)==SDLP_GetIDMaxAnim(Feu))
        {
            SDLP_SetEtatAnim(Feu, SDLP_PAUSE);
            SDLP_SetEtatAnim(Cat[DROITE], SDLP_LANCER);
            SDLP_SetEtatAnim(Cat[GAUCHE], SDLP_LANCER);
        }
       
        if (pCat.x &gt;= ecran-&gt;w-SDLP_GetWSurfaceAnim(Cat[DROITE])-10)
        {
            SDLP_SetEtatAnim(Feu, SDLP_ARRETER);
            SDLP_SetEtatAnim(Cat[DROITE], SDLP_PAUSE);
            SDLP_SetEtatAnim(Cat[GAUCHE], SDLP_PAUSE);
        }
        
        switch(event.type)
        {
            case SDL_QUIT:
                continuer = 0;
            break;
            case SDL_KEYDOWN:
            switch (event.key.keysym.sym)
            {
                case SDLK_RIGHT:
                     if (SDLP_GetEtatAnim(Feu)==SDLP_PAUSE)
                     {
                         pCat.x+=2;
                     }
                     Regarde = DROITE;
                break;
                case SDLK_LEFT:
                     if (SDLP_GetEtatAnim(Feu)==SDLP_PAUSE)
                     {
                         pCat.x-=2;
                     }
                     Regarde = GAUCHE;
                break;
                default:
                     SDLP_BlockTouch(Cat[DROITE]);
                     SDLP_BlockTouch(Cat[GAUCHE]);
                break;
            }
            break;
        }
        SDLP_Touch(event, Cat[DROITE]);
        SDLP_Touch(event, Cat[GAUCHE]);
        
        SDL_FillRect(ecran, NULL, SDL_MapRGB(ecran-&gt;format, 255, 255, 255));
        
        SDLP_BlitAnim(Feu, ecran, pFeu);
        switch (Regarde)
        {
            case DROITE:
                 SDLP_BlitAnim(Cat[DROITE], ecran, pCat);
            break;
            case GAUCHE:
                 SDLP_BlitAnim(Cat[GAUCHE], ecran, pCat);
            break;
            default:
            break;
        }
        SDL_Flip(ecran);
    }
    
    SDLP_FreeAnim(Feu);
    SDLP_FreeAnim(Cat[DROITE]);
    SDLP_FreeAnim(Cat[GAUCHE]);
    
    SDL_Quit();
 
    return EXIT_SUCCESS;
}</code></pre></div><p id="r-590227" data-claire-element-id="590227"><a href="http://tikado.3dom.fr/Exercice 2 SDLP_Anim.zip">Télécharger le projet.</a></p><p id="r-590228" data-claire-element-id="590228">Rien de très bien compliqué, il suffit juste de bien connaître ses fonctions !</p><p id="r-590229" data-claire-element-id="590229">J'espère que vous avez tout retenu (mais je vous laisse revenir, au cas où). Il y a pas mal de fonctions ; je ne vous oblige pas à toutes les retenir !</p><p id="r-590230" data-claire-element-id="590230">C'est ici que nous nous quittons. J'espère vous avoir aidé !<br/> À bientôt.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim">Faire des animations avec SDLP_Anim</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim/telechargement-44">
Téléchargement
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim/animation-normale">
Animation normale
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim/animation-par-evenement">
Animation par événement
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/faire-des-animations-avec-sdlp-anim/animation-normale">
<span class="arrow"></span>
<span class="next">Animation normale</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/faire-des-animations-avec-sdlp-anim.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:12:40 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/faire-des-animations-avec-sdlp-anim.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:31:32 GMT -->
</html>