<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/executer-php-en-cli-console.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 09:07:15 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/executer-php-en-cli-console.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:37:15 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Exécuter PHP en CLI (Console)</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/executer-php-en-cli-console.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Exécuter PHP en CLI (Console)</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#ExcuterPHPenCLIConsole">Exécuter PHP en CLI (Console)</a><br/><a href="#TlchargementdePHP">Téléchargement de PHP</a><br/><a href="#UnpetitHelloWorld">Un petit Hello World !</a><br/><a href="#Utilitsdel039excutionenCLI">Utilités de l&#039;exécution en CLI</a><br/><a href="#BoostezvosscriptsPHPenCLI">Boostez vos scripts PHP en CLI !</a><br/></div>
<a name="ExcuterPHPenCLIConsole"></a><h2>Exécuter PHP en CLI (Console)</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/telechargement-de-php">
<span class="next">Téléchargement de PHP</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-529725" data-claire-element-id="529725">Jusque là, on vous a toujours dit que le PHP était un langage côté serveur, c'est-à-dire qui ne servait surtout qu'à générer des pages en (X)HTML. C'est bien sûr exact, et cela reste sa principale utilisation. Cependant...</p><div id="r-529727" data-claire-element-id="529727" data-claire-semantic="question"><p id="r-529726" data-claire-element-id="529726">En devant renommer une bonne centaine de fichiers, vous ne vous êtes jamais dit : &quot;Ah, si je pouvais faire un script en PHP qui pouvait tous les renommer, ça irait bien plus vite !&quot; ? Non ? :p</p></div><p id="r-529728" data-claire-element-id="529728">Eh bien effectivement, cela irait beaucoup plus vite, et c'est possible. En effet, grâce à l'exécution de PHP en CLI, des tas de possibilités s'ouvrent... :D</p><aside id="r-529730" data-claire-element-id="529730" data-claire-semantic="warning"><p id="r-529729" data-claire-element-id="529729">Des connaissances correctes en PHP sont nécessaires pour maîtriser pleinement ce tuto. En cas de besoin, consultez <a href="http://www.siteduzero.com/tuto-3-4-0-un-site-dynamique-avec-php.html">le tuto de M@teo21</a>. De plus, il vaut mieux activer l'affichage des extensions sous Windows, ou suivre ce tuto se révèlera plus dur.</p></aside><p id="r-529731" data-claire-element-id="529731">Ce tuto est centré sur les utilisateurs de Windows. Toutefois, les utilisateurs d'autres systèmes d'exploitation peuvent facilement s'en servir pour exécuter des scripts PHP en CLI, avec quelques légères modifications du côté du téléchargement de PHP.</p>
</div><a name="TlchargementdePHP"></a><h2>Téléchargement de PHP</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/un-petit-hello-world-1">
<span class="next">Un petit Hello World !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<div id="r-529733" data-claire-element-id="529733" data-claire-semantic="question"><p id="r-529732" data-claire-element-id="529732">Mais &quot;CLI&quot;, ça veut dire quoi, au juste ? :euh:</p></div><p id="r-529734" data-claire-element-id="529734">Littéralement, cela signifie &quot;<em>Command-Line Interface</em>&quot; : autrement dit, une fois traduit, &quot;Interface en Ligne de Commande&quot;. Vous avez peut-être déjà vu une console (pas une console de jeux :p ), non ? En voici une :</p><figure id="r-529736" data-claire-element-id="529737"><img id="r-529735" data-claire-element-id="529735" src="medias/uploads.siteduzero.com_files_39001_40000_39736.jpg" alt="Aperçu d'une console"/></figure><p id="r-529738" data-claire-element-id="529738">Lorsque vous aurez appris à créer des scripts PHP exécutés en CLI, il se peut que certains d'entre eux ne durent qu'une fraction de seconde. D'autres, en revanche, vous laisseront admirer cette console, qui pourra se révéler utile, surtout pour le débuggage. ;)</p><p id="r-529739" data-claire-element-id="529739">Pour vous encourager à lire la suite, voici un aperçu de l'un de mes propres scripts PHP exécutés de cette manière. Il sert à comptabiliser des votes au sein d'un forum particulier.</p><figure id="r-529741" data-claire-element-id="529742"><img id="r-529740" data-claire-element-id="529740" src="medias/uploads.siteduzero.com_files_39001_40000_39737.jpg" alt="Exemple de script PHP exécuté en CLI"/></figure><p id="r-529743" data-claire-element-id="529743">Avant de commencer à tester des scripts de ce genre, il vous faudra télécharger PHP, car votre ordinateur n'est pas capable d'interpréter du PHP. Pour ce faire, rendez-vous sur la <a href="http://www.php.net/downloads.php">page des téléchargements</a> de <a href="http://www.php.net/">php.net</a> en <a href="http://www.php.net/downloads.php">cliquant ici</a>.<br/> Choisissez la version la plus récente de PHP. A l'heure où est écrit ce tuto, c'est la version 5.1.6. Si vous êtes sous Windows, choisissez le lien vers les &quot;<em><strong>Windows Binaries</strong></em>&quot;, puis choississez un miroir (français, de préférence, ou gare à la vitesse du téléchargement :p ) et téléchargez le fichier .zip.</p><figure id="r-529745" data-claire-element-id="529746"><img id="r-529744" data-claire-element-id="529744" src="medias/uploads.siteduzero.com_files_39001_40000_39738.jpg" alt="Choisir 'Zip Package' en dessous de 'Windows Binaries'"/></figure><p id="r-529747" data-claire-element-id="529747">Une fois l'archive téléchargée, créez un nouveau dossier dans la racine de votre disque dur (C:, la plupart du temps). J'expliquerai plus tard pourquoi créer le dossier à la racine du disque est plus pratique. Extrayez ensuite l'archive dans ce nouveau dossier, que j'ai personnellement appelé &quot;PHP_tests&quot;.</p><aside id="r-529749" data-claire-element-id="529749" data-claire-semantic="warning"><p id="r-529748" data-claire-element-id="529748">Lorsque l'archive a été extraite, vous devez vous assurer que les répertoires ont été conservés. Normalement, il y en a quatre : dev, ext, extras et PEAR. S'ils sont absents, décompressez l'archive d'une autre manière, en cliquant droit dessus, puis en la décompressant à l'aide de l'option correspondante incluse par votre programme de gestion d'archives.</p></aside><p id="r-529750" data-claire-element-id="529750">Exemple avec PowerArchiver :</p><figure id="r-529752" data-claire-element-id="529753"><img id="r-529751" data-claire-element-id="529751" src="medias/uploads.siteduzero.com_files_39001_40000_39739.jpg" alt="Cliquer droit pour ouvrir le menu contextuel..."/></figure><figure id="r-529755" data-claire-element-id="529756"><img id="r-529754" data-claire-element-id="529754" src="medias/uploads.siteduzero.com_files_39001_40000_39740.jpg" alt="Une fois l'extraction effectuée, on peut supprimer l'archive"/></figure><p id="r-529757" data-claire-element-id="529757">Une fois ceci fait, vous pouvez déjà supprimer les fichiers et dossiers inutiles pour une exécution en CLI. Voici ce que vous pouvez effacer sans crainte :</p><ul id="r-529784" data-claire-element-id="529784"><li id="r-529759" data-claire-element-id="529759"><p id="r-529758" data-claire-element-id="529758">dev</p></li><li id="r-529761" data-claire-element-id="529761"><p id="r-529760" data-claire-element-id="529760">extras</p></li><li id="r-529763" data-claire-element-id="529763"><p id="r-529762" data-claire-element-id="529762">PEAR</p></li><li id="r-529765" data-claire-element-id="529765"><p id="r-529764" data-claire-element-id="529764">go-pear.bat</p></li><li id="r-529767" data-claire-element-id="529767"><p id="r-529766" data-claire-element-id="529766">install.txt</p></li><li id="r-529769" data-claire-element-id="529769"><p id="r-529768" data-claire-element-id="529768">news.txt</p></li><li id="r-529771" data-claire-element-id="529771"><p id="r-529770" data-claire-element-id="529770">php-cgi.exe</p></li><li id="r-529773" data-claire-element-id="529773"><p id="r-529772" data-claire-element-id="529772">php-win.exe</p></li><li id="r-529775" data-claire-element-id="529775"><p id="r-529774" data-claire-element-id="529774">php.ini-dist</p></li><li id="r-529777" data-claire-element-id="529777"><p id="r-529776" data-claire-element-id="529776">php5embed.lib</p></li><li id="r-529779" data-claire-element-id="529779"><p id="r-529778" data-claire-element-id="529778">pws-php5cgi.reg</p></li><li id="r-529781" data-claire-element-id="529781"><p id="r-529780" data-claire-element-id="529780">pws-php5isapi.reg</p></li><li id="r-529783" data-claire-element-id="529783"><p id="r-529782" data-claire-element-id="529782">snapshot.txt</p></li></ul><p id="r-529785" data-claire-element-id="529785">Ensuite, créez un nouveau fichier, et renommez-le pour qu'il ait une extension en .php. Choisissez le nom qui vous conviendra. Pourquoi pas &quot;exemple.php&quot;, pour un début ?<br/> Autre chose à faire : renommez le fichier &quot;php.ini-recommended&quot; en &quot;php.ini&quot;.</p><p id="r-529786" data-claire-element-id="529786">Vous avez à présent tous les outils nécessaires pour créer votre propre script en PHP, exécuté en CLI !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console">Exécuter PHP en CLI (Console)</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/telechargement-de-php">
Téléchargement de PHP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/un-petit-hello-world-1">
Un petit Hello World !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/utilites-de-l-execution-en-cli">
Utilités de l&#039;exécution en CLI
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/boostez-vos-scripts-php-en-cli">
Boostez vos scripts PHP en CLI !
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/un-petit-hello-world-1">
<span class="next">Un petit Hello World !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="UnpetitHelloWorld"></a><h2>Un petit Hello World !</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/telechargement-de-php">
<span class="arrow"></span>
<span class="next">Téléchargement de PHP</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/utilites-de-l-execution-en-cli">
<span class="next">Utilités de l&#039;exécution en CLI</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-529788" data-claire-element-id="529788">Maintenant que vous pouvez techniquement faire tourner des scripts PHP sur votre ordinateur, si on essayait un petit Hello World ?</p><aside id="r-529790" data-claire-element-id="529790" data-claire-semantic="information"><p id="r-529789" data-claire-element-id="529789">Un &quot;Hello World !&quot;, en programmation, est une sorte d'initiation à un langage. Ici, vous connaissez déjà PHP, mais c'est la première fois que vous allez l'utiliser en CLI : un Hello World est donc de rigueur. ;)</p></aside><p id="r-529791" data-claire-element-id="529791">Pour cela, rien de plus simple. Ouvrez le fichier en .php que vous avez créé précédemment, à l'aide de votre éditeur qui vous sert habituellement à scripter en PHP (Bloc-Notes, NotePad++, DreamWeaver, etc). Ensuite, comme d'habitude, mettez les tags PHP, et ajoutez, tout bêtement, un <a href="http://www.php.net/manual/fr/function.echo.php">echo</a> ou un <a href="http://www.php.net/manual/fr/function.print.php">print</a>, avec comme paramètre la chaîne &quot;Hello World !&quot;.</p><pre id="r-529792" data-claire-element-id="529792"><code data-claire-semantic="html+php">&lt;?php
print
(&quot;Hello World !&quot;); // Je préfère print, mais echo a aussi souvent la cote :)
?&gt;</code></pre><p id="r-529793" data-claire-element-id="529793">Enregistrez et fermez. Voilà, votre Hello World est prêt à être testé !</p><div id="r-529795" data-claire-element-id="529795" data-claire-semantic="question"><p id="r-529794" data-claire-element-id="529794">Mais comment le parser ?</p></div><p id="r-529796" data-claire-element-id="529796">C'est là qu'intervient tout ce qu'on a téléchargé. Rappelez-vous, tous les fichiers, scripts compris, sont dans un dossier à la racine de votre disque. Imaginons que vous ayez nommé le script &quot;exemple.php&quot; et le dossier &quot;PHP_tests&quot;, dans la racine du lecteur C:. Il va falloir utiliser l'application php.exe dans ce répertoire, mais en lui passant un paramètre. On pourrait créer un raccourci, mais ça serait bien trop fastidieux. Pour le moment, on va utiliser la console, mais plus tard, j'expliquerai comment se passer de cette console.</p><p id="r-529797" data-claire-element-id="529797">Rendez-vous dans <strong>démarrer</strong>, cliquez sur <strong>Exécuter</strong>, tapez &quot;cmd&quot; et validez.</p><figure id="r-529799" data-claire-element-id="529800"><img id="r-529798" data-claire-element-id="529798" src="medias/uploads.siteduzero.com_files_39001_40000_39741.jpg" alt="Ouvrir la console"/></figure><p id="r-529801" data-claire-element-id="529801">Vous obtenez une superbe console. :D Ne rêvez quand même pas, ce n'est pas une console de jeux, comme je l'ai déjà dit. :p <br/> Seulement, la console affiche un répertoire, et ce n'est pas le bon. Nous allons donc nous replacer dans le bon répertoire. Pour ce faire, tapez ceci :</p><pre id="r-529802" data-claire-element-id="529802"><code data-claire-semantic="console">cd ../../PHP_tests</code></pre><p id="r-529803" data-claire-element-id="529803">Appuyez ensuite sur <strong>Entrée</strong>.<br/> Si ça n'a pas marché, tapez &quot;cd ..&quot; puis Entrée, jusqu'à ce que vous atteignez C:. Tapez ensuite &quot;cd PHP_tests&quot;.<br/> &quot;PHP_tests&quot; doit bien sûr être remplacé par le nom du dossier que vous avez crée à la racine de C:.</p><p id="r-529804" data-claire-element-id="529804">Une fois placé dans le bon dossier, tapez simplement ceci :</p><pre id="r-529805" data-claire-element-id="529805"><code data-claire-semantic="console">php exemple.php</code></pre><p id="r-529806" data-claire-element-id="529806">&quot;exemple.php&quot; devant être remplacé par le nom de votre script PHP chargé d'afficher &quot;Hello World !&quot;.<br/> Et miracle, voici le résultat o_O :</p><figure id="r-529808" data-claire-element-id="529809"><img id="r-529807" data-claire-element-id="529807" src="medias/uploads.siteduzero.com_files_39001_40000_39742.jpg" alt="Hello World !"/></figure><p id="r-529810" data-claire-element-id="529810">Évidemment, si <a href="http://www.php.net/manual/fr/function.echo.php">echo</a> et <a href="http://www.php.net/manual/fr/function.print.php">print</a> fonctionnent, une grande partie des fonctions PHP vont être tout aussi efficaces en CLI que en CGI (le &quot;mode serveur web&quot;). ^^ Toutefois, comme indiqué <a href="http://www.php.net/manual/fr/features.commandline.php">à cet endroit</a> sur <a href="http://www.php.net/">php.net</a>, il existe quelques légères différences...<br/> Voici un petit résumé de ces différences :</p><ul id="r-529827" data-claire-element-id="529827"><li id="r-529812" data-claire-element-id="529812"><p id="r-529811" data-claire-element-id="529811">si vous avez manipulé des headers dans un script pour un site web, ne comptez pas pouvoir faire de même avec PHP en mode CLI, pour des raisons évidentes ; aucun header n'est envoyé nulle part !</p></li><li id="r-529814" data-claire-element-id="529814"><p id="r-529813" data-claire-element-id="529813">Contrairement à la version CGI, la version CLI de PHP ne transforme pas le répertoire du script en répertoire courant. Si vous manipulez les fichiers de votre ordinateur, il faudra donc taper leur adresse en absolu, ou bien faire du répertoire du script le répertoire courant.</p></li><li id="r-529816" data-claire-element-id="529816"><p id="r-529815" data-claire-element-id="529815">Lorsqu'une erreur se produit avec un script exécuté en CGI, le message d'erreur est formaté en HTML avant d'être placé dans la source, afin de rendre l'erreur plus facilement lisible. Évidemment, en CLI, formater les erreurs en HTML n'aurait pas de sens, elles sont donc affichées en texte brut, en on ne peut changer ceci.</p></li><li id="r-529818" data-claire-element-id="529818"><p id="r-529817" data-claire-element-id="529817">Si vous utilisiez l'option <a href="http://www.php.net/manual/fr/ref.outcontrol.php#ini.implicit-flush">implicit_flush</a> dans le fichier php.ini de votre serveur web, sachez que cette option n'est pas activable en CLI.</p></li><li id="r-529820" data-claire-element-id="529820"><p id="r-529819" data-claire-element-id="529819">Un script exécuté en CGI a un temps d'exécution limité (souvent 30 secondes), afin de ne pas surcharger le serveur web. Cette limite n'ayant pas de sens en CLI, elle n'existe pas lorsque vous exécutez un script de cette manière.</p></li><li id="r-529822" data-claire-element-id="529822"><p id="r-529821" data-claire-element-id="529821">Comme dans des langages de programmation tels que le C, il peut être utile de pouvoir exécuter un script en mode CLI de plusieurs manières, $argv et $argc existent donc dans ce mode. Le sujet sera abordé plus tard.</p></li><li id="r-529824" data-claire-element-id="529824"><p id="r-529823" data-claire-element-id="529823">Comme dans des langages de programmation tels que le C, des pointeurs de fichiers sont déjà ouverts dès l'exécution d'un script en CLI. Les constantes STDIN, STDOUT et STDERR peuvent donc être utilisées par des fonctions telles que <a href="http://www.php.net/manual/fr/function.fgets.php">fgets</a> ou <a href="http://www.php.net/manual/fr/function.fputs.php">fputs</a>, de la même manière qu'est utilisé un pointeur de fichier renvoyé par des fonctions comme <a href="http://www.php.net/manual/fr/function.fopen.php">fopen</a>. Il est également inutile de les refermer à l'aide de <a href="http://www.php.net/manual/fr/function.fclose.php">fclose</a>, ceci étant fait automatiquement à la fin du script.</p></li><li id="r-529826" data-claire-element-id="529826"><p id="r-529825" data-claire-element-id="529825">N'oubliez pas que la console de Windows ne gère pas les accents ! Faites donc attention lorsque vous utilisez <a href="http://www.php.net/manual/fr/function.echo.php">echo</a> ou <a href="http://www.php.net/manual/fr/function.print.php">print</a>...</p></li></ul>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console">Exécuter PHP en CLI (Console)</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/telechargement-de-php">
Téléchargement de PHP
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/un-petit-hello-world-1">
Un petit Hello World !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/utilites-de-l-execution-en-cli">
Utilités de l&#039;exécution en CLI
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/boostez-vos-scripts-php-en-cli">
Boostez vos scripts PHP en CLI !
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/telechargement-de-php">
<span class="arrow"></span>
<span class="next">Téléchargement de PHP</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/utilites-de-l-execution-en-cli">
<span class="next">Utilités de l&#039;exécution en CLI</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Utilitsdel039excutionenCLI"></a><h2>Utilités de l&#039;exécution en CLI</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/un-petit-hello-world-1">
<span class="arrow"></span>
<span class="next">Un petit Hello World !</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/boostez-vos-scripts-php-en-cli">
<span class="next">Boostez vos scripts PHP en CLI !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-529829" data-claire-element-id="529829">A présent, vous savez créer un petit script et l'exécuter en CLI.</p><div id="r-529831" data-claire-element-id="529831" data-claire-semantic="question"><p id="r-529830" data-claire-element-id="529830">Maintenant que je sais faire de tels scripts, qu'est-ce que je peux bien faire ?</p></div><p id="r-529832" data-claire-element-id="529832">Les scripts en CLI ont souvent une utilité bien différente de celle des scripts en CGI. On les utilise parfois pour accomplir des tâches brèves, ou des tâches &quot;automatisées&quot;. Un des principaux défauts des scripts en CLI est qu'on ne peut pas interagir directement avec l'utilisateur autrement qu'avec STDIN, qui se révèle limité. Il existe des solutions face à ce problème, comme <a href="http://www.php.net/manual/fr/history.php.related.php">PHP-GTK</a>, mais elles sont souvent complexes.</p><p id="r-529833" data-claire-element-id="529833">Pour interagir avec l'utilisateur, voici le code PHP :</p><pre id="r-529834" data-claire-element-id="529834"><code data-claire-semantic="html+php">&lt;?php
$reponse = fgets(STDIN);
?&gt;</code></pre><aside id="r-529836" data-claire-element-id="529836" data-claire-semantic="information"><p id="r-529835" data-claire-element-id="529835">Lorsque PHP atteindra cette ligne, le script se &quot;bloquera&quot;. L'utilisateur pourra alors entrer du texte dans la console, et pourra l'envoyer dans $reponse à l'aide de la touche <strong>Entrée</strong>. le script se &quot;débloquera&quot; alors.</p></aside><p id="r-529837" data-claire-element-id="529837">On peut tout d'abord utiliser PHP en CLI pour gérer des fichiers et / ou des dossiers. Les fonctions &quot;<a href="http://www.php.net/manual/fr/ref.filesystem.php">Système de Fichiers</a>&quot; sont donc très utiles dans ce cas-là. Par exemple, si vous avez un millier de fichiers à renommer, l'utilisation de PHP en CLI peut être judicieuse. Si vous voulez renommer un millier de fichiers .html en fichiers .php, qui seraient situés dans le dossier &quot;fichiers&quot; situé dans un dossier (contenant le script) à la racine de votre disque dur, il suffit de taper un script pour scanner le répertoire &quot;fichiers&quot;, et renommer tous les fichiers .htm(l) s'y trouvant. Exemple de script :</p><pre id="r-529838" data-claire-element-id="529838"><code data-claire-semantic="html+php">&lt;?php
if(($array = scandir(getcwd().&quot;/fichiers&quot;)) !== false)
 {
 foreach($array as $key =&gt; $content)
  {
  if($content != &quot;.&quot; &amp;&amp; $content != &quot;..&quot; &amp;&amp; preg_match(&quot;`.html?$`&quot;, $content) == 1)
   {
   $newname = preg_replace(&quot;`.html?$`&quot;, &quot;.php&quot;, $content);
   rename(getcwd().&quot;/fichiers/&quot;.$content, getcwd().&quot;/fichiers/&quot;.$newname);
   print($content.&quot; a ete renomme : le nom du fichier est maintenant &quot;.$newname.&quot;n&quot;);
   }
  }
 }
?&gt;</code></pre><p id="r-529839" data-claire-element-id="529839">Essayons avec 3 fichiers :</p><ul id="r-529846" data-claire-element-id="529846"><li id="r-529841" data-claire-element-id="529841"><p id="r-529840" data-claire-element-id="529840">test.html</p></li><li id="r-529843" data-claire-element-id="529843"><p id="r-529842" data-claire-element-id="529842">test2.htm</p></li><li id="r-529845" data-claire-element-id="529845"><p id="r-529844" data-claire-element-id="529844">test3.ht (pour vérifier que ce fichier-ci n'est pas renommé).</p></li></ul><figure id="r-529848" data-claire-element-id="529849"><img id="r-529847" data-claire-element-id="529847" src="medias/uploads.siteduzero.com_files_39001_40000_39743.jpg" alt="Script de renommage de fichiers"/></figure><p id="r-529850" data-claire-element-id="529850">Et lorsqu'on regarde à nouveau les 3 fichiers, on a à présent :</p><ul id="r-529857" data-claire-element-id="529857"><li id="r-529852" data-claire-element-id="529852"><p id="r-529851" data-claire-element-id="529851">test.php</p></li><li id="r-529854" data-claire-element-id="529854"><p id="r-529853" data-claire-element-id="529853">test2.php</p></li><li id="r-529856" data-claire-element-id="529856"><p id="r-529855" data-claire-element-id="529855">test3.ht.</p></li></ul><div id="r-529859" data-claire-element-id="529859" data-claire-semantic="question"><p id="r-529858" data-claire-element-id="529858">Pourquoi avoir mis le caractère &quot;n&quot; dans la fonction <a href="http://www.php.net/manual/fr/function.print.php">print</a> ; à quoi sert-il ?</p></div><p id="r-529860" data-claire-element-id="529860">Ce caractère est un saut de ligne.<br/> Lors d'une utilisation &quot;traditionnelle&quot; de PHP en CGI, on met rarement des sauts de ligne, en PHP. En effet, ceux-ci sont visibles uniquement dans le code source HTML généré, contrairement à &lt;br&gt;. Or, en CLI, la console n'est pas soumise à l'HTML. C'est un peu comme si on &quot;lisait directement la source&quot;. Un saut de ligne sera donc visible, et empêcheront les messages d'être collés. :)</p><div id="r-529862" data-claire-element-id="529862" data-claire-semantic="question"><p id="r-529861" data-claire-element-id="529861">Si je me trompe dans mon script et que je mets une boucle infinie, comment arrêter tout ça ? :euh:</p></div><p id="r-529863" data-claire-element-id="529863">Il suffit de faire la combinaison de touches <strong>CTRL</strong> + <strong>C</strong> pour stopper le script à tout moment. ;)</p><figure id="r-529865" data-claire-element-id="529866"><img id="r-529864" data-claire-element-id="529864" src="medias/uploads.siteduzero.com_files_39001_40000_39744.jpg" alt="CTRL + C stoppe le script"/></figure><div id="r-529868" data-claire-element-id="529868" data-claire-semantic="question"><p id="r-529867" data-claire-element-id="529867">Les scripts CLI ne servent-ils donc qu'à accélérer la manipulation de fichiers ?</p></div><p id="r-529869" data-claire-element-id="529869">Pas du tout ! Les possibilités, limitées seulement par votre imagination, sont quasi-infinies ; presque toutes les fonctions de PHP sont utilisables dans ce mode ! Vous pouvez, par exemple, manipuler des pages web distantes (en lecture seule, bien sûr). Il existe beaucoup d'usages de PHP en CLI dans ce sens, comme des statistiques pour des forums. Pour accéder à Internet, quelque soit le mode de fonctionnement de PHP, l'une des meilleures solutions est d'utiliser <a href="http://www.php.net/manual/fr/ref.curl.php">cURL</a>.<br/> Toutefois, le plus grand atout de PHP en CLI est l'absence de limite de temps. Vous pouvez à présent tenter de transformer votre ordinateur en une sorte de serveur (stoppable à tout moment). Un des meilleurs exercices que je pourrais vous proposer serait de vous servir du <a href="http://www.siteduzero.com/tuto-3-892-0-comment-utiliser-les-sockets-avec-php-comment-faire-un-chat-avec-les-sockets.html">tuto sur les sockets</a> d'<a href="http://www.siteduzero.com/membres-294-2456.html">Azmeuk</a> pour apprendre comment créer un chat par le biais des sockets en CGI, puis de réaliser ce genre de chat avec un script serveur exécuté en CLI, afin de se débarrasser de la limite du temps d'exécution de la plupart des serveurs web pour avoir un serveur de chat fonctionnel.</p><p id="r-529870" data-claire-element-id="529870">A un niveau beaucoup plus relevé, cette fois-ci, vous pourriez utiliser les sockets pour réaliser un bot pour un jeu vidéo, même si à ce stade, on utiliserait PHP-GTK.</p><aside id="r-529872" data-claire-element-id="529872" data-claire-semantic="warning"><p id="r-529871" data-claire-element-id="529871">Restez dans la légalité ! Sur la plupart des jeux non entièrement axés multi-joueurs (même s'ils possèdent un mode multi-joueurs apprécié et très fréquenté), les bots sont largement tolérés, pas de problème, donc. <strong>En revanche, sur les MMORPGs, pour ne citer qu'eux, les bots sont souvent strictement interdits !</strong></p></aside><p id="r-529873" data-claire-element-id="529873">Avant de bondir sur <a href="http://www.php.net/">php.net</a> et les <a href="http://www.siteduzero.com/tuto-2-68-php-mysql.html">autres tutos PHP</a> pour trouver des idées d'utilisation, mieux vaut lire encore un peu ce tuto-ci, car pour le moment, exécuter un script PHP en CLI est très lourd.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console">Exécuter PHP en CLI (Console)</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/telechargement-de-php">
Téléchargement de PHP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/un-petit-hello-world-1">
Un petit Hello World !
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/utilites-de-l-execution-en-cli">
Utilités de l&#039;exécution en CLI
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/boostez-vos-scripts-php-en-cli">
Boostez vos scripts PHP en CLI !
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/un-petit-hello-world-1">
<span class="arrow"></span>
<span class="next">Un petit Hello World !</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/boostez-vos-scripts-php-en-cli">
<span class="next">Boostez vos scripts PHP en CLI !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="BoostezvosscriptsPHPenCLI"></a><h2>Boostez vos scripts PHP en CLI !</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/utilites-de-l-execution-en-cli">
<span class="arrow"></span>
<span class="next">Utilités de l&#039;exécution en CLI</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-529875" data-claire-element-id="529875">Vous savez déjà comment exécuter un script PHP en CLI. Toutefois, il vaut mieux que vous connaissiez le moyen permettant d'exécuter de tels scripts bien plus rapidement.</p><aside id="r-529877" data-claire-element-id="529877" data-claire-semantic="information"><p id="r-529876" data-claire-element-id="529876">Pour le moment, on a utilisé la console de Windows pour lancer les scripts. Cependant, il existe une méthode bien plus rapide ; les fichiers .bat.</p></aside><p id="r-529878" data-claire-element-id="529878">Vous pouvez tout de suite déplacer le dossier dans lequel se trouve le script pour le mettre n'importe où, comme sur le bureau. En effet, sans console à gérer, le script sera facilement exécutable de partout.<br/> Créez ensuite un nouveau fichier texte. Inutile de lui donner un nom précis pour le moment, on le renommera plus tard.<br/> A l'intérieur de ce fichier texte, tapez tout simplement :</p><pre id="r-529879" data-claire-element-id="529879"><code data-claire-semantic="console">php exemple.php</code></pre><p id="r-529880" data-claire-element-id="529880">Remplacez exemple.php par le nom de votre script.<br/> Ensuite, enregistrez et fermez le fichier texte, puis renommez-le sous n'importe quel nom. Une seule obligation : l'extension doit être en .bat.</p><figure id="r-529882" data-claire-element-id="529883"><img id="r-529881" data-claire-element-id="529881" src="medias/uploads.siteduzero.com_files_39001_40000_39745.jpg" alt="Lancer exemple.php.bat"/></figure><p id="r-529884" data-claire-element-id="529884">Double-cliquez ensuite sur le fichier .bat... Incroyable, la console a trouvé le script toute seule. o_O :D</p><aside id="r-529886" data-claire-element-id="529886" data-claire-semantic="warning"><p id="r-529885" data-claire-element-id="529885">Le fichier .bat est, certes, très pratique pour un usage courant, mais la fenêtre disparaît une fois que le script cesse toute activité. La plupart du temps, cela se produit car le script est achevé, mais ça peut aussi arriver après une erreur de type &quot;Fatal Error&quot;. Si vous devez donc débugger votre script, mieux vaut recourir à la bonne vieille méthode ; ouvrir une console Windows et lancer le script à partir de cette console.</p></aside><p id="r-529887" data-claire-element-id="529887">Abordons à présent un sujet lié au fichier .bat : les arguments.<br/> Comme en C, on peut passer une liste d'arguments au script. Celui-ci peut ensuite les gérer.</p><p id="r-529888" data-claire-element-id="529888">Comme le fichier .bat est de loin le plus pratique pour lancer le script rapidement, je ne m'attarderai que sur lui.<br/> Pour passer des arguments au script à partir du fichier .bat, il suffit de les ajouter à la suite de la ligne déjà remplie, en séparant chaque argument par un espace. Exemple :</p><pre id="r-529889" data-claire-element-id="529889"><code data-claire-semantic="console">php exemple.php argument1 Argument2 argumentTrois</code></pre><p id="r-529890" data-claire-element-id="529890">Bien sûr, il faut ensuite gérer ces arguments côté script. Là aussi, c'est très facile : les arguments sont stockés dans la variable superglobale, $_SERVER, plus précisément dans l'array $_SERVER['argv']. Le premier argument sera $_SERVER['argv'][0], le second sera $_SERVER['argv'][1], etc.<br/> Le nombre d'arguments est aussi stocké, dans $_SERVER['argc'].</p><aside id="r-529892" data-claire-element-id="529892" data-claire-semantic="information"><p id="r-529891" data-claire-element-id="529891">Vous pouvez donc créer <strong>plusieurs fichiers .bat</strong> ! Par exemple, un sans arguments, un avec deux arguments, et un troisième avec deux arguments différents ! Le script réagira donc différemment face aux trois situations différentes, du moins, si vous utilisez $_SERVER['argv'] et / ou dans $_SERVER['argc'].</p></aside><p id="r-529893" data-claire-element-id="529893">Si vous voulez utiliser toutes les fonctionalités de PHP, comme les sockets, MySQL, cURL, etc, n'oubliez pas que vous devez activer les extensions correspondantes en ôtant le point-virgule (&quot;<strong>;</strong>&quot;) devant leur DLL, dans php.ini. Pour trouver facilement la zone correspondante dans le gros fichier, faite simplement une recherche sur &quot;mysql&quot; avec l'outil de recherche du bloc-notes, les DLL à activer ou non devraient être à proximité de la première occurrence.<br/> Si vous n'activez pas une fonctionnalité, les fonctions PHP correspondantes ne seront pas définies.</p><p id="r-529894" data-claire-element-id="529894">Si savoir exécuter un script PHP en CLI n'est pas indispensable, cela peut se révéler quand même très utile. Évidemment, si vous maîtrisez complètement le C, le C++ ou n'importe quel autre langage de programmation, PHP ne fera pas le poids. :p Cependant, PHP est bien plus facile et rapide à utiliser que ces langages. De plus, s'entraîner avec PHP exécuté en CLI peut aider à mieux comprendre certains concepts en programmation, surtout si vous vous intéressez de près à <a href="http://gtk.php.net/">PHP-GTK</a>, qui permet de scripter de manière événementielle (le script est &quot;en attente&quot; d'un évènement, provenant souvent de l'utilisateur) et de manier des <em>widgets</em>. ^^</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console">Exécuter PHP en CLI (Console)</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/telechargement-de-php">
Téléchargement de PHP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/un-petit-hello-world-1">
Un petit Hello World !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/utilites-de-l-execution-en-cli">
Utilités de l&#039;exécution en CLI
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/boostez-vos-scripts-php-en-cli">
Boostez vos scripts PHP en CLI !
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/executer-php-en-cli-console/utilites-de-l-execution-en-cli">
<span class="arrow"></span>
<span class="next">Utilités de l&#039;exécution en CLI</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/executer-php-en-cli-console.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 09:08:01 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/executer-php-en-cli-console.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:37:17 GMT -->
</html>