<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/developper-son-propre-controle-utilisateur-winforms.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:19:44 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/developper-son-propre-controle-utilisateur-winforms.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:33:10 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Développer son propre contrôle utilisateur WinForms</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Développer son propre contrôle utilisateur WinForms</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#DveloppersonproprecontrleutilisateurWinForms">Développer son propre contrôle utilisateur WinForms</a><br/><a href="#Prambule">Préambule</a><br/><a href="#Crationducontrle">Création du contrôle</a><br/><a href="#vnements">Événements</a><br/><a href="#Fonctionnalitssupplmentaires">Fonctionnalités supplémentaires</a><br/></div>
<a name="DveloppersonproprecontrleutilisateurWinForms"></a><h2>Développer son propre contrôle utilisateur WinForms</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/preambule-9">
<span class="next">Préambule</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-551143" data-claire-element-id="551143">N'avez vous jamais été frustré de vous apercevoir qu'il manque, dans votre boite à outils, un contrôle utilisateur que vous utilisiez auparavant avec un autre framework ? Dès lors, une réponse surgit lors de cette infâme découverte : créons notre propre contrôle utilisateur.</p><div id="r-551145" data-claire-element-id="551145" data-claire-semantic="question"><p id="r-551144" data-claire-element-id="551144">Oui, mais comment ?</p></div><p id="r-551146" data-claire-element-id="551146">Heureusement pour nous, il nous est possible de créer notre propre contrôle utilisateur grâce à une classe déjà toute faite, et tout est entièrement personnalisable. Nous allons, pas à pas, créer un contrôle utilisateur spécialement conçu pour nous, les Zéros : une <em>zCheckBox </em>!</p><aside id="r-551148" data-claire-element-id="551148" data-claire-semantic="warning"><p id="r-551147" data-claire-element-id="551147">Dans ce tutoriel, je n'utilise que le C# pour créer le contrôle utilisateur, mais vous pouvez le réaliser en VB.NET !</p></aside><figure id="r-551150" data-claire-element-id="551151"><img id="r-551149" data-claire-element-id="551149" src="medias/uploads.siteduzero.com_files_354001_355000_354836.png" alt="Image utilisateur"/></figure><p id="r-551152" data-claire-element-id="551152">Contrôle utilisateur développé par moi-même</p><figure id="r-551154" data-claire-element-id="551155"><img id="r-551153" data-claire-element-id="551153" src="medias/uploads.siteduzero.com_files_355001_356000_355117.png" alt="Image utilisateur"/></figure><p id="r-551156" data-claire-element-id="551156">Contrôle utilisateur que nous développerons dans ce tutoriel</p><p id="r-551157" data-claire-element-id="551157">Afin d'être à l'aise dans la compréhension des codes, il est vivement conseillé d'avoir lu le tutoriel de nico.pyright sur le <a href="http://www.siteduzero.com/tutoriel-3-523498-apprendre-a-developper-en-c.html">langage C#.NET</a>, notamment vers la partie 3.</p><p id="r-551158" data-claire-element-id="551158">Je vous conseille de lire entièrement le tutoriel sans sauter d'étapes, sinon vous risquerez d'être très rapidement perdu.<br/><em><br/> Je tiens à remercier <a href="http://www.siteduzero.com/membres-294-241946.html">Chiheb2012</a> pour le gros travail de relecture et de correction orthographique qu'il a effectué. Je remercie également <a href="http://www.siteduzero.com/membres-294-26302.html">Orwell</a> pour son travail de validation ainsi que ses remarques qui ont permis d'améliorer ce tutoriel.</em></p>
</div><a name="Prambule"></a><h2>Préambule</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/creation-du-controle">
<span class="next">Création du contrôle</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-551159" data-claire-element-id="551159">Comme je l'ai annoncé plus haut dans l'introduction, nous allons ensemble créer un contrôle utilisateur : une case à cocher.</p><div id="r-551161" data-claire-element-id="551161" data-claire-semantic="question"><p id="r-551160" data-claire-element-id="551160">C'est tout ? Je m'attendais à quelque chose de plus impressionnant !</p></div><p id="r-551162" data-claire-element-id="551162">Oui, mais ne vaut-il pas mieux commencer par quelque chose de simple sur un sujet inconnu ? Il se peut que certains manipulent déjà les contrôles utilisateurs et savent en créer sans problème. Mais lorsqu'on est débutant, c'est pas toujours facile de vouloir créer nos contrôles avec un déploiement parfait. C'est d'ailleurs pour cette raison que j'ai créé ce tutoriel.</p><p id="r-551163" data-claire-element-id="551163">Le tutoriel est un peu spécial, car il s'agit d'un TP intégré au cours. Tout au long du tutoriel, nous allons créer une case à cocher nommée <em>zCheckBox</em> ayant un autre style visuel que celui du framework .NET. L'intérêt de celui-ci sera surtout de créer une case à cocher plus belle que celles fournies par défaut. Mais rassurez-vous, j'ai adapté le cours à votre situation : tout est expliqué, chaque morceau de code est décortiqué de façon à ce que vous compreniez les éléments essentiels.</p><p id="r-551164" data-claire-element-id="551164">Et comme je suis gentil, je vous ai fourni l'outil plus les sources et le projet à la fin du tutoriel. Voici ce que nous créerons à l'issue de ce tutoriel :</p><figure id="r-551166" data-claire-element-id="551167"><img id="r-551165" data-claire-element-id="551165" src="medias/uploads.siteduzero.com_files_354001_355000_354837.png" alt="Image utilisateur"/></figure><aside id="r-551169" data-claire-element-id="551169" data-claire-semantic="information"><p id="r-551168" data-claire-element-id="551168">J'utilise Visual Studio 2010, et je suis sous le framework .NET 4.0. Si vous utilisez un autre IDE (par exemple MonoDevelop) ou une autre version du framework, il peut y avoir quelques différences, mais cela devrait fonctionner sans gros soucis.</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms">Développer son propre contrôle utilisateur WinForms</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/preambule-9">
Préambule
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/creation-du-controle">
Création du contrôle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/evenements-7">
Événements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/fonctionnalites-supplementaires-1">
Fonctionnalités supplémentaires
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/creation-du-controle">
<span class="next">Création du contrôle</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Crationducontrle"></a><h2>Création du contrôle</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/preambule-9">
<span class="arrow"></span>
<span class="next">Préambule</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/evenements-7">
<span class="next">Événements</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-551171" data-claire-element-id="551171">Nous allons à présent créer notre contrôle. Ouvrez Visual Studio C#, créez un nouveau projet, et sélectionnez <em>Bibliothèque de classes</em>.</p><figure id="r-551173" data-claire-element-id="551174"><img id="r-551172" data-claire-element-id="551172" src="medias/uploads.siteduzero.com_files_354001_355000_354887.png" alt="Image utilisateur"/></figure><p id="r-551175" data-claire-element-id="551175">Une classe par défaut nous est offerte. Supprimez-la, et en faisant un clic droit sur votre projet dans l'explorateur de solutions, ajoutez-y un élément <em>Contrôle utilisateur</em> que vous nommerez par exemple <em>zCheckBox.cs</em> :</p><figure id="r-551177" data-claire-element-id="551178"><img id="r-551176" data-claire-element-id="551176" src="medias/uploads.siteduzero.com_files_354001_355000_354888.png" alt="Image utilisateur"/></figure><h2 id="r-la-partie-design" data-claire-element-id="551280">La partie Design</h2><p id="r-551179" data-claire-element-id="551179">Vous accédez alors à la page <strong>Design </strong>de votre contrôle. Tout comme dans le <strong>Designer </strong>d'une fenêtre, nous allons placer les éléments déjà fournis dans la boite à outils pour créer notre case à cocher. Nous avons donc besoin de deux composants :</p><ul id="r-551184" data-claire-element-id="551184"><li id="r-551181" data-claire-element-id="551181"><p id="r-551180" data-claire-element-id="551180"><strong>PictureBox </strong>: Ce composant va nous permettre d'afficher la case ainsi que la croix <em>Vrai</em></p></li><li id="r-551183" data-claire-element-id="551183"><p id="r-551182" data-claire-element-id="551182"><strong>Label </strong>: Comme dans un <strong>CheckBox</strong>, le texte de la case à cocher</p></li></ul><p id="r-551185" data-claire-element-id="551185">Disposez-les de façon à reconnaître l’architecture d'une case à cocher : la case à gauche et le texte à droite.</p><div id="r-551187" data-claire-element-id="551187" data-claire-semantic="question"><p id="r-551186" data-claire-element-id="551186">Mais on doit créer nous même nos images ?</p></div><p id="r-551188" data-claire-element-id="551188">Oui, et c'est justement là l'intérêt de créer une case à cocher, nous allons pouvoir lui donner nos propres styles. Dans chaque style, nous avons 3 états pour la case à cocher :</p><ul id="r-551195" data-claire-element-id="551195"><li id="r-551190" data-claire-element-id="551190"><p id="r-551189" data-claire-element-id="551189"><em>NoEvent</em>, lorsque la souris n’interagit pas avec la case</p></li><li id="r-551192" data-claire-element-id="551192"><p id="r-551191" data-claire-element-id="551191"><em>OnHover</em>, lorsque la souris est sur le composant</p></li><li id="r-551194" data-claire-element-id="551194"><p id="r-551193" data-claire-element-id="551193"><em>OnClick</em>, lorsque l'utilisateur clique sur la case</p></li></ul><p id="r-551196" data-claire-element-id="551196">Il s'agit bien évidemment d'événements que nous créerons pour définir l'état du contrôle. Il y aura aussi un quatrième événement, OnRelease, lorsque le bouton de la souris est relâché, mais qui ne fait pas office d'état pour l'instant, car aucun effet visuel ne sera rajouté pour cet événement. Et pour chaque état, il y a une image. J'ai réalisé cinq styles de case à cocher ci-dessous que nous utiliserons (et que vous pourrez utiliser dans vos futurs programmes, si vous en avez le courage :p ). De gauche à droite, l'état est défini par <em>NoEvent</em>, <em>OnHover</em>, <em>OnClick </em>puis le symbole <strong>Checked</strong>.</p><table id="r-551273" data-claire-element-id="551273"><tbody id="r-551272" data-claire-element-id="551272"><tr id="r-551211" data-claire-element-id="551211"><td id="r-551198" data-claire-element-id="551198"><p id="r-551197" data-claire-element-id="551197">Basic</p></td><td id="r-551200" data-claire-element-id="551201"><img id="r-551201" data-claire-element-id="551200" src="medias/uploads.siteduzero.com_files_354001_355000_354895.png" alt="Image utilisateur"/><img id="r-551199" data-claire-element-id="551199" src="medias/uploads.siteduzero.com_files_354001_355000_354895.png" alt="Image utilisateur"/></td><td id="r-551203" data-claire-element-id="551204"><img id="r-551204" data-claire-element-id="551203" src="medias/uploads.siteduzero.com_files_354001_355000_354896.png" alt="Image utilisateur"/><img id="r-551202" data-claire-element-id="551202" src="medias/uploads.siteduzero.com_files_354001_355000_354896.png" alt="Image utilisateur"/></td><td id="r-551206" data-claire-element-id="551207"><img id="r-551207" data-claire-element-id="551206" src="medias/uploads.siteduzero.com_files_354001_355000_354897.png" alt="Image utilisateur"/><img id="r-551205" data-claire-element-id="551205" src="medias/uploads.siteduzero.com_files_354001_355000_354897.png" alt="Image utilisateur"/></td><td id="r-551209" data-claire-element-id="551210"><img id="r-551210" data-claire-element-id="551209" src="medias/uploads.siteduzero.com_files_376001_377000_376275.png" alt="Image utilisateur"/><img id="r-551208" data-claire-element-id="551208" src="medias/uploads.siteduzero.com_files_376001_377000_376275.png" alt="Image utilisateur"/></td></tr><tr id="r-551226" data-claire-element-id="551226"><td id="r-551213" data-claire-element-id="551213"><p id="r-551212" data-claire-element-id="551212">Lighted</p></td><td id="r-551215" data-claire-element-id="551216"><img id="r-551216" data-claire-element-id="551215" src="medias/uploads.siteduzero.com_files_354001_355000_354900.png" alt="Image utilisateur"/><img id="r-551214" data-claire-element-id="551214" src="medias/uploads.siteduzero.com_files_354001_355000_354900.png" alt="Image utilisateur"/></td><td id="r-551218" data-claire-element-id="551219"><img id="r-551219" data-claire-element-id="551218" src="medias/uploads.siteduzero.com_files_354001_355000_354936.png" alt="Image utilisateur"/><img id="r-551217" data-claire-element-id="551217" src="medias/uploads.siteduzero.com_files_354001_355000_354936.png" alt="Image utilisateur"/></td><td id="r-551221" data-claire-element-id="551222"><img id="r-551222" data-claire-element-id="551221" src="medias/uploads.siteduzero.com_files_354001_355000_354937.png" alt="Image utilisateur"/><img id="r-551220" data-claire-element-id="551220" src="medias/uploads.siteduzero.com_files_354001_355000_354937.png" alt="Image utilisateur"/></td><td id="r-551224" data-claire-element-id="551225"><img id="r-551225" data-claire-element-id="551224" src="medias/uploads.siteduzero.com_files_376001_377000_376276.png" alt="Image utilisateur"/><img id="r-551223" data-claire-element-id="551223" src="medias/uploads.siteduzero.com_files_376001_377000_376276.png" alt="Image utilisateur"/></td></tr><tr id="r-551241" data-claire-element-id="551241"><td id="r-551228" data-claire-element-id="551228"><p id="r-551227" data-claire-element-id="551227">Ubuntu</p></td><td id="r-551230" data-claire-element-id="551231"><img id="r-551231" data-claire-element-id="551230" src="medias/uploads.siteduzero.com_files_354001_355000_354904.png" alt="Image utilisateur"/><img id="r-551229" data-claire-element-id="551229" src="medias/uploads.siteduzero.com_files_354001_355000_354904.png" alt="Image utilisateur"/></td><td id="r-551233" data-claire-element-id="551234"><img id="r-551234" data-claire-element-id="551233" src="medias/uploads.siteduzero.com_files_354001_355000_354905.png" alt="Image utilisateur"/><img id="r-551232" data-claire-element-id="551232" src="medias/uploads.siteduzero.com_files_354001_355000_354905.png" alt="Image utilisateur"/></td><td id="r-551236" data-claire-element-id="551237"><img id="r-551237" data-claire-element-id="551236" src="medias/uploads.siteduzero.com_files_354001_355000_354906.png" alt="Image utilisateur"/><img id="r-551235" data-claire-element-id="551235" src="medias/uploads.siteduzero.com_files_354001_355000_354906.png" alt="Image utilisateur"/></td><td id="r-551239" data-claire-element-id="551240"><img id="r-551240" data-claire-element-id="551239" src="medias/uploads.siteduzero.com_files_376001_377000_376277.png" alt="Image utilisateur"/><img id="r-551238" data-claire-element-id="551238" src="medias/uploads.siteduzero.com_files_376001_377000_376277.png" alt="Image utilisateur"/></td></tr><tr id="r-551256" data-claire-element-id="551256"><td id="r-551243" data-claire-element-id="551243"><p id="r-551242" data-claire-element-id="551242">Kubuntu</p></td><td id="r-551245" data-claire-element-id="551246"><img id="r-551246" data-claire-element-id="551245" src="medias/uploads.siteduzero.com_files_354001_355000_354908.png" alt="Image utilisateur"/><img id="r-551244" data-claire-element-id="551244" src="medias/uploads.siteduzero.com_files_354001_355000_354908.png" alt="Image utilisateur"/></td><td id="r-551248" data-claire-element-id="551249"><img id="r-551249" data-claire-element-id="551248" src="medias/uploads.siteduzero.com_files_354001_355000_354909.png" alt="Image utilisateur"/><img id="r-551247" data-claire-element-id="551247" src="medias/uploads.siteduzero.com_files_354001_355000_354909.png" alt="Image utilisateur"/></td><td id="r-551251" data-claire-element-id="551252"><img id="r-551252" data-claire-element-id="551251" src="medias/uploads.siteduzero.com_files_354001_355000_354911.png" alt="Image utilisateur"/><img id="r-551250" data-claire-element-id="551250" src="medias/uploads.siteduzero.com_files_354001_355000_354911.png" alt="Image utilisateur"/></td><td id="r-551254" data-claire-element-id="551255"><img id="r-551255" data-claire-element-id="551254" src="medias/uploads.siteduzero.com_files_376001_377000_376278.png" alt="Image utilisateur"/><img id="r-551253" data-claire-element-id="551253" src="medias/uploads.siteduzero.com_files_376001_377000_376278.png" alt="Image utilisateur"/></td></tr><tr id="r-551271" data-claire-element-id="551271"><td id="r-551258" data-claire-element-id="551258"><p id="r-551257" data-claire-element-id="551257">System</p></td><td id="r-551260" data-claire-element-id="551261"><img id="r-551261" data-claire-element-id="551260" src="medias/uploads.siteduzero.com_files_354001_355000_354914.png" alt="Image utilisateur"/><img id="r-551259" data-claire-element-id="551259" src="medias/uploads.siteduzero.com_files_354001_355000_354914.png" alt="Image utilisateur"/></td><td id="r-551263" data-claire-element-id="551264"><img id="r-551264" data-claire-element-id="551263" src="medias/uploads.siteduzero.com_files_354001_355000_354915.png" alt="Image utilisateur"/><img id="r-551262" data-claire-element-id="551262" src="medias/uploads.siteduzero.com_files_354001_355000_354915.png" alt="Image utilisateur"/></td><td id="r-551266" data-claire-element-id="551267"><img id="r-551267" data-claire-element-id="551266" src="medias/uploads.siteduzero.com_files_354001_355000_354916.png" alt="Image utilisateur"/><img id="r-551265" data-claire-element-id="551265" src="medias/uploads.siteduzero.com_files_354001_355000_354916.png" alt="Image utilisateur"/></td><td id="r-551269" data-claire-element-id="551270"><img id="r-551270" data-claire-element-id="551269" src="medias/uploads.siteduzero.com_files_376001_377000_376279.png" alt="Image utilisateur"/><img id="r-551268" data-claire-element-id="551268" src="medias/uploads.siteduzero.com_files_376001_377000_376279.png" alt="Image utilisateur"/></td></tr></tbody></table><h3 id="r-utilisons-les-ressources" data-claire-element-id="551279">Utilisons les ressources</h3><p id="r-551274" data-claire-element-id="551274">Sachez que le résultat final sera généré sous la forme d'un fichier DLL (<strong>D</strong>ynamic <strong>L</strong>ink <strong>L</strong>ibrary) pour être directement utilisé dans un autre programme. Seulement, pour notre case à cocher, on va devoir utiliser des images, et ces images doivent se situer quelque part sur votre disque dur ! On pourrait très bien mettre les images en même temps que le fichier DLL, mais ça peut devenir vite encombrant et lassant s'il faut copier à chaque fois les images ! Heureusement, les ressources sont là pour rectifier le tir. En plus d'être simples à utiliser, elles vont être directement incluses dans notre fichier DLL, on pourra alors distribuer notre fichier librement sans problème de fichiers supplémentaires.<br/> Pour importer des ressources, je vous renvoie au tutoriel officiel de Hankerspace sur l'annexe <a href="http://www.siteduzero.com/tutoriel-3-312649-les-ressources.html">Les ressources</a>. Pour utiliser nos ressources en C#, en revanche, on n'utilisera pas les mêmes classes (et un langage différent entre autres ;) ).</p><p id="r-551275" data-claire-element-id="551275">Toutes les images que je vous ai fournies (mis à part les symboles) ont pour taille 14*14 pixels. Seulement, si vous avez aperçu l'image dans la partie précédente, le symbole est un peu décalé vers la droite : c'est pour donner un style (comme sur Mac par exemple). Notre <strong>PictureBox </strong>devra donc faire plus que 14 pixels en largeur. Je compte une largeur pour les symboles ayant au maximum 17 pixels en largeur, la <em>PictureBox </em>aura donc une taille de 14 pixels en hauteur et 17 pixels en largeurs (facile jusque-là). Je vais l'appeler <em>pb_case</em>.<br/> Pour le <em>Label</em>, c'est très simple, il suffit juste de le placer à droite de la case. Je l’appellerai <em>txt_texte</em>.<br/> C'est tout ce dont nous avons besoin pour la partie graphique du contrôle. L'intérêt ici, c'est comme dit précédemment de créer un style plus beau que celui proposé par le framework .NET.<br/> Voici ce que j'obtiens avec le designer Visual Studio :</p><figure id="r-551277" data-claire-element-id="551278"><img id="r-551276" data-claire-element-id="551276" src="medias/uploads.siteduzero.com_files_376001_377000_376283.png" alt="Image utilisateur"/></figure><h2 id="r-la-partie-code" data-claire-element-id="551373">La partie code</h2><p id="r-551281" data-claire-element-id="551281">Enfin nous allons coder ! Et pas qu'un peu. Dans la partie design, appuyez sur <strong>F7</strong> pour dévoiler le code. Je vous conseille, dans chaque code, de mettre une entête qui définit l'auteur, l'utilisation de cette classe, la date de création, etc... permettant d'obtenir plus d'informations sur la classe qu'on lit, et c'est toujours bon de savoir quand elle a été créée. Si vous regardez, on remarque que notre classe hérite de <strong>UserControl</strong> :</p><pre id="r-551282" data-claire-element-id="551282"><code data-claire-semantic="csharp">public partial class zCheckBox : UserControl</code></pre><p id="r-551283" data-claire-element-id="551283">En effet, il faut préciser que notre classe est un contrôle utilisateur, pour qu'elle hérite de ses fonctions, ses événements, mais surtout que notre classe soit utilisable en tant que contrôle.</p><aside id="r-551285" data-claire-element-id="551285" data-claire-semantic="information"><p id="r-551284" data-claire-element-id="551284">Pensez à utiliser le mot-clé <code data-claire-semantic="csharp">#region</code> pour organiser votre code !</p></aside><p id="r-551286" data-claire-element-id="551286">Ce mot-clé magique permet de faire des blocs de code, autrement dit des régions pouvant être diminuées ou rétablies par le biais de petits carrés sur votre gauche. Je les utilise souvent pour rendre le code plus clair, et lorsque l'on veut rechercher par exemple une propriété, on sait déjà dans quelle partie la rechercher. Personnellement, j'ai horreur (pour des fichiers finaux) d'avoir des variables vers la fin, vers le milieu, un peu partout. Plus un code est organisé, plus il est compréhensible.</p><pre id="r-551287" data-claire-element-id="551287"><code data-claire-semantic="csharp">#region Déclaration des variables

// Toutes les variables ici et pas ailleurs

#endregion</code></pre><p id="r-551288" data-claire-element-id="551288">J'ai mis 7 <code data-claire-semantic="csharp">#region</code> dans mon code, quelques-unes peuvent être supprimées, mais je fais ça pour avoir une lisibilité optimale (attention tout de même à ne pas en mettre une cinquantaine).</p><p id="r-551289" data-claire-element-id="551289">Commençons par définir les styles. Nous devrons donc créer une énumération publique que je vais nommer <em>CheckBoxStyle</em> pour définir les différents styles disponibles :</p><pre id="r-551290" data-claire-element-id="551290"><code data-claire-semantic="csharp">public enum CheckBoxStyle
{
    Basic,
    Lighted,
    Ubuntu,
    Kubuntu,
    System
};</code></pre><p id="r-551291" data-claire-element-id="551291">À présent, nous allons créer les variables de notre case à cocher.</p><aside id="r-551293" data-claire-element-id="551293" data-claire-semantic="warning"><p id="r-551292" data-claire-element-id="551292">Vous remarquerez que je n'hérite pas mon <em>zCheckBox </em>d'une <strong>CheckBox </strong>du framework .NET, car je préfère avoir mes propres propriétés et fonctions. La seconde raison vient aussi du fait que l'héritage multiple, présent en C++, n'est pas supporté en C#. Le moyen permettant de <em>contourner </em>cette limitation serait de créer et d'implémenter des interfaces, mais ne compliquons pas le tutoriel.</p></aside><p id="r-551294" data-claire-element-id="551294">Et comme nous n'héritons pas notre <em>zCheckBox</em>, il faut donc créer toutes les variables d'une case à cocher basique :</p><pre id="r-551295" data-claire-element-id="551295"><code data-claire-semantic="csharp">private bool _isChecked = false, _activeClick = true; // Le premier, l'état du zCheckBox, le second sera utilisé pour les événements
private CheckBoxStyle _style; // Le style de la case à cocher
private Image _currentBg, _currentHover, _currentClick, _currentTrue; // Les images selon le style défini
private string _text = &quot;Texte&quot;; // Le texte de la case à cocher</code></pre><p id="r-551296" data-claire-element-id="551296">Pour les propriétés en revanche, je ne vais pas toutes vous les étaler, car le principe est très simple : un <strong>getter</strong>, un <strong>setter</strong>, nous avons notre propriété. Voici, par exemple, la propriété <strong>Checked</strong> :</p><pre id="r-551297" data-claire-element-id="551297"><code data-claire-semantic="csharp">/// &lt;summary&gt;
/// Obtient ou définit la valeur booléenne de la case à cocher
/// &lt;/summary&gt;
public bool Checked
{
    get { return _isChecked; }
    set { _isChecked = value; }
}</code></pre><aside id="r-551299" data-claire-element-id="551299" data-claire-semantic="information"><p id="r-551298" data-claire-element-id="551298">Ici, j'ai créé une propriété pour une variable, mais on pourrait très bien créer seulement la propriété. Ainsi, la variable _<em>isChecked </em>pourrait être supprimée, mais cette variable nous sera utile dans la suite du tutoriel.</p></aside><p id="r-551300" data-claire-element-id="551300">Créez deux/trois propriétés supplémentaires telles que <strong>Text </strong>(pour le texte) ou <strong>Style </strong>(pour le style).</p><h3 id="r-les-methodes-24" data-claire-element-id="551350">Les méthodes</h3><p id="r-551301" data-claire-element-id="551301">Dans notre classe, toutes les méthodes seront privées afin de ne pas embrouiller le futur développeur et qu'il fasse une confusion avec une quelconque propriété.<br/> Nous avons donc un total de 5 méthodes :</p><table id="r-551346" data-claire-element-id="551346"><thead id="r-551309" data-claire-element-id="551309"><tr id="r-551308" data-claire-element-id="551308"><th id="r-551303" data-claire-element-id="551303"><p id="r-551302" data-claire-element-id="551302">Nom</p></th><th id="r-551305" data-claire-element-id="551305"><p id="r-551304" data-claire-element-id="551304">Arguments</p></th><th id="r-551307" data-claire-element-id="551307"><p id="r-551306" data-claire-element-id="551306">Fonction</p></th></tr></thead><tbody id="r-551345" data-claire-element-id="551345"><tr id="r-551316" data-claire-element-id="551316"><td id="r-551311" data-claire-element-id="551311"><p id="r-551310" data-claire-element-id="551310">SetCheckState</p></td><td id="r-551313" data-claire-element-id="551313"><p id="r-551312" data-claire-element-id="551312"><code data-claire-semantic="csharp">bool state</code></p></td><td id="r-551315" data-claire-element-id="551315"><p id="r-551314" data-claire-element-id="551314">Modifie l'état booléen de la case à cocher</p></td></tr><tr id="r-551323" data-claire-element-id="551323"><td id="r-551318" data-claire-element-id="551318"><p id="r-551317" data-claire-element-id="551317">SetText</p></td><td id="r-551320" data-claire-element-id="551320"><p id="r-551319" data-claire-element-id="551319"><code data-claire-semantic="csharp">string texte</code></p></td><td id="r-551322" data-claire-element-id="551322"><p id="r-551321" data-claire-element-id="551321">Modifie le texte de la case à cocher</p></td></tr><tr id="r-551330" data-claire-element-id="551330"><td id="r-551325" data-claire-element-id="551325"><p id="r-551324" data-claire-element-id="551324">ShowTruePicture</p></td><td id="r-551327" data-claire-element-id="551327"><p id="r-551326" data-claire-element-id="551326">Aucun</p></td><td id="r-551329" data-claire-element-id="551329"><p id="r-551328" data-claire-element-id="551328">Affiche l'image &quot;Vrai&quot;</p></td></tr><tr id="r-551337" data-claire-element-id="551337"><td id="r-551332" data-claire-element-id="551332"><p id="r-551331" data-claire-element-id="551331">HideTruePicture</p></td><td id="r-551334" data-claire-element-id="551334"><p id="r-551333" data-claire-element-id="551333">Aucun</p></td><td id="r-551336" data-claire-element-id="551336"><p id="r-551335" data-claire-element-id="551335">Cache l'image &quot;Vrai&quot;</p></td></tr><tr id="r-551344" data-claire-element-id="551344"><td id="r-551339" data-claire-element-id="551339"><p id="r-551338" data-claire-element-id="551338">ChangeStyle</p></td><td id="r-551341" data-claire-element-id="551341"><p id="r-551340" data-claire-element-id="551340"><code data-claire-semantic="csharp">CheckBoxStyle styleToChange</code></p></td><td id="r-551343" data-claire-element-id="551343"><p id="r-551342" data-claire-element-id="551342">Change le style graphique de la case à cocher</p></td></tr></tbody></table><p id="r-551347" data-claire-element-id="551347">Mais puisque l'on crée une méthode spécifique pour une propriété, il va falloir changer le <strong>setter </strong>des trois propriétés. Du coup, le setter de la propriété Checked devient :</p><pre id="r-551348" data-claire-element-id="551348"><code data-claire-semantic="csharp">set { SetCheckState(value); }</code></pre><p id="r-551349" data-claire-element-id="551349">Faites de même pour les propriétés CheckBoxText (<code data-claire-semantic="csharp">SetText(value)</code>) et CheckBoxStyle (<code data-claire-semantic="csharp">ChangeStyle(value)</code>).</p><h3 id="r-methode-setcheckstate" data-claire-element-id="551354">Méthode SetCheckState</h3><p id="r-551351" data-claire-element-id="551351">Son fonctionne est assez simple à comprendre : elle permet de modifier l'état logique de la case à cocher, à savoir <em>true </em>ou <em>false</em> :</p><pre id="r-551352" data-claire-element-id="551352"><code data-claire-semantic="csharp">private void SetCheckState(bool state)
{
    if (state) // Si l'état cible a pour value true
    {
        _isChecked = true;
        ShowTruePicture(); // On affiche le symbole vrai
    }
    else
    {
        _isChecked = false;
        HideTruePicture(); // On masque le symbole vrai
    }
}</code></pre><p id="r-551353" data-claire-element-id="551353">Dans cette méthode, l'argument <em>state</em>, l'état cible, est la nouvelle valeur que prendre la case à cocher.</p><h3 id="r-methode-settext" data-claire-element-id="551357">Méthode SetText</h3><p id="r-551355" data-claire-element-id="551355">Tout comme la méthode ci-dessous, celle-ci permet quant à elle de modifier le texte de la case à cocher :</p><pre id="r-551356" data-claire-element-id="551356"><code data-claire-semantic="csharp">_text = texte; // On modifie la valeur de la variable membre
txt_texte.Text = _text; // On modifie le texte du Label</code></pre><h3 id="r-methode-showtruepicture" data-claire-element-id="551360">Méthode ShowTruePicture</h3><p id="r-551358" data-claire-element-id="551358">C'est l'une des méthodes les plus importantes, car c'est celle qui nous permettra de visualiser l'état de la case à cocher par l'intermédiaire d'images :</p><pre id="r-551359" data-claire-element-id="551359"><code data-claire-semantic="csharp">private void ShowTruePicture()
{
    pb_case.Image = _currentTrue; // On met à jour la nouvelle image
}</code></pre><h3 id="r-methode-hidetruepicture" data-claire-element-id="551367">Méthode HideTruePicture</h3><p id="r-551361" data-claire-element-id="551361">Cette méthode permet à l'inverse d'effacer le symbole &quot;Vrai&quot; :</p><pre id="r-551362" data-claire-element-id="551362"><code data-claire-semantic="csharp">private void HideTruePicture()
{
    pb_case.Image = null; // Aucune valeur n'est affectée à l'image de pb_case
}</code></pre><p id="r-551363" data-claire-element-id="551363">En affectant la valeur <code data-claire-semantic="csharp">null</code> à mon <em>pb_case</em>, aucune image ne sera dessinée sur la <strong>PictureBox</strong>.</p><div id="r-551365" data-claire-element-id="551365" data-claire-semantic="question"><p id="r-551364" data-claire-element-id="551364">Mais dans ce cas, notre image de fond sera effacée ?</p></div><p id="r-551366" data-claire-element-id="551366">Non justement, et c'est ça l'avantage d'une <strong>PictureBox</strong>. Il y a deux propriétés concernant le dessin d'image dans ce contrôle : <em>Image </em>et <em>BackgroundImage</em>. Ainsi, j'utilise la seconde propriété pour dessiner le fond de ma case à cocher, ce qui fait que ma propriété <em>BackgroundImage </em>n'est pas modifiée si j'affecte la valeur <code data-claire-semantic="csharp">null</code> à ma propriété <em>Image</em>.</p><h3 id="r-methode-changestyle" data-claire-element-id="551372">Méthode ChangeStyle</h3><p id="r-551368" data-claire-element-id="551368">Celle-ci va nous permettre de modifier à tout moment le style de notre case à cocher. J'utilise donc un <code data-claire-semantic="csharp">switch</code> qui me permet de modifier les variables qui seront utilisées pour dessiner la case à cocher :</p><pre id="r-551369" data-claire-element-id="551369"><code data-claire-semantic="csharp">private void ChangeStyle(CheckBoxStyle styleToChange)
{
    switch (_styleToChange) // Selon le style à changer
    {
        case CheckBoxStyle.Basic: // Cas du CheckBoxStyle.Basic, du ...
            _currentBg = Resources.checkbox_basic; // État NoEvent
            _currentClick = Resources.checkbox_click; // État OnClick
            _currentHover = Resources.checkbox_hover; // État OnHover
            _currentTrue = Resources.checkbox_true;
            break;
        case CheckBoxStyle.Lighted:
            _currentBg = Resources.checkbox_2_basic;
            _currentClick = Resources.checkbox_2_click;
            _currentHover = Resources.checkbox_2_hover;
            _currentTrue = Resources.checkbox_2_true;
            break;
        case CheckBoxStyle.Ubuntu:
            _currentBg = Resources.checkbox_3_basic;
            _currentClick = Resources.checkbox_3_click;
            _currentHover = Resources.checkbox_3_hover;
            _currentTrue = Resources.checkbox_3_true;
            break;
        case CheckBoxStyle.Kubuntu:
            _currentBg = Resources.checkbox_4_basic;
            _currentClick = Resources.checkbox_4_click;
            _currentHover = Resources.checkbox_4_hover;
            _currentTrue = Resources.checkbox_4_true;
            break;
        case CheckBoxStyle.System:
            _currentBg = Resources.checkbox_5_basic;
            _currentClick = Resources.checkbox_5_click;
            _currentHover = Resources.checkbox_5_hover;
            _currentTrue = Resources.checkbox_5_true;
            break;
    }
    style = styleToChange; // On met à jour le style de la case à cocher
    pb_case.BackgroundImage = _currentBg; // On affiche le nouveau style à l'écran
}</code></pre><aside id="r-551371" data-claire-element-id="551371" data-claire-semantic="information"><p id="r-551370" data-claire-element-id="551370">Pour connaître le contenu de toutes les méthodes, je vous invite à télécharger le code source dans le lien situé vers la fin du tutoriel.</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms">Développer son propre contrôle utilisateur WinForms</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/preambule-9">
Préambule
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/creation-du-controle">
Création du contrôle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/evenements-7">
Événements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/fonctionnalites-supplementaires-1">
Fonctionnalités supplémentaires
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/preambule-9">
<span class="arrow"></span>
<span class="next">Préambule</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/evenements-7">
<span class="next">Événements</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="vnements"></a><h2>Événements</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/creation-du-controle">
<span class="arrow"></span>
<span class="next">Création du contrôle</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/fonctionnalites-supplementaires-1">
<span class="next">Fonctionnalités supplémentaires</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-551375" data-claire-element-id="551375">Le code concernant la case à cocher est maintenant terminé. Nous allons dès maintenant nous préoccuper des événements privés et publics. Comme d'habitude, je vous fais un petit tableau récapitulatif du <a href="http://msdn.microsoft.com/fr-fr/library/aa984105(v=vs.71).aspx">gestionnaire d'événement</a>.</p><div id="r-551377" data-claire-element-id="551377" data-claire-semantic="question"><p id="r-551376" data-claire-element-id="551376">Quelle est la différence entre un événement et un gestionnaire d'événement ?</p></div><p id="r-551378" data-claire-element-id="551378">Un événement est une action produite par l'utilisateur ou par un programme afin de déclencher un traitement. Ainsi, tous les événements sont réalisés, quoiqu'il arrive (par exemple, un clic souris est un événement).<br/> Mais si vous souhaitez réaliser un traitement suite à un événement, vous devez associer une méthode (ou fonction) à votre événement, et cette méthode est nommée gestionnaire d'événement.</p><table id="r-551406" data-claire-element-id="551406"><thead id="r-551384" data-claire-element-id="551384"><tr id="r-551383" data-claire-element-id="551383"><th id="r-551380" data-claire-element-id="551380"><p id="r-551379" data-claire-element-id="551379">Gestionnaire d'événement</p></th><th id="r-551382" data-claire-element-id="551382"><p id="r-551381" data-claire-element-id="551381">Événement</p></th></tr></thead><tbody id="r-551405" data-claire-element-id="551405"><tr id="r-551389" data-claire-element-id="551389"><td id="r-551386" data-claire-element-id="551386"><p id="r-551385" data-claire-element-id="551385">zCheckBox_MouseEnter</p></td><td id="r-551388" data-claire-element-id="551388"><p id="r-551387" data-claire-element-id="551387">Souris sur le composant</p></td></tr><tr id="r-551394" data-claire-element-id="551394"><td id="r-551391" data-claire-element-id="551391"><p id="r-551390" data-claire-element-id="551390">zCheckBox_MouseLeave</p></td><td id="r-551393" data-claire-element-id="551393"><p id="r-551392" data-claire-element-id="551392">Souris quitte le composant / hors du composant</p></td></tr><tr id="r-551399" data-claire-element-id="551399"><td id="r-551396" data-claire-element-id="551396"><p id="r-551395" data-claire-element-id="551395">zCheckBox_MouseDown</p></td><td id="r-551398" data-claire-element-id="551398"><p id="r-551397" data-claire-element-id="551397">Clic souris sur le composant</p></td></tr><tr id="r-551404" data-claire-element-id="551404"><td id="r-551401" data-claire-element-id="551401"><p id="r-551400" data-claire-element-id="551400">zCheckBox_MouseUp</p></td><td id="r-551403" data-claire-element-id="551403"><p id="r-551402" data-claire-element-id="551402">Relâchement clic souris n'importe où</p></td></tr></tbody></table><p id="r-551407" data-claire-element-id="551407">Associez ces quatre gestionnaires d'événements dans la partie <strong>Designer</strong> de votre <em>zCheckBox</em>. Le problème, c'est que ce code n'est pas tout à fait adapté à notre situation.<br/> En effet, les gestionnaires d'événements sont liés à notre <em>zCheckBox</em>, donc il s'agit seulement du fond du composant. Et la <em>PictureBox </em>et le <em>Label </em>n'ont aucun gestionnaire d'événement qui leur est associé. Prenez l'image suivante :</p><figure id="r-551409" data-claire-element-id="551410"><img id="r-551408" data-claire-element-id="551408" src="medias/uploads.siteduzero.com_files_355001_356000_355025.png" alt="Image utilisateur"/></figure><p id="r-551411" data-claire-element-id="551411">Chacun des composants est représenté par une couleur.</p><ul id="r-551418" data-claire-element-id="551418"><li id="r-551413" data-claire-element-id="551413"><p id="r-551412" data-claire-element-id="551412">Gris : Il s'agit du <em>zCheckbox</em>. Ce composant possède à la fois du code, mais aussi des gestionnaires aux événements associés.</p></li><li id="r-551415" data-claire-element-id="551415"><p id="r-551414" data-claire-element-id="551414">Bleu : C'est la <strong>PictureBox </strong>. Il n'y a que du code, mais aucun gestionnaire d'événement associé.</p></li><li id="r-551417" data-claire-element-id="551417"><p id="r-551416" data-claire-element-id="551416">Orange : C'est le <strong>Label</strong>. De même, que du code, mais aucun gestionnaire d'événement associé.</p></li></ul><p id="r-551419" data-claire-element-id="551419">Cela signifie que par exemple, lorsque la souris sera au-dessus du <strong>PictureBox</strong>, aucun gestionnaire d'événement n'est associé au contrôle, et donc aucune instruction ne sera exécutée. Il faut donc que tous les gestionnaires aux événements pour chaque contrôle soient les mêmes, et cela va se faire dans l'initialisation du contrôle :</p><pre id="r-551420" data-claire-element-id="551420"><code data-claire-semantic="csharp">foreach (Control _control in this.Controls)
{
    control.MouseEnter += new EventHandler(zCheckBox_MouseEnter);
    control.MouseLeave += new EventHandler(zCheckBox_MouseLeave);
    control.MouseDown += new MouseEventHandler(zCheckBox_MouseDown);
    control.MouseUp += new MouseEventHandler(zCheckBox_MouseUp);
    // J'abonne les mêmes gestionnaires aux événements de chaque contrôle de mon zCheckBox, de manière à tous les capter
}</code></pre><p id="r-551421" data-claire-element-id="551421">On utilise une boucle <code data-claire-semantic="csharp">foreach</code>, et donc ici, chaque contrôle contenu dans notre classe (ici la <strong>PictureBox </strong>et le <strong>Label</strong>) hérite des quatre événements spécifiés de celui-ci. Les événements seront les mêmes que ce soit pour n'importe quel contrôle dans notre <em>zCheckBox</em>.</p><h3 id="r-creons-nos-propres-evenements" data-claire-element-id="551456">Créons nos propres événements</h3><p id="r-551422" data-claire-element-id="551422">Dans tous les contrôles, il y a forcément des événements, mais il arrive parfois que l'on veuille créer ses propres événements. L'exemple sera de créer l’événement <em>CheckedChanged</em>, qui interviendra lorsque la valeur de la case à cocher (vrai ou faux) change.<br/> Nous allons utiliser un <a href="http://msdn.microsoft.com/fr-fr/library/ms173171(v=vs.80).aspx">délégué</a> existant pour créer notre événement dans le cas où l'état booléen de la case à cocher changerait, <em>le delegate EventHandler</em> :</p><pre id="r-551423" data-claire-element-id="551423"><code data-claire-semantic="csharp">public delegate void EventHandler(Object sender, EventArgs e)</code></pre><p id="r-551424" data-claire-element-id="551424">Bien sûr, il ne faut pas insérer cette ligne de code dans le fichier, puisque le délégué existe déjà.<br/> Notre délégué étant connu, nous pouvant créer l'événement à l'aide du mot clé <code data-claire-semantic="csharp">event</code> :</p><pre id="r-551425" data-claire-element-id="551425"><code data-claire-semantic="csharp">public event EventHandler CheckedChanged;</code></pre><p id="r-551426" data-claire-element-id="551426">Enfin, il faut créer la fonction permettant de faire appel à notre événement :</p><pre id="r-551427" data-claire-element-id="551427"><code data-claire-semantic="csharp">public void OnCheckedChanged(EventArgs args)
{
    if (CheckedChanged != null)
    {
        CheckedChanged(this, args);
    }
}</code></pre><p id="r-551428" data-claire-element-id="551428">Même si notre événement est maintenant prêt, il faut tout de même savoir quand l'appeler. L'état booléen de la case à cocher change lorsque le bouton de la souris est relâché. Il faut tout simplement appeler l'événement à la fin de la fonction MouseUp :</p><pre id="r-551429" data-claire-element-id="551429"><code data-claire-semantic="csharp">OnCheckedChanged(EventArgs.Empty); // On signale qu'un événement &quot;CheckedChanged&quot; s'est produit avec aucun argument (nous n'avons pas besoin d'utiliser un argument)</code></pre><h2 id="r-les-gestionnaires-d-evenements-2" data-claire-element-id="551455">Les gestionnaires d'événements</h2><p id="r-551430" data-claire-element-id="551430">Afin que l'utilisateur puisse interagir avec la case à cocher, nous devons coder nos gestionnaires d'événements pour savoir quelles actions doivent être exécutées.</p><h3 id="r-lorsque-la-souris-rentre-dans-le-composant" data-claire-element-id="551433">Lorsque la souris rentre dans le composant</h3><p id="r-551431" data-claire-element-id="551431">Le gestionnaire <em>MouseEnter</em> est utile dans notre cas, car il permet à la fois de modifier l'arrière-plan de la PictureBox, mais aussi de modifier une variable qui indique que la souris est entrée dans le composant. Autrement dit, à cet instant, il sera possible d'effectuer un traitement lors du clic souris.</p><pre id="r-551432" data-claire-element-id="551432"><code data-claire-semantic="csharp">private void zCheckBox_MouseEnter(object sender, EventArgs e)
{
    pb_case.BackgroundImage = _currentHover; // État OnHover
    _activeClick = true; // On signale qu'il est possible de cliquer
}</code></pre><h3 id="r-lorsque-la-souris-quitte-le-composant" data-claire-element-id="551436">Lorsque la souris quitte le composant</h3><p id="r-551434" data-claire-element-id="551434">À l'inverse du précédent gestionnaire, celui-ci s'exécute lorsque la souris quitte le composant. Ainsi, l'image d'arrière-plan <em>NoEvent </em>sera remplacée, et on indique qu'on ne peut plus effectuer de traitement si un clic souris se produit.</p><pre id="r-551435" data-claire-element-id="551435"><code data-claire-semantic="csharp">private void zCheckBox_MouseLeave(object sender, EventArgs e)
{
    pb_case.BackgroundImage = _currentBg; // État NoEvent
    _activeClick = false; // On signale qu'il n'est plus possible de cliquer
}</code></pre><h3 id="r-lorsque-l-utilisateur-clique-sur-le-composant" data-claire-element-id="551442">Lorsque l'utilisateur clique sur le composant</h3><p id="r-551437" data-claire-element-id="551437">Dès que l'utilisateur clique sur le composant, on modifie l'image d'arrière-plan mais seulement si l'utilisateur a l'autorisation de cliquer.</p><pre id="r-551438" data-claire-element-id="551438"><code data-claire-semantic="csharp">private void zCheckBox_MouseDown(object sender, MouseEventArgs e)
{
    if (_activeClick) // S'il est possible de cliquer
    {
        pb_case.BackgroundImage = _currentClick; // État OnClick
    }
}</code></pre><div id="r-551440" data-claire-element-id="551440" data-claire-semantic="question"><p id="r-551439" data-claire-element-id="551439">Pourquoi on ne modifie par l'état de la case à cocher maintenant ?</p></div><p id="r-551441" data-claire-element-id="551441">Une <strong>CheckBox</strong> du framework .NET change d'état lors du <strong>relâchement du clic souris</strong>. J'ai, dans le cas de la <em>zCheckBox</em>, respecté cette convention, mais vous pouvez très bien placer votre changement d'état ici.</p><h3 id="r-lorsque-l-utilisateur-relache-le-clic-souris" data-claire-element-id="551454">Lorsque l'utilisateur relâche le clic souris</h3><p id="r-551443" data-claire-element-id="551443">C'est donc dans ce gestionnaire d'événement que nous allons effectuer le changement d'état :</p><pre id="r-551444" data-claire-element-id="551444"><code data-claire-semantic="csharp">private void zCheckBox_MouseUp(object sender, MouseEventArgs e)
{
    pb_case.BackgroundImage = _currentHover; // État OnHover
    SetCheckState(!_isChecked); // L'état prend sa valeur inverse
    OnCheckedChanged(EventArgs.Empty); // On signale qu'un événement &quot;CheckedChanged&quot; s'est produit avec aucun argument (nous n'avons pas besoin d'utiliser un argument)
}</code></pre><p id="r-551445" data-claire-element-id="551445">Comme dans les précédents gestionnaires, l'arrière-plan sera modifié, et on signale la production de l'événement <em>CheckedChanged</em>.<br/> La seconde ligne est très pratique pour alléger le code. Pour que l'état de la case à cocher change, nous devons lui donner sa valeur inverse : c'est-à-dire que si la case à cocher avait pour valeur <em>False</em>, elle passerait à <em>True </em>et réciproquement. Le point d'exclamation (!) signifie <strong>NON</strong>, comme celle que l'on utilise dans les tests de condition, sauf qu'ici elle s'applique sur un argument. Le code suivant permet de réaliser la même chose :</p><pre id="r-551446" data-claire-element-id="551446"><code data-claire-semantic="csharp">if (_isChecked) // Si la case était à l'état &quot;Vrai&quot;
{
    SetCheckState(false); // On met à l'état &quot;Faux&quot;
}
else 
{
    SetCheckState(true); // On met à l'état &quot;Vrai&quot;
}</code></pre><p id="r-551447" data-claire-element-id="551447">Il serait donc préférable de choisir la première solution, puisque l'on économise quelques lignes de code.</p><p id="r-551448" data-claire-element-id="551448">Notre <em>zCheckBox </em>est maintenant finie. Seulement, vous ne pouvez toujours pas en profiter. Nous allons donc ajouter notre <em>zCheckBox </em>à notre boite à outils. Commencez par générer la solution à l'aide de la touche <strong>F6</strong>. Ensuite, ouvrez une nouvelle instance de Visual Studio C#, et créez cette fois-ci un projet <strong>Windows Forms</strong> quelconque.<br/> Dans votre boite à outils, vous pouvez apercevoir plusieurs onglets. Créons notre onglet spécifique à notre <em>zCheckBox</em>. Faites clic droit, puis cliquez sur <strong>Ajouter un onglet</strong>. Nommez le comme bon vous semble, puis, refaites clic droit et cliquez sur <strong>Choisir les éléments</strong>.<br/> Et là, c'est le drame ! Si vous avez un ordinateur un peu lent, ne pensez pas que Visual Studio C# a planté. Non, c'est juste qu'il y a vraiment beaucoup d'éléments à afficher, et que donc VC# freeze (ne réponds pas). Mais ne vous inquiétez pas, pour un ordinateur normalement constitué, cela ne dure pas plus d'une minute.</p><p id="r-551449" data-claire-element-id="551449">Une fois la fenêtre ouverte, cliquez sur le bouton Parcourir, et dirigez-vous dans le dossier <strong>Release </strong>de votre projet pour y trouver le fameux fichier DLL. Dès que vous l'avez, cliquez sur OK. <em>zCheckBox</em> apparaît alors dans l'onglet que vous avez créé, et vous pouvez l'utiliser normalement comme s'il s'agissait d'un contrôle quelconque. Et voilà un résultat concluant tous nos efforts :</p><figure id="r-551451" data-claire-element-id="551452"><img id="r-551450" data-claire-element-id="551450" src="medias/uploads.siteduzero.com_files_355001_356000_355117.png" alt="Image utilisateur"/></figure><p id="r-551453" data-claire-element-id="551453">Tout notre code reposant sur le principe d'une case à cocher est terminé. Nous allons voir ensemble quelques fonctionnalités supplémentaires pouvant être utiles.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms">Développer son propre contrôle utilisateur WinForms</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/preambule-9">
Préambule
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/creation-du-controle">
Création du contrôle
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/evenements-7">
Événements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/fonctionnalites-supplementaires-1">
Fonctionnalités supplémentaires
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/creation-du-controle">
<span class="arrow"></span>
<span class="next">Création du contrôle</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/fonctionnalites-supplementaires-1">
<span class="next">Fonctionnalités supplémentaires</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Fonctionnalitssupplmentaires"></a><h2>Fonctionnalités supplémentaires</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/evenements-7">
<span class="arrow"></span>
<span class="next">Événements</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-les-descriptions-et-categories" data-claire-element-id="551473">Les Descriptions et Catégories</h2><p id="r-551458" data-claire-element-id="551458">Vous avez remarqué qu'une fois notre contrôle fini, le futur utilisateur ne saura pas à quoi servent les propriétés que nous avons créées (Style par exemple). Nous allons décrire ces propriétés grâce à des <a href="http://msdn.microsoft.com/fr-fr/library/z0w1kczw(v=vs.80).aspx">attributs </a>dans notre classe zCheckBox.<br/> Dans un premier temps, nous allons donner une description à la propriété <em>Style</em> par l'intermédiaire de l'attribut <strong>Description</strong>. Dans notre exemple, le code à rajouter est le suivant :</p><pre id="r-551459" data-claire-element-id="551459"><code data-claire-semantic="csharp">[Description(&quot;Change le style de la case à cocher.&quot;)] // Ajouter cette ligne au-dessus de la propriété Style</code></pre><p id="r-551460" data-claire-element-id="551460">Vous remarquerez alors que dans la fenêtre des propriétés, la description s'affiche en bas lorsque vous avez sélectionné la propriété Style. Toujours dans la fenêtre des propriétés, vous avez deux choix d'affichage en haut à gauche :</p><ul id="r-551465" data-claire-element-id="551465"><li id="r-551462" data-claire-element-id="551462"><p id="r-551461" data-claire-element-id="551461">Par catégorie : les propriétés sont classées par catégorie (Texte, Comportement, ...).</p></li><li id="r-551464" data-claire-element-id="551464"><p id="r-551463" data-claire-element-id="551463">Par ordre alphabétique : les propriétés sont classées par ordre alphabétique.</p></li></ul><p id="r-551466" data-claire-element-id="551466">Comme nous n'avons pas assigné de catégories à nos propriétés, celles-ci se retrouvent dans la catégorie par défaut <em>Divers</em>. N'étant pas un grand admirateur du nom de cette catégorie, je propose que nous placions une catégorie appelée <em>zCategory</em> pour toutes nos propriétés. Nous utiliserons l'attribut <strong>Category</strong> (pas très dépaysant :) ) pour définir nos catégories (à noter que les catégories sont créées automatiquement si celles-ci ne sont pas déjà fournies) :</p><pre id="r-551467" data-claire-element-id="551467"><code data-claire-semantic="csharp">[Category(&quot;zCategory&quot;)] // Ajouter cette ligne au-dessus de chaque propriété</code></pre><aside id="r-551469" data-claire-element-id="551469" data-claire-semantic="information"><p id="r-551468" data-claire-element-id="551468">L'ordre des attributs n'a pas d'importance : ils seront tous traités de la même manière. De plus, vous pouvez sauter des lignes entre l'attribut et sa méthode ou propriété associée.</p></aside><p id="r-551470" data-claire-element-id="551470">Il existe aussi l'attribut <strong>Browsable</strong>, qui ressemble beaucoup à Enabled. Cet attribut permet de savoir si la propriété peut-être modifiable dans la fenêtre des propriétés. Dans le cas contraire, la propriété sera invisible. Utile pour les propriétés en lecture seule :</p><pre id="r-551471" data-claire-element-id="551471"><code data-claire-semantic="csharp">[Category(&quot;zCategory&quot;), Description(&quot;Change le style de la case à cocher.&quot;), Browsable(false)]</code></pre><p id="r-551472" data-claire-element-id="551472">Il existe une dernière propriété, <a href="http://msdn.microsoft.com/en-us/library/system.componentmodel.designerserializationvisibilityattribute.aspx">DesignerSerializationVisibility</a>, qui permet d'ajouter des éléments à une collection dans le Designer de Visual Studio.</p><h2 id="r-les-designer-verbs" data-claire-element-id="551517">Les Designer Verbs</h2><p id="r-551474" data-claire-element-id="551474">Les <a href="http://msdn.microsoft.com/en-us/library/xfk1zfw9(v=vs.80).aspx">Designer Verbs</a> sont des sortes de liens de commande qui apparaissent en bas de la fenêtre des propriétés :</p><figure id="r-551476" data-claire-element-id="551477"><img id="r-551475" data-claire-element-id="551475" src="medias/uploads.siteduzero.com_files_355001_356000_355099.png" alt="Image utilisateur"/></figure><p id="r-551478" data-claire-element-id="551478">Quelques fois, ces liens peuvent ne pas être visibles. Pour les afficher, faites clic droit dans la fenêtre des propriétés, puis activez <strong>Commandes </strong>:</p><figure id="r-551480" data-claire-element-id="551481"><img id="r-551479" data-claire-element-id="551479" src="medias/uploads.siteduzero.com_files_355001_356000_355101.png" alt="Image utilisateur"/></figure><p id="r-551482" data-claire-element-id="551482">Mais avant de vous lancer dans la création d'une classe <em>zDesignerVerbs</em> afin de créer vos propres <em>verbs</em>, vous devez avant tout ajouter la référence <em>System.Design</em> à votre projet. Pour ce faire, faites clic droit sur votre projet dans l'explorateur de solutions, puis cliquez sur <em>Ajouter une référence ...</em></p><figure id="r-551484" data-claire-element-id="551485"><img id="r-551483" data-claire-element-id="551483" src="medias/uploads.siteduzero.com_files_355001_356000_355103.png" alt="Image utilisateur"/></figure><p id="r-551486" data-claire-element-id="551486">Enfin, pensez à rajouter les deux lignes suivantes pour pouvoir utiliser les espaces de noms dont nous aurons besoin :</p><pre id="r-551487" data-claire-element-id="551487"><code data-claire-semantic="csharp">using System.Windows.Forms.Design;
using System.ComponentModel.Design;</code></pre><p id="r-551488" data-claire-element-id="551488">Mais là, vous avez deux jolis petits avertissements, dont un qui nous intéresse beaucoup :</p><figure id="r-551490" data-claire-element-id="551491"><img id="r-551489" data-claire-element-id="551489" src="medias/uploads.siteduzero.com_files_355001_356000_355116.png" alt="Image utilisateur"/></figure><p id="r-551492" data-claire-element-id="551492">Pour l'instant, il n'est pas gênant. Mais vous verrez que par la suite, il le sera. Pour corriger ce problème, faites clic droit sur votre projet dans l'explorateur de solution, puis cliquez sur <strong>Propriétés</strong>. Dans l'onglet <strong>Application</strong>, retrouvez l'option <strong>Framework cible</strong>. Normalement cette option vaut <strong>.NET Framework 4.0 Client Profile</strong>. Et bien le voilà notre problème, c'est ce <strong>Client Profile</strong> qui nous gêne. Choisissez celui qui est juste au-dessus, celui sans le <strong>Client Profile</strong> :</p><figure id="r-551494" data-claire-element-id="551495"><img id="r-551493" data-claire-element-id="551493" src="medias/uploads.siteduzero.com_files_355001_356000_355119.png" alt="Image utilisateur"/></figure><p id="r-551496" data-claire-element-id="551496">Une boite de dialogue vous demandera votre autorisation pour changer le framework cible et redémarrera votre projet. Tout est bon, plus d'avertissements, on peut continuer tranquillement.</p><div id="r-551498" data-claire-element-id="551498" data-claire-semantic="question"><p id="r-551497" data-claire-element-id="551497">Mais alors il sert à quoi le <strong>Client Profile</strong> ?</p></div><p id="r-551499" data-claire-element-id="551499">Il est utilisé pour avoir un déploiement le plus rapide possible. Il utilise donc le minimum d'assemblys pour exécuter notre projet. <code data-claire-semantic="csharp">System.Design</code> ne fait pas partie des ces assemblys pris en charge par le <strong>Client Profile</strong>. Plus d'informations sur le <a href="http://msdn.microsoft.com/fr-fr/library/cc656912(v=vs.90).aspx">Framework .NET Profile Client</a>.</p><p id="r-551500" data-claire-element-id="551500">Comme je l'ai annoncé plus haut, nous allons créer une classe nommée <em>zDesignerVerbs </em>qui héritera de la classe <strong>ControlDesigner</strong>. Nos <strong>Designer Verbs</strong> seront exposés par la propriété <em>Verbs</em> de cette classe sous la forme d'une collection de type <strong>DesignerVerbCollection</strong>, que nous devons remplir avant de renvoyer.</p><pre id="r-551501" data-claire-element-id="551501"><code data-claire-semantic="csharp">public override DesignerVerbCollection Verbs
{
    get
    {
        DesignerVerbCollection verbs = new DesignerVerbCollection(); // On crée une nouvelle collection de Designer Verbs
        verbs.Add(new DesignerVerb(&quot;Visiter le Site du Zéro&quot;, new EventHandler(VisitSdz))); // Add permet d'ajouter un Designer verb à la liste
        return verbs; // On retourne la valeur au getter
    }
}</code></pre><p id="r-551502" data-claire-element-id="551502">Utilisez tout simplement la méthode <em>Add </em>pour ajouter chaque <strong>Designer Verb</strong> à cette collection. Le premier paramètre de la classe <strong>DesignerVerb </strong>est son nom, le second est le gestionnaire d'événement à exécuter lorsque l'utilisateur cliquera dessus. Pensez bien à mettre le mot-clé <code data-claire-semantic="csharp">override</code> devant la propriété, car il s'agit d'une substitution de la propriété virtuelle <strong>Verbs </strong>définie par la classe <strong>ComponentDesigner</strong>. Utilisez l'explorateur d'objets si vous souhaitez en savoir plus. Pour que la compilation fonctionne, nous devons définir ici le gestionnaire d'événement <em>VisitSdz</em>, simple méthode qui nous lancera le Site du Zéro après un clic :</p><pre id="r-551503" data-claire-element-id="551503"><code data-claire-semantic="csharp">private void VisitSdz(object sender, EventArgs e)
{
    Process.Start(&quot;http://siteduzero.com&quot;);
}</code></pre><aside id="r-551505" data-claire-element-id="551505" data-claire-semantic="information"><p id="r-551504" data-claire-element-id="551504">N'oubliez pas d'importer l'espace de nom <code data-claire-semantic="csharp">System.Diagnostics</code> pour pouvoir utiliser la classe <strong>Process </strong>!</p></aside><p id="r-551506" data-claire-element-id="551506">La dernière action nécessaire pour faire apparaître nos <strong>Designer Verbs</strong> dans l'éditeur est de décorer notre classe <em>zCheckBox</em> avec l'attribut <em>Designer</em> en faisant référence à notre nouvelle classe :</p><pre id="r-551507" data-claire-element-id="551507"><code data-claire-semantic="csharp">[Designer(typeof(zDesignerVerbs))]
public partial class zCheckBox : UserControl
{
    ...
}</code></pre><p id="r-551508" data-claire-element-id="551508">Comme pour tout à l'heure, lancez votre <em>zCheckBox </em>dans une <strong>Windows Forms</strong> pour admirer le résultat.<br/> Mais vous n'êtes pas encore au bout de vos peines. Car effectivement, lors de la compilation pour lancer votre projet <strong>Windows Forms</strong>, vous avez plusieurs erreurs correspondantes à votre <em>zCheckBox </em>et un avertissement assez bizarre qui plombe l'ambiance :</p><figure id="r-551510" data-claire-element-id="551511"><img id="r-551509" data-claire-element-id="551509" src="medias/uploads.siteduzero.com_files_355001_356000_355116.png" alt="Image utilisateur"/></figure><div id="r-551513" data-claire-element-id="551513" data-claire-semantic="question"><p id="r-551512" data-claire-element-id="551512">Encore la même erreur ! Il m'est dit que le problème vient de System.Design, alors on le supprime ?</p></div><aside id="r-551515" data-claire-element-id="551515" data-claire-semantic="information"><p id="r-551514" data-claire-element-id="551514">Non ! Puisque votre DLL est ciblé pour un <strong>.NET Framework 4.0</strong>, il faut que votre projet <strong>Windows Forms</strong> (et dans les autres projets) soit lui aussi ciblé sur le <strong>.NET Framework 4.0</strong>, car actuellement, il est ciblé sur le <strong>.NET Framework 4.0 Client Profile</strong> !</p></aside><p id="r-551516" data-claire-element-id="551516">Vous pouvez à présent admirer vos beaux <strong>Designer Verbs</strong> et proposer des actions bien plus complexes que celle-ci.</p><h2 id="r-les-smarttags" data-claire-element-id="551549">Les SmartTags</h2><p id="r-551518" data-claire-element-id="551518">Les <a href="http://msdn.microsoft.com/fr-fr/library/ms171829.aspx">SmartTags</a> (<em>Balises Actives</em> en Français) sont des petits menus qui apparaissent en haut à droite de votre contrôle lorsque vous cliquez sur une petite flèche pour l'ouvrir :</p><figure id="r-551520" data-claire-element-id="551521"><img id="r-551519" data-claire-element-id="551519" src="medias/uploads.siteduzero.com_files_355001_356000_355295.png" alt="Image utilisateur"/></figure><p id="r-551522" data-claire-element-id="551522">Avouez, ça donne envie.</p><p id="r-551523" data-claire-element-id="551523">Inutile ici de créer une nouvelle classe : en effet, pour le <strong>SmartTag</strong>, il faut utiliser une classe dérivée de <strong>DesignerActionList</strong>, tout comme nous l'avons fait avec <strong>ControlDesigner</strong> pour les <strong>DesignerVerbs</strong>. On peut donc par exemple renommer la classe <em>zDesignerVerbs</em> en <em>zCheckBoxControlDesigner</em>. Ainsi, nous utiliserons à la fois les <strong>DesignerVerbs</strong> et le <strong>SmartTag</strong> dans la même classe.<br/> Pour définir le contenu du <em>SmartTag</em> nous allons devoir implémenter une nouvelle classe dérivée de <em>DesignerActionList</em> :</p><pre id="r-551524" data-claire-element-id="551524"><code data-claire-semantic="csharp">public class zSmartTagElements : DesignerActionList</code></pre><p id="r-551525" data-claire-element-id="551525">Son constructeur nécessite par ailleurs un paramètre de type <strong>IComponent</strong>, à transmettre au constructeur parent :</p><pre id="r-551526" data-claire-element-id="551526"><code data-claire-semantic="csharp">public zSmartTagElements(IComponent component) : base(component) { }</code></pre><p id="r-551527" data-claire-element-id="551527">Cette classe joue globalement le rôle de passerelle entre le SmartTag et le contrôle zCheckBox. Elle permet de prendre correctement en charge les fonctionnalités &quot;Annuler&quot; (<em>undo</em>) et &quot;Rétablir&quot; (<em>redo</em>) par exemple.</p><p id="r-551528" data-claire-element-id="551528">Avant de commencer à définir nos éléments qui seront affichés dans notre <strong>SmartTag</strong>, nous allons tout d'abord le crée par l'intermédiaire de la propriété <em>ActionsList</em> :</p><pre id="r-551529" data-claire-element-id="551529"><code data-claire-semantic="csharp">public override DesignerActionListCollection ActionLists
{
    get
    {
        DesignerActionListCollection list = new DesignerActionListCollection(); // On créer une nouvelle collection pour nos actions
        zSmartTagElements designList = new zSmartTagElements(this.Control); // On récupère toutes les propriétés
        list.Add(designList); // On ajoute toutes nos propriétés par l'intermédiaire de designList

        return list;
    }
}</code></pre><p id="r-551530" data-claire-element-id="551530">Cette propriété nous permet ainsi d'afficher les éléments du <strong>SmartTag</strong> tout comme nous le faisions avec les <strong>Designer Verbs</strong>.</p><p id="r-551531" data-claire-element-id="551531">Pour chaque propriété de notre zCheckBox que l'on veut pouvoir définir via le SmartTag, il faut donc créer une propriété équivalente dans notre nouvelle classe <strong>zSmartTagElements</strong>. Ces propriétés sont à implémenter d'une manière un peu particulière : il faudra ici utiliser un casting pour le getter et la réflexion (un <em>TypeDescriptor</em> en particulier) pour le setter. Concrètement, ça ressemble à ça :</p><pre id="r-551532" data-claire-element-id="551532"><code data-claire-semantic="csharp">public bool Checked
{
    get { return ((zCheckBox)this.Component).Checked; } // On obtient la valeur de la propriété Checked de la zCheckBox par casting
    set
    {
        PropertyDescriptor prop = TypeDescriptor.GetProperties(this.Component)[&quot;Checked&quot;]; // On utilise la reflection pour accéder à la propriété Checked de la zCheckBox.
        prop.SetValue(this.Component, value); // On définit la valeur de propriété Checked
    }
}</code></pre><p id="r-551533" data-claire-element-id="551533">Faites de même avec les autres propriétés que vous souhaitez inclure dans votre <strong>SmartTag</strong>.</p><p id="r-551534" data-claire-element-id="551534">Il nous reste une chose à faire dans cette classe <em>zSmartTagElements</em> : nous devons substituer sa méthode <em>GetSortedActionItems()</em> afin de lui faire renvoyer la liste des éléments actionnables que l'on souhaite faire apparaître dans le SmartTag.</p><pre id="r-551535" data-claire-element-id="551535"><code data-claire-semantic="csharp">public override DesignerActionItemCollection GetSortedActionItems()
{
    DesignerActionItemCollection items = new DesignerActionItemCollection(); // On crée une collection d'items pour notre SmartTag

    // Utilisez Add() pour ajouter chaque élément
    items.Add(new DesignerActionHeaderItem(&quot;zOptions&quot;));
    items.Add(new DesignerActionPropertyItem(&quot;Checked&quot;, &quot;État par défaut&quot;));
    items.Add(new DesignerActionPropertyItem(&quot;CheckBoxText&quot;, &quot;Texte de la case à cocher :&quot;));
    items.Add(new DesignerActionPropertyItem(&quot;Style&quot;, &quot;Style de la case à cocher :&quot;));

    return items; // On renvoie cette collection remplie
}</code></pre><p id="r-551536" data-claire-element-id="551536">Vous pouvez ajouter quatre types d'éléments :</p><ul id="r-551545" data-claire-element-id="551545"><li id="r-551538" data-claire-element-id="551538"><p id="r-551537" data-claire-element-id="551537"><strong>DesignerActionPropertyItem </strong>: Affiche ou modifie les propriétés indiquées.</p></li><li id="r-551540" data-claire-element-id="551540"><p id="r-551539" data-claire-element-id="551539"><strong>DesignerActionHeaderItem </strong>: Crée un groupe de propriétés.</p></li><li id="r-551542" data-claire-element-id="551542"><p id="r-551541" data-claire-element-id="551541"><strong>DesignerActionTextItem </strong>: Affiche un texte.</p></li><li id="r-551544" data-claire-element-id="551544"><p id="r-551543" data-claire-element-id="551543"><strong>DesignerActionMethodItem </strong>: Appelle une méthode.</p></li></ul><p id="r-551546" data-claire-element-id="551546">N'oubliez pas de mettre à jour l'attribut présent à l'entête de la classe <em>zCheckBox </em>pour que vos <strong>Designer Verbs</strong> et vos <strong>SmartTags </strong>s'affichent en même temps.</p><pre id="r-551547" data-claire-element-id="551547"><code data-claire-semantic="csharp">[Designer(typeof(zCheckBoxControlDesigner))] // Affiche les DesignerVerbs et les SmartTags
public partial class zCheckBox : UserControl
{
    ...
}</code></pre><p id="r-551548" data-claire-element-id="551548">Vous devriez maintenant apercevoir vos <strong>DesignerVerbs </strong>et votre <strong>SmartTag</strong> dans le concepteur de vues. :)</p><h2 id="r-afficher-une-icone-dans-la-boite-a-outils" data-claire-element-id="551592">Afficher une icône dans la boite à outils</h2><p id="r-551550" data-claire-element-id="551550">Comme vous avez pu le remarquer, beaucoup de contrôles de votre boite à outils disposent d'une icône afin d'être plus facilement identifiables. Et bien sachez que vous pouvez faire de même grâce à l'attribut <a href="http://msdn.microsoft.com/en-us/library/system.drawing.toolboxbitmapattribute.aspx">ToolboxBitmap</a>. Il existe plusieurs définitions :</p><table id="r-551573" data-claire-element-id="551573"><thead id="r-551556" data-claire-element-id="551556"><tr id="r-551555" data-claire-element-id="551555"><th id="r-551552" data-claire-element-id="551552"><p id="r-551551" data-claire-element-id="551551">Type des arguments</p></th><th id="r-551554" data-claire-element-id="551554"><p id="r-551553" data-claire-element-id="551553">Rôle des arguments</p></th></tr></thead><tbody id="r-551572" data-claire-element-id="551572"><tr id="r-551561" data-claire-element-id="551561"><td id="r-551558" data-claire-element-id="551558"><p id="r-551557" data-claire-element-id="551557">String</p></td><td id="r-551560" data-claire-element-id="551560"><p id="r-551559" data-claire-element-id="551559">Chemin de l'icône</p></td></tr><tr id="r-551566" data-claire-element-id="551566"><td id="r-551563" data-claire-element-id="551563"><p id="r-551562" data-claire-element-id="551562">Type</p></td><td id="r-551565" data-claire-element-id="551565"><p id="r-551564" data-claire-element-id="551564">Assembly dont l'icône voulue y est incluse en tant que ressource incorporée.</p></td></tr><tr id="r-551571" data-claire-element-id="551571"><td id="r-551568" data-claire-element-id="551568"><p id="r-551567" data-claire-element-id="551567">Type, String</p></td><td id="r-551570" data-claire-element-id="551570"><p id="r-551569" data-claire-element-id="551569">Assembly dont l'icône voulue y est incluse en tant que ressource incorporée et chemin de l'icône.</p></td></tr></tbody></table><p id="r-551574" data-claire-element-id="551574">Pour cet exemple, nous utiliserons la troisième définition. À présent, nous allons ajouter l'icône souhaitée dans le projet Visual Studio. Pour ce faire, vous devez utiliser un fichier <em>.bmp</em> ou <em>.ico</em> pour l'icône, et celle-ci doit avoir une taille de 16 * 16 pixels. Dans le cas présent, j'utilise une image déjà présente dans notre contrôle, mais j'ai modifié sa taille et enregistré celle-ci sous une autre image dont le nom est <strong>zCheckBox_ico.ico</strong> :</p><figure id="r-551576" data-claire-element-id="551577"><img id="r-551575" data-claire-element-id="551575" src="medias/uploads.siteduzero.com_files_393001_394000_393681.png" alt="Image utilisateur"/></figure><p id="r-551578" data-claire-element-id="551578">Avant d'ajouter l'attribut permettant d'afficher l'icône, nous allons devoir commencer par ajouter l'image à notre projet. Pour ce faire, faites clic droit sur le nom du projet puis <em>Ajouter -&gt; Élément existant ...</em> Choisissez ensuite votre icône puis cliquez sur valider. Même si notre image est présente dans le projet, nous ne pouvons toujours pas l'utiliser : en effet, afin d'avoir toujours accès à l'icône, vous devez l'ajouter en tant que ressource incorporée, sans quoi vous n'aurez pas accès à l'image. Pour ce faire, vous avez juste à sélectionnez votre icône puis à choisir l'option <strong>Ressource incorporée</strong> dans la propriété <strong>Action de génération</strong> :</p><figure id="r-551580" data-claire-element-id="551581"><img id="r-551579" data-claire-element-id="551579" src="medias/uploads.siteduzero.com_files_393001_394000_393682.png" alt="Image utilisateur"/></figure><p id="r-551582" data-claire-element-id="551582">À présent, notre icône est bien présente dans notre projet, et sera incorporée dans la DLL lors de la génération de celle-ci. Dès maintenant, ajoutons l'attribut pour associer l'image au contrôle :</p><pre id="r-551583" data-claire-element-id="551583"><code data-claire-semantic="csharp">[ToolboxBitmap(typeof(zCheckBox), &quot;zCheckBox_ico.ico&quot;)]</code></pre><p id="r-551584" data-claire-element-id="551584">Ce fut aussi simple que cela :) . Vous pouvez donc admirer l'icône associée à notre contrôle dans la boite à outils :</p><figure id="r-551586" data-claire-element-id="551587"><img id="r-551585" data-claire-element-id="551585" src="medias/uploads.siteduzero.com_files_393001_394000_393683.png" alt="Image utilisateur"/></figure><p id="r-551588" data-claire-element-id="551588"><a href="http://hardgames3d.com/zCheckBox.dll"><strong>Télécharger le contrôle utilisateur zCheckBox (*.dll)</strong></a></p><p id="r-551589" data-claire-element-id="551589"><strong><a href="http://hardgames3d.com/zCheckBox.zip">Télécharger le code source + projet Visual C# Express (*.zip)</a></strong></p><p id="r-551590" data-claire-element-id="551590">Vous pouvez voir que créer un contrôle utilisateur peut-être très facile, et surtout très utile dans certains cas.<br/> Même si on passe la moitié du temps pendant le tutoriel à créer une case à cocher, cela vous permet de comprendre comment fonctionne un contrôle utilisateur. Il est possible de créer d'autres contrôles qui n'existent pas dans le framework .NET. J'avais pensé à créer une RangeTrackBar, mais j'ai ensuite compris que c'était beaucoup trop long à créer, et donc beaucoup trop de code. J'ai préféré faire quelque chose de simple, pour un sujet simple. :)</p><p id="r-551591" data-claire-element-id="551591">Épatez-moi, postez vos belles créations sur les forums et partagez-les !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms">Développer son propre contrôle utilisateur WinForms</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/preambule-9">
Préambule
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/creation-du-controle">
Création du contrôle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/evenements-7">
Événements
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/fonctionnalites-supplementaires-1">
Fonctionnalités supplémentaires
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/developper-son-propre-controle-utilisateur-winforms/evenements-7">
<span class="arrow"></span>
<span class="next">Événements</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/developper-son-propre-controle-utilisateur-winforms.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:19:55 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/developper-son-propre-controle-utilisateur-winforms.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:33:18 GMT -->
</html>