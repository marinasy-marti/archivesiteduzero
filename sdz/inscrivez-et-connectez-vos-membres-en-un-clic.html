<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/inscrivez-et-connectez-vos-membres-en-un-clic.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:19:04 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/inscrivez-et-connectez-vos-membres-en-un-clic.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:32:59 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Inscrivez et connectez vos membres en un clic !</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Inscrivez et connectez vos membres en un clic !</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Inscrivezetconnectezvosmembresenunclic">Inscrivez et connectez vos membres en un clic !</a><br/><a href="#PrsentationdeJanrain">Présentation de Janrain</a><br/><a href="#Labasedusystme">La base du système</a><br/><a href="#tape1ajoutezdesfournisseurs">Étape 1 : ajoutez des fournisseurs !</a><br/><a href="#tape2intgrerJanRaindansvotresite">Étape 2 : intégrer JanRain dans votre site</a><br/><a href="#tape3l039inscription">Étape 3 : l&#039;inscription</a><br/><a href="#tape4laconnexion">Étape 4 : la connexion</a><br/></div>
<a name="Inscrivezetconnectezvosmembresenunclic"></a><h2>Inscrivez et connectez vos membres en un clic !</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/presentation-de-janrain">
<span class="next">Présentation de Janrain</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-557672" data-claire-element-id="557672">Vous venez de finir de modifier votre script de connexion pour donner la possibilité aux utilisateurs de se souvenir de leur pseudo, et vous êtes persuadés d'avoir tout fait pour simplifier au maximum la tâche de vos membres ? Détrompez-vous : il existe un moyen pour les identifier d'un seul clic.</p><div id="r-557674" data-claire-element-id="557674" data-claire-semantic="question"><p id="r-557673" data-claire-element-id="557673">Dis, tu deviens pas un peu fou, là o_O ? Si on clique juste sur un bouton, tout le monde pourra se connecter sur mon site !</p></div><p id="r-557675" data-claire-element-id="557675">En fait, il y a une astuce : vos membres sont déjà identifiés sur d'autres sites plus connus que le vôtre, tels que <em>Google</em>, <em>Facebook</em> ou <em>Windows Live</em>, pour ne citer que les plus utilisés. Tous ces sites proposent une fonctionnalité intéressante : délivrer, avec l'accord de l'utilisateur, des données concernant leurs membres. Vous pouvez récupérer ces informations pour identifier vos membres.<br/> De plus, vous pourrez proposer l'option « inscription-minute » : vous pourrez aller chercher les infos du visiteur directement dans son profil MSN ou Facebook !</p>
</div><a name="PrsentationdeJanrain"></a><h2>Présentation de Janrain</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/la-base-du-systeme">
<span class="next">La base du système</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-janrain" data-claire-element-id="557708">JanRain</h2><aside id="r-557677" data-claire-element-id="557677" data-claire-semantic="information"><p id="r-557676" data-claire-element-id="557676">JanRain avait comme nom <strong>RPX</strong> avant le 16 juin 2010.</p></aside><p id="r-557678" data-claire-element-id="557678"><a href="http://www.janrain.com/">JanRain</a> est un site qui permet de mettre en place gratuitement, rapidement et facilement un module permettant à vos membres de se connecter sur votre site en un clic !<br/> De nombreux sites l'utilisent : vous pouvez voir la <a href="http://www.janrain.com/customers">liste complète ici</a>. Par exemple, le Site du Zéro l'utilisait :</p><figure id="r-557680" data-claire-element-id="557681"><img id="r-557679" data-claire-element-id="557679" src="medias/uploads.siteduzero.com_files_258001_259000_258657.png" alt="Lien de connexion avec un compte externe du Site du Zéro"/></figure><p id="r-557682" data-claire-element-id="557682">Lorsqu'on clique sur les petites icônes, une fenêtre apparaît :</p><figure id="r-557684" data-claire-element-id="557685"><img id="r-557683" data-claire-element-id="557683" src="medias/uploads.siteduzero.com_files_228001_229000_228641.png" alt="Fenêtre de connexion pour un compte externe sur le Site du Zéro"/></figure><p id="r-557686" data-claire-element-id="557686">Vous avez le choix entre plusieurs fournisseurs OpenID. Un fournisseur est un gros site, comme <em>Windows Live</em>, <em>Google</em>, <em>Facebook</em>... Il permet à ses membres de délivrer, avec leur accord, des informations les concernant. Si vous êtes déjà connectés sur un de ces fournisseurs, on vous propose directement de vous loguer sur le SdZ :</p><figure id="r-557688" data-claire-element-id="557689"><img id="r-557687" data-claire-element-id="557687" src="medias/uploads.siteduzero.com_files_228001_229000_228643.png" alt="Fenêtre de connexion lorsque vous êtes déjà logué"/></figure><aside id="r-557691" data-claire-element-id="557691" data-claire-semantic="information"><p id="r-557690" data-claire-element-id="557690">Vous avez juste à cliquer sur le bouton « Connecter » pour vous identifier sur le SdZ !</p></aside><h3 id="r-avantages-7" data-claire-element-id="557699">Avantages</h3><ul id="r-557698" data-claire-element-id="557698"><li id="r-557693" data-claire-element-id="557693"><p id="r-557692" data-claire-element-id="557692"><strong>Connexion et inscription en un clic !</strong></p></li><li id="r-557695" data-claire-element-id="557695"><p id="r-557694" data-claire-element-id="557694">Support de nombreux fournisseurs OpenID.</p></li><li id="r-557697" data-claire-element-id="557697"><p id="r-557696" data-claire-element-id="557696">Simple à mettre en place.</p></li></ul><h3 id="r-inconvenients-8" data-claire-element-id="557707">Inconvénients</h3><ul id="r-557706" data-claire-element-id="557706"><li id="r-557701" data-claire-element-id="557701"><p id="r-557700" data-claire-element-id="557700"><strong>Le temps de chargement est très long : le visiteur est d'abord redirigé vers le site de Janrain, puis vers le fournisseur, puis il retourne sur Janrain... Bref, c'est parfois plus rapide de se connecter directement :lol:</strong></p></li><li id="r-557703" data-claire-element-id="557703"><p id="r-557702" data-claire-element-id="557702">Vous ne pouvez pas personnaliser l'interface utilisateur pour l'adapter a votre site.</p></li><li id="r-557705" data-claire-element-id="557705"><p id="r-557704" data-claire-element-id="557704">Votre site dépend de JanRain : si un problème technique survient, ou pire, si cette entreprise disparaît, votre script ne fonctionnera plus.</p></li></ul><h2 id="r-comment-ca-marche-28" data-claire-element-id="557722">Comment ça marche ?</h2><figure id="r-557710" data-claire-element-id="557711"><img id="r-557709" data-claire-element-id="557709" src="medias/uploads.siteduzero.com_files_241001_242000_241957.png" alt="Schéma de fonctionnement de JanRain"/></figure><ul id="r-557720" data-claire-element-id="557720"><li id="r-557713" data-claire-element-id="557713"><p id="r-557712" data-claire-element-id="557712"><strong>Étape 1</strong> : l'utilisateur clique sur une des icônes de fournisseurs sur votre site.</p></li><li id="r-557715" data-claire-element-id="557715"><p id="r-557714" data-claire-element-id="557714"><strong>Étape 2</strong> : JanRain redirige le visiteur vers le site du fournisseur pour l'authentification.</p></li><li id="r-557717" data-claire-element-id="557717"><p id="r-557716" data-claire-element-id="557716"><strong>Étape 3</strong> : le fournisseur renvoie des infos à JanRain, qui les sauvegarde dans sa BDD.</p></li><li id="r-557719" data-claire-element-id="557719"><p id="r-557718" data-claire-element-id="557718"><strong>Étape 4</strong> : votre site envoie une requête vers la BDD de JanRain qui lui renvoie des infos sur le membre en question.</p></li></ul><p id="r-557721" data-claire-element-id="557721">Convaincus ? Alors c'est parti ! :pirate:</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic">Inscrivez et connectez vos membres en un clic !</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/presentation-de-janrain">
Présentation de Janrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/la-base-du-systeme">
La base du système
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-1-ajoutez-des-fournisseurs">
Étape 1 : ajoutez des fournisseurs !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-2-integrer-janrain-dans-votre-site">
Étape 2 : intégrer JanRain dans votre site
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-3-l-inscription">
Étape 3 : l&#039;inscription
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-4-la-connexion">
Étape 4 : la connexion
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/la-base-du-systeme">
<span class="next">La base du système</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Labasedusystme"></a><h2>La base du système</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/presentation-de-janrain">
<span class="arrow"></span>
<span class="next">Présentation de Janrain</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-1-ajoutez-des-fournisseurs">
<span class="next">Étape 1 : ajoutez des fournisseurs !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-557724" data-claire-element-id="557724">Lorsqu'un membre tente de se connecter avec un site externe, ce site retourne automatiquement un ID et une adresse internet. Il est possible de récupérer certaines informations sur le membre, telles que son adresse e-mail, son avatar, etc...<br/> Par exemple, voici un lien pour Google (j'ai choisi un id au hasard) :</p><pre id="r-557725" data-claire-element-id="557725"><code>https://www.google.com/accounts/o8/id?id=fbf83cgfryqm8f73nqzf8rng3irxmg43qmf</code></pre><p id="r-557726" data-claire-element-id="557726">On appelle ce lien l'<strong>identifier</strong>. On ne va pas utiliser l'ID, car deux utilisateurs différents peuvent avoir un ID similaire, l'un étant sur Google, l'autre sur Facebook. En revanche, l'identifier est unique, quel que soit le site externe.<br/> On peut donc utiliser l'identifier pour lier un compte externe à un compte sur votre site : ainsi, lorsque un utilisateur se connecte avec Janrain, on vérifiera si l'identifier est déjà stocké dans la BDD.<br/> Par exemple, la table membres :</p><table id="r-557756" data-claire-element-id="557756"><thead id="r-557736" data-claire-element-id="557736"><tr id="r-557735" data-claire-element-id="557735"><th id="r-557728" data-claire-element-id="557728"><p id="r-557727" data-claire-element-id="557727">id</p></th><th id="r-557730" data-claire-element-id="557730"><p id="r-557729" data-claire-element-id="557729">pseudo</p></th><th id="r-557732" data-claire-element-id="557732"><p id="r-557731" data-claire-element-id="557731">mail</p></th><th id="r-557734" data-claire-element-id="557734"><p id="r-557733" data-claire-element-id="557733">identifier</p></th></tr></thead><tbody id="r-557755" data-claire-element-id="557755"><tr id="r-557745" data-claire-element-id="557745"><td id="r-557738" data-claire-element-id="557738"><p id="r-557737" data-claire-element-id="557737">1</p></td><td id="r-557740" data-claire-element-id="557740"><p id="r-557739" data-claire-element-id="557739">BrianMan692</p></td><td id="r-557742" data-claire-element-id="557742"><p id="r-557741" data-claire-element-id="557741"><a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="84e6f6ede5eae9e5eab2bdb6c4e3e9e5ede8aae7ebe9">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script></p></td><td id="r-557744" data-claire-element-id="557744"><p id="r-557743" data-claire-element-id="557743"><a href="https://www.google.com/accounts/o8/id?id=fbf83cgfryqm8f73nqzf8rng3irxmg43qmf"><strong>https://www.google.com/accounts/o8/id? [...] ng3irxmg43qmf</strong></a></p></td></tr><tr id="r-557754" data-claire-element-id="557754"><td id="r-557747" data-claire-element-id="557747"><p id="r-557746" data-claire-element-id="557746">2</p></td><td id="r-557749" data-claire-element-id="557749"><p id="r-557748" data-claire-element-id="557748">$imon</p></td><td id="r-557751" data-claire-element-id="557751"><p id="r-557750" data-claire-element-id="557750"><a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="b9cad0d4d6d7f9ded4d8d0d597dad6d4">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script></p></td><td id="r-557753" data-claire-element-id="557753"><p id="r-557752" data-claire-element-id="557752"><a href="https://www.google.com/accounts/o8/id?id=g4f83cgfryqm6f73nqzf8rng3irxmg53qmg"><strong>https://www.google.com/accounts/o8/id? [...] ng3irxmg53qmg</strong></a></p></td></tr></tbody></table><p id="r-557757" data-claire-element-id="557757">On a rajouté une colonne identifier pour mémoriser le lien renvoyé par la BDD de JanRain. Il servira à stocker l'<em>identifier</em> lors de l'inscription et à le comparer avec celui renvoyé par JanRain lors de la connexion.<br/> Nous allons créer une page pour gérer l'inscription avec JanRain, on va l'appeler inscriptionjanrain.php. On aura besoin d'en créer une autre pour la connexion : connexionjanrain.php.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic">Inscrivez et connectez vos membres en un clic !</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/presentation-de-janrain">
Présentation de Janrain
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/la-base-du-systeme">
La base du système
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-1-ajoutez-des-fournisseurs">
Étape 1 : ajoutez des fournisseurs !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-2-integrer-janrain-dans-votre-site">
Étape 2 : intégrer JanRain dans votre site
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-3-l-inscription">
Étape 3 : l&#039;inscription
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-4-la-connexion">
Étape 4 : la connexion
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/presentation-de-janrain">
<span class="arrow"></span>
<span class="next">Présentation de Janrain</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-1-ajoutez-des-fournisseurs">
<span class="next">Étape 1 : ajoutez des fournisseurs !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="tape1ajoutezdesfournisseurs"></a><h2>Étape 1 : ajoutez des fournisseurs !</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/la-base-du-systeme">
<span class="arrow"></span>
<span class="next">La base du système</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-2-integrer-janrain-dans-votre-site">
<span class="next">Étape 2 : intégrer JanRain dans votre site</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-557759" data-claire-element-id="557760">Vous l'avez bien vu, lorsque la boîte de connexion est affichée, on a le choix entre plusieurs fournisseurs.<br/> Tout d'abord, vous devez créer un compte sur <a href="http://www.janrain.com/products/engage/pricing">cette page</a>. Si vous ne voulez pas payer, il y a une version gratuite limitée : cliquez sur « Sign up » pour vous inscrire (oui, JanRain n'est disponible qu'en anglais :euh: ). Et... une fenêtre comme sur le SdZ s'ouvre ! Eh oui, le site de JanRain lui-même utilise ses propres services ! Si vous possédez déjà un compte OpenID, il suffit de cliquer sur son icône. Sinon, il est temps de s'inscrire sur un des fournisseurs !<br/> Il vous suffit de remplir les informations demandées pour vous inscrire. On vous demandera le nom de votre application, vous pouvez mettre le nom de votre site web (cela n'a pas une grande importance).<br/> Vous vous retrouvez ensuite devant le panneau de configuration de votre application :<br/><a href="medias/uploads.siteduzero.com_files_363001_364000_363860.png"><img id="r-557760" data-claire-element-id="557759" src="medias/uploads.siteduzero.com_thb_363001_364000_363860.png" alt="Panneau de configuration"/></a><br/> Pour commencer à modeler votre nouvelle application, cliquez sur « Sign-in for Web », dans le menu « Deployment » :</p><figure id="r-557762" data-claire-element-id="557763"><img id="r-557761" data-claire-element-id="557761" src="medias/uploads.siteduzero.com_files_363001_364000_363859.png" alt="Menu deployment -> sign-in for Web"/></figure><p id="r-557764" data-claire-element-id="557764">Vous vous retrouvez face à un autre formulaire :</p><figure id="r-557766" data-claire-element-id="557767"><img id="r-557765" data-claire-element-id="557765" src="medias/uploads.siteduzero.com_files_363001_364000_363861.png" alt="Formulaire sign-in for Web"/></figure><p id="r-557768" data-claire-element-id="557768">Dans la première liste, vous pouvez choisir d'avoir le code soit pour ouvrir une fenêtre (« modal »), soit pour insérer un cadre (« embedded »).</p><div id="r-557770" data-claire-element-id="557770" data-claire-semantic="question"><p id="r-557769" data-claire-element-id="557769">Pourquoi certaines fonctionnalités sont-elles grisées ?</p></div><p id="r-557771" data-claire-element-id="557771">Janrain est un service payant, et certaines options sont réservées aux membres « Pro ». Les options grisées sont juste la dans le but de vous faire saliver !</p><p id="r-557772" data-claire-element-id="557772">Pour ajouter des fournisseurs, cliquez sur la liste « Providers » en bas a gauche, puis faites un glisser-déposer d'un fournisseur vers la grille.</p><p id="r-557773" data-claire-element-id="557773">Tous les fournisseurs accompagnés de l'icône</p><figure id="r-557775" data-claire-element-id="557776"><img id="r-557774" data-claire-element-id="557774" src="medias/uploads.siteduzero.com_files_228001_229000_228735.png" alt="Icône pour les fournisseurs nécessitant une configuration"/></figure><p id="r-557777" data-claire-element-id="557777">sur leur droite demandent des paramètres spéciaux. Les autres peuvent s'ajouter en un seul clic sans pré-requis (un seul glisser-déplacer en l'occurrence ;) ).</p><h2 id="r-pour-facebook" data-claire-element-id="557789">Pour Facebook</h2><p id="r-557778" data-claire-element-id="557778">Vous devez en premier lieu être inscrits sur Facebook. Connectez-vous et allez à l'adresse : <a href="http://www.facebook.com/developers/">http://www.facebook.com/developers/</a>. Cliquez sur « Accepter », puis sur</p><figure id="r-557780" data-claire-element-id="557781"><img id="r-557779" data-claire-element-id="557779" src="medias/uploads.siteduzero.com_files_228001_229000_228736.png" alt="Bouton Créer une application de Facebook"/></figure><p id="r-557782" data-claire-element-id="557782">en haut à droite. Donnez le nom que vous voulez à votre application, cela n'a pas d'importance. N'oubliez pas de cocher « J'accepte les conditions d'utilisation » et validez.<br/> Du côté du site de JanRain, il faut cliquer deux fois sur « Next ». Une page s'affiche ensuite avec différents renseignements. Faites un copier-coller de :</p><ul id="r-557787" data-claire-element-id="557787"><li id="r-557784" data-claire-element-id="557784"><p id="r-557783" data-claire-element-id="557783"><em>Clé API</em> vers <em>API key</em> (Facebook =&gt; JanRain) ;</p></li><li id="r-557786" data-claire-element-id="557786"><p id="r-557785" data-claire-element-id="557785"><em>Secret</em> vers <em>Application Secret</em>.</p></li></ul><p id="r-557788" data-claire-element-id="557788">Cochez la case « Yes! I want to receive my users email addresses. » pour recevoir les adresses e-mail des membres qui vont se connecter sur votre site avec Facebook.</p><h2 id="r-pour-windows-live-id" data-claire-element-id="557803">Pour Windows Live ID</h2><p id="r-557790" data-claire-element-id="557790">Pour Windows Live ID, c'est un peu plus compliqué. Vous devez tout d'abord posséder un compte Windows Live. Lorsque vous faites un glisser-déplacer avec Windows Live ID, on vous demande une <em>Privacy Policy URL</em>. C'est la page vers la politique de confidentialité de votre site Web.<br/> Ensuite, allez sur la <a href="https://manage.dev.live.com/AddApplication.aspx">page de création d'une application Windows Live</a>. Connectez-vous à l'aide de votre identifiant Windows Live. Vous vous retrouvez devant une page en anglais ( :-° ) ; le système est le même qu'avec Facebook.<br/> Je vous laisse remplir les deux premiers champs (titre et langue), vous avez l'habitude maintenant. ;) <br/> Vous pouvez ensuite valider en cliquant sur « I accept », vous devez arriver sur une page de confirmation :</p><figure id="r-557792" data-claire-element-id="557793"><img id="r-557791" data-claire-element-id="557791" src="medias/uploads.siteduzero.com_files_367001_368000_367198.png" alt="Page de confirmation"/></figure><p id="r-557794" data-claire-element-id="557794">Revenez sur le site de JanRain, cliquez sur « Next » jusqu'à la troisième étape. On vous fournit un renseignement : <em>Return URL</em>. Revenez sur le site de Windows Live, cliquez sur « Application Settings Page » puis « API Settings » :</p><figure id="r-557796" data-claire-element-id="557797"><img id="r-557795" data-claire-element-id="557795" src="medias/uploads.siteduzero.com_files_363001_364000_363863.png" alt="Menu API settings"/></figure><p id="r-557798" data-claire-element-id="557798">Il faut maintenant entrer <em>Return URL</em> dans le champ « Redirect domain ».</p><figure id="r-557800" data-claire-element-id="557801"><img id="r-557799" data-claire-element-id="557799" src="medias/uploads.siteduzero.com_files_363001_364000_363862.png" alt="API settings"/></figure><p id="r-557802" data-claire-element-id="557802">Cliquez ensuite sur « Next » sur le site de JanRain. Faites un copier-coller de « Application Id » et de « Secret Key » dans le formulaire qui s'affiche.<br/> Cliquez sur « Save » pour enregistrer les infos.</p><h2 id="r-pour-les-autres-fournisseurs" data-claire-element-id="557807">Pour les autres fournisseurs</h2><p id="r-557804" data-claire-element-id="557804">La manipulation est quasiment la même que pour Facebook, ou aucune manipulation n'est requise. Je vous laisse vous débrouiller pour le reste des fournisseurs. ;)</p><aside id="r-557806" data-claire-element-id="557806" data-claire-semantic="warning"><p id="r-557805" data-claire-element-id="557805">Une fois que vous avez fini, n'<strong>oubliez pas</strong> de fermer la fenêtre cliquer sur « Save » en bas à droite.</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic">Inscrivez et connectez vos membres en un clic !</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/presentation-de-janrain">
Présentation de Janrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/la-base-du-systeme">
La base du système
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-1-ajoutez-des-fournisseurs">
Étape 1 : ajoutez des fournisseurs !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-2-integrer-janrain-dans-votre-site">
Étape 2 : intégrer JanRain dans votre site
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-3-l-inscription">
Étape 3 : l&#039;inscription
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-4-la-connexion">
Étape 4 : la connexion
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/la-base-du-systeme">
<span class="arrow"></span>
<span class="next">La base du système</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-2-integrer-janrain-dans-votre-site">
<span class="next">Étape 2 : intégrer JanRain dans votre site</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="tape2intgrerJanRaindansvotresite"></a><h2>Étape 2 : intégrer JanRain dans votre site</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-1-ajoutez-des-fournisseurs">
<span class="arrow"></span>
<span class="next">Étape 1 : ajoutez des fournisseurs !</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-3-l-inscription">
<span class="next">Étape 3 : l&#039;inscription</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-le-code-xhtml-et-javascript-a-inserer-dans-vos-pages" data-claire-element-id="557821">Le code xHTML et JavaScript à insérer dans vos pages</h2><p id="r-557809" data-claire-element-id="557809">Pour intégrer Janrain dans votre site, cliquez sur « Get the Code » :</p><figure id="r-557811" data-claire-element-id="557812"><img id="r-557810" data-claire-element-id="557810" src="medias/uploads.siteduzero.com_files_363001_364000_363868.png" alt="Get the code"/></figure><p id="r-557813" data-claire-element-id="557813">Le site vous donne alors un code JavaScript et un autre en HTML. Ils devraient ressembler à ceci :</p><pre id="r-557814" data-claire-element-id="557814"><code data-claire-semantic="html">&lt;script type=&quot;text/javascript&quot;&gt;
(function() {
    if (typeof window.janrain !== 'object') window.janrain = {};
    window.janrain.settings = {};
    
    janrain.settings.tokenUrl = '__REPLACE_WITH_YOUR_TOKEN_URL__';

    function isReady() { janrain.ready = true; };
    if (document.addEventListener) {
      document.addEventListener(&quot;DOMContentLoaded&quot;, isReady, false);
    } else {
      window.attachEvent('onload', isReady);
    }

    var e = document.createElement('script');
    e.type = 'text/javascript';
    e.id = 'janrainAuthWidget';

    if (document.location.protocol === 'https:') {
      e.src = 'https://rpxnow.com/js/lib/user/engage.js';
    } else {
      e.src = 'http://widget-cdn.rpxnow.com/js/lib/user/engage.js';
    }

    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(e, s);
})();
&lt;/script&gt;</code></pre><pre id="r-557815" data-claire-element-id="557815"><code data-claire-semantic="html">&lt;a class=&quot;janrainEngage&quot; href=&quot;#&quot;&gt;Sign-In&lt;/a&gt;</code></pre><p id="r-557816" data-claire-element-id="557816">Le premier code est à insérer dans la balise <code data-claire-semantic="html">&lt;body&gt;&lt;/body&gt;</code> dans votre page de connexion habituelle. Il est conseillé de le mettre juste avant <code data-claire-semantic="html">&lt;/body&gt;</code>. Le second code est un lien : celui qui ouvrira la fenêtre de connexion. Vous pouvez le mettre n'importe où dans votre balise <code data-claire-semantic="html">&lt;body&gt;&lt;/body&gt;</code>.</p><p id="r-557817" data-claire-element-id="557817">Il faut rajouter un paramètre après <code data-claire-semantic="javascript">janrain.settings.tokenUrl = '__REPLACE_WITH_YOUR_TOKEN_URL__';</code> :</p><pre id="r-557818" data-claire-element-id="557818"><code data-claire-semantic="javascript">janrain.settings.tokenUrl = 'http://unsite.com/connexionjanrain.php';</code></pre><p id="r-557819" data-claire-element-id="557819">Il correspond a la page vers laquelle le visiteur sera redirigé après authentification, nous la coderons plus loin dans le tutoriel.</p><p id="r-557820" data-claire-element-id="557820">Vous remarquerez que l'interface de connexion de Janrain est elle aussi en anglais. Pour pouvoir personnaliser la fenêtre et changer la langue, il vous faudra... Payer. :(</p><h2 id="r-configurer-janrain" data-claire-element-id="557835">Configurer JanRain</h2><p id="r-557822" data-claire-element-id="557822">Entrez dans les paramètres de votre application en cliquant sur « Application settings » dans le menu « Deployment » :</p><figure id="r-557824" data-claire-element-id="557825"><img id="r-557823" data-claire-element-id="557823" src="medias/uploads.siteduzero.com_files_363001_364000_363869.png" alt="Menu deployment -> application settings"/></figure><p id="r-557826" data-claire-element-id="557826">Dans le premier champ, vous pouvez entrer les domaines sur lesquels elle pourra être utilisée. Si l'adresse de votre site est <a href="http://unsite.com/">http://unsite.com/</a>, vous pouvez mettre unsite.com. Si vous avez des sous-domaines et que vous voulez que votre application soit aussi utilisable dessus, vous pouvez entrer unsite.com et *.unsite.com.</p><aside id="r-557828" data-claire-element-id="557828" data-claire-semantic="information"><p id="r-557827" data-claire-element-id="557827">Vous pouvez aussi entrer localhost pour faire des tests en local.</p></aside><p id="r-557829" data-claire-element-id="557829">JanRain est configuré pour ne renvoyer qu'une seule fois les informations sur le membre. Or, nous aurons besoin d'actualiser la page pour pouvoir demander au visiteur certaines infos.<br/> On va donc modifier cela : dans la section « Migrations », il faut désactiver l'utilisation unique des token (« One-time use auth_info tokens ») :</p><figure id="r-557831" data-claire-element-id="557832"><img id="r-557830" data-claire-element-id="557830" src="medias/uploads.siteduzero.com_files_363001_364000_363870.png" alt="One-time use auth_info tokens"/></figure><aside id="r-557834" data-claire-element-id="557834" data-claire-semantic="information"><p id="r-557833" data-claire-element-id="557833"><strong>À noter</strong> : JanRain acceptera de renvoyer les infos pendant approximativement 10 minutes.</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic">Inscrivez et connectez vos membres en un clic !</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/presentation-de-janrain">
Présentation de Janrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/la-base-du-systeme">
La base du système
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-1-ajoutez-des-fournisseurs">
Étape 1 : ajoutez des fournisseurs !
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-2-integrer-janrain-dans-votre-site">
Étape 2 : intégrer JanRain dans votre site
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-3-l-inscription">
Étape 3 : l&#039;inscription
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-4-la-connexion">
Étape 4 : la connexion
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-1-ajoutez-des-fournisseurs">
<span class="arrow"></span>
<span class="next">Étape 1 : ajoutez des fournisseurs !</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-3-l-inscription">
<span class="next">Étape 3 : l&#039;inscription</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="tape3l039inscription"></a><h2>Étape 3 : l&#039;inscription</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-2-integrer-janrain-dans-votre-site">
<span class="arrow"></span>
<span class="next">Étape 2 : intégrer JanRain dans votre site</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-4-la-connexion">
<span class="next">Étape 4 : la connexion</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-557837" data-claire-element-id="557837">Nous allons ici coder la page <strong>inscriptionjanrain.php</strong>, qui gère l'inscription avec un compte externe.</p><h2 id="r-reflechissons" data-claire-element-id="557842">Réfléchissons...</h2><p id="r-557838" data-claire-element-id="557838">On va récupérer les informations du membre avec JanRain. Il suffira alors de les enregistrer dans la BDD s'il n'en manque pas (quelques fournisseurs ne fournissent pas l'e-mail ou le pseudo de leur membre). S'il n'y a pas les données minimales, on les demandera au visiteur par un formulaire.<br/> Un bon schéma vaut mieux qu'un long discours :lol: :</p><figure id="r-557840" data-claire-element-id="557841"><img id="r-557839" data-claire-element-id="557839" src="medias/uploads.siteduzero.com_files_241001_242000_241958.png" alt="Image utilisateur"/></figure><h2 id="r-codons-10" data-claire-element-id="557880">Codons !</h2><aside id="r-557844" data-claire-element-id="557844" data-claire-semantic="information"><p id="r-557843" data-claire-element-id="557843"><strong>Note</strong> : j'utilise PHP pour gérer la réponse des fournisseurs, mais il est tout à fait possible de coder un équivalent en Python, Java, C# ou Ruby on Rails (voir la liste à gauche dans l'étape 2).</p></aside><p id="r-557845" data-claire-element-id="557845">Cliquez sur « Call the API » :</p><figure id="r-557847" data-claire-element-id="557848"><img id="r-557846" data-claire-element-id="557846" src="medias/uploads.siteduzero.com_files_363001_364000_363877.png" alt="Call the API"/></figure><p id="r-557849" data-claire-element-id="557849">Vous avez le script de base à cette adresse : <a href="http://gist.github.com/291396">http://gist.github.com/291396</a>.<br/> Le voici (les commentaires ont été traduits en français pour une meilleure compréhension du code) :</p><pre id="r-557850" data-claire-element-id="557850"><code data-claire-semantic="html+php">&lt;?php
// Ici, un script basique pour recevoir les données des fournisseurs (requiert PHP 5 ou plus)
// Vous devez avoir installé CURL HTTP fetching library

$JanRainApiKey = 'REMPLACEZ_CE_TEXTE_AVEC_VOTRE_CLEF_API';  

if(isset($_POST['token'])) { // Si l'utilisateur tente de se connecter avec JanRain

  /* ÉTAPE 1 : récupérer le paramètre token */
  $token = $_POST['token'];

  /* ÉTAPE 2 : utiliser le token pour envoyer une requête vers le serveur de JanRain, qui interrogera à son tour le fournisseur */
  $post_data = array('token' =&gt; $_POST['token'],
                     'apiKey' =&gt; $JanRainApiKey,
                     'format' =&gt; 'json'); 

  $curl = curl_init(); // Initialisation
  curl_setopt($curl, CURLOPT_RETURNTRANSFER, true); // Retourne le résultat du transfert au lieu de l'afficher
  curl_setopt($curl, CURLOPT_URL, 'https://rpxnow.com/api/v2/auth_info'); // On définit l'URL cible à récupérer
  curl_setopt($curl, CURLOPT_POST, true); // On dit à PHP de faire un HTTP POST (comme pour les formulaires)
  curl_setopt($curl, CURLOPT_POSTFIELDS, $post_data); // Données à fournir par HTTP POST
  curl_setopt($curl, CURLOPT_HEADER, false); // On dit de ne pas renvoyer l'en-tête dans la valeur de retour
  curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false); // On ne vérifie pas le certificat SSL
  $raw_json = curl_exec($curl); // On exécute la requête
  curl_close($curl); // On ferme la connexion


  /* ÉTAPE 3 : décoder la réponse Json */
  $auth_info = json_decode($raw_json, true);

  if ($auth_info['stat'] == 'ok') { // Si tout est OK
  
    /* ÉTAPE 4 : récupérer les infos à partir de la réponse */
    $profile = $auth_info['profile']; // Les infos sur le membre
    $identifier = $profile['identifier']; // Le lien

    if (isset($profile['photo']))  { // Avatar
      $photo_url = $profile['photo'];
    }

    if (isset($profile['displayName']))  { // Nom à afficher
      $displayName = $profile['displayName'];
    }

    if (isset($profile['email']))  { // E-mail
      $email = $profile['email'];
    }

    /* ÉTAPE 5 : utilisez l'identifier pour identifier les utilisateurs dans votre site
     * Nous allons revenir sur cette partie un peu plus tard...
     */

  } else { /* Une erreur est survenue */
     // On affiche l'erreur
     echo 'Une erreur est survenue : ' . $auth_info['err']['msg'];
  }
}
?&gt;</code></pre><p id="r-557851" data-claire-element-id="557851">Pensez à modifier la valeur de $JanRainApiKey avec celle fournie dans ce cadre :</p><figure id="r-557853" data-claire-element-id="557854"><img id="r-557852" data-claire-element-id="557852" src="medias/uploads.siteduzero.com_files_258001_259000_258655.png" alt="Image utilisateur"/></figure><aside id="r-557856" data-claire-element-id="557856" data-claire-semantic="warning"><p id="r-557855" data-claire-element-id="557855">Vous devez avoir <strong>PHP 5 ou plus</strong> et avoir installé <a href="http://php.net/manual/fr/book.curl.php"><strong>CURL HTTP fetching library</strong></a>.</p></aside><p id="r-557857" data-claire-element-id="557857">Pour ceux qui ne connaissent pas cURL, voici un peu de lecture :</p><p id="r-557858" data-claire-element-id="557858"><cite>Citation : Manuel PHP</cite></p><blockquote id="r-557860" data-claire-element-id="557860"><p id="r-557859" data-claire-element-id="557859">PHP supporte libcurl, une bibliothèque créée par Daniel Stenberg, qui vous permet de vous connecter et de communiquer avec différents types de serveurs, et ce, avec différents types de protocoles. libcurl supporte actuellement les protocoles http, https, ftp, gopher, telnet, DICT, file et LDAP. libcurl supporte également les certificats HTTPS, HTTP POST, HTTP PUT, le téléchargement FTP (ceci pouvant également être effectué via l'extension ftp de PHP), les formulaires de téléchargement HTTP, les serveurs mandataires (proxy), les cookies et l'identification utilisateur/mot de passe.</p></blockquote><p id="r-557861" data-claire-element-id="557861">Si cURL n'est pas installé, vous aurez ce message d'erreur :</p><p id="r-557862" data-claire-element-id="557862"><cite>Citation : Erreur PHP</cite></p><blockquote id="r-557864" data-claire-element-id="557864"><p id="r-557863" data-claire-element-id="557863"><strong>Fatal error</strong>: Call to undefined function curl_init() in <strong>connexionjanrain.php</strong> on line <strong>17</strong></p></blockquote><p id="r-557865" data-claire-element-id="557865">Pour l'installer, si vous êtes en local, il faut activer le module cURL : Icône wamp &gt; PHP &gt; Extensions PHP &gt; php_curl.<br/> Puis il faut redémarrer wamp, si ce n'est pas fait pas automatiquement (l'icône change de couleur).<br/> Sur serveur, un paquet de cURL doit exister pour votre distribution Linux (par exemple, <a href="http://doc.ubuntu-fr.org/modules_php#php5-curl">voir ici pour Ubuntu</a>). Voici le site de cURL, ou vous devrez trouver votre bonheur dans la section &quot;Downloads&quot; : <a href="http://curl.haxx.se/">http://curl.haxx.se/</a>. ;)</p><div id="r-557867" data-claire-element-id="557867" data-claire-semantic="question"><p id="r-557866" data-claire-element-id="557866">Dis, c'est bien beau tout ça, mais comment inscrire les membres maintenant ?</p></div><p id="r-557868" data-claire-element-id="557868">Tout d'abord, se connecter à sa BDD (placez ce code à la place de l'étape 5 du code ci-dessus) :</p><pre id="r-557869" data-claire-element-id="557869"><code data-claire-semantic="html+php">&lt;?php
session_start(); // On démarre les sessions
// Connexion à la BDD
$PARAM_hote='localhost'; // Le chemin vers le serveur
$PARAM_port='3306';
$PARAM_nom_bd='monsite'; // Le nom de votre base de données
$PARAM_utilisateur='root'; // Nom d'utilisateur pour se connecter
$PARAM_mot_passe=''; // Mot de passe de l'utilisateur pour se connecter
try {
	$connexion = new PDO('mysql:host='.$PARAM_hote.';port='.$PARAM_port.';dbname='.$PARAM_nom_bd, $PARAM_utilisateur, $PARAM_mot_passe);
} catch(Exception $e) {
	echo 'Erreur : '.$e-&gt;getMessage().'&lt;br /&gt;';
	echo 'N° : '.$e-&gt;getCode();
}
$connexion-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_WARNING); // Lance une alerte à chaque requête échouée
?&gt;</code></pre><p id="r-557870" data-claire-element-id="557870">Ensuite, vérifier que le membre n'est pas déjà inscrit :</p><pre id="r-557871" data-claire-element-id="557871"><code data-claire-semantic="html+php">&lt;?php
if (isset($_GET['JanRain_inscrire'])) { // Si le visiteur veut s'inscrire avec JanRain
	$nombreResultats = $connexion-&gt;query('SELECT COUNT(*) FROM membres WHERE identifier = \''.$identifier.'\'')-&gt;fetchColumn(); // On vérifie si le visiteur n'est pas déjà inscrit
	if ($nombreResultats == 1) {
		$message = '&lt;p&gt;Vous êtes déjà inscrit !&lt;/p&gt;&lt;form action=&quot;./connexionjanrain.php&quot; method=&quot;post&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;'.$token.'&quot;/&gt;&lt;input type=&quot;submit&quot; value=&quot;Me connecter&quot;/&gt;&lt;/form&gt;'; // Message
	}
?&gt;</code></pre><p id="r-557872" data-claire-element-id="557872">Sinon, on vérifie qu'aucun membre n'a la même adresse e-mail que le visiteur.</p><pre id="r-557873" data-claire-element-id="557873"><code data-claire-semantic="html+php">&lt;?php
	else {
		if ((isset($displayName) OR isset($_POST['pseudo'])) AND (isset($email) OR isset($_POST['email']))) { // Si on a toutes les infos
			$nombreResultats = $connexion-&gt;query('SELECT COUNT(*) FROM membres WHERE mail = \''.$email.'\'')-&gt;fetchColumn(); // On vérifie si un membre n'a pas cet e-mail
			if ($nombreResultats == 1) {
				$query = $connexion-&gt;query('SELECT id, pseudo FROM membres WHERE mail = \''.$email.'\'');
				$donnees = $query-&gt;fetch(PDO::FETCH_ASSOC);
				$message = '&lt;p&gt;Vous pouvez vous connecter avec un compte externe en cliquant seulement sur un bouton ! Seulement, êtes-vous bien &lt;strong&gt;'.$donnees['pseudo'].'&lt;/strong&gt; ? Cette question ne vous sera plus posée à l\'avenir.&lt;/p&gt;
				&lt;form action=&quot;./connexionjanrain.php?JanRain_lier&quot;&gt;
				&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;'.$token.'&quot;/&gt;
				&lt;input type=&quot;submit&quot; value=&quot;Oui&quot;/&gt; &lt;a href=&quot;./connexion.php&quot;&gt;&lt;input type=&quot;button&quot; value=&quot;Non&quot;/&gt;&lt;/a&gt;
				&lt;/form&gt;'; // Message
			}
?&gt;</code></pre><p id="r-557874" data-claire-element-id="557874">Si tout est O.K., on inscrit le visiteur :</p><pre id="r-557875" data-claire-element-id="557875"><code data-claire-semantic="html+php">&lt;?php
			else {
				if (isset($_POST['pseudo']))
					$displayName = $_POST['pseudo'];
				if (isset($_POST['email']))
					$email = $_POST['email'];
				$query = $connexion-&gt;prepare('INSERT INTO membres (id,pseudo,mail,identifier) VALUES (\'\',?,?,?)'); // On enregistre les infos
				$query-&gt;execute(array($displayName, $email, $identifier));
				$_SESSION['pseudo'] = $donnees['pseudo']; // On connecte le membre
				$_SESSION['id'] = $donnees['id'];
				$message = '&lt;p&gt;Vous avez bien été inscrit !
				&lt;a href=&quot;./index.php&quot;&gt;Cliquez ici&lt;/a&gt; 
				pour revenir à la page d\'accueil&lt;/p&gt;'; // Message
			}
		}
?&gt;</code></pre><p id="r-557876" data-claire-element-id="557876">S'il n'y a pas assez d'infos, on les demande :</p><pre id="r-557877" data-claire-element-id="557877"><code data-claire-semantic="html+php">&lt;?php
		} else { // Pas assez d'infos : on les demande
			if (!isset($displayName))
				$displayName = '';
			if (!isset($email))
				$email = '';
			$message = '&lt;p&gt;Veuillez renseigner les champs ci-dessous pour vous inscrire :&lt;/p&gt;
			&lt;form action=&quot;./inscriptionjanrain.php&quot; method=&quot;post&quot;&gt;
			&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;'.$token.'&quot;/&gt;
			Pseudo : &lt;input type=&quot;text&quot; name=&quot;pseudo&quot; value=&quot;'.$displayName.'&quot;/&gt;
			E-mail : &lt;input type=&quot;text&quot; name=&quot;email&quot; value=&quot;'.$email.'&quot;/&gt;
			&lt;input type=&quot;submit&quot; value=&quot;M\'inscrire !&quot;/&gt;
			&lt;/form&gt;';
		}
	}
}
?&gt;</code></pre><p id="r-557878" data-claire-element-id="557878">Ouf !<br/> Voici le code complet :</p><pre id="r-557879" data-claire-element-id="557879"><code data-claire-semantic="html+php">&lt;?php
// Ici, un script basique pour recevoir les données des fournisseurs (requiert PHP 5 ou plus)
// Vous devez avoir installé CURL HTTP fetching library

$JanRainApiKey = 'REMPLACEZ_CE_TEXTE_AVEC_VOTRE_CLEF_API';  

if(isset($_POST['token'])) { // Si l'utilisateur tente de se connecter avec JanRain

	/* ÉTAPE 1 : récupérer le paramètre token */
	$token = $_POST['token'];

	/* ÉTAPE 2 : utiliser le token pour envoyer une requête vers le serveur de JanRain, qui interrogera à son tour le fournisseur */
	$post_data = array('token' =&gt; $_POST['token'],
		'apiKey' =&gt; $JanRainApiKey,
		'format' =&gt; 'json'); 

	$curl = curl_init(); // Initialisation
	curl_setopt($curl, CURLOPT_RETURNTRANSFER, true); // Retourne le résultat du transfert au lieu de l'afficher
	curl_setopt($curl, CURLOPT_URL, 'https://rpxnow.com/api/v2/auth_info'); // On définit l'URL cible à récupérer
	curl_setopt($curl, CURLOPT_POST, true); // On dit à PHP de faire un HTTP POST (comme pour les formulaires)
	curl_setopt($curl, CURLOPT_POSTFIELDS, $post_data); // Données à fournir par HTTP POST
	curl_setopt($curl, CURLOPT_HEADER, false); // On dit de ne pas renvoyer l'en-tête dans la valeur de retour
	curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false); // On ne vérifie pas le certificat SSL
	$raw_json = curl_exec($curl); // On exécute la requête
	curl_close($curl); // On ferme la connexion

	/* ÉTAPE 3 : décoder la réponse Json */
	$auth_info = json_decode($raw_json, true);

	if ($auth_info['stat'] == 'ok') { // Si tout est OK
  
		/* ÉTAPE 4 : récupérer les infos à partir de la réponse */
		$profile = $auth_info['profile']; // Les infos sur le membre
		$identifier = $profile['identifier']; // Le lien

		if (isset($profile['photo']))  { // Avatar
			$photo_url = $profile['photo'];
		}

		if (isset($profile['displayName']))  { // Nom à afficher
			$displayName = $profile['displayName'];
		}

		if (isset($profile['email']))  { // E-mail
			$email = $profile['email'];
		}

		session_start(); // On démarre les sessions
		// Connexion à la BDD
		$PARAM_hote='localhost'; // Le chemin vers le serveur
		$PARAM_port='3306';
		$PARAM_nom_bd='monsite'; // Le nom de votre base de données
		$PARAM_utilisateur='root'; // Nom d'utilisateur pour se connecter
		$PARAM_mot_passe=''; // Mot de passe de l'utilisateur pour se connecter
		try {
			$connexion = new PDO('mysql:host='.$PARAM_hote.';port='.$PARAM_port.';dbname='.$PARAM_nom_bd, $PARAM_utilisateur, $PARAM_mot_passe);
		} catch(Exception $e) {
			echo 'Erreur : '.$e-&gt;getMessage().'&lt;br /&gt;';
			echo 'N° : '.$e-&gt;getCode();
		}
		$connexion-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_WARNING); // Lance une alerte à chaque requête échouée

		$nombreResultats = $connexion-&gt;query('SELECT COUNT(*) FROM membres WHERE identifier = \''.$identifier.'\'')-&gt;fetchColumn(); // On vérifie si le visiteur n'est pas déjà inscrit
		if ($nombreResultats == 1) {
			$message =  '&lt;p&gt;Vous êtes déjà inscrit !&lt;/p&gt;&lt;form action=&quot;./connexionjanrain.php&quot; method=&quot;post&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;'.$token.'&quot;/&gt;&lt;input type=&quot;submit&quot; value=&quot;Me connecter&quot;/&gt;&lt;/form&gt;'; // Message
		} else {
			if ((isset($displayName) OR isset($_POST['pseudo'])) AND (isset($email) OR isset($_POST['email']))) { // Si on a toutes les infos
				$nombreResultats = $connexion-&gt;query('SELECT COUNT(*) FROM membres WHERE mail = \''.$email.'\'')-&gt;fetchColumn(); // On vérifie si un membre n'a pas cet e-mail
				if ($nombreResultats == 1) {
					$query = $connexion-&gt;query('SELECT id, pseudo FROM membres WHERE mail = \''.$email.'\'');
					$donnees = $query-&gt;fetch(PDO::FETCH_ASSOC);
					$message = '&lt;p&gt;Vous pouvez vous connecter avec un compte externe en cliquant seulement sur un bouton ! Seulement, êtes-vous bien &lt;strong&gt;'.$donnees['pseudo'].'&lt;/strong&gt; ? Cette question ne vous sera plus posée à l\'avenir.&lt;/p&gt;
					&lt;form action=&quot;./connexionjanrain.php?JanRain_lier&quot;&gt;
					&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;'.$token.'&quot;/&gt;
					&lt;input type=&quot;submit&quot; value=&quot;Oui&quot;/&gt; &lt;a href=&quot;./connexion.php&quot;&gt;&lt;input type=&quot;button&quot; value=&quot;Non&quot;/&gt;&lt;/a&gt;
					&lt;/form&gt;'; // Message
				} else {
					if (isset($_POST['pseudo']))
						$displayName = $_POST['pseudo'];
					if (isset($_POST['email']))
						$email = $_POST['email'];
					$query = $connexion-&gt;prepare('INSERT INTO membres (id,pseudo,mail,identifier) VALUES (\'\',?,?,?)'); // On enregistre les infos
					$query-&gt;execute(array($displayName, $email, $identifier));
					$_SESSION['pseudo'] = $donnees['pseudo']; // On connecte le membre
					$_SESSION['id'] = $donnees['id'];
					$message = '&lt;p&gt;Vous avez bien été inscrit !
					&lt;a href=&quot;./index.php&quot;&gt;Cliquez ici&lt;/a&gt; 
					pour revenir à la page d\'accueil&lt;/p&gt;'; // Message
				}
			} else { // Pas assez d'infos : on les demande
				if (!isset($displayName))
					$displayName = '';
				if (!isset($email))
					$email = '';
				$message = '&lt;p&gt;Veuillez renseigner les champs ci-dessous pour vous inscrire :&lt;/p&gt;
				&lt;form action=&quot;./inscriptionjanrain.php&quot; method=&quot;post&quot;&gt;
				&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;'.$token.'&quot;/&gt;
				Pseudo : &lt;input type=&quot;text&quot; name=&quot;pseudo&quot; value=&quot;'.$displayName.'&quot;/&gt;
				E-mail : &lt;input type=&quot;text&quot; name=&quot;email&quot; value=&quot;'.$email.'&quot;/&gt;
				&lt;input type=&quot;submit&quot; value=&quot;M\'inscrire !&quot;/&gt;
				&lt;/form&gt;';
			}
		}

	} else { /* Une erreur est survenue */
		// On affiche l'erreur
		echo 'Une erreur est survenue : ' . $auth_info['err']['msg'];
	}
}
echo $message;
?&gt;</code></pre>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic">Inscrivez et connectez vos membres en un clic !</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/presentation-de-janrain">
Présentation de Janrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/la-base-du-systeme">
La base du système
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-1-ajoutez-des-fournisseurs">
Étape 1 : ajoutez des fournisseurs !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-2-integrer-janrain-dans-votre-site">
Étape 2 : intégrer JanRain dans votre site
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-3-l-inscription">
Étape 3 : l&#039;inscription
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-4-la-connexion">
Étape 4 : la connexion
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-2-integrer-janrain-dans-votre-site">
<span class="arrow"></span>
<span class="next">Étape 2 : intégrer JanRain dans votre site</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-4-la-connexion">
<span class="next">Étape 4 : la connexion</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="tape4laconnexion"></a><h2>Étape 4 : la connexion</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-3-l-inscription">
<span class="arrow"></span>
<span class="next">Étape 3 : l&#039;inscription</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-557882" data-claire-element-id="557882">Nous allons ici coder la page <strong>connexionjanrain.php</strong>, elle permet au visiteur de se connecter avec un compte externe.</p><h2 id="r-reflechissons-1" data-claire-element-id="557887">Réfléchissons...</h2><p id="r-557883" data-claire-element-id="557883">On pourra alors voir si l'<em>identifier</em> est déjà stocké dans la BDD ou non à chaque connexion avec JanRain. S'il l'est, on a juste à identifier le membre en question. Sinon, on vérifiera si l'adresse e-mail du visiteur est déjà enregistrée dans la BDD. Si elle l'est, on demande la confirmation au membre, sinon, on lui demande de se connecter « à l'ancienne ». Une fois connecté, on sauvegardera le lien dans la BDD, sur la même ligne que ce membre.<br/> Voici un petit schéma qui permet de s'y retrouver plus simplement :</p><figure id="r-557885" data-claire-element-id="557886"><img id="r-557884" data-claire-element-id="557884" src="medias/uploads.siteduzero.com_files_241001_242000_241958.png" alt="Shema de fonctionnement de la connexion avec JanRain"/></figure><h2 id="r-codons-11" data-claire-element-id="557907">Codons !</h2><p id="r-557888" data-claire-element-id="557888">Tout d'abord, il faut vérifier si l'<em>identifier</em> est déjà stocké dans votre BDD (placez ce code à la place de l'étape 5 du code de base, dans connexionjanrain.php) :</p><pre id="r-557889" data-claire-element-id="557889"><code data-claire-semantic="html+php">&lt;?php
// On compte le nombre de membres ayant pour identifier celui retourné par JanRain
$nombreResulat = $connexion-&gt;query('SELECT COUNT(*) FROM membres WHERE identifier = \''.$identifier.'\'')-&gt;fetchColumn();
if ($nombreResulat == 1) { // S'il y a un résultat
	$query = $connexion-&gt;query('SELECT pseudo, id FROM membres WHERE identifier = \''.$identifier.'\'');
	$donnees = $query-&gt;fetch(PDO::FETCH_ASSOC); // On met en forme la réponse de la BDD
?&gt;</code></pre><p id="r-557890" data-claire-element-id="557890">Les commentaires devraient suffire pour comprendre le code.<br/> Ensuite, il faut identifier le membre. Placez ce code juste à la suite de celui ci-dessus :</p><pre id="r-557891" data-claire-element-id="557891"><code data-claire-semantic="html+php">&lt;?php
	$_SESSION['pseudo'] = $donnees['pseudo'];
	$_SESSION['id'] = $donnees['id'];
	$message = '&lt;p&gt;Bienvenue '.htmlspecialchars($donnees['pseudo']).', 
	vous êtes maintenant connecté !&lt;/p&gt;
	&lt;p&gt;Cliquez &lt;a href=&quot;./index.php&quot;&gt;ici&lt;/a&gt; 
	pour revenir à la page d\'accueil&lt;/p&gt;';
}
?&gt;</code></pre><p id="r-557892" data-claire-element-id="557892">On définit ici les différentes variables de session.<br/> Si l'<em>identifier</em> n'est pas enregistré et que le fournisseur a retourné un e-mail, on vérifie si l'e-mail est dans la BDD. Si oui, on demande la confirmation :</p><pre id="r-557893" data-claire-element-id="557893"><code data-claire-semantic="html+php">&lt;?php
} elseif (isset($email)) {
	// On compte le nombre de membres ayant pour e-mail celui retourné par JanRain
	$nombreResulat = $connexion-&gt;query('SELECT COUNT(*) FROM membres WHERE mail = \''.$email.'\'')-&gt;fetchColumn();
	if ($nombreResulat == 1) { // S'il y a un résultat
		$query = $connexion-&gt;query('SELECT id, pseudo FROM membres WHERE mail = \''.$email.'\'');
		$donnees = $query-&gt;fetch(PDO::FETCH_ASSOC);
		$message = '&lt;p&gt;Vous pouvez vous connecter avec un compte externe en cliquant seulement sur un bouton ! Seulement, êtes-vous bien &lt;strong&gt;'.$donnees['pseudo'].'&lt;/strong&gt; ? Cette question ne vous sera plus posée à l\'avenir.&lt;/p&gt;
		&lt;form action=&quot;?JanRain_lier&quot;&gt;
		&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;'.$token.'&quot;/&gt;
		&lt;input type=&quot;submit&quot; value=&quot;Oui&quot;/&gt; &lt;a href=&quot;./connexion.php&quot;&gt;&lt;input type=&quot;button&quot; value=&quot;Non&quot;/&gt;&lt;/a&gt;
		&lt;/form&gt;';
	}
?&gt;</code></pre><p id="r-557894" data-claire-element-id="557894">Sinon, on demande au membre de se connecter normalement :</p><pre id="r-557895" data-claire-element-id="557895"><code data-claire-semantic="html+php">&lt;?php
	else { // S'il n'y a pas de résultat
		$message = '&lt;p&gt;Vous pouvez vous connecter avec un compte externe en cliquant seulement sur un bouton ! Seulement, nous vous demandons de vous connecter avec votre compte sur ce site. Cette question ne vous sera plus posée à l\'avenir.&lt;/p&gt;
		&lt;form action=&quot;?JanRain_lier&quot; method=&quot;post&quot;&gt;
		&lt;input type=&quot;text&quot; name=&quot;pseudo&quot;/&gt;
		&lt;input type=&quot;password&quot; name=&quot;password&quot;/&gt;
		&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;'.$token.'&quot;/&gt;
		&lt;input type=&quot;submit&quot; value=&quot;Valider&quot;/&gt;
		&lt;/form&gt;'; // Formulaire de connexion
	}
} else { // S'il n'y a pas d'e-mail
	$message = '&lt;p&gt;Vous pouvez vous connecter avec un compte externe en cliquant seulement sur un bouton ! Seulement, nous vous demandons de vous connecter avec votre compte sur ce site. Cette question ne vous sera plus posée à l\'avenir.&lt;/p&gt;
	&lt;form action=&quot;?JanRain_lier&quot; method=&quot;post&quot;&gt;
	&lt;input type=&quot;text&quot; name=&quot;pseudo&quot;/&gt;
	&lt;input type=&quot;password&quot; name=&quot;password&quot;/&gt;
	&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;'.$token.'&quot;/&gt;
	&lt;input type=&quot;submit&quot; value=&quot;Valider&quot;/&gt;
	&lt;/form&gt;
	&lt;/div&gt;'; // Formulaire de connexion
}
?&gt;</code></pre><p id="r-557896" data-claire-element-id="557896">Enfin !<br/> Pour la suite, il faut vérifier si le membre demande de lier un compte :</p><pre id="r-557897" data-claire-element-id="557897"><code data-claire-semantic="html+php">&lt;?php
if (isset($_GET['JanRain_lier'])) { // Si on demande de lier un compte
	if (isset($_SESSION['id'])) { // Si le membre s'est connecté
		$query = $connexion-&gt;prepare('UPDATE membres SET identifier = ? WHERE id = ?'); // On change l'identifier du membre dans la BDD
		$req-&gt;execute(array($identifier, $_SESSION['id']));
		echo '&lt;p&gt;Le compte a bien été lié. Vous n\'avez qu\'à cliquer sur un bouton pour vous connecter !&lt;/p&gt;'; // Message
	} else { // Sinon, il n'est pas connecté
		$query = $connexion-&gt;prepare('UPDATE membres SET identifier = ? WHERE mail = ?'); // On modifie la table
		$req-&gt;execute(array($identifier, $email));
		$query = $connexion-&gt;query('SELECT id, pseudo FROM membres WHERE mail = \''.$email.'\''); // On récupère les données concernant le membre
		$donnees = $query-&gt;fetch(PDO::FETCH_ASSOC);
		$_SESSION['pseudo'] = $donnees['pseudo']; // On connecte le membre
		$_SESSION['id'] = $donnees['id'];
		$message = '&lt;p&gt;Le compte a bien été lié. Vous n\'avez qu\'à cliquer sur un bouton pour vous connecter !&lt;/p&gt;'; // Message
	}
}
?&gt;</code></pre><p id="r-557898" data-claire-element-id="557898">C'est tout !<br/> Voici le code complet :</p><pre id="r-557899" data-claire-element-id="557899"><code data-claire-semantic="html+php">&lt;?php
// Ici, un script basique pour recevoir les données des fournisseurs (requiert PHP 5 ou plus)
// Vous devez avoir installé CURL HTTP fetching library

$JanRainApiKey = 'REMPLACEZ_CE_TEXTE_AVEC_VOTRE_CLEF_API';  

if(isset($_POST['token'])) { // Si l'utilisateur tente de se connecter avec JanRain

	/* ÉTAPE 1 : récupérer le paramètre token */
	$token = $_POST['token'];

	/* ÉTAPE 2 : utiliser le token pour envoyer une requête vers le serveur de JanRain, qui interrogera à son tour le fournisseur */
	$post_data = array('token' =&gt; $_POST['token'],
		'apiKey' =&gt; $JanRainApiKey,
		'format' =&gt; 'json'); 

	$curl = curl_init(); // Initialisation
	curl_setopt($curl, CURLOPT_RETURNTRANSFER, true); // Retourne le résultat du transfert au lieu de l'afficher
	curl_setopt($curl, CURLOPT_URL, 'https://rpxnow.com/api/v2/auth_info'); // On définit l'URL cible à récupérer
	curl_setopt($curl, CURLOPT_POST, true); // On dit à PHP de faire un HTTP POST (comme pour les formulaires)
	curl_setopt($curl, CURLOPT_POSTFIELDS, $post_data); // Données à fournir par HTTP POST
	curl_setopt($curl, CURLOPT_HEADER, false); // On dit de ne pas renvoyer l'en-tête dans la valeur de retour
	curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false); // On ne vérifie pas le certificat SSL
	$raw_json = curl_exec($curl); // On exécute la requête
	curl_close($curl); // On ferme la connexion


	/* ÉTAPE 3 : décoder la réponse Json */
	$auth_info = json_decode($raw_json, true);

	if ($auth_info['stat'] == 'ok') { // Si tout est OK
  
		/* ÉTAPE 4 : récupérer les infos à partir de la réponse */
		$profile = $auth_info['profile']; // Les infos sur le membre
		$identifier = $profile['identifier']; // Le lien

		if (isset($profile['photo']))  { // Avatar
			$photo_url = $profile['photo'];
		}

		if (isset($profile['displayName']))  { // Nom à afficher
			$displayName = $profile['displayName'];
		}

		if (isset($profile['email']))  { // E-mail
			$email = $profile['email'];
		}

		session_start(); // On démarre les sessions
		// Connexion à la BDD
		$PARAM_hote='localhost'; // Le chemin vers le serveur
		$PARAM_port='3306';
		$PARAM_nom_bd='monsite'; // Le nom de votre base de données
		$PARAM_utilisateur='root'; // Nom d'utilisateur pour se connecter
		$PARAM_mot_passe=''; // Mot de passe de l'utilisateur pour se connecter
		try {
			$connexion = new PDO('mysql:host='.$PARAM_hote.';port='.$PARAM_port.';dbname='.$PARAM_nom_bd, $PARAM_utilisateur, $PARAM_mot_passe);
		} catch(Exception $e) {
			echo 'Erreur : '.$e-&gt;getMessage().'&lt;br /&gt;';
			echo 'N° : '.$e-&gt;getCode();
		}
		$connexion-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_WARNING); // Lance une alerte à chaque requête échouée

		// On compte le nombre de membres ayant pour identifier celui retourné par JanRain
		$nombreResulat = $connexion-&gt;query('SELECT COUNT(*) FROM membres WHERE identifier = \''.$identifier.'\'')-&gt;fetchColumn();
		if ($nombreResulat == 1) { // S'il y a un résultat
			$query = $connexion-&gt;query('SELECT pseudo, id FROM membres WHERE identifier = \''.$identifier.'\'');
			$donnees = $query-&gt;fetch(PDO::FETCH_ASSOC); // On met en forme la réponse de la BDD
			$_SESSION['pseudo'] = $donnees['pseudo'];
			$_SESSION['id'] = $donnees['id']; // On identifie le membre
			$message = '&lt;p&gt;Bienvenue '.htmlspecialchars($donnees['pseudo']).', 
			vous êtes maintenant connecté !&lt;/p&gt;
			&lt;p&gt;&lt;a href=&quot;./index.php&quot;&gt;Cliquez ici&lt;/a&gt; 
			pour revenir à la page d\'accueil&lt;/p&gt;'; // Message
		} elseif (isset($email)) {
			// On compte le nombre de membres ayant pour e-mail celui retourné par JanRain
			$nombreResulat = $connexion-&gt;query('SELECT COUNT(*) FROM membres WHERE mail = \''.$email.'\'')-&gt;fetchColumn();
			if ($nombreResulat == 1) { // S'il y a un résultat
				$query = $connexion-&gt;query('SELECT id, pseudo FROM membres WHERE mail = \''.$email.'\'');
				$donnees = $query-&gt;fetch(PDO::FETCH_ASSOC);
				$message = '&lt;p&gt;Vous pouvez vous connecter avec un compte externe en cliquant seulement sur un bouton ! Seulement, êtes-vous bien &lt;strong&gt;'.$donnees['pseudo'].'&lt;/strong&gt; ? Cette question ne vous sera plus posée à l\'avenir.&lt;/p&gt;
				&lt;form action=&quot;?JanRain_lier&quot;&gt;
				&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;'.$token.'&quot;/&gt;
				&lt;input type=&quot;submit&quot; value=&quot;Oui&quot;/&gt; &lt;a href=&quot;./connexion.php&quot;&gt;&lt;input type=&quot;button&quot; value=&quot;Non&quot;/&gt;&lt;/a&gt;
				&lt;/form&gt;';
			} else { // S'il n'y a pas de résultat
				$message = '&lt;p&gt;Vous pouvez vous connecter avec un compte externe en cliquant seulement sur un bouton ! Seulement, nous vous demandons de vous connecter avec votre compte sur ce site. Cette question ne vous sera plus posée à l\'avenir.&lt;/p&gt;
				&lt;form action=&quot;?JanRain_lier&quot; method=&quot;post&quot;&gt;
				&lt;input type=&quot;text&quot; name=&quot;pseudo&quot;/&gt;
				&lt;input type=&quot;password&quot; name=&quot;password&quot;/&gt;
				&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;'.$token.'&quot;/&gt;
				&lt;input type=&quot;submit&quot; value=&quot;Valider&quot;/&gt;
				&lt;/form&gt;'; // Formulaire de connexion
			}
		} else { // S'il n'y a pas d'e-mail
			$message = '&lt;p&gt;Vous pouvez vous connecter avec un compte externe en cliquant seulement sur un bouton ! Seulement, nous vous demandons de vous connecter avec votre compte sur ce site. Cette question ne vous sera plus posée à l\'avenir.&lt;/p&gt;
			&lt;form action=&quot;?JanRain_lier&quot; method=&quot;post&quot;&gt;
			&lt;input type=&quot;text&quot; name=&quot;pseudo&quot;/&gt;
			&lt;input type=&quot;password&quot; name=&quot;password&quot;/&gt;
			&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;'.$token.'&quot;/&gt;
			&lt;input type=&quot;submit&quot; value=&quot;Valider&quot;/&gt;
			&lt;/form&gt;'; // Formulaire de connexion
		}

		if (isset($_GET['JanRain_lier'])) { // Si on demande de lier un compte
			if (isset($_SESSION['id'])) { // Si le membre s'est connecté
				$query = $connexion-&gt;prepare('UPDATE membres SET identifier = ? WHERE id = ?'); // On change l'identifier du membre de la BDD
				$req-&gt;execute(array($identifier, $_SESSION['id']));
				echo '&lt;p&gt;Le compte a bien été lié. Vous n\'avez qu\'à cliquer sur un bouton pour vous connecter !&lt;/p&gt;'; // Message
			} else { // Sinon, il n'est pas connecté
				$query = $connexion-&gt;prepare('UPDATE membres SET identifier = ? WHERE mail = ?'); // On modifie la table
				$req-&gt;execute(array($identifier, $email));
				$query = $connexion-&gt;query('SELECT id, pseudo FROM membres WHERE mail = \''.$email.'\''); // On récupère les données concernant le membre
				$donnees = $query-&gt;fetch(PDO::FETCH_ASSOC);
				$_SESSION['pseudo'] = $donnees['pseudo']; // On connecte le membre
				$_SESSION['id'] = $donnees['id'];
				$message = '&lt;p&gt;Le compte a bien été lié. Vous n\'avez qu\'à cliquer sur un bouton pour vous connecter !&lt;/p&gt;'; // Message
			}
		}

	} else { /* Une erreur est survenue */
		// On affiche l'erreur
		echo 'Une erreur est survenue : ' . $auth_info['err']['msg'];
	}
}
echo $message;
?&gt;</code></pre><p id="r-557900" data-claire-element-id="557900">Voila, vous avez maintenant un module fonctionnel d'inscription et connexion en un clic ! Bonne route avec JanRain ! :) <br/> Voici quelques liens utiles :</p><ul id="r-557905" data-claire-element-id="557905"><li id="r-557902" data-claire-element-id="557902"><p id="r-557901" data-claire-element-id="557901">Forum officiel des développeurs de Janrain : <a href="http://groups.google.com/group/RPX-developers?pli=1">http://groups.google.com/group/RPX-developers?pli=1</a></p></li><li id="r-557904" data-claire-element-id="557904"><p id="r-557903" data-claire-element-id="557903">Documentation : <a href="https://rpxnow.com/docs">https://rpxnow.com/docs</a></p></li></ul><p id="r-557906" data-claire-element-id="557906">Ce tutoriel aura très bientôt une suite : nous verrons comment créer soi-même son système, en étant indépendant de Janrain. ;)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic">Inscrivez et connectez vos membres en un clic !</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/presentation-de-janrain">
Présentation de Janrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/la-base-du-systeme">
La base du système
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-1-ajoutez-des-fournisseurs">
Étape 1 : ajoutez des fournisseurs !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-2-integrer-janrain-dans-votre-site">
Étape 2 : intégrer JanRain dans votre site
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-3-l-inscription">
Étape 3 : l&#039;inscription
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-4-la-connexion">
Étape 4 : la connexion
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/inscrivez-et-connectez-vos-membres-en-un-clic/etape-3-l-inscription">
<span class="arrow"></span>
<span class="next">Étape 3 : l&#039;inscription</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/inscrivez-et-connectez-vos-membres-en-un-clic.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:19:28 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/inscrivez-et-connectez-vos-membres-en-un-clic.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:33:03 GMT -->
</html>