<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/do-comprendre-et-corriger-les-erreurs-les-plus-frequentes.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 19:57:48 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/do-comprendre-et-corriger-les-erreurs-les-plus-frequentes.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:42:54 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : PDO : comprendre et corriger les erreurs les plus fréquentes</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : PDO : comprendre et corriger les erreurs les plus fréquentes</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#PDOcomprendreetcorrigerleserreurslesplusfrquentes">PDO : comprendre et corriger les erreurs les plus fréquentes</a><br/><a href="#Unpeudevocabulaire">Un peu de vocabulaire</a><br/><a href="#Lesoptionsdeconfiguration">Les options de configuration</a><br/><a href="#Scurisersesrequtes">Sécuriser ses requêtes</a><br/><a href="#PDOStatementexecuteetletypeINT">PDOStatement::execute() et le type INT</a><br/></div>
<a name="PDOcomprendreetcorrigerleserreurslesplusfrquentes"></a><h2>PDO : comprendre et corriger les erreurs les plus fréquentes</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/un-peu-de-vocabulaire-9">
<span class="next">Un peu de vocabulaire</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-527795" data-claire-element-id="527795">Bonjour à tous ! :)</p><p id="r-527796" data-claire-element-id="527796">Vous venez d'apprendre le PHP grâce <a href="http://www.siteduzero.com/tutoriel-3-14668-concevez-votre-site-web-avec-php-et-mysql.html">au cours de M@teo21</a> ? Ou bien vous connaissez déjà le PHP mais vous souhaitez abandonner l'API MySQL pour passer à PDO ? Vous vous embrouillez avec toutes ces nouveautés ?</p><p id="r-527797" data-claire-element-id="527797">Cet article a pour objectif de vous aider à comprendre votre code, et à corriger vous-même vos erreurs les plus simples.</p><p id="r-527798" data-claire-element-id="527798">Les prérequis sont les suivants :</p><ul id="r-527804" data-claire-element-id="527804"><li id="r-527800" data-claire-element-id="527800"><p id="r-527799" data-claire-element-id="527799">avoir suivi <a href="http://www.siteduzero.com/tutoriel-3-14668-concevez-votre-site-web-avec-php-et-mysql.html">le cours de M@teo21 sur le PHP</a> et terminé la partie qui concerne la base de données (ou niveau équivalent) ;</p></li><p id="r-527801" data-claire-element-id="527801">ou</p><li id="r-527803" data-claire-element-id="527803"><p id="r-527802" data-claire-element-id="527802">avoir suivi <a href="http://www.siteduzero.com/tutoriel-3-34790-pdo-interface-d-acces-aux-bdd.html">le cours sur PDO</a> écrit par <a href="http://www.siteduzero.com/membres-294-10877.html">Draeli</a>.</p></li></ul><p id="r-527805" data-claire-element-id="527805">PDO étant un ensemble de classes, quelques notions de POO pourront vous aider. Toutefois, je définirai les termes que j'utilise dans la première partie.</p><aside id="r-527807" data-claire-element-id="527807" data-claire-semantic="warning"><p id="r-527806" data-claire-element-id="527806">Cet article n'a pas pour vocation de vous apprendre à utiliser PDO, mais de vous apprendre à comprendre ce que vous faites avec. Vous devez <strong>déjà</strong> savoir utiliser les principales méthodes des classes de PDO.</p></aside>
</div><a name="Unpeudevocabulaire"></a><h2>Un peu de vocabulaire</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/les-options-de-configuration">
<span class="next">Les options de configuration</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-introduction-81" data-claire-element-id="527810">Introduction</h2><p id="r-527808" data-claire-element-id="527808">Pour commencer, je vous propose un petit rappel sur le vocabulaire de base de la POO, <strong>car PDO est composé de trois classes</strong>. Notez que je ne vous ferai pas de cours sur la POO, d'autres s'en sont déjà chargés (<a href="http://www.siteduzero.com/tutoriel-3-232176-la-programmation-orientee-objet.html">cours de M@teo21</a>, <a href="http://www.siteduzero.com/tutoriel-3-147180-la-programmation-orientee-objet-en-php.html">cours de vyk12</a>). Je me contenterai de rappeler la définition de quelques mots-clés.</p><p id="r-527809" data-claire-element-id="527809">Si vous êtes à l'aise avec la POO, vous pouvez sauter cette partie. Si vous avez le moindre doute, je vous conseille de la lire tout de même. Vous n'en aurez que pour quelques minutes et ça ne pourra vous faire que du bien ! ;)</p><h2 id="r-quelques-definitions-3" data-claire-element-id="527821">Quelques définitions</h2><h3 id="r-classe" data-claire-element-id="527812">Classe</h3><p id="r-527811" data-claire-element-id="527811">La classe est le moule qui permettra de créer des objets. Elle contient les attributs et les méthodes qui définissent l'objet. Par exemple, <a href="http://fr2.php.net/manual/fr/class.pdo.php">PDO </a>est une classe. Il en va de même pour <a href="http://fr2.php.net/manual/fr/class.pdostatement.php">PDOStatement </a>et <a href="http://fr2.php.net/manual/fr/class.pdoexception.php">PDOException</a>.</p><h3 id="r-attribut-1" data-claire-element-id="527814">Attribut</h3><p id="r-527813" data-claire-element-id="527813">Un attribut, parfois nommé variable d'instance, est une variable propre à l'objet. Lorsque l'on conçoit une classe, il faut se poser la question <strong>« De quoi est constitué mon objet ? »</strong> pour trouver quels attributs lui donner. Par exemple, pour un objet &quot;Client&quot;, on pourra répondre à cette question en disant qu'un client est constitué d'un numéro de client, d'un prénom, d'un nom, d'une adresse, d'un numéro de téléphone etc. On créera donc autant d'attributs.</p><h3 id="r-methode-5" data-claire-element-id="527816">Méthode</h3><p id="r-527815" data-claire-element-id="527815">Une méthode est une fonction propre à l'objet. Lorsque l'on conçoit une classe, il faut se poser la question <strong>« Que peut faire mon objet ? »</strong> pour trouver quelles méthodes implémenter. Par exemple, un client peut changer de nom, d'adresse, de numéro de téléphone etc.</p><h3 id="r-instance" data-claire-element-id="527820">Instance</h3><p id="r-527817" data-claire-element-id="527817">Une instance est tout simplement un exemplaire de notre objet. En PHP, le code suivant crée une instance de l'objet &quot;Client&quot; qui sera accessible via la variable $client :</p><pre id="r-527818" data-claire-element-id="527818"><code data-claire-semantic="html+php">&lt;?php
$client = new Client();</code></pre><p id="r-527819" data-claire-element-id="527819">Cette instruction utilise le moule (la classe Client) pour créer une instance (ou occurrence) de cette classe. Cette instance possède tous les attributs et toutes les méthodes propres à la classe Client.</p><h2 id="r-recapitulatif-15" data-claire-element-id="527823">Récapitulatif</h2><pre id="r-527822" data-claire-element-id="527822"><code data-claire-semantic="html+php">&lt;?php
class Classe // Ici on déclare la classe.
{
	// Ici on déclare les attributs de la classe :
	private $attribut1 = 0;
	private $attribut2 = '';
	
	// Ceci est une méthode de la classe Classe :
	public function methode()
	{
		// Instructions de la méthode.
	}
}

$classe = new Classe(); // On construit une instance de la classe Classe.
/*
 * Cette instance possède tous les attributs et toutes les méthodes
 * de la classe Classe : attribut1, attribut2 et methode().
 */</code></pre><h2 id="r-une-convention-d-ecriture-a-connaitre" data-claire-element-id="527831">Une convention d'écriture à connaître</h2><p id="r-527824" data-claire-element-id="527824">Pour désigner la méthode d'une classe, les programmeurs ont l'habitude de faire précéder son nom de celui de sa classe puis d'un double deux-points &quot;<strong>::</strong>&quot; , afin de savoir au premier coup d'œil à quelle classe elle appartient, et de ne pas la confondre avec une méthode homonyme d'une autre classe.<br/> Par exemple, pour désigner la méthode methode() de la classe Classe j'écrirai <strong>Classe::methode()</strong>, et pour la méthode query() de la classe PDO j'écrirai <strong>PDO::query()</strong>.</p><p id="r-527825" data-claire-element-id="527825">Ce sera tout pour le vocabulaire ! Si vous n'avez pas compris ces quelques termes, je vous conseille de jeter un œil à l'un des cours que j'ai cités tout à l'heure :</p><ul id="r-527830" data-claire-element-id="527830"><li id="r-527827" data-claire-element-id="527827"><p id="r-527826" data-claire-element-id="527826"><a href="http://www.siteduzero.com/tutoriel-3-232176-la-programmation-orientee-objet.html">la POO en PHP selon M@teo21</a> ;</p></li><li id="r-527829" data-claire-element-id="527829"><p id="r-527828" data-claire-element-id="527828"><a href="http://www.siteduzero.com/tutoriel-3-147180-la-programmation-orientee-objet-en-php.html">la POO en PHP selon vyk12</a>.</p></li></ul>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes">PDO : comprendre et corriger les erreurs les plus fréquentes</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/un-peu-de-vocabulaire-9">
Un peu de vocabulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/les-options-de-configuration">
Les options de configuration
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/securiser-ses-requetes">
Sécuriser ses requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/pdostatement-execute-et-le-type-int">
PDOStatement::execute() et le type INT
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/les-options-de-configuration">
<span class="next">Les options de configuration</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesoptionsdeconfiguration"></a><h2>Les options de configuration</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/un-peu-de-vocabulaire-9">
<span class="arrow"></span>
<span class="next">Un peu de vocabulaire</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/securiser-ses-requetes">
<span class="next">Sécuriser ses requêtes</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-introduction-82" data-claire-element-id="527839">Introduction</h2><ul id="r-527837" data-claire-element-id="527837"><li id="r-527834" data-claire-element-id="527834"><p id="r-527833" data-claire-element-id="527833">Ma requête ne fonctionne pas, et pourtant je n'ai aucun message d'erreur !</p></li><li id="r-527836" data-claire-element-id="527836"><p id="r-527835" data-claire-element-id="527835">J'ai une erreur &quot;Call to a member function fetch() on a non-object&quot;. Je ne comprends pas, pourtant j'appelle la méthode comme dans le tuto !</p></li></ul><p id="r-527838" data-claire-element-id="527838">Hé oui ! Il faut savoir que par défaut, PDO n'affiche pas les erreurs SQL. Or, en tant que développeur, vous devez <strong>aimer</strong> les messages d'erreurs ! Si, si ! Sans eux, on n'a aucune idée de l'endroit où l'on s'est trompé. Parfois même, ils nous disent ce qui ne va pas.<br/> La preuve qu'ils sont utiles : PDO n'affiche pas les erreurs, et vous êtes perdu. ;)</p><h2 id="r-des-erreurs-mysterieuses" data-claire-element-id="527860">Des erreurs mystérieuses</h2><div id="r-527841" data-claire-element-id="527841" data-claire-semantic="question"><p id="r-527840" data-claire-element-id="527840">Bon, j'ai compris pourquoi quand je faisais une erreur SQL, je n'avais pas de message d'erreur. Mais pourquoi est-ce que parfois j'ai une erreur sur le fetch(), alors ?</p></div><p id="r-527842" data-claire-element-id="527842">Hé bien tout d'abord, il faut se souvenir que l'on travaille avec deux langages :</p><ul id="r-527847" data-claire-element-id="527847"><li id="r-527844" data-claire-element-id="527844"><p id="r-527843" data-claire-element-id="527843">PHP ;</p></li><li id="r-527846" data-claire-element-id="527846"><p id="r-527845" data-claire-element-id="527845">SQL.</p></li></ul><p id="r-527848" data-claire-element-id="527848">Or, PDO ne vous montre pas les erreurs SQL. Les erreurs PHP ne sont pas influencées par PDO, elles sont influencées par la configuration de PHP.<br/> Autrement dit, l'erreur que vous pouvez voir sur le fetch() est une erreur PHP causée indirectement <strong>par une erreur SQL que vous ne voyez pas</strong>.</p><p id="r-527849" data-claire-element-id="527849">Prenons un code de base de sélection de données avec PDO :</p><pre id="r-527850" data-claire-element-id="527850"><code data-claire-semantic="html+php">&lt;?php
$stmt = $pdo-&gt;query('SELECT id, auteur, contenu, date FROM messages');
while($message = $stmt-&gt;fetch())
{
	// Utilisation des données.
}</code></pre><p id="r-527851" data-claire-element-id="527851">Admettons que, pour une raison ou pour une autre, ma requête échoue. Que va-t-il se passer ? Regardons la documentation de la méthode <a href="http://fr2.php.net/manual/fr/pdo.query.php">PDO::query()</a>.</p><p id="r-527852" data-claire-element-id="527852"><cite>Citation : php.net</cite></p><blockquote id="r-527854" data-claire-element-id="527854"><p id="r-527853" data-claire-element-id="527853">PDO::query() retourne un objet PDOStatement, ou FALSE si une erreur survient.</p></blockquote><p id="r-527855" data-claire-element-id="527855">Un objet de <a href="http://fr2.php.net/manual/fr/class.pdostatement.php">la classe PDOStatement</a> ? Hé oui, si vous avez la curiosité de jeter un œil à la documentation de cette classe, vous vous apercevrez que c'est cette classe qui possède la méthode fetch(). Si ma requête réussit, $stmt sera donc une instance de la classe PDOStatement. Mais si elle échoue, elle contiendra uniquement… <strong>FALSE</strong> ! :o</p><p id="r-527856" data-claire-element-id="527856">Vous avez compris ? Si la requête échoue, il n'y a pas d'objet PDOStatement (pas d'objet du tout même, on obtient un booléen !). Sans objet, pas de méthode. Par conséquent, PHP nous prévient qu'on essaie d'appeler une méthode sur quelque chose qui n'est pas un objet, et que c'est donc impossible !</p><div id="r-527858" data-claire-element-id="527858" data-claire-semantic="question"><p id="r-527857" data-claire-element-id="527857">Et pourquoi aucun message d'erreur n'est affiché parfois ?</p></div><p id="r-527859" data-claire-element-id="527859">Tout simplement parce que dans le cas d'une requête de type <strong>UPDATE</strong> ou <strong>DELETE</strong>, on n'utilise pas (ou rarement) la valeur de retour de la méthode.<br/> Vous l'aurez compris, il devient <strong>urgent</strong> de demander poliment à PDO de nous prévenir en cas de problème.</p><h2 id="r-afficher-les-erreurs-sql" data-claire-element-id="527887">Afficher les erreurs SQL</h2><p id="r-527861" data-claire-element-id="527861">Pour modifier les paramètres de PDO, nous avons deux solutions. Soit on donne les options directement au constructeur, soit on utilise la méthode <a href="http://fr2.php.net/manual/fr/pdo.setattribute.php">PDO::setAttribute()</a>. Je vais vous montrer ces deux méthodes, vous choisirez celle qui vous fait plaisir.</p><p id="r-527862" data-claire-element-id="527862">Il faut également savoir que l'on peut demander à PDO de nous avertir de deux façons :</p><ul id="r-527867" data-claire-element-id="527867"><li id="r-527864" data-claire-element-id="527864"><p id="r-527863" data-claire-element-id="527863">avec une erreur type &quot;WARNING&quot; ;</p></li><li id="r-527866" data-claire-element-id="527866"><p id="r-527865" data-claire-element-id="527865">avec une exception.</p></li></ul><p id="r-527868" data-claire-element-id="527868">Vous connaissez déjà les erreurs WARNING. Un exemple ? Vous y avez droit si vous oubliez de donner un paramètre à une fonction : &quot;<strong>Warning: Wrong parameter count for intval()</strong>&quot;. Si vous choisissez ce mode, vous aurez une erreur de ce type en cas d'erreur SQL.<br/> En ce qui concerne les exceptions, vous en avez déjà vu au moins une ! Souvenez-vous, quand vous construisiez votre objet PDO :</p><p id="r-527869" data-claire-element-id="527869"><cite>Citation : Cours de PHP</cite></p><blockquote id="r-527871" data-claire-element-id="527871"><pre id="r-527870" data-claire-element-id="527870"><code data-claire-semantic="html+php">&lt;?php
try
{
	$bdd = new PDO('mysql:host=localhost;dbname=test', 'root', '');
}
catch (Exception $e)
{
        die('Erreur : ' . $e-&gt;getMessage());
}</code></pre></blockquote><p id="r-527872" data-claire-element-id="527872">Ici, $e est une exception. Les exceptions sont lancées par l'instruction <strong>throw</strong> et peuvent être interceptées par un bloc catch(). Je ne vous en dis pas plus, je ne compte pas vous faire un cours sur les exceptions. Si vous êtes curieux, vous chercherez de votre côté.</p><h3 id="r-demander-un-warning" data-claire-element-id="527877">Demander un WARNING</h3><p id="r-527873" data-claire-element-id="527873">Sans plus attendre, voici comment demander à PDO d'afficher des erreurs WARNING en cas de problème.<br/> Vous pouvez passer un array en quatrième paramètre du constructeur. Cet array devra avoir pour clé le nom de l'attribut à modifier, et pour valeur… la valeur de l'attribut à modifier. En ce qui nous concerne, l'attribut à modifier est PDO::ATTR_ERRMODE et sa valeur PDO::ERRMODE_WARNING. On le comprend très bien : ATTR mis pour &quot;attribut&quot;, et ERRMODE pour &quot;error mode&quot;.<br/> Sinon, vous pouvez utiliser la méthode <a href="http://fr2.php.net/manual/fr/pdo.setattribute.php">PDO::setAttribute()</a>. Elle prend deux paramètres : l'attribut à modifier et sa nouvelle valeur.</p><p id="r-527874" data-claire-element-id="527874">Voyez plutôt :</p><pre id="r-527875" data-claire-element-id="527875"><code data-claire-semantic="html+php">&lt;?php
// Je donne les paramètres au constructeur :
$pdo = new PDO('mysql:host=localhost;dbname=DBNAME', 'root', '', array(PDO::ATTR_ERRMODE =&gt; PDO::ERRMODE_WARNING));</code></pre><pre id="r-527876" data-claire-element-id="527876"><code data-claire-semantic="html+php">&lt;?php
// Je construis mon objet, puis je donne le paramètre à PDO::setAttribute() :
$pdo = new PDO('mysql:host=localhost;dbname=DBNAME', 'root', '');
$pdo-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_WARNING);</code></pre><h3 id="r-demander-une-exception" data-claire-element-id="527886">Demander une EXCEPTION</h3><p id="r-527878" data-claire-element-id="527878">Allez, je suis sûr que vous pouvez trouver tout seul en cherchant la bonne valeur de l'attribut dans <a href="http://fr2.php.net/manual/fr/pdo.constants.php">la liste des constantes prédéfinies de PDO</a>.</p><p id="r-527879" data-claire-element-id="527879"></p><div id="r-527883" data-claire-element-id="527883"><p id="r-527880" data-claire-element-id="527880">PDO::ERRMODE_EXCEPTION ? Oui, bravo ! Regardez ce que ça donne :</p><pre id="r-527881" data-claire-element-id="527881"><code data-claire-semantic="html+php">&lt;?php
// Je donne les paramètres au constructeur :
$pdo = new PDO('mysql:host=localhost;dbname=DBNAME', 'root', '', array(PDO::ATTR_ERRMODE =&gt; PDO::ERRMODE_EXCEPTION ));</code></pre><pre id="r-527882" data-claire-element-id="527882"><code data-claire-semantic="html+php">&lt;?php
// Je construis mon objet, puis je donne le paramètre à PDO::setAttribute() :
$pdo = new PDO('mysql:host=localhost;dbname=DBNAME', 'root', '');
$pdo-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION );</code></pre></div><p id="r-527884" data-claire-element-id="527884">Et voilà, vos erreurs ne sont plus silencieuses ! Si vous choisissez les exceptions, mettez vos requêtes dans un bloc try/catch pour pouvoir les attraper. Un exemple ? Le voici :</p><pre id="r-527885" data-claire-element-id="527885"><code data-claire-semantic="html+php">&lt;?php
try
{
	$pdo = new PDO('mysql:host=localhost;dbname=DBNAME', 'root', '', array(PDO::ATTR_ERRMODE =&gt; PDO::ERRMODE_EXCEPTION ));
	$stmt = $pdo-&gt;query('SELECT id, auteur, contenu, DATE_FORMAT(date, &quot;%W %d %M %Y à %Hh%i&quot;) as date FROM messages');
	$messages = $stmt-&gt;fetchAll(PDO::FETCH_OBJ);
}
catch(Exception $e)
{
	exit('&lt;b&gt;Catched exception at line '. $e-&gt;getLine() .' :&lt;/b&gt; '. $e-&gt;getMessage());
}
foreach($messages as $message)
{
	echo '&lt;p&gt;Le ', $message-&gt;date, ' par ', $message-&gt;auteur, ' : &lt;br /&gt;', $message-&gt;contenu, '&lt;/p&gt;';
}</code></pre><h2 id="r-d-autres-attributs-a-modifier" data-claire-element-id="527893">D'autres attributs à modifier !</h2><p id="r-527888" data-claire-element-id="527888">Si vous regardez plus en détail <a href="http://fr2.php.net/manual/fr/pdo.constants.php">la liste des constantes de PDO</a> que je vous ai montrée tout à l'heure, vous vous apercevrez que ERRMODE n'est pas le seul attribut modifiable. Par exemple, j'aime bien modifier le DEFAULT_FETCH_MODE, plutôt que de le donner à chaque fois à mes méthodes PDOStatement::fetch() ou PDOStatement::fetchAll().<br/> Si vous êtes attentif, vous remarquerez que toutes les constantes qui commencent par PDO::ATTR_ sont des attributs que l'on peut modifier. Par exemple pour le fetch mode par défaut : PDO::ATTR_DEFAULT_FETCH_MODE fera l'affaire. Les valeurs possibles pour cet attribut sont les constantes qui commencent par PDO::FETCH_.</p><p id="r-527889" data-claire-element-id="527889">En bonus, voici comment je construis mon propre objet PDO. À vous d'adapter ce code selon vos goûts et vos besoins :</p><pre id="r-527890" data-claire-element-id="527890"><code data-claire-semantic="html+php">&lt;?php
try
{
	$db_config = array();
	$db_config['SGBD']	= 'mysql';
	$db_config['HOST']	= 'localhost';
	$db_config['DB_NAME']	= 'tests';
	$db_config['USER']	= 'root';
	$db_config['PASSWORD']	= '';
	$db_config['OPTIONS']	= array(
		// Activation des exceptions PDO :
		PDO::ATTR_ERRMODE =&gt; PDO::ERRMODE_EXCEPTION,
		// Change le fetch mode par défaut sur FETCH_ASSOC ( fetch() retournera un tableau associatif ) :
		PDO::ATTR_DEFAULT_FETCH_MODE =&gt; PDO::FETCH_ASSOC
	);
	
	$pdo = new PDO($db_config['SGBD'] .':host='. $db_config['HOST'] .';dbname='. $db_config['DB_NAME'],
	$db_config['USER'],
	$db_config['PASSWORD'],
	$db_config['OPTIONS']);
	unset($db_config);
}
catch(Exception $e)
{
	trigger_error($e-&gt;getMessage(), E_USER_ERROR);
}</code></pre><aside id="r-527892" data-claire-element-id="527892" data-claire-semantic="information"><p id="r-527891" data-claire-element-id="527891">N'hésitez pas à parcourir <a href="http://fr2.php.net/manual/fr/book.pdo.php">la documentation des trois classes qui composent PDO</a> pour apprendre à les utiliser.</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes">PDO : comprendre et corriger les erreurs les plus fréquentes</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/un-peu-de-vocabulaire-9">
Un peu de vocabulaire
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/les-options-de-configuration">
Les options de configuration
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/securiser-ses-requetes">
Sécuriser ses requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/pdostatement-execute-et-le-type-int">
PDOStatement::execute() et le type INT
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/un-peu-de-vocabulaire-9">
<span class="arrow"></span>
<span class="next">Un peu de vocabulaire</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/securiser-ses-requetes">
<span class="next">Sécuriser ses requêtes</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Scurisersesrequtes"></a><h2>Sécuriser ses requêtes</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/les-options-de-configuration">
<span class="arrow"></span>
<span class="next">Les options de configuration</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/pdostatement-execute-et-le-type-int">
<span class="next">PDOStatement::execute() et le type INT</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-introduction-83" data-claire-element-id="527897">Introduction</h2><p id="r-527895" data-claire-element-id="527895">On parle beaucoup des injections SQL. Cette technique consiste à écrire du code SQL dans un champ de texte pour détourner l'utilisation d'une requête <em>a priori</em> inoffensive pour une utilisation malveillante.<br/> Sur les forums, je lis souvent « avec PDO, pas besoin de sécuriser ses requêtes, ça le fait tout seul ».<br/> Ceci est <strong>faux</strong>.</p><p id="r-527896" data-claire-element-id="527896">Cette affirmation résulte d'une confusion entre PDO et les requêtes préparées. Comme je l'ai déjà dit, cet article n'a pas vocation à vous apprendre à utiliser ce genre de chose. D'autres s'en chargent bien mieux que moi dans <a href="http://www.siteduzero.com/tutoriel-3-14506-lire-des-donnees.html">le tutoriel de M@teo21</a> ou <a href="http://www.siteduzero.com/tutoriel-3-34790-pdo-interface-d-acces-aux-bdd.html">celui de Draeli</a>.<br/> En revanche, je vais vous expliquer dans quel cas il faut se protéger, et comment.</p><h2 id="r-une-histoire-de-types" data-claire-element-id="527906">Une histoire de types</h2><p id="r-527898" data-claire-element-id="527898">Il y a deux catégories de variables que l'on utilise dans une requête SQL : les nombres (int, float, double…) et les chaînes de caractères.<br/> Or, une injection SQL est constituée de code SQL, et donc de texte. Cela signifie qu'une variable qui contient <strong>uniquement</strong> un nombre n'est pas dangereuse.</p><p id="r-527899" data-claire-element-id="527899">Seulement voilà, il existe une règle très importante en informatique : <strong>never trust user input</strong>, soit en français &quot;ne faites jamais confiance aux données entrées par l'utilisateur&quot;. En effet, celui-ci peut se tromper ou pire : tenter d'insérer un code malveillant !<br/> Avant d'utiliser une variable utilisateur (c'est-à-dire les variables dont la valeur peut être influencée par l'utilisateur) <strong>censée</strong> contenir un nombre, il faut vérifier qu'elle en contient effectivement un.</p><p id="r-527900" data-claire-element-id="527900">Pour cela plusieurs solutions s'offrent à vous. Soit vous faites une condition avec une fonction is_<em>type</em>(), comme par exemple <a href="http://fr.php.net/manual/fr/function.is-int.php">is_int()</a>. Soit vous convertissez (on peut aussi dire &quot;transtyper&quot;) cette valeur en nombre.<br/> Voici deux façons de procéder pour réaliser cette conversion (ou &quot;cast&quot; en anglais) :</p><pre id="r-527901" data-claire-element-id="527901"><code data-claire-semantic="html+php">&lt;?php
// Première méthode : en précisant le type de destination.
$id = (int) $_GET['id'];

// Seconde méthode : en utilisant la fonction intval().
$id = intval($_GET['id']);</code></pre><p id="r-527902" data-claire-element-id="527902">Si la variable ne contenait pas un nombre entier, alors sa nouvelle valeur sera 0. C'est très pratique lorsque l'on sait que les champs auto-incrémentés commencent à 1. Si après la conversion vous obtenez 0 : soit la variable ne contenait pas un entier, soit elle contenait zéro. Quoi qu'il arrive nous n'aurions pas pu trouver d'identifiant correspondant.</p><p id="r-527903" data-claire-element-id="527903">Lorsque vous voulez récupérer un identifiant auto_increment, vous pouvez donc procéder comme ceci :</p><pre id="r-527904" data-claire-element-id="527904"><code data-claire-semantic="html+php">&lt;?php
$id = (int) $_GET['id'];
if($id &lt;= 0)
{
	/* L'identifiant est invalide. Vous pouvez faire une redirection,
	 * un message d'erreur… bref ce que vous voulez !
	 */
}
else
{
	// Faites votre requête en toute confiance : un nombre entier, c'est inoffensif !
}</code></pre><p id="r-527905" data-claire-element-id="527905">Voilà pour les nombres. Ce n'est pas très compliqué, il suffit de vérifier que la variable sur laquelle on travaille est effectivement un nombre.<br/> En revanche, pour les chaînes de caractères… cela va dépendre de comment vous procédez !</p><h2 id="r-les-requetes-preparees-3" data-claire-element-id="527916">Les requêtes préparées</h2><p id="r-527907" data-claire-element-id="527907">Bon nombre de Zéros comprennent mal le fonctionnement des requêtes préparées. On leur a dit &quot;avec une requête préparée, on ne peut pas subir d'injection SQL&quot;. C'est vrai, <strong>mais seulement si on utilise correctement les requêtes préparées</strong> !</p><p id="r-527908" data-claire-element-id="527908">Pour faire simple, toutes les données que vous envoyez à la requête via <a href="http://fr2.php.net/manual/fr/pdostatement.bindvalue.php">PDOStatement::bindValue()</a>, <a href="http://fr2.php.net/manual/fr/pdostatement.bindparam.php">PDOStatement::bindParam()</a> ou <a href="http://fr2.php.net/manual/fr/pdostatement.execute.php">PDOStatement::execute()</a> ne risquent pas de provoquer une injection.<br/> Si vous voulez comprendre pourquoi, je vous conseille <a href="http://www.siteduzero.com/tutoriel-3-36596-requete-preparee.html#ss_part_1">cet article de Draeli</a> qui explique le mécanisme des requêtes préparées.</p><p id="r-527909" data-claire-element-id="527909">En revanche, toutes les variables utilisateur qui sont présentes dans la chaîne de caractères donnée en paramètre à <a href="http://fr2.php.net/manual/fr/pdo.prepare.php">PDO::prepare()</a> peuvent causer une injection SQL ! En théorie, aucune variable utilisateur ne devrait se trouver ici. Vous devriez utiliser une des trois fonctions que j'ai citées plus haut. Toutefois, si cela s'avère indispensable, vous pouvez utiliser la même méthode que celle que je vais vous donner pour <a href="http://fr2.php.net/manual/fr/pdo.query.php">PDO::query()</a> et <a href="http://fr2.php.net/manual/fr/pdo.exec.php">PDO::exec()</a>.</p><p id="r-527910" data-claire-element-id="527910">Un exemple de <strong>faille </strong>:</p><pre id="r-527911" data-claire-element-id="527911"><code data-claire-semantic="html+php">&lt;?php
$stmt = $pdo-&gt;prepare(&quot;SELECT * FROM membres WHERE pseudo = $pseudo&quot;);
$stmt-&gt;execute();</code></pre><p id="r-527912" data-claire-element-id="527912">Voici une vraie requête préparée :</p><pre id="r-527913" data-claire-element-id="527913"><code data-claire-semantic="html+php">&lt;?php
$stmt = $pdo-&gt;prepare(&quot;SELECT * FROM membres WHERE pseudo = :pseudo&quot;);
$stmt-&gt;execute(array('pseudo' =&gt; $pseudo));</code></pre><p id="r-527914" data-claire-element-id="527914">Et encore plus joli !</p><pre id="r-527915" data-claire-element-id="527915"><code data-claire-semantic="html+php">&lt;?php
$stmt = $pdo-&gt;prepare(&quot;SELECT * FROM membres WHERE pseudo = :pseudo&quot;);
$stmt-&gt;bindValue('pseudo', $pseudo, PDO::PARAM_STR);
$stmt-&gt;execute();</code></pre><h2 id="r-les-methodes-pdo-query-et-pdo-exec" data-claire-element-id="527920">Les méthodes PDO::query() et PDO::exec()</h2><p id="r-527917" data-claire-element-id="527917">Si pour une raison ou pour une autre, vous n'utilisez pas une requête préparée, alors toutes vos variables qui contiennent des chaînes de caractères doivent être protégées à l'aide de la méthode <a href="http://fr2.php.net/manual/fr/pdo.quote.php">PDO::quote()</a>.<br/> Comment ça &quot;encore une méthode&quot; ? Allez, ne faites pas la tête, cette méthode s'occupe de tout ! Elle entoure même votre chaîne de caractères avec des guillemets !</p><pre id="r-527918" data-claire-element-id="527918"><code data-claire-semantic="html+php">&lt;?php
$stmt = $pdo-&gt;query('SELECT id FROM membres WHERE pseudo = '. $pdo-&gt;quote($_POST['pseudo']));</code></pre><pre id="r-527919" data-claire-element-id="527919"><code data-claire-semantic="html+php">&lt;?php
$pdo-&gt;exec('INSERT INTO livre_or(pseudo, message, date_post) VALUES('. $pdo-&gt;quote($_POST['pseudo']) .', '. $pdo-&gt;quote($_POST['message']) .', NOW())');</code></pre>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes">PDO : comprendre et corriger les erreurs les plus fréquentes</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/un-peu-de-vocabulaire-9">
Un peu de vocabulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/les-options-de-configuration">
Les options de configuration
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/securiser-ses-requetes">
Sécuriser ses requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/pdostatement-execute-et-le-type-int">
PDOStatement::execute() et le type INT
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/les-options-de-configuration">
<span class="arrow"></span>
<span class="next">Les options de configuration</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/pdostatement-execute-et-le-type-int">
<span class="next">PDOStatement::execute() et le type INT</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="PDOStatementexecuteetletypeINT"></a><h2>PDOStatement::execute() et le type INT</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/securiser-ses-requetes">
<span class="arrow"></span>
<span class="next">Sécuriser ses requêtes</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-les-symptomes" data-claire-element-id="527945">Les symptômes</h2><p id="r-527922" data-claire-element-id="527922">Une erreur très fréquente est basée sur le comportement de <a href="http://fr.php.net/manual/fr/pdostatement.execute.php">PDOStatement::execute()</a>.<br/> Essayez donc ce genre de requête :</p><pre id="r-527923" data-claire-element-id="527923"><code data-claire-semantic="html+php">&lt;?php
$offset = 5;
$stmt = $pdo-&gt;prepare('SELECT * FROM messages LIMIT 0, ?');
$stmt-&gt;execute(array($offset));</code></pre><p id="r-527924" data-claire-element-id="527924">Le but de cette requête est de récupérer un certain nombre d'entrées dans la table messages. Ce nombre est défini par une variable (ici : $offset).<br/> Si vous avez correctement configuré PDO, vous devez avoir ce message d'erreur :</p><p id="r-527925" data-claire-element-id="527925"><cite>Citation : Erreur</cite></p><blockquote id="r-527927" data-claire-element-id="527927"><p id="r-527926" data-claire-element-id="527926">SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''5'' at line 1</p></blockquote><p id="r-527928" data-claire-element-id="527928">Et pourtant, cette requête fonctionne :</p><pre id="r-527929" data-claire-element-id="527929"><code data-claire-semantic="html+php">&lt;?php
$stmt = $pdo-&gt;prepare('SELECT * FROM messages LIMIT 0, 5');
$stmt-&gt;execute();</code></pre><div id="r-527931" data-claire-element-id="527931" data-claire-semantic="question"><p id="r-527930" data-claire-element-id="527930">Alors quoi ? Normalement, execute() remplace le marqueur <strong>?</strong> par la valeur de la variable, donc <strong>5</strong>. Le résultat est le même, non ?</p></div><p id="r-527932" data-claire-element-id="527932">Non. Ça vous en bouche un coin, hein ? :p <br/> En fait, si on prend la peine de lire la documentation de <a href="http://fr.php.net/manual/fr/pdostatement.execute.php">PDOStatement::execute()</a>, on peut y trouver cette phrase qui décrit l'array passé en paramètre :</p><p id="r-527933" data-claire-element-id="527933"><cite>Citation : php.net</cite></p><blockquote id="r-527935" data-claire-element-id="527935"><p id="r-527934" data-claire-element-id="527934">Un tableau de valeurs avec autant d'éléments qu'il y a de paramètres à associer dans la requête SQL qui sera exécutée. <strong>Toutes les valeurs sont traitées comme des constantes PDO::PARAM_STR</strong>.</p></blockquote><p id="r-527936" data-claire-element-id="527936">C'est la partie en gras qui est importante. Pour execute(), <strong>tout est chaîne de caractères</strong>. Par conséquent, il va entourer de <em>quotes</em> toutes les valeurs qu'on lui donne. La requête exécutée ressemble à cela : <code data-claire-semantic="sql">SELECT * FROM messages LIMIT 0, '5' </code>, ce qui produit une erreur de syntaxe.</p><div id="r-527940" data-claire-element-id="527940" data-claire-semantic="question"><p id="r-527937" data-claire-element-id="527937">Pourtant j'ai fait cette requête et je n'ai pas de problème de type, alors que mon champ `id` est de type INT !</p><pre id="r-527938" data-claire-element-id="527938"><code data-claire-semantic="sql">SELECT * FROM `table` WHERE `id` = '1';</code></pre><p id="r-527939" data-claire-element-id="527939">Comment ça se fait ?</p></div><p id="r-527941" data-claire-element-id="527941">MySQL est très permissif. Il va transtyper '1' en entier, et cela suffira (tandis que sur d'autres SGBD, cela pourrait ne pas fonctionner). En revanche, pour un LIMIT, il ne fera pas cette opération et signalera une erreur de syntaxe.</p><div id="r-527943" data-claire-element-id="527943" data-claire-semantic="question"><p id="r-527942" data-claire-element-id="527942">Alors, je ne dois plus donner de paramètre à execute() ? :o</p></div><p id="r-527944" data-claire-element-id="527944">Si. Vous le pouvez tant que les paramètres que vous donnez sont des chaînes de caractères !<br/> En pratique, j'ai pris l'habitude de ne plus donner aucun paramètre à execute(), car je trouve que l'autre solution rend le code plus lisible.</p><h2 id="r-pdostatement-bindvalue-et-pdostatement-bindparam" data-claire-element-id="527967">PDOStatement::bindValue() et PDOStatement::bindParam()</h2><p id="r-527946" data-claire-element-id="527946">Je vous conseille d'aller voir ce que dit la documentation à propos de ces deux méthodes. Elles s'utilisent toutes les deux de la même façon. Il y a trois paramètres à donner :</p><ul id="r-527953" data-claire-element-id="527953"><li id="r-527948" data-claire-element-id="527948"><p id="r-527947" data-claire-element-id="527947">le nom du marqueur à remplacer ;</p></li><li id="r-527950" data-claire-element-id="527950"><p id="r-527949" data-claire-element-id="527949">la valeur à utiliser ;</p></li><li id="r-527952" data-claire-element-id="527952"><p id="r-527951" data-claire-element-id="527951">le type de valeur à envoyer. On utilise pour cela les constantes de PDO. En pratique, ce sera presque toujours PDO::PARAM_INT (pour un entier) ou PDO::PARAM_STR (pour une chaîne de caractères).</p></li></ul><p id="r-527954" data-claire-element-id="527954">Si on reprend notre exemple avec le LIMIT, voici le résultat avec bindValue() :</p><pre id="r-527955" data-claire-element-id="527955"><code data-claire-semantic="html+php">&lt;?php
$offset = 5;
$stmt = $pdo-&gt;prepare('SELECT * FROM messages LIMIT 0, :offset');
$stmt-&gt;bindValue('offset', $offset, PDO::PARAM_INT);
$stmt-&gt;execute();</code></pre><p id="r-527956" data-claire-element-id="527956">Hourra, cela fonctionne cette fois-ci !</p><div id="r-527958" data-claire-element-id="527958" data-claire-semantic="question"><p id="r-527957" data-claire-element-id="527957">Y a-t-il une différence entre bindValue() et bindParam() ?</p></div><p id="r-527959" data-claire-element-id="527959">Oui ! Traduisons le nom de ces méthodes en français : &quot;bind value&quot; signifie &quot;lier une valeur&quot; tandis que &quot;bind param&quot; signifie &quot;lier un paramètre&quot;. La différence est simple, mais subtile : bindValue() lie <strong>la valeur d'une variable</strong>, tandis que bindParam() lie <strong>la variable elle-même</strong>.<br/> N'oubliez pas qu'une requête préparée peut être exécutée plusieurs fois en appelant plusieurs fois execute(). Ainsi, si l'on utilise bindParam(), il suffira de changer la valeur de la variable liée puis de rappeler execute() pour faire une nouvelle requête.</p><p id="r-527960" data-claire-element-id="527960">Les deux codes suivants produisent les mêmes requêtes :</p><pre id="r-527961" data-claire-element-id="527961"><code data-claire-semantic="html+php">&lt;?php
$id_membre = 1;
$message = 'Bonjour :)';

$stmt = $pdo-&gt;prepare('INSERT INTO minichat(id_membre, message) VALUES(:id_membre, :message)');
$stmt-&gt;bindValue('id_membre', $id_membre, PDO::PARAM_INT);
$stmt-&gt;bindValue('message', $message, PDO::PARAM_STR);
$stmt-&gt;execute();

$id_membre = 2;
$message = 'Salut !';

$stmt-&gt;bindValue('id_membre', $id_membre, PDO::PARAM_INT);
$stmt-&gt;bindValue('message', $message, PDO::PARAM_STR);
$stmt-&gt;execute();</code></pre><pre id="r-527962" data-claire-element-id="527962"><code data-claire-semantic="html+php">&lt;?php
$id_membre = 1;
$message = 'Bonjour :)';

$stmt = $pdo-&gt;prepare('INSERT INTO minichat(id_membre, message) VALUES(:id_membre, :message)');
$stmt-&gt;bindParam('id_membre', $id_membre, PDO::PARAM_INT);
$stmt-&gt;bindParam('message', $message, PDO::PARAM_STR);
$stmt-&gt;execute();

$id_membre = 2;
$message = 'Salut !';
$stmt-&gt;execute();</code></pre><p id="r-527963" data-claire-element-id="527963">Là, je n'ai modifié les valeurs qu'une seule fois. Mais admettons que j'aie besoin de les modifier 10 fois ou 100 fois ! Dans ce cas, cela reste plus pratique que de rappeler bindValue() à chaque fois.</p><p id="r-527964" data-claire-element-id="527964">Ce sera tout pour les erreurs typiques de ceux qui débutent avec PDO ! Si vous en voyez d'autres ou que vous pensez que certains points nécessitent d'être clarifiés ou développés, n'hésitez pas à me contacter.</p><p id="r-527965" data-claire-element-id="527965">Si vous avez des questions, je répondrai avec plaisir à vos MP. Préférez un message sur les forums ou dans les commentaires, ainsi la réponse profitera à tout le monde et vous aurez d'autres points de vue que le mien.</p><p id="r-527966" data-claire-element-id="527966">J'insiste une nouvelle fois sur ce point : utilisez la documentation (<a href="http://www.php.net/manual/fr/">doc PHP</a>, <a href="http://fr2.php.net/manual/fr/book.pdo.php">doc PDO</a>) ! Lisez la description des méthodes, de leurs paramètres et de leurs valeurs de retour. C'est comme cela que vous comprendrez au mieux comment les utiliser.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes">PDO : comprendre et corriger les erreurs les plus fréquentes</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/un-peu-de-vocabulaire-9">
Un peu de vocabulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/les-options-de-configuration">
Les options de configuration
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/securiser-ses-requetes">
Sécuriser ses requêtes
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/pdostatement-execute-et-le-type-int">
PDOStatement::execute() et le type INT
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/pdo-comprendre-et-corriger-les-erreurs-les-plus-frequentes/securiser-ses-requetes">
<span class="arrow"></span>
<span class="next">Sécuriser ses requêtes</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/do-comprendre-et-corriger-les-erreurs-les-plus-frequentes.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 19:57:48 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/do-comprendre-et-corriger-les-erreurs-les-plus-frequentes.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:42:54 GMT -->
</html>