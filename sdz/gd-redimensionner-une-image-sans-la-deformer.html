<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/gd-redimensionner-une-image-sans-la-deformer.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:54:39 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/gd-redimensionner-une-image-sans-la-deformer.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:38:20 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : [GD] Redimensionner une image sans la déformer</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : [GD] Redimensionner une image sans la déformer</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#GDRedimensionneruneimagesansladformer">[GD] Redimensionner une image sans la déformer</a><br/><a href="#Quelquesrappelsutiles">Quelques rappels utiles…</a><br/><a href="#Desfonctionstrsgraphiques">Des fonctions très… graphiques</a><br/><a href="#Redimensionnonsmaissansdformer">Redimensionnons, mais sans déformer !</a><br/></div>
<a name="GDRedimensionneruneimagesansladformer"></a><h2>[GD] Redimensionner une image sans la déformer</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer/quelques-rappels-utiles">
<span class="next">Quelques rappels utiles…</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-436451" data-claire-element-id="436451">Ce tutoriel est mon premier et je fais appel par avance à votre sollicitude.<br/> Il a pour but de vous exposer une manière de redimensionner une image en conservant ses proportions (largeur et hauteur) de façon à l'insérer proprement dans vos scripts (news, diaporama…).</p><aside id="r-436453" data-claire-element-id="436453" data-claire-semantic="warning"><p id="r-436452" data-claire-element-id="436452">Il est évident que pour des raisons de clarté, je ne présenterai pas ici la marche à suivre pour créer un système complet de news ou une galerie d'images.</p></aside><p id="r-436454" data-claire-element-id="436454">Nous commencerons donc par faire un <strong>rappel du formulaire</strong> qui sera utilisé pour l'upload de l'image. Nous verrons ensuite quelles sont les <strong>fonctions</strong> qui seront utilisées en faisant référence à la doc. Enfin, nous passerons doucement à la <strong>pratique</strong>. ;)</p><p id="r-436455" data-claire-element-id="436455">Dans ce tutoriel, j'utiliserai principalement des images au format JPEG et vérifierai les extensions en conséquence, mais vous pourrez très facilement adapter le script à l'utilisation d'autres formats (comme GIF ou PNG par exemple), à condition de ne pas oublier d'utiliser les fonctions associées qui, bien que peu connues, sont indispensables : tout le monde emploie imagecreatefromjpeg, mais il existe imagecreatefromgif ou encore imagecreatefrompng (quelques précisions plus bas). Idem pour la fonction imagejpeg : imagegif et imagepng existent bel et bien. ;) <br/> Il suffira pour vous d'assurer un minimum la sécurisation des données et de suivre les recommandations pour l'utilisation des autres formats.</p><p id="r-436456" data-claire-element-id="436456">O.K. ? Alors c'est parti !</p>
</div><a name="Quelquesrappelsutiles"></a><h2>Quelques rappels utiles…</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer/des-fonctions-tres-graphiques">
<span class="next">Des fonctions très… graphiques</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-436457" data-claire-element-id="436457">On partira du principe (puisque c'est mon cas) que vous disposez d'un système de news et que vous voulez insérer, pour chacune des nouvelles news, une image ou une photo. Mais le problème est de taille : vous avez assuré une mise en page qui vous plaît et la photo est trop grande !</p><aside id="r-436459" data-claire-element-id="436459" data-claire-semantic="warning"><p id="r-436458" data-claire-element-id="436458">Je précise encore une fois qu'il s'agit d'un exemple d'utilisation qui ne saurait constituer l'unique façon de mettre à profit ce script !</p></aside><div id="r-436461" data-claire-element-id="436461" data-claire-semantic="question"><p id="r-436460" data-claire-element-id="436460">Comment faire ?</p></div><p id="r-436462" data-claire-element-id="436462">Je vais tout vous dire… <em>don't worry</em>. :)</p><p id="r-436463" data-claire-element-id="436463">Commençons par ajouter à notre formulaire de saisie de news un espace dédié à l'upload de notre image (si vous n'y connaissez rien en upload de fichier, vous devez absolument faire un tour par <a href="http://www.siteduzero.com/tuto-3-1718-1-upload-de-fichiers-par-formulaire.html">là</a>).<br/> Je vous rappelle simplement que :</p><ul id="r-436470" data-claire-element-id="436470"><li id="r-436465" data-claire-element-id="436465"><p id="r-436464" data-claire-element-id="436464">si vous voulez uploader un fichier, comme une image, il faudra modifier l'<strong>enctype</strong> de votre balise &lt;form&gt; ;</p></li><li id="r-436467" data-claire-element-id="436467"><p id="r-436466" data-claire-element-id="436466">vous devez assurer une première restriction sur l'insertion de l'image en maximisant la taille d'envoi à 2 Mo par exemple (poids maximum autorisé par défaut pour l'upload d'un fichier, fixé dans la configuration d'Apache et de PHP, mais qu'il faudra pourtant contraindre) grâce à un input en hidden ;</p></li><li id="r-436469" data-claire-element-id="436469"><p id="r-436468" data-claire-element-id="436468">le type de l'input change car on ne charge plus du texte, mais un fichier…</p></li></ul><p id="r-436471" data-claire-element-id="436471">Comment, vous trouvez cela compliqué ? Mais non, c'est on ne peut plus simple !<br/> Je vous laisse deux petites minutes pour réaliser ce bête formulaire…</p><p id="r-436472" data-claire-element-id="436472">Ça y est ? Alors, correction :</p><pre id="r-436473" data-claire-element-id="436473"><code data-claire-semantic="html">&lt;form method=&quot;post&quot; action=&quot;news.php&quot; enctype=&quot;multipart/form-data&quot;&gt;
&lt;fieldset class=&quot;formulaire_news&quot;&gt;
        &lt;p&gt;
                &lt;label for=&quot;titre&quot;&gt;Titre :&lt;/label&gt;
                &lt;input type=&quot;text&quot; name=&quot;TitreNews&quot; id=&quot;titre&quot; /&gt;
        &lt;/p&gt;
                       
        &lt;p&gt;
                &lt;label for=&quot;image&quot;&gt;Image : &lt;/label&gt;
                &lt;input type=&quot;hidden&quot; name=&quot;MAX_FILE_SIZE&quot; value=&quot;2097152&quot; /&gt;
                &lt;input type=&quot;file&quot; name=&quot;ImageNews&quot; id=&quot;image&quot; /&gt;
        &lt;/p&gt;
                        
        &lt;p&gt;
                &lt;label for=&quot;contenu&quot;&gt;Contenu :&lt;/label&gt;
                &lt;textarea cols=&quot;40&quot; rows=&quot;3&quot; name=&quot;ContenuNews&quot;&gt;&lt;/textarea&gt;
        &lt;/p&gt;
 
        &lt;p&gt;
                &lt;input type=&quot;submit&quot; name=&quot;InsererNews&quot; value=&quot;Insérer&quot; /&gt;
                &lt;input type=&quot;reset&quot; name=&quot;Recommencer&quot; value=&quot;Recommencer&quot; /&gt;
        &lt;/p&gt;
&lt;/fieldset&gt;
&lt;/form&gt;</code></pre><p id="r-436474" data-claire-element-id="436474">J'ai bien évidemment allégé volontairement le formulaire. Vous devriez avoir un champ <em>auteur</em> en plus, non ?<br/> Vous remarquerez que j'appelle une page de traitement que j'ai sobrement nommée news.php : vous pouvez la renommer en fonction de vos souhaits.</p><p id="r-436475" data-claire-element-id="436475">Voilà, la première sous-partie est terminée.</p><aside id="r-436477" data-claire-element-id="436477" data-claire-semantic="warning"><p id="r-436476" data-claire-element-id="436476">Si vous avez des soucis de compréhension concernant cette petite mise au point, n'hésitez pas à aller faire un tour sur le tuto de DHKold.</p></aside><p id="r-436478" data-claire-element-id="436478">Maintenant, on passe à la présentation des fonctions que nous utiliserons dans le script de redimensionnement.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer">[GD] Redimensionner une image sans la déformer</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer/quelques-rappels-utiles">
Quelques rappels utiles…
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer/des-fonctions-tres-graphiques">
Des fonctions très… graphiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer/redimensionnons-mais-sans-deformer">
Redimensionnons, mais sans déformer !
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer/des-fonctions-tres-graphiques">
<span class="next">Des fonctions très… graphiques</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Desfonctionstrsgraphiques"></a><h2>Des fonctions très… graphiques</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer/quelques-rappels-utiles">
<span class="arrow"></span>
<span class="next">Quelques rappels utiles…</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer/redimensionnons-mais-sans-deformer">
<span class="next">Redimensionnons, mais sans déformer !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-436480" data-claire-element-id="436480">Voici la liste des fonctions que nous utiliserons dans le script de redimensionnement, en partant du principe que vous désirez utiliser une image au format JPEG :</p><ul id="r-436497" data-claire-element-id="436497"><li id="r-436482" data-claire-element-id="436482"><p id="r-436481" data-claire-element-id="436481">explode ;</p></li><li id="r-436484" data-claire-element-id="436484"><p id="r-436483" data-claire-element-id="436483">strtolower ;</p></li><li id="r-436486" data-claire-element-id="436486"><p id="r-436485" data-claire-element-id="436485">imagecreatefrom<strong>jpeg</strong> ;</p></li><li id="r-436488" data-claire-element-id="436488"><p id="r-436487" data-claire-element-id="436487">getimagesize ;</p></li><li id="r-436490" data-claire-element-id="436490"><p id="r-436489" data-claire-element-id="436489">imagecreatetruecolor ;</p></li><li id="r-436492" data-claire-element-id="436492"><p id="r-436491" data-claire-element-id="436491">imagecopyresampled ;</p></li><li id="r-436494" data-claire-element-id="436494"><p id="r-436493" data-claire-element-id="436493">imagedestroy ;</p></li><li id="r-436496" data-claire-element-id="436496"><p id="r-436495" data-claire-element-id="436495">image<strong>jpeg</strong>.</p></li></ul><p id="r-436498" data-claire-element-id="436498">Je les ai fait figurer dans l'ordre de leur utilisation dans le script.<br/> Le format choisi étant JPEG, deux des fonctions utilisées se termineront par <strong>jpeg</strong>. Mais, comme je vous le dis depuis le début, vous pourrez utiliser les formats PNG et GIF en utilisant lesdites fonctions adaptées (imagecreatefromgif, imagecreatefrompng et imagegif ou imagepng).<br/> Il est fort possible que vous connaissiez et maîtrisiez les fonctions explode et strtolower, mais que les autres vous paraissent « barbares ». Pas de panique, je vais tout vous expliquer (dans la mesure de mes compétences, et en m'aidant de la documentation PHP).</p><h2 id="r-la-fonction-explode" data-claire-element-id="436508">La fonction explode</h2><p id="r-436499" data-claire-element-id="436499">La fonction explode coupe une chaîne en segments. Il s'agit plus exactement d'une fonction qui retourne un tableau (array) de chaînes issues d'une variable, en utilisant un délimiteur.</p><div id="r-436501" data-claire-element-id="436501" data-claire-semantic="question"><p id="r-436500" data-claire-element-id="436500">Oh là, doucement, vieux ! C'est compliqué, ton truc !</p></div><p id="r-436502" data-claire-element-id="436502">D'accord, un petit exemple est plus parlant :</p><pre id="r-436503" data-claire-element-id="436503"><code data-claire-semantic="html+php">&lt;?php
//Je pose ma variable :
$variable = &quot;Je veux couper ma variable. Mais je la veux en plusieurs chaînes&quot;;
 
//J'utilise mon array explode :
$chaine = explode('.', $variable);
// Mon délimiteur est le point, ma variable est $variable. Donc explode va couper en chaînes tout ce qui se trouve de part et d'autre du point.
 
//J'affiche mes chaînes, dont la numérotation commence à zéro :
echo $chaine[0]; //Ceci va retourner &quot;Je veux couper ma variable&quot;
echo $chaine[1]; //Ceci va retourner &quot;Mais je la veux en plusieurs chaînes&quot;
?&gt;</code></pre><aside id="r-436505" data-claire-element-id="436505" data-claire-semantic="error"><p id="r-436504" data-claire-element-id="436504">L'erreur la plus fréquente est l'inversion des paramètres d'explode à l'intérieur des parenthèses. Il faut respecter scrupuleusement l'ordre des paramètres, contrairement à implode().</p></aside><p id="r-436506" data-claire-element-id="436506">Vous avez compris ?</p><p id="r-436507" data-claire-element-id="436507">Vous pouvez très bien limiter le nombre de chaînes que vous voulez retourner en utilisant, et ce, depuis PHP 4.0.1, le paramètre limit juste avant de fermer la parenthèse.<br/> Exemple : $chaine = explode('.', $variable, 1), auquel cas dans mon exemple précédent, la seule ($limit = 1) chaîne retournée sera : « Je veux couper ma variable ».<br/> Depuis PHP 5, il est même possible d'utiliser une limite négative comme -1. Vous verrez plus tard son utilité. ;)</p><h2 id="r-la-fonction-strtolower" data-claire-element-id="436510">La fonction strtolower</h2><p id="r-436509" data-claire-element-id="436509">Vous vous êtes aperçus bien souvent que les images pouvaient être nommées avec l'extension <em>.jpg</em> / <em>.JPG</em>, <em>.jpeg</em> / <em>.JPEG</em>, <em>.gif</em> / <em>.GIF</em> ou encore <em>.png</em> / <em>.PNG</em>.<br/> Pour éviter tout problème d'interprétation lié à la sensibilité de PHP à la casse, nous utiliserons la fonction strtolower, dont l'effet est de convertir une chaîne en minuscules (sauf les voyelles accentuées, mais ici, on s'en fiche ^^ ).<br/> Cette fonction va nous permettre plus tard de nous assurer de l'extension du fichier à uploader.</p><h2 id="r-la-fonction-imagecreatefromjpeg" data-claire-element-id="436518">La fonction imagecreatefromjpeg</h2><p id="r-436511" data-claire-element-id="436511">Cette fonction va se montrer déterminante, puisqu'elle va nous permettre de créer une nouvelle image à partir de celle que nous choisirons.<br/> Elle s'utilise très simplement :</p><pre id="r-436512" data-claire-element-id="436512"><code data-claire-semantic="html+php">&lt;?php
$NouvelleImage = imagecreatefromjpeg ($ImageChoisie);
?&gt;</code></pre><p id="r-436513" data-claire-element-id="436513">Vous pouvez très bien utiliser un chemin de type URL pour votre variable $ImageChoisie à condition d'avoir préalablement activé l'option des fopen wrappers. Pour cela, il faut aller jeter un œil <a href="http://fr.php.net/manual/fr/function.fopen.php">ici</a>.</p><p id="r-436514" data-claire-element-id="436514">Cette nouvelle image reste « virtuelle », et nous allons la modifier par la suite.</p><p id="r-436515" data-claire-element-id="436515"><strong>Remarque 1</strong> : si vous utilisez la fonction équivalente pour les images de format PNG (imagecreatefrompng), assurez-vous que l'image de départ que vous choisissez ne dépasse pas un nombre total de 1 040 000 pixels, soit une résolution d'environ 1040 x 1000. En effet, la fonction imagecreatefrompng ne semble pas efficiente pour un nombre de pixels supérieur… Allez savoir pourquoi, là je sèche !<br/> De plus, si vous travaillez sur des PNG 24 permettant la transparence, il vous faudra activer le canal alpha et sauvegarder (imagecolorallocatealpha).</p><p id="r-436516" data-claire-element-id="436516"><strong>Remarque 2</strong> : si vous utilisez la fonction équivalente pour les images de format GIF (imagecreatefromgif), vous devez disposer des librairies GD dans leur version inférieure à 1.6, ou supérieure à 2.0.28. Entre ces deux versions, le format n'est pas supporté par GD.</p><p id="r-436517" data-claire-element-id="436517"><strong>Remarque 3</strong> : les versions Windows de PHP antérieures à la version 4.3.0 ne supportent pas l'accès aux fichiers distants avec ces fonctions, même si la directive allow_url_fopen est activée dans le <em>php.ini</em>.</p><h2 id="r-la-fonction-getimagesize" data-claire-element-id="436534">La fonction getimagesize</h2><p id="r-436519" data-claire-element-id="436519">Pour ceux qui maîtrisent la langue de Shakespeare, ce nom est facile à comprendre.</p><ul id="r-436526" data-claire-element-id="436526"><li id="r-436521" data-claire-element-id="436521"><p id="r-436520" data-claire-element-id="436520"><em>Get</em> : déterminer, prendre, obtenir.</p></li><li id="r-436523" data-claire-element-id="436523"><p id="r-436522" data-claire-element-id="436522"><em>Image</em> : …</p></li><li id="r-436525" data-claire-element-id="436525"><p id="r-436524" data-claire-element-id="436524"><em>Size</em> : taille.</p></li></ul><p id="r-436527" data-claire-element-id="436527">Cette fonction retourne un array comprenant les dimensions de l'image, dont les deux premières entrées nous intéressent particulièrement. Pour l'utiliser, il vous suffit d'écrire ce bout de code :</p><pre id="r-436528" data-claire-element-id="436528"><code data-claire-semantic="html+php">&lt;?php
$TailleImage = getimagesize ($ImageChoisie);
?&gt;</code></pre><p id="r-436529" data-claire-element-id="436529">Ceci retourne entre autres $TailleImage[0], qui correspond à la largeur de l'image (<em>width</em>), et $TailleImage[1], qui correspond à la hauteur de l'image (<em>height</em>).</p><p id="r-436530" data-claire-element-id="436530">On pourrait également utiliser les entrées $TailleImage['bits'], qui nous retourne le nombre de bits ou $TailleImage['mime'] qui nous retourne… le type MIME ! Eh oui !</p><p id="r-436531" data-claire-element-id="436531">Cette fonction va être utile pour déterminer, au départ, les dimensions de l'image que l'on souhaite redimensionner, mais surtout pour connaître le ratio largeur / hauteur, afin de redimensionner en conservant les proportions. ;) Elle nous servira enfin à vérifier, de manière certaine, le type MIME du fichier uploadé.</p><aside id="r-436533" data-claire-element-id="436533" data-claire-semantic="information"><p id="r-436532" data-claire-element-id="436532">Cette fonction ne requiert pas GD.</p></aside><h2 id="r-la-fonction-imagecreatetruecolor" data-claire-element-id="436540">La fonction imagecreatetruecolor</h2><p id="r-436535" data-claire-element-id="436535">Cette fonction sera, dans notre exemple, indissociable de la fonction imagecreatefromjpeg.<br/> En effet, imagecreatetruecolor crée une nouvelle image en couleurs vraies, autrement dit une image <strong>noire</strong> dont il faudra préciser la largeur et la hauteur.<br/> Exemple :</p><pre id="r-436536" data-claire-element-id="436536"><code data-claire-semantic="html+php">&lt;?php
$ImageEnCouleursVraies = imagecreatetruecolor(800, 600);
?&gt;</code></pre><p id="r-436537" data-claire-element-id="436537">Cette nouvelle image en couleurs vraies correspondra en fait à l'ébauche de notre image redimensionnée, O.K. ?</p><p id="r-436538" data-claire-element-id="436538"><strong>Remarque</strong> : cette fonction ne fonctionne pas avec le format GIF. De plus, elle requiert la bibliothèque GD en version au moins 2.0.1 (la 2.0.28 ou supérieure est recommandée).<br/> Toutefois, il est possible de passer outre cette embûche en utilisant simplement la fonction imagecreate comme ceci :</p><pre id="r-436539" data-claire-element-id="436539"><code data-claire-semantic="html+php">&lt;?php
imagecreate(int x_size, int y_size);
?&gt;</code></pre><h2 id="r-la-fonction-imagecopyresampled" data-claire-element-id="436565">La fonction imagecopyresampled</h2><p id="r-436541" data-claire-element-id="436541">La fonction magique ! Elle copie, redimensionne et ré-échantillonne notre nouvelle image.<br/> Toutefois, son interprétation est un peu plus complexe. Voyons ensemble :</p><pre id="r-436542" data-claire-element-id="436542"><code data-claire-semantic="html+php">&lt;?php
imagecopyresampled($NouvelleImage, $ImageDepart, $CoordonneeXduPointdeDestination, $CoordonneeYduPointdeDestination, $CoordonneeXduPointSource, $CoordonneeYduPointSource, $NouvelleLargeur, $NouvelleHauteur, $LargeurImageDepart, $HauteurImageDepart);
?&gt;</code></pre><div id="r-436544" data-claire-element-id="436544" data-claire-semantic="question"><p id="r-436543" data-claire-element-id="436543">Arf, c'est quoi ce charabia ? &gt;_</p></div><p id="r-436545" data-claire-element-id="436545">Bon, quelques explications s'imposent.</p><ul id="r-436560" data-claire-element-id="436560"><li id="r-436547" data-claire-element-id="436547"><p id="r-436546" data-claire-element-id="436546"><strong>$NouvelleImage</strong> est l'image que l'on veut obtenir après redimensionnement.</p></li><li id="r-436549" data-claire-element-id="436549"><p id="r-436548" data-claire-element-id="436548"><strong>$Imagedepart</strong> est l'image que nous avons choisie.</p></li><li id="r-436551" data-claire-element-id="436551"><p id="r-436550" data-claire-element-id="436550"><strong>$CoordonneeXduPointdeDestination</strong> se détermine par rapport à <strong>$CoordonneeXduPointSource</strong>. C'est un chiffre, 0 (zéro) si vous ne voulez pas créer de décalage par rapport à l'image de départ, fixée au coin supérieur gauche par référence.</p></li><li id="r-436553" data-claire-element-id="436553"><p id="r-436552" data-claire-element-id="436552">Idem pour <strong>$CoordonneYduPointdeDestination</strong>.</p></li><li id="r-436555" data-claire-element-id="436555"><p id="r-436554" data-claire-element-id="436554"><strong>$NouvelleLargeur</strong> constitue la nouvelle dimension <em>width</em> attendue pour notre image redimensionnée.</p></li><li id="r-436557" data-claire-element-id="436557"><p id="r-436556" data-claire-element-id="436556"><strong>$NouvelleHauteur</strong> suit le même principe.</p></li><li id="r-436559" data-claire-element-id="436559"><p id="r-436558" data-claire-element-id="436558">Les deux dernières variables sont généralement déterminées par la fonction getimagesize.</p></li></ul><p id="r-436561" data-claire-element-id="436561">Vous aurez donc compris l'intérêt sans équivoque de l'appel de cette fonction. ;)</p><aside id="r-436563" data-claire-element-id="436563" data-claire-semantic="error"><p id="r-436562" data-claire-element-id="436562">Attention : erreur fréquente ! Il arrive souvent, lorsque l'on fait appel à cette fonction, de se retrouver avec une image dont les couleurs n'ont plus rien à voir avec celles de l'image de départ : une image toute bleue, par exemple.<br/> Pourquoi ? Parce que toutes les couleurs utilisées pour former l'image ne peuvent pas toujours être allouées. :'( La couleur la plus proche (en théorie) est alors utilisée. Je dis bien « en théorie » ! Car souvent, ce n'est pas visuellement la couleur la plus proche !</p></aside><p id="r-436564" data-claire-element-id="436564">Pour éviter ce genre de mauvaise surprise, il convient d'utiliser la fonction précédemment citée, imagecreatetruecolor, avant de passer par imagecopyresampled.</p><h2 id="r-la-fonction-imagedestroy" data-claire-element-id="436572">La fonction imagedestroy</h2><p id="r-436566" data-claire-element-id="436566">Bon, eh bien là, c'est clair !<br/> Cette fonction détruit purement et simplement l'image dont on ne veut plus.</p><div id="r-436568" data-claire-element-id="436568" data-claire-semantic="question"><p id="r-436567" data-claire-element-id="436567">Et devinez laquelle ne nous servira plus ?</p></div><p id="r-436569" data-claire-element-id="436569">Réponse : l'image originale bien sûr ! ;) <br/> Seulement, il faudra utiliser comme paramètre la variable retournée par l'une de nos fonctions précédentes comme imagecreatefromjpeg.<br/> Exemple :</p><pre id="r-436570" data-claire-element-id="436570"><code data-claire-semantic="html+php">&lt;?php
imagedestroy($ImageChoisie);
?&gt;</code></pre><p id="r-436571" data-claire-element-id="436571">Très difficile, hein ?</p><h2 id="r-la-der-des-ders-enfin-la-fonction-imagejpeg" data-claire-element-id="436580">La Der des Ders… enfin la fonction imagejpeg</h2><p id="r-436573" data-claire-element-id="436573">Cette dernière fonction n'est pas des moins utiles puisqu'elle va nous offrir l'opportunité non seulement de sauvegarder notre nouvelle image dans un fichier, mais également de déterminer la qualité avec laquelle on va l'enregistrer !<br/> Exemple d'utilisation :</p><pre id="r-436574" data-claire-element-id="436574"><code data-claire-semantic="html+php">&lt;?php
imagejpeg($NouvelleImage, $fichier, 100);
?&gt;</code></pre><p id="r-436575" data-claire-element-id="436575">Ici, je vais sauvegarder ma nouvelle image ($NouvelleImage) dans le fichier choisi ($fichier) avec une qualité maximale (100).</p><p id="r-436576" data-claire-element-id="436576"><strong>Remarque 1</strong> : le chemin vers le fichier est optionnel. S'il n'est pas défini ou s'il vaut NULL, le flux brut de l'image sera affiché directement. En d'autres termes, l'image GD sera envoyée au format JPEG directement sur la sortie standard (en général votre navigateur web).<br/> Il en est de même pour la définition de la qualité de l'image sauvegardée. Toutefois, vous pouvez opter pour une qualité allant de 0 (la pire) à 100 (la qualité maximale).</p><p id="r-436577" data-claire-element-id="436577"><strong>Remarque 2</strong> : afin d'utiliser le format JPEG avec la fonction imagejpeg, il vous faudra activer la librairie GD version 1.8 ou supérieure.<br/> Si vous voulez générer des images JPEG progressives, vous devez activer l'entrelacement à l'aide de la fonction <a href="http://fr.php.net/manual/fr/function.imageinterlace.php">imageinterlace()</a>.</p><p id="r-436578" data-claire-element-id="436578"><strong>Remarque 3</strong> : comme je vous l'ai expliqué plus haut, si votre image est au format PNG, il faudra utiliser imagepng ; si elle est au format GIF, il faudra utiliser imagegif. ;)</p><p id="r-436579" data-claire-element-id="436579">Eh bien voilà, nous en avons fini avec les fonctions utiles à notre script. Vous savez à quoi elles servent, il ne nous reste plus qu'à les mettre en pratique.<br/> Alors, au boulot !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer">[GD] Redimensionner une image sans la déformer</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer/quelques-rappels-utiles">
Quelques rappels utiles…
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer/des-fonctions-tres-graphiques">
Des fonctions très… graphiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer/redimensionnons-mais-sans-deformer">
Redimensionnons, mais sans déformer !
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer/quelques-rappels-utiles">
<span class="arrow"></span>
<span class="next">Quelques rappels utiles…</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer/redimensionnons-mais-sans-deformer">
<span class="next">Redimensionnons, mais sans déformer !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Redimensionnonsmaissansdformer"></a><h2>Redimensionnons, mais sans déformer !</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer/des-fonctions-tres-graphiques">
<span class="arrow"></span>
<span class="next">Des fonctions très… graphiques</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-436582" data-claire-element-id="436582">Nous voilà donc plongés dans le vif du sujet !<br/> Pour commencer, reprenons notre formulaire. Nous avons appelé la page news.php, mais il s'agit en fait de la page que vous utilisez pour traiter en PHP votre formulaire de news. O.K. ? Donc, vous l'appelez comme bon vous semble.<br/> Dans ce tutoriel, je décide de n'accepter que les images au format JPEG, mais je vous montre quand même l'utilisation d'autres formats.<br/> On y va : on récupère notre fichier image envoyé par la méthode POST.</p><pre id="r-436583" data-claire-element-id="436583"><code data-claire-semantic="html+php">&lt;?php
if (!empty($_FILES['ImageNews']))
{
  if ($_FILES['ImageNews']['error'] &lt;= 0)
  {
    if ($_FILES['ImageNews']['size'] &lt;= 2097152)
    {
        $ImageNews = $_FILES['ImageNews']['name'];
?&gt;</code></pre><p id="r-436584" data-claire-element-id="436584">Ça va jusque-là ? N'oubliez pas qu'il fallait s'assurer de ne pas dépasser un poids maximal de 2 Mo pour l'image (soit 2 097 152 octets), même s'il possède une valeur par défaut.<br/> Passons au premier exercice. ;)</p><h2 id="r-premier-exercice-fixer-les-extensions-autorisees-des-images-a-uploader" data-claire-element-id="436609">Premier exercice : fixer les extensions autorisées des images à uploader</h2><p id="r-436585" data-claire-element-id="436585">Nous désirons accepter les extensions suivantes (parce que je suis généreux ;) ) :</p><ul id="r-436602" data-claire-element-id="436602"><li id="r-436587" data-claire-element-id="436587"><p id="r-436586" data-claire-element-id="436586">.jpg ;</p></li><li id="r-436589" data-claire-element-id="436589"><p id="r-436588" data-claire-element-id="436588">.JPG ;</p></li><li id="r-436591" data-claire-element-id="436591"><p id="r-436590" data-claire-element-id="436590">.jpeg ;</p></li><li id="r-436593" data-claire-element-id="436593"><p id="r-436592" data-claire-element-id="436592">.JPEG ;</p></li><li id="r-436595" data-claire-element-id="436595"><p id="r-436594" data-claire-element-id="436594">.gif ;</p></li><li id="r-436597" data-claire-element-id="436597"><p id="r-436596" data-claire-element-id="436596">.GIF ;</p></li><li id="r-436599" data-claire-element-id="436599"><p id="r-436598" data-claire-element-id="436598">.png ;</p></li><li id="r-436601" data-claire-element-id="436601"><p id="r-436600" data-claire-element-id="436600">.PNG.</p></li></ul><p id="r-436603" data-claire-element-id="436603">Vous pouvez bien entendu ajouter ce que vous voulez, dans la mesure où vous réfléchissez ensuite à la manière de traiter vos images, en utilisant les fonctions adéquates.</p><div id="r-436605" data-claire-element-id="436605" data-claire-semantic="question"><p id="r-436604" data-claire-element-id="436604">Comment faire pour s'assurer que l'extension du fichier à uploader est bien une de celles acceptées ?</p></div><p id="r-436606" data-claire-element-id="436606">Je vous laisse y réfléchir un peu…<br/> Vous avez trouvé ?</p><pre id="r-436607" data-claire-element-id="436607"><code data-claire-semantic="html+php">&lt;?php
// Je crée un array dans lequel figurent seulement les extensions acceptées, avec le type MIME qui leur est associé (qui peut varier sous IE et qu'on va donc devoir différencier) :
$ListeExtension = array('jpg' =&gt; 'image/jpeg', 'jpeg' =&gt; 'image/jpeg', 'png' =&gt; 'image/png', 'gif' =&gt; 'image/gif');
$ListeExtensionIE = array('jpg' =&gt; 'image/pjpg', 'jpeg'=&gt;'image/pjpeg'); // Il fallait une nouvelle fois qu'IE se différencie.
?&gt;</code></pre><p id="r-436608" data-claire-element-id="436608">Le principe est simple : je crée un tableau d'équivalences dans lequel je précise les extensions que j'accepte avec le type MIME associé en fonction du navigateur, car le type MIME d'un fichier JPEG (et seulement ce format-là) peut être interprété différemment sous IE… Il fallait bien qu'il se distingue une fois de plus, celui-là. :colere2: <br/> Si l'extension de mon fichier est contenue dans l'array, tout est O.K. et on continue, sinon on indique qu'une erreur s'est produite.</p><h2 id="r-deuxieme-exercice-verifier-l-extension-de-notre-fichier-en-utilisant-nos-array-precedents" data-claire-element-id="436620">Deuxième exercice : vérifier l'extension de notre fichier en utilisant nos array précédents</h2><p id="r-436610" data-claire-element-id="436610">Idem, je vous laisse deux minutes pour réfléchir.<br/> Attention : 3… 2… 1… partez ! :)</p><pre id="r-436611" data-claire-element-id="436611"><code data-claire-semantic="html+php">&lt;?php
// Je vérifie l'extension présumée du fichier :
$ExtensionPresumee = explode('.', $ImageNews);
$ExtensionPresumee = strtolower($ExtensionPresumee[1]);
if ($ExtensionPresumee == 'jpg' || $ExtensionPresumee == 'jpeg' || $ExtensionPresumee == 'pjpg' || $ExtensionPresumee == 'pjpeg' || $ExtensionPresumee == 'gif' || $ExtensionPresumee == 'png')
{
// On pourra alors continuer notre vérification.
?&gt;</code></pre><h3 id="r-explications-26" data-claire-element-id="436619">Explications</h3><p id="r-436612" data-claire-element-id="436612">J'utilise ma première fonction : explode. Je découpe donc $ImageNews en deux chaînes, de part et d'autre du délimiteur « . » (le point) ; l'une s'appelle $ExtensionPresumee et contient le nom de l'image (située avant le point), l'autre contient l'extension (située après le point). Puis je choisis uniquement de m'intéresser à la chaîne contenant l'extension ; elle est appelée par $ExtensionPresumee[1] (c'est bien la deuxième chaîne puisque la numérotation d'un array commence à 0 : vous vous en souvenez ?).<br/> Ensuite, je convertis cette extension en minuscules grâce à strtolower, pour éviter les conflits de reconnaissance entre .jpg et .JPG, ou entre .jpeg et .JPEG (ou .GIF et .gif, etc.).<br/> Enfin, je vérifie que $ExtensionPresumee correspond bien à l'une des extensions acceptées.<br/> Mais attention ! Les plus malins me diront :</p><p id="r-436613" data-claire-element-id="436613"><cite>Citation : Les plus malins</cite></p><blockquote id="r-436615" data-claire-element-id="436615"><p id="r-436614" data-claire-element-id="436614">… et si je nomme mon image mon.image.jpg ?<br/> L'explode me renvoiera image comme extension ! Et ce n'est pas une extension valide. :(</p></blockquote><p id="r-436616" data-claire-element-id="436616">Bonne remarque effectivement, et merci à <a href="http://www.siteduzero.com/membres-294-23475.html">samuel2202</a> de m'avoir soumis cette proposition de rectification.<br/> On va donc contourner le problème en comptabilisant (grâce à la fonction count) le nombre d'entrées de l'array retourné par l'explode, et en enlevant 1 au nombre total. ;) En effet, je rappelle que la numérotation des chaînes débute à 0. S'il y a 4 chaînes retournées, la dernière sera donc la [3] (4 - 1 !).<br/> Voici alors le code rectifié :</p><pre id="r-436617" data-claire-element-id="436617"><code data-claire-semantic="html+php">&lt;?php
$ExtensionPresumee = explode('.', $ImageNews);
$ExtensionPresumee = strtolower($ExtensionPresumee[count($ExtensionPresumee)-1]);
if ($ExtensionPresumee == 'jpg' || $ExtensionPresumee == 'jpeg' || $ExtensionPresumee == 'pjpg' || $ExtensionPresumee == 'pjpeg' || $ExtensionPresumee == 'gif' || $ExtensionPresumee == 'png')
{
// On pourra alors continuer notre vérification.
?&gt;</code></pre><p id="r-436618" data-claire-element-id="436618">On poursuit ?</p><h2 id="r-troisieme-exercice-verifier-que-le-type-mime-de-l-image-correspond-bien-a-son-extension" data-claire-element-id="436640">Troisième exercice : vérifier que le type MIME de l'image correspond bien à son extension</h2><aside id="r-436622" data-claire-element-id="436622" data-claire-semantic="information"><p id="r-436621" data-claire-element-id="436621">Petit rappel : le type MIME, défini depuis 1991, correspond à une information relative au fichier transféré par protocole HTTP ou par mail. En d'autres termes, lors d'une transaction entre le serveur et le navigateur, le serveur envoie en premier à votre navigateur le type MIME du fichier envoyé.</p></aside><p id="r-436623" data-claire-element-id="436623">Je vous demande donc maintenant de vérifier que le type MIME de l'image que vous avez choisie correspond bien à son extension, de façon à éviter des erreurs d'affichage. ;) C'est de la fonction getimagesize dont vous aurez besoin.<br/> Attention, à vos touches, prêts ? Tapez !<br/> …<br/> …<br/> …<br/> Là, vous êtes un peu longs. :-° <br/> Fini ? Non ? Pas trouvé ?<br/> Alors… :magicien:</p><pre id="r-436624" data-claire-element-id="436624"><code data-claire-semantic="html+php">&lt;?php
$ImageNews = getimagesize($_FILES['ImageNews']['tmp_name']);
if($ImageNews['mime'] == $ListeExtension[$ExtensionPresumee]  || $ImageNews['mime'] == $ListeExtensionIE[$ExtensionPresumee])
{
?&gt;</code></pre><h3 id="r-explications-27" data-claire-element-id="436639">Explications</h3><ul id="r-436632" data-claire-element-id="436632"><li id="r-436626" data-claire-element-id="436626"><p id="r-436625" data-claire-element-id="436625">On utilise la fonction getimagesize pour déterminer le type MIME de l'image, en se basant toujours sur le nom temporaire de l'image uploadée.</p></li><li id="r-436631" data-claire-element-id="436631"><p id="r-436627" data-claire-element-id="436627">On vérifie que le type MIME de l'image correspond à un type répertorié, en fonction du navigateur qui renvoie le type :<br/> (si le navigateur est MF)</p><pre id="r-436628" data-claire-element-id="436628"><code data-claire-semantic="html+php">&lt;?php if($ImageNews['mime'] == $ListeExtension[$ExtensionPresumee])?&gt;</code></pre><p id="r-436629" data-claire-element-id="436629">(si le navigateur est IE)</p><pre id="r-436630" data-claire-element-id="436630"><code data-claire-semantic="html+php">&lt;?php if($ImageNews['mime'] == $ListeExtensionIE[$ExtensionPresumee])?&gt;</code></pre></li></ul><p id="r-436633" data-claire-element-id="436633">Facile, non ?</p><p id="r-436634" data-claire-element-id="436634">Je vous vois d'ici me dire :</p><p id="r-436635" data-claire-element-id="436635"><cite>Citation : Vous</cite></p><blockquote id="r-436637" data-claire-element-id="436637"><p id="r-436636" data-claire-element-id="436636">… il est bien gentil lui, mais jusque-là on n'a toujours pas redimensionné notre image !</p></blockquote><p id="r-436638" data-claire-element-id="436638">Pas de panique, on y arrive. Par contre, à partir de là, et comme ce dossier doit rester un tutoriel, je ne vous exposerai que la façon de redimensionner une image au format JPEG. Il vous faudra donc, si vous voulez utiliser une image PNG ou GIF, faire un petit effort de relecture et d'adaptation (eh oui, je ne peux pas toujours vous mâcher le travail ^^ ).</p><h2 id="r-quatrieme-exercice-creons-notre-copie-d-image-a-redimensionner" data-claire-element-id="436655">Quatrième exercice : créons notre copie d'image à redimensionner</h2><p id="r-436641" data-claire-element-id="436641">Pour utiliser une image en vue de la redimensionner, il faut en créer une « sauvegarde », ici grâce à la fonction imagecreatefromjpeg.<br/> Vous souvenez-vous des explications de la partie 2 ?</p><aside id="r-436643" data-claire-element-id="436643" data-claire-semantic="warning"><p id="r-436642" data-claire-element-id="436642">Vous devrez vous servir du nom temporaire de l'image, récupéré par $_FILES, pour créer votre sauvegarde, et à condition que toutes les conditions précédentes aient été remplies.</p></aside><p id="r-436644" data-claire-element-id="436644">Sur ces mots, je vous laisse réfléchir, mes amis… ;)</p><pre id="r-436645" data-claire-element-id="436645"><code data-claire-semantic="html+php">&lt;?php
$ImageChoisie = imagecreatefromjpeg($_FILES['ImageNews']['tmp_name']);
?&gt;</code></pre><h3 id="r-explications-28" data-claire-element-id="436654">Explications</h3><ul id="r-436650" data-claire-element-id="436650"><li id="r-436647" data-claire-element-id="436647"><p id="r-436646" data-claire-element-id="436646">On récupère le nom temporaire de l'image que l'on a choisie au départ : $_FILES['ImagesNews']['tmp_name'].</p></li><li id="r-436649" data-claire-element-id="436649"><p id="r-436648" data-claire-element-id="436648">On lui applique la fonction imagecreatefromjpeg : imagecreatefromjpeg ($_FILES['ImageNews']['tmp_name']).</p></li></ul><aside id="r-436652" data-claire-element-id="436652" data-claire-semantic="information"><p id="r-436651" data-claire-element-id="436651">Rappel : si votre image est au format PNG, vous appliquerez imagecreatefrompng.</p></aside><p id="r-436653" data-claire-element-id="436653">Bravo, vous venez de sauvegarder votre image.<br/> Passons à la suite : il nous faut déterminer les dimensions de notre première image pour pouvoir jouer dessus et redimensionner notre copie.</p><h2 id="r-cinquieme-exercice-recuperer-les-dimensions-de-l-image-de-depart" data-claire-element-id="436668">Cinquième exercice : récupérer les dimensions de l'image de départ</h2><div id="r-436657" data-claire-element-id="436657" data-claire-semantic="question"><p id="r-436656" data-claire-element-id="436656">Quelle est la fonction qui permet de récupérer les dimensions d'un fichier posté ?</p></div><p id="r-436658" data-claire-element-id="436658"><strong>getimagesize</strong>, bravo ! :D <br/> N'oubliez pas : nous travaillons toujours sur le nom temporaire de l'image choisie ($_FILES['ImageNews']['tmp_name']), et vous appellerez la nouvelle variable correspondant à la taille de l'image $TailleImageChoisie (par exemple).<br/> Vous avez une minute montre en main… :pirate:</p><pre id="r-436659" data-claire-element-id="436659"><code data-claire-semantic="html+php">&lt;?php
$TailleImageChoisie = getimagesize($_FILES['ImageNews']['tmp_name']);
?&gt;</code></pre><p id="r-436660" data-claire-element-id="436660">Bon, là il n'y a pas grand-chose à expliquer… Tout est clair, non ?</p><p id="r-436661" data-claire-element-id="436661">Eh bien ! Vous avez fait du chemin d'un coup !<br/> Récapitulons :</p><ul id="r-436666" data-claire-element-id="436666"><li id="r-436663" data-claire-element-id="436663"><p id="r-436662" data-claire-element-id="436662">vous avez créé une copie de votre image ;</p></li><li id="r-436665" data-claire-element-id="436665"><p id="r-436664" data-claire-element-id="436664">vous avez défini ses dimensions.</p></li></ul><p id="r-436667" data-claire-element-id="436667">Il nous faut donc maintenant préciser les nouvelles dimensions que nous souhaitons appliquer à la future image (celle qui sera redimensionnée).</p><h2 id="r-sixieme-exercice-tailler-la-nouvelle-image" data-claire-element-id="436691">Sixième exercice : tailler la nouvelle image</h2><p id="r-436669" data-claire-element-id="436669">Plusieurs choix s'offrent ici à nous :</p><ul id="r-436676" data-claire-element-id="436676"><li id="r-436671" data-claire-element-id="436671"><p id="r-436670" data-claire-element-id="436670">créer une image dont largeur et hauteur seront les mêmes (déformations assurées :colere: ) ;</p></li><li id="r-436673" data-claire-element-id="436673"><p id="r-436672" data-claire-element-id="436672">déterminer séparément la nouvelle hauteur et la nouvelle largeur (perte de temps) ;</p></li><li id="r-436675" data-claire-element-id="436675"><p id="r-436674" data-claire-element-id="436674">ou définir une nouvelle largeur et déterminer la hauteur qui lui est proportionnelle.</p></li></ul><p id="r-436677" data-claire-element-id="436677">Mais pour cela il faudra, avant de pouvoir afficher la hauteur proportionnellement à la largeur, trouver le ratio largeur / hauteur de la première image, pour l'appliquer ensuite à la nouvelle taille. ;)</p><div id="r-436679" data-claire-element-id="436679" data-claire-semantic="question"><p id="r-436678" data-claire-element-id="436678">Quelles fonctions allez-vous utiliser ?</p></div><p id="r-436680" data-claire-element-id="436680">Aucune ! :p C'était un piège… Il nous suffira d'effectuer des calculs très simples.<br/> Au boulot, jeunes gens.</p><pre id="r-436681" data-claire-element-id="436681"><code data-claire-semantic="html+php">&lt;?php
// Étape 1 :
$NouvelleLargeur = 350;
 
// Étape 2 :
$Reduction = ( ($NouvelleLargeur * 100)/$TailleImageChoisie[0] );
 
// Étape 3 :
$NouvelleHauteur = ( ($TailleImageChoisie[1] * $Reduction)/100 );
?&gt;</code></pre><h3 id="r-explications-29" data-claire-element-id="436690">Explications</h3><ul id="r-436688" data-claire-element-id="436688"><li id="r-436683" data-claire-element-id="436683"><p id="r-436682" data-claire-element-id="436682"><strong>Étape 1</strong> : je définis « en dur » la largeur de ma future image. Ici, j'opte pour une largeur de 350 px.</p></li><li id="r-436685" data-claire-element-id="436685"><p id="r-436684" data-claire-element-id="436684"><strong>Étape 2</strong> : je calcule le pourcentage de réduction qui correspond au quotient de l'ancienne largeur par la nouvelle. Comme c'est un pourcentage, on multiplie le résultat par 100. ;)</p></li><li id="r-436687" data-claire-element-id="436687"><p id="r-436686" data-claire-element-id="436686"><strong>Étape 3</strong> : enfin, je détermine la hauteur de la nouvelle image en appliquant le pourcentage de réduction à l'ancienne hauteur. Vous vous souvenez ? Le premier paramètre de getimagesize définit la hauteur de l'image. ;) N'oubliez pas de diviser par 100 pour convertir en véritable valeur « dimension », sinon vous resterez en valeur « pourcentage » à cause de la réduction.</p></li></ul><p id="r-436689" data-claire-element-id="436689">Créons tout de suite la nouvelle image en lui appliquant ses nouvelles dimensions, que nous venons de trouver.</p><h2 id="r-septieme-exercice-creation-de-la-miniature" data-claire-element-id="436732">Septième exercice : création de la miniature</h2><p id="r-436692" data-claire-element-id="436692">Alors, comment s'y prendre ?<br/> Revenons un instant sur la liste des fonctions que nous devions utiliser :</p><ul id="r-436709" data-claire-element-id="436709"><li id="r-436694" data-claire-element-id="436694"><p id="r-436693" data-claire-element-id="436693">explode ;</p></li><li id="r-436696" data-claire-element-id="436696"><p id="r-436695" data-claire-element-id="436695">strtolower ;</p></li><li id="r-436698" data-claire-element-id="436698"><p id="r-436697" data-claire-element-id="436697">imagecreatefromjpeg ;</p></li><li id="r-436700" data-claire-element-id="436700"><p id="r-436699" data-claire-element-id="436699">getimagesize ;</p></li><li id="r-436702" data-claire-element-id="436702"><p id="r-436701" data-claire-element-id="436701">imagecreatetruecolor ;</p></li><li id="r-436704" data-claire-element-id="436704"><p id="r-436703" data-claire-element-id="436703">imagecopyresampled ;</p></li><li id="r-436706" data-claire-element-id="436706"><p id="r-436705" data-claire-element-id="436705">imagedestroy ;</p></li><li id="r-436708" data-claire-element-id="436708"><p id="r-436707" data-claire-element-id="436707">imagejpeg.</p></li></ul><p id="r-436710" data-claire-element-id="436710">Vous avez déjà intégré dans votre script les quatre premières. Nous nous servirons au cours de cet exercice des deux suivantes : <strong>imagecreatetruecolor</strong> et <strong>imagecopyresampled</strong> (nous parlerons des deux dernières un peu plus tard).</p><p id="r-436711" data-claire-element-id="436711"><strong>Rappels : </strong>la fonction imagecreatetruecolor doit être appelée après la fonction imagecreatefromjpeg, tandis que la fonction imagecopyresampled sert à ré-échantillonner l'image de départ en la nouvelle image désirée.<br/> Donc, d'abord imagecreatetruecolor, puis imagecopyresampled.</p><p id="r-436712" data-claire-element-id="436712">Vous devriez avoir déjà fini ! :colere: Que faites-vous à attendre, là ? Codez !</p><pre id="r-436713" data-claire-element-id="436713"><code data-claire-semantic="html+php">&lt;?php
//Etape 1 :
$NouvelleImage = imagecreatetruecolor($NouvelleLargeur , $NouvelleHauteur) or die (&quot;Erreur&quot;);
 
//Etape 2 :
imagecopyresampled($NouvelleImage , $ImageChoisie, 0, 0, 0, 0, $NouvelleLargeur, $NouvelleHauteur, $TailleImageChoisie[0],$TailleImageChoisie[1]);
?&gt;</code></pre><h3 id="r-explications-30" data-claire-element-id="436731">Explications</h3><ul id="r-436718" data-claire-element-id="436718"><li id="r-436715" data-claire-element-id="436715"><p id="r-436714" data-claire-element-id="436714"><strong>Étape 1</strong> : les paramètres d'imagecreatetruecolor entre parenthèses sont faciles à comprendre : je veux créer une nouvelle image de largeur $NouvelleLargeur et de hauteur $NouvelleHauteur. J'ai mis un die pour que l'on soit au courant si une erreur se produit.</p></li><li id="r-436717" data-claire-element-id="436717"><p id="r-436716" data-claire-element-id="436716"><strong>Étape 2</strong> : on ré-échantillonne la nouvelle image en précisant des paramètres qui doivent vous laisser perplexes. :) <br/> On place d'abord entre les parenthèses la variable qui correspond à notre image redimensionnée ($NouvelleImage), puis on indique celle que l'on a utilisée ($ImageChoisie). Ensuite, on indique la position relative de la nouvelle image en précisant les éventuels décalages que l'on veut lui attribuer : ici, j'ai choisi de ne rien décaler, donc j'ai mis 0, 0, 0, 0 pour caler les deux images aux mêmes coordonnées (abscisses et ordonnées). Puis on précise les nouvelles dimensions de la future image $NouvelleLargeur et $NouvelleHauteur. Enfin, il ne faut pas oublier de préciser les dimensions de l'ancienne image ($TailleImageChoisie[0] (= la largeur), $TailleImageChoisie[1] (= la hauteur)).</p></li></ul><p id="r-436719" data-claire-element-id="436719">Eh bien mes amis, nous en avons presque fini avec le redimensionnement de notre image. ;)</p><div id="r-436721" data-claire-element-id="436721" data-claire-semantic="question"><p id="r-436720" data-claire-element-id="436720">Pourquoi conserver l'image initiale, alors qu'elle ne nous sert plus à rien ?</p></div><p id="r-436722" data-claire-element-id="436722">Bonne question. La réponse est simple : vous pouvez vous en servir pour l'afficher en taille « réelle » lorsque votre miniature est une image cliquable (exemple d'un diaporama).<br/> Ici, il n'y a donc qu'une chose à faire : la supprimer, puisque nous ne nous servirons pas d'images cliquables dans mon exemple.</p><p id="r-436723" data-claire-element-id="436723">Allez, encore quelques efforts de mémoire.</p><div id="r-436725" data-claire-element-id="436725" data-claire-semantic="question"><p id="r-436724" data-claire-element-id="436724">Quelle fonction nous permet de supprimer un fichier image dont on ne veut plus ?</p></div><p id="r-436726" data-claire-element-id="436726">imagedestroy, bravo ! :)</p><p id="r-436727" data-claire-element-id="436727">Vous souvenez-vous de la copie sauvegardée de notre image ? Celle que l'on a nommée $ImageChoisie, et que l'on a obtenue grâce à la fonction imagecreatefromjpeg ?<br/> Eh bien, vous allez vous en servir, parce que c'est elle qu'il faut supprimer !<br/> Allez, je vous attends… :soleil:</p><pre id="r-436728" data-claire-element-id="436728"><code data-claire-semantic="html+php">&lt;?php
imagedestroy($ImageChoisie);
?&gt;</code></pre><p id="r-436729" data-claire-element-id="436729">Résumons un peu, maintenant.<br/> Nous avons choisi une image à redimensionner, déterminé ses dimensions, créé une copie sauvegardée de cette image, redimensionné l'image comme voulu, ré-échantillonné l'image pour pouvoir l'utiliser, et détruit l'image choisie au départ pour éviter de surcharger le serveur.<br/> Notre travail est donc terminé. Youpi !</p><p id="r-436730" data-claire-element-id="436730">Mais les plus attentifs me diront que nous n'avons pas utilisé la fonction imagejpeg dont nous avions parlé dans la seconde sous-partie. Elle n'intervient pas dans le redimensionnement mais dans l'enregistrement du fichier dans un dossier spécifique. Et comme je suis très gentil, je vais vous montrer en bonus comment utiliser cette dernière fonction et ainsi enregistrer notre image redimensionnée dans un dossier précis de votre serveur. ;)</p><h2 id="r-bonus-enregistrer-notre-nouvelle-image-grace-a-imagejpeg" data-claire-element-id="436759">Bonus : enregistrer notre nouvelle image grâce à imagejpeg</h2><p id="r-436733" data-claire-element-id="436733">Nous allons suivre ici la logique adoptée depuis le début, mais nous allons en plus sécuriser le nom de l'image grâce à une fonction supplémentaire. Le but de cette démarche sera d'éviter les doublons de noms lors de l'insertion et d'éviter les problèmes de sécurité liés à la conservation du nom de l'image lors de l'envoi.</p><h3 id="r-retrouver-le-nom-de-l-image-en-utilisant-explode" data-claire-element-id="436738">Retrouver le nom de l'image en utilisant explode</h3><p id="r-436734" data-claire-element-id="436734">Une nouvelle fois, explode va se montrer fort utile. Tout ce que nous voulons, c'est supprimer (provisoirement) l'extension de notre image pour ne conserver que son nom. Alors, c'est du gâteau, n'est-ce pas ?</p><aside id="r-436736" data-claire-element-id="436736" data-claire-semantic="information"><p id="r-436735" data-claire-element-id="436735">Je pars du principe que je modifie le nom original de l'image de départ, récupérée par $_FILES, et que j'ai nommée au début $ImageNews.</p></aside><pre id="r-436737" data-claire-element-id="436737"><code data-claire-semantic="html+php">&lt;?php
$NomImageChoisie = explode('.', $ImageNews);
?&gt;</code></pre><h3 id="r-modifier-le-nom-retrouve-pour-securiser-notre-insertion" data-claire-element-id="436747">Modifier le nom retrouvé pour sécuriser notre insertion</h3><p id="r-436739" data-claire-element-id="436739">Je crée donc une variable $NomImageExploitable, correspondant au nom définitif de mon image. C'est cette variable qui sera « cryptée » numériquement. Pour cela il faudra, par exemple, utiliser la fonction time() (mais la fonction microtime() peut également être utilisée ;) ).</p><pre id="r-436740" data-claire-element-id="436740"><code data-claire-semantic="html+php">&lt;?php
$NomImageExploitable = time();
?&gt;</code></pre><p id="r-436741" data-claire-element-id="436741"><strong>Petite explication au passage</strong></p><p id="r-436742" data-claire-element-id="436742">Il est préférable, pour alléger le code, d'écrire ceci :</p><pre id="r-436743" data-claire-element-id="436743"><code data-claire-semantic="html+php">&lt;?php
$NomImageExploitable = time();
?&gt;</code></pre><p id="r-436744" data-claire-element-id="436744">plutôt que cela :</p><pre id="r-436745" data-claire-element-id="436745"><code data-claire-semantic="html+php">&lt;?php
$NomImageExploitable = time($NomImageChoisie[0]);</code></pre><p id="r-436746" data-claire-element-id="436746">puisque le nom original de l'image ne nous sert ici plus à rien (ben oui, on le « crypte » ;) ).</p><h3 id="r-finir-en-enregistrant-la-nouvelle-image-dans-le-dossier-de-notre-choix-tout-en-choisissant-sa-qualite" data-claire-element-id="436758">Finir en enregistrant la nouvelle image dans le dossier de notre choix, tout en choisissant sa qualité</h3><p id="r-436748" data-claire-element-id="436748">C'est ici que nous allons utiliser notre dernière fonction, imagejpeg, en stipulant le nom de la variable contenant la nouvelle image ($NouvelleImage), la dénomination de celle-ci ($NomImageExploitable) et son extension ($ExtensionPresumee), et finalement la qualité de ré-échantillonnage (valeur numérique de 0 à 100).</p><pre id="r-436749" data-claire-element-id="436749"><code data-claire-semantic="html+php">&lt;?php
imagejpeg($NouvelleImage , 'imagesnews/'.$NomImageExploitable.'.'.$ExtensionPresumee, 100);
?&gt;</code></pre><p id="r-436750" data-claire-element-id="436750"><strong>Explications</strong></p><p id="r-436751" data-claire-element-id="436751">J'ai choisi un dossier fictif nommé <strong>imagesnews</strong>. Je détermine l'extension de mon image redimensionnée grâce au paramètre de l'array $ExtensionPresumee.<br/> Je l'enregistre avec une <strong>qualité de 100</strong> (qualité maximale). Mais bien souvent, une valeur de 80 suffit amplement. ;) <br/> Voilà, votre image redimensionnée est enregistrée dans le dossier imagesnews, avec une qualité de 100, et des dimensions choisies.</p><p id="r-436752" data-claire-element-id="436752">Pour finir, une petite devinette.</p><div id="r-436754" data-claire-element-id="436754" data-claire-semantic="question"><p id="r-436753" data-claire-element-id="436753">Comment insérer un lien relatif dans ma BDD, et récupérer cette image facilement dans mes news ?</p></div><p id="r-436755" data-claire-element-id="436755">Je crée une variable $LienImageNews qui aura pour valeur le chemin relatif vers la nouvelle image :</p><pre id="r-436756" data-claire-element-id="436756"><code data-claire-semantic="html+php">&lt;?php
$LienImageNews = 'imagesnews/'.$NomImageExploitable.'.'.$ExtensionPresumee;
?&gt;</code></pre><p id="r-436757" data-claire-element-id="436757">puis je l'insère dans ma page. ;)</p><h2 id="r-extra-bonus-code-possible-pour-l-utilisation-d-une-image-jpeg" data-claire-element-id="436775">Extra-bonus : code possible pour l'utilisation d'une image JPEG</h2><p id="r-436760" data-claire-element-id="436760">N'oubliez pas de vous référer au code de notre formulaire d'insertion de la première sous-partie pour comprendre l'utilisation des variables. J'évite volontairement la connexion à la BDD, parce que chacun a sa propre méthode (en dur dans le code, en include…).</p><pre id="r-436761" data-claire-element-id="436761"><code data-claire-semantic="html+php">&lt;?php
if (!empty($_POST['InsererNews']))
{
        $ListeExtension = array('jpg' =&gt; 'image/jpeg', 'jpeg'=&gt;'image/jpeg');
        $ListeExtensionIE = array('jpg' =&gt; 'image/pjpeg', 'jpeg'=&gt;'image/pjpeg');
        if (!empty($_POST['TitreNews']) &amp;&amp; (!empty($_FILES['ImageNews'])) &amp;&amp; (!empty($_POST['ContenuNews'])))
        {
                $TitreNews = $_POST['TitreNews'];
                $ContenuNews = $_POST['ContenuNews'];
 
                if ($_FILES['ImageNews']['error'] &lt;= 0)
                {
                        if ($_FILES['ImageNews']['size'] &lt;= 2097152)
                        {
                            $ImageNews = $_FILES['ImageNews']['name'];
 
                            $ExtensionPresumee = explode('.', $ImageNews);
                            $ExtensionPresumee = strtolower($ExtensionPresumee[count($ExtensionPresumee)-1]);
                            if ($ExtensionPresumee == 'jpg' || $ExtensionPresumee == 'jpeg')
                            {
                              $ImageNews = getimagesize($_FILES['ImageNews']['tmp_name']);
                              if($ImageNews['mime'] == $ListeExtension[$ExtensionPresumee]  || $ImageNews['mime'] == $ListeExtensionIE[$ExtensionPresumee])
{
 
                                              $ImageChoisie = imagecreatefromjpeg($_FILES['ImageNews']['tmp_name']);
                                              $TailleImageChoisie = getimagesize($_FILES['ImageNews']['tmp_name']);
                                              $NouvelleLargeur = 350; //Largeur choisie à 350 px mais modifiable
 
                                              $NouvelleHauteur = ( ($TailleImageChoisie[1] * (($NouvelleLargeur)/$TailleImageChoisie[0])) );
 
                                              $NouvelleImage = imagecreatetruecolor($NouvelleLargeur , $NouvelleHauteur) or die (&quot;Erreur&quot;);
 
                                              imagecopyresampled($NouvelleImage , $ImageChoisie  , 0,0, 0,0, $NouvelleLargeur, $NouvelleHauteur, $TailleImageChoisie[0],$TailleImageChoisie[1]);
                                              imagedestroy($ImageChoisie);
                                              $NomImageChoisie = explode('.', $ImageNews);
                                              $NomImageExploitable = time();
                                              
                                              imagejpeg($NouvelleImage , 'imagesnews/'.$NomImageExploitable.'.'.$ExtensionPresumee, 100);
                                              $LienImageNews = 'imagesnews/'.$NomImageExploitable.'.'.$ExtensionPresumee;
 
                                              $sql= 'INSERT INTO votre_table VALUES (&quot;&quot;, &quot;'.$TitreNews.'&quot;, &quot;'.$ContenuNews.'&quot;, &quot;'.$LienImageNews.'&quot;, &quot;'.time().'&quot;)';
                                              $res = mysql_query($sql) or die(mysql_error());
                                              if ($res)
                                              {
                                                      echo 'La news a bien été insérée';
                                              }
                                        }
                                        else
                                        {
                                                echo 'Le type MIME de l\'image n\'est pas bon';
                                        }
                                }
                                else
                                {
                                        echo 'L\'extension choisie pour l\'image est incorrecte';
                                }
                        }
                        else
                        {
                                echo 'L\'image est trop lourde';
                        }
                }
                else
                {
                        echo 'Erreur lors de l\'upload image';
                }
        }
        else
        {
                echo 'Au moins un des champs est vide';
        }
}
?&gt;</code></pre><aside id="r-436763" data-claire-element-id="436763" data-claire-semantic="warning"><p id="r-436762" data-claire-element-id="436762">Notez que je n'ai pas sécurisé les données ! J'ai effectué une simple vérification des données concernant l'image. Il vous faudra vérifier les autres variables.</p></aside><p id="r-436764" data-claire-element-id="436764">Par exemple, passez $TitreNews, $ContenuNews par un <strong>mysql_real_escape_string</strong>, <strong>htmlspecialchars</strong> et <strong>trim</strong>, vérifiez que le nom de vos fichiers ne contienne pas d'espaces superflues qui pourraient bloquer la vérification, etc.</p><p id="r-436765" data-claire-element-id="436765">De plus, <strong>il vous faudra assurer la connexion à votre base de données</strong>. ;)</p><p id="r-436766" data-claire-element-id="436766">Voilà, c'est fini (ça me rappelle une chanson, ça !).<br/> En espérant que ce tuto vous ait appris 2 ou 3 petites choses, et surtout qu'il vous servira.<br/> Vous aurez remarqué que ce script n'apporte pas une sécurité optimale (faille du byte NULL par exemple ;) ).<br/> De plus il est préférable, quand cela est possible, d'utiliser la fonction system ou shell_exec pour connaître le type MIME du fichier de façon un peu plus certaine.</p><p id="r-436767" data-claire-element-id="436767">Je tiens à remercier tout particulièrement mon grand ami <strong>inazo</strong>, sans qui rien n'aurait été possible. ;)</p><p id="r-436768" data-claire-element-id="436768">P.−S. − J'ai choisi ici de détruire l'image source, mais il vous est possible de la conserver sous un nom facilement identifiable pour permettre son affichage simultané.<br/> Exemple :</p><pre id="r-436769" data-claire-element-id="436769"><code data-claire-semantic="html+php">&lt;?php
//Enregistrement de l'image redimensionnée :
imagejpeg($NouvelleImage , 'imagesnews/'.$NomImageExploitable.'.'.$ExtensionPresumee, 100);
 
//Enregistrement de l'image initiale :
imagejpeg($ImageChoisie , 'imagesnews/'.$NomImageExploitable.'FullImage.'.$ExtensionPresumee, 100);
?&gt;</code></pre><div id="r-436771" data-claire-element-id="436771" data-claire-semantic="question"><p id="r-436770" data-claire-element-id="436770">Quel est l'intérêt d'un tel code ?</p></div><p id="r-436772" data-claire-element-id="436772">Vous conservez l'image de départ et sa miniature, et vous créez votre diaporama facilement. :D</p><p id="r-436773" data-claire-element-id="436773">Je vous remercie d'avoir suivi ce tutoriel jusqu'au bout et je suis très impatient de répondre à vos critiques.</p><p id="r-436774" data-claire-element-id="436774">Cordialement,<br/> ratdelabo.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer">[GD] Redimensionner une image sans la déformer</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer/quelques-rappels-utiles">
Quelques rappels utiles…
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer/des-fonctions-tres-graphiques">
Des fonctions très… graphiques
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer/redimensionnons-mais-sans-deformer">
Redimensionnons, mais sans déformer !
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/gd-redimensionner-une-image-sans-la-deformer/des-fonctions-tres-graphiques">
<span class="arrow"></span>
<span class="next">Des fonctions très… graphiques</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/gd-redimensionner-une-image-sans-la-deformer.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:54:39 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/gd-redimensionner-une-image-sans-la-deformer.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:38:21 GMT -->
</html>