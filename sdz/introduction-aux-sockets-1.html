<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/introduction-aux-sockets-1.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 01:19:11 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/introduction-aux-sockets-1.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:21:07 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Introduction aux sockets</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/introduction-aux-sockets-1.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Introduction aux sockets</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Introductionauxsockets">Introduction aux sockets</a><br/><a href="#RcupreruneadresseIPavecInetAddress">Récupérer une adresse IP avec InetAddress</a><br/><a href="#Qu039est-cequ039unsocket">Qu&#039;est-ce qu&#039;un socket ?</a><br/><a href="#changedemessage">Échange de message</a><br/><a href="#TPunmini-chatentreleclientetleserveur">TP : un mini-chat entre le client et le serveur !</a><br/></div>
<a name="Introductionauxsockets"></a><h2>Introduction aux sockets</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/recuperer-une-adresse-ip-avec-inetaddress">
<span class="next">Récupérer une adresse IP avec InetAddress</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-467022" data-claire-element-id="467022">Bienvenue dans mon tout premier mini-tutoriel consacré aux sockets en langage Java. On ne va pas tout apprendre sur les sockets mais étudier le plus important concernant ces classes du répertoire java.net.</p><aside id="r-467024" data-claire-element-id="467024" data-claire-semantic="warning"><p id="r-467023" data-claire-element-id="467023">Avant de vous lancer dans la lecture de ce tutoriel, les deux premières parties de cysboy sur le <a href="http://www.siteduzero.com/tutoriel-3-10601-programmation-en-java.html">langage Java</a> ainsi que la lecture de celui sur <a href="http://www.siteduzero.com/tutoriel-3-10516-les-threads.html">les <em>threads</em></a> et <a href="http://www.siteduzero.com/tutoriel-3-65524-les-flux-d-entrees-sorties-1-2.html">les flux d'entrées et sorties (1/2)</a> sont primordiales pour bien suivre le cours !</p></aside><p id="r-467025" data-claire-element-id="467025">Je vous recommande également de lire le chapitre de Dalshim <a href="http://www.siteduzero.com/tutoriel-3-127772-bien-fermer-ses-threads-en-java.html"><em>Bien fermer ses threads en Java</em></a> si vous voulez bien maîtriser la fermeture de vos <em>threads</em>.</p><p id="r-467026" data-claire-element-id="467026">Les sockets servent à communiquer entre deux hôtes appelés Client / Serveur à l'aide d'une adresse IP et d'un port que j'appelle prise ; ces sockets permettront de gérer des flux entrant et sortant afin d'assurer une communication entre les deux (le client et le serveur), soit de manière fiable à l'aide du protocole TCP/IP, soit non fiable mais plus rapide avec le protocole UDP. Nous allons étudier le premier mode, le mode TCP/IP…</p><p id="r-467027" data-claire-element-id="467027">Voici ce qu'on peut réaliser à l'aide des sockets :</p><ul id="r-467038" data-claire-element-id="467038"><li id="r-467029" data-claire-element-id="467029"><p id="r-467028" data-claire-element-id="467028">des jeux en ligne ;</p></li><li id="r-467031" data-claire-element-id="467031"><p id="r-467030" data-claire-element-id="467030">des systèmes distribués ;</p></li><li id="r-467033" data-claire-element-id="467033"><p id="r-467032" data-claire-element-id="467032">des espaces <em>messengers</em> comme MSN Messenger, Yahoo Messenger, … ;</p></li><li id="r-467035" data-claire-element-id="467035"><p id="r-467034" data-claire-element-id="467034">des applications comme BitComet permettant de gérer les fichiers .torrent que vous connaissez ;</p></li><li id="r-467037" data-claire-element-id="467037"><p id="r-467036" data-claire-element-id="467036">et bien d'autres choses.</p></li></ul><p id="r-467039" data-claire-element-id="467039">Les sockets sont utilisés dans plusieurs autres langages, tels que :</p><ul id="r-467052" data-claire-element-id="467052"><li id="r-467041" data-claire-element-id="467041"><p id="r-467040" data-claire-element-id="467040">le langage C : <a href="http://www.siteduzero.com/tutoriel-3-3273-histoire-et-fonctionnement.html">( lien vers un tutoriel)</a> ;</p></li><li id="r-467043" data-claire-element-id="467043"><p id="r-467042" data-claire-element-id="467042">le langage C++ : <a href="http://www.siteduzero.com/tutoriel-3-11396-communiquer-en-reseau-avec-son-programme.html">(lien vers un autre tutoriel) ;</a></p></li><li id="r-467045" data-claire-element-id="467045"><p id="r-467044" data-claire-element-id="467044">le langage PHP : <a href="http://www.siteduzero.com/tutoriel-3-10118-comment-utiliser-les-sockets-avec-php-comment-faire-un-chat-avec-les-sockets">(lien vers un troisième tutoriel) ;</a></p></li><li id="r-467047" data-claire-element-id="467047"><p id="r-467046" data-claire-element-id="467046">l'Action Script : <a href="http://www.siteduzero.com/tutoriel-3-63640-creer-une-animation-flash-qui-communique-avec-un-serveur.html">(aller lire le tutoriel) ;</a></p></li><li id="r-467049" data-claire-element-id="467049"><p id="r-467048" data-claire-element-id="467048">le Erlang : <a href="http://www.siteduzero.com/tutoriel-3-66044-les-sockets.html">(lien vers le tuto concerné)</a> ;</p></li><li id="r-467051" data-claire-element-id="467051"><p id="r-467050" data-claire-element-id="467050">et bien d'autres.</p></li></ul><p id="r-467053" data-claire-element-id="467053">Lire les parties « histoire » et « définitions » de tutoriels ci-dessus ne vous fera pas de mal.<br/> Ne tardons pas et commençons. :)</p>
</div><a name="RcupreruneadresseIPavecInetAddress"></a><h2>Récupérer une adresse IP avec InetAddress</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/qu-est-ce-qu-un-socket">
<span class="next">Qu&#039;est-ce qu&#039;un socket ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-467054" data-claire-element-id="467054">Le package java.net de la plate-forme Java fournit une classe InetAddress qui nous permet de récupérer et manipuler son adresse internet, IP pour les intimes. Cette classe n'a pas de constructeur, pour pouvoir avoir une instance de cette classe on a besoin des <strong>méthodes de classe</strong>. Voici les méthodes dont je vous parle :</p><ul id="r-467061" data-claire-element-id="467061"><li id="r-467056" data-claire-element-id="467056"><p id="r-467055" data-claire-element-id="467055"><em>getLocalHost()</em> : elle retourne un objet qui contient l'adresse IP de la machine locale.</p></li><li id="r-467058" data-claire-element-id="467058"><p id="r-467057" data-claire-element-id="467057"><em>getByName(String nom_de_l_machine)</em> : elle retourne un objet qui contient l'adresse IP de la machine dont le nom est passé en paramètre.</p></li><li id="r-467060" data-claire-element-id="467060"><p id="r-467059" data-claire-element-id="467059"><em>getAllByName(String nom_de_l_machine)</em> : elle retourne un tableau d'objets qui contient l'ensemble d'adresses IP de la machine qui correspond au nom passé en paramètre.</p></li></ul><p id="r-467062" data-claire-element-id="467062">A présent, voyons les méthodes applicables à un objet de cette classe :</p><ul id="r-467069" data-claire-element-id="467069"><li id="r-467064" data-claire-element-id="467064"><p id="r-467063" data-claire-element-id="467063"><em>getHostName() </em> : elle retourne le nom de la machine dont l'adresse est stockée dans l'objet.</p></li><li id="r-467066" data-claire-element-id="467066"><p id="r-467065" data-claire-element-id="467065"><em>getAddress()</em> : elle retourne l'adresse IP stockée dans l'objet sous forme d'un tableau de 4 octets.</p></li><li id="r-467068" data-claire-element-id="467068"><p id="r-467067" data-claire-element-id="467067"><em>toString()</em> : elle retourne un String qui correspond au nom de la machine et son adresse.</p></li></ul><p id="r-467070" data-claire-element-id="467070">Et pour terminer un petit exemple :</p><pre id="r-467071" data-claire-element-id="467071"><code data-claire-semantic="java">import java.net.InetAddress;
import java.net.UnknownHostException;


public class Adressage {
	
	public static void main(String[] zero) {
		
		InetAddress LocaleAdresse ;
		InetAddress ServeurAdresse;

		try {

			LocaleAdresse = InetAddress.getLocalHost();
			System.out.println(&quot;L'adresse locale est : &quot;+LocaleAdresse ); 
			
			ServeurAdresse= InetAddress.getByName(&quot;www.siteduzero.com&quot;);
                        System.out.println(&quot;L'adresse du serveur du site du zéro est : &quot;+ServeurAdresse);
		
		} catch (UnknownHostException e) {
			
			e.printStackTrace();
		}
	}

}</code></pre><p id="r-467072" data-claire-element-id="467072">Et le résultat est :</p><pre id="r-467073" data-claire-element-id="467073"><code data-claire-semantic="console">L'adresse locale est : softdeath/239.254.78.177
L'adresse du serveur du site du zéro est : www.siteduzero.com/80.248.219.123</code></pre><p id="r-467074" data-claire-element-id="467074">Fastoche, hein ? :magicien:</p><aside id="r-467076" data-claire-element-id="467076" data-claire-semantic="warning"><p id="r-467075" data-claire-element-id="467075">La classe <em>InetAdress </em>peut lever une exception de type <em>UnknownHostException</em>, tâchez de ne pas l'oublier !</p></aside><p id="r-467077" data-claire-element-id="467077">Nous savons maintenant comment récupérer l'adresse IP de notre machine ou d'une machine distante, que diriez-vous si l'on l'utilisait pour créer notre tout premier socket ? C'est parti ;)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1">Introduction aux sockets</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/recuperer-une-adresse-ip-avec-inetaddress">
Récupérer une adresse IP avec InetAddress
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/qu-est-ce-qu-un-socket">
Qu&#039;est-ce qu&#039;un socket ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/echange-de-message">
Échange de message
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/tp-un-mini-chat-entre-le-client-et-le-serveur">
TP : un mini-chat entre le client et le serveur !
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/qu-est-ce-qu-un-socket">
<span class="next">Qu&#039;est-ce qu&#039;un socket ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Qu039est-cequ039unsocket"></a><h2>Qu&#039;est-ce qu&#039;un socket ?</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/recuperer-une-adresse-ip-avec-inetaddress">
<span class="arrow"></span>
<span class="next">Récupérer une adresse IP avec InetAddress</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/echange-de-message">
<span class="next">Échange de message</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-467079" data-claire-element-id="467079">Un socket est un point de terminaison d'une communication <em>bidirectionnelle</em>, c'est-à-dire entre un client et un serveur en cours d'exécution sur un réseau donné. Les deux sont liés par un même numéro de port TCP de sorte que la couche puisse identifier la demande de partage de données.</p><p id="r-467080" data-claire-element-id="467080">Un serveur fonctionne sur une machine bien définie et est lié à un numéro de port spécifique. Le serveur se met simplement à l'écoute d'un client, qui demande une connexion.</p><figure id="r-467082" data-claire-element-id="467083"><img id="r-467081" data-claire-element-id="467081" src="medias/uploads.siteduzero.com_files_192001_193000_192109.jpg" alt="Image utilisateur"/></figure><p id="r-467084" data-claire-element-id="467084">En outre, java.net comprend la classe <em>ServerSocket</em>, qui met en oeuvre une sorte de prise que les serveurs peuvent utiliser pour écouter et accepter les connexions des clients. Ce qui nous donne :</p><pre id="r-467085" data-claire-element-id="467085"><code data-claire-semantic="java">ServerSocket socketserver = new ServerSocket(numero_port);</code></pre><p id="r-467086" data-claire-element-id="467086">Ainsi on obtient un objet de la classe <em>ServerSocket </em>sur un port spécifique : si ce dernier est à 0, le socket est créée sur n'importe quel port libre.</p><p id="r-467087" data-claire-element-id="467087">Il existe deux autres constructeurs ; l'un a deux paramètres, le premier est bien sûr le numéro de port et le <em>nombre total de connexion simultanées acceptées</em>, voyez :</p><pre id="r-467088" data-claire-element-id="467088"><code data-claire-semantic="java">ServerSocket socketserver = new ServerSocket(numer_port,nbr_max);</code></pre><p id="r-467089" data-claire-element-id="467089"><strong>nbr_max</strong> est le nombre maximal de connexions traitées simultanément. Par exemple au-delà de cinq tentatives de connexion consécutives autorisées, les connexions sont refusés.</p><p id="r-467090" data-claire-element-id="467090">Pour le second constructeur il suffit de spécifier l'adresse locale du serveur.</p><pre id="r-467091" data-claire-element-id="467091"><code data-claire-semantic="java">ServerSocket socketserver = new ServerSocket(numer_port,nbr_max,adresse_locale);</code></pre><p id="r-467092" data-claire-element-id="467092">Quant au client, celui-ci connaît le nom de la machine sur laquelle le serveur est en exécution et le numéro de port sur lequel il écoute. Le client va demander une connexion au serveur en s'identifiant avec son adresse IP ainsi que le numéro de port qui lui est lié.</p><p id="r-467093" data-claire-element-id="467093">Pour cela, le package java.net fournit une classe <em>Socket </em>qui met en œuvre une connexion bidirectionnelle entre votre programme Java et un autre programme situé sur le réseau. La classe <em>Socket </em>permet de cacher les détails d'implémentation de cette connexion. En utilisant cette classe en lieu et place d'un code natif, vos programmes peuvent communiquer sur le réseau quel que soit la plateforme sur laquelle ils se trouvent. La création d'un socket pour un programme client s'effectue à l'aide d'un des constructeurs suivants :</p><pre id="r-467094" data-claire-element-id="467094"><code data-claire-semantic="java">Socket socket = new Socket(param1, param2)</code></pre><p id="r-467095" data-claire-element-id="467095">Le premier paramètre correspond à l'identité du client, il peut être une chaine de caractère ou de type <em>InetAddress</em>, param2 correspond au numéro de port sur lequel on souhaite se connecter sur le serveur. Il est possible également de spécifier son adresse local comme troisième paramètre et le numéro de port local :</p><pre id="r-467096" data-claire-element-id="467096"><code data-claire-semantic="java">Socket socket = new Socket(adresse_distante, port_distant, adresse_locale, port_locale)</code></pre><p id="r-467097" data-claire-element-id="467097">Après tentative de connexion, si tout va bien, le serveur accepte la connexion du client, et reçoit un nouveau socket qui est directement lié au même port local. Il a besoin d'une nouvelle prise de sorte qu'elle puisse continuer à écouter le socket d'origine pour les demandes de connexion, tout t'en satisfaisant les besoins du client connecté. Voici comment accepter une connexion d'un client :</p><pre id="r-467098" data-claire-element-id="467098"><code data-claire-semantic="java">Socket socketduserveur = socketserver.accept();</code></pre><p id="r-467099" data-claire-element-id="467099">Une fois le socket créé, l'attente de connexion provenant du client se fait à l'aide de la méthode <em>accept()</em>.</p><aside id="r-467101" data-claire-element-id="467101" data-claire-semantic="warning"><p id="r-467100" data-claire-element-id="467100">La méthode accept() reste bloquante tant qu'elle n'a pas détecté de connexion.</p></aside><p id="r-467102" data-claire-element-id="467102">Afin d'éviter une attente infinie, il est possible de spécifier un délai maximal d'attente à l'aide d'un mutateur <em>setSoTimeout</em>.</p><p id="r-467103" data-claire-element-id="467103">Si un <em>timeout </em>est une valeur strictement positive, l'appel <em>accept()</em> va générer une attente maximale égale à <em>timeout</em>. Si ce temps expire, une exception de type <em>InterruptedIOException </em>est levée sans toute fois que la socket de type <em>ServerSocket</em> ne soit invalidée. La lecture de ce <em>timeout </em>se fait à l'aide de l'accesseur <em>getSoTimeout()</em>.</p><p id="r-467104" data-claire-element-id="467104">Côté client, si la connexion est acceptée, une socket est créé et le client peut utiliser la socket pour communiquer avec le serveur.<br/> L'établissement d'une connexion peut lever une exception de type <em>IOException</em>.</p><p id="r-467105" data-claire-element-id="467105">On va essayer d'établir une communication. Vous avez tout les éléments à portée de main, vous pouvez désormais établir une connexion, au boulot ! :pirate:</p><p id="r-467106" data-claire-element-id="467106">...Ce n'était pas si difficile que ça, voyons la correction :) <br/> Le client et le serveur peuvent à présent communiquer par l'écriture ou la lecture de leurs prises. :)</p><p id="r-467107" data-claire-element-id="467107"></p><div id="r-467112" data-claire-element-id="467112"><p id="r-467108" data-claire-element-id="467108"><em><strong>Serveur.java</strong></em></p><pre id="r-467109" data-claire-element-id="467109"><code data-claire-semantic="java">import java.io.IOException;
import java.net.ServerSocket;
import java.net.Socket;

public class Serveur {

	public static void main(String[] zero) {
		
		ServerSocket socketserver  ;
		Socket socketduserveur ;

		try {
		
			socketserver = new ServerSocket(2009);
			socketduserveur = socketserver.accept(); 
			System.out.println(&quot;Un zéro s'est connecté !&quot;);
		        socketserver.close();
		        socketduserveur.close();

		}catch (IOException e) {
			e.printStackTrace();
		}
	}

}</code></pre><p id="r-467110" data-claire-element-id="467110"><em><strong>Client.java</strong></em></p><pre id="r-467111" data-claire-element-id="467111"><code data-claire-semantic="java">import java.io.IOException;
import java.net.InetAddress;
import java.net.Socket;
import java.net.UnknownHostException;


public class Client {
	
	public static void main(String[] zero) {
		
		Socket socket;

		try {
		
		     socket = new Socket(InetAddress.getLocalHost(),2009);	
	             socket.close();

		}catch (UnknownHostException e) {
			
			e.printStackTrace();
		}catch (IOException e) {
			
			e.printStackTrace();
		}
	}

}</code></pre></div><aside id="r-467114" data-claire-element-id="467114" data-claire-semantic="error"><p id="r-467113" data-claire-element-id="467113">Lancez le serveur en premier et ensuite le client !</p></aside><p id="r-467115" data-claire-element-id="467115">Vous venez d'établir votre première connexion entre un serveur et un client :magicien: . Maintenant, voyons comment envoyer et recevoir des messages.</p><aside id="r-467117" data-claire-element-id="467117" data-claire-semantic="warning"><p id="r-467116" data-claire-element-id="467116">Attention : il ne faut jamais oublier de fermer le socket ! Sinon si vous utilisez le même port dans un autre programme, ce (l'action de fermer une socket) ne sera plus possible car il (le port) sera occupé !</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1">Introduction aux sockets</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/recuperer-une-adresse-ip-avec-inetaddress">
Récupérer une adresse IP avec InetAddress
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/qu-est-ce-qu-un-socket">
Qu&#039;est-ce qu&#039;un socket ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/echange-de-message">
Échange de message
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/tp-un-mini-chat-entre-le-client-et-le-serveur">
TP : un mini-chat entre le client et le serveur !
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/recuperer-une-adresse-ip-avec-inetaddress">
<span class="arrow"></span>
<span class="next">Récupérer une adresse IP avec InetAddress</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/echange-de-message">
<span class="next">Échange de message</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="changedemessage"></a><h2>Échange de message</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/qu-est-ce-qu-un-socket">
<span class="arrow"></span>
<span class="next">Qu&#039;est-ce qu&#039;un socket ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/tp-un-mini-chat-entre-le-client-et-le-serveur">
<span class="next">TP : un mini-chat entre le client et le serveur !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-467119" data-claire-element-id="467119">Une fois la connexion établie et <strong>les sockets en possession</strong>, il est possible de récupérer le flux d'entrée et de sortie de la connexion TCP vers le serveur. Il existe deux méthodes pour permettre la récupération des flux :</p><ul id="r-467124" data-claire-element-id="467124"><li id="r-467121" data-claire-element-id="467121"><p id="r-467120" data-claire-element-id="467120"><em>getInputStream()</em> de la classe <em>InputStream</em>. Elle nous permet de gérer les flux entrant ;</p></li><li id="r-467123" data-claire-element-id="467123"><p id="r-467122" data-claire-element-id="467122"><em>getOutputStream()</em> de la classe <em>OuputStream</em>. Elle nous permet de gérer les flux sortant.</p></li></ul><p id="r-467125" data-claire-element-id="467125">Ces deux méthodes nous permettent donc de gérer les flux en entrée et en sortie. En général le type d'entrée et sortie utilisé est <em>BufferedReader</em> et <em>InputStreamReader</em> pour la lecture, <em>PrintWriter</em> pour l'écriture. Mais on peut utiliser tous les autres flux.</p><p id="r-467126" data-claire-element-id="467126">En se basant sur l'annexe du tuto Java :</p><ul id="r-467133" data-claire-element-id="467133"><li id="r-467128" data-claire-element-id="467128"><p id="r-467127" data-claire-element-id="467127"><em>BufferedReader</em> : cette classe permet de lire des caractères à partir d'un flux tamponné, afin de faire des lectures plus rapides ;</p></li><li id="r-467130" data-claire-element-id="467130"><p id="r-467129" data-claire-element-id="467129"><em>InputStreamReader</em> : convertit un flux binaire en flux de caractères : elle convertit un objet de type <em>InputStream</em> en objet de type <em>Reader</em> ;</p></li><li id="r-467132" data-claire-element-id="467132"><p id="r-467131" data-claire-element-id="467131"><em>PrintWriter </em> : la classe PrintWriter ajoute à un flux la possibilité de faire des écritures sous forme de texte des types primitifs Java, et des chaînes de caractères.</p></li></ul><p id="r-467134" data-claire-element-id="467134">Un petit exemple de communication en image et en code source :</p><figure id="r-467136" data-claire-element-id="467137"><img id="r-467135" data-claire-element-id="467135" src="medias/uploads.siteduzero.com_files_192001_193000_192110.png" alt="Image utilisateur"/></figure><p id="r-467138" data-claire-element-id="467138"><em><strong>Serveur.java</strong></em></p><pre id="r-467139" data-claire-element-id="467139"><code data-claire-semantic="java">import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.net.InetAddress;
import java.net.ServerSocket;
import java.net.Socket;
import java.net.UnknownHostException;
import java.io.PrintWriter;

public class Serveur {
	
	public static void main(String[] zero) {
		
		ServerSocket socketserver  ;
		Socket socketduserveur ;
		BufferedReader in;
		PrintWriter out;
		
		try {
		
			socketserver = new ServerSocket(2009);
			System.out.println(&quot;Le serveur est à l'écoute du port &quot;+socketserver.getLocalPort());
			socketduserveur = socketserver.accept(); 
		        System.out.println(&quot;Un zéro s'est connecté&quot;);
			out = new PrintWriter(socketduserveur.getOutputStream());
		        out.println(&quot;Vous êtes connecté zéro !&quot;);
		        out.flush();
		                
		        socketduserveur.close();
		        socketserver.close();
		        
		}catch (IOException e) {
			
			e.printStackTrace();
		}
	}

}</code></pre><p id="r-467140" data-claire-element-id="467140"><em><strong>Client.java</strong></em></p><pre id="r-467141" data-claire-element-id="467141"><code data-claire-semantic="java">import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.net.InetAddress;
import java.net.Socket;
import java.net.UnknownHostException;


public class Client {
	
	public static void main(String[] zero) {
		
		
		Socket socket;
		BufferedReader in;
		PrintWriter out;

		try {
		
			socket = new Socket(InetAddress.getLocalHost(),2009);	
		        System.out.println(&quot;Demande de connexion&quot;);

		        in = new BufferedReader (new InputStreamReader (socket.getInputStream()));
		        String message_distant = in.readLine();
		        System.out.println(message_distant);
		        
		        socket.close();
		       
		}catch (UnknownHostException e) {
			
			e.printStackTrace();
		}catch (IOException e) {
			
			e.printStackTrace();
		}
	}

}</code></pre><p id="r-467142" data-claire-element-id="467142"><em>Résultat chez le serveur :</em></p><pre id="r-467143" data-claire-element-id="467143"><code data-claire-semantic="console">Le serveur est à l'écoute du port 2009
Un zéro s'est connecté</code></pre><p id="r-467144" data-claire-element-id="467144"><em>Résultat chez le client :</em></p><pre id="r-467145" data-claire-element-id="467145"><code data-claire-semantic="console">Demande de connexion
Vous êtes connecté zéro !</code></pre><div id="r-467147" data-claire-element-id="467147" data-claire-semantic="question"><p id="r-467146" data-claire-element-id="467146">Ho là ! Un instant ! C'est quoi, ces <em>encapsulations</em> et ce <em>flush</em> ?</p></div><p id="r-467148" data-claire-element-id="467148">Rassurez-vous, on va tout expliquer en détail ( ^^ ), surtout ne vous affolez pas.</p><h3 id="r-cote-serveur" data-claire-element-id="467150">Côté Serveur</h3><p id="r-467149" data-claire-element-id="467149">Après établissement de la connexion, le serveur obtient son socket qu'il utilise pour gérer le flux sortant à l'aide de <em>socketduserveur.getOutputStream()</em> ; ensuite, à l'aide de la méthode <em>println</em> on envoie un message au client, on utilise <em>flush</em> pour vider le <em>buffer</em> tout simplement. Et pour finir on ferme la connexion.</p><h3 id="r-cote-client" data-claire-element-id="467161">Côté Client</h3><p id="r-467151" data-claire-element-id="467151">Après avoir obtenu notre socket, on utilise <em>socket.getInputStream()</em> pour récupérer le flux sortant. La méthode <em>readLine()</em> nous permet de lire une chaîne de caractères. Il existe plusieurs autres méthodes telles :</p><ul id="r-467158" data-claire-element-id="467158"><li id="r-467153" data-claire-element-id="467153"><p id="r-467152" data-claire-element-id="467152"><em>readInt()</em> permettant de lire un entier ;</p></li><li id="r-467155" data-claire-element-id="467155"><p id="r-467154" data-claire-element-id="467154"><em>readDouble()</em> permettant de lire un nombre de type <em>double</em> ;</p></li><li id="r-467157" data-claire-element-id="467157"><p id="r-467156" data-claire-element-id="467156">…</p></li></ul><p id="r-467159" data-claire-element-id="467159">Pour finir, on affiche le message reçu et on ferme notre socket.</p><p id="r-467160" data-claire-element-id="467160">Ça a l'air très simple à première vue pour deux hôtes, mais si l'on veut que plus que deux puissent communiquer entre eux à la fois, comment faire ? D'où la nécessité d'utiliser les <em>Threads</em>.</p><h3 id="r-utilisation-des-threads" data-claire-element-id="467175">Utilisation des threads</h3><p id="r-467162" data-claire-element-id="467162">Je pars du principe que vous connaissez ce que sont les threads et comment les utiliser et pourquoi doit-on les utiliser dans nos programme, on va donc attaquer directement la pratique.</p><p id="r-467163" data-claire-element-id="467163">Le principe d'utilisation des Threads est simple (sera simple si vous suivez attentivement :D). Après avoir créer un objet <em>ServerSocket </em>par le serveur, on le place (l'objet) comme paramètre à un constructeur de la classe qui implémente la classe <em>Runnable </em>ou étend la classe <em>Thread</em>, dès qu'un client souhaite se connecter avec le serveur, un Thread s'occupe de la connexion, il ne sera plus la peine de faire appel au serveur lorsqu'un client souhaite se connecter, tout le boulot sera confié à un Thread.<br/> Vous commencez à comprendre l'utilité des Threads ;) avec le temps vous ne pourrez plus vous en passer.</p><p id="r-467164" data-claire-element-id="467164">Voyons un petit exemple de connexion Multi-Threads en image et avec un code source toujours :</p><figure id="r-467166" data-claire-element-id="467167"><img id="r-467165" data-claire-element-id="467165" src="medias/uploads.siteduzero.com_files_192001_193000_192111.jpg" alt="Image utilisateur"/></figure><p id="r-467168" data-claire-element-id="467168"><em><strong>Serveur.java</strong></em></p><pre id="r-467169" data-claire-element-id="467169"><code data-claire-semantic="java">import java.io.IOException;
import java.net.*;

public class Serveur {

	public static void main(String[] zero){
		
		ServerSocket socket;
		try {
		socket = new ServerSocket(2009);
		Thread t = new Thread(new Accepter_clients(socket));
		t.start();
		System.out.println(&quot;Mes employeurs sont prêts !&quot;);
		
		} catch (IOException e) {
			
			e.printStackTrace();
		}
	}
}

class Accepter_clients implements Runnable {

	   private ServerSocket socketserver;
	   private Socket socket;
	   private int nbrclient = 1;
		public Accepter_clients(ServerSocket s){
			socketserver = s;
		}
		
		public void run() {

	        try {
	        	while(true){
			  socket = socketserver.accept(); // Un client se connecte on l'accepte
	                  System.out.println(&quot;Le client numéro &quot;+nbrclient+ &quot; est connecté !&quot;);
	                  nbrclient++;
	                  socket.close();
	        	}
	        
	        } catch (IOException e) {
				e.printStackTrace();
			}
		}

	}</code></pre><p id="r-467170" data-claire-element-id="467170"><em><strong>Client.java</strong></em></p><pre id="r-467171" data-claire-element-id="467171"><code data-claire-semantic="java">import java.io.IOException;
import java.net.*;

public class Client {

	public static void main(String[] zero){
		
		Socket socket;
		try {
		socket = new Socket(&quot;localhost&quot;,2009);
		socket.close();
		} catch (IOException e) {
			
			e.printStackTrace();
		}
	}
}</code></pre><p id="r-467172" data-claire-element-id="467172">Résulats :</p><pre id="r-467173" data-claire-element-id="467173"><code data-claire-semantic="console">Mes employeurs sont prêts !
Le client numero 1 est connecté !
Le client numero 2 est connecté !
Le client numero 3 est connecté !</code></pre><p id="r-467174" data-claire-element-id="467174">Si vous m'avez bien suivis vous ne devriez pas avoir du mal à comprendre ce code. Dès que quelqu'un tape à la porte, on demande à un employer de lui ouvrir la porte, celui-là va le saluer et lui dire bye bye avec socket.close(); s'il ne veut pas parler (communiquer) :-° .</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1">Introduction aux sockets</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/recuperer-une-adresse-ip-avec-inetaddress">
Récupérer une adresse IP avec InetAddress
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/qu-est-ce-qu-un-socket">
Qu&#039;est-ce qu&#039;un socket ?
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/echange-de-message">
Échange de message
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/tp-un-mini-chat-entre-le-client-et-le-serveur">
TP : un mini-chat entre le client et le serveur !
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/qu-est-ce-qu-un-socket">
<span class="arrow"></span>
<span class="next">Qu&#039;est-ce qu&#039;un socket ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/tp-un-mini-chat-entre-le-client-et-le-serveur">
<span class="next">TP : un mini-chat entre le client et le serveur !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="TPunmini-chatentreleclientetleserveur"></a><h2>TP : un mini-chat entre le client et le serveur !</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/echange-de-message">
<span class="arrow"></span>
<span class="next">Échange de message</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-467177" data-claire-element-id="467177">À présent que nous savons su manier les sockets en utilisant les <em>threads</em>, réalisons un petit programme client / serveur : après la connexion du client, celui-ci devra s'authentifier en premier, le serveur va vérifier dans un fichier la validité de ses données ; si tout est O.K., un message lui dira qu'il est connecté, ils pourront ensuite envoyer tous leurs messages au serveur. Voilà : très simple.</p><p id="r-467178" data-claire-element-id="467178">On devra avoir quelque chose de ce genre côté serveur, pour plusieurs clients à la fois :</p><pre id="r-467179" data-claire-element-id="467179"><code data-claire-semantic="console">Le serveur est à l'écoute du port 2009
Un zéro veut se connecter 
softdeath vient de se connecter 
softdeath : salut, M. le serveur, j'ai besoin de vos services.
Un zéro veut se connecter 
chabanus vient de se connecte
chabanus : salut, j'ai besoin d'accéder à telles données.</code></pre><p id="r-467180" data-claire-element-id="467180">et du côté du client, tête-à-tête avec le serveur après connexion :</p><pre id="r-467181" data-claire-element-id="467181"><code data-claire-semantic="console">Demande de connexion
Connexion établie avec le serveur, authentification :
Entrez votre login :
chabanus
Entrez votre mot de passe :
chabanus
Je suis connecté 
Votre message :
salut
Le serveur vous dit : salut 
Votre message :
ça va ?
Le serveur vous dit : bien et toi ?</code></pre><p id="r-467182" data-claire-element-id="467182">Allez au boulot !</p><p id="r-467183" data-claire-element-id="467183">…<br/> …<br/> …</p><p id="r-467184" data-claire-element-id="467184">… J'espère que vous avez au moins essayé. :euh: <br/> Cette solution n'est ni unique ni la meilleure, elle est simple et minimale pour vous montrer comment les <em>threads</em> doivent être gérés.<br/> Voyons la correction :</p><p id="r-467185" data-claire-element-id="467185"><em><strong>Côté Serveur</strong></em></p><p id="r-467186" data-claire-element-id="467186"></p><div id="r-467199" data-claire-element-id="467199"><p id="r-467187" data-claire-element-id="467187"><em><strong>Accepter_connexion.java</strong></em></p><pre id="r-467188" data-claire-element-id="467188"><code data-claire-semantic="java">import java.io.*;
import java.net.*;


public class Accepter_connexion implements Runnable{

	private ServerSocket socketserver = null;
	private Socket socket = null;

	public Thread t1;
	public Accepter_connexion(ServerSocket ss){
	 socketserver = ss;
	}
	
	public void run() {
		
		try {
			while(true){
				
			socket = socketserver.accept();
			System.out.println(&quot;Un zéro veut se connecter  &quot;);
			
			t1 = new Thread(new Authentification(socket));
			t1.start();
			
			}
		} catch (IOException e) {
			
			System.err.println(&quot;Erreur serveur&quot;);
		}
		
	}
}</code></pre><p id="r-467189" data-claire-element-id="467189"><em><strong>Authentification .java</strong></em></p><pre id="r-467190" data-claire-element-id="467190"><code data-claire-semantic="java">import java.net.*;
import java.util.NoSuchElementException;
import java.util.Scanner;
import java.io.*;

public class Authentification implements Runnable {

	private Socket socket;
	private PrintWriter out = null;
	private BufferedReader in = null;
	private String login = &quot;zero&quot;, pass =  null;
	public boolean authentifier = false;
	public Thread t2;
	
	public Authentification(Socket s){
		 socket = s;
		}
	public void run() {
	
		try {
			
			in = new BufferedReader(new InputStreamReader(socket.getInputStream()));
			out = new PrintWriter(socket.getOutputStream());
			
		while(!authentifier){
			
			out.println(&quot;Entrez votre login :&quot;);
			out.flush();
			login = in.readLine();
			
			
			out.println(&quot;Entrez votre mot de passe :&quot;);
			out.flush();
			pass = in.readLine();

			if(isValid(login, pass)){
				
				out.println(&quot;connecte&quot;);
				System.out.println(login +&quot; vient de se connecter &quot;);
				out.flush();
				authentifier = true;	
			}
			else {out.println(&quot;erreur&quot;); out.flush();}
		 }
			t2 = new Thread(new Chat_ClientServeur(socket,login));
			t2.start();
			
		} catch (IOException e) {
			
			System.err.println(login+&quot; ne répond pas !&quot;);
		}
	}
	
	private static boolean isValid(String login, String pass) {
		
		
		boolean connexion = false;
		try {
			Scanner sc = new Scanner(new File(&quot;zero.txt&quot;));
			
			
			while(sc.hasNext()){
				if(sc.nextLine().equals(login+&quot; &quot;+pass)){
              	  connexion=true;
				  break;
				}
             }
			
		} catch (FileNotFoundException e) {	
			System.err.println(&quot;Le fichier n'existe pas !&quot;);
		}
	return connexion;
		
	}

}</code></pre><p id="r-467191" data-claire-element-id="467191"><em><strong>Chat_ClientServeur.java</strong></em></p><pre id="r-467192" data-claire-element-id="467192"><code data-claire-semantic="java">import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.net.Socket;


public class Chat_ClientServeur implements Runnable {

	private Socket socket = null;
	private BufferedReader in = null;
	private PrintWriter out = null;
	private String login = &quot;zero&quot;;
	private Thread t3, t4;
	
	
	public Chat_ClientServeur(Socket s, String log){
		
		socket = s;
		login = log;
	}
	public void run() {
		
		try {
		in = new BufferedReader(new InputStreamReader(socket.getInputStream()));
		out = new PrintWriter(socket.getOutputStream());
		
		Thread t3 = new Thread(new Reception(in,login));
		t3.start();
		Thread t4 = new Thread(new Emission(out));
		t4.start();
		
		} catch (IOException e) {
			System.err.println(login +&quot;s'est déconnecté &quot;);
		}
}
}</code></pre><p id="r-467193" data-claire-element-id="467193"><em><strong>Emission .java</strong></em></p><pre id="r-467194" data-claire-element-id="467194"><code data-claire-semantic="java">import java.io.IOException;
import java.io.PrintWriter;
import java.util.Scanner;


public class Emission implements Runnable {

	private PrintWriter out;
	private String message = null;
	private Scanner sc = null;
	
	public Emission(PrintWriter out) {
		this.out = out;
	}

	
	public void run() {
		
		  sc = new Scanner(System.in);
		  
		  while(true){
			    System.out.println(&quot;Votre message :&quot;);
				message = sc.nextLine();
				out.println(message);
			    out.flush();
			  }
	}
}</code></pre><p id="r-467195" data-claire-element-id="467195"><strong><em>Reception.java</em></strong></p><pre id="r-467196" data-claire-element-id="467196"><code data-claire-semantic="java">import java.io.BufferedReader;
import java.io.IOException;


public class Reception implements Runnable {

	private BufferedReader in;
	private String message = null, login = null;
	
	public Reception(BufferedReader in, String login){
		
		this.in = in;
		this.login = login;
	}
	
	public void run() {
		
		while(true){
	        try {
	        	
			message = in.readLine();
			System.out.println(login+&quot; : &quot;+message);
			
		    } catch (IOException e) {
				
				e.printStackTrace();
			}
		}
	}

}</code></pre><p id="r-467197" data-claire-element-id="467197"><em><strong>Serveur.java</strong></em></p><pre id="r-467198" data-claire-element-id="467198"><code data-claire-semantic="java">import java.io.*;
import java.net.*;

public class Serveur {
 public static ServerSocket ss = null;
 public static Thread t;

 
	public static void main(String[] args) {
		
		try {
			ss = new ServerSocket(2009);
			System.out.println(&quot;Le serveur est à l'écoute du port &quot;+ss.getLocalPort());
			
			t = new Thread(new Accepter_connexion(ss));
			t.start();
			
		} catch (IOException e) {
			System.err.println(&quot;Le port &quot;+ss.getLocalPort()+&quot; est déjà utilisé !&quot;);
		}
	
	}

	
	}</code></pre></div><p id="r-467200" data-claire-element-id="467200"><strong><em>Côté Client</em></strong></p><p id="r-467201" data-claire-element-id="467201"></p><div id="r-467212" data-claire-element-id="467212"><p id="r-467202" data-claire-element-id="467202"><em><strong>Chat_ClientServeur.java</strong></em></p><pre id="r-467203" data-claire-element-id="467203"><code data-claire-semantic="java">import java.io.*;
import java.net.*;
import java.util.Scanner;


public class Chat_ClientServeur implements Runnable {

	private Socket socket;
	private PrintWriter out = null;
	private BufferedReader in = null;
	private Scanner sc;
	private Thread t3, t4;
	
	public Chat_ClientServeur(Socket s){
		socket = s;
	}
	
	public void run() {
		try {
			out = new PrintWriter(socket.getOutputStream());
			in = new BufferedReader(new InputStreamReader(socket.getInputStream()));
			
			sc = new Scanner(System.in);
			
			Thread t4 = new Thread(new Emission(out));
			t4.start();
			Thread t3 = new Thread(new Reception(in));
			t3.start();
		
		   
		    
		} catch (IOException e) {
			System.err.println(&quot;Le serveur distant s'est déconnecté !&quot;);
		}
	}

}</code></pre><p id="r-467204" data-claire-element-id="467204"><em><strong>Client.java</strong></em></p><pre id="r-467205" data-claire-element-id="467205"><code data-claire-semantic="java">import java.io.*;
import java.net.*;

public class Client {

	public static Socket socket = null;
	public static Thread t1;
	
	public static void main(String[] args) {
	
		
	try {
		
		System.out.println(&quot;Demande de connexion&quot;);
		socket = new Socket(&quot;127.0.0.1&quot;,2009);
		System.out.println(&quot;Connexion établie avec le serveur, authentification :&quot;); // Si le message s'affiche c'est que je suis connecté
		
		t1 = new Thread(new Connexion(socket));
		t1.start();
		
		
		
	} catch (UnknownHostException e) {
	  System.err.println(&quot;Impossible de se connecter à l'adresse &quot;+socket.getLocalAddress());
	} catch (IOException e) {
	  System.err.println(&quot;Aucun serveur à l'écoute du port &quot;+socket.getLocalPort());
	}
	
	

	}

}</code></pre><p id="r-467206" data-claire-element-id="467206"><em><strong>Connexion.java</strong></em></p><pre id="r-467207" data-claire-element-id="467207"><code data-claire-semantic="java">import java.net.*;
import java.util.Scanner;
import java.io.*;

public class Connexion implements Runnable {

	private Socket socket = null;
	public static Thread t2;
	public static String login = null, pass = null, message1 = null, message2 = null, message3 = null;
	private PrintWriter out = null;
	private BufferedReader in = null;
	private Scanner sc = null;
	private boolean connect = false;
	
	public Connexion(Socket s){
		
		socket = s;
	}
	
	public void run() {
		
		try {
			
		out = new PrintWriter(socket.getOutputStream());
		in = new BufferedReader(new InputStreamReader(socket.getInputStream()));	
		sc = new Scanner(System.in);
	
		
		while(!connect ){
		
		System.out.println(in.readLine());
		login = sc.nextLine();
		out.println(login);
		out.flush();
		
		System.out.println(in.readLine());
		pass = sc.nextLine();
		out.println(pass);
		out.flush();
		
		if(in.readLine().equals(&quot;connecte&quot;)){
			
		System.out.println(&quot;Je suis connecté &quot;); 
		connect = true;
		  }
		
		else {
			System.err.println(&quot;Vos informations sont incorrectes &quot;); 
		  }
		
	}
			
			t2 = new Thread(new Chat_ClientServeur(socket));
			t2.start();
		
		} catch (IOException e) {
			
			System.err.println(&quot;Le serveur ne répond plus &quot;);
		}
	}

}</code></pre><p id="r-467208" data-claire-element-id="467208"><em><strong>Emission.java</strong></em></p><pre id="r-467209" data-claire-element-id="467209"><code data-claire-semantic="java">import java.io.IOException;
import java.io.PrintWriter;
import java.util.Scanner;


public class Emission implements Runnable {

	private PrintWriter out;
	private String login = null, message = null;
	private Scanner sc = null;
	
	public Emission(PrintWriter out) {
		this.out = out;
		
	}

	
	public void run() {
		
		  sc = new Scanner(System.in);
		  
		  while(true){
			    System.out.println(&quot;Votre message :&quot;);
				message = sc.nextLine();
				out.println(message);
			    out.flush();
			  }
	}
}</code></pre><p id="r-467210" data-claire-element-id="467210"><em><strong>Reception.java</strong></em></p><pre id="r-467211" data-claire-element-id="467211"><code data-claire-semantic="java">import java.io.BufferedReader;
import java.io.IOException;


public class Reception implements Runnable {

	private BufferedReader in;
	private String message = null;
	
	public Reception(BufferedReader in){
		
		this.in = in;
	}
	
	public void run() {
		
		while(true){
	        try {
	        	
			message = in.readLine();
			System.out.println(&quot;Le serveur vous dit :&quot; +message);
			
		    } catch (IOException e) {
				
				e.printStackTrace();
			}
		}
	}

}</code></pre></div><p id="r-467213" data-claire-element-id="467213">Lancez serveur.java et ensuite client.java, n'oubliez pas de créer un fichier pour le serveur pour qu'il puisse y vérifier l'identité de ses clients, je l'ai nommé zero.txt : vous pouvez le nommer comme vous le souhaitez, c'est à votre guise.</p><p id="r-467214" data-claire-element-id="467214">Optimisation :<br/> Pour ne pas dire qu'il en existe à l'infini, plusieurs autres possibilités s'offrent à vous, vous pouvez :</p><ul id="r-467223" data-claire-element-id="467223"><li id="r-467216" data-claire-element-id="467216"><p id="r-467215" data-claire-element-id="467215">rendre l'application client / client. Le serveur authentifie les deux clients et ces deux-là pourront discuter ensemble sans que d'autres puissent y entrer : grosso modo réaliser un « salon », comme on l'appelle ;</p></li><li id="r-467218" data-claire-element-id="467218"><p id="r-467217" data-claire-element-id="467217">utiliser les bases de données pour la sauvegarde des messages et pour authentifier les clients ;</p></li><li id="r-467220" data-claire-element-id="467220"><p id="r-467219" data-claire-element-id="467219">réaliser une interface graphique en <em>swing</em> ou en <em>awt</em> ;</p></li><li id="r-467222" data-claire-element-id="467222"><p id="r-467221" data-claire-element-id="467221">…</p></li></ul><p id="r-467224" data-claire-element-id="467224">Croyez-moi : lorsque vous maîtriserez les sockets en utilisant les <em>threads</em>, rien ne sera plus compliqué pour vous. ;) Bonne continuation à tous ; surtout n'hésitez pas à l'améliorer et envoyez-moi un MP pour m'exposer votre travail.</p><p id="r-467225" data-claire-element-id="467225">Le mode UDP est plus rapide que le mode TCP mais c'est une communication non fiable, car on ne se préoccupe pas du résultat de la réception du récepteur, il est donc moins utilisé. Maintenant que vous savez manier les sockets, le mode UDP ne devrait pas vous poser de problème ;) .</p><p id="r-467226" data-claire-element-id="467226">Je vous remercie d'avoir lu le tutoriel, il est à présent terminé. J'espère que vous avez bien suivi :)</p><p id="r-467227" data-claire-element-id="467227">À la prochaine pour un autre tutoriel client/serveur ! La technologie RMI (Remote Method Invocation) ! Qui vous permettra de mieux comprendre la nature et la fonction des EJB (Entreprise JavaBeans) qui représente l'étendard de la plate-forme J2EE !</p><p id="r-467228" data-claire-element-id="467228">Je remercie :</p><ul id="r-467237" data-claire-element-id="467237"><li id="r-467230" data-claire-element-id="467230"><p id="r-467229" data-claire-element-id="467229">Le membre <a href="http://www.siteduzero.com/membres-294-875.html">cysboy </a>pour m'avoir encouragé.</p></li><li id="r-467232" data-claire-element-id="467232"><p id="r-467231" data-claire-element-id="467231">Les validateurs <a href="http://www.siteduzero.com/membres-294-51570.html">Xavinou</a>, <a href="http://www.siteduzero.com/membres-294-1084.html">Coyote </a> et <a href="http://www.siteduzero.com/membres-294-1398.html">Thunderseb</a>.</p></li><li id="r-467234" data-claire-element-id="467234"><p id="r-467233" data-claire-element-id="467233">Le zCorrecteur <a href="http://www.siteduzero.com/membres-294-7888.html">Poulpette</a> pour avoir pris le temps de corriger le tutoriel.</p></li><li id="r-467236" data-claire-element-id="467236"><p id="r-467235" data-claire-element-id="467235">Enfin, tout le staff du <a href="http://www.siteduzero.com/">site du zéro</a> qui nous permet de rédiger des tutoriels pour débutants.</p></li></ul>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1">Introduction aux sockets</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/recuperer-une-adresse-ip-avec-inetaddress">
Récupérer une adresse IP avec InetAddress
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/qu-est-ce-qu-un-socket">
Qu&#039;est-ce qu&#039;un socket ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/echange-de-message">
Échange de message
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/tp-un-mini-chat-entre-le-client-et-le-serveur">
TP : un mini-chat entre le client et le serveur !
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-sockets-1/echange-de-message">
<span class="arrow"></span>
<span class="next">Échange de message</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/introduction-aux-sockets-1.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 01:19:15 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/introduction-aux-sockets-1.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:21:07 GMT -->
</html>