<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/adopter-un-style-de-programmation-clair-avec-le-modele-mvc.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 03:05:24 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/adopter-un-style-de-programmation-clair-avec-le-modele-mvc.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:41:09 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Adopter un style de programmation clair avec le modèle MVC</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Adopter un style de programmation clair avec le modèle MVC</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#AdopterunstyledeprogrammationclairaveclemodleMVC">Adopter un style de programmation clair avec le modèle MVC</a><br/><a href="#Prsentationthorique">Présentation théorique</a><br/><a href="#OrganiserlesfichierssurleFTP">Organiser les fichiers sur le FTP</a><br/><a href="#Applicationpratiqueunsystmedenews">Application pratique : un système de news</a><br/><a href="#D039autresapproches">D&#039;autres approches</a><br/></div>
<a name="AdopterunstyledeprogrammationclairaveclemodleMVC"></a><h2>Adopter un style de programmation clair avec le modèle MVC</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/presentation-theorique">
<span class="next">Présentation théorique</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-383990" data-claire-element-id="383990">Bonjour à tous !</p><p id="r-383991" data-claire-element-id="383991">Je vais aujourd'hui m'attaquer à un problème que tout programmeur a rencontré un jour ou l'autre dans sa carrière : comment organiser le code de son site de manière à être le plus clair possible ? Il existe de nombreuses solutions, chacune ayant ses avantages et ses inconvénients.</p><p id="r-383992" data-claire-element-id="383992">Je vais ainsi vous présenter une façon de faire que j'aime beaucoup. Ce n'est sans doute pas la meilleure, ni la pire, juste une parmi tant d'autres. Essayez, et forgez-vous votre opinion après cela.</p><p id="r-383993" data-claire-element-id="383993">Le modèle dont je vais vous parler se nomme MVC pour les intimes (nous allons voir dans le premier chapitre ce que cela signifie).</p><p id="r-383994" data-claire-element-id="383994"><strong>Difficulté : </strong>après avoir lu tous les cours de M@teo21 et quelques tutos rédigés par des Zér0s, vous pourrez vous en sortir. Ce n'est pas très dur, mais il vaut mieux avoir une bonne connaissance en PHP avant de se lancer dans ce tuto, je pense. Je vous donnerai des liens vers d'autres tutos par la suite si vous bloquez sur tel ou tel point.</p><p id="r-383995" data-claire-element-id="383995">Ceci étant dit, je vous souhaite une bonne lecture. :)</p>
</div><a name="Prsentationthorique"></a><h2>Présentation théorique</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/organiser-les-fichiers-sur-le-ftp">
<span class="next">Organiser les fichiers sur le FTP</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<aside id="r-383997" data-claire-element-id="383997" data-claire-semantic="warning"><p id="r-383996" data-claire-element-id="383996">Note aux puristes : le modèle présenté ne sera peut-être pas très rigoureux à vos yeux. Ce n'est qu'une approche n'ayant pas pour but de dégoûter le lecteur à sa première lecture. J'ai repris le terme de <em><strong>modèle MVC</strong></em> car il s'en approche beaucoup, et parce que le terme est très connu. ;)</p></aside><p id="r-383998" data-claire-element-id="383998">Tout d'abord, vous devez vous demander ce que signifie cet acronyme énigmatique MVC. MVC sont les initiales de</p><p id="r-383999" data-claire-element-id="383999"><strong>M</strong>odèle <strong>V</strong>ue <strong>C</strong>ontrôleur.</p><p id="r-384000" data-claire-element-id="384000">Comme vous pouvez vous en douter, l'organisation se fera en trois parties. Au lieu d'un fichier utilisé par une organisation de la programmation classique (tout dans un fichier), le modèle MVC divisera le tout en trois fichiers.</p><div id="r-384002" data-claire-element-id="384002" data-claire-semantic="question"><p id="r-384001" data-claire-element-id="384001">Mais cela va beaucoup alourdir mon FTP ! Et puis, ce n'est pas très pratique d'avoir trois fichiers, alors qu'on peut faire n'en faire qu'un... :o</p></div><p id="r-384003" data-claire-element-id="384003">À cette question, je répondrai qu'il faut savoir ce que l'on veut. :p Le gain réside dans le fait que votre code sera plus lisible qu'avec un seul fichier. C'est le but de cette fragmentation. L'inconvénient d'avoir plusieurs fichiers n'en est pas un, je pense. Ce n'est pas dérangeant.</p><h3 id="r-le-controleur-19" data-claire-element-id="384008">Le contrôleur</h3><p id="r-384004" data-claire-element-id="384004">Nous allons commencer par le contrôleur, et vous allez comprendre pourquoi. Quand vous demanderez un fichier dans votre barre d'adresse, ce sera en fait le contrôleur que vous appellerez. C'est le fichier qui contient toute la logique du code. Vous commencerez généralement par y inclure votre modèle (nous verrons plus loin de quoi il s'agit). Vous procéderez à quelques vérifications d'ordre général (comme les autorisations), puis vous pourrez appeler des fonctions avant d'inclure la vue.</p><p id="r-384005" data-claire-element-id="384005">Comme vous le voyez, c'est la partie du système qui fait le lien avec les deux autres parties.</p><aside id="r-384007" data-claire-element-id="384007" data-claire-semantic="information"><p id="r-384006" data-claire-element-id="384006">Petite précision : nous verrons plus tard qu'un fichier index.php se chargera de faire le lien entre les informations demandées par l'URL et les fichiers. Ce fichier index.php sera lui-même un contrôleur (appelé <em>FrontController</em>), par opposition aux autres contrôleurs (appelés les <em>BackController</em>). Son rôle est de procéder aux initialisations nécessaires, et d'appeler le <em>BackController</em>.</p></aside><h3 id="r-le-modele-17" data-claire-element-id="384014">Le modèle</h3><p id="r-384009" data-claire-element-id="384009">Ce fichier ne contiendra que des fonctions. Le modèle a pour but de gérer l'organisation des données. Chacune de ces fonctions effectuera une action bien précise. <strong>Vous ne pourrez effectuer des requêtes SQL que dans ces fonctions !</strong> Le contrôleur et la vue ne devront contenir aucun appel à MySQL. Réfléchissez-donc bien aux fonctions que vous y mettrez.</p><aside id="r-384011" data-claire-element-id="384011" data-claire-semantic="information"><p id="r-384010" data-claire-element-id="384010">Quand je dis <em>requêtes SQL</em>, cela inclut aussi bien MySQL, que PostegreSQL, ou tout autre SGBDR. De même, les bases de données ne sont pas le seul moyen de gérer des données. Le modèle pourra donc tout aussi bien contenir des fonctions gérant des fichiers XML, par exemple. ;)</p></aside><p id="r-384012" data-claire-element-id="384012">Vous aurez au final sans doute des fonctions du type : ajouter_news, supprimer_news, ajouter_commentaire_news pour un script de news.</p><p id="r-384013" data-claire-element-id="384013">Vous pouvez bien évidemment aussi stocker des fonctions classiques dans ce fichier, mais en général, ce type de fonctions est souvent réutilisé dans d'autres fichiers, et vous préférerez les mettre dans un fichier à part, inclus lors de l'initialisation de votre script.</p><h3 id="r-la-vue-13" data-claire-element-id="384018">La vue</h3><p id="r-384015" data-claire-element-id="384015">La vue contient le code xHTML. C'est la seule partie qui doit en contenir. Vous pouvez à la limite faire quelques echo depuis le contrôleur, mais pour du déboguage ou l'affichage d'erreurs. Sinon, ce sera la vue qui s'en chargera. Elle s'occupe donc de l'interface homme / machine.</p><p id="r-384016" data-claire-element-id="384016">La vue est un moteur de templates, dans le sens où logique du code et affichage sont séparés. Le code PHP doit être très limité dans ce fichier. Personnellement, je n'emploie que des if, foreach et des echo dans la majorité des cas. Après, vous pouvez y joindre un moteur de templates dans le sens courant du terme (voir plus loin), mais cela donne un peu plus de boulot au contrôleur. Ici, cela revient à employer PHP comme moteur de templates (ce qui devrait faire plaisir à certains :-° ).</p><p id="r-384017" data-claire-element-id="384017">Enfin, notez que restreindre la vue à du code xHTML est réducteur. La vue s'occupe de l'interface pour l'utilisateur. Il peut donc en théorie s'agir d'un peu tout et n'importe quoi, comme du XML par exemple, voire du texte brut ! Mais l'affichage de xHTML est, vous vous en doutez, le plus employé dans le cadre de la conception d'un site web, même si vous serez sans doute amenés à afficher des flux RSS (en XML donc). Certains sites proposent aussi une API retournant des résultats dans d'autres formats que le xHTML, comme du Yaml, XML, Json, etc.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc">Adopter un style de programmation clair avec le modèle MVC</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/presentation-theorique">
Présentation théorique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/organiser-les-fichiers-sur-le-ftp">
Organiser les fichiers sur le FTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/application-pratique-un-systeme-de-news">
Application pratique : un système de news
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/d-autres-approches">
D&#039;autres approches
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/organiser-les-fichiers-sur-le-ftp">
<span class="next">Organiser les fichiers sur le FTP</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="OrganiserlesfichierssurleFTP"></a><h2>Organiser les fichiers sur le FTP</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/presentation-theorique">
<span class="arrow"></span>
<span class="next">Présentation théorique</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/application-pratique-un-systeme-de-news">
<span class="next">Application pratique : un système de news</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-384020" data-claire-element-id="384020">Maintenant que les bases sont posées, commençons à réfléchir à l'organisation des fichiers sur le FTP. Personnellement, j'entrevois plusieurs solutions. Dans tous les cas, le principe sera de séparer les trois éléments : <strong>modèle</strong>, <strong>vue</strong> et <strong>contrôleur</strong> (parce que ça ne fait pas de mal de les réécrire une fois de plus :D ).</p><h3 id="r-organisation-simple" data-claire-element-id="384027">Organisation simple</h3><p id="r-384021" data-claire-element-id="384021">La solution la plus simple est de créer trois dossiers : modeles, vues et controleurs. Dans chacun de ces dossiers, vous mettrez l'élément correspondant.</p><p id="r-384022" data-claire-element-id="384022">À partir de là, vous avez deux solutions pour gérer les appels de fichiers. Vous pouvez donc soit appeler directement le contrôleur depuis l'URL, avec une adresse de la sorte : <br/><a href="http://monsiteamoi.net/controleurs/forum.php">http://monsiteamoi.net/controleurs/forum.php</a>, <br/> soit l'appeler en passant par un index.php faisant le lien entre les contrôleurs avec une adresse de la forme : <br/><a href="http://monsiteamoi.net/index.php?page=forum">http://monsiteamoi.net/index.php?page=forum</a>. <br/> Dans le premier cas, il faudra que votre contrôleur et / ou votre vue inclue(nt) les éléments communs à votre site (connexion à la BDD, en-tête, pied de page, etc.). Dans le deuxième cas, c'est l'index.php qui effectue toutes les initialisations, qui vérifie si le contrôleur existe bien (pour empêcher un piratage) et l'inclut si tel est le cas. Pour ma part je vous conseille la seconde solution qui permet d'éviter des duplications de code inutiles. Vous pouvez commencer à coder directement dans votre fichier, puisque toutes vos initialisations sont faites dans l'index.php ! De plus, combiné avec de l'<em>url rewriting</em>, les adresses pourront être plus jolies (pour les visiteurs mais aussi les moteurs de recherche).</p><p id="r-384023" data-claire-element-id="384023">Voici un exemple d'un fichier d'index type :</p><pre id="r-384024" data-claire-element-id="384024"><code data-claire-semantic="html+php">&lt;?php
//On démarre la session
session_start();
 
//On se connecte à MySQL
mysql_connect('localhost', 'root', '');
mysql_select_db('tests');
 
//On inclut le logo du site et le menu
include 'vues/logo.php';
include 'vues/menu.php';
 
//On inclut le contrôleur s'il existe et s'il est spécifié
if (!empty($_GET['page']) &amp;&amp; is_file('controleurs/'.$_GET['page'].'.php'))
{
        include 'controleurs/'.$_GET['page'].'.php';
}
else
{
        include 'controleurs/accueil.php';
}
 
//On inclut le pied de page
include 'vues/pied.php';
 
//On ferme la connexion à MySQL
mysql_close();</code></pre><aside id="r-384026" data-claire-element-id="384026" data-claire-semantic="information"><p id="r-384025" data-claire-element-id="384025">Ce fichier est très simple et pas encore très sécurisé, mais il peut très bien vous servir de base de travail si vous décidez de procéder avec cette méthode.</p></aside><h3 id="r-une-autre-organisation-possible" data-claire-element-id="384030">Une autre organisation possible</h3><p id="r-384028" data-claire-element-id="384028">Cette variante est similaire à l'organisation utilisée avec un moteur de templates. D'ailleurs, si vous comptez en adjoindre un (voir la dernière partie), vous devriez songer à l'utiliser.</p><p id="r-384029" data-claire-element-id="384029">La principale différence est que vous allez mettre tous les contrôleurs à la racine du site. Vous noterez que pour les appeler, vous aurez encore le choix entre les deux méthodes (voir ci-dessus pour plus de détails). Il vous faudra ensuite deux autres dossiers pour y mettre les vues et les modèles. Vous les nommerez comme vous le désirez, mais sachez que la majorité des moteurs de templates exigent qu'on les nomme 'templates' (original :p ), quoique ce paramètre peut très souvent être modifié. Vous vous retrouvez alors avec une structure quelque peu différente, avec plus de fichiers à la racine, mais qui pourra peut-être paraître plus logique à certains.</p><h3 id="r-redirections" data-claire-element-id="384035">Redirections</h3><p id="r-384031" data-claire-element-id="384031">Certains m'ont fait la remarque du problème posé par les redirections, j'en parle donc ici. Comme vous le savez, une redirection se fait habituellement en PHP avec un :</p><pre id="r-384032" data-claire-element-id="384032"><code data-claire-semantic="html+php">&lt;?php header('Location: cible.php'); ?&gt;</code></pre><p id="r-384033" data-claire-element-id="384033">Or un tel appel de fonction <strong>ne peut pas être mis si quelque chose a déjà été envoyé au navigateur</strong>. Pour cela, et dans l'optique de garder l'organisation actuelle, une seule solution : la tamporisation de sortie (<a href="http://www.siteduzero.com/tutoriel-3-38102-la-tamporisation-de-sortie-en-php.html">tutoriel d'Alex ici</a>). Globalement, vous mettez un ob_start en début de script, un ob_end_flush en fin, et vous pouvez, entre les appels à ces deux fonctions, insérer divers éléments habituellement interdits en milieu de fichiers PHP comme des setcookie et des header.</p><p id="r-384034" data-claire-element-id="384034">Cependant, je n'emploierai pas cette technique par la suite, pour simplifier les choses. Sachez simplement qu'elle existe et qu'elle peut être très utile. ;)</p><h3 id="r-en-conclusion-1" data-claire-element-id="384038">En conclusion</h3><p id="r-384036" data-claire-element-id="384036">Vous choisissez l'organisation que vous voulez, voire une autre de votre cru. Le principal est que vous soyez à l'aise avec. Un petit conseil pendant que j'y suis : protégez les répertoires des vues et des modèles avec un .htaccess. Si vous employez la méthode à base de index.php?page=, protégez aussi le répertoire des contrôleurs (si celui-ci n'est pas la racine ^^ ). Cela pourra éventuellement éviter quelques piratages.</p><p id="r-384037" data-claire-element-id="384037">Pour plus d'infos sur la création et l'utilisation des .htaccess : <a href="http://www.siteduzero.com/tutoriel-3-14649-proteger-un-dossier-avec-un-htaccess.html">le tutoriel officiel de M@teo21</a> et <a href="http://www.siteduzero.com/tutoriel-3-35126-le-htaccess-et-ses-fonctionnalites.html">un tutoriel de kozo sur les usages de ce fichier bien particulier</a>.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc">Adopter un style de programmation clair avec le modèle MVC</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/presentation-theorique">
Présentation théorique
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/organiser-les-fichiers-sur-le-ftp">
Organiser les fichiers sur le FTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/application-pratique-un-systeme-de-news">
Application pratique : un système de news
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/d-autres-approches">
D&#039;autres approches
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/presentation-theorique">
<span class="arrow"></span>
<span class="next">Présentation théorique</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/application-pratique-un-systeme-de-news">
<span class="next">Application pratique : un système de news</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Applicationpratiqueunsystmedenews"></a><h2>Application pratique : un système de news</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/organiser-les-fichiers-sur-le-ftp">
<span class="arrow"></span>
<span class="next">Organiser les fichiers sur le FTP</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/d-autres-approches">
<span class="next">D&#039;autres approches</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-384040" data-claire-element-id="384040">Cette partie sera un mini-TP. Je vais vous fournir un système de news tout fait, et vous allez me l'adapter en suivant le modèle MVC que je vous ai décrit plus haut.</p><p id="r-384041" data-claire-element-id="384041">À l'assaut du MVC ! :pirate:</p><h3 id="r-le-systeme-de-base" data-claire-element-id="384070">Le système de base</h3><p id="r-384042" data-claire-element-id="384042">Voici donc le code PHP servant à afficher les news. Vous noterez qu'il est très simple : la difficulté n'est pas le but de ce TP. ;)</p><p id="r-384043" data-claire-element-id="384043">Il emploie une table MySQL news caractérisée ainsi :</p><ul id="r-384054" data-claire-element-id="384054"><li id="r-384045" data-claire-element-id="384045"><p id="r-384044" data-claire-element-id="384044">id / int / <em>clé primaire</em> / auto-increment</p></li><li id="r-384047" data-claire-element-id="384047"><p id="r-384046" data-claire-element-id="384046">titre / varchar</p></li><li id="r-384049" data-claire-element-id="384049"><p id="r-384048" data-claire-element-id="384048">auteur / varchar</p></li><li id="r-384051" data-claire-element-id="384051"><p id="r-384050" data-claire-element-id="384050">date / datetime</p></li><li id="r-384053" data-claire-element-id="384053"><p id="r-384052" data-claire-element-id="384052">contenu / text.</p></li></ul><p id="r-384055" data-claire-element-id="384055">Voici le code pour créer la table facilement, avec quelques données d'exemple :</p><pre id="r-384056" data-claire-element-id="384056"><code data-claire-semantic="sql">CREATE TABLE `news` (
`id` SMALLINT NOT NULL AUTO_INCREMENT PRIMARY KEY ,
`titre` VARCHAR( 255 ) NOT NULL ,
`auteur` VARCHAR( 255 ) NOT NULL ,
`date` DATETIME NOT NULL ,
`contenu` TEXT NOT NULL
) ENGINE = MYISAM ;
 
INSERT INTO `news` (
`id` ,
`titre` ,
`auteur` ,
`date` ,
`contenu`
)
VALUES (
NULL , 'Une première news', 'vincent1870', '2007-12-30 18:38:02', 'Bienvenue à tous sur ce beau site !&lt;br /&gt; &lt;br /&gt; Bon surf ! ;)'
), (
NULL , 'Et une deuxième', 'Arthur', '2007-12-11 18:38:44', 'Hello !&lt;br /&gt; What happened ?'
);</code></pre><aside id="r-384058" data-claire-element-id="384058" data-claire-semantic="information"><p id="r-384057" data-claire-element-id="384057">Je considèrerai dans le script d'affichage que les données entrées dans la BDD sont déjà sécurisées (insérées avec htmlspecialchars), converties en xHTML avec nl2br et éventuellement une fonction de parsage. Elles sont de plus dépourvues de slashes gênants.</p></aside><p id="r-384059" data-claire-element-id="384059">Le code de l'index.php :</p><pre id="r-384060" data-claire-element-id="384060"><code data-claire-semantic="html+php">&lt;?php
//On démarre la session
session_start();
 
//On se connecte à MySQL
mysql_connect('localhost', 'root', '');
mysql_select_db('tests');
 
//On inclut le fichier s'il existe et s'il est spécifié
if (!empty($_GET['page']) &amp;&amp; is_file($_GET['page'].'.php'))
{
        include $_GET['page'].'.php';
}
else
{
        include 'accueil.php';
}
 
//On ferme la connexion à MySQL
mysql_close();</code></pre><p id="r-384061" data-claire-element-id="384061">Et le code d'une page news.php, située à la racine du site pour le moment :</p><pre id="r-384062" data-claire-element-id="384062"><code data-claire-semantic="html+php">&lt;h1&gt;Les news du site&lt;/h1&gt;
 
&lt;?php
$req = mysql_query(&quot;SELECT id, auteur, titre, DATE_FORMAT(date, '%d/%m/%Y %H') AS date_formatee, contenu 
FROM news
ORDER BY date DESC&quot;);
while ($data = mysql_fetch_assoc($req))
{
        echo '
        &lt;div class=&quot;news&quot;&gt;
                &lt;h2&gt;'.$data['titre'].'&lt;/h2&gt;
                &lt;p&gt;News postée le '.str_replace(' ', ' à ', $data['date_formatee']).' par '.$data['auteur'].'&lt;/p&gt;
                &lt;p&gt;'.$data['contenu'].'&lt;/p&gt;
        &lt;/div&gt;';
}
?&gt;</code></pre><p id="r-384063" data-claire-element-id="384063">Ce code est très simple, vous devriez le comprendre sans peine. Si ce n'est pas le cas, vous pouvez relire <a href="http://www.siteduzero.com/tutoriel-3-14506-lire-des-donnees.html">la partie sur la récupération de données du tuto de M@teo21</a> et <a href="http://www.siteduzero.com/tutoriel-3-32877-mysql-et-les-donnees-temporelles.html">le tuto de Machin sur les DATETIME de MySQL</a>.</p><p id="r-384064" data-claire-element-id="384064">Bon, maintenant, à vous de me faire un joli modèle MVC. Vous utiliserez le premier système décrit avec :</p><ul id="r-384069" data-claire-element-id="384069"><li id="r-384066" data-claire-element-id="384066"><p id="r-384065" data-claire-element-id="384065">trois dossiers : modeles, vues et controleurs ;</p></li><li id="r-384068" data-claire-element-id="384068"><p id="r-384067" data-claire-element-id="384067">un fichier index.php, comme je l'ai fait ici, en le modifiant bien sûr.</p></li></ul><h3 id="r-correction-131" data-claire-element-id="384084">Correction</h3><p id="r-384071" data-claire-element-id="384071">Puisque vous avez fini, voici venue l'heure de la correction, commentée bien entendu. :)</p><p id="r-384072" data-claire-element-id="384072">Pour l'index.php, je reprends celui que je vous avais donné dans la partie précédente. Il se situera à la racine du site.</p><pre id="r-384073" data-claire-element-id="384073"><code data-claire-semantic="html+php">&lt;?php
//On démarre la session
session_start();
 
//On se connecte à MySQL
mysql_connect('localhost', 'root', '');
mysql_select_db('tests');
 
//On inclut le contrôleur s'il existe et s'il est spécifié
if (!empty($_GET['page']) &amp;&amp; is_file('controleurs/'.$_GET['page'].'.php'))
{
        include 'controleurs/'.$_GET['page'].'.php';
}
else
{
        include 'controleurs/accueil.php';
}
 
//On ferme la connexion à MySQL
mysql_close();</code></pre><p id="r-384074" data-claire-element-id="384074">Il se connecte à la BDD et choisit le bon contrôleur. Dans notre cas, pour visualiser les news, il vous faudra donc faire un <br/><a href="http://monsite.com/index.php?page=news">http://monsite.com/index.php?page=news</a>. Notez que je n'ai pas inclus le code xHTML de base, ce sera donc à vous de le trouver et de le mettre comme des grands. Il ne présente pas d'intérêt dans ce tuto. Vous n'avez qu'à le mettre dans une vue et à inclure cette vue depuis l'index. Enfantin ! :magicien:</p><p id="r-384075" data-claire-element-id="384075">On continue avec le contrôleur news.php, situé donc dans controleurs/news.php :</p><pre id="r-384076" data-claire-element-id="384076"><code data-claire-semantic="html+php">&lt;?php
/* C'est en tout début de fichier que l'on vérifie les autorisations. Les 
news sont visibles par tous, mais si vous voulez en restreindre l'accès, c'est 
ici que cela se passe. */
 
//On inclut le modèle
include(dirname(__FILE__).'/../modeles/news.php');
 
/* On effectue ici diverses actions, comme supprimer des news, par exemple. ;)
Il n'y en aura aucune dans ce tutoriel pour rester simple, mais libre à vous d'en rajouter. */
 
//On récupère les news
$news = recuperer_news();
 
//On inclut la vue
include(dirname(__FILE__).'/../vues/news.php');
?&gt;</code></pre><p id="r-384077" data-claire-element-id="384077">Ce code est vraiment le contrôleur le plus simple que vous pourrez avoir : il inclut le modèle, récupère les news et appelle la vue. Trivial, je pense. La seule chose que vous pourriez ne pas connaître est le dirname(__FILE__). C'est une fonction permettant de retourner le chemin vers un fichier, le fichier actuel (le contrôleur) en l'occurrence, désigné par __FILE__, qui est une constante définie par PHP. Vous noterez que je vous ai mis en commentaire les endroits où vous pourrez effectuer diverses actions et vérifications, pour améliorer ce script.</p><p id="r-384078" data-claire-element-id="384078">Allez, maintenant, au tour du modèle (modeles/news.php) :</p><pre id="r-384079" data-claire-element-id="384079"><code data-claire-semantic="html+php">&lt;?php
function recuperer_news()
{
        $news = array();
 
        $req = mysql_query(&quot;SELECT id, auteur, titre, DATE_FORMAT(date, '%d/%m/%Y %H') AS date_formatee, contenu 
        FROM news
        ORDER BY date DESC&quot;);
        while ($data = mysql_fetch_assoc($req))
        {
                $news[] = $data;
        }
 
        return $news;
}</code></pre><p id="r-384080" data-claire-element-id="384080">Ce code récupère toutes les news dans la base de données, les stocke dans un array et les retourne à l'appelant. Toute l'astuce était dans le tableau. Je pense que ceux qui auront bloqué l'auront fait à ce moment. Il faut juste penser à stocker les données dans un tableau avant de les afficher. Cela rajoute certes une étape, mais c'est le prix de la clarification du code.</p><p id="r-384081" data-claire-element-id="384081">Et la dernière étape, la vue, qui devrait passer toute seule si vous avez compris ce qui précède (dans vues/news.php) :</p><pre id="r-384082" data-claire-element-id="384082"><code data-claire-semantic="html+php">&lt;h1&gt;Les news du site&lt;/h1&gt;
 
&lt;?php
foreach($news as $n)
{
        echo '
        &lt;div class=&quot;news&quot;&gt;
                &lt;h2&gt;'.$n['titre'].'&lt;/h2&gt;
                &lt;p&gt;News postée le '.str_replace(' ', ' à ', $n['date_formatee']).' par '.$n['auteur'].'&lt;/p&gt;
                &lt;p&gt;'.$n['contenu'].'&lt;/p&gt;
        &lt;/div&gt;';
}
?&gt;</code></pre><p id="r-384083" data-claire-element-id="384083">Comme vous le voyez, la vue parcourt le tableau et affiche les infos, exactement comme dans le fichier de support. En réalité, nous n'avons fait que diviser un fichier en trois, mais cela procure une belle clarté, je trouve : pas vous ? :soleil:</p><h3 id="r-resume-de-la-structure-ftp" data-claire-element-id="384108">Résumé de la structure FTP</h3><p id="r-384085" data-claire-element-id="384085">Le FTP se présente normalement à la fin comme cela :</p><ul id="r-384107" data-claire-element-id="384107"><li id="r-384087" data-claire-element-id="384087"><p id="r-384086" data-claire-element-id="384086">/</p></li><li id="r-384089" data-claire-element-id="384089"><p id="r-384088" data-claire-element-id="384088">index.php</p></li><li id="r-384094" data-claire-element-id="384094"><p id="r-384090" data-claire-element-id="384090">controleurs</p><ul id="r-384093" data-claire-element-id="384093"><li id="r-384092" data-claire-element-id="384092"><p id="r-384091" data-claire-element-id="384091">news.php</p></li></ul></li><li id="r-384099" data-claire-element-id="384099"><p id="r-384095" data-claire-element-id="384095">modeles</p><ul id="r-384098" data-claire-element-id="384098"><li id="r-384097" data-claire-element-id="384097"><p id="r-384096" data-claire-element-id="384096">news.php</p></li></ul></li><li id="r-384106" data-claire-element-id="384106"><p id="r-384100" data-claire-element-id="384100">vues</p><ul id="r-384105" data-claire-element-id="384105"><li id="r-384102" data-claire-element-id="384102"><p id="r-384101" data-claire-element-id="384101">news.php</p></li><li id="r-384104" data-claire-element-id="384104"><p id="r-384103" data-claire-element-id="384103">et les autres fichiers d'affichage comme logo.php, menu.php et pied.php si besoin.</p></li></ul></li></ul>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc">Adopter un style de programmation clair avec le modèle MVC</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/presentation-theorique">
Présentation théorique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/organiser-les-fichiers-sur-le-ftp">
Organiser les fichiers sur le FTP
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/application-pratique-un-systeme-de-news">
Application pratique : un système de news
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/d-autres-approches">
D&#039;autres approches
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/organiser-les-fichiers-sur-le-ftp">
<span class="arrow"></span>
<span class="next">Organiser les fichiers sur le FTP</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/d-autres-approches">
<span class="next">D&#039;autres approches</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="D039autresapproches"></a><h2>D&#039;autres approches</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/application-pratique-un-systeme-de-news">
<span class="arrow"></span>
<span class="next">Application pratique : un système de news</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-384110" data-claire-element-id="384110">Je vois plusieurs améliorations possibles. Je vais vous en lister quelques-unes ici : à vous de prendre, ou de laisser. Si vous avez d'autres idées, vous pouvez les proposer dans les commentaires, je me ferai un plaisir de les ajouter si je le juge utile. :)</p><h3 id="r-un-systeme-de-templates" data-claire-element-id="384121">Un système de templates !</h3><p id="r-384111" data-claire-element-id="384111">Comme je le dis depuis le début, c'est l'amélioration la plus évidente à apporter. Les codes de logique et de présentation sont déjà séparés, vous n'avez plus que quelques changements à réaliser pour ajouter le moteur.</p><p id="r-384112" data-claire-element-id="384112">Il en existe un grand nombre, je vous donne quelques idées ici, à vous de chercher un peu ensuite (Google est votre ami ;) )...</p><ul id="r-384119" data-claire-element-id="384119"><li id="r-384114" data-claire-element-id="384114"><p id="r-384113" data-claire-element-id="384113"><a href="http://www.gagatemplate.com/">Gagatemplate</a> ;</p></li><li id="r-384116" data-claire-element-id="384116"><p id="r-384115" data-claire-element-id="384115"><a href="http://smarty.net/">Smarty</a> ;</p></li><li id="r-384118" data-claire-element-id="384118"><p id="r-384117" data-claire-element-id="384117"><a href="http://www.talus-works.net/">Talus' TPL</a>.</p></li></ul><p id="r-384120" data-claire-element-id="384120">Un tutoriel sur l'utilisation des Gagatemplates existe sur ce site (<a href="http://www.siteduzero.com/tutoriel-3-35648-utilisation-d-un-moteur-de-templates-gagatemplate.html">celui-ci</a>), je vous conseille de le lire. Les généralités pourront vous aider à mieux cerner les avantages et inconvénients d'un tel système. Si vous envisagez de les utiliser, alors la suite vous fournira une initiation simple, faite par son concepteur.</p><h3 id="r-separer-les-modeles" data-claire-element-id="384124">Séparer les modèles</h3><p id="r-384122" data-claire-element-id="384122">Une idée peut être de séparer vos modèles par action. Actuellement, vous avez un modèle par contrôleur ou bien par thème (groupes.php, membres.php, etc.). Si vous le désirez, vous pouvez mettre une fonction par fichier. Vous aurez alors des fichiers du style groupes/ajouter.php ou membres/editer_profil.php.</p><p id="r-384123" data-claire-element-id="384123">C'est à vous de trouver s'il y a un intérêt pour votre site. Cela rend la gestion des erreurs un peu plus facile, puisque vous savez de quel fichier précis vient l'erreur, donc de quelle fonction. Certains trouveront lourd de devoir inclure le modèle spécifique avant chaque action... À vous de voir. ;)</p><h3 id="r-utiliser-un-framework" data-claire-element-id="384143">Utiliser un framework</h3><p id="r-384125" data-claire-element-id="384125">Un <em>framework</em> est un ensemble de scripts PHP vous permettant de faciliter la création de sites web. En (très) gros, ils comportent des méthodes pour gérer les accès à SQL, les sessions, le cache, des templates, etc., sans que vous n'ayez rien à écrire. Or, ils se trouve (tiens donc :-° ) que la majorité de ces <em>frameworks</em> utilisent le modèle MVC. Bien sûr, vous n'aurez pas à utiliser ce dernier tel quel, mais la lecture de ce tuto vous en aura appris le principe. :)</p><p id="r-384126" data-claire-element-id="384126">Voici quelques <em>frameworks</em> que vous pourrez utiliser :</p><ul id="r-384135" data-claire-element-id="384135"><li id="r-384128" data-claire-element-id="384128"><p id="r-384127" data-claire-element-id="384127"><a href="http://www.symfony-project.org/">Symfony</a> (en anglais) ;</p></li><li id="r-384130" data-claire-element-id="384130"><p id="r-384129" data-claire-element-id="384129"><a href="http://framework.zend.com/">Zend Framework</a> (en anglais, mais avec <a href="http://framework.zend.com/manual/fr/">une documentation en français</a>) ;</p></li><li id="r-384132" data-claire-element-id="384132"><p id="r-384131" data-claire-element-id="384131"><a href="http://codeigniter.com/">Code Igniter</a> (en anglais) ;</p></li><li id="r-384134" data-claire-element-id="384134"><p id="r-384133" data-claire-element-id="384133"><a href="http://cakephp.org/">CakePHP</a> (en anglais).</p></li></ul><p id="r-384136" data-claire-element-id="384136">Les deux premiers <em>frameworks</em> cités sont sans doute les frameworks les plus utilisés dans le monde professionnel, et sont vraiment très bien conçus ! Les deux suivants sont plus légers, mais aussi bien plus simples à prendre en main. On pourrait aussi parler de <a href="http://www.django-fr.org/">Django</a>. Attention, il s'utilise avec le langage Python ! Il sort donc un peu du cadre de tutoriels PHP puisqu'il faut connaître le langage Python pour l'utiliser. Il est cependant très connu, c'est pourquoi j'en parle.</p><aside id="r-384138" data-claire-element-id="384138" data-claire-semantic="information"><p id="r-384137" data-claire-element-id="384137">Notez que tous les ajouts spécifiés dans cette partie ne sont en aucun cas obligatoires. Ils s'éloignent un peu du modèle MVC standard. Cependant, si l'un d'entre eux vous tente, n'hésitez pas !</p></aside><p id="r-384139" data-claire-element-id="384139">Je vous recommande <a href="http://www.siteduzero.com/forum-83-174429-p1-vos-techniques-pour-le-developpement-de-sites-en-php.html">ce sujet du forum PHP</a>, traitant des techniques de programmation en PHP, qui est dans la continuité de ce tuto. En cas de problème sur le tuto, les commentaires sont là pour ça.</p><p id="r-384140" data-claire-element-id="384140">J'espère que ce tutoriel vous a plu et donné envie de mieux organiser le code de votre site !</p><div id="r-384142" data-claire-element-id="384142"><p id="r-384141" data-claire-element-id="384141"><em>Merci à <a href="http://www.siteduzero.com/membres-294-7500.html">ptipilou</a> pour sa relecture attentive de mon tutoriel et sa zCorrection online. :)</em></p></div>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc">Adopter un style de programmation clair avec le modèle MVC</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/presentation-theorique">
Présentation théorique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/organiser-les-fichiers-sur-le-ftp">
Organiser les fichiers sur le FTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/application-pratique-un-systeme-de-news">
Application pratique : un système de news
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/d-autres-approches">
D&#039;autres approches
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/adopter-un-style-de-programmation-clair-avec-le-modele-mvc/application-pratique-un-systeme-de-news">
<span class="arrow"></span>
<span class="next">Application pratique : un système de news</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/adopter-un-style-de-programmation-clair-avec-le-modele-mvc.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 03:05:24 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/adopter-un-style-de-programmation-clair-avec-le-modele-mvc.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:41:09 GMT -->
</html>