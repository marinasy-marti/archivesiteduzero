<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/upload-de-fichiers-par-formulaire.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 22:43:42 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/upload-de-fichiers-par-formulaire.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:59:40 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Upload de fichiers par formulaire</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/upload-de-fichiers-par-formulaire.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Upload de fichiers par formulaire</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Uploaddefichiersparformulaire">Upload de fichiers par formulaire</a><br/><a href="#L039uploadc039estquoi">L&#039;upload, c&#039;est quoi ?</a><br/><a href="#Crerleformulaire">Créer le formulaire</a><br/><a href="#Rcuprerlefichier">Récupérer le fichier</a><br/><a href="#Etaprs">Et après ?</a><br/><a href="#Enbonus">En bonus</a><br/></div>
<a name="Uploaddefichiersparformulaire"></a><h2>Upload de fichiers par formulaire</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/l-upload-c-est-quoi">
<span class="next">L&#039;upload, c&#039;est quoi ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-82137" data-claire-element-id="82137">L'utilisation des formulaires n'est pas des plus compliquées, et vous en avez certainement déjà utilisé pour créer votre site web, ne serait-ce que pour la page d'inscription et de connexion.</p><p id="r-82138" data-claire-element-id="82138">Mais dès que l'on souhaite aller plus loin, et proposer aux visiteurs de personnaliser leur avatar ou d'envoyer une image, cela devient plus difficile. Or, PHP propose des fonctions permettant justement de créer ce genre de script.</p><aside id="r-82140" data-claire-element-id="82140" data-claire-semantic="warning"><p id="r-82139" data-claire-element-id="82139"><strong>Pour suivre ce tutoriel, il est fortement conseillé d'avoir lu les cours portant sur XHTML et PHP de M@teo21.</strong></p></aside>
</div><a name="L039uploadc039estquoi"></a><h2>L&#039;upload, c&#039;est quoi ?</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/creer-le-formulaire">
<span class="next">Créer le formulaire</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-82141" data-claire-element-id="82141">Internet est un réseau mondial, regroupant des millions d'individus répartis sur le globe. Toutes ces personnes s'échangent des messages, partagent des fichiers, jouent ou cherchent des informations. Nous échangeons donc des données directement avec d'autres personnes ou avec des ordinateurs installés dans des locaux.</p><p id="r-82142" data-claire-element-id="82142">Tous ces transferts de données d'un ordinateur à l'autre se font par le biais de connexions, qu'elles soient filaires ou non-filaires (comme le célèbre WiFi). Une connexion est donc un lien entre deux ordinateurs.</p><p id="r-82143" data-claire-element-id="82143">Imaginons qu'Alice souhaite envoyer un message à Bob. Pour ce faire, elle a besoin de créer une connexion avec Bob. Heureusement, ce n'est pas directement Alice mais son ordinateur qui va s'occuper de créer et de gérer cette connexion. Alice utilisera très probablement un logiciel muni d'une interface graphique simple dans lequel elle devra indiquer à qui elle souhaite envoyer son message. Pour ce faire, elle doit donc connaître son adresse (e-mail, IP, ICQ ou autre). Une fois l'adresse connue, l'ordinateur d'Alice envoie une demande de connexion à celui de Bob, qui peut alors l'accepter. Les deux ordinateurs peuvent ensuite s'échanger des données.</p><p id="r-82144" data-claire-element-id="82144">L'ordinateur (ainsi que le logiciel) qui crée la connexion s'appelle le <strong>client</strong>, alors que celui qui « reçoit » la demande s'appelle le <strong>serveur</strong>.<br/> Pour chacun des ordinateurs, les données reçues constituent le <strong>download</strong> (téléchargement), alors que les données envoyées constituent l'<strong>upload</strong> (téléversement). Si vous avez bien compris, vous devriez alors voir que tout ce qui est de l'upload pour le client, est du download pour le serveur, et réciproquement.</p><figure id="r-82146" data-claire-element-id="82147"><img id="r-82145" data-claire-element-id="82145" src="medias/uploads.siteduzero.com_files_99001_100000_99437.png" alt="Image utilisateur"/></figure><p id="r-82148" data-claire-element-id="82148">Figure 1 - Vue de la connexion pour le client.</p><p id="r-82149" data-claire-element-id="82149">Consulter un site web revient généralement à télécharger (download) les pages, images et autres fichiers qui forment la page que l'on souhaite. C'est le navigateur qui s'occupe de gérer toutes les connexions nécessaires, qui envoie les demandes de fichiers, reçoit les fichiers et affiche la page.</p><p id="r-82150" data-claire-element-id="82150">Mais depuis de nombreuses années, les sites s'ouvrent aux visiteurs de manière à leur permettre de participer à la vie du site. On trouve désormais bon nombre de forums, des galeries, et de nombreuses autres applications en ligne. Pour permettre aux visiteurs d'envoyer des données, la page contient un formulaire.</p><p id="r-82151" data-claire-element-id="82151">Donc, dans un premier temps, le visiteur sélectionne le fichier. Ensuite, après avoir rempli le reste du formulaire, il clique sur le bouton pour l'envoyer.<br/> À ce moment-là, le navigateur du client demande au serveur la page « cible » (spécifiée grâce à l'attribut <strong><em>action</em></strong> du formulaire) en lui envoyant une requête HTTP. Dans cette requête, le navigateur fournit diverses informations (page demandée, nom et version du navigateur, <em>cookies</em> qu'il possède pour ce site, etc.) dont les données du formulaire.</p><p id="r-82152" data-claire-element-id="82152">Le serveur (Apache par exemple) analyse la requête et passe le relais à PHP. Juste avant de lancer l'exécution de la page demandée, PHP s'occupe des données envoyées par le formulaire :</p><ul id="r-82159" data-claire-element-id="82159"><li id="r-82154" data-claire-element-id="82154"><p id="r-82153" data-claire-element-id="82153">les champs textuels (text, checkbox, select, textarea, ...) sont copiés dans le tableau superglobal $_POST ;</p></li><li id="r-82156" data-claire-element-id="82156"><p id="r-82155" data-claire-element-id="82155">les informations concernant les champs de type <strong><em>file</em></strong> sont enregistrées dans le tableau superglobal $_FILES ;</p></li><li id="r-82158" data-claire-element-id="82158"><p id="r-82157" data-claire-element-id="82157">les fichiers sont temporairement placés dans le dossier temporaire du serveur.</p></li></ul><p id="r-82160" data-claire-element-id="82160">Une fois que tout est prêt, PHP commence à exécuter le script de la page demandée. C'est donc le script PHP qui va pouvoir gérer le fichier. Il ne faudra pas oublier que le fichier est dans un dossier temporaire, et donc que si l'on souhaite le garder, il faudra le placer ailleurs (dans un dossier du site par exemple). Si au contraire on décide de ne pas garder le fichier (par exemple si on remarque qu'il est trop grand, que ce n'est pas une image, …) il suffit de ne pas le déplacer ; il sera effacé automatiquement lorsque le script aura fini d'être exécuté.</p><p id="r-82161" data-claire-element-id="82161">Nous allons voir plus en détail comment mettre en place le script.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire">Upload de fichiers par formulaire</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/l-upload-c-est-quoi">
L&#039;upload, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/creer-le-formulaire">
Créer le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/recuperer-le-fichier">
Récupérer le fichier
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/et-apres-1">
Et après ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/en-bonus">
En bonus
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/creer-le-formulaire">
<span class="next">Créer le formulaire</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Crerleformulaire"></a><h2>Créer le formulaire</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/l-upload-c-est-quoi">
<span class="arrow"></span>
<span class="next">L&#039;upload, c&#039;est quoi ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/recuperer-le-fichier">
<span class="next">Récupérer le fichier</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-82163" data-claire-element-id="82163">Bien, nous voici donc à la première étape : la création d'un formulaire. Le visiteur qui veut uploader un fichier doit passer par un formulaire.</p><h2 id="r-le-champ-de-selection" data-claire-element-id="82176">Le champ de sélection</h2><div id="r-82165" data-claire-element-id="82165" data-claire-semantic="question"><p id="r-82164" data-claire-element-id="82164">Je ne peux pas simplement faire un champ texte pour indiquer l'adresse du fichier sur le disque dur ?</p></div><p id="r-82166" data-claire-element-id="82166">Eh bien non, cela serait terriblement dangereux. En effet, s'il suffisait au script PHP d'avoir l'adresse du fichier pour pouvoir le prendre sur le disque dur du visiteur, un <em>webmaster</em> mal intentionné pourrait prendre tous les fichiers qu'il veut, et donc même ceux qui contiennent vos informations confidentielles ! C'est pourquoi on utilise un type de champ particulier où seul le visiteur pourra choisir le fichier que le navigateur va envoyer au serveur.</p><p id="r-82167" data-claire-element-id="82167">Il faut utiliser la balise XHTML <code data-claire-semantic="html">&lt;input /&gt;</code> que vous connaissez déjà sous trois formes :</p><pre id="r-82168" data-claire-element-id="82168"><code data-claire-semantic="html">&lt;input type=&quot;text&quot; name=&quot;nom&quot; value=&quot;valeur par défaut&quot; /&gt;
&lt;input type=&quot;password&quot; name=&quot;nom&quot; value=&quot;valeur par défaut&quot; /&gt;
&lt;input type=&quot;hidden&quot; name=&quot;nom&quot; value=&quot;valeur par défaut&quot; /&gt;</code></pre><p id="r-82169" data-claire-element-id="82169">Nous allons utiliser une autre forme de cette balise, qui permet au visiteur de sélectionner un fichier dans une liste. Elle est fortement semblable aux trois formes précédentes, mais son type est « <em>file</em> » et elle ne peut pas avoir de valeur par défaut :</p><pre id="r-82170" data-claire-element-id="82170"><code data-claire-semantic="html">&lt;input type=&quot;file&quot; name=&quot;nom&quot; /&gt;</code></pre><p id="r-82171" data-claire-element-id="82171"><cite>Citation : Aperçu</cite></p><blockquote id="r-82173" data-claire-element-id="82174"><img id="r-82174" data-claire-element-id="82173" src="medias/uploads.siteduzero.com_files_7001_8000_7338.png" alt="Image utilisateur"/><img id="r-82172" data-claire-element-id="82172" src="medias/uploads.siteduzero.com_files_7001_8000_7338.png" alt="Image utilisateur"/></blockquote><p id="r-82175" data-claire-element-id="82175">Elle permet, comme vous le voyez, de sélectionner un fichier à envoyer. Vous pouvez en mettre autant que vous le souhaitez dans votre formulaire, mais n'oubliez pas de leur donner des noms différents. :)</p><h2 id="r-l-en-tete-du-formulaire" data-claire-element-id="82185">L'en-tête du formulaire</h2><p id="r-82177" data-claire-element-id="82177">Pour que le navigateur sache qu'il doit envoyer un fichier, on l'indique dans l'en-tête du formulaire. C'est très simple, mais il faudra bien y penser pour que votre formulaire fonctionne correctement.<br/> Vous connaissez déjà la balise <code data-claire-semantic="html">&lt;form&gt;</code>, il ne devrait donc pas vous être difficile d'y ajouter une propriété. Il s'agit de la propriété <strong><em>enctype</em></strong>, qui indique le type d'encodage des données. Elle prendra la valeur « <em>multipart/form-data</em> », qui spécifie que le formulaire envoie des données binaires (fichier) et du texte (champs de formulaire). Ce qui nous donne ceci :</p><pre id="r-82178" data-claire-element-id="82178"><code data-claire-semantic="html">&lt;form method=&quot;post&quot; action=&quot;page.php&quot; enctype=&quot;multipart/form-data&quot;&gt;</code></pre><p id="r-82179" data-claire-element-id="82179">Profitons-en pour nous intéresser aux deux autres propriétés du formulaire.</p><ul id="r-82184" data-claire-element-id="82184"><li id="r-82181" data-claire-element-id="82181"><p id="r-82180" data-claire-element-id="82180"><strong>method</strong> : c'est la façon dont les informations seront envoyées, soit par l'URL si la méthode est « GET », soit dans la requête HTTP si la méthode est « POST ». Dans le cas de l'envoi d'un fichier, cette propriété <strong>doit</strong> être placée à « POST », car le fichier ne peut pas être passé par l'URL ( ^^ ) . Il existe d'autres valeurs possibles, mais qui ne nous intéressent pas ici.</p></li><li id="r-82183" data-claire-element-id="82183"><p id="r-82182" data-claire-element-id="82182"><strong>action</strong> : c'est la page qui sera appelée lors de l'envoi du formulaire. C'est-à-dire, par exemple, le script PHP qui va traiter la réception du fichier. Vous pouvez placer le script sur la même page que le formulaire, comme vous avez appris à le faire dans le cours PHP (que vous devez aussi avoir lu pour poursuivre ce tutoriel).</p></li></ul><h2 id="r-restrictions" data-claire-element-id="82194">Restrictions</h2><p id="r-82186" data-claire-element-id="82186">Un <em>webmaster</em> sain d'esprit ne laissera pas n'importe qui uploader n'importe quoi ( ^^ ) . C'est pourquoi il est nécessaire d'apprendre à restreindre l'envoi. Nous verrons par la suite que c'est en PHP que se fera la plus grosse partie de la vérification, mais il est déjà possible, en XHTML, de fixer une limite de taille sur l'envoi.</p><aside id="r-82188" data-claire-element-id="82188" data-claire-semantic="warning"><p id="r-82187" data-claire-element-id="82187">Comme tout formulaire XHTML, il ne faut jamais oublier qu'il est très facile de passer outre un champ ou une propriété. Cette restriction ne peut donc qu'être utilisée <strong>en plus</strong> de la vérification par PHP, et ne constitue en aucun cas une barrière infranchissable.</p></aside><p id="r-82189" data-claire-element-id="82189">C'est en fait juste une variable que l'on communique au navigateur dans le formulaire. Comme le visiteur n'a pas besoin de voir ce champ, on lui attribue le type <strong><em>hidden</em></strong>.</p><pre id="r-82190" data-claire-element-id="82190"><code data-claire-semantic="html">&lt;input type=&quot;hidden&quot; name=&quot;MAX_FILE_SIZE&quot; value=&quot;12345&quot; /&gt;</code></pre><p id="r-82191" data-claire-element-id="82191">Cette restriction se fait en octets. Normalement, depuis quelques années, 1 Go = 1 000 Mo = 1 000 000 Ko = 10^9 octets, mais cette norme n'est pas suivie par tout le monde ; il existe encore beaucoup de cas où le « vieux » système de conversion est utilisé :</p><pre id="r-82192" data-claire-element-id="82192"><code data-claire-semantic="console">1 Go = 2^10 Mo = 1024 Mo
1 Mo = 2^10 Ko = 1024 Ko
1 Ko = 2^10 octets = 1024 octets
::&gt;
1 Mo = 2^20 octets = 1048576 octets</code></pre><p id="r-82193" data-claire-element-id="82193">Vous devez placer ce champ <strong>avant</strong> le champ de sélection du fichier.<br/> Remarque : ce champ fixe la limite totale des uploads, et comprend donc tous les fichiers uploadés par ce formulaire.</p><h2 id="r-finalisation-exemple" data-claire-element-id="82202">Finalisation/Exemple</h2><p id="r-82195" data-claire-element-id="82195">Nous avons maintenant vu tout ce qui est nécessaire pour réaliser un formulaire d'upload. Bien sûr, vous pouvez ajouter autant de champs que vous le souhaitez. Pour ma part, je vais par exemple ajouter un champ de type texte pour indiquer une brève description. J'ai aussi décidé de permettre au visiteur d'envoyer deux fichiers avec le formulaire. Au final, mon code XHTML ressemble à ceci :</p><pre id="r-82196" data-claire-element-id="82196"><code data-claire-semantic="html">&lt;form method=&quot;post&quot; action=&quot;reception.php&quot; enctype=&quot;multipart/form-data&quot;&gt;
     &lt;label for=&quot;icone&quot;&gt;Icône du fichier (JPG, PNG ou GIF | max. 15 Ko) :&lt;/label&gt;&lt;br /&gt;
     &lt;input type=&quot;file&quot; name=&quot;icone&quot; id=&quot;icone&quot; /&gt;&lt;br /&gt;
     &lt;label for=&quot;mon_fichier&quot;&gt;Fichier (tous formats | max. 1 Mo) :&lt;/label&gt;&lt;br /&gt;
     &lt;input type=&quot;hidden&quot; name=&quot;MAX_FILE_SIZE&quot; value=&quot;1048576&quot; /&gt;
     &lt;input type=&quot;file&quot; name=&quot;mon_fichier&quot; id=&quot;mon_fichier&quot; /&gt;&lt;br /&gt;
     &lt;label for=&quot;titre&quot;&gt;Titre du fichier (max. 50 caractères) :&lt;/label&gt;&lt;br /&gt;
     &lt;input type=&quot;text&quot; name=&quot;titre&quot; value=&quot;Titre du fichier&quot; id=&quot;titre&quot; /&gt;&lt;br /&gt;
     &lt;label for=&quot;description&quot;&gt;Description de votre fichier (max. 255 caractères) :&lt;/label&gt;&lt;br /&gt;
     &lt;textarea name=&quot;description&quot; id=&quot;description&quot;&gt;&lt;/textarea&gt;&lt;br /&gt;
     &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Envoyer&quot; /&gt;
&lt;/form&gt;</code></pre><p id="r-82197" data-claire-element-id="82197"><cite>Citation : Aperçu</cite></p><blockquote id="r-82199" data-claire-element-id="82200"><img id="r-82200" data-claire-element-id="82199" src="medias/uploads.siteduzero.com_files_7001_8000_7339.png" alt="Image utilisateur"/><img id="r-82198" data-claire-element-id="82198" src="medias/uploads.siteduzero.com_files_7001_8000_7339.png" alt="Image utilisateur"/></blockquote><p id="r-82201" data-claire-element-id="82201">La réalisation du formulaire est à présent terminée. Nous allons maintenant passer à la réception du fichier par le script PHP. :)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire">Upload de fichiers par formulaire</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/l-upload-c-est-quoi">
L&#039;upload, c&#039;est quoi ?
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/creer-le-formulaire">
Créer le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/recuperer-le-fichier">
Récupérer le fichier
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/et-apres-1">
Et après ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/en-bonus">
En bonus
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/l-upload-c-est-quoi">
<span class="arrow"></span>
<span class="next">L&#039;upload, c&#039;est quoi ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/recuperer-le-fichier">
<span class="next">Récupérer le fichier</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Rcuprerlefichier"></a><h2>Récupérer le fichier</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/creer-le-formulaire">
<span class="arrow"></span>
<span class="next">Créer le formulaire</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/et-apres-1">
<span class="next">Et après ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-82204" data-claire-element-id="82204">Poursuivons notre petite histoire. Le formulaire est en place ; le visiteur le remplit puis le valide. Comme je vous l'ai expliqué, les fichiers sont alors uploadés et placés dans un répertoire temporaire. L'avantage, c'est que seul le script PHP pourra accéder à ce dossier.</p><p id="r-82205" data-claire-element-id="82205">Nous allons donc contrôler le fichier puis le déplacer vers un dossier du site. On peut contrôler plusieurs choses : la taille, le type, le nom, les dimensions (si c'est une image), …</p><p id="r-82206" data-claire-element-id="82206">Le tableau $_FILES contient certaines informations sur les fichiers. Pour chaque champ de type <strong><em>file</em></strong>, on peut obtenir les informations le concernant dans le tableau $_FILES[<em>attribut_name</em>]. On retrouve actuellement les informations suivantes :</p><pre id="r-82207" data-claire-element-id="82207"><code data-claire-semantic="html+php">&lt;?php
$_FILES['icone']['name']     //Le nom original du fichier, comme sur le disque du visiteur (exemple : mon_icone.png).
$_FILES['icone']['type']     //Le type du fichier. Par exemple, cela peut être « image/png ».
$_FILES['icone']['size']     //La taille du fichier en octets.
$_FILES['icone']['tmp_name'] //L'adresse vers le fichier uploadé dans le répertoire temporaire.
$_FILES['icone']['error']    //Le code d'erreur, qui permet de savoir si le fichier a bien été uploadé.
?&gt;</code></pre><aside id="r-82209" data-claire-element-id="82209" data-claire-semantic="warning"><p id="r-82208" data-claire-element-id="82208">Le type n'est pas totalement fiable, car il dépend de l'extension du fichier.</p></aside><h2 id="r-controles-sur-le-fichier" data-claire-element-id="82223">Contrôles sur le fichier</h2><p id="r-82210" data-claire-element-id="82210">Une première vérification consiste à savoir si le fichier a bien été uploadé. Pour ce faire, nous allons utiliser le code d'erreur du fichier. Ensuite nous pourrons effectuer les autres tests.</p><pre id="r-82211" data-claire-element-id="82211"><code data-claire-semantic="html+php">&lt;?php
if ($_FILES['icone']['error'] &gt; 0) $erreur = &quot;Erreur lors du transfert&quot;;
?&gt;</code></pre><p id="r-82212" data-claire-element-id="82212">On peut même préciser de quel type d'erreur il s'agit en comparant le code d'erreur à plusieurs constantes :</p><p id="r-82213" data-claire-element-id="82213"><cite>Citation</cite></p><blockquote id="r-82215" data-claire-element-id="82215"><p id="r-82214" data-claire-element-id="82214"><strong>UPLOAD_ERR_NO_FILE</strong> : fichier manquant.<br/><strong>UPLOAD_ERR_INI_SIZE</strong> : fichier dépassant la taille maximale autorisée par PHP.<br/><strong>UPLOAD_ERR_FORM_SIZE</strong> : fichier dépassant la taille maximale autorisée par le formulaire.<br/><strong>UPLOAD_ERR_PARTIAL</strong> : fichier transféré partiellement.</p></blockquote><p id="r-82216" data-claire-element-id="82216">Commençons par la taille maximale. Pas difficile, c'est une simple comparaison. :)</p><pre id="r-82217" data-claire-element-id="82217"><code data-claire-semantic="html+php">&lt;?php
if ($_FILES['icone']['size'] &gt; $maxsize) $erreur = &quot;Le fichier est trop gros&quot;;
?&gt;</code></pre><p id="r-82218" data-claire-element-id="82218">Pour le type, nous n'allons pas utiliser le <em>type</em> du tableau mais l'extension du fichier, ce qui sera plus simple. Rassurez-vous, cela revient exactement au même, car le <em>type</em> est pris en fonction de l'extension. Ce qui signifie aussi, malheureusement, qu'on ne peut pas être sûr de la nature du fichier.<br/> Le moyen le plus efficace et le plus polyvalent est de placer les extensions autorisées dans un tableau puis de vérifier que l'extension du fichier est bien dans ce tableau. On pourrait aussi, si on souhaitait autoriser tous les types de fichier mis à part quelques uns, lister les extensions non autorisées et vérifier ensuite que l'extension du fichier uploadé ne s'y trouve pas. Pour cette dernière méthode, il suffit alors d'ajouter une négation à la condition grâce à « <strong>!</strong> ».</p><pre id="r-82219" data-claire-element-id="82219"><code data-claire-semantic="html+php">&lt;?php
$extensions_valides = array( 'jpg' , 'jpeg' , 'gif' , 'png' );
//1. strrchr renvoie l'extension avec le point (« . »).
//2. substr(chaine,1) ignore le premier caractère de chaine.
//3. strtolower met l'extension en minuscules.
$extension_upload = strtolower(  substr(  strrchr($_FILES['icone']['name'], '.')  ,1)  );
if ( in_array($extension_upload,$extensions_valides) ) echo &quot;Extension correcte&quot;;
?&gt;</code></pre><p id="r-82220" data-claire-element-id="82220">Pour contrôler les dimensions d'une image, il suffit d'utiliser une fonction PHP, <em><strong>getimagesize()</strong></em>, qui retourne un tableau. Nous devons bien évidemment spécifier l'adresse du fichier, qui pour l'instant se trouve dans le dossier temporaire. La fonction retourne alors un tableau dont l'index 0 donne la largeur et l'index 1 la hauteur de l'image. C'est ici encore une simple condition.</p><pre id="r-82221" data-claire-element-id="82221"><code data-claire-semantic="html+php">&lt;?php
$image_sizes = getimagesize($_FILES['icone']['tmp_name']);
if ($image_sizes[0] &gt; $maxwidth OR $image_sizes[1] &gt; $maxheight) $erreur = &quot;Image trop grande&quot;;
?&gt;</code></pre><p id="r-82222" data-claire-element-id="82222">En utilisant conjointement ces deux ou trois tests, on peut s'assurer que le fichier est correct et que nous pouvons donc le déplacer dans un dossier du site sans danger. Je ne vous ai pas donné le code final, mais vous devriez être capables de le réaliser facilement avec les lignes de code que je vous ai données. Si vous n'y arrivez pas, c'est que vous devriez sans doute relire le cours, car vous n'avez pas compris le fonctionnement de PHP.</p><h2 id="r-deplacer-le-fichier" data-claire-element-id="82243">Déplacer le fichier</h2><p id="r-82224" data-claire-element-id="82224">Pour déplacer le fichier, nous avons besoin de deux informations : l'emplacement de départ, que nous connaissons déjà grâce à la variable superglobale $_FILES, et l'emplacement de destination, que nous devons fixer nous-mêmes. Ici, plusieurs possibilités s'offrent à nous. <br/> Il est toujours important de bien choisir de quelle façon on va nommer les fichiers. Il faut se rappeler deux règles fondamentales : deux fichiers ne peuvent pas avoir le même nom dans le même dossier, et il faut faire attention à l'extension. Ce qui veut dire que l'on ne va presque jamais garder le nom de départ du fichier, car deux visiteurs différents pourraient avoir un fichier du même nom. Pour l'extension, nous verrons par la suite comment contourner le problème. Voici d'abord quelques exemples de noms :</p><ul id="r-82231" data-claire-element-id="82231"><li id="r-82226" data-claire-element-id="82226"><p id="r-82225" data-claire-element-id="82225">un avatar : on peut lui donner le numéro unique (id) du membre (1, 2, 343, ...) ;</p></li><li id="r-82228" data-claire-element-id="82228"><p id="r-82227" data-claire-element-id="82227">une image perso : on peut créer un dossier par membre (s'il peut uploader plusieurs fichiers) et garder le nom de départ ;</p></li><li id="r-82230" data-claire-element-id="82230"><p id="r-82229" data-claire-element-id="82229">un <em>tracker</em> torrent : on peut lui attribuer un numéro unique (son id dans une BDD par exemple).</p></li></ul><p id="r-82232" data-claire-element-id="82232">Il existe de nombreux autres choix possibles : attribuer un nom alphanumérique généré au hasard, la date actuelle, etc.</p><p id="r-82233" data-claire-element-id="82233">Quelques fonctions utiles :</p><p id="r-82234" data-claire-element-id="82234">Créer un dossier : <em>bool</em><a href="http://be2.php.net/mkdir">mkdir</a> ( <strong>string</strong><em>$pathname</em> [, <strong>int</strong><em>$mode</em> [, <strong>bool</strong><em>$recursive</em> [, <strong>resource</strong><em>$context</em> ]]] )<br/>Créer un identifiant alphanumérique unique : <em>string</em><a href="http://be2.php.net/manual/fr/function.uniqid.php">uniqid</a> ([ <strong>string</strong><em>$prefix</em> [, <strong>bool</strong><em>$more_entropy</em> ]] )</p><pre id="r-82235" data-claire-element-id="82235"><code data-claire-semantic="html+php">&lt;?php
//Créer un dossier 'fichiers/1/'
  mkdir('fichier/1/', 0777, true);
 
//Créer un identifiant difficile à deviner
  $nom = md5(uniqid(rand(), true));
?&gt;</code></pre><p id="r-82236" data-claire-element-id="82236">Pour l'extension, on a plusieurs possibilités. On peut garder celle de départ, s’il s’agit par exemple d'une image ou d'un document PDF. En revanche, si l'extension de départ est <em>php</em> ou <em>html</em>, mieux vaut changer l'extension pour éviter que le visiteur puisse placer ses propres scripts sur le site.<br/> &gt;Il y a plusieurs façons de procéder : on peut se contenter d'ajouter une extension après celle déjà existante (par exemple <em>page2.php</em> deviendrait <em>page2.php.file</em>) ; on peut remplacer l'extension par une autre (<em>page2.php</em> deviendrait <em>page2.file</em>) ; ou on peut finalement retirer l'extension (<em>page2.php</em> deviendrait <em>page2</em>). Évidemment, lorsqu'un visiteur voudra télécharger le fichier, il faudra remettre l'extension correcte, mais nous verrons comment faire cela plus tard.</p><p id="r-82237" data-claire-element-id="82237">Une fois le nom du fichier choisi, il faut déplacer le fichier du répertoire temporaire vers le dossier de destination. Il existe pour cela une fonction très simple qui fonctionne presque exactement comme la fonction <em><strong>copy()</strong></em> ; il s'agit de la fonction <strong><em>move_uploaded_file()</em></strong>. La principale différence avec <em>copy</em>, c'est qu'elle vérifie également que le fichier que l'on souhaite déplacer provient bien d'un formulaire PHP. Voici un exemple d'utilisation :</p><pre id="r-82238" data-claire-element-id="82238"><code data-claire-semantic="html+php">&lt;?php
$nom = &quot;avatars/{$id_membre}.{$extension_upload}&quot;;
$resultat = move_uploaded_file($_FILES['icone']['tmp_name'],$nom);
if ($resultat) echo &quot;Transfert réussi&quot;;
?&gt;</code></pre><p id="r-82239" data-claire-element-id="82239">La fonction renvoie vrai ou faux, selon que le fichier a bien été déplacé ou non. On peut donc s'assurer que le transfert a bien eu lieu, ce qui constitue la dernière étape dans l'upload du fichier.</p><aside id="r-82241" data-claire-element-id="82241" data-claire-semantic="warning"><p id="r-82240" data-claire-element-id="82240">N'oubliez pas que pour copier un fichier dans un dossier, PHP doit y avoir accès en écriture. Il faut donc que le CHMOD de ce dossier soit correctement configuré. En pratique, 733 suffit en général. Sur Windows, l'accès est garanti.</p></aside><p id="r-82242" data-claire-element-id="82242">Nous allons maintenant voir comment nous pouvons tirer parti de l'upload de plusieurs manières.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire">Upload de fichiers par formulaire</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/l-upload-c-est-quoi">
L&#039;upload, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/creer-le-formulaire">
Créer le formulaire
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/recuperer-le-fichier">
Récupérer le fichier
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/et-apres-1">
Et après ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/en-bonus">
En bonus
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/creer-le-formulaire">
<span class="arrow"></span>
<span class="next">Créer le formulaire</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/et-apres-1">
<span class="next">Et après ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Etaprs"></a><h2>Et après ?</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/recuperer-le-fichier">
<span class="arrow"></span>
<span class="next">Récupérer le fichier</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/en-bonus">
<span class="next">En bonus</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-82245" data-claire-element-id="82245">Une fois le fichier uploadé et déplacé dans un dossier du site, il est possible d'effectuer plusieurs actions. Parmi les nombreuses possibilités qui s’offrent à nous, voici les quelques-unes que nous allons étudier :</p><ul id="r-82252" data-claire-element-id="82252"><li id="r-82247" data-claire-element-id="82247"><p id="r-82246" data-claire-element-id="82246">enregistrement des infos dans une BDD ;</p></li><li id="r-82249" data-claire-element-id="82249"><p id="r-82248" data-claire-element-id="82248">téléchargements avec compteur ;</p></li><li id="r-82251" data-claire-element-id="82251"><p id="r-82250" data-claire-element-id="82250">création de miniatures.</p></li></ul><h2 id="r-enregistrement-des-infos-dans-une-bdd" data-claire-element-id="82278">Enregistrement des infos dans une BDD</h2><p id="r-82253" data-claire-element-id="82253">Je ne vais pas vous apprendre à créer une table ou à insérer un nouvel enregistrement. En revanche, je peux vous donner quelques conseils pour bien utiliser votre BDD.</p><p id="r-82254" data-claire-element-id="82254">Tout d'abord, notons quelles informations sont utiles à enregistrer : le titre, la description, le nom du fichier, son nom dans le dossier du site, la date d'ajout, la taille, et, si vous avez un espace membre, pourquoi ne pas y ajouter l'id du membre qui a posté le fichier ?</p><p id="r-82255" data-claire-element-id="82255">Le nombre de champs, et ceux que vous choisissez, dépend fortement de l'utilisation que vous souhaitez faire de ces fichiers. S'il s'agit juste d'un avatar, il est certainement inutile d'enregistrer des infos dans une BDD, il suffit de donner comme nom à l'image l'id du membre et vous éviterez ainsi une requête inutile. :) <br/> S'il s'agit au contraire d'une galerie, il est très pratique d'enregistrer les infos dans une table en y ajoutant par exemple une note attribuée par les visiteurs. Réfléchissez toujours à ce dont vous aurez besoin par la suite.</p><p id="r-82256" data-claire-element-id="82256">Voici, par exemple, la table que je pourrais créer pour un mini-espace membre permettant d'uploader des fichiers :</p><p id="r-82257" data-claire-element-id="82257"><cite>Citation : Table MySQL</cite></p><blockquote id="r-82259" data-claire-element-id="82260"><img id="r-82260" data-claire-element-id="82259" src="medias/uploads.siteduzero.com_files_7001_8000_7342.png" alt="Image utilisateur"/><img id="r-82258" data-claire-element-id="82258" src="medias/uploads.siteduzero.com_files_7001_8000_7342.png" alt="Image utilisateur"/></blockquote><aside id="r-82262" data-claire-element-id="82262" data-claire-semantic="information"><p id="r-82261" data-claire-element-id="82261">Il peut s'avérer très utile, pour une question de clarté et de facilité, d'utiliser un préfixe sur les noms des champs. Vous pouvez voir que dans ma table, tous les champs commencent par le préfixe <em>up_</em>, qui permet d'identifier immédiatement la provenance de l'information. Pensez à utiliser systématiquement un préfixe différent pour chaque table, d'environs 2-3 caractères suivis d'un <em>underscore</em> (_).</p></aside><p id="r-82263" data-claire-element-id="82263">La raison pour laquelle j'ai mis un champ <em>filesize</em> est simple : pour éviter de devoir aller chercher la taille pour chaque fichier, on l'enregistre dans la BDD, ce qui permet d'économiser un temps de traitement intéressant. Le champ d'identification est quant à lui toujours très utile : en mode <em>auto_increment</em>, il vous permettra de directement pouvoir accéder aux infos d'un fichier particulier.</p><p id="r-82264" data-claire-element-id="82264">Enfin, n'oubliez pas d'optimiser vos tables en utilisant les types corrects :</p><ul id="r-82275" data-claire-element-id="82275"><li id="r-82266" data-claire-element-id="82266"><p id="r-82265" data-claire-element-id="82265"><strong>un nombre</strong> est de type TINYINT, SMALLINT, MEDIUMINT, INT, BIGINT, FLOAT, DOUBLE ou DECIMAL selon sa précision, et n'oubliez pas d'indiquer sa taille selon vos besoins ;</p></li><li id="r-82268" data-claire-element-id="82268"><p id="r-82267" data-claire-element-id="82267"><strong>un texte</strong> est de type VARCHAR (moins de 256 caractères) ou TEXT (plus de 256 caractères) ;</p></li><li id="r-82270" data-claire-element-id="82270"><p id="r-82269" data-claire-element-id="82269"><strong>une date</strong> est de type DATE pour uniquement la date, TIME pour uniquement l'heure, ou DATETIME pour les deux réunis ;</p></li><li id="r-82272" data-claire-element-id="82272"><p id="r-82271" data-claire-element-id="82271"><strong>un booléen</strong> (VRAI/FAUX) n'a pas de type particulier. On utilise un TINYINT de taille 1 positionné à 0 ou 1 (pas ENUM!) ;</p></li><li id="r-82274" data-claire-element-id="82274"><p id="r-82273" data-claire-element-id="82273"><strong>une suite binaire</strong> est de type BLOB ou BINARY.</p></li></ul><aside id="r-82277" data-claire-element-id="82277" data-claire-semantic="information"><p id="r-82276" data-claire-element-id="82276">Juste après avoir inséré un élément, vous pouvez connaître l'<strong>id auto_increment</strong> qui a été attribué en utilisant <a href="http://be2.php.net/manual/fr/function.mysql-insert-id.php">mysql_insert_id</a>.</p></aside><h2 id="r-telechargements-avec-compteur" data-claire-element-id="82300">Téléchargements avec compteur</h2><p id="r-82279" data-claire-element-id="82279">Le principe est assez simple : on veut permettre aux visiteurs de télécharger un fichier tout en comptant le nombre de téléchargements de celui-ci. Il nous faut bien sûr utiliser la table que vous aurez créée en y ajoutant un champ permettant de mémoriser le nombre de downloads. Il s'agit donc d'un champ de type INT(5), appelé par exemple <em>up_counter</em>. :)</p><p id="r-82280" data-claire-element-id="82280">Imaginons qu'une page référence les différents fichiers (ce que vous savez faire, puisqu'il suffit de lister le contenu de la table ^^ ) avec des liens pour télécharger les fichiers. Ces liens indiquent le numéro d'identification du fichier, par exemple :</p><pre id="r-82281" data-claire-element-id="82281"><code data-claire-semantic="console">download.php?file=25
download.php?file=143
download.php?file=476</code></pre><p id="r-82282" data-claire-element-id="82282">La première chose à faire, c'est de récupérer quelques informations dans la table pour pouvoir les envoyer au visiteur. C'est une simple requête de sélection :</p><pre id="r-82283" data-claire-element-id="82283"><code data-claire-semantic="sql">SELECT up_filename, up_filesize, up_final FROM upfiles WHERE up_id = …</code></pre><p id="r-82284" data-claire-element-id="82284">Bien sûr, les « … » doivent être remplacés par l'id donné par le lien ( <em><strong>$_GET['file']</strong></em> ).</p><aside id="r-82286" data-claire-element-id="82286" data-claire-semantic="warning"><p id="r-82285" data-claire-element-id="82285">Vous devez bien sûr contrôler cette variable avant de l'utiliser pour vérifier qu'elle contient bien un entier, sinon, le visiteur peut injecter du code SQL pour vider votre table, la modifier, etc.</p></aside><p id="r-82287" data-claire-element-id="82287">Vous devez ensuite mettre à jour le nombre de téléchargements. C'est facile, il suffit d'incrémenter un champ de la table :</p><pre id="r-82288" data-claire-element-id="82288"><code data-claire-semantic="sql">UPDATE upfiles SET up_counter = up_counter + 1 WHERE up_id = ...</code></pre><p id="r-82289" data-claire-element-id="82289">Je vais maintenant vous montrer le code qui va servir à envoyer le fichier en le commentant un maximum. Surtout, ne vous contentez pas de le copier, comprenez-le ! Si j'ai évité de vous donner trop de code dans ce tutoriel, c'est pour vous forcer à réfléchir. Le but d'un programmeur ou d'un codeur n'est pas de pouvoir copier un bout de code, c'est de pouvoir l'adapter à ses besoins, produire un code optimisé et juste pour chaque application rencontrée.</p><pre id="r-82290" data-claire-element-id="82290"><code data-claire-semantic="html+php">&lt;?php
/*Après avoir vérifié que le fichier existe (l'id est bien dans la BDD) et
  après avoir sélectionné les informations sur le fichier dans la BDD (dans $bdd_infos) */
 
//Création des headers, pour indiquer au navigateur qu'il s'agit d'un fichier à télécharger
  header('Content-Transfer-Encoding: binary'); //Transfert en binaire (fichier)
  header('Content-Disposition: attachment; filename=&quot;'.$bdd_infos['up_final'].'&quot;'); //Nom du fichier
  header('Content-Length: '.$bdd_infos['up_filesize']); //Taille du fichier
 
//Envoi du fichier dont le chemin est passé en paramètre
  readfile($bdd_infos['up_filename']);
?&gt;</code></pre><p id="r-82291" data-claire-element-id="82291">Le nom du fichier (up_final) correspond au nom que le serveur va proposer au visiteur. Par exemple, si on indique <em>filename=&quot;PD6StdFR6011.exe&quot;</em>, voilà à quoi pourrait ressembler la fenêtre de téléchargement :</p><figure id="r-82293" data-claire-element-id="82294"><img id="r-82292" data-claire-element-id="82292" src="medias/uploads.siteduzero.com_files_99001_100000_99485.png" alt="Image utilisateur"/></figure><p id="r-82295" data-claire-element-id="82295">C'est donc ici que vous pourrez remédier au problème de l'extension (il suffit de l'ajouter au nom de fichier).</p><aside id="r-82297" data-claire-element-id="82297" data-claire-semantic="information"><p id="r-82296" data-claire-element-id="82296">Les <em>headers</em> sont les en-têtes, ce sont les informations que le serveur envoie à votre navigateur <strong>avant</strong> de charger la page. Il ne doit donc y avoir aucune ligne de code XHTML, aucune « sortie » vers le navigateur (donc pas de <em>echo</em>), et rien en dehors du PHP, pas même une espace ou un retour à la ligne. Sinon, PHP renverra une erreur, car il ne peut pas envoyer les en-têtes une fois que la page commence à être chargée ( :) ) . De même, si vous écrivez quelque chose hormis du PHP après les <em>headers</em>, ce quelque chose sera envoyé avec le fichier, et celui-ci sera donc corrompu. Soyez très vigilants.</p></aside><div id="r-82299" data-claire-element-id="82299" data-claire-semantic="question"><p id="r-82298" data-claire-element-id="82298">Une amélioration possible peut être la nécessité d'être identifié pour télécharger un fichier. En effet, puisque c'est PHP qui gère l'envoi du fichier, vous pouvez facilement contrôler avant le script que le visiteur est connecté. De plus, comme PHP accède aux fichiers en local, vous pouvez placer un <em>.htaccess</em> dans le dossier où se trouvent vos fichiers : de cette manière, vous pourrez empêcher les visiteurs d'accéder au fichier sans passer par le script PHP, qui, lui, n'est pas affecté par le <em>.htaccess</em>.</p></div><h2 id="r-creation-de-miniatures" data-claire-element-id="82307">Création de miniatures</h2><p id="r-82301" data-claire-element-id="82301">Je ne vais pas m'attarder sur le sujet. En fait, j'ai simplement remarqué que beaucoup de codeurs inexpérimentés avaient du mal avec la création et la gestion de miniatures. Je vais simplement vous donner quelques conseils, mais je ne vais pas vous donner la fonction pour créer des miniatures, ce n'est pas l'objet de ce tutoriel.</p><p id="r-82302" data-claire-element-id="82302">Une miniature est une image, qui, comme son nom l'indique, permet d'avoir un aperçu en plus petit d'une image trop grande pour être facilement et rapidement affichée. C'est le cas d'une galerie photo, où on affiche sur une page une série de miniatures, chacune donnant accès, par un simple lien, à l'image de taille réelle.</p><p id="r-82303" data-claire-element-id="82303">Une première chose à vérifier, c'est que les miniatures prennent peu de place, aussi bien en taille physique (le nombre de pixels) qu'en poids (le nombre d'octets). Si les miniatures sont trop volumineuses, pensez à réduire la taille ou à diminuer la qualité, sans pour autant la rendre trop floue.</p><p id="r-82304" data-claire-element-id="82304">Ensuite, ne placez pas les miniatures dans le même dossier que les originales, placez-les dans un dossier spécial « miniatures » tout en gardant le même nom que l'image originale de façon à pouvoir facilement l'utiliser. En effet, si vous avez comme nom, pour les deux fichiers, « image112 », il vous suffira de changer le dossier pour pouvoir afficher soit l'une, soit l'autre. Vous n'aurez ainsi besoin que d'un seul champ pour les deux noms dans la BDD ( <em><strong>up_filename</strong></em> ). Par exemple :</p><pre id="r-82305" data-claire-element-id="82305"><code data-claire-semantic="html+php">&lt;?php
//Après avoir récupéré les infos de l'image dans $bdd_infos
echo &quot;&lt;a href='images/uploaded/&quot;.$bdd_infos['up_filename'].&quot;'&gt;&lt;img src='images/miniatures/&quot;.$bdd_infos['up_filename'].&quot;'&gt;&lt;/a&gt;&quot;;
?&gt;</code></pre><p id="r-82306" data-claire-element-id="82306">Pour ce qui est de l'endroit où placer le code pour créer la miniature, c'est bien de le faire juste avant l'insertion des infos du fichier uploadé dans la BDD, sur la page d'upload.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire">Upload de fichiers par formulaire</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/l-upload-c-est-quoi">
L&#039;upload, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/creer-le-formulaire">
Créer le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/recuperer-le-fichier">
Récupérer le fichier
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/et-apres-1">
Et après ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/en-bonus">
En bonus
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/recuperer-le-fichier">
<span class="arrow"></span>
<span class="next">Récupérer le fichier</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/en-bonus">
<span class="next">En bonus</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Enbonus"></a><h2>En bonus</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/et-apres-1">
<span class="arrow"></span>
<span class="next">Et après ?</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-82309" data-claire-element-id="82309">Nous y voilà enfin : nous touchons à la fin de ce tutoriel, qui, je l'espère, vous aura permis de maîtriser un peu mieux certaines facettes de PHP. Mais avant de nous quitter, je tiens à vous offrir une petite fonction ou deux. Vous allez vite comprendre quel en est l'intérêt.</p><h2 id="r-pur-concentre" data-claire-element-id="82315">Pur concentré</h2><p id="r-82310" data-claire-element-id="82310">Pour faciliter l'upload de plusieurs fichiers, cette petite fonction rassemble les tests et déplace le fichier.</p><pre id="r-82311" data-claire-element-id="82311"><code data-claire-semantic="html+php">&lt;?php
function upload($index,$destination,$maxsize=FALSE,$extensions=FALSE)
{
   //Test1: fichier correctement uploadé
     if (!isset($_FILES[$index]) OR $_FILES[$index]['error'] &gt; 0) return FALSE;
   //Test2: taille limite
     if ($maxsize !== FALSE AND $_FILES[$index]['size'] &gt; $maxsize) return FALSE;
   //Test3: extension
     $ext = substr(strrchr($_FILES[$index]['name'],'.'),1);
     if ($extensions !== FALSE AND !in_array($ext,$extensions)) return FALSE;
   //Déplacement
     return move_uploaded_file($_FILES[$index]['tmp_name'],$destination);
}
 
//EXEMPLES
  $upload1 = upload('icone','uploads/monicone1',15360, array('png','gif','jpg','jpeg') );
  $upload2 = upload('mon_fichier','uploads/file112',1048576, FALSE );
 
  if ($upload1) &quot;Upload de l'icone réussi!&lt;br /&gt;&quot;;
  if ($upload2) &quot;Upload du fichier réussi!&lt;br /&gt;&quot;;
?&gt;</code></pre><p id="r-82312" data-claire-element-id="82312">Son utilisation est très simple et permet de gérer facilement une suite de fichiers. On indique en premier paramètre le nom du fichier (c'est le <em><strong>name</strong></em> du formulaire), puis le chemin de destination avec le nom complet du fichier (comme par exemple un nom unique). On peut ensuite indiquer une taille limite (en octets), ou FALSE pour ne pas en fixer. Enfin, on peut préciser dans un tableau les extensions autorisées, ou écrire FALSE si elles sont toutes permises.</p><p id="r-82313" data-claire-element-id="82313">Il est bien sûr possible de faire davantage de choses à partir d'un simple formulaire d'upload, mais avec ce que vous avez appris et compris durant ce tutoriel, vous devriez être capables de faire tout ce que vous souhaitez… ou presque. ^^</p><p id="r-82314" data-claire-element-id="82314">Si toutefois vous avez des questions, n'hésitez pas à venir les poser sur le forum.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire">Upload de fichiers par formulaire</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/l-upload-c-est-quoi">
L&#039;upload, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/creer-le-formulaire">
Créer le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/recuperer-le-fichier">
Récupérer le fichier
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/et-apres-1">
Et après ?
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/en-bonus">
En bonus
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/upload-de-fichiers-par-formulaire/et-apres-1">
<span class="arrow"></span>
<span class="next">Et après ?</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/upload-de-fichiers-par-formulaire.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 22:43:45 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/upload-de-fichiers-par-formulaire.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:59:41 GMT -->
</html>