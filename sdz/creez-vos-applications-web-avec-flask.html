<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/creez-vos-applications-web-avec-flask.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 11:04:48 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/creez-vos-applications-web-avec-flask.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:47:12 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Créez vos applications web avec Flask</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/creez-vos-applications-web-avec-flask.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Créez vos applications web avec Flask</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#CrezvosapplicationswebavecFlask">Créez vos applications web avec Flask</a><br/><a href="#LeWeb">Le Web</a><br/><a href="#Unserveurdesclients">Un serveur, des clients</a><br/><a href="#LeprotocoleHTTP">Le protocole HTTP</a><br/><a href="#Derniresnotions">Dernières notions</a><br/><a href="#PrsentationdeFlask">Présentation de Flask</a><br/><a href="#Prsentation">Présentation</a><br/><a href="#Possibilits">Possibilités</a><br/><a href="#Installationetpremierspas">Installation et premiers pas</a><br/><a href="#Installation">Installation</a><br/><a href="#Premierspas">Premiers pas</a><br/><a href="#RequtesetRponses">Requêtes et Réponses</a><br/><a href="#Lesrequtes">Les requêtes</a><br/><a href="#Lesrponses">Les réponses</a><br/><a href="#Lestemplates">Les templates</a><br/><a href="#Unefaussebonneide...">Une fausse bonne idée...</a><br/><a href="#Lestemplatesctutilisateur">Les templates, côté utilisateur</a><br/><a href="#Lestemplatesctprogammeur">Les templates, côté progammeur</a><br/><a href="#Flash">Flash</a><br/><a href="#L039changededonnes">L&#039;échange de données</a><br/><a href="#Introduction">Introduction</a><br/><a href="#Lesformulaires">Les formulaires</a><br/><a href="#LesQueryString">Les Query String</a><br/><a href="#Lescookies">Les cookies</a><br/><a href="#Lessessions">Les sessions</a><br/><a href="#TPServiceWebd039uploadd039images">[TP] Service Web d&#039;upload d&#039;images</a><br/><a href="#Objectif">Objectif</a><br/><a href="#Solution">Solution</a><br/></div>
<a name="CrezvosapplicationswebavecFlask"></a><h2>Créez vos applications web avec Flask</h2><div class="content" role="article">
<figure id="r-719433" data-claire-element-id="719434"><img id="r-719432" data-claire-element-id="719432" src="medias/uploads.siteduzero.com_files_390001_391000_390565.png" alt="Image utilisateur"/></figure><p id="r-719435" data-claire-element-id="719435">Vous avez appris le Python et aimeriez l’utiliser pour créer votre site web ? C’est possible ! Le langage Python est tout à fait adapté pour cela, et de nombreux frameworks peuvent vous simplifier la tâche. :) <br/> Je vous propose de découvrir l’un d’entre eux, <strong>Flask</strong>, qui a l'avantage d'être très simple à prendre en main.</p><p id="r-719436" data-claire-element-id="719436">Ce tutoriel est accessible aux débutants, mais demande tout de même quelques pré-requis :</p><ul id="r-719441" data-claire-element-id="719441"><li id="r-719438" data-claire-element-id="719438"><p id="r-719437" data-claire-element-id="719437">connaître le langage Python (un tutoriel est disponible <a href="http://www.siteduzero.com/tutoriel-3-223267-apprenez-a-programmer-en-python.html">ici</a>)</p></li><li id="r-719440" data-claire-element-id="719440"><p id="r-719439" data-claire-element-id="719439">connaître les langages HTML et CSS (tutoriel <a href="http://www.siteduzero.com/tutoriel-3-13666-apprenez-a-creer-votre-site-web-avec-html5-et-css3.html">ici</a>). Si vous ne les connaissez pas, vous pouvez néanmoins suivre les 4 premiers chapitres du cours, par curiosité.</p></li></ul><p id="r-719442" data-claire-element-id="719442">Voilà un petit exemple de ce que nous réaliserons durant ce cours :</p><p id="r-719443" data-claire-element-id="719446"><a href="medias/uploads.siteduzero.com_files_386001_387000_386866.png"><img id="r-719446" data-claire-element-id="719445" src="medias/uploads.siteduzero.com_thb_386001_387000_386866.png" alt="Image utilisateur"/></a><a href="medias/uploads.siteduzero.com_files_389001_390000_389059.png"><img id="r-719445" data-claire-element-id="719444" src="medias/uploads.siteduzero.com_thb_389001_390000_389059.png" alt="Image utilisateur"/></a><a href="medias/uploads.siteduzero.com_files_389001_390000_389443.png"><img id="r-719444" data-claire-element-id="719443" src="medias/uploads.siteduzero.com_thb_389001_390000_389443.png" alt="Image utilisateur"/></a></p>
</div>
<div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1358423835269-0" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1358423835269-0');
        });
    }
    </script>
</div><a name="LeWeb"></a><h2>Le Web</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
<span class="next">Un serveur, des clients</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-719448" data-claire-element-id="719448">Avant d’attaquer l’apprentissage de Flask, attardons-nous un peu sur de la théorie : le fonctionnement des sites Web. Cette partie a beau n’être que théorique, elle est néanmoins très importante pour comprendre la suite : ne la négligez pas ! En effet, c’est maintenant que nous allons découvrir des notions que nous utiliserons par la suite grâce à Flask. Ces notions vous seront donc toujours utiles, que vous utilisiez Flask ou autre chose.</p>
</div><a name="Unserveurdesclients"></a><h2>Un serveur, des clients</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">
<span class="arrow"></span>
<span class="next">Le Web</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
<span class="next">Le protocole HTTP</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-un-serveur-des-clients" data-claire-element-id="719463">Un serveur, des clients</h4><p id="r-719449" data-claire-element-id="719449">Pour commencer, disons qu'un site web n'est qu'un simple programme exécuté sur un ordinateur. Quand vous vous rendez sur ce site web, vous êtes ce qu'on appellera un <strong>client</strong>, et l'ordinateur où est exécuté ce site web est appelé le <strong>serveur</strong>.</p><p id="r-719450" data-claire-element-id="719450">Quoi de plus simple qu’un beau schéma pour introduire le concept ? Voici donc un schéma représentant plusieurs clients se connectant à un serveur :</p><figure id="r-719452" data-claire-element-id="719453"><img id="r-719451" data-claire-element-id="719451" src="medias/uploads.siteduzero.com_files_387001_388000_387752.png" alt="Image utilisateur"/></figure><p id="r-719454" data-claire-element-id="719454">Vous noterez que j’ai représenté les clients de la même manière que le serveur : par un ordinateur. En effet, il faut bien comprendre que n’importe quelle machine peut faire office de client ou de serveur. Durant notre apprentissage, nous utiliserons le même ordinateur pour faire les deux : le site web sera donc situé sur votre propre machine. Quand notre site sera prêt, nous pourrons le placer sur un serveur accessible au monde entier. Patience ! :)</p><div id="r-719456" data-claire-element-id="719456" data-claire-semantic="question"><p id="r-719455" data-claire-element-id="719455">Qu’est-ce qui différencie un serveur d’un client dans ton schéma alors ?</p></div><p id="r-719457" data-claire-element-id="719457">Le client et le serveur communiquent ensemble.<br/> Je ne l’ai pas représentée, mais la seule différence, c’est le logiciel utilisé pour la communication entre le client et le serveur. En effet, le client et le serveur n’utilisent pas le même logiciel ! Le client utilise un simple navigateur web (ça, vous devriez connaitre). Quant au serveur, le logiciel qu’il utilise (et qui lui permet de communiquer avec tous les clients en même temps) s’appelle un serveur HTTP.</p><p id="r-719458" data-claire-element-id="719458">J’en profite pour compléter le schéma :</p><figure id="r-719460" data-claire-element-id="719461"><img id="r-719459" data-claire-element-id="719459" src="medias/uploads.siteduzero.com_files_387001_388000_387753.png" alt="Image utilisateur"/></figure><p id="r-719462" data-claire-element-id="719462">Tout comme il existe plusieurs navigateurs web, il existe plusieurs serveurs HTTP. Le plus connu d’entre tous est Apache, mais il en existe de nombreux autres : peut être avez vous entendu parler de nginx, lighttpd, cherokee.<br/> Les serveurs HTTP peuvent évidemment fournir des pages web à plusieurs clients à la fois, et ils peuvent même contenir plusieurs sites web différents.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">
<span class="arrow"></span>
<span class="next">Le Web</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
<span class="next">Le protocole HTTP</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="LeprotocoleHTTP"></a><h2>Le protocole HTTP</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
<span class="arrow"></span>
<span class="next">Un serveur, des clients</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
<span class="next">Dernières notions</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-le-protocole-http" data-claire-element-id="719496">Le protocole HTTP</h4><p id="r-719464" data-claire-element-id="719464">Réintéressons nous à notre schéma : il est encore incomplet. En effet, on a compris que les clients communiquaient avec le serveur, mais on ne sait pas comment. Ils utilisent pour cela le protocole HTTP. Pour simplifier, on pourrait dire que le client demande une page web, et que le serveur la lui renvoie, mais soyons un peu plus précis.</p><h5 id="r-la-requete-1" data-claire-element-id="719475">La requête</h5><p id="r-719465" data-claire-element-id="719465">Quand le client “demande une page web”, en réalité, il envoie au serveur une requête qui contient :</p><ul id="r-719474" data-claire-element-id="719474"><li id="r-719467" data-claire-element-id="719467"><p id="r-719466" data-claire-element-id="719466">le <strong>chemin</strong> vers la page web demandée, évidemment</p></li><li id="r-719469" data-claire-element-id="719469"><p id="r-719468" data-claire-element-id="719468">un <strong>type</strong>. Les deux principaux sont GET et POST. Le type de requête POST est utilisé quand on valide un formulaire sur une page web. Le reste du temps, le type est GET.</p></li><li id="r-719471" data-claire-element-id="719471"><p id="r-719470" data-claire-element-id="719470">quelques informations (sur le type de navigateur notamment)</p></li><li id="r-719473" data-claire-element-id="719473"><p id="r-719472" data-claire-element-id="719472">et éventuellement, des données. Par exemple quand le visiteur valide un formulaire, il envoie les données remplies dans la requête POST. Mais on peut également envoyer des données avec une requête GET.</p></li></ul><h5 id="r-la-reponse-1" data-claire-element-id="719495">La réponse</h5><p id="r-719476" data-claire-element-id="719476">Lorsque le serveur lui répond, il renvoie bien évidemment la page demandée, mais pas seulement ! Il renvoie aussi le type de la page renvoyée, appelé le <strong>mimetype</strong> (généralement, ce mimetype indique que la page est une page normale, contenant du HTML. Mais parfois, on souhaite renvoyer autre chose : une image, un fichier .doc, un pdf...), et il renvoie également qu'un <strong>code d’erreur</strong>. Par exemple, quand la page demandée est introuvable, on a le fameux code d’erreur <strong>404</strong>. Mais il en existe de nombreux autres :</p><ul id="r-719485" data-claire-element-id="719485"><li id="r-719478" data-claire-element-id="719478"><p id="r-719477" data-claire-element-id="719477">L'erreur 500 désigne une erreur survenue sur le serveur (il faut espérer ne pas l’avoir, celle là ;) )</p></li><li id="r-719480" data-claire-element-id="719480"><p id="r-719479" data-claire-element-id="719479">L'erreur 401 désigne que l'accès à cette page web n'est pas autorisé</p></li><li id="r-719482" data-claire-element-id="719482"><p id="r-719481" data-claire-element-id="719481">L'erreur 400 signifie que la requête du client est mal formée (par exemple s'il n'envoie pas toutes les données d'un formulaire)</p></li><li id="r-719484" data-claire-element-id="719484"><p id="r-719483" data-claire-element-id="719483">L'erreur 200 signifie que... tout s’est bien passé</p></li></ul><p id="r-719486" data-claire-element-id="719486">Eh oui, quand tout se passe bien et que l’on renvoie la page au client, on précise quand même le code d’erreur.</p><p id="r-719487" data-claire-element-id="719487">On peut donc finaliser notre schéma :</p><figure id="r-719489" data-claire-element-id="719490"><img id="r-719488" data-claire-element-id="719488" src="medias/uploads.siteduzero.com_files_387001_388000_387755.png" alt="Image utilisateur"/></figure><div id="r-719492" data-claire-element-id="719492" data-claire-semantic="question"><p id="r-719491" data-claire-element-id="719491">Tout ça c’est bien beau, on sait comment client et serveur communiquent, mais dans tout ça, où est notre site web ?</p></div><p id="r-719493" data-claire-element-id="719493">Eh bien, pour y accéder, on utilisera un navigateur, peu importe lequel. Et pour exécuter notre site web, où plutôt, pour le propulser (oui j'aime bien ce terme ;) ), on utilisera un serveur HTTP. Il nous faudrait donc installer apache, par exemple. Mais en réalité, cela ne suffirait pas. Hé oui, je ne vous l’avais pas dit, mais les serveurs HTTP ne savent pas interpréter le Python ! Il nous faut donc ajouter à notre serveur HTTP un module pour rendre possible l’utilisation de Python, et donc de Flask. Je précise que ce problème est le même pour utiliser PHP ou Java : à chaque fois, il faut un module spécifique.<br/> Il y a plusieurs façons d’intégrer Python dans un serveur web. Pour faire court, sachez qu’il existe une norme appelée <strong>WSGI</strong>, que Flask respecte cette norme, et qu’il existe des modules pour les principaux serveurs HTTP leurs permettant de désservir des sites web en Python respectant la norme WSGI. Pour apache, il existe le module mod_wsgi.<br/> Une fois que tout est bien installé, il ne reste plus qu'à configurer le serveur pour qu'il déserve notre code Python.</p><p id="r-719494" data-claire-element-id="719494">Enfin, tout ça, c’était pour votre culture, parce que dans tout ce tutoriel, nous allons utiliser le serveur HTTP + WSGI pré-intégré à Flask ! Autrement dit, nous allons exécuter notre programme Python comme n'import quel autre programme, et automatiquement, le serveur HTTP + WSGI intégré sera lancé, propulsera votre site web, et vous pourrez y accéder immédiatement ! :)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
<span class="arrow"></span>
<span class="next">Un serveur, des clients</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
<span class="next">Dernières notions</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Derniresnotions"></a><h2>Dernières notions</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
<span class="arrow"></span>
<span class="next">Le protocole HTTP</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">
<span class="next">Présentation de Flask</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-dernieres-notions" data-claire-element-id="719514">Dernières notions</h4><p id="r-719497" data-claire-element-id="719497">Nous avons vu que notre navigateur web envoyait des requêtes HTTP aux serveurs HTTP. Intéressons nous au lien qu'il existe entre cette requête et l’adresse que nous entrons dans notre navigateur web pour accéder à une page web. Prenons l’exemple de cet adresse :</p><p id="r-719498" data-claire-element-id="719498"><cite>Citation</cite></p><blockquote id="r-719500" data-claire-element-id="719500"><p id="r-719499" data-claire-element-id="719499"><strong>http://<a href="http://www.siteduzero.com/">www.siteduzero.com</a>/forum-81-407-langage-python.html</strong></p></blockquote><ul id="r-719507" data-claire-element-id="719507"><li id="r-719502" data-claire-element-id="719502"><p id="r-719501" data-claire-element-id="719501">le <strong>protocole</strong> est toujours http puisqu'on envoie cette requête à un serveur HTTP.</p></li><li id="r-719504" data-claire-element-id="719504"><p id="r-719503" data-claire-element-id="719503"><a href="http://www.siteduzero.com/">www.siteduzero.com</a> : c’est ce qu’on appelle le <strong>nom de domaine</strong></p></li><li id="r-719506" data-claire-element-id="719506"><p id="r-719505" data-claire-element-id="719505">/forum-81-407-langage-python.html : ceci est le <strong>chemin</strong> de la page web demandée, aussi appelé &quot;route&quot;. Il s'agit du même chemin que celui présent dans la requête HTTP !</p></li></ul><p id="r-719508" data-claire-element-id="719508">Dans tout le tutoriel, le serveur HTTP sera notre propre ordinateur.<br/> Le nom de domaine de notre propre ordinateur est appelé <strong>localhost</strong> par convention. Pour accéder à la page appelée “/unepage”, nous devrons donc entrer dans notre navigateur : <a href="http://localhost/unepage">http://localhost/unepage</a><br/> Un dernier petit détail : un serveur HTTP peut fonctionner sur différent <strong>ports</strong>. Par défaut, le serveur HTTP intégré à Flask fonctionne sur le port 5000, il faut donc le préciser dans l’adresse du navigateur : <a href="http://localhost:5000/unepage">http://localhost:5000/unepage</a></p><div id="r-719510" data-claire-element-id="719510" data-claire-semantic="question"><p id="r-719509" data-claire-element-id="719509">Mais d'habitude on n'indique jamais de numéro de port ?</p></div><p id="r-719511" data-claire-element-id="719511">Si on ne précise pas de numéro de port, le navigateur va aller automatiquement sur le port 80. Or, c'est sur le port 80 que fonctionnent la plupart des serveurs HTTP. Celui intégré à Flask ne fonctionne pas sur ce port car il s'agit d'un serveur HTTP destiné uniquement au développement de votre site web, il ne doit pas être utilisé quand celui-ci est terminé et diffusé sur Internet.</p><p id="r-719512" data-claire-element-id="719512">Voilà, vous devriez en savoir désormais assez pour passer au second chapitre... Mais vérifions tout cela dans notre premier QCM ! :)</p><p id="r-719513" data-claire-element-id="719513">J'espère que vous avez décroché un 20/20 au QCM car dans la suite, toutes ces notions devront être maîtrisées afin que vous puissiez utiliser Flask sans encombre. ;)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
<span class="arrow"></span>
<span class="next">Le protocole HTTP</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">
<span class="next">Présentation de Flask</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="PrsentationdeFlask"></a><h2>Présentation de Flask</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
<span class="arrow"></span>
<span class="next">Dernières notions</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
<span class="next">Présentation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-719516" data-claire-element-id="719516">Après la découverte des notions nécessaires dans le chapitre précédent, nous allons enfin nous concentrer sur Flask. Ce chapitre à pour but d'en faire la présentation.</p>
</div><a name="Prsentation"></a><h2>Présentation</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">
<span class="arrow"></span>
<span class="next">Présentation de Flask</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
<span class="next">Possibilités</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-presentation-16" data-claire-element-id="719542">Présentation</h4><p id="r-719517" data-claire-element-id="719517">Flask, je l’ai dit, est un <strong>framework web</strong>, ou plutôt, un micro-framework. Ce “micro” signifie simplement que Flask ne fait pas <em>tout</em>. Cela signifie aussi que pour en faire plus que ce qu’il permet de base, il faudra installer des extensions. Heureusement, celles-ci sont nombreuses, de qualité, et très bien intégrées, je vous en présenterai d’ailleurs quelques unes en temps voulu.</p><aside id="r-719519" data-claire-element-id="719519" data-claire-semantic="information"><p id="r-719518" data-claire-element-id="719518">Ce tutoriel présentera Flask dans sa version la plus récente : 0.9.</p></aside><p id="r-719520" data-claire-element-id="719520">Si vous ne savez pas ce qu’est un framework, dites vous simplement que Flask est un ensemble de modules qui vont vous faciliter la programmation de sites web dynamiques. Dans l’absolu, vous pourriez vous débrouiller sans framework ! En effet, il suffit que votre application suive la norme WSGI. Voilà un exemple d’une application extrêmement basique réalisée sans framework, simplement en respectant cette norme :</p><pre id="r-719521" data-claire-element-id="719521"><code data-claire-semantic="python">#!/usr/bin/env python
# -*- coding:utf-8 -*-

import re
from cgi import escape

def index(environ, start_response):
    &quot;&quot;&quot; Page d'accueil accessible à '/'
       Affiche simplement une phrase. &quot;&quot;&quot;
    start_response('200 OK', [('Content-Type', 'text/html')])
    return [&quot;Ceci est la page d'accueil.&quot;]

def hello(environ, start_response):
    &quot;&quot;&quot; Page accessible à la route '/hello/'
       Affiche la phrase que l'utilisateur a passée en paramètre. &quot;&quot;&quot;
    # recupère la phrase depuis l'url si elle a été spécifiée
    # Sinon, affiche Hello World.
    args = environ['myapp.url_args']
    if args:
       phrase = escape(args[0])
    else:
       phrase = 'Hello World'
    start_response('200 OK', [('Content-Type', 'text/html')])
    return [phrase]

def not_found(environ, start_response):
    &quot;&quot;&quot; Appelée si l'adresse est inconnue. &quot;&quot;&quot;
    start_response('404 NOT FOUND', [('Content-Type', 'text/plain')])
    return ['Not Found']

# associe les adresses aux fonctions
urls = [
    (r'^$', index),
    (r'hello/?$', hello),
    (r'hello/(.+)$', hello)
]

def application(environ, start_response):
    &quot;&quot;&quot; Dispatche les requêtes aux fonctions précédentes. &quot;&quot;&quot;
    path = environ.get('PATH_INFO', '').lstrip('/')
    for regex, callback in urls:
       match = re.search(regex, path)
       if match is not None:
           environ['myapp.url_args'] = match.groups()
           return callback(environ, start_response)
    return not_found(environ, start_response)</code></pre><p id="r-719522" data-claire-element-id="719522">Comme vous le voyez, le code est long et complexe, et son organisation n’est pas évidente. Pourtant, tout cela représente finalement peu de choses : cela crée un site web qui dispose de deux pages :</p><ul id="r-719534" data-claire-element-id="719534"><li id="r-719524" data-claire-element-id="719524"><p id="r-719523" data-claire-element-id="719523">la page d’accueil, dont le chemin (la route) est ‘/’, et qui se contente d’afficher un message prédéfini.</p></li><li id="r-719526" data-claire-element-id="719526"><p id="r-719525" data-claire-element-id="719525">la page ‘/hello’, qui affiche “Hello World” si on ne lui précise rien, ou qui affiche ce qu’on lui passe en paramètre. Exemple :</p></li><ul id="r-719531" data-claire-element-id="719531"><li id="r-719528" data-claire-element-id="719528"><p id="r-719527" data-claire-element-id="719527">‘/hello/coucou’ affichera “coucou”</p></li><li id="r-719530" data-claire-element-id="719530"><p id="r-719529" data-claire-element-id="719529">‘/hello/Bienvenue sur mon site !’ affichera “Bienvenue sur mon site !”</p></li></ul><li id="r-719533" data-claire-element-id="719533"><p id="r-719532" data-claire-element-id="719532">Si la page demandée ne correspond à aucune route existante, on renvoie une erreur 404.</p></li></ul><p id="r-719535" data-claire-element-id="719535">Vous voyez donc qu’écrire un site web sans framework peut se révéler extrêmement fastidieux... Je vous propose de voir comment on peut obtenir la même application avec Flask. Vous allez voir, c’est tout de suite beaucoup plus digeste ! :)</p><pre id="r-719536" data-claire-element-id="719536"><code data-claire-semantic="python">#!/usr/bin/env python
# -*- coding:utf-8 -*-

from flask import Flask
app = Flask(__name__)

@app.route('/')
def index():
   return &quot;Ceci est la page d'accueil.&quot;
   
@app.route('/hello/&lt;phrase&gt;')
def hello(phrase):
   return phrase</code></pre><p id="r-719537" data-claire-element-id="719537"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/1-2/">'/'</a> ; <a href="http://tutoflask.fspot.org/1-2/hello/test">'/hello/test'</a> ; <a href="http://tutoflask.fspot.org/1-2/hello/this is a test">'/hello/this is a test'</a></strong></p><p id="r-719538" data-claire-element-id="719538"></p><aside id="r-719540" data-claire-element-id="719540" data-claire-semantic="information"><p id="r-719539" data-claire-element-id="719539">Dans la suite du tutoriel, quand cela sera approprié, je vous proposerais d'essayer ce code en cliquant sur des liens, à l'instar de ceux que je viens de placer.<br/> Cependant, il faut bien comprendre que les adresses réelles des pages ne seront pas forcément celles du lien : en effet, au cours du tutoriel, je risque de souvent réutiliser les mêmes noms de pages. Cela n'est qu'un détail, n'y prêtez pas attention.</p></aside><p id="r-719541" data-claire-element-id="719541">Là le code est beaucoup plus court et plus lisible, on distingue bien nos deux pages, la page d’erreur est automatiquement générée, bref, il n’y a pas photo : c’est bien plus simple.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">
<span class="arrow"></span>
<span class="next">Présentation de Flask</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
<span class="next">Possibilités</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Possibilits"></a><h2>Possibilités</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
<span class="arrow"></span>
<span class="next">Présentation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">
<span class="next">Installation et premiers pas</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-possibilites" data-claire-element-id="719552">Possibilités</h4><div id="r-719544" data-claire-element-id="719544" data-claire-semantic="question"><p id="r-719543" data-claire-element-id="719543">Tout ça c’est bien joli, mais qu’est-ce qu’on peut faire de réellement utile avec Flask ?</p></div><p id="r-719545" data-claire-element-id="719545">Comme je l’ai dit, vous pouvez réaliser des sites web <strong>dynamiques</strong>. Cela signifie que le contenu de votre site ne sera pas figé, par opposition aux sites statiques. Un site statique est suffisant pour, par exemple, faire la description d’un projet. Mais dès que l’on veut personnaliser la page en fonction du visiteur ou de ses actions, il faut faire un site dynamique.<br/> Un site dynamique permet la participation des visiteurs. Par exemple, les blogs, les forums, les réseaux sociaux, les chats, les webmails, sont des sites dynamiques.</p><p id="r-719546" data-claire-element-id="719546">Le petit exemple que l’on a vu, aussi inutile soit il, est bien un exemple de site dynamique ! En effet, la page située au chemin '/hello' affiche un message qui n’est pas figé, il dépend du visiteur. :)</p><p id="r-719547" data-claire-element-id="719547">À la fin de ce cours, vous serez donc en capacité de réaliser toutes sortes de sites dynamiques. Tout ce que vous avez à faire est de lire les chapitres dans l’ordre. Au passage, étant donné que Flask n’est qu’un module Python parmi d’autres, une fois que vous le connaîtrez, vous pourrez ajouter une interface web à vos programmes grâce à lui, ou bien interagir avec d’autres modules Python dans votre site web !</p><h5 id="r-la-concurrence" data-claire-element-id="719551">La concurrence</h5><p id="r-719548" data-claire-element-id="719548">Avant de vous laisser face au QCM, je me dois de vous parler de la concurrence. En effet, Flask est loin d’être le seul framework web en Python. Il en existe de nombreux : Django, Pyramid, Pylons, Tornado, Bottle, Cherrypy, Web2Py, Web.py, et beaucoup d’autres.</p><p id="r-719549" data-claire-element-id="719549">Pourquoi donc choisiriez vous Flask ? Je n’ai pas de réponse toute faite, cela dépend évidemment des goûts de chacun. Ce qui est certain, c’est que Flask, contrairement à Django (qui est un très gros framework), ne réinvente pas la roue : il utilise d’autres modules existants en tant qu’extensions, ce qui pourra vous être utile si jamais vous désiriez un jour utiliser ces modules en dehors de Flask. Flask est également beaucoup plus simple que Django à appréhender, comme vous avez pu le voir avec l’exemple de code donné précédemment, tenant en quelques lignes d’un fichier.</p><p id="r-719550" data-claire-element-id="719550">Ce court chapitre d’introduction est terminé, j’espère qu’il vous donnera envie d’apprendre à utiliser Flask :) . Si c’est le cas, direction le chapitre suivant, où on attaque les choses sérieuses : installation de Flask et réalisation d’un premier site web ! :pirate:</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
<span class="arrow"></span>
<span class="next">Présentation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">
<span class="next">Installation et premiers pas</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Installationetpremierspas"></a><h2>Installation et premiers pas</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
<span class="arrow"></span>
<span class="next">Possibilités</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
<span class="next">Installation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-719554" data-claire-element-id="719554">Dans ce chapitre, les choses sérieuses commencent, puisqu’on va installer Flask, créer un premier site (simplifié à l’extrême), et comprendre son fonctionnement.</p>
</div><a name="Installation"></a><h2>Installation</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">
<span class="arrow"></span>
<span class="next">Installation et premiers pas</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
<span class="next">Premiers pas</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-installation-109" data-claire-element-id="719582">Installation</h4><p id="r-719555" data-claire-element-id="719555">Nous allons installer Flask à l’aide de la commande <code data-claire-semantic="console">pip</code>, qui simplifie beaucoup de choses. En plus de cela il nous faut bien évidemment Python (version 2.7, Flask ne supporte pas encore Python 3, mais ne vous inquiétez pas, vous ne constaterez aucune différence).</p><h5 id="r-sous-linux-27" data-claire-element-id="719558">Sous Linux</h5><p id="r-719556" data-claire-element-id="719556">L'installation de paquets est toujours aussi simple (exemple avec ubuntu):</p><pre id="r-719557" data-claire-element-id="719557"><code data-claire-semantic="console">sudo apt-get install python python-pip
sudo pip install flask</code></pre><h5 id="r-sous-windows-45" data-claire-element-id="719578">Sous Windows</h5><p id="r-719559" data-claire-element-id="719559">Python 2.7 est téléchargeable <a href="http://www.python.org/download/">sur le site officiel</a> (choisissez Python 2.7.3 Windows Installer, la version 32 bits). Installez le si ce n'est pas déjà fait.<br/> Puis, téléchargez <a href="http://python-distribute.org/distribute_setup.py">ce fichier</a> (il s'agit d'un bête script Python) et exécutez le (par un double clic). Une console devrait s'ouvrir, afficher quelques messages, télécharger un fichier, et se refermer. Parfait, vous venez d'installer easy_install, qui est l'ancêtre de pip.<br/> Ensuite il faut ajouter easy_install à la variable PATH pour que Windows sache où trouver ce programme.</p><ul id="r-719574" data-claire-element-id="719574"><li id="r-719561" data-claire-element-id="719561"><p id="r-719560" data-claire-element-id="719560">Menu Démarrer</p></li><li id="r-719563" data-claire-element-id="719563"><p id="r-719562" data-claire-element-id="719562">Clic droit sur <strong>Ordinateur</strong> ⇒ <strong>Propriétés</strong></p></li><li id="r-719565" data-claire-element-id="719565"><p id="r-719564" data-claire-element-id="719564">Dans la nouvelle fenêtre, clic sur <strong>Paramètres Systèmes avancés</strong>(sous Windows XP, clic sur l’onglet <em>avancé</em> à la place)</p></li><li id="r-719567" data-claire-element-id="719567"><p id="r-719566" data-claire-element-id="719566">Clic sur “<strong>variables d’environnements</strong>”</p></li><li id="r-719569" data-claire-element-id="719569"><p id="r-719568" data-claire-element-id="719568">Dans la section “<strong>Variables systèmes</strong>”, double clic sur “<strong>Path</strong>”</p></li><li id="r-719571" data-claire-element-id="719571"><p id="r-719570" data-claire-element-id="719570">Ajoutez ;C:\Python27\Scripts à la fin de cette ligne (vérifiez quand même que le dossier C:\Python27\Scripts existe)</p></li><li id="r-719573" data-claire-element-id="719573"><p id="r-719572" data-claire-element-id="719572">Puis, lancez une invite de commande (<code data-claire-semantic="python">cmd</code>) et entrez les commandes suivantes :</p></li></ul><pre id="r-719575" data-claire-element-id="719575"><code data-claire-semantic="console">easy_install pip
pip install flask</code></pre><aside id="r-719577" data-claire-element-id="719577" data-claire-semantic="information"><p id="r-719576" data-claire-element-id="719576">Si la seule commande à poser problème est <code data-claire-semantic="console">pip install flask</code>, vous pouvez essayer <code data-claire-semantic="console">easy_install flask</code>.</p></aside><h5 id="r-sous-mac-os-x-9" data-claire-element-id="719581">Sous Mac OS X</h5><p id="r-719579" data-claire-element-id="719579">Python 2.7 est téléchargeable <a href="http://www.python.org/download/">ici</a>.<br/> Puis, exécutez ces commandes dans une console :</p><pre id="r-719580" data-claire-element-id="719580"><code data-claire-semantic="console">curl -O http://python-distribute.org/distribute_setup.py
python distribute_setup.py
easy_install pip
pip install flask</code></pre>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">
<span class="arrow"></span>
<span class="next">Installation et premiers pas</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
<span class="next">Premiers pas</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Premierspas"></a><h2>Premiers pas</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
<span class="arrow"></span>
<span class="next">Installation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">
<span class="next">Requêtes et Réponses</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-premiers-pas-21" data-claire-element-id="719635">Premiers pas</h4><p id="r-719583" data-claire-element-id="719583">Vous disposez maintenant du module Flask. Il est temps de créer notre premier projet !<br/> Créez donc un dossier où nous pourrons placer tout le nécessaire. Certes, dans un premier temps, il n’y aura qu’un seul fichier dans ce dossier, mais c’est une bonne habitude à prendre pour la suite !</p><p id="r-719584" data-claire-element-id="719584">Dans ce dossier, créez un fichier nommé hello.py qui contiendra ce code :</p><pre id="r-719585" data-claire-element-id="719585"><code data-claire-semantic="python">#! /usr/bin/python
# -*- coding:utf-8 -*-

from flask import Flask
app = Flask(__name__)

@app.route('/')
def index():
    return &quot;Hello !&quot;

if __name__ == '__main__':
    app.run(debug=True)</code></pre><p id="r-719586" data-claire-element-id="719586"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/1-3/">'/'</a></strong></p><p id="r-719587" data-claire-element-id="719587">Puis exécutez ce code (à l’aide d’un simple <code data-claire-semantic="console">python hello.py</code> en console), ouvrez votre navigateur web, et rendez vous à l’adresse <a href="http://localhost:5000/">http://localhost:5000</a>. Et là, sous vos yeux ébahis, un magnifique <code data-claire-semantic="python">“Hello !”</code> devrait apparaître : félicitations, votre tout premier site web est terminé ! :)</p><h5 id="r-un-peu-d-explications" data-claire-element-id="719610">Un peu d’explications</h5><p id="r-719588" data-claire-element-id="719588">Ligne 4, on importe la classe Flask depuis le module flask, et on s’en sert ligne 5 pour instancier l’objet <code data-claire-semantic="python">app</code>. Cet objet est <strong>fondamental</strong> : il s’agit de notre application, ou de notre site web, si vous préférez. En termes techniques, il s’agit d’une application WSGI... vous vous souvenez, la chose horrible dans le chapitre précédent. Eh bien l’objet app contient toutes ces choses horribles et nous dispense de nous en charger. :D <br/> Lors de l’instanciation de app, vous noterez qu’on lui passe en paramètre <code data-claire-semantic="python">__name__</code> (qui vaut <code data-claire-semantic="python">'__main__'</code> dans ce cas). Ce paramètre est utile lorsque l’on a plusieurs applications WSGI, mais dans notre cas ce n’est qu’un détail, on ne s’en souciera pas.</p><p id="r-719589" data-claire-element-id="719589">Voyons maintenant la fin du code : ligne 12, on lance notre application en mode debug, qui nous aidera à détecter les erreurs dans notre code. Le mode debug nous offre un second avantage : essayer de modifier ce fichier (par exemple, faites afficher <code data-claire-semantic="python">“Coucou”</code> au lieu de <code data-claire-semantic="python">“Hello !”</code>), sauvegardez le, et actualisez la page dans votre navigateur web : le site a été mis à jour sans besoin de relancer le programme avec <code data-claire-semantic="console">python hello.py</code>. Le mode debug est donc bien pratique pour développer, mais à ne surtout par laisser quand votre site sera disponible sur Internet.</p><p id="r-719590" data-claire-element-id="719590">Une autre manière d'activer le mode debug aurait été d'écrire (juste après la ligne 5 par exemple) :</p><pre id="r-719591" data-claire-element-id="719591"><code data-claire-semantic="python">app.debug = True</code></pre><p id="r-719592" data-claire-element-id="719592">Cela revient au même : l'objet <code data-claire-semantic="python">app</code> est configurable. On peut par exemple lui configurer sa clé secrète (qui sera indispensable pour sécuriser les sessions des visiteurs, mais nous n'en sommes pas encore là). Il suffit de faire :</p><pre id="r-719593" data-claire-element-id="719593"><code data-claire-semantic="python">app.secret_key = '2d9-E2.)f&amp;é,A$p@fpa+zSU03êû9_'</code></pre><p id="r-719594" data-claire-element-id="719594">Faites cela de votre côté et gardez votre clé bien secrète.</p><p id="r-719595" data-claire-element-id="719595">Revenons à la ligne 12 de notre code. Lorsque l'on appelle la méthode <code data-claire-semantic="python">run()</code> de <code data-claire-semantic="python">app</code>, le serveur HTTP + WSGI de Flask est automatiquement lancé.</p><p id="r-719596" data-claire-element-id="719596">Mais le coeur du code, c’est la fonction <code data-claire-semantic="python">index</code>, c’est elle qui se charge de renvoyer <code data-claire-semantic="python">“Hello !”</code>. Vous remarquerez qu’on a décoré cette fonction avec le décorateur <code data-claire-semantic="python">@app.route</code> qui prend en paramètre une route. Cette route est celle par laquelle notre fonction sera accessible.<br/> La route <code data-claire-semantic="python">‘/’</code> est spéciale puisqu’elle représente la racine du site web. Il n’est donc pas besoin de la préciser dans l'adresse du navigateur. Comme ce concept est important, voici quelques exemples :</p><ul id="r-719605" data-claire-element-id="719605"><li id="r-719598" data-claire-element-id="719598"><p id="r-719597" data-claire-element-id="719597">si l'adresse est <strong>siteduzero.com →</strong> la route est <strong>/</strong></p></li><li id="r-719600" data-claire-element-id="719600"><p id="r-719599" data-claire-element-id="719599"><strong>siteduzero.com/ → /</strong></p></li><li id="r-719602" data-claire-element-id="719602"><p id="r-719601" data-claire-element-id="719601"><strong>siteduzero.com/forum/ → /forum/</strong></p></li><li id="r-719604" data-claire-element-id="719604"><p id="r-719603" data-claire-element-id="719603"><strong>siteduzero.com/forum/python → /forum/python</strong></p></li></ul><aside id="r-719607" data-claire-element-id="719607" data-claire-semantic="information"><p id="r-719606" data-claire-element-id="719606">J’ai appelé cette fonction “index”, mais son nom importe peu : changez le et vous verrez que tout reste identique. A quoi donc sert le nom de cette fonction ? Elle vous sert à vous, à vous souvenir de son rôle.</p></aside><aside id="r-719609" data-claire-element-id="719609" data-claire-semantic="information"><p id="r-719608" data-claire-element-id="719608">Dans le jargon, pour désigner une fonction qui renvoie une page web, on utilise le mot <strong>vue</strong>. Par conséquent, chaque fonction décorée par <code data-claire-semantic="python">@app.route</code> est une <strong>vue</strong>.</p></aside><h5 id="r-jouons-un-peu-avec-ce-code" data-claire-element-id="719617">Jouons un peu avec ce code</h5><p id="r-719611" data-claire-element-id="719611">Faisons quelques tests pour voir si les routes fonctionnent comme on s’y attend : créons de nouvelles pages !<br/> Créons une page <code data-claire-semantic="python">‘/contact’</code> qui affiche quelques informations pour nous contacter (mail, téléphone) :</p><pre id="r-719612" data-claire-element-id="719612"><code data-claire-semantic="python">@app.route('/contact')
def contact():
    mail = &quot;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="d2b8b7b3bc92b0bdbcfcb4a0">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&quot;
    tel = &quot;01 23 45 67 89&quot;
    return &quot;Mail: {} --- Tel: {}&quot;.format(mail, tel)</code></pre><p id="r-719613" data-claire-element-id="719613"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/1-3/contact">'/contact'</a></strong></p><p id="r-719614" data-claire-element-id="719614">Ajoutez ce code à votre fichier, sauvegardez, et rendez vous à l'adresse <a href="http://localhost:5000/contact">http://localhost:5000/contact</a>. Tout fonctionne bien. Maintenant, essayer de vous rendre à l'adresse <a href="http://localhost:5000/contact/">http://localhost:5000/contact/</a> (la même qu'auparavant, mais avec un slash à la fin !).<br/> On obtient une erreur 404. :colere2: <br/> Cela est normal car la route vers la fonction contact est <code data-claire-semantic="python">'/contact'</code>, sans slash à la fin. Si on rajoute un slash à la fin de cette route, cela fonctionnera. Essayez, remplacez <code data-claire-semantic="python">@app.route('/contact')</code> par <code data-claire-semantic="python">@app.route('/contact/')</code>.<br/> Vous pouvez constater que si vous mettez le slash à la fin de l'adresse, cela fonctionne, et même mieux, si vous oubliez d'entrer le slash, il est automatiquement rajouté, plus d'erreur 404 !</p><aside id="r-719616" data-claire-element-id="719616" data-claire-semantic="warning"><p id="r-719615" data-claire-element-id="719615">Souvenez vous bien de cela, ou vous risquez de retomber sur des erreurs 404 inattendues : Flask peut rajouter un slash manquant, mais pas enlever un slash en trop ! Il s'agit du même fonctionnement pour naviguer dans ses dossiers sous Unix.</p></aside><h5 id="r-le-debugger-en-action" data-claire-element-id="719634">Le debugger en action</h5><p id="r-719618" data-claire-element-id="719618">Profitons de la <strong>vue</strong><code data-claire-semantic="python">contact</code> pour tester le debugger. Introduisons une erreur dans ce code. Par exemple, comme cela :</p><pre id="r-719619" data-claire-element-id="719619"><code data-claire-semantic="python">@app.route('/contact/')
def contact():
    # mail = &quot;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="214b44404f61434e4f0f4753">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&quot;
    tel = &quot;01 23 45 67 89&quot;
    return &quot;Mail: {} --- Tel: {}&quot;.format(mail, tel)</code></pre><p id="r-719620" data-claire-element-id="719620">La variable <code data-claire-semantic="python">mail</code> est désormais inconnue. Regardons ce qui se passe si l'on tente de se rendre à la page <code data-claire-semantic="python">'/contact/'</code> :</p><p id="r-719621" data-claire-element-id="719622"><a href="medias/uploads.siteduzero.com_files_387001_388000_387798.png"><img id="r-719622" data-claire-element-id="719621" src="medias/uploads.siteduzero.com_thb_387001_388000_387798.png" alt="Image utilisateur"/></a>Cette page d'erreur est généré par le debugger intégré à Flask (que l'on a activé grâce à <code data-claire-semantic="python">debug=True</code>, je vous rappelle). J'ai indiqué par 3 symboles rouges les détails importants :</p><ul id="r-719629" data-claire-element-id="719629"><li id="r-719624" data-claire-element-id="719624"><p id="r-719623" data-claire-element-id="719623">En haut à gauche, la description de l'erreur</p></li><li id="r-719626" data-claire-element-id="719626"><p id="r-719625" data-claire-element-id="719625">En bas à droite, une icone noire pour activer le terminal</p></li><li id="r-719628" data-claire-element-id="719628"><p id="r-719627" data-claire-element-id="719627">Une fois le terminal activé, en bas à gauche, vous pouvez saisir des commandes python qui seront exécutées à l'endroit du code choisi !</p></li></ul><aside id="r-719631" data-claire-element-id="719631" data-claire-semantic="information"><p id="r-719630" data-claire-element-id="719630">Une commande particulièrement pratique intégrée au debugger est <code data-claire-semantic="python">dump(objet)</code>. En entrant cela (il faut bien évidemment remplacer &quot;objet&quot; par le nom de l'objet que vous voulez étudier), un tableau s'affiche, contenant tous les attributs et méthodes de votre objet.</p></aside><p id="r-719632" data-claire-element-id="719632">Une petite question pour voir ceux qui suivent : à votre avis, que se serait-il passé si on n'avait pas activé le debugger ?<br/>On aurait eu une erreur 500 :euh:</p><p id="r-719633" data-claire-element-id="719633">conclu install</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
<span class="arrow"></span>
<span class="next">Installation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">
<span class="next">Requêtes et Réponses</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="RequtesetRponses"></a><h2>Requêtes et Réponses</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
<span class="arrow"></span>
<span class="next">Premiers pas</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
<span class="next">Les requêtes</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-719639" data-claire-element-id="719639">J'espère que vos souvenirs du premier chapitre sur le Web sont encore frais ! En effet dans cette partie nous allons voir comment Flask, à sa manière, manipule les requêtes et les réponses HTTP.<br/> Si vous avez déjà oublié qu'une requête HTTP est envoyée par le navigateur au serveur HTTP, ou ce que sont les types GET et POST, ou qu'une réponse possède toujours un code d'erreur, je vous invite à relire avec attention le premier chapitre de ce cours ! ;)</p>
</div><a name="Lesrequtes"></a><h2>Les requêtes</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">
<span class="arrow"></span>
<span class="next">Requêtes et Réponses</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
<span class="next">Les réponses</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-requetes-4" data-claire-element-id="719704">Les requêtes</h4><p id="r-719640" data-claire-element-id="719640">Attaquons sans attendre cette partie en créant un nouveau fichier avec le code minimal suivant :</p><pre id="r-719641" data-claire-element-id="719641"><code data-claire-semantic="python">#/usr/bin/env python
# -*- coding:utf-8 -*-

from flask import Flask, request
app = Flask(__name__)

@app.route('/coucou')
def dire_coucou():
    return 'Coucou !'

if __name__ == '__main__':
    app.run()</code></pre><p id="r-719642" data-claire-element-id="719642"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-1/coucou">'/coucou'</a></strong></p><p id="r-719643" data-claire-element-id="719643">Vous remarquerez que la seule nouveauté est l'import de <code data-claire-semantic="python">request</code>. Cet objet va représenter la requête HTTP envoyée par le client et reçue par le serveur. Par conséquent, tout ce qui est contenu dans la requête HTTP se retrouve dans cet objet.<br/> Nous y trouverons donc le <strong>chemin</strong> de la page demandée, le <strong>type</strong> de la requête, quelques <strong>informations</strong> supplémentaires à propos du client, ainsi que les <strong>données</strong> transmises.</p><h5 id="r-le-chemin-de-la-page-demandee" data-claire-element-id="719648">Le chemin de la page demandée</h5><p id="r-719644" data-claire-element-id="719644">Le chemin de la page demandé est accessible via l'attribut path de l'objet request. Voilà un petit exemple d'utilisation :</p><pre id="r-719645" data-claire-element-id="719645"><code data-claire-semantic="python">@app.route('/')
def racine():
    return &quot;Le chemin de 'racine' est : &quot; + request.path

@app.route('/la')
def ici():
    return &quot;Le chemin de 'ici' est : &quot; + request.path</code></pre><p id="r-719646" data-claire-element-id="719646"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-1/">'/'</a> ; <a href="http://tutoflask.fspot.org/2-1/la">'/la'</a></strong></p><p id="r-719647" data-claire-element-id="719647">Accéder au contenu de la requête est aussi simple que cela. Mais l'attribut path ne présente pas tellement d'intérêt. Voyons donc un autre exemple avec une utilité concrète : le <strong>type</strong> de la requête HTTP.</p><h5 id="r-filtrage-des-methodes-http" data-claire-element-id="719659">Filtrage des méthodes HTTP</h5><p id="r-719649" data-claire-element-id="719649">Ce fameux &quot;type&quot; est plus connu sous le nom de &quot;méthode HTTP&quot;. Je vous ai dit que les méthodes HTTP les plus répandues étaient GET et POST : c'est vrai, car les formulaires des pages web ne peuvent envoyer que ce type de requête dans les normes HTML 4 et XHTML 1. Cela devrait changer avec l'avènement de HTML 5. De plus, les autres méthodes HTTP sont disponibles grâce à d'autres outils (pour ceux qui connaissent : via XMLHttpRequest en Javascript, ou via la commande curl, etc.).</p><p id="r-719650" data-claire-element-id="719650">La méthode POST est généralement employée lorsque le visiteur valide un formulaire (et envoie donc ses données au serveur dans le requête). Le reste du temps, la méthode employée est GET.<br/> Imaginons une situation où nous avons une page accessible au chemin <code data-claire-semantic="python">'/contact'</code>. Nous voudrions que cette page affiche un formulaire de contact, que le visiteur remplisse le formulaire, le valide, et qu'un remerciement lui soit affiché à la suite de cela. Tout cela, dans une seule et même page, <code data-claire-semantic="python">'/contact'</code>.</p><p id="r-719651" data-claire-element-id="719651">Une solution à ce genre de problème courant est de regarder la méthode HTTP utilisée : si le visiteur vient simplement d'arriver sur la page (en cliquant sur un lien ou en tapant directement l'url dans son navigateur), la méthode employée sera GET. En revanche, s'il vient de valider le formulaire, la méthode sera POST. Voyons la mise en œuvre de cet exemple :</p><pre id="r-719652" data-claire-element-id="719652"><code data-claire-semantic="python">@app.route('/contact', methods=['GET', 'POST'])
def contact():
    if request.method == 'GET':
        # afficher le formulaire
    else:
        # traiter les données reçues
        # afficher : &quot;Merci de m'avoir laissé un message !&quot;</code></pre><p id="r-719653" data-claire-element-id="719653"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-1/contact">'/contact'</a></strong></p><p id="r-719654" data-claire-element-id="719654">On note deux nouveautés dans ce code. La première : la méthode employée est accessible via l'attribut <code data-claire-semantic="python">method</code> de l'objet <code data-claire-semantic="python">request</code>. La seconde : on a précisé les méthodes autorisées dans le <code data-claire-semantic="python">@app.route</code>. Sans cela, la seule méthode autorisée est GET.<br/> On aurait pu écrire ce code différemment, en faisant une vue pour la méthode GET et une autre pour la méthode POST :</p><pre id="r-719655" data-claire-element-id="719655"><code data-claire-semantic="python">@app.route('/contact', methods=['GET'])
def contact_formulaire():
    # afficher le formulaire

@app.route('/contact', methods=['POST'])
def contact_traiter_donnees():
    # traiter les données reçues
    # afficher : &quot;Merci de m'avoir laissé un message !&quot;</code></pre><aside id="r-719657" data-claire-element-id="719657" data-claire-semantic="warning"><p id="r-719656" data-claire-element-id="719656">Faites bien attention à ce que vous n'ayez pas deux routes identiques, ou deux vues portant le même nom ! Ici, nos routes sont bien différentes malgré les apparences : en effet, elles ne sont pas accessibles par les mêmes méthodes HTTP.</p></aside><p id="r-719658" data-claire-element-id="719658">Pour découvrir l'erreur HTTP 405, regardez ce qui se passe si on supprime la méthode POST des méthodes autorisées. ^^</p><h5 id="r-les-routes" data-claire-element-id="719703">Les Routes</h5><p id="r-719660" data-claire-element-id="719660">Nous avons vu que la route (c'est à dire le chemin de la page demandée) était accessible dans <code data-claire-semantic="python">request.path</code>. En pratique, ce n'est pas très utile, puisque Flask se débrouille tout seul comme un chef pour exécuter la bonne vue selon l'url demandée, tout cela grâce à <code data-claire-semantic="python">@app.route</code>.<br/> Nous avons vu que celui ci permet de spécifier une URL d'accès à une vue, en filtrant les méthodes HTTP autorisées. Mais <code data-claire-semantic="python">@app.route</code> nous réserve d'autres possibilités.</p><h6 id="r-une-vue-plusieurs-routes" data-claire-element-id="719665">Une vue, plusieurs routes</h6><p id="r-719661" data-claire-element-id="719661">Eh oui, on peut décorer plusieurs fois une vue avec @app.route afin de rendre accessible cette page par plusieurs adresses. Exemple :</p><pre id="r-719662" data-claire-element-id="719662"><code data-claire-semantic="python">@app.route('/f_python')
@app.route('/forum/python')
@app.route('/truc')
def forum_python():
    return 'contenu forum python'</code></pre><p id="r-719663" data-claire-element-id="719663"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-1/f_python">'/f_python'</a> ; <a href="http://tutoflask.fspot.org/2-1/forum/python">'/forum/python'</a> ; <a href="http://tutoflask.fspot.org/2-1/truc">'/truc'</a></strong></p><p id="r-719664" data-claire-element-id="719664">Cependant, ce n'est pas une très bonne chose d'utiliser cette possibilité comme je le fais dans cet exemple. En effet, les moteurs de recherche qui veulent indexer votre site web pour le référencer vont croire qu'il s'agit de 3 pages différentes, et on risque donc de retrouver ces 3 résultats en cherchant cette page dans Google, par exemple.<br/> En fait, cette possibilité est utile quand elle est combinée aux <strong>routes personnalisées</strong>.</p><h6 id="r-les-routes-personnalisees" data-claire-element-id="719702">Les routes personnalisées</h6><p id="r-719666" data-claire-element-id="719666">Voilà une fonctionnalité qui se révèlera extrêmement utile pour le développement de votre site web ! :) <br/> Prenons à nouveau un exemple concret. Vous voulez mettre en place une page de discussion sur votre site, où les utilisateurs peuvent poster des messages et lire ceux des autres. Les messages seraient triés dans l'ordre décroissant afin de voir les plus récents en premier. Problème : au bout de quelques temps vous vous rendez compte qu'il y a trop de messages à afficher ! Vous décidez de limiter le nombre de messages par page à 50, et vous ajoutez des boutons &quot;page suivante&quot; et &quot;page précédente&quot; pour naviguer dedans. Comment faire ?</p><p id="r-719667" data-claire-element-id="719667">Voici un résultat élégant que nous aimerions obtenir :</p><ul id="r-719674" data-claire-element-id="719674"><li id="r-719669" data-claire-element-id="719669"><p id="r-719668" data-claire-element-id="719668">La page <code data-claire-semantic="python">'/discussion'</code> affiche les 50 messages les plus récents.</p></li><li id="r-719671" data-claire-element-id="719671"><p id="r-719670" data-claire-element-id="719670">La page <code data-claire-semantic="python">'/discussion/page/3'</code> affiche la 3ème page de messages, c'est à dire de 101 à 150.</p></li><li id="r-719673" data-claire-element-id="719673"><p id="r-719672" data-claire-element-id="719672">Du coup, la page <code data-claire-semantic="python">'/discussion/page/1'</code> affiche la même chose que la page <code data-claire-semantic="python">'/discussion'</code>.</p></li></ul><p id="r-719675" data-claire-element-id="719675">Les routes personnalisées sont un moyen d'obtenir de telles url. Nous aurions quelque chose de ce genre là :</p><pre id="r-719676" data-claire-element-id="719676"><code data-claire-semantic="python">@app.route('/discussion/page/&lt;num_page&gt;')
def mon_chat(num_page):
    num_page = int(num_page)
    premier_msg = 1 + 50 * (num_page - 1)
    dernier_msg = premier_msg + 50
    return 'affichage des messages {} à {}'.format(premier_msg, dernier_msg)</code></pre><p id="r-719677" data-claire-element-id="719677"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-1/discussion-v1/page/3">'/discussion/page/3'</a> ; <a href="http://tutoflask.fspot.org/2-1/discussion-v1/page/1">'/discussion/page/1'</a></strong></p><p id="r-719678" data-claire-element-id="719678">Ce qu'on a fait ici, c'est rajouter un paramètre obligatoire dans la route : un numéro de page à préciser, afin de pouvoir calculer les messages à afficher. Pour cela, il y a deux choses à faire :</p><ul id="r-719683" data-claire-element-id="719683"><li id="r-719680" data-claire-element-id="719680"><p id="r-719679" data-claire-element-id="719679">Placer dans la route un nom de variable écrit entre les symboles <code data-claire-semantic="python">'&lt;'</code> et <code data-claire-semantic="python">'&gt;'</code></p></li><li id="r-719682" data-claire-element-id="719682"><p id="r-719681" data-claire-element-id="719681">Ajouter en paramètre à la vue décorée une variable possédant ce même nom</p></li></ul><p id="r-719684" data-claire-element-id="719684">En procédant ainsi, on obtient alors une variable num_page qui correspond à ce qui a été mis à cet endroit dans l'url. Cette variable est une string, or nous voudrions un int, c'est pour cela que nous effectuons une conversion ligne 3. Mais cela crée une erreur si l'utilisateur entre autre chose qu'un nombre...<br/> Heureusement, Flask nous propose une meilleure façon de faire :</p><pre id="r-719685" data-claire-element-id="719685"><code data-claire-semantic="python">@app.route('/discussion/page/&lt;int:num_page&gt;')
def mon_chat(num_page):
    premier_msg = 1 + 50 * (num_page - 1)
    dernier_msg = premier_msg + 50
    return 'affichage des messages {} à {}'.format(premier_msg, dernier_msg)</code></pre><p id="r-719686" data-claire-element-id="719686"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-1/discussion-v2/page/3">'/discussion/page/3'</a> ; <a href="http://tutoflask.fspot.org/2-1/discussion-v2/page/1">'/discussion/page/1'</a></strong></p><p id="r-719687" data-claire-element-id="719687">Magique ! :magicien: En rajoutant ce petit <code data-claire-semantic="python">'int:'</code> avant le nom de la variable, les seules valeurs acceptées seront des entiers (sinon il y aura une erreur 404), et la variable sera automatiquement convertie. Plus d'erreur 500 !</p><aside id="r-719689" data-claire-element-id="719689" data-claire-semantic="information"><p id="r-719688" data-claire-element-id="719688">Il existe aussi <code data-claire-semantic="python">'float:'</code> pour les nombres à virgule, et <code data-claire-semantic="python">'path:'</code> pour les chaînes contenant le symbole '/' (slash)</p></aside><p id="r-719690" data-claire-element-id="719690">Maintenant, il nous reste un dernier problème : pouvoir accéder aux 50 messages les plus récents en nous rendant à l'adrese <code data-claire-semantic="python">'/discussion'</code>. Si on essaye de rajouter une route, bêtement :</p><pre id="r-719691" data-claire-element-id="719691"><code data-claire-semantic="python">@app.route('/discussion')</code></pre><p id="r-719692" data-claire-element-id="719692">On obtient une erreur, puisqu'il manque une valeur pour <code data-claire-semantic="python">num_page</code>... La solution est d'utiliser une valeur par défaut pour le paramètre <code data-claire-semantic="python">num_page</code> de notre vue <code data-claire-semantic="python">mon_chat</code> :</p><pre id="r-719693" data-claire-element-id="719693"><code data-claire-semantic="python">@app.route('/discussion')
@app.route('/discussion/page/&lt;int:num_page&gt;')
def mon_chat(num_page = 1):
    premier_msg = 1 + 50 * (num_page - 1)
    dernier_msg = premier_msg + 50
    return 'affichage des messages {} à {}'.format(premier_msg, dernier_msg)</code></pre><p id="r-719694" data-claire-element-id="719694"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-1/discussion-v3">'/discussion'</a></strong></p><p id="r-719695" data-claire-element-id="719695">Problème résolu ! :)</p><p id="r-719696" data-claire-element-id="719696">Bien entendu, vous pouvez mettre plusieurs variables dans vos routes, et vous n'êtes pas obligés de les séparer par un slash. Par exemple, voici une page qui qui affiche le prénom et le nom passés dans l'adresse :</p><pre id="r-719697" data-claire-element-id="719697"><code data-claire-semantic="python">@app.route('/afficher')
@app.route('/afficher/mon_nom_est_&lt;nom&gt;_et_mon_prenom_&lt;prenom&gt;')
def afficher(nom=None, prenom=None):
    if nom is None or prenom is None:
        return &quot;Entrez votre nom et votre prénom comme il le faut dans l'url&quot;
    return &quot;Vous vous appelez {} {} !&quot;.format(prenom, nom)</code></pre><p id="r-719698" data-claire-element-id="719698"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-1/afficher">'/afficher'</a> ; <a href="http://tutoflask.fspot.org/2-1/afficher/mon_nom_est_Dupont_et_mon_prenom_Luc">'/afficher/mon_nom_est_Dupont_et_mon_prenom_Luc'</a></strong></p><aside id="r-719700" data-claire-element-id="719700" data-claire-semantic="warning"><p id="r-719699" data-claire-element-id="719699">Ceci est uniquement un exemple, ce n'est pas quelque chose à faire. Les routes personnalisées doivent vous permettre d'avoir de belles url, pas de transmettre des données. Pour cela, il y a les formulaires.</p></aside><p id="r-719701" data-claire-element-id="719701">Un bon exemple d'utilisation des routes personnalisées est la fonctionnalité de facebook qui permet d'avoir une belle url pour accéder à son profil : si vous vous appelez Luc Dupont, votre profil peut être accessible à la route <code data-claire-semantic="python">'/luc.dupont'</code>. Ce genre de choses se met en place facilement grâce aux routes personnalisées (<code data-claire-semantic="python">'/&lt;prenom&gt;.&lt;nom&gt;'</code>).</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">
<span class="arrow"></span>
<span class="next">Requêtes et Réponses</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
<span class="next">Les réponses</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesrponses"></a><h2>Les réponses</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
<span class="arrow"></span>
<span class="next">Les requêtes</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">
<span class="next">Les templates</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-reponses-1" data-claire-element-id="719772">Les réponses</h4><p id="r-719705" data-claire-element-id="719705">Jusqu'ici, toutes nos pages se contentaient de renvoyer une chaîne de caractère. Flask transformait tout seul cette chaîne en une réponse HTTP, et lui attribuait le mimetype <code data-claire-semantic="python">&quot;text/html&quot;</code> (ce qui signifie que le contenu de la page est du HTML) et le code d'erreur 200 (qui signifie que tout s'est bien passé). Voyons maintenant comment modifier ce comportement. ;)</p><h5 id="r-changer-le-mimetype" data-claire-element-id="719722">Changer le mimetype</h5><p id="r-719706" data-claire-element-id="719706">Essayons de concevoir une page web qui génère une image et qui la renvoie telle quelle. J'utiliserai pour cela le module PIL (Python Image Library) que vous pouvez installer via la commande <code data-claire-semantic="console">pip install PIL</code>.</p><pre id="r-719707" data-claire-element-id="719707"><code data-claire-semantic="python">from PIL import Image
from StringIO import StringIO

@app.route('/image')
def genere_image():
    mon_image = StringIO()
    Image.new(&quot;RGB&quot;, (300,300), &quot;#92C41D&quot;).save(mon_image, 'BMP')
    return mon_image.getvalue()</code></pre><p id="r-719708" data-claire-element-id="719708"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-1/image">'/image'</a></strong></p><p id="r-719709" data-claire-element-id="719709">Quelques explications : ligne 6 je crée l'objet qui va contenir l'image (un <code data-claire-semantic="python">StringIO</code> est en quelques sortes un fichier stocké dans la RAM et non sur le disque dur), ligne 7 je génère une image de dimensions 300 sur 300, de couleur verte (<code data-claire-semantic="python">'#92C41D'</code>), au format BMP, et je la stocke dans l'objet <code data-claire-semantic="python">mon_image</code>.<br/> Puis, ligne 8, je renvoie le contenu de l'objet <code data-claire-semantic="python">mon_image</code>... c'est à dire l'image elle même.</p><p id="r-719710" data-claire-element-id="719710">En se rendant à l'adresse <code data-claire-semantic="python">'/image'</code> on s'attend donc à voir apparaître notre carré vert... Mais non, on obtient du texte incompréhensible ! :waw: (regardez le code source de la page si ce texte n'apparaît pas, en faisant Ctrl-U)</p><p id="r-719711" data-claire-element-id="719711">Le problème est que Flask nous renvoie bien l'image mais en oubliant de préciser qu'il s'agit d'une image, justement, et au format BMP : Flask fait croire à notre navigateur qu'il s'agit d'une page HTML comme une autre, c'est pour cela que notre navigateur s'acharne à l'afficher sous forme de texte.</p><p id="r-719712" data-claire-element-id="719712">La solution est simplement de dire à Flask que le <strong>mimetype</strong> de cette réponse HTTP n'est pas <code data-claire-semantic="python">'text/html'</code> comme d'habitude, mais <code data-claire-semantic="python">'image/bmp'</code>.</p><div id="r-719714" data-claire-element-id="719714" data-claire-semantic="question"><p id="r-719713" data-claire-element-id="719713">Mais, où est-ce qu'on fait ça ? On doit faire un <code data-claire-semantic="python">from flask import reponse</code> pour pouvoir manipuler la réponse HTTP ?</p></div><p id="r-719715" data-claire-element-id="719715">Presque ! Cette fois ci, c'est légèrement différent, on va créer la réponse à partir de l'image, puis on va changer son mimetype en manipulant l'objet réponse. Mais pour le créer, nous allons effectivement avoir besoin d'un <code data-claire-semantic="python">import</code> :</p><pre id="r-719716" data-claire-element-id="719716"><code data-claire-semantic="python">from flask import make_response</code></pre><p id="r-719717" data-claire-element-id="719717">Ensuite, on peut enfin créer un objet réponse HTTP à partir de l'image, changer son mimetype (qui est simplement un attribut de la réponse), et renvoyer la réponse :</p><pre id="r-719718" data-claire-element-id="719718"><code data-claire-semantic="python">reponse = make_response(mon_image.getvalue())
reponse.mimetype = &quot;image/bmp&quot;  # à la place de &quot;text/html&quot;
return reponse</code></pre><p id="r-719719" data-claire-element-id="719719"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-1/image-v2">'/image'</a></strong></p><aside id="r-719721" data-claire-element-id="719721" data-claire-semantic="information"><p id="r-719720" data-claire-element-id="719720">D'habitude, on ne fait pas appel à <code data-claire-semantic="python">make_response()</code> car Flask le fait pour nous : lorsqu'on <code data-claire-semantic="python">return</code> quelque chose, Flask applique <code data-claire-semantic="python">make_response()</code> dessus. C'est dans des cas comme celui ci qu'on est amenés à le faire nous même.</p></aside><h5 id="r-changer-le-code-d-erreur-http" data-claire-element-id="719747">Changer le code d'erreur HTTP</h5><p id="r-719723" data-claire-element-id="719723">Dans le même registre, on peut éventuellement avoir besoin de changer le code d'erreur HTTP d'une page. Imaginons la page suivante (parfaitement inutile, mais c'est pour l'exemple) :</p><pre id="r-719724" data-claire-element-id="719724"><code data-claire-semantic="python">@app.route('/404')
def page_non_trouvee():
    return &quot;Cette page devrait vous avoir renvoyé une erreur 404&quot;</code></pre><p id="r-719725" data-claire-element-id="719725"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-1/404">'/404'</a></strong></p><p id="r-719726" data-claire-element-id="719726">Si on consulte cette page dans notre navigateur, le texte s'affiche bien. Mais a-t-on reçu un code d'erreur 404 ? Non, nous n'avons rien fait pour cela, nous avons donc obtenu le code d'erreur 200. Pour forcer un code d'erreur différent, il faut créer un objet réponse et modifier son attribut <code data-claire-semantic="python">status_code</code> :</p><pre id="r-719727" data-claire-element-id="719727"><code data-claire-semantic="python">@app.route('/404')
def page_non_trouvee():
    reponse = make_response(&quot;Cette page devrait vous avoir renvoyé une erreur 404&quot;)
    reponse.status_code = 404
    return reponse</code></pre><p id="r-719728" data-claire-element-id="719728"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-1/404-v2">'/404'</a></strong></p><p id="r-719729" data-claire-element-id="719729">Et voilà ! :magicien: <br/> Petite astuce : dans le cas particulier du code d'erreur, on peut le spécifier directement à l'intérieur du <code data-claire-semantic="python">make_response()</code> :</p><pre id="r-719730" data-claire-element-id="719730"><code data-claire-semantic="python">@app.route('/404')
def page_non_trouvee():
    reponse = make_response(&quot;Cette page devrait vous avoir renvoyé une erreur 404&quot;, 404)
    return reponse</code></pre><p id="r-719731" data-claire-element-id="719731">Et même mieux : je vous ai dit que Flask appliquait tout seul <code data-claire-semantic="python">make_response()</code> à nos <code data-claire-semantic="python">return</code> quand on ne l'avait pas fait, on peut donc écrire tout simplement ceci :</p><pre id="r-719732" data-claire-element-id="719732"><code data-claire-semantic="python">@app.route('/404')
def page_non_trouvee():
    return &quot;Cette page devrait vous avoir renvoyé une erreur 404&quot;, 404</code></pre><p id="r-719733" data-claire-element-id="719733">On renvoie en fait un tuple dont la deuxième valeur est le code d'erreur HTTP. Plus besoin de <code data-claire-semantic="python">make_response()</code> !</p><h6 id="r-personnaliser-ses-pages-d-erreur" data-claire-element-id="719741">Personnaliser ses pages d'erreur</h6><p id="r-719734" data-claire-element-id="719734">Ce que nous venons de faire est en quelque sorte de créer une page d'erreur personnalisée, mais cela ne présente pas beaucoup d'intérêt, car dans le cas général, le visiteur entre une adresse inconnue, et Flask lui renvoie une page d'erreur 404 assez austère. Ce qui serait intéressant serait justement de modifier cette page 404 affichée par défaut...<br/> Heureusement Flask nous permet de mettre cela en place très facilement pour n'importe quel code d'erreur, grâce au décorateur <code data-claire-semantic="python">@app.errorhandler</code> ! :)</p><p id="r-719735" data-claire-element-id="719735">Ce décorateur est comparable à <code data-claire-semantic="python">@app.route</code>. La différence est que <code data-claire-semantic="python">@app.route</code> associe une vue à la route présente dans la requête, tandis que <code data-claire-semantic="python">@app.errorhandler</code> associe une vue à une erreur survenue sur le serveur. Voilà comment il s'utilise :</p><pre id="r-719736" data-claire-element-id="719736"><code data-claire-semantic="python">@app.errorhandler(404)
def ma_page_404(error):
    return &quot;Ma jolie page 404&quot;, 404</code></pre><aside id="r-719738" data-claire-element-id="719738" data-claire-semantic="warning"><p id="r-719737" data-claire-element-id="719737">Vous noterez que j'ai renvoyé un tuple dont la deuxième valeur est le code d'erreur, comme on l'a vu plus tôt. Si j'avais oublié cela, ma page d'erreur 404 aurait renvoyé le code 200 ! o_O Faites attention à cela.</p></aside><p id="r-719739" data-claire-element-id="719739">Je ne me suis pas servi du paramètre error de ma vue, car celui-ci contient des informations sur le type d'erreur survenue, or, dans ce cas là, il s'agit forcément de l'erreur 404. Mais ce paramètre est utile si on fait une seule vur pour plusieurs codes d'erreur :</p><pre id="r-719740" data-claire-element-id="719740"><code data-claire-semantic="python">@app.errorhandler(401)
@app.errorhandler(404)
@app.errorhandler(500)
def ma_page_erreur(error):
    return &quot;Ma jolie page {}&quot;.format(error.code), error.code</code></pre><h6 id="r-emettre-soi-meme-des-erreurs-http" data-claire-element-id="719746">Émettre soi-même des erreurs HTTP</h6><p id="r-719742" data-claire-element-id="719742">Nous avons vu comment modifier le code d'erreur pour une réponse donnée, mais imaginons que nous voulions carrément qu'une page (qui existe bien) se comporte comme si elle n'existe pas ? Il faudrait en quelques sortes &quot;rediriger&quot; vers la page 404. Ce comportement est exactement celui permis par la fonction <code data-claire-semantic="python">abort</code>.</p><p id="r-719743" data-claire-element-id="719743">Prenons un exemple concret : si l'utilisateur n'est pas identifié, la page <code data-claire-semantic="python">'/profil'</code> affiche une page d'erreur 401 (qui signifie &quot;accès non autorisé&quot;) :</p><pre id="r-719744" data-claire-element-id="719744"><code data-claire-semantic="python">from flask import abort

@app.route('/profil')
def profil():
    if utilisateur_non_identifie:
        abort(401)
    return &quot;Vous êtes bien identifié, voici la page demandée : ...&quot;</code></pre><p id="r-719745" data-claire-element-id="719745">Ce petit système de redirection spécifique aux erreurs est bien pratique... Et il existe le même système de redirection pour les pages normale, ce que nous allons voir immédiatement.</p><h5 id="r-les-redirections" data-claire-element-id="719771">Les redirections</h5><p id="r-719748" data-claire-element-id="719748">Nous préférerions que la page <code data-claire-semantic="python">'/profil'</code> redirige vers la page <code data-claire-semantic="python">'/login'</code> si l'utilisateur n'est pas identifié. Voyons comment faire.</p><h6 id="r-un-peu-de-theorie-le-code-d-erreur-http-302" data-claire-element-id="719750">Un peu de théorie : le code d'erreur HTTP 302</h6><p id="r-719749" data-claire-element-id="719749">Commençons par un petit détail technique : lorsqu'on veut rediriger le visiteur vers une autre page, on lui envoie un code d'erreur HTTP 302 accompagné de l'adresse de la page où il doit se rendre. Le navigateur charge alors cette page automatiquement, c'est pour cela qu'on ne voit jamais de page d'erreur 302 apparaître, tout s'enchaîne rapidement.</p><h6 id="r-la-fonction-redirect" data-claire-element-id="719759">La fonction <code data-claire-semantic="python">redirect</code></h6><p id="r-719751" data-claire-element-id="719751">Elle s'utilise un peu à la manière de <code data-claire-semantic="python">abort</code>, sauf qu'au lieu de prendre en paramètre un code d'erreur, elle prend une route. De plus, il faut retourner ce que renvoie <code data-claire-semantic="python">redirect</code>. Exemple :</p><pre id="r-719752" data-claire-element-id="719752"><code data-claire-semantic="python">@app.route('/google')
def redirection_google():
    return redirect('http://www.google.fr')</code></pre><p id="r-719753" data-claire-element-id="719753"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-1/google">'/google'</a></strong></p><p id="r-719754" data-claire-element-id="719754">Et si nous revenons à notre problème initial, nous pouvons maintenant le résoudre en faisant ainsi :</p><pre id="r-719755" data-claire-element-id="719755"><code data-claire-semantic="python">from flask import redirect

@app.route('/profil')
def profil():
    if utilisateur_non_identifie:
        return redirect('/login')
    return &quot;Vous êtes bien identifié, voici la page demandée : ...&quot;

@app.route('/login')
def page_de_login():
    # ...</code></pre><p id="r-719756" data-claire-element-id="719756">Tout semble aller pour le mieux... sauf qu'il ne faut surtout pas procéder ainsi. En effet, on vient de faire quelque chose de mal : on a indiqué une route en paramètre de <code data-claire-semantic="python">redirect()</code>. Souvenez vous, les routes sont faites pour être écrites une seule fois, dans le <code data-claire-semantic="python">@app.route</code>. De cette façon, si on veut changer les routes, cela se fera à un seul endroit, tandis que si on écrit également les routes dans les <code data-claire-semantic="python">redirect()</code>, il faudra les changer partout !</p><p id="r-719757" data-claire-element-id="719757">La bonne méthode est d'utiliser non pas la route, qui peut changer, mais le <strong>nom</strong> de la vue ciblée, qui restera inchangé, même si on modifie sa ou ses routes d'accès. En l'occurence, le nom de la vue est <code data-claire-semantic="python">page_de_login</code>.</p><p id="r-719758" data-claire-element-id="719758">La problème est que si l'on passe le nom de cette vue à <code data-claire-semantic="python">redirect</code>, celui ci ne va pas savoir quoi en faire, car il ne peut recevoir qu'une adresse. Il faut donc utiliser une autre fonction (encore une !), très pratique, appelée <code data-claire-semantic="python">url_for()</code>. Elle va transformer le nom de vue que vous lui passerez (sous la forme d'une <strong>chaîne</strong>) en une adresse, exploitable par <code data-claire-semantic="python">redirect</code>.</p><h6 id="r-la-fonction-url-for" data-claire-element-id="719770">La fonction <code data-claire-semantic="python">url_for</code></h6><p id="r-719760" data-claire-element-id="719760">Je n'ai plus grand chose à rajouter, voilà simplement le code final que nous voulions :</p><pre id="r-719761" data-claire-element-id="719761"><code data-claire-semantic="python">from flask import redirect, url_for

@app.route('/profil')
def profil():
    if utilisateur_non_identifie:
        return redirect(url_for('page_de_login'))
    return &quot;Vous êtes bien identifié, voici la page demandée : ...&quot;

@app.route('/login')
def page_de_login():
    # ...</code></pre><p id="r-719762" data-claire-element-id="719762">Un dernier détail cependant : <code data-claire-semantic="python">url_for</code> peut aussi générer des routes personnalisées, il suffit de lui passer en paramètres les variables nécessaires dans la route.</p><p id="r-719763" data-claire-element-id="719763">Par exemple, si notre page <code data-claire-semantic="python">'/profil'</code> est en réalité accessible uniquement avec un pseudo de la façon suivante :</p><pre id="r-719764" data-claire-element-id="719764"><code data-claire-semantic="python">@app.route('/profil/&lt;pseudo&gt;')
def afficher_profil(pseudo):
    # ...</code></pre><p id="r-719765" data-claire-element-id="719765">Alors pour générer l'adresse vers le profil du membre &quot;Luc1664&quot;, on utilisera <code data-claire-semantic="python">url_for</code> de la manière suivante :</p><pre id="r-719766" data-claire-element-id="719766"><code data-claire-semantic="python">url_for('afficher_profil', pseudo=&quot;Luc1664&quot;)</code></pre><p id="r-719767" data-claire-element-id="719767">Tout simplement ! :)</p><p id="r-719768" data-claire-element-id="719768">Et maintenant, vérifions votre attention avec le traditionnel QCM ! :diable:</p><p id="r-719769" data-claire-element-id="719769">Ce chapitre a été long (n'hésitez pas à le relire et à vous entraîner), et pourtant je n'ai pas tout dit ! Il nous reste quelques petits mystères à propos des objets requêtes et réponses à découvrir, mais le plus gros du travail a été fait, félicitations ! En guise de récompense, dans le prochain chapitre, on va enfin apprendre à afficher des belles pages pleines de HTML5, de CSS3 et de Javascript. :)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
<span class="arrow"></span>
<span class="next">Les requêtes</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">
<span class="next">Les templates</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lestemplates"></a><h2>Les templates</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
<span class="arrow"></span>
<span class="next">Les réponses</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
<span class="next">Une fausse bonne idée...</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-719774" data-claire-element-id="719774">Je vous avais prévenu à la fin du chapitre précédent : nous allons maintenant, enfin, produire de belles pages contenant du HTML5/CSS3 (qu'il vous faudra impérativement connaître pour la suite) !<br/> Pour effectuer cela de la manière la plus efficace et élégante possible, Flask intègre ce qu'on appelle un moteur de templates.<br/> Voyons comment il s'utilise ! :pirate:</p>
</div><a name="Unefaussebonneide..."></a><h2>Une fausse bonne idée...</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">
<span class="arrow"></span>
<span class="next">Les templates</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
<span class="next">Les templates, côté utilisateur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-une-fausse-bonne-idee" data-claire-element-id="719813">Une fausse bonne idée...</h4><div id="r-719776" data-claire-element-id="719776" data-claire-semantic="question"><p id="r-719775" data-claire-element-id="719775">Un <em>moteur de templates</em> ? Je n'ai pas besoin de ça pour afficher du HTML moi...</p></div><p id="r-719777" data-claire-element-id="719777">Si vous vous dites cela, c'est peut être que vous avez une idée derrière la tête ! En effet, jusque là, je n'ai fait renvoyer que des chaînes de caractères par nos pages web. Certains d'entre vous se sont sûrement essayés à insérer du HTML dans ces chaînes... et ont pu constater que cela fonctionnait parfaitement :</p><pre id="r-719778" data-claire-element-id="719778"><code data-claire-semantic="python">@app.route('/')
def accueil():
    return &quot;&lt;h1&gt;Bienvenue !&lt;/h1&gt;&quot;</code></pre><p id="r-719779" data-claire-element-id="719779"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-2/">'/'</a></strong></p><p id="r-719780" data-claire-element-id="719780">Cette façon de faire est suffisante pour un exemple aussi minimal, mais dans le cas d'une page web un peu plus compliquée, cela devient lourd :</p><pre id="r-719781" data-claire-element-id="719781"><code data-claire-semantic="python">@app.route('/')
def accueil():
    mots = [&quot;bonjour&quot;, &quot;à&quot;, &quot;toi,&quot;, &quot;visiteur.&quot;]
    puces = ''.join(&quot;&lt;li&gt;{}&lt;/li&gt;&quot;.format(m) for m in mots)
    return &quot;&quot;&quot;&lt;!DOCTYPE html&gt;
        &lt;html&gt;
            &lt;head&gt;
                &lt;meta charset=&quot;utf-8&quot; /&gt;
                &lt;title&gt;{titre}&lt;/title&gt;
            &lt;/head&gt;
        
            &lt;body&gt;
                &lt;h1&gt;{titre}&lt;/h1&gt;
                &lt;ul&gt;
                    {puces}
                &lt;/ul&gt;
            &lt;/body&gt;
        &lt;/html&gt;&quot;&quot;&quot;.format(titre=&quot;Bienvenue !&quot;, puces=puces)</code></pre><p id="r-719782" data-claire-element-id="719782"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-2/v2/">'/'</a></strong></p><p id="r-719783" data-claire-element-id="719783">Ce code est immonde, et pourtant ma page est encore bien simple. Imaginez que vous ayez 50 pages : vous rendez vous compte de la taille de votre fichier ? Du nombre de répétitions que vous faites ? Du nombre de lignes de codes à changer à chaque fois que vous voudrez modifier la page ?</p><p id="r-719784" data-claire-element-id="719784">Une solution serait de coder quelque chose qui évite toute cette répétition, qui nous permette d'insérer intelligemment et élégamment le contenu de nos variables dans des pages HTML... et c'est exactement ce à quoi sert un moteur de templates.</p><h5 id="r-la-meme-page-en-utilisant-un-template" data-claire-element-id="719798">La même page, en utilisant un template</h5><p id="r-719785" data-claire-element-id="719785">Sans plus attendre, voici à quoi ressemblerait le code précédent en l'adaptant au moteur de template intégré à Flask. Nous aurions deux fichier :</p><ul id="r-719790" data-claire-element-id="719790"><li id="r-719787" data-claire-element-id="719787"><p id="r-719786" data-claire-element-id="719786">Le fichier Python <strong>hello.py</strong> qui contient notre vue <code data-claire-semantic="python">accueil()</code>.</p></li><li id="r-719789" data-claire-element-id="719789"><p id="r-719788" data-claire-element-id="719788">Le fichier template, que nous appellerons par exemple <strong>accueil.html</strong>.</p></li></ul><p id="r-719791" data-claire-element-id="719791">Le code complet de <strong>hello.py</strong> serait :</p><pre id="r-719792" data-claire-element-id="719792"><code data-claire-semantic="python">#! /usr/bin/python
# -*- coding:utf-8 -*-

from flask import Flask
app = Flask(__name__)

@app.route('/')
def accueil():
    mots = [&quot;bonjour&quot;, &quot;à&quot;, &quot;toi,&quot;, &quot;visiteur.&quot;]
    return render_template('accueil.html', titre=&quot;Bienvenue !&quot;, mots=mots)

if __name__ == '__main__':
    app.run(debug=True)</code></pre><p id="r-719793" data-claire-element-id="719793">Et le contenu de <strong>accueil.html</strong> serait :</p><pre id="r-719794" data-claire-element-id="719794"><code data-claire-semantic="jinja">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot; /&gt;
        &lt;title&gt;{{ titre }}&lt;/title&gt;
    &lt;/head&gt;

    &lt;body&gt;
        &lt;h1&gt;{{ titre }}&lt;/h1&gt;
        &lt;ul&gt;
        {% for mot in mots %}
            &lt;li&gt;{{ mot }}&lt;/li&gt;
        {% endfor %}
        &lt;/ul&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-719795" data-claire-element-id="719795">Comme vous le voyez, on déporte tout ce qui concerne simplement l'affichage et la mise en forme dans le fichier template. J'expliquerais plus loin en détail comment tout cela fonctionne.</p><aside id="r-719797" data-claire-element-id="719797" data-claire-semantic="information"><p id="r-719796" data-claire-element-id="719796">On dirait qu'on utilise du Python à l'intérieur du HTML, mais ce n'est pas vraiment le cas. Cette syntaxe à beau ressembler beaucoup à du Python, elle n'est néanmoins prévue que pour faciliter la mise en forme et l'affichage, pas pour faire des calculs mathématiques ou pour écrire dans des fichiers, comme on peut le faire en Python.</p></aside><h5 id="r-integrer-les-fichiers-css-et-javascript" data-claire-element-id="719806">Intégrer les fichiers CSS et Javascript</h5><p id="r-719799" data-claire-element-id="719799">Nous voudrions ajouter notre beau style CSS, appelé mon_style.css, à cette page toute morne. <br/> Question : quel chemin écrire dans l'attribut <code data-claire-semantic="html">href</code> de l'élément HTML <code data-claire-semantic="html">&lt;link&gt;</code> ?</p><pre id="r-719800" data-claire-element-id="719800"><code data-claire-semantic="html">&lt;link href=&quot;chemin/vers/mon_style.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;</code></pre><p id="r-719801" data-claire-element-id="719801">Piège ! :ninja: <br/> Rappelez-vous : on n'écrit pas les chemins en dur, on utilise <code data-claire-semantic="python">url_for()</code> ! Eh oui, cette fonction est utilisable à l'intérieur des templates. :)</p><p id="r-719802" data-claire-element-id="719802">Maintenant, l'autre question est de savoir où placer notre fichier mon_style.css, et comment faire comprendre à <code data-claire-semantic="python">url_for()</code> qu'on veut l'adresse de ce fichier et pas d'une vue comme auparavant...<br/> C'est en fait tout simple. Les fichiers CSS, Javascript, tout comme les images, c'est à dire tous les fichiers <strong>statiques</strong>, vont être placés dans un dossier appelé <code data-claire-semantic="python">static</code> justement. Puis on utilisera <code data-claire-semantic="python">url_for()</code> de la manière suivante :</p><pre id="r-719803" data-claire-element-id="719803"><code data-claire-semantic="python">url_for('static', filename='mon_style.css')</code></pre><p id="r-719804" data-claire-element-id="719804">Notre balise <code data-claire-semantic="html">&lt;link&gt;</code> ressemblera donc à cela au final :</p><pre id="r-719805" data-claire-element-id="719805"><code data-claire-semantic="jinja">&lt;link href=&quot;{{ url_for('static', filename='mon_style.css') }}&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;</code></pre><h5 id="r-organisation-des-fichiers" data-claire-element-id="719812">Organisation des fichiers</h5><p id="r-719807" data-claire-element-id="719807">Les fichiers template vont, eux, dans un dossier appelé <code data-claire-semantic="python">templates</code>. Nous avons donc typiquement l'arborescence suivante dans un projet Flask :</p><pre id="r-719808" data-claire-element-id="719808"><code>projet/
    application.py
    static/
        mon_style.css
        images/
            ma_banniere.png
    templates/
        accueil.html
        login.html</code></pre><p id="r-719809" data-claire-element-id="719809">Pour l'instant, nous avons un seul fichier Python, mais à termes nous en aurons plusieurs. Afin de faire de notre projet un package Python, j'ai l'habitude de renommer <code data-claire-semantic="python">application.py</code> en <code data-claire-semantic="python">__init__.py</code>.</p><aside id="r-719811" data-claire-element-id="719811" data-claire-semantic="information"><p id="r-719810" data-claire-element-id="719810">Cette introduction est terminée, nous allons à présent nous plonger dans l'exploration des possibilités offertes par le moteur de templates de Flask. Pour votre culture, ce moteur de template est <a href="http://jinja.pocoo.org/">Jinja2</a>, il ressemble fortement à celui utilisé par Django (Django possède son propre moteur de template - à vrai dire il possède presque son propre &quot;tout&quot;).<br/> Cependant, Jinja2 se targue d'être plus populaire et plus performant.</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">
<span class="arrow"></span>
<span class="next">Les templates</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
<span class="next">Les templates, côté utilisateur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lestemplatesctutilisateur"></a><h2>Les templates, côté utilisateur</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
<span class="arrow"></span>
<span class="next">Une fausse bonne idée...</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
<span class="next">Les templates, côté progammeur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-templates-cote-utilisateur" data-claire-element-id="719941">Les templates, côté utilisateur</h4><p id="r-719814" data-claire-element-id="719814">Ne vous laissez pas intriguer par le titre &quot;côté utilisateur&quot;, vous ne le comprendrez qu'une fois que vous aurez vu l'autre côté, celui &quot;programmeur&quot;, dans la partie suivante. ^^</p><h5 id="r-passer-du-contenu-au-template" data-claire-element-id="719845">Passer du contenu au template</h5><p id="r-719815" data-claire-element-id="719815">Les templates sont des fichiers HTML dans lesquels on place des sections de code Jinja2, qui ressemble fortement à du Python. L'exemple le plus simple que l'on puisse imaginer serait un template ne contenant que du HTML :</p><pre id="r-719816" data-claire-element-id="719816"><code data-claire-semantic="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot; /&gt;
        &lt;title&gt;Accueil&lt;/title&gt;
    &lt;/head&gt;

    &lt;body&gt;
        &lt;h1&gt;Ceci est la page d'accueil.&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-719817" data-claire-element-id="719817">Pour faire afficher ce template par notre vue <code data-claire-semantic="python">accueil()</code>, Flask nous met à disposition la fonction <code data-claire-semantic="python">render_template()</code>, à laquelle on va passer en paramètres le nom du fichier template (par exemple, pour être cohérent, <code data-claire-semantic="python">accueil.html</code> en l'occurence). Les fichiers templates doivent être placés dans le dossier nommé <code data-claire-semantic="python">templates</code>.</p><pre id="r-719818" data-claire-element-id="719818"><code data-claire-semantic="python">from flask import render_template

@app.route('/')
def accueil():
    return render_template('accueil.html')</code></pre><p id="r-719819" data-claire-element-id="719819"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-2/v3/">'/'</a></strong></p><aside id="r-719821" data-claire-element-id="719821" data-claire-semantic="information"><p id="r-719820" data-claire-element-id="719820">La fonction <code data-claire-semantic="python">render_template()</code> renvoie le contenu de la page web qui va être envoyée au client. Ce contenu n'est rien d'autre qu'une simple chaine de caractères. Tout ce qu'on a vu au chapitre précédent sur les réponses HTTP est donc valable en utilisant les templates.</p></aside><p id="r-719822" data-claire-element-id="719822">Si l'on veut passer au template des variables à afficher, cela se fait également dans la fonction <code data-claire-semantic="python">render_template()</code>. Il suffit de lui passer ces variables en tant qu'argument optionnels.<br/> Par exemple, si on désire afficher la date actuelle dans la page web, on fera ainsi :</p><pre id="r-719823" data-claire-element-id="719823"><code data-claire-semantic="python">from datetime import date

@app.route('/date')
def date():
    d = date.today().isoformat()
    return render_template('accueil.html', la_date=d)</code></pre><p id="r-719824" data-claire-element-id="719824">On passe au template une variable qui s'appellera la_date. Cette variable sera une simple chaîne qu'on affichera ainsi :</p><pre id="r-719825" data-claire-element-id="719825"><code data-claire-semantic="jinja">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot; /&gt;
        &lt;title&gt;Date&lt;/title&gt;
    &lt;/head&gt;

    &lt;body&gt;
        &lt;h1&gt;La date d'aujourd'hui est : {{ la_date }}&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-719826" data-claire-element-id="719826"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-2/date">'/date'</a></strong></p><p id="r-719827" data-claire-element-id="719827">Comme vous le voyez, pour afficher quelque chose dans un template, il suffit de mettre ce quelque chose entre <code data-claire-semantic="python">'{{'</code> et <code data-claire-semantic="python">'}}'</code>.</p><p id="r-719828" data-claire-element-id="719828">Il existe deux autres façons de faire en sorte de passer des variables depuis le code Python vers le template.</p><h6 id="r-1-app-context-processor" data-claire-element-id="719832">1) @app.context_processor</h6><p id="r-719829" data-claire-element-id="719829">Si vous vous rendez compte que dans chaque vue, vous passez une variable qui est utilisée dans chaque template, il existe une manière de supprimer cette répétition. Par exemple, si vous utilisez la variable <code data-claire-semantic="python">titre</code> dans chaque template, voilà comment vous pourriez faire pour la passer à un seul endroit :</p><pre id="r-719830" data-claire-element-id="719830"><code data-claire-semantic="python">@app.context_processor
def passer_titre():
    return dict(titre=&quot;Bienvenue !&quot;)</code></pre><p id="r-719831" data-claire-element-id="719831">Comme vous le voyez, il suffit de créer une autre fonction décorée par <code data-claire-semantic="python">@app.context_processor</code>. Cette fonction doit renvoyer un dictionnaire où chaque clé sera une variable accessible dans les templates Jinja.</p><h6 id="r-2-sans-rien-faire" data-claire-element-id="719844">2) Sans rien faire</h6><p id="r-719833" data-claire-element-id="719833">Certaines variables sont accessibles par défaut dans les templates, sans que vous ayez à faire quoi que ce soit. C'est le cas des variables <code data-claire-semantic="python">request</code>, <code data-claire-semantic="python">config</code>, <code data-claire-semantic="python">session</code> et <code data-claire-semantic="python">g</code>.</p><p id="r-719834" data-claire-element-id="719834">L'objet <code data-claire-semantic="python">request</code>, vous le connaissez. On peut par exemple afficher la valeur de son attribut <code data-claire-semantic="python">method</code> :</p><pre id="r-719835" data-claire-element-id="719835"><code data-claire-semantic="jinja">{{ request.method }}</code></pre><p id="r-719836" data-claire-element-id="719836">Pour ce qui est des autres objets :</p><ul id="r-719843" data-claire-element-id="719843"><li id="r-719838" data-claire-element-id="719838"><p id="r-719837" data-claire-element-id="719837"><code data-claire-semantic="python">config</code> représente la configuration de Flask. Nous n'y avons pas trop touché, excepté lorsque nous avons précisé <code data-claire-semantic="python">debug=True</code>. <code data-claire-semantic="python">debug</code> est en fait un item du dictionnaire <code data-claire-semantic="python">config</code>. Il en est de même pour <code data-claire-semantic="python">secret_key</code>.</p></li><li id="r-719840" data-claire-element-id="719840"><p id="r-719839" data-claire-element-id="719839"><code data-claire-semantic="python">session</code> représente la session de l'utilisateur. Nous découvrirons les sessions dans le chapitre suivant.</p></li><li id="r-719842" data-claire-element-id="719842"><p id="r-719841" data-claire-element-id="719841"><code data-claire-semantic="python">g</code> est un objet un peu fourre-tout où vous pouvez placer ce que bon vous semble en lui ajoutant des attributs : par exemple <code data-claire-semantic="python">g.titre = &quot;Bienvenue !&quot;</code></p></li></ul><h5 id="r-afficher-le-contenu-des-variables" data-claire-element-id="719875">Afficher le contenu des variables</h5><p id="r-719846" data-claire-element-id="719846">On a déjà vu comment faire ça juste avant : il faut se servir de <code data-claire-semantic="python">'{{'</code> et <code data-claire-semantic="python">'}}'</code>. On a également vu (avec l'exemple de l'objet <code data-claire-semantic="python">request</code>) que l'on pouvait accéder aux attributs des objets, comme en Python, en plaçant un point entre le nom de l'objet et le nom de l'attribut : <code data-claire-semantic="python">{{ obj.attr }}</code>. Cette notation, s'il n'y a pas d'attribut <code data-claire-semantic="python">attr</code>, va aller chercher s'il existe un item <code data-claire-semantic="python">'attr'</code> contenu dans <code data-claire-semantic="python">obj</code>.</p><aside id="r-719848" data-claire-element-id="719848" data-claire-semantic="information"><p id="r-719847" data-claire-element-id="719847">Vous avez oublié ce qu'est un item ? Relisez <a href="http://www.siteduzero.com/tutoriel-3-296050-les-methodes-speciales.html#ss_part_2">cette partie</a> du tuto Python.</p></aside><p id="r-719849" data-claire-element-id="719849">Inversement, si on écrit <code data-claire-semantic="python">{{ obj['attr'] }}</code>, cela va d'abord chercher si un item <code data-claire-semantic="python">attr</code> est contenu dans <code data-claire-semantic="python">obj</code>, puis, s'il n'y en a pas, si <code data-claire-semantic="python">obj</code> possède un attribut nommé <code data-claire-semantic="python">attr</code>.</p><p id="r-719850" data-claire-element-id="719850">Ce fonctionnement est le même pour les objets, les listes et les dictionnaires ! :)</p><div id="r-719852" data-claire-element-id="719852" data-claire-semantic="question"><p id="r-719851" data-claire-element-id="719851">Et s'il n'y a ni item ni attribut, tout ça plante ?</p></div><p id="r-719853" data-claire-element-id="719853">Non : cela renverra la valeur spéciale <code data-claire-semantic="javascript">undefined</code>, et cela n'affichera rien.</p><h6 id="r-creer-des-variables-dans-les-templates" data-claire-element-id="719861">Créer des variables dans les templates</h6><p id="r-719854" data-claire-element-id="719854">On n'est pas obligé de se contenter des variables passées depuis l'extérieur dans nos templates. On peut très bien créer nos propres variables ! Les entiers, float, les chaînes, les listes, tuples et dictionnaires sont disponibles. Les opérations mathématiques de base également (+, -, *, /, %, **).<br/> La syntaxe pour créer une variable est la même qu'en Python, mais précédée du mot clé <code data-claire-semantic="python">set</code> :</p><pre id="r-719855" data-claire-element-id="719855"><code data-claire-semantic="jinja">{% set menu = ['accueil', 'news', 'contact'] %}</code></pre><aside id="r-719857" data-claire-element-id="719857" data-claire-semantic="information"><p id="r-719856" data-claire-element-id="719856">Comme vous pouvez le voir, je n'ai pas mis <code data-claire-semantic="python">'{{ }}'</code> mais <code data-claire-semantic="python">'{% %}'</code>.<br/> C'est normal, <code data-claire-semantic="python">'{{ }}'</code> ne fait qu'<strong>afficher</strong> le contenu d'une variable, tandis que <code data-claire-semantic="python">'{% %}'</code> sert à tout le reste. Quand au code HTML du template, il est en dehors de ces sections.</p></aside><p id="r-719858" data-claire-element-id="719858">En faisant cela, on crée une variable appelée menu, qui est une liste. Cette variable sera accessible dans tout le reste du template. Si l'on désire que cette variable soit accessible seulement dans une certaine zone du template, alors on doit la créer dans un <strong>tag</strong><code data-claire-semantic="python">with</code> :</p><pre id="r-719859" data-claire-element-id="719859"><code data-claire-semantic="jinja">{% with menu = ['accueil', 'news', 'contact'] %}
    {{ menu[0] }}
    {{ menu[1] }}
    {{ menu[2] }}
{% endwith %}</code></pre><p id="r-719860" data-claire-element-id="719860">De cette manière, menu est inacessible en dehors des <strong>with</strong> / <strong>endwith</strong>.</p><h6 id="r-les-filtres-10" data-claire-element-id="719874">Les filtres</h6><p id="r-719862" data-claire-element-id="719862">Jinja introduit une syntaxe particulièrement élégante (à mon goût) pour appliquer une fonction sur une variable : les filtres. De nombreux filtres sont déjà prédéfinis.<br/> Les filtres s'utilisent ainsi (dans mon exemple, j'applique un filtre à une variable appelée x :</p><pre id="r-719863" data-claire-element-id="719863"><code data-claire-semantic="jinja">{{ x|filtre }}
{# ou, si le filtre utilisé dispose de paramètres : #}
{{ x|filtre('parametre') }}</code></pre><aside id="r-719865" data-claire-element-id="719865" data-claire-semantic="information"><p id="r-719864" data-claire-element-id="719864">Au passage, vous découvrez la syntaxe nécessaire à l'insertion de commentaires dans les templates Jinja : <code data-claire-semantic="python">'{# #}'</code></p></aside><p id="r-719866" data-claire-element-id="719866">En fin de compte, l'application de filtres utilise la même syntaxe que l'appel d'une méthode, sauf que l'on remplace le symbole <code data-claire-semantic="python">'.'</code> par <code data-claire-semantic="python">'|'</code> (ce symbole est accessible en faisant AltGr+6 (Shift+Alt+L sous Mac). Et sauf que les filtres ne sont pas des méthodes propres à une classe, ce sont simplement des fonctions.</p><p id="r-719867" data-claire-element-id="719867">Il existe beaucoup de filtres disponibles dans Jinja, certains sont là uniquement pour la mise en forme, d'autres non. La liste de tous ces filtres est disponible dans <a href="http://jinja.pocoo.org/docs/templates/#list-of-builtin-filters">la documentation de Jinja</a>. Voici néanmoins quelques exemples :</p><ul id="r-719872" data-claire-element-id="719872"><li id="r-719869" data-claire-element-id="719869"><p id="r-719868" data-claire-element-id="719868"><code data-claire-semantic="python">capitalize</code> : ce filtre met en majuscule la première lettre d'une chaîne et en minuscule la suite. Pas de paramètres. Exemple : <code data-claire-semantic="python">{{ titre|capitalize }}</code></p></li><li id="r-719871" data-claire-element-id="719871"><p id="r-719870" data-claire-element-id="719870"><code data-claire-semantic="python">join</code> : concatène les valeurs d'une liste en les séparant par le délimiteur passé en paramètre (qui vaut par défaut ''). Cela fonctionne comme la méthode <code data-claire-semantic="python">join</code> de <code data-claire-semantic="python">str</code>. Exemple : <code data-claire-semantic="python">{{ [&quot;Salut&quot;, &quot;Les&quot;, &quot;Zéros&quot;] | join(', ') }}</code></p></li></ul><p id="r-719873" data-claire-element-id="719873">Nous en verrons quelques autres dans la suite de ce chapitre.</p><h5 id="r-les-conditions-37" data-claire-element-id="719889">Les conditions</h5><p id="r-719876" data-claire-element-id="719876">Les conditions se font de la même manière qu'en Python : <code data-claire-semantic="python">if / elif / else</code>. Et comme il ne s'agit pas d'un affichage, on utilise les balises <code data-claire-semantic="python">'{% %}'</code> et non <code data-claire-semantic="python">'{{ }}'</code>.<br/> Cependant, Python se base sur l'indentation, alors que Jinja non (vous pouvez placer vos balises comme vous le souhaitez, l'indentation ne compte pas). Par conséquent, il faut préciser la fin du bloc <code data-claire-semantic="python">if / elif / else</code> grâce à un mot clé spécial, <strong>endif</strong>.</p><p id="r-719877" data-claire-element-id="719877">Voilà un exemple simple d'utilisation des conditions :</p><pre id="r-719878" data-claire-element-id="719878"><code data-claire-semantic="jinja">&lt;p&gt;
{% if age &lt; 18 %}
    Halte là ! Accès non autorisé aux mineurs.
{% elif age &lt; 90 %}
    Accès autorisé. Enjoy !
{% else %}
    Allez-y doucement.
{% endif %}
&lt;/p&gt;</code></pre><p id="r-719879" data-claire-element-id="719879">Maintenant voilà un autre exemple réutilisant ce qu'on a découvert juste auparavant (la déclaration de variables et les filtres) :</p><pre id="r-719880" data-claire-element-id="719880"><code data-claire-semantic="jinja">{% set age = &quot;20&quot; %}
{% if age|int == 20 %}
    &lt;p&gt;Vous avez 20 ans tout pile, vous bénéficiez d'une remise exceptionnelle !&lt;/p&gt;
{% endif %}</code></pre><p id="r-719881" data-claire-element-id="719881">On utilise là le filtre <code data-claire-semantic="python">int</code> qui convertit une valeur en entier.</p><p id="r-719882" data-claire-element-id="719882">Dans les conditions, vous pouvez utiliser les opérateurs habituels : <code data-claire-semantic="python">==, !=, &lt;, &gt;, &lt;=, &gt;=, is, and, or, not, in</code>.</p><h6 id="r-les-tests-integres-a-jinja2" data-claire-element-id="719888">Les tests intégrés à Jinja2</h6><p id="r-719883" data-claire-element-id="719883">Les tests sont des fonctions disponibles dans Jinja et qui s'utilisent dans les conditions grâce au mot clé <code data-claire-semantic="python">is</code>. Tout comme les filtres, il existe des tests qui ne prennent pas de paramètres, et d'autre qui en nécessitent. La liste de tous ces tests est disponible dans <a href="http://jinja.pocoo.org/docs/templates/#list-of-builtin-tests">la documentation de Jinja</a>.<br/> Voici deux exemples, avec les tests <code data-claire-semantic="python">defined</code> et <code data-claire-semantic="python">divisibleby</code> :</p><pre id="r-719884" data-claire-element-id="719884"><code data-claire-semantic="jinja">{% if truc is defined %}
    &lt;p&gt;La variable truc n'est pas undefined.&lt;/p&gt;
{% endif %}</code></pre><aside id="r-719886" data-claire-element-id="719886" data-claire-semantic="information"><p id="r-719885" data-claire-element-id="719885">J'ai parlé de ce que signifiait undefined juste au dessus, j'espère que vous n'avez pas déjà oublié. o_O</p></aside><pre id="r-719887" data-claire-element-id="719887"><code data-claire-semantic="jinja">{% set age = 20 %}
{% if age is divisibleby(10) %}
    &lt;p&gt;Votre âge est un multiple de 10.&lt;/p&gt;
{% endif %}</code></pre><h5 id="r-les-boucles-31" data-claire-element-id="719898">Les boucles</h5><p id="r-719890" data-claire-element-id="719890">Pour les boucles, il n'y a pas non plus beaucoup de nouveautés par rapport aux boucles en Python. On a même déjà vu un exemple de boucle <code data-claire-semantic="python">for</code> dans l'introduction.<br/> Cependant, il n'y a pas de boucles <code data-claire-semantic="python">while</code> dans Jinja. Et, comme l'indentation ne compte pas ici non plus, il faut terminer le bloc de la boucle <code data-claire-semantic="python">for</code> par le mot clé <strong>endfor</strong>.<br/> L'exemple que nous avions vu était :</p><pre id="r-719891" data-claire-element-id="719891"><code data-claire-semantic="jinja">&lt;ul&gt;
{% for mot in mots %}
    &lt;li&gt;{{ mot }}&lt;/li&gt;
{% endfor %}
&lt;/ul&gt;</code></pre><p id="r-719892" data-claire-element-id="719892">On peut inverser l'affichage en appliquant un filtre <code data-claire-semantic="python">reverse</code> sur la liste <code data-claire-semantic="python">mots</code> :</p><pre id="r-719893" data-claire-element-id="719893"><code data-claire-semantic="jinja">&lt;ul&gt;
{% for mot in mots|reverse %}
    &lt;li&gt;{{ mot }}&lt;/li&gt;
{% endfor %}
&lt;/ul&gt;</code></pre><p id="r-719894" data-claire-element-id="719894">Si l'on ne désire afficher que les 10 premiers mots:</p><pre id="r-719895" data-claire-element-id="719895"><code data-claire-semantic="jinja">{% if mots|length &gt; 10 %}
    &lt;ul&gt;
    {% for i in range(10) %}
        &lt;li&gt;{{ mots[i] }}&lt;/li&gt;
    {% endfor %}
    &lt;/ul&gt;
{% else %}
    &lt;p&gt;Vous devez entrer dix mots au minimum.&lt;/p&gt;
{% endif %}</code></pre><aside id="r-719897" data-claire-element-id="719897" data-claire-semantic="information"><p id="r-719896" data-claire-element-id="719896">Cet exemple inutile était destiné à vous présenter le filtre <code data-claire-semantic="python">length</code> ainsi que la fonction <code data-claire-semantic="python">range(</code>), disponibles dans Jinja. Quelques autres fonctions sont intégrées dans Jinja comme on le voit dans <a href="http://jinja.pocoo.org/docs/templates/#list-of-global-functions">la documentation</a>.</p></aside><h5 id="r-include-3" data-claire-element-id="719907">Include</h5><p id="r-719899" data-claire-element-id="719899">Nos templates commencent à être bien pratiques, mais il reste un problème essentiel : le code se répète entre nos templates, ce qui induit des risques d'erreur lors des modifications, et ce qui alourdit la quantité totale de code inutilement.<br/> C'est sur ce problème que vont intervenir l'héritage de templates (que l'on verra juste après), ainsi qu'include, que l'on va voir tout de suite.</p><p id="r-719900" data-claire-element-id="719900">Include permet, comme son nom l'indique, d'aller inclure le contenu d'un autre fichier template, comme si on effectuait un copier-coller du contenu. Cela peut se révéler particulièrement utile, si, par exemple, tous nos templates commencent ainsi :</p><pre id="r-719901" data-claire-element-id="719901"><code data-claire-semantic="jinja">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot; /&gt;
        &lt;title&gt;{{ titre }}&lt;/title&gt;
        &lt;link href=&quot;{{ url_for('static', filename='style.css') }}&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;
    &lt;/head&gt;</code></pre><p id="r-719902" data-claire-element-id="719902">Dans un cas comme celui là, il suffit de placer ce code dans un template nommé par exemple <code>header.html</code>, puis, dans les templates qui voudront inclure ce code, il suffira de placer, à l'endroit désiré :</p><pre id="r-719903" data-claire-element-id="719903"><code data-claire-semantic="python">{{ include 'header.html' }}</code></pre><p id="r-719904" data-claire-element-id="719904">Par conséquent, il faudra veiller à ce que les templates qui incluront <code data-claire-semantic="jinja">header.html</code> connaissent tous une variable nommée <code data-claire-semantic="python">titre</code>, sinon vous vous retrouverez avec des pages sans titre.</p><aside id="r-719906" data-claire-element-id="719906" data-claire-semantic="information"><p id="r-719905" data-claire-element-id="719905">En réalité, on n'utilisera pas include pour ce genre de choses, on préfèrera utiliser l'héritage de templates. Include sera plutôt utile, si, par exemple, certaines pages de votre site affichent un gros formulaire : il vous suffira d'écrire une seule fois ce formulaire dans un template séparé et de l'inclure. Votre code sera mieux découpé.</p></aside><h5 id="r-le-meilleur-pour-la-fin-l-heritage" data-claire-element-id="719940">Le meilleur pour la fin : l'héritage</h5><div id="r-719909" data-claire-element-id="719909" data-claire-semantic="question"><p id="r-719908" data-claire-element-id="719908">Euh, l'héritage, ce n'est pas pour les classes en Python ? o_O</p></div><p id="r-719910" data-claire-element-id="719910">Si, et c'est extrêmement pratique, à tel point qu'un concept similaire existe avec les templates Jinja. :)</p><p id="r-719911" data-claire-element-id="719911">L'idée de base est que, au fond, la plupart des pages de notre site sont composées du même squelette, seul le contenu change un peu. On a vu qu'on pouvait utiliser include pour simplifier cela, mais l'héritage de templates est plus puissant. Son principe est de structurer une page en une série de “blocks”. Les blocks du template parent qu'on ne veut pas changer dans les templates enfants n'ont pas à être reprécisés. Par contre, ceux que l'on veut modifier n'ont qu'à être réécrits en remplaçant leur contenu par ce que l'on veut.<br/> Ne vous inquiétez pas si ça n'est pas clair, ça ira mieux avec un petit exemple :</p><p id="r-719912" data-claire-element-id="719912">On va se contenter de deux templates :</p><ul id="r-719917" data-claire-element-id="719917"><li id="r-719914" data-claire-element-id="719914"><p id="r-719913" data-claire-element-id="719913">un template qui ne contiendra que le squelette du site</p></li><li id="r-719916" data-claire-element-id="719916"><p id="r-719915" data-claire-element-id="719915">un autre qui sera utilisé par la page contact de notre site.</p></li></ul><p id="r-719918" data-claire-element-id="719918">Voyons tout d'abord le template <code data-claire-semantic="python">squelette.html</code>. C'est une page HTML classique dans laquelle on précise des blocks :</p><pre id="r-719919" data-claire-element-id="719919"><code data-claire-semantic="jinja">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
    {% block header %}
        &lt;meta charset=&quot;utf-8&quot; /&gt;
        &lt;title&gt;{% block titre %}Titre par défaut{% endblock %}&lt;/title&gt;
    {% endblock %}
    &lt;/head&gt;

    &lt;body&gt;
        {% block corps %}{% endblock %}        
        {% block footer %}{% endblock %}
    &lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-719920" data-claire-element-id="719920">Comme vous le voyez, un block se crée en faisant :</p><pre id="r-719921" data-claire-element-id="719921"><code data-claire-semantic="jinja">{% block nom_du_block %}{% endblock %}</code></pre><p id="r-719922" data-claire-element-id="719922">Un block peut être initialement vide (il pourra être rempli dans les templates fils), ou il peut contenir déjà du code (qui sera donc présent dans les templates fils, par défaut). Comme on le voit dans cet exemple, un block peut contenir d'autres blocks, ça n'est pas un problème.<br/> Voyons maintenant comment réaliser le template de la page contact :</p><pre id="r-719923" data-claire-element-id="719923"><code data-claire-semantic="jinja">{% extends &quot;squelette.html&quot; %}

{% block titre %}Page de contact{% endblock %}

{% block corps %}
&lt;h1&gt;Page de contact&lt;/h1&gt;
&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;
    &lt;input type=&quot;text&quot; name=&quot;nom&quot; value=&quot;Votre nom&quot; /&gt;
    &lt;textarea name=&quot;message&quot;&gt;Votre message ici.&lt;/textarea&gt;
    &lt;input type=&quot;submit&quot; value=&quot;Envoyer&quot; /&gt;
&lt;/form&gt;
{% endblock %}


{% block footer %}
&lt;footer&gt;Copyright monsite.fr 2009-2012&lt;/footer&gt;
{% endblock %}</code></pre><p id="r-719924" data-claire-element-id="719924">On note plusieurs choses :</p><ul id="r-719931" data-claire-element-id="719931"><li id="r-719926" data-claire-element-id="719926"><p id="r-719925" data-claire-element-id="719925">Pour préciser qu'on souhaite hériter du template <code data-claire-semantic="python">squelette.html</code>, on utilise le tag <strong>extends</strong> en lui précisant simplement le nom du template.</p></li><li id="r-719928" data-claire-element-id="719928"><p id="r-719927" data-claire-element-id="719927">On peut changer le contenu d'un block en le réécrivant (ici on change le titre de la page de cette manière).</p></li><li id="r-719930" data-claire-element-id="719930"><p id="r-719929" data-claire-element-id="719929">On peut mettre du contenu dans les blocks qui étaient vides (exemple avec les blocks corps et footer).</p></li></ul><p id="r-719932" data-claire-element-id="719932">L'avantage est qu'on a pas besoin de repréciser le squelette HTML de la page, on se contente simplement de remplir les blocks. On aurait même pu créer de nouveaux blocks, à l'intérieur du formulaire par exemple, et ensuite remplir ces blocks dans un template fils, et ainsi de suite.</p><p id="r-719933" data-claire-element-id="719933">Il reste néanmoins un détail gênant : on écrit deux fois le titre de la page (une fois dans le block titre, qui va remplir la balise <code data-claire-semantic="html">&lt;title&gt;</code>, et une deuxième fois dans la balise <code data-claire-semantic="html">&lt;h1&gt;</code>), alors que le titre est le même. Pour éviter cela, on peut afficher le contenu du block titre dans la balise <code data-claire-semantic="html">&lt;h1&gt;</code> :</p><pre id="r-719934" data-claire-element-id="719934"><code data-claire-semantic="jinja">&lt;h1&gt;{{ self.titre() }}&lt;/h1&gt;</code></pre><pre id="r-719935" data-claire-element-id="719935"><code data-claire-semantic="python">self.nom_du_block()</code></pre><p id="r-719936" data-claire-element-id="719936">renvoie le contenu du block <code data-claire-semantic="python">nom_du_block</code> (<code data-claire-semantic="python">self</code> représente le template actuel).</p><p id="r-719937" data-claire-element-id="719937">Il existe une autre astuce, très pratique quand on veut <strong>garder</strong> le contenu du block du parent, mais y <strong>rajouter</strong> quelque chose en plus. Par exemple, on pourrait imaginer vouloir garder le contenu du block header, mais y rajouter un <code data-claire-semantic="html">&lt;link&gt;</code> CSS. Pour cela, on peut utiliser <code data-claire-semantic="python">super()</code>, qui renvoie le contenu du même block dans le parent :</p><pre id="r-719938" data-claire-element-id="719938"><code data-claire-semantic="jinja">{% block header %}
    {{ super() }} {# renvoie le contenu du block header (celui où l'on se situe) du template parent (squelette.html) #}
    &lt;link href=&quot;{{ url_for('static', filename='style_contact.css') }}&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;
{% endblock %}</code></pre><p id="r-719939" data-claire-element-id="719939">L'héritage de templates simplifie vraiment le contenu des templates en vous évitant de vous répéter inutilement. Tout comme avec include, n'oubliez pas, dans vos vues, de donner des valeurs aux variables utilisées dans les templates parents.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
<span class="arrow"></span>
<span class="next">Une fausse bonne idée...</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
<span class="next">Les templates, côté progammeur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lestemplatesctprogammeur"></a><h2>Les templates, côté progammeur</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
<span class="arrow"></span>
<span class="next">Les templates, côté utilisateur</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
<span class="next">Flash</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-templates-cote-progammeur" data-claire-element-id="719978">Les templates, côté progammeur</h4><p id="r-719942" data-claire-element-id="719942">Maintenant que vous savez parfaitement utiliser les templates, découvrons comment étendre leurs possibilités, si par hasard les filtres, les tests et les fonctions pré-intégrées ne vous suffisaient pas. ;) <br/> C'est très simple, car les filtres et les tests ne sont en fait que de simples fonctions, à écrire dans votre code Python.</p><h5 id="r-rendre-ses-fonctions-utilisables-dans-les-templates" data-claire-element-id="719946">Rendre ses fonctions utilisables dans les templates</h5><p id="r-719943" data-claire-element-id="719943">Pour passer les fonctions aux templates, cela se fait de l'une des manières que l'on a vues pour passer les variables, avec <code data-claire-semantic="python">@app.context_processor</code> :</p><pre id="r-719944" data-claire-element-id="719944"><code data-claire-semantic="python">@app.context_processor
def passer_aux_templates():
    def formater_distance(dist):
        unite = 'm'
        if dist &gt; 1000:
            dist /= 1000.0
            unite = 'km'
        return u'{0:.2f}{1}'.format(dist, unite)
    return dict(format_dist=formater_distance)</code></pre><p id="r-719945" data-claire-element-id="719945">De cette manière, la fonction <code data-claire-semantic="python">formater_distance</code> sera disponible dans les templates sous le nom <code data-claire-semantic="python">format_dist</code>. Cela dit, on préfère généralement utiliser les filtres pour cela, et écrire <code data-claire-semantic="python">distance|format_dist</code> plutôt que <code data-claire-semantic="python">format_dist(distance)</code>.<br/> Voyons donc comment créer ses propres filtres.</p><h5 id="r-creer-ses-propres-filtres" data-claire-element-id="719950">Créer ses propres filtres</h5><p id="r-719947" data-claire-element-id="719947">Flask nous met à disposition un autre décorateur appelé <code data-claire-semantic="python">@app.template_filter('nom_du_filtre_dans_le_template')</code> pour créer ses propres filtres.</p><pre id="r-719948" data-claire-element-id="719948"><code data-claire-semantic="python">@app.template_filter('format_dist')
def formater_distance(dist):
    unite = 'm'
    if dist &gt; 1000:
        dist /= 1000.0
        unite = 'km'
    return u'{0:.2f}{1}'.format(dist, unite)</code></pre><p id="r-719949" data-claire-element-id="719949">(Le code de la fonction n'a pas changé)<br/> En faisant comme cela, on peut utiliser <code data-claire-semantic="python">distance|format_dist</code> ! :magicien: <br/> Si l'on veut créer un filtre prenant des paramètres, il suffit de rajouter des paramètres à cette fonction. Le premier paramètre (en l'occurence, <code data-claire-semantic="python">dist</code>) représente toujours l'objet auquel on applique le filtre dans le template.</p><h5 id="r-creer-ses-propres-tests" data-claire-element-id="719960">Créer ses propres tests</h5><p id="r-719951" data-claire-element-id="719951">C'est encore la même chose : il suffit d'écrire une fonction dans le code Python puis de la passer aux templates en précisant qu'il s'agit d'un test. Dans cet exemple, on va créer un test pour savoir si un nombre est impair, que l'on utilisera ainsi dans les templates :</p><pre id="r-719952" data-claire-element-id="719952"><code data-claire-semantic="jinja">{% if nombre is impair %}
    {{ nombre }} est impair.
{% else %}
    {{ nombre }} est pair.
{% endif %}</code></pre><p id="r-719953" data-claire-element-id="719953">Commençons par créer la fonction. Tout comme pour les filtres, le premier paramètre de cette fonction sera l'objet auquel on l'applique dans le template (c'est à dire l'objet avant le “<code data-claire-semantic="python">is</code>”).</p><pre id="r-719954" data-claire-element-id="719954"><code data-claire-semantic="python">def est_impair(n):
    if n % 2 == 1:
        return True
    return False</code></pre><p id="r-719955" data-claire-element-id="719955">Puis rendons accessible cette fonction en tant que test Jinja portant le nom <code data-claire-semantic="python">impair</code> :</p><pre id="r-719956" data-claire-element-id="719956"><code data-claire-semantic="python">app.jinja_env.tests['impair'] = est_impair</code></pre><p id="r-719957" data-claire-element-id="719957">Malheureusement, il n'existe pas de décorateur pour faire cela. :'(</p><aside id="r-719959" data-claire-element-id="719959" data-claire-semantic="information"><p id="r-719958" data-claire-element-id="719958">De la même manière, on peut passer un filtre à Jinja en faisant <code data-claire-semantic="python">app.jinja_env.filters['format_dist'] = formater_distance</code>, et on peut passer une fonction (ou même une classe) en faisant <code data-claire-semantic="python">app.jinja_env.globals['fonction'] = ma_fonction</code></p></aside><h5 id="r-creer-des-macros-jinja" data-claire-element-id="719977">Créer des macros Jinja</h5><p id="r-719961" data-claire-element-id="719961">Une dernière manière d'augmenter les possibilités de Jinja est la création de macros. À la différence de la création de fonctions, de filtres ou de tests, cela ne se passe pas dans le code Python, mais uniquement dans les templates.<br/> Les macros ne sont ni plus ni moins que des fonctions, leur seul intérêt est de facilement afficher du HTML étant donné qu'elles bénéficient de la puissance des templates.</p><p id="r-719962" data-claire-element-id="719962">Par exemple, si vous êtes lassés d'écrire des balises <code data-claire-semantic="html">&lt;link&gt;</code> à rallonge, parce que vous utilisez de nombreux fichiers CSS différents selon les templates, vous pouvez vous simplifier la vie avec une macro :</p><pre id="r-719963" data-claire-element-id="719963"><code data-claire-semantic="jinja">{% macro link(nom_fichiers, extension='css') %}
    {% for fichier in nom_fichiers %}
        &lt;link href=&quot;{{ url_for('static', filename=fichier + '.' + extension) }}&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;
    {% endfor %}
{% endmacro %}</code></pre><p id="r-719964" data-claire-element-id="719964">Et hop, grâce à cette petite macro, vous pourrez remplacer les interminables :</p><pre id="r-719965" data-claire-element-id="719965"><code data-claire-semantic="jinja">&lt;link href=&quot;{{ url_for('static', filename=&quot;4.css&quot;) }}&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;
&lt;link href=&quot;{{ url_for('static', filename=&quot;8.css&quot;) }}&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;
&lt;link href=&quot;{{ url_for('static', filename=&quot;15.css&quot;) }}&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;
&lt;link href=&quot;{{ url_for('static', filename=&quot;16.css&quot;) }}&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;</code></pre><p id="r-719966" data-claire-element-id="719966">Par un simple :</p><pre id="r-719967" data-claire-element-id="719967"><code data-claire-semantic="jinja">{{ link['4', '8', '15', '16'] }}</code></pre><h6 id="r-utiliser-les-macros-definies-dans-un-autre-template" data-claire-element-id="719976">Utiliser les macros définies dans un autre template</h6><p id="r-719968" data-claire-element-id="719968">Ce cas est très courant : en pratique, on a même souvent tendance à mettre toutes ses macros dans un seul template, et à les importer dans les templates où on en a besoin. L'import se fait de la même manière qu'en Python :</p><pre id="r-719969" data-claire-element-id="719969"><code data-claire-semantic="jinja">{% from 'mes_macros.html' import link %}</code></pre><p id="r-719970" data-claire-element-id="719970">ou bien :</p><pre id="r-719971" data-claire-element-id="719971"><code data-claire-semantic="jinja">{% import 'mes_macros.html' as macros %}</code></pre><p id="r-719972" data-claire-element-id="719972">ou encore :</p><pre id="r-719973" data-claire-element-id="719973"><code data-claire-semantic="jinja">{% from 'mes_macros.html' import link as generer_css %}</code></pre><p id="r-719974" data-claire-element-id="719974">... et voilà pour les macros.</p><p id="r-719975" data-claire-element-id="719975">Même si cela semble faire beaucoup de nouveautés, la syntaxe de Jinja reprend celle de Python sur de nombreux points, vous ne devriez donc normalement pas vous perdre. <br/> Votre apprentissage des templates est terminé, finissons ce chapitre en douceur avec la découverte d'une fonction bien pratique de Flask. :)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
<span class="arrow"></span>
<span class="next">Les templates, côté utilisateur</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
<span class="next">Flash</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Flash"></a><h2>Flash</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
<span class="arrow"></span>
<span class="next">Les templates, côté progammeur</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">
<span class="next">L&#039;échange de données</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-flash-2" data-claire-element-id="720007">Flash</h4><p id="r-719979" data-claire-element-id="719979">Je vous rassure, je ne parlerais pas ici du tristement célèbre module d'Adobe, mais d'une petite fonctionnalité introduite par Flask, extrêmement pratique pour notifier le visiteur de différents messages.</p><p id="r-719980" data-claire-element-id="719980">Exemple typique : quand le visiteur vous écrit un long mail sur votre page de contact, et valide le formulaire, il est bien plus agréable de voir apparaître un message &quot;Votre mail a bien été envoyé !&quot;, plutôt que simplement faire réafficher la page. Il en est de même pour toutes les autres actions que peut effectuer un visiteur : il est important qu'il sache toujours où il en est, si ce qu'il vient d'effectuer a fonctionné, ou sinon, pourquoi cela a échoué.</p><p id="r-719981" data-claire-element-id="719981">Flask propose donc deux fonctions pour faciliter la mise en place d'un tel système : <code data-claire-semantic="python">flash()</code> et <code data-claire-semantic="python">get_flashed_messages()</code>.</p><aside id="r-719983" data-claire-element-id="719983" data-claire-semantic="information"><p id="r-719982" data-claire-element-id="719982">Pour des raisons mystérieuses, app.secret_key doit être définie pour que flash fonctionne.</p></aside><h5 id="r-flash-1" data-claire-element-id="719988">flash()</h5><p id="r-719984" data-claire-element-id="719984">Reprenons l'exemple que je viens de citer :</p><pre id="r-719985" data-claire-element-id="719985"><code data-claire-semantic="python">@app.route('/contact', methods=['GET', 'POST'])
def contact():
    if request.method == 'POST':
        if donnees_envoyees_correctes:
            flash(u'Votre message a bien été envoyé !')
            traiter_donnees()
        else:
            flash(u'Erreur dans les données envoyées.')
    return render_template('contact.html')</code></pre><p id="r-719986" data-claire-element-id="719986">Comme vous le voyez, <code data-claire-semantic="python">flash</code> prend simplement une chaîne en paramètre. Il s'agit du message qui sera affiché au visiteur. A chaque nouveau flash, un message est ajouté à la liste des messages flashés.</p><p id="r-719987" data-claire-element-id="719987">Ensuite, dans le template, il suffit de récupérer les messages flashés et de les afficher. Flask nous fournit pour cela la fonction <code data-claire-semantic="python">get_flashed_messages()</code>.</p><h5 id="r-get-flashed-message" data-claire-element-id="719996">get_flashed_message()</h5><p id="r-719989" data-claire-element-id="719989">Cette fonction renvoie simplement les messages flashés sous la forme d'une liste. Il suffit donc de la parcourir.<br/> Dans cet exemple, l'affichages des messages flashés sera réalisé dans le template <code data-claire-semantic="python">squelette.html</code>, dont le template <code data-claire-semantic="python">contact.html</code> héritera.. En effet, généralement, on désire que les messages flashés s'affichent quelle que soit la page du site web, il est donc avantageux de placer cette partie dans le template parent.</p><p id="r-719990" data-claire-element-id="719990"><strong>squelette.html :</strong></p><pre id="r-719991" data-claire-element-id="719991"><code data-claire-semantic="jinja">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot; /&gt;
        &lt;title&gt;{% block title %}{% endblock %}&lt;/title&gt;
    &lt;/head&gt;

    &lt;body&gt;
        &lt;h1&gt;{{ self.title() }}&lt;/h1&gt;
        {% with messages = get_flashed_messages() %}
        {% if messages %}
            &lt;ul&gt;
            {% for m in messages %}
                &lt;li&gt;{{ m }}&lt;/li&gt;
            {% endfor %}
            &lt;/ul&gt;
        {% endif %}
        {% endwith %}
        {% block contenu %}{% endblock %}
    &lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-719992" data-claire-element-id="719992"><strong>contact.html :</strong></p><pre id="r-719993" data-claire-element-id="719993"><code data-claire-semantic="jinja">{% extends '3.html' %}

{% block title %}Contact{% endblock %}

{% block contenu %}
        &lt;p&gt;Laissez moi un message en remplissant ce formulaire :&lt;/p&gt;
        &lt;form action=&quot;&quot; method=&quot;post&quot;&gt;
            &lt;label for=&quot;msg&quot;&gt;Votre message&lt;/label&gt;&lt;br /&gt;
            &lt;textarea id=&quot;msg&quot; name=&quot;msg&quot;&gt;&lt;/textarea&gt;&lt;br /&gt;
            &lt;input type=&quot;submit&quot; value=&quot;Envoyer&quot;&gt;
        &lt;/form&gt;
{% endblock %}</code></pre><p id="r-719994" data-claire-element-id="719994"><strong>↳ Essayer ce code (en version complète) : <a href="http://tutoflask.fspot.org/2-2/contact">'/contact'</a></strong></p><p id="r-719995" data-claire-element-id="719995">Pour tester un cas où il y à une erreur de formulaire, laissez celui-ci vide.</p><h5 id="r-flasher-ses-messages-par-categories" data-claire-element-id="720006">Flasher ses messages par catégories</h5><p id="r-719997" data-claire-element-id="719997">Le code précédent fonctionne bien, malheureusement il affiche de la même façon les messages de succès et les messages d'erreur. En plus, si nous avions plusieurs messages de chacun de ces types, ils se retrouveraient tous mélangés !<br/> C'est pour cela que l'on peut associer les messages flashés à une catégorie. Dans notre exemple, il serait utile d'avoir les catégories <code data-claire-semantic="python">'succes'</code> et <code data-claire-semantic="python">'erreur'</code>.</p><p id="r-719998" data-claire-element-id="719998">Pour affecter une catégorie à un message, il suffit de passer le nom de la catégorie en deuxième paramètre à <code data-claire-semantic="python">flash</code> :</p><pre id="r-719999" data-claire-element-id="719999"><code data-claire-semantic="python">flash(u'Erreur dans les données envoyées.', 'erreur')</code></pre><p id="r-720000" data-claire-element-id="720000">Par la suite, quand on souhaite récupérer certaines catégories précises dans le template, il suffit d'en passer la liste à <code data-claire-semantic="python">get_flashed_message()</code> grâce au paramètre <code data-claire-semantic="python">category_filter</code> :</p><pre id="r-720001" data-claire-element-id="720001"><code data-claire-semantic="jinja">{% with msg_erreur = get_flashed_messages(category_filter=[&quot;erreur&quot;]) %}</code></pre><p id="r-720002" data-claire-element-id="720002">Je vous laisse (à titre d'exercice) modifier le code précédent pour qu'on affiche en priorité les messages d'erreur en rouge, puis les messages de succès en vert. :) <br/> Une fois cela fait et bien compris (ainsi que tout le reste du chapitre), place au QCM !</p><p id="r-720003" data-claire-element-id="720003">Ouf, encore un chapitre bien long qui s'achève !<br/> Mais avouez que les templates sont terriblement pratiques et élégants. :) <br/> Cependant il y a quelque chose qui doit vous fatiguer un peu... N'est-ce pas rageant de ne toujours pas savoir comment récupérer les données des formulaires avec Flask ? Si ?</p><aside id="r-720005" data-claire-element-id="720005" data-claire-semantic="information"><p id="r-720004" data-claire-element-id="720004">Eh bien le temps est enfin venu de découvrir ce mystère, et bien d'autres, dans le chapitre suivant, consacré à l'échange de données avec Flask ! :waw:</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
<span class="arrow"></span>
<span class="next">Les templates, côté progammeur</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">
<span class="next">L&#039;échange de données</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="L039changededonnes"></a><h2>L&#039;échange de données</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
<span class="arrow"></span>
<span class="next">Flash</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
<span class="next">Introduction</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-720009" data-claire-element-id="720009">Nous y voilà enfin ! Après avoir découvert les rudiments de Flask, l'utilisation des requêtes et réponses HTTP, et la création de templates, nous allons enfin découvrir comment récupérer les données envoyées par le visiteur, qu'il s'agisse des données d'un formulaire, ou autres.<br/> C'est également dans ce chapitre que nous allons apprendre à identifier le visiteur, grâce aux sessions. Enfin, nous apprendrons à envoyer des cookies au visiteur puis à les récupérer à sa prochaine visite, ce qui sera par exemple utile pour lui éviter de s'identifier à chaque fois.</p><p id="r-720010" data-claire-element-id="720010">Une fois ce chapitre fini, nous pourrons passer à notre premier TP ! :)</p>
</div><a name="Introduction"></a><h2>Introduction</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">
<span class="arrow"></span>
<span class="next">L&#039;échange de données</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
<span class="next">Les formulaires</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-introduction-19" data-claire-element-id="720015">Introduction</h4><p id="r-720011" data-claire-element-id="720011">Vous devriez maintenant le savoir par cœur : les données que nous envoie le client sont stockées dans la requête HTTP. Pour les récupérer, il faudra donc aller voir le contenu de l'objet <code data-claire-semantic="python">request</code>, comme on l'a déjà fait.</p><p id="r-720012" data-claire-element-id="720012">D'ailleurs, avant d'aller plus loin, je tiens à vous rappeler qu'il y a beaucoup de choses dans l'objet <code data-claire-semantic="python">request</code>, notamment des petites informations que votre navigateur envoie aux serveurs HTTP sans que vous vous en doutiez. Il est parfois pratique de s'en servir.</p><p id="r-720013" data-claire-element-id="720013">Par exemple, l'objet <code data-claire-semantic="python">request</code> possède un attribut <code data-claire-semantic="python">remote_addr</code>, qui contient (sous la forme d'une chaîne) l'adresse IP du client.<br/> Autre exemple, l'attribut <code data-claire-semantic="python">user_agent</code> de <code data-claire-semantic="python">request</code> contient un objet de la classe <code data-claire-semantic="python">UserAgent</code>. Cet objet contient plusieurs informations sur le client, notamment le navigateur utilisé et le système d'exploitation du client, accessibles respectivement par <code data-claire-semantic="python">request.user_agent.browser</code> et <code data-claire-semantic="python">request.user_agent.platform</code>.</p><p id="r-720014" data-claire-element-id="720014">Je vous invite à faire un petit <code data-claire-semantic="python">dump(request)</code> dans le debugger de Flask pour découvrir ce que l'objet request a encore dans le ventre.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">
<span class="arrow"></span>
<span class="next">L&#039;échange de données</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
<span class="next">Les formulaires</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesformulaires"></a><h2>Les formulaires</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
<span class="arrow"></span>
<span class="next">Introduction</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
<span class="next">Les Query String</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-formulaires-7" data-claire-element-id="720036">Les formulaires</h4><p id="r-720016" data-claire-element-id="720016">Nous y voilà. Enfin.<br/> Attaquons sans plus attendre : créons une vue contact (vous devriez avoir l'habitude à force ;) ), accessible via les méthodes GET et POST, qui affiche un formulaire dans le cas de GET.</p><pre id="r-720017" data-claire-element-id="720017"><code data-claire-semantic="python">@app.route('/contact', methods=['GET', 'POST'])
def contact():
    if request.method == 'POST':
        return &quot;Vous avez envoyé un message...&quot;
    return '&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;&lt;input type=&quot;text&quot; name=&quot;msg&quot; /&gt;&lt;input type=&quot;submit&quot; value=&quot;Envoyer&quot; /&gt;&lt;/form&gt;</code></pre><aside id="r-720019" data-claire-element-id="720019" data-claire-semantic="information"><p id="r-720018" data-claire-element-id="720018">Vous remarquerez que l'on précise dans la balise <code data-claire-semantic="html">&lt;form&gt;</code> que la méthode HTTP employée pour valider le formulaire doit être POST. Sans cela, notre code ne pourrait pas fonctionner ! <br/> Nous verrons dans la partie suivante comment récupérer le contenu d'un formulaire envoyé en GET.</p></aside><p id="r-720020" data-claire-element-id="720020">Bien. Nous aimerions récupérer le message envoyé par le visiteur et le lui afficher. Pour cela, il faut utiliser l'attribut <code data-claire-semantic="python">form</code> de l'objet <code data-claire-semantic="python">request</code>, qui contient toutes les données du formulaire envoyé en POST. Cet attribut <code data-claire-semantic="python">form</code> est un dictionnaire qui associe la valeur à l'attribut <code data-claire-semantic="python">name</code> du champ du formulaire. En l'occurence, l'attribut <code data-claire-semantic="python">name</code> du champ texte vaut <code data-claire-semantic="python">&quot;msg&quot;</code>. Pour récupérer son contenu il faudra donc faire <code data-claire-semantic="python">request.form['msg']</code>. <br/> Et... c'est tout.</p><pre id="r-720021" data-claire-element-id="720021"><code data-claire-semantic="python">@app.route('/contact', methods=['GET', 'POST'])
def contact():
    if request.method == 'POST':
        return &quot;Vous avez envoyé : {msg}&quot;.format(msg=request.form['msg'])
    return '&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;&lt;input type=&quot;text&quot; name=&quot;msg&quot; /&gt;&lt;input type=&quot;submit&quot; value=&quot;Envoyer&quot; /&gt;&lt;/form&gt;'</code></pre><p id="r-720022" data-claire-element-id="720022"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-3/contact">'/contact'</a></strong></p><aside id="r-720024" data-claire-element-id="720024" data-claire-semantic="warning"><p id="r-720023" data-claire-element-id="720023">Si le visiteur s'amuse à modifier le formulaire (avec un outil comme firebug) et à vous envoyer une requête POST dans laquelle il manquera la donnée <code data-claire-semantic="python">'msg'</code>, alors il recevra une erreur 400 (Bad Request), car la ligne 4 échouera.<br/> Cependant, si vous voulez prévoir ce cas de figure, il suffit de basculer vers une valeur par défaut si jamais une valeur manque. Cela se fait grâce à la méthode <code data-claire-semantic="python">get()</code> des dictionnaires.<br/> Exemple : <code data-claire-semantic="python">request.form.get('msg', 'valeur par défaut')</code>. (la valeur par défaut vaudra <code data-claire-semantic="python">None</code> si vous ne la précisez pas)</p></aside><h5 id="r-les-differents-types-de-champs" data-claire-element-id="720026">Les différents types de champs</h5><p id="r-720025" data-claire-element-id="720025">Le code précédent récupère le contenu (sous la forme d'une chaîne) d'un champ de type <code data-claire-semantic="html">&lt;input type=&quot;text&quot;&gt;</code>.<br/> Pour les autres types d'input, c'est tout aussi simple. Un <code data-claire-semantic="html">&lt;input type=&quot;password&quot;&gt;</code>, un <code data-claire-semantic="html">&lt;select&gt;</code> ou un <code data-claire-semantic="html">&lt;textarea&gt;</code> renverrons également une chaîne associée à leur name.<br/> La seule exception est <code data-claire-semantic="html">&lt;input type=&quot;checkbox&quot;&gt;</code>, qui associe soit <code data-claire-semantic="python">True</code> soit <code data-claire-semantic="python">False</code> à son <code data-claire-semantic="python">name</code>, selon que la case est cochée ou non.</p><h5 id="r-upload-de-fichiers-1" data-claire-element-id="720035">Upload de fichiers</h5><p id="r-720027" data-claire-element-id="720027">Les fichiers s'envoient de la même manière que les données d'un formulaire.<br/> La seule chose à changer est que le formulaire doit posséder l'attribut <code data-claire-semantic="python">enctype</code> avec pour valeur <code data-claire-semantic="python">&quot;multipart/form-data&quot;</code>.<br/> Ensuite, il faut créer un champ permettant à l'utilisateur de choisir un fichier à uploader. Cela se fait grâce à la balise <code data-claire-semantic="html">&lt;input type=&quot;file&quot; name=&quot;mon_fichier&quot; /&gt;</code>. Enfin, on récupère le fichier non pas avec <code data-claire-semantic="python">request.form</code>, mais avec <code data-claire-semantic="python">request.files</code> (dont l'utilisation est la même).</p><h6 id="r-sauvegarder-le-fichier-de-maniere-securisee" data-claire-element-id="720034">Sauvegarder le fichier de manière sécurisée</h6><p id="r-720028" data-claire-element-id="720028">Souvent, vous voudrez vous assurer que le fichier envoyé est d'un certain type, pour empêcher le visiteur d'envoyer des fichiers .html. Pour cela, il est nécessaire de récupérer le nom du fichier envoyé. Attention cependant, même si le nom semble correct, il faut toujours sauvegarder le fichier sous un nom sécurisé. Mais une fois de plus, pour cela, il existe une fonction dédiée. :)</p><p id="r-720029" data-claire-element-id="720029">Cette fonction s'appelle <code data-claire-semantic="python">secure_filename()</code> et doit être importée depuis le module werkzeug (qui gère la partie WSGI de Flask).</p><p id="r-720030" data-claire-element-id="720030">Typiquement, on procèdera de cette manière pour sauvegarder un fichier dans le dossier <code data-claire-semantic="python">'./uploads'</code> :</p><pre id="r-720031" data-claire-element-id="720031"><code data-claire-semantic="python">fichier = request.files['mon_fichier']
nom_fichier = fichier.filename
if nom_fichier[-5:] != '.html':
    nom_fichier = secure_filename(nom_fichier)
    fichier.save('./uploads/' + nom_fichier)</code></pre><aside id="r-720033" data-claire-element-id="720033" data-claire-semantic="warning"><p id="r-720032" data-claire-element-id="720032">La vérification de l'extension du fichier que j'ai faite ne suffit pas. Il vaut mieux établir une liste d'extensions autorisées, et interdire les autres.</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
<span class="arrow"></span>
<span class="next">Introduction</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
<span class="next">Les Query String</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="LesQueryString"></a><h2>Les Query String</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
<span class="arrow"></span>
<span class="next">Les formulaires</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
<span class="next">Les cookies</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-query-string" data-claire-element-id="720059">Les Query String</h4><p id="r-720037" data-claire-element-id="720037">Les formulaires sont certainement la principale manière d'envoyer des données au serveur, mais il existe une autre manière, qui fonctionne même avec la méthode HTTP GET. C'est cette seconde manière qu'utilisent les formulaires lorsqu'on précise <code data-claire-semantic="python">method=&quot;get&quot;</code> dans la balise <code data-claire-semantic="html">&lt;form&gt;</code>. Les valeurs ne se retrouveront pas dans <code data-claire-semantic="python">request.form</code> mais dans <code data-claire-semantic="python">request.args</code>.<br/> Testons immédiatement cela :</p><pre id="r-720038" data-claire-element-id="720038"><code data-claire-semantic="python">@app.route('/contact') # on n'autorise pas la méthode POST
def contact():
    if request.args.get('msg') is not None:
        return &quot;Vous avez envoyé : {msg}&quot;.format(msg=request.args['msg'])
    return '&lt;form action=&quot;&quot; method=&quot;get&quot;&gt;&lt;input type=&quot;text&quot; name=&quot;msg&quot; /&gt;&lt;input type=&quot;submit&quot; value=&quot;Envoyer&quot; /&gt;&lt;/form&gt;'</code></pre><p id="r-720039" data-claire-element-id="720039"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-3-bis/contact">'/contact'</a></strong></p><p id="r-720040" data-claire-element-id="720040">Déjà, la première différence que l'on remarque est que l'on ne peut plus différencier le cas GET et le cas POST puisqu'on a plus que le premier. La deuxième différence se remarque si vous êtes attentifs... les valeurs que l'on a envoyées sont visibles dans la barre d'adresse. o_O</p><p id="r-720041" data-claire-element-id="720041">En fait, tout ce qui se situe après le caractère <code data-claire-semantic="python">'?'</code> dans la barre d'adresse est appelé la <strong>query string</strong>. La query string peut être générée par un formulaire (comme on vient de le faire), mais elle peut aussi se trouver directement écrite dans vos liens (<code data-claire-semantic="html">&lt;a href=&quot;&quot;&gt;</code>).<br/> En revanche, la query string est beaucoup plus limitée en taille que les formulaires en POST. Et étant donné que tout se verra dans la barre d'adresse, il n'est pas judicieux d'envoyer un mot de passe dans une query string, par exemple.</p><aside id="r-720043" data-claire-element-id="720043" data-claire-semantic="warning"><p id="r-720042" data-claire-element-id="720042">D'ailleurs, plusieurs milliers de mots de passe du site figaro.fr se sont retrouvés dans la nature à cause de cette erreur. Servez vous donc constamment de la méthode POST pour vos formulaires, et réservez les query string aux liens.</p></aside><h5 id="r-generer-des-query-string-avec-url-for" data-claire-element-id="720050">Générer des query string avec <code data-claire-semantic="python">url_for()</code></h5><p id="r-720044" data-claire-element-id="720044">Décidément, cette fonction nous suit partout. ^^ <br/> Commençons par un petit rappel de la génération de liens vers les routes personnalisées avec <code data-claire-semantic="python">url_for()</code>. Prenons comme exemple la vue suivante :</p><pre id="r-720045" data-claire-element-id="720045"><code data-claire-semantic="python">@app.route('/discussion/page/&lt;int:num_page&gt;')
def discussion(num_page):
    return 'Affichage de la page n°{num} de la discussion.'.format(num=num_page)</code></pre><p id="r-720046" data-claire-element-id="720046">Pour générer un lien vers la 3ème page de la discussion (<code data-claire-semantic="python">'/discussion/page/3'</code>), on doit faire <code data-claire-semantic="python">url_for('discussion', num_page=3)</code>. Ça, vous le saviez. Mais que se passe-t-il si on rajoute des paramètres à url_for ? Eh bien il va générer une query string avec les paramètres en trop.</p><pre id="r-720047" data-claire-element-id="720047"><code data-claire-semantic="python">url_for('discussion', num_page=3, truc='machin') # génère '/discussion/page/3?truc=machin'
url_for('discussion', num_page=12, truc='machin', age=20) # génère '/discussion/page/12?truc=machin&amp;age=20'</code></pre><aside id="r-720049" data-claire-element-id="720049" data-claire-semantic="information"><p id="r-720048" data-claire-element-id="720048">Dans une query string, les variables sont séparées entres elles par le symbole <code data-claire-semantic="python">'&amp;'</code></p></aside><h5 id="r-route-personnalisee-ou-query-string" data-claire-element-id="720058">Route personnalisée ou query string ?</h5><p id="r-720051" data-claire-element-id="720051">En réalisant vos routes, vous vous rendrez compte que vous avez le choix entre deux types d'url pour vos vues :</p><ul id="r-720056" data-claire-element-id="720056"><li id="r-720053" data-claire-element-id="720053"><p id="r-720052" data-claire-element-id="720052"><code data-claire-semantic="python">'/profil?prenom=Luc&amp;nom=Dupont'</code> (utilise une simple route <code data-claire-semantic="python">'/profil'</code> et une query string)</p></li><li id="r-720055" data-claire-element-id="720055"><p id="r-720054" data-claire-element-id="720054">et <code data-claire-semantic="python">'/profil/Luc.Dupont'</code> (utilise une route personnalisée <code data-claire-semantic="python">'/profil/&lt;prenom&gt;.&lt;nom&gt;'</code>)</p></li></ul><p id="r-720057" data-claire-element-id="720057">Que choisir ?<br/> Les routes personnalisées. Absolument. Elles sont plus jolies, bien mieux indexées par les moteurs de recherche (ce qui vous permettra d'être mieux placé dans Google, notamment), et elles gèrent pour nous le cas où le visiteur enlève des valeurs manuellement dans la barre d'adresse, alors que vous devrez tester la présence et la validité de chaque variable dans le cas de la query string.<br/> Au final, les query string présentent généralement assez peu d'intérêt.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
<span class="arrow"></span>
<span class="next">Les formulaires</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
<span class="next">Les cookies</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lescookies"></a><h2>Les cookies</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
<span class="arrow"></span>
<span class="next">Les Query String</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
<span class="next">Les sessions</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-cookies-2" data-claire-element-id="720077">Les cookies</h4><p id="r-720060" data-claire-element-id="720060">Ne vous êtes vous jamais demandé comment font les sites web pour vous reconnaître alors que vous aviez éteint votre ordinateur entre deux visites ? La réponse est dans cette partie : les cookies. En plus du célèbre gâteau sec, ce mot désigne une donnée qu'un site web peut décider de stocker sur votre ordinateur pendant une certaine durée.<br/> Par exemple, pour se souvenir de qui vous êtes, il suffit au site web de stocker votre numéro d'identifiant ou votre pseudo.</p><p id="r-720061" data-claire-element-id="720061">Une réponse HTTP peut contenir un champ spécial pour vous envoyer des cookies. Réciproquement, pour que le site web vous reconnaisse, il faut que vous lui envoyiez les cookies qu'il vous a confié. Pour cela, votre navigateur, à chaque requête HTTP, va envoyer tous les cookies que ce site vous a confié.</p><div id="r-720063" data-claire-element-id="720063" data-claire-semantic="question"><p id="r-720062" data-claire-element-id="720062">Mais, si le site nous a laissé beaucoup de cookies, ça ne risque pas d'être un peu lourd de les renvoyer tous à chaque fois ?</p></div><p id="r-720064" data-claire-element-id="720064">Si, mais heureusement un site web est limité en nombre et en taille de cookies ! ^^</p><h5 id="r-recuperer-les-cookies-qu-on-avait-confies-au-client" data-claire-element-id="720068">Récupérer les cookies qu'on avait confiés au client</h5><p id="r-720065" data-claire-element-id="720065">Étant donné que les cookies parviennent au serveur via une requête HTTP, j'espère ne pas vous surprendre en vous disant qu'on y accède via l'attribut <code data-claire-semantic="python">cookies</code> de l'objet <code data-claire-semantic="python">request</code>, de la même manière qu'avec <code data-claire-semantic="python">request.form</code>, <code data-claire-semantic="python">request.files</code> ou <code data-claire-semantic="python">request.args</code> :</p><pre id="r-720066" data-claire-element-id="720066"><code data-claire-semantic="python">@app.route('/')
def index():
    pseudo_visiteur = request.cookies.get('pseudo') # on récupère le cookie 'pseudo'
    if pseudo_visiteur is not None:
        return &quot;C'est un plaisir de se revoir, {pseudo} !&quot;.format(pseudo=pseudo_visiteur)
    else:
        return &quot;Bonjour, c'est votre première visite ?&quot;</code></pre><p id="r-720067" data-claire-element-id="720067">Pour l'instant, vu qu'on n'a pas vu comment stocker des cookies, ce code se comporte comme si c'était toujours votre première visite.</p><h5 id="r-stocker-des-cookies-chez-le-client" data-claire-element-id="720076">Stocker des cookies chez le client</h5><p id="r-720069" data-claire-element-id="720069">Là, c'est un peu plus délicat : il faut placer le nom et la valeur de notre cookie dans la réponse du client. Pour cela, les objets réponses disposent d'une méthode <code data-claire-semantic="python">set_cookie</code>. Mais déjà faut-il créer un objet réponse... Et voilà que ressurgit <code data-claire-semantic="python">make_response()</code> ! :ninja:</p><pre id="r-720070" data-claire-element-id="720070"><code data-claire-semantic="python">@app.route('/')
def index():
    pseudo_visiteur = request.cookies.get('pseudo') # on récupère le cookie 'pseudo'
    if pseudo_visiteur is not None:
        return &quot;C'est un plaisir de se revoir, {pseudo} !&quot;.format(pseudo=pseudo_visiteur)
    else:
        reponse = make_response(&quot;Bonjour, c'est votre première visite ?&quot;)
        reponse.set_cookie('pseudo', 'Luc')
        return reponse</code></pre><p id="r-720071" data-claire-element-id="720071"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-3/cookie/">'/'</a></strong></p><p id="r-720072" data-claire-element-id="720072">De cette manière, à partir de la seconde visite, vous serez reconnu ! Cependant, si vous fermez et rouvrez votre navigateur, vous pourrez constater que le cookie semble avoir été effacé... C'est normal, nous ne lui avons pas donné de durée de vie. Pour cela il suffit de donner une valeur (en secondes) au paramètre <code data-claire-semantic="python">max_age</code> de la méthode <code data-claire-semantic="python">set_cookie</code>.<br/> Par exemple, pour que le cookie reste en place un mois : <code data-claire-semantic="python">reponse.set_cookie('pseudo', 'Luc', max_age=3600*24*30)</code>.<br/> Vous pouvez bien sûr rallonger la durée de vie d'un cookie de la même manière. <br/> Puis, pour le supprimer : <code data-claire-semantic="python">reponse.set_cookie('pseudo', '', max_age=-1)</code>.</p><h6 id="r-considerations-de-securite" data-claire-element-id="720075">Considérations de sécurité</h6><p id="r-720073" data-claire-element-id="720073">Les cookies posent deux problèmes de sécurités. Premièrement, ils peuvent être modifiés facilement, dans le navigateur du client, on ne peut donc pas vraiment avoir confiance en eux. Deuxièmement, étant donné que le navigateur d'un client renvoie toujours les cookies qu'on lui a laissé, si quelqu'un s'amuse, sur le même réseau que le client, à sniffer les paquets qui transitent, alors il risque d'intercepter le contenu des cookies.</p><p id="r-720074" data-claire-element-id="720074">La solution à ces problèmes est de chiffrer le contenu des cookies. De cette manière, ils ne peuvent plus être modifiés (à moins que les clients connaissent votre <code data-claire-semantic="python">secret_key</code>), et les sniffeurs ne posent plus de problèmes. Nous n'allons pas voir comment faire, car Flask nous met à dispositions les <strong>sessions</strong>, qui gèrent cela sans que l'on s'en préoccupe.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
<span class="arrow"></span>
<span class="next">Les Query String</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
<span class="next">Les sessions</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lessessions"></a><h2>Les sessions</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
<span class="arrow"></span>
<span class="next">Les cookies</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">
<span class="next">[TP] Service Web d&#039;upload d&#039;images</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-sessions-1" data-claire-element-id="720114">Les sessions</h4><p id="r-720078" data-claire-element-id="720078">Les sessions sont donc un moyen simplifié et plus sécurisé de retenir des informations pour vos visiteurs. Les sessions utilisent deux choses distinctes :</p><ul id="r-720083" data-claire-element-id="720083"><li id="r-720080" data-claire-element-id="720080"><p id="r-720079" data-claire-element-id="720079">Un <strong>cookie</strong> placé chez le client, pour <strong>identifier</strong> sa session.</p></li><li id="r-720082" data-claire-element-id="720082"><p id="r-720081" data-claire-element-id="720081">Des données <strong>stockées sur le serveur</strong>, reliées à cette même session.</p></li></ul><p id="r-720084" data-claire-element-id="720084">Pour fonctionner, nous aurons besoin d'importer l'objet <code data-claire-semantic="python">session</code> :</p><pre id="r-720085" data-claire-element-id="720085"><code data-claire-semantic="python">from flask import session</code></pre><p id="r-720086" data-claire-element-id="720086">Cet objet s'utilise ensuite de la même manière qu'un dictionnaire Python. L'avantage est qu'on peut lire et écrire dedans, on ne passe donc plus par les objets requête et réponse. Voilà l'équivalent du code avec les cookies transposé dans une version utilisant <code data-claire-semantic="python">session</code> à la place :</p><pre id="r-720087" data-claire-element-id="720087"><code data-claire-semantic="python">@app.route('/')
def index():
    if 'pseudo' in session:
        return &quot;C'est un plaisir de se revoir, {pseudo} !&quot;.format(pseudo=session['pseudo'])
    else:
        session['pseudo'] = 'Luc'
        return &quot;Bonjour, c'est votre première visite ?&quot;</code></pre><p id="r-720088" data-claire-element-id="720088"><strong>↳ Essayer ce code : <a href="http://tutoflask.fspot.org/2-3/session/">'/'</a></strong></p><p id="r-720089" data-claire-element-id="720089">Le défaut des sessions est qu'on ne peut pas choisir de période d'expiration différente pour chaque variable qu'on stocke dans la session. Par défaut, la session sera effacée quand le visiteur fermera son navigateur. Si on veut qu'elle dure plus longtemps, il faut placer <code data-claire-semantic="python">session.permanent = True</code> après sa création. Elle vivra alors un mois.<br/> Pour changer cette durée, il faut modifier la configuration de l'objet <code data-claire-semantic="python">app</code> :</p><pre id="r-720090" data-claire-element-id="720090"><code data-claire-semantic="python">app.config['PERMANENT_SESSION_LIFETIME'] = 3600 # la session dure une heure</code></pre><p id="r-720091" data-claire-element-id="720091">On peut stocker n'importe quoi dans <code data-claire-semantic="python">session</code> : entiers, chaînes, listes, objets, dictionnaires, etc. Cependant, dans le cas des listes et des dictionnaires (et de tout type mutable plus généralement), il faut notifier la session lorsqu'on les modifie, en positionnant à <code data-claire-semantic="python">True</code> l'attribut <code data-claire-semantic="python">modified</code> :</p><pre id="r-720092" data-claire-element-id="720092"><code data-claire-semantic="python">session['mon_panier'].append('appareil photo') # mon_panier est une liste
session.modified = True</code></pre><p id="r-720093" data-claire-element-id="720093">Pour finir, lorsqu'on désire supprimer une variable de la session, on utilise la méthode pop() de la session :</p><pre id="r-720094" data-claire-element-id="720094"><code data-claire-semantic="python">session.pop('pseudo', None)</code></pre><aside id="r-720096" data-claire-element-id="720096" data-claire-semantic="information"><p id="r-720095" data-claire-element-id="720095">Le deuxième paramètre (<code data-claire-semantic="python">None</code>) est là uniquement pour éviter une erreur s'il n'y a pas de variable <code data-claire-semantic="python">'pseudo'</code> dans la session.</p></aside><p id="r-720097" data-claire-element-id="720097">C'est tout ce qu'il y a à dire sur les sessions. Vous remarquerez que dans ce chapitre, tout s'utilise pratiquement de la même manière. Mais il y a quand même de nombreuses notions en jeu, et tout ça s'articule autour des requêtes et des réponses HTTP.</p><p id="r-720098" data-claire-element-id="720098">Avant de passer au QCM, que diriez vous de vous entraîner encore un peu, notamment avec les formulaires et les sessions ? Voilà quelques idées d'exercices très simples :</p><ul id="r-720111" data-claire-element-id="720111"><li id="r-720100" data-claire-element-id="720100"><p id="r-720099" data-claire-element-id="720099">Faire un formulaire permettant d'envoyer son pseudo.</p></li><li id="r-720102" data-claire-element-id="720102"><p id="r-720101" data-claire-element-id="720101">Stocker le pseudo reçu dans la session.</p></li><li id="r-720104" data-claire-element-id="720104"><p id="r-720103" data-claire-element-id="720103">Ensuite, sur les différentes pages du site, faire apparaître le pseudo en haut à droite (l'objet session est nativement accessible dans les templates).</p></li><li id="r-720106" data-claire-element-id="720106"><p id="r-720105" data-claire-element-id="720105">Afficher un compteur de visite qui compte le nombre de fois qu'on a chargé une page du site (indice : stockez un entier dans la session).</p></li><li id="r-720108" data-claire-element-id="720108"><p id="r-720107" data-claire-element-id="720107">Laisser le choix, dans le formulaire de connexion, entre une session temporaire ou une session d'un mois, à l'aide d'une case à cocher.</p></li><li id="r-720110" data-claire-element-id="720110"><p id="r-720109" data-claire-element-id="720109">Si on est connecté, faire apparaître un lien en haut à gauche pour se déconnecter.</p></li></ul><p id="r-720112" data-claire-element-id="720112">Les sessions sont extrêmement pratiques, alors exercez vous un peu. :)</p><p id="r-720113" data-claire-element-id="720113">Si vous êtes sûr d'avoir bien assimilé les notions de ce chapitre et des deux précédents, alors nous pouvons enfin passer à notre premier TP ! Et si ce n'est pas le cas, je vous invite vivement à relire les passages qui vous ont posé problèmes, à vous entraîner, et à poser vos questions dans le forum Python si vous êtes bloqués. :)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
<span class="arrow"></span>
<span class="next">Les cookies</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">
<span class="next">[TP] Service Web d&#039;upload d&#039;images</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="TPServiceWebd039uploadd039images"></a><h2>[TP] Service Web d&#039;upload d&#039;images</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
<span class="arrow"></span>
<span class="next">Les sessions</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
<span class="next">Objectif</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-720116" data-claire-element-id="720116">Nous voilà enfin arrivés à notre premier TP, maintenant que nous connaissons les bases de Flask. Ce TP réutilisera les notions des précédents chapitres, j'espère donc que vous les avez suivi attentivement, car cette fois ci, il va falloir vous débrouiller tous seuls. ^^</p>
</div><a name="Objectif"></a><h2>Objectif</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">
<span class="arrow"></span>
<span class="next">[TP] Service Web d&#039;upload d&#039;images</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
<span class="next">Solution</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-objectif-15" data-claire-element-id="720151">Objectif</h4><p id="r-720117" data-claire-element-id="720117">Comme je l'ai dit, l'objectif est de créer un site web où nous pourrons uploader nos images pour les partager facilement.</p><p id="r-720118" data-claire-element-id="720118">Pour vous donner une idée de ce à quoi cela devra ressembler, vous pouvez tester cette version que j'ai réalisée (le mot de passe est &quot;<strong>up</strong>&quot;, mais l'upload de fichiers est bloqué) :</p><p id="r-720119" data-claire-element-id="720119">Essayer ce code :</p><ul id="r-720126" data-claire-element-id="720126"><li id="r-720121" data-claire-element-id="720121"><p id="r-720120" data-claire-element-id="720120"><a href="http://tutoflask.fspot.org/up/">'/up/'</a> (page d'upload)</p></li><li id="r-720123" data-claire-element-id="720123"><p id="r-720122" data-claire-element-id="720122"><a href="http://tutoflask.fspot.org/up/view/">'/up/view/'</a> (liste des images)</p></li><li id="r-720125" data-claire-element-id="720125"><p id="r-720124" data-claire-element-id="720124"><a href="../../tutoflask.fspot.org/up/view/hal.png">'/up/view/hal.png'</a> (téléchargement d'une image)</p></li></ul><p id="r-720127" data-claire-element-id="720127">Comme vous le voyez, on dispose de 3 vues. L'une sert à l'envoi de fichiers, une autre liste tous les fichiers envoyés, et une autre permet de télécharger le fichier qu'on lui précise dans sa route (à l'aide d'une route personnalisée, vous vous en doutez).</p><p id="r-720128" data-claire-element-id="720128">Essayer donc de réaliser quelque chose qui possède ce fonctionnement :</p><ul id="r-720133" data-claire-element-id="720133"><li id="r-720130" data-claire-element-id="720130"><p id="r-720129" data-claire-element-id="720129">On ne doit pouvoir uploader QUE des images (extensions png et jpg au moins)</p></li><li id="r-720132" data-claire-element-id="720132"><p id="r-720131" data-claire-element-id="720131">On doit notifier le visiteur quand une erreur se produit : fichier introuvable, mot de passe erroné, etc.</p></li></ul><p id="r-720134" data-claire-element-id="720134">Vous devrez utiliser l'héritage de templates.</p><h5 id="r-avant-de-commencer-34" data-claire-element-id="720150">Avant de commencer</h5><p id="r-720135" data-claire-element-id="720135">Voilà quelques informations qui vous seront utiles :</p><h6 id="r-hierarchie-des-fichiers-et-dossiers-de-ce-tp" data-claire-element-id="720140">Hiérarchie des fichiers et dossiers de ce TP</h6><p id="r-720136" data-claire-element-id="720136">La hiérarchie de mon projet est celle ci :</p><pre id="r-720137" data-claire-element-id="720137"><code data-claire-semantic="python">tp_upload/
    up.py  # mon application, ma configuration, et mes vues
    templates/
        up_squelette.html  # le template parent
        up_up.html  # template pour la page d'upload
        up_liste.html  # template pour la page avec la liste des fichiers
    static/
        up.css  # fichier CSS
    ups/</code></pre><aside id="r-720139" data-claire-element-id="720139" data-claire-semantic="information"><p id="r-720138" data-claire-element-id="720138">C'est dans le dossier <code data-claire-semantic="python">'ups/'</code> que je stockerai les fichiers uploadés. Dans mon code Python, j'ai une variable qui contient le chemin d'accès à ce dossier pour plus de simplicité (dans mon cas : <code data-claire-semantic="python">DOSSIER_UPS = '/home/fred/www/tp_upload/ups/'</code>)</p></aside><h6 id="r-quelques-fonctions-utiles-3" data-claire-element-id="720149">Quelques fonctions utiles</h6><p id="r-720141" data-claire-element-id="720141">Pour savoir si un fichier existe, et s'il s'agit bien d'un fichier (et non d'un dossier), il existe la fonction <code data-claire-semantic="python">os.path.isfile(chemin_fichier)</code>.</p><p id="r-720142" data-claire-element-id="720142">Pour obtenir la liste des fichiers contenus dans un dossier, il existe la fonction <code data-claire-semantic="python">os.listdir(chemin_dossier)</code>.</p><p id="r-720143" data-claire-element-id="720143">Pour faire télécharger un fichier à l'utilisateur, flask propose la fonction <code data-claire-semantic="python">send_file(chemin_fichier)</code>. Cette fonction accepte l'argument booléen optionnel <code data-claire-semantic="python">as_attachment</code>, qui peut forcer le téléchargement de l'image plutôt que sa visualisation dans le navigateur.</p><p id="r-720144" data-claire-element-id="720144">Lorsqu'on flash() un message, et qu'on veut l'afficher dans le template, un problème survient si le message flashé contenait du HTML : celui ci ne sera pas interprété. Il s'agit d'une mesure de sécurité au cas où on afficherai du contenu envoyé par l'utilisateur, si celui ci nous envoie du HTML. Si on est sûr que ce cas de figure n'arrive pas, alors on peut désactiver la protection, dans le template, au moment de l'affichage.<br/> Il suffit d'appliquer le filtre safe sur la variable à afficher :</p><pre id="r-720145" data-claire-element-id="720145"><code data-claire-semantic="jinja">{{ message|safe }}</code></pre><aside id="r-720147" data-claire-element-id="720147" data-claire-semantic="information"><p id="r-720146" data-claire-element-id="720146">Si vous n'êtes pas bien sûr du fonctionnement de ces fonctions (ou d'autres fonctions vues pendant le cours), je vous invite à les tester individuellement afin de comprendre leur rôle.</p></aside><p id="r-720148" data-claire-element-id="720148">Bon, tout est prêt ? Alors, réfléchissez à comment mettre tout cela en place.<br/> Une fois votre solution toute trouvée, à vos claviers, codez ! :pirate:</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">
<span class="arrow"></span>
<span class="next">[TP] Service Web d&#039;upload d&#039;images</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
<span class="next">Solution</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Solution"></a><h2>Solution</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
<span class="arrow"></span>
<span class="next">Objectif</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-solution-103" data-claire-element-id="720178">Solution</h4><p id="r-720152" data-claire-element-id="720152">Si vous avez réussi, bravo ! :) <br/> Dans le cas contraire, êtes vous sûr d'avoir bien cherché ? Dans tous les cas, voici la solution que je propose. Ce n'est pas nécessairement la meilleure, mais elle fonctionne parfaitement. Si votre solution ne fonctionne pas ou bien si elle est beaucoup plus longue que la mienne, essayer de repérer vos erreurs : un site web fait avec Flask doit rester court et simple, autant que possible.</p><p id="r-720153" data-claire-element-id="720153">Voilà donc le fameux code :</p><p id="r-720154" data-claire-element-id="720154">Contenu du fichier <strong>up.py</strong> :</p><pre id="r-720155" data-claire-element-id="720155"><code data-claire-semantic="python">#!/usr/bin/env python
# -*- coding:utf-8 -*-

from flask import Flask, request, flash, redirect, url_for
from flask import send_file
from werkzeug import secure_filename
import os

app = Flask(__name__)
app.secret_key = 'd66HR8dç&quot;f_-àgjYYic*dh'

DOSSIER_UPS = '/home/fred/www/tp_upload/ups/'

def extension_ok(nomfic):
    &quot;&quot;&quot; Renvoie True si le fichier possède une extension d'image valide. &quot;&quot;&quot;
    return '.' in nomfic and nomfic.rsplit('.', 1)[1] in ('png', 'jpg', 'jpeg', 'gif', 'bmp')

@app.route('/up/', methods=['GET', 'POST'])
def upload():
    if request.method == 'POST':
        if request.form['pw'] == 'up': # on vérifie que le mot de passe est bon
            f = request.files['fic']
            if f: # on vérifie qu'un fichier a bien été envoyé
                if extension_ok(f.filename): # on vérifie que son extension est valide
                    nom = secure_filename(f.filename)
                    f.save(DOSSIER_UPS + nom)
                    flash(u'Image envoyée ! Voici &lt;a href=&quot;{lien}&quot;&gt;son lien&lt;/a&gt;.'.format(lien=url_for('upped', nom=nom)), 'suc
                else:
                    flash(u'Ce fichier ne porte pas une extension autorisée !', 'error')
            else:
                flash(u'Vous avez oublié le fichier !', 'error')
        else:
            flash(u'Mot de passe incorrect', 'error')
    return render_template('up_up.html')

@app.route('/up/view/')
def liste_upped():
    images = [img for img in os.listdir(DOSSIER_UPS) if extension_ok(img)] # la liste des images dans le dossier
    return render_template('up_liste.html', images=images)

@app.route('/up/view/&lt;nom&gt;')
def upped(nom):
    nom = secure_filename(nom)
    if os.path.isfile(DOSSIER_UPS + nom): # si le fichier existe
        return send_file(DOSSIER_UPS + nom, as_attachment=True) # on l'envoie
    else:
        flash(u'Fichier {nom} inexistant.'.format(nom=nom), 'error')
        return redirect(url_for('liste_upped')) # sinon on redirige vers la liste des images, avec un message d'erreur

if __name__ == '__main__':
    app.run(debug=True)</code></pre><p id="r-720156" data-claire-element-id="720156">Contenu du fichier <strong>templates/up_squelette.html</strong> :</p><pre id="r-720157" data-claire-element-id="720157"><code data-claire-semantic="jinja">&lt;!doctype html&gt;
&lt;html class=&quot;no-js&quot; lang=&quot;fr&quot;&gt;
&lt;head&gt;
	&lt;meta charset=&quot;utf-8&quot;&gt;
	&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge,chrome=1&quot;&gt;
	&lt;title&gt;{% block title %}{% endblock %}&lt;/title&gt;
	&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot;&gt;
	&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;http://fonts.googleapis.com/css?family=Merienda One&quot;&gt;
	&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;http://fonts.googleapis.com/css?family=Port Lligat Slab&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;{{ url_for('static', filename='up.css') }}&quot;&gt;
&lt;/head&gt;
&lt;body&gt;

{# on affiche les messages d'erreur puis les messages de succes #}
{% for categorie in ['error', 'succes'] %}
    {% with msgs = get_flashed_messages(category_filter=[categorie]) %}
        {% if msgs %}
        &lt;ul class=&quot;flashed {{ categorie }}&quot;&gt;
            {% for m in msgs %}
                &lt;li&gt;{{ m|safe }}&lt;/li&gt;
            {% endfor %}
        &lt;/ul&gt;
        {% endif %}
    {% endwith %}
{% endfor %}

&lt;div id=&quot;main&quot;&gt;
    {% block main %}{% endblock %}
&lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-720158" data-claire-element-id="720158">Contenu du fichier <strong>templates/up_up.html</strong> :</p><pre id="r-720159" data-claire-element-id="720159"><code data-claire-semantic="jinja">{% extends 'up_squelette.html' %}

{% block title %}Upload d'images{% endblock %}

{% block main %}
&lt;h1&gt;Choisissez une image à Uploader :&lt;/h1&gt;
&lt;form action=&quot;&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
    &lt;label for=&quot;fic&quot;&gt;Fichier&lt;/label&gt;&lt;input id=&quot;fic&quot; type=&quot;file&quot; name=&quot;fic&quot; /&gt;

    &lt;label for=&quot;pw&quot;&gt;Mot de passe&lt;/label&gt;&lt;input id=&quot;pw&quot; type=&quot;password&quot; name=&quot;pw&quot; /&gt;

    &lt;input id=&quot;btsub&quot; type=&quot;submit&quot; value=&quot;Uploader&quot; /&gt;
&lt;/form&gt;
{% endblock %}</code></pre><p id="r-720160" data-claire-element-id="720160">Contenu du fichier <strong>templates/up_liste.html</strong> :</p><pre id="r-720161" data-claire-element-id="720161"><code data-claire-semantic="jinja">{% extends 'up_squelette.html' %}

{% block title %}Liste des images{% endblock %}

{% block main %}
&lt;h1&gt;Voilà la liste des images :&lt;/h1&gt;
{% if images %}
	&lt;ul class=&quot;fichiers&quot;&gt;
	{% for img in images %}
		&lt;li&gt;&lt;a href=&quot;{{ url_for('upped', nom=img) }}&quot;&gt;{{ img }}&lt;/a&gt;&lt;/li&gt;
	{% endfor %}
	&lt;/ul&gt;
{% endif %}
{% endblock %}</code></pre><p id="r-720162" data-claire-element-id="720162">Contenu du fichier <strong>static/up.css</strong> :</p><pre id="r-720163" data-claire-element-id="720163"><code data-claire-semantic="css">body { 
	margin:0;  
	padding:0;  
	background: no-repeat center center fixed;  
	background-image: -moz-linear-gradient(#CDCBD0, #F0EDE9);  
	background-image: -webkit-linear-gradient(#CDCBD0, #F0EDE9);  
	background-size : cover; }
#main { 
	margin: auto;  
	width: 50%;  
	margin-top: 100px; 
    background-color: #F3F3F3; 
    box-shadow: 0px 0px 30px black; 
    border-radius: 10px;  
    text-align:center;  
    padding-top: 10px;  
    padding-bottom: 40px;  }
h1 { 
	font-family: Merienda One; 
	text-shadow: 1px 1px 2px #2C2235;  
	font-size: 170%; }
form { 
	font-family: Port Lligat Slab;  
	text-shadow: 1px 1px 2px white;  
	text-align: left; }
label { 
	display: block; 
	width: 120px; 
	float:left;  
	margin-left: 130px; 
	position: relative; 
	top: 3px;  }
#btsub { 
	position:relative;  
	left: 39%; 
	top: 23px; 
	width: 140px;  
	background-image: -moz-linear-gradient(#B31A16, #FF521E);  
	background-image: -webkit-linear-gradient(#B31A16, #FF521E);  
	color: white;  
	border: none; 
	border-radius: 3px;  
	box-shadow: 1px 1px 7px black; 
	font-size: 130%; 
	font-family: Merienda One;  font-weight:bold; }
#btsub:hover { 
	background-image: -moz-linear-gradient(#FF521E, #B31A16);  
	background-image: -webkit-linear-gradient(#FF521E, #B31A16);  
	color: white;  
	font-weight: bold;  
	border: none; 
	border-radius: 3px;  
	box-shadow: 1px 1px 2px black; }
.flashed {
	position: relative;
	right:20px;
	list-style-type: none; }
.flashed li {
	font-family: Port Lligat Slab; 
	text-align: center;
	padding: 5px;
	margin-bottom: 10px;
	border-radius: 3px;
	box-shadow: 1px 1px 9px black; }
.succes li {
	background-image: -moz-linear-gradient(#B7FF4F, #6CD043);
	background-image: -webkit-linear-gradient(#B7FF4F, #6CD043); }
.error li {
	background-image: -moz-linear-gradient(#F43600, #D83C31);
	background-image: -webkit-linear-gradient(#F43600, #D83C31); }
.fichiers {
	text-align: left;
	list-style-type: circle;
	font-family: Port Lligat Slab;</code></pre><aside id="r-720165" data-claire-element-id="720165" data-claire-semantic="information"><p id="r-720164" data-claire-element-id="720164">N'étant pas un pro en HTML et en CSS, je vous fais toutes mes excuses si l'affichage n'est pas au top sur votre écran ! Zoomez ou dézoomez pour obtenir quelque chose d'acceptable. :honte:</p></aside><p id="r-720166" data-claire-element-id="720166">Avant de passer à la partie suivante, je vous propose d'apporter quelques améliorations à ce TP pour vous entraîner :</p><ul id="r-720173" data-claire-element-id="720173"><li id="r-720168" data-claire-element-id="720168"><p id="r-720167" data-claire-element-id="720167">Faire un système de login par session afin d'éviter de taper le mot de passe à chaque fois.</p></li><li id="r-720170" data-claire-element-id="720170"><p id="r-720169" data-claire-element-id="720169">Faire en sorte que lorsqu'on upload une image dont le nom est déjà pris, on n'écrase pas l'ancienne.</p></li><li id="r-720172" data-claire-element-id="720172"><p id="r-720171" data-claire-element-id="720171">Rajouter une vue pour la suppression des images. (à l'aide de la fonction <code data-claire-semantic="python">os.unlink()</code>)</p></li></ul><p id="r-720174" data-claire-element-id="720174">Il n'y a pas de secret : pour maîtriser un outil, il faut <strong>pratiquer</strong> ! :)</p><p id="r-720175" data-claire-element-id="720175">En échange de tout le travail que vous venez de fournir, je vous dispense de QCM. ;)</p><p id="r-720176" data-claire-element-id="720176">J'espère que ce TP vous a plu ! Un second TP, qui concernera la réalisation d'un blog, est au programme de la partie suivante du cours, qui traite de l'utilisation des bases de données dans Flask.</p><p id="r-720177" data-claire-element-id="720177">Ce tutoriel est encore en chantier ! Pour m'aider à l'améliorer laissez vos commentaires et suggestions sur <a href="http://www.siteduzero.com/forum-83-786703-p1-beta-on-python-creez-vos-applications-web-avec-flask.html">ce topic</a>. :)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask">Créez vos applications web avec Flask</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-web-2">Le Web</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/un-serveur-des-clients">
Un serveur, des clients
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/le-protocole-http">
Le protocole HTTP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/dernieres-notions">
Dernières notions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-de-flask">Présentation de Flask</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/presentation-16">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/possibilites">
Possibilités
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-et-premiers-pas">Installation et premiers pas</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/installation-109">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/premiers-pas-21">
Premiers pas
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Les bases de Flask
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/requetes-et-reponses">Requêtes et Réponses</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-requetes-4">
Les requêtes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-reponses-1">
Les réponses
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-4">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/une-fausse-bonne-idee">
Une fausse bonne idée...
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-utilisateur">
Les templates, côté utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-templates-cote-progammeur">
Les templates, côté progammeur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/flash-2">
Flash
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/l-echange-de-donnees">L&#039;échange de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/introduction-19">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-formulaires-7">
Les formulaires
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-query-string">
Les Query String
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-cookies-2">
Les cookies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/les-sessions-1">
Les sessions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/tp-service-web-d-upload-d-images">[TP] Service Web d&#039;upload d&#039;images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
Objectif
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/solution-103">
Solution
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creez-vos-applications-web-avec-flask/objectif-15">
<span class="arrow"></span>
<span class="next">Objectif</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/creez-vos-applications-web-avec-flask.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 11:05:02 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/creez-vos-applications-web-avec-flask.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:47:15 GMT -->
</html>