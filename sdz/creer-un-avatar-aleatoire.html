<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/creer-un-avatar-aleatoire.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 23:51:30 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/creer-un-avatar-aleatoire.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:12:43 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Créer un avatar aléatoire</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/creer-un-avatar-aleatoire.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Créer un avatar aléatoire</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Crerunavataralatoire">Créer un avatar aléatoire</a><br/><a href="#Pourquoicetuto">Pourquoi ce tuto ?</a><br/><a href="#Unavataralatoireetunserveurquidortrenommersesfichiers">Un avatar aléatoire et un serveur qui dort : renommer ses fichiers</a><br/><a href="#L039avatarsemi-alatoireetlecache">L&#039;avatar semi-aléatoire et le cache</a><br/><a href="#Deuxavatarsenun">Deux avatars en un</a><br/><a href="#Feinterlesprotectionsfairecroirequesonimagealatoireestunevraieimage">Feinter les protections : faire croire que son image aléatoire est une vraie image</a><br/></div>
<a name="Crerunavataralatoire"></a><h2>Créer un avatar aléatoire</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/pourquoi-ce-tuto">
<span class="next">Pourquoi ce tuto ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-342267" data-claire-element-id="342267">Vous désirez avoir un avatar aléatoire, différent à chaque affichage, comme le mien ?<br/> Vous estimez que les dizaines de <em>scripts</em> sur le sujet que l'on trouve sur Internet sont horriblement compliqués pour quelque chose qui a l'air simple ?</p><p id="r-342268" data-claire-element-id="342268">Ce tutoriel est là pour vous !</p>
</div><a name="Pourquoicetuto"></a><h2>Pourquoi ce tuto ?</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/un-avatar-aleatoire-et-un-serveur-qui-dort-renommer-ses-fichiers">
<span class="next">Un avatar aléatoire et un serveur qui dort : renommer ses fichiers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-342269" data-claire-element-id="342269">Les avatars aléatoires, c'est-à-dire qui affichent une image différente à chaque rafraîchissement (ou selon tout autre paramètre) sont très à la mode, et on trouve énormément de scripts sur Internet qui permettent d'en faire.</p><p id="r-342270" data-claire-element-id="342270">Malheureusement, la très grande majorité de ces scripts sont des horreurs finies, des choses de dizaines et dizaines de lignes, avec des variables dans tous les sens, des constantes, etc.<br/> À la limite, le problème n'est pas tellement là : on colle le script, il marche, on n'a pas besoin de savoir comment il fonctionne.</p><p id="r-342271" data-claire-element-id="342271">Non, le problème est que beaucoup de ces scripts utilisent des fonctions beaucoup trop lourdes pour le serveur par rapport à ce dont on a <em>réellement</em> besoin.<br/> On commence avec un petit <code>array()</code>, puis on passe à <code>glob()</code>, et on finit par utiliser l'extension GD pour afficher une image qui se trouve à l'identique sur le disque dur… GD est une librairie très pratique, mais très lourde en calculs pour un serveur.<br/> Et comme on va le voir, on n'en a pratiquement jamais besoin.</p><aside id="r-342273" data-claire-element-id="342273" data-claire-semantic="information"><p id="r-342272" data-claire-element-id="342272">La plupart des avatars aléatoires que je vois nécessitent en tout et pour tout <strong>3 lignes de code</strong>, indentation comprise, mais à une petite condition. Nous allons voir tout de suite comment faire.</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire">Créer un avatar aléatoire</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/pourquoi-ce-tuto">
Pourquoi ce tuto ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/un-avatar-aleatoire-et-un-serveur-qui-dort-renommer-ses-fichiers">
Un avatar aléatoire et un serveur qui dort : renommer ses fichiers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/l-avatar-semi-aleatoire-et-le-cache">
L&#039;avatar semi-aléatoire et le cache
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/deux-avatars-en-un">
Deux avatars en un
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/feinter-les-protections-faire-croire-que-son-image-aleatoire-est-une-vraie-image">
Feinter les protections : faire croire que son image aléatoire est une vraie image
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/un-avatar-aleatoire-et-un-serveur-qui-dort-renommer-ses-fichiers">
<span class="next">Un avatar aléatoire et un serveur qui dort : renommer ses fichiers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Unavataralatoireetunserveurquidortrenommersesfichiers"></a><h2>Un avatar aléatoire et un serveur qui dort : renommer ses fichiers</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/pourquoi-ce-tuto">
<span class="arrow"></span>
<span class="next">Pourquoi ce tuto ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/l-avatar-semi-aleatoire-et-le-cache">
<span class="next">L&#039;avatar semi-aléatoire et le cache</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-l-avatar-aleatoire-le-plus-simple-du-monde" data-claire-element-id="342287">L'avatar aléatoire le plus simple du monde</h2><p id="r-342275" data-claire-element-id="342275">La solution pour avoir un avatar aléatoire super simple, et super léger pour le serveur, est tellement simple qu'on se demande pourquoi personne ne la choisit : <strong>il suffit de renommer ses images</strong>. Ou plus exactement de les numéroter. Démonstration.</p><h3 id="r-l-avatar-aleatoire-aux-fichiers-a-noms-normaux" data-claire-element-id="342280">L'avatar aléatoire aux fichiers à noms « normaux »</h3><p id="r-342276" data-claire-element-id="342276">L'algorithme de cet avatar est le suivant :</p><pre id="r-342277" data-claire-element-id="342277"><code>— Lister tous les fichiers du répertoire où il y a les images à afficher.
— Compter le nombre d'items de la liste.
— Choisir un nombre aléatoire, et récupérer le nom du fichier correspondant.
— Afficher le fichier choisi.</code></pre><p id="r-342278" data-claire-element-id="342278">Et encore, c'est un cas simple : je pars du principe que toutes les images dont on a besoin sont sagement rangées dans un même dossier, où il n'y a <strong>que</strong> des images et que celles que l'on veut afficher.<br/> De plus, il suffit qu'il y ait un caractère spécial un peu merdique, un fichier parasite qui n'a rien à faire dans le dossier, et hop ! plus rien ne fonctionne correctement.<br/> En outre, la recherche des noms de fichiers est un processus lent (il faut faire un accès disque).</p><p id="r-342279" data-claire-element-id="342279">L'avantage de cette solution est qu'elle est extrêmement simple à faire fonctionner, une fois que le <em>script</em> est fait : on uploade le script, on uploade les fichiers, ça marche. Si on veut changer les images affichées, on change les images et ça marche tout seul, une fois de plus, et quel que soit le format de l'image.</p><h3 id="r-solution-a-images-nommees" data-claire-element-id="342286">Solution à images nommées</h3><p id="r-342281" data-claire-element-id="342281">Ici, toutes nos images que l'on veut afficher s'appellent avatar-1.jpg à avatar-<em>n</em>.jpg, où <em>n</em> est le nombre d'images.</p><p id="r-342282" data-claire-element-id="342282">Dans ce cas, l'algorithme devient le suivant :</p><pre id="r-342283" data-claire-element-id="342283"><code>— Choisir un nombre i entre 1 et n.
— Afficher l'image avatar-i.jpg.</code></pre><p id="r-342284" data-claire-element-id="342284">Simple, efficace.</p><p id="r-342285" data-claire-element-id="342285">De plus, c'est totalement insensible aux autres fichiers qui pourraient traîner dans le répertoire.<br/> L'inconvénient est qu'il faut renommer ses fichiers, et changer le nombre <em>n</em> dans le script à chaque fois qu'on ajoute ou enlève des images à notre avatar.</p><h2 id="r-afficher-l-image-choisie" data-claire-element-id="342299">Afficher l'image choisie</h2><p id="r-342288" data-claire-element-id="342288">Là encore, on voit beaucoup d'horreurs.<br/> La technique la plus répandue consiste à dire que notre fichier PHP renvoie une image (grâce aux <code><a href="http://fr.php.net/manual/fr/function.header.php">headers()</a></code>), puis à charger l'image dans le fichier pour l'afficher.</p><aside id="r-342290" data-claire-element-id="342290" data-claire-semantic="error"><p id="r-342289" data-claire-element-id="342289">Il y a beaucoup plus simple. Réfléchissons un peu.</p></aside><ul id="r-342295" data-claire-element-id="342295"><li id="r-342292" data-claire-element-id="342292"><p id="r-342291" data-claire-element-id="342291">On veut afficher une image qui se trouve sur le serveur.</p></li><li id="r-342294" data-claire-element-id="342294"><p id="r-342293" data-claire-element-id="342293">On connaît le nom de cette image.</p></li></ul><p id="r-342296" data-claire-element-id="342296">La solution consiste donc à dire au navigateur : <em>« L'image que tu veux afficher, elle se trouve à cette adresse. »</em><br/> Est-ce qu'il existe une fonction qui nous permet de faire ça ?<br/> Oui, toujours notre fameuse fonction <code>headers()</code> !</p><aside id="r-342298" data-claire-element-id="342298" data-claire-semantic="information"><p id="r-342297" data-claire-element-id="342297"><code>header(location: URL);</code> indique au navigateur que la ressource que l'on cherche est en fait à l'URL que l'on a indiquée. <a href="http://fr.php.net/manual/fr/function.header.php">Voici la documentation</a> si vous êtes intéressés.</p></aside><h2 id="r-et-du-fond-des-cieux-vint-le-script" data-claire-element-id="342319">... et du fond des cieux vint le Script</h2><p id="r-342300" data-claire-element-id="342300">Maintenant, vous devez être capables de faire votre avatar aléatoire en trois lignes de code, en tout et pour tout. Voici la solution (ici avec 21 images) :</p><pre id="r-342301" data-claire-element-id="342301"><code data-claire-semantic="html+php">&lt;?php
	header('Location: avatar-'.mt_rand(1,21).'.jpg');
?&gt;</code></pre><p id="r-342302" data-claire-element-id="342302">Le fichier <em>.php</em> ne contient absolument rien d'autre.</p><p id="r-342303" data-claire-element-id="342303">Notez que l'on peut encore réduire ce script à <strong>une seule ligne</strong> :</p><pre id="r-342304" data-claire-element-id="342304"><code data-claire-semantic="html+php">&lt;?php header('Location: avatar-'.mt_rand(1,21).'.jpg'); ?&gt;</code></pre><figure id="r-342306" data-claire-element-id="342307"><img id="r-342305" data-claire-element-id="342305" src="http://kisai.info/avatar/avatar_renard.php" alt="Image utilisateur"/></figure><p id="r-342308" data-claire-element-id="342308">L'image ci-contre fonctionne exactement sous ce principe. Le script PHP est à l'adresse suivante :<br/><code><a href="http://kisai.info/avatar/avatar_renard.php">http://kisai.info/avatar/avatar_renard.php</a></code><br/> Cliquez sur le lien, ou copiez-collez-le dans une autre fenêtre, et vous verrez dans la barre d'URL l'adresse se muer en la véritable adresse de l'image, tandis qu'un superbe renard s'affichera dans votre navigateur : tout fonctionne.</p><aside id="r-342310" data-claire-element-id="342310" data-claire-semantic="warning"><p id="r-342309" data-claire-element-id="342309">J'imagine d'ici que certains d'entre vous avaient utilisé des variables telles que <code>$nombreAleatoire</code> ou <code>$nbImagesTotal</code> pour stocker respectivement le nombre tiré, ou le nombre d'images total. C'est totalement inutile.</p></aside><p id="r-342311" data-claire-element-id="342311">Ce sont des variables utilisées une seule fois, on peut donc les remplacer directement par leur valeur.<br/> Le concept de <em>« variable utilisée une seule fois pour rendre le code plus lisible »</em> peut se comprendre sur un projet de plusieurs centaines de lignes, mais là… non.</p><h3 id="r-avantages-de-cette-methode" data-claire-element-id="342318">Avantages de cette méthode</h3><ul id="r-342316" data-claire-element-id="342316"><li id="r-342313" data-claire-element-id="342313"><p id="r-342312" data-claire-element-id="342312">Le serveur ne fait rien, à part tirer un nombre aléatoire.</p></li><li id="r-342315" data-claire-element-id="342315"><p id="r-342314" data-claire-element-id="342314">On profite du cache du navigateur : si l'on demande l'affichage de avatar-2.jpg et que le navigateur l'a déjà en cache, il n'a pas besoin de la recharger ; alors qu'avec un script sans redirection, il sera toujours obligé de charger l'image.</p></li></ul><p id="r-342317" data-claire-element-id="342317">Bien, et si on compliquait un peu tout ça ?</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire">Créer un avatar aléatoire</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/pourquoi-ce-tuto">
Pourquoi ce tuto ?
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/un-avatar-aleatoire-et-un-serveur-qui-dort-renommer-ses-fichiers">
Un avatar aléatoire et un serveur qui dort : renommer ses fichiers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/l-avatar-semi-aleatoire-et-le-cache">
L&#039;avatar semi-aléatoire et le cache
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/deux-avatars-en-un">
Deux avatars en un
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/feinter-les-protections-faire-croire-que-son-image-aleatoire-est-une-vraie-image">
Feinter les protections : faire croire que son image aléatoire est une vraie image
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/pourquoi-ce-tuto">
<span class="arrow"></span>
<span class="next">Pourquoi ce tuto ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/l-avatar-semi-aleatoire-et-le-cache">
<span class="next">L&#039;avatar semi-aléatoire et le cache</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="L039avatarsemi-alatoireetlecache"></a><h2>L&#039;avatar semi-aléatoire et le cache</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/un-avatar-aleatoire-et-un-serveur-qui-dort-renommer-ses-fichiers">
<span class="arrow"></span>
<span class="next">Un avatar aléatoire et un serveur qui dort : renommer ses fichiers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/deux-avatars-en-un">
<span class="next">Deux avatars en un</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<div id="r-342322" data-claire-element-id="342322" data-claire-semantic="question"><p id="r-342321" data-claire-element-id="342321">D'accord, je vois le concept. Mais si je veux faire quelque chose de plus compliqué, avec un traitement sur l'image ?</p></div><p id="r-342323" data-claire-element-id="342323">L'idée de base est de faire le traitement à chaque fois. Sauf que qui dit « traitement », dit en général « librairie GD », donc lourd… C'est là qu'intervient le système de cache !</p><aside id="r-342325" data-claire-element-id="342325" data-claire-semantic="error"><p id="r-342324" data-claire-element-id="342324">Dans la suite, je considère que vous savez vous servir de la librairie GD de PHP. Si vous ne savez pas, <a href="http://www.siteduzero.com/tutoriel-3-14597-creer-des-images-en-php.html">foncez donc lire le tuto de M@teo21 à ce sujet</a> !</p></aside><h2 id="r-l-avatar-en-deux-ou-plusieurs-parties" data-claire-element-id="342356">L'avatar en deux (ou plusieurs) parties</h2><figure id="r-342327" data-claire-element-id="342328"><img id="r-342326" data-claire-element-id="342326" src="medias/uploads.siteduzero.com_files_167001_168000_167541.png" alt="Image utilisateur"/></figure><p id="r-342329" data-claire-element-id="342329">Imaginons que j'aie <a href="http://kisai.info/avatar/avatar_mbt.php">toute une collection de charmantes demoiselles</a>, dont vous avez un exemple sur votre gauche, et que je veuille en faire mon avatar.<br/> Rien de plus simple, je prends la technique indiquée au-dessus.</p><figure id="r-342331" data-claire-element-id="342332"><img id="r-342330" data-claire-element-id="342330" src="medias/uploads.siteduzero.com_files_167001_168000_167540.png" alt="Image utilisateur"/></figure><p id="r-342333" data-claire-element-id="342333">Sauf que… je veux aussi que mon pseudo apparaisse avec une police classe, en gros, en dessous de mon avatar. Très exactement de la façon dont vous pouvez le voir à droite. Eh bien là, ma méthode ne marche plus !<br/> Il va falloir combiner les deux images, mettre la demoiselle au-dessus du pseudo. Problème : l'image de la demoiselle est aléatoire… Il va donc falloir le faire pour chaque demoiselle. Tout ça sent l'utilisation de PHP GD à plein nez, donc plein de calculs et de difficultés pour votre pauvre serveur.</p><h3 id="r-combiner-les-deux-images" data-claire-element-id="342340">Combiner les deux images</h3><p id="r-342334" data-claire-element-id="342334">Mes images de demoiselles font 150 x 150 pixels, le pseudo 150 x 50 pixels, le tout pour une image finale de 150 x 200 pixels.<br/> J'ai 72 demoiselles différentes, dans les fichiers haut-1.png à haut-72.png ; et mon pseudo est dans le fichier bas.png.</p><p id="r-342335" data-claire-element-id="342335">Si vous connaissez un minimum PHP GD, ça ne pose aucun problème. La variable <code>$haut</code> va nous servir un peu plus loin, c'est sa raison d'être.<br/> Le code qui permet de combiner les deux images ressemble donc à ceci :</p><pre id="r-342336" data-claire-element-id="342336"><code data-claire-semantic="html+php">&lt;?php
// Tirage de l'image aléatoire
$haut = mt_rand(1, 72);

// L'image finale
$iFinale = imagecreatetruecolor(150,200);

// Récupération des images sources
$iHaut = imagecreatefrompng('haut-'.$haut.'.png');
$iBas = imagecreatefrompng('bas.png');

// Collage de l'image haute dans l'image finale
imagecopy($iFinale,
	  $iHaut,
	  0, 0,
	  0, 0,
	  150, 150);
// Collage de l'image basse dans l'image finale
imagecopy($iFinale,
	  $iBas,
	  0, 150,
	  0, 0,
	  150, 50);
?&gt;</code></pre><p id="r-342337" data-claire-element-id="342337">Il ne me reste plus qu'à afficher l'image <code>$iFinale</code>.</p><div id="r-342339" data-claire-element-id="342339" data-claire-semantic="question"><p id="r-342338" data-claire-element-id="342338">Sauf que… Il n'y a que moi que ça chagrine, de refaire les calculs à chaque fois ? Après tout, on n’a que 72 images possibles, or notre avatar va être affiché bien plus que 72 fois…</p></div><h3 id="r-cachez-moi-ces-images-que-je-ne-saurais-voir" data-claire-element-id="342355">Cachez-moi ces images que je ne saurais voir</h3><aside id="r-342342" data-claire-element-id="342342" data-claire-semantic="information"><p id="r-342341" data-claire-element-id="342341">Et si on faisait une bonne fois pour toutes les calculs, et qu'on affichait une image au hasard parmi les images déjà calculées ? Elles ne vont pas changer, ces images, maintenant qu'on les a calculées !</p></aside><p id="r-342343" data-claire-element-id="342343">C'est exactement ça. Et là, deux solutions s'offrent à vous.</p><ul id="r-342348" data-claire-element-id="342348"><li id="r-342345" data-claire-element-id="342345"><p id="r-342344" data-claire-element-id="342344">Vous faites toutes vos images à la main, et utilisez la première solution. Sauf qu'on est feignants, et qu'on ne veut pas faire d'images à la main.</p></li><li id="r-342347" data-claire-element-id="342347"><p id="r-342346" data-claire-element-id="342346">Vous vérifiez si l'image calculée est disponible. Si oui, on l'affiche. Si non, on la calcule, on l'enregistre, et on l'affiche.</p></li></ul><p id="r-342349" data-claire-element-id="342349">Récapitulons : j'ai toujours mes 72 images de demoiselles, mon pseudo, et j'ai à ma disposition un dossier intelligemment appelé « cache ».<br/> De plus, PHP GD dispose d'une fonction qui permet d'enregistrer les images sur le disque dur. Que demande le peuple ?<br/> Si on combine tout ça, on obtient un script PHP qui ressemble à ça :</p><pre id="r-342350" data-claire-element-id="342350"><code data-claire-semantic="html+php">&lt;?php
// Tirage de l'image aléatoire
$haut = mt_rand(1, 72);
// Génération du nom de l'image pré-calculée :
$imgCache = 'cache/h'.$haut.'_b1.jpg';

// Est-ce que mon image existe déjà dans le cache ?
if (!file_exists($imgCache)) {

	// Visiblement, non. Alors on la génère :

	// L'image finale
	$iFinale = imagecreatetruecolor(150,200);

	// Récupération des images sources
	$iHaut = imagecreatefrompng('haut_'.$haut.'.png');
	$iBas = imagecreatefrompng('bas.png');

	// Collage de l'image haute dans l'image finale
	imagecopy($iFinale,
		  $iHaut,
		  0, 0,
		  0, 0,
		  150, 150);
	// Collage de l'image basse dans l'image finale
	imagecopy($iFinale,
		  $iBas,
		  0, 150,
		  0, 0,
		  150, 50);

	// Sauvegarde de l'image
	imagejpeg($iFinale, $imgCache, 90);
}
// Maintenant, on est sûrs que notre image existe, donc on peut l'afficher :
header('Location: '.$imgCache);
?&gt;</code></pre><figure id="r-342352" data-claire-element-id="342353"><img id="r-342351" data-claire-element-id="342351" src="http://kisai.info/avatar/avatar4.php" alt="Image utilisateur"/></figure><p id="r-342354" data-claire-element-id="342354">Le résultat de ce script se trouve à votre droite.<br/> Au bout d'un moment, on va se retrouver avec 72 images dans le dossier « cache », de h1_b1.jpg à h72_b1.jpg, il n'y aura alors plus rien à générer, et votre serveur pourra se la couler douce !<br/> Et mieux, si on ajoute une image 73 (et qu'on pense bien à changer le nombre maximum d'images dans le script), elle va se rajouter toute seule à la liste.</p><h2 id="r-contre-indications" data-claire-element-id="342375">Contre-indications</h2><p id="r-342357" data-claire-element-id="342357">Hélas, la technique du cache ne fonctionne pas avec tous les types d'avatars aléatoires. En fait, je vois deux raisons principales qui empêchent d'utiliser cette technique :</p><h3 id="r-l-avatar-trop-aleatoire" data-claire-element-id="342359">L'avatar trop aléatoire</h3><p id="r-342358" data-claire-element-id="342358">Votre avatar affiche des informations différentes à chaque fois (typiquement : l'heure, l'IP du visiteur…). Là, vous n'avez pas le choix, vous <strong>devez</strong> recalculer l'image à chaque fois.</p><h3 id="r-l-avatar-produit-trop-d-images" data-claire-element-id="342374">L'avatar produit trop d'images</h3><figure id="r-342361" data-claire-element-id="342362"><img id="r-342360" data-claire-element-id="342360" src="http://kisai.info/avatar/avatar3.php" alt="Image utilisateur"/></figure><p id="r-342363" data-claire-element-id="342363">C'est un simple problème de multiplications. L'image que vous avez à votre droite est un de mes anciens avatars. Il est constitué de :</p><ul id="r-342370" data-claire-element-id="342370"><li id="r-342365" data-claire-element-id="342365"><p id="r-342364" data-claire-element-id="342364">3 « fonds » différents ;</p></li><li id="r-342367" data-claire-element-id="342367"><p id="r-342366" data-claire-element-id="342366">13 manières d'écrire « SpaceFox » en différentes langues ;</p></li><li id="r-342369" data-claire-element-id="342369"><p id="r-342368" data-claire-element-id="342368">64 demoiselles différentes.</p></li></ul><p id="r-342371" data-claire-element-id="342371">Un petit calcul m'indique donc que dans mon cache, il y avait au bout d'un moment :<br/><code>3 x 13 x 64 = 2 496</code> images différentes.<br/> Chaque image me prend environ 63 kio, j'ai donc environ <strong>150 Mio</strong> de cache pour cet avatar.</p><aside id="r-342373" data-claire-element-id="342373" data-claire-semantic="warning"><p id="r-342372" data-claire-element-id="342372">Avant de lancer votre avatar sur le serveur, vérifiez s'il y aura la place de mettre tous les fichiers cache !</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire">Créer un avatar aléatoire</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/pourquoi-ce-tuto">
Pourquoi ce tuto ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/un-avatar-aleatoire-et-un-serveur-qui-dort-renommer-ses-fichiers">
Un avatar aléatoire et un serveur qui dort : renommer ses fichiers
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/l-avatar-semi-aleatoire-et-le-cache">
L&#039;avatar semi-aléatoire et le cache
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/deux-avatars-en-un">
Deux avatars en un
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/feinter-les-protections-faire-croire-que-son-image-aleatoire-est-une-vraie-image">
Feinter les protections : faire croire que son image aléatoire est une vraie image
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/un-avatar-aleatoire-et-un-serveur-qui-dort-renommer-ses-fichiers">
<span class="arrow"></span>
<span class="next">Un avatar aléatoire et un serveur qui dort : renommer ses fichiers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/deux-avatars-en-un">
<span class="next">Deux avatars en un</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Deuxavatarsenun"></a><h2>Deux avatars en un</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/l-avatar-semi-aleatoire-et-le-cache">
<span class="arrow"></span>
<span class="next">L&#039;avatar semi-aléatoire et le cache</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/feinter-les-protections-faire-croire-que-son-image-aleatoire-est-une-vraie-image">
<span class="next">Feinter les protections : faire croire que son image aléatoire est une vraie image</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<figure id="r-342378" data-claire-element-id="342379"><img id="r-342377" data-claire-element-id="342377" src="http://www.kisai.info/avatar/avatar4_sdz.php" alt="Image utilisateur"/></figure><p id="r-342380" data-claire-element-id="342380">Cet avatar est très sympathique, et j'aimerais beaucoup pouvoir l'utiliser ailleurs, sur le Site du Zéro par exemple.</p><aside id="r-342382" data-claire-element-id="342382" data-claire-semantic="error"><p id="r-342381" data-claire-element-id="342381">Problème : je ne peux pas l'utiliser directement, les formats ne sont pas compatibles.</p></aside><p id="r-342383" data-claire-element-id="342383">En effet, le site pour lequel j'ai conçu cet avatar accepte des avatars de <strong>150 x 200 pixels</strong>, et le Site du Zéro est limité à <strong>100 x 100 pixels</strong>. Zut. Voilà qui est bien gênant. Que faire ?</p><div id="r-342385" data-claire-element-id="342385" data-claire-semantic="question"><p id="r-342384" data-claire-element-id="342384">Tu peux redimensionner toutes les images de demoiselles (qui sont déjà carrées), et utiliser la première technique pour le Site du Zéro.</p></div><p id="r-342386" data-claire-element-id="342386">Certes, mais :</p><ul id="r-342391" data-claire-element-id="342391"><li id="r-342388" data-claire-element-id="342388"><p id="r-342387" data-claire-element-id="342387">Je suis une feignasse, donc je n'ai pas envie de faire plein de redimensionnements à la main.</p></li><li id="r-342390" data-claire-element-id="342390"><p id="r-342389" data-claire-element-id="342389">Si j'ajoute une image, je devrai aussi la redimensionner pour qu'elle apparaisse dans les deux avatars. Et si je veux avoir trois, quatre, cinq avatars avec les mêmes demoiselles ?</p></li></ul><aside id="r-342393" data-claire-element-id="342393" data-claire-semantic="information"><p id="r-342392" data-claire-element-id="342392">La solution est toute simple : il faut refaire un script. Un set d'images, deux scripts, donc deux avatars. Et si je modifie une image, les deux avatars sont impactés.</p></aside><p id="r-342394" data-claire-element-id="342394">Évidemment, il faut utiliser un système de cache ici aussi, pas question de redimensionner « à la volée ». Je vous donne directement le script :</p><pre id="r-342395" data-claire-element-id="342395"><code data-claire-semantic="html+php">&lt;?php
$id = mt_rand(1, 72);
$imgCache = 'cachesdz/'.$id.'.jpg';

if (!file_exists($imgCache)) {
	$iFinale = imagecreatetruecolor(100,100);	
	imagecopyresampled($iFinale,
			   imagecreatefrompng('haut_'.$id.'.png'),
			   0, 0,
			   0, 0,
			   100, 100,
			   150, 150);
	
	imagejpeg($iFinale, $imgCache, 90);
}
header('Location: '.$imgCache);
?&gt;</code></pre><p id="r-342396" data-claire-element-id="342396">Et voilà comment on obtient deux avatars différents avec un seul set d'images.<br/> L'inconvénient de ce genre de méthodes est qu'il faut modifier les deux fichiers PHP à chaque fois qu'on change le nombre d'images.<br/> Notez que l'on peut toujours contourner ce « problème » en déclarant le nombre d'images dans une constante dans un fichier de configuration (si j'ose dire), qui sera inclus dans tous les avatars.</p><p id="r-342397" data-claire-element-id="342397">Dans config.php :</p><pre id="r-342398" data-claire-element-id="342398"><code data-claire-semantic="html+php">&lt;?php define('NB_DEMOISELLES', 72); ?&gt;</code></pre><p id="r-342399" data-claire-element-id="342399">Puis dans tous les scripts d'avatar :</p><pre id="r-342400" data-claire-element-id="342400"><code data-claire-semantic="html+php">&lt;?php
require('config.php');
$id = mt_rand(1, NB_DEMOISELLES);
// Suite du code spécifique à chaque avatar...
?&gt;</code></pre><p id="r-342401" data-claire-element-id="342401">Ou tout autre système de non-redondance que vous pourriez imaginer. Toutefois, n'oubliez pas que la simplicité est le maître mot de ce tutoriel…</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire">Créer un avatar aléatoire</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/pourquoi-ce-tuto">
Pourquoi ce tuto ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/un-avatar-aleatoire-et-un-serveur-qui-dort-renommer-ses-fichiers">
Un avatar aléatoire et un serveur qui dort : renommer ses fichiers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/l-avatar-semi-aleatoire-et-le-cache">
L&#039;avatar semi-aléatoire et le cache
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/deux-avatars-en-un">
Deux avatars en un
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/feinter-les-protections-faire-croire-que-son-image-aleatoire-est-une-vraie-image">
Feinter les protections : faire croire que son image aléatoire est une vraie image
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/l-avatar-semi-aleatoire-et-le-cache">
<span class="arrow"></span>
<span class="next">L&#039;avatar semi-aléatoire et le cache</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/feinter-les-protections-faire-croire-que-son-image-aleatoire-est-une-vraie-image">
<span class="next">Feinter les protections : faire croire que son image aléatoire est une vraie image</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Feinterlesprotectionsfairecroirequesonimagealatoireestunevraieimage"></a><h2>Feinter les protections : faire croire que son image aléatoire est une vraie image</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/deux-avatars-en-un">
<span class="arrow"></span>
<span class="next">Deux avatars en un</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-342403" data-claire-element-id="342403">Donc vous avez votre script qui marche impec, testé sur votre serveur, et tout. Vous indiquez l'adresse de votre avatar dans votre forum préféré, et…</p><aside id="r-342405" data-claire-element-id="342405" data-claire-semantic="error"><p id="r-342404" data-claire-element-id="342404">Échec. Le serveur veut absolument « une image », donc un nom qui se finit en <em>.jpg</em>, <em>.png</em> ou <em>.gif</em>. Pas moyen de lui passer ce fichu script qui se termine par <em>.php</em>…</p></aside><p id="r-342406" data-claire-element-id="342406">Pas de panique ! Il existe deux manières de contourner ce problème !</p><h2 id="r-la-maniere-barbare-le-parametre-inutile" data-claire-element-id="342416">La manière « barbare » : le paramètre inutile</h2><p id="r-342407" data-claire-element-id="342407"><em>Elle s'appelle ainsi parce qu'elle n'est ni subtile, ni délicate, mais très simple très efficace. Disons, dans 9 cas sur 10.</em></p><p id="r-342408" data-claire-element-id="342408">Il s'agit de passer un paramètre inutile à votre script, et de lui donner la valeur <em>.jpg</em>, <em>.png</em> ou <em>.gif</em>. Au lieu d'indiquer :<br/><code>exemple.com/avatar.php</code><br/> comme adresse d'image, ce qui ne va pas fonctionner, on passe :<br/><code>exemple.com/avatar.php?inutile=.jpg</code></p><p id="r-342409" data-claire-element-id="342409">Et là, tout le monde est content :</p><ul id="r-342414" data-claire-element-id="342414"><li id="r-342411" data-claire-element-id="342411"><p id="r-342410" data-claire-element-id="342410">Le système de protection qui va voir une adresse en <em>.jpg</em>, et en déduire que c'est une image valide.</p></li><li id="r-342413" data-claire-element-id="342413"><p id="r-342412" data-claire-element-id="342412">Le script, qui va recevoir un paramètre (ici « inutile » avec la valeur « .jpg ») dont il se fiche totalement, vu qu'il ne le récupère jamais.</p></li></ul><p id="r-342415" data-claire-element-id="342415">Le gros avantage de cette méthode, c'est qu'elle se fait en 10 secondes sans rien toucher sur votre serveur.</p><h2 id="r-la-maniere-agent-double-le-dossier-deguise-en-fichier" data-claire-element-id="342432">La manière « agent double » : le dossier déguisé en fichier</h2><p id="r-342417" data-claire-element-id="342417"><em>Elle s'appelle ainsi parce qu'elle fonctionne comme un agent double : le dossier se fait passer pour un fichier pour obtenir ce qu'il veut, et c'est très efficace.</em></p><aside id="r-342419" data-claire-element-id="342419" data-claire-semantic="warning"><p id="r-342418" data-claire-element-id="342418">Cette technique ne fonctionne que si vous avez un seul avatar dans le dossier.</p></aside><p id="r-342420" data-claire-element-id="342420">Ici, on va se servir de cette propriété intéressante des serveurs web :</p><p id="r-342421" data-claire-element-id="342421"><cite>Citation : Les règles des serveurs web</cite></p><blockquote id="r-342423" data-claire-element-id="342423"><p id="r-342422" data-claire-element-id="342422">Quand on donne l'adresse d'un dossier à un serveur web, il va automatiquement chercher le fichier <code>index.php</code> ou <code>index.html</code> qu'il y a dedans.</p></blockquote><p id="r-342424" data-claire-element-id="342424">Et qu'est-ce qui m'empêche d'appeler mon dossier <code>avatar.jpg</code> ? Eh bien… rien !<br/> On va devoir toucher un peu à la structure de notre avatar. Il faut :</p><ul id="r-342429" data-claire-element-id="342429"><li id="r-342426" data-claire-element-id="342426"><p id="r-342425" data-claire-element-id="342425">Mettre tous les fichiers (images, script) dans un même dossier que l'on appellera par exemple <code>avatar.jpg</code>.</p></li><li id="r-342428" data-claire-element-id="342428"><p id="r-342427" data-claire-element-id="342427">Renommer le script en <code>index.php</code>.</p></li></ul><p id="r-342430" data-claire-element-id="342430">Puis vous indiquez à votre site l'adresse suivante : <code>exemple.com/avatar.jpg</code><br/> Le site va voir une image, donc va être content et accepter votre avatar. Le serveur, lui, va regarder ce qu'est avatar.jpg et comme c'est un dossier, il va automatiquement appeler :<br/><code>exemple.com/avatar.jpg/index.php</code><br/> ce qui va renvoyer votre image.</p><p id="r-342431" data-claire-element-id="342431">L'avantage de cette solution, c'est qu'elle marche sur n'importe quel serveur ; l'inconvénient est qu'elle ne fonctionne plus, ou plus exactement qu'elle nécessite de sérieuses modifications du code, quand on veut faire plusieurs avatars à partir du même set d'images.</p><h2 id="r-la-maniere-ninja-le-fichier-htaccess" data-claire-element-id="342439">La manière « ninja » : le fichier .htaccess</h2><p id="r-342433" data-claire-element-id="342433"><em>Elle s'appelle ainsi parce qu'elle est subtile, discrète et très, très efficace. En fait, elle ne peut pas échouer.</em></p><p id="r-342434" data-claire-element-id="342434">La première étape, c'est de déclarer qu'on utilise un <strong>vrai fichier image</strong>, on indique comme adresse quelque chose du genre :<br/><code>exemple.com/avatar.jpg</code></p><p id="r-342435" data-claire-element-id="342435">Sauf qu'on va dire à Apache que ce fichier <code>avatar.jpg</code> n'est pas une image, mais notre fichier <code>avatar.php</code>, et ce grâce aux directives htaccess.<br/> Pour ce faire, il faut créer un fichier nommé .htaccess dans le même dossier que votre fichier PHP, qui contient les deux lignes :</p><pre id="r-342436" data-claire-element-id="342436"><code data-claire-semantic="apache">RewriteEngine on
RewriteRule ^avatar\.jpg$ avatar.php [L]</code></pre><p id="r-342437" data-claire-element-id="342437">En fait, on se sert du module de réécriture d'URL d'Apache (ligne 1), et on lui demande de réécrire avatar.jpg (ce que voit le client) en avatar.php (ce qui va être fait sur le serveur).<br/> Je ne détaillerai pas ceci en profondeur, vous pouvez <a href="http://www.siteduzero.com/tutoriel-3-35126-le-htaccess-et-ses-fonctionnalites.html">trouver les informations de base sur les fichiers .htaccess ici</a> et trouver les informations sur la réécriture d'URL un peu partout sur Internet.</p><p id="r-342438" data-claire-element-id="342438">L'avantage de cette technique est qu'elle est imparable : le client, donc le système de protection, n'a aucun moyen de savoir que vous ne lui passez pas une « vraie » image.<br/> Les inconvénients sont que la technique nécessite le <em>ModRewrite</em> activé sur le serveur Apache, et qu'il faut créer le .htaccess en plus.</p><h2 id="r-les-cas-pathologiques" data-claire-element-id="342475">Les cas pathologiques</h2><p id="r-342440" data-claire-element-id="342440">Il existe quelques administrateurs paranoïaques, qui ont entendu parler <a href="http://fr.wikipedia.org/wiki/Cross-site_request_forgery">des failles CSRF</a> et qui ont mis en place des techniques un peu violentes pour s'en prémunir.<br/> Nous allons voir ici deux de ces techniques, et ce qu'on peut faire face à de tels cas.</p><h3 id="r-le-site-telecharge-l-image-et-ne-se-sert-que-de-la-version-locale" data-claire-element-id="342450">Le site télécharge l'image et ne se sert que de la version locale</h3><p id="r-342441" data-claire-element-id="342441">Tout est dans le titre : quand vous donnez une URL, le site télécharge une copie de l'image, et la stocke sur son propre serveur. L'image que voient les visiteurs est celle stockée sur le serveur.</p><aside id="r-342443" data-claire-element-id="342443" data-claire-semantic="error"><p id="r-342442" data-claire-element-id="342442"><strong>Là, vous avez perdu :</strong> il est totalement impossible de faire un avatar aléatoire avec une telle « protection ».</p></aside><p id="r-342444" data-claire-element-id="342444"><em>A priori</em> c'est le cas :</p><ul id="r-342447" data-claire-element-id="342447"><li id="r-342446" data-claire-element-id="342446"><p id="r-342445" data-claire-element-id="342445">Des <strong>avatars</strong> sur les forums Xooit.</p></li></ul><p id="r-342448" data-claire-element-id="342448">Les signatures ne semblent pas affectées : je n'ai pas essayé personnellement mais, si j'ai bien compris, la « technique ninja » fonctionne.</p><p id="r-342449" data-claire-element-id="342449">Si quelqu'un a plus d'informations, merci de les partager dans les commentaires. De même, si quelqu'un connaît d'autres plates-formes ou sites connus qui fonctionnent de cette manière, signalez-le-moi que je puisse tenir cette liste à jour.</p><h3 id="r-le-site-verifie-qu-il-n-y-a-pas-de-redirection" data-claire-element-id="342474">Le site vérifie qu'il n'y a pas de redirection</h3><p id="r-342451" data-claire-element-id="342451">Et sa variante : <strong>le site enregistre l'URL sur laquelle on redirige</strong> au lieu de l'URL que l'on donne.<br/> Or, tout le fonctionnement repose sur ces fameuses redirections, d'où : problème.</p><aside id="r-342453" data-claire-element-id="342453" data-claire-semantic="information"><p id="r-342452" data-claire-element-id="342452">Il faut savoir que le site ne peut vérifier cette redirection <strong>qu'à l'enregistrement</strong> — ou alors doit déployer des moyens complètement déments, qu'aucun webmaster sain d'esprit ne mettra en place.</p></aside><p id="r-342454" data-claire-element-id="342454">La parade fonctionne donc en deux étapes :</p><ol id="r-342459" data-claire-element-id="342459"><li id="r-342456" data-claire-element-id="342456"><p id="r-342455" data-claire-element-id="342455">On fournit une vraie image <code>exemple.com/avatar.jpg</code> au formulaire. Le site la vérifie, et enregistre l'URL telle quelle dans sa base, puisqu'il a vérifié qu'il s'agissait bien d'une vraie image.</p></li><li id="r-342458" data-claire-element-id="342458"><p id="r-342457" data-claire-element-id="342457">Une fois l'enregistrement effectué, on supprime notre vraie image <code>exemple.com/avatar.jpg</code> et on se sert de la « technique ninja » pour faire correspondre <code>exemple.com/avatar.jpg</code> à notre fichier <em>.php</em>.</p></li></ol><p id="r-342460" data-claire-element-id="342460">Personnellement je n'ai jamais vu ce genre de cas ; si quelqu'un connaît des plates-formes / sites connus qui fonctionnent de cette manière, merci de me le signaler en commentaire, que je puisse en faire une liste ici.</p><p id="r-342461" data-claire-element-id="342461">Voilà, maintenant vous savez à peu près tout ce qu'il y a à savoir sur la création d'avatars aléatoires. En résumé :</p><ul id="r-342470" data-claire-element-id="342470"><li id="r-342463" data-claire-element-id="342463"><p id="r-342462" data-claire-element-id="342462">il faut utiliser la redirection vers les images ;</p></li><li id="r-342465" data-claire-element-id="342465"><p id="r-342464" data-claire-element-id="342464">on peut calculer des images, mais dans ce cas un système de cache est très intéressant ;</p></li><li id="r-342467" data-claire-element-id="342467"><p id="r-342466" data-claire-element-id="342466">on peut générer plusieurs avatars pour plusieurs sites à partir d'un même set ;</p></li><li id="r-342469" data-claire-element-id="342469"><p id="r-342468" data-claire-element-id="342468">les protections pour obliger à mettre de vraies images sur les sites sont <em>feintables</em>.</p></li></ul><p id="r-342471" data-claire-element-id="342471">Mais surtout, vous savez que <strong>si vous prenez la peine de nommer correctement vos fichiers, vous épargnez beaucoup de douleurs à votre serveur</strong>, et accessoirement simplifiez vos <em>scripts</em>.<br/> Un peu de travail pour vous, beaucoup moins pour votre serveur.</p><p id="r-342472" data-claire-element-id="342472">En cadeau pour finir, et parce que vous êtes de bons programmeurs, donc de vraies <em>feignasses</em> qui refusent de nommer plein de fichiers à la main, dans l'ordre et sans se tromper, je vous offre ce logiciel qui le fait pour vous : <a href="http://www.antp.be/software/renamer/fr">AntRenamer</a>.<br/> Un petit logiciel bien pratique qui permet de numéroter une liste de fichiers, mais aussi de les renommer de plein de manières différentes.</p><p id="r-342473" data-claire-element-id="342473">Si vous avez des questions, commentaires, réflexions, etc., n'hésitez pas, les commentaires sont là pour ça !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire">Créer un avatar aléatoire</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/pourquoi-ce-tuto">
Pourquoi ce tuto ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/un-avatar-aleatoire-et-un-serveur-qui-dort-renommer-ses-fichiers">
Un avatar aléatoire et un serveur qui dort : renommer ses fichiers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/l-avatar-semi-aleatoire-et-le-cache">
L&#039;avatar semi-aléatoire et le cache
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/deux-avatars-en-un">
Deux avatars en un
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/feinter-les-protections-faire-croire-que-son-image-aleatoire-est-une-vraie-image">
Feinter les protections : faire croire que son image aléatoire est une vraie image
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-avatar-aleatoire/deux-avatars-en-un">
<span class="arrow"></span>
<span class="next">Deux avatars en un</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/creer-un-avatar-aleatoire.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 23:51:31 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/creer-un-avatar-aleatoire.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:12:44 GMT -->
</html>