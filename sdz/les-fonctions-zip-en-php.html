<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/les-fonctions-zip-en-php.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 04:35:30 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/les-fonctions-zip-en-php.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:55:54 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Les fonctions Zip en PHP</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/les-fonctions-zip-en-php.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Les fonctions Zip en PHP</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#LesfonctionsZipenPHP">Les fonctions Zip en PHP</a><br/><a href="#InstancierlaclasseZipArchive">Instancier la classe ZipArchive</a><br/><a href="#Crerouvrirfermerunearchive">Créer, ouvrir, fermer une archive</a><br/><a href="#Ajouterrenommersupprimeretextrairedesfichiers">Ajouter, renommer, supprimer et extraire des fichiers</a><br/><a href="#Autresoprations">Autres opérations</a><br/><a href="#T.P.Rcuprerunearchivedundossier">T.P. — Récupérer une archive d’un dossier</a><br/></div>
<a name="LesfonctionsZipenPHP"></a><h2>Les fonctions Zip en PHP</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/instancier-la-classe-ziparchive">
<span class="next">Instancier la classe ZipArchive</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-529179" data-claire-element-id="529179">Bien souvent, il arrive qu’on veuille récupérer le contenu d’un dossier ; or à moins de télécharger les fichiers un à un, ce n’est pas possible. Avec PHP on peut cependant créer une archive Zip et la proposer au téléchargement.</p><p id="r-529180" data-claire-element-id="529180">Les bases nécessaires à la compréhension de ce tutoriel sont <a href="http://www.siteduzero.com/tutoriel-3-14668-un-site-dynamique-avec-php.html">la programmation en PHP</a> ( :p ) et <a href="http://www.siteduzero.com/tutoriel-3-147180-poo-programmez-oo-en-php.html">la programmation orientée objet</a> (tutoriel de <a href="http://www.siteduzero.com/membres-294-85974.html">vyk12</a>), car les fonctions <em>zip_*</em> ne sont pas nombreuses et ne permettent que la lecture et l’extraction d’une archive. On utilisera donc la classe <a href="http://www.php.net/ziparchive">ZipArchive</a>.<br/> Pour pouvoir utiliser cette classe, il faut que l’extension <em>php_zip</em> soit activée, si elle ne l’est pas il faut la <em>décommenter</em> dans le fichier php.ini.</p><p id="r-529181" data-claire-element-id="529181">Ce tutoriel servira d’introduction aux fonctions Zip.</p>
</div><a name="InstancierlaclasseZipArchive"></a><h2>Instancier la classe ZipArchive</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/creer-ouvrir-fermer-une-archive">
<span class="next">Créer, ouvrir, fermer une archive</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-529182" data-claire-element-id="529182">Je ne suis pas là pour vous apprendre à faire de la POO donc je ne m’étendrai pas là-dessus ; les mots instance, classe, etc. doivent vous être familiers.<br/> Le nom de la classe est <strong>ZipArchive</strong> (<a href="http://www.php.net/ziparchive">documentation</a>), elle permet de gérer totalement une archive de type zip. Elle ne prend aucun paramètre à son instanciation.</p><pre id="r-529183" data-claire-element-id="529183"><code data-claire-semantic="html+php">&lt;?php $zip = new ZipArchive(); ?&gt;</code></pre><p id="r-529184" data-claire-element-id="529184">Ceci va donc créer une instance de cette classe que l’on pourra manipuler tout au long du code.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php">Les fonctions Zip en PHP</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/instancier-la-classe-ziparchive">
Instancier la classe ZipArchive
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/creer-ouvrir-fermer-une-archive">
Créer, ouvrir, fermer une archive
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/ajouter-renommer-supprimer-et-extraire-des-fichiers">
Ajouter, renommer, supprimer et extraire des fichiers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/autres-operations-3">
Autres opérations
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/t-p-recuperer-une-archive-d-un-dossier">
T.P. — Récupérer une archive d’un dossier
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/creer-ouvrir-fermer-une-archive">
<span class="next">Créer, ouvrir, fermer une archive</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Crerouvrirfermerunearchive"></a><h2>Créer, ouvrir, fermer une archive</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/instancier-la-classe-ziparchive">
<span class="arrow"></span>
<span class="next">Instancier la classe ZipArchive</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/ajouter-renommer-supprimer-et-extraire-des-fichiers">
<span class="next">Ajouter, renommer, supprimer et extraire des fichiers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-529186" data-claire-element-id="529186">Le nom de mon instance de ZipArchive sera <em>$zip</em> durant tout le tutoriel.<br/> On a instancié notre classe, on peut donc commencer à la manipuler. Il y a deux cas possibles pour l’ouverture d’une archive :</p><ul id="r-529191" data-claire-element-id="529191"><li id="r-529188" data-claire-element-id="529188"><p id="r-529187" data-claire-element-id="529187">on crée une nouvelle archive ;</p></li><li id="r-529190" data-claire-element-id="529190"><p id="r-529189" data-claire-element-id="529189">on ouvre une archive existante.</p></li></ul><p id="r-529192" data-claire-element-id="529192">La méthode destinée à ouvrir une archive est <code data-claire-semantic="html+php">&lt;?php $zip-&gt;open(); ?&gt; </code>.<br/> Si on veut créer une nouvelle archive, il faudra passer en argument la valeur <code data-claire-semantic="html+php">ZipArchive::CREATE </code> qui lui indiquera qu’il faut ouvrir une nouvelle archive.<br/> Si l’ouverture réussit, la méthode renvoie « TRUE », sinon elle renvoie un code d’erreur. Une liste complète des codes d’erreur est disponible <a href="http://www.php.net/ziparchive-open">ici</a>.</p><aside id="r-529194" data-claire-element-id="529194" data-claire-semantic="information"><p id="r-529193" data-claire-element-id="529193">Pour créer une nouvelle archive, le fichier doit avoir les droits en écriture.<br/> En cas de problème, <code data-claire-semantic="console">chmod 0777 &lt;fichier&gt;</code>.</p></aside><pre id="r-529195" data-claire-element-id="529195"><code data-claire-semantic="html+php">&lt;?php
      $zip = new ZipArchive(); 
      // On ouvre l’archive.
      if($zip-&gt;open('Zip.zip') == TRUE)
      // On crée l’archive.
      if($zip-&gt;open('Zip.zip', ZipArchive::CREATE) == TRUE)
      {
        echo '&amp;quot;Zip.zip&amp;quot; ouvert';
      }
      else
      {
        echo 'Impossible d&amp;#039;ouvrir &amp;quot;Zip.zip&amp;quot;';
	// Traitement des erreurs avec un switch(), par exemple.
      } ?&gt;</code></pre><aside id="r-529197" data-claire-element-id="529197" data-claire-semantic="information"><p id="r-529196" data-claire-element-id="529196">À titre informatif, j’ai pris l’habitude de convertir les entités accentuées et autres choses du même genre en <a href="http://www.commentcamarche.net/contents/html/htmlcarac.php3">code (x)HTML</a>, c’est pour cela que des &amp;quot; et &amp;#039; sont présents dans le code.</p></aside><p id="r-529198" data-claire-element-id="529198">Le code ci-dessus ne fera strictement rien si on crée une nouvelle archive zip car celle-ci est vide et donc ne sera pas sauvegardée. De plus, on ne ferme pas la ressource que nous renvoie <em>$zip</em>.</p><pre id="r-529199" data-claire-element-id="529199"><code data-claire-semantic="html+php">&lt;?php
      $zip = new ZipArchive(); 
      // On ouvre l’archive.
      if($zip-&gt;open('Zip.zip') == TRUE)
      // On crée l’archive.
      if($zip-&gt;open('Zip.zip', ZipArchive::CREATE) == TRUE)
      {
        echo '&amp;quot;Zip.zip&amp;quot; ouvert';

        $zip-&gt;close();
      }
      else
      {
        echo 'Impossible d&amp;#039;ouvrir &amp;quot;Zip.zip&amp;quot;';
	// Traitement des erreurs avec un switch(), par exemple.
      } ?&gt;</code></pre><p id="r-529200" data-claire-element-id="529200">On sait donc comment créer, ouvrir et fermer une archive. Nous allons maintenant passer à l’ajout de fichiers.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php">Les fonctions Zip en PHP</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/instancier-la-classe-ziparchive">
Instancier la classe ZipArchive
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/creer-ouvrir-fermer-une-archive">
Créer, ouvrir, fermer une archive
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/ajouter-renommer-supprimer-et-extraire-des-fichiers">
Ajouter, renommer, supprimer et extraire des fichiers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/autres-operations-3">
Autres opérations
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/t-p-recuperer-une-archive-d-un-dossier">
T.P. — Récupérer une archive d’un dossier
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/instancier-la-classe-ziparchive">
<span class="arrow"></span>
<span class="next">Instancier la classe ZipArchive</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/ajouter-renommer-supprimer-et-extraire-des-fichiers">
<span class="next">Ajouter, renommer, supprimer et extraire des fichiers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Ajouterrenommersupprimeretextrairedesfichiers"></a><h2>Ajouter, renommer, supprimer et extraire des fichiers</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/creer-ouvrir-fermer-une-archive">
<span class="arrow"></span>
<span class="next">Créer, ouvrir, fermer une archive</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/autres-operations-3">
<span class="next">Autres opérations</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-ajouter-des-fichiers-1" data-claire-element-id="529216">Ajouter des fichiers</h2><p id="r-529202" data-claire-element-id="529202">On dispose donc d’une archive avec le code de la partie précédente et à laquelle on va ajouter des fichiers. Commençons avec de simples fichiers texte (*.txt).<br/> Il existe deux méthodes pour cela :</p><ul id="r-529207" data-claire-element-id="529207"><li id="r-529204" data-claire-element-id="529204"><p id="r-529203" data-claire-element-id="529203"><strong>addFile</strong>, pour ajouter un fichier existant ;</p></li><li id="r-529206" data-claire-element-id="529206"><p id="r-529205" data-claire-element-id="529205"><strong>addFromString</strong>, pour écrire directement le contenu.</p></li></ul><p id="r-529208" data-claire-element-id="529208">Ces deux méthodes sont donc <code data-claire-semantic="html+php">&lt;?php $zip-&gt;addFile(); ?&gt;</code> et <code data-claire-semantic="html+php">&lt;?php $zip-&gt;addFromString(); ?&gt;</code> (elles écrasent le contenu si le fichier existe déjà), elles renvoient toutes les deux un booléen. <br/> Notez que <code data-claire-semantic="html+php">&lt;?php $zip-&gt;addFile(); ?&gt;</code> possède un paramètre facultatif qui permet de changer le nom du fichier dans l’archive.</p><pre id="r-529209" data-claire-element-id="529209"><code data-claire-semantic="html+php">bool ZipArchive::addFile  ( string $filename  [, string $localname  ] )</code></pre><p id="r-529210" data-claire-element-id="529210">Le contenu du fichier .txt sera très simple.</p><pre id="r-529211" data-claire-element-id="529211"><code>Je suis le contenu de Fichier.txt !</code></pre><pre id="r-529212" data-claire-element-id="529212"><code data-claire-semantic="html+php">&lt;?php
      $zip = new ZipArchive(); 
      if($zip-&gt;open('Zip.zip', ZipArchive::CREATE) === true)
      {
        echo '&amp;quot;Zip.zip&amp;quot; ouvert&lt;br/&gt;';
	
	// Ajout d’un fichier.
	$zip-&gt;addFile('Fichier.txt');
	
	// Ajout direct.
	$zip-&gt;addFromString('Fichier.txt', 'Je suis le contenu de Fichier.txt !');

        // Et on referme l'archive.
	$zip-&gt;close();
      }
      else
      {
        echo 'Impossible d&amp;#039;ouvrir &amp;quot;Zip.zip&lt;br/&gt;';
	// Traitement des erreurs avec un switch(), par exemple.
      }</code></pre><p id="r-529213" data-claire-element-id="529213">L’ajout de fichier est donc très simple : pour de simples fichiers contenant du texte on passe par <code data-claire-semantic="html+php">&lt;?php $zip-&gt;addFromString(); ?&gt;</code> et pour ce qui est des images, des documents Word, XML, etc., on passe par <code data-claire-semantic="html+php">&lt;?php $zip-&gt;addFile(); ?&gt;</code>.</p><p id="r-529214" data-claire-element-id="529214">Si on veut organiser son archive, on peut y créer des dossiers, soit en passant par <code data-claire-semantic="html+php">&lt;?php $zip-&gt;addEmptyDir('Le nom du dossier'); ?&gt;</code>, soit en précisant directement un nom de dossier lors de l’ajout du fichier.</p><pre id="r-529215" data-claire-element-id="529215"><code data-claire-semantic="html+php">&lt;?php $zip = new ZipArchive(); 
      if($zip-&gt;open('Zip.zip', ZipArchive::CREATE) === true)
      {
        echo '&amp;quot;Zip.zip&amp;quot; ouvert&lt;br/&gt;';
 
	// Création d'un dossier par addEmptyDir(). [Facultatif]
        $zip-&gt;addEmptyDir('Fichiers textes');
 
	// Ajout d'un fichier.
	$zip-&gt;addFile('Fichiers textes/Fichier.txt');
	
	// Ajout directement.
	$zip-&gt;addFromString('Fichiers textes/Fichier.txt', 'Je suis le contenu de Fichier.txt !');

        // Et on referme l’archive.
	$zip-&gt;close();
      }
      else
      {
        echo 'Impossible d&amp;#039;ouvrir &amp;quot;Zip.zip&lt;br/&gt;';
	// Traitement des erreurs avec un switch(), par exemple.
      }</code></pre><h2 id="r-renommer-et-supprimer" data-claire-element-id="529219">Renommer et supprimer</h2><p id="r-529217" data-claire-element-id="529217">Pour renommer et supprimer des fichiers, on dispose de deux méthodes. On peut soit passer le nom du fichier, soit passer son numéro d'index (récupérable par <code data-claire-semantic="html+php">&lt;?php $zip-&gt;locateName('nom du fichier'); ?&gt;</code>). Elles renvoient toutes deux un booléen indiquant le succès de l’opération.</p><pre id="r-529218" data-claire-element-id="529218"><code data-claire-semantic="html+php">&lt;?php // Suppression en passant par l’index.
      $zip-&gt;deleteIndex(3);
      
      // Suppression en passant par le nom du fichier.
      $zip-&gt;deleteName('Nom du fichier.extension');
      
      // Renommer en passant par l’index.
      $zip-&gt;renameIndex(3, 'Nouveau nom.extension');
      
      // Renommer en passant par le nom.
      $zip-&gt;renameName('Fichier.extension', 'Nouveau Nom.extension'); ?&gt;</code></pre><h2 id="r-extraire-les-fichiers" data-claire-element-id="529222">Extraire les fichiers</h2><p id="r-529220" data-claire-element-id="529220">Il est possible d’extraire le contenu de l’archive (seulement une/plusieurs entrée(s) ou même l’archive complète) grâce à la méthode <code data-claire-semantic="html+php">&lt;?php $zip-&gt;extractTo(); ?&gt;</code>.</p><pre id="r-529221" data-claire-element-id="529221"><code data-claire-semantic="html+php">&lt;?php // Extraction unique dans le dossier courant.
      $zip-&gt;extractTo('.', 'Fichier.txt');
	
      // Extractions multiples dans le dossier courant.
      $zip-&gt;extractTo('.', array('Fichier.txt', 'Autre fichier.txt')); ?&gt;</code></pre>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php">Les fonctions Zip en PHP</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/instancier-la-classe-ziparchive">
Instancier la classe ZipArchive
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/creer-ouvrir-fermer-une-archive">
Créer, ouvrir, fermer une archive
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/ajouter-renommer-supprimer-et-extraire-des-fichiers">
Ajouter, renommer, supprimer et extraire des fichiers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/autres-operations-3">
Autres opérations
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/t-p-recuperer-une-archive-d-un-dossier">
T.P. — Récupérer une archive d’un dossier
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/creer-ouvrir-fermer-une-archive">
<span class="arrow"></span>
<span class="next">Créer, ouvrir, fermer une archive</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/autres-operations-3">
<span class="next">Autres opérations</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Autresoprations"></a><h2>Autres opérations</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/ajouter-renommer-supprimer-et-extraire-des-fichiers">
<span class="arrow"></span>
<span class="next">Ajouter, renommer, supprimer et extraire des fichiers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/t-p-recuperer-une-archive-d-un-dossier">
<span class="next">T.P. — Récupérer une archive d’un dossier</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-529224" data-claire-element-id="529224">La classe <em>ZipArchive</em> possède d’autres méthodes qui permettent de gérer les commentaires sur l’archive et ses fichiers, d’annuler les actions faites depuis l'ouverture, de récupérer les statistiques d’un fichier, etc.</p><pre id="r-529225" data-claire-element-id="529225"><code data-claire-semantic="html+php">&lt;?php 	// Mettre un commentaire sur l’archive.
	$zip-&gt;setArchiveComment('Mon joli commentaire sur l\'archive.');
	
	// Récupérer le commentaire sur l’archive.
	$commentaire = $zip-&gt;getArchiveComment();
	
	// Mettre un commentaire sur un fichier.
	$zip-&gt;setCommentIndex(3, 'Mon joli commentaire de fichier.');
	$zip-&gt;setCommentName('Fichier.extension', 'Et paf un commentaire !');
	
	// Récupérer le commentaire sur le fichier.
	$commentaire = $zip-&gt;getCommentIndex(3);
	$commentaire = $zip-&gt;getCommentName('Fichier.extension'); ?&gt;</code></pre><p id="r-529226" data-claire-element-id="529226">S’il y a un nombre conséquent d’archives *.zip, on peut se servir des commentaires pour préciser leur contenu lorsque celui-ci n’est pas explicité par le nom (il en va de même pour les fichiers si leurs noms ne sont également pas significatifs).</p><p id="r-529227" data-claire-element-id="529227">Pour ce qui est de l’annulation de modifications, je vous laisse lire la documentation :</p><ul id="r-529236" data-claire-element-id="529236"><li id="r-529229" data-claire-element-id="529229"><p id="r-529228" data-claire-element-id="529228"><a href="http://www.php.net/ziparchive-unchangeall">ZipArchive::unchangeAll()</a> ;</p></li><li id="r-529231" data-claire-element-id="529231"><p id="r-529230" data-claire-element-id="529230"><a href="http://www.php.net/ziparchive-unchangearchive">ZipArchive::unchangeArchive()</a> ;</p></li><li id="r-529233" data-claire-element-id="529233"><p id="r-529232" data-claire-element-id="529232"><a href="http://www.php.net/ziparchive-unchangeindex">ZipArchive::unchangeIndex()</a> ;</p></li><li id="r-529235" data-claire-element-id="529235"><p id="r-529234" data-claire-element-id="529234"><a href="http://www.php.net/ziparchive-unchangename">ZipArchive::unchangeName()</a>.</p></li></ul><p id="r-529237" data-claire-element-id="529237">Pour récupérer le contenu d’un fichier présent dans l’archive, on peut récupérer un flux <em>(resource)</em> de la même manière qu’avec <em>fopen()</em> qu’on pourra ensuite exploiter uniquement au moyen de fonctions de <strong>lecture</strong> comme <em>fgetc()</em>, <em>fgets()</em>, <em>fread()</em>, etc., étant donné que l’écriture n’est pas encore implémentée.<br/> On peut s’en servir pour vérifier le contenu d'un fichier (grâce aux sommes md5 ou sha1, par exemple), récupérer un fichier sans extraire toute l’archive, etc.</p><pre id="r-529238" data-claire-element-id="529238"><code data-claire-semantic="html+php">&lt;?php $flux = $zip-&gt;getStream('Fichier.extension');
      // Je ne teste pas si le flux est bien retourné mais normalement il faut le tester, avec is_resource(), par exemple.
      $temp = '';
      
      while($ligne = fgets($flux))
      {
        $temp .= $ligne;
      }

      echo $temp; ?&gt;</code></pre><p id="r-529239" data-claire-element-id="529239">Ci-dessous, un exemple de récupération directe de contenu sans passer par une fonction <em>f*()</em>.</p><pre id="r-529240" data-claire-element-id="529240"><code data-claire-semantic="html+php">&lt;?php	// Récupérer le contenu d’un fichier directement avec l'index du fichier ou son nom.
	$contenu = $zip-&gt;getFromIndex(3);
	$contenu = $zip-&gt;getFromName('Fichier.extension'); ?&gt;</code></pre><p id="r-529241" data-claire-element-id="529241">L’inverse de <a href="http://www.php.net/ziparchive-locatename">ZipArchive::locateName()</a> est <a href="http://www.php.net/ziparchive-getnameindex">ZipArchive::getNameIndex()</a>, qui permet d’obtenir le nom d’un fichier à partir de son index.</p><p id="r-529242" data-claire-element-id="529242">Il existe bien d’autres fonctions qui sont toutes consultables <a href="http://www.php.net/ziparchive">ici</a>.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php">Les fonctions Zip en PHP</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/instancier-la-classe-ziparchive">
Instancier la classe ZipArchive
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/creer-ouvrir-fermer-une-archive">
Créer, ouvrir, fermer une archive
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/ajouter-renommer-supprimer-et-extraire-des-fichiers">
Ajouter, renommer, supprimer et extraire des fichiers
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/autres-operations-3">
Autres opérations
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/t-p-recuperer-une-archive-d-un-dossier">
T.P. — Récupérer une archive d’un dossier
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/ajouter-renommer-supprimer-et-extraire-des-fichiers">
<span class="arrow"></span>
<span class="next">Ajouter, renommer, supprimer et extraire des fichiers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/t-p-recuperer-une-archive-d-un-dossier">
<span class="next">T.P. — Récupérer une archive d’un dossier</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="T.P.Rcuprerunearchivedundossier"></a><h2>T.P. — Récupérer une archive d’un dossier</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/autres-operations-3">
<span class="arrow"></span>
<span class="next">Autres opérations</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-sujet-1" data-claire-element-id="529255">Sujet</h2><p id="r-529244" data-claire-element-id="529244">Rien ne vaut un bon T.P. pour finir ce tutoriel assez simple. Pour ceux qui connaissent <a href="http://fr.dotclear.org/">Dotclear</a>, bien que cela doit exister ailleurs aussi, vous avez pu remarquer la possibilité de « Télécharger ce répertoire dans un fichier zip ». L’objectif de ce T.P. est donc le suivant : récupérer le contenu d’un dossier dans une archive et la proposer en téléchargement.<br/> Je vous renvoie à cette <a href="http://www.siteduzero.com/tutoriel-3-37674-upload-de-fichiers-par-formulaire.html#ss_part_4">sous-partie</a> du tuto de <a href="http://www.siteduzero.com/membres-294-6.html">DHKold</a>. Lisez le passage expliquant comment envoyer un fichier au client dans « Téléchargement avec compteur ».<br/> Voici quelques méthodes pour lister les fichiers dans un dossier :</p><ul id="r-529251" data-claire-element-id="529251"><li id="r-529246" data-claire-element-id="529246"><p id="r-529245" data-claire-element-id="529245"><a href="http://php.net/scandir">scandir()</a> ;</p></li><li id="r-529248" data-claire-element-id="529248"><p id="r-529247" data-claire-element-id="529247"><a href="http://php.net/glob">glob()</a> ;</p></li><li id="r-529250" data-claire-element-id="529250"><p id="r-529249" data-claire-element-id="529249"><a href="http://php.net/opendir">opendir()</a> couplé avec <a href="http://php.net/readdir">readdir()</a>.</p></li></ul><p id="r-529252" data-claire-element-id="529252">Vous pouvez ensuite décider d’implémenter ou non la récursivité. Si oui, un dossier présent dans le répertoire à archiver sera lui aussi mis dans le fichier zip. Sinon, il ne sera pas pris en compte et seuls les fichiers se trouvant directement dans le répertoire courant seront pris en compte.</p><p id="r-529253" data-claire-element-id="529253">Après, tout dépend de vous, le corrigé vous présentera une méthode sans la récursivité, pour faciliter les choses.</p><p id="r-529254" data-claire-element-id="529254">Attention ! 3, 2, 1, Codez ! Oui, je m’y crois trop. :p</p><h2 id="r-solution-87" data-claire-element-id="529259">Solution</h2><p id="r-529256" data-claire-element-id="529256">Ma solution n’est pas <strong>la</strong> solution, c’est simplement une solution possible.</p><pre id="r-529257" data-claire-element-id="529257"><code data-claire-semantic="html+php">&lt;?php // On instancie la classe.
      $zip = new ZipArchive();
      
      if(is_dir('upload/'))
      {
        // On teste si le dossier existe, car sans ça le script risque de provoquer des erreurs.
	
        if($zip-&gt;open('Archive.zip', ZipArchive::CREATE) == TRUE)
	{
	  // Ouverture de l’archive réussie.

	  // Récupération des fichiers.
	  $fichiers = scandir('upload/');
	  // On enlève . et .. qui représentent le dossier courant et le dossier parent.
	  unset($fichiers[0], $fichiers[1]);
	  
	  foreach($fichiers as $f)
	  {
	    // On ajoute chaque fichier à l’archive en spécifiant l’argument optionnel.
	    // Pour ne pas créer de dossier dans l’archive.
	    if(!$zip-&gt;addFile('upload/'.$f, $f))
	    {
	      echo 'Impossible d&amp;#039;ajouter &amp;quot;'.$f.'&amp;quot;.&lt;br/&gt;';
	    }
	  }
	
	  // On ferme l’archive.
	  $zip-&gt;close();
	
	  // On peut ensuite, comme dans le tuto de DHKold, proposer le téléchargement.
	  header('Content-Transfer-Encoding: binary'); //Transfert en binaire (fichier).
	  header('Content-Disposition: attachment; filename=&quot;Archive.zip&quot;'); //Nom du fichier.
	  header('Content-Length: '.filesize('Archive.zip')); //Taille du fichier.
	  
	  readfile('Archive.zip');
	}
	else
	{
	  // Erreur lors de l’ouverture.
	  // On peut ajouter du code ici pour gérer les différentes erreurs.
	  echo 'Erreur, impossible de créer l&amp;#039;archive.';
	}
      }
      else
      {
        // Possibilité de créer le dossier avec mkdir().
        echo 'Le dossier &amp;quot;upload/&amp;quot; n&amp;#039;existe pas.';
      } ?&gt;</code></pre><p id="r-529258" data-claire-element-id="529258">Voilà, ce tutoriel est fini. <br/> J’espère vous avoir aidés. Si vous avez une question vous pouvez me contacter par <a href="http://www.siteduzero.com/mp-273-73764.html">M.P.</a> :)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php">Les fonctions Zip en PHP</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/instancier-la-classe-ziparchive">
Instancier la classe ZipArchive
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/creer-ouvrir-fermer-une-archive">
Créer, ouvrir, fermer une archive
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/ajouter-renommer-supprimer-et-extraire-des-fichiers">
Ajouter, renommer, supprimer et extraire des fichiers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/autres-operations-3">
Autres opérations
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/t-p-recuperer-une-archive-d-un-dossier">
T.P. — Récupérer une archive d’un dossier
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-fonctions-zip-en-php/autres-operations-3">
<span class="arrow"></span>
<span class="next">Autres opérations</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/les-fonctions-zip-en-php.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 04:35:30 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/les-fonctions-zip-en-php.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:55:54 GMT -->
</html>