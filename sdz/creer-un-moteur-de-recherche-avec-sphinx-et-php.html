<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/creer-un-moteur-de-recherche-avec-sphinx-et-php.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 06:36:45 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/creer-un-moteur-de-recherche-avec-sphinx-et-php.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:10:55 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Créer un moteur de recherche avec Sphinx et PHP</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Créer un moteur de recherche avec Sphinx et PHP</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#CrerunmoteurderechercheavecSphinxetPHP">Créer un moteur de recherche avec Sphinx et PHP</a><br/><a href="#InstallationdeSphinx">Installation de Sphinx</a><br/><a href="#RecherchonsavecSphinx">Recherchons avec Sphinx</a><br/><a href="#ExploitonsSphinxavecPHP">Exploitons Sphinx avec PHP</a><br/></div>
<a name="CrerunmoteurderechercheavecSphinxetPHP"></a><h2>Créer un moteur de recherche avec Sphinx et PHP</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php/installation-de-sphinx">
<span class="next">Installation de Sphinx</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-547211" data-claire-element-id="547211">Vous avez envie de faire un moteur de recherche, mais vous ne savez pas comment vous y prendre ? Vous ne voulez pas vous embêter à construire des requêtes SQL au risque de vous embrouiller ? Vous avez déjà fait un moteur de recherche, mais il n'est pas très performant et vous en cherchez alors un puissant ? Ce tutoriel est fait pour vous !</p><p id="r-547212" data-claire-element-id="547212">Je vais ici vous présenter un moteur de recherche très utilisé, que ce soit par les très gros sites ou les petits sites faits maison. En effet, Sphinx est l'un des moteurs les plus puissants qui existent, avec une vitesse de recherche impressionnante. Il a l'avantage d'être compatible avec de nombreux langages, comme PHP, Python et Java par exemple. Ici, nous l'exploiterons avec PHP.</p><p id="r-547213" data-claire-element-id="547213">Pour vous montrer la puissance de cette bibliothèque, j'ajouterai que <a href="http://sphinxsearch.com/info/powered/">de nombreux sites utilisent Sphinx</a>, tels que Dailymotion, joomla.org, mysql.com, et même le SdZ. Le plus gros site utilisant Sphinx hébergeant environ 2 TB de données, cela vous donne une idée de la puissance du moteur. ;)</p><aside id="r-547215" data-claire-element-id="547215" data-claire-semantic="information"><p id="r-547214" data-claire-element-id="547214">Pour utiliser Sphinx, il va falloir l'installer sur le serveur. Assurez-vous donc que vous ayez les droits nécessaires pour effectuer de telles opérations.</p></aside>
</div><a name="InstallationdeSphinx"></a><h2>Installation de Sphinx</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php/recherchons-avec-sphinx">
<span class="next">Recherchons avec Sphinx</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-547216" data-claire-element-id="547216">Commençons par télécharger les fichiers nécessaires au fonctionnement de Sphinx. Pour cela, rendez-vous sur <a href="http://sphinxsearch.com/">le site de Sphinx</a>, rubrique <a href="http://sphinxsearch.com/downloads/">Téléchargements</a>. Choisissez ensuite <a href="http://sphinxsearch.com/downloads/release/">la version <em>release</em></a>. Si vous êtes sous Windows, téléchargez le fichier <strong>Win32 binaries w/MySQL support</strong>. Sinon, si vous êtes sous Linux ou Mac OS par exemple, téléchargez le fichier <strong>Source tarball (tar.gz)</strong>.</p><aside id="r-547218" data-claire-element-id="547218" data-claire-semantic="information"><p id="r-547217" data-claire-element-id="547217">Gardez cette archive dans un coin de votre ordinateur, même après l'installation finie, car elle comporte un dossier (<strong>api</strong>) dont nous nous servirons par la suite.</p></aside><h2 id="r-installation-et-mise-en-route-sous-windows" data-claire-element-id="547230">Installation et mise en route sous Windows</h2><h3 id="r-installation-86" data-claire-element-id="547223">Installation</h3><p id="r-547219" data-claire-element-id="547219">Décompressez l'archive à la racine de votre disque dur, et renommez le dossier en <strong>Sphinx</strong>. Si votre disque dur se nomme <strong>C:</strong>, vous devriez avoir un dossier <strong>C:\Sphinx</strong>.</p><p id="r-547220" data-claire-element-id="547220">Ouvrez ensuite l'invite de commandes. Pour cela, cliquez sur le menu <strong>Démarrer</strong>, puis dans <strong>Exécuter</strong> tapez <strong>cmd</strong> et validez. Si votre dossier contenant sphinx est <strong>C:\Sphinx</strong>, tapez dans la fenêtre ouverte cette commande :</p><pre id="r-547221" data-claire-element-id="547221"><code data-claire-semantic="console">C:\Sphinx\bin\searchd --install --config C:\Sphinx\sphinx.conf --servicename SphinxSearch</code></pre><p id="r-547222" data-claire-element-id="547222">Ceci aura pour effet d'enregistrer le service <strong>searchd</strong> dans Windows.</p><h3 id="r-mise-en-route-6" data-claire-element-id="547229">Mise en route</h3><p id="r-547224" data-claire-element-id="547224">Le service est par défaut arrêté, il faut que vous l'activiez manuellement. Pour cela, nous allons d'abord configurer un petit peu Sphinx. Avec Sphinx, toutes les options de configuration se font dans un fichier texte : <strong>sphinx.conf</strong>, situé dans le dossier <strong>C:\Sphinx</strong>. Créez donc ce fichier, et mettez-y à l'intérieur :</p><pre id="r-547225" data-claire-element-id="547225"><code>index dist
{
        type = distributed
}

searchd
{
        port      = 3312
        log       = C:\Sphinx\var\searchd.log
        query_log = C:\Sphinx\var\query.log
        pid_file  = C:\Sphinx\var\searchd.pid
}</code></pre><p id="r-547226" data-claire-element-id="547226">Puis créez un dossier <strong>var</strong> dans <strong>C:\Sphinx</strong>, ainsi qu'un dossier <strong>data</strong> dans le dossier <strong>var</strong> que vous venez de créer. Maintenant, Sphinx est correctement configuré pour être lancé. Rouvrez la console (<strong>Démarrer</strong>, puis <strong>Exécuter...</strong>, puis <strong>cmd</strong>) et entrez :</p><pre id="r-547227" data-claire-element-id="547227"><code data-claire-semantic="console">net start SphinxSearch</code></pre><p id="r-547228" data-claire-element-id="547228">Sphinx est désormais lancé !</p><h2 id="r-installation-et-mise-en-route-sous-linux-et-mac-os" data-claire-element-id="547251">Installation et mise en route sous Linux et Mac OS</h2><h3 id="r-installation-87" data-claire-element-id="547243">Installation</h3><p id="r-547231" data-claire-element-id="547231">Vous devriez avoir l'archive <strong>.tar.gz</strong> dans le dossier où vous l'avez téléchargée. Dans un premier temps, décompressez l'archive (clic droit &gt; Extraire ici, ou <em>via</em> un terminal avec la commande <code data-claire-semantic="console">tar xzvf sphinx-0.9.9.tar.gz</code> par exemple). Pour qu'on ait tous le même dossier (ce qui peut varier à cause du numéro de version), renommez-le <strong>sphinx</strong>.</p><p id="r-547232" data-claire-element-id="547232">Avant de compiler la bibliothèque, nous devons nous assurer que vous avez les outils nécessaires. Il vous faudra deux outils : <strong>gcc</strong> et <strong>make</strong> (sous ubuntu). Pour les installer, il faut vous octroyer le paquet <strong>build-essential</strong> (<code data-claire-semantic="console">sudo apt-get install build-essential</code>).</p><p id="r-547233" data-claire-element-id="547233">Nous voilà parés. Ouvrez le terminal si ce n'est pas déjà fait, et dirigez-vous dans le dossier <em>via</em> la commande <code data-claire-semantic="console">cd</code>. Invoquons maintenant le fichier de configuration avec cette commande :</p><pre id="r-547234" data-claire-element-id="547234"><code data-claire-semantic="console">./configure --prefix=/usr/local/sphinx</code></pre><p id="r-547235" data-claire-element-id="547235">L'option <strong>--prefix</strong> indique au programme l'emplacement désiré où installer Sphinx.</p><aside id="r-547237" data-claire-element-id="547237" data-claire-semantic="information"><p id="r-547236" data-claire-element-id="547236">Si la console vous affiche une erreur stipulant qu'elle ne trouve pas les fichiers d'inclusion de MySQL, installez le paquet <strong>libmysqlclient15-dev</strong> (sous ubuntu). Il contient un programme qui sera invoqué par le fichier de configuration lui permettant de localiser ces fichiers.</p></aside><p id="r-547238" data-claire-element-id="547238">Nous allons maintenant compiler les sources pour créer les fichiers binaires :</p><pre id="r-547239" data-claire-element-id="547239"><code data-claire-semantic="console">make</code></pre><p id="r-547240" data-claire-element-id="547240">Tout simplement. ;) <br/> Maintenant que tous les fichiers sont prêts, il ne manque plus qu'à les installer :</p><pre id="r-547241" data-claire-element-id="547241"><code data-claire-semantic="console">sudo make install</code></pre><p id="r-547242" data-claire-element-id="547242">Et tout est bon ! :)</p><h3 id="r-mise-en-route-7" data-claire-element-id="547250">Mise en route</h3><p id="r-547244" data-claire-element-id="547244">Avant de démarrer Sphinx, il va falloir le configurer un minimum. Sphinx se configure à l'aide d'un fichier de configuration du nom de <strong>sphinx.conf</strong> dans le dossier <strong>/usr/local/sphinx/etc</strong> s'il n'existe pas, créez-le). À l'intérieur de ce fichier, copiez/collez ceci :</p><pre id="r-547245" data-claire-element-id="547245"><code>searchd
{
        port      = 3312
        log       = /usr/local/sphinx/var/log/searchd/searchd.log
        query_log = /usr/local/sphinx/var/log/searchd/query.log
        pid_file  = /usr/local/sphinx/var/log/searchd/searchd.pid
}</code></pre><p id="r-547246" data-claire-element-id="547246">Ces données informent le moteur de recherche qu'il devra écouter le port <strong>3312</strong> de l'ordinateur (c'est à ce port qu'on se connectera pour exécuter une requête), qu'il stockera son historique dans les fichiers <strong>searchd.log</strong> et <strong>query.log</strong>, et enfin que le fichier associé au processus que Sphinx créera sera <strong>searchd.pid</strong>.</p><p id="r-547247" data-claire-element-id="547247">Pour démarrer Sphinx, il suffit de démarrer le service <strong>sphinx</strong>. Pour cela, si vous êtes sous Ubuntu, la simple commande <code data-claire-semantic="console">sudo service sphinx start</code> suffit.</p><p id="r-547248" data-claire-element-id="547248">Pour des raisons pratiques, nous allons créer des liens pointant vers les outils de Sphinx (se situant dans le dossier <strong>/usr/local/sphinx/bin</strong> si vous avez utilisé le même préfixe que moi). Pour cela, il va falloir, pour chaque fichier, exécuter une commande :</p><pre id="r-547249" data-claire-element-id="547249"><code data-claire-semantic="console">sudo ln -s /usr/local/sphinx/bin/indexer /usr/local/bin/indexer
sudo ln -s /usr/local/sphinx/bin/indextool /usr/local/bin/indextool
sudo ln -s /usr/local/sphinx/bin/search /usr/local/bin/search
sudo ln -s /usr/local/sphinx/bin/searchd /usr/local/bin/searchd
sudo ln -s /usr/local/sphinx/bin/spelldump /usr/local/bin/spelldump</code></pre>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php">Créer un moteur de recherche avec Sphinx et PHP</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php/installation-de-sphinx">
Installation de Sphinx
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php/recherchons-avec-sphinx">
Recherchons avec Sphinx
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php/exploitons-sphinx-avec-php">
Exploitons Sphinx avec PHP
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php/recherchons-avec-sphinx">
<span class="next">Recherchons avec Sphinx</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="RecherchonsavecSphinx"></a><h2>Recherchons avec Sphinx</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php/installation-de-sphinx">
<span class="arrow"></span>
<span class="next">Installation de Sphinx</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php/exploitons-sphinx-avec-php">
<span class="next">Exploitons Sphinx avec PHP</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-le-fonctionnement-de-sphinx" data-claire-element-id="547261">Le fonctionnement de Sphinx</h2><p id="r-547253" data-claire-element-id="547253">Avant de commencer à rentrer dans le vif du sujet et utiliser bêtement le moteur sans savoir ce qu'on fait, on va d'abord se pencher sur son mode de fonctionnement.</p><p id="r-547254" data-claire-element-id="547254">Imaginez votre bureau en désordre, avec vos notes ou vos factures éparpillées n'importe où. Si on vous demandait de retrouver tel montant sur telle facture, vous mettriez un temps fou pour le retrouver ! Pour pallier ce problème, il est recommandé de <strong>trier</strong> ses papiers pour pouvoir ensuite <strong>rechercher</strong> à n'importe quel moment et rapidement les informations nécessaires. Et c'est exactement comme ça que Sphinx fonctionne.</p><p id="r-547255" data-claire-element-id="547255">Sphinx Search est un moteur de recherche qui permet de rechercher à une grande vitesse du contenu à travers des milliers de documents. Pour ce faire, il a besoin (comme vous et vos papiers) de <strong>connaitre</strong> ces documents et de les ranger de façon à ce qu'il puisse les retrouver facilement. En effet, si on lui demandait de rechercher à travers une grosse quantité de données sans qu'il ne les ai jamais vues, il devrait tout lire à chaque recherche pour effectuer ensuite des opérations complexes sur les données pour voir si le document correspond à la requête. Tout cela serait bien long, et c'est pour quoi Sphinx opère en deux étapes.</p><ul id="r-547260" data-claire-element-id="547260"><li id="r-547257" data-claire-element-id="547257"><p id="r-547256" data-claire-element-id="547256">La première étape est l'étape <strong>d'indexation</strong>. Cette étape est l'étape de <strong>lecture</strong>. C'est à cette étape que Sphinx va lire toutes les données pour les <strong>indexer</strong>. Il va alors se constituer une grande bibliothèque avec toutes ces données indexées qu'il pourra donc retrouver plus facilement. Cela soulève donc un léger problème, mais nous y reviendrons en temps voulu.</p></li><li id="r-547259" data-claire-element-id="547259"><p id="r-547258" data-claire-element-id="547258">La seconde étape est simplement l'étape de <strong>recherche</strong>. Puisque Sphinx a déjà rangé toutes les données, il est capable de les retrouver en un temps record.</p></li></ul><h2 id="r-preparation-du-terrain-6" data-claire-element-id="547263">Préparation du terrain</h2><p id="r-547262" data-claire-element-id="547262">Avant de procéder à une recherche, encore faudrait-il avoir des données à rechercher ! Pour que l'on travaille tous sur une même base de travail, je vous propose de télécharger une <a href="http://vyk12.alwaysdata.net/sdz/tuto_sphinx/newssdz.sql">liste de 57 news issues du SdZ avec leurs catégories</a>.</p><h2 id="r-indexer-les-donnees" data-claire-element-id="547322">Indexer les données</h2><p id="r-547264" data-claire-element-id="547264">Comme je vous l'avais dit plus tôt, il va falloir <strong>indexer les données</strong>. Cependant, cela ne se fait pas d'un simple coup de baguette magique : il ne suffit pas de dire à Sphinx <em>« indexe-moi mes news ! »</em>, ce serait trop simple ! Non, il va falloir lui donner quelques renseignements.</p><p id="r-547265" data-claire-element-id="547265">Avec Sphinx, pour effectuer une recherche sur une table, il faut avant tout créer un <strong>index</strong>. Un <strong>index</strong> est un bloc d'informations écrit dans le fichier de configuration qui va indiquer à Sphinx sur quoi il devra effectuer la recherche. Un index ne comporte généralement que 2 informations :</p><ul id="r-547270" data-claire-element-id="547270"><li id="r-547267" data-claire-element-id="547267"><p id="r-547266" data-claire-element-id="547266">Le nom de la <strong>source</strong> qui lui est associée. Chaque index correspond à une source. C'est dans cette source que vous déterminerez les informations nécessaires au moteur pour pouvoir effectuer la recherche ;</p></li><li id="r-547269" data-claire-element-id="547269"><p id="r-547268" data-claire-element-id="547268">L'emplacement où Sphinx créera sa bibliothèque.</p></li></ul><p id="r-547271" data-claire-element-id="547271">Ainsi, si nous voulons créer notre index <strong>news</strong>, nous procéderions comme ceci :</p><table id="r-547284" data-claire-element-id="547284"><thead id="r-547277" data-claire-element-id="547277"><tr id="r-547276" data-claire-element-id="547276"><th id="r-547273" data-claire-element-id="547273"><p id="r-547272" data-claire-element-id="547272">Sous Linux/Mac OS</p></th><th id="r-547275" data-claire-element-id="547275"><p id="r-547274" data-claire-element-id="547274">Sous Windows</p></th></tr></thead><tbody id="r-547283" data-claire-element-id="547283"><tr id="r-547282" data-claire-element-id="547282"><td id="r-547279" data-claire-element-id="547279"><pre id="r-547278" data-claire-element-id="547278"><code data-claire-semantic="autre">index news
{
        source = news
        path   = /usr/local/sphinx/var/data/news
}

searchd
{
        port      = 3312
        log       = /usr/local/sphinx/var/log/searchd/searchd.log
        query_log = /usr/local/sphinx/var/log/searchd/query.log
        pid_file  = /usr/local/sphinx/var/log/searchd/searchd.pid
}</code></pre></td><td id="r-547281" data-claire-element-id="547281"><pre id="r-547280" data-claire-element-id="547280"><code data-claire-semantic="autre">index news
{
        source = news
        path   = C:\Sphinx\var\data\news
}

searchd
{
        port      = 3312
        log       = C:\Sphinx\var\searchd.log
        query_log = C:\Sphinx\var\query.log
        pid_file  = C:\Sphinx\var\searchd.pid
}</code></pre></td></tr></tbody></table><p id="r-547285" data-claire-element-id="547285">On va maintenant créer notre source <strong>news</strong>. Pour commencer, il va falloir dire à Sphinx qu'il devra se connecter à une BDD gérée par MySQL et lui communiquer les identifiants qui lui permettront de s'y connecter, ainsi que le nom de la base de données.</p><pre id="r-547286" data-claire-element-id="547286"><code>source news
{
        type                = mysql
        sql_host            = localhost
        sql_user            = root
        sql_pass            = 
        sql_db              = newssdz
}

# ...</code></pre><p id="r-547287" data-claire-element-id="547287">Si nous le voulons, Sphinx peut exécuter une requête <strong>dès qu'il se connecte</strong>. Ici, nous allons communiquer des données encodées en UTF-8 : il va donc falloir le dire à MySQL grâce à une requête <code data-claire-semantic="sql">SET NAMES</code> :</p><pre id="r-547288" data-claire-element-id="547288"><code>source news
{
        type                = mysql
        sql_host            = localhost
        sql_user            = root
        sql_pass            = 
        sql_db              = newssdz
        sql_query_pre       = SET NAMES utf8
}</code></pre><p id="r-547289" data-claire-element-id="547289">Maintenant, il va falloir indiquer à Sphinx comment récupérer les news pour qu'il les indexe. Pour cela, on va lui écrire la requête qu'il devra exécuter et qui lui retournera toutes les news, <strong>avec les champs désirés</strong>. Pour cela, une simple requête de type <code data-claire-semantic="sql">SELECT</code> suffit :</p><pre id="r-547290" data-claire-element-id="547290"><code>source news
{
        type                = mysql
        sql_host            = localhost
        sql_user            = root
        sql_pass            = 
        sql_db              = newssdz
        sql_query_pre       = SET NAMES utf8
        sql_query           = SELECT id\
                                    , categorie\
                                    , titre\
                                    , contenu FROM news
}</code></pre><p id="r-547291" data-claire-element-id="547291">Qu'est-ce que j'entends par « <strong>avec les champs désirés</strong> » ? Visionnez-vous ce que Sphinx va faire : il va récupérer toutes les news en BDD, avec les valeurs des colonnes <strong>id</strong>, <strong>categorie</strong>, <strong>titre</strong> et <strong>contenu</strong>. Il va analyser chacune de ces colonnes :</p><ul id="r-547300" data-claire-element-id="547300"><li id="r-547293" data-claire-element-id="547293"><p id="r-547292" data-claire-element-id="547292">« Tiens, la première colonne <strong>id</strong> est une clé primaire unique. J'en déduis qu'elle représente de manière unique, grâce à un identifiant, chaque news. Je vais donc me servir de cet identifiant pour différencier chaque document que j'aurai récupéré. »</p></li><li id="r-547295" data-claire-element-id="547295"><p id="r-547294" data-claire-element-id="547294">« Ensuite, il y a une colonne <strong>categorie</strong>. C'est une simple clé contenant un nombre entier. L'utilisateur veut que je la récupère, donc je m'exécute, mais pour l'instant je vois pas à quoi elle me servira. »</p></li><li id="r-547297" data-claire-element-id="547297"><p id="r-547296" data-claire-element-id="547296">« À présent, je vois une colonne <strong>titre</strong>. Je vois que cette colonne contiendra des valeurs de type texte. Lorsque l'utilisateur effectuera une recherche, j'irai donc chercher là-dedans. »</p></li><li id="r-547299" data-claire-element-id="547299"><p id="r-547298" data-claire-element-id="547298">« Ah, il y a aussi une colonne <strong>contenu</strong> qui est de type texte. J'irai donc aussi chercher là-dedans. »</p></li></ul><aside id="r-547302" data-claire-element-id="547302" data-claire-semantic="information"><p id="r-547301" data-claire-element-id="547301">Sphinx ira chercher dans toutes les colonnes de type texte que vous avez spécifiées.</p></aside><p id="r-547303" data-claire-element-id="547303">Vous voyez que pour l'instant, il est un peu inutile pour Sphinx de récupérer la colonne <strong>categorie</strong>, ça ne lui est pas utile. Or, pour nous, utilisateurs, on aimerait bien que Sphinx puisse nous classer nos résultats en fonction des catégories par exemple. On va donc dire à Sphinx que <strong>categorie</strong> est un attribut (on pourra alors filtrer et trier nos news grâce à cet attribut) :</p><pre id="r-547304" data-claire-element-id="547304"><code>source news
{
        type                = mysql
        sql_host            = localhost
        sql_user            = root
        sql_pass            = 
        sql_db              = newssdz
        sql_query_pre       = SET NAMES utf8
        sql_query           = SELECT id\
                                    , categorie\
                                    , titre\
                                    , contenu FROM news
        sql_attr_uint       = categorie
}</code></pre><p id="r-547305" data-claire-element-id="547305">Enfin, il reste une dernière chose à indiquer à Sphinx. Lorsqu'on effectuera une recherche, Sphinx ira chercher les résultats dans sa bibliothèque. Après ça, il ira les rechercher dans la BDD pour nous les donner dans la forme qui convient. Il va donc falloir lui dire quelle requête exécuter pour récupérer les news qui nous intéressent. Pour cela, il va donc encore falloir utiliser une requête de type <code data-claire-semantic="sql">SELECT</code>, <strong>avec la liste des champs qu'on veut qu'il nous retourne</strong> (sachant que, quoi qu'il arrive, Sphinx retournera l'identifiant du document et les attributs qu'on aura créés) :</p><pre id="r-547306" data-claire-element-id="547306"><code>source news
{
        type                = mysql
        sql_host            = localhost
        sql_user            = root
        sql_pass            = 
        sql_db              = newssdz
        sql_query_pre       = SET NAMES utf8
        sql_query           = SELECT id\
                                    , categorie\
                                    , titre\
                                    , contenu FROM news
        sql_attr_uint       = categorie
        sql_query_info      = SELECT titre FROM news WHERE id=$id
}</code></pre><p id="r-547307" data-claire-element-id="547307">Ici, Sphinx nous retournera donc l'identifiant, la catégorie (puisque c'est un attribut) ainsi que le titre de la news.</p><aside id="r-547309" data-claire-element-id="547309" data-claire-semantic="error"><p id="r-547308" data-claire-element-id="547308">Cela ne s'applique que lors d'une recherche effectuée par le biais de la console (en CLI). En effet, si nous effectuons une recherche <em>via</em> PHP ou autre, Sphinx ignorera la ligne <strong>sql_query_info</strong>. De la sorte, Sphinx ne nous retournera que l'identifiant de la news et sa catégorie, peu importe la requête que vous aurez écrite dans cette ligne.</p></aside><p id="r-547310" data-claire-element-id="547310">À présent, tout est prêt pour indexer ! Pour cela, il faut utiliser l'outil <em>indexer</em>. Normalement, Sphinx n'a encore jamais créé de bibliothèque pour votre source <strong>news</strong>, donc l'outil <em>indexer</em> se contentera de créer les fichiers constituant la bibliothèque.</p><p id="r-547311" data-claire-element-id="547311">Cependant, si vous avez déjà indexé une première fois vos news, la bibliothèque sera alors déjà créée. Si le moteur est démarré, il ira <strong>verrouiller</strong> cette bibliothèque et les fichiers ne seront ainsi pas modifiables, donc la création de la bibliothèque sera impossible. Pour pallier ce problème et faire en sorte que l'outil puisse remplacer ces fichiers tout en laissant le moteur tourner, il faut passer à l'outil <em>indexer</em> l'argument <strong>--rotate</strong> :</p><pre id="r-547312" data-claire-element-id="547312"><code data-claire-semantic="console">sudo indexer news --rotate</code></pre><aside id="r-547314" data-claire-element-id="547314" data-claire-semantic="information"><p id="r-547313" data-claire-element-id="547313">Comme toutes les commandes, si vous êtes sous Windows, ignorez le <code data-claire-semantic="console">sudo</code>, et remplacez l'outil (par exemple <em>indexer</em>) par <strong>C:\Sphinx\bin\<em>outil</em></strong>. Dans ce cas-là, cela nous donnerait <code data-claire-semantic="console">C:\Sphinx\bin\indexer news --rotate</code>. <strong>Assurez-vous aussi d'avoir les droits administrateur</strong> !</p></aside><aside id="r-547316" data-claire-element-id="547316" data-claire-semantic="error"><p id="r-547315" data-claire-element-id="547315">Si vous obtenez une erreur du type <code data-claire-semantic="console">FATAL: no readable config file (looked in ./sphinx.conf)</code>, alors il va falloir indiquer à Sphinx où se situe le fichier de configuration. Pour cela, utilisez l'option <code data-claire-semantic="console">--config</code> (<code data-claire-semantic="console">indexer news --rotate --config /chemin/vers/sphinx.conf</code> (qui est normalement <strong>/usr/local/sphinx/etc/sphinx.conf</strong> sous Mac OS et Linux, et <strong>C:\Sphinx\sphinx.conf</strong> sous Windows).</p></aside><p id="r-547317" data-claire-element-id="547317">Ce code signifie simplement qu'on veut indexer les news. L'argument <strong>news</strong> passé à l'outil <strong>indexer</strong> fait référence à la <strong>source</strong> que l'on a écrite dans notre fichier de configuration.</p><p id="r-547318" data-claire-element-id="547318">Si vous êtes légèrement perdu et que vous n'avez pas tout suivi sur le fonctionnement l'indexation, voici un petit schéma qui vous aidera à comprendre :</p><figure id="r-547320" data-claire-element-id="547321"><img id="r-547319" data-claire-element-id="547319" src="medias/uploads.siteduzero.com_files_351001_352000_351333.png" alt="Image utilisateur"/></figure><h2 id="r-effectuer-une-recherche-1" data-claire-element-id="547350">Effectuer une recherche</h2><p id="r-547323" data-claire-element-id="547323">C'est l'étape la plus simple. Pour rechercher avec Sphinx, il faut utiliser l'outil <strong>search</strong>. À cet outil, vous devez lui passer au moins un paramètre : la requête à chercher. Cependant, nous voulons aussi lui spécifier la source dans laquelle il doit chercher, alors on lui passera l'option <strong>-i</strong> et le nom de la source. Si vous recherchez « navigateur », cela donnerait ça :</p><pre id="r-547324" data-claire-element-id="547324"><code data-claire-semantic="console">victor@victor-pc:~$ search -i news navigateur
Sphinx 0.9.9-release (r2117)
Copyright (c) 2001-2009, Andrew Aksyonoff

using config file '/usr/local/sphinx/etc/sphinx.conf'...
index 'news': query 'navigateur ': returned 13 matches of 13 total in 0.000 sec

displaying matches:
1. document=1, weight=1, categorie=3
        titre=Zoom sur les gestionnaires de fenêtres sur les systèmes UNIX
2. document=13, weight=1, categorie=1
        titre=Zoom sur les générateurs de sites statiques
3. document=21, weight=1, categorie=4
        titre=WebMotion, un nouveau framework web libre en Java
4. document=24, weight=1, categorie=8
        titre=Apple présente ses nouveautés logicielles lors de la WWDC 2011
5. document=25, weight=1, categorie=5
        titre=The Million Song Dataset, 300 Go de métadonnées et d'analyses musicales
6. document=32, weight=1, categorie=8
        titre=Bilan de la conférence Google I/O 2011
7. document=33, weight=1, categorie=1
        titre=Le langage Dart sort sa nouvelle spécification
8. document=35, weight=1, categorie=3
        titre=Fedora annonce sa 16e version !
9. document=41, weight=1, categorie=2
        titre=Unpacked 2011 : la révélation d'Android Ice Cream Sandwich et du prochain Nexus
10. document=43, weight=1, categorie=4
        titre=Ocsigen 2, une bouffée d'air frais pour le web
11. document=45, weight=1, categorie=3
        titre=Ubuntu 11.10 est disponible !
12. document=52, weight=1, categorie=3
        titre=Bilan de la BUILD Windows : Windows 8 enfin dévoilé
13. document=57, weight=1, categorie=3
        titre=Firefox 6.0 sort des cartons

words:
1. 'navigateur': 13 documents, 32 hits</code></pre><p id="r-547325" data-claire-element-id="547325">Décortiquons ce résultat en commençant par la première ligne : <code data-claire-semantic="console">index 'news': query 'navigateur ': returned 13 matches of 13 total in 0.000 sec</code>. Cette ligne nous indique :</p><ul id="r-547334" data-claire-element-id="547334"><li id="r-547327" data-claire-element-id="547327"><p id="r-547326" data-claire-element-id="547326">L'<strong>index</strong> sur lequel on a cherché (ici, <strong>news</strong>) ;</p></li><li id="r-547329" data-claire-element-id="547329"><p id="r-547328" data-claire-element-id="547328">La requête qu'on a entrée (ici, <strong>navigateur</strong>) ;</p></li><li id="r-547331" data-claire-element-id="547331"><p id="r-547330" data-claire-element-id="547330">Le nombre de résultats retourné et le nombre de résultats total. Le premier nombre peut être inférieur au second si le nombre de résultats trouvé est plus grand que la limite imposée à Sphinx (par défaut à 20). Essayez de chercher « web », et vous verrez qu'il ne vous retournera que 20 news sur un total de 28 (nous verrons plus tard comment utiliser cette fonctionnalité, notamment pour créer un système de pagination) ;</p></li><li id="r-547333" data-claire-element-id="547333"><p id="r-547332" data-claire-element-id="547332">Et enfin, le temps qu'il lui a fallu pour effectuer la recherche... Oui, le temps est (très) petit ! Chez moi, il lui a fallu moins d'un millième de seconde pour trouver les news qui m'intéressent.</p></li></ul><p id="r-547335" data-claire-element-id="547335">Après ça, Sphinx vous dévoile tous les résultats de la recherche. Prenons le premier :</p><pre id="r-547336" data-claire-element-id="547336"><code data-claire-semantic="console">1. document=1, weight=1, categorie=3
        titre=Zoom sur les gestionnaires de fenêtres sur les systèmes UNIX</code></pre><p id="r-547337" data-claire-element-id="547337">Vous voyez une première ligne contenant 3 valeurs, et une seconde ligne contenant une valeur. Voici dans l'ordre la signification de chacune d'elles :</p><ul id="r-547346" data-claire-element-id="547346"><li id="r-547339" data-claire-element-id="547339"><p id="r-547338" data-claire-element-id="547338"><strong>document=1</strong> : c'est la <strong>valeur de la clé primaire de la news</strong> (dans notre cas, elle correspond à la valeur du champ <strong>id</strong>). Sphinx s'en sert comme identifiant pour justement identifier ses résultats. L'identifiant de cette news en BDD est donc <strong>1</strong> ;</p></li><li id="r-547341" data-claire-element-id="547341"><p id="r-547340" data-claire-element-id="547340"><strong>weight=1</strong> : en théorie, plus cette valeur est élevée, plus le résultat correspond à la recherche. Ici, toutes les valeurs sont à 1, car nous utilisons un mode de recherche qui ne permet pas l'établissement d'un classement. Si vous voulez l'activer, il faut rajouter l'option <code data-claire-semantic="console">-e2</code> (<code data-claire-semantic="console">search -i news navigateur -e2</code>) ;</p></li><li id="r-547343" data-claire-element-id="547343"><p id="r-547342" data-claire-element-id="547342"><strong>categorie=3</strong> : souvenez-vous, on a dit à Sphinx que <strong>categorie</strong> était un attribut. Il nous l'a donc retourné et on sait désormais que cette news appartient à la catégorie ayant pour identifiant 3 en BDD ;</p></li><li id="r-547345" data-claire-element-id="547345"><p id="r-547344" data-claire-element-id="547344"><strong>titre=[...]</strong> : c'est tout simplement la valeur du champ <strong>titre</strong>.</p></li></ul><p id="r-547347" data-claire-element-id="547347">Et enfin, après la liste de tous les résultats trouvés, nous avons :</p><pre id="r-547348" data-claire-element-id="547348"><code data-claire-semantic="console">words:
1. 'navigateur': 13 documents, 32 hits</code></pre><p id="r-547349" data-claire-element-id="547349">Ce bout de texte nous liste les mots que l'on a cherchés (ici, il n'y avait que « navigateur »). Pour chacun de ces mots, Sphinx nous dit dans combien de documents il a été trouvé (ici, il a été trouvé dans 13 news) et combien de fois il a été trouvé (ici, 32 fois).</p><h2 id="r-le-probleme-de-l-indexation" data-claire-element-id="547356">Le problème de l'indexation</h2><p id="r-547351" data-claire-element-id="547351">Comme je l'avais brièvement évoqué, un léger problème s'est posé : Sphinx s'est constitué une bibliothèque avec les données <strong>actuelles</strong> présentes en BDD. Essayez d'ajouter une news, puis relancez la recherche : vous verrez que la news n'a pas été prise en compte par Sphinx, et c'est normal puisque cette news n'a pas été ajoutée à sa bibliothèque.</p><p id="r-547352" data-claire-element-id="547352">Pour pallier ce problème, il faut indexer régulièrement sa BDD. Sous Linux et Mac, vous pouvez utiliser des <strong>cron jobs</strong> pour exécuter cette tâche. Je ne vais pas m'étaler sur le fonctionnement des cron jobs ni sur leur utilisation (<a href="http://www.siteduzero.com/tutoriel-3-73916-executer-un-programme-a-une-heure-differee.html#ss_part_4">M@teo21 le fait très bien</a>), donc je vais vous donner la ligne à ajouter à votre crontab pour indexer automatiquement les données toutes les 15 minutes :</p><pre id="r-547353" data-claire-element-id="547353"><code data-claire-semantic="console">*/15 * * * * /usr/local/sphinx/bin/indexer news --rotate &gt;&gt; /usr/local/sphinx/var/log/indexer 2&gt;&amp;1</code></pre><aside id="r-547355" data-claire-element-id="547355" data-claire-semantic="warning"><p id="r-547354" data-claire-element-id="547354">L'outil <em>indexer</em> a besoin des droits administrateur pour fonctionner. Veuillez donc à modifier votre crontab en tant que superutilisateur !</p></aside><h2 id="r-exemple-pratique-d-utilisation-d-un-attribut" data-claire-element-id="547360">Exemple pratique d'utilisation d'un attribut</h2><p id="r-547357" data-claire-element-id="547357">Je vous avais dit qu'un attribut permettait de filtrer. En effet, si l'envie vous prend de ne sélectionner que les news appartenant à la catégorie 3, vous pouvez le faire grâce à l'option <code data-claire-semantic="console">--filter</code> (ou <code data-claire-semantic="console">-f</code>). Cette option attend deux arguments : le nom de l'attribut et la valeur qu'il doit avoir. Dans notre cas, cela nous donnerait :</p><pre id="r-547358" data-claire-element-id="547358"><code data-claire-semantic="console">victor@victor-pc:~$ search -i news navigateur -f categorie 3
Sphinx 0.9.9-release (r2117)
Copyright (c) 2001-2009, Andrew Aksyonoff

using config file '/usr/local/sphinx/etc/sphinx.conf'...
index 'news': query 'navigateur ': returned 5 matches of 5 total in 0.000 sec

displaying matches:
1. document=1, weight=1, categorie=3
        titre=Zoom sur les gestionnaires de fenêtres sur les systèmes UNIX
2. document=35, weight=1, categorie=3
        titre=Fedora annonce sa 16e version !
3. document=45, weight=1, categorie=3
        titre=Ubuntu 11.10 est disponible !
4. document=52, weight=1, categorie=3
        titre=Bilan de la BUILD Windows : Windows 8 enfin dévoilé
5. document=57, weight=1, categorie=3
        titre=Firefox 6.0 sort des cartons

words:
1. 'navigateur': 13 documents, 32 hits</code></pre><p id="r-547359" data-claire-element-id="547359">Sphinx offre beaucoup de possibilités, et je ne peux malheureusement pas toutes les lister ici. Par cet exemple, je voulais juste vous montrer à quoi servait (entre autres) de spécifier des attributs dans le fichier de configuration. Maintenant, je sais que la console vous ennuie un petit peu et que vous voulez exploiter ce moteur pour votre site... Alors exploitons-le donc grâce à PHP !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php">Créer un moteur de recherche avec Sphinx et PHP</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php/installation-de-sphinx">
Installation de Sphinx
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php/recherchons-avec-sphinx">
Recherchons avec Sphinx
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php/exploitons-sphinx-avec-php">
Exploitons Sphinx avec PHP
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php/installation-de-sphinx">
<span class="arrow"></span>
<span class="next">Installation de Sphinx</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php/exploitons-sphinx-avec-php">
<span class="next">Exploitons Sphinx avec PHP</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="ExploitonsSphinxavecPHP"></a><h2>Exploitons Sphinx avec PHP</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php/recherchons-avec-sphinx">
<span class="arrow"></span>
<span class="next">Recherchons avec Sphinx</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-547362" data-claire-element-id="547362">Voilà le moment tant attendu : nous allons enfin intégrer le moteur de recherche sur votre site. Pour cela, nous allons nous servir de PHP, mais si votre site web est construit avec Python ou Java par exemple, sachez que vous pourrez aussi exploiter Sphinx avec ces langages.</p><aside id="r-547364" data-claire-element-id="547364" data-claire-semantic="information"><p id="r-547363" data-claire-element-id="547363">Avant de commencer, je dois vous informer que l'API Sphinx est orientée objet, c'est-à-dire qu'il vous faudra <a href="http://www.siteduzero.com/tutoriel-3-232176-la-programmation-orientee-objet.html">les bases de la POO</a> (le niveau en POO requis est identique à celui requis pour utiliser PDO).</p></aside><h2 id="r-mise-en-place-de-l-api-sphinx-pour-php" data-claire-element-id="547370">Mise en place de l'API Sphinx pour PHP</h2><p id="r-547365" data-claire-element-id="547365">Lorsque nous avions téléchargé Sphinx pour installer le moteur sur notre serveur, il y avait dedans un sous-dossier <strong>~/api</strong>. Si vous l'ouvrez, vous découvrirez des fichiers PHP et Python, ainsi que des dossiers pour Ruby et Java.</p><p id="r-547366" data-claire-element-id="547366">Pour plus de confort, je vous recommande de créer un dossier à la racine de votre serveur web où vous placerez les fichiers nécessaires pour mettre en place le moteur (par exemple, un dossier <strong>~/sphinx</strong>). Dans ce dossier, vous allez copier le dossier <strong>api</strong> présent dans l'archive téléchargée au début de ce tutoriel. Vous devriez donc avoir un dossier <strong>~/sphinx</strong> contenant le dossier <strong>api</strong>.</p><p id="r-547367" data-claire-element-id="547367">Dans votre dossier <strong>sphinx</strong>, vous allez créer un fichier <strong>index.php</strong> (c'est sur cette page que nous allons nous servir de Sphinx). La première chose à faire pour se servir du moteur est d'inclure le fichier <strong>sphinxapi.php</strong>, présent dans le dossier <strong>api</strong> :</p><pre id="r-547368" data-claire-element-id="547368"><code data-claire-semantic="html+php">&lt;?php
    require 'api/sphinxapi.php';</code></pre><p id="r-547369" data-claire-element-id="547369">Nous sommes maintenant fin prêts à utiliser le moteur !</p><h2 id="r-premiere-recherche-avec-php" data-claire-element-id="547417">Première recherche avec PHP</h2><p id="r-547371" data-claire-element-id="547371">Effectuer une recherche avec PHP est aussi simple qu'avec la console. Pour commencer, nous devrons créer un objet <strong>SphinxClient</strong>. Ce sera sur cet objet que nous appellerons diverses méthodes nous permettant d'effectuer des recherches ou d'ajouter des filtres par exemple.</p><p id="r-547372" data-claire-element-id="547372">Une fois l'objet créé, il faudra lui dire de se connecter au serveur où Sphinx tourne, et à quel port il doit se connecter. Cela se fait grâce à la méthode <code>SetServer($server, $port)</code>.</p><p id="r-547373" data-claire-element-id="547373">Ensuite, il est préférable d'appeler une méthode qui va limiter le temps de connexion à 1 seconde. En effet, si la connexion dure plus d'une seconde, vous pourriez être quasiment sûr qu'il y a un problème, donc autant arrêter la recherche. Cela se fait grâce à la méthode <code>SetConnectionTimeout($seconds)</code>.</p><p id="r-547374" data-claire-element-id="547374">Et enfin, il ne reste plus qu'à chercher ! Une recherche s'effectue grâce à la méthode <code>Query($query, $index)</code>, où <code>$query</code> est la requête (par exemple, « navigateur ») et <code>$index</code> est tout simplement l'index sur lequel on veut que Sphinx cherche (dans notre cas il s'agit de « news »). Cette méthode renvoie un tableau contenant les résultats ainsi que les statistiques relatives à la requête (le temps mis pour trouver les résultats, le nombre de résultats trouvé, etc.). Pour comprendre la forme du tableau que Sphinx nous renvoie, nous allons l'afficher.</p><p id="r-547375" data-claire-element-id="547375">Le code devrait donc être celui-ci :</p><pre id="r-547376" data-claire-element-id="547376"><code data-claire-semantic="html+php">&lt;?php
    require 'api/sphinxapi.php';
    
    $sphinx = new SphinxClient;
    
    $sphinx-&gt;SetServer('localhost', 3312);
    $sphinx-&gt;SetConnectTimeout(1);
    
    $resultat = $sphinx-&gt;Query('navigateur', 'news');
    
    echo '&lt;pre&gt;', print_r($resultat, true), '&lt;/pre&gt;';</code></pre><p id="r-547377" data-claire-element-id="547377">Et ça nous donne un truc assez gros :</p><p id="r-547378" data-claire-element-id="547378"></p><div id="r-547380" data-claire-element-id="547380"><pre id="r-547379" data-claire-element-id="547379"><code>Array
(
    [error] =&gt; 
    [warning] =&gt; 
    [status] =&gt; 0
    [fields] =&gt; Array
        (
            [0] =&gt; titre
            [1] =&gt; contenu
        )

    [attrs] =&gt; Array
        (
            [categorie] =&gt; 1
        )

    [matches] =&gt; Array
        (
            [1] =&gt; Array
                (
                    [weight] =&gt; 1
                    [attrs] =&gt; Array
                        (
                            [categorie] =&gt; 3
                        )

                )

            [13] =&gt; Array
                (
                    [weight] =&gt; 1
                    [attrs] =&gt; Array
                        (
                            [categorie] =&gt; 1
                        )

                )

            [21] =&gt; Array
                (
                    [weight] =&gt; 1
                    [attrs] =&gt; Array
                        (
                            [categorie] =&gt; 4
                        )

                )

            [24] =&gt; Array
                (
                    [weight] =&gt; 1
                    [attrs] =&gt; Array
                        (
                            [categorie] =&gt; 8
                        )

                )

            [25] =&gt; Array
                (
                    [weight] =&gt; 1
                    [attrs] =&gt; Array
                        (
                            [categorie] =&gt; 5
                        )

                )

            [32] =&gt; Array
                (
                    [weight] =&gt; 1
                    [attrs] =&gt; Array
                        (
                            [categorie] =&gt; 8
                        )

                )

            [33] =&gt; Array
                (
                    [weight] =&gt; 1
                    [attrs] =&gt; Array
                        (
                            [categorie] =&gt; 1
                        )

                )

            [35] =&gt; Array
                (
                    [weight] =&gt; 1
                    [attrs] =&gt; Array
                        (
                            [categorie] =&gt; 3
                        )

                )

            [41] =&gt; Array
                (
                    [weight] =&gt; 1
                    [attrs] =&gt; Array
                        (
                            [categorie] =&gt; 2
                        )

                )

            [43] =&gt; Array
                (
                    [weight] =&gt; 1
                    [attrs] =&gt; Array
                        (
                            [categorie] =&gt; 4
                        )

                )

            [45] =&gt; Array
                (
                    [weight] =&gt; 1
                    [attrs] =&gt; Array
                        (
                            [categorie] =&gt; 3
                        )

                )

            [52] =&gt; Array
                (
                    [weight] =&gt; 1
                    [attrs] =&gt; Array
                        (
                            [categorie] =&gt; 3
                        )

                )

            [57] =&gt; Array
                (
                    [weight] =&gt; 1
                    [attrs] =&gt; Array
                        (
                            [categorie] =&gt; 3
                        )

                )

        )

    [total] =&gt; 13
    [total_found] =&gt; 13
    [time] =&gt; 0.007
    [words] =&gt; Array
        (
            [navigateur] =&gt; Array
                (
                    [docs] =&gt; 13
                    [hits] =&gt; 32
                )

        )

)</code></pre></div><p id="r-547381" data-claire-element-id="547381">Il peut faire peur, mais regardez-le bien, vous devriez normalement comprendre la plupart des éléments, car rien de nouveau n'est apparu depuis la console.</p><p id="r-547382" data-claire-element-id="547382">Décomposons ce tableau en deux parties : l'une contient des informations relatives à la requête, l'autre partie contient les résultats trouvés.</p><p id="r-547383" data-claire-element-id="547383">Voici la première partie du tableau :</p><pre id="r-547384" data-claire-element-id="547384"><code>Array
(
    [error] =&gt; 
    [warning] =&gt; 
    [status] =&gt; 0
    [fields] =&gt; Array
        (
            [0] =&gt; titre
            [1] =&gt; contenu
        )

    [attrs] =&gt; Array
        (
            [categorie] =&gt; 1
        )

    [total] =&gt; 13
    [total_found] =&gt; 13
    [time] =&gt; 0.007
    [words] =&gt; Array
        (
            [navigateur] =&gt; Array
                (
                    [docs] =&gt; 13
                    [hits] =&gt; 32
                )

        )
)</code></pre><p id="r-547385" data-claire-element-id="547385">Dans l'ordre, nous avons :</p><ul id="r-547402" data-claire-element-id="547402"><li id="r-547387" data-claire-element-id="547387"><p id="r-547386" data-claire-element-id="547386">La clé <strong>error</strong> : contient un message d'erreur si une erreur survient ;</p></li><li id="r-547389" data-claire-element-id="547389"><p id="r-547388" data-claire-element-id="547388">La clé <strong>warning</strong> : contient un message si une alerte a été levée ;</p></li><li id="r-547391" data-claire-element-id="547391"><p id="r-547390" data-claire-element-id="547390">La clé <strong>status</strong> : est à 0 si tout s'est bien passé (les valeurs possibles vont de 0 à 3, les valeurs allant de 1 à 3 signifiant qu'il y a eu une erreur ou une alerte) ;</p></li><li id="r-547393" data-claire-element-id="547393"><p id="r-547392" data-claire-element-id="547392">La clé <strong>fields</strong> : contient un tableau contenant lui-même la liste des colonnes dans lesquelles Sphinx a été cherché ;</p></li><li id="r-547395" data-claire-element-id="547395"><p id="r-547394" data-claire-element-id="547394">La clé <strong>attrs</strong> : contient la liste des attributs ;</p></li><li id="r-547397" data-claire-element-id="547397"><p id="r-547396" data-claire-element-id="547396">Les clés <strong>total</strong> et <strong>total_found</strong> : contiennent respectivement le nombre de résultats retourné et le nombre de résultats total ;</p></li><li id="r-547399" data-claire-element-id="547399"><p id="r-547398" data-claire-element-id="547398">La clé <strong>time</strong> : contient le temps en seconde mis par Sphinx pour effectuer la recherche ;</p></li><li id="r-547401" data-claire-element-id="547401"><p id="r-547400" data-claire-element-id="547400">La clé <strong>words</strong> : contient une liste de valeurs ayant pour clé l'un des mots recherchés et pour valeur un autre tableau contenant le nombre de documents dans lequel il a été trouvé et le nombre de fois qu'il a été trouvé.</p></li></ul><p id="r-547403" data-claire-element-id="547403">C'était une brève description car je pense que vous étiez capables de trouver vous-mêmes la signification de chacune des entrées.</p><p id="r-547404" data-claire-element-id="547404">Vient maintenant la seconde partie : la liste des résultats. Cette liste est stockée dans un tableau à la clé <strong>matches</strong>. Ce tableau, qui contient tous les résultats, est lui-même composé de tableaux, chacun représentant un résultat. <strong>Chaque tableau est une valeur dont la clé est l'identifiant du document</strong>. Par exemple, si je prends le premier résultat :</p><pre id="r-547405" data-claire-element-id="547405"><code>...
    [matches] =&gt; Array
        (
            [1] =&gt; Array
                (
                    [weight] =&gt; 1
                    [attrs] =&gt; Array
                        (
                            [categorie] =&gt; 3
                        )

                )
            
            ...
        )
...</code></pre><p id="r-547406" data-claire-element-id="547406">Nous voyons ici que le premier résultat se trouve à la clé <strong>1</strong>. Cela veut donc dire que ce résultat n'est autre que la news ayant pour identifiant <strong>1</strong> en BDD.</p><p id="r-547407" data-claire-element-id="547407">Ensuite, nous retrouvons la clé <strong>weight</strong> qui, je vous le rappelle, contient un nombre représentant le poids du document (théoriquement, plus le poids est élevé, plus le document correspond à la recherche). Ici, le poids est de 1 pour la même raison qu'en console : le mode de recherche utilisé ne permet pas de calculer le poids des documents. Si vous voulez obtenir ce poids, je vous invite à regarder du côté de la méthode <code><a href="http://fr2.php.net/manual/fr/sphinxclient.setmatchmode.php">SetMatchMode($mode)</a></code>, et plus particulièrement l'argument <strong>SPH_MATCH_EXTENDED2</strong> (qui correspond à l'option <code data-claire-semantic="console">-e2</code> que nous pouvons passer à l'outil <em>search</em> dans la console).</p><p id="r-547408" data-claire-element-id="547408">Enfin, Sphinx nous liste les attributs correspondant à la news. Ici, il n'y a que catégorie, et Sphinx nous informe que cette news appartient à la catégorie ayant pour identifiant 3 en BDD.</p><div id="r-547410" data-claire-element-id="547410" data-claire-semantic="question"><p id="r-547409" data-claire-element-id="547409">Pourquoi Sphinx ne m'a pas renvoyé le titre de la news comme dans la console ?</p></div><p id="r-547411" data-claire-element-id="547411">Comme je vous l'avais dit, la requête correspondant à la clé de configuration <strong>sql_query_info</strong> n'est utilisée que lorsqu'on effectue une recherche depuis la console. Sphinx ignore donc cette requête car nous recherchons depuis PHP. Nous allons donc devoir effectuer nous-mêmes la requête nous permettant de récupérer la liste des news avec leur titre et, pendant qu'on y est, le nom de leur catégorie à l'aide d'une simple jointure.</p><p id="r-547412" data-claire-element-id="547412">La première difficulté que vous serez peut-être amenés à rencontrer est « comment récupérer les identifiants de mes news ? ». En fait, c'est très simple. On sait que les identifiants sont les clés du tableau <code>$resultat['matches']</code> (où <code>$resultat</code> est le gros tableau renvoyé par <code>Query()</code>). À partir de là, nous allons nous servir d'une fonction toute bête : <a href="http://fr2.php.net/manual/fr/function.array-keys.php">array_keys()</a>. Cette fonction attend un paramètre : le tableau dont on veut récupérer les clés, et ce tableau n'est autre que <code>$resultat['matches']</code> !</p><p id="r-547413" data-claire-element-id="547413">Nous avons donc notre liste d'identifiants. Jusqu'à maintenant, vous étiez peut-être habitués à écrire, dans votre requête, une clause <code data-claire-semantic="sql">WHERE</code> où vous mettiez une valeur précise pour un champ. Sachez qu'il est possible, grâce à la fonction <code data-claire-semantic="sql">IN()</code>, de spécifier <strong>plusieurs valeurs</strong>. Ainsi, vous n'êtes pas contraints à une seule valeur : vous pouvez en mettre une infinité, où chaque valeur est séparée d'une autre par une virgule. Ainsi, le code pourrait ressembler à ceci :</p><pre id="r-547414" data-claire-element-id="547414"><code data-claire-semantic="html+php">&lt;?php
    require 'api/sphinxapi.php';
    
    // Le quatrième paramètre sert à dire à MySQL que l'on va communiquer des données encodées en UTF-8
    $db = new PDO('mysql:host=localhost;dbname=newssdz', 'root', '', array(PDO::MYSQL_ATTR_INIT_COMMAND =&gt; 'SET NAMES \'UTF8\''));
    $db-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    
    $sphinx = new SphinxClient;
    
    $sphinx-&gt;SetServer('localhost', 3312);
    $sphinx-&gt;SetConnectTimeout(1);
    
    $resultat = $sphinx-&gt;Query('navigateur', 'news');
    
    $ids = array_keys($resultat['matches']);
    $query = $db-&gt;query('SELECT news.titre, categories.nom AS cat_nom FROM news LEFT JOIN categories ON news.categorie = categories.id WHERE news.id IN('.implode(',', $ids).')');</code></pre><p id="r-547415" data-claire-element-id="547415">Il ne vous reste maintenant plus qu'à afficher les résultats sous la forme de votre choix !</p><pre id="r-547416" data-claire-element-id="547416"><code data-claire-semantic="html+php">&lt;?php
    require 'api/sphinxapi.php';
    
    // Le quatrième paramètre sert à dire à MySQL que l'on va communiquer des données encodées en UTF-8
    $db = new PDO('mysql:host=localhost;dbname=newssdz', 'root', '', array(PDO::MYSQL_ATTR_INIT_COMMAND =&gt; 'SET NAMES \'UTF8\''));
    $db-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    
    $sphinx = new SphinxClient;
    
    $sphinx-&gt;SetServer('localhost', 3312);
    $sphinx-&gt;SetConnectTimeout(1);
    
    $resultat = $sphinx-&gt;Query('navigateur', 'news');
    
    $ids = array_keys($resultat['matches']);
    $query = $db-&gt;query('SELECT news.titre, categories.nom AS cat_nom FROM news LEFT JOIN categories ON news.categorie = categories.id WHERE news.id IN('.implode(',', $ids).')');
?&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot;&gt;
    &lt;head&gt;
        &lt;meta http-equiv=&quot;Content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;
        &lt;title&gt;Premier essai de l'API PHP de Sphinx&lt;/title&gt;
    &lt;/head&gt;
    
    &lt;body&gt;
        &lt;p&gt;&lt;?php echo $res['total_found']; ?&gt; résultats ont été trouvés en &lt;?php echo $res['time']; ?&gt;s.&lt;/p&gt;
        &lt;table style=&quot;width:100%; text-align:center; margin: auto;&quot;&gt;
            &lt;tr&gt;&lt;th&gt;Titre&lt;/th&gt;&lt;th&gt;Catégorie&lt;/th&gt;&lt;/tr&gt;
&lt;?php   
    while ($news = $query-&gt;fetch(PDO::FETCH_ASSOC))
    {
        echo '&lt;tr&gt;&lt;td&gt;', $news['titre'], '&lt;/td&gt;&lt;td&gt;', $news['cat_nom'], '&lt;/td&gt;&lt;/tr&gt;', &quot;\n&quot;;
    }
?&gt;  
	    &lt;/table&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre><h2 id="r-paginer-ses-resultats" data-claire-element-id="547425">Paginer ses résultats</h2><p id="r-547418" data-claire-element-id="547418">En recherchant « navigateur », nous n'avons que 13 résultats. Je vais maintenant vous inviter à chercher « web », où vous découvrirez que 28 news correspondent à la recherche, alors que Sphinx n'en a retourné que 20.</p><p id="r-547419" data-claire-element-id="547419">Comme je l'avais dit dans la précédente partie, Sphinx retourne par défaut les 20 premiers résultats. Il est possible de changer cette limite ainsi que le rang de la première news à renvoyer de façon à créer un système de pagination grâce à la méthode <code>SetLimits($rank, $limit)</code>.</p><p id="r-547420" data-claire-element-id="547420">Imaginons que nous voulons 10 résultats par page. La première page comportera les news du rang 0 au rang 9, la deuxième page comportera les news du rang 10 au rang 19, la troisième page comportera les news du rang 20 au rang 29, etc. À partir de là, il est facile de créer un système de pagination : le rang de la première news est égal à <code>($page - 1) * LIMITE</code>, où <code>$page</code> est le numéro de la page et où <code>LIMITE</code> est une constante contenant le nombre de résultats par page.</p><p id="r-547421" data-claire-element-id="547421">Il ne reste qu'un détail à régler : comment connait-on le nombre de pages ? Pour cela, il faudrait déjà avoir le nombre de résultats total trouvé. Bonne nouvelle, on le connait ce nombre : ce n'est autre que <code>$resultat['total_found']</code> ! Pour calculer le nombre de pages, il va falloir diviser le nombre de résultats total par le nombre de résultats par page, puis arrondir le nombre obtenu à l'entier supérieur grâce à <a href="http://fr2.php.net/manual/fr/function.ceil.php">ceil</a>.</p><p id="r-547422" data-claire-element-id="547422">Le code que vous avez obtenu devrait ressembler à ça :</p><pre id="r-547423" data-claire-element-id="547423"><code data-claire-semantic="html+php">&lt;?php
    require 'api/sphinxapi.php';
    
    define('LIMITE', 10);
    
    // Le quatrième paramètre sert à dire à MySQL que l'on va communiquer des données encodées en UTF-8
    $db = new PDO('mysql:host=localhost;dbname=newssdz', 'root', '', array(PDO::MYSQL_ATTR_INIT_COMMAND =&gt; 'SET NAMES \'UTF8\''));
    $db-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    
    $sphinx = new SphinxClient;
    
    $sphinx-&gt;SetServer('localhost', 3312);
    $sphinx-&gt;SetConnectTimeout(1);
    
    $page = isset($_GET['page']) ? (int) $_GET['page'] : 1;
    $rang = ($page - 1) * LIMITE;
    
    $sphinx-&gt;SetLimits($rang, LIMITE);
    
    $resultat = $sphinx-&gt;Query('web', 'news');
    
    $nombrePages = ceil($resultat['total_found'] / LIMITE);
    
    $ids = array_keys($resultat['matches']);
    $query = $db-&gt;query('SELECT news.titre, categories.nom AS cat_nom FROM news LEFT JOIN categories ON news.categorie = categories.id WHERE news.id IN('.implode(',', $ids).')');
?&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot;&gt;
    &lt;head&gt;
        &lt;meta http-equiv=&quot;Content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;
        &lt;title&gt;Premier essai de l'API PHP de Sphinx&lt;/title&gt;
    &lt;/head&gt;
    
    &lt;body&gt;
        &lt;p&gt;&lt;?php echo $resultat['total_found']; ?&gt; résultats ont été trouvés en &lt;?php echo $resultat['time']; ?&gt;s.&lt;/p&gt;
        &lt;p&gt;Pages : 
&lt;?php
    // On affiche les liens menant aux différentes pages
    for ($i = 1; $i &lt;= $nombrePages; $i++)
    {
        echo '&lt;a href=&quot;?page=', $i, '&quot;&gt;', $i, '&lt;/a&gt; ';
    }
?&gt;
        &lt;/p&gt;
        &lt;table style=&quot;width:100%; text-align:center; margin: auto;&quot;&gt;
            &lt;tr&gt;&lt;th&gt;Titre&lt;/th&gt;&lt;th&gt;Catégorie&lt;/th&gt;&lt;/tr&gt;
&lt;?php   
    while ($news = $query-&gt;fetch(PDO::FETCH_ASSOC))
    {
        echo '&lt;tr&gt;&lt;td&gt;', $news['titre'], '&lt;/td&gt;&lt;td&gt;', $news['cat_nom'], '&lt;/td&gt;&lt;/tr&gt;', &quot;\n&quot;;
    }
?&gt;  
	    &lt;/table&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-547424" data-claire-element-id="547424">De la sorte, vos résultats sont paginés avec 10 résultats par page !</p><h2 id="r-utiliser-des-filtres" data-claire-element-id="547429">Utiliser des filtres</h2><p id="r-547426" data-claire-element-id="547426">Nous avons vu dans la console que nous pouvions ne demander à Sphinx que les news appartenant à la catégorie no3. Avec PHP, cette contrainte s'ajoute à la requête avec la méthode <code>SetFilter($attr, $values)</code>. Le premier paramètre est l'attribut concerné et le second paramètre doit être un tableau contenant la liste des valeurs que l'attribut peut prendre. Par exemple, si nous ne voulons que les news des catégories Web et Programmation (ayant respectivement pour identifiants 1 et 4), cela donnerait :</p><pre id="r-547427" data-claire-element-id="547427"><code data-claire-semantic="html+php">&lt;?php
    require 'api/sphinxapi.php';
    
    define('LIMITE', 10);
    
    // Le quatrième paramètre sert à dire à MySQL que l'on va communiquer des données encodées en UTF-8
    $db = new PDO('mysql:host=localhost;dbname=newssdz', 'root', '', array(PDO::MYSQL_ATTR_INIT_COMMAND =&gt; 'SET NAMES \'UTF8\''));
    $db-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    
    $sphinx = new SphinxClient;
    
    $sphinx-&gt;SetServer('localhost', 3312);
    $sphinx-&gt;SetConnectTimeout(1);
    
    // On ne veut que des news de certaines catégories
    $sphinx-&gt;SetFilter('categorie', array(1, 4));
    
    $page = isset($_GET['page']) ? (int) $_GET['page'] : 1;
    $rang = ($page - 1) * LIMITE;
    
    $sphinx-&gt;SetLimits($rang, LIMITE);
    
    $resultat = $sphinx-&gt;Query('web', 'news');
    
    $nombrePages = ceil($resultat['total_found'] / LIMITE);
    
    $ids = array_keys($resultat['matches']);
    $query = $db-&gt;query('SELECT news.titre, categories.nom AS cat_nom FROM news LEFT JOIN categories ON news.categorie = categories.id WHERE news.id IN('.implode(',', $ids).')');
?&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot;&gt;
    &lt;head&gt;
        &lt;meta http-equiv=&quot;Content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;
        &lt;title&gt;Premier essai de l'API PHP de Sphinx&lt;/title&gt;
    &lt;/head&gt;
    
    &lt;body&gt;
        &lt;p&gt;&lt;?php echo $resultat['total_found']; ?&gt; résultats ont été trouvés en &lt;?php echo $resultat['time']; ?&gt;s.&lt;/p&gt;
        &lt;p&gt;Pages : 
&lt;?php
    // On affiche les liens menant aux différentes pages
    for ($i = 1; $i &lt;= $nombrePages; $i++)
    {
        echo '&lt;a href=&quot;?page=', $i, '&quot;&gt;', $i, '&lt;/a&gt; ';
    }
?&gt;
        &lt;/p&gt;
        &lt;table style=&quot;width:100%; text-align:center; margin: auto;&quot;&gt;
            &lt;tr&gt;&lt;th&gt;Titre&lt;/th&gt;&lt;th&gt;Catégorie&lt;/th&gt;&lt;/tr&gt;
&lt;?php   
    while ($news = $query-&gt;fetch(PDO::FETCH_ASSOC))
    {
        echo '&lt;tr&gt;&lt;td&gt;', $news['titre'], '&lt;/td&gt;&lt;td&gt;', $news['cat_nom'], '&lt;/td&gt;&lt;/tr&gt;', &quot;\n&quot;;
    }
?&gt;  
	    &lt;/table&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-547428" data-claire-element-id="547428">Si vous testez ce code, vous verrez que Sphinx vous retournera 15 résultats avec des news n'appartenant qu'aux catégories Web et Programmation. Pratique, non ?</p><h2 id="r-le-probleme-des-caracteres-accentues" data-claire-element-id="547437">Le problème des caractères accentués</h2><p id="r-547430" data-claire-element-id="547430">Si vous essayez de chercher « étude », Sphinx vous retournera deux news. Cependant, si vous cherchez « etude », Sphinx ne vous retournera rien. En effet, pour lui, « étude » et « etude » sont deux mots différents, donc il est normal que le résultat de la requête ne soit pas le même. Le problème, c'est que nous, ça ne nous arrange pas trop. On aimerait bien qu'il nous retourne les mêmes news, qu'on recherche « étude » ou « etude ». Pour pallier ce problème, il va falloir dire à Sphinx que le caractère « é » équivaut à « e », que « à » équivaut à « a », etc. Cela se fait dans le fichier de configuration (oui, on y retourne !). Il va falloir, dans la source <strong>source</strong><em>news</em>, écrire cette table de correspondances. Elle est assez longue et impossible à retenir par cœur, donc exceptionnellement je vous autorise à copier/coller (que ceux qui se sentent de l'apprendre ne se gênent pas, mais bon...) :</p><pre id="r-547431" data-claire-element-id="547431"><code>index news
{
        source = news
        path   = /usr/local/sphinx/var/data/news
        charset_type            = utf-8
        charset_table           = U+FF10..U+FF19-&gt;0..9, U+FF21..U+FF3A-&gt;a..z\
                , U+FF41..U+FF5A-&gt;a..z, 0..9, A..Z-&gt;a..z, a..z ,U+00C0-&gt;a, U+00C1-&gt;a\
                , U+00C2-&gt;a, U+00C3-&gt;a, U+00C4-&gt;a, U+00C5-&gt;a, U+00E0-&gt;a, U+00E1-&gt;a\
                , U+00E2-&gt;a, U+00E3-&gt;a, U+00E4-&gt;a, U+00E5-&gt;a, U+0100-&gt;a, U+0101-&gt;a\
                , U+0102-&gt;a, U+0103-&gt;a, U+010300-&gt;a, U+0104-&gt;a, U+0105-&gt;a, U+01CD-&gt;a\
                , U+01CE-&gt;a, U+01DE-&gt;a, U+01DF-&gt;a, U+01E0-&gt;a, U+01E1-&gt;a, U+01FA-&gt;a\
                , U+01FB-&gt;a, U+0200-&gt;a, U+0201-&gt;a, U+0202-&gt;a, U+0203-&gt;a, U+0226-&gt;a\
                , U+0227-&gt;a, U+023A-&gt;a, U+0250-&gt;a, U+04D0-&gt;a, U+04D1-&gt;a, U+1D2C-&gt;a\
                , U+1D43-&gt;a, U+1D44-&gt;a, U+1D8F-&gt;a, U+1E00-&gt;a, U+1E01-&gt;a, U+1E9A-&gt;a\
                , U+1EA0-&gt;a, U+1EA1-&gt;a, U+1EA2-&gt;a, U+1EA3-&gt;a, U+1EA4-&gt;a, U+1EA5-&gt;a\
                , U+1EA6-&gt;a, U+1EA7-&gt;a, U+1EA8-&gt;a, U+1EA9-&gt;a, U+1EAA-&gt;a, U+1EAB-&gt;a\
                , U+1EAC-&gt;a, U+1EAD-&gt;a, U+1EAE-&gt;a, U+1EAF-&gt;a, U+1EB0-&gt;a, U+1EB1-&gt;a\
                , U+1EB2-&gt;a, U+1EB3-&gt;a, U+1EB4-&gt;a, U+1EB5-&gt;a, U+1EB6-&gt;a, U+1EB7-&gt;a\
                , U+2090-&gt;a, U+2C65-&gt;a ,U+00C8-&gt;e, U+00C9-&gt;e, U+00CA-&gt;e, U+00CB-&gt;e\
                , U+00E8-&gt;e, U+00E9-&gt;e, U+00EA-&gt;e, U+00EB-&gt;e, U+0112-&gt;e, U+0113-&gt;e\
                , U+0114-&gt;e, U+0115-&gt;e, U+0116-&gt;e, U+0117-&gt;e, U+0118-&gt;e, U+0119-&gt;e\
                , U+011A-&gt;e, U+011B-&gt;e, U+018E-&gt;e, U+0190-&gt;e, U+01DD-&gt;e, U+0204-&gt;e\
                , U+0205-&gt;e, U+0206-&gt;e, U+0207-&gt;e, U+0228-&gt;e, U+0229-&gt;e, U+0246-&gt;e\
                , U+0247-&gt;e, U+0258-&gt;e, U+025B-&gt;e, U+025C-&gt;e, U+025D-&gt;e, U+025E-&gt;e\
                , U+029A-&gt;e, U+1D07-&gt;e, U+1D08-&gt;e, U+1D31-&gt;e, U+1D32-&gt;e, U+1D49-&gt;e\
                , U+1D4B-&gt;e, U+1D4C-&gt;e, U+1D92-&gt;e, U+1D93-&gt;e, U+1D94-&gt;e, U+1D9F-&gt;e\
                , U+1E14-&gt;e, U+1E15-&gt;e, U+1E16-&gt;e, U+1E17-&gt;e, U+1E18-&gt;e, U+1E19-&gt;e\
                , U+1E1A-&gt;e, U+1E1B-&gt;e, U+1E1C-&gt;e, U+1E1D-&gt;e, U+1EB8-&gt;e, U+1EB9-&gt;e\
                , U+1EBA-&gt;e, U+1EBB-&gt;e, U+1EBC-&gt;e, U+1EBD-&gt;e, U+1EBE-&gt;e, U+1EBF-&gt;e\
                , U+1EC0-&gt;e, U+1EC1-&gt;e, U+1EC2-&gt;e, U+1EC3-&gt;e, U+1EC4-&gt;e, U+1EC5-&gt;e\
                , U+1EC6-&gt;e, U+1EC7-&gt;e, U+2091-&gt;e ,U+00CC-&gt;i, U+00CD-&gt;i, U+00CE-&gt;i\
                , U+00CF-&gt;i, U+00EC-&gt;i, U+00ED-&gt;i, U+00EE-&gt;i, U+00EF-&gt;i, U+010309-&gt;i\
                , U+0128-&gt;i, U+0129-&gt;i, U+012A-&gt;i, U+012B-&gt;i, U+012C-&gt;i, U+012D-&gt;i\
                , U+012E-&gt;i, U+012F-&gt;i, U+0130-&gt;i, U+0131-&gt;i, U+0197-&gt;i, U+01CF-&gt;i\
                , U+01D0-&gt;i, U+0208-&gt;i, U+0209-&gt;i, U+020A-&gt;i, U+020B-&gt;i, U+0268-&gt;i\
                , U+026A-&gt;i, U+040D-&gt;i, U+0418-&gt;i, U+0419-&gt;i, U+1E09-&gt;c, U+212D-&gt;c\
                , U+2184-&gt;c
}</code></pre><p id="r-547432" data-claire-element-id="547432">Maintenant, si vous essayez de chercher « etude », eh bien... ça ne fonctionnera toujours pas. En effet, dans la bibliothèque de Sphinx, les mots sont toujours accentués, donc il ne trouvera toujours pas le mot « etude ». Il va falloir réindexer les news pour que Sphinx crée sa bibliothèque avec les news « désaccentuées ». Ainsi, dans la bibliothèque de Sphinx, il n'y aura plus de mot « étude », mais que des « etude ».</p><aside id="r-547434" data-claire-element-id="547434" data-claire-semantic="information"><p id="r-547433" data-claire-element-id="547433"><strong>Rappel</strong> : pour réindexer les news, il faut utiliser la commande <code data-claire-semantic="console">sudo indexer news --rotate</code> sous Linux et Mac OS, ou <code data-claire-semantic="console">C:\Sphinx\bin\indexer news --rotate</code> sous Windows.</p></aside><p id="r-547435" data-claire-element-id="547435">Essayez à présent de chercher « etude », et vous verrez que Sphinx vous retournera les news attendues. Il en va de même si vous cherchez « étude » ou même « ètude », car Sphinx retire tous les accents de la requête.</p><p id="r-547436" data-claire-element-id="547436">Ce tutoriel s'arrête ici. Celui-ci vous a posé les bases et permis de réaliser votre premier moteur de recherche avec Sphinx. Libre à vous de l'améliorer et de chercher sur Internet de nouvelles fonctionnalités intéressantes ! Pour cela, je vous redirigerais vers <a href="http://sphinxsearch.com/docs/">la documentation officielle de Sphinx</a> (indépendante du langage utilisé) et <a href="http://fr2.php.net/manual/fr/book.sphinx.php">la documentation de Sphinx pour PHP</a>. :)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php">Créer un moteur de recherche avec Sphinx et PHP</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php/installation-de-sphinx">
Installation de Sphinx
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php/recherchons-avec-sphinx">
Recherchons avec Sphinx
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php/exploitons-sphinx-avec-php">
Exploitons Sphinx avec PHP
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-moteur-de-recherche-avec-sphinx-et-php/recherchons-avec-sphinx">
<span class="arrow"></span>
<span class="next">Recherchons avec Sphinx</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/creer-un-moteur-de-recherche-avec-sphinx-et-php.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 06:36:45 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/creer-un-moteur-de-recherche-avec-sphinx-et-php.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:10:56 GMT -->
</html>