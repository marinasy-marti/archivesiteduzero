<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/un-livre-d-or.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 19:54:44 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/un-livre-d-or.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:39:49 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Un livre d&#039;or</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/un-livre-d-or.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Un livre d&#039;or</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Unlivred039or">Un livre d&#039;or</a><br/><a href="#Ralisationdulivred039or">Réalisation du livre d&#039;or</a><br/></div>
<a name="Unlivred039or"></a><h2>Un livre d&#039;or</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/un-livre-d-or/realisation-du-livre-d-or">
<span class="next">Réalisation du livre d&#039;or</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-951118" data-claire-element-id="951118">De nombreux sites web aiment bien démarrer avec un livre d'or pour que les membres laissent leur avis. C'est un bon moyen de récolter les premiers retours de ses visiteurs.</p><p id="r-951119" data-claire-element-id="951119">On va dans ce TP apprendre à créer un livre d'or pour votre site. Ainsi, les visiteurs pourront laisser une trace de leur passage, et ça valorisera d'autant plus votre site :)</p>
</div><a name="Ralisationdulivred039or"></a><h2>Réalisation du livre d&#039;or</h2><div class="clear"></div> <div id="content" role="article">
<h2 id="r-etape-1-prerequis-1" data-claire-element-id="951131">Étape 1 : prérequis</h2><p id="r-951120" data-claire-element-id="951120">Les prérequis pour le livre d'or ressemblent beaucoup à ceux du Mini-Chat :</p><ul id="r-951129" data-claire-element-id="951129"><li id="r-951122" data-claire-element-id="951122"><p id="r-951121" data-claire-element-id="951121">savoir lire dans une table MySQL ;</p></li><li id="r-951124" data-claire-element-id="951124"><p id="r-951123" data-claire-element-id="951123">savoir écrire dans une table MySQL ;</p></li><li id="r-951126" data-claire-element-id="951126"><p id="r-951125" data-claire-element-id="951125">savoir compter le nombre d'entrées dans une table ;</p></li><li id="r-951128" data-claire-element-id="951128"><p id="r-951127" data-claire-element-id="951127">savoir bien utiliser les formulaires.</p></li></ul><p id="r-951130" data-claire-element-id="951130">Ce que vous avez appris dans le chapitre précédent sur les formulaires est très important. N'hésitez pas à vous y reporter, car c'est en combinant les formulaires et MySQL que vous créerez des scripts très puissants !</p><h2 id="r-etape-2-preparation-du-script-1" data-claire-element-id="951175">Étape 2 : préparation du script</h2><p id="r-951132" data-claire-element-id="951132">Comme d'habitude, on n'attaque <strong>jamais</strong> un script PHP avant de l'avoir préparé : on doit réfléchir à son fonctionnement si on ne veut pas se retrouver complètement perdus dans notre code.<br/> On doit d'abord se demander quelles seront les fonctionnalités de notre livre d'or. Quand un visiteur va arriver dessus, que va-t-il pouvoir faire ? Il peut laisser son pseudo et un message ; il sera enregistré dans une table comme tous les autres.</p><p id="r-951133" data-claire-element-id="951133">Commençons par créer cette table justement. On va l'appeler &quot;livreor&quot;, et elle aura 3 champs :</p><ul id="r-951140" data-claire-element-id="951140"><li id="r-951135" data-claire-element-id="951135"><p id="r-951134" data-claire-element-id="951134">id : comme d'habitude, on crée un id pour numéroter chaque champ. Cet id a le type INT dans MySQL et j'ai sélectionné &quot;Primaire&quot; comme je vous avais dit de faire pour les champs id. Par ailleurs, j'ai choisi &quot;auto increment&quot; pour que le numéro d'id s'inscrive automatiquement à chaque nouvelle entrée.</p></li><li id="r-951137" data-claire-element-id="951137"><p id="r-951136" data-claire-element-id="951136">pseudo : c'est le pseudo du visiteur. Il est de type VARCHAR, et il ne faut pas oublier de préciser sa &quot;taille&quot; lorsque vous créez la table : une taille de 255 me semble suffisante (vous n'avez pas des pseudos de 256 caractères dites-moi ? o_O)</p></li><li id="r-951139" data-claire-element-id="951139"><p id="r-951138" data-claire-element-id="951138">message : on y stocke le message qu'a laissé le visiteur. Ce champ est de type TEXT.</p></li></ul><p id="r-951141" data-claire-element-id="951141">Je propose qu'on mette en haut de la page le formulaire, puis juste en-dessous la liste des messages... Ce qui devrait vous faire très fortement penser au Mini-Chat !<br/> Voici un aperçu de ce que vous devez pouvoir réaliser :</p><figure id="r-951143" data-claire-element-id="951144"><img id="r-951142" data-claire-element-id="951142" src="medias/uploads.siteduzero.com_files_6001_7000_6738.jpg" alt="Image utilisateur"/></figure><p id="r-951145" data-claire-element-id="951145">Encore une fois, c'est moche je vous l'accorde. Mais le design, c'est très facile à réaliser (une couleur de fond, une image et c'est bon :p ).<br/> Nous, ce qui nous intéresse c'est d'arriver à faire marcher le code. Vous aurez tout le loisir de rajouter des fioritures après, croyez-moi. ;)</p><p id="r-951146" data-claire-element-id="951146">Pour l'enregistrement, c'est comme pour le Mini-Chat. Par mesure de sécurité, il ne faut pas oublier le htmlspecialchars ainsi que le mysql_real_escape_string (car on va utiliser les variables dans des requêtes SQL).</p><p id="r-951147" data-claire-element-id="951147">Bon, vous avez certainement remarqué la principale différence entre le Mini-Chat et le livre d'or : ici on ne veut pas afficher juste les 10 derniers messages, on veut TOUS les afficher. Et tous sur une même page, ça fait beaucoup. Donc, <em>on va créer automatiquement des pages</em> pour qu'il y ait par exemple 20 messages par page.</p><p id="r-951148" data-claire-element-id="951148">Cela peut vous sembler flou : comment &quot;créer&quot; automatiquement des pages en PHP ? Vous allez voir, ce n'est peut-être pas ce à quoi vous vous attendiez. ^^</p><ol id="r-951161" data-claire-element-id="951161"><li id="r-951150" data-claire-element-id="951150"><p id="r-951149" data-claire-element-id="951149">On récupère le nombre total des messages ($totalDesMessages) grâce à la requête MySQL que je vous ai apprise.</p></li><li id="r-951155" data-claire-element-id="951155"><p id="r-951151" data-claire-element-id="951151">On calcule le nombre de pages qu'il y aura. Comment ? Avec une bête division mathématique !<br/>$nombreDePages = $totalDesMessages / $nombreDeMessagesParPage;<br/> Exemple : si on a 100 messages, et qu'on veut 20 messages par page. On calcule 100 / 20 = 5 pages ! Tout bête n'est-ce pas. ;)</p><aside id="r-951153" data-claire-element-id="951153" data-claire-semantic="information"><p id="r-951152" data-claire-element-id="951152">Vous devez, bien sûr, donner d'abord une valeur à $nombreDeMessagesParPage. Moi je mettrai 20 par exemple, mais vous mettez ce que vous voulez. L'avantage, c'est que si vous voulez changer plus tard le nombre de message par page, vous aurez juste à modifier la valeur de la variable !</p></aside><p id="r-951154" data-claire-element-id="951154">Mais... mais... s'il y a 102 messages par exemple, 102 / 20 = 5.1 pages ! Or, on ne peut pas avoir 5.1 pages, donc il va falloir créer une sixième page qui ne contiendra que 2 messages.<br/> Il y a une fonction PHP mathématique qui va bien nous aider : <em>ceil</em>. Elle renvoie le nombre entier supérieur : si on lui donne 5.1, elle va renvoyer 6 ! C'est exactement ce qu'il nous faut ! Donc, pour être sûrs du nombre exact de pages à créer, il faudra plutôt utiliser l'instruction suivante :</p></li><p id="r-951156" data-claire-element-id="951156">$nombreDePages = ceil($totalDesMessages / $nombreDeMessagesParPage);</p><li id="r-951158" data-claire-element-id="951158"><p id="r-951157" data-claire-element-id="951157">Maintenant qu'on a le nombre de pages, on va écrire tous les liens vers chacune de ces pages (1 2 3 4 5 6...). Lorsqu'on cliquera sur un de ces numéros, ça amènera à la page correspondante.<br/> Il suffit de faire une boucle For (ou While, comme vous voulez :p) qui va écrire tous ces nombres à la suite, de 1 à $nombreDePages. Comme ça, on aura écrit 1 2 3 4 si on a 4 pages dans notre livre d'or !</p></li><li id="r-951160" data-claire-element-id="951160"><p id="r-951159" data-claire-element-id="951159">Mais vers quelle page amène chacun de ces liens ? En fait, on va rouvrir la même page, mais avec un paramètre différent. On va rajouter un ?page=4 par exemple si on veut aller à la page 4. Si la page du livre d'or s'appelle &quot;livreor.php&quot;, le lien vers la page 4 sera donc :<br/>&lt;a href=&quot;livreor.php?page=4&quot;&gt;4&lt;/a&gt;</p></li></ol><p id="r-951162" data-claire-element-id="951162">Si je prends l'aperçu du livre d'or que je vous ai montré tout à l'heure, voici par exemple les liens vers les pages 3 et 8 :</p><figure id="r-951164" data-claire-element-id="951165"><img id="r-951163" data-claire-element-id="951163" src="medias/uploads.siteduzero.com_files_6001_7000_6739.jpg" alt="Image utilisateur"/></figure><p id="r-951166" data-claire-element-id="951166">C'est ce qu'on cherche à obtenir.<br/> Ça a peut-être l'air d'être un truc mathématique barbare, mais dites-vous bien que ce n'est qu'une minable petite division à faire. Non, en fait ce qui doit vous gêner, c'est que vous découvrez le &quot;truc&quot; des pages pour la première fois.</p><p id="r-951167" data-claire-element-id="951167">On ne va pas créer un fichier PHP différent pour chaque page (je suis pas fou à ce point :lol: ). Simplement, il y aura une variable $_GET['page'] qui va indiquer à quelle page on se trouve. Notre script saura afficher les messages de cette page tout seul !</p><aside id="r-951169" data-claire-element-id="951169" data-claire-semantic="warning"><p id="r-951168" data-claire-element-id="951168">Pensez à vérifier si $_GET['page'] existe. Si ce n'est pas le cas, alors c'est la première fois que le visiteur charge le livre d'or : mettez-le sur la page 1 (la plus récente).</p></aside><div id="r-951171" data-claire-element-id="951171" data-claire-semantic="question"><p id="r-951170" data-claire-element-id="951170">Bon, j'ai récupéré le nombre total de messages et j'ai écrit les liens vers chacune de ces pages avec une boucle. Je fais comment pour afficher juste les messages de la page ?</p></div><p id="r-951172" data-claire-element-id="951172">Souvenez-vous : $_GET['page'] est une variable qui contient le numéro de la page que le visiteur est en train de lire. Il suffit de modifier la requête SQL, en utilisant LIMIT. Et n'oubliez pas qu'on veut afficher les messages dans l'ordre décroissant (le plus récent en premier).</p><p id="r-951173" data-claire-element-id="951173">Il va donc falloir réfléchir un petit peu à la requête SQL... Je ne vous donne pas la réponse, il faut que vous cherchiez vous-mêmes.<br/> Pour info, j'ai bien dû réfléchir 5 minutes avant de trouver la requête... Eh oui, contrairement aux apparences je ne suis pas un robot : comme vous, je dois réfléchir un peu avant d'arriver à faire marcher mes scripts. ;)</p><p id="r-951174" data-claire-element-id="951174">Bon, et après ça, c'est gagné. :D <br/> Il ne vous reste plus qu'à afficher le résultat de la requête dans une boucle, comme vous avez l'habitude de faire. Si tout se passe bien, les messages de la page s'afficheront !</p><h2 id="r-etape-3-a-vous-de-jouer-1" data-claire-element-id="951179">Étape 3 : à vous de jouer !</h2><p id="r-951176" data-claire-element-id="951176">Pfiou ! Je vous ai décortiqué tout le problème, vous avez les bases qu'il faut pour écrire le script. :)</p><p id="r-951177" data-claire-element-id="951177">Prenez votre temps surtout, on n'est pas pressés.<br/> Soignez bien le système de pages, c'est d'ailleurs la seule chose qui différencie ce TP du TP Mini-Chat.<br/> Surtout, n'abandonnez pas trop vite : il est parfois bien, quand vous commencez à avoir mal à la tête, d'aller piquer un petit somme. Très souvent, on a plein de bonnes idées au réveil ! :D</p><p id="r-951178" data-claire-element-id="951178">Ah, et n'ayez pas peur de créer d'autres variables si nécessaire. C'est un bon moyen de simplifier un problème, parfois !</p><h2 id="r-etape-4-correction-1" data-claire-element-id="951216">Étape 4 : correction</h2><p id="r-951180" data-claire-element-id="951180">On corrige maintenant ?</p><p id="r-951181" data-claire-element-id="951181">Allez, voici en gros ce qu'il fallait faire :</p><pre id="r-951182" data-claire-element-id="951182"><code data-claire-semantic="html+php">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
 
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot;&gt;
   &lt;head&gt;
       &lt;title&gt;Livre d'or&lt;/title&gt;
        &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=iso-8859-1&quot; /&gt;
 
        &lt;style type=&quot;text/css&quot;&gt;
        form, .pages
        {
            text-align:center;
        }
        &lt;/style&gt;
    &lt;/head&gt;
    &lt;body&gt;
 
    &lt;form method=&quot;post&quot; action=&quot;livreor.php&quot;&gt;
        &lt;p&gt;Mon site vous plaît ? Laissez-moi un message !&lt;/p&gt;
        &lt;p&gt;
            Pseudo : &lt;input name=&quot;pseudo&quot; /&gt;&lt;br /&gt;
            Message :&lt;br /&gt;
            &lt;textarea name=&quot;message&quot; rows=&quot;8&quot; cols=&quot;35&quot;&gt;&lt;/textarea&gt;&lt;br /&gt;
            &lt;input type=&quot;submit&quot; value=&quot;Envoyer&quot; /&gt;
        &lt;/p&gt;
    &lt;/form&gt;
 
    &lt;p class=&quot;pages&quot;&gt;
 
&lt;?php
mysql_connect(&quot;localhost&quot;, &quot;sdz&quot;, &quot;mot_de_passe&quot;);
mysql_select_db(&quot;coursphp&quot;);
 
// --------------- Étape 1 -----------------
// Si un message est envoyé, on l'enregistre
// -----------------------------------------
 
if (isset($_POST['pseudo']) AND isset($_POST['message']))
{
    $pseudo = mysql_real_escape_string(htmlspecialchars($_POST['pseudo'])); // On utilise mysql_real_escape_string et htmlspecialchars par mesure de sécurité
    $message = mysql_real_escape_string(htmlspecialchars($_POST['message'])); // De même pour le message
    $message = nl2br($message); // Pour le message, comme on utilise un textarea, il faut remplacer les Entrées par des &lt;br /&gt;
 
    // On peut enfin enregistrer :o)
    mysql_query(&quot;INSERT INTO livreor VALUES('', '&quot; . $pseudo . &quot;', '&quot; . $message . &quot;')&quot;);
}
 
// --------------- Étape 2 -----------------
// On écrit les liens vers chacune des pages
// -----------------------------------------
 
// On met dans une variable le nombre de messages qu'on veut par page
$nombreDeMessagesParPage = 20; // Essayez de changer ce nombre pour voir :o)
// On récupère le nombre total de messages
$retour = mysql_query('SELECT COUNT(*) AS nb_messages FROM livreor');
$donnees = mysql_fetch_array($retour);
$totalDesMessages = $donnees['nb_messages'];
// On calcule le nombre de pages à créer
$nombreDePages  = ceil($totalDesMessages / $nombreDeMessagesParPage);
// Puis on fait une boucle pour écrire les liens vers chacune des pages
echo 'Page : ';
for ($i = 1 ; $i &lt;= $nombreDePages ; $i++)
{
    echo '&lt;a href=&quot;livreor.php?page=' . $i . '&quot;&gt;' . $i . '&lt;/a&gt; ';
}
?&gt;
 
&lt;/p&gt;
 
&lt;?php
 
 
// --------------- Étape 3 ---------------
// Maintenant, on va afficher les messages
// ---------------------------------------
 
if (isset($_GET['page']))
{
        $page = $_GET['page']; // On récupère le numéro de la page indiqué dans l'adresse (livreor.php?page=4)
}
else // La variable n'existe pas, c'est la première fois qu'on charge la page
{
        $page = 1; // On se met sur la page 1 (par défaut)
}
 
// On calcule le numéro du premier message qu'on prend pour le LIMIT de MySQL
$premierMessageAafficher = ($page - 1) * $nombreDeMessagesParPage;
 
$reponse = mysql_query('SELECT * FROM livreor ORDER BY id DESC LIMIT ' . $premierMessageAafficher . ', ' . $nombreDeMessagesParPage);
 
while ($donnees = mysql_fetch_array($reponse))
{
        echo '&lt;p&gt;&lt;strong&gt;' . $donnees['pseudo'] . '&lt;/strong&gt; a écrit :&lt;br /&gt;' . $donnees['message'] . '&lt;/p&gt;';
}
 
mysql_close(); // On n'oublie pas de fermer la connexion à MySQL ;o)
?&gt;
 
&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-951183" data-claire-element-id="951183"><strong>Veuillez noter</strong> : j'ai volontairement désactivé l'ajout de messages sur cet exemple de livre d'or afin d'éviter que ça ne devienne un bazar sans nom. ^^ <br/> Vous pouvez donc lire les messages mais pas en ajouter. Testez ce script en local avec WAMP, et vous verrez qu'il marche bien entendu. ;)</p><p id="r-951184" data-claire-element-id="951184">Bien entendu, je ne doute pas que 90 % d'entre vous ont eu du mal à arriver à finir ce script (ou ont bloqué quelque part).<br/> Je ne vous le répèterai jamais assez : il ne faut pas s'affoler, c'est normal. Le TP vous force à réfléchir, et la correction vous permet de vous dire : « Ah oui ! C'était ça ! »<br/> C'est ça qui est vraiment enrichissant pour vous. :)</p><p id="r-951185" data-claire-element-id="951185">Et si nous expliquions un peu ce code ?<br/> Comme vous pouvez le voir, il est clairement séparé en 3 parties :</p><ol id="r-951213" data-claire-element-id="951213"><li id="r-951187" data-claire-element-id="951187"><p id="r-951186" data-claire-element-id="951186">Partie 1 : Si un message est envoyé, on l'enregistre : comme d'habitude, on vérifie si les variables $_POST['pseudo'] et $_POST['message'] existent. Si c'est le cas, c'est que le visiteur vient d'envoyer un message.<br/> On fait alors un mysql_real_escape_string et un htmlspecialchars sur chacune de ces variables pour éviter que du HTML ne soit inscrit dans votre livre d'or. On utilise aussi un nl2br pour $_POST['message'] : en effet, si le visiteur a tapé des Entrées dans le textarea, il faut utiliser nl2br comme je vous l'ai appris pour les transformer en balises &lt;br /&gt;<br/> Après, il n'y a plus qu'à envoyer une requête à MySQL pour qu'il enregistre le message dans la table.</p></li><li id="r-951198" data-claire-element-id="951198"><p id="r-951188" data-claire-element-id="951188">Partie 2 : On écrit les liens vers chacune des pages : bon là ça devient un peu plus chaud. Je vous ai pas mal expliqué auparavant comment il fallait faire, je vais rapidement vous rappeler ce qu'il se passe.</p><ol id="r-951197" data-claire-element-id="951197"><li id="r-951190" data-claire-element-id="951190"><p id="r-951189" data-claire-element-id="951189">On définit une variable $nombreDeMessagesParPage. J'ai choisi 20 messages par page. L'avantage d'utiliser une variable pour retenir le nombre de messages par pages est évident : si vous décidez plus tard de changer le nombre de messages par page, vous aurez juste à changer cette ligne et non pas tout le code. :)</p></li><li id="r-951192" data-claire-element-id="951192"><p id="r-951191" data-claire-element-id="951191">On récupère le nombre de message total avec une requête SQL comme on l'a vu dans la partie II. On met ce nombre dans $totalDesMessages</p></li><li id="r-951194" data-claire-element-id="951194"><p id="r-951193" data-claire-element-id="951193">Puis, on calcule le nombre de pages à créer avec la division dont je vous ai parlé. Le ceil permet, je vous le rappelle, d'avoir un nombre de pages entier (et non pas 5.2 pages :) ).</p></li><li id="r-951196" data-claire-element-id="951196"><p id="r-951195" data-claire-element-id="951195">Enfin, on n'a plus qu'à faire une boucle pour écrire tous les numéros de page (et les liens qui vont avec). J'ai choisi de faire une boucle for car c'est pratique dans ce cas, mais si vous avez fait un while c'est tout aussi bon.</p></li></ol></li><li id="r-951212" data-claire-element-id="951212"><p id="r-951199" data-claire-element-id="951199">Partie 3 : Maintenant, on va afficher les messages : il reste une dernière petite difficulté, celle-là je vous avais laissé la résoudre vous-mêmes (sinon autant vous donner la correction de suite :lol: ). On a 3 choses à faire :</p><ol id="r-951211" data-claire-element-id="951211"><li id="r-951201" data-claire-element-id="951201"><p id="r-951200" data-claire-element-id="951200">On vérifie si $_GET['page'] existe (avec un isset). Si c'est le cas, on place ce numéro de page dans $page. Si ce n'est pas le cas, c'est que l'adresse de la page est &quot;livreor.php&quot; (il n'y a pas de numéro de page indiqué dans l'adresse). Alors, on donne la valeur 1 à $page.</p></li><li id="r-951208" data-claire-element-id="951208"><p id="r-951202" data-claire-element-id="951202">Maintenant qu'on a un bon numéro de page dans $page, on doit calculer quelque chose pour la requête. En effet, on va faire un <em>ORDER BY id DESC LIMIT</em> ?, ?<br/> Que mettre dans chacun de ces points d'interrogation ?</p><ul id="r-951207" data-claire-element-id="951207"><li id="r-951204" data-claire-element-id="951204"><p id="r-951203" data-claire-element-id="951203">Le premier point d'interrogation correspond au numéro du premier message à prendre (qui n'a rien à voir avec l'id). Le premier message a le numéro 0 je vous rappelle. Comme on prend les messages dans l'ordre décroissant, on commence par le dernier. Si on est sur la page 1, (<em>$page - 1) * $nombreDeMessagesParPage</em> va renvoyer (1-1) * 20 = 0 * 20 = 0. On prendra donc à partir du message n°0 (le premier quoi), et comme on est dans l'ordre décroissant, ça correspond au tout dernier message enregistré. Donc, sur la page 1, on affichera en premier le dernier message écrit dans le livre d'or : exactement ce qu'on voulait ! :)</p></li><li id="r-951206" data-claire-element-id="951206"><p id="r-951205" data-claire-element-id="951205">Pour le second point d'interrogation, c'est facile : il s'agit du nombre d'entrées à récupérer dans la table, c'est-à-dire $nombreDeMessagesParPage puisqu'on veut prendre juste les X messages de la page.</p></li></ul></li><li id="r-951210" data-claire-element-id="951210"><p id="r-951209" data-claire-element-id="951209">Ouf, le plus dur est fait. On n'a plus qu'à faire la requête SQL pour prendre juste les messages qu'il faut, puis à faire une boucle pour afficher les messages de la page.</p></li></ol></li></ol><p id="r-951214" data-claire-element-id="951214">Eh oui, ce script était un peu plus gros que les autres, d'où l'intérêt de bien le découper en plusieurs parties !</p><p id="r-951215" data-claire-element-id="951215">Prenez le temps de bien comprendre comment ce système de pagination fonctionne, croyez-moi ça vaut le coup et vous en aurez certainement besoin pour un de vos futurs scripts. ;)</p><h2 id="r-etape-5-ameliorez-ce-script-1" data-claire-element-id="951232">Étape 5 : améliorez ce script !</h2><p id="r-951217" data-claire-element-id="951217">Sur un tel script, on pourrait faire beaucoup d'autres choses. Je vais vous proposer quelques pistes pour améliorer ce script, mais je ne vous donnerai pas de correction (sinon je m'en sortirai jamais :p ).<br/> Je pense que c'est une bonne idée que vous continuiez à réfléchir à l'amélioration du script tout seuls. Mon rôle ici se limite à vous donner des idées.<br/> Et n'oubliez pas que je ne vous abandonne pas : si vous bloquez sur une amélioration vous pouvez aller demander de l'aide sur les forums !</p><ul id="r-951228" data-claire-element-id="951228"><li id="r-951219" data-claire-element-id="951219"><p id="r-951218" data-claire-element-id="951218">Améliorez le design, c'est vraiment super basique ce que j'ai fait comme présentation. C'est facile à faire, ça demande juste de modifier le code HTML.</p></li><li id="r-951221" data-claire-element-id="951221"><p id="r-951220" data-claire-element-id="951220">Affichez le nombre total de messages postés dans votre livre d'or, c'est pratique de le voir écrit (c'est super facile à faire, si vous n'y arrivez pas c'est très grave :lol: ).</p></li><li id="r-951223" data-claire-element-id="951223"><p id="r-951222" data-claire-element-id="951222">Ajoutez une liste déroulante dans votre formulaire. Ce champ permettra au visiteur de choisir une note qu'il donne à votre site (mettez donc les choix 0 1 2 3 ... 18 19 20).<br/> Ajoutez un champ &quot;note&quot; de type INT à votre table livreor (si vous regardez dans les options de PHPMyAdmin c'est facile de rajouter un champ même quand la table a été créée).<br/> Comme ça, en plus du message du visiteur, vous affichez la note qu'il a donnée à votre site</p></li><li id="r-951225" data-claire-element-id="951225"><p id="r-951224" data-claire-element-id="951224">Mieux, vous faites la moyenne de toutes les notes qu'on a données à votre site, et vous l'affichez en haut (ex. : &quot;Note moyenne : 14.6 / 20&quot;). Je vous rappelle que pour trouver la moyenne, il faut faire (note1 + note2 + note3 + ...) / totalDesMessages</p></li><li id="r-951227" data-claire-element-id="951227"><p id="r-951226" data-claire-element-id="951226">Question sécurité, si on veut vraiment être parfaits, il y a un petit détail que j'ai omis volontairement pour pas trop compliquer le script. Vous voyez le numéro de page passé par l'adresse avec $_GET['page'] ? Eh bien, si le visiteur modifie manuellement ce numéro de page, il peut mettre n'importe quoi et même du code HTML !<br/> Bon, dans ce cas c'est pas bien grave, le code HTML ne sera pas affiché et ça fera juste bugger le script. Mais, pour être &quot;propres&quot;, il faudrait utiliser la fonction intval sur $_GET['page'] pour <em>transformer à coup sûr</em> le numéro de page en un nombre. Donc, il faudrait écrire plutôt la ligne suivante :<br/>$page = intval($_GET['page']);<br/> Si vous ne le faites pas vous n'allez pas en mourir, mais sachez que les bons codeurs en PHP font ce genre de choses. Je peux pas vous en vouloir de ne pas l'avoir fait, vous ne connaissiez pas cette fonction. :p</p></li></ul><p id="r-951229" data-claire-element-id="951229">Voilà ce que j'appelle un bon vrai TP. :D</p><p id="r-951230" data-claire-element-id="951230">Là, on est vraiment dans le concret des choses : vous êtes aptes à créer des scripts assez importants, comme vous venez de le voir. Le truc pour pas se perdre, c'est une organisation sans faille : un code bien présenté, avec des commentaires et des noms de variables clairs.<br/> Vous n'allez pas me croire, mais c'est la clé de tout. Oui oui, un code bien présenté vous permet de ne pas vous noyer, des commentaires permettent de vous y retrouver.</p><p id="r-951231" data-claire-element-id="951231">Prenez ces bonnes habitudes, il va sans dire qu'elles seront tout bonnement indispensables si vous voulez bien progresser. :)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/un-livre-d-or">Un livre d&#039;or</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/un-livre-d-or/realisation-du-livre-d-or">
Réalisation du livre d&#039;or
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/un-livre-d-or.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 19:54:45 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/un-livre-d-or.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:39:50 GMT -->
</html>