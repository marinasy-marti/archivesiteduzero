<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/les-magic-quotes-ou-guillemets-magiques.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 11:16:14 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/les-magic-quotes-ou-guillemets-magiques.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:48:53 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Les magic quotes ou guillemets magiques</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/les-magic-quotes-ou-guillemets-magiques.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Les magic quotes ou guillemets magiques</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Lesmagicquotesouguillemetsmagiques">Les magic quotes ou guillemets magiques</a><br/><a href="#C039estquoicettebestiole">C&#039;est quoi cette bestiole ?</a><br/><a href="#Dsactiverlesmagicquotes">Désactiver les magic quotes</a><br/></div>
<a name="Lesmagicquotesouguillemetsmagiques"></a><h2>Les magic quotes ou guillemets magiques</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-magic-quotes-ou-guillemets-magiques/c-est-quoi-cette-bestiole">
<span class="next">C&#039;est quoi cette bestiole ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-557504" data-claire-element-id="557504">Bienvenue dans ce tutoriel sur les <em>magic quotes</em>, aussi appelés les guillemets magiques. Je vais vous expliquer ce que sont les magic quotes et comment les désactiver.</p>
</div><a name="C039estquoicettebestiole"></a><h2>C&#039;est quoi cette bestiole ?</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-magic-quotes-ou-guillemets-magiques/desactiver-les-magic-quotes">
<span class="next">Désactiver les magic quotes</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-557505" data-claire-element-id="557505">Les magic quotes ou guillemets magiques sont une protection de PHP qui effectue automatiquement des <a href="http://www.php.net/manual/fr/function.addslashes.php">addslashes</a> (place un \ devant les ' pour les échapper) sur les valeurs reçues en HTTP.</p><p id="r-557506" data-claire-element-id="557506">Exemple de la fonction addslashes :</p><pre id="r-557507" data-claire-element-id="557507"><code data-claire-semantic="html+php">&lt;?php
$chaine_non_protegee = &quot;S'alut !&quot;; // une phrase contenant un '
$chaine_protegee = addslashes($chaine_non_protegee); // le ' est échappé
echo $chaine_protegee; // affiche : S\'alut !
?&gt;</code></pre><p id="r-557508" data-claire-element-id="557508">Cette protection est considérée comme une sécurité pour le développeur, car il n'a plus à faire la conversion lui-même pour être protégé des injections SQL (détournements de requêtes en utilisant les apostrophes). L'échappement est automatiquement fait.<br/> Mais ce comportement est de plus en plus remis en cause pour des questions de performance et de facilité de programmation.</p><p id="r-557509" data-claire-element-id="557509">En effet la conversion n'est pas toujours nécessaire, et l'activation de cette protection implique de toujours savoir d'où viennent les données qu'on utilise. Si elles viennent de la requête HTTP, elles sont déjà converties ; si elles viennent d'un fichier (d'une base de données ou d'un calcul), elles ne le sont pas. Ceci entraîne souvent des oublis de conversion de données ne provenant pas de la requête HTTP.</p><p id="r-557510" data-claire-element-id="557510">Il est donc préférable de désactiver les magic quotes.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/les-magic-quotes-ou-guillemets-magiques">Les magic quotes ou guillemets magiques</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/les-magic-quotes-ou-guillemets-magiques/c-est-quoi-cette-bestiole">
C&#039;est quoi cette bestiole ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-magic-quotes-ou-guillemets-magiques/desactiver-les-magic-quotes">
Désactiver les magic quotes
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-magic-quotes-ou-guillemets-magiques/desactiver-les-magic-quotes">
<span class="next">Désactiver les magic quotes</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Dsactiverlesmagicquotes"></a><h2>Désactiver les magic quotes</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-magic-quotes-ou-guillemets-magiques/c-est-quoi-cette-bestiole">
<span class="arrow"></span>
<span class="next">C&#039;est quoi cette bestiole ?</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-557512" data-claire-element-id="557512">Si vous décidez de désactiver les magic quotes, il faut que vous pensiez bien à sécuriser vos requêtes SQL à l'aide de la fonction <a href="http://fr3.php.net/mysql_real_escape_string">mysql_real_escape_string</a> ou de la fonction <a href="http://www.php.net/manual/fr/function.addslashes.php">addslashes</a>.</p><p id="r-557513" data-claire-element-id="557513">Exemple de requête sécurisée :</p><pre id="r-557514" data-claire-element-id="557514"><code data-claire-semantic="html+php">&lt;?php
$pseudo = mysql_real_escape_string($_GET['pseudo']); // On protège d'abord la variable $_GET['pseudo']
$reponse = mysql_query(&quot;SELECT champ1, champ2 FROM membre WHERE pseudo = '$pseudo' &quot;); // puis on l'utilise dans une requête
?&gt;</code></pre><p id="r-557515" data-claire-element-id="557515">Il existe deux façons de désactiver les guillemets magiques, je vais vous les présenter toutes les deux.<br/> La première est surtout pratique si vous avez votre propre serveur, et que personne ne risque de modifier la configuration de PHP.<br/> La seconde est pratique car elle permet de fonctionner sur n'importe quel serveur (avec ou sans les magic quotes).</p><p id="r-557516" data-claire-element-id="557516">Je vous conseille, par conséquent, la seconde. :p</p><h3 id="r-vous-etes-en-hebergement-dedie-desactivation-dans-le-fichier-de-configuration" data-claire-element-id="557523">Vous êtes en hébergement dédié (&quot;désactivation dans le fichier de configuration&quot;)</h3><p id="r-557517" data-claire-element-id="557517">Si vous êtes en hébergement dédié, vous devez pouvoir accéder au fichier de configuration de PHP. Il s'agit du fichier php.ini.<br/> Le php.ini est un fichier texte ASCII divisé en plusieurs sections, chaque section permettant de configurer différents paramètres (chemins d'accès des fichiers, changement des paramètres de sessions et des bases de données, activation d'extensions).</p><p id="r-557518" data-claire-element-id="557518">Trouvez l'endroit où il y a :</p><pre id="r-557519" data-claire-element-id="557519"><code>;;;;;;;;;;;;;;;;;
; Data Handling ;
;;;;;;;;;;;;;;;;;</code></pre><p id="r-557520" data-claire-element-id="557520">Puis descendez un peu, vous devriez trouver ceci :</p><pre id="r-557521" data-claire-element-id="557521"><code>; Magic quotes
;
 
; Magic quotes for incoming GET/POST/Cookie data.
magic_quotes_gpc = On
 
; Magic quotes for runtime-generated data, e.g. data from SQL, from exec(), etc.
magic_quotes_runtime = Off
 
; Use Sybase-style magic quotes (escape ' with '' instead of \').
magic_quotes_sybase = Off</code></pre><p id="r-557522" data-claire-element-id="557522">Ce sont les valeurs par défaut.<br/> Pour désactiver les magic quotes, mettez magic_quotes_gpc à <strong>Off</strong>. Normalement, magic_quotes_runtime et magic_quotes_sybase sont désactivés ; s'ils ne le sont pas, mettez-les à <strong>Off</strong>.</p><h3 id="r-vous-n-avez-pas-acces-au-php-ini-desactivation-dans-le-code" data-claire-element-id="557534">Vous n'avez pas accès au php.ini (&quot;désactivation dans le code&quot;)</h3><p id="r-557524" data-claire-element-id="557524">Si vous êtes en hébergement mutualisé, vous n'avez pas accès au php.ini, l'activation des magic quotes dépend de votre hébergeur. Beaucoup d'hébergeurs continuent à activer cette directive pour rester compatibles avec les anciens scripts, mais d'autres la désactivent.</p><p id="r-557525" data-claire-element-id="557525">Pour savoir si les magic quotes sont activés sur votre serveur, utilisez la fonction get_magic_quotes_gpc(). Cette fonction renvoie 1 s'ils sont activés, sinon 0.<br/> S'ils sont activés, il faut alors contrer leur effet. Il faut enlever les \ ajoutés. Il existe pour cela la fonction stripslashes().</p><aside id="r-557527" data-claire-element-id="557527" data-claire-semantic="warning"><p id="r-557526" data-claire-element-id="557526">T'es gentil, mais c'est pas très pratique d'appliquer stripslashes sur toutes les variables extérieures ($_POST, $_GET et $_COOKIE) . Si je dois faire $variable = stripslashes($_GET['variable']); pour chaque variable, c'est nul !</p></aside><p id="r-557528" data-claire-element-id="557528">C'est vrai, mais heureusement la fonction (eh oui, encore une !) <a href="http://fr2.php.net/array_map">array_map</a> va nous sauver. <br/> Cette fonction permet d'appliquer une fonction sur tous les éléments d'un tableau. Cela a l'air compliqué, mais c'est simple.</p><p id="r-557529" data-claire-element-id="557529">Vous allez comprendre, voici un code qui annule l'effet des magic quotes :</p><pre id="r-557530" data-claire-element-id="557530"><code data-claire-semantic="html+php">&lt;?php
function stripslashes_r($var) // Fonction qui supprime l'effet des magic quotes
{
        if(is_array($var)) // Si la variable passée en argument est un array, on appelle la fonction stripslashes_r dessus
        {
                return array_map('stripslashes_r', $var);
        }
        else // Sinon, un simple stripslashes suffit
        {
                return stripslashes($var);
        }
}
 
if(get_magic_quotes_gpc()) // Si les magic quotes sont activés, on les désactive avec notre super fonction ! ;)
{
   $_GET = stripslashes_r($_GET);
   $_POST = stripslashes_r($_POST);
   $_COOKIE = stripslashes_r($_COOKIE);
}
?&gt;</code></pre><p id="r-557531" data-claire-element-id="557531">Ce code permet donc de contrer l'effet des magic quotes. Les magic quotes agissent avant l'analyse du code, ce petit code est donc à placer au tout début de votre page.</p><p id="r-557532" data-claire-element-id="557532">Même si les guillemets magiques sont désactivés sur votre serveur, utilisez ce code. En effet, si par exemple la configuration du serveur est modifiée ou que vous changez de serveur, votre application marchera dans tous les cas !<br/> Un autre exemple : vous avez fait un forum. Sur votre site, les gens peuvent le télécharger pour l'installer sur leur serveur : du coup, quelle que soit leur configuration, votre application fonctionnera !</p><p id="r-557533" data-claire-element-id="557533">Voilà, ce tuto est fini : j'espère avoir été le plus clair possible. Si vous avez des questions / remarques ou autres, n'hésitez pas !<br/><em>Merci aux <a href="http://www.zcorrecteurs.fr/">zcorrecteurs</a> (surtout <a href="http://www.siteduzero.com/membres-294-7500.html">ptipilou</a>), pour leurs corrections et relectures. :) </em><br/>f</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/les-magic-quotes-ou-guillemets-magiques">Les magic quotes ou guillemets magiques</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-magic-quotes-ou-guillemets-magiques/c-est-quoi-cette-bestiole">
C&#039;est quoi cette bestiole ?
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/les-magic-quotes-ou-guillemets-magiques/desactiver-les-magic-quotes">
Désactiver les magic quotes
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-magic-quotes-ou-guillemets-magiques/c-est-quoi-cette-bestiole">
<span class="arrow"></span>
<span class="next">C&#039;est quoi cette bestiole ?</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/les-magic-quotes-ou-guillemets-magiques.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 11:16:14 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/les-magic-quotes-ou-guillemets-magiques.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:48:53 GMT -->
</html>