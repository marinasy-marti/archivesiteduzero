<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/un-compte-a-rebours-en-php.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 01:19:00 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/un-compte-a-rebours-en-php.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:21:01 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Un compte à rebours en PHP</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/un-compte-a-rebours-en-php.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Un compte à rebours en PHP</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#UncomptereboursenPHP">Un compte à rebours en PHP</a><br/><a href="#Basesduscript">Bases du script</a><br/><a href="#Lesconversions">Les conversions</a><br/><a href="#Finalisationampamliorations">Finalisation &amp; améliorations</a><br/><a href="#AnnexeallonsplusloinavecJavaScript">Annexe : allons plus loin avec JavaScript !</a><br/></div>
<a name="UncomptereboursenPHP"></a><h2>Un compte à rebours en PHP</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/bases-du-script">
<span class="next">Bases du script</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-333426" data-claire-element-id="333426">Salut les Zéros !</p><p id="r-333427" data-claire-element-id="333427">Je vais ici vous apprendre comment faire un compte à rebours en PHP, avec une petite touche de <strong>JavaScript</strong> pour ceux qui en veulent plus. Vous verrez, il n'y a rien de plus simple, et quelquefois on va chercher dans le bien compliqué inutilement (j'ai été dans ce cas :p ).</p><p id="r-333428" data-claire-element-id="333428">Je vous propose de faire, tout au long de ce tutoriel, un <strong>TP</strong>. Nous apprendrons à faire un compte à rebours avant Noël. <em>(C'est vrai quoi, qui n'est pas pressé d'être à Noël ? :ange: )</em><br/><a href="http://perso-spritew.webou.net/script~papanoel.php"> ==&gt; Ce que vous saurez faire dans pas très très longtemps...</a><br/><a href="http://perso-spritew.webou.net/script~papanoel_js.html"> ==&gt; Et en JavaScript...</a></p><p id="r-333429" data-claire-element-id="333429"><strong>Compétences requises : </strong><br/><em>Maîtrise du PHP (évidemment) ; Fonction date() ; Timestamp.</em></p><ul id="r-333436" data-claire-element-id="333436"><li id="r-333431" data-claire-element-id="333431"><p id="r-333430" data-claire-element-id="333430"><a href="http://www.siteduzero.com/tutoriel-3-14668-concevez-votre-site-web-avec-php-et-mysql.html">Maîtrise du PHP (évidemment) ;</a></p></li><li id="r-333433" data-claire-element-id="333433"><p id="r-333432" data-claire-element-id="333432"><a href="http://www.siteduzero.com/tutoriel-3-14457-les-fonctions.html#ss_part_2">Fonction date() ;</a></p></li><li id="r-333435" data-claire-element-id="333435"><p id="r-333434" data-claire-element-id="333434"><a href="http://www.siteduzero.com/tutoriel-3-14563-variables-superglobales-sessions-et-cookies.html#ss_part_3">Timestamp.</a></p></li></ul>
</div><a name="Basesduscript"></a><h2>Bases du script</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/les-conversions">
<span class="next">Les conversions</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-333437" data-claire-element-id="333437">Comme je vous l'ai dit, notre petit script fera en sorte de calculer le temps qu'il reste jusqu'à Noël. Pour ce faire, nous allons utiliser le <a href="http://www.siteduzero.com/tutoriel-3-14563-variables-superglobales-sessions-et-cookies.html#ss_part_3">timestamp</a>. Puis, nous calculerons la différence entre le timestamp actuel et le timestamp de Noël prochain.</p><p id="r-333438" data-claire-element-id="333438">Pour commencer, nous allons créer le timestamp du prochain Noël :<br/> Changement de programme ! Est-ce plus palpitant d'attendre le 24 ou l'ouverture des cadeaux ? :D Personnellement, chez moi on les ouvre à 8h, car ma petite sœur croit toujours au Père Noël. À vous d'adapter en fonction de votre situation.</p><aside id="r-333440" data-claire-element-id="333440" data-claire-semantic="warning"><p id="r-333439" data-claire-element-id="333439">Dans la suite du tutoriel, je continuerai de citer le mot « Noël ». J'entends par là, bien sûr, l'ouverture des cadeaux, comme je l'ai dit plus haut.</p></aside><aside id="r-333442" data-claire-element-id="333442" data-claire-semantic="information"><p id="r-333441" data-claire-element-id="333441">Il ne faut pas oublier que nous cherchons à calculer le Noël prochain avec <strong>date('Y')</strong>.</p></aside><pre id="r-333443" data-claire-element-id="333443"><code data-claire-semantic="html+php">&lt;?php
$annee = date('Y');
$noel = mktime(8, 0, 0, 12, 25, $annee); // Le timestamp du 25 décembre de l'année actuelle à 8h00 (ouverture des cadeaux).
?&gt;</code></pre><p id="r-333444" data-claire-element-id="333444">Voilà qui est fait ! Toutefois, nous avons négligé un détail : imaginez que nous sommes le <strong>26 décembre</strong>. Le compteur va donc être réglé sur le Noël qui vient de passer vu que l'année, elle, sera toujours la même. ;) Le compteur sera donc en négatif, sauf si nous appliquons une condition simple à notre code :</p><pre id="r-333445" data-claire-element-id="333445"><code data-claire-semantic="html+php">&lt;?php
$annee = date('Y');
$noel = mktime(8, 0, 0, 12, 25, $annee);
		
 if ($noel &lt; time())
 $noel = mktime(8, 0, 0, 12, 25, ++$annee);

?&gt;</code></pre><div id="r-333447" data-claire-element-id="333447" data-claire-semantic="question"><p id="r-333446" data-claire-element-id="333446">Pourquoi as-tu placé le signe de l'incrémentation avant $annee ? :o</p></div><p id="r-333448" data-claire-element-id="333448">Il s'agit de la pré-incrémentation (au contraire de la post-incrémentation pour $annee++). La valeur de la variable est d'abord incrémentée d'une unité puis renvoyée, alors que dans l'autre cas, c'est l'inverse. D'où l'utilité de faire un ++$annee ici. ;) <br/> De cette manière, nous avançons d'une année, et cela, (au risque de me répéter) tout simplement car nous cherchons à calculer le Noël <strong>PROCHAIN </strong> ! ;)</p><p id="r-333449" data-claire-element-id="333449">Bon ensuite, il faut que l'on récupère la différence entre le timestamp actuel et celui de Noël. Cette différence sera donc le temps qu'il nous reste (en secondes) avant d'ouvrir les cadeaux !</p><p id="r-333450" data-claire-element-id="333450">Récapitulatif :</p><pre id="r-333451" data-claire-element-id="333451"><code data-claire-semantic="html+php">&lt;?php
$annee = date('Y');
$noel = mktime(8, 0, 0, 12, 25, $annee);
		
 if ($noel &lt; time())
 $noel = mktime(8, 0, 0, 12, 25, ++$annee);

 $tps_restant = $noel - time(); // Différence entre Noël et maintenant.
?&gt;</code></pre><p id="r-333452" data-claire-element-id="333452">Avez-vous compris le principe ? Jusque là, c'était assez facile.<br/> Maintenant devinez ce qu'il nous reste à faire pour afficher des jours, des minutes, etc. ?</p><div id="r-333454" data-claire-element-id="333454" data-claire-semantic="question"><p id="r-333453" data-claire-element-id="333453">Terminer le tuto ? :euh:</p></div><p id="r-333455" data-claire-element-id="333455">Aussi, mais je pensais plutôt à convertir toutes ces secondes en durées plus courantes ; car un compte à rebours qui indique <em>« 13459054423 secondes restantes »</em> (par exemple), c'est pas pratique. :D</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php">Un compte à rebours en PHP</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/bases-du-script">
Bases du script
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/les-conversions">
Les conversions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/finalisation-ameliorations">
Finalisation &amp; améliorations
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/annexe-allons-plus-loin-avec-javascript">
Annexe : allons plus loin avec JavaScript !
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/les-conversions">
<span class="next">Les conversions</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesconversions"></a><h2>Les conversions</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/bases-du-script">
<span class="arrow"></span>
<span class="next">Bases du script</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/finalisation-ameliorations">
<span class="next">Finalisation &amp; améliorations</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-333457" data-claire-element-id="333457">Nous arrivons dans la deuxième partie du tuto, et la plus coriace. Jusqu'ici, nous avons construit un script qui nous renvoie le temps restant en secondes. Et ce temps là, nous allons le transformer en quelque chose de plus lisible.</p><p id="r-333458" data-claire-element-id="333458">Vous savez quoi ? Je vais vous laisser chercher un peu ! :D</p><aside id="r-333466" data-claire-element-id="333466" data-claire-semantic="information"><ul id="r-333465" data-claire-element-id="333465"><li id="r-333460" data-claire-element-id="333460"><p id="r-333459" data-claire-element-id="333459">utilisez le <strong>modulo %</strong> pour prendre un reste d'une division ;</p></li><li id="r-333462" data-claire-element-id="333462"><p id="r-333461" data-claire-element-id="333461">utilisez <a href="http://php.net/manual/fr/function.floor.php"><strong>floor()</strong></a> pour arrondir ;</p></li><li id="r-333464" data-claire-element-id="333464"><p id="r-333463" data-claire-element-id="333463">pensez à la division par <strong>60</strong> !</p></li></ul></aside><p id="r-333467" data-claire-element-id="333467">Pom... pom... pom... Fini ? :ninja:</p><p id="r-333468" data-claire-element-id="333468">Allez, ne vous torturez pas plus, je vais vous expliquer ma solution : j'ai divisé le <strong>temps restant par 60</strong> pour obtenir les minutes, puis les <strong>minutes par 60</strong> pour obtenir les heures, et pour finir, <strong>les heures par 24 </strong>pour obtenir les jours. Ce qui me donne ça :</p><pre id="r-333469" data-claire-element-id="333469"><code data-claire-semantic="html+php">&lt;?php
$i_restantes = $tps_restant / 60; // Minutes restantes
$H_restantes = $i_restantes / 60; // Heures restantes
$d_restants = $H_restantes / 24; // Jours restants
?&gt;</code></pre><p id="r-333470" data-claire-element-id="333470">À ce stade, j'espère que vous avez déjà écarquillé les yeux sur ma façon de faire, qui a l'air fausse. Sinon, relisez ! Car en effet elle l'est. Pourquoi ? Car en fin de compte, c'est comme si notre compteur nous disait :</p><p id="r-333471" data-claire-element-id="333471"><cite>Citation</cite></p><blockquote id="r-333473" data-claire-element-id="333473"><p id="r-333472" data-claire-element-id="333472"><em>Il reste <strong>tant d'heures</strong>, ou si vous préférez<strong> tant de minutes</strong>, ou...</em></p></blockquote><p id="r-333474" data-claire-element-id="333474">Et ainsi de suite. Cette méthode revient à traduire le timestamp restant en plusieurs unités de mesure temporelle. Vous suivez ? :-°</p><p id="r-333475" data-claire-element-id="333475">Nous ce qu'on veut c'est que SI il reste 32 heures, le compte à rebours indique <em>« 1 jour et 8 heures restants ».</em> :) <br/> Pour ça, on va prendre le reste des divisions grâce au <strong>modulo (%)</strong>. C'est-à-dire que s'il y a un peu plus d'un jour, on convertira le reste en heures.</p><p id="r-333476" data-claire-element-id="333476">Vous avez compris ? Application du raisonnement :</p><pre id="r-333477" data-claire-element-id="333477"><code data-claire-semantic="html+php">&lt;?php
$H_restantes = $H_restantes % 24;
?&gt;</code></pre><p id="r-333478" data-claire-element-id="333478">C'est au reste de la division de $H_restantes par 24 qu'est maintenant égal $H_restantes. ;)</p><p id="r-333479" data-claire-element-id="333479">Pour finir, appliquons ces changements avec un petit mixage « <strong>floor() + %</strong> » pour arrondir les restes :</p><pre id="r-333480" data-claire-element-id="333480"><code data-claire-semantic="html+php">&lt;?php
$s_restantes = floor($tps_restant % 60); // Secondes restantes
$i_restantes = floor($i_restantes % 60); // Minutes restantes
$H_restantes = floor($H_restantes % 24); // Heures restantes
$d_restants = floor($d_restants); // Jours restants
?&gt;</code></pre><p id="r-333481" data-claire-element-id="333481">Si vous avez mal compris cette partie, relisez-la, c'est important d'avoir bien compris mon raisonnement. Je sais que c'est dur de comprendre un code que vous n'avez pas fait, mais c'est important de ne pas recopier bêtement. Je vous parle en connaissance de cause, c'est d'ailleurs ce qui m'a amené à faire ce tutoriel. Je ne comprenais rien à ce que faisaient les autres, alors j'ai essayé de réfléchir par moi-même. :)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php">Un compte à rebours en PHP</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/bases-du-script">
Bases du script
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/les-conversions">
Les conversions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/finalisation-ameliorations">
Finalisation &amp; améliorations
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/annexe-allons-plus-loin-avec-javascript">
Annexe : allons plus loin avec JavaScript !
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/bases-du-script">
<span class="arrow"></span>
<span class="next">Bases du script</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/finalisation-ameliorations">
<span class="next">Finalisation &amp; améliorations</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Finalisationampamliorations"></a><h2>Finalisation &amp; améliorations</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/les-conversions">
<span class="arrow"></span>
<span class="next">Les conversions</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/annexe-allons-plus-loin-avec-javascript">
<span class="next">Annexe : allons plus loin avec JavaScript !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-333483" data-claire-element-id="333483">Nous voici à la dernière étape ! Comme nous avons le script de fonctionnement, rien de plus simple que d'afficher les résultats !</p><pre id="r-333484" data-claire-element-id="333484"><code data-claire-semantic="html+php">&lt;?php
echo 'Il reste exactement &lt;strong&gt;'. $d_restants .' jours&lt;/strong&gt;, &lt;strong&gt;'. $H_restantes .' heures&lt;/strong&gt;,'
    . ' &lt;strong&gt;'. $i_restantes .' minutes&lt;/strong&gt; et &lt;strong&gt;'. $s_restantes .'s&lt;/strong&gt; avant d\'ouvrir les cadeaux &lt;:o).';
?&gt;</code></pre><p id="r-333485" data-claire-element-id="333485">Pour finir, que diriez-vous d'afficher la date dans la page ? Pour cela, nous allons utiliser les fonctions <a href="http://www.php.net/manual/fr/function.setlocale.php">setlocale()</a> et <a href="http://www.php.net/manual/fr/function.strftime.php">strftime()</a> pour afficher la date en français :</p><pre id="r-333486" data-claire-element-id="333486"><code data-claire-semantic="html+php">&lt;?php
setlocale(LC_ALL, 'fr_FR');

echo 'Nous sommes le '. strftime('&lt;strong&gt;%d %B %Y&lt;/strong&gt;, et il est &lt;strong&gt;%Hh%M&lt;/strong&gt;') .'.&lt;br /&gt;'

?&gt;</code></pre><p id="r-333487" data-claire-element-id="333487">Ça y est, nous avons fini ! :magicien: <br/> Pour les retardataires, voici le script entier :</p><pre id="r-333488" data-claire-element-id="333488"><code data-claire-semantic="html+php">&lt;?php
$annee = date('Y');
$noel = mktime(8, 0, 0, 12, 25, $annee);
		
 if ($noel &lt; time())
 $noel = mktime(8, 0, 0, 12, 25, ++$annee);

 $tps_restant = $noel - time(); // $noel sera toujours plus grand que le timestamp actuel, vu que c'est dans le futur. ;)

//============ CONVERSIONS

$i_restantes = $tps_restant / 60;
$H_restantes = $i_restantes / 60;
$d_restants = $H_restantes / 24;


$s_restantes = floor($tps_restant % 60); // Secondes restantes
$i_restantes = floor($i_restantes % 60); // Minutes restantes
$H_restantes = floor($H_restantes % 24); // Heures restantes
$d_restants = floor($d_restants); // Jours restants
//==================

setlocale(LC_ALL, 'fr_FR');

echo 'Nous sommes le '. strftime('&lt;strong&gt;%d %B %Y&lt;/strong&gt;, et il est &lt;strong&gt;%Hh%M&lt;/strong&gt;') .'.&lt;br /&gt;'

   . 'Il reste exactement &lt;strong&gt;'. $d_restants .' jours&lt;/strong&gt;, &lt;strong&gt;'. $H_restantes .' heures&lt;/strong&gt;,'
   . ' &lt;strong&gt;'. $i_restantes .' minutes&lt;/strong&gt; et &lt;strong&gt;'. $s_restantes .'s&lt;/strong&gt; avant d\'ouvrir les cadeaux &lt;:o).';

?&gt;</code></pre><h2 id="r-ameliorations-16" data-claire-element-id="333491">Améliorations</h2><p id="r-333489" data-claire-element-id="333489">Maintenant, il ne vous reste plus qu'à faire un joli design de Noël. :D <br/> Si vous souhaitez en savoir plus, et améliorer votre compte à rebours en voyant le temps restant défiler, rendez-vous dans l'annexe qui suit. ;)</p><p id="r-333490" data-claire-element-id="333490">Vous pouvez aussi rajouter un système de mois : c'est exactement la même démarche à suivre que celle que nous avons vue ensemble. <em>(Et pourquoi pas des années ? Soyons fous !)</em></p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php">Un compte à rebours en PHP</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/bases-du-script">
Bases du script
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/les-conversions">
Les conversions
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/finalisation-ameliorations">
Finalisation &amp; améliorations
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/annexe-allons-plus-loin-avec-javascript">
Annexe : allons plus loin avec JavaScript !
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/les-conversions">
<span class="arrow"></span>
<span class="next">Les conversions</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/annexe-allons-plus-loin-avec-javascript">
<span class="next">Annexe : allons plus loin avec JavaScript !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="AnnexeallonsplusloinavecJavaScript"></a><h2>Annexe : allons plus loin avec JavaScript !</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/finalisation-ameliorations">
<span class="arrow"></span>
<span class="next">Finalisation &amp; améliorations</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-333493" data-claire-element-id="333493">Tiens, vous revoilà ? ^^ <br/> Je savais que vous seriez curieux. Je vais vous apprendre ici comment faire ce compte à rebours avec le langage <strong>JavaScript</strong>. Ce langage s'exécute du côté utilisateur, ce qui va nous permettre de voir le temps défiler. Néanmoins, je déconseille à tous ceux ne s'y connaissant pas de s'aventurer par ici. Car le copier / coller sans rien comprendre, ça n'avance à rien !</p><p id="r-333494" data-claire-element-id="333494"><strong>Compétences requises : </strong><br/><em>connaissance minimale du JavaScript ; fonction Date().</em></p><ul id="r-333499" data-claire-element-id="333499"><li id="r-333496" data-claire-element-id="333496"><p id="r-333495" data-claire-element-id="333495"><a href="http://www.siteduzero.com/tutoriel-3-8158-tout-sur-le-javascript.html">connaissance minimale du JavaScript ;</a></p></li><li id="r-333498" data-claire-element-id="333498"><p id="r-333497" data-claire-element-id="333497"><a href="http://www.siteduzero.com/tutoriel-3-8096-l-objet-date.html">fonction Date().</a></p></li></ul><p id="r-333500" data-claire-element-id="333500">Bon, eh bien allons-y ! :-°</p><p id="r-333501" data-claire-element-id="333501">Tout d'abord, nous allons préparer le « terrain » avec cette portion de code (x)HTML, qu'il faudra placer en haut du script :</p><pre id="r-333502" data-claire-element-id="333502"><code data-claire-semantic="html">&lt;body&gt;
&lt;p id=&quot;affichage&quot;&gt;&lt;/p&gt;
&lt;/body&gt;</code></pre><p id="r-333503" data-claire-element-id="333503">Fait ? Poursuivons !<br/> Nous allons commencer par déclarer notre fonction CompteARebours().</p><pre id="r-333504" data-claire-element-id="333504"><code data-claire-semantic="javascript">function CompteARebours()
{
// Notre script ici
}</code></pre><div id="r-333506" data-claire-element-id="333506" data-claire-semantic="question"><p id="r-333505" data-claire-element-id="333505">Une fonction ? Mais on n'en avait pas besoin en <strong>PHP </strong>! :o</p></div><p id="r-333507" data-claire-element-id="333507">Effectivement, mais nous avons besoin de placer notre script dans une fonction pour ensuite faire appel à une autre fonction nommée « setInterval() », qui rappellera la fonction toutes les x millisecondes, et donc qui actualisera le temps restant.</p><p id="r-333508" data-claire-element-id="333508">Ensuite, vous verrez, rien de compliqué. En fait, nous allons poursuivre les mêmes étapes qu'en PHP : c'est-à-dire que nous allons d'abord déclarer les deux <em>« timestamps »</em> (pour parler PHP :lol: ), et ensuite la condition qui permet le compte à rebours jusqu'à Noël prochain :</p><pre id="r-333509" data-claire-element-id="333509"><code data-claire-semantic="javascript">function CompteARebours()
{
    var date_actuelle = new Date(); // On déclare la date d'aujourd'hui.
    var annee = date_actuelle.getFullYear();

    var noel = new Date(annee, 11, 25, 8, 0, 0); // On déclare la date de Noël.
				
	 if (noel.getTime() &lt; date_actuelle.getTime()) // Si Noël est dépassé, on passe au Noël suivant !
	 noel = new Date(++annee, 11, 25, 8, 0, 0); // On re-déclare Noël pour qu'il ne soit pas passé.
        
        // Reste du script.
}</code></pre><aside id="r-333511" data-claire-element-id="333511" data-claire-semantic="error"><p id="r-333510" data-claire-element-id="333510">Remarquez que dans l'argument du mois, j'ai tapé <strong>« 11 »</strong>. Il faut tout simplement tenir compte du fait que les mois commencent à partir de <strong>0</strong><em>(tiens, comme vous, bizarre hein ? :D )</em>, donc janvier sera égal à 0, et décembre à 11. C'est à l'origine de pas mal d'erreurs, et de casse-tête.</p></aside><p id="r-333512" data-claire-element-id="333512">Maintenant, rien de plus simple, nous allons recopier bêtement la soustraction des deux timestamps ainsi que les conversions. Pour arrondir, nous allons utiliser Math.floor(). Bien sur, sans oublier qu'en JavaScript les timestamps sont exprimés en millisecondes, une division pour obtenir des secondes s'impose donc :</p><pre id="r-333513" data-claire-element-id="333513"><code data-claire-semantic="javascript">var tps_restant = noel.getTime() - date_actuelle.getTime(); // Temps restant en millisecondes

//============ CONVERSIONS

var s_restantes = tps_restant / 1000; // On convertit en secondes
var i_restantes = s_restantes / 60;
var H_restantes = i_restantes / 60;
var d_restants = H_restantes / 24;


    s_restantes = Math.floor(s_restantes % 60); // Secondes restantes
    i_restantes = Math.floor(i_restantes % 60); // Minutes restantes
    H_restantes = Math.floor(H_restantes % 24); // Heures restantes
    d_restants = Math.floor(d_restants); // Jours restants
//==================</code></pre><p id="r-333514" data-claire-element-id="333514">Nous voici presque à la fin : nous allons afficher les résultats. :) Pour afficher le mois en français, nous allons utiliser la bonne vieille méthode du tableau contenant les mois. Ensuite, rien de plus facile que d'afficher le texte avec <strong>document.getElementById(&quot;affichage&quot;).innerHTML</strong> :</p><pre id="r-333515" data-claire-element-id="333515"><code data-claire-semantic="javascript">var mois_fr = new Array('Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre');

var texte = &quot;Nous sommes le &lt;strong&gt;&quot; +date_actuelle.getDate()+ &quot; &quot; +mois_fr[date_actuelle.getMonth()]+ &quot; &quot; +date_actuelle.getFullYear()+ &quot;&lt;/strong&gt;,&quot; +
            &quot; et il est &lt;strong&gt;&quot; +date_actuelle.getHours()+ &quot;h&quot; +date_actuelle.getMinutes()+ &quot;&lt;/strong&gt;.&lt;br /&gt;&quot;;

    texte += &quot;Il reste exactement &lt;strong&gt;&quot; +d_restants+ &quot; jours&lt;/strong&gt;, &lt;strong&gt;&quot; +H_restantes+ &quot; heures&lt;/strong&gt;,&quot; +
         &quot; &lt;strong&gt;&quot; +i_restantes+ &quot; minutes&lt;/strong&gt; et &lt;strong&gt;&quot; +s_restantes+ &quot;s&lt;/strong&gt; avant d'ouvrir les cadeaux &lt;:o).&quot;;


document.getElementById(&quot;affichage&quot;).innerHTML = texte;</code></pre><p id="r-333516" data-claire-element-id="333516">Pour finir, nous allons faire en sorte de rappeler la fonction toutes les secondes, pour qu'elle se mette à jour, avec <strong>setInterval(fonction, millisecondes)</strong> (Sans oublier de fermer la fonction avant !) :</p><pre id="r-333517" data-claire-element-id="333517"><code data-claire-semantic="javascript">}
setInterval(CompteARebours, 1000); // Rappel de la fonction toutes les 1000 millisecondes (toutes les secondes quoi !).</code></pre><p id="r-333518" data-claire-element-id="333518">Et voilà le travail ! Vous devriez obtenir <a href="http://www.perso-spritew.webou.net/script~papanoel_js.html">ce résultat</a>. Encore une fois, il est possible d'améliorer ce script pour qu'il rende mieux. Moi, par exemple, j'ai affiché les dixièmes de secondes après la virgule, ça rend sympa en JavaScript ! En plus, vous connaissez déjà le principe, c'est pas bien dur. :-°</p><aside id="r-333520" data-claire-element-id="333520" data-claire-semantic="information"><p id="r-333519" data-claire-element-id="333519">Notez que si vous souhaitez afficher les dixièmes de secondes, n'oubliez pas de diminuer le délai de la fonction <strong>setInterval </strong>à 100.</p></aside><aside id="r-333522" data-claire-element-id="333522" data-claire-semantic="error"><p id="r-333521" data-claire-element-id="333521">Attention, le script en JavaScript calcule le temps restant à partir de l'heure du visiteur, contrairement au script PHP, qui affiche en fonction du serveur !</p></aside><p id="r-333523" data-claire-element-id="333523">Voilà tout ! Si vous avez des questions, n'hésitez pas à me contacter par <a href="http://www.siteduzero.com/mp-273-148715.html">MP</a>, et me faire des remarques par le biais des commentaires.<br/> Bonne continuation à vous ! ^^</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php">Un compte à rebours en PHP</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/bases-du-script">
Bases du script
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/les-conversions">
Les conversions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/finalisation-ameliorations">
Finalisation &amp; améliorations
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/annexe-allons-plus-loin-avec-javascript">
Annexe : allons plus loin avec JavaScript !
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/un-compte-a-rebours-en-php/finalisation-ameliorations">
<span class="arrow"></span>
<span class="next">Finalisation &amp; améliorations</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/un-compte-a-rebours-en-php.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 01:19:00 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/un-compte-a-rebours-en-php.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:21:02 GMT -->
</html>