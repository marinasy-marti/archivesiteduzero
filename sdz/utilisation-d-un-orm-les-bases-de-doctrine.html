<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/utilisation-d-un-orm-les-bases-de-doctrine.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:56:40 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/utilisation-d-un-orm-les-bases-de-doctrine.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:38:41 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Utilisation d&#039;un ORM : les bases de Doctrine</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Utilisation d&#039;un ORM : les bases de Doctrine</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Utilisationd039unORMlesbasesdeDoctrine">Utilisation d&#039;un ORM : les bases de Doctrine</a><br/><a href="#UnORMDoctrine">Un ORM : Doctrine</a><br/><a href="#Crationdesmodlesetdelatable">Création des modèles et de la table</a><br/><a href="#EffectuerdesrequtesavecDoctrine">Effectuer des requêtes avec Doctrine</a><br/><a href="#Creretutiliserdesfonctionsdercuprationpartirdumodle">Créer et utiliser des fonctions de récupération à partir du modèle</a><br/><a href="#Lierdeuxtables">Lier deux tables</a><br/></div>
<a name="Utilisationd039unORMlesbasesdeDoctrine"></a><h2>Utilisation d&#039;un ORM : les bases de Doctrine</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/un-orm-doctrine">
<span class="next">Un ORM : Doctrine</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-367854" data-claire-element-id="367854">Bienvenue dans ce tutoriel qui a pour vocation de vous apprendre à utiliser l'ORM Doctrine.<br/> Qu'est-ce qu'un ORM ? À quoi sert-il ? Comment l'utilise-t-on ? Tant de questions auxquelles ce tutoriel répond. :)</p>
</div><a name="UnORMDoctrine"></a><h2>Un ORM : Doctrine</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/creation-des-modeles-et-de-la-table">
<span class="next">Création des modèles et de la table</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-definition-d-un-orm" data-claire-element-id="367865">Définition d'un ORM</h2><p id="r-367862" data-claire-element-id="367862">Un ORM est une classe (ou bien plus souvent un ensemble de classes) visant à ce que l'utilisateur puisse manipuler ses tables de données comme si c'étaient des objets.<br/> Voici un petit code pour vous mettre l'eau à la bouche :</p><pre id="r-367863" data-claire-element-id="367863"><code data-claire-semantic="html+php">&lt;?php
$maNews = new News();

// On définit les caractéristiques de la news.
$maNews-&gt;titre = 'La première news du site'; 
$maNews-&gt;auteur = 'christophetd';
$maNews-&gt;contenu = 'Bienvenue sur mon site, j\'espère qu\'il vous plaira !';

// Puis, on sauvegarde le tout dans la base de données.
$maNews-&gt;save();
?&gt;</code></pre><p id="r-367864" data-claire-element-id="367864">Comme vous le voyez, on considère les champs d'une table (ici <strong>news</strong>) comme de simples attributs (ici <strong>titre, auteur</strong> et <strong>contenu</strong>). <br/> Ensuite, c'est l'ORM qui se chargera de la communication avec la base de données, c'est lui qui fait le sale boulot. :p</p><h2 id="r-doctrine" data-claire-element-id="367872">Doctrine</h2><h3 id="r-presentation-76" data-claire-element-id="367867">Présentation</h3><p id="r-367866" data-claire-element-id="367866">Doctrine est, comme vous devez maintenant vous douter, l'un des ORM les plus connus qui existent actuellement.<br/> Il est utilisé dans des <em>frameworks </em>très connus (symfony, Zend Framework), et est aussi simple à prendre en main que puissant.<br/> Dans ce tutoriel, seules les bases seront présentées.</p><h3 id="r-telechargement-18" data-claire-element-id="367871">Téléchargement</h3><p id="r-367868" data-claire-element-id="367868">Pour commencer, rendez-vous sur le site <a href="http://www.doctrine-project.org/">http://www.doctrine-project.org</a>, puis dans la section « <em>Download</em> ».<br/> Prenez la version marquée comme stable, puis lancez le téléchargement en cliquant sur <strong>Doctrine-X.X.X.tgz</strong>.</p><p id="r-367869" data-claire-element-id="367869">Pour décompresser cette archive, il vous faudra un utilitaire comme <strong>7-Zip</strong>.<br/> Une fois cela fait, vous devriez vous retrouver avec un fichier <strong>Doctrine.php</strong>, ainsi qu'un dossier <strong>Doctrine</strong>. <br/> Déplacez les deux dans le dossier <strong>lib</strong> de votre dossier Web (<strong>C:\wamp\www\Tests\doctrine\lib</strong> dans mon cas), puis créez un fichier <strong>index.php</strong> à la racine.</p><p id="r-367870" data-claire-element-id="367870">Ce sera tout pour l'installation, maintenant nous allons commencer les choses sérieuses. :pirate:</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine">Utilisation d&#039;un ORM : les bases de Doctrine</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/un-orm-doctrine">
Un ORM : Doctrine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/creation-des-modeles-et-de-la-table">
Création des modèles et de la table
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/effectuer-des-requetes-avec-doctrine">
Effectuer des requêtes avec Doctrine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/creer-et-utiliser-des-fonctions-de-recuperation-a-partir-du-modele">
Créer et utiliser des fonctions de récupération à partir du modèle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/lier-deux-tables">
Lier deux tables
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/creation-des-modeles-et-de-la-table">
<span class="next">Création des modèles et de la table</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Crationdesmodlesetdelatable"></a><h2>Création des modèles et de la table</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/un-orm-doctrine">
<span class="arrow"></span>
<span class="next">Un ORM : Doctrine</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/effectuer-des-requetes-avec-doctrine">
<span class="next">Effectuer des requêtes avec Doctrine</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-creation-des-modeles" data-claire-element-id="367886">Création des modèles</h2><p id="r-367874" data-claire-element-id="367874">Pour fonctionner, Doctrine a besoin que vous lui indiquiez la structure de votre ou de vos tables.<br/> Pour cela, nous allons créer une classe qui hérite de la classe Doctrine_Record, portant le même nom que la table.<br/> Notez que par convention, ce nom doit être au singulier.</p><pre id="r-367875" data-claire-element-id="367875"><code data-claire-semantic="html+php">&lt;?php
// Nous allons travailler sur un module de news, donc la classe s'appellera News.
class News extends Doctrine_Record
{
}</code></pre><p id="r-367876" data-claire-element-id="367876">Ensuite, nous allons indiquer à Doctrine le nom de la table, ainsi que les différents champs, les types et spécificités que contiendra la table.<br/> Pour ce faire, nous allons nous servir de deux méthodes de Doctrine_Record, héritées par notre classe :</p><ul id="r-367881" data-claire-element-id="367881"><li id="r-367878" data-claire-element-id="367878"><p id="r-367877" data-claire-element-id="367877">setTableName, qui prend en paramètre le nom que nous voulons donner à notre table ;</p></li><li id="r-367880" data-claire-element-id="367880"><p id="r-367879" data-claire-element-id="367879">hasColumn, qui prend trois (ou quatre) paramètres : le nom du champ, son type, sa valeur, et optionnellement, des paramètres supplémentaires (auto-incrémentation, valeur par défaut, clé primaire, etc.).</p></li></ul><p id="r-367882" data-claire-element-id="367882">Voici ce que cela donne dans notre cas :</p><pre id="r-367883" data-claire-element-id="367883"><code data-claire-semantic="html+php">&lt;?php
class News extends Doctrine_Record
{
    public function setTableDefinition()
    {
        // On définit le nom de notre table : « news ».
        $this-&gt;setTableName('news');
		
	//Puis, tous les champs
        $this-&gt;hasColumn('id', 'integer', 8, array('primary' =&gt; true,
						   'autoincrement' =&gt; true));
        $this-&gt;hasColumn('titre', 'string', 100);
	$this-&gt;hasColumn('auteur', 'string', 100);
	$this-&gt;hasColumn('contenu', 'string', 4000);
    }
}
?&gt;</code></pre><p id="r-367884" data-claire-element-id="367884">C'est une chose de faite. :)<br/> Enregistrez cette classe dans le fichier <em>modeles/News.class.php</em>, puis créez <em>modeles/NewsTable.class.php</em>.<br/> Nous allons mettre à l'intérieur, une classe &quot;<em>NewsTable</em>&quot; héritant de Doctrine_Table que nous remplirons plus tard. Elle nous permettra de définir certaines méthodes dont nous nous servirons plus bas. ;)</p><pre id="r-367885" data-claire-element-id="367885"><code data-claire-semantic="html+php">&lt;?php
// On inclut le modèle «News ».
require_once dirname(__FILE__).'/modeles/News.class.php';

class NewsTable extends Doctrine_Table
{

}
?&gt;</code></pre><h2 id="r-creation-de-la-table-1" data-claire-element-id="367896">Création de la table</h2><p id="r-367887" data-claire-element-id="367887">Avant de pouvoir commencer à manipuler réellement Doctrine et notre base de données, il nous va falloir établir une connexion à celle-ci.<br/> Pour commencer, nous allons inclure le fichier <strong>News.class.php</strong> et <strong>Doctrine.php</strong>, la base de Doctrine, puis « enregistrer » sa fonction d'inclusion automatique de classes auprès de PHP :</p><pre id="r-367888" data-claire-element-id="367888"><code data-claire-semantic="html+php">&lt;?php
require_once 'lib/Doctrine.php';
spl_autoload_register(array('Doctrine_Core', 'autoload'));
require_once 'modeles/News.class.php';</code></pre><p id="r-367889" data-claire-element-id="367889">La fonction <a href="http://www.php.net/manual/fr/function.spl-autoload-register.php">spl_autoload_register()</a> dit à PHP : « <em>Si je fais appel à une classe qui n'existe pas, avant de générer une erreur, appelle la méthode <strong>autoload</strong> de la classe <strong>Doctrine</strong> pour qu'elle tente de l'inclure.</em> » ;)</p><p id="r-367890" data-claire-element-id="367890">Bien, maintenant, nous allons appeler la méthode connection de Doctrine, qui prend en paramètre une chaîne formatée selon la syntaxe :</p><p id="r-367891" data-claire-element-id="367891">mysql://utilisateur:motdepasse@serveur/base_de_donnees</p><pre id="r-367892" data-claire-element-id="367892"><code data-claire-semantic="html+php">&lt;?php
// Si l'utilisateur ne possède pas de mot de passe, il faut faire directement « utilisateur@serveur ».
$dsn = 'mysql://root@localhost/developpement';
$connexion = Doctrine_Manager::connection($dsn);</code></pre><p id="r-367893" data-claire-element-id="367893">Pour finir, nous allons pouvoir générer notre table, comme ceci :</p><pre id="r-367894" data-claire-element-id="367894"><code data-claire-semantic="html+php">&lt;?php
try {
	$table = Doctrine_Core::getTable('News'); // On récupère l'objet de la table.
	$connexion-&gt;export-&gt;createTable($table-&gt;getTableName(), 
		                           $table-&gt;getColumns()); // Puis, on la crée.
        echo 'La table a bien été créée';
} catch(Doctrine_Connection_Exception $e) { // Si une exception est lancée.
	echo $e-&gt;getMessage(); // On l'affiche.
}</code></pre><p id="r-367895" data-claire-element-id="367895">Si vous voyez le message de confirmation s'afficher, c'est que tout s'est bien passé, et que la table « News » a bien été créée (vous pouvez aller vérifier via <a href="http://localhost/phpmyadmin">phpmyadmin</a>). :)<br/> Sinon, c'est qu'il y a une erreur quelque part, essayez de comprendre le message, et si vous ne trouvez toujours pas la cause de l'erreur, postez sur le forum. ;)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine">Utilisation d&#039;un ORM : les bases de Doctrine</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/un-orm-doctrine">
Un ORM : Doctrine
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/creation-des-modeles-et-de-la-table">
Création des modèles et de la table
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/effectuer-des-requetes-avec-doctrine">
Effectuer des requêtes avec Doctrine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/creer-et-utiliser-des-fonctions-de-recuperation-a-partir-du-modele">
Créer et utiliser des fonctions de récupération à partir du modèle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/lier-deux-tables">
Lier deux tables
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/un-orm-doctrine">
<span class="arrow"></span>
<span class="next">Un ORM : Doctrine</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/effectuer-des-requetes-avec-doctrine">
<span class="next">Effectuer des requêtes avec Doctrine</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="EffectuerdesrequtesavecDoctrine"></a><h2>Effectuer des requêtes avec Doctrine</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/creation-des-modeles-et-de-la-table">
<span class="arrow"></span>
<span class="next">Création des modèles et de la table</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/creer-et-utiliser-des-fonctions-de-recuperation-a-partir-du-modele">
<span class="next">Créer et utiliser des fonctions de récupération à partir du modèle</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-367898" data-claire-element-id="367898">Bien, maintenant que tout est prêt, on va pouvoir commencer à voir comment s'exécute une requête.<br/> Tout d'abord, videz votre <em>index.php</em>, et ne gardez que ce code :</p><pre id="r-367899" data-claire-element-id="367899"><code data-claire-semantic="html+php">&lt;?php
require_once 'lib/Doctrine.php';
spl_autoload_register(array('Doctrine', 'autoload'));
require_once 'modeles/News.class.php';

// Adaptez cela selon vos besoins bien entendu.
$dsn = 'mysql://root@localhost/developpement';
$connexion = Doctrine_Manager::connection($dsn);</code></pre><p id="r-367900" data-claire-element-id="367900">Pour commencer, on va créer une instance de notre classe News :</p><pre id="r-367901" data-claire-element-id="367901"><code data-claire-semantic="html+php">&lt;?php
$news = new News();</code></pre><p id="r-367902" data-claire-element-id="367902">Vous vous souvenez de ce que je vous ai dit tout à l'heure ? On va pouvoir traiter cet objet comme si c'était notre table ! :D<br/> Essayons donc…</p><pre id="r-367903" data-claire-element-id="367903"><code data-claire-semantic="html+php">&lt;?php
$news-&gt;titre = 'Doctrine';
$news-&gt;auteur = 'Georges Clooney';
$news-&gt;contenu = 'Doctrine, what else ?';</code></pre><div id="r-367905" data-claire-element-id="367905" data-claire-semantic="question"><p id="r-367904" data-claire-element-id="367904">Tu m'as bien eu, ça ne fait rien ce code ! :'(</p></div><p id="r-367906" data-claire-element-id="367906">Eh oui, c'est normal, on n'a pas dit à Doctrine d'appliquer les modifications dans la base de données. Pour cela, il faut utiliser la méthode save. ;)</p><pre id="r-367907" data-claire-element-id="367907"><code data-claire-semantic="html+php">&lt;?php
$news-&gt;save();</code></pre><p id="r-367908" data-claire-element-id="367908">Et là, vos yeux ébahis, rougis par les larmes que vous versez tant vous avez attendu ce jour (c'est bon, j'en fais assez là ? :-° ), vous voyez s'insérer comme par magie dans votre table une ligne correspondant aux valeurs que vous avez indiquées.</p><h2 id="r-recuperer-les-donnees-de-la-table" data-claire-element-id="367938">Récupérer les données de la table</h2><p id="r-367909" data-claire-element-id="367909">J'imagine que vous aimeriez bien voir comment l'on récupère les données d'une table.</p><p id="r-367910" data-claire-element-id="367910">Pour que l'on ait quelques enregistrements sur lesquels travailler, exécutez ce code depuis PhpMyAdmin (onglet <em>SQL</em>) :</p><p id="r-367911" data-claire-element-id="367911"></p><div id="r-367913" data-claire-element-id="367913"><pre id="r-367912" data-claire-element-id="367912"><code data-claire-semantic="sql">INSERT INTO `news` (`id`, `titre`, `auteur`, `contenu`) VALUES (NULL, 'La premiere news du site', 'christophetd', 'Bonjour, 
Bienvenue sur mon site, j''espere que vous l''aimerez ... 
@+'), (NULL, 'Fermeture temporaire du site', 'vyk12', 'Le site fermera ce mercredi 16 decembre de 10h00 a 20h00, le temps d''une grosse maintenance du code (passage a Doctrine =D).');</code></pre></div><p id="r-367914" data-claire-element-id="367914">Pour récupérer tous les enregistrements contenus dans cette table, nous allons manipuler l'objet Doctrine_Query que nous renvoie la méthode <code>Doctrine_Query::create()</code> :</p><pre id="r-367915" data-claire-element-id="367915"><code data-claire-semantic="html+php">&lt;?php
$requete = Doctrine_Query::create();
// Spécifications de la requête</code></pre><p id="r-367916" data-claire-element-id="367916">Pour commencer, nous allons utiliser la méthode from, puis exécuter la requête à l'aide de execute() :</p><pre id="r-367917" data-claire-element-id="367917"><code data-claire-semantic="html+php">&lt;?php
$requete = Doctrine_Query::create() // On crée une requête.
		   -&gt;from('news') // On veut les enregistrements de la table news.
		   -&gt;execute(); // On exécute la requête.
?&gt;</code></pre><div id="r-367919" data-claire-element-id="367919" data-claire-semantic="question"><p id="r-367918" data-claire-element-id="367918">C'est bien beau tout ça, mais si je veux parcourir les résultats, comment je peux faire ? :euh:</p></div><p id="r-367920" data-claire-element-id="367920">En fait, l'objet renvoyé implémente une interface qui fait qu'on peut le parcourir comme si c'était un <em>array</em> ! :)<br/> Nous allons donc faire cela à l'aide d'un <em>foreach</em>, puis accéder à la colonne que nous voulons :</p><pre id="r-367921" data-claire-element-id="367921"><code data-claire-semantic="html+php">&lt;?php
// On parcourt les résultats de la requête.
foreach($requete as $news) {
        // On affiche le titre de chaque news.
	echo $news-&gt;titre.'&lt;br /&gt;';
}</code></pre><aside id="r-367923" data-claire-element-id="367923" data-claire-semantic="information"><p id="r-367922" data-claire-element-id="367922">Pour accéder à une colonne, nous pouvons aussi bien faire <strong>$requete-&gt;colonne</strong> que <strong>$requete['colonne']</strong>. ;)</p></aside><p id="r-367924" data-claire-element-id="367924">Maintenant que vous savez faire une requête basique, vous pouvez y apporter des spécifications.<br/> Pour faire simple, vous pouvez généralement (quasiment souvent) définir le nom d'une clause via la méthode qui porte son nom.<br/> Exemples :</p><ul id="r-367933" data-claire-element-id="367933"><li id="r-367926" data-claire-element-id="367926"><p id="r-367925" data-claire-element-id="367925"><strong>where(condition)</strong> pour la clause <code data-claire-semantic="sql">WHERE condition </code> ;</p></li><li id="r-367928" data-claire-element-id="367928"><p id="r-367927" data-claire-element-id="367927"><strong>orderBy(champ)</strong> pour la clause <code data-claire-semantic="sql">ORDER BY champ </code> ;</p></li><li id="r-367930" data-claire-element-id="367930"><p id="r-367929" data-claire-element-id="367929"><strong>groupBy(champ)</strong> pour la clause <code data-claire-semantic="sql">GROUP BY champ </code> ;</p></li><li id="r-367932" data-claire-element-id="367932"><p id="r-367931" data-claire-element-id="367931"><strong>leftJoin</strong> pour la clause <code data-claire-semantic="sql">LEFT JOIN </code>. Raté. :p C'est une exception que nous verrons dans une autre partie. :)</p></li></ul><p id="r-367934" data-claire-element-id="367934">Pour être sûr que vous avez bien compris le principe, voici une requête qui en regroupe cinq ou six :</p><pre id="r-367935" data-claire-element-id="367935"><code data-claire-semantic="html+php">&lt;?php
$requete = Doctrine_Query::create()
		   -&gt;select('titre, auteur')
		   -&gt;from('news n')
		   -&gt;orderBy('titre')
		   -&gt;groupBy('auteur')
		   -&gt;limit(2);
// N'oubliez pas de rajouter le execute() si vous voulez utiliser la requête par la suite.</code></pre><aside id="r-367937" data-claire-element-id="367937" data-claire-semantic="information"><p id="r-367936" data-claire-element-id="367936">L'ensemble des méthodes de Doctrine utilisées pour construire des requêtes est appelé le DQL.</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine">Utilisation d&#039;un ORM : les bases de Doctrine</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/un-orm-doctrine">
Un ORM : Doctrine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/creation-des-modeles-et-de-la-table">
Création des modèles et de la table
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/effectuer-des-requetes-avec-doctrine">
Effectuer des requêtes avec Doctrine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/creer-et-utiliser-des-fonctions-de-recuperation-a-partir-du-modele">
Créer et utiliser des fonctions de récupération à partir du modèle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/lier-deux-tables">
Lier deux tables
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/creation-des-modeles-et-de-la-table">
<span class="arrow"></span>
<span class="next">Création des modèles et de la table</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/creer-et-utiliser-des-fonctions-de-recuperation-a-partir-du-modele">
<span class="next">Créer et utiliser des fonctions de récupération à partir du modèle</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Creretutiliserdesfonctionsdercuprationpartirdumodle"></a><h2>Créer et utiliser des fonctions de récupération à partir du modèle</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/effectuer-des-requetes-avec-doctrine">
<span class="arrow"></span>
<span class="next">Effectuer des requêtes avec Doctrine</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/lier-deux-tables">
<span class="next">Lier deux tables</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-367940" data-claire-element-id="367940">Vous vous souvenez de la classe <strong>NewsTable</strong> que nous avions créée ? Elle hérite de la classe <strong>Doctrine_Table</strong>.<br/> Il se trouve que cette dernière hérite elle-même de deux méthodes auxquelles nous allons nous intéresser.</p><h3 id="r-findall" data-claire-element-id="367944">findAll()</h3><p id="r-367941" data-claire-element-id="367941">Étant donné que cette méthode appartient à la classe <strong>Doctrine_Record</strong>, nous allons devoir utiliser la méthode de Doctrine_CoregetTable, qui prend en paramètre le nom de notre table, et qui renvoie un objet de type News.<br/> Elle permet de récupérer tous les enregistrements d'une table.<br/> Par exemple, pour récupérer toutes nos <em>news</em>, nous pourrions faire :</p><pre id="r-367942" data-claire-element-id="367942"><code data-claire-semantic="html+php">&lt;?php
$requete = Doctrine_Core::getTable('News')-&gt;findAll();

foreach($requete as $news)
{
	echo $news-&gt;titre.', par &lt;strong&gt;'.$news-&gt;auteur.'&lt;/strong&gt;&lt;br /&gt;';
}</code></pre><p id="r-367943" data-claire-element-id="367943">Vous avouerez que c'est plus pratique de faire comme ça que de devoir passer par un <code>Doctrine_Query::create()...</code>. :)</p><h3 id="r-find" data-claire-element-id="367963">find</h3><p id="r-367945" data-claire-element-id="367945">Cette méthode prend en paramètre l'identifiant de l'enregistrement à récupérer.</p><pre id="r-367946" data-claire-element-id="367946"><code data-claire-semantic="html+php">&lt;?php
// On veut la news n° 1.
$news = Doctrine_Core::getTable('News')-&gt;find(1);

// Notre objet ne contient forcément qu'un seul enregistrement, on peut l'afficher sans avoir à faire de foreach.
echo $news-&gt;titre.', par &lt;strong&gt;'.$news-&gt;auteur.'&lt;/strong&gt;';</code></pre><p id="r-367947" data-claire-element-id="367947">Grâce à cela, on peut facilement éditer une <em>news</em> :</p><pre id="r-367948" data-claire-element-id="367948"><code data-claire-semantic="html+php">&lt;?php
// On veut éditer la news numéro 1.
$requete = Doctrine_Core::getTable('News')-&gt;find(1);

// On modifie ses attributs.
$requete-&gt;titre = 'Mon nouveau titre';

// Puis on sauvegarde.
$requete-&gt;save();</code></pre><h2 id="r-utiliser-des-methodes-de-recuperation-a-partir-du-modele" data-claire-element-id="367962">Utiliser des méthodes de récupération à partir du modèle</h2><p id="r-367949" data-claire-element-id="367949">Vous ne trouvez pas ça lourd de devoir créer une requête longue et fastidieuse à chaque fois ? Que diriez-vous s'il était possible de créer une méthode recupererDernieresNews($nombreDeNews) qui nous permettrait de récupérer les $nombreDeNews dernières <em>news</em> ?<br/> Il se trouve que c'est tout à fait faisable. :D</p><p id="r-367950" data-claire-element-id="367950">Tout d'abord, rendons-nous dans notre classe NewsTable qui est pour l'instant vierge. Nous allons y créer une méthode recupererNews qui prend en paramètre un nombre entier (le nombre de <em>news</em> à récupérer). Les <em>news</em> doivent être ordonnées par ordre d'identifiant décroissant.<br/> Essayez de faire ça pour vous-même, c'est un bon entraînement. :)</p><p id="r-367951" data-claire-element-id="367951">Solution :</p><p id="r-367952" data-claire-element-id="367952"></p><div id="r-367954" data-claire-element-id="367954"><pre id="r-367953" data-claire-element-id="367953"><code data-claire-semantic="html+php">&lt;?php
class NewsTable extends Doctrine_Table
{
	public function recupererNews($nombreNews) {
		$q = Doctrine_Query::create()
				-&gt;from('news')
				-&gt;orderBy('id DESC')
				-&gt;limit((int) $nombreNews);
		return $q;
				
	}
}</code></pre></div><p id="r-367955" data-claire-element-id="367955">Maintenant, dans notre index.php, nous pouvons faire :</p><pre id="r-367956" data-claire-element-id="367956"><code data-claire-semantic="html+php">&lt;?php
$news = Doctrine_Core::getTable('News');
foreach($news-&gt;recupererNews(2)-&gt;execute() as $news) {
	echo $news-&gt;titre.'&lt;br /&gt;';
}</code></pre><p id="r-367957" data-claire-element-id="367957">Détaillons un peu la troisième ligne : <code data-claire-semantic="html+php">&lt;?php $news-&gt;recupererNews(2)-&gt;execute() ?&gt; </code>.<br/> Tout d'abord, on appelle la méthode recupererNews de l'objet $news. Cette méthode renvoyant un objet Doctrine_Query, nous pouvons ensuite exécuter sa méthode execute.</p><div id="r-367959" data-claire-element-id="367959" data-claire-semantic="question"><p id="r-367958" data-claire-element-id="367958">Mais à quoi ça sert de se compliquer la vie à créer une méthode de notre classe NewsTable ? Pourquoi ne pas faire directement la requête dans notre index.php ?</p></div><p id="r-367960" data-claire-element-id="367960">Ça sert surtout si vous utilisez le <a href="http://www.siteduzero.com/tutoriel-3-31452-adopter-un-style-de-programmation-clair-avec-le-modele-mvc.html">modèle MVC</a>.<br/> En effet, le contrôleur, qui inclut les modèles, appelle des fonctions et plein d'autres choses indispensables au fonctionnement d'une application, <strong>ne doit pas contenir de requêtes</strong> : il doit seulement faire appel à des fonctions du modèle qui s'en chargeront.</p><p id="r-367961" data-claire-element-id="367961">Vous voyez où je veux en venir ? Si vous avez pour projet d'utiliser le modèle MVC, il vous faudra obligatoirement user de cette fonctionnalité.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine">Utilisation d&#039;un ORM : les bases de Doctrine</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/un-orm-doctrine">
Un ORM : Doctrine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/creation-des-modeles-et-de-la-table">
Création des modèles et de la table
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/effectuer-des-requetes-avec-doctrine">
Effectuer des requêtes avec Doctrine
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/creer-et-utiliser-des-fonctions-de-recuperation-a-partir-du-modele">
Créer et utiliser des fonctions de récupération à partir du modèle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/lier-deux-tables">
Lier deux tables
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/effectuer-des-requetes-avec-doctrine">
<span class="arrow"></span>
<span class="next">Effectuer des requêtes avec Doctrine</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/lier-deux-tables">
<span class="next">Lier deux tables</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lierdeuxtables"></a><h2>Lier deux tables</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/creer-et-utiliser-des-fonctions-de-recuperation-a-partir-du-modele">
<span class="arrow"></span>
<span class="next">Créer et utiliser des fonctions de récupération à partir du modèle</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-367965" data-claire-element-id="367965">Maintenant que vous avez les bases, nous pouvons nous attaquer à quelque chose un chouïa plus compliqué. :)<br/> Tout d'abord, nous allons utiliser une nouvelle table <strong>commentaires</strong> qui comporte trois champs : <strong>id, id_news</strong> et <strong>contenu</strong>.</p><h2 id="r-configuration-des-modeles" data-claire-element-id="367985">Configuration des modèles</h2><p id="r-367966" data-claire-element-id="367966">Créez un modèle « <em>Commentaire</em> » dans <strong>modeles/</strong> :</p><pre id="r-367967" data-claire-element-id="367967"><code data-claire-semantic="html+php">&lt;?php
// Souvenez-vous, le nom du modèle reste au singulier.
class Commentaire extends Doctrine_Record
{
    public function setTableDefinition()
    {
        $this-&gt;setTableName('commentaires');
		
        $this-&gt;hasColumn('id', 'integer', 8, array('primary' =&gt; true,
						   'autoincrement' =&gt; true));
	$this-&gt;hasColumn('id_news', 'integer', 8);
        $this-&gt;hasColumn('contenu', 'string', 4000);
    }
}</code></pre><p id="r-367968" data-claire-element-id="367968">Jusque-là rien de nouveau.<br/> Maintenant, voici ce que nous voulons faire : lier les tables <strong>news</strong> et <strong>commentaires</strong> afin de pouvoir effectuer une jointure entre les deux.<br/> Pour ce faire, nous aurons besoin d'ajouter une méthode setUp dans nos deux modèles qui contiendront ce code :</p><pre id="r-367969" data-claire-element-id="367969"><code data-claire-semantic="html+php">&lt;?php
    public function setUp() {
    	$this-&gt;[type de la relation](
    		'NomDeLaTableARelier [as Alias]', 
    		array(
    			'local' =&gt; 'clé locale', 
    			'foreign' =&gt; 'clé étrangère'
    		)
    	);
    }</code></pre><p id="r-367970" data-claire-element-id="367970">Détaillons ce code.</p><ul id="r-367984" data-claire-element-id="367984"><li id="r-367977" data-claire-element-id="367977"><p id="r-367971" data-claire-element-id="367971"><strong>Type de la relation</strong> : une relation peut être de deux types.</p><ul id="r-367976" data-claire-element-id="367976"><li id="r-367973" data-claire-element-id="367973"><p id="r-367972" data-claire-element-id="367972"><em>hasOne</em> : cette relation est valable quand l'objet (= la table) ne peut avoir qu'une seule relation avec l'objet avec lequel il est lié.<br/>Exemple : un commentaire ne peut être lié <strong>qu'à une seule</strong><em>news</em>.</p></li><li id="r-367975" data-claire-element-id="367975"><p id="r-367974" data-claire-element-id="367974"><em>hasMany</em> : cette relation est valable quand l'objet peut avoir plusieurs relations avec l'objet auquel il est lié.<br/>Exemple : une <em>news</em> peut être liée <strong>à plusieurs</strong> commentaires.</p></li></ul></li><li id="r-367979" data-claire-element-id="367979"><p id="r-367978" data-claire-element-id="367978"><strong>Alias</strong> : c'est en quelque sorte un deuxième nom que vous pourrez par la suite utiliser (voir rappel plus bas). <strong>Le « <em>as Alias</em> » est facultatif</strong>.</p></li><li id="r-367981" data-claire-element-id="367981"><p id="r-367980" data-claire-element-id="367980"><strong>Clé locale : </strong> c'est le champ appartenant à l'objet qui le relie à celui auquel il est lié. Pour la table <strong>news</strong>, ce sera <strong>id</strong>. Pour la table <strong>commentaires</strong>, ce sera <strong>id_news</strong>.</p></li><li id="r-367983" data-claire-element-id="367983"><p id="r-367982" data-claire-element-id="367982"><strong>Clé étrangère</strong> : c'est le champ n'appartenant pas à l'objet qui le relie à celui auquel il est lié. Pour la table <strong>news</strong>, ce sera <strong>id</strong> (de l'objet commentaires). Pour la table <strong>commentaires</strong>, ce sera <strong>id_news</strong> (de la table news).</p></li></ul><h2 id="r-rappel-4" data-claire-element-id="368000">Rappel</h2><p id="r-367986" data-claire-element-id="367986">Si vous vous êtes endormis pendant quelques secondes en lisant votre cours de SQL, il se peut que vous ayez sauté la notion de création d'alias.<br/> Un alias se crée à la suite du nom de la table, dans la clause <code data-claire-semantic="sql">FROM </code>. C'est un nom généralement plus court que celui de la table (les alias ont été principalement créés pour ça) :</p><pre id="r-367987" data-claire-element-id="367987"><code data-claire-semantic="sql">SELECT titre FROM news n</code></pre><p id="r-367988" data-claire-element-id="367988">On peut ensuite mettre le préfixe <strong>&lt;aliasTable&gt;.champ</strong> dans le <code data-claire-semantic="sql">SELECT </code> pour indiquer que le champ <strong>champ</strong> appartient à la table <strong>table</strong> :</p><pre id="r-367989" data-claire-element-id="367989"><code data-claire-semantic="sql">SELECT n.titre FROM news n</code></pre><p id="r-367990" data-claire-element-id="367990">Maintenant, voici ce que devrait être la méthode setUp pour la table news :</p><pre id="r-367991" data-claire-element-id="367991"><code data-claire-semantic="html+php">&lt;?php
public function setUp() {
    	$this-&gt;hasMany(
    		'Commentaire as commentaires', 
    		array(
    			'local' =&gt; 'id', 
    			'foreign' =&gt; 'id_news'
    		)
    	);
    }</code></pre><h3 id="r-exercice-24" data-claire-element-id="367999">Exercice</h3><p id="r-367992" data-claire-element-id="367992">Codez la fonction setUp de la table commentaires. :)</p><p id="r-367993" data-claire-element-id="367993">Solution :</p><p id="r-367994" data-claire-element-id="367994"></p><div id="r-367998" data-claire-element-id="367998"><pre id="r-367995" data-claire-element-id="367995"><code data-claire-semantic="html+php">&lt;?php
public function setUp() {
    	$this-&gt;hasOne(
    		'News as news', 
    		array(
    			'local' =&gt; 'id_news', 
    			'foreign' =&gt; 'id'
    		)
    	);
    }</code></pre><aside id="r-367997" data-claire-element-id="367997" data-claire-semantic="information"><p id="r-367996" data-claire-element-id="367996">Notez que nous ne sommes pas obligés de créer un alias dans ce cas-ci, car notre jointure ira de la table news vers la table commentaires.</p></aside></div><h2 id="r-utilisation-23" data-claire-element-id="368046">Utilisation</h2><p id="r-368001" data-claire-element-id="368001">Nous allons commencer par créer la table commentaires, ça pourrait nous être utile. :-°</p><pre id="r-368002" data-claire-element-id="368002"><code data-claire-semantic="html+php">&lt;?php
// Les inclusions et la connexion
try {
	$table = Doctrine_Core::getTable('Commentaire'); // On récupère l'objet de la table.
	$doctrine-&gt;export-&gt;createTable($table-&gt;getTableName(), 
		                           $table-&gt;getColumns()); // Puis on la crée.
        echo 'La table a bien été créée';
} catch(Doctrine_Connection_Exception $e) { // Si une exception est lancée.
	echo $e-&gt;getMessage(); // On l'affiche.
}</code></pre><p id="r-368003" data-claire-element-id="368003">Importez quelques commentaires dans votre table depuis phpMyAdmin (j'en profite pour enlever toutes les <em>news</em> et n'en laisser que deux) :</p><p id="r-368004" data-claire-element-id="368004"></p><div id="r-368006" data-claire-element-id="368006"><pre id="r-368005" data-claire-element-id="368005"><code data-claire-semantic="sql">INSERT INTO `commentaires` (`id`, `id_news`, `contenu`) VALUES
(1, 1, 'Cool cette ouverture. :)'),
(2, 2, 'Quel dommage !'),
(3, 1, 'Vraiment bien ca :)');
DELETE FROM news;
INSERT INTO `news` (`id`, `titre`, `auteur`, `contenu`) VALUES
(1, 'Ouverture du site', 'christophetd', 'Le site ouvre. :)'),
(2, 'Fermeture du site', 'vyk12', 'Le site ferme. :(');</code></pre></div><p id="r-368007" data-claire-element-id="368007">Ensuite, nous allons faire une requête pour récupérer le titre de chacune des <em>news</em> et les commentaires qui lui sont associés :</p><pre id="r-368008" data-claire-element-id="368008"><code data-claire-semantic="html+php">&lt;?php
$liste_news = Doctrine_Query::create() // Création de la requête
		-&gt;select('n.titre, c.contenu') // On sélectionne le titre de la news et les commentaires associés.
		-&gt;from('news n')
		-&gt;leftJoin('n.commentaires c') // On joint les deux tables.
		-&gt;execute(); // Et enfin, on exécute la requête.</code></pre><div id="r-368010" data-claire-element-id="368010" data-claire-semantic="question"><p id="r-368009" data-claire-element-id="368009">Pourquoi met-on « <em>n.commentaires c</em> » dans le leftJoin ?</p></div><p id="r-368011" data-claire-element-id="368011">Décomposons :<br/>n.commentairesc</p><ul id="r-368019" data-claire-element-id="368019"><li id="r-368013" data-claire-element-id="368013"><p id="r-368012" data-claire-element-id="368012">n. est l'alias de la table news que nous avons défini dans -&gt;from('news <strong>n</strong>'). On aurait tout aussi bien pu mettre &quot;<em>news</em>&quot;. Ce préfixe sert à indiquer la table <strong>parente</strong>, en l'occurrence la table news ;</p></li><li id="r-368016" data-claire-element-id="368016"><p id="r-368014" data-claire-element-id="368014">commentaires est l'alias que nous avions tout à l'heure donné à la table commentaires, dans le modèle de la classe News :</p><pre id="r-368015" data-claire-element-id="368015"><code data-claire-semantic="html+php">&lt;?php
$this-&gt;hasMany(
    		'Commentaires as commentaires' /* &lt;-- */, 
                ...
               );</code></pre></li><li id="r-368018" data-claire-element-id="368018"><p id="r-368017" data-claire-element-id="368017">c est l'alias que nous donnons dans la requête à la table commentaires. Nous nous en sommes servis dans la clause select : <code data-claire-semantic="html+php">-&gt;select('..., c.contenu') ?&gt; </code> pour sélectionner le champ <strong>contenu</strong> de la table <strong>commentaires</strong>, alias <strong>c</strong>.</p></li></ul><p id="r-368020" data-claire-element-id="368020">Maintenant, parcourons la requête pour afficher le titre des <em>news</em> :</p><pre id="r-368021" data-claire-element-id="368021"><code data-claire-semantic="html+php">&lt;?php
foreach($liste_news as $news) {
	echo $news-&gt;titre.'&lt;br /&gt;';
}</code></pre><div id="r-368023" data-claire-element-id="368023" data-claire-semantic="question"><p id="r-368022" data-claire-element-id="368022">Comment va-t-on parcourir les commentaires ? Il faut faire un echo de $news-&gt;contenu ? :o</p></div><p id="r-368024" data-claire-element-id="368024">Non. :) La liste de tous les commentaires est contenue dans $news-&gt;commentaires !<br/> Nous n'avons donc qu'à parcourir cette liste, puis à afficher les commentaires un à un.</p><pre id="r-368025" data-claire-element-id="368025"><code data-claire-semantic="html+php">&lt;?php
foreach($liste_news as $news) {
	echo $news-&gt;titre.'&lt;br /&gt;';
	echo '&lt;p&gt;Commentaires sur cette news :';
	echo '&lt;ul&gt;';
	foreach($news-&gt;commentaires as $commentaire) {
		echo '&lt;li&gt;'.$commentaire-&gt;contenu.'&lt;/li&gt;';
	}
	echo '&lt;/ul&gt;&lt;/p&gt;&lt;hr /&gt;';
}</code></pre><p id="r-368026" data-claire-element-id="368026">Résultat :</p><p id="r-368027" data-claire-element-id="368027"><cite>Citation : Résultat</cite></p><blockquote id="r-368042" data-claire-element-id="368042"><p id="r-368028" data-claire-element-id="368028">Ouverture du site</p><p id="r-368029" data-claire-element-id="368029">Commentaires sur cette <em>news</em> :</p><ul id="r-368034" data-claire-element-id="368034"><li id="r-368031" data-claire-element-id="368031"><p id="r-368030" data-claire-element-id="368030">Cool cette ouverture. :)</p></li><li id="r-368033" data-claire-element-id="368033"><p id="r-368032" data-claire-element-id="368032">Vraiment bien ça. :)</p></li></ul><p id="r-368035" data-claire-element-id="368035">______________________________________________________________</p><p id="r-368036" data-claire-element-id="368036">Fermeture du site</p><p id="r-368037" data-claire-element-id="368037">Commentaires sur cette <em>news</em> :</p><ul id="r-368040" data-claire-element-id="368040"><li id="r-368039" data-claire-element-id="368039"><p id="r-368038" data-claire-element-id="368038">Quel dommage...</p></li></ul><p id="r-368041" data-claire-element-id="368041">______________________________________________________________</p></blockquote><p id="r-368043" data-claire-element-id="368043">Voilà, ce tutoriel se termine.<br/> Il n'est cependant pas fini, il est possible (et même fort probable) que j'ajoute dans quelque temps une ou deux parties sur d'autres utilisations plus avancées de Doctrine.</p><p id="r-368044" data-claire-element-id="368044">Je vous laisse un lien vers <a href="http://www.doctrine-project.org/documentation/manual/1_2/en/introduction">la documentation officielle de Doctrine</a> (en anglais <em>of course</em>:p ).</p><p id="r-368045" data-claire-element-id="368045">Un grand merci à <a href="http://www.siteduzero.com/membres-294-85974.html">vyk12</a> pour ses corrections, suggestions et le suivi du tutoriel !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine">Utilisation d&#039;un ORM : les bases de Doctrine</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/un-orm-doctrine">
Un ORM : Doctrine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/creation-des-modeles-et-de-la-table">
Création des modèles et de la table
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/effectuer-des-requetes-avec-doctrine">
Effectuer des requêtes avec Doctrine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/creer-et-utiliser-des-fonctions-de-recuperation-a-partir-du-modele">
Créer et utiliser des fonctions de récupération à partir du modèle
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/lier-deux-tables">
Lier deux tables
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/utilisation-d-un-orm-les-bases-de-doctrine/creer-et-utiliser-des-fonctions-de-recuperation-a-partir-du-modele">
<span class="arrow"></span>
<span class="next">Créer et utiliser des fonctions de récupération à partir du modèle</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/utilisation-d-un-orm-les-bases-de-doctrine.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:56:40 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/utilisation-d-un-orm-les-bases-de-doctrine.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:38:42 GMT -->
</html>