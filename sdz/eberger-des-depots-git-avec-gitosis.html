<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/eberger-des-depots-git-avec-gitosis.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:48:32 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/eberger-des-depots-git-avec-gitosis.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:37:04 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Héberger des dépôts Git avec gitosis</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/heberger-des-depots-git-avec-gitosis.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Héberger des dépôts Git avec gitosis</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#HbergerdesdptsGitavecgitosis">Héberger des dépôts Git avec gitosis</a><br/><a href="#Gitqu039est-cedonc">Git, qu&#039;est-ce donc ?!</a><br/><a href="#Installationdegitosis">Installation de gitosis</a><br/><a href="#Configurationdegitosis">Configuration de gitosis</a><br/><a href="#Ajouterunutilisateur">Ajouter un utilisateur</a><br/><a href="#Ajouterundpt">Ajouter un dépôt</a><br/><a href="#Leshooks">Les hooks</a><br/></div>
<a name="HbergerdesdptsGitavecgitosis"></a><h2>Héberger des dépôts Git avec gitosis</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/git-qu-est-ce-donc">
<span class="next">Git, qu&#039;est-ce donc ?!</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-582790" data-claire-element-id="582790">Bonjour !<br/> Dans ce tutoriel, je vous propose d'apprendre à mettre en place un hébergement de dépôts Git sur votre serveur GNU/Linux avec l'outil gitosis.</p><p id="r-582791" data-claire-element-id="582791"><strong>Je souhaite remercier <a href="http://www.siteduzero.com/membres-294-4519.html">bougie</a> pour son aide.</strong></p>
</div><a name="Gitqu039est-cedonc"></a><h2>Git, qu&#039;est-ce donc ?!</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/installation-de-gitosis">
<span class="next">Installation de gitosis</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-582792" data-claire-element-id="582792">Si vous ne connaissez pas Git, on est bien d'accord qu'il ne sert à rien d'héberger des dépôts, non ? :-° <br/> Dans cette partie, je vais vous présenter l'outil lui-même, puis des alternatives.</p><h2 id="r-git-kezako" data-claire-element-id="582802">Git, <em>kézako</em> ?</h2><figure id="r-582794" data-claire-element-id="582795"><img id="r-582793" data-claire-element-id="582793" src="medias/uploads.siteduzero.com_files_201001_202000_201812.gif" alt="Image utilisateur"/></figure><p id="r-582796" data-claire-element-id="582796">Git est un gestionnaire de versions décentralisé, puissant et libre créé par Linus Torvalds, créateur du noyau Linux.<br/> Mais c'est quoi, un gestionnaire de versions ?!<br/> Pour cela, je vous renvoie à Wikipédia qui produira une explication plus claire que la mienne :</p><p id="r-582797" data-claire-element-id="582797"><cite>Citation : Wikipédia (fr)</cite></p><blockquote id="r-582799" data-claire-element-id="582799"><p id="r-582798" data-claire-element-id="582798">Un logiciel de gestion de versions agit sur une arborescence de fichiers afin de conserver toutes les versions des fichiers, ainsi que les différences entre les fichiers.<br/> Ce système permet par exemple de mutualiser un développement. Un groupe de développeurs autour d'un même développement se servira de l'outil pour stocker toute évolution du code source. Le système gère les mises à jour des sources pour chaque développeur, conserve une trace de chaque changement. Ceux-ci sont, en bonne utilisation, chaque fois accompagnés d'un commentaire. Le système travaille par fusion de copies locale et distante, et non par écrasement de la version distante par la version locale. Ainsi, deux développeurs travaillant de concert sur une même source, les changements du premier à soumettre son travail ne seront pas perdus lorsque le second, qui a donc travaillé sur une version non encore modifiée par le premier, renvoie ses modifications.</p></blockquote><p id="r-582800" data-claire-element-id="582800">Pour résumer, c'est un système permettant de travailler par versions d'un même projet, et ainsi conserver toutes les modifications apportées aux fichiers entre les versions.<br/> C'est vraiment pratique pour travailler à plusieurs.</p><p id="r-582801" data-claire-element-id="582801">Mais de ces gestionnaires de versions, il en existe plusieurs.<br/> Je vais donc vous présenter quelques alternatives célèbres.</p><h2 id="r-git-seul-au-monde-non" data-claire-element-id="582822">Git, seul au monde ? Non !</h2><h3 id="r-subversion" data-claire-element-id="582816">Subversion</h3><figure id="r-582804" data-claire-element-id="582805"><img id="r-582803" data-claire-element-id="582803" src="medias/uploads.siteduzero.com_files_201001_202000_201809.png" alt="Image utilisateur"/></figure><p id="r-582806" data-claire-element-id="582806">Une des alternatives parmi les plus connues est bien sûr Subversion (abrégé en SVN).<br/> C'est aussi un gestionnaire de dépôts, mais lui est centralisé.<br/> Voici une liste de liens où vous pourrez apprendre à utiliser cet outil :</p><ul id="r-582815" data-claire-element-id="582815"><li id="r-582808" data-claire-element-id="582808"><p id="r-582807" data-claire-element-id="582807">(Site du Zéro) <a href="http://www.siteduzero.com/tutoriel-3-2696-gerez-vos-projets-a-l-aide-du-gestionnaire-de-versions-subversion.html">Gérez vos projets à l'aide du gestionnaire de versions Subversion</a>, par <a href="http://www.siteduzero.com/membres-294-28170.html">Dalshim</a> ;</p></li><li id="r-582810" data-claire-element-id="582810"><p id="r-582809" data-claire-element-id="582809">(Site du Zéro) <a href="http://www.siteduzero.com/tutoriel-3-33632-utilisation-de-subversion.html">Utilisation de Subversion</a>, par <a href="http://www.siteduzero.com/membres-294-1405.html">apognu</a> ;</p></li><li id="r-582812" data-claire-element-id="582812"><p id="r-582811" data-claire-element-id="582811">(Site du Zéro) <a href="http://www.siteduzero.com/tutoriel-3-58147-creer-un-serveur-subversion.html">Créer un serveur Subversion</a>, par <a href="http://www.siteduzero.com/membres-294-2300.html">L·P</a> ;</p></li><li id="r-582814" data-claire-element-id="582814"><p id="r-582813" data-claire-element-id="582813">(Wikipédia fr) <a href="http://fr.wikipedia.org/wiki/Subversion_(logiciel)">Subversion (logiciel)</a>.</p></li></ul><h3 id="r-mercurial" data-claire-element-id="582821">Mercurial</h3><figure id="r-582818" data-claire-element-id="582819"><img id="r-582817" data-claire-element-id="582817" src="medias/uploads.siteduzero.com_files_201001_202000_201811.png" alt="Image utilisateur"/></figure><p id="r-582820" data-claire-element-id="582820">Un autre gestionnaire, bien que moins connu, puissant, décentralisé, et ressemblant fortement à Git sur la syntaxe des commandes (il a d'ailleurs été publié pour la première fois quelques jours après le début du développement de Git), voilà ce qu'est Mercurial.<br/> Pour apprendre, je n'ai pas pu trouver beaucoup de liens comme pour SVN, mais il reste toujours Wikipédia pour avoir une liste des commandes : <a href="http://fr.wikipedia.org/wiki/Mercurial">Mercurial</a> sur Wikipédia (fr).</p><h2 id="r-petit-mot-avant-de-commencer" data-claire-element-id="582824">Petit mot avant de commencer</h2><p id="r-582823" data-claire-element-id="582823">Ce tutoriel ne portant pas sur Git mais sur l'hébergement de dépôts, je ne peux pas tout expliquer sur ce dernier.<br/> Pour suivre ce tutoriel il est donc nécessaire de savoir récupérer un dépôt et le <em>commiter/pusher</em>.<br/> Si vous ne savez pas faire cela, j'ai justement un petit lien pour vous : le <em>Git Community Book</em>, traduit de l'anglais (<a href="http://book.git-scm.com/">ici</a>) au français : <a href="http://alexgirard.com/git-book/">http://alexgirard.com/git-book/</a>.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis">Héberger des dépôts Git avec gitosis</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/git-qu-est-ce-donc">
Git, qu&#039;est-ce donc ?!
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/installation-de-gitosis">
Installation de gitosis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/configuration-de-gitosis">
Configuration de gitosis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-utilisateur">
Ajouter un utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-depot">
Ajouter un dépôt
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/les-hooks-1">
Les hooks
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/installation-de-gitosis">
<span class="next">Installation de gitosis</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Installationdegitosis"></a><h2>Installation de gitosis</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/git-qu-est-ce-donc">
<span class="arrow"></span>
<span class="next">Git, qu&#039;est-ce donc ?!</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/configuration-de-gitosis">
<span class="next">Configuration de gitosis</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-582826" data-claire-element-id="582826">Vous êtes décidés à faire votre dépôt personnel ? Alors allons-y, installons gitosis !</p><p id="r-582827" data-claire-element-id="582827">Pour les utilisateurs d'ArchLinux, il suffira d'installer le paquet <strong>aur/gitosis-git</strong> avec yaourt, qui fait automatiquement ce qui va suivre. Vous pouvez donc passer directement à la partie suivante.</p><p id="r-582828" data-claire-element-id="582828">Pour les utilisateurs de distributions Linux &quot;Debian-like&quot; avec aptitude, le paquet gitosis est également dans les dépôts. Il suffit de l'installer et passer à la partie suivante.</p><p id="r-582829" data-claire-element-id="582829">Pour commencer, il va falloir récupérer les sources dans le dépôt Git de gitosis (comment ça, c'est un comble ? :D ) :</p><pre id="r-582830" data-claire-element-id="582830"><code data-claire-semantic="console">git clone git://eagain.net/gitosis.git</code></pre><p id="r-582831" data-claire-element-id="582831">Quand vous aurez la copie du dépôt en local (c'est-à-dire que la commande a fini son exécution sans afficher d'erreur), vous pouvez utiliser le script python d'installation de cette façon :</p><pre id="r-582832" data-claire-element-id="582832"><code data-claire-semantic="console">cd gitosis
python setup.py install</code></pre><p id="r-582833" data-claire-element-id="582833">En cas d'erreur, veuillez vous reporter à la FAQ en partie annexe.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis">Héberger des dépôts Git avec gitosis</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/git-qu-est-ce-donc">
Git, qu&#039;est-ce donc ?!
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/installation-de-gitosis">
Installation de gitosis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/configuration-de-gitosis">
Configuration de gitosis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-utilisateur">
Ajouter un utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-depot">
Ajouter un dépôt
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/les-hooks-1">
Les hooks
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/git-qu-est-ce-donc">
<span class="arrow"></span>
<span class="next">Git, qu&#039;est-ce donc ?!</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/configuration-de-gitosis">
<span class="next">Configuration de gitosis</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Configurationdegitosis"></a><h2>Configuration de gitosis</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/installation-de-gitosis">
<span class="arrow"></span>
<span class="next">Installation de gitosis</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-utilisateur">
<span class="next">Ajouter un utilisateur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-582835" data-claire-element-id="582835">Tout d'abord, il va falloir créer un utilisateur nommé « git ».<br/> Il aura le plein pouvoir sur les dépôts, les ayant dans son répertoire <em>home</em>.<br/> Pour ce faire, nous allons utiliser la commande <em>useradd</em> :</p><pre id="r-582836" data-claire-element-id="582836"><code data-claire-semantic="console"># useradd -G git -d /home/git -s /bin/bash -m git</code></pre><p id="r-582837" data-claire-element-id="582837">Pour pouvoir communiquer avec le serveur il faut que vous ayez une clé publique SSH. Il vous faut donc en générer une sur votre ordinateur local (pas sur le serveur) :</p><pre id="r-582838" data-claire-element-id="582838"><code data-claire-semantic="console">ssh-keygen -t rsa</code></pre><p id="r-582839" data-claire-element-id="582839">Cette commande va créer une paire de clé dans votre répertoire .ssh lui-même dans votre répertoire personnel ($HOME). La clé privée est contenue dans le fichier id_rsa par défaut et la clé publique dans le fichier id_rsa.pub. Copiez la clé publique (attention à ne pas mettre la clé privée) dans un fichier temporaire tel que « /tmp/cle.pub » cette fois-ci sur le serveur.</p><p id="r-582840" data-claire-element-id="582840">Nous allons ensuite, en tant que root, exécuter ces commandes :</p><pre id="r-582841" data-claire-element-id="582841"><code data-claire-semantic="console">sudo -H -u git gitosis-init &lt; /tmp/cle.pub</code></pre><p id="r-582842" data-claire-element-id="582842">La commande sudo, comme vous le savez, nous permet d'exécuter une action sous une autre identité, qui est par défaut root.<br/> Dans ce cas, nous allons exécuter en tant que git, mais en plus, nous allons exécuter dans le <em>home</em> de ce dernier.<br/> La commande gitosis-init va initialiser le dépôt en ajoutant l'utilisateur de la clé publique comme <em>commiter</em> du dépôt contenant la configuration.</p><p id="r-582843" data-claire-element-id="582843">En cas de succès, vous devriez obtenir un résultat comme celui-ci :</p><pre id="r-582844" data-claire-element-id="582844"><code data-claire-semantic="console">Initialized empty Git repository in ./
Initialized empty Git repository in ./</code></pre><p id="r-582845" data-claire-element-id="582845">(Oui, deux fois !)</p><p id="r-582846" data-claire-element-id="582846">Et si vous affichez le contenu du <em>home</em> de git, comme par magie, il y a tout plein de fichiers ! :D</p><p id="r-582847" data-claire-element-id="582847">Maintenant, nous allons changer les droits d'un fichier.<br/> J'ai en effet quelquefois remarqué qu'il ne se modifiait pas à cause de problèmes de droits.<br/> Pour ce faire, nous allons exécuter cette commande :</p><pre id="r-582848" data-claire-element-id="582848"><code data-claire-semantic="console">sudo chmod 755 /home/git/repositories/gitosis-admin.git/hooks/post-update</code></pre><p id="r-582849" data-claire-element-id="582849">Ceci étant fait, j'ai l'honneur de vous annoncer que votre serveur Git est prêt à l'emploi, et qu'il ne reste plus qu'à faire vos dépôts et ajouter vos utilisateurs ! :D</p><p id="r-582850" data-claire-element-id="582850">Désormais, toute la configuration se fera sur votre ordinateur, via le dépôt que nous allons importer tout de suite :</p><pre id="r-582851" data-claire-element-id="582851"><code data-claire-semantic="console">git clone git@[adresse du serveur]:gitosis-admin.git
cd gitosis-admin.git</code></pre><aside id="r-582853" data-claire-element-id="582853" data-claire-semantic="warning"><p id="r-582852" data-claire-element-id="582852">Dans certains cas la commande &quot;git clone&quot; ne fonctionne pas. Il faut donc mettre le chemin complet de gitosis-admin.git soit /home/git/repositories/gitosis-admin.git</p></aside><p id="r-582854" data-claire-element-id="582854">Si nous affichons le contenu du dépôt, nous verrons un fichier et un répertoire :</p><ul id="r-582859" data-claire-element-id="582859"><li id="r-582856" data-claire-element-id="582856"><p id="r-582855" data-claire-element-id="582855"><strong>gitosis.conf</strong> : il contient tout ce qui concerne les droits des utilisateurs (les dépôts auxquels ils peuvent accéder) ;</p></li><li id="r-582858" data-claire-element-id="582858"><p id="r-582857" data-claire-element-id="582857"><strong>keydir/</strong> : répertoire comptant toutes les clés publiques de vos utilisateurs. La partie précédant l'extension dans le nom du fichier sera le nom d'utilisateur utilisé dans le fichier de configuration.</p></li></ul>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis">Héberger des dépôts Git avec gitosis</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/git-qu-est-ce-donc">
Git, qu&#039;est-ce donc ?!
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/installation-de-gitosis">
Installation de gitosis
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/configuration-de-gitosis">
Configuration de gitosis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-utilisateur">
Ajouter un utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-depot">
Ajouter un dépôt
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/les-hooks-1">
Les hooks
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/installation-de-gitosis">
<span class="arrow"></span>
<span class="next">Installation de gitosis</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-utilisateur">
<span class="next">Ajouter un utilisateur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Ajouterunutilisateur"></a><h2>Ajouter un utilisateur</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/configuration-de-gitosis">
<span class="arrow"></span>
<span class="next">Configuration de gitosis</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-depot">
<span class="next">Ajouter un dépôt</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-582861" data-claire-element-id="582861">Pour créer un utilisateur, il vous faut acquérir la clé publique SSH du nouvel utilisateur, que vous enregistrerez dans le dossier keydir/ du dépôt gitosis-admin, sous le nom de « [pseudo].pub ».<br/> Ensuite, vous pourrez modifier le fichier de configuration pour ajouter le membre dans un dépôt, en ajoutant la partie [pseudo] dans une des lignes « members ».</p><p id="r-582862" data-claire-element-id="582862">Il vous faudra ensuite faire un <em>commit</em> du dépôt pour que vos modifications soient prises en compte.<br/> Il faudra faire un <strong>git add</strong> des fichiers ajoutés/modifiés, puis commiter :</p><pre id="r-582863" data-claire-element-id="582863"><code data-claire-semantic="console">git commit -a -m &quot;Ajout de l'utilisateur [foo]&quot;
git push</code></pre>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis">Héberger des dépôts Git avec gitosis</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/git-qu-est-ce-donc">
Git, qu&#039;est-ce donc ?!
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/installation-de-gitosis">
Installation de gitosis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/configuration-de-gitosis">
Configuration de gitosis
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-utilisateur">
Ajouter un utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-depot">
Ajouter un dépôt
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/les-hooks-1">
Les hooks
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/configuration-de-gitosis">
<span class="arrow"></span>
<span class="next">Configuration de gitosis</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-depot">
<span class="next">Ajouter un dépôt</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Ajouterundpt"></a><h2>Ajouter un dépôt</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-utilisateur">
<span class="arrow"></span>
<span class="next">Ajouter un utilisateur</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/les-hooks-1">
<span class="next">Les hooks</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-582865" data-claire-element-id="582865">Maintenant, la chose la plus utile de tout ce que l'on a fait dans le tutoriel : ajouter un dépôt ! :-° <br/> Pour ce faire, il faut modifier le fichier de configuration en ajoutant un bloc ressemblant à celui-là :</p><pre id="r-582866" data-claire-element-id="582866"><code data-claire-semantic="console">[repo NOM_PROJET]
description = DESCRIPTION
owner = NOM</code></pre><p id="r-582867" data-claire-element-id="582867">NOM_PROJET est le nom du projet que vous voulez créer.<br/> DESCRIPTION est une courte description du projet<br/> NOM est le nom du propriétaire de dépôt.</p><p id="r-582868" data-claire-element-id="582868">Pour ajouter des utilisateurs dans la modification du dépôt, il faut soit créer un nouveau groupe, soit ajouter le dépôt au droit d'écriture d'un groupe déjà existant.</p><h3 id="r-creer-un-groupe-d-utilisateurs" data-claire-element-id="582878">Créer un groupe d'utilisateurs</h3><p id="r-582869" data-claire-element-id="582869">La syntaxe est simple :</p><pre id="r-582870" data-claire-element-id="582870"><code data-claire-semantic="console">[group NOM_GROUPE]
writable=
members=</code></pre><p id="r-582871" data-claire-element-id="582871"><em>NOM_GROUPE</em> est le nom du groupe.<br/><em>writable</em> est la liste des dépôts que peuvent modifier les membres du groupe.<br/><em>members</em> est la liste des membres du groupe.</p><p id="r-582872" data-claire-element-id="582872">Pour ajouter un dépôt/membre dans un groupe, il suffit d'ajouter son nom à la liste en séparant chaque dépôt/membre par un espace.</p><p id="r-582873" data-claire-element-id="582873">Une fois les groupes et dépôts mis à jour, il suffit de faire un push pour envoyer les modifications. Seulement pour les nouveaux dépôts, ils n'ont pas été créés sur le serveur. Il est donc nécessaire de l'initialiser. Pour cela, il faut créer un nouveau projet en local et l'envoyer sur le serveur avec un push une fois de plus.</p><p id="r-582874" data-claire-element-id="582874">Voici la marche à suivre :</p><pre id="r-582875" data-claire-element-id="582875"><code data-claire-semantic="console">mkdir NOM_PROJET
cd NOM_PROJET
git init
git remote add origin git@NOM_SERVEUR:NOM_PROJET.git
git push origin master:refs/heads/master</code></pre><p id="r-582876" data-claire-element-id="582876">NOM_PROJET est le nom du projet que vous avez créé dans vos fichiers de configuration auparavant.<br/> NOM_SERVEUR est le FQDN (Fully Qualified Domain Name) ou l'ip de votre serveur.</p><p id="r-582877" data-claire-element-id="582877">Vous pouvez bien sûr créer des fichiers avant de faire le push. Après cela, le dépôt est réellement créé sur le serveur.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis">Héberger des dépôts Git avec gitosis</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/git-qu-est-ce-donc">
Git, qu&#039;est-ce donc ?!
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/installation-de-gitosis">
Installation de gitosis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/configuration-de-gitosis">
Configuration de gitosis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-utilisateur">
Ajouter un utilisateur
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-depot">
Ajouter un dépôt
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/les-hooks-1">
Les hooks
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-utilisateur">
<span class="arrow"></span>
<span class="next">Ajouter un utilisateur</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/les-hooks-1">
<span class="next">Les hooks</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Leshooks"></a><h2>Les hooks</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-depot">
<span class="arrow"></span>
<span class="next">Ajouter un dépôt</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-582880" data-claire-element-id="582880">Dans cette partie, je vais vous parler de choses plus poussées, que l'on n'utilise pas à chaque fois que l'on fait un dépôt Git avec gitosis, il s'agit des <em>hooks</em>.<br/> Mais qu'est-ce donc, cet animal ? Nous allons commencer par cela avant de voir comment on peut les mettre en place. :) <br/> Il est nécessaire de savoir faire des scripts shell pour suivre cette partie.</p><h2 id="r-un-quoi" data-claire-element-id="582903">Un... quoi ?</h2><p id="r-582881" data-claire-element-id="582881">Un hook, qu'est-ce donc en informatique ?<br/> Eh bien, ça permet à l'utilisateur d'un logiciel d'en personnaliser le fonctionnement en lui faisant exécuter des actions supplémentaires à des moments déterminés.<br/> Gitosis prévoit justement une panoplie complète de hooks pour réaliser plusieurs choses assez sympathiques dont je donnerai quelques exemples dans la partie pratique. :) <br/> Par défaut, avec notre gitosis adoré, les fichiers des hooks sont remplis d'exemples et sont désactivés.</p><p id="r-582882" data-claire-element-id="582882">Avec gitosis, les hooks se trouvent dans le home de l'utilisateur git.<br/> Par exemple, pour votre dépôt &quot;repo&quot;, les hooks seront dans <strong>/home/git/repositories/repo.git/hooks/</strong> (les parties pouvant varier selon la façon dont vous avez configuré gitosis sont en rouge).<br/> Avant de faire un hook, nous allons voir les deux hooks souvent utilisés dans la pratique, ainsi que leur fonction :</p><table id="r-582900" data-claire-element-id="582900"><thead id="r-582888" data-claire-element-id="582888"><tr id="r-582887" data-claire-element-id="582887"><th id="r-582884" data-claire-element-id="582884"><p id="r-582883" data-claire-element-id="582883">Nom</p></th><th id="r-582886" data-claire-element-id="582886"><p id="r-582885" data-claire-element-id="582885">Fonction</p></th></tr></thead><tbody id="r-582899" data-claire-element-id="582899"><tr id="r-582893" data-claire-element-id="582893"><td id="r-582890" data-claire-element-id="582890"><p id="r-582889" data-claire-element-id="582889">post-commit</p></td><td id="r-582892" data-claire-element-id="582892"><p id="r-582891" data-claire-element-id="582891">Il est appelé quand un commit a été effectué.</p></td></tr><tr id="r-582898" data-claire-element-id="582898"><td id="r-582895" data-claire-element-id="582895"><p id="r-582894" data-claire-element-id="582894">pre-commit</p></td><td id="r-582897" data-claire-element-id="582897"><p id="r-582896" data-claire-element-id="582896">Appelé avant un commit, il a le pouvoir de l'arrêter si le script retourne une valeur différente de zéro.</p></td></tr></tbody></table><aside id="r-582902" data-claire-element-id="582902" data-claire-semantic="warning"><p id="r-582901" data-claire-element-id="582901">Ce n'est pas une liste exhaustive, il en existe d'autres.<br/> Pour les connaître, je vous propose d'afficher la liste des fichiers de votre répertoire contenant les hooks. Chaque fichier contient un commentaire décrivant les paramètres, quand il est appelé, ainsi que d'autres détails du genre.</p></aside><h2 id="r-pechons-le-poisson" data-claire-element-id="582916">Péchons le poisson !</h2><p id="r-582904" data-claire-element-id="582904">Pour explication du titre, en anglais, hook signifie crochet ou hameçon. :-°</p><p id="r-582905" data-claire-element-id="582905">Bon : maintenant, on sait ce qu'est un hook, on sait qu'il y en a avec gitosis.<br/> Hmm, ma foi, je pense qu'on est prêt à commencer ! :D <br/> J'ai pensé que la meilleure façon d'apprendre était de générer un exemple codé au fur et à mesure, ainsi qu'un petit exercice.<br/> Pour mon exemple, je travaillerai sur le fichier &quot;post-commit&quot; (tandis que l'exercice portera sur l'autre fichier dont je vous ai parlé, &quot;pre-commit&quot;). :)</p><h3 id="r-exemple-174" data-claire-element-id="582915">Exemple</h3><p id="r-582906" data-claire-element-id="582906">Comme exemple, je vous propose tout simplement un dépôt qui, quand il reçoit une nouvelle révision, fait automatiquement une mise à jour sur un site quelconque.<br/> Inconvénient : il faut que le site soit hébergé sur le même serveur.<br/> Avantage : coder devient plus confortable.</p><p id="r-582907" data-claire-element-id="582907">Comment faire ?<br/> Tout d'abord, on va aller dans le répertoire qui va accueillir votre site (public_html, par exemple ;) ) et prendre le dépôt :</p><pre id="r-582908" data-claire-element-id="582908"><code data-claire-semantic="console">git init
git remote add origin <a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="65020c11255457524b554b554b54">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>:repo.git
git push origin master:refs/heads/master</code></pre><p id="r-582909" data-claire-element-id="582909">Il faut ensuite activer le hook en renommant le fichier <strong>post-commit.sample</strong> en <strong>post-commit</strong> et lui donner les droits d'exécution (<code data-claire-semantic="console">chmod +x post-commit</code>) !<br/> Voilà : quand quelqu'un fera un commit, le script sera exécuté, et la moitié du travail est effectuée ! :D</p><p id="r-582910" data-claire-element-id="582910">Pour finir notre exemple, il vous suffit de réaliser le contenu du fichier :</p><pre id="r-582911" data-claire-element-id="582911"><code data-claire-semantic="bash">#!/bin/bash

chemin=&quot;/chemin/de/notre/repo.git/&quot; # Chez moi, /home/git/public_html/
avant=`pwd`
cd &quot;$chemin&quot;
git pull
cd &quot;$avant&quot;</code></pre><p id="r-582912" data-claire-element-id="582912"><em>Attention aux problèmes de droits !</em></p><p id="r-582913" data-claire-element-id="582913">Et voilà, vous avez un dépôt qui s'<em>auto-update</em> à chaque commit, donc un site qui se modifie par Git ! :)</p><p id="r-582914" data-claire-element-id="582914">Et voilà, c'est fini ! Bon <em>gitage</em> ! ( :-° )<br/> toki pona</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis">Héberger des dépôts Git avec gitosis</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/git-qu-est-ce-donc">
Git, qu&#039;est-ce donc ?!
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/installation-de-gitosis">
Installation de gitosis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/configuration-de-gitosis">
Configuration de gitosis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-utilisateur">
Ajouter un utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-depot">
Ajouter un dépôt
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/les-hooks-1">
Les hooks
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/heberger-des-depots-git-avec-gitosis/ajouter-un-depot">
<span class="arrow"></span>
<span class="next">Ajouter un dépôt</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/eberger-des-depots-git-avec-gitosis.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:48:36 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/eberger-des-depots-git-avec-gitosis.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:37:04 GMT -->
</html>