<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/creer-un-espace-membre-pour-son-site.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 08:29:34 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/creer-un-espace-membre-pour-son-site.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:31:33 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Créer un espace membre pour son site</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/creer-un-espace-membre-pour-son-site.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Créer un espace membre pour son site</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Crerunespacemembrepoursonsite">Créer un espace membre pour son site</a><br/><a href="#Introduction">Introduction</a><br/><a href="#UnespacemembreKkc">Un espace membre ? Kékécé ?</a><br/><a href="#Prsentationdelapremirepartie">Présentation de la première partie</a><br/><a href="#Prsentationdelasecondepartie">Présentation de la seconde partie</a><br/><a href="#LatableSQL">La table SQL</a><br/><a href="#Lesbasesdusystme">Les bases du système</a><br/><a href="#Despagesbienutiles">Des pages bien utiles</a><br/><a href="#D039autrespagesinclure">D&#039;autres pages à inclure</a><br/><a href="#Inscription">Inscription</a><br/><a href="#Avantdecommencer">Avant de commencer</a><br/><a href="#Leformulaire">Le formulaire</a><br/><a href="#Charteetsystmeanti-robot">Charte et système anti-robot</a><br/><a href="#Lavalidationetlesmails">La validation et les mails</a><br/><a href="#Validationduformulaire">Validation du formulaire</a><br/><a href="#Unpetitmail">Un petit mail ?</a><br/><a href="#TPconnexionetdconnexion">TP : connexion et déconnexion</a><br/><a href="#Prrequisetexplications">Prérequis et explications</a><br/><a href="#Correction">Correction</a><br/><a href="#Etaprs">Et après ?</a><br/><a href="#TPsiteetprofils">TP : site et profils</a><br/><a href="#Exercice1-Crationdestatistiques">Exercice 1 - Création de statistiques</a><br/><a href="#Correctiondel039exercice1">Correction de l&#039;exercice 1</a><br/><a href="#Exercice2-Crationdelapageuser.php">Exercice 2 - Création de la page user.php</a><br/><a href="#Correctiondel039exercice2">Correction de l&#039;exercice 2</a><br/></div>
<a name="Crerunespacemembrepoursonsite"></a><h2>Créer un espace membre pour son site</h2><div class="content" role="article">
<p id="r-122441" data-claire-element-id="122441">Bonjour amis Zér0s !! :)</p><p id="r-122442" data-claire-element-id="122442">Dans ce big-tuto, nous allons créer ensemble un système d'espace pour les membres de votre site : grâce à cela, vous pourrez créer une communauté et gérer au mieux votre site. :)</p><p id="r-122443" data-claire-element-id="122443">Au niveau des pré-requis, avoir suivi l'intégralité du cours PHP/MySQL ainsi que le cours XHTML/CSS de M@teo21 suffira amplement (et par la même occasion, c'est une base nécessaire). ;)</p><p id="r-122444" data-claire-element-id="122444">Cependant, nous utiliserons dans la partie II du JavaScript et les objets XHR (<code>XMLHttpRequest</code>), et la programmation orientée objets en partie III : si vous les connaissez, cela sera grandement utile, mais nous y reviendrons en temps voulu. :)</p><p id="r-122445" data-claire-element-id="122445">Vous êtes prêts ? :p</p><p id="r-122446" data-claire-element-id="122446"><em>Renseignements</em></p><ul id="r-122463" data-claire-element-id="122463"><li id="r-122448" data-claire-element-id="122448"><p id="r-122447" data-claire-element-id="122447">28/08/2008 : décision de créer ce tutoriel, les premières lignes en sont tapées le soir même.</p></li><li id="r-122450" data-claire-element-id="122450"><p id="r-122449" data-claire-element-id="122449">22/09/2008 : le tutoriel en est à la fin de son quatrième chapitre et proposé à la validation.</p></li><li id="r-122452" data-claire-element-id="122452"><p id="r-122451" data-claire-element-id="122451">05/10/2008 : le tutoriel est refusé à la validation pour des problèmes au niveau de la page information.php ainsi que de la taille du chapitre IV, relecture et mise à niveau exigée.</p></li><li id="r-122454" data-claire-element-id="122454"><p id="r-122453" data-claire-element-id="122453">22/10/2008 : le tutoriel est renvoyé à la validation après d'importantes modifications.</p></li><li id="r-122456" data-claire-element-id="122456"><p id="r-122455" data-claire-element-id="122455">29/10/2008 : le tutoriel est accepté, mais il contient quelques fautes qui seront corrigées dans la prochaine édition, et deux-trois points sont à modifier.</p></li><li id="r-122458" data-claire-element-id="122458"><p id="r-122457" data-claire-element-id="122457">29/10/2008 : correction de nombreuses fautes, modification de certains points, et coupure en deux du chapitre d'inscription. Rajout d'une sous-partie sur la fonction <code data-claire-semantic="html+php">mail() </code>.</p></li><li id="r-122460" data-claire-element-id="122460"><p id="r-122459" data-claire-element-id="122459">20/11/2008 : après la zCorrection de <a href="http://www.siteduzero.com/membres-294-7500.html">ptipilou</a> qui a encore permis de trouver quelques erreurs et de discuter de la lourdeur de certaines phrases le tuto va reprendre son développement.</p></li><li id="r-122462" data-claire-element-id="122462"><p id="r-122461" data-claire-element-id="122461">23/11/2008 : en créant un chapitre intermédiaire avec le TP suivant, découverte d'une <strong>erreur</strong> sur <code data-claire-semantic="html+php">sqlquery() </code>, pensez à mettre à jour votre code, ajout d'une fonction <code data-claire-semantic="html+php">queries() </code>, donc suppression des <code data-claire-semantic="html+php">&lt;?php global $queries; ?&gt; </code> et autres <code data-claire-semantic="html+php">&lt;?php $queries++; ?&gt; </code>. Pensez à regardez cela aussi. :)</p></li></ul><aside id="r-122466" data-claire-element-id="122466" data-claire-semantic="information"><p id="r-122464" data-claire-element-id="122464">À cause d'un très fort manque de temps de notre part à tous les deux (Neoterranos et LkY), ainsi que d'autres raisons qui ont été exposées maintes fois sur le forum, nous avons décidé <strong>d'arrêter totalement la création du tutoriel.</strong><br/> Dans l'état où il est, le tutoriel permet tout de même d'avoir les bases pour un espace membre simple, il ne tient qu'à vous de l'améliorer.</p><p id="r-122465" data-claire-element-id="122465">Je vous prie d'accepter nos excuses pour cela.</p></aside><aside id="r-122474" data-claire-element-id="122474" data-claire-semantic="error"><p id="r-122467" data-claire-element-id="122467">Après de multiples demandes issues de membres sans cesse refusées, j'ai pris la décision d'ajouter ce message au tuto :</p><ul id="r-122472" data-claire-element-id="122472"><li id="r-122469" data-claire-element-id="122469"><p id="r-122468" data-claire-element-id="122468"><strong>Aucune archive contenant les fichiers créés dans ce tuto ne sera fournie</strong>, pour la simple raison que les codes abordés via ce tuto y sont étudiés dans leur intégralité.</p></li><li id="r-122471" data-claire-element-id="122471"><p id="r-122470" data-claire-element-id="122470">Si vous rencontrez des erreurs, il est par ailleurs intéressant de chercher par vous-même, et vous pouvez ensuite demander de l'aide dans le topic du forum dédié à ce tuto, j'essaierai de répondre à vos questions.</p></li></ul><p id="r-122473" data-claire-element-id="122473">Merci de votre compréhension.</p></aside>
</div>
<div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1358423835269-0" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1358423835269-0');
        });
    }
    </script>
</div><a name="Introduction"></a><h2>Introduction</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
<span class="next">Un espace membre ? Kékécé ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-122476" data-claire-element-id="122476">Bonjour et bienvenue à tous dans le premier chapitre de ce tuto.</p><p id="r-122477" data-claire-element-id="122477">Pour commencer, nous allons vous expliquer ce que nous (LkY et Neoterranos) vous avons prévu dans ce tuto.</p><p id="r-122478" data-claire-element-id="122478">Si vous vous en fichez royalement, passez au chapitre suivant, mais nous vous recommandons tout de même de lire ce chapitre : il pose les bases du système et nous vous y donnerons la table SQL, c'est important ! ^^</p>
</div><a name="UnespacemembreKkc"></a><h2>Un espace membre ? Kékécé ?</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">
<span class="arrow"></span>
<span class="next">Introduction</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
<span class="next">Présentation de la première partie</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-un-espace-membre-kekece" data-claire-element-id="122493">Un espace membre ? Kékécé ?</h4><p id="r-122479" data-claire-element-id="122479">C'est une bonne question, ça : qu'est-ce que c'est, un espace membre ?</p><p id="r-122480" data-claire-element-id="122480">Sur conseil de Ziame, nous avons décidé de faire une sous-partie pour vous expliquer ce qu'on entend par espace membre.<br/> L'espace membre est tout ce qui permet au membre de contribuer à un site web.</p><p id="r-122481" data-claire-element-id="122481">On peut donc en quelque sorte dire que le forum fait partie de l'espace membre, ou que la messagerie privée fait partie de l'espace membre.</p><p id="r-122482" data-claire-element-id="122482">Mais nous ne voulons pas refaire le monde, encore moins vous donner en un seul tuto de quoi faire tout un site web ; nous allons donc limiter cette définition à une partie restreinte : l'inscription, la connexion, l'affichage et la gestion de profils.</p><p id="r-122483" data-claire-element-id="122483">Comme nous ne voulons pas vous abandonner n'importe où, nous vous proposerons aussi une gestion des droits que vous pourrez même étendre à un forum ou à un système de news. :)</p><p id="r-122484" data-claire-element-id="122484">Pour vous donner un point de comparaison avec le SdZ, nous traiterons des pages similaires à celles que vous allez voir sur ces images.</p><p id="r-122485" data-claire-element-id="122485">Je mets des miniatures car les grandes images prennent de la place : pour les voir en taille réelle, vous savez quoi faire. :)</p><p id="r-122486" data-claire-element-id="122486">Et pour ceux qui savent pas, faut cliquer dessus. Ok je sors ===&gt; []</p><p id="r-122487" data-claire-element-id="122490"><a href="medias/uploads.siteduzero.com_files_134001_135000_134274.png"><img id="r-122488" data-claire-element-id="122487" src="medias/uploads.siteduzero.com_thb_134001_135000_134274.png" alt="Image utilisateur"/></a><a href="medias/uploads.siteduzero.com_files_134001_135000_134273.png"><img id="r-122489" data-claire-element-id="122488" src="medias/uploads.siteduzero.com_thb_134001_135000_134273.png" alt="Image utilisateur"/></a><a href="medias/uploads.siteduzero.com_files_134001_135000_134272.png"><img id="r-122490" data-claire-element-id="122489" src="medias/uploads.siteduzero.com_thb_134001_135000_134272.png" alt="Image utilisateur"/></a></p><p id="r-122491" data-claire-element-id="122491">Pour éviter des remarques futures (pis je suis content, je la sors en premier :p ), non, nous ne vous apprendrons pas à faire un système de synthèse vocale. :lol:</p><p id="r-122492" data-claire-element-id="122492">Bon, attaquons un descriptif des parties prévues. :)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site">Créer un espace membre pour son site</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Création d&#039;un système simple
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">Introduction</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
Un espace membre ? Kékécé ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
Présentation de la première partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
Présentation de la seconde partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
La table SQL
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">Les bases du système</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
Des pages bien utiles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
D&#039;autres pages à inclure
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">Inscription</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
Le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
Charte et système anti-robot
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">La validation et les mails</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
Validation du formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
Un petit mail ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">TP : connexion et déconnexion</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
Prérequis et explications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
Et après ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">TP : site et profils</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
Exercice 1 - Création de statistiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
Correction de l&#039;exercice 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
Exercice 2 - Création de la page user.php
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
Correction de l&#039;exercice 2
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">
<span class="arrow"></span>
<span class="next">Introduction</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
<span class="next">Présentation de la première partie</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Prsentationdelapremirepartie"></a><h2>Présentation de la première partie</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
<span class="arrow"></span>
<span class="next">Un espace membre ? Kékécé ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
<span class="next">Présentation de la seconde partie</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-presentation-de-la-premiere-partie" data-claire-element-id="122571">Présentation de la première partie</h4><p id="r-122494" data-claire-element-id="122494">Avant toute chose, nous nous sommes demandés de quoi nous allions vous parler dans ce tuto, cela n'a pas été difficile : nous voulons créer un espace membre.</p><p id="r-122495" data-claire-element-id="122495">Pour avoir un espace membre, il faut déjà permettre aux membres de s'inscrire, de se connecter et de modifier leur profil, voire de consulter celui des autres (ça peut toujours servir :-° ).</p><p id="r-122496" data-claire-element-id="122496">Nous allons donc vous décrire ici tout ce que vous (oui, vous ; nous, on est des feignasses et on compte pas se fatiguer pour vous :pirate: ) allez faire dans la première partie.</p><h5 id="r-inscription" data-claire-element-id="122534">Inscription</h5><p id="r-122497" data-claire-element-id="122497">La première page du système proprement dit contiendra le formulaire d'inscription, la deuxième, la page de vérification.<br/> Comme ce sera le début, nous devrons aussi vous faire coder d'autres fonctions qui nous serviront tout au long de cette partie.<br/> Le formulaire d'inscription contiendra les éléments suivants :</p><ul id="r-122512" data-claire-element-id="122512"><li id="r-122499" data-claire-element-id="122499"><p id="r-122498" data-claire-element-id="122498">pseudo ;</p></li><li id="r-122501" data-claire-element-id="122501"><p id="r-122500" data-claire-element-id="122500">mot de passe ;</p></li><li id="r-122503" data-claire-element-id="122503"><p id="r-122502" data-claire-element-id="122502">confirmation du mot de passe ;</p></li><li id="r-122505" data-claire-element-id="122505"><p id="r-122504" data-claire-element-id="122504">e-mail ;</p></li><li id="r-122507" data-claire-element-id="122507"><p id="r-122506" data-claire-element-id="122506">confirmation de l'e-mail ;</p></li><li id="r-122509" data-claire-element-id="122509"><p id="r-122508" data-claire-element-id="122508">date de naissance ;</p></li><li id="r-122511" data-claire-element-id="122511"><p id="r-122510" data-claire-element-id="122510">système de protection anti-robot.</p></li></ul><p id="r-122513" data-claire-element-id="122513">Comme vous le voyez, ça fait déjà pas mal. Surtout le système anti-robot, c'est ce qui risque de nous prendre le plus de temps.</p><aside id="r-122515" data-claire-element-id="122515" data-claire-semantic="information"><p id="r-122514" data-claire-element-id="122514">La liste ici ne vous présente pas toutes les options ; dans la partie <strong><em>Profil</em></strong>, nous comptons rajouter d'autres choses, vous verrez au moment voulu. :)</p></aside><p id="r-122516" data-claire-element-id="122516">La deuxième partie parlera du traitement du formulaire :</p><ul id="r-122531" data-claire-element-id="122531"><li id="r-122518" data-claire-element-id="122518"><p id="r-122517" data-claire-element-id="122517">vérification de la disponibilité du pseudo ;</p></li><li id="r-122520" data-claire-element-id="122520"><p id="r-122519" data-claire-element-id="122519">vérifications sur le mot de passe ;</p></li><li id="r-122522" data-claire-element-id="122522"><p id="r-122521" data-claire-element-id="122521">comparaison des deux champs mot de passe ;</p></li><li id="r-122524" data-claire-element-id="122524"><p id="r-122523" data-claire-element-id="122523">vérification de l'e-mail ;</p></li><li id="r-122526" data-claire-element-id="122526"><p id="r-122525" data-claire-element-id="122525">comparaison des deux e-mails ;</p></li><li id="r-122528" data-claire-element-id="122528"><p id="r-122527" data-claire-element-id="122527">vérification de la protection anti-robot ;</p></li><li id="r-122530" data-claire-element-id="122530"><p id="r-122529" data-claire-element-id="122529">envoi dans la base de données ou redirection selon le cas.</p></li></ul><p id="r-122532" data-claire-element-id="122532">Dans cette page, nous toucherons déjà plus aux variables de sessions (et autres), car la redirection, pour être propre, se fera avec l'utilisation de sessions.</p><p id="r-122533" data-claire-element-id="122533">À noter que nous utiliserons aussi la fonction <code data-claire-semantic="html+php">mail </code>, si vous pouvez vous en servir.</p><h5 id="r-connexion-et-deconnexion" data-claire-element-id="122538">Connexion et déconnexion</h5><p id="r-122535" data-claire-element-id="122535">Ce chapitre traitera de la connexion.<br/> Il y aura un formulaire demandant pseudo et mot de passe, ainsi qu'un bouton Connexion automatique qui utilisera les cookies.</p><p id="r-122536" data-claire-element-id="122536">La page d'arrivée vérifiera les informations et créera les cookies si la case a été cochée, une bonne occasion d'utiliser <code data-claire-semantic="html+php">setcookie() </code>. :)</p><p id="r-122537" data-claire-element-id="122537">deconnexion.php fermera la session ouverte.</p><h5 id="r-profil" data-claire-element-id="122540">Profil</h5><p id="r-122539" data-claire-element-id="122539">Cette page affichera au moyen d'une variable <code data-claire-semantic="html+php">get </code> un membre par son id ou par son pseudo.<br/> Sur la page, on y verra différentes parties : pseudo, date d'inscription, âge si le membre veut le rendre public, l'e-mail s'il veut le rendre public aussi, adresses MSN, Yahoo, AIM, Skype, profession, localisation, biographie (comme sur le SdZ :-° ) et un bel avatar pour être le plus beau ; il sera assez facile d'y rajouter d'autres choses, comme des liens forum (genre voir tous les messages de ce membre) et autres joyeusetés du genre.<br/> Si on a les droits, on pourra éditer le profil (il y aura un lien) de la personne, et accéder aux informations privées (car pour l'administrateur, rien n'est privé :p ).</p><h5 id="r-edition-de-profil-et-administration" data-claire-element-id="122570">Édition de profil et administration</h5><p id="r-122541" data-claire-element-id="122541">Sur cette page, il y aura un graaaaaaaaaaaaaaaaaaand formulaire (y a assez de a ? :p ) qui permettra de modifier tout ça et peut-être plus encore :</p><ul id="r-122566" data-claire-element-id="122566"><li id="r-122543" data-claire-element-id="122543"><p id="r-122542" data-claire-element-id="122542">mot de passe ;</p></li><li id="r-122545" data-claire-element-id="122545"><p id="r-122544" data-claire-element-id="122544">e-mail ;</p></li><li id="r-122547" data-claire-element-id="122547"><p id="r-122546" data-claire-element-id="122546">date de naissance ;</p></li><li id="r-122549" data-claire-element-id="122549"><p id="r-122548" data-claire-element-id="122548">MSN ;</p></li><li id="r-122551" data-claire-element-id="122551"><p id="r-122550" data-claire-element-id="122550">Yahoo ;</p></li><li id="r-122553" data-claire-element-id="122553"><p id="r-122552" data-claire-element-id="122552">AIM ;</p></li><li id="r-122555" data-claire-element-id="122555"><p id="r-122554" data-claire-element-id="122554">localisation ;</p></li><li id="r-122557" data-claire-element-id="122557"><p id="r-122556" data-claire-element-id="122556">profession / occupation ;</p></li><li id="r-122559" data-claire-element-id="122559"><p id="r-122558" data-claire-element-id="122558">avatar ;</p></li><li id="r-122561" data-claire-element-id="122561"><p id="r-122560" data-claire-element-id="122560">biographie ;</p></li><li id="r-122563" data-claire-element-id="122563"><p id="r-122562" data-claire-element-id="122562">signature pour forum (nous sommes prévoyants :p ) ;</p></li><li id="r-122565" data-claire-element-id="122565"><p id="r-122564" data-claire-element-id="122564">nom de son chien...</p></li></ul><p id="r-122567" data-claire-element-id="122567">Comme quoi il y a du boulot, car après, il faut aussi balancer tout ça dans la base de données, et plus il y a d'infos, plus les risques de plantage sont importants ; en plus, faut faire gaffe à la sécurité. :)</p><p id="r-122568" data-claire-element-id="122568">C'est pour cela que nous aborderons ce point dans les derniers.</p><p id="r-122569" data-claire-element-id="122569">L'administration touchera à un système de droits. :)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site">Créer un espace membre pour son site</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Création d&#039;un système simple
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">Introduction</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
Un espace membre ? Kékécé ?
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
Présentation de la première partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
Présentation de la seconde partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
La table SQL
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">Les bases du système</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
Des pages bien utiles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
D&#039;autres pages à inclure
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">Inscription</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
Le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
Charte et système anti-robot
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">La validation et les mails</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
Validation du formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
Un petit mail ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">TP : connexion et déconnexion</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
Prérequis et explications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
Et après ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">TP : site et profils</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
Exercice 1 - Création de statistiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
Correction de l&#039;exercice 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
Exercice 2 - Création de la page user.php
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
Correction de l&#039;exercice 2
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
<span class="arrow"></span>
<span class="next">Un espace membre ? Kékécé ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
<span class="next">Présentation de la seconde partie</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Prsentationdelasecondepartie"></a><h2>Présentation de la seconde partie</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
<span class="arrow"></span>
<span class="next">Présentation de la première partie</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
<span class="next">La table SQL</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-presentation-de-la-seconde-partie" data-claire-element-id="122604">Présentation de la seconde partie</h4><p id="r-122572" data-claire-element-id="122572">La seconde partie, comme il a été dit, prendra en charge des améliorations de ce système.<br/> Elle touchera donc à des points plus complexes tels que JavaScript, les objets <code>XMLHttpRequest</code>, et des modifications des scripts déjà en place.</p><p id="r-122573" data-claire-element-id="122573">Une introduction vous parlera de JavaScript et d'AJAX.</p><aside id="r-122575" data-claire-element-id="122575" data-claire-semantic="warning"><p id="r-122574" data-claire-element-id="122574">Cette introduction n'aura pas pour but de vous apprendre tout ce qu'il faut savoir sur JavaScript ou sur les objets XHR, mais de poser des rappels et vous donner des liens vers de très bons tutoriels pour mieux comprendre comment tout cela marche.<br/> Nous estimons cependant qu'elle est nécessaire car elle vous fera quitter les sphères PHP pour vous ouvrir à un autre langage et à une méthode qui utilise JS et PHP.</p></aside><p id="r-122576" data-claire-element-id="122576">Ensuite, nous toucherons à notre espace membre proprement dit.</p><h5 id="r-inscription-1-2-le-retour" data-claire-element-id="122595">Inscription 1/2 (le retour)</h5><p id="r-122577" data-claire-element-id="122577">Dans cette page, nous allons rendre dynamique un bon nombre de choses :</p><ul id="r-122594" data-claire-element-id="122594"><li id="r-122579" data-claire-element-id="122579"><p id="r-122578" data-claire-element-id="122578">vérification en temps réel de la disponibilité du pseudo (XHR) ;</p></li><li id="r-122581" data-claire-element-id="122581"><p id="r-122580" data-claire-element-id="122580">mot de passe correct (JavaScript) ;</p></li><li id="r-122583" data-claire-element-id="122583"><p id="r-122582" data-claire-element-id="122582">mot de passe et mot de passe de confirmation identiques (JavaScript) ;</p></li><li id="r-122585" data-claire-element-id="122585"><p id="r-122584" data-claire-element-id="122584">évaluation du mot de passe (Faible / Moyen / Fort) (JavaScript) ;</p></li><li id="r-122587" data-claire-element-id="122587"><p id="r-122586" data-claire-element-id="122586">vérification de l'e-mail (XHR) ;</p></li><li id="r-122589" data-claire-element-id="122589"><p id="r-122588" data-claire-element-id="122588">comparaison des deux e-mails (JavaScript) ;</p></li><li id="r-122591" data-claire-element-id="122591"><p id="r-122590" data-claire-element-id="122590">affichage du bouton Valider mon inscription seulement si le formulaire est bon (JavaScript) ;</p></li><li id="r-122593" data-claire-element-id="122593"><p id="r-122592" data-claire-element-id="122592">actualisation du captcha s'il est illisible (JavaScript).</p></li></ul><h5 id="r-inscription-2-2" data-claire-element-id="122597">Inscription 2/2</h5><p id="r-122596" data-claire-element-id="122596">Il n'est pas encore certain que nous ayons à modifier cette page, mais c'est une éventualité que nous gardons à l'esprit. :)</p><h5 id="r-connexion-3" data-claire-element-id="122599">Connexion</h5><p id="r-122598" data-claire-element-id="122598">De même que pour inscription 2/2.</p><h5 id="r-profil-1" data-claire-element-id="122601">Profil</h5><p id="r-122600" data-claire-element-id="122600">A priori, ce n'est que de l'affichage, nous ne sommes pas censés y revenir, mais nous ajouterons un système de &quot;parsage&quot; avec les expressions régulières (ou avec DOM, cela dépendra de ma compréhension du système DOM quand je me pencherai dessus) pour faire un joli &quot;bbcode&quot; (ou zCode) qui donnera plus d'allure à la biographie du membre ou à sa signature forum, etc. :) <br/> D'autres systèmes verront peut-être le jour sur cette page aussi.</p><h5 id="r-edition-d-un-profil" data-claire-element-id="122603">Édition d'un profil</h5><p id="r-122602" data-claire-element-id="122602">Dans ce chapitre, nous allons créer un &quot;bbcode&quot; (ou zCode) à l'insertion, ainsi qu'un système d'aperçu utilisant XHR.<br/> Sur le papier c'est court, mais cette partie nous promet pas mal de travail. :p</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site">Créer un espace membre pour son site</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Création d&#039;un système simple
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">Introduction</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
Un espace membre ? Kékécé ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
Présentation de la première partie
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
Présentation de la seconde partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
La table SQL
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">Les bases du système</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
Des pages bien utiles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
D&#039;autres pages à inclure
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">Inscription</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
Le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
Charte et système anti-robot
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">La validation et les mails</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
Validation du formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
Un petit mail ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">TP : connexion et déconnexion</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
Prérequis et explications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
Et après ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">TP : site et profils</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
Exercice 1 - Création de statistiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
Correction de l&#039;exercice 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
Exercice 2 - Création de la page user.php
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
Correction de l&#039;exercice 2
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
<span class="arrow"></span>
<span class="next">Présentation de la première partie</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
<span class="next">La table SQL</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="LatableSQL"></a><h2>La table SQL</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
<span class="arrow"></span>
<span class="next">Présentation de la seconde partie</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">
<span class="next">Les bases du système</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-la-table-sql" data-claire-element-id="122623">La table SQL</h4><p id="r-122605" data-claire-element-id="122605">Bien, avant d'attaquer l'espace membre proprement dit, nous allons créer la table SQL : sans cela, nous risquons d'avoir deux, voire trois soucis ! :p</p><p id="r-122606" data-claire-element-id="122606">Pour avoir un espace membre correct, il faut que vos membres puissent renseigner un certain nombre de champs avec leurs informations personnelles, comme leur adresse de messagerie instantanée, leur signature (si jamais votre site dispose d'un forum), etc.</p><p id="r-122607" data-claire-element-id="122607">La table sera donc assez conséquente, nous allons vous donner le code SQL pour créer la table nécessaire à ce tutoriel.</p><aside id="r-122609" data-claire-element-id="122609" data-claire-semantic="information"><p id="r-122608" data-claire-element-id="122608">Selon l'organisation de votre site, vous aurez peut-être besoin d'avoir d'autres champs dans votre table membres, rien ne vous empêche d'en rajouter ! ;)</p></aside><p id="r-122610" data-claire-element-id="122610">Voici le code de la table.</p><pre id="r-122611" data-claire-element-id="122611"><code data-claire-semantic="sql">CREATE TABLE `membres` (
  `membre_id` int(11) NOT NULL auto_increment,
  `membre_pseudo` varchar(32) NOT NULL,
  `membre_mdp` varchar(40) NOT NULL,
  `membre_mail` varchar(100) NOT NULL,
  `membre_inscription` bigint(20) NOT NULL,
  `membre_naissance` varchar(11) NOT NULL,
  `membre_msn` varchar(255) NOT NULL,
  `membre_yahoo` varchar(255) NOT NULL,
  `membre_aim` varchar(255) NOT NULL,
  `membre_localisation` varchar(255) NOT NULL,
  `membre_profession` varchar(255) NOT NULL,
  `membre_avatar` varchar(255) NOT NULL,
  `membre_biographie` text NOT NULL,
  `membre_signature` text NOT NULL,
  `membre_derniere_visite` bigint(20) NOT NULL,
  `membre_banni` int(11) NOT NULL default '0',
  PRIMARY KEY `membre_id` (`membre_id`),
  UNIQUE (`membre_pseudo`),
  UNIQUE (`membre_mail`)
) ENGINE=InnoDB CHARACTER SET utf8 COLLATE utf8_general_ci AUTO_INCREMENT=1</code></pre><p id="r-122612" data-claire-element-id="122612">Les noms des champs sont explicites, je n'aurai pas besoin de vous faire un dessin. ;) <br/> Je voudrais juste faire une parenthèse sur trois champs : les champs membre_mdp, membre_banni et membre_derniere_visite.</p><ul id="r-122619" data-claire-element-id="122619"><li id="r-122614" data-claire-element-id="122614"><p id="r-122613" data-claire-element-id="122613">membre_mdp : il contiendra un md5, donc normalement 32 caractères suffisent ; j'en ai mis 40 pour ceux qui veulent utiliser une fonction de hash plus grosse (pensez à adapter à votre besoin).</p></li><li id="r-122616" data-claire-element-id="122616"><p id="r-122615" data-claire-element-id="122615">membre_banni : si ce champ vaut 0, le membre n'est pas banni, il pourra donc se connecter. En revanche, si ce champ vaut 1, le membre est banni et il lui sera impossible de se connecter.</p></li><li id="r-122618" data-claire-element-id="122618"><p id="r-122617" data-claire-element-id="122617">membre_derniere_visite : ce champ sera mis à jour avec le timestamp de la dernière visite du membre.</p></li></ul><p id="r-122620" data-claire-element-id="122620">C'est tout pour la table SQL, créez-la puis commençons ! ;)</p><p id="r-122621" data-claire-element-id="122621">Zzzzzzzz... Quoi ?! Vous dormez ?? Allez, debout tout de suite !</p><p id="r-122622" data-claire-element-id="122622">Hum... Maintenant que vous savez à quoi vous attendre, nous vous proposons de passer au chapitre suivant qui sera déjà plus intéressant.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site">Créer un espace membre pour son site</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Création d&#039;un système simple
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">Introduction</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
Un espace membre ? Kékécé ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
Présentation de la première partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
Présentation de la seconde partie
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
La table SQL
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">Les bases du système</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
Des pages bien utiles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
D&#039;autres pages à inclure
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">Inscription</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
Le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
Charte et système anti-robot
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">La validation et les mails</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
Validation du formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
Un petit mail ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">TP : connexion et déconnexion</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
Prérequis et explications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
Et après ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">TP : site et profils</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
Exercice 1 - Création de statistiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
Correction de l&#039;exercice 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
Exercice 2 - Création de la page user.php
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
Correction de l&#039;exercice 2
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
<span class="arrow"></span>
<span class="next">Présentation de la seconde partie</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">
<span class="next">Les bases du système</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesbasesdusystme"></a><h2>Les bases du système</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
<span class="arrow"></span>
<span class="next">La table SQL</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
<span class="next">Des pages bien utiles</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-122625" data-claire-element-id="122625">Avant de coder le système proprement dit, on a besoin de préparer un certain nombre de pages qui reviendront par la suite pas mal de fois. :)</p><p id="r-122626" data-claire-element-id="122626">Le système n'est pas très compliqué, mais il est quand même nécessaire d'avoir une bonne organisation.<br/> Ce chapitre sert à cela, nous allons vous donner les fonctions, pages à inclure et les astuces que nous utiliserons tout au long de ce tutoriel. Bien sûr, vous n'êtes pas obligés de procéder comme nous, mais nous allons quand même vous donner un exemple d'organisation.</p>
</div><a name="Despagesbienutiles"></a><h2>Des pages bien utiles</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">
<span class="arrow"></span>
<span class="next">Les bases du système</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
<span class="next">D&#039;autres pages à inclure</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-des-pages-bien-utiles" data-claire-element-id="122687">Des pages bien utiles</h4><p id="r-122627" data-claire-element-id="122627">Après la théorie, un peu de pratique avant le système lui-même. :)</p><p id="r-122628" data-claire-element-id="122628">Afin de ne pas devoir refaire plusieurs dizaines de fois les même actions, nous allons ici créer des fonctions qui vont nous permettre de gagner du temps, et, en plus, vos scripts n'en seront que plus clairs ! :) <br/> Chacune des pages que nous vous proposerons contiendra un entête avec le nom de la page, et une courte description, plus quelques informations utiles.</p><aside id="r-122630" data-claire-element-id="122630" data-claire-semantic="information"><p id="r-122629" data-claire-element-id="122629">Je suppose que votre site est totalement vide, et que donc nous allons tout créer ensemble.<br/> De plus, je vous informe que nous encoderons toutes nos pages, et les afficherons avec la norme UTF-8.<br/> Dans Notepad++, l'encodage est indiqué en bas à droite (voir image ci-après) et il se modifie dans Format (voir image aussi).<br/> Enfin, il est possible de paramétrer Notepad++ pour avoir toutes vos pages par défaut en UTF-8.</p></aside><p id="r-122631" data-claire-element-id="122631">Je mets mes images en miniature car les gros formats prennent beaucoup de place : pour les voir en taille réelle, vous savez quoi faire. :p</p><p id="r-122632" data-claire-element-id="122634"><a href="medias/uploads.siteduzero.com_files_139001_140000_139515.png"><img id="r-122633" data-claire-element-id="122632" src="medias/uploads.siteduzero.com_thb_139001_140000_139515.png" alt="Image utilisateur"/></a><a href="medias/uploads.siteduzero.com_files_139001_140000_139518.png"><img id="r-122634" data-claire-element-id="122633" src="medias/uploads.siteduzero.com_thb_139001_140000_139518.png" alt="Image utilisateur"/></a></p><p id="r-122635" data-claire-element-id="122635">Bon, passons à la suite.</p><p id="r-122636" data-claire-element-id="122636">Dans ce chapitre, nous allons vous donner pas mal de codes tout faits car ils ne sont pas passionnants, et que c'est juste pour nous faciliter la vie ; dans les chapitres qui suivront, nous ne vous donnerons pas les codes mâchés, il faudra réfléchir un peu (même si nous donnons les solutions, si vous voulez apprendre, il n'y a pas de secret, il faut bosser, donc, ne recopiez pas bêtement comme des moutons).</p><h5 id="r-information-php" data-claire-element-id="122641">information.php</h5><p id="r-122637" data-claire-element-id="122637">À la racine du site ou de votre dossier de test, vous allez créer une page <em>information.php</em> qui va contenir ceci :</p><pre id="r-122638" data-claire-element-id="122638"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page information.php

Gère les informations (page incluse).

Quelques indications : (Utiliser l'outil de recherche et rechercher les mentions données)

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations/erreurs :
--------------------------
Erreur interne
--------------------------
*/

if(!isset($informations))
{
	$informations = Array(/*Erreur*/
					true,
					'Erreur',
					'Une erreur interne est survenue...',
					'',
					ROOTPATH.'/index.php',
					3
					);
}

if($informations[0] === true) $type = 'erreur';
else $type = 'information';
?&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot; &gt;
	&lt;head&gt;
		&lt;title&gt;&lt;?php echo $informations[1]; ?&gt; : &lt;?php echo TITRESITE; ?&gt;&lt;/title&gt;
		&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;
		&lt;meta name=&quot;language&quot; content=&quot;fr&quot; /&gt;
		&lt;meta http-equiv=&quot;Refresh&quot; content=&quot;&lt;?php echo $informations[5]; ?&gt;;url=&lt;?php echo $informations[4]; ?&gt;&quot;&gt;
		&lt;link rel=&quot;stylesheet&quot; title=&quot;Design&quot; href=&quot;&lt;?php echo ROOTPATH; ?&gt;/design.css&quot; type=&quot;text/css&quot; media=&quot;screen&quot; /&gt;
	&lt;/head&gt;
	
	
	&lt;body&gt;
		&lt;div id=&quot;info&quot;&gt;
			&lt;div id=&quot;&lt;?php echo $type; ?&gt;&quot;&gt;&lt;?php echo $informations[2]; ?&gt; Redirection en cours...&lt;br/&gt;
			&lt;a href=&quot;&lt;?php echo $informations[4]; ?&gt;&quot;&gt;Cliquez ici si vous ne voulez pas attendre...&lt;/a&gt;&lt;?php echo $informations[3]; ?&gt;&lt;/div&gt;
		&lt;/div&gt;
	&lt;/body&gt;
&lt;/html&gt;
&lt;?php
unset($informations);
?&gt;</code></pre><p id="r-122639" data-claire-element-id="122639">Cette page sera inclue pour afficher des informations / erreurs éventuelles, elle reçoit un array <code data-claire-semantic="html+php">$informations</code>, et en affiche le contenu ; une erreur générique est mise en place au cas où. ^^</p><p id="r-122640" data-claire-element-id="122640">Ne vous souciez pas de <code data-claire-semantic="html+php">ROOTPATH</code> ni de <code data-claire-semantic="html+php">TITRESITE</code> pour le moment, nous allons y revenir. :)</p><h5 id="r-index-php-1" data-claire-element-id="122645">index.php</h5><p id="r-122642" data-claire-element-id="122642">Bon et puisque nous avons attaqué la racine, continuons sur cette lancée : vous allez créer une page <em>index.php</em>.</p><pre id="r-122643" data-claire-element-id="122643"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page index.php

Index du site.

Quelques indications : (utiliser l'outil de recherche et rechercher les mentions données)

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations/erreurs :
--------------------------
Aucune information/erreur
--------------------------
*/

session_start();
header('Content-type: text/html; charset=utf-8');
include('includes/config.php');

/********Actualisation de la session...**********/

include('includes/fonctions.php');
connexionbdd();
actualiser_session();

/********Fin actualisation de session...**********/

/********Entête et titre de page*********/

$titre = 'Inscription';

include('includes/haut.php'); //contient le doctype, et head.

/**********Fin entête et titre***********/
?&gt;

		&lt;div id=&quot;colonne_gauche&quot;&gt;
		&lt;?php
		include('includes/colg.php');
		?&gt;
		&lt;/div&gt;
		
		&lt;div id=&quot;contenu&quot;&gt;
			&lt;div id=&quot;map&quot;&gt;
				&lt;a href=&quot;index.php&quot;&gt;Accueil&lt;/a&gt;
			&lt;/div&gt;
			
			&lt;h1&gt;Bienvenue sur mon super site !&lt;/h1&gt;
			&lt;p&gt;Ce site parlera de ... et est ouvert à tous.
			Cependant, faut payer pour &lt;a href=&quot;membres/inscription.php&quot;&gt;s'inscrire&lt;/a&gt; mouhahaha !
			
			Le Webmaster
			&lt;/p&gt;
		&lt;/div&gt;
		
		&lt;?php
		include('includes/bas.php');
		mysql_close();
		?&gt;</code></pre><p id="r-122644" data-claire-element-id="122644">Comme vous le devinez, nous allons très prochainement créer haut.php, bas.php, colg.php, fonctions.php, config.php, etc. :p <br/> Concernant colg, je me permets une parenthèse : dans le design que nous vous proposons, nous nous basons sur le design du SdZ qui a le mérite d'être très simple, joli et facile d'accès ; colg représente donc une colonne gauche - d'une largeur égale à 15 % de la largeur de la page - qui contient des informations ou d'autres choses qui ne changeront pas (qui seront les mêmes sur toutes les pages).<br/> Si cette idée ne vous convient pas, n'hésitez pas à supprimer cette colonne et à modifier le CSS en conséquence. :)</p><h5 id="r-fonctions-php" data-claire-element-id="122669">fonctions.php</h5><p id="r-122646" data-claire-element-id="122646">À la racine de votre site ou de votre dossier de test, créez un dossier nommé <em>includes</em>.<br/> Dans ce dossier, créez une page que nous allons nommer <em>fonctions.php</em>, elle contiendra toutes nos fonctions faites maison. ^^</p><p id="r-122647" data-claire-element-id="122647">Nous allons d'abord créer une fonction SQL pour se faciliter la vie ; je la mets directement, car ce n'est pas difficile à comprendre :) (en plus, le code est commenté :-° ).</p><pre id="r-122648" data-claire-element-id="122648"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page fonctions.php

Contient quelques fonctions globales.

Quelques indications : (utiliser l'outil de recherche et rechercher les mentions donnÃ©es)

Liste des fonctions :
--------------------------
sqlquery($requete,$number)
connexionbdd()
actualiser_session()
vider_cookie()
--------------------------


Liste des informations/erreurs :
--------------------------
Mot de passe de session incorrect
Mot de passe de cookie incorrect
L'id de cookie est incorrect
--------------------------
*/

function sqlquery($requete, $number)
{
	$query = mysql_query($requete) or exit('Erreur SQL : '.mysql_error().' Ligne : '. __LINE__ .'.'); //requête
	queries();
	
	/*
	Deux cas possibles ici :
	Soit on sait qu'on a qu'une seule entrée qui sera
	retournée par SQL, donc on met $number à 1
	Soit on ne sait pas combien seront retournées,
	on met alors $number à 2.
	*/
	
	if($number == 1)
	{
		$query1 = mysql_fetch_assoc($query);
		mysql_free_result($query);
		/*mysql_free_result($query) libère le contenu de $query, je
		le fais par principe, mais c'est pas indispensable.*/
		return $query1;
	}
	
	else if($number == 2)
	{
		while($query1 = mysql_fetch_assoc($query))
		{
			$query2[] = $query1;
			/*On met $query1 qui est un array dans $query2 qui
			est un array. Ca fait un array d'arrays :o*/
		}
		mysql_free_result($query);
		return $query2;
	}
	
	else //Erreur
	{
		exit('Argument de sqlquery non renseigné ou incorrect.');
	}
}
?&gt;</code></pre><p id="r-122649" data-claire-element-id="122649">Comme ça, nous économisons du temps, car nous n'avons plus à taper tout cela à chaque fois. :)</p><p id="r-122650" data-claire-element-id="122650">Dans la fonction <code data-claire-semantic="html+php">sqlquery()</code>, nous utilisons une fonction nommée <code data-claire-semantic="html+php">queries()</code>, il faut donc la définir :</p><pre id="r-122651" data-claire-element-id="122651"><code data-claire-semantic="html+php">&lt;?php
function queries($num = 1)
{
	global $queries;
	$queries = $queries + intval($num);
}
?&gt;</code></pre><p id="r-122652" data-claire-element-id="122652">Nous allons maintenant réaliser une fonction pour nous connecter en une seule ligne ( :D ) à la base de données.</p><pre id="r-122653" data-claire-element-id="122653"><code data-claire-semantic="html+php">&lt;?php
function connexionbdd()
{
	//Définition des variables de connexion à la base de données
	$bd_nom_serveur='localhost';
	$bd_login='root';
	$bd_mot_de_passe='';
	$bd_nom_bd='espace_membre';

	//Connexion à la base de données
	mysql_connect($bd_nom_serveur, $bd_login, $bd_mot_de_passe);
	mysql_select_db($bd_nom_bd);
	mysql_query(&quot;set names 'utf8'&quot;);
}
?&gt;</code></pre><p id="r-122654" data-claire-element-id="122654">Si cette fonction est appelée, la connexion à la base de données se fait automatiquement.<br/> La ligne <code data-claire-semantic="html+php">&lt;?php mysql_query(&quot;set names 'utf8'&quot;); ?&gt;</code> définit l'encodage des transferts entre la base de données et les pages PHP (donc Apache).</p><p id="r-122655" data-claire-element-id="122655">On peut passer à <code data-claire-semantic="html+php">actualiser_session()</code>.</p><pre id="r-122656" data-claire-element-id="122656"><code data-claire-semantic="html+php">&lt;?php
function actualiser_session()
{
	if(isset($_SESSION['membre_id']) &amp;&amp; intval($_SESSION['membre_id']) != 0) //Vérification id
	{
		//utilisation de la fonction sqlquery, on sait qu'on aura qu'un résultat car l'id d'un membre est unique.
		$retour = sqlquery(&quot;SELECT membre_id, membre_pseudo, membre_mdp FROM membres WHERE membre_id = &quot;.intval($_SESSION['membre_id']), 1);
		
		//Si la requête a un résultat (c'est-à-dire si l'id existe dans la table membres)
		if(isset($retour['membre_pseudo']) &amp;&amp; $retour['membre_pseudo'] != '')
		{
			if($_SESSION['membre_mdp'] != $retour['membre_mdp'])
			{
				//Dehors vilain pas beau !
				$informations = Array(/*Mot de passe de session incorrect*/
									true,
									'Session invalide',
									'Le mot de passe de votre session est incorrect, vous devez vous reconnecter.',
									'',
									'membres/connexion.php',
									3
									);
				require_once('../information.php');
				vider_cookie();
				session_destroy();
				exit();
			}
			
			else
			{
				//Validation de la session.
					$_SESSION['membre_id'] = $retour['membre_id'];
					$_SESSION['membre_pseudo'] = $retour['membre_pseudo'];
					$_SESSION['membre_mdp'] = $retour['membre_mdp'];
			}
		}
	}
	
	else //On vérifie les cookies et sinon pas de session
	{
		if(isset($_COOKIE['membre_id']) &amp;&amp; isset($_COOKIE['membre_mdp'])) //S'il en manque un, pas de session.
		{
			if(intval($_COOKIE['membre_id']) != 0)
			{
				//idem qu'avec les $_SESSION
				$retour = sqlquery(&quot;SELECT membre_id, membre_pseudo, membre_mdp FROM membres WHERE membre_id = &quot;.intval($_COOKIE['membre_id']), 1);
				
				if(isset($retour['membre_pseudo']) &amp;&amp; $retour['membre_pseudo'] != '')
				{
					if($_COOKIE['membre_mdp'] != $retour['membre_mdp'])
					{
						//Dehors vilain tout moche !
						$informations = Array(/*Mot de passe de cookie incorrect*/
											true,
											'Mot de passe cookie erroné',
											'Le mot de passe conservé sur votre cookie est incorrect vous devez vous reconnecter.',
											'',
											'membres/connexion.php',
											3
											);
						require_once('../information.php');
						vider_cookie();
						session_destroy();
						exit();
					}
					
					else
					{
						//Bienvenue :D
						$_SESSION['membre_id'] = $retour['membre_id'];
						$_SESSION['membre_pseudo'] = $retour['membre_pseudo'];
						$_SESSION['membre_mdp'] = $retour['membre_mdp'];
					}
				}
			}
			
			else //cookie invalide, erreur plus suppression des cookies.
			{
				$informations = Array(/*L'id de cookie est incorrect*/
									true,
									'Cookie invalide',
									'Le cookie conservant votre id est corrompu, il va donc être détruit vous devez vous reconnecter.',
									'',
									'membres/connexion.php',
									3
									);
				require_once('../information.php');
				vider_cookie();
				session_destroy();
				exit();
			}
		}
		
		else
		{
			//Fonction de suppression de toutes les variables de cookie.
			if(isset($_SESSION['membre_id'])) unset($_SESSION['membre_id']);
			vider_cookie();
		}
	}
}

function vider_cookie()
{
	foreach($_COOKIE as $cle =&gt; $element)
	{
		setcookie($cle, '', time()-3600);
	}
}
?&gt;</code></pre><h6 id="r-explications-5" data-claire-element-id="122668">Explications</h6><p id="r-122657" data-claire-element-id="122657">Cette fonction doit actualiser les sessions, donc d'abord vérifier s'il existe une session.<br/> On vérifie la variable <code data-claire-semantic="html+php">$_SESSION['membre_id']</code>, car a priori, l'id d'un membre ne changera jamais, et seuls les membres connectés ont un id.<br/> On vérifie que <code data-claire-semantic="html">$_SESSION['membre_id']</code> contient un nombre différent de 0 (via <code data-claire-semantic="html+php">intval()</code>, une fonction très intéressante qui retourne la valeur numérique entière d'une variable ; si la variable est une chaîne commençant par une lettre, on aura un 0, c'est ici ce qui nous intéresse :) ).</p><p id="r-122658" data-claire-element-id="122658">Si cette vérification se passe bien, on appelle alors SQL (et on incrémente au passage une variable globale <code data-claire-semantic="html+php">$queries</code> pour le nombre de requêtes) pour avoir les informations désirées et on vérifie que le pseudo retourné n'est pas vide, ce qui sert à deux choses : déjà à être sûrs que le membre existe, ensuite qu'il a un pseudo (normalement oui, mais vous n'êtes jamais à l'abri d'un bug).</p><aside id="r-122660" data-claire-element-id="122660" data-claire-semantic="information"><p id="r-122659" data-claire-element-id="122659">Notez l'utilisation de <code data-claire-semantic="html+php">intval()</code> dans la requête SQL. <code data-claire-semantic="html+php">intval()</code> force la variable à être un nombre, il n'y a donc pas de risque pour la sécurité de la requête.<br/> Pour plus d'informations sur ces histoires de sécurité dans les requêtes SQL, je vous invite à vous rendre <a href="http://www.siteduzero.com/tutoriel-3-37762-eviter-les-injections-sql.html">ici</a> (notez à quel point je suis feignant, je ne vous explique même pas ça :p ).</p></aside><p id="r-122661" data-claire-element-id="122661">Bon, alors : si le membre a un pseudo, on compare les mots de passe en session et venant de la bdd, et si tout roule, on valide la session du membre ; sinon, on inclut information.php et on affiche une erreur. :p</p><p id="r-122662" data-claire-element-id="122662">Si le membre n'a pas de session, on va dans le <code data-claire-semantic="html+php">else</code>, on vérifie donc s'il a des cookies et s'ils sont valides, la procédure ressemble assez à celle des sessions, sauf que si le cookie id est incorrect, on génère une autre erreur.</p><p id="r-122663" data-claire-element-id="122663">Enfin, si le membre n'a pas de session valide, ni de cookie valide, on détruit la variable <code data-claire-semantic="html+php">$_SESSION['membre_id']</code> (si elle existait), et on détruit les cookies.<br/> La fonction <code data-claire-semantic="html+php">vider_cookie()</code> est facile à comprendre, elle parcourt les cookies avec un <code data-claire-semantic="html+php">foreach</code> et les détruit tous (mouhahahahaha).</p><p id="r-122664" data-claire-element-id="122664">Voilà. :p</p><p id="r-122665" data-claire-element-id="122665">Donc, dans fonctions.php, nous avons tout ça, normalement :</p><div id="r-122667" data-claire-element-id="122667"><pre id="r-122666" data-claire-element-id="122666"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page fonctions.php

Contient quelques fonctions globales.

Quelques indications : (utiliser l'outil de recherche et rechercher les mentions donnÃ©es)

Liste des fonctions :
--------------------------
sqlquery($requete,$number)
connexionbdd()
actualiser_session()
vider_cookie()
--------------------------


Liste des informations/erreurs :
--------------------------
Mot de passe de session incorrect
Mot de passe de cookie incorrect
L'id de cookie est incorrect
--------------------------
*/

function sqlquery($requete, $number)
{
	$query = mysql_query($requete) or exit('Erreur SQL : '.mysql_error().' Ligne : '. __LINE__ .'.'); //requête
	queries();
	
	/*
	Deux cas possibles ici :
	Soit on sait qu'on a qu'une seule entrée qui sera
	retournée par SQL, donc on met $number à 1
	Soit on ne sait pas combien seront retournées,
	on met alors $number à 2.
	*/
	
	if($number == 1)
	{
		$query1 = mysql_fetch_assoc($query);
		mysql_free_result($query);
		/*mysql_free_result($query) libère le contenu de $query, je
		le fais par principe, mais c'est pas indispensable.*/
		return $query1;
	}
	
	else if($number == 2)
	{
		while($query1 = mysql_fetch_assoc($query))
		{
			$query2[] = $query1;
			/*On met $query1 qui est un array dans $query2 qui
			est un array. Ca fait un array d'arrays :o*/
		}
		mysql_free_result($query);
		return $query2;
	}
	
	else //Erreur
	{
		exit('Argument de sqlquery non renseigné ou incorrect.');
	}
}

function queries($num = 1)
{
	global $queries;
	$queries = $queries + intval($num);
}

function connexionbdd()
{
	//Définition des variables de connexion à la base de données
	$bd_nom_serveur='localhost';
	$bd_login='root';
	$bd_mot_de_passe='';
	$bd_nom_bd='espace_membre';

	//Connexion à la base de données
	mysql_connect($bd_nom_serveur, $bd_login, $bd_mot_de_passe);
	mysql_select_db($bd_nom_bd);
	mysql_query(&quot;set names 'utf8'&quot;);
}

function actualiser_session()
{
	if(isset($_SESSION['membre_id']) &amp;&amp; intval($_SESSION['membre_id']) != 0) //Vérification id
	{
		//utilisation de la fonction sqlquery, on sait qu'on aura qu'un résultat car l'id d'un membre est unique.
		$retour = sqlquery(&quot;SELECT membre_id, membre_pseudo, membre_mdp FROM membres WHERE membre_id = &quot;.intval($_SESSION['membre_id']), 1);
		
		//Si la requête a un résultat (id est : si l'id existe dans la table membres)
		if(isset($retour['membre_pseudo']) &amp;&amp; $retour['membre_pseudo'] != '')
		{
			if($_SESSION['membre_mdp'] != $retour['membre_mdp'])
			{
				//Dehors vilain pas beau !
				$informations = Array(/*Mot de passe de session incorrect*/
									true,
									'Session invalide',
									'Le mot de passe de votre session est incorrect, vous devez vous reconnecter.',
									'',
									'membres/connexion.php',
									3
									);
				require_once('../information.php');
				vider_cookie();
				session_destroy();
				exit();
			}
			
			else
			{
				//Validation de la session.
					$_SESSION['membre_id'] = $retour['membre_id'];
					$_SESSION['membre_pseudo'] = $retour['membre_pseudo'];
					$_SESSION['membre_mdp'] = $retour['membre_mdp'];
			}
		}
	}
	
	else //On vérifie les cookies et sinon pas de session
	{
		if(isset($_COOKIE['membre_id']) &amp;&amp; isset($_COOKIE['membre_mdp'])) //S'il en manque un, pas de session.
		{
			if(intval($_COOKIE['membre_id']) != 0)
			{
				//idem qu'avec les $_SESSION
				$retour = sqlquery(&quot;SELECT membre_id, membre_pseudo, membre_mdp FROM membres WHERE membre_id = &quot;.intval($_COOKIE['membre_id']), 1);
				
				if(isset($retour['membre_pseudo']) &amp;&amp; $retour['membre_pseudo'] != '')
				{
					if($_COOKIE['membre_mdp'] != $retour['membre_mdp'])
					{
						//Dehors vilain tout moche !
						$informations = Array(/*Mot de passe de cookie incorrect*/
											true,
											'Mot de passe cookie erroné',
											'Le mot de passe conservé sur votre cookie est incorrect vous devez vous reconnecter.',
											'',
											'membres/connexion.php',
											3
											);
						require_once('../information.php');
						vider_cookie();
						session_destroy();
						exit();
					}
					
					else
					{
						//Bienvenue :D
						$_SESSION['membre_id'] = $retour['membre_id'];
						$_SESSION['membre_pseudo'] = $retour['membre_pseudo'];
						$_SESSION['membre_mdp'] = $retour['membre_mdp'];
					}
				}
			}
			
			else //cookie invalide, erreur plus suppression des cookies.
			{
				$informations = Array(/*L'id de cookie est incorrect*/
									true,
									'Cookie invalide',
									'Le cookie conservant votre id est corrompu, il va donc être détruit vous devez vous reconnecter.',
									'',
									'membres/connexion.php',
									3
									);
				require_once('../information.php');
				vider_cookie();
				session_destroy();
				exit();
			}
		}
		
		else
		{
			//Fonction de suppression de toutes les variables de cookie.
			if(isset($_SESSION['membre_id'])) unset($_SESSION['membre_id']);
			vider_cookie();
		}
	}
}

function vider_cookie()
{
	foreach($_COOKIE as $cle =&gt; $element)
	{
		setcookie($cle, '', time()-3600);
	}
}
?&gt;</code></pre></div><h5 id="r-config-php" data-claire-element-id="122686">config.php</h5><p id="r-122670" data-claire-element-id="122670">Toujours dans notre dossier <em>includes</em>, nous allons créer un fichier <em>config.php</em>.</p><pre id="r-122671" data-claire-element-id="122671"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page config.php

Deux define et la variable de queries.

Quelques indications : (utiliser l'outil de recherche et rechercher les mentions données)

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations/erreurs :
--------------------------
Aucune information/erreur
--------------------------
*/

define('ROOTPATH', 'http://'.$_SERVER['HTTP_HOST'], true);
define('TITRESITE', 'Mon site de test', true);
$queries = 0;
?&gt;</code></pre><h6 id="r-explications-6" data-claire-element-id="122685">Explications</h6><p id="r-122672" data-claire-element-id="122672">Je me suis demandé pendant un bout de temps comment j'allais m'organiser pour la gestion des liens des pages incluses.<br/> Plutôt que d'utiliser une fonction pour repérer où je suis et bosser totalement en relatif, j'ai pensé à un chemin absolu, mais ce genre de chemin a un défaut : si on change de nom de domaine, on doit le modifier ; du coup, j'ai voulu créer une variable de configuration <code data-claire-semantic="html+php">rootpath</code> dans un fichier de configuration et l'inclure partout où j'en ai besoin, pour n'avoir qu'une et une seule modification de NDD à faire.</p><div id="r-122674" data-claire-element-id="122674" data-claire-semantic="question"><p id="r-122673" data-claire-element-id="122673">Oui, mais pourquoi ne pas trouver une solution pour ne pas avoir à modifier <code data-claire-semantic="html+php">ROOTPATH</code> ?</p></div><p id="r-122675" data-claire-element-id="122675">J'y viens ; dans l'objectif de faire quelque chose sur lequel je revienne le moins souvent possible, j'ai (enfin, c'est LkY, mais on va dire que c'est moi :p ) trouvé une variable serveur qui me convenait parfaitement : <code data-claire-semantic="html+php">$_SERVER['HTTP_HOST']</code>.</p><p id="r-122676" data-claire-element-id="122676">Essayez ce script en local, sur votre ftp, vous comprendrez l'intérêt de cette variable :</p><pre id="r-122677" data-claire-element-id="122677"><code data-claire-semantic="html+php">&lt;?php
echo $_SERVER['HTTP_HOST'];
?&gt;</code></pre><p id="r-122678" data-claire-element-id="122678">Il ne restait plus qu'à mettre le <code data-claire-semantic="html">http://</code> devant et j'avais mon lien absolu.</p><aside id="r-122681" data-claire-element-id="122681" data-claire-semantic="warning"><p id="r-122679" data-claire-element-id="122679">Pensez cependant à vérifier sur quoi pointe <code data-claire-semantic="html+php">ROOTPATH</code> : en effet, si vous êtes en local, il faudra peut-être modifier celui-ci pour qu'il pointe sur votre dossier de test !!</p><p id="r-122680" data-claire-element-id="122680">Exemple : mon <code data-claire-semantic="html+php">ROOTPATH</code> en local ressemble au code qui suit.</p></aside><pre id="r-122682" data-claire-element-id="122682"><code data-claire-semantic="html+php">&lt;?php
define(ROOTPATH, 'http://'.$_SERVER['HTTP_HOST'].'/Site/Sdz/tuto/tuto-membres', true);
?&gt;</code></pre><p id="r-122683" data-claire-element-id="122683"><code data-claire-semantic="html+php">TITRESITE</code> n'est pas très utile, et on pourrait la mettre ailleurs, mais j'ai décidé de la mettre là. :)</p><p id="r-122684" data-claire-element-id="122684"><code data-claire-semantic="html+php">$queries</code> est créé sur chaque page appelant config.php, elle sert à enregistrer le nombre de requêtes effectuées sur une page (au passage : pensez à la portée des variables).</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site">Créer un espace membre pour son site</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Création d&#039;un système simple
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">Introduction</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
Un espace membre ? Kékécé ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
Présentation de la première partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
Présentation de la seconde partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
La table SQL
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">Les bases du système</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
Des pages bien utiles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
D&#039;autres pages à inclure
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">Inscription</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
Le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
Charte et système anti-robot
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">La validation et les mails</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
Validation du formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
Un petit mail ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">TP : connexion et déconnexion</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
Prérequis et explications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
Et après ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">TP : site et profils</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
Exercice 1 - Création de statistiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
Correction de l&#039;exercice 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
Exercice 2 - Création de la page user.php
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
Correction de l&#039;exercice 2
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">
<span class="arrow"></span>
<span class="next">Les bases du système</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
<span class="next">D&#039;autres pages à inclure</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="D039autrespagesinclure"></a><h2>D&#039;autres pages à inclure</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
<span class="arrow"></span>
<span class="next">Des pages bien utiles</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">
<span class="next">Inscription</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-d-autres-pages-a-inclure" data-claire-element-id="122712">D'autres pages à inclure</h4><p id="r-122688" data-claire-element-id="122688">Nous allons ensuite préparer d'autres pages (il y a déjà fonctions.php) à inclure au début de vos scripts : de cette manière, vos scripts seront plus propres, et puis si vous décidez de faire un changement, vous n'aurez pas à modifier toutes vos pages ! :lol:</p><p id="r-122689" data-claire-element-id="122689">Nous mettrons ces pages dans le dossier <em>includes</em> précédemment créé.</p><h5 id="r-la-page-haut-php" data-claire-element-id="122694">La page haut.php</h5><p id="r-122690" data-claire-element-id="122690">Cette page contiendra le code minimal HTML nécessaire à tout site Internet.<br/> La voici. ;)</p><pre id="r-122691" data-claire-element-id="122691"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page haut.php

Page incluse créant le doctype etc etc.

Quelques indications : (utiliser l'outil de recherche et rechercher les mentions données)

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations/erreurs :
--------------------------
Aucune information/erreur
--------------------------
*/
?&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot; &gt;
	&lt;head&gt;
	&lt;?php
	/**********Vérification du titre...*************/
	
	if(isset($titre) &amp;&amp; trim($titre) != '')
	$titre = $titre.' : '.TITRESITE;
	
	else
	$titre = TITRESITE;
	
	/***********Fin vérification titre...************/
	?&gt;
		&lt;title&gt;&lt;?php echo $titre; ?&gt;&lt;/title&gt;
		&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;
		&lt;meta name=&quot;language&quot; content=&quot;fr&quot; /&gt;
		&lt;link rel=&quot;stylesheet&quot; title=&quot;Design&quot; href=&quot;&lt;?php echo ROOTPATH; ?&gt;/design.css&quot; type=&quot;text/css&quot; media=&quot;screen&quot; /&gt;
	&lt;/head&gt;


	&lt;body&gt;
		&lt;div id=&quot;banniere&quot;&gt;
			&lt;a href=&quot;&lt;?php echo ROOTPATH;?&gt;/index.php&quot;&gt;&lt;img src=&quot;&lt;?php echo ROOTPATH; ?&gt;/images/banniere.png&quot;/&gt;&lt;/a&gt;
		&lt;/div&gt;
		
		&lt;div id=&quot;menu&quot;&gt;
			&lt;div id=&quot;menu_gauche&quot;&gt;
			&lt;!-- Vide, mettez-y les liens qui ne dépendent pas du statut
			du membre (connecté ou non) --&gt;
			&lt;/div&gt;
			
			&lt;div id=&quot;menu_droite&quot;&gt;
			&lt;?php
			if(isset($_SESSION['membre_id']))
			{
			?&gt;
				&lt;a href=&quot;&lt;?php echo ROOTPATH; ?&gt;/membres/moncompte.php&quot;&gt;Gérer mon compte&lt;/a&gt;   &lt;a href=&quot;&lt;?php echo ROOTPATH; ?&gt;/membres/deconnexion.php&quot;&gt;Se déconnecter&lt;/a&gt;
			&lt;?php
			}
			
			else
			{
			?&gt;
				&lt;a href=&quot;&lt;?php echo ROOTPATH; ?&gt;/membres/inscription.php&quot;&gt;Inscription&lt;/a&gt;   &lt;a href=&quot;&lt;?php echo ROOTPATH; ?&gt;/membres/connexion.php&quot;&gt;Connexion&lt;/a&gt;
			&lt;?php
			}
			?&gt;
			&lt;/div&gt;
		&lt;/div&gt;</code></pre><p id="r-122692" data-claire-element-id="122692">Rien de bien particulier ici, à part le titre, le menu et la bannière. :)</p><p id="r-122693" data-claire-element-id="122693">Pour le titre (dans la balise <code data-claire-semantic="html">&lt;title&gt; </code>), on vérifie simplement que la variable existe : si oui, on l'affiche.</p><h5 id="r-colg-php" data-claire-element-id="122698">colg.php</h5><p id="r-122695" data-claire-element-id="122695">Toujours dans le dossier <em>includes</em>, créez le fichier <em>colg.php</em> et mettez-y ce que vous voulez, il ne nous servira pas pour le moment. :)</p><p id="r-122696" data-claire-element-id="122696">Pour ma part, j'y ai mis ça :</p><pre id="r-122697" data-claire-element-id="122697"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page colg.php

La colonne de gauche de votre site.

Quelques indications : (utiliser l'outil de recherche et rechercher les mentions données)

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations/erreurs :
--------------------------
Aucune information/erreur
--------------------------
*/
?&gt;
&lt;div&gt;Hello World !&lt;/div&gt;</code></pre><h5 id="r-page-bas-php" data-claire-element-id="122704">Page bas.php</h5><p id="r-122699" data-claire-element-id="122699">Voici le code de la page <em>bas.php</em>, on affiche le footer (avec un copyright :soleil: ) et on ferme les balises <code data-claire-semantic="html">body </code> et <code data-claire-semantic="html">html </code>.</p><p id="r-122700" data-claire-element-id="122700">Voici la page. ;)</p><pre id="r-122701" data-claire-element-id="122701"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page bas.php

Pied de page.

Quelques indications : (utiliser l'outil de recherche et rechercher les mentions données)

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations/erreurs :
--------------------------
Aucune information/erreur
--------------------------
*/
?&gt;
		&lt;div id=&quot;footer&quot;&gt;
			Site réalisé par Neoterranos et LkY.&lt;br/&gt;
			&lt;?php echo $queries; ?&gt; requête(s).
		&lt;/div&gt;
	&lt;/body&gt;
&lt;/html&gt;</code></pre><aside id="r-122703" data-claire-element-id="122703" data-claire-semantic="information"><p id="r-122702" data-claire-element-id="122702">Il se peut que nous rajoutions par la suite d'autres choses dans nos pages haut et bas, donc gardez-les sous la main ! ^^</p></aside><h5 id="r-le-design" data-claire-element-id="122711">Le design</h5><p id="r-122705" data-claire-element-id="122705">Bien que je vous aie recommandé de faire un design pour votre système, vous en avez sûrement un pour votre site.<br/> Mais si vous faites ce tuto uniquement pour vous entraîner et apprendre comment mettre en place ce type de système (même s'il est toujours recommandé d'essayer avant de pomper les codes :-° ), je vous ai concocté un petit design simple et propre ! :)</p><p id="r-122706" data-claire-element-id="122706">À la racine du site, créez <em>design.css</em> :</p><pre id="r-122707" data-claire-element-id="122707"><code data-claire-semantic="css">body {
	background-color: #CDF0F0;
	width:auto;
	margin-left: 1%;
	margin-right: 1%;
	font-family: verdana, serif;
	font-size:12px
}

#banniere {
	height:auto;
	width:auto;
	margin-left: 0.25%;
}

#banniere a img	{
	width: 99.5%;
	height: auto;
}

#menu {
	padding-top: 7px;
	padding-bottom: 3px;
	background-color: white;
	width: auto;
	height: 20px;
	border: 1px solid #2499cc;
}

#colonne_gauche {
	background-color: white;
	width:15%;
	margin-top: 5px;
	margin-bottom: 10px;
	padding:0;
	border: 1px solid #2499cc;
	float: left;
}

#menu_droite {
	text-align: right;
}

#contenu {
	background-color: white;
	margin-left: 16%;
	margin-bottom:10px;
	margin-right:0;
	margin-top:5px;
	padding:5px;
	width:auto;
	border: 1px solid #2499cc;
	min-height:200px;
}

#footer {
	background-color: white;
	clear: both;
	margin:0;
	padding:5px;
	width:auto;
	text-align:center;
	border:1px solid #2499cc;
}

#info {
	width: 40%;
	position: absolute;
	top: 42%;
	left: 30%;
	border: 1px solid black;
	background-color: #CFEDF4;
}

#erreur {
	text-align: center;
	color: #EE0808;
}

#information {
	text-align: center;
	color: #08EE08;
}

/* ----------------------------------------------------------------------------- */

h1 {
	text-align:center;
	text-decoration: underline;
	color: #3080D0;
	font-family:&quot;trebuchet ms&quot;, verdana, sans-serif;
	letter-spacing:1.2px;
	font-variant:small-caps;
	font-weight:bold;
	font-size:22px;
	margin-top:0;
}

a, a:visited {
	color:#4497e6;
	text-decoration:none;
}

a:hover, a:focus {
	text-decoration:underline;
	color:#76b4ee;
}

a img	{
	border: none;
}</code></pre><p id="r-122708" data-claire-element-id="122708">Voilà ! :)</p><p id="r-122709" data-claire-element-id="122709">On en a fini avec ce chapitre. :) <br/> Beaucoup de ces pages vont servir presque tout le temps, et certaines seront sujettes à des modifications fréquentes, donc ne les zappez pas.</p><p id="r-122710" data-claire-element-id="122710">Allez, on attaque l'inscription.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site">Créer un espace membre pour son site</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Création d&#039;un système simple
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">Introduction</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
Un espace membre ? Kékécé ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
Présentation de la première partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
Présentation de la seconde partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
La table SQL
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">Les bases du système</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
Des pages bien utiles
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
D&#039;autres pages à inclure
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">Inscription</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
Le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
Charte et système anti-robot
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">La validation et les mails</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
Validation du formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
Un petit mail ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">TP : connexion et déconnexion</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
Prérequis et explications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
Et après ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">TP : site et profils</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
Exercice 1 - Création de statistiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
Correction de l&#039;exercice 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
Exercice 2 - Création de la page user.php
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
Correction de l&#039;exercice 2
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
<span class="arrow"></span>
<span class="next">Des pages bien utiles</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">
<span class="next">Inscription</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Inscription"></a><h2>Inscription</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
<span class="arrow"></span>
<span class="next">D&#039;autres pages à inclure</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
<span class="next">Avant de commencer</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-122714" data-claire-element-id="122714">Nous allons enfin pouvoir commencer à coder nos pages.<br/> Ici ce n'est pas très dur, c'est tout le formulaire d'inscription, alors on y va. :p</p>
</div><a name="Avantdecommencer"></a><h2>Avant de commencer</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">
<span class="arrow"></span>
<span class="next">Inscription</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
<span class="next">Le formulaire</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-avant-de-commencer-4" data-claire-element-id="122740">Avant de commencer</h4><p id="r-122715" data-claire-element-id="122715">Avant de commencer à coder notre page, vous allez, à la racine de votre site ou de votre dossier de test, créer un dossier membres, et y créer la page inscription.php ; ensuite, nous allons réfléchir ensemble à ce que nous voulons y insérer.</p><p id="r-122716" data-claire-element-id="122716">Nous voulons un formulaire contenant tous les éléments suivants :</p><ul id="r-122731" data-claire-element-id="122731"><li id="r-122718" data-claire-element-id="122718"><p id="r-122717" data-claire-element-id="122717">pseudo ;</p></li><li id="r-122720" data-claire-element-id="122720"><p id="r-122719" data-claire-element-id="122719">mot de passe ;</p></li><li id="r-122722" data-claire-element-id="122722"><p id="r-122721" data-claire-element-id="122721">confirmation du mot de passe ;</p></li><li id="r-122724" data-claire-element-id="122724"><p id="r-122723" data-claire-element-id="122723">e-mail :</p></li><li id="r-122726" data-claire-element-id="122726"><p id="r-122725" data-claire-element-id="122725">confirmation de l'e-mail ;</p></li><li id="r-122728" data-claire-element-id="122728"><p id="r-122727" data-claire-element-id="122727">date de naissance ;</p></li><li id="r-122730" data-claire-element-id="122730"><p id="r-122729" data-claire-element-id="122729">système de protection anti-robot.</p></li></ul><p id="r-122732" data-claire-element-id="122732">On pourrait se limiter à cela, mais par principe, on veut un système qui marche bien, donc on va réfléchir encore plus loin (en fait, pas tant que ça quand même). :)</p><p id="r-122733" data-claire-element-id="122733">Nous voulons que cette page serve à l'inscription ; or, un membre connecté ne peut prétendre vouloir s'inscrire.<br/> On va donc limiter l'inscription aux membres non connectés.<br/> La première idée qui nous viendrait, c'est de couper les sessions sur cette page en ne mettant pas de <code data-claire-semantic="html+php">session_start(); </code>.<br/> Cependant, pour une raison pratique, nous n'allons pas le faire, car nous allons utiliser les sessions en vue de pré-remplir les champs corrects si l'inscription échoue pour une raison quelconque, cela évitera au membre de tout retaper.</p><p id="r-122734" data-claire-element-id="122734">On va donc se baser sur une variable de session particulière qui n'existera pas si l'on n'est pas connecté : <code data-claire-semantic="html+php">$_SESSION['membre_id'] </code>.</p><p id="r-122735" data-claire-element-id="122735">Donc, cette page est interdite aux membres connectés.<br/> Par ailleurs, nous voulons éviter que les bugs puissent permettre à un membre connecté de s'inscrire, ou empêchent un membre non connecté de s'inscrire.</p><p id="r-122736" data-claire-element-id="122736">On va donc, avant de se pencher sur l'inscription, se pencher sur l'actualisation de session pour qu'il n'y ait plus que deux cas possibles :</p><p id="r-122737" data-claire-element-id="122737">1°) le membre a une session valide, il ne peut pas s'inscrire ;<br/> 2°) le membre n'a pas de session valide (il n'est pas connecté), il peut donc s'inscrire.</p><p id="r-122738" data-claire-element-id="122738">En fait, se pencher dessus, ça ne veut pas dire grand chose : on va utiliser la fonction mise en place précédemment, donc rien de stupéfiant.</p><p id="r-122739" data-claire-element-id="122739">On y va. :)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site">Créer un espace membre pour son site</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Création d&#039;un système simple
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">Introduction</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
Un espace membre ? Kékécé ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
Présentation de la première partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
Présentation de la seconde partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
La table SQL
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">Les bases du système</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
Des pages bien utiles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
D&#039;autres pages à inclure
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">Inscription</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
Le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
Charte et système anti-robot
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">La validation et les mails</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
Validation du formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
Un petit mail ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">TP : connexion et déconnexion</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
Prérequis et explications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
Et après ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">TP : site et profils</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
Exercice 1 - Création de statistiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
Correction de l&#039;exercice 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
Exercice 2 - Création de la page user.php
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
Correction de l&#039;exercice 2
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">
<span class="arrow"></span>
<span class="next">Inscription</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
<span class="next">Le formulaire</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Leformulaire"></a><h2>Le formulaire</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
<span class="arrow"></span>
<span class="next">Avant de commencer</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
<span class="next">Charte et système anti-robot</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-le-formulaire-4" data-claire-element-id="122775">Le formulaire</h4><p id="r-122741" data-claire-element-id="122741">Ça y est ! Ça y est ! :) <br/> On commence !! :D</p><p id="r-122742" data-claire-element-id="122742">Bien : pour permettre une plus grande clarté dans nos formulaires, nous allons utiliser la balise <code data-claire-semantic="html">&lt;label&gt; </code> avec la classe <code data-claire-semantic="html">float </code> que nous rajouterons dans notre CSS quand le formulaire sera fini.</p><p id="r-122743" data-claire-element-id="122743">On commence (enfin) à coder.<br/> Vous allez, dans l'ordre, ouvrir les sessions, configurer avec un header l'encodage en UTF-8 et appeler en include le fichier de configuration.</p><p id="r-122744" data-claire-element-id="122744">En dehors de l'encodage, vous savez tous faire ce que je vous demande.</p><pre id="r-122745" data-claire-element-id="122745"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page inscription.php

Permet de s'inscrire.

Quelques indications : (utiliser l'outil de recherche et rechercher les mentions données)

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations/erreurs :
--------------------------
Aucune information/erreur
--------------------------
*/

session_start();
header('Content-type: text/html; charset=utf-8');
include('../includes/config.php');
?&gt;</code></pre><p id="r-122746" data-claire-element-id="122746">Avant de faire quoi que ce soit, nous allons actualiser les sessions. Ces deux lignes de code sont assez faciles aussi. :)</p><pre id="r-122747" data-claire-element-id="122747"><code data-claire-semantic="html+php">&lt;?php
/********Actualisation de la session...**********/

include('../includes/fonctions.php');
connexionbdd();
actualiser_session();

/********Fin actualisation de session...**********/
?&gt;</code></pre><p id="r-122748" data-claire-element-id="122748">Maintenant, je veux que vous fassiez ce que je vous avais annoncé juste avant : vous allez vérifier si le visiteur est connecté ; s'il l'est, vous l'envoyez purement et simplement sur l'index (on ne va pas leur tenir la jambe avec un message d'erreur. :p ).</p><p id="r-122749" data-claire-element-id="122749">Prenez votre temps, n'affichez le code (qui utilise une fonction que vous devriez connaître) que lorsque vous aurez fini. :)</p><p id="r-122750" data-claire-element-id="122750"></p><div id="r-122752" data-claire-element-id="122752"><pre id="r-122751" data-claire-element-id="122751"><code data-claire-semantic="html+php">&lt;?php
if(isset($_SESSION['membre_id']))
{
	header('Location: '.ROOTPATH.'/index.php');
	exit();
}
?&gt;</code></pre></div><p id="r-122753" data-claire-element-id="122753">Bon : on a viré les intrus ; et si on s'occupait de ceux qui veulent venir ? :)</p><pre id="r-122754" data-claire-element-id="122754"><code data-claire-semantic="html+php">&lt;?php
/********Entête et titre de page*********/

$titre = 'Inscription 1/2';

include('../includes/haut.php'); //contient le doctype, et head.

/**********Fin entête et titre***********/
?&gt;</code></pre><aside id="r-122756" data-claire-element-id="122756" data-claire-semantic="warning"><p id="r-122755" data-claire-element-id="122755">Faites attention à inclure config.php (ce que l'on a fait ici, en gros :p ) avant d'inclure haut.php car nous utilisons la constante <code data-claire-semantic="html+php">TITRESITE </code> dans haut.php, et si elle est n'est pas définie... ça risque de ne pas aller ! :lol:</p></aside><p id="r-122757" data-claire-element-id="122757">Les trois fichiers étant inclus, nous pouvons commencer notre formulaire proprement dit. :) <br/> Commençons par la colonne de gauche :</p><pre id="r-122758" data-claire-element-id="122758"><code data-claire-semantic="html+php">&lt;!--Colonne gauche--&gt;
		&lt;div id=&quot;colonne_gauche&quot;&gt;
		&lt;?php
		include('../includes/colg.php');
		?&gt;
		&lt;/div&gt;</code></pre><p id="r-122759" data-claire-element-id="122759">Enfin, tapons notre formulaire (mais pas trop fort, parce qu'on va en avoir besoin). :)</p><p id="r-122760" data-claire-element-id="122760">Ici vous allez donc bosser un peu : je vous rappelle que la liste des choses nécessaires est en haut, n'oubliez pas le <em>sitemap</em>, ni une petite présentation de votre formulaire d'inscription. :)</p><p id="r-122761" data-claire-element-id="122761">Bon ben moi, j'vais me faire un café... :-°</p><p id="r-122762" data-claire-element-id="122762"></p><div id="r-122764" data-claire-element-id="122764"><pre id="r-122763" data-claire-element-id="122763"><code data-claire-semantic="html">&lt;!--Contenu--&gt;
		&lt;div id=&quot;contenu&quot;&gt;
			&lt;div id=&quot;map&quot;&gt;
				&lt;a href=&quot;../index.php&quot;&gt;Accueil&lt;/a&gt; =&gt; &lt;a href=&quot;inscription.php&quot;&gt;Inscription 1/2&lt;/a&gt;
			&lt;/div&gt;
			
			&lt;h1&gt;Formulaire d'inscription&lt;/h1&gt;
			&lt;p&gt;Bienvenue sur la page d'inscription de mon site !&lt;br/&gt;
			Merci de remplir ces champs pour continuer.&lt;/p&gt;
			&lt;form action=&quot;trait-inscription.php&quot; method=&quot;post&quot; name=&quot;Inscription&quot;&gt;
				&lt;fieldset&gt;&lt;legend&gt;Identifiants&lt;/legend&gt;
					&lt;label for=&quot;pseudo&quot; class=&quot;float&quot;&gt;Pseudo :&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;pseudo&quot; id=&quot;pseudo&quot; size=&quot;30&quot; /&gt; &lt;em&gt;(compris entre 3 et 32 caractères)&lt;/em&gt;&lt;br /&gt;
					&lt;label for=&quot;mdp&quot; class=&quot;float&quot;&gt;Mot de passe :&lt;/label&gt; &lt;input type=&quot;password&quot; name=&quot;mdp&quot; id=&quot;mdp&quot; size=&quot;30&quot; /&gt; &lt;em&gt;(compris entre 4 et 50 caractères)&lt;/em&gt;&lt;br /&gt;
					&lt;label for=&quot;mdp_verif&quot; class=&quot;float&quot;&gt;Mot de passe (vérification) :&lt;/label&gt; &lt;input type=&quot;password&quot; name=&quot;mdp_verif&quot; id=&quot;mdp_verif&quot; size=&quot;30&quot; /&gt;&lt;br /&gt;
					&lt;label for=&quot;mail&quot; class=&quot;float&quot;&gt;Mail :&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;mail&quot; id=&quot;mail&quot; size=&quot;30&quot; /&gt; &lt;br /&gt;
					&lt;label for=&quot;mail_verif&quot; class=&quot;float&quot;&gt;Mail (vérification) :&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;mail_verif&quot; id=&quot;mail_verif&quot; size=&quot;30&quot; /&gt;&lt;br /&gt;
					&lt;label for=&quot;date_naissance&quot; class=&quot;float&quot;&gt;Date de naissance :&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;date_naissance&quot; id=&quot;date_naissance&quot; size=&quot;30&quot; /&gt; &lt;em&gt;(format JJ/MM/AAAA)&lt;/em&gt;&lt;br/&gt;
					&lt;div class=&quot;center&quot;&gt;&lt;input type=&quot;submit&quot; value=&quot;Inscription&quot; /&gt;&lt;/div&gt;
				&lt;/fieldset&gt;
			&lt;/form&gt;
		&lt;/div&gt;</code></pre></div><p id="r-122765" data-claire-element-id="122765">Notre page est terminée ! Allez hop hop hop, on passe au traitement ! (ouuuh il a l'air pressé, lui... :-° )</p><div id="r-122767" data-claire-element-id="122767" data-claire-semantic="question"><p id="r-122766" data-claire-element-id="122766">Mais... Mais.. Et le système anti-robot ?? Tu me prends pour un idiot ?</p></div><p id="r-122768" data-claire-element-id="122768">Rah zut ! Ils s'en sont rappelés !! :( LkY, au secours, à l'aide !!!<br/> Bon, ben puisque vous y tenez tant, nous allons attaquer ce problème dans la sous-partie suivante (faut bien se faire désirer, non ? :p ).</p><p id="r-122769" data-claire-element-id="122769">Avant ça, n'oubliez pas que l'on a créé une dernière page, la page bas.php, il faut bien que l'on ferme nos pages, non ? :)</p><pre id="r-122770" data-claire-element-id="122770"><code data-claire-semantic="html+php">&lt;!--bas--&gt;
		&lt;?php
		include('../includes/bas.php');
		mysql_close();
		?&gt;</code></pre><p id="r-122771" data-claire-element-id="122771">Et voilà le travail, on peut maintenant sauvegarder notre page et afficher le tout ! ^^</p><p id="r-122772" data-claire-element-id="122772">Mais avant cela, n'oubliez pas de modifier votre CSS, hein ?</p><pre id="r-122773" data-claire-element-id="122773"><code data-claire-semantic="css">.float {
	display: block;
	width:200px;
	float:left;
}

.center {
	text-align: center;
}</code></pre><p id="r-122774" data-claire-element-id="122774">Allez hop, à la suite (enfin, entre autres), le captcha !</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site">Créer un espace membre pour son site</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Création d&#039;un système simple
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">Introduction</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
Un espace membre ? Kékécé ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
Présentation de la première partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
Présentation de la seconde partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
La table SQL
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">Les bases du système</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
Des pages bien utiles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
D&#039;autres pages à inclure
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">Inscription</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
Avant de commencer
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
Le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
Charte et système anti-robot
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">La validation et les mails</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
Validation du formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
Un petit mail ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">TP : connexion et déconnexion</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
Prérequis et explications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
Et après ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">TP : site et profils</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
Exercice 1 - Création de statistiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
Correction de l&#039;exercice 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
Exercice 2 - Création de la page user.php
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
Correction de l&#039;exercice 2
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
<span class="arrow"></span>
<span class="next">Avant de commencer</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
<span class="next">Charte et système anti-robot</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Charteetsystmeanti-robot"></a><h2>Charte et système anti-robot</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
<span class="arrow"></span>
<span class="next">Le formulaire</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">
<span class="next">La validation et les mails</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-charte-et-systeme-anti-robot" data-claire-element-id="122881">Charte et système anti-robot</h4><p id="r-122776" data-claire-element-id="122776">Bon : alors déjà, avant de nous lancer ensemble dans la création d'un système permettant de bloquer les robots publicitaires, j'aimerais clarifier deux points.</p><p id="r-122777" data-claire-element-id="122777">Premièrement, il n'y a pas de meilleure protection qu'une protection innovante ; les captchas, ce n'est pas mal, mais malheureusement, plus on avance, moins c'est bien car les gens qui créent des bots les améliorent pour contourner les captchas.</p><p id="r-122778" data-claire-element-id="122778">Ainsi, je vais vous proposer deux systèmes, que vous pourrez combiner, mais indépendants l'un de l'autre : un système de charte avec QCM à remplir, comme celui qu'il y a eu pendant un moment sur le SdZ, qui sera moins performant je pense, mais qui bloquera les robots qui n'ont pas été programmés spécialement pour attaquer votre site ; le deuxième système sera un captcha, que je vous invite fortement à modifier comme il vous convient ; je le fais pour vous permettre de vous plonger dans GD et vous entraîner à la manipulation d'images.</p><p id="r-122779" data-claire-element-id="122779">Deuxièmement, il n'existe aucune protection incontournable, ne serait-ce que parce que derrière le bot qui vous attaque, il y a un humain pour le créer, donc quelqu'un qui pense et s'adapte, qui peut même, pour contourner le captcha, s'inscrire lui-même et ensuite filer les commandes au robot.<br/> Dans cette logique, je vous invite à ne pas devenir paranoïaque, tout en laissant un niveau de protection correct. Ne vous enfermez pas dans des programmes flash ultra-sophistiqués où il faut faire trois cercles autour de trois carrés (j'ai dit sophistiqué ?), c'est complètement inutile...</p><p id="r-122780" data-claire-element-id="122780">Enfin, n'oubliez pas qu'il y a des mal-voyants et des non-voyants qui surfent comme ils peuvent sur le net, et qu'il est indispensable de penser à eux : donc, si captcha vous mettez, vous devrez aussi mettre soit un captcha audio, soit un e-mail ou lien pour vous contacter de façon qu'ils puissent, eux aussi, s'inscrire chez vous.</p><p id="r-122781" data-claire-element-id="122781">Après ces belles paroles (en toute modestie, je m'épate parfois :p ), lançons-nous dans le système charte / questions.</p><h5 id="r-si-tu-as-lu-le-reglement-tu-peux-t-inscrire" data-claire-element-id="122812">Si tu as lu le règlement, tu peux t'inscrire</h5><p id="r-122782" data-claire-element-id="122782">Bon, au boulot (vous, pas moi :p ) : vous allez me virer le bouton <code data-claire-semantic="html">submit </code>, me fermer le <code data-claire-semantic="html">fieldset </code>, m'en ouvrir un avec comme légende <em>charte du site et protection anti-robot</em>, m'inclure un fichier charte.php et, à la suite, mettre un système anti-robot (le formulaire, un message d'explication, et l'image avec comme source captcha.php) dont on s'occupera plus tard. Fermez enfin le <code data-claire-semantic="html">fieldset </code> et mettez le bouton <code data-claire-semantic="html">submit </code>, le tout en une minute et 25 secondes (et douze centièmes :-° ).</p><div id="r-122784" data-claire-element-id="122784" data-claire-semantic="question"><p id="r-122783" data-claire-element-id="122783">Eh eh oh ! Tu vas trop vite là ! Tu peux répéter ?</p></div><p id="r-122785" data-claire-element-id="122785">Ben quoi ? Ce n'est pas encore fini ?! Au boulot, tout de suite !<br/> Voilà la correction :</p><div id="r-122787" data-claire-element-id="122787"><pre id="r-122786" data-claire-element-id="122786"><code data-claire-semantic="html+php">&lt;!-- Formulaire mis à jour : --&gt;
			&lt;form action=&quot;trait-inscription.php&quot; method=&quot;post&quot; name=&quot;Inscription&quot;&gt;
				&lt;fieldset&gt;&lt;legend&gt;Identifiants&lt;/legend&gt;
					&lt;label for=&quot;pseudo&quot; class=&quot;float&quot;&gt;Pseudo :&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;pseudo&quot; id=&quot;pseudo&quot; size=&quot;30&quot; /&gt; &lt;em&gt;(compris entre 3 et 32 caractères)&lt;/em&gt;&lt;br /&gt;
					&lt;label for=&quot;mdp&quot; class=&quot;float&quot;&gt;Mot de passe :&lt;/label&gt; &lt;input type=&quot;password&quot; name=&quot;mdp&quot; id=&quot;mdp&quot; size=&quot;30&quot; /&gt; &lt;em&gt;(compris entre 4 et 50 caractères)&lt;/em&gt;&lt;br /&gt;
					&lt;label for=&quot;mdp_verif&quot; class=&quot;float&quot;&gt;Mot de passe (vérification) :&lt;/label&gt; &lt;input type=&quot;password&quot; name=&quot;mdp_verif&quot; id=&quot;mdp_verif&quot; size=&quot;30&quot; /&gt;&lt;br /&gt;
					&lt;label for=&quot;mail&quot; class=&quot;float&quot;&gt;Mail :&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;mail&quot; id=&quot;mail&quot; size=&quot;30&quot; /&gt; &lt;br /&gt;
					&lt;label for=&quot;mail_verif&quot; class=&quot;float&quot;&gt;Mail (vérification) :&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;mail_verif&quot; id=&quot;mail_verif&quot; size=&quot;30&quot; /&gt;&lt;br /&gt;
					&lt;label for=&quot;date_naissance&quot; class=&quot;float&quot;&gt;Date de naissance :&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;date_naissance&quot; id=&quot;date_naissance&quot; size=&quot;30&quot; /&gt; &lt;em&gt;(format JJ/MM/AAAA)&lt;/em&gt;&lt;br/&gt;
				&lt;/fieldset&gt;
				&lt;fieldset&gt;&lt;legend&gt;Charte du site et protection anti-robot&lt;/legend&gt;
					&lt;?php
					include('../includes/charte.php');
					?&gt;
					
					&lt;h1&gt;Système anti-robot :&lt;/h1&gt;
					
					&lt;p&gt;Qu'est-ce que c'est ?&lt;br/&gt;
					Pour lutter contre l'inscription non désirée de robots qui publient du contenu non désiré sur les sites web,
					nous avons décidé de mettre en place un systèle de sécurité.&lt;br/&gt;
					Aucun de ces systèmes n'est parfait, mais nous espérons que celui-ci, sans vous être inacessible sera suffisant
					pour lutter contre ces robots.&lt;br/&gt;
					Il est possible que certaines fois, l'image soit trop dure à lire ; le cas échéant, actualisez la page jusqu'à avoir une image lisible.&lt;br/&gt;
					Si vous êtes dans l'incapacité de lire plusieurs images d'affilée, &lt;a href=&quot;../contact.php&quot;&gt;contactez-nous&lt;/a&gt;, nous nous occuperons de votre inscription.&lt;/p&gt;
					&lt;label for=&quot;captcha&quot; class=&quot;float&quot;&gt;Entrez les 8 caractères (majuscules ou chiffres) contenus dans l'image :&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;captcha&quot; id=&quot;captcha&quot;&gt;&lt;br/&gt;
					&lt;img src=&quot;captcha.php&quot; /&gt;
				&lt;/fieldset&gt;
				&lt;div class=&quot;center&quot;&gt;&lt;input type=&quot;submit&quot; value=&quot;Inscription&quot; /&gt;&lt;/div&gt;
			&lt;/form&gt;</code></pre></div><p id="r-122788" data-claire-element-id="122788">Laissez tomber captcha.php et tout ce qui gravite autour pour le moment, occupons-nous de la charte.</p><p id="r-122789" data-claire-element-id="122789">Ah tenez, tant qu'à faire, moi je trouve que ces <code data-claire-semantic="html">input </code> sont bien laids. :D</p><p id="r-122790" data-claire-element-id="122790">Vous allez ( :-° ) Nous allons améliorer tout ça. :)</p><pre id="r-122791" data-claire-element-id="122791"><code data-claire-semantic="css">input[type=&quot;submit&quot;], input[type=&quot;button&quot;]	{
	background-color: #CDF0F0;
	color: black;
	border: 1px outset black;
}

input[type=&quot;text&quot;]:focus, input[type=&quot;password&quot;]:focus {
	background-color: #CDF0F0;
	color: black;
}</code></pre><p id="r-122792" data-claire-element-id="122792">Je ne pouvais pas vous demander de les connaître, ces propriétés CSS pour ces balises, mais voilà : elles existent. :) <br/> Sachez cependant qu'Internet Explorer a du mal avec l'indicateur <code data-claire-semantic="css">:focus </code> et que, du coup, nos champs d'entrée ne seront pas colorés quand on cliquera dessus avec IE 7 ou antérieur (mais FF et Opéra supportent très bien ça :) , espérons qu'IE8 saura faire de même...).</p><p id="r-122793" data-claire-element-id="122793">Ici pas de mystère : on va créer charte.php dans les includes (si, si, j'vous jure, vous avez un dossier includes), et vous allez y mettre ce que vous voulez.<br/> Quant à moi, je vous propose ça : soyez indulgents, j'ai écrit ça tard hier et sans aucune inspiration. :p</p><p id="r-122794" data-claire-element-id="122794"></p><div id="r-122796" data-claire-element-id="122796"><pre id="r-122795" data-claire-element-id="122795"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page charte.php

Contient la charte et génère le QCM qui va avec.

Quelques indications : (utiliser l'outil de recherche et rechercher les mentions données)

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations/erreurs :
--------------------------
Aucune information/erreur
--------------------------
*/
?&gt;
					&lt;div id=&quot;charte&quot;&gt;
						&lt;h1&gt;La charte de mon site :&lt;/h1&gt;
						&lt;p&gt;Ce site contient un espace membres, un forum, un système de news ainsi que d'autres modules.&lt;br/&gt;
						En vous inscrivant, vous reconnaissez avoir pris connaissance de cette charte et l'avoir acceptée.
						Si tel n'est pas le cas, vous ne pouvez vous inscrire.&lt;/p&gt;&lt;br/&gt;
						
						&lt;div class=&quot;chartecat&quot;&gt;Règlement Général du site&lt;/div&gt;&lt;br/&gt;
						&lt;p&gt;Ce site et toutes ses pages sont soummis à la loi française, par conséquent, il est interdit
						d'y tenir des propos ou d'y publier du contenu illégal aux yeux de la loi, sont considérés illégaux entres
						autres les contenus suivants : contenu à caractère raciste, contenu diffamatoire, contenu incitant à la haine,
						à la violence, contenu expliquant comment pirater (i.e. : à des fins néfastes ou non), contenu violant les droits
						d'auteur.&lt;br/&gt;
						À cette liste non exhaustive vient s'ajouter l'interdiction de publier du contenu à caractère sexuel.&lt;br/&gt;
						Cette liste étant non exhaustive, nous faisons appel à votre bon sens pour discerner ce que vous pouvez publier
						et / ou dire de ce que vous ne pouvez publier / dire.&lt;br/&gt;
						Les propos insultants, dégradants, agressifs ou tout comportement néfaste à une ambiance correcte sur l'ensemble
						du site sont interdits.&lt;br/&gt;
						Le thème de ce site n'est pas restreint, bien que les technologies de l'information soient le thème principal, libre
						à vous de parler de couture si ça vous chante, mais n'espérez pas trouver autant d'adeptes de la couture que de la
						programmation ici.&lt;br/&gt;
						Les forums sont un espace de discussion important pour un site à caractère communautaire, surtout s'il est centré
						sur l'informatique, mais c'est aussi un espace d'entraide, par conséquent, n'hésitez pas à y poser vos questions si
						vous en avez, cependant, pensez à faire une recherche avant de poster une question, peut-être que la question a déjà été posée par
						un autre membre, et de plus, votre sujet devra avoir un titre clair et concis.&lt;br/&gt;
						Partout sur le site, vous devrez écrire dans un français correct, toute forme de langage SMS (abrégé) est interdite.&lt;br/&gt;
						Il est important de noter que pour votre confort, et le nôtre, le forum est surveillé par une équipe de modération
						bénévole, qui peut être ammenée à sanctionner tout membre enfreignant le règlement, ceci allant de l'avertissement
						à l'interdiction d'accéder au site.&lt;br/&gt;
						La messagerie privée est, comme son nom l'indique, privée. Cependant, vous acceptez l'idée que vous, ou votre / vos
						interlocuteur(s) puisse(nt), à tout moment, demander à l'équipe de modération du site de lire votre échange avec
						lui / eux en cas de problème.&lt;br/&gt;
						Vous reconnaissez que ce site est la propriété de son créateur, qui est, par conséquent libre de faire ce
						qu'il veut de celui-ci, tout en respectant le caractère privé des informations que vous, ou tout autre membre, lui donnez en vous
						inscrivant et en utilisant le site.&lt;br/&gt;
						Vous êtes donc propriétaire de votre compte et responsable de celui-ci (ainsi que des propos tenus avec), vous pouvez
						à tout moment demander sa suppression. Veuillez noter qu'à aucun moment, l'équipe du site ne vous demandera votre mot
						de passe.&lt;br/&gt;
						
						Fin (ben ouais, vous y mettez ce que vous voulez dans votre charte, mais à 2h du mat, moi ça me barbe de continuer ;
						en plus, c'est pas terrible. ^^ )
						&lt;/p&gt;
					&lt;/div&gt;</code></pre></div><p id="r-122797" data-claire-element-id="122797">Bon ok ça pue, mais au moins, on peut faire un QCM maintenant, et il ne tient qu'à vous de modifier tout ça. :p</p><aside id="r-122799" data-claire-element-id="122799" data-claire-semantic="information"><p id="r-122798" data-claire-element-id="122798">J'ai mis en place la charte en HTML et non dans la BDD parce que j'estime qu'un texte comme celui-là n'a pas sa place en BDD : vous pouvez faire comme vous voulez, même créer charte.code, mettre tout le contenu formaté en bbcode et l'afficher, mais j'estime ça important de vous désolidariser de SQL quand il s'agit de textes très peu modifiés.<br/> Quant au QCM, j'ai préféré le mettre dans la page charte au lieu de le mettre en BDD : c'est complètement débile, car la modification est plus longue sur la page que dans une page d'administration, mais ici, on veut un système simple, on retouchera le QCM en partie II, et il finira dans la BDD, c'est promis. :p</p></aside><p id="r-122800" data-claire-element-id="122800">D'ailleurs, en parlant de QCM, on va s'y attaquer tout de suite. :) <br/> Premièrement, notre array de questions / réponses justes / réponses fausses, vous pouvez le faire vous-mêmes ; je précise juste que j'ai fait un Array d'Arrays.<br/> Je vous propose ça, mais chacun fait comme il veut. :)</p><div id="r-122802" data-claire-element-id="122802"><pre id="r-122801" data-claire-element-id="122801"><code data-claire-semantic="html+php">&lt;div id=&quot;qcm&quot;&gt;
						&lt;h1&gt;Questionnaire sur la charte :&lt;/h1&gt;
						&lt;p&gt;Pous nous assurer que vous avez lu le règlement, ou du moins que vous avez du bon sens,
						voici un questionnaire à remplir. (Le remplir signifie accepter la charte.)
						&lt;/p&gt;
&lt;?php
/*QCM CHARTE*/
$questions = Array();
$questions[] = Array('A qui appartient ce site ?', 'Son créateur', 'Vous', 'L\'hébergeur web du site', 'À personne', 'Je ne sais pas', 1);
$questions[] = Array('Que faut-il faire avant de poser une question sur les forums ?', 'Rien', 'Demander à son voisin s\'il a la réponse', 'Une recherche sur le site', 'Consulter Google', 'Je ne sais pas', 3);
$questions[] = Array('Vous pouvez supprimer votre compte...', 'quand vous voulez', 'quand vous voulez en le demandant à un administrateur', 'seulement le mardi', 'seulement si vous ne respectez pas le règlement', 'Je ne sais pas', 2);
$questions[] = Array('Quel titre de sujet convient ?', 'PC en carton plante tout le temps', 'Grrrrrrrrr!!!! Quelqu\'un a un marteau ?', 'A l\'aiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiide !!', '[Windows] Plantage système au démarrage', 'Je ne sais pas', 4);
$questions[] = Array('Qui surveille les forums ?', 'L\'équipe de modération', 'Les administrateurs', 'L\'hébergeur web du site', 'Il se surveille tout seul', 'Je ne sais pas', 1);
$questions[] = Array('Quel sujet n\'est pas légal ?', '[SONDAGE] Vous lavez-vous souvent les cheveux ?', '[HOTMAIL] Contourner le filtre anti-spam', 'La nouvelle loi Hadopi, la fin du P2P en France ?', 'Topic flood !', 'Je ne sais pas', 2);
$questions[] = Array('Si quelqu\'un vous demande votre mot de passe...', 'il n\'est pas membre de l\'équipe du site', 'c\'est qu\'il est curieux', 'vous lui donnez', 'vous lui demandez le sien en échange', 'Je ne sais pas', 1);
$questions[] = Array('Quel langage est interdit sur ce site ?', 'L\'anglais', 'L\'allemand', 'Le braille', 'Le SMS', 'Je ne sais pas', 4);
$questions[] = Array('En vous inscrivant vous reconnaissez', 'être fan du site', 'aimer le chocolat', 'avoir accepté la charte', 'être bête', 'Je ne sais pas', 3);
$Tquestions = count($questions);
?&gt;</code></pre></div><aside id="r-122804" data-claire-element-id="122804" data-claire-semantic="warning"><p id="r-122803" data-claire-element-id="122803">Chaque sous-array contient en entrée 0 la question et en entrée 6, le numéro de l'entrée contenant la bonne réponse : c'est comme ça que ça marche dans ce système (que je reconnais non optimisé, la BDD serait mieux je suis d'accord, mais ici c'est comme ça, na !).</p></aside><p id="r-122805" data-claire-element-id="122805">Bon, ben du coup, en vous basant sur votre QCM et moi sur le mien, je vous propose de sélectionner trois questions au hasard (utilisez <code data-claire-semantic="html+php"><a href="http://fr3.php.net/manual/fr/function.mt-rand.php">mt_rand() </a></code>) (ou plus si vous y tenez :p ) que l'on va stocker dans un array qui servira à l'affichage (je rappelle que je suis conscient qu'il y a des méthodes plus sympas, mais celle-ci est accessible sans difficultés).</p><p id="r-122806" data-claire-element-id="122806"></p><div id="r-122808" data-claire-element-id="122808"><pre id="r-122807" data-claire-element-id="122807"><code data-claire-semantic="html+php">&lt;?php
$locate = Array();
$i=1;

while($i&lt;=3)
{
	$k = $questions[mt_rand(0,$Tquestions-1)];
	while(in_array($k, $locate))
	{
		$k = $questions[mt_rand(0,$Tquestions-1)];
	}
	$locate[] = $k;
	$i++;
}
?&gt;</code></pre></div><p id="r-122809" data-claire-element-id="122809">Et maintenant l'affichage, en n'oubliant pas de créer les variables de session <code data-claire-semantic="html+php">reponse1 </code>, <code data-claire-semantic="html+php">reponse2 </code> et <code data-claire-semantic="html+php">reponse3 </code> qui contiennent le numéro de la réponse :</p><pre id="r-122810" data-claire-element-id="122810"><code data-claire-semantic="html+php">&lt;!--Affichage--&gt;
&lt;?php
$i=1;
while($i&lt;=3)
{
	$_SESSION['reponse'.$i] = $locate[$i-1][6];
?&gt;
						&lt;span class=&quot;question&quot;&gt;&lt;?php echo $locate[$i-1][0]; ?&gt;&lt;/span&gt;&lt;br/&gt;
						&lt;input type=&quot;radio&quot; name=&quot;reponse&lt;?php echo $i; ?&gt;&quot; value=&quot;1&quot; id=&quot;&lt;?php echo $i; ?&gt;1&quot; /&gt; &lt;label for=&quot;&lt;?php echo $i; ?&gt;1&quot;&gt;&lt;?php echo $locate[$i-1][1]; ?&gt;&lt;/label&gt;&lt;br /&gt;
						&lt;input type=&quot;radio&quot; name=&quot;reponse&lt;?php echo $i; ?&gt;&quot; value=&quot;2&quot; id=&quot;&lt;?php echo $i; ?&gt;2&quot; /&gt; &lt;label for=&quot;&lt;?php echo $i; ?&gt;2&quot;&gt;&lt;?php echo $locate[$i-1][2]; ?&gt;&lt;/label&gt;&lt;br /&gt;
						&lt;input type=&quot;radio&quot; name=&quot;reponse&lt;?php echo $i; ?&gt;&quot; value=&quot;3&quot; id=&quot;&lt;?php echo $i; ?&gt;3&quot; /&gt; &lt;label for=&quot;&lt;?php echo $i; ?&gt;3&quot;&gt;&lt;?php echo $locate[$i-1][3]; ?&gt;&lt;/label&gt;&lt;br /&gt;
						&lt;input type=&quot;radio&quot; name=&quot;reponse&lt;?php echo $i; ?&gt;&quot; value=&quot;4&quot; id=&quot;&lt;?php echo $i; ?&gt;4&quot; /&gt; &lt;label for=&quot;&lt;?php echo $i; ?&gt;4&quot;&gt;&lt;?php echo $locate[$i-1][4]; ?&gt;&lt;/label&gt;&lt;br /&gt;
						&lt;input type=&quot;radio&quot; name=&quot;reponse&lt;?php echo $i; ?&gt;&quot; value=&quot;5&quot; id=&quot;&lt;?php echo $i; ?&gt;5&quot; /&gt; &lt;label for=&quot;&lt;?php echo $i; ?&gt;5&quot;&gt;&lt;?php echo $locate[$i-1][5]; ?&gt;&lt;/label&gt;&lt;br /&gt;
&lt;?php
	$i++;
}
?&gt;
					&lt;/div&gt;</code></pre><p id="r-122811" data-claire-element-id="122811">Vous pouvez tester, notre QCM est fin prêt, et vous aurez tout le temps de le constater en l'essayant. :) <br/> N'oubliez pas : dans la partie II on fera mieux, mais là, j'ai voulu éviter la création d'une table supplémentaire dans la BDD, parce qu'on sait tous qu'il y a des gens qui n'aiment pas SQL dans le coin. :-°</p><h5 id="r-si-tu-arrives-a-me-decoder-tu-peux-entrer" data-claire-element-id="122880">Si tu arrives à me décoder, tu peux entrer</h5><p id="r-122813" data-claire-element-id="122813">Avant de nous attaquer aux captchas, trois choses.</p><p id="r-122814" data-claire-element-id="122814">Premièrement, il y a un tuto entièrement dédié aux <a href="http://www.siteduzero.com/tutoriel-3-56201-les-captchas-anti-bot.html">captchas</a> ici. :) Allez y faire un tour !<br/> Deuxièmement, vous devriez peut-être revoir <a href="http://www.siteduzero.com/tutoriel-3-14597-0-creer-des-images-en-php.html">le cours de M@teo sur GD</a>, et troisièmement, vous devrez probablement vous fournir en polices.<br/> Une police - petit rappel - est une apparence pour le texte : il en existe des milliers ; vous connaissez probablement arial, verdana, georgia, times new roman et d'autres, mais pour les captchas, elles ne sont pas top.</p><p id="r-122815" data-claire-element-id="122815">Aussi, pour vous fournir, je vous conseille de visiter <a href="http://www.font-police.com/">ce</a> site ou <a href="http://www.dafont.com/fr/">celui-là</a> (que je ne connaissais pas, je l'ai trouvé dans le cours pour apprendre le langage C) et de privilégier les polices avec des caractères non remplis pour pouvoir faire de la superposition de caractères (entre autres, je sais pas si elle s'y trouve, mais pour <a href="http://www.siteduzero.com/forum-83-170810-2286702-galerie-realisation-de-captchas.html#r2286702">son captcha</a>, Tracker a utilisé Basic Font il me semble, et ça rend plutôt bien ; malheureusement, l'image n'est plus affichée sur le sujet).<br/> Pour ma part, je n'en ai pris qu'une : <a href="http://www.font-police.com/affiche.php?a=habiller&amp;b=graf&amp;c=baveuse3d.ttf">baveuse3d</a>.</p><p id="r-122816" data-claire-element-id="122816">Je vous conseille grandement d'en prendre plusieurs (donc, de ne pas faire comme moi), mais après avoir lu cette partie du chapitre, vous saurez faire plein de captchas. Pour ma part je suis arrivé à ça, et je ne suis pas trop mécontent de moi. :p</p><figure id="r-122818" data-claire-element-id="122819"><img id="r-122817" data-claire-element-id="122817" src="medias/uploads.siteduzero.com_files_201001_202000_201239.png" alt="Image utilisateur"/></figure><p id="r-122820" data-claire-element-id="122820">C'est parfois (souvent ?) un peu dur à lire, mais il semble que les caractères superposés soient un fléau pour les bots spammeurs ; donc, sans vous inciter à faire illisible ou comme moi (donc illisible :p ), je vous invite à essayer de faire un captcha utilisant ce principe de superposition de lettres non remplies.</p><p id="r-122821" data-claire-element-id="122821">Téléchargez les polices qui vous intéressent (vous pouvez aussi, pour ceux qui utilisent Windows en trouver dans C:\WINDOWS\Fonts, mais l'option copier avec le clic droit de la souris est désactivée dans ce dossier, utilisez CTRL + C). Une fois le plein de polices fait, créez dans le dossier membres le dossier polices.</p><p id="r-122822" data-claire-element-id="122822"></p><div id="r-122829" data-claire-element-id="122829"><p id="r-122823" data-claire-element-id="122823">Création du répertoire &quot;polices&quot; en cours...</p><p id="r-122824" data-claire-element-id="122824">10%...</p><p id="r-122825" data-claire-element-id="122825">40%...</p><p id="r-122826" data-claire-element-id="122826">90%...<br/> 99.1%...<br/> 99.2%...<br/> 99.8%...<br/> 99.85%...<br/> ...<br/> Répertoire &quot;polices&quot; créé.</p><p id="r-122827" data-claire-element-id="122827">Waaaahhhh le bluff de fou, comment j't'ai trop eu :lol:</p><p id="r-122828" data-claire-element-id="122828">Euhm.. Huum, passons... :-°</p></div><p id="r-122830" data-claire-element-id="122830">Bon c'est pas tout ça, mais si on parlait de GD et qu'on refaisait ensemble mon code (que je vous invite à modifier !!) ?</p><p id="r-122831" data-claire-element-id="122831">Une chose importante à savoir, c'est que, encore plus qu'en temps normal, PHP n'aime pas les erreurs dans la manipulation d'images.<br/> Il est donc important de savoir faire le moins d'erreurs possible quand on touche à GD, parce que sinon, ça peut vite devenir un bordel sans nom et vous dégoûter des captchas à vie. ^^</p><p id="r-122832" data-claire-element-id="122832">Donc, créez dans votre dossier membres (toujours ^^ ), le fichier captcha.php.</p><p id="r-122833" data-claire-element-id="122833">Premièrement, on va ouvrir les sessions et déclarer notre image, c'est là qu'on va voir qui se rappelle encore du tuto de M@teo :</p><pre id="r-122834" data-claire-element-id="122834"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page captcha.php

Génère un captcha.

Quelques indications : (utiliser l'outil de recherche et rechercher les mentions données)

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations/erreurs :
--------------------------
Aucune information/erreur
--------------------------
*/

session_start();
header (&quot;Content-type: image/png&quot;);
$image = imagecreate(320, 100);
?&gt;</code></pre><p id="r-122835" data-claire-element-id="122835">Ensuite, on va déclarer une panoplie de couleurs via <code data-claire-semantic="html+php"><a href="http://fr3.php.net/manual/fr/function.imagecolorallocate.php">imagecolorallocate() </a></code>.<br/> Pour ma part, je veux un fond blanc, donc je dois déclarer <code data-claire-semantic="html+php">$blanc </code> en premier. :p</p><p id="r-122836" data-claire-element-id="122836">Ici pas de secret : soit vous connaissez vos couleurs, soit vous ne les connaissez pas.</p><pre id="r-122837" data-claire-element-id="122837"><code data-claire-semantic="html+php">&lt;?php
$blanc = imagecolorallocate($image, 255, 255, 255);
$noir = imagecolorallocate($image, 0, 0, 0);
$gris = imagecolorallocate($image, 200,200,200);
$jaune = imagecolorallocate($image, 255, 255, 0);
$rouge = imagecolorallocate($image, 200, 39, 45);
$vert = imagecolorallocate($image, 45, 255, 39);
$cyan = imagecolorallocate($image, 0, 255, 255);
$magenta = imagecolorallocate($image, 200, 0, 200);
$orange = imagecolorallocate($image, 255, 160, 0);
$bleu = imagecolorallocate($image, 60, 75, 200);
$bleuclair = imagecolorallocate($image, 156, 227, 254);
$vertf = imagecolorallocate($image, 20, 140, 17);

/*$Anoir = imagecolorallocatealpha($image, 0, 0, 0, 80);
$Ajaune = imagecolorallocatealpha($image, 255, 255, 0, 80);
$Ablanc = imagecolorallocatealpha($image, 255, 255, 255, 80);
$Arouge = imagecolorallocatealpha($image, 200, 39, 45, 80);
$Avert = imagecolorallocatealpha($image, 45, 200, 39, 80);
$Acyan = imagecolorallocatealpha($image, 0, 255, 255, 80);
$Amagenta = imagecolorallocatealpha($image, 255, 0, 255, 80);
$Aorange = imagecolorallocatealpha($image, 255, 128, 0, 80);
$Ableu = imagecolorallocatealpha($image, 39, 45, 200, 80);
$Ableuclair = imagecolorallocatealpha($image, 156, 227, 254, 80);

$A2noir = imagecolorallocatealpha($image, 0, 0, 0, 25);
$A2jaune = imagecolorallocatealpha($image, 255, 255, 0, 25);
$A2blanc = imagecolorallocatealpha($image, 255, 255, 255, 25);
$A2rouge = imagecolorallocatealpha($image, 200, 39, 45, 25);
$A2vert = imagecolorallocatealpha($image, 45, 200, 39, 25);
$A2cyan = imagecolorallocatealpha($image, 0, 255, 255, 25);
$A2magenta = imagecolorallocatealpha($image, 255, 0, 255, 25);
$A2orange = imagecolorallocatealpha($image, 255, 128, 0, 25);
$A2bleu = imagecolorallocatealpha($image, 39, 45, 200, 25);
$A2bleuclair = imagecolorallocatealpha($image, 156, 227, 254, 25);*/
?&gt;</code></pre><p id="r-122838" data-claire-element-id="122838">Notez qu'en commentaire, il y a, à peu près, les mêmes couleurs déclarées avec des niveaux de transparence en plus (sauf le gris et le vert foncé qui sont venus plus tard, quand je me suis rendu compte que je n'utiliserai pas de couleur transparente :p ).</p><p id="r-122839" data-claire-element-id="122839">Vous allez me faire un <code data-claire-semantic="html+php">array </code> des couleurs normales, et si vous voulez, deux autres des couleurs en commentaire (que vous penserez à dé-commenter si vous voulez pas avoir un bug :lol: ).</p><pre id="r-122840" data-claire-element-id="122840"><code data-claire-semantic="html+php">&lt;?php
//Toutes les couleurs
$colors = Array($vert, $noir, $jaune, $blanc, $rouge, $cyan, $magenta, $orange, $bleu, $bleuclair, $gris, $vertf);
$Tcolors = count($colors);

/*$colors2 = Array($Avert, $Anoir, $Ajaune, $Ablanc, $Arouge, $Acyan, $Amagenta, $Aorange, $Ableu, $Ableuclair);
$Tcolors2 = count($colors2);
$colors3 = Array($A2vert, $A2noir, $A2jaune, $A2blanc, $A2rouge, $A2cyan, $A2magenta, $A2orange, $A2bleu, $A2bleuclair);
$Tcolors3 = count($colors3);*/</code></pre><p id="r-122841" data-claire-element-id="122841">Enfin, vous allez créer un array des couleurs lisibles, c'est-à-dire des couleurs que PHP peut utiliser pour colorer les caractères du captcha ; par exemple, dans ces couleurs, on ne mettra pas le jaune si on est sur fond blanc, parce que sinon, vous allez casser les yeux de beaucoup de monde.<br/> Justement (quelle coïncidence ^^ ) je suis sur fond blanc, mon array va donc ressembler à ça :</p><pre id="r-122842" data-claire-element-id="122842"><code data-claire-semantic="html+php">&lt;?php
//couleurs autorisées pour les caractères
$Lcolors = Array($noir, $rouge, $magenta, $bleu, $vertf);
$TLcolors = count($Lcolors);
?&gt;</code></pre><p id="r-122843" data-claire-element-id="122843">Bon, nous avons tout ce que l'on veut comme couleurs ; maintenant, on va s'occuper de la police (ou des polices, tout dépend de vous), et des caractères autorisés.</p><p id="r-122844" data-claire-element-id="122844">Vous allez définir un <code data-claire-semantic="html+php">array </code> contenant les noms de vos polices, ainsi qu'une variable définissant les caractères autorisés (pensez à définir leur intervalle de taille avec des variables ; si vous avez le même intervalle pour toutes les polices, ce n'est pas nécessaire).</p><pre id="r-122845" data-claire-element-id="122845"><code data-claire-semantic="html+php">&lt;?php
$polices = Array('baveuse3d'); //Pensez à en rajouter !!
$Tpolices = count($polices);

//définition des caractères autorisés.
$carac = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
$Tcarac = strlen($carac);
?&gt;</code></pre><p id="r-122846" data-claire-element-id="122846">Maintenant, nous décorer le captcha avec lignes, ellipses et triangles colorés, dites-vous bien que cela ne gêne pas vraiment un bot, car souvent, un simple flou gaussien suffit à les &quot;effacer&quot; tout en gardant les lettres. Mais déjà avec ça, un captcha c'est moins vide, et puis n'oublions pas que nos caractères n'étant pas remplis, un flou gaussien peut compliquer leur lecture par une machine. :)</p><p id="r-122847" data-claire-element-id="122847">Donc quatre opérations à faire.<br/> Première opération, ajouter des lignes noires (et que des noires).<br/> Deuxième opération, ajouter des lignes dont la couleur sera aléatoire.<br/> Troisième opération, ajouter des ellipses dont la couleur sera aléatoire.<br/> Quatrième opération, ajouter des triangles dont la couleur sera aléatoire.</p><p id="r-122848" data-claire-element-id="122848">La position de ces formes devra être pseudo-aléatoire : les lignes traverseront le captcha, les ellipses auront leur centre dans le captcha ; les triangles, eux, ben faites comme vous le sentez. ^^</p><p id="r-122849" data-claire-element-id="122849">Quelques rappels : on utilise <code data-claire-semantic="html+php">mt_rand() </code> pour les nombres aléatoires, les lignes se font avec la fonction <code data-claire-semantic="html+php"><a href="http://fr3.php.net/manual/fr/function.imageline.php">ImageLine() </a></code>, les ellipses avec <code data-claire-semantic="html+php"><a href="http://fr3.php.net/manual/fr/function.imageellipse.php">ImageEllipse() </a></code>, et les triangles avec <code data-claire-semantic="html+php"><a href="http://fr3.php.net/manual/fr/function.imagepolygon.php">ImagePolygon() </a></code>.</p><p id="r-122850" data-claire-element-id="122850">Le nombre de chacune de ces formes sera aléatoire, mais restreint.</p><p id="r-122851" data-claire-element-id="122851">Maintenant c'est à vous de jouer, tout ce que je vous ai donné devrait vous suffire. :)</p><p id="r-122852" data-claire-element-id="122852">Voici ce que vous devriez avoir (excepté niveau nombres, chacun ses notions en terme d'intervalle de nombre restreint :p (que l'imbécile qui a mis pour i allant de 1 à 15524.3 se dénonce !) ) :</p><div id="r-122854" data-claire-element-id="122854"><pre id="r-122853" data-claire-element-id="122853"><code data-claire-semantic="html+php">&lt;?php
//définition des lignes noires
$nb_lignes = mt_rand(3,7);
$i = 1;
while($i&lt;=$nb_lignes)
{
	ImageLine($image, mt_rand(0,40), mt_rand(0,100), mt_rand(280, 320), mt_rand(0,100), $noir);
	$i++;
}

//définition des lignes colorées.
$nb_lignes = mt_rand(3,7);
$i = 1;
while($i&lt;=$nb_lignes)
{
	ImageLine($image, mt_rand(0,40), mt_rand(0,100), mt_rand(280,320), mt_rand(0,100), $colors[mt_rand(0,$Tcolors-1)]);
	$i++;
}

//définition des ellipses
$nb_ellipses = mt_rand(1,6);
$i = 1;
while($i&lt;= $nb_ellipses)
{
	ImageEllipse($image, mt_rand(0,320), mt_rand(0,100), 25+mt_rand(0,15), 25+mt_rand(0,15), $colors[mt_rand(0,$Tcolors-1)]);
	$i++;
}

//définition des triangles
$nb_triangles = mt_rand(1,6);
$i = 1;
while($i&lt;=$nb_triangles)
{
	$array = Array(mt_rand(0,300), mt_rand(0,100), mt_rand(0,300), mt_rand(0,100), mt_rand(0,300), mt_rand(0,100));
	ImagePolygon($image, $array, 3, $colors[mt_rand(0,$Tcolors-1)]);
	$i++;
}
?&gt;</code></pre></div><p id="r-122855" data-claire-element-id="122855">Si vous ne comprenez pas, je vous renvoie au cours de M@teo et à la doc PHP, c'est on ne peut plus clair. :)</p><p id="r-122856" data-claire-element-id="122856">On en arrive aux caractères. Il y en aura 8 ; pensez à définir une constante d'écart de caractères (et à vous en servir), une couleur pour les caractères (la même pour tous, sinon ça sert à rien de profiter de la superposition), et à consulter la doc pour <code data-claire-semantic="html+php"><a href="http://fr3.php.net/manual/fr/function.imagettftext.php">imagettftext() </a></code> car vous allez vous servir de cette fonction pour l'affichage.<br/> Comme M@teo n'en parle pas dans son tuto, on va l'étudier ensemble.</p><p id="r-122857" data-claire-element-id="122857"><cite>Citation : Doc PHP</cite></p><blockquote id="r-122860" data-claire-element-id="122860"><p id="r-122858" data-claire-element-id="122858">array imagettftext (resource $image, float $size, float $angle, int $x, int $y, int $color, string $fontfile, string $text)</p><p id="r-122859" data-claire-element-id="122859">Dessine le texte fourni avec une police TrueType.</p></blockquote><p id="r-122861" data-claire-element-id="122861"><code data-claire-semantic="html+php">$image </code> est votre image.<br/><code data-claire-semantic="html+php">$size </code> est la taille du caractère, c'est comme la propriété CSS <code data-claire-semantic="css">font-size </code>. Ici, on en veut des plutôt grands, on va donc utiliser <code data-claire-semantic="html+php">mt_rand(35,45) </code> par exemple (ou bien vos constantes définies pour chaque police). Cependant, la taille de chaque caractère est propre à lui-même, donc dans la boucle le <code data-claire-semantic="html+php">mt_rand() </code> (pensez à le coordonner avec la police si besoin est). :p <br/><code data-claire-semantic="html+php">$angle </code> définit l'angle d'affichage (qui a cru qu'il allait devoir faire des maths ? :D ), en degrés (que l'imbécile qui a dit Celsius ou Kelvin se dénonce !), donc incline le caractère (180 le retourne) ; ici encore une fois, on veut un intervalle d'angle, donc on va utiliser <code data-claire-semantic="html+php">mt_rand(-35,35) </code> ; je vous conseille de garder ces valeurs, ou si vous les changez, de ne pas excéder -45,45, sinon ça devient lourd à lire.<br/> Pareil, l'angle étant propre à chaque caractère, vous déclarerez <code data-claire-semantic="html+php">$angle </code> dans la boucle d'affichage.<br/><code data-claire-semantic="html+php">$x </code> définit l'abscisse horizontale du point de départ du caractère, <code data-claire-semantic="html+php">$y </code> l'ordonnée verticale (donc, si, il y a des maths :D ), ici, je vous laisse chercher seuls, faut pas tout vous mâcher non plus. :p <br/><code data-claire-semantic="html+php">$color </code> est la couleur définie avant la boucle (vu qu'on veut la même pour tous les caractères), <code data-claire-semantic="html+php">$police </code> est la police, propre à chaque caractère (donc définie en boucle), choisie dans l'array <code data-claire-semantic="html+php">$polices </code>, et <code data-claire-semantic="html+php">$text </code> s'appellera ici <code data-claire-semantic="html+php">$lettre </code>, vu qu'on bossera lettre par lettre.<br/> À vous de voir comment vous choisissez les lettres.</p><p id="r-122862" data-claire-element-id="122862">Voilà, vous avez tout ce qu'il vous faut pour finir votre captcha. :)</p><p id="r-122863" data-claire-element-id="122863">On est partis. :p</p><p id="r-122864" data-claire-element-id="122864">Une fois que vous avez fini, consultez ma correction :</p><div id="r-122871" data-claire-element-id="122871"><p id="r-122865" data-claire-element-id="122865">Déjà, on va définir la couleur des caractères, l'écart, et la session qui stockera le code du captcha (quoi, vous aviez oublié ? :p) :</p><pre id="r-122866" data-claire-element-id="122866"><code data-claire-semantic="html+php">&lt;?php
$aupifcolor = $Lcolors[mt_rand(0,$TLcolors-1)]; //la couleur des caractères
$ecart = 300/10+4; //écart entre les caractères

$_SESSION['captcha'] = ''; //La voilà !! Enfin !!
?&gt;</code></pre><p id="r-122867" data-claire-element-id="122867">Maintenant on lance la boucle, on définit à chaque fois un caractère, sa taille, son angle, son ordonnée (l'abscisse n'est pas aléatoire), sa police... :</p><pre id="r-122868" data-claire-element-id="122868"><code data-claire-semantic="html+php">&lt;?php
$i = 0;
while($i &lt;= 7)
{
	$lettre = $carac[mt_rand(0, $Tcarac-1)]; //choix de lettre
	$_SESSION['captcha'] .= $lettre; //stockage
	$taille = mt_rand(35,45); //taille
	$angle = mt_rand(-35,35); //angle
	$y = mt_rand(55, 60); //ordonnée
	$police = $polices[mt_rand(0, $Tpolices-1)]; //police :p
	
	imagettftext($image, $taille, $angle, $ecart*$i+15, $y, $aupifcolor, 'polices/'.$police.'.ttf', $lettre);
	$i++;
}

?&gt;</code></pre><p id="r-122869" data-claire-element-id="122869">Et on envoie l'image :D :</p><pre id="r-122870" data-claire-element-id="122870"><code data-claire-semantic="html+php">&lt;?php
imagepng($image); //On envoie et on prie :p
?&gt;</code></pre></div><p id="r-122872" data-claire-element-id="122872">Voilà : vous avez réussi votre captcha, et normalement, si vous allez voir votre page d'inscription, elle a maintenant de la gueule. :)</p><p id="r-122873" data-claire-element-id="122873">Bon, je vous remets le code captcha.php complet ici :</p><div id="r-122875" data-claire-element-id="122875"><pre id="r-122874" data-claire-element-id="122874"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page captcha.php

Génère un captcha.

Quelques indications : (utiliser l'outil de recherche et rechercher les mentions données)

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations/erreurs :
--------------------------
Aucune information/erreur
--------------------------
*/

session_start();
header (&quot;Content-type: image/png&quot;);
$image = imagecreate(320, 100);

$blanc = imagecolorallocate($image, 255, 255, 255);
$noir = imagecolorallocate($image, 0, 0, 0);
$gris = imagecolorallocate($image, 200,200,200);
$jaune = imagecolorallocate($image, 255, 255, 0);
$rouge = imagecolorallocate($image, 200, 39, 45);
$vert = imagecolorallocate($image, 45, 255, 39);
$cyan = imagecolorallocate($image, 0, 255, 255);
$magenta = imagecolorallocate($image, 200, 0, 200);
$orange = imagecolorallocate($image, 255, 160, 0);
$bleu = imagecolorallocate($image, 60, 75, 200);
$bleuclair = imagecolorallocate($image, 156, 227, 254);
$vertf = imagecolorallocate($image, 20, 140, 17);

/*$Anoir = imagecolorallocatealpha($image, 0, 0, 0, 80);
$Ajaune = imagecolorallocatealpha($image, 255, 255, 0, 80);
$Ablanc = imagecolorallocatealpha($image, 255, 255, 255, 80);
$Arouge = imagecolorallocatealpha($image, 200, 39, 45, 80);
$Avert = imagecolorallocatealpha($image, 45, 200, 39, 80);
$Acyan = imagecolorallocatealpha($image, 0, 255, 255, 80);
$Amagenta = imagecolorallocatealpha($image, 255, 0, 255, 80);
$Aorange = imagecolorallocatealpha($image, 255, 128, 0, 80);
$Ableu = imagecolorallocatealpha($image, 39, 45, 200, 80);
$Ableuclair = imagecolorallocatealpha($image, 156, 227, 254, 80);

$A2noir = imagecolorallocatealpha($image, 0, 0, 0, 25);
$A2jaune = imagecolorallocatealpha($image, 255, 255, 0, 25);
$A2blanc = imagecolorallocatealpha($image, 255, 255, 255, 25);
$A2rouge = imagecolorallocatealpha($image, 200, 39, 45, 25);
$A2vert = imagecolorallocatealpha($image, 45, 200, 39, 25);
$A2cyan = imagecolorallocatealpha($image, 0, 255, 255, 25);
$A2magenta = imagecolorallocatealpha($image, 255, 0, 255, 25);
$A2orange = imagecolorallocatealpha($image, 255, 128, 0, 25);
$A2bleu = imagecolorallocatealpha($image, 39, 45, 200, 25);
$A2bleuclair = imagecolorallocatealpha($image, 156, 227, 254, 25);*/

//Toutes les couleurs
$colors = Array($vert, $noir, $jaune, $blanc, $rouge, $cyan, $magenta, $orange, $bleu, $bleuclair, $gris, $vertf);
$Tcolors = count($colors);

/*$colors2 = Array($Avert, $Anoir, $Ajaune, $Ablanc, $Arouge, $Acyan, $Amagenta, $Aorange, $Ableu, $Ableuclair);
$Tcolors2 = count($colors2);
$colors3 = Array($A2vert, $A2noir, $A2jaune, $A2blanc, $A2rouge, $A2cyan, $A2magenta, $A2orange, $A2bleu, $A2bleuclair);
$Tcolors3 = count($colors3);*/

//couleurs autorisées pour les caractères
$Lcolors = Array($noir, $rouge, $magenta, $bleu, $vertf);
$TLcolors = count($Lcolors);

$polices = Array('baveuse3d'); //Pensez à en rajouter !!
$Tpolices = count($polices);

//définition des caractères autorisés.
$carac = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
$Tcarac = strlen($carac);

//définition des lignes noires
$nb_lignes = mt_rand(3,7);
$i = 1;
while($i&lt;=$nb_lignes)
{
	ImageLine($image, mt_rand(0,40), mt_rand(0,100), mt_rand(280, 320), mt_rand(0,100), $noir);
	$i++;
}

//définition des lignes colorées.
$nb_lignes = mt_rand(3,7);
$i = 1;
while($i&lt;=$nb_lignes)
{
	ImageLine($image, mt_rand(0,40), mt_rand(0,100), mt_rand(280,320), mt_rand(0,100), $colors[mt_rand(0,$Tcolors-1)]);
	$i++;
}

//définition des ellipses
$nb_ellipses = mt_rand(1,6);
$i = 1;
while($i&lt;= $nb_ellipses)
{
	ImageEllipse($image, mt_rand(0,320), mt_rand(0,100), 25+mt_rand(0,15), 25+mt_rand(0,15), $colors[mt_rand(0,$Tcolors-1)]);
	$i++;
}

//définition des triangles
$nb_triangles = mt_rand(1,6);
$i = 1;
while($i&lt;=$nb_triangles)
{
	$array = Array(mt_rand(0,300), mt_rand(0,100), mt_rand(0,300), mt_rand(0,100), mt_rand(0,300), mt_rand(0,100));
	ImagePolygon($image, $array, 3, $colors[mt_rand(0,$Tcolors-1)]);
	$i++;
}


$aupifcolor = $Lcolors[mt_rand(0,$TLcolors-1)]; //la couleur des caractères
$ecart = 300/10+4; //écart entre les caractères

$_SESSION['captcha'] = ''; //La voilà !! Enfin !!

$i = 0;
while($i &lt;= 7)
{
	$lettre = $carac[mt_rand(0, $Tcarac-1)]; //choix de lettre
	$_SESSION['captcha'] .= $lettre; //stockage
	$taille = mt_rand(35,45); //taille
	$angle = mt_rand(-35,35); //angle
	$y = mt_rand(55, 60); //ordonnée
	$police = $polices[mt_rand(0, $Tpolices-1)]; //police :p
	
	imagettftext($image, $taille, $angle, $ecart*$i+15, $y, $aupifcolor, 'polices/'.$police.'.ttf', $lettre);
	$i++;
}

imagepng($image); //On envoie et on prie :p
?&gt;</code></pre></div><p id="r-122876" data-claire-element-id="122876">On a fini, le système anti-bot est enfin au point. :p Il nous aura pris du temps, mais il marche, et, quand la page de validation sera finie, vous verrez que tout marche comme sur des roulettes !</p><p id="r-122877" data-claire-element-id="122877">Avant de passer à la validation d'ailleurs, je vous invite, si vous aimez vraiment GD et les captchas, à aller voir cette fonction qui pourra, si votre version de PHP et votre serveur le permettent, vous offrir des trucs sympas à rajouter : <a href="http://fr3.php.net/manual/fr/function.imagefilter.php">imagefilter</a>.</p><p id="r-122878" data-claire-element-id="122878">On a fini le chapitre !</p><p id="r-122879" data-claire-element-id="122879">Le formulaire est enfin prêt, passons à la deuxième partie de l'inscription. :)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site">Créer un espace membre pour son site</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Création d&#039;un système simple
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">Introduction</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
Un espace membre ? Kékécé ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
Présentation de la première partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
Présentation de la seconde partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
La table SQL
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">Les bases du système</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
Des pages bien utiles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
D&#039;autres pages à inclure
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">Inscription</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
Le formulaire
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
Charte et système anti-robot
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">La validation et les mails</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
Validation du formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
Un petit mail ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">TP : connexion et déconnexion</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
Prérequis et explications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
Et après ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">TP : site et profils</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
Exercice 1 - Création de statistiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
Correction de l&#039;exercice 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
Exercice 2 - Création de la page user.php
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
Correction de l&#039;exercice 2
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
<span class="arrow"></span>
<span class="next">Le formulaire</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">
<span class="next">La validation et les mails</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lavalidationetlesmails"></a><h2>La validation et les mails</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
<span class="arrow"></span>
<span class="next">Charte et système anti-robot</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
<span class="next">Validation du formulaire</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-122883" data-claire-element-id="122883">Bon, nous avons fait notre formulaire, et il marche, mais il faut encore pouvoir le valider et compléter l'inscription du membre, sinon bah... Cela ne sert pas à grand-chose. :p</p>
</div><a name="Validationduformulaire"></a><h2>Validation du formulaire</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">
<span class="arrow"></span>
<span class="next">La validation et les mails</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
<span class="next">Un petit mail ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-validation-du-formulaire" data-claire-element-id="122996">Validation du formulaire</h4><p id="r-122884" data-claire-element-id="122884">La validation ne demande pas de grandes compétences en PHP, juste un peu de méthode.<br/> Ce sera, avec la page d'édition de profil, la plus grosse de notre espace membres, car il y a beaucoup de vérifications à faire, encore que, j'ai converti pas mal de choses en fonctions, car elles resserviront pour la page d'édition.</p><p id="r-122885" data-claire-element-id="122885">Attaquons, sans plus attendre, la page de validation. :)</p><p id="r-122886" data-claire-element-id="122886">Dans le dossier membres, créez le fichier trait-inscription.php.</p><p id="r-122887" data-claire-element-id="122887">Ajoutons-y ceci tout de suite :</p><pre id="r-122888" data-claire-element-id="122888"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page trait-inscription.php

Permet de valider son inscription.

Quelques indications : (utiliser l'outil de recherche et rechercher les mentions données)

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations/erreurs :
--------------------------
Déjà inscrit (en cas de bug...)
--------------------------
*/

session_start();
header('Content-type: text/html; charset=utf-8');
include('../includes/config.php');

/********Actualisation de la session...**********/

include('../includes/fonctions.php');
connexionbdd();
actualiser_session();

/********Fin actualisation de session...**********/

if(isset($_SESSION['membre_id']))
{
	header('Location: '.ROOTPATH.'/index.php');
	exit();
}
?&gt;</code></pre><p id="r-122889" data-claire-element-id="122889">Là, je vais vous informer d'une idée que j'ai eue qui consiste à créer, si l'inscription est réussie, une variable de session <code data-claire-semantic="html+php">$_SESSION['inscrit']</code> et de la comparer à <code data-claire-semantic="html+php">$_POST['pseudo']</code>.<br/> Dans quel but ? Imaginons que notre homme valide son inscription et que pour une raison ou une autre, le site plante avant la confirmation, ou que le navigateur du bonhomme plante ou un autre problème du genre.<br/> En revenant, le membre va réessayer de s'inscrire avec le même pseudo, et la variable de session lui indiquera qu'il s'est déjà inscrit et qu'il peut se connecter.</p><p id="r-122890" data-claire-element-id="122890">Bon : vous me direz que son utilité est contestable, mais c'est une idée que je propose ; je vous rappelle quand même que le système se veut le plus personnalisable possible, donc n'hésitez pas à modifier des trucs. Moi-même, si je m'en sers (faudrait déjà que je me décide à faire un site), je le modifierai probablement. :)</p><pre id="r-122891" data-claire-element-id="122891"><code data-claire-semantic="html+php">&lt;?php
if($_SESSION['inscrit'] == $_POST['pseudo'] &amp;&amp; trim($_POST['inscrit']) != '')
{
	$informations = Array(/*Déjà inscrit (en cas de bug...)*/
						true,
						'Vous êtes déjà inscrit',
						'Vous avez déjà complété une inscription avec le pseudo &lt;span class=&quot;pseudo&quot;&gt;'.htmlspecialchars($_SESSION['inscrit'], ENT_QUOTES).'&lt;/span&gt;.',
						' - &lt;a href=&quot;'.ROOTPATH.'/index.php&quot;&gt;Retourner à l\'index&lt;/a&gt;',
						ROOTPATH.'/membres/connexion.php',
						5
						);
	require_once('../information.php');
	exit();
}
?&gt;</code></pre><p id="r-122892" data-claire-element-id="122892">Une nouvelle classe fait son apparition, éditons donc le CSS. :)</p><pre id="r-122893" data-claire-element-id="122893"><code data-claire-semantic="css">.pseudo {
	font-weight: bold;
}</code></pre><p id="r-122894" data-claire-element-id="122894">Bon, stoppons le blabla : après cette formalité, on va devoir attaquer directement les fonctions avant de continuer la page d'inscription, car sinon, je sens que je vais vous perdre. :p</p><h5 id="r-les-fonctions-8" data-claire-element-id="122927">Les fonctions</h5><h6 id="r-checkpseudo" data-claire-element-id="122899"><code data-claire-semantic="html+php">checkpseudo</code></h6><p id="r-122895" data-claire-element-id="122895">La première fonction s'occupera du pseudo : elle devra vérifier dans l'ordre si le pseudo est vide, ensuite, s'il est trop court ou trop long, et enfin s'il est pris, sinon, c'est bon.<br/> La fonction retournera un code pour chaque erreur, et le code <code data-claire-semantic="html+php">ok</code> si c'est bon.</p><div id="r-122897" data-claire-element-id="122897"><pre id="r-122896" data-claire-element-id="122896"><code data-claire-semantic="html+php">&lt;?php
function checkpseudo($pseudo)
{
	if($pseudo == '') return 'empty';
	else if(strlen($pseudo) &lt; 3) return 'tooshort';
	else if(strlen($pseudo) &gt; 32) return 'toolong';
	
	else
	{
		$result = sqlquery(&quot;SELECT COUNT(*) AS nbr FROM membres WHERE membre_pseudo = '&quot;.mysql_real_escape_string($pseudo).&quot;'&quot;, 1);
		global $queries;
		$queries++;
		
		if($result['nbr'] &gt; 0) return 'exists';
		else return 'ok';
	}
}
?&gt;</code></pre></div><p id="r-122898" data-claire-element-id="122898">Vous avez maintenant déjà une idée de la tête qu'auront les autres fonctions. :)</p><h6 id="r-checkmdp" data-claire-element-id="122903"><code data-claire-semantic="html+php">checkmdp</code></h6><p id="r-122900" data-claire-element-id="122900"><code data-claire-semantic="html+php">checkmdp</code> devra vérifier si le mot de passe entré est ni trop long ni trop court, s'il contient au moins un chiffre et au moins une majuscule, sinon, tout est ok pour le mot de passe.</p><div id="r-122902" data-claire-element-id="122902"><pre id="r-122901" data-claire-element-id="122901"><code data-claire-semantic="html+php">&lt;?php
function checkmdp($mdp)
{
	if($mdp == '') return 'empty';
	else if(strlen($mdp) &lt; 4) return 'tooshort';
	else if(strlen($mdp) &gt; 50) return 'toolong';
	
	else
	{
		if(!preg_match('#[0-9]{1,}#', $mdp)) return 'nofigure';
		else if(!preg_match('#[A-Z]{1,}#', $mdp)) return 'noupcap';
		else return 'ok';
	}
}
?&gt;</code></pre></div><h6 id="r-checkmdps" data-claire-element-id="122907"><code data-claire-semantic="html+php">checkmdpS</code></h6><p id="r-122904" data-claire-element-id="122904">Cette fonction devra vérifier que le mot de passe de vérification correspond au mot de passe (et même s'ils sont différents, les deux doivent être non vides pour être déclarés différents), sinon on retourne une erreur ; s'ils sont pareils, on le passe au même traitement que le mot de passe.</p><div id="r-122906" data-claire-element-id="122906"><pre id="r-122905" data-claire-element-id="122905"><code data-claire-semantic="html+php">&lt;?php
function checkmdpS($mdp, $mdp2)
{
	if($mdp != $mdp2 &amp;&amp; $mdp != '' &amp;&amp; $mdp2 != '') return 'different';
	else return checkmdp($mdp);
}
?&gt;</code></pre></div><h6 id="r-checkmail" data-claire-element-id="122911"><code data-claire-semantic="html+php">checkmail</code></h6><p id="r-122908" data-claire-element-id="122908">Cette fonction devra vérifier le format du mail via <em>regexp</em>, et si le mail n'est pas déjà pris.<br/> Je ne vous explique pas la <em>regexp</em>, M@teo a fait exactement la même dans son tuto.</p><div id="r-122910" data-claire-element-id="122910"><pre id="r-122909" data-claire-element-id="122909"><code data-claire-semantic="html+php">&lt;?php
function checkmail($email)
{
	if($email == '') return 'empty';
	else if(!preg_match('#^[a-z0-9._-]+@[a-z0-9._-]{2,}\.[a-z]{2,4}$#is', $email)) return 'isnt';
	
	else
	{
		$result = sqlquery(&quot;SELECT COUNT(*) AS nbr FROM membres WHERE membre_mail = '&quot;.mysql_real_escape_string($email).&quot;'&quot;, 1);
		global $queries;
		$queries++;
		
		if($result['nbr'] &gt; 0) return 'exists';
		else return 'ok';
	}
}
?&gt;</code></pre></div><h6 id="r-checkmails" data-claire-element-id="122915"><code data-claire-semantic="html+php">checkmailS</code></h6><p id="r-122912" data-claire-element-id="122912">Cette fonction fait comme <code data-claire-semantic="html+php">checkmdpS</code>.</p><div id="r-122914" data-claire-element-id="122914"><pre id="r-122913" data-claire-element-id="122913"><code data-claire-semantic="html+php">&lt;?php
function checkmailS($email, $email2)
{
	if($email != $email2 &amp;&amp; $email != '' &amp;&amp; $email2 != '') return 'different';
	else return 'ok';
}
?&gt;</code></pre></div><h6 id="r-birthdate" data-claire-element-id="122920"><code data-claire-semantic="html+php">birthdate</code></h6><p id="r-122916" data-claire-element-id="122916">Cette fonction est un peu plus longue que les autres.<br/> Elle devra vérifier le format de la date de naissance (deux /), l'âge de l'utilisateur (vous voulez vraiment un enfant de 4 ans sur votre site ? :D ), l'existence de la date, enfin valider celle-ci si c'est bon.</p><p id="r-122917" data-claire-element-id="122917"></p><div id="r-122919" data-claire-element-id="122919"><pre id="r-122918" data-claire-element-id="122918"><code data-claire-semantic="html+php">&lt;?php
function birthdate($date)
{
	if($date == '') return 'empty';

	else if(substr_count($date, '/') != 2) return 'format';
	else
	{
		$DATE = explode('/', $date);
		if(date('Y') - $DATE[2] &lt;= 4) return 'tooyoung';
		else if(date('Y') - $DATE[2] &gt;= 135) return 'tooold';
		
		else if($DATE[2]%4 == 0)
		{
			$maxdays = Array('31', '29', '31', '30', '31', '30', '31', '31', '30', '31', '30', '31');
			if($DATE[0] &gt; $maxdays[$DATE[1]-1]) return 'invalid';
			else return 'ok';
		}
		
		else
		{
			$maxdays = Array('31', '28', '31', '30', '31', '30', '31', '31', '30', '31', '30', '31');
			if($DATE[0] &gt; $maxdays[$DATE[1]-1]) return 'invalid';
			else return 'ok';
		}
	}
}
?&gt;</code></pre></div><h6 id="r-vidersession" data-claire-element-id="122926"><code data-claire-semantic="html+php">vidersession</code></h6><p id="r-122921" data-claire-element-id="122921">Durant toute l'inscription, on va mettre dans <code data-claire-semantic="html+php">$_SESSION</code> plein de variables car si la validation n'est pas correcte, on renvoie le visiteur sur le formulaire d'inscription, on affiche à nouveau les erreurs que l'on a rencontrées, et on pré-remplit les champs qui étaient corrects.<br/> Mais si l'inscription se passe bien, juste avant de créer <code data-claire-semantic="html+php">$_SESSION['inscrit']</code> on va vider toute la session sans <code data-claire-semantic="html+php">session_destroy()</code>, car sinon on peut pas créer <code data-claire-semantic="html+php">$_SESSION['inscrit']</code>.<br/> Un simple <code data-claire-semantic="html+php">foreach</code> suffit.</p><p id="r-122922" data-claire-element-id="122922"></p><div id="r-122924" data-claire-element-id="122924"><pre id="r-122923" data-claire-element-id="122923"><code data-claire-semantic="html+php">&lt;?php
function vidersession()
{
	foreach($_SESSION as $cle =&gt; $element)
	{
		unset($_SESSION[$cle]);
	}
}
?&gt;</code></pre></div><p id="r-122925" data-claire-element-id="122925">Voilà, nos fonctions sont prêtes, passons à la suite. :) <br/> Nota : une autre solution consiste à mettre toutes ces variables temporaires dans une variable <code data-claire-semantic="html+php">$_SESSION['temp']</code>.<br/> On aura donc <code data-claire-semantic="html+php">$_SESSION['temp']['form_pseudo']</code> etc.<br/> Vous n'aurez alors qu'à faire un <code data-claire-semantic="html+php">unset()</code> sur <code data-claire-semantic="html+php">$_SESSION['temp']</code> pour vider le formulaire temporaire.</p><h5 id="r-validation-proprement-dite" data-claire-element-id="122995">Validation proprement dite</h5><p id="r-122928" data-claire-element-id="122928">Bon : on a fini les fonctions, revenons à trait-inscription.php. :)</p><p id="r-122929" data-claire-element-id="122929">Maintenant que les fonctions sont prêtes, il suffit pour chaque champ du formulaire de vérifier s'il existe (<code data-claire-semantic="html+php">isset</code>), de supprimer les espaces en début et fin de chaîne (<code data-claire-semantic="html+php">trim</code>), de les passer par leurs fonctions respectives ; enfin, de mettre les bonnes erreurs en session et de créer une variable <code data-claire-semantic="html+php">$_SESSION['erreurs']</code> qui recense le nombre d'erreurs.</p><p id="r-122930" data-claire-element-id="122930">On y va, c'est très facile : essayez d'abord sans regarder mon code. :)</p><p id="r-122931" data-claire-element-id="122931"></p><div id="r-122933" data-claire-element-id="122933"><pre id="r-122932" data-claire-element-id="122932"><code data-claire-semantic="html+php">&lt;?php
/*Code anti-pompage sans lecture :p*/
exit('Pour ceux qui recopient bêtement ce code sans avoir essayé, sachez que vous êtes bien
bêtes, le but de ce tuto est de vous entraîner à comprendre et à coder en PHP. Tci
il n\'y a rien de dur, c\'est un simple traitement de l\'information fournie par des fonctions
et de la définition de variables, alors pomper ce code sans essayer tout seul, c\'est vraiment
pas une attitude de Zér0 :o)');

/********Étude du bazar envoyé***********/

$_SESSION['erreurs'] = 0;

//Pseudo
if(isset($_POST['pseudo']))
{
	$pseudo = trim($_POST['pseudo']);
	$pseudo_result = checkpseudo($pseudo);
	if($pseudo_result == 'tooshort')
	{
		$_SESSION['pseudo_info'] = '&lt;span class=&quot;erreur&quot;&gt;Le pseudo '.htmlspecialchars($pseudo, ENT_QUOTES).' est trop court, vous devez en choisir un plus long (minimum 3 caractères).&lt;/span&gt;&lt;br/&gt;';
		$_SESSION['form_pseudo'] = '';
		$_SESSION['erreurs']++;
	}
	
	else if($pseudo_result == 'toolong')
	{
		$_SESSION['pseudo_info'] = '&lt;span class=&quot;erreur&quot;&gt;Le pseudo '.htmlspecialchars($pseudo, ENT_QUOTES).' est trop long, vous devez en choisir un plus court (maximum 32 caractères).&lt;/span&gt;&lt;br/&gt;';
		$_SESSION['form_pseudo'] = '';
		$_SESSION['erreurs']++;
	}
	
	else if($pseudo_result == 'exists')
	{
		$_SESSION['pseudo_info'] = '&lt;span class=&quot;erreur&quot;&gt;Le pseudo '.htmlspecialchars($pseudo, ENT_QUOTES).' est déjà pris, choisissez-en un autre.&lt;/span&gt;&lt;br/&gt;';
		$_SESSION['form_pseudo'] = '';
		$_SESSION['erreurs']++;
	}
		
	else if($pseudo_result == 'ok')
	{
		$_SESSION['pseudo_info'] = '';
		$_SESSION['form_pseudo'] = $pseudo;
	}
	
	else if($pseudo_result == 'empty')
	{
		$_SESSION['pseudo_info'] = '&lt;span class=&quot;erreur&quot;&gt;Vous n\'avez pas entré de pseudo.&lt;/span&gt;&lt;br/&gt;';
		$_SESSION['form_pseudo'] = '';
		$_SESSION['erreurs']++;	
	}
}

else
{
	header('Location: ../index.php');
	exit();
}

//Mot de passe
if(isset($_POST['mdp']))
{
	$mdp = trim($_POST['mdp']);
	$mdp_result = checkmdp($mdp, '');
	if($mdp_result == 'tooshort')
	{
		$_SESSION['mdp_info'] = '&lt;span class=&quot;erreur&quot;&gt;Le mot de passe entré est trop court, changez-en pour un plus long (minimum 4 caractères).&lt;/span&gt;&lt;br/&gt;';
		$_SESSION['form_mdp'] = '';
		$_SESSION['erreurs']++;
	}
	
	else if($mdp_result == 'toolong')
	{
		$_SESSION['mdp_info'] = '&lt;span class=&quot;erreur&quot;&gt;Le mot de passe entré est trop long, changez-en pour un plus court. (maximum 50 caractères)&lt;/span&gt;&lt;br/&gt;';
		$_SESSION['form_mdp'] = '';
		$_SESSION['erreurs']++;
	}
	
	else if($mdp_result == 'nofigure')
	{
		$_SESSION['mdp_info'] = '&lt;span class=&quot;erreur&quot;&gt;Votre mot de passe doit contenir au moins un chiffre.&lt;/span&gt;&lt;br/&gt;';
		$_SESSION['form_mdp'] = '';
		$_SESSION['erreurs']++;
	}
		
	else if($mdp_result == 'noupcap')
	{
		$_SESSION['mdp_info'] = '&lt;span class=&quot;erreur&quot;&gt;Votre mot de passe doit contenir au moins une majuscule.&lt;/span&gt;&lt;br/&gt;';
		$_SESSION['form_mdp'] = '';
		$_SESSION['erreurs']++;
	}
		
	else if($mdp_result == 'ok')
	{
		$_SESSION['mdp_info'] = '';
		$_SESSION['form_mdp'] = $mdp;
	}
	
	else if($mdp_result == 'empty')
	{
		$_SESSION['mdp_info'] = '&lt;span class=&quot;erreur&quot;&gt;Vous n\'avez pas entré de mot de passe.&lt;/span&gt;&lt;br/&gt;';
		$_SESSION['form_mdp'] = '';
		$_SESSION['erreurs']++;

	}
}

else
{
	header('Location: ../index.php');
	exit();
}

//Mot de passe suite
if(isset($_POST['mdp_verif']))
{
	$mdp_verif = trim($_POST['mdp_verif']);
	$mdp_verif_result = checkmdpS($mdp_verif, $mdp);
	if($mdp_verif_result == 'different')
	{
		$_SESSION['mdp_verif_info'] = '&lt;span class=&quot;erreur&quot;&gt;Le mot de passe de vérification diffère du mot de passe.&lt;/span&gt;&lt;br/&gt;';
		$_SESSION['form_mdp_verif'] = '';
		$_SESSION['erreurs']++;
		if(isset($_SESSION['form_mdp'])) unset($_SESSION['form_mdp']);
	}
	
	else
	{
		if($mdp_verif_result == 'ok')
		{
			$_SESSION['form_mdp_verif'] = $mdp_verif;
			$_SESSION['mdp_verif_info'] = '';
		}
		
		else
		{
			$_SESSION['mdp_verif_info'] = str_replace('passe', 'passe de vérification', $_SESSION['mdp_info']);
			$_SESSION['form_mdp_verif'] = '';
			$_SESSION['erreurs']++;
		}
	}
}

else
{
	header('Location: ../index.php');
	exit();
}

//mail
if(isset($_POST['mail']))
{
	$mail = trim($_POST['mail']);
	$mail_result = checkmail($mail);
	if($mail_result == 'isnt')
	{
		$_SESSION['mail_info'] = '&lt;span class=&quot;erreur&quot;&gt;Le mail '.htmlspecialchars($mail, ENT_QUOTES).' n\'est pas valide.&lt;/span&gt;&lt;br/&gt;';
		$_SESSION['form_mail'] = '';
		$_SESSION['erreurs']++;
	}
	
	else if($mail_result == 'exists')
	{
		$_SESSION['mail_info'] = '&lt;span class=&quot;erreur&quot;&gt;Le mail '.htmlspecialchars($mail, ENT_QUOTES).' est déjà pris, &lt;a href=&quot;../contact.php&quot;&gt;contactez-nous&lt;/a&gt; si vous pensez à une erreur.&lt;/span&gt;&lt;br/&gt;';
		$_SESSION['form_mail'] = '';
		$_SESSION['erreurs']++;
	}
		
	else if($mail_result == 'ok')
	{
		$_SESSION['mail_info'] = '';
		$_SESSION['form_mail'] = $mail;
	}
	
	else if($mail_result == 'empty')
	{
		$_SESSION['mail_info'] = '&lt;span class=&quot;erreur&quot;&gt;Vous n\'avez pas entré de mail.&lt;/span&gt;&lt;br/&gt;';
		$_SESSION['form_mail'] = '';
		$_SESSION['erreurs']++;	
	}
}

else
{
	header('Location: ../index.php');
	exit();
}

//mail suite
if(isset($_POST['mail_verif']))
{
	$mail_verif = trim($_POST['mail_verif']);
	$mail_verif_result = checkmailS($mail_verif, $mail);
	if($mail_verif_result == 'different')
	{
		$_SESSION['mail_verif_info'] = '&lt;span class=&quot;erreur&quot;&gt;Le mail de vérification diffère du mail.&lt;/span&gt;&lt;br/&gt;';
		$_SESSION['form_mail_verif'] = '';
		$_SESSION['erreurs']++;
	}
	
	else
	{
		if($mail_result == 'ok')
		{
			$_SESSION['mail_verif_info'] = '';
			$_SESSION['form_mail_verif'] = $mail_verif;
		}
		
		else
		{
			$_SESSION['mail_verif_info'] = str_replace(' mail', ' mail de vérification', $_SESSION['mail_info']);
			$_SESSION['form_mail_verif'] = '';
			$_SESSION['erreurs']++;
		}
	}
}

else
{
	header('Location: ../index.php');
	exit();
}

//date de naissance
if(isset($_POST['date_naissance']))
{
	$date_naissance = trim($_POST['date_naissance']);
	$date_naissance_result = birthdate($date_naissance);
	if($date_naissance_result == 'format')
	{
		$_SESSION['date_naissance_info'] = '&lt;span class=&quot;erreur&quot;&gt;Date de naissance au mauvais format ou invalide.&lt;/span&gt;&lt;br/&gt;';
		$_SESSION['form_date_naissance'] = '';
		$_SESSION['erreurs']++;
	}
	
	else if($date_naissance_result == 'tooyoung')
	{
		$_SESSION['date_naissance_info'] = '&lt;span class=&quot;erreur&quot;&gt;Agagagougougou areuh ? (Vous êtes trop jeune pour vous inscrire ici.)&lt;/span&gt;&lt;br/&gt;';
		$_SESSION['form_date_naissance'] = '';
		$_SESSION['erreurs']++;
	}
		
	else if($date_naissance_result == 'tooold')
	{
		$_SESSION['date_naissance_info'] = '&lt;span class=&quot;erreur&quot;&gt;Plus de 135 ans ? Mouais...&lt;/span&gt;&lt;br/&gt;';
		$_SESSION['form_date_naissance'] = '';
		$_SESSION['erreurs']++;
	}
		
	else if($date_naissance_result == 'invalid')
	{
		$_SESSION['date_naissance_info'] = '&lt;span class=&quot;erreur&quot;&gt;Le '.htmlspecialchars($date_naissance, ENT_QUOTES).' n\'existe pas.&lt;/span&gt;&lt;br/&gt;';
		$_SESSION['form_date_naissance'] = '';
		$_SESSION['erreurs']++;
	}
		
	else if($date_naissance_result == 'ok')
	{
		$_SESSION['date_naissance_info'] = '';
		$_SESSION['form_date_naissance'] = $date_naissance;
	}
	
	else if($date_naissance_result == 'empty')
	{
		$_SESSION['date_naissance_info'] = '&lt;span class=&quot;erreur&quot;&gt;Vous n\'avez pas entré de date de naissance.&lt;/span&gt;&lt;br/&gt;';
		$_SESSION['form_date_naissance'] = '';
		$_SESSION['erreurs']++;
	}
}

else
{
	header('Location: ../index.php');
	exit();
}

//qcm
if($_SESSION['reponse1'] == $_POST['reponse1'] &amp;&amp; $_SESSION['reponse2'] == $_POST['reponse2'] &amp;&amp; $_SESSION['reponse3'] == $_POST['reponse3'] &amp;&amp; isset($_POST['reponse1']) &amp;&amp; isset($_POST['reponse2']) &amp;&amp; isset($_POST['reponse3']))
{
	$_SESSION['qcm_info'] = '';
}

else
{
	$_SESSION['qcm_info'] = '&lt;span class=&quot;erreur&quot;&gt;Au moins une des réponses au QCM charte est fausse.&lt;/span&gt;&lt;br/&gt;';
	$_SESSION['erreurs']++;
}


//captcha
if($_POST['captcha'] == $_SESSION['captcha'] &amp;&amp; isset($_POST['captcha']) &amp;&amp; isset($_SESSION['captcha']))
{
	$_SESSION['captcha_info'] = '';
}

else
{
	$_SESSION['captcha_info'] = '&lt;span class=&quot;erreur&quot;&gt;Vous n\'avez pas recopié correctement le contenu de l\'image.&lt;/span&gt;&lt;br/&gt;';
	$_SESSION['erreurs']++;
}

unset($_SESSION['reponse1'], $_SESSION['reponse2'], $_SESSION['reponse3']);
unset($_SESSION['captcha']);

/*************Fin étude******************/
?&gt;</code></pre></div><p id="r-122934" data-claire-element-id="122934">Voilà, le traitement à proprement parler est fini ; on va maintenant afficher le titre de la page et faire une insertion du tout si tout s'est bien passé. :)</p><pre id="r-122935" data-claire-element-id="122935"><code data-claire-semantic="html+php">&lt;?php
/********Entête et titre de page*********/
if($_SESSION['erreurs'] &gt; 0) $titre = 'Erreur : Inscription 2/2';
else $titre = 'Inscription 2/2';

include('../includes/haut.php'); //contient le doctype, et head.

/**********Fin entête et titre***********/
?&gt;
		&lt;div id=&quot;colonne_gauche&quot;&gt;
		&lt;?php
		include('../includes/colg.php');
		?&gt;
		&lt;/div&gt;
		
		&lt;div id=&quot;contenu&quot;&gt;
			&lt;div id=&quot;map&quot;&gt;
&lt;!-- Absence de lien à Inscription 2/2 volontaire --&gt;
				&lt;a href=&quot;../index.php&quot;&gt;Accueil&lt;/a&gt; =&gt; Inscription 2/2
			&lt;/div&gt;</code></pre><p id="r-122936" data-claire-element-id="122936">À présent, nous allons attaquer un subtil détail que je n'ai pas encore énoncé.<br/> S'il n'y a pas d'erreur, on va définir une requête et tenter de l'appliquer.<br/> Seulement, imaginons qu'une fraction de secondes après la vérification du pseudo pour un visiteur X, un visiteur Y s'inscrive avec le même pseudo : la vérification du pseudo dans le traitement indique qu'il est libre, mais le visiteur X envoie alors la requête et prend le pseudo.<br/> Le visiteur Y va alors envoyer la requête à son tour et là, deux possibilités.</p><p id="r-122937" data-claire-element-id="122937">1°) Vous n'aviez pas prévu ça, et on a deux utilisateurs ayant le même pseudo sur votre site, ce qui est fort gênant.</p><p id="r-122938" data-claire-element-id="122938">2°) Vous aviez prévu ça et le visiteur Y se fait refuser car le champ <code data-claire-semantic="html+php">pseudo</code> est configuré en UNIQUE, mais il ne sait pas pourquoi il s'est fait jeter !</p><p id="r-122939" data-claire-element-id="122939">Voici un schéma pour vous aider à comprendre :</p><table id="r-122969" data-claire-element-id="122969"><tbody id="r-122968" data-claire-element-id="122968"><tr id="r-122947" data-claire-element-id="122947"><td id="r-122941" data-claire-element-id="122941"><p id="r-122940" data-claire-element-id="122940">t1 : Mr X valide son formulaire<br/> avec le pseudo &quot;patate&quot;.</p></td><td id="r-122943" data-claire-element-id="122944"><img id="r-122944" data-claire-element-id="122943" src="medias/uploads.siteduzero.com_files_139001_140000_139009.png" alt="Image utilisateur"/><p id="r-122942" data-claire-element-id="122942">Axe du temps :</p></td><td id="r-122946" data-claire-element-id="122946"><p id="r-122945" data-claire-element-id="122945">t1 : Mr Y n'a pas encore validé.</p></td></tr><tr id="r-122952" data-claire-element-id="122952"><td id="r-122949" data-claire-element-id="122949"><p id="r-122948" data-claire-element-id="122948">t2 : Le pseudo &quot;patate&quot; est libre,<br/> Mr X peut donc s'inscrire<br/> avec.</p></td><td id="r-122951" data-claire-element-id="122951"><p id="r-122950" data-claire-element-id="122950">t2 : Mr Y valide son formulaire<br/> avec le pseudo &quot;patate&quot;.</p></td></tr><tr id="r-122957" data-claire-element-id="122957"><td id="r-122954" data-claire-element-id="122954"><p id="r-122953" data-claire-element-id="122953">t3 : La requête d'insertion du formulaire<br/> de Mr X n'a pas encore eu lieu, mais son<br/> formulaire n'a pas rencontré d'erreurs.</p></td><td id="r-122956" data-claire-element-id="122956"><p id="r-122955" data-claire-element-id="122955">t3 : Le pseudo &quot;patate&quot; est encore<br/> libre, Mr Y peut donc s'inscrire<br/> avec.</p></td></tr><tr id="r-122962" data-claire-element-id="122962"><td id="r-122959" data-claire-element-id="122959"><p id="r-122958" data-claire-element-id="122958">t4 : Mr X est finalement inscrit<br/> avec le pseudo &quot;patate&quot;.</p></td><td id="r-122961" data-claire-element-id="122961"><p id="r-122960" data-claire-element-id="122960">t4 : Le formulaire de mr Y n'a pas<br/> rencontré d'erreurs.</p></td></tr><tr id="r-122967" data-claire-element-id="122967"><td id="r-122964" data-claire-element-id="122964"><p id="r-122963" data-claire-element-id="122963">t5 : Mr X est inscrit, on<br/> l'oublie.</p></td><td id="r-122966" data-claire-element-id="122966"><p id="r-122965" data-claire-element-id="122965">t5 : Insertion du formulaire de Mr Y ;<br/> deux cas possibles : le premier,<br/> le champ pseudo n'est pas en<br/> unique, Mr Y est inscrit avec<br/> le même pseudo que Mr X ;<br/> deuxième cas, le champ pseudo<br/> est en unique, et Mr Y se voit<br/> refuser son inscription, il faut<br/> donc lui créer un message d'erreur<br/> explicite, car il ne comprendra pas<br/> &quot;<code data-claire-semantic="html+php">duplicate entry for 'patate' [...]</code> &quot;</p></td></tr></tbody></table><p id="r-122970" data-claire-element-id="122970">Vous avez compris, je veux travailler le cas où on l'empêche de s'inscrire, mais on lui explique pourquoi l'inscription est refusée.<br/> Ça va être un peu nouveau pour vous, on va faire appel à une fonction sur <code data-claire-semantic="html+php">mysql_error()</code> que vous ne connaissez pas tous : <code data-claire-semantic="html+php"><a href="http://fr3.php.net/manual/fr/function.stripos.php">stripos</a></code>.</p><p id="r-122971" data-claire-element-id="122971"><code data-claire-semantic="html+php">stripos</code> recherche la première occurrence d'une chaîne dans une autre et retourne sa position (qui peut valoir 0 si le premier caractère de l'occurrence est le premier de la chaîne), <code data-claire-semantic="html+php">stripos</code> est insensible à la casse contrairement à <code data-claire-semantic="html+php"><a href="http://fr3.php.net/manual/fr/function.strpos.php">strpos</a></code>.</p><pre id="r-122972" data-claire-element-id="122972"><code data-claire-semantic="html+php">&lt;?php
echo stripos('abcdefg', 'ab'); //echo 0, car a est le premier caractère de abcdefg;
echo stripos('abcdefg', 'gh'); //FALSE
echo stripos('abcdefg', 'd'); //echo 3;, car d est le 4e caractère de abcdefg
?&gt;</code></pre><p id="r-122973" data-claire-element-id="122973">Il est important de noter que la fonction peut retourner 0, donc il faudra utiliser === pour tester l'égalité et !== pour tester l'inégalité.</p><p id="r-122974" data-claire-element-id="122974">Les opérateurs ===/!== marchent comme ==/!= sauf qu'ils vérifient aussi si les variables sont de même type ou non.<br/> Le meilleur exemple est avec 0 ou 1 et respectivement <code data-claire-semantic="html+php">FALSE</code> et <code data-claire-semantic="html+php">TRUE</code>.<br/> Si vous testez l'égalité entre 0 et <code data-claire-semantic="html+php">FALSE</code>, vous trouverez que celle-ci est vraie ; or, 0 est un entier, et <code data-claire-semantic="html+php">FALSE</code> est un booléen, c'est l'une des caractéristique de PHP, c'est un langage faiblement typé. Du coup, on dit que 0 est un équivalent de <code data-claire-semantic="html+php">FALSE</code> en PHP.<br/> Seulement, on a parfois besoin que l'égalité entre 0 et <code data-claire-semantic="html+php">FALSE</code> soit fausse, on utilisera donc === qui teste aussi le type.<br/> Exemple :</p><pre id="r-122975" data-claire-element-id="122975"><code data-claire-semantic="html+php">&lt;?php
if(0 == FALSE) echo 'Oooohhhh! 0 == False !!&lt;br/&gt;';
else echo 'Oh non, 0 != False :(&lt;br/&gt;';
if(0 === FALSE) echo 'Aahhhhhhh! 0 === False !!&lt;br/&gt;';
else echo 'Oh, 0 !== False :x'; //On sent l'inspiration :p
?&gt;</code></pre><p id="r-122976" data-claire-element-id="122976">Retour de ce code :</p><p id="r-122977" data-claire-element-id="122977"><cite>Citation : Pas de titre</cite></p><blockquote id="r-122979" data-claire-element-id="122979"><p id="r-122978" data-claire-element-id="122978">Oooohhhh! 0 == False !!<br/> Oh, 0 !== False :x</p></blockquote><p id="r-122980" data-claire-element-id="122980">Compris ?</p><p id="r-122981" data-claire-element-id="122981">Dans le code d'erreur SQL, si le problème vient d'un champ unique, le nom qu'on a tenté d'insérer est affiché : donc, avec <code data-claire-semantic="html+php">stripos</code>, on va chercher le pseudo et / ou le mail dans l'erreur.</p><p id="r-122982" data-claire-element-id="122982">Allons-y. :)</p><pre id="r-122983" data-claire-element-id="122983"><code data-claire-semantic="html+php">&lt;!--Test des erreurs et envoi--&gt;
			&lt;?php
			if($_SESSION['erreurs'] == 0)
			{
				$insertion = &quot;INSERT INTO membres VALUES(NULL, '&quot;.mysql_real_escape_string($pseudo).&quot;',
				'&quot;.md5($mdp).&quot;', '&quot;.mysql_real_escape_string($mail).&quot;',
				&quot;.time().&quot;, '&quot;.mysql_real_escape_string($date_naissance).&quot;',
				'', '',
				'', '',
				'', '',
				'', '',
				&quot;.time().&quot;, 0)&quot;;
				
				if(mysql_query($insertion))
				{
					$queries++;
					vidersession();
					$_SESSION['inscrit'] = $pseudo;
					/*informe qu'il s'est déjà inscrit s'il actualise, si son navigateur
					bugue avant l'affichage de la page et qu'il recharge la page, etc.*/
				?&gt;
			&lt;h1&gt;Inscription validée !&lt;/h1&gt;
			&lt;p&gt;Nous vous remercions de vous être inscrit sur notre site, votre inscription a été validée !&lt;br/&gt;
			Vous pouvez vous connecter avec vos identifiants &lt;a href=&quot;connexion.php&quot;&gt;ici&lt;/a&gt;.
			&lt;/p&gt;
				&lt;?php
				}
				
				else
				{
					if(stripos(mysql_error(), $_SESSION['form_pseudo']) !== FALSE) // recherche du pseudo
					{
						unset($_SESSION['form_pseudo']);
						$_SESSION['pseudo_info'] = '&lt;span class=&quot;erreur&quot;&gt;Le pseudo '.htmlspecialchars($pseudo, ENT_QUOTES).' est déjà pris, choisissez-en un autre.&lt;/span&gt;&lt;br/&gt;';
						$_SESSION['erreurs']++;
					}
					
					if(stripos(mysql_error(), $_SESSION['form_mail']) !== FALSE) //recherche du mail
					{
						unset($_SESSION['form_mail']);
						unset($_SESSION['form_mail_verif']);
						$_SESSION['mail_info'] = '&lt;span class=&quot;erreur&quot;&gt;Le mail '.htmlspecialchars($mail, ENT_QUOTES).' est déjà pris, &lt;a href=&quot;../contact.php&quot;&gt;contactez-nous&lt;/a&gt; si vous pensez à une erreur.&lt;/span&gt;&lt;br/&gt;';
						$_SESSION['mail_verif_info'] = str_replace('mail', 'mail de vérification', $_SESSION['mail_info']);
						$_SESSION['erreurs']++;
						$_SESSION['erreurs']++;
					}
					
					if($_SESSION['erreurs'] == 0)
					{
						$sqlbug = true; //plantage SQL.
						$_SESSION['erreurs']++;
					}
				}
			}
?&gt;</code></pre><p id="r-122984" data-claire-element-id="122984">Rien de choquant ici : si vous aviez compris le fonctionnement de <code data-claire-semantic="html+php">stripos</code> et que vous aviez vu comment on marchait, vous saviez faire ça.</p><p id="r-122985" data-claire-element-id="122985">Enfin, s'il y a des erreurs, on utilise pas <code data-claire-semantic="html+php">else if</code>, car <code data-claire-semantic="html+php">$_SESSION['erreurs']</code> a pu devenir supérieur à 0 dans le <code data-claire-semantic="html+php">if</code>, donc on fait une nouvelle condition. :)</p><pre id="r-122986" data-claire-element-id="122986"><code data-claire-semantic="html+php">&lt;?php
			if($_SESSION['erreurs'] &gt; 0)
			{
				if($_SESSION['erreurs'] == 1) $_SESSION['nb_erreurs'] = '&lt;span class=&quot;erreur&quot;&gt;Il y a eu 1 erreur.&lt;/span&gt;&lt;br/&gt;';
				else $_SESSION['nb_erreurs'] = '&lt;span class=&quot;erreur&quot;&gt;Il y a eu '.$_SESSION['erreurs'].' erreurs.&lt;/span&gt;&lt;br/&gt;';
			?&gt;
			&lt;h1&gt;Inscription non validée.&lt;/h1&gt;
			&lt;p&gt;Vous avez rempli le formulaire d'inscription du site et nous vous en remercions, cependant, nous n'avons
			pas pu valider votre inscription, en voici les raisons :&lt;br/&gt;
			&lt;?php
				echo $_SESSION['nb_erreurs'];
				echo $_SESSION['pseudo_info'];
				echo $_SESSION['mdp_info'];
				echo $_SESSION['mdp_verif_info'];
				echo $_SESSION['mail_info'];
				echo $_SESSION['mail_verif_info'];
				echo $_SESSION['date_naissance_info'];
				echo $_SESSION['qcm_info'];
				echo $_SESSION['captcha_info'];
				
				if($sqlbug !== true)
				{
			?&gt;
			Nous vous proposons donc de revenir à la page précédente pour corriger les erreurs. (Attention, que vous
			l'ayez correctement remplie ou non, la partie sur la charte et l'image est à refaire intégralement.)&lt;/p&gt;
			&lt;div class=&quot;center&quot;&gt;&lt;a href=&quot;inscription.php&quot;&gt;Retour&lt;/a&gt;&lt;/div&gt;
			&lt;?php
				}
				
				else
				{
			?&gt;
			Une erreur est survenue dans la base de données, votre formulaire semble ne pas contenir d'erreurs, donc
			il est possible que le problème vienne de notre côté, réessayez de vous inscrire ou contactez-nous.&lt;/p&gt;
			
			&lt;div class=&quot;center&quot;&gt;&lt;a href=&quot;inscription.php&quot;&gt;Retenter une inscription&lt;/a&gt; - &lt;a href=&quot;../contact.php&quot;&gt;Contactez-nous&lt;/a&gt;&lt;/div&gt;
			&lt;?php
				}
			}
			?&gt;
		&lt;/div&gt;

		&lt;?php
		include('../includes/bas.php');
		?&gt;
&lt;!--fin--&gt;</code></pre><p id="r-122987" data-claire-element-id="122987">Voilà, trait-inscription.php est fini : si vous avez tenté d'en coder une majeure partie vous-mêmes sans pomper le code, alors vous êtes gagnants ; les autres, ben... vous n'êtes pas de vrais Zér0s. :p</p><p id="r-122988" data-claire-element-id="122988">Maintenant, vous avez vu qu'on a utilisé des sessions et qu'on propose de revenir à inscription.php si l'inscription échoue.<br/> Ce n'est pas pour rien, les sessions : on va modifier inscription.php pour qu'elle affiche à nouveau les erreurs qu'il y a eu si l'entier <code data-claire-semantic="html+php">$_SESSION['erreurs']</code> est supérieur à 0 et pour pré-remplir les champs corrects. :)</p><p id="r-122989" data-claire-element-id="122989">Pour le coup, je vous donne le code directement, car il n'y a rien de technique, c'est juste de la gestion d'affichage. :)</p><p id="r-122990" data-claire-element-id="122990"></p><div id="r-122992" data-claire-element-id="122992"><pre id="r-122991" data-claire-element-id="122991"><code data-claire-semantic="html+php">&lt;div id=&quot;contenu&quot;&gt;
			&lt;div id=&quot;map&quot;&gt;
				&lt;a href=&quot;../index.php&quot;&gt;Accueil&lt;/a&gt; =&gt; &lt;a href=&quot;inscription.php&quot;&gt;Inscription 1/2&lt;/a&gt;
			&lt;/div&gt;
			
			&lt;?php
			if($_SESSION['erreurs'] &gt; 0)
			{
			?&gt;
			&lt;div class=&quot;border-red&quot;&gt;
			&lt;h1&gt;Note :&lt;/h1&gt;
			&lt;p&gt;
			Lors de votre dernière tentative d'inscription, des erreurs sont survenues, en voici la liste :&lt;br/&gt;
			&lt;?php
				echo $_SESSION['nb_erreurs'];
				echo $_SESSION['pseudo_info'];
				echo $_SESSION['mdp_info'];
				echo $_SESSION['mdp_verif_info'];
				echo $_SESSION['mail_info'];
				echo $_SESSION['mail_verif_info'];
				echo $_SESSION['date_naissance_info'];
				echo $_SESSION['qcm_info'];
				echo $_SESSION['captcha_info'];
			?&gt;
			Nous vous avons pré-rempli les champs qui étaient corrects.&lt;br/&gt;
			Note : la partie QCM et image est entièrement à refaire, que vous vous soyez trompé ou non.
			&lt;/p&gt;
			&lt;/div&gt;
			&lt;?php
			}
			?&gt;
			
			&lt;h1&gt;Formulaire d'inscription&lt;/h1&gt;
			&lt;p&gt;Bienvenue sur la page d'inscription de mon site !&lt;br/&gt;
			Merci de remplir ces champs pour continuer.&lt;/p&gt;
			&lt;form action=&quot;trait-inscription.php&quot; method=&quot;post&quot; name=&quot;Inscription&quot;&gt;
				&lt;fieldset&gt;&lt;legend&gt;Identifiants&lt;/legend&gt;
					&lt;label for=&quot;pseudo&quot; class=&quot;float&quot;&gt;Pseudo :&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;pseudo&quot; id=&quot;pseudo&quot; size=&quot;30&quot; value=&quot;&lt;?php if($_SESSION['pseudo_info'] == '') echo htmlspecialchars($_SESSION['form_pseudo'], ENT_QUOTES) ; ?&gt;&quot; /&gt; &lt;em&gt;(compris entre 3 et 32 caractères)&lt;/em&gt;&lt;br /&gt;
					&lt;label for=&quot;mdp&quot; class=&quot;float&quot;&gt;Mot de passe :&lt;/label&gt; &lt;input type=&quot;password&quot; name=&quot;mdp&quot; id=&quot;mdp&quot; size=&quot;30&quot; value=&quot;&lt;?php if($_SESSION['mdp_info'] == '') echo htmlspecialchars($_SESSION['form_mdp'], ENT_QUOTES) ; ?&gt;&quot; /&gt; &lt;em&gt;(compris entre 4 et 50 caractères)&lt;/em&gt;&lt;br /&gt;
					&lt;label for=&quot;mdp_verif&quot; class=&quot;float&quot;&gt;Mot de passe (vérification) :&lt;/label&gt; &lt;input type=&quot;password&quot; name=&quot;mdp_verif&quot; id=&quot;mdp_verif&quot; size=&quot;30&quot; value=&quot;&lt;?php if($_SESSION['mdp_verif_info'] == '') echo htmlspecialchars($_SESSION['form_mdp_verif'], ENT_QUOTES) ; ?&gt;&quot; /&gt;&lt;br /&gt;
					&lt;label for=&quot;mail&quot; class=&quot;float&quot;&gt;Mail :&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;mail&quot; id=&quot;mail&quot; size=&quot;30&quot; value=&quot;&lt;?php if($_SESSION['mail_info'] == '') echo htmlspecialchars($_SESSION['form_mail'], ENT_QUOTES) ; ?&gt;&quot; /&gt; &lt;br /&gt;
					&lt;label for=&quot;mail_verif&quot; class=&quot;float&quot;&gt;Mail (vérification) :&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;mail_verif&quot; id=&quot;mail_verif&quot; size=&quot;30&quot; value=&quot;&lt;?php if($_SESSION['mail_verif_info'] == '') echo htmlspecialchars($_SESSION['form_mail_verif'], ENT_QUOTES) ; ?&gt;&quot; /&gt;&lt;br /&gt;
					&lt;label for=&quot;date_naissance&quot; class=&quot;float&quot;&gt;Date de naissance :&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;date_naissance&quot; id=&quot;date_naissance&quot; size=&quot;30&quot; value=&quot;&lt;?php if($_SESSION['date_naissance_info'] == '') echo htmlspecialchars($_SESSION['form_date_naissance'], ENT_QUOTES) ; ?&gt;&quot; /&gt; &lt;em&gt;(format JJ/MM/AAAA)&lt;/em&gt;&lt;br/&gt;
				&lt;/fieldset&gt;
				&lt;fieldset&gt;&lt;legend&gt;Charte du site et protection anti-robot&lt;/legend&gt;
					&lt;?php
					include('../includes/charte.php');
					?&gt;
					
					&lt;h1&gt;Système anti robots :&lt;/h1&gt;
					
					&lt;p&gt;Qu'est-ce que c'est ?&lt;br/&gt;
					Pour lutter contre l'inscription non désirée de robots qui publient du contenu non désiré sur les sites web,
					nous avons décidé de mettre en place un systèle de sécurité.&lt;br/&gt;
					Aucun de ces systèmes n'est parfait, mais nous espérons que celui-ci, sans vous être inaccessible sera suffisant
					pour lutter contre ces robots.&lt;br/&gt;
					Il est possible que certaine fois, l'image soit trop dure à lire, le cas échéant, actualisez la page jusqu'à avoir une image lisible.&lt;br/&gt;
					Si vous êtes dans l'incapacité de lire plusieurs images d'affilée, &lt;a href=&quot;../contact.php&quot;&gt;contactez-nous&lt;/a&gt;, nous nous occuperons de votre inscription.&lt;/p&gt;
					&lt;label for=&quot;captcha&quot; class=&quot;float&quot;&gt;Entrez les 8 caractères (majuscules ou chiffres) contenus dans l'image :&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;captcha&quot; id=&quot;captcha&quot;&gt;&lt;br/&gt;
					&lt;img src=&quot;captcha.php&quot; /&gt;
				&lt;/fieldset&gt;
				&lt;div class=&quot;center&quot;&gt;&lt;input type=&quot;submit&quot; value=&quot;Inscription&quot; /&gt;&lt;/div&gt;
			&lt;/form&gt;
		&lt;/div&gt;</code></pre></div><p id="r-122993" data-claire-element-id="122993">Voilà, c'était pas bien dur. :p</p><p id="r-122994" data-claire-element-id="122994">Eh bien vous savez quoi ? Le traitement du formulaire est bel et bien fini, cette fois ! :D</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site">Créer un espace membre pour son site</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Création d&#039;un système simple
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">Introduction</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
Un espace membre ? Kékécé ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
Présentation de la première partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
Présentation de la seconde partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
La table SQL
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">Les bases du système</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
Des pages bien utiles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
D&#039;autres pages à inclure
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">Inscription</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
Le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
Charte et système anti-robot
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">La validation et les mails</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
Validation du formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
Un petit mail ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">TP : connexion et déconnexion</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
Prérequis et explications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
Et après ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">TP : site et profils</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
Exercice 1 - Création de statistiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
Correction de l&#039;exercice 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
Exercice 2 - Création de la page user.php
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
Correction de l&#039;exercice 2
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">
<span class="arrow"></span>
<span class="next">La validation et les mails</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
<span class="next">Un petit mail ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Unpetitmail"></a><h2>Un petit mail ?</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
<span class="arrow"></span>
<span class="next">Validation du formulaire</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">
<span class="next">TP : connexion et déconnexion</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-un-petit-mail" data-claire-element-id="123040">Un petit mail ?</h4><p id="r-122997" data-claire-element-id="122997">Bon, bon, bon... :p</p><p id="r-122998" data-claire-element-id="122998">On a déjà fait pas mal de choses, mais il faut encore envoyer un mail au membre qui vient de s'inscrire. :) <br/> Pour cela, il faut avoir un serveur qui le permette ; normalement, vous n'avez rien à faire pour que la fonction marche.</p><p id="r-122999" data-claire-element-id="122999">Il y a un <a href="http://www.siteduzero.com/tutoriel-3-35146-mail-envoyer-un-mail-en-php.html">tutoriel</a> du SdZ qui propose d'étudier la fonction <code data-claire-semantic="html+php">mail </code>, je vous le recommande chaudement !</p><p id="r-123000" data-claire-element-id="123000">Cependant, on ne sait jamais : si par hasard vous voulez vérifier si vous ne pouvez pas l'activer, consultez <a href="http://fr2.php.net/manual/fr/book.mail.php">la documentation</a>.</p><p id="r-123001" data-claire-element-id="123001">Un bon exemple de l'utilisation de la fonction <code data-claire-semantic="html+php">mail </code> est fait dans <a href="http://www.siteduzero.com/tutoriel-3-35459-envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement.html">ce tutoriel</a>.</p><p id="r-123002" data-claire-element-id="123002">Nous allons ici étudier cette fonction et certaines de ses possibilités.</p><p id="r-123003" data-claire-element-id="123003">Comme nous le dit la <a href="http://fr2.php.net/manual/fr/function.mail.php">documentation PHP</a>, la fonction <code data-claire-semantic="html+php">mail() </code> se décrit ainsi :</p><p id="r-123004" data-claire-element-id="123004"><cite>Citation : Doc</cite></p><blockquote id="r-123006" data-claire-element-id="123006"><p id="r-123005" data-claire-element-id="123005">bool mail(string $to, string $subject, string $message[, string $additional_headers[, string $additional_parameters]])</p></blockquote><p id="r-123007" data-claire-element-id="123007">Elle prend donc en paramètre obligatoire un destinataire (surpris ? :p ), un sujet, un message, et c'est tout.</p><pre id="r-123008" data-claire-element-id="123008"><code data-claire-semantic="html+php">&lt;?php
$to = '<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="e18f848e95849393808f8e92a19288958485949b84938ecf828e8c">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>'; //je m'y crois un peu trop, moi o_O
$subject = 'Merci !!';
$message = 'Merci le SdZ. :)';

mail($to, $subject, $message); //marche
?&gt;</code></pre><p id="r-123009" data-claire-element-id="123009">Ce petit bout de code marche sans soucis, mais évitez de le faire : vous n'aurez jamais de réponse. :p</p><p id="r-123010" data-claire-element-id="123010">Cependant, la fonction <code data-claire-semantic="html+php">mail </code> telle quelle n'est pas terrible.<br/> Le message est restreint : en effet, on ne peut envoyer que des textes contenant 70 caractères par ligne, chaque ligne étant séparée par un <code data-claire-semantic="html+php"></code> .<br/> Il y a de plus une histoire avec les . dans le message...</p><p id="r-123011" data-claire-element-id="123011">Bref, avec la fonction <code data-claire-semantic="html+php">mail </code>, on ne peut rien faire... :(</p><p id="r-123012" data-claire-element-id="123012">Heureusement qu'il y a des headers :p (en fait, on peut faire des choses avec <code data-claire-semantic="html+php">mail </code>, mais c'est mieux de passer outre les impositions vraiment lourdes).</p><p id="r-123013" data-claire-element-id="123013">En effet, en paramètre additionnel (donc facultatif), vous pouvez fournir des en-têtes.<br/> Imaginons que, par un grand hasard, vous ayez, sans vous en rendre compte (tout cela n'est que pure coïncidence), composé ce code :</p><pre id="r-123014" data-claire-element-id="123014"><code data-claire-semantic="html+php">&lt;?php
$to = '<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="2b454e445f4e59594a4544586b58425f4e4f5e514e594405484446">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>'; //je m'y crois un peu trop, moi o_O
$subject = 'Merci !!';
$message = '&lt;html&gt;
      &lt;head&gt;
       &lt;title&gt;J\'vous kiffe de trop :D&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
       &lt;p&gt;Loin de moi l\'envie fortuite de vous importuner avec mes&lt;br/&gt;
discours aussi inutiles qu\'endormants, mais je trouve que vous êtes&lt;br/&gt;
tout simplement génial !!&lt;/p&gt;
&lt;p&gt;I love you !! (De tout mon body).&lt;/p&gt;
      &lt;/body&gt;
     &lt;/html&gt;';

$headers  = 'MIME-Version: 1.0' . &quot;\r\n&quot;;
$headers .= 'Content-type: text/html; charset=utf-8' . &quot;\r\n&quot;;

     // En-têtes additionnels
$headers .= 'From: &quot;Mon super site&quot; &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="3d5e5253495c5e497d4e484d584f4e544958135e5250">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;' . &quot;\r\n&quot;;
$headers .= 'Cc: &quot;Contact&quot; &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="afccc0c1dbceccdbefdcdadfcadddcc6dbca81ccc0c2">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;' . &quot;\r\n&quot;;
$headers .= 'Bcc: &quot;Contact&quot; &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="01626e6f75606275417274716473726875642f626e6c">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;' . &quot;\r\n&quot;;
$headers .= 'Reply-To: &quot;Members&quot; &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="97faf2faf5e5f2e4d7e4e2e7f2e5e4fee3f2b9f4f8fa">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;' . &quot;\r\n&quot;;

$mail = mail($to, $subject, $message, $headers); //marche

if($mail) echo 'ok';
else echo 'erreur.';
?&gt;</code></pre><p id="r-123015" data-claire-element-id="123015">Eh bien certes vous enverrez un mail ridicule et personne ne le lira, mais normalement, il arrivera en un seul morceau. :p</p><aside id="r-123017" data-claire-element-id="123017" data-claire-semantic="information"><p id="r-123016" data-claire-element-id="123016">Oh my god, on peut envoyer des mails en HTML !!</p></aside><p id="r-123018" data-claire-element-id="123018">En effet, la fonction <code data-claire-semantic="html+php">mail </code> peut formater des mails en HTML, c'est ce qui va nous servir par la suite ; avec cette fonction, vous pourrez même faire de la mise en forme, envoyer des pièces jointes (images, etc.), vous donnerez ainsi des rendus agréables à lire.</p><p id="r-123019" data-claire-element-id="123019">Nous ici, on veut envoyer un mail à notre cher inscrit.<br/> Il faut donc créer une fonction <code data-claire-semantic="html+php">inscription_mail() </code>, elle sera très basique, mais en partie II, nous vous proposerons d'envoyer des pièces jointes avec les mails, pour faire des belles newsletters comme le SdZ en fait. :)</p><p id="r-123020" data-claire-element-id="123020">Sans plus attendre :</p><pre id="r-123021" data-claire-element-id="123021"><code data-claire-semantic="html+php">&lt;?php
function inscription_mail($mail, $pseudo, $passe)
{
	$to = $mail;
	$subject = 'Inscription sur '.TITRESITE.' - '.$pseudo;
?&gt;</code></pre><p id="r-123022" data-claire-element-id="123022">On définit le message. :)</p><pre id="r-123023" data-claire-element-id="123023"><code data-claire-semantic="html+php">&lt;?php
	$message = '&lt;html&gt;
					&lt;head&gt;
						&lt;title&gt;&lt;/title&gt;
					&lt;/head&gt;
					
					&lt;body&gt;
						&lt;div&gt;Bienvenue sur '.TITRESITE.' !&lt;br/&gt;
						Vous avez complété une inscription avec le pseudo
						'.htmlspecialchars($pseudo, ENT_QUOTES).' à l\'instant.&lt;br/&gt;
						Votre mot de passe est : '.htmlspecialchars($passe, ENT_QUOTES).'.&lt;br/&gt;
						Veillez à le garder secret et à ne pas l\'oublier.&lt;br/&gt;&lt;br/&gt;
						
						En vous remerciant.&lt;br/&gt;&lt;br/&gt;
						Moi - Wembaster de '.TITRESITE.'
					&lt;/body&gt;
				&lt;/html&gt;';
?&gt;</code></pre><p id="r-123024" data-claire-element-id="123024">Ensuite viennent les headers additionnels (cherchez avant de lire le code) :</p><div id="r-123026" data-claire-element-id="123026"><pre id="r-123025" data-claire-element-id="123025"><code data-claire-semantic="html+php">&lt;?php
//headers principaux.
$headers  = 'MIME-Version: 1.0' . &quot;\r\n&quot;;
$headers .= 'Content-type: text/html; charset=utf-8' . &quot;\r\n&quot;;
//headers supplémentaires
$headers .= 'From: &quot;Mon super site&quot; &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="21424e4f55404255615254514453524855440f424e4c">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;' . &quot;\r\n&quot;;
$headers .= 'Cc: &quot;Duplicata&quot; &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="b6d2c3c6dadfd5d7c2d7f6c5c3c6d3c4c5dfc2d398d5d9db">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;' . &quot;\r\n&quot;;
$headers .= 'Reply-To: &quot;Membres&quot; &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="335e565e51415640734046435641405a47561d505c5e">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;' . &quot;\r\n&quot;;
?&gt;</code></pre></div><p id="r-123027" data-claire-element-id="123027">Enfin, l'envoi (idem, facile). :)</p><p id="r-123028" data-claire-element-id="123028"></p><div id="r-123030" data-claire-element-id="123030"><pre id="r-123029" data-claire-element-id="123029"><code data-claire-semantic="html+php">&lt;?php
$mail = mail($to, $subject, $message, $headers); //marche

if($mail) return true;
return false;
}
?&gt;</code></pre></div><p id="r-123031" data-claire-element-id="123031">Notre fonction est fin prête.<br/> Il ne reste plus qu'à l'implémenter dans trait_inscription.php. :) <br/> Je vous laisse faire. ^^</p><p id="r-123032" data-claire-element-id="123032"></p><div id="r-123034" data-claire-element-id="123034"><pre id="r-123033" data-claire-element-id="123033"><code data-claire-semantic="html+php">&lt;?php
				if(mysql_query($insertion))
				{
					if(inscription_mail($mail, $pseudo, $mdp)) $sent = 'Un mail de confirmation vous a été envoyé.';
					else $sent = 'Un mail de confirmation devait être envoyé, mais son envoi a échoué, vous êtes cependant bien inscrit.';
					vidersession();
					$_SESSION['inscrit'] = $pseudo;
					/*informe qu'il s'est déjà inscrit s'il actualise, si son navigateur
					bugue avant l'affichage de la page et qu'il recharge la page, etc.*/
				?&gt;
			&lt;h1&gt;Inscription validée !&lt;/h1&gt;
			&lt;p&gt;Nous vous remercions de vous être inscrit sur notre site, votre inscription a été validée !&lt;br/&gt;
			Vous pouvez vous connecter avec vos identifiants &lt;a href=&quot;connexion.php&quot;&gt;ici&lt;/a&gt;&lt;br/&gt;.
			&lt;?php echo $sent; ?&gt;</code></pre></div><p id="r-123035" data-claire-element-id="123035">On crée une variable <code data-claire-semantic="html+php">sent </code> qui contient le statut d'envoi ; si tout est bon, on affiche un message informatif, sinon on affiche une erreur (qui n'annule pas l'inscription).</p><p id="r-123036" data-claire-element-id="123036">Voilà : le plus dur dans la fonction <code data-claire-semantic="html+php">mail </code>, c'est de comprendre comment elle marche ; le reste, c'est du gâteau. :p</p><p id="r-123037" data-claire-element-id="123037">Pfiou, l'inscription est enfin finie...<br/> J'espère que vous êtes contents de vous. :)</p><p id="r-123038" data-claire-element-id="123038">Voilà, le prochain chapitre sera un TP, vous y créerez une page de connexion / déconnexion.</p><p id="r-123039" data-claire-element-id="123039">Prêts ? :)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site">Créer un espace membre pour son site</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Création d&#039;un système simple
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">Introduction</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
Un espace membre ? Kékécé ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
Présentation de la première partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
Présentation de la seconde partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
La table SQL
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">Les bases du système</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
Des pages bien utiles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
D&#039;autres pages à inclure
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">Inscription</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
Le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
Charte et système anti-robot
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">La validation et les mails</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
Validation du formulaire
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
Un petit mail ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">TP : connexion et déconnexion</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
Prérequis et explications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
Et après ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">TP : site et profils</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
Exercice 1 - Création de statistiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
Correction de l&#039;exercice 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
Exercice 2 - Création de la page user.php
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
Correction de l&#039;exercice 2
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
<span class="arrow"></span>
<span class="next">Validation du formulaire</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">
<span class="next">TP : connexion et déconnexion</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="TPconnexionetdconnexion"></a><h2>TP : connexion et déconnexion</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
<span class="arrow"></span>
<span class="next">Un petit mail ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
<span class="next">Prérequis et explications</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-123042" data-claire-element-id="123042">Dans ce chapitre, nous allons voir comment nous connecter et nous déconnecter.<br/> Nous allons également faire un petit système utilisant les cookies pour faire une connexion automatique sans avoir besoin de rentrer les informations de connexion.</p><p id="r-123043" data-claire-element-id="123043">Vous verrez, ce n'est vraiment pas compliqué, en plus, ce n'est même pas long. ^^</p><p id="r-123044" data-claire-element-id="123044">C'est parti !</p>
</div><a name="Prrequisetexplications"></a><h2>Prérequis et explications</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">
<span class="arrow"></span>
<span class="next">TP : connexion et déconnexion</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
<span class="next">Correction</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-prerequis-et-explications" data-claire-element-id="123056">Prérequis et explications</h4><p id="r-123045" data-claire-element-id="123045">Bon : avant de nous lancer dans notre premier TP ensemble, je vais résumer ce que j'attends de vous, et comment je vois les choses. :)</p><h5 id="r-connexion-php" data-claire-element-id="123051">connexion.php</h5><p id="r-123046" data-claire-element-id="123046">Cette page, comme vous vous en doutez, contiendra le formulaire de connexion au site.<br/> Je voudrais que le formulaire de connexion et la page validant la connexion ne fassent justement qu'une seule et même page.<br/> Par conséquent, je vous invite à utiliser un champ <code data-claire-semantic="html+php">hidden </code> et à tester sa valeur pour savoir si vous êtes en phase validation ou non. :)</p><p id="r-123047" data-claire-element-id="123047">Cette page vérifiera si le visiteur est connecté ou non, si le pseudo est bon, si le mot de passe est bon, s'il existe des doublons dans votre base de données (normalement c'est impossible, mais on est sûr de rien).</p><p id="r-123048" data-claire-element-id="123048">Si tout roule, on valide la connexion et on crée les variables de session.<br/> Sinon, on utilise information.php. :)</p><aside id="r-123050" data-claire-element-id="123050" data-claire-semantic="warning"><p id="r-123049" data-claire-element-id="123049">Si le mot de passe est erroné, je veux que la page se rappelle du pseudo entré par le visiteur.</p></aside><h5 id="r-deconnexion-php" data-claire-element-id="123055">deconnexion.php</h5><p id="r-123052" data-claire-element-id="123052">Cette page détruit sessions et cookies et appelle information.php.<br/> Rien de plus simple. :D</p><p id="r-123053" data-claire-element-id="123053">Vous n'avez pas besoin de conseils, vous pouvez très bien y arriver tout seuls. :)</p><p id="r-123054" data-claire-element-id="123054">Allez, c'est parti !</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site">Créer un espace membre pour son site</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Création d&#039;un système simple
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">Introduction</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
Un espace membre ? Kékécé ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
Présentation de la première partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
Présentation de la seconde partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
La table SQL
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">Les bases du système</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
Des pages bien utiles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
D&#039;autres pages à inclure
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">Inscription</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
Le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
Charte et système anti-robot
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">La validation et les mails</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
Validation du formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
Un petit mail ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">TP : connexion et déconnexion</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
Prérequis et explications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
Et après ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">TP : site et profils</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
Exercice 1 - Création de statistiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
Correction de l&#039;exercice 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
Exercice 2 - Création de la page user.php
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
Correction de l&#039;exercice 2
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">
<span class="arrow"></span>
<span class="next">TP : connexion et déconnexion</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
<span class="next">Correction</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Correction"></a><h2>Correction</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
<span class="arrow"></span>
<span class="next">Prérequis et explications</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
<span class="next">Et après ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-correction-54" data-claire-element-id="123078">Correction</h4><p id="r-123057" data-claire-element-id="123057">Bon, ben nous y voilà. :p</p><p id="r-123058" data-claire-element-id="123058">Je vous donne les corrections, et j'expliquerai deux ou trois choses qui me semblent importantes. :)</p><h6 id="r-membres-connexion-php" data-claire-element-id="123061">membres / connexion.php</h6><div id="r-123060" data-claire-element-id="123060"><pre id="r-123059" data-claire-element-id="123059"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page connexion.php

Permet de se connecter au site.

Quelques indications : (Utiliser l'outil de recherche et rechercher les mentions données)

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations/erreurs :
--------------------------
Membre qui essaie de se connecter alors qu'il l'est déjà
Vous êtes bien connecté
Erreur de mot de passe
Erreur de pseudo doublon (normalement impossible)
Pseudo inconnu
--------------------------
*/

session_start();
header('Content-type: text/html; charset=utf-8');
include('../includes/config.php');

/********Actualisation de la session...**********/

include('../includes/fonctions.php');
connexionbdd();
actualiser_session();

/********Fin actualisation de session...**********/

if(isset($_SESSION['membre_id']))
{
	$informations = Array(/*Membre qui essaie de se connecter alors qu'il l'est déjà*/
					true,
					'Vous êtes déjà connecté',
					'Vous êtes déjà connecté avec le pseudo &lt;span class=&quot;pseudo&quot;&gt;'.htmlspecialchars($_SESSION['membre_pseudo'], ENT_QUOTES).'&lt;/span&gt;.',
					' - &lt;a href=&quot;'.ROOTPATH.'/membres/deconnexion.php&quot;&gt;Se déconnecter&lt;/a&gt;',
					ROOTPATH.'/index.php',
					5
					);
	
	require_once('../information.php');
	exit();
}

if($_POST['validate'] != 'ok')
{
/********Entête et titre de page*********/

$titre = 'Connexion';

include('../includes/haut.php'); //contient le doctype, et head.

/**********Fin entête et titre***********/
?&gt;		
		&lt;div id=&quot;colonne_gauche&quot;&gt;
		&lt;?php
		include('../includes/colg.php');
		?&gt;
		&lt;/div&gt;
		
		&lt;div id=&quot;contenu&quot;&gt;
			&lt;div id=&quot;map&quot;&gt;
				&lt;a href=&quot;../index.php&quot;&gt;Accueil&lt;/a&gt; =&gt; &lt;a href=&quot;connexion.php&quot;&gt;Connexion&lt;/a&gt;
			&lt;/div&gt;
					
			&lt;h1&gt;Formulaire de connexion&lt;/h1&gt;
			&lt;p&gt;Pour vous connecter, indiquez votre pseudo et votre mot de passe.&lt;br/&gt;
			Vous pouvez aussi cocher l'option &quot;Me connecter automatiquement à mon
			prochain passage.&quot; pour laisser une trace sur votre ordinateur pour être
			connecté automatiquement.&lt;br/&gt;
			Ce système de trace est basé sur les cookies, ce sont des petits fichiers
			contenant votre numéro d'identification ainsi qu'une version cryptée de votre
			mot de passe. Ces fichiers ne peuvent en aucun cas endommager votre ordinateur,
			ni l'affecter d'aucune façons, vous pourrez les supprimer à tout moment dans
			les options de votre navigateur.&lt;/p&gt;
			
			&lt;form name=&quot;connexion&quot; id=&quot;connexion&quot; method=&quot;post&quot; action=&quot;connexion.php&quot;&gt;
				&lt;fieldset&gt;&lt;legend&gt;Connexion&lt;/legend&gt;
					&lt;label for=&quot;pseudo&quot; class=&quot;float&quot;&gt;Pseudo :&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;pseudo&quot; id=&quot;pseudo&quot; value=&quot;&lt;?php if(isset($_SESSION['connexion_pseudo'])) echo $_SESSION['connexion_pseudo']; ?&gt;&quot;/&gt;&lt;br/&gt;
					&lt;label for=&quot;mdp&quot; class=&quot;float&quot;&gt;Passe :&lt;/label&gt; &lt;input type=&quot;password&quot; name=&quot;mdp&quot; id=&quot;mdp&quot;/&gt;&lt;br/&gt;
					&lt;input type=&quot;hidden&quot; name=&quot;validate&quot; id=&quot;validate&quot; value=&quot;ok&quot;/&gt;
					&lt;input type=&quot;checkbox&quot; name=&quot;cookie&quot; id=&quot;cookie&quot;/&gt; &lt;label for=&quot;cookie&quot;&gt;Me connecter automatiquement à mon prochain passage.&lt;/label&gt;&lt;br/&gt;
					&lt;div class=&quot;center&quot;&gt;&lt;input type=&quot;submit&quot; value=&quot;Connexion&quot; /&gt;&lt;/div&gt;
				&lt;/fieldset&gt;
			&lt;/form&gt;
			
			&lt;h1&gt;Options&lt;/h1&gt;
			&lt;p&gt;&lt;a href=&quot;inscription.php&quot;&gt;Je ne suis pas inscrit !&lt;/a&gt;&lt;br/&gt;
			&lt;a href=&quot;moncompte.php?action=reset&quot;&gt;J'ai oublié mon mot de passe !&lt;/a&gt;
			&lt;/p&gt;
			&lt;?php
}
			
			else
			{
				$result = sqlquery(&quot;SELECT COUNT(membre_id) AS nbr, membre_id, membre_pseudo, membre_mdp FROM membres WHERE
				membre_pseudo = '&quot;.mysql_real_escape_string($_POST['pseudo']).&quot;' GROUP BY membre_id&quot;, 1);
				
				if($result['nbr'] == 1)
				{
					if(md5($_POST['mdp']) == $result['membre_mdp'])
					{
						$_SESSION['membre_id'] = $result['membre_id'];
						$_SESSION['membre_pseudo'] = $result['membre_pseudo'];
						$_SESSION['membre_mdp'] = $result['membre_mdp'];
						unset($_SESSION['connexion_pseudo']);
						
						if(isset($_POST['cookie']) &amp;&amp; $_POST['cookie'] == 'on')
						{
							setcookie('membre_id', $result['membre_id'], time()+365*24*3600);
							setcookie('membre_mdp', $result['membre_mdp'], time()+365*24*3600);
						}
						
						$informations = Array(/*Vous êtes bien connecté*/
										false,
										'Connexion réussie',
										'Vous êtes désormais connecté avec le pseudo &lt;span class=&quot;pseudo&quot;&gt;'.htmlspecialchars($_SESSION['membre_pseudo'], ENT_QUOTES).'&lt;/span&gt;.',
										'',
										ROOTPATH.'/index.php',
										3
										);
						require_once('../information.php');
						exit();
					}
					
					else
					{
						$_SESSION['connexion_pseudo'] = $_POST['pseudo'];
						$informations = Array(/*Erreur de mot de passe*/
										true,
										'Mauvais mot de passe',
										'Vous avez fourni un mot de passe incorrect.',
										' - &lt;a href=&quot;'.ROOTPATH.'/index.php&quot;&gt;Index&lt;/a&gt;',
										ROOTPATH.'/membres/connexion.php',
										3
										);
						require_once('../information.php');
						exit();
					}
				}
				
				else if($result['nbr'] &gt; 1)
				{
					$informations = Array(/*Erreur de pseudo doublon (normalement impossible)*/
									true,
									'Doublon',
									'Deux membres ou plus ont le même pseudo, contactez un administrateur pour régler le problème.',
									' - &lt;a href=&quot;'.ROOTPATH.'/index.php&quot;&gt;Index&lt;/a&gt;',
									ROOTPATH.'/contact.php',
									3
									);
					require_once('../information.php');
					exit();
				}
				
				else
				{
					$informations = Array(/*Pseudo inconnu*/
									true,
									'Pseudo inconnu',
									'Le pseudo &lt;span class=&quot;pseudo&quot;&gt;'.htmlspecialchars($_POST['pseudo'], ENT_QUOTES).'&lt;/span&gt; n\'existe pas dans notre base de données. Vous avez probablement fait une erreur.',
									' - &lt;a href=&quot;'.ROOTPATH.'/index.php&quot;&gt;Index&lt;/a&gt;',
									ROOTPATH.'/membres/connexion.php',
									5
									);
					require_once('../information.php');
					exit();
				}
			}
			?&gt;			
		&lt;/div&gt;

		&lt;?php
		include('../includes/bas.php');
		mysql_close();
		?&gt;</code></pre></div><h6 id="r-membres-deconnexion-php" data-claire-element-id="123077">membres / deconnexion.php</h6><div id="r-123063" data-claire-element-id="123063"><pre id="r-123062" data-claire-element-id="123062"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page deconnexion.php

Permet de se déconnecter du site.

Quelques indications : (Utiliser l'outil de recherche et rechercher les mentions données)

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations/erreurs :
--------------------------
Déconnexion
--------------------------
*/

session_start();
include('../includes/config.php');
include('../includes/fonctions.php');
connexionbdd();
mysql_query(&quot;DELETE FROM connectes WHERE connectes_id = &quot;.$_SESSION['membre_id']) or exit(mysql_error());
vider_cookie();
session_destroy();

$informations = Array(/*Déconnexion*/
				false,
				'Déconnexion',
				'Vous êtes à présent déconnecté.',
				' - &lt;a href=&quot;'.ROOTPATH.'/membres/connexion.php&quot;&gt;Se connecter&lt;/a&gt;',
				ROOTPATH.'/index.php',
				5
				);

require_once('../information.php');
exit();
?&gt;</code></pre></div><h5 id="r-connexion-php-1" data-claire-element-id="123074">connexion.php</h5><p id="r-123064" data-claire-element-id="123064">Déjà, ma manière de faire qu'un formulaire et sa validation soient sur la même page consiste à utiliser une variable <code data-claire-semantic="html+php">post </code> qui se trouvera dans un <code data-claire-semantic="html">input </code> caché du formulaire. C'est une méthode ; on pourrait aussi vérifier un des champs du formulaire, mais pour des raisons pratiques, je ne le fais pas : comme ça, si je modifie le formulaire, je ne touche pas à ce champ et la page reste valable.<br/> Niveau SQL, beaucoup de monde fait une requête type <code data-claire-semantic="html+php">SELECT * WHERE pseudo=$_POST['pseudo'] AND passe=$_POST['passe'] </code> : je n'utilise pas cette méthode, non pas parce qu'elle est moins bien, juste parce que j'ai l'habitude de celle que je vous propose. En plus, ça me permettait de vous montrer comment sélectionner des données et faire un <code data-claire-semantic="html+php">COUNT() </code> en même temps ; en effet, essayez en retirant <code data-claire-semantic="html+php">GROUP BY membre_id </code>, vous aurez droit à une belle erreur.</p><p id="r-123065" data-claire-element-id="123065">À vrai dire, on se fiche pas mal de pouvoir faire un <code data-claire-semantic="html+php">count </code> et un <code data-claire-semantic="html+php">select </code> ici, mais bon, comme ça, vous le saurez à l'avenir. :) <br/> L'option <em>se souvenir de moi</em> est tout ce qu'il y a de plus banal.<br/> Bref, cette correction vous révèle certains de mes tics en PHP, pas forcément mieux ni même bien, mais ce sont les miens : ce sont des automatismes, et je vous invite à les modifier s'ils ne vous plaisent pas, et à me dire en commentaire si pour une raison ou pour une autre, vous estimez que je devrais éditer ces codes pour utiliser des méthodes différentes.</p><p id="r-123066" data-claire-element-id="123066">Pour en revenir aux actions de la page, elle fait bien tout ce que je vous ai raconté :</p><pre id="r-123067" data-claire-element-id="123067"><code data-claire-semantic="html+php">&lt;?php
if(isset($_SESSION['membre_id']))
{
	$informations = Array(/*Membre qui essaie de se connecter alors qu'il l'est déjà*/
					true,
					'Vous êtes déjà connecté',
					'Vous êtes déjà connecté avec le pseudo &lt;span class=&quot;pseudo&quot;&gt;'.htmlspecialchars($_SESSION['membre_pseudo'], ENT_QUOTES).'&lt;/span&gt;.',
					' - &lt;a href=&quot;'.ROOTPATH.'/membres/deconnexion.php&quot;&gt;Se déconnecter&lt;/a&gt;',
					ROOTPATH.'/index.php',
					5
					);
	
	require_once('../information.php');
	exit();
}
?&gt;</code></pre><p id="r-123068" data-claire-element-id="123068">Ici on vérifie le statut du visiteur, on pourrait le renvoyer bêtement à l'index, mais contrairement à l'inscription, la connexion est assez fréquente, il suffit que l'utilisateur ait le lien vers la connexion en historique et il se fait refouler sans précisions, contrairement à l'inscription, je mets un message.</p><pre id="r-123069" data-claire-element-id="123069"><code data-claire-semantic="html+php">&lt;?php
if($_POST['validate'] != 'ok')
?&gt;</code></pre><p id="r-123070" data-claire-element-id="123070">Voilà ma variable cachée en action. :p</p><pre id="r-123071" data-claire-element-id="123071"><code data-claire-semantic="html+php">&lt;label for=&quot;pseudo&quot; class=&quot;float&quot;&gt;Pseudo :&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;pseudo&quot; id=&quot;pseudo&quot; value=&quot;&lt;?php if(isset($_SESSION['connexion_pseudo'])) echo $_SESSION['connexion_pseudo']; ?&gt;&quot;/&gt;&lt;br/&gt;</code></pre><p id="r-123072" data-claire-element-id="123072">Ici la variable <code data-claire-semantic="html+php">souvenir </code>.</p><p id="r-123073" data-claire-element-id="123073">Le reste c'est du test de pseudo, mot de passe et affichage d'erreurs. ^^</p><h5 id="r-deconnexion-php-1" data-claire-element-id="123076">deconnexion.php</h5><p id="r-123075" data-claire-element-id="123075">Ici, rien de compliqué non plus : je vide les cookies, j'efface les sessions, et j'affiche un message pour confirmer que le membre s'est déconnecté. :)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site">Créer un espace membre pour son site</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Création d&#039;un système simple
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">Introduction</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
Un espace membre ? Kékécé ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
Présentation de la première partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
Présentation de la seconde partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
La table SQL
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">Les bases du système</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
Des pages bien utiles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
D&#039;autres pages à inclure
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">Inscription</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
Le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
Charte et système anti-robot
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">La validation et les mails</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
Validation du formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
Un petit mail ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">TP : connexion et déconnexion</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
Prérequis et explications
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
Et après ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">TP : site et profils</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
Exercice 1 - Création de statistiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
Correction de l&#039;exercice 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
Exercice 2 - Création de la page user.php
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
Correction de l&#039;exercice 2
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
<span class="arrow"></span>
<span class="next">Prérequis et explications</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
<span class="next">Et après ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Etaprs"></a><h2>Et après ?</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
<span class="arrow"></span>
<span class="next">Correction</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">
<span class="next">TP : site et profils</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-et-apres-3" data-claire-element-id="123091">Et après ?</h4><p id="r-123079" data-claire-element-id="123079">Comme vous l'avez remarqué, ce n'était vraiment pas difficile. :)</p><p id="r-123080" data-claire-element-id="123080">Ce chapitre était en fait vraiment simple, le but était de vous donner un peu de boulot, faudrait pas que je sois le seul à bosser. :p</p><p id="r-123081" data-claire-element-id="123081">Sachez cependant que le prochain chapitre sera un TP peut-être un peu plus difficile : il faudra réfléchir et s'y retrouver entre les statistiques stats.php et l'affichage des profils user.php.</p><p id="r-123082" data-claire-element-id="123082">Avant de nous quitter, je vous propose cependant quelques améliorations pour le système de connexion / déconnexion.</p><p id="r-123083" data-claire-element-id="123083">1°) Quand tout est bon, on valide, et un beau message (de préférence centré) apparaît pour dire au membre qu'il est connecté. À l'inverse, quand le mot de passe est mauvais, ou quand le pseudo est inconnu, on affiche aussi une erreur avec information.php.<br/> Ça a des avantages (clarté), mais aussi des inconvénients (obligé de recharger la page connexion.php).<br/> Pourquoi ne pas incorporer les messages d'erreur dans la page connexion.php ?<br/> Il faut retravailler le code pour mettre un <code data-claire-semantic="html">div </code> avant le formulaire qui affichera les erreurs éventuelles.</p><p id="r-123084" data-claire-element-id="123084">2°) La déconnexion c'est sympa, mais il se peut (je ne sais pas) que le membre ne veuille pas se déconnecter, mais juste réinitialiser ses cookies ou les effacer.<br/> Pourquoi ne pas mettre une page déconnexion avec les trois options et utiliser une variable <code data-claire-semantic="html+php">get </code> pour effectuer l'action voulue par l'utilisateur ?<br/> Pareil, ça a ses plus et ses moins : l'utilisateur impatient dira que ça sert à rien, l'utilisateur pointilleux trouvera ça génial. :)</p><p id="r-123085" data-claire-element-id="123085">3°) Et si, au lieu de faire une page connexion et une page deconnexion, vous faisiez une seule page (<em>statut.php</em> par exemple) qui gère le tout (encore des variables <code data-claire-semantic="html+php">get </code>) ?<br/> Là pour le coup, l'inconvénient est la gestion des cas, l'avantage est d'éviter d'avoir des pages avec seulement 15 lignes de code, et puis certains préfèrent comme ça. :)</p><p id="r-123086" data-claire-element-id="123086">4°) Vous pourriez rajouter une redirection de trait-inscription.php vers connexion.php avec un <code data-claire-semantic="html+php">timer </code> de 5 à 10 secondes.</p><p id="r-123087" data-claire-element-id="123087">Voilà, ce sont quelques idées, juste pour vous rappeler que c'est vous qui personnalisez votre système, pas moi. :p</p><p id="r-123088" data-claire-element-id="123088">Ce chapitre TP touche à sa fin.<br/> Pour ceux qui n'ont pas réussi, ce n'est pas grave, vous ferez mieux dans pas longtemps. :)</p><p id="r-123089" data-claire-element-id="123089">Je vous annonce que le prochain chapitre est aussi un TP, car il reprend essentiellement des points abordés chapitre 3.</p><p id="r-123090" data-claire-element-id="123090">Allons-y. :)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site">Créer un espace membre pour son site</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Création d&#039;un système simple
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">Introduction</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
Un espace membre ? Kékécé ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
Présentation de la première partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
Présentation de la seconde partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
La table SQL
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">Les bases du système</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
Des pages bien utiles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
D&#039;autres pages à inclure
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">Inscription</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
Le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
Charte et système anti-robot
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">La validation et les mails</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
Validation du formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
Un petit mail ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">TP : connexion et déconnexion</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
Prérequis et explications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
Correction
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
Et après ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">TP : site et profils</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
Exercice 1 - Création de statistiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
Correction de l&#039;exercice 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
Exercice 2 - Création de la page user.php
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
Correction de l&#039;exercice 2
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
<span class="arrow"></span>
<span class="next">Correction</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">
<span class="next">TP : site et profils</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="TPsiteetprofils"></a><h2>TP : site et profils</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
<span class="arrow"></span>
<span class="next">Et après ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
<span class="next">Exercice 1 - Création de statistiques</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-123093" data-claire-element-id="123093">Comme prévu, ce chapitre est aussi un TP ; cependant, il sera sensiblement plus long que le précédent, je vais donc le découper en deux parties. Une première portera sur la mise en place de statistiques (même si le terme est assez exagéré pour ce que nous allons faire), et de la page de visualisation des profils, tandis que la seconde partie portera sur l'édition de son profil ou de celui d'un membre (administration oblige). :)</p><p id="r-123094" data-claire-element-id="123094">Pour ce TP, vous n'aurez besoin que des connaissances acquises jusque-là, nous pouvons donc y aller sans plus tarder.</p>
</div><a name="Exercice1-Crationdestatistiques"></a><h2>Exercice 1 - Création de statistiques</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">
<span class="arrow"></span>
<span class="next">TP : site et profils</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
<span class="next">Correction de l&#039;exercice 1</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-exercice-1-creation-de-statistiques" data-claire-element-id="123128">Exercice 1 - Création de statistiques</h4><p id="r-123095" data-claire-element-id="123095">Bon, nous sommes d'accord : le mot statistiques est assez ambigu, on ne va pas faire des choses ultra-poussées comme le nombre de visiteurs uniques par mois, le nombre de pages lues, le nombre de Français qui parcourent votre site et j'en passe ; cela, on y réfléchira peut-être en partie II, mais pour le moment, on se cantonne à des choses très simples. :)</p><p id="r-123096" data-claire-element-id="123096">Ici, je veux donner une utilité à colg.php, je vais donc vous montrer ce que j'y ai mis, et vous allez essayer de me créer les pages et fonctions nécessaires pour faire marcher tout ce bazar !</p><pre id="r-123097" data-claire-element-id="123097"><code data-claire-semantic="html+php">&lt;div id=&quot;statistiques&quot;&gt;&lt;h1&gt;Site&lt;/h1&gt;
                                &lt;a href=&quot;&lt;?php echo ROOTPATH; ?&gt;/stats.php?see=nb_membres&quot;&gt;&lt;?php echo $num1 = get('nb_membres'); if($num1 &lt;= 1) echo ' membre inscrit'; else echo ' membres inscrits'; ?&gt;&lt;/a&gt;&lt;br/&gt;
                                &lt;a href=&quot;&lt;?php echo ROOTPATH; ?&gt;/stats.php?see=connectes&quot;&gt;&lt;?php echo $num2 = get('connectes'); if($num2 &lt;= 1) echo ' visiteur'; else echo ' visiteurs' ?&gt;&lt;/a&gt;&lt;br/&gt;
                                &lt;a href=&quot;&lt;?php echo ROOTPATH; ?&gt;/stats.php?see=passed&quot;&gt;Dernières visites&lt;/a&gt;&lt;br/&gt;
                        &lt;/div&gt;</code></pre><p id="r-123098" data-claire-element-id="123098">Voilà, c'est pas bien gros, mais ça va vous occuper quelques temps. :) <br/> Détaillons ce que nous voulons.</p><p id="r-123099" data-claire-element-id="123099">À la racine de votre site (ou espace de test), créez le fichier stats.php.<br/> Ce fichier recevra une variable <code>$_GET['see']</code> qui lui permettra de savoir quoi faire.</p><h5 id="r-les-differents-cas" data-claire-element-id="123127">Les différents cas</h5><h6 id="r-nb-membres-php" data-claire-element-id="123101">nb_membres.php</h6><p id="r-123100" data-claire-element-id="123100">Si la variable <code>$_GET['see']</code> vaut <code>nb_membres</code>, alors stats.php inclura stats/nb_membres.php qui lui affichera une liste de tous les membres inscrits, avec leur pseudo et dates d'inscription (mis en page).<br/> Nous essayerons d'améliorer cette liste en partie II.</p><h6 id="r-connectes-php" data-claire-element-id="123119">connectes.php</h6><p id="r-123102" data-claire-element-id="123102">Si la variable <code>$_GET['see']</code> vaut <code>connectes</code>, alors stats.php inclura la page stats/connectes.php qui dépendra elle-même d'une variable <code>$_GET['a']</code>.<br/> La page connectes.php devra afficher une liste des membres inscrits connectés si <code>$_GET['a']</code> diffère de 1 ou 2.<br/> Elle montrera une liste des invités connectés si <code>$_GET['a']</code> vaut 2, enfin elle proposera une liste complète si <code>$_GET['a']</code> vaut 1.</p><div id="r-123104" data-claire-element-id="123104" data-claire-semantic="question"><p id="r-123103" data-claire-element-id="123103">Mais... Mais ?! Tu veux qu'on la sorte d'où, la liste des connectés ?!</p></div><p id="r-123105" data-claire-element-id="123105">Ah tiens, excellente question !<br/> Il est temps de créer une deuxième table SQL !</p><pre id="r-123106" data-claire-element-id="123106"><code data-claire-semantic="sql">CREATE TABLE `connectes` (
  `connectes_id` int(11) NOT NULL, --id du membre connecté, vaut -1 si le membre est un invité.
  `connectes_ip` varchar(16) NOT NULL, --l'ip du connecté, fera appel à une fonction getIp().
  `connectes_membre` varchar(16) NOT NULL, --est-ce que le connecté est un membre ? Vaut 1 si oui, vaut l'adresse IP du connecté sinon.
  `connectes_actualisation` int(11) NOT NULL, --dernière actualisation
  UNIQUE KEY `membre_id` (`connectes_id`,`connectes_membre`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
*/</code></pre><p id="r-123107" data-claire-element-id="123107">Bien : maintenant, nous allons donc devoir faire des modifications à <code data-claire-semantic="html+php">actualiser_session() </code> !<br/> Premièrement, à chaque fois que le membre actualise une page, sa session est vérifiée et validée à nouveau, il faut donc qu'à chaque fois que le membre actualise une page, on mette à jour le champ <code>membre_derniere_visite</code> avec un code dans ce goût :</p><pre id="r-123108" data-claire-element-id="123108"><code data-claire-semantic="html+php">&lt;?php
        mysql_query(&quot;UPDATE membres SET membre_derniere_visite = &quot;.time().&quot; WHERE membre_id = &quot;.$_SESSION['membre_id']) or exit(mysql_error());
        queries();
?&gt;</code></pre><p id="r-123109" data-claire-element-id="123109">Enfin, il va falloir mettre à jour la table des connectés à chaque actualisation de page ; mettez ce code juste avant de fermer la fonction :</p><pre id="r-123110" data-claire-element-id="123110"><code data-claire-semantic="html+php">&lt;?php
        if(isset($_SESSION['membre_id'])) $id = $_SESSION['membre_id'];
        else $id = -1;
        updateConnectes($id);
?&gt;</code></pre><p id="r-123111" data-claire-element-id="123111">Vous avez donc une fonction supplémentaire à définir.<br/> Alors là j'en vois venir certains : à quoi sert le champ <code>connectes_actualisation</code> dans la table <code>connectes</code> si l'on met à jour les deux à chaque fois ?<br/> Eh bien la table des connectés est débarrassée des champs où l'actualisation dépasse les 300 secondes (5 minutes) : donc si on se base dessus, on ne peut pas savoir quand un membre est passé pour la dernière fois.<br/> A contrario, si on se base sur le champ de la table <code>membres</code>, comment sait-on quand un membre est connecté ou non, et comment recenser les invités ? Au final, nous ne gagnerions rien à ne pas utiliser deux champs au lieu d'un.</p><p id="r-123112" data-claire-element-id="123112">Enfin, la fonction <code data-claire-semantic="html+php">getIp() </code> est définie ainsi :</p><pre id="r-123113" data-claire-element-id="123113"><code data-claire-semantic="html+php">&lt;?php
function getIp()
{
        if(isset($_SERVER['HTTP_X_FORWARDED_FOR'])) return $_SERVER['HTTP_X_FORWARDED_FOR'];
        else return $_SERVER['REMOTE_ADDR'];
}
?&gt;</code></pre><p id="r-123114" data-claire-element-id="123114">Elle permet de mieux identifier quelqu'un qui passerait par un proxy transparent, par exemple, celui de son université ou autre.<br/> Certains hébergeurs gratuits (olympe network, par exemple) utilisent un proxy intermédiaire pour sécuriser leur infrastructure, si bien que pour avoir les IP des membres, j'ai été obligé de mettre cette fonction en place.<br/> Cette fonction ne peut en aucun cas retourner l'IP d'un membre qui passerait par un proxy visant à le rendre anonyme ; un proxy, je vous le rappelle, permet de passer par un ordinateur avant d'envoyer une requête à votre serveur.<br/> Si certains ne sont même pas conscients de passer par un proxy (exemple d'une université, d'une bibilothèque), d'autres le font pour pouvoir avoir accès à des données réservées à des habitants d'un pays précis ou pour pirater en toute tranquillité (ou presque... :o)). Sans lancer un débat sur le bien-fondé des proxies, il peut être utile d'utiliser cette fonction.</p><p id="r-123115" data-claire-element-id="123115">Bref, pour obtenir l'IP de quelqu'un, il ne vous reste plus qu'à faire :</p><pre id="r-123116" data-claire-element-id="123116"><code data-claire-semantic="html+php">&lt;?php
$ip = getIp();
?&gt;</code></pre><p id="r-123117" data-claire-element-id="123117">Pratique. :)</p><p id="r-123118" data-claire-element-id="123118">Bien, nous en avons, je pense, fini avec connectes.php.</p><h6 id="r-passed-php" data-claire-element-id="123121">passed.php</h6><p id="r-123120" data-claire-element-id="123120">Si la variable <code>$_GET['see']</code> vaut <code>passed</code>, alors stats.php inclura la page stats/passed.php.<br/> Cette page, au premier abord similaire à connectes.php, est <a href="http://www.siteduzero.com/membres-309.html">directement tirée du SdZ</a> (un peu comme toutes les mises en page que je vous propose, l'objectif étant d'avoir un joli rendu). :) <br/> Elle affichera une liste exhaustive des membres avec leur pseudo, leur date de dernière connexion, ainsi que leur statut actuel (connecté ou non).<br/> Elle ne changera donc pas dans la partie II.</p><h6 id="r-autre-cas-index-php" data-claire-element-id="123126">Autre cas : index.php</h6><p id="r-123122" data-claire-element-id="123122">Si la variable $_GET['see'] a une autre valeur, alors stats.php inclura la page stats/index.php.<br/> Cet index des stats contiendra une liste des pages de statistiques accessibles (3), ainsi que d'autres pages de statistiques que vous auriez pu mettre en place vous-mêmes.<br/> Qu'on soit bien clairs : cette page n'est pas indispensable, vous pouvez mettre une redirection si vous le préférez. :)</p><aside id="r-123124" data-claire-element-id="123124" data-claire-semantic="warning"><p id="r-123123" data-claire-element-id="123123">Les pages nb_membres.php, connectes.php, passed.php et index.php sont toutes les quatre dans un dossier stats à la racine de votre site (ou dossier de tests), sinon ma correction diffèrera de votre système !</p></aside><p id="r-123125" data-claire-element-id="123125">Bien, bien, maintenant que nous avons planté le décor, je pense qu'il est temps pour vous d'entrer en scène : pendant ce temps, je vais aller mettre mon costume de prof.<br/> Bonne chance !</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site">Créer un espace membre pour son site</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Création d&#039;un système simple
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">Introduction</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
Un espace membre ? Kékécé ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
Présentation de la première partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
Présentation de la seconde partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
La table SQL
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">Les bases du système</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
Des pages bien utiles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
D&#039;autres pages à inclure
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">Inscription</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
Le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
Charte et système anti-robot
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">La validation et les mails</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
Validation du formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
Un petit mail ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">TP : connexion et déconnexion</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
Prérequis et explications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
Et après ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">TP : site et profils</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
Exercice 1 - Création de statistiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
Correction de l&#039;exercice 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
Exercice 2 - Création de la page user.php
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
Correction de l&#039;exercice 2
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">
<span class="arrow"></span>
<span class="next">TP : site et profils</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
<span class="next">Correction de l&#039;exercice 1</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Correctiondel039exercice1"></a><h2>Correction de l&#039;exercice 1</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
<span class="arrow"></span>
<span class="next">Exercice 1 - Création de statistiques</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
<span class="next">Exercice 2 - Création de la page user.php</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-correction-de-l-exercice-1" data-claire-element-id="123187">Correction de l'exercice 1</h4><p id="r-123129" data-claire-element-id="123129">Alors, ça bosse dur ? :p</p><p id="r-123130" data-claire-element-id="123130">Voilà sans plus attendre une correction détaillée de l'exercice. :)</p><h6 id="r-colg-php-je-la-remets-au-cas-ou" data-claire-element-id="123140">colg.php (je la remets au cas où)</h6><pre id="r-123131" data-claire-element-id="123131"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page colg.php

La colonne de gauche de votre site (page incluse).

Quelques indications (utiliser l'outil de recherche et rechercher les mentions données) :

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations / erreurs :
--------------------------
Aucune information / erreur
--------------------------
*/
?&gt;
                        &lt;div id=&quot;statistiques&quot;&gt;&lt;h1&gt;Site&lt;/h1&gt;
                                &lt;a href=&quot;&lt;?php echo ROOTPATH; ?&gt;/stats.php?see=nb_membres&quot;&gt;&lt;?php echo $num1 = get('nb_membres'); if($num1 &lt;= 1) echo ' membre inscrit'; else echo ' membres inscrits'; ?&gt;&lt;/a&gt;&lt;br/&gt;
                                &lt;a href=&quot;&lt;?php echo ROOTPATH; ?&gt;/stats.php?see=connectes&quot;&gt;&lt;?php echo $num2 = get('connectes'); if($num2 &lt;= 1) echo ' visiteur'; else echo ' visiteurs' ?&gt;&lt;/a&gt;&lt;br/&gt;
                                &lt;a href=&quot;&lt;?php echo ROOTPATH; ?&gt;/stats.php?see=passed&quot;&gt;Dernières visites&lt;/a&gt;&lt;br/&gt;
                        &lt;/div&gt;</code></pre><p id="r-123132" data-claire-element-id="123132">On définit donc <code data-claire-semantic="html+php">get() </code>.</p><pre id="r-123133" data-claire-element-id="123133"><code data-claire-semantic="html+php">&lt;?php
function get($type) //je ne me suis pas foulé. :D
{
        if($type == 'nb_membres')
        {
                $count = sqlquery(&quot;SELECT COUNT(*) AS nbr FROM membres&quot;, 1);
                return $count['nbr'];
        }
        
        else if($type == 'connectes')
        {
                $count = sqlquery(&quot;SELECT COUNT(*) AS nbr FROM connectes&quot;, 1);
                return $count['nbr'];
        }
        
        else
        {
                return 0;
        }
}
?&gt;</code></pre><p id="r-123134" data-claire-element-id="123134">On définit aussi une fonction de mise en page de la date (inspirée de la gestion des dates du SdZ) :</p><pre id="r-123135" data-claire-element-id="123135"><code data-claire-semantic="html+php">&lt;?php
function mepd($date)
{
        if(intval($date) == 0) return $date;
        
        $tampon = time();
        $diff = $tampon - $date;
        
        $dateDay = date('d', $date);
        $tamponDay = date('d', $tampon);
        $diffDay = $tamponDay - $dateDay;
        
        if($diff &lt; 60 &amp;&amp; $diffDay == 0)
        {
                return 'Il y a '.$diff.'s';
        }
        
        else if($diff &lt; 600 &amp;&amp; $diffDay == 0)
        {
                return 'Il y a '.floor($diff/60).'m et '.floor($diff%60).'s';
        }
        
        else if($diff &lt; 3600 &amp;&amp; $diffDay == 0)
        {
                return 'Il y a '.floor($diff/60).'m';
        }
        
        else if($diff &lt; 7200 &amp;&amp; $diffDay == 0)
        {
                return 'Il y a '.floor($diff/3600).'h et '.floor(($diff%3600)/60).'m';
        }
        
        else if($diff &lt; 24*3600 &amp;&amp; $diffDay == 0)
        {
                return 'Aujourd\'hui à '.date('H\hi', $date);
        }
        
        else if($diff &lt; 48*3600 &amp;&amp; $diffDay == 1)
        {
                return 'Hier à '.date('H\hi', $date);
        }
        
        else
        {
                return 'Le '.date('d/m/Y', $date).' à '.date('h\hi', $date).'.';
        }
}
?&gt;</code></pre><p id="r-123136" data-claire-element-id="123136">Vous remarquerez que j'ai vraiment un problème avec les <code>switch</code>, je ne les aime vraiment pas. :p</p><p id="r-123137" data-claire-element-id="123137">C'est notre point de départ, à partir d'ici, vous avez normalement créé stats.php :</p><pre id="r-123138" data-claire-element-id="123138"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page stats.php

Statistiques du site.

Quelques indications (utiliser l'outil de recherche et rechercher les mentions données) :

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations / erreurs :
--------------------------
$_GET['see'] contient des caractères invalides (tentative de hack ?)
--------------------------
*/

session_start();
header('Content-type: text/html; charset=utf-8');
include('includes/config.php');

/********Actualisation de la session...**********/

include('includes/fonctions.php');
connexionbdd();
actualiser_session();

/********Fin actualisation de session...**********/

if($_GET['see'] == '' || !isset($_GET['see']))
{
        include('stats/index.php');
}

else
{
        if(strpos($_GET['see'], '.') !== FALSE || strpos($_GET['see'], ':') !== FALSE || strpos($_GET['see'], 'http') !== FALSE) //$_GET['see'] contient des caractères invalides (tentative de hack ?)
        {
                include('stats/index.php');
        }
        
        else if(file_exists('stats/'.$_GET['see'].'.php'))
        {
                include('stats/'.$_GET['see'].'.php');
        }
        
        else
        {
                include('stats/index.php');
        }
}

include('includes/bas.php');
mysql_close();
?&gt;</code></pre><p id="r-123139" data-claire-element-id="123139">Voilà, j'ai procédé ainsi pour inclure autant de fichiers que voulu, cette méthode est sécurisée.<br/> Il n'y a, a priori, rien que vous ne puissiez comprendre. :)</p><h6 id="r-passons-a-stats-nb-connectes-php" data-claire-element-id="123167">Passons à stats/nb_connectes.php</h6><p id="r-123141" data-claire-element-id="123141">Comme vous l'avez vu, nous n'avons absolument pas donné de nom à notre page, le nom sera défini dans la page incluse :</p><pre id="r-123142" data-claire-element-id="123142"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page nb_membres.php

Affiche une liste complète des membres.

Quelques indications (utiliser l'outil de recherche et rechercher les mentions données) :

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations / erreurs :
--------------------------
Aucune information / erreur
--------------------------
*/

/********En-tête et titre de page*********/

$titre = 'Liste des membres du site';

include('includes/haut.php'); //contient le doctype, et head.

/**********Fin en-tête et titre***********/
?&gt;
                &lt;div id=&quot;colonne_gauche&quot;&gt;
                &lt;?php
                include('includes/colg.php');
                ?&gt;
                &lt;/div&gt;

                &lt;div id=&quot;contenu&quot;&gt;
                        &lt;div id=&quot;map&quot;&gt;
                                &lt;a href=&quot;index.php&quot;&gt;Accueil&lt;/a&gt; =&gt; &lt;a href=&quot;stats.php?see=nb_membres&quot;&gt;Liste des membres&lt;/a&gt;
                        &lt;/div&gt;</code></pre><p id="r-123143" data-claire-element-id="123143">Jusqu'ici, rien de bien nouveau. :)</p><p id="r-123144" data-claire-element-id="123144">Maintenant, nous allons, via une requête, récupérer tous les membres, les classer par ID (SQL le fait très bien), et les afficher dans un tableau, je pense d'ailleurs qu'il peut être utile de revoir le <a href="http://www.siteduzero.com/tutoriel-3-13584-les-tableaux.html">chapitre de M@teo sur les tableaux (cours XHTML/CSS)</a> :</p><pre id="r-123145" data-claire-element-id="123145"><code data-claire-semantic="html+php">&lt;?php
                $membre_query = sqlquery(&quot;SELECT membre_id, membre_pseudo, membre_inscription
                FROM membres
                ORDER BY membre_id ASC&quot;, 2); //ORDER BY s'occupe du tri !
                $i = 0;
                ?&gt;
                        &lt;div class=&quot;membre_liste&quot;&gt;
                                &lt;table&gt;
                                        &lt;thead&gt;
                                                &lt;th&gt;N° du membre&lt;/th&gt;
                                                &lt;th&gt;Pseudonyme&lt;/th&gt;
                                                &lt;th&gt;Date d'inscription&lt;/th&gt;
                                        &lt;/thead&gt;
                                        
                                        &lt;tfoot&gt;
                                                &lt;th&gt;N° du membre&lt;/th&gt;
                                                &lt;th&gt;Pseudonyme&lt;/th&gt;
                                                &lt;th&gt;Date d'inscription&lt;/th&gt;
                                        &lt;/tfoot&gt;</code></pre><p id="r-123146" data-claire-element-id="123146">Ici, on a préparé la tête et le pied du tableau, n'oubliez pas qu'on les met avant la balise <code data-claire-semantic="html">&lt;tbody&gt; </code> !</p><div id="r-123148" data-claire-element-id="123148" data-claire-semantic="question"><p id="r-123147" data-claire-element-id="123147">Mais tu ne fais pas de <code>limit</code> dans ta requête SQL ?</p></div><p id="r-123149" data-claire-element-id="123149">Non, pour le moment, on n'en aura pas besoin, mais effectivement, quand on a 113 326 membres inscrits sur son site, et une requête à rallonge avec des jointures pour savoir si le membre est dans tel ou tel groupe (notez que le SdZ semble avoir une façon plus simple de faire : max un groupe pour un membre, donc peut-être pas de requête à rallonge), cela peut devenir utile. :) <br/> Cependant, on aura besoin de définir une fonction page dans ce cas-là, qui gèrera la position de la page visualisée par rapport à la première et à la dernière page, donc on verra cela plus tard, ce n'est pas indispensable tout de suite.</p><p id="r-123150" data-claire-element-id="123150">Affichons maintenant les membres :</p><pre id="r-123151" data-claire-element-id="123151"><code data-claire-semantic="html+php">&lt;tbody&gt;
                &lt;?php
                while(isset($membre_query[$i]))
                {
                        echo '&lt;tr class=&quot;ligne_'.($i%2).'&quot;&gt;
                        &lt;td&gt;'.$membre_query[$i]['membre_id'].'&lt;/td&gt;
                        &lt;td&gt;&lt;a href=&quot;membres/user.php?id='.$membre_query[$i]['membre_id'].'&quot;&gt;'.htmlspecialchars($membre_query[$i]['membre_pseudo'], ENT_QUOTES).'&lt;/a&gt;&lt;/td&gt;
                        &lt;td&gt;'.mepd($membre_query[$i]['membre_inscription']).'&lt;/td&gt;
                        &lt;/tr&gt;
                        
                        ';
                        $i++;
                }
                
                if($i == 0) echo '&lt;tr&gt;&lt;td colspan=&quot;3&quot;&gt;Pas de membre trouvé.&lt;/td&gt;&lt;/tr&gt;';
                ?&gt;
                                        &lt;/tbody&gt;
                                &lt;/table&gt;
                        &lt;/div&gt;
                &lt;/div&gt;</code></pre><p id="r-123152" data-claire-element-id="123152">Et un peu de CSS :</p><pre id="r-123153" data-claire-element-id="123153"><code data-claire-semantic="css">table {
        margin: auto;
        margin-top: 10px;
        border: 1px solid black;
        text-align: center;
        border-collapse: collapse;
}

th {
        border: 1px solid black;
        text-align: center;
}

td {
        border: 1px solid black;
        text-align: center;
}

.ligne_0 {
        background-color: #dfe5f5;
}

.ligne_1 {
        background-color: #edf1f8;
}</code></pre><p id="r-123154" data-claire-element-id="123154">Voilà ! Votre page nb_membres est finie !<br/> Vous pouvez l'admirer avec joie !</p><p id="r-123155" data-claire-element-id="123155">Passons à l'affichage des connectés, et donc la création de fonctions supplémentaires.</p><p id="r-123156" data-claire-element-id="123156"><code data-claire-semantic="html+php">actualiser_session() </code> :</p><pre id="r-123157" data-claire-element-id="123157"><code data-claire-semantic="html+php">&lt;?php
function actualiser_session()
{
        if(isset($_SESSION['membre_id']) &amp;&amp; intval($_SESSION['membre_id']) != 0) //Vérification id
        {
                //utilisation de la fonction sqlquery, on sait qu'on aura qu'un résultat car l'id d'un membre est unique.
                $retour = sqlquery(&quot;SELECT membre_id, membre_pseudo, membre_mdp FROM membres WHERE membre_id = &quot;.intval($_SESSION['membre_id']), 1);
                
                //Si la requête a un résultat (id est : si l'id existe dans la table membres)
                if(isset($retour['membre_pseudo']) &amp;&amp; $retour['membre_pseudo'] != '')
                {
                        if($_SESSION['membre_mdp'] != $retour['membre_mdp'])
                        {
                                //Dehors vilain pas beau !
                                $informations = Array(/*Mot de passe de session incorrect*/
                                                                        true,
                                                                        'Session invalide',
                                                                        'Le mot de passe de votre session est incorrect, vous devez vous reconnecter.',
                                                                        '',
                                                                        'membres/connexion.php',
                                                                        3
                                                                        );
                                require_once('../information.php');
                                vider_cookie();
                                session_destroy();
                                exit();
                        }
                        
                        else
                        {
                                //Validation de la session.
                                        $_SESSION['membre_id'] = $retour['membre_id'];
                                        $_SESSION['membre_pseudo'] = $retour['membre_pseudo'];
                                        $_SESSION['membre_mdp'] = $retour['membre_mdp'];
                                        mysql_query(&quot;UPDATE membres SET membre_derniere_visite = &quot;.time().&quot; WHERE membre_id = &quot;.$_SESSION['membre_id']) or exit(mysql_error());
                                        queries();
                        }
                }
        }
        
        else //On vérifie les cookies et sinon pas de session
        {
                if(isset($_COOKIE['membre_id']) &amp;&amp; isset($_COOKIE['membre_mdp'])) //S'il en manque un, pas de session.
                {
                        if(intval($_COOKIE['membre_id']) != 0)
                        {
                                //idem qu'avec les $_SESSION
                                $retour = sqlquery(&quot;SELECT membre_id, membre_pseudo, membre_mdp FROM membres WHERE membre_id = &quot;.intval($_COOKIE['membre_id']), 1);
                                
                                if(isset($retour['membre_pseudo']) &amp;&amp; $retour['membre_pseudo'] != '')
                                {
                                        if($_COOKIE['membre_mdp'] != $retour['membre_mdp'])
                                        {
                                                //Dehors vilain tout moche !
                                                $informations = Array(/*Mot de passe de cookie incorrect*/
                                                                                        true,
                                                                                        'Mot de passe cookie erroné',
                                                                                        'Le mot de passe conservé sur votre cookie est incorrect, vous devez vous reconnecter.',
                                                                                        '',
                                                                                        'membres/connexion.php',
                                                                                        3
                                                                                        );
                                                require_once('../information.php');
                                                vider_cookie();
                                                session_destroy();
                                                exit();
                                        }
                                        
                                        else
                                        {
                                                //Bienvenue :D
                                                $_SESSION['membre_id'] = $retour['membre_id'];
                                                $_SESSION['membre_pseudo'] = $retour['membre_pseudo'];
                                                $_SESSION['membre_mdp'] = $retour['membre_mdp'];
                                                mysql_query(&quot;UPDATE membres SET membre_derniere_visite = &quot;.time().&quot; WHERE membre_id = &quot;.$_SESSION['membre_id']) or exit(mysql_error());
                                                queries();
                                        }
                                }
                        }
                        
                        else //cookie invalide, erreur plus suppression des cookies.
                        {
                                $informations = Array(/*L'id de cookie est incorrect*/
                                                                        true,
                                                                        'Cookie invalide',
                                                                        'Le cookie conservant votre id est corrompu, il va donc être détruit, vous devez vous reconnecter.',
                                                                        '',
                                                                        'membres/connexion.php',
                                                                        3
                                                                        );
                                require_once('../information.php');
                                vider_cookie();
                                session_destroy();
                                exit();
                        }
                }
                
                else
                {
                        //Fonction de suppression de toutes les variables de cookie.
                        if(isset($_SESSION['membre_id'])) unset($_SESSION['membre_id']);
                        vider_cookie();
                }
        }
        
        if(isset($_SESSION['membre_id'])) $id = $_SESSION['membre_id'];
        else $id = -1;
        updateConnectes($id);
}
?&gt;</code></pre><p id="r-123158" data-claire-element-id="123158"><code data-claire-semantic="html+php">updateConnectes() </code> et <code data-claire-semantic="html+php">getIp() </code> :</p><pre id="r-123159" data-claire-element-id="123159"><code data-claire-semantic="html+php">&lt;?php
function updateConnectes($id)
{
        $ip = getIp();
        if($id != -1)
        {
                $id = $_SESSION['membre_id'];
                $additionnal = 1; //la variable à mettre dans connectes_membre
        }
        
        else
        {
                $additionnal = $ip;
        }
        
        mysql_query(&quot;DELETE FROM connectes WHERE connectes_actualisation &lt; &quot;.(time()-300)) or exit(mysql_error()); //MàJ générale des connectés
        mysql_query(&quot;INSERT INTO connectes VALUES(&quot;.$id.&quot;, '&quot;.$ip.&quot;', '&quot;.$additionnal.&quot;', &quot;.time().&quot;)
        ON DUPLICATE KEY UPDATE connectes_actualisation=&quot;.time().&quot;, connectes_ip='&quot;.$ip.&quot;'&quot;) or exit(mysql_error()); //tiens, tiens, ON DUPLICATE... :o
        queries(2);
}

function getIp()
{
        if(isset($_SERVER['HTTP_X_FORWARDED_FOR'])) return $_SERVER['HTTP_X_FORWARDED_FOR'];
        else return $_SERVER['REMOTE_ADDR'];
}
?&gt;</code></pre><p id="r-123160" data-claire-element-id="123160">Quelques explications s'imposent. :) <br/> Je vous ai fait utiliser un champ <code>connectes_membre</code>, dans lequel on insère ici <code>$additionnal</code> : à quoi ce champ sert-il ? <br/> Si vous avez bien regardé la structure de la table des connectés, vous avez dû remarquer ceci :</p><pre id="r-123161" data-claire-element-id="123161"><code data-claire-semantic="sql">UNIQUE KEY `membre_id` (`connectes_id`,`connectes_membre`)</code></pre><p id="r-123162" data-claire-element-id="123162">Cette ligne place une condition d'unicité sur deux champs en même temps : <code>connectes_id</code> et <code>connectes_membre</code>.<br/> Une autre façon de voir la ligne SQL que j'ai citée, c'est de l'interpréter en français : &quot;Si, au moment d'une insertion, la valeur de <code>connectes_id</code> et la valeur de <code>connectes_membre</code> sont déjà <strong>toutes les deux</strong> prises sur <strong>une même ligne</strong>, retourner une erreur.&quot;.</p><p id="r-123163" data-claire-element-id="123163">L'intérêt est en effet de permettre à plusieurs visiteurs d'être présents en même temps, donc de comptabiliser chaque IP comme un visiteur, tout en ne permettant à un membre inscrit de n'être comptabilisé qu'une fois, donc que son IP ne soit pas une condition d'unicité, mais cette fois son id et son statut de membre !</p><p id="r-123164" data-claire-element-id="123164">Donc si le membre ayant <em>l'id 1</em> est connecté, le champ <code>connectes_id</code> vaut 1, et le champ <code>connectes_membre</code> vaut 1 aussi, s'il actualise, on lui refuse l'insertion d'une nouvelle ligne, car elle transgresse la condition d'unicité ; par contre, pour les invités, le champ <code>connectes_membre</code> valant leur IP, on peut avoir sans problèmes plusieurs invités connectés en même temps pour un peu qu'ils aient des IP différents. :D <br/> Cependant, un problème se pose si un membre ou un invité déjà enregistré dans la table <code>connectes</code> actualise une page, l'insertion étant refusée, il faut donc faire un <code>UPDATE</code>. :(</p><p id="r-123165" data-claire-element-id="123165">C'est ici que <code>ON DUPLICATE KEY UPDATE</code> intervient.<br/> Plutôt que de faire une nouvelle requête pour mettre à jour la connexion, on appose cette condition en fin de requête d'insertion et les champs à mettre à jour.<br/> Cela revient à dire en français : &quot;Si l'insertion transgresse la condition d'unicité, mettre à jour le champ connectes_actualisation à la valeur <code data-claire-semantic="html+php">time() </code>.&quot;<br/> Ainsi, on condense deux requêtes en une. :)</p><p id="r-123166" data-claire-element-id="123166">C'est vrai qu'à première vue, ce n'est pas évident ; j'ai essayé de vous expliquer cela le plus simplement possible, mais je sais déjà que mes explications ne conviendront pas à certains, sur la condition d'unicité je ne peux rien faire de plus. Par contre, pour <code>ON DUPLICATE KEY UPDATE</code>, vous pouvez vous rendre <a href="http://dev.mysql.com/doc/refman/5.0/en/insert-on-duplicate.html">ici</a> (attention, page en anglais). :)</p><h6 id="r-on-peut-enfin-attaquer-connectes-php" data-claire-element-id="123176">On peut enfin attaquer connectes.php</h6><pre id="r-123168" data-claire-element-id="123168"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page connectes.php

Affiche une liste complète des membres connectes.

Quelques indications (utiliser l'outil de recherche et rechercher les mentions données) :

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations / erreurs :
--------------------------
Aucune information / erreur
--------------------------
*/

/********En-tête et titre de page*********/

$titre = 'Liste des connectés';

include('includes/haut.php'); //contient le doctype, et head.

/**********Fin en-tête et titre***********/
?&gt;
                &lt;div id=&quot;colonne_gauche&quot;&gt;
                &lt;?php
                include('includes/colg.php');
                ?&gt;
                &lt;/div&gt;
                
                &lt;div id=&quot;contenu&quot;&gt;
                        &lt;div id=&quot;map&quot;&gt;
                                &lt;a href=&quot;index.php&quot;&gt;Accueil&lt;/a&gt; =&gt; &lt;a href=&quot;stats.php?see=connectes&amp;a=&lt;?php echo intval($_GET['a']); ?&gt;&quot;&gt;Liste des connectés&lt;/a&gt;
                        &lt;/div&gt;
                        
                        &lt;h1&gt;Liste des connectés&lt;/h1&gt;</code></pre><p id="r-123169" data-claire-element-id="123169">Ensuite, vient le moment de s'occuper du menu, et donc de la requête SQL à effectuer en fonction des liens sélectionnés.<br/> Moi je ne m'embête pas, je fais une condition <code>if/else if</code>, un <code>switch</code> est aussi possible. :)</p><pre id="r-123170" data-claire-element-id="123170"><code data-claire-semantic="html+php">&lt;?php
                if($_GET['a'] == 1)
                {
                        $id = '';
                }
                
                else if($_GET['a'] == 2)
                {
                        $id = ' AND connectes_id = -1';
                }
                
                else
                {
                        $id = ' AND connectes_id &lt;&gt; -1';
                }

                $membre_query = sqlquery(&quot;SELECT membre_id, membre_pseudo, connectes_actualisation
                FROM connectes
                LEFT JOIN membres ON membre_id = connectes_id
                WHERE connectes_actualisation &gt; &quot;.(time()-300).$id.&quot;
                ORDER BY connectes_actualisation DESC&quot;, 2);
                ?&gt;</code></pre><p id="r-123171" data-claire-element-id="123171">C'est un peu du bidouillage, mais je préfère cela plutôt que de monter trois requêtes différentes. ^^ <br/> Passons au mini-menu : comme on veut qu'il soit centré, on va le prendre dans un <code>div</code> avec la propriété CSS qui convient :</p><pre id="r-123172" data-claire-element-id="123172"><code data-claire-semantic="html+php">&lt;!--menu//--&gt;
                        &lt;div class=&quot;center&quot;&gt;
                                &lt;?php
                                        if($_GET['a'] == 1 || $_GET['a'] == 2)
                                        {
                                                echo '&lt;a href=&quot;stats.php?see=connectes&quot;&gt;Voir seulement les membres connectés&lt;/a&gt;';
                                                $avt = 1;
                                        }
                                        
                                        if($_GET['a'] != 2)
                                        {
                                                if($avt == 1) echo ' - ';
                                                echo '&lt;a href=&quot;stats.php?see=connectes&amp;a=2&quot;&gt;Voir seulement les invités connectés&lt;/a&gt;';
                                                $avt = 1;
                                        }
                                        
                                        if($_GET['a'] != 1)
                                        {
                                                if($avt == 1) echo ' - ';
                                                echo '&lt;a href=&quot;stats.php?see=connectes&amp;a=1&quot;&gt;Voir les membres et les invités connectés&lt;/a&gt;';
                                        }
                                ?&gt;
                        &lt;/div&gt;</code></pre><p id="r-123173" data-claire-element-id="123173">Ici aussi, nous n'affichons que les menus proposant une page différente de celle que l'on visualise actuellement, donc on s'arrange pour rendre cela joli, même s'il faut du coup &quot;bidouiller&quot; un peu (je n'aime pas le mot bidouiller dans ce cas-là, car ce n'est pas vraiment du bidouillage, quelle que soit la méthode employée, le principe est le même, sauf si l'on affiche les trois menus, là au moins on ne s'ennuie pas, même pas besoin de PHP).<br/> Il ne reste plus qu'à mettre le tableau en place, avec des liens pointant sur les membres, mais pas sur les invités :</p><pre id="r-123174" data-claire-element-id="123174"><code data-claire-semantic="html+php">&lt;!--tableau//--&gt;
                        &lt;table&gt;
                                &lt;thead&gt;
                                        &lt;th&gt;N° du membre&lt;/th&gt;
                                        &lt;th&gt;Pseudonyme&lt;/th&gt;
                                        &lt;th&gt;Dernière connexion&lt;/th&gt;
                                &lt;/thead&gt;
                                
                                &lt;tfoot&gt;
                                        &lt;th&gt;N° du membre&lt;/th&gt;
                                        &lt;th&gt;Pseudonyme&lt;/th&gt;
                                        &lt;th&gt;Dernière connexion&lt;/th&gt;
                                &lt;/tfoot&gt;
                                
                                &lt;tbody&gt;
        &lt;?php
        $i = 0;
        while(isset($membre_query[$i]))
        {
                if($membre_query[$i]['membre_id'] != '')
                {
                        $lien = '&lt;a href=&quot;membres/user.php?id='.$membre_query[$i]['membre_id'].'&quot;&gt;';
                        $lien2 = '&lt;/a&gt;';
                }
                
                else
                {
                        $lien = '';
                        $lien2 = '';
                }
                
                if($membre_query[$i]['membre_id'] == '') //un invité n'a pas de lien, ni d'id.
                {
                        $membre_query[$i]['membre_id'] = 'Non renseigné'; //
                        $membre_query[$i]['membre_pseudo'] = 'Invité';
                }
        
                echo '&lt;tr class=&quot;ligne_'.($i%2).'&quot;&gt;
                &lt;td&gt;'.$membre_query[$i]['membre_id'].'&lt;/td&gt;
                &lt;td&gt;'.$lien.htmlspecialchars($membre_query[$i]['membre_pseudo'], ENT_QUOTES).$lien2.'&lt;/td&gt;
                &lt;td&gt;'.mepd($membre_query[$i]['connectes_actualisation']).'&lt;/td&gt;
                &lt;/tr&gt;
                
                ';
                $i++;
        }
        
        if($i == 0) echo '&lt;tr&gt;&lt;td colspan=&quot;3&quot;&gt;Pas de membre trouvé.&lt;/td&gt;&lt;/tr&gt;';
        ?&gt;
                                &lt;/tbody&gt;
                        &lt;/table&gt;
                &lt;/div&gt;</code></pre><p id="r-123175" data-claire-element-id="123175">Voilà pour connectes.php. :)</p><h6 id="r-passed-php-1" data-claire-element-id="123186">passed.php</h6><p id="r-123177" data-claire-element-id="123177">Allez, on attaque passed.php, elle se passe d'explications, elle est très similaire aux précédentes.</p><pre id="r-123178" data-claire-element-id="123178"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page passed.php

Affiche une liste complète des dates de visite des membres.

Quelques indications (utiliser l'outil de recherche et rechercher les mentions données) :

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations / erreurs :
--------------------------
Aucune information / erreur
--------------------------
*/

/********En-tête et titre de page*********/

$titre = 'Liste des dernières visites';

include('includes/haut.php'); //contient le doctype, et head.

/**********Fin en-tête et titre***********/
?&gt;
                &lt;div id=&quot;colonne_gauche&quot;&gt;
                &lt;?php
                include('includes/colg.php');
                ?&gt;
                &lt;/div&gt;
                
                &lt;div id=&quot;contenu&quot;&gt;
                        &lt;div id=&quot;map&quot;&gt;
                                &lt;a href=&quot;index.php&quot;&gt;Accueil&lt;/a&gt; =&gt; &lt;a href=&quot;stats.php?see=passed&quot;&gt;Liste des visites&lt;/a&gt;
                        &lt;/div&gt;
                        
                        &lt;h1&gt;Liste des visites&lt;/h1&gt;

                &lt;?php                
                $membre_query = sqlquery(&quot;SELECT membre_id, membre_pseudo, membre_derniere_visite, connectes_id
                FROM membres
                LEFT JOIN connectes
                ON membre_id = connectes_id
                ORDER BY membre_derniere_visite DESC&quot;, 2);
                $i = 0;
                ?&gt;
                        &lt;div class=&quot;membre_liste&quot;&gt;
                                &lt;table&gt;
                                        &lt;thead&gt;
                                                &lt;th&gt;N° du membre&lt;/th&gt;
                                                &lt;th&gt;Pseudonyme&lt;/th&gt;
                                                &lt;th&gt;Dernière connexion&lt;/th&gt;
                                                &lt;th&gt;Statut&lt;/th&gt;
                                        &lt;/thead&gt;
                                        
                                        &lt;tfoot&gt;
                                                &lt;th&gt;N° du membre&lt;/th&gt;
                                                &lt;th&gt;Pseudonyme&lt;/th&gt;
                                                &lt;th&gt;Dernière connexion&lt;/th&gt;
                                                &lt;th&gt;Statut&lt;/th&gt;
                                        &lt;/tfoot&gt;
                                        
                                        &lt;tbody&gt;
                &lt;?php
                while(isset($membre_query[$i]))
                {
                        if($membre_query[$i]['connectes_id'] == $membre_query[$i]['membre_id']) //gestion des statuts de connexion
                        {
                                $statut = '&lt;span class=&quot;actif&quot;&gt;Connecté&lt;/span&gt;';
                        }
                        
                        else
                        {
                                $statut = '&lt;span class=&quot;inactif&quot;&gt;Déconnecté&lt;/span&gt;';
                        }
                        
                        echo '&lt;tr class=&quot;ligne_'.($i%2).'&quot;&gt;
                        &lt;td&gt;'.$membre_query[$i]['membre_id'].'&lt;/td&gt;
                        &lt;td&gt;&lt;a href=&quot;membres/user.php?id='.$membre_query[$i]['membre_id'].'&quot;&gt;'.htmlspecialchars($membre_query[$i]['membre_pseudo'], ENT_QUOTES).'&lt;/a&gt;&lt;/td&gt;
                        &lt;td&gt;'.mepd($membre_query[$i]['membre_derniere_visite']).'&lt;/td&gt;
                        &lt;td&gt;'.$statut.'&lt;/td&gt;
                        &lt;/tr&gt;
                        
                        ';
                        $i++;
                }
                
                if($i == 0) echo '&lt;tr&gt;&lt;td colspan=&quot;4&quot;&gt;Pas de membre trouvé.&lt;/td&gt;&lt;/tr&gt;';
                ?&gt;
                                        &lt;/tbody&gt;
                                &lt;/table&gt;
                        &lt;/div&gt;
                &lt;/div&gt;</code></pre><p id="r-123179" data-claire-element-id="123179">Ici, on ne gère pas les invités. :p</p><p id="r-123180" data-claire-element-id="123180">Il ne reste plus qu'à mettre l'index des stats :</p><pre id="r-123181" data-claire-element-id="123181"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page index.php

Index des statistiques du site (page incluse).

Quelques indications (utiliser l'outil de recherche et rechercher les mentions données) :

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations / erreurs :
--------------------------
Aucune information / erreur
--------------------------
*/

/********En-tête et titre de page*********/

$titre = 'Statistiques du site';

include('includes/haut.php'); //contient le doctype, et head.

/**********Fin en-tête et titre***********/
?&gt;
                &lt;div id=&quot;colonne_gauche&quot;&gt;
                &lt;?php
                include('includes/colg.php');
                ?&gt;
                &lt;/div&gt;
                
                &lt;div id=&quot;contenu&quot;&gt;
                        &lt;div id=&quot;map&quot;&gt;
                                &lt;a href=&quot;index.php&quot;&gt;Accueil&lt;/a&gt; =&gt; &lt;a href=&quot;stats.php&quot;&gt;Statistiques&lt;/a&gt;
                        &lt;/div&gt;
                        
                        &lt;h1&gt;Statistiques&lt;/h1&gt;
                        
                        Bienvenue sur la page des statistiques du site.&lt;br/&gt;
                        Ici, vous pourrez voir les statistiques concernant les membres, les forums, les news, etc., etc. :)&lt;br/&gt;
                        Bonne visite !
                        
                        &lt;h2&gt;Membres&lt;/h2&gt;
                        &lt;div class=&quot;center&quot;&gt;
                                -&gt; &lt;a href=&quot;stats.php?see=nb_membres&quot;&gt;Il y a &lt;?php echo $num1; if($num1 &lt;= 1) echo ' membre inscrit'; else echo ' membres inscrits'; ?&gt;.&lt;/a&gt;&lt;br/&gt;
                                -&gt; &lt;a href=&quot;stats.php?see=connectes&quot;&gt;Il y a &lt;?php echo $num2; if($num2 &lt;= 1) echo ' visiteur'; else echo ' visiteurs' ?&gt;.&lt;/a&gt;&lt;br/&gt;
                                -&gt; &lt;a href=&quot;stats.php?see=passed&quot;&gt;Voir les dernières visites de chaque membre.&lt;/a&gt;&lt;br/&gt;
                        &lt;/div&gt;
                &lt;/div&gt;</code></pre><p id="r-123182" data-claire-element-id="123182">Notez juste que je réutilise les variables définies dans colg.php ; si vous supprimez le bloc sur les stats dans cette page, alors vous devrez les définir ici.</p><p id="r-123183" data-claire-element-id="123183">On définit enfin trois nouvelles propriétés CSS :</p><pre id="r-123184" data-claire-element-id="123184"><code data-claire-semantic="css">.actif {
        color: blue;
        font-weight: blod;
}

.inactif {
        color: red;
        font-weight: bold;
}

h2 {
        text-align:center;
        text-decoration: underline;
        color: #507090;
        font-family:&quot;trebuchet ms&quot;, verdana, sans-serif;
        letter-spacing:1.1px;
        font-variant:small-caps;
        font-weight:bold;
        font-size:19px;
        margin-top:0;
}</code></pre><p id="r-123185" data-claire-element-id="123185">Voilà, j'espère que vous avez tout compris. :) <br/> Passons à l'exercice II !</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site">Créer un espace membre pour son site</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Création d&#039;un système simple
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">Introduction</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
Un espace membre ? Kékécé ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
Présentation de la première partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
Présentation de la seconde partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
La table SQL
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">Les bases du système</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
Des pages bien utiles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
D&#039;autres pages à inclure
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">Inscription</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
Le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
Charte et système anti-robot
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">La validation et les mails</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
Validation du formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
Un petit mail ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">TP : connexion et déconnexion</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
Prérequis et explications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
Et après ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">TP : site et profils</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
Exercice 1 - Création de statistiques
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
Correction de l&#039;exercice 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
Exercice 2 - Création de la page user.php
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
Correction de l&#039;exercice 2
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
<span class="arrow"></span>
<span class="next">Exercice 1 - Création de statistiques</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
<span class="next">Exercice 2 - Création de la page user.php</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Exercice2-Crationdelapageuser.php"></a><h2>Exercice 2 - Création de la page user.php</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
<span class="arrow"></span>
<span class="next">Correction de l&#039;exercice 1</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
<span class="next">Correction de l&#039;exercice 2</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-exercice-2-creation-de-la-page-user-php" data-claire-element-id="123210">Exercice 2 - Création de la page user.php</h4><p id="r-123188" data-claire-element-id="123188">Bien, les statistiques sont finies, et vous avez vu que l'on y a mis un lien vers une page user.php (qui se trouvera dans le dossier membres).</p><p id="r-123189" data-claire-element-id="123189">Il s'agit donc pour vous de la créer. :) <br/> Le Site du Zér0 a une façon d'afficher les profils que je trouve particulièrement réussie, je vous suggère d'essayer de faire la même.</p><p id="r-123190" data-claire-element-id="123190">Il y a donc plusieurs choses que je veux y voir :</p><ul id="r-123201" data-claire-element-id="123201"><li id="r-123192" data-claire-element-id="123192"><p id="r-123191" data-claire-element-id="123191">le titre de la page doit contenir le pseudo du membre ;</p></li><li id="r-123194" data-claire-element-id="123194"><p id="r-123193" data-claire-element-id="123193">le statut de connexion du membre doit être visible ;</p></li><li id="r-123196" data-claire-element-id="123196"><p id="r-123195" data-claire-element-id="123195">sa date de naissance doit être visible ;</p></li><li id="r-123198" data-claire-element-id="123198"><p id="r-123197" data-claire-element-id="123197">son âge (calculé avec la date de naissance) doit être visible ;</p></li><li id="r-123200" data-claire-element-id="123200"><p id="r-123199" data-claire-element-id="123199">l'e-mail, le MSN, le yahoo ou toute autre messagerie doit être affichée par image.</p></li></ul><h6 id="r-precisons-le-dernier-point" data-claire-element-id="123209">Précisons le dernier point</h6><p id="r-123202" data-claire-element-id="123202">Comme vous le savez, les adresses e-mail des membres sont a priori des données privées ; pour le moment, dans le cadre de notre système simple, on ne propose rien au membre pour le cacher, donc les robots spammeurs n'ont qu'à venir, lire les mails, et spammer les membres.<br/> Le fait de les afficher par image est censé (je dis bien <em>censé</em>) leur compliquer la tâche.<br/> Ici, ce n'est pas le cas, car je vais vous demander de créer un fichier image.php qui affiche bêtement le texte qu'on lui file en get, donc forcément, le mail sera dans le code source, donc lisible par un bot.</p><p id="r-123203" data-claire-element-id="123203">L'objectif ici est juste de vous sensibiliser, on verra comment régler ce problème efficacement dans le TP suivant, en créant ces images et en les enregistrant dans un dossier spécifique lors de la modification du profil d'un membre ou de son inscription.</p><aside id="r-123205" data-claire-element-id="123205" data-claire-semantic="warning"><p id="r-123204" data-claire-element-id="123204">Une idée qui pourrait vous venir à l'esprit est de créer image.php et de la faire marcher avec deux GET ; un premier prendrait le pseudo, le deuxième le type de mail (email, msn, yahoo, gmail ou autre...), le souci est que cela imposerait une requête par image, lourd pour afficher un simple profil.</p></aside><p id="r-123206" data-claire-element-id="123206">On modifiera donc dans le prochain TP la page user.php, la page image.php, la page trait-inscription.php. :)</p><p id="r-123207" data-claire-element-id="123207">Pour le moment on s'en fiche pas mal. :) <br/> Pour le reste, il s'agit d'un bête affichage de données provenant de la BDD, vous savez faire ça depuis maintenant quelques temps. :)</p><p id="r-123208" data-claire-element-id="123208">Bonne chance !</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site">Créer un espace membre pour son site</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Création d&#039;un système simple
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">Introduction</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
Un espace membre ? Kékécé ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
Présentation de la première partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
Présentation de la seconde partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
La table SQL
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">Les bases du système</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
Des pages bien utiles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
D&#039;autres pages à inclure
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">Inscription</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
Le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
Charte et système anti-robot
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">La validation et les mails</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
Validation du formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
Un petit mail ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">TP : connexion et déconnexion</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
Prérequis et explications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
Et après ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">TP : site et profils</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
Exercice 1 - Création de statistiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
Correction de l&#039;exercice 1
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
Exercice 2 - Création de la page user.php
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
Correction de l&#039;exercice 2
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
<span class="arrow"></span>
<span class="next">Correction de l&#039;exercice 1</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
<span class="next">Correction de l&#039;exercice 2</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Correctiondel039exercice2"></a><h2>Correction de l&#039;exercice 2</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
<span class="arrow"></span>
<span class="next">Exercice 2 - Création de la page user.php</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-correction-de-l-exercice-2" data-claire-element-id="123249">Correction de l'exercice 2</h4><p id="r-123211" data-claire-element-id="123211">Alors, c'est fini ?</p><p id="r-123212" data-claire-element-id="123212">On peut donc corriger votre travail. :) <br/> On suivra la page en respectant les points que je vous avais donnés.</p><p id="r-123213" data-claire-element-id="123213">Tout d'abord, le pseudo doit figurer dans le titre de la page user.php, cela implique de faire <code data-claire-semantic="html+php">sqlquery() </code> avant d'inclure haut.php et de définir le titre.</p><p id="r-123214" data-claire-element-id="123214">D'abord, lançons notre page :</p><pre id="r-123215" data-claire-element-id="123215"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page index.php

Affichage de profil.

Quelques indications (utiliser l'outil de recherche et rechercher les mentions données) :

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations / erreurs :
--------------------------
Le membre n'existe pas
--------------------------
*/

session_start();
header('Content-type: text/html; charset=utf-8');
include('../includes/config.php');

/********Actualisation de la session...**********/

include('../includes/fonctions.php');
connexionbdd();
actualiser_session();

/********Fin actualisation de session...**********/</code></pre><p id="r-123216" data-claire-element-id="123216">Maintenant, passons à la gestion avant affichage :</p><pre id="r-123217" data-claire-element-id="123217"><code data-claire-semantic="html+php">&lt;?php
/********Gestion avant affichage...***********/
if($_GET['id'] == '') //s'il n'y a pas d'id, on affiche la page du membre connecté...
{
        if(isset($_SESSION['membre_id'])) $id = $_SESSION['membre_id'];
        else $id = -1;
}

else $id = $_GET['id'];

$profil = sqlquery(&quot;SELECT * FROM membres
LEFT JOIN connectes
ON connectes_id = membre_id
WHERE membre_id=&quot;.intval($id), 1);
if($profil['membre_id'] == '' || $id == -1)
{
        $informations = Array(/*L'id de cookie est incorrect*/
                true,
                'Page membre inconnue',
                'Ce membre n\'existe pas.',
                '',
                '../index.php',
                3
                );
        require_once('../information.php');
        exit();
}
/********Fin gestion avant affichage************/
?&gt;</code></pre><p id="r-123218" data-claire-element-id="123218">Voilà, ce n'était pas plus dur que cela ; maintenant, on peut afficher haut.php, le titre, etc. :)</p><pre id="r-123219" data-claire-element-id="123219"><code data-claire-semantic="html+php">&lt;?php
/********En-tête et titre de page*********/

$titre = 'Membre : '.htmlspecialchars($profil['membre_pseudo'], ENT_QUOTES).'';

include('../includes/haut.php'); //contient le doctype, et head.

/**********Fin en-tête et titre***********/
?&gt;

                &lt;div id=&quot;colonne_gauche&quot;&gt;
                &lt;?php
                include('../includes/colg.php');
                ?&gt;
                &lt;/div&gt;</code></pre><p id="r-123220" data-claire-element-id="123220">La partie assez habituelle de toute page de notre site est prête, passons au contenu. :)</p><pre id="r-123221" data-claire-element-id="123221"><code data-claire-semantic="html+php">&lt;!--contenu//--&gt;
                &lt;div id=&quot;contenu&quot;&gt;
                        &lt;div id=&quot;map&quot;&gt;
                                &lt;a href=&quot;../index.php&quot;&gt;Accueil&lt;/a&gt; =&gt; &lt;a href=&quot;user.php?id=&lt;?php echo intval($profil['membre_id']); ?&gt;&quot;&gt;Profil de &lt;?php echo htmlspecialchars($profil['membre_pseudo'], ENT_QUOTES); ?&gt;&lt;/a&gt;
                        &lt;/div&gt;
                        
                        &lt;h1&gt;Profil de &lt;?php echo htmlspecialchars($profil['membre_pseudo'], ENT_QUOTES); ?&gt;&lt;/h1&gt;
                        
                        &lt;div class=&quot;profil_cellule_float&quot;&gt;
                                &lt;h2&gt;Informations générales&lt;/h2&gt;
                                
                                
                                &lt;div class=&quot;avatar&quot;&gt;
                                &lt;?php
                                if($profil['membre_avatar'] == '')
                                {
                                        echo 'Pas d\'avatar';
                                }
                                ?&gt;
                                &lt;/div&gt;</code></pre><p id="r-123222" data-claire-element-id="123222">Le sitemap porte aussi le nom du bonhomme, de même que le titre de la page. ^^ <br/> Quant à l'avatar, pour le moment, à moins que vous n'ayez votre propre gestion des uploads, c'est pas vraiment le point fort de notre page. :p <br/> Ensuite, on fait une liste des informations principales sur le membre ; je dis bien <em>sur le membre</em>, pas sur sa personne, donc son pseudo, sa date d'inscription, son dernier passage sur le site, le groupe dans lequel il est (pour le moment aucun, a priori, on se basera donc sur <code>membre_banni</code>), et s'il est connecté actuellement...</p><pre id="r-123223" data-claire-element-id="123223"><code data-claire-semantic="html+php">&lt;!--liste//--&gt;
                                &lt;ul&gt;
                                        &lt;li&gt;&lt;b&gt;Pseudo :&lt;/b&gt; &lt;?php echo htmlspecialchars($profil['membre_pseudo'], ENT_QUOTES); ?&gt;&lt;/li&gt;
                                        &lt;li&gt;&lt;b&gt;Date d'inscription :&lt;/b&gt; &lt;?php echo mepd($profil['membre_inscription']); ?&gt;&lt;/li&gt;
                                        &lt;li&gt;&lt;b&gt;Groupe :&lt;/b&gt; &lt;?php if($profil['banni'] == 1) echo 'bannis'; else echo 'membres'; ?&gt;&lt;/li&gt;
                                        &lt;li&gt;&lt;b&gt;Dernier passage :&lt;/b&gt; &lt;?php echo mepd($profil['membre_derniere_visite']); ?&gt;&lt;/li&gt;
                                        &lt;li&gt;&lt;b&gt;Statut :&lt;/b&gt;
                                        &lt;?php
                                        if($profil['connectes_id'] == $profil['membre_id'])
                                        {
                                        ?&gt;
                                        &lt;span class=&quot;actif&quot;&gt;&lt;?php echo htmlspecialchars($profil['membre_pseudo'], ENT_QUOTES); ?&gt; est connecté&lt;/span&gt;
                                        &lt;?php
                                        }
                                        
                                        else
                                        {
                                        ?&gt;
                                        &lt;span class=&quot;inactif&quot;&gt;&lt;?php echo htmlspecialchars($profil['membre_pseudo'], ENT_QUOTES); ?&gt; est déconnecté&lt;/span&gt;&lt;/li&gt;
                                        &lt;?php
                                        }
                                        ?&gt;
                                &lt;/ul&gt;
                        &lt;/div&gt;</code></pre><p id="r-123224" data-claire-element-id="123224">Comme vous le voyez, le point numéro 2 est respecté. :) <br/> Tout de suite après, on ajoute des informations, sur la personne du membre cette fois, donc la date de naissance, l'âge, la ville, la profession, mais pas l'e-mail, c'est un peu à part. :)</p><pre id="r-123225" data-claire-element-id="123225"><code data-claire-semantic="html+php">&lt;!--infos complémentaires//--&gt;
                        &lt;div class=&quot;profil_cellule&quot;&gt;
                                &lt;h2&gt;Informations complémentaires&lt;/h2&gt;
                                &lt;ul&gt;
                                        &lt;li&gt;&lt;b&gt;Date de naissance :&lt;/b&gt; &lt;?php echo $profil['membre_naissance']; ?&gt;&lt;/li&gt;
                                        &lt;li&gt;&lt;b&gt;Âge :&lt;/b&gt; &lt;?php echo age($profil['membre_naissance']); ?&gt;
                                        &lt;?php
                                        if(trim($profil['membre_profession']) != '') /*affichage de la profession*/
                                        {
                                        ?&gt;
                                        &lt;li&gt;&lt;b&gt;Profession :&lt;/b&gt; &lt;?php echo htmlspecialchars($profil['membre_profession'], ENT_QUOTES); ?&gt;&lt;/li&gt;
                                        &lt;?php
                                        }
                                        
                                        if(trim($profil['membre_localisation']) != '') /*affichage de la ville*/
                                        {
                                        ?&gt;
                                        &lt;li&gt;&lt;b&gt;Ville :&lt;/b&gt; &lt;?php echo htmlspecialchars($profil['membre_localisation'], ENT_QUOTES); ?&gt;&lt;/li&gt;
                                        &lt;?php
                                        }
                                        ?&gt;
                                &lt;/ul&gt;
                        &lt;/div&gt;</code></pre><p id="r-123226" data-claire-element-id="123226">Voilà : on a bien la date de naissance et l'âge du membre. :) <br/> D'ailleurs, occupons-nous de la fonction <strong>age</strong>, il s'agit d'un calcul simple :</p><pre id="r-123227" data-claire-element-id="123227"><code data-claire-semantic="html+php">&lt;?php
function age($birth)
{
        $DATE = intArray(explode('/', $birth));
        $try = mktime(0, 0, 0, $DATE[1], $DATE[0], date('Y'));
        if(time() &gt;= $try) $age = date('Y') - $DATE[2];
        else $age = date('Y') - $DATE[2] - 1;

        return $age;        
}
?&gt;</code></pre><p id="r-123228" data-claire-element-id="123228">Tiens donc, voilà une nouvelle fonction : <code data-claire-semantic="html+php">intArray() </code> !<br/> Ce n'est pas une fonction native, elle est juste là pour sécuriser un peu plus la date de naissance :</p><pre id="r-123229" data-claire-element-id="123229"><code data-claire-semantic="html+php">&lt;?php
function intArray($Array)
{
        foreach($Array as $cle =&gt; $element)
        {
                $Array[$cle] = intval($element);
        }
        
        return $Array;
}
?&gt;</code></pre><p id="r-123230" data-claire-element-id="123230">Passons maintenant à son activité sur le site (quand je vous dis que je me suis vraiment inspiré du SdZ, même si je fais ça moins bien...), cette case sera vide, nous n'avons pas de forum, de système de news, ou même de tutoriels. :p</p><pre id="r-123231" data-claire-element-id="123231"><code data-claire-semantic="html">&lt;!--activité//--&gt;
                        &lt;div class=&quot;profil_cellule_float&quot;&gt;
                                &lt;h2&gt;&lt;?php echo htmlspecialchars($profil['membre_pseudo'], ENT_QUOTES); ?&gt; et le site&lt;/h2&gt;
                                Si vous avez un forum, ou des news, ou autre chose comme le Site du Zér0, c'est ici qu'il faudra mettre tout ça !
                        &lt;/div&gt;</code></pre><p id="r-123232" data-claire-element-id="123232">Enfin, passons aux moyens de contacter le membre :</p><pre id="r-123233" data-claire-element-id="123233"><code data-claire-semantic="html+php">&lt;!--contact//--&gt;
                        &lt;div class=&quot;profil_cellule&quot;&gt;
                                &lt;h2&gt;Comment le joindre&lt;/h2&gt;
                                &lt;!--
                                L'adresse e-mail est généralement une information très privée, pour le moment
                                nous ne la protégeons pas, mais très vite nous le ferons.
                                //--&gt;
                                S'il y a un module de MP sur votre site, ou si vous comptez en mettre un, mettez un lien. :)
                                
                                &lt;h3&gt;Messageries&lt;/h3&gt;
                                &lt;ul&gt;
                                        &lt;li&gt;&lt;b&gt;E-Mail :&lt;/b&gt; &lt;img src=&quot;image.php?tex=&lt;?php echo htmlspecialchars($profil['membre_mail'], ENT_QUOTES); ?&gt;&quot;/&gt;&lt;/li&gt;
                                        &lt;?php
                                        if(trim($profil['membre_msn']) != '')
                                        {
                                        ?&gt;
                                        &lt;li&gt;&lt;b&gt;MSN :&lt;/b&gt; &lt;img src=&quot;image.php?tex=&lt;?php echo htmlspecialchars($profil['membre_msn'], ENT_QUOTES); ?&gt;&quot;/&gt;&lt;/li&gt;
                                        &lt;?php
                                        }
                                        
                                        if(trim($profil['membre_yahoo']) != '')
                                        {
                                        ?&gt;
                                        &lt;li&gt;&lt;b&gt;Yahoo :&lt;/b&gt; &lt;img src=&quot;image.php?tex=&lt;?php echo htmlspecialchars($profil['membre_yahoo'], ENT_QUOTES); ?&gt;&quot;/&gt;&lt;/li&gt;
                                        &lt;?php
                                        }
                                        
                                        if(trim($profil['membre_aim']) != '')
                                        {
                                        ?&gt;
                                        &lt;li&gt;&lt;b&gt;Aim :&lt;/b&gt; &lt;img src=&quot;image.php?tex=&lt;?php echo htmlspecialchars($profil['membre_aim'], ENT_QUOTES); ?&gt;&quot;/&gt;&lt;/li&gt;
                                        &lt;?php
                                        }
                                        ?&gt;
                                &lt;/ul&gt;
                        &lt;/div&gt;</code></pre><p id="r-123234" data-claire-element-id="123234">On rajoute la biographie, la signature, et on clôt la page.</p><pre id="r-123235" data-claire-element-id="123235"><code data-claire-semantic="html+php">&lt;!--signature et fin//--&gt;
                        &lt;div class=&quot;profil_ligne&quot;&gt;
                                &lt;h2&gt;Signature&lt;/h2&gt;
                                
                                &lt;?php echo htmlspecialchars($profil['membre_signature'], ENT_QUOTES); ?&gt;
                        &lt;/div&gt;
                        
                        &lt;div class=&quot;profil_ligne&quot;&gt;
                                &lt;h2&gt;Biographie&lt;/h2&gt;
                                
                                &lt;?php echo htmlspecialchars($profil['membre_biographie'], ENT_QUOTES); ?&gt;
                        &lt;/div&gt;
                &lt;/div&gt;
                
                &lt;?php
                include('../includes/bas.php');
                mysql_close();
                ?&gt;</code></pre><p id="r-123236" data-claire-element-id="123236">On peut enfin passer à image.php.</p><pre id="r-123237" data-claire-element-id="123237"><code data-claire-semantic="html+php">&lt;?php
/*
Neoterranos &amp; LkY
Page image.php

Génère une image d'un texte passé en GET['tex'].

Quelques indications (utiliser l'outil de recherche et rechercher les mentions données) :

Liste des fonctions :
--------------------------
Aucune fonction
--------------------------


Liste des informations / erreurs :
--------------------------
Aucune information / erreur
--------------------------
*/

header (&quot;Content-type: image/png&quot;);
$count = strlen($_GET['tex']);
$image = imagecreate($count*9, 18);

if(function_exists(imagecolorallocatealpha))
{
        $blanc = imagecolorallocatealpha($image, 255, 255, 255, 127);
}

else
{
        $blanc = imagecolorallocate($image, 255, 255, 255, 127);
}
$noir = imagecolorallocate($image, 0, 0, 0);

imagestring($image, 5, 1, 1, htmlspecialchars($_GET['tex'], ENT_QUOTES), $noir);
imagepng($image);
?&gt;</code></pre><p id="r-123238" data-claire-element-id="123238">Le plus dur dans cette page a été de définir la taille de l'image souhaitée, ni trop grosse, ni trop petite, avec la police que j'ai choisie, chaque caractère fait 9 pixels de large : ainsi, nous sommes tranquilles.<br/> La fonction <code data-claire-semantic="html+php">function_exists() </code> vérifie qu'une fonction existe bien dans votre version de PHP.<br/> Nous avons enfin notre dernier point respecté.</p><p id="r-123239" data-claire-element-id="123239">Voilà un profil qui ressemble à celui du SdZ comme deux gouttes d'eau se ressemblent, ce n'est pas par manque d'imagination que je vous propose cela, mais simplement parce que je sais que ce mode d'affichage plaît à pas mal de monde. :) <br/> Passons au CSS : pour le moment, cette pauvre page souffre un peu de son design. :p</p><pre id="r-123240" data-claire-element-id="123240"><code data-claire-semantic="css">.profil_cellule_float {
        float: left;
        width: 47%;
        border: 1px solid #CCDFEF;
        max-height: 30%;
        margin-bottom: 1%;
        margin-left: 1%;
        margin-right: 1%;
        height: 250px;
}

.profil_cellule {
        margin-left: 49%;
        margin-bottom: 1%;
        margin-right: 1%;
        width: 47%;
        border: 1px solid #CCDFEF;
        height: 250px;
}

.profil_ligne {
        width: 95%;
        margin-left: 1%;
        border: 1px solid #CCDFEF;
        margin-bottom: 1%;
}

.avatar {
        margin-left: 10%;
        float: left;
        min-width: 150px;
        min-height: 130px;
}

h3 {
        text-decoration: underline;
        color: #507080;
        font-family:&quot;trebuchet ms&quot;, verdana, sans-serif;
        font-variant:small-caps;
        font-weight:bold;
        font-size:17px;
}</code></pre><p id="r-123241" data-claire-element-id="123241">Vous l'avez constaté, sur cette page, la réelle difficulté devrait être le CSS, et encore, c'est pour cela que je ne m'étends pas en explications, je ne voudrais pas que vous croyiez que je vous prends pour des idiots. :lol:</p><p id="r-123242" data-claire-element-id="123242">Bien, vous avez enfin des listes de vos membres, des connectés, etc., elles sont assez vides, car le système est pour le moment basique, c'est à vous de le modifier ; mais dans la partie II, nous les remplirons un peu plus, quant à la visualisation de profils, vous voyez que ce n'était pas si difficile, nous verrons en partie II comment sécuriser certaines informations telles que le mail ou la date de naissance.</p><p id="r-123243" data-claire-element-id="123243">Sur ce, attaquons l'édition de profil !</p><p id="r-123244" data-claire-element-id="123244">Dans la deuxième partie, nous allons approfondir tout cela pour créer un système encore plus sympa. :)</p><p id="r-123245" data-claire-element-id="123245">Le tutoriel n'est pas fini ! :) <br/> Nous continuons d'écrire les prochains chapitres pendant que vous lisez ces lignes.</p><p id="r-123246" data-claire-element-id="123246">Vous pouvez suivre l'avancement du tutoriel sur <a href="http://www.siteduzero.com/forum-83-314787-p1-tuto-espace-membre.html">ce topic</a>. :) <br/> Vous pouvez aussi aussi y poster vos suggestions.</p><p id="r-123247" data-claire-element-id="123247">À bientôt !</p><p id="r-123248" data-claire-element-id="123248">Neoterranos et LkY</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site">Créer un espace membre pour son site</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Création d&#039;un système simple
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/introduction-7">Introduction</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-espace-membre-kekece">
Un espace membre ? Kékécé ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-premiere-partie">
Présentation de la première partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/presentation-de-la-seconde-partie">
Présentation de la seconde partie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-table-sql">
La table SQL
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/les-bases-du-systeme">Les bases du système</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/des-pages-bien-utiles">
Des pages bien utiles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/d-autres-pages-a-inclure">
D&#039;autres pages à inclure
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/inscription-1">Inscription</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/avant-de-commencer-4">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/le-formulaire-4">
Le formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/charte-et-systeme-anti-robot">
Charte et système anti-robot
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/la-validation-et-les-mails">La validation et les mails</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/validation-du-formulaire">
Validation du formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/un-petit-mail">
Un petit mail ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-connexion-et-deconnexion">TP : connexion et déconnexion</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/prerequis-et-explications">
Prérequis et explications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-54">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/et-apres-3">
Et après ?
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/tp-site-et-profils">TP : site et profils</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-1-creation-de-statistiques">
Exercice 1 - Création de statistiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-1">
Correction de l&#039;exercice 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
Exercice 2 - Création de la page user.php
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/correction-de-l-exercice-2">
Correction de l&#039;exercice 2
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-espace-membre-pour-son-site/exercice-2-creation-de-la-page-user-php">
<span class="arrow"></span>
<span class="next">Exercice 2 - Création de la page user.php</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/creer-un-espace-membre-pour-son-site.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 08:29:48 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/creer-un-espace-membre-pour-son-site.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:31:36 GMT -->
</html>