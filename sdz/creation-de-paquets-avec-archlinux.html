<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/creation-de-paquets-avec-archlinux.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:50:09 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/creation-de-paquets-avec-archlinux.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:37:17 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Création de paquets avec ArchLinux</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/creation-de-paquets-avec-archlinux.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Création de paquets avec ArchLinux</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#CrationdepaquetsavecArchLinux">Création de paquets avec ArchLinux</a><br/><a href="#PKGBUILDoulabasedupaquet">PKGBUILD ou la base du paquet</a><br/><a href="#Lafonctionbuild">La fonction build()</a><br/><a href="#Crerlepaquetetleredistribuer">Créer le paquet et le redistribuer</a><br/><a href="#Lesfichiersd039installation">Les fichiers d&#039;installation</a><br/><a href="#DesPKGBUILDpluscompliqus">Des PKGBUILD plus compliqués</a><br/></div>
<a name="CrationdepaquetsavecArchLinux"></a><h2>Création de paquets avec ArchLinux</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/pkgbuild-ou-la-base-du-paquet">
<span class="next">PKGBUILD ou la base du paquet</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-592395" data-claire-element-id="592395">Vous avez envie de créer le paquet ArchLinux pour votre super jeu en 3D ou encore pour votre éditeur de texte révolutionnaire mais vous ne savez pas par où commencer ?</p><p id="r-592396" data-claire-element-id="592396">Pour suivre ce tutoriel, il vous faut évidemment une distribution ArchLinux fonctionnelle. Si vous voulez installer ce système, vous pouvez vous référer à la page « Installation de base » du <a href="http://wiki.archlinux.fr/">wiki français</a>. Il faut aussi une base en bash (variables, tableaux, conditions et fonctions sont utilisés dans ce tutoriel) ainsi qu'une connaissance des commandes courantes.</p><p id="r-592397" data-claire-element-id="592397">Si c'est bon, suivez le guide...</p>
</div><a name="PKGBUILDoulabasedupaquet"></a><h2>PKGBUILD ou la base du paquet</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/la-fonction-build">
<span class="next">La fonction build()</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-592398" data-claire-element-id="592398">Tout d'abord, sachez que PKGBUILD est un simple fichier texte qui va expliquer comment se déroule la création du paquet.<br/> Nous allons donc voir sa syntaxe et faire une approche de paquet.</p><p id="r-592399" data-claire-element-id="592399">Pour comprendre la syntaxe de ce fichier, je vous propose un petit PKGBUILD classique pour un programme fictif nommé Palne :</p><pre id="r-592400" data-claire-element-id="592400"><code data-claire-semantic="bash"># Maintainer: Adrien Perkele &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="215144534a444d4461454e4c40484f0f554d45">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;
# Contributor: Adrien Perkele &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="c6b6a3b4ada3aaa386a2a9aba7afa8e8b2aaa2">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;
pkgname=palne
pkgver=0.99_10
pkgrel=1
pkgdesc=&quot;Palne, le jeu super cool de Perkele&quot;
arch=(any)
url=&quot;http://www.palne.net&quot;
license=('BSD')
groups=
provides=
depends=('scengine&gt;=1.2')
optdepends=('unelib: Pour rajouter une fonctionnalité au programme !')
makedepends=
conflicts=('kipalne')
replaces=('palneuh')
backup=('etc/palne/palne.conf')
install=
source=(http://www.palne.net/download/$pkgname-$pkgver.tar.gz)
md5sums=('40972633cea6c8d38ff26dade3eec51e')
 
build() {
  cd $srcdir/$pkgname-$pkgver
  ./configure --prefix=/usr
  make || return 1
  make prefix=$pkgdir/usr install
}</code></pre><p id="r-592401" data-claire-element-id="592401">Évidemment, toutes ces variables ne vous disent peut-être pas grand-chose, je vous propose donc ce petit tableau :</p><table id="r-592514" data-claire-element-id="592514"><thead id="r-592407" data-claire-element-id="592407"><tr id="r-592406" data-claire-element-id="592406"><th id="r-592403" data-claire-element-id="592403"><p id="r-592402" data-claire-element-id="592402">Nom</p></th><th id="r-592405" data-claire-element-id="592405"><p id="r-592404" data-claire-element-id="592404">Description</p></th></tr></thead><tbody id="r-592513" data-claire-element-id="592513"><tr id="r-592412" data-claire-element-id="592412"><td id="r-592409" data-claire-element-id="592409"><p id="r-592408" data-claire-element-id="592408"># Maintainer</p></td><td id="r-592411" data-claire-element-id="592411"><p id="r-592410" data-claire-element-id="592410">La personne qui se charge officiellement de la maintenance du paquet (format Nom &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="0f626e66634f6b60626e6661217b636b">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;)</p></td></tr><tr id="r-592417" data-claire-element-id="592417"><td id="r-592414" data-claire-element-id="592414"><p id="r-592413" data-claire-element-id="592413"># Contributor</p></td><td id="r-592416" data-claire-element-id="592416"><p id="r-592415" data-claire-element-id="592415">La personne qui est à l'origine du paquet (même format)</p></td></tr><tr id="r-592422" data-claire-element-id="592422"><td id="r-592419" data-claire-element-id="592419"><p id="r-592418" data-claire-element-id="592418">pkgname</p></td><td id="r-592421" data-claire-element-id="592421"><p id="r-592420" data-claire-element-id="592420">Nom du paquet</p></td></tr><tr id="r-592427" data-claire-element-id="592427"><td id="r-592424" data-claire-element-id="592424"><p id="r-592423" data-claire-element-id="592423">pkgver</p></td><td id="r-592426" data-claire-element-id="592426"><p id="r-592425" data-claire-element-id="592425">Version du programme ( chiffres et lettres uniquement, pour séparer on utilise des underscores (_) ).</p></td></tr><tr id="r-592432" data-claire-element-id="592432"><td id="r-592429" data-claire-element-id="592429"><p id="r-592428" data-claire-element-id="592428">pkgrel</p></td><td id="r-592431" data-claire-element-id="592431"><p id="r-592430" data-claire-element-id="592430">Valeur spécifique à ArchLinux, elle correspond à la version du paquet (pour chaque version d'un PKGBUILD d'un même programme de la même version, on met une valeur différente, en commençant par 1). Elle gère entre autres les paquets périmés.</p></td></tr><tr id="r-592437" data-claire-element-id="592437"><td id="r-592434" data-claire-element-id="592434"><p id="r-592433" data-claire-element-id="592433">pkgdesc</p></td><td id="r-592436" data-claire-element-id="592436"><p id="r-592435" data-claire-element-id="592435">Courte description du contenu du paquet qui sera affichée dans les détails.</p></td></tr><tr id="r-592442" data-claire-element-id="592442"><td id="r-592439" data-claire-element-id="592439"><p id="r-592438" data-claire-element-id="592438">arch</p></td><td id="r-592441" data-claire-element-id="592441"><p id="r-592440" data-claire-element-id="592440">L'architecture où la compilation du programme est compatible (<strong>i686</strong> ou <strong>x86_64</strong> ou <strong>any</strong> pour les deux)</p></td></tr><tr id="r-592447" data-claire-element-id="592447"><td id="r-592444" data-claire-element-id="592444"><p id="r-592443" data-claire-element-id="592443">url</p></td><td id="r-592446" data-claire-element-id="592446"><p id="r-592445" data-claire-element-id="592445">Site du programme</p></td></tr><tr id="r-592452" data-claire-element-id="592452"><td id="r-592449" data-claire-element-id="592449"><p id="r-592448" data-claire-element-id="592448">license</p></td><td id="r-592451" data-claire-element-id="592451"><p id="r-592450" data-claire-element-id="592450">Licence du programme (lire la partie « Le problème des licences » pour les valeurs)</p></td></tr><tr id="r-592457" data-claire-element-id="592457"><td id="r-592454" data-claire-element-id="592454"><p id="r-592453" data-claire-element-id="592453">groups</p></td><td id="r-592456" data-claire-element-id="592456"><p id="r-592455" data-claire-element-id="592455">Si le paquet appartient à un groupe de paquets, on le précise (exemple kdebase appartient au groupe kde)</p></td></tr><tr id="r-592462" data-claire-element-id="592462"><td id="r-592459" data-claire-element-id="592459"><p id="r-592458" data-claire-element-id="592458">provides</p></td><td id="r-592461" data-claire-element-id="592461"><p id="r-592460" data-claire-element-id="592460">Si notre paquet fournit un autre logiciel, on le précise</p></td></tr><tr id="r-592467" data-claire-element-id="592467"><td id="r-592464" data-claire-element-id="592464"><p id="r-592463" data-claire-element-id="592463">depends</p></td><td id="r-592466" data-claire-element-id="592466"><p id="r-592465" data-claire-element-id="592465">Les dépendances du programme (lire la partie « Les dépendances » pour savoir comment ça marche)</p></td></tr><tr id="r-592472" data-claire-element-id="592472"><td id="r-592469" data-claire-element-id="592469"><p id="r-592468" data-claire-element-id="592468">optdepends</p></td><td id="r-592471" data-claire-element-id="592471"><p id="r-592470" data-claire-element-id="592470">Paquet optionnel qui rajoute en général des fonctionnalités au programme (exemple, pacman-color rajoute de la couleur dans pacman).</p></td></tr><tr id="r-592477" data-claire-element-id="592477"><td id="r-592474" data-claire-element-id="592474"><p id="r-592473" data-claire-element-id="592473">makedepends</p></td><td id="r-592476" data-claire-element-id="592476"><p id="r-592475" data-claire-element-id="592475">Ce sont aussi des dépendances, mais celles que la compilation nécessite (pareil, voir la partie « Les dépendances »)</p></td></tr><tr id="r-592482" data-claire-element-id="592482"><td id="r-592479" data-claire-element-id="592479"><p id="r-592478" data-claire-element-id="592478">conflicts</p></td><td id="r-592481" data-claire-element-id="592481"><p id="r-592480" data-claire-element-id="592480">Les paquets qui empêchent le fonctionnement de notre programme</p></td></tr><tr id="r-592487" data-claire-element-id="592487"><td id="r-592484" data-claire-element-id="592484"><p id="r-592483" data-claire-element-id="592483">replaces</p></td><td id="r-592486" data-claire-element-id="592486"><p id="r-592485" data-claire-element-id="592485">Précise les paquets que notre programme remplace (exemple, ancienne version du programme qui porte un autre nom)</p></td></tr><tr id="r-592492" data-claire-element-id="592492"><td id="r-592489" data-claire-element-id="592489"><p id="r-592488" data-claire-element-id="592488">backup</p></td><td id="r-592491" data-claire-element-id="592491"><p id="r-592490" data-claire-element-id="592490">Les fichiers qui seront sauvegardés à la désinstallation</p></td></tr><tr id="r-592497" data-claire-element-id="592497"><td id="r-592494" data-claire-element-id="592494"><p id="r-592493" data-claire-element-id="592493">install</p></td><td id="r-592496" data-claire-element-id="592496"><p id="r-592495" data-claire-element-id="592495">Précise un fichier d'installation (voir la partie « Les fichiers d'installation »)</p></td></tr><tr id="r-592502" data-claire-element-id="592502"><td id="r-592499" data-claire-element-id="592499"><p id="r-592498" data-claire-element-id="592498">source</p></td><td id="r-592501" data-claire-element-id="592501"><p id="r-592500" data-claire-element-id="592500">Le lien de l'archive contenant les sources</p></td></tr><tr id="r-592507" data-claire-element-id="592507"><td id="r-592504" data-claire-element-id="592504"><p id="r-592503" data-claire-element-id="592503">md5sums</p></td><td id="r-592506" data-claire-element-id="592506"><p id="r-592505" data-claire-element-id="592505">Permet de vérifier l'intégralité de l'archive en fournissant son empreinte MD5</p></td></tr><tr id="r-592512" data-claire-element-id="592512"><td id="r-592509" data-claire-element-id="592509"><p id="r-592508" data-claire-element-id="592508">build()</p></td><td id="r-592511" data-claire-element-id="592511"><p id="r-592510" data-claire-element-id="592510">Fonction qui nous permettra de préparer le paquet (compilation ainsi que placement dans le paquet final)</p></td></tr></tbody></table><h2 id="r-les-dependances" data-claire-element-id="592516">Les dépendances</h2><p id="r-592515" data-claire-element-id="592515">Pour la variable depends, on prend un tableau avec la liste des dépendances sous la forme « <code data-claire-semantic="console">'[nom du paquet archlinux]'</code> ». On peut aussi préciser une version avec un comparatif (qui je rappelle sont <strong>=, &gt;, &lt;,</strong><strong>&lt;=</strong> ou encore <strong>&gt;=</strong>) suivi d'un numéro de version (par exemple « <code data-claire-semantic="console">'python&gt;=2.6'</code> »).</p><h2 id="r-le-probleme-des-licences" data-claire-element-id="592527">Le problème des licences</h2><p id="r-592517" data-claire-element-id="592517">La variable <strong>licence</strong> est assez particulière, en effet il faut respecter une syntaxe et ne pas balancer le nom d'une licence comme ça.<br/> Il y a plusieurs cas selon les licences, je vais essayer de vous les détailler un maximum.<br/> Tout d'abord, vérifiez si un dossier du nom de la licence existe dans <em>/usr/share/licenses/common/</em> :</p><ul id="r-592526" data-claire-element-id="592526"><li id="r-592519" data-claire-element-id="592519"><p id="r-592518" data-claire-element-id="592518">Si votre licence (elle est « common ») s'y trouve, il suffit d'écrire le nom du répertoire dans la variable <strong>license</strong> (exemple: <code>license=('GPL')</code>) ;</p></li><li id="r-592521" data-claire-element-id="592521"><p id="r-592520" data-claire-element-id="592520">Si votre licence est MIT, BSD, zlib/libpng ou encore Python, vous devrez créer un fichier nommé généralement COPYING (le nom n'est pas important) contenant le texte de la licence dans <em>/usr/share/licenses/<strong>$pkgname</strong></em>. Vous verrez comment faire cela dans la partie sur la fonction build(). Pour l'utiliser, il suffira de faire comme pour les licences common, un exemple se trouve dans mon fichier PKGBUILD ;</p></li><li id="r-592523" data-claire-element-id="592523"><p id="r-592522" data-claire-element-id="592522">Dans le cas d'une licence personnelle, vous allez aussi créer votre fichier COPYING. Quant à l'utilisation dans le PKGBUILD, vous allez utiliser la syntaxe « <code data-claire-semantic="console">license=('custom:Nom de la licence')</code> ;</p></li><li id="r-592525" data-claire-element-id="592525"><p id="r-592524" data-claire-element-id="592524">Enfin, dernier cas, si votre paquet est couvert par plusieurs licences, vous aurez remarqué que <strong>license</strong> est un tableau : chaque valeur est une licence (exemple : <code data-claire-semantic="console">license=('GPL' 'custom:crave' 'BSD')</code>).</p></li></ul><h2 id="r-la-variable-md5sums" data-claire-element-id="592531">La variable <em>md5sums</em></h2><p id="r-592528" data-claire-element-id="592528">Un petit mot sur le md5sums : pour le calculer, il suffit d'utiliser la commande <code data-claire-semantic="console">md5sum</code> ainsi :</p><pre id="r-592529" data-claire-element-id="592529"><code data-claire-semantic="console">md5sum monprogramme-1.1_1.tar.gz | cut -d ' ' -f 1</code></pre><p id="r-592530" data-claire-element-id="592530">C'est le résultat de cette commande que vous allez mettre dans la variable md5sums.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux">Création de paquets avec ArchLinux</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/pkgbuild-ou-la-base-du-paquet">
PKGBUILD ou la base du paquet
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/la-fonction-build">
La fonction build()
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/creer-le-paquet-et-le-redistribuer">
Créer le paquet et le redistribuer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/les-fichiers-d-installation">
Les fichiers d&#039;installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/des-pkgbuild-plus-compliques">
Des PKGBUILD plus compliqués
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/la-fonction-build">
<span class="next">La fonction build()</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lafonctionbuild"></a><h2>La fonction build()</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/pkgbuild-ou-la-base-du-paquet">
<span class="arrow"></span>
<span class="next">PKGBUILD ou la base du paquet</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/creer-le-paquet-et-le-redistribuer">
<span class="next">Créer le paquet et le redistribuer</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-592533" data-claire-element-id="592533">Maintenant, nous rentrons dans le vif du sujet. Jusqu'ici, nous avons fait de la théorie sur la création et nous savons récupérer les sources, vérifier qu'elles sont complètes, mais nous ne savons toujours pas créer le paquet !<br/> C'est la fonction build() qui va se charger de cette tâche.</p><p id="r-592534" data-claire-element-id="592534">En général, l'ordre des commandes dans cette fonction est celui-ci :</p><pre id="r-592535" data-claire-element-id="592535"><code>Fonction build
    On se place dans le répertoire contenant les sources téléchargées
    On compile les sources 
    On place dans le répertoire qui va être le paquet tout ce qu'il nous faudra
Fin de la fonction</code></pre><p id="r-592536" data-claire-element-id="592536">Il faut savoir qu'un paquet est une simple archive qui contient l'architecture du système. Le gestionnaire s'occupera donc ainsi (en partie) de décompresser l'archive à la racine.<br/> Pendant la création de notre fonction, nous allons traiter un dossier nommé pkg, qui sera compressé à l'exécution du PKGBUILD.</p><p id="r-592537" data-claire-element-id="592537">Comme exemple, nous allons maintenant imaginer que notre archive tar.gz téléchargée contient ceci :</p><pre id="r-592538" data-claire-element-id="592538"><code>Archive tar.gz
---- bin/
---- doc/
-------- palne.6.gz
-------- index.html
---- src/
-------- main.c
-------- fonctions.c
-------- fonctions.h
---- data/
-------- COPYING
-------- images/
------------ icone.png
------------ splash.png
------------ gagne.png
------------ perdu.png
-------- conf/
------------ palne.cfg
---- Makefile</code></pre><p id="r-592539" data-claire-element-id="592539">Nous allons maintenant créer la fonction build() qui va :</p><ul id="r-592554" data-claire-element-id="592554"><li id="r-592541" data-claire-element-id="592541"><p id="r-592540" data-claire-element-id="592540">compiler les sources ;</p></li><li id="r-592543" data-claire-element-id="592543"><p id="r-592542" data-claire-element-id="592542">mettre le man dans le répertoire qui correspond ;</p></li><li id="r-592545" data-claire-element-id="592545"><p id="r-592544" data-claire-element-id="592544">mettre la doc dans le répertoire qui correspond ;</p></li><li id="r-592547" data-claire-element-id="592547"><p id="r-592546" data-claire-element-id="592546">mettre l'exécutable dans /usr/bin ;</p></li><li id="r-592549" data-claire-element-id="592549"><p id="r-592548" data-claire-element-id="592548">mettre la configuration dans /etc ;</p></li><li id="r-592551" data-claire-element-id="592551"><p id="r-592550" data-claire-element-id="592550">placer la licence dans /usr/share/licenses/ ;</p></li><li id="r-592553" data-claire-element-id="592553"><p id="r-592552" data-claire-element-id="592552">et enfin mettre les images dans /usr/share/.</p></li></ul><p id="r-592555" data-claire-element-id="592555">Tout d'abord, on se place dans le répertoire des sources :</p><pre id="r-592556" data-claire-element-id="592556"><code data-claire-semantic="bash">build()
{
    cd $srcdir/$pkgname</code></pre><p id="r-592557" data-claire-element-id="592557">La variable srcdir contient le répertoire où l'archive a été décompressée.<br/> Attention néanmoins, les fichiers décompressés sont dans un répertoire du même nom que le paquet.</p><p id="r-592558" data-claire-element-id="592558">Nous allons donc maintenant compiler les sources de notre programme en exécutant simplement le Makefile :</p><pre id="r-592559" data-claire-element-id="592559"><code data-claire-semantic="bash">make || return 1</code></pre><p id="r-592560" data-claire-element-id="592560">Comme vous le constatez, ma commande de compilation est suivie d'un <code data-claire-semantic="console">|| return 1</code> : cela permet de dire que si la commande a échoué, on arrête la création du paquet.<br/> Il faudra placer ceci après chaque commande importante pour le paquet.</p><p id="r-592561" data-claire-element-id="592561">Passons maintenant à la création de l'architecture du paquet :</p><pre id="r-592562" data-claire-element-id="592562"><code data-claire-semantic="bash">mkdir -p $pkgdir/usr/bin/
mkdir -p $pkgdir/usr/share/palne/
mkdir -p $pkgdir/usr/share/doc/palne/
mkdir -p $pkgdir/usr/man/man6/
mkdir -p $pkgdir/etc/palne/
mkdir -p $pkgdir/usr/share/licenses/palne/</code></pre><p id="r-592563" data-claire-element-id="592563">À noter que la variable <strong>pkgdir</strong> correspond au dossier <strong>pkg</strong> dont je vous avais parlé plus tôt.<br/> On va maintenant pouvoir passer à la copie des fichiers :</p><pre id="r-592564" data-claire-element-id="592564"><code data-claire-semantic="bash">cp bin/palne $pkgdir/usr/bin/
chmod +x $pkgdir/usr/bin
cp doc/palne.6.gz $pkgdir/usr/man/man6/
cp doc/index.html $pkgdir/usr/share/doc/palne/
cp -r data/images/ $pkgdir/usr/share/palne/images/
cp data/conf/palne.cfg $pkgdir/etc/palne/
cp data/COPYING $pkgdir/usr/share/licenses/palne/</code></pre><p id="r-592565" data-claire-element-id="592565">À noter que le chmod est obligatoire si l'on veut pouvoir exécuter le programme.</p><p id="r-592566" data-claire-element-id="592566">Et bonne nouvelle, nous avons fini notre fonction build() !<br/> Néanmoins, il ne faut pas oublier de la refermer :</p><pre id="r-592567" data-claire-element-id="592567"><code data-claire-semantic="bash">}</code></pre><p id="r-592568" data-claire-element-id="592568">Voici donc un petit récapitulatif de la fonction qui correspond aux besoins de mon programme Palne :</p><pre id="r-592569" data-claire-element-id="592569"><code data-claire-semantic="bash">build()
{
    cd $srcdir/$pkgname
    make || return 1

    mkdir -p $pkgdir/usr/bin/ 
    mkdir -p $pkgdir/usr/share/palne/
    mkdir -p $pkgdir/usr/share/doc/palne/
    mkdir -p $pkgdir/usr/man/man6/
    mkdir -p $pkgdir/etc/palne/
    mkdir -p $pkgdir/usr/share/licenses/palne/

    cp bin/palne $pkgdir/usr/bin/
    chmod +x $pkgdir/usr/bin
    cp doc/palne.6.gz $pkgdir/usr/man/man6/
    cp doc/index.html $pkgdir/usr/share/doc/palne/
    cp -r data/images/ $pkgdir/usr/share/palne/images/
    cp data/conf/palne.cfg $pkgdir/etc/palne/
    cp data/COPYING $pkgdir/usr/share/licenses/palne/
}</code></pre>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux">Création de paquets avec ArchLinux</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/pkgbuild-ou-la-base-du-paquet">
PKGBUILD ou la base du paquet
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/la-fonction-build">
La fonction build()
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/creer-le-paquet-et-le-redistribuer">
Créer le paquet et le redistribuer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/les-fichiers-d-installation">
Les fichiers d&#039;installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/des-pkgbuild-plus-compliques">
Des PKGBUILD plus compliqués
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/pkgbuild-ou-la-base-du-paquet">
<span class="arrow"></span>
<span class="next">PKGBUILD ou la base du paquet</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/creer-le-paquet-et-le-redistribuer">
<span class="next">Créer le paquet et le redistribuer</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Crerlepaquetetleredistribuer"></a><h2>Créer le paquet et le redistribuer</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/la-fonction-build">
<span class="arrow"></span>
<span class="next">La fonction build()</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/les-fichiers-d-installation">
<span class="next">Les fichiers d&#039;installation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-creation-34" data-claire-element-id="592577">Création</h2><p id="r-592571" data-claire-element-id="592571">Bon, nous savons créer un PKGBUILD basique, mais nous ne savons toujours pas comment obtenir le paquet !<br/> En fait, vous allez rire mais le PKGBUILD, c'était une blague de mon invention et il ne sert à rien la création d'un paquet se limite à une commande.<br/> Tout d'abord je vous recommande de mettre le PKGBUILD dans un répertoire créé à cet effet.</p><p id="r-592572" data-claire-element-id="592572">Maintenant, l'heure de vérité, lancez cette commande :</p><pre id="r-592573" data-claire-element-id="592573"><code data-claire-semantic="console">makepkg</code></pre><p id="r-592574" data-claire-element-id="592574">Si tout se passe bien, il vous posera quelques questions, et vous retournerez dans votre prompt.<br/> Mais mais, que vois-je ? Notre répertoire a été rempli !</p><pre id="r-592575" data-claire-element-id="592575"><code data-claire-semantic="console">$ ls
src/ pkg/ PKGBUILD nom-version.tar.gz</code></pre><p id="r-592576" data-claire-element-id="592576">Eh bien oui, ce fameux tar.gz est votre paquet. Vous ne me croyez pas ? Alors lancez l'installation avec <code data-claire-semantic="console">yaourt -U nom-version.tar.gz</code> puis testez votre programme avec <code data-claire-semantic="console">palne</code>.</p><h2 id="r-redistribution" data-claire-element-id="592580">Redistribution</h2><p id="r-592578" data-claire-element-id="592578">Vous pouvez vous contenter de donner votre tar.gz au public via votre site internet ou alors la mettre dans les dépôts AUR d'ArchLinux.<br/> C'est cette méthode que je vais vous présenter.</p><p id="r-592579" data-claire-element-id="592579">Tout d'abord, il faut vous inscrire sur le site officiel de AUR : <a href="http://aur.archlinux.org/account.php">http://aur.archlinux.org/account.php</a><br/> Une fois inscrit, connectez-vous et choisissez « submit » (ou « soumettre » en français) dans le menu en haut. <br/> Vous aurez deux champs : Package Category et Upload package file.<br/> Pour la liste déroulante, vous mettrez la catégorie de votre paquet (dans le cas de mon exemple, ce serait un jeu).<br/> Pour le fichier à sélectionner, nous allons le créer tout de suite en exécutant la commande <code data-claire-semantic="console">makepkg --source</code> dans le répertoire du PKGBUILD.<br/> Validez. Si tout s'est bien passé, en exécutant la commande <code data-claire-semantic="console">yaourt -Sy monpaquet</code>, votre paquet s'installera !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux">Création de paquets avec ArchLinux</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/pkgbuild-ou-la-base-du-paquet">
PKGBUILD ou la base du paquet
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/la-fonction-build">
La fonction build()
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/creer-le-paquet-et-le-redistribuer">
Créer le paquet et le redistribuer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/les-fichiers-d-installation">
Les fichiers d&#039;installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/des-pkgbuild-plus-compliques">
Des PKGBUILD plus compliqués
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/la-fonction-build">
<span class="arrow"></span>
<span class="next">La fonction build()</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/les-fichiers-d-installation">
<span class="next">Les fichiers d&#039;installation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesfichiersd039installation"></a><h2>Les fichiers d&#039;installation</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/creer-le-paquet-et-le-redistribuer">
<span class="arrow"></span>
<span class="next">Créer le paquet et le redistribuer</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/des-pkgbuild-plus-compliques">
<span class="next">Des PKGBUILD plus compliqués</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-592582" data-claire-element-id="592582">Quand votre programme nécessite une configuration spécifique, vous devriez l'expliquer à l'installation.<br/> C'est grâce au fameux fichier d'installation précisé par la variable install que vous pourrez le faire.</p><p id="r-592583" data-claire-element-id="592583">Il est composé de trois simples fonctions, chacune exécutée à un moment précis de l'utilisation du paquet.</p><p id="r-592584" data-claire-element-id="592584">La première fonction, post_install(), est exécutée après l'installation du paquet (vous pourrez préciser où trouver la configuration de base, par exemple. Comme argument, cette fonction prend le numéro de version.</p><p id="r-592585" data-claire-element-id="592585">La seconde fonction, post_upgrade(), est exécutée après la mise à jour du paquet, on l'utilise souvent pour préciser que la configuration est incompatible, si c'est le cas. En arguments, cette fonction prend le numéro de la nouvelle version puis celui de l'ancienne.</p><p id="r-592586" data-claire-element-id="592586">La troisième fonction, pre_remove(), est exécutée avant la suppression. Je n'ai malheureusement pas d'exemple d'utilisation, mais si quelqu'un en trouve un, je serai heureux de l'ajouter dans ce tutoriel. Cette fonction prend le numéro de version.</p><p id="r-592587" data-claire-element-id="592587">Voici un exemple de fichier tiré du paquet du Window Manager Awesome :</p><pre id="r-592588" data-claire-element-id="592588"><code data-claire-semantic="bash">post_install() {
cat &lt;&lt; _EOF

==&gt; awesome installation notes:
    ----------------------------------------
    During some updates of awesome, the config file syntax changes heavily.
    This means that your configuration file (~/.config/awesome/rc.lua) for 
    any other than this particular version of awesome may or may not work.
    
_EOF

}

post_upgrade() {
        post_install
}</code></pre>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux">Création de paquets avec ArchLinux</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/pkgbuild-ou-la-base-du-paquet">
PKGBUILD ou la base du paquet
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/la-fonction-build">
La fonction build()
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/creer-le-paquet-et-le-redistribuer">
Créer le paquet et le redistribuer
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/les-fichiers-d-installation">
Les fichiers d&#039;installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/des-pkgbuild-plus-compliques">
Des PKGBUILD plus compliqués
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/creer-le-paquet-et-le-redistribuer">
<span class="arrow"></span>
<span class="next">Créer le paquet et le redistribuer</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/des-pkgbuild-plus-compliques">
<span class="next">Des PKGBUILD plus compliqués</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="DesPKGBUILDpluscompliqus"></a><h2>Des PKGBUILD plus compliqués</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/les-fichiers-d-installation">
<span class="arrow"></span>
<span class="next">Les fichiers d&#039;installation</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-592590" data-claire-element-id="592590">Ceux que nous avons vu jusqu'à maintenant sont assez basiques, nous allons donc en voir quelques-uns plus complexes, par exemple avec gestion des patchs ou d'un système de versionnage.<br/> C'est parti !</p><h2 id="r-les-gestionnaires-de-versions" data-claire-element-id="592613">Les gestionnaires de versions</h2><p id="r-592591" data-claire-element-id="592591">Comme je n'ai pas une imagination infinie, je vais simplement réutiliser mon ancien PKGBUILD et le transformer pour utiliser le gestionnaire de versionnage <strong>git</strong>.</p><p id="r-592592" data-claire-element-id="592592">Pour ceux qui l'auraient oublié, en voici le code :</p><div id="r-592594" data-claire-element-id="592594"><pre id="r-592593" data-claire-element-id="592593"><code data-claire-semantic="bash"># Maintainer: Adrien Perkele &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="cbbbaeb9a0aea7ae8bafa4a6aaa2a5e5bfa7af">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;
# Contributor: Adrien Perkele &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="79091c0b121c151c391d1614181017570d151d">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;
pkgname=palne
pkgver=1
pkgrel=1
pkgdesc=&quot;Palne, le jeu super cool de Perkele&quot;
arch=(any)
url=&quot;http://www.palne.net&quot;
license=('BSD')
groups=
provides=
depends=('scengine&gt;=1.2')
optdepends=('unelib: Pour rajouter une fonctionnalité au programme !')
makedepends=
conflicts=('kipalne')
replaces=('palneuh')
backup=('etc/palne/palne.conf')
install=
source=(http://www.palne.net/download/$pkgname-$pkgver.tar.gz)
md5sums=('40972633cea6c8d38ff26dade3eec51e')
 
build()
{
    cd $srcdir/$pkgname
    make || return 1

    mkdir -p $pkgdir/usr/bin/ 
    mkdir -p $pkgdir/usr/share/palne/
    mkdir -p $pkgdir/usr/share/doc/palne/
    mkdir -p $pkgdir/usr/man/man6/
    mkdir -p $pkgdir/etc/palne/

    cp bin/palne $pkgdir/usr/bin/
    chmod +x $pkgdir/usr/bin
    cp doc/palne.6.gz $pkgdir/usr/man/man6/
    cp doc/index.html $pkgdir/usr/share/doc/palne/
    cp -r data/images/ $pkgdir/usr/share/palne/images/
    cp data/conf/palne.cfg $pkgdir/etc/palne/
}</code></pre></div><p id="r-592595" data-claire-element-id="592595">On va donc commencer par renommer le paquet pour préciser qu'il utilise les versions de développement, par exemple palne-git.</p><p id="r-592596" data-claire-element-id="592596">Maintenant, il va falloir préciser que git est nécessaire à la compilation :</p><pre id="r-592597" data-claire-element-id="592597"><code data-claire-semantic="bash">makedepends=('git')</code></pre><p id="r-592598" data-claire-element-id="592598">Étant donné que nous ne téléchargeons plus les sources par une archive sur le net, il va falloir supprimer le contenu de <strong>source</strong> et de <strong>md5sums</strong> :</p><pre id="r-592599" data-claire-element-id="592599"><code data-claire-semantic="bash">source=()
md5sums=()</code></pre><p id="r-592600" data-claire-element-id="592600">Maintenant, pour que le code soit plus clair, nous allons créer deux variables personnalisées. Néanmoins, pour éviter d'éventuels conflits, nous allons mettre un underscore (<strong>_</strong>) avant le nom de la variable. Nous allons donc créer nos deux variables, une pour la racine de notre <em>repository</em> et une pour le nom du répertoire à créer, par exemple :</p><pre id="r-592601" data-claire-element-id="592601"><code data-claire-semantic="bash">_gitroot=&quot;git://git.palne.net/palne&quot;
_gitname=&quot;palne&quot;</code></pre><p id="r-592602" data-claire-element-id="592602">Pour la suite, nous allons modifier la fonction build().<br/> Remplacez la première ligne <code data-claire-semantic="bash">cd $srcdir/$pkgname </code> par un simple <code data-claire-semantic="bash">cd $srcdir </code>.</p><p id="r-592603" data-claire-element-id="592603">Ensuite nous allons vérifier si le <em>repository</em> a déjà été récupéré ou s'il faut le faire :</p><pre id="r-592604" data-claire-element-id="592604"><code data-claire-semantic="bash">if [[ -d $_gitname ]] ; then
    # Le repository a déjà été récupéré, on le met a jour
else
    # on doit le récupérer 
fi</code></pre><p id="r-592605" data-claire-element-id="592605">Pour mettre à jour notre <em>repository</em>, nous allons faire comme cela (et laisser un petit message) :</p><pre id="r-592606" data-claire-element-id="592606"><code data-claire-semantic="bash">git-pull origin || return 1 
msg &quot;Les fichiers locaux ont été mis à jour.&quot;</code></pre><p id="r-592607" data-claire-element-id="592607">À noter que je n'ai pas oublié de finir par ligne par un <code data-claire-semantic="console">|| return 1</code> pour préciser que si la fonction échoue, la suite ne fonctionnera pas.</p><p id="r-592608" data-claire-element-id="592608">Maintenant, pour récupérer le <em>repository</em>, nous allons faire ainsi :</p><pre id="r-592609" data-claire-element-id="592609"><code data-claire-semantic="bash">git clone $_gitroot || return 1
msg &quot;Les fichiers ont été téléchargés.&quot;</code></pre><p id="r-592610" data-claire-element-id="592610">Nous avons fini, c'était si compliqué ?</p><p id="r-592611" data-claire-element-id="592611">Pour ceux qui n'auraient pas bien compris où placer le code, voici un récapitulatif du PKGBUILD :</p><pre id="r-592612" data-claire-element-id="592612"><code data-claire-semantic="bash"># Maintainer: Adrien Perkele &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="c5b5a0b7aea0a9a085a1aaa8a4acabebb1a9a1">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;
# Contributor: Adrien Perkele &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="364653445d535a537652595b575f5818425a52">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;
pkgname=palne-git
pkgver=1
pkgrel=1
pkgdesc=&quot;Palne, le jeu super cool de Perkele&quot;
arch=(any)
url=&quot;http://www.palne.net&quot;
license=('BSD')
groups=
provides=
depends=('scengine&gt;=1.2')
optdepends=('unelib: Pour rajouter une fonctionnalité au programme !')
makedepends=('git')
conflicts=('kipalne')
replaces=('palneuh')
backup=('etc/palne/palne.conf')
install=
source=()
md5sums=()
_gitroot=&quot;git://git.palne.net/palne&quot;
_gitname=&quot;palne&quot;

build()
{
    msg &quot;Récupération des sources sur le serveur git&quot;
    if [[ -d $_gitname ]] ; then
        git-pull origin || return 1 
        msg &quot;Les fichiers locaux ont été mis à jour.&quot;
    else
        git clone $_gitroot || return 1
        msg &quot;Les fichiers ont été téléchargés.&quot;
    fi
    cd $_gitname

    msg &quot;Récupération des sources terminée&quot;
    msg &quot;Début de la compilation&quot;

    make || return 1

    mkdir -p $pkgdir/usr/bin/ 
    mkdir -p $pkgdir/usr/share/palne/
    mkdir -p $pkgdir/usr/share/doc/palne/
    mkdir -p $pkgdir/usr/man/man6/
    mkdir -p $pkgdir/etc/palne/

    cp bin/palne $pkgdir/usr/bin/
    chmod +x $pkgdir/usr/bin
    cp doc/palne.6.gz $pkgdir/usr/man/man6/
    cp doc/index.html $pkgdir/usr/share/doc/palne/
    cp -r data/images/ $pkgdir/usr/share/palne/images/
    cp data/conf/palne.cfg $pkgdir/etc/palne/
}</code></pre><h2 id="r-appliquer-un-patch-1" data-claire-element-id="592639">Appliquer un patch</h2><p id="r-592614" data-claire-element-id="592614">Maintenant, éloignons-nous un peu des PKGBUILD pour nous intéresser à deux commandes très utiles, j'ai nommé diff et patch.</p><p id="r-592615" data-claire-element-id="592615"><strong>diff</strong> sert à calculer la différence entre deux ensemble de fichiers tandis que <strong>patch</strong> sert, à partir du résultat de la commande précédente et des sources, à obtenir la version modifiée des sources.</p><p id="r-592616" data-claire-element-id="592616">Pour comprendre le fonctionnement de ces commandes, je vous propose donc cet exemple simple :</p><p id="r-592617" data-claire-element-id="592617">Nous avons deux fichiers, code.c.old et code.c :</p><pre id="r-592618" data-claire-element-id="592618"><code data-claire-semantic="c">#include &lt;stdio.h&gt;

int main(int a, char **b)
{
    printf(&quot;Hello world!&quot;);
    return 0;
}</code></pre><pre id="r-592619" data-claire-element-id="592619"><code data-claire-semantic="c">#include &lt;stdio.h&gt;

int main(int a, char **b)
{
    printf(&quot;Bonjour le monde !&quot;);
    return 0;
}</code></pre><p id="r-592620" data-claire-element-id="592620">La seule chose qui change entre ces deux codes est le texte, l'un en anglais, l'autre en français.</p><p id="r-592621" data-claire-element-id="592621">Pour créer un patch, on va donc exécuter la commande diff ainsi :</p><pre id="r-592622" data-claire-element-id="592622"><code data-claire-semantic="console">diff -c code.c.old code.c &gt; code.diff</code></pre><p id="r-592623" data-claire-element-id="592623">Si vous ouvrez le fichier code.diff, vous aurez un résultat semblable à celui-ci :</p><pre id="r-592624" data-claire-element-id="592624"><code data-claire-semantic="diff">*** code.c.old	2010-05-13 16:49:09.000000000 +0200
--- code.c	2010-05-13 16:47:58.000000000 +0200
***************
*** 2,7 ****
  
  int main(int a, char **b)
  {
!     printf(&quot;Hello World!&quot;);
      return 0;
  }
--- 2,7 ----
  
  int main(int a, char **b)
  {
!     printf(&quot;Bonjour le monde !&quot;);
      return 0;
  }</code></pre><p id="r-592625" data-claire-element-id="592625">Bien sûr, en général, vous allez devoir comparer plusieurs fichiers pour un même patch.<br/> Pour cela, vous allez créer un répertoire contenant les anciennes sources, code-old par exemple, et un autre contenant les sources à jour, code. La commande sera donc :</p><pre id="r-592626" data-claire-element-id="592626"><code data-claire-semantic="console">diff -cr code-old/ code/ &gt; code.diff</code></pre><p id="r-592627" data-claire-element-id="592627">Où -r est le mode récursif.</p><p id="r-592628" data-claire-element-id="592628">C'est bien beau mais à quoi sert ce fichier .diff si on ne le réutilise pas ?<br/> Pour ce faire, on va utiliser la commande patch dans le répertoire code-old ainsi :</p><pre id="r-592629" data-claire-element-id="592629"><code data-claire-semantic="console">patch -p0 &lt; code.diff</code></pre><p id="r-592630" data-claire-element-id="592630">Où -p0 est le mode récursif.</p><p id="r-592631" data-claire-element-id="592631">Voilà, maintenant que nous connaissons le fonctionnement de la commande patch et que nous avons notre diff, nous allons pouvoir utiliser tout ceci dans un paquet et ce n'est pas plus compliqué que ça !</p><p id="r-592632" data-claire-element-id="592632">Tout d'abord, il faudra héberger votre diff quelque part, et le rajouter dans le tableau <strong>source</strong> ainsi que son md5sums dans le tableau correspondant :</p><pre id="r-592633" data-claire-element-id="592633"><code data-claire-semantic="bash">source=(http://palne.net/$pkgname-$pkgver.pkg.tar.gz http://palne.net/patch.diff)
md5sums=('40972633cea6c8d38ff26dade3eec51e' '8def8b39aceae8e27fdcf2af107991cb')</code></pre><p id="r-592634" data-claire-element-id="592634">Juste avant la compilation, dans notre fonction build(), on ajoute un simple :</p><pre id="r-592635" data-claire-element-id="592635"><code data-claire-semantic="bash">patch &lt; $srcdir/patch.diff</code></pre><p id="r-592636" data-claire-element-id="592636">Et voilà, les sources du paquet sont patchées !</p><p id="r-592637" data-claire-element-id="592637">Et voilà, vous pouvez être fier car vous avez découvert le dur boulot de mainteneur. :)</p><p id="r-592638" data-claire-element-id="592638">Perkele</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux">Création de paquets avec ArchLinux</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/pkgbuild-ou-la-base-du-paquet">
PKGBUILD ou la base du paquet
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/la-fonction-build">
La fonction build()
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/creer-le-paquet-et-le-redistribuer">
Créer le paquet et le redistribuer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/les-fichiers-d-installation">
Les fichiers d&#039;installation
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/des-pkgbuild-plus-compliques">
Des PKGBUILD plus compliqués
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creation-de-paquets-avec-archlinux/les-fichiers-d-installation">
<span class="arrow"></span>
<span class="next">Les fichiers d&#039;installation</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/creation-de-paquets-avec-archlinux.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:50:09 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/creation-de-paquets-avec-archlinux.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:37:18 GMT -->
</html>