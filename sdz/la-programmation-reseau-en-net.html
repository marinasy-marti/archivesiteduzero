<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/la-programmation-reseau-en-net.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 19:58:10 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/la-programmation-reseau-en-net.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:43:16 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : La programmation réseau en .NET</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/la-programmation-reseau-en-net.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : La programmation réseau en .NET</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Laprogrammationrseauen.NET">La programmation réseau en .NET</a><br/><a href="#Lesdelegates">Les delegates</a><br/><a href="#Lesdelegatesunerfrenceenlamatire">Les delegates, une référence en la matière !</a><br/><a href="#Lesdelegatesgnriques">Les delegates génériques</a><br/><a href="#Lesmthodesanonymes">Les méthodes anonymes</a><br/><a href="#Lemulti-tche">Le multi-tâche</a><br/><a href="#Lesthreads">Les threads</a><br/><a href="#Lesmcanismesdesynchronisation">Les mécanismes de synchronisation</a><br/><a href="#LemultithreadingenWindowsForms">Le multithreading en Windows Forms</a><br/><a href="#Etlesdelegatesdanstouta">Et les delegates dans tout ça ?</a><br/><a href="#Lecasclassique">Le cas classique</a><br/><a href="#LesBackgroundWorkers">Les BackgroundWorkers</a><br/><a href="#TravailPratique">Travail Pratique</a><br/><a href="#Laproblmatique">La problématique</a><br/><a href="#Solutionlapartie1">Solution à la partie 1</a><br/><a href="#Lasuite">La suite</a><br/><a href="#Solutionlapartie2">Solution à la partie 2</a><br/><a href="#Lathoriededpart">La théorie de départ</a><br/><a href="#Organisationdesrseaux">Organisation des réseaux</a><br/><a href="#LeprotocoleUDP">Le protocole UDP</a><br/><a href="#Lestypesdecommunication">Les types de communication</a><br/><a href="#Lesoutils">Les outils</a><br/><a href="#Premirecommunication">Première communication</a><br/><a href="#Leclient">Le client</a><br/><a href="#Leserveur">Le serveur</a><br/><a href="#TravailPratiquemini-chat">Travail Pratique : mini-chat</a><br/><a href="#Dfinitionduclient">Définition du client</a><br/><a href="#Dfinitionduserveur">Définition du serveur</a><br/><a href="#Correction">Correction</a><br/><a href="#Lasrialisationdesobjets">La sérialisation des objets</a><br/><a href="#Introductionlasrialisation">Introduction à la sérialisation</a><br/><a href="#SrialisationenXML">Sérialisation en XML</a><br/><a href="#Srialisationbinaire">Sérialisation binaire</a><br/></div>
<a name="Laprogrammationrseauen.NET"></a><h2>La programmation réseau en .NET</h2><div class="content" role="article">
<p id="r-378429" data-claire-element-id="378429">C'est le rêve ultime de tout programmeur débutant. Du moins, c'était le mien : La programmation en réseau. Aujourd'hui, même si je suis plus expérimenté, je dois avouer que j'aime encore l'idée de programmer en réseau. Je désire maintenant vous enseigner comment faire afin d'arriver à vos buts. Vous allez voir, il y a énormément d'étapes avant d'y parvenir. Certaines de ces étapes nécessitent la compréhension de concepts plus poussés comme les <em>delegates</em>, les <em>interfaces</em> et les <em>threads</em>. Je me suis donc donné comme mission de démystifier ces concepts pour vous.</p><p id="r-378430" data-claire-element-id="378430">Avant de commencer, j'aimerais vous avertir de quelques points :</p><aside id="r-378440" data-claire-element-id="378440" data-claire-semantic="warning"><ul id="r-378439" data-claire-element-id="378439"><li id="r-378432" data-claire-element-id="378432"><p id="r-378431" data-claire-element-id="378431">J'utiliserai le C# afin de vous montrer comment faire. Cependant, le principe reste le même en VB.NET. Vous pouvez même réutiliser beaucoup de ces concepts en Java !</p></li><li id="r-378434" data-claire-element-id="378434"><p id="r-378433" data-claire-element-id="378433">Je commencerai aussi doucement que possible, mais il est nécessaire de posséder une bonne connaissance du .NET (C# ou VB.NET) afin de pouvoir suivre plus aisément.</p></li><li id="r-378436" data-claire-element-id="378436"><p id="r-378435" data-claire-element-id="378435">Si vous ne comprenez pas certains concepts, n'hésitez pas à relire le chapitre en entier. Si ça ne débloque toujours pas, utilisez le forum. Beaucoup de Zéros sont bien placés pour vous répondre.</p></li><li id="r-378438" data-claire-element-id="378438"><p id="r-378437" data-claire-element-id="378437">N'oubliez pas de commenter le tutoriel si vous l'aimez ou si vous avez des pistes d'amélioration. ;)</p></li></ul></aside><p id="r-378441" data-claire-element-id="378441"><strong>Allez hop ! Nous voilà partis !</strong></p>
</div>
<div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1358423835269-0" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1358423835269-0');
        });
    }
    </script>
</div><a name="Lesdelegates"></a><h2>Les delegates</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
<span class="next">Les delegates, une référence en la matière !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-378443" data-claire-element-id="378443">Nous allons aborder la question des delegates. À ce stade-ci, votre code pourrait devenir un peu mêlant au début. Cependant, avec un peu d'expérience, on arrive à bien distinguer le tout. Si vous avez déjà programmé avec certains langages fondamentalement anonymes (Javascript est un bon exemple avec jQuery), vous comprendrez probablement plus rapidement.</p><p id="r-378444" data-claire-element-id="378444">Sans plus tarder, commençons par voir une petite description de ce qu'est exactement un <strong>delegate </strong>(anglais) ou <strong>délégué </strong>(français).</p>
</div><a name="Lesdelegatesunerfrenceenlamatire"></a><h2>Les delegates, une référence en la matière !</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">
<span class="arrow"></span>
<span class="next">Les delegates</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
<span class="next">Les delegates génériques</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-delegates-une-reference-en-la-matiere" data-claire-element-id="378492">Les delegates, une référence en la matière !</h4><h5 id="r-petite-introduction" data-claire-element-id="378450">Petite introduction</h5><h6 id="r-qu-est-ce-qu-un-delegate" data-claire-element-id="378449">Qu'est-ce qu'un delegate ?</h6><p id="r-378445" data-claire-element-id="378445">Un delegate est un concept abstrait du C#. Jusqu'à maintenant, une variable pouvait contenir de nombreuses choses. On traite, par exemple, les objets comme des variables. Elles permettent aussi de mettre en mémoire des données, comme du texte, des nombres entiers ou flottants, des booléens. Ces cas ne sont que des exemples.</p><p id="r-378446" data-claire-element-id="378446">Un delegate est en fait une variable un peu spéciale... Elle donne plutôt une référence vers une <strong>méthode</strong>. Ce type de variable est donc de type référence, comme un objet normal.</p><p id="r-378447" data-claire-element-id="378447">L'utilité sera bien évidemment d'envoyer ces delegates en paramètres ! Comment peut-on réussir à mettre une méthode dans une variable ? Rien de plus simple. Comme tout objet, une méthode est chargée en mémoire et possède donc une adresse mémoire. Par le même principe qui nous permet de référencer un objet à l'aide d'une variable, nous allons pouvoir référencer une méthode.</p><p id="r-378448" data-claire-element-id="378448">Si vous avez déjà fait de la programmation en C# autre qu'avec la Console, vous avez très probablement utilisé des delegates sans même vous en rendre compte. Pensez aux événements dans Windows Forms, ASP.NET ou WPF. Tout cela fonctionne à base de delegate.</p><h5 id="r-partis-pour-la-gloire" data-claire-element-id="378491">Partis pour la gloire !</h5><p id="r-378451" data-claire-element-id="378451">Je vais commencer par vous donner un exemple bien simple, un cas &quot;facile&quot;.</p><pre id="r-378452" data-claire-element-id="378452"><code data-claire-semantic="csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace TestThread
{
    class Program
    {
        static void Main(string[] args)
        {
            bool resultat = Test(&quot;Ceci est un test qui est négatif !&quot;);
            bool res2 = Test(&quot;Positif&quot;);
        }

        static public bool Test(string test)
        {
            return test.Length &lt; 15;
        }
    }
}</code></pre><p id="r-378453" data-claire-element-id="378453">On voit clairement une situation très usuelle ici. Vous appelez <strong>Test</strong> deux fois à partir du <strong>Main</strong>. Ce qui se passera, c'est que lorsque viendra le temps d'exécuter ce code, .NET lancera la méthode <strong>Test</strong> afin de donner un résultat à la variable <em>resultat</em>. On fait alors un appel de la méthode.</p><p id="r-378454" data-claire-element-id="378454">Je vais immédiatement déclarer un delegate pour la même situation, comme ça, vous verrez de quoi il en retourne.</p><pre id="r-378455" data-claire-element-id="378455"><code data-claire-semantic="csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace TestThread
{
    class Program
    {
        //Mon delegate aura exactement la même signature que ma méthode !
        delegate bool PremierDelegate(string i);

        static void Main(string[] args)
        {
            //Je crée une variable a qui contiendra la méthode Test.
            PremierDelegate a = new PremierDelegate(Test);

            //Au lieu d'appeler Test, je vais appeler a, ce qui me donnera le
            //même résultat !
            bool resultat = a(&quot;Ceci est un test qui est négatif !&quot;);
            bool res2 = a(&quot;Positif&quot;);
        }

        static public bool Test(string test)
        {
            return test.Length &lt; 15;
        }
    }
}</code></pre><p id="r-378456" data-claire-element-id="378456">Bon, dans cet exemple, l'utilisation d'un delegate est carrément inutile, mais ils deviendront rapidement indispensables, surtout lors de la programmation réseau.</p><p id="r-378457" data-claire-element-id="378457">Une autre utilisation très fréquente des <em>delegates</em> est la <strong>gestion des événements</strong> ! Quand vous vous abonnez à un <em>événement</em>, vous abonnez tout simplement une méthode à une liste d'appel. Quand l’évènement se déclenche, on avertis donc tous les abonnés de ce qui s'est passé à l'aide de ce mécanisme.Si vous voulez plus d'informations, veuillez visiter le site de <a href="http://msdn.microsoft.com/fr-fr/library/system.eventargs(v=VS.80).aspx">MSDN</a>.</p><aside id="r-378459" data-claire-element-id="378459" data-claire-semantic="information"><p id="r-378458" data-claire-element-id="378458">Dans cet exemple, je me réfère au concept de signature d'une méthode. Je vais prendre quelques minutes pour vous expliquer.</p></aside><h6 id="r-les-signatures-de-methodes" data-claire-element-id="378478">Les signatures de méthodes</h6><p id="r-378460" data-claire-element-id="378460">Toute méthode possède une signature. Une signature de méthode, comme dans le monde réel, sert à identifier une méthode de façon plus ou moins unique. Si vous avez déjà fait de la programmation, peut-être avez-vous déjà vu ce concept.</p><p id="r-378461" data-claire-element-id="378461">La signature de méthode résout le problème des noms uniques dans le cas de surcharge d'une méthode. Dans les langages autorisant la surcharge de méthode, on se réfère à la signature plutôt qu'au nom de la méthode pour l'appeler. Pour chaque méthode surchargée doit correspondre une signature différente des autres méthodes portant le même nom.</p><p id="r-378462" data-claire-element-id="378462">Donc, la signature d'une méthode contient les informations suivantes :</p><ul id="r-378467" data-claire-element-id="378467"><li id="r-378464" data-claire-element-id="378464"><p id="r-378463" data-claire-element-id="378463">L'identifiant de la méthode.</p></li><li id="r-378466" data-claire-element-id="378466"><p id="r-378465" data-claire-element-id="378465">La séquence des types des paramètres, sans leur nom.</p></li></ul><p id="r-378468" data-claire-element-id="378468">Notre méthode <code data-claire-semantic="csharp">static public int Test(string test)</code> a donc la signature suivante : <code data-claire-semantic="csharp">Test(string);</code></p><aside id="r-378470" data-claire-element-id="378470" data-claire-semantic="warning"><p id="r-378469" data-claire-element-id="378469">Le type de retour ne fait pas partie de la signature ! En effet, ce qui est important de retenir est le <strong>nom de la méthode</strong> et <strong>l'ordre des paramètres</strong>.</p></aside><aside id="r-378472" data-claire-element-id="378472" data-claire-semantic="warning"><p id="r-378471" data-claire-element-id="378471">Cette définition de signature des méthodes n'est valide qu'en C#. D'autres langages pourraient avoir d'autres règles. Attention donc à ne pas généraliser ces règles. Informez-vous avant.</p></aside><p id="r-378473" data-claire-element-id="378473">La <em><strong>définition</strong></em> d'un delegate est un peu différente. Le nom de la méthode et des paramètres sont inutiles. Ce qui compte ce sont le type de retour et l'ordre des paramètres selon leur type (pas leur nom). Ainsi, un delegate ne pourra référer qu'une méthode possédant la même <em><strong>définition</strong></em>. C'est un peu abstrait sans exemple, alors voici un petit exemple.</p><p id="r-378474" data-claire-element-id="378474">Considérant la méthode suivante :</p><pre id="r-378475" data-claire-element-id="378475"><code data-claire-semantic="csharp">public string ObtientNomComplet(string prenom, string nom)
{
    return String.Format(&quot;{0} {1}&quot;, prenom, nom);
}</code></pre><p id="r-378476" data-claire-element-id="378476">Nous allons pouvoir faire référence à elle par le biais d'un delegate. Nous devrons cependant respecter sa <em><strong>définition</strong></em>, comme nous l'avons vu. Ainsi, nous devrons faire attention à indiquer exactement le même type de retour et le même ordre des paramètres (indépendamment de leur nom). Le delegate suivant respecte ces règles :</p><pre id="r-378477" data-claire-element-id="378477"><code data-claire-semantic="csharp">delegate string Methode(string a, string b);</code></pre><h6 id="r-l-autopsie-d-un-delegate" data-claire-element-id="378490">L'autopsie d'un delegate !</h6><p id="r-378479" data-claire-element-id="378479">Analysons maintenant comment créer ce fameux <em>delegate</em>. Voici la composition d'un delegate standard.</p><p id="r-378480" data-claire-element-id="378480">[Attribut][Modificateur d'accès]delegatetypeRetourNomDuDelegate (paramètres)</p><aside id="r-378482" data-claire-element-id="378482" data-claire-semantic="information"><p id="r-378481" data-claire-element-id="378481">Les arguments entourés de crochets sont optionnels. Un <strong>attribut</strong>, par exemple, sert à injecter des <em>meta-données </em>récupérables à l'exécution du programme. Nous verrons cela plus tard avec la sérialisation. Les <strong>modificateurs d'accès</strong>, quant à eux, sont une notion qui devrait vous être connue. Il s'agit de modifier l'accès à l'aide des mots clés <strong>public</strong>, <strong>private</strong>, <strong>protected</strong>, <strong>internal</strong>, etc.</p></aside><p id="r-378483" data-claire-element-id="378483">Voici un exemple. Passez votre curseur sur les arguments afin de mieux comprendre leur rôle :<br/>delegateintCalcul(int i1, int i2);</p><aside id="r-378485" data-claire-element-id="378485" data-claire-semantic="error"><p id="r-378484" data-claire-element-id="378484">Il faut absolument déclarer le type de delegate dans l'espace global de la classe (c'est-à-dire là où l'on déclare les variables globales de la classe). Si vous tentez de le faire à l'intérieur d'une méthode, le compilateur comprendra que vous tentez de créer une méthode anonyme. Nous n'en sommes pas rendu là pour l'instant.</p></aside><p id="r-378486" data-claire-element-id="378486">Ensuite, on utilise le <em>delegate</em> comme un type. On peut donc créer des objets avec le nom de ce type. On peut alors l'utiliser en tant que <strong>paramètre</strong>. Ce sera plus clair pour vous avec l'exemple qui suit :</p><pre id="r-378487" data-claire-element-id="378487"><code data-claire-semantic="csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace TestThread
{
    class Program
    {

        delegate int Calcul(int i1, int i2);

        static void Main(string[] args)
        {
            //Affichage de la console.
            Console.WriteLine(&quot;Test de delegate&quot;);
            Console.WriteLine(&quot;----------------------&quot;);

            //On passe à la méthode Afficher la méthode à lancer et les arguments.
            Afficher(Add, 25, 19);
            Afficher(Sub, 52, 17);
            Afficher(Mul, 10, 12);
            Afficher(Div, 325, 5);
            
            //On ne ferme pas la console immédiatement.
            Console.ReadKey();
        }
           
        //On fait une méthode générale qui prendra un delegate Calcul en paramètre.
        static void Afficher(Calcul methodeCalcul, int i, int j)
        {
            Console.WriteLine(&quot;{0} {1} {2} = {3}&quot;, i, methodeCalcul.Method.Name,
                j, methodeCalcul(i, j));
        }

        //Méthodes très simples qui ont toutes un type de retour et des paramètres identiques.
        static int Add(int i, int j) { return i + j; }
        static int Sub(int i, int j) { return i - j; }
        static int Mul(int i, int j) { return i * j; }
        static int Div(int i, int j) { return i / j; }
    }
}</code></pre><p id="r-378488" data-claire-element-id="378488">Ce n’est pas du chinois, mais ce n’est pas simple, hein ? En effet, ça arrache une grimace la première fois qu'on voit ça, mais en fait, c'est très simple. Comme toutes nos méthodes répondent à la même <em><strong>définition</strong></em> que notre <em>delegate</em><strong>Calcul</strong>, nous sommes en mesure de toutes les utiliser en envoyant leur adresse mémoire en tant que paramètre. C'est un peu comme dire qu'un <em>int</em> peut égaler 0 ou bien 12154, car les deux répondent à la même définition, soit être un entier entre <strong>int.Min</strong> et <strong>int.Max</strong>. Cela est vrai car tous les nombres entiers qui répondent à ces exigences sont des <em>int</em>. Dans ce cas-ci, toutes les méthodes qui respectent la définition de <strong>Calcul </strong>peuvent être considérées de type délégué <strong>Calcul</strong>.</p><p id="r-378489" data-claire-element-id="378489">Ce code, bien que simple, est très puissant. Si je voulais ajouter l'opération modulo, il serait TRÈS TRÈS simple de le faire, vous ne trouvez pas ? Certains critiquent pourraient reprocher l'utilisation d'un delegate dans ce cas-ci et j'approuverais leurs critiques. Il serait probablement mieux d'utiliser un concept orienté-objet basé sur du polymorphisme afin de résoudre ce problème. Cependant, il ne s'agit que d'un exemple. Libres à vous d'utiliser la méthode qui vous plaît le plus par la suite.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">
<span class="arrow"></span>
<span class="next">Les delegates</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
<span class="next">Les delegates génériques</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesdelegatesgnriques"></a><h2>Les delegates génériques</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
<span class="arrow"></span>
<span class="next">Les delegates, une référence en la matière !</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
<span class="next">Les méthodes anonymes</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-delegates-generiques" data-claire-element-id="378523">Les delegates génériques</h4><p id="r-378493" data-claire-element-id="378493">Depuis la version 2.0 de .NET, il existe des delegates génériques qui permettent de faire à peu près tout ce dont on a besoin sans même avoir à se salir les mains à faire le travail douloureux (soit définir un type delegate). Ils viennent en deux variétés et peuvent couvrir la plupart des scénarios communs. <code data-claire-semantic="csharp">Func&lt;T, TResult&gt;</code> et <code data-claire-semantic="csharp">Action&lt;T&gt;</code> seront maintenant vos nouveaux amis. :D À eux deux, ils sauront probablement convenir à tous vos besoins en matière de delegate !</p><p id="r-378494" data-claire-element-id="378494">Regardons-les de plus près. À ce stade, vous devriez avoir vu les génériques et avoir compris leur fonctionnement.</p><aside id="r-378496" data-claire-element-id="378496" data-claire-semantic="information"><p id="r-378495" data-claire-element-id="378495">Ce deux types de delegate sont très utilisés, notamment lors des requêtes LINQ et des méthodes lambda. Si vous avez déjà utilisé ces technologies, vous comprenez d'ore et déjà leur importance. Nous ne couvrirons pas ces types de requêtes dans ce tutoriel, cependant, je vous invite fortement à vous informer sur leur utilisation en consultant la documentation MSDN.</p></aside><h5 id="r-le-delegate-action-t" data-claire-element-id="378502">Le delegate Action&lt;T&gt;</h5><p id="r-378497" data-claire-element-id="378497">Action est un delegate de base qui prend un paramètre de type T et qui ne renvoie rien (<code data-claire-semantic="csharp">void</code>). D'ailleurs, voici sa syntaxe :</p><pre id="r-378498" data-claire-element-id="378498"><code data-claire-semantic="csharp">public delegate void Action&lt;in T&gt;(T obj)</code></pre><p id="r-378499" data-claire-element-id="378499">Cela revient à créer un delegate comme suit :</p><pre id="r-378500" data-claire-element-id="378500"><code data-claire-semantic="csharp">delegate void Action(Object obj);</code></pre><p id="r-378501" data-claire-element-id="378501">Sauf que dans ce cas, on profite des génériques, ce qui nous permet d'éviter les erreurs de transtypage.</p><h5 id="r-le-delegate-func-t-tresult" data-claire-element-id="378505">Le delegate Func&lt;T, TResult&gt;</h5><p id="r-378503" data-claire-element-id="378503">Func est un delegate qui se révèle bien utile dans le cas où l'on veut se référer à une méthode qui prend des paramètres de type T (à définir) et qui retourne un résultat de type TResult (encore une fois, un générique). La signature de Func va comme suit :</p><pre id="r-378504" data-claire-element-id="378504"><code data-claire-semantic="csharp">public delegate TResult Func&lt;T, TResult&gt;(T arg)</code></pre><h5 id="r-et-alors" data-claire-element-id="378518">Et alors ?</h5><div id="r-378507" data-claire-element-id="378507" data-claire-semantic="question"><p id="r-378506" data-claire-element-id="378506">Et si ces cas ne sont pas suffisants ? Si vous devez passer plusieurs paramètres à la méthode ? Devrez-vous créer votre propre <em>delegate </em>?</p></div><p id="r-378508" data-claire-element-id="378508">Non, ne vous inquiétez pas. Microsoft a pensé à vous et a créé des delegates diversifiés qui sauront répondre à vos besoins. Voici l'exemple le plus simple, soit une méthode ne prenant pas de paramètres et ne retournant rien.</p><pre id="r-378509" data-claire-element-id="378509"><code data-claire-semantic="csharp">public delegate void Action()</code></pre><p id="r-378510" data-claire-element-id="378510">Bien évidemment, des signatures plus étoffées sont disponibles. Dans cet exemple, on peut aller jusqu'à 16 paramètres.</p><pre id="r-378511" data-claire-element-id="378511"><code data-claire-semantic="csharp">public delegate void Action&lt;in T1, in T2, in T3, in T4, in T5, in T6, in T7, in T8, in T9, in T10, in T11, in T12, in T13, in T14, in T15, in T16&gt;(
	T1 arg1,
	T2 arg2,
	T3 arg3,
	T4 arg4,
	T5 arg5,
	T6 arg6,
	T7 arg7,
	T8 arg8,
	T9 arg9,
	T10 arg10,
	T11 arg11,
	T12 arg12,
	T13 arg13,
	T14 arg14,
	T15 arg15,
	T16 arg16
)</code></pre><p id="r-378512" data-claire-element-id="378512">On retrouve la même situation avec Func.</p><p id="r-378513" data-claire-element-id="378513">Voici la signature la plus simple, soit une méthode retournant un résultat de type TResult et ne prenant pas de paramètres.</p><pre id="r-378514" data-claire-element-id="378514"><code data-claire-semantic="csharp">public delegate TResult Func&lt;out TResult&gt;()</code></pre><p id="r-378515" data-claire-element-id="378515">Et voilà la plus complexe, soit 16 paramètres de type Tx et un résultat de type TResult.</p><pre id="r-378516" data-claire-element-id="378516"><code data-claire-semantic="csharp">public delegate TResult Func&lt;in T1, in T2, in T3, in T4, in T5, in T6, in T7, in T8, in T9, in T10, in T11, in T12, in T13, in T14, in T15, in T16, out TResult&gt;(
	T1 arg1,
	T2 arg2,
	T3 arg3,
	T4 arg4,
	T5 arg5,
	T6 arg6,
	T7 arg7,
	T8 arg8,
	T9 arg9,
	T10 arg10,
	T11 arg11,
	T12 arg12,
	T13 arg13,
	T14 arg14,
	T15 arg15,
	T16 arg16
)</code></pre><p id="r-378517" data-claire-element-id="378517">Par contre, après ces 16 paramètres, à vous de créer votre propre delegate. Cependant, cela devrait être un cas rare.</p><h5 id="r-un-petit-exemple-4" data-claire-element-id="378522">Un petit exemple</h5><p id="r-378519" data-claire-element-id="378519">Je vais simplement reprendre l'exemple des opérations arithmétiques pour vous montrer comment on va simplifier en utilisant des delegates génériques.</p><pre id="r-378520" data-claire-element-id="378520"><code data-claire-semantic="csharp">using System;

namespace ExempleGeneriques
{
    internal class Program
    {
        //Plus besoin de définir le delegate de type Calcul.

        private static void Main(string[] args)
        {
            //Affichage de la console.
            Console.WriteLine(&quot;Test de delegate&quot;);
            Console.WriteLine(&quot;----------------------&quot;);

            //On passe à la méthode Afficher la méthode à lancer et les arguments.
            Afficher(Add, 25, 19);
            Afficher(Sub, 52, 17);
            Afficher(Mul, 10, 12);
            Afficher(Div, 325, 5);

            //On ne ferme pas la console immédiatement.
            Console.ReadKey();
        }

        //On fait une méthode générale qui prendra le delegate en paramètre.
        private static void Afficher(Func&lt;int, int, int&gt; calcul, int i, int j)
        {
            Console.WriteLine(&quot;{0} {1} {2} = {3}&quot;, i, calcul.Method.Name,
                j, calcul(i, j));
        }

        //Méthodes très simples qui ont toutes un type de retour et des paramètres identiques.
        private static int Add(int i, int j) { return i + j; }

        private static int Sub(int i, int j) { return i - j; }

        private static int Mul(int i, int j) { return i * j; }

        private static int Div(int i, int j) { return i / j; }
    }
}</code></pre><p id="r-378521" data-claire-element-id="378521">Et voilà, on a pu se débarrasser de notre propre delegate Calcul au profit de Func qui répond parfaitement à nos besoins ! N'est-ce pas merveilleux ?</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
<span class="arrow"></span>
<span class="next">Les delegates, une référence en la matière !</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
<span class="next">Les méthodes anonymes</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesmthodesanonymes"></a><h2>Les méthodes anonymes</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
<span class="arrow"></span>
<span class="next">Les delegates génériques</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">
<span class="next">Le multi-tâche</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-methodes-anonymes" data-claire-element-id="378575">Les méthodes anonymes</h4><p id="r-378524" data-claire-element-id="378524">Si vous avez fait un peu de Javascript, et en particulier du jQuery, vous comprenez déjà l'avantage des méthodes anonymes. Si vous provenez de Java et que vous avez fait du Swing, vous avez probablement déjà vu ce concept, mais à l'aide des classes anonymes.</p><p id="r-378525" data-claire-element-id="378525">On utilise les méthodes anonymes pour de petites actions qui ne se reproduisent pas à plus d'un endroit. Leur utilisation permet généralement d'alléger la syntaxe d'une classe. Nous allons voir immédiatement un exemple et vous comprendrez ce que je veux dire. Nous allons réintroduire l'exemple des méthodes de calcul.</p><pre id="r-378526" data-claire-element-id="378526"><code data-claire-semantic="csharp">public class Program
{
    private static void Main(string[] args)
    {
        //Affichage de la console.
        Console.WriteLine(&quot;Test de méthodes anonymes&quot;);
        Console.Title = &quot;Méthode anonymes&quot;;
        Console.WriteLine(&quot;----------------------&quot;);

        //Création d'un delegate avec une méthode anonyme. Dans ce cas, on pourra réappeler la méthode
        //tant et aussi longtemps que le delegate additionner sera dans la portée de la méthode.
        Func&lt;int, int, int&gt; additionner = new Func&lt;int, int, int&gt;(delegate(int i, int j) { return i + j; });

        //Forme allégée, mais tout aussi efficace. Attention à bien respecter la signature du delegate.
        Func&lt;int, int, int&gt; soustraire = (delegate(int i, int j) { return i - j; });

        //On passe à la méthode Afficher le delegate à éxécuter et les arguments.
        Afficher(additionner, 25, 19);
        Afficher(soustraire, 52, 17);

        //On peut définir la méthode anonyme à utiliser &quot;in-line&quot;. Attention, après l'éxécution de cette
        //ligne, on perd la référence mémoire à cette méthode.
        Afficher(new Func&lt;int, int, int&gt;(delegate(int i, int j) { return i * j; }), 10, 12);

        //On peut aussi également utiliser la syntaxe simplifiée si la signature respecte
        //les requis de Func&lt;int, int, int&gt;.
        Afficher((delegate(int i, int j) { return i / j; }), 325, 5);

        //On ne ferme pas la console immédiatement.
        Console.ReadKey();
    }

    //On fait une méthode générale qui prendra le delegate en paramètre.
    private static void Afficher(Func&lt;int, int, int&gt; calcul, int i, int j)
    {
        Console.WriteLine(&quot;{0} {1} {2} = {3}&quot;, i, calcul.Method.Name,
            j, calcul(i, j));
    }

    //Plus besoin de déclarer les méthodes de calcul.
}</code></pre><p id="r-378527" data-claire-element-id="378527">Et voilà, on a fait un peu de ménage dans la classe Program. Voici d'ailleurs le résultat dans la console.</p><figure id="r-resultat-des-calculs-avec-les-methodes-anonymes" data-claire-element-id="378530"><img id="r-378528" data-claire-element-id="378528" src="medias/uploads.siteduzero.com_files_405001_406000_405085.png" alt="Résultat des calculs avec les méthodes anonymes."/><figcaption>Résultat des calculs avec les méthodes anonymes.</figcaption></figure><p id="r-378531" data-claire-element-id="378531">Oops, vous voyez que l'on a perdu le nom des méthodes entre les chiffres. Cela est normal et indique que le compilateur a bien fait son travail. Puisqu'une méthode anonyme est justement anonyme, il n'y a aucun besoin pour nous de connaître son nom. Nous désirons simplement avoir son adresse en mémoire. Ce nom est le résultat de la compilation de votre code en MSIL. Pendant cette phase, le compilateur reconnaît les méthodes anonymes dans votre code et les crée à l'intérieur de la classe où réside votre méthode hôte. Au final, cela revient au même pour le compilateur. Cependant, pour nous, cela devient plus simple.</p><aside id="r-378533" data-claire-element-id="378533" data-claire-semantic="warning"><p id="r-378532" data-claire-element-id="378532">Nous voyons bien ici que les méthodes anonymes possèdent un nom. Il est cependant impossible de les appeler comme des méthodes normales. Tout essaie se résoudra par un échec de la compilation. Le seul moyen (efficace) reste de les appeler par le delegate. Une fois le delegate hors de portée, il ne sera plus possible d'appeler la méthode anonyme.</p></aside><h5 id="r-logique-des-methodes-anonymes" data-claire-element-id="378553">Logique des méthodes anonymes</h5><p id="r-378534" data-claire-element-id="378534">Comme vous avez pu voir, les méthodes anonymes s'apparentent à des méthodes normales. L'exception est qu'elles sont déclarées à l'intérieur d'une méthode, qu'elles ne possèdent pas de nom, mais bien le mot-clef <em><strong>delegate</strong></em> et que le type de retour est déduit par le compilateur. Pour les rendre utilisables, il faut immédiatement les affecter à un delegate qui possède la même <strong>définition</strong>. Dans l'exemple précédent, le type <code data-claire-semantic="csharp">Func&lt;int, int, int&gt;</code> était le bon. Le delegate <strong>Calcul</strong> dont nous nous sommes débarassés aurait très bien fonctionné lui aussi.</p><p id="r-378535" data-claire-element-id="378535">Bref, voici les quelques règles à respecter :</p><ul id="r-378548" data-claire-element-id="378548"><li id="r-378537" data-claire-element-id="378537"><p id="r-378536" data-claire-element-id="378536">Les méthodes anonymes ne possèdent pas de nom. On utilise plutôt le mot-clef <em><strong>delegate</strong></em> (ne pas utiliser une majuscule ici, car ce n'est pas la même chose).</p></li><li id="r-378539" data-claire-element-id="378539"><p id="r-378538" data-claire-element-id="378538">Les méthodes anonymes ne déclarent pas de type de retour. Il est déduit par le compilateur.</p></li><li id="r-378541" data-claire-element-id="378541"><p id="r-378540" data-claire-element-id="378540">Lors de leur création, le compilateur affecte un nom à la méthode et la place dans la classe hôte.</p></li><li id="r-378543" data-claire-element-id="378543"><p id="r-378542" data-claire-element-id="378542">Il est impossible d'appeler la méthode autrement que par un delegate qui détient son adresse en mémoire.</p></li><li id="r-378545" data-claire-element-id="378545"><p id="r-378544" data-claire-element-id="378544">Il est important d'affecter la méthode anonyme à un delegate afin de pouvoir l'appeler par la suite (soit dans une variable, soit dans un paramètre directement).</p></li><li id="r-378547" data-claire-element-id="378547"><p id="r-378546" data-claire-element-id="378546">Les méthodes anonymes se plient aux règles des méthodes standards pour ce qui est de la signature des méthodes et de leurs définitions.</p></li></ul><aside id="r-378550" data-claire-element-id="378550" data-claire-semantic="information"><p id="r-378549" data-claire-element-id="378549">La portée des variables est un peu bizarre dans les méthodes anonymes. Si les variables déclarées à l'intérieur du bloc d'instructions de la méthode anonyme ne peuvent en sortir, celles qui sont définies dans la méthode hôte peuvent être utilisées dans la méthode anonyme. L'exemple suivant en fait foi.</p></aside><pre id="r-378551" data-claire-element-id="378551"><code data-claire-semantic="csharp">public class Program
{
    private static void Main(string[] args)
    {
        //Affichage de la console.
        Console.WriteLine(&quot;Test de méthodes anonymes&quot;);
        Console.Title = &quot;Méthode anonymes&quot;;
        Console.WriteLine(&quot;----------------------&quot;);

        int i = 13;
        int j = 42;

        Func&lt;int&gt; additionner = delegate() { return i + j; };

        //L'utilisation de la méthode Invoke est optionnelle.
        Console.WriteLine(additionner.Invoke());

        //On ne ferme pas la console immédiatement.
        Console.ReadKey();
    }
}</code></pre><p id="r-378552" data-claire-element-id="378552">Le code précédent produit bel et bien le résultat désiré. Cependant, ce genre d'architecture est à éviter autant que possible, car il devient rapidement mélangeant.</p><h5 id="r-cas-concret-d-utilisation-des-methodes-anonymes" data-claire-element-id="378556">Cas concret d'utilisation des méthodes anonymes</h5><pre id="r-378554" data-claire-element-id="378554"><code data-claire-semantic="csharp">public class Personne
{
    public string Nom { get; set; }
    public string Prenom { get; set; }
    public int Age { get; set; }

    public override string ToString()
    {
        return string.Format(&quot;{0} {1} - {2} ans&quot;, Prenom, Nom, Age);
    }
}

public class Program
{
    static void Main(string[] args)
    {
        //Création d'une liste de personnes.
        List&lt;Personne&gt; liste = new List&lt;Personne&gt;() {
            new Personne() { Nom = &quot;Smith&quot;, Prenom=&quot;John&quot;, Age=39 },
            new Personne() { Nom=&quot;West&quot;, Prenom=&quot;Adam&quot;, Age=26 },
            new Personne() { Nom=&quot;Lebeau&quot;, Prenom=&quot;Ginette&quot;, Age=58 },
            new Personne() { Nom=&quot;Lajeunesse&quot;, Prenom=&quot;Émilie&quot;, Age=16}
        };

        //On trie la liste en lui spécifiant comment le faire (delegate Comparison).
        liste.Sort(delegate(Personne p1, Personne p2)
        {
            return p1.Age - p2.Age;
        });

        //Pour chaque personne dans la liste, on l'affiche dans la console.
        liste.ForEach(delegate(Personne p) { Console.WriteLine(p); });
        Console.ReadKey();
    }
}</code></pre><p id="r-378555" data-claire-element-id="378555">Et voilà une situation concrète où on utilise des méthodes anonymes pour éviter d’alourdir le code.</p><h5 id="r-en-resume-461" data-claire-element-id="378574">En résumé...</h5><ul id="r-378571" data-claire-element-id="378571"><li id="r-378558" data-claire-element-id="378558"><p id="r-378557" data-claire-element-id="378557">Les delegates sont des références vers des méthodes.</p></li><li id="r-378560" data-claire-element-id="378560"><p id="r-378559" data-claire-element-id="378559">On peut les invoquer exactement comme des méthodes normales.</p></li><li id="r-378562" data-claire-element-id="378562"><p id="r-378561" data-claire-element-id="378561">Pour qu'un delegate puisse référer une méthode, il faut qu'ils aient la même définition et vice-versa.</p></li><li id="r-378564" data-claire-element-id="378564"><p id="r-378563" data-claire-element-id="378563">Il existe des delegates génériques (Action et Func) qui devraient permettre de couvrir la plupart des cas.</p></li><li id="r-378566" data-claire-element-id="378566"><p id="r-378565" data-claire-element-id="378565">Les méthodes anonymes permettent de créer des méthodes sans avoir à leur donner de nom.</p></li><li id="r-378568" data-claire-element-id="378568"><p id="r-378567" data-claire-element-id="378567">Les méthodes anonymes ne peuvent être invoquées que par les delegates qui détiennent une référence vers elles.</p></li><li id="r-378570" data-claire-element-id="378570"><p id="r-378569" data-claire-element-id="378569">Le Père Noël n'existe pas... :'(</p></li></ul><p id="r-378572" data-claire-element-id="378572">C'est terminé, je ne vous achale plus avec la théorie sur les <strong>delegates</strong>. Promis ! :p Cependant, rappelez-vous de ces règles, car elles nous seront très utiles, et ce, à partir du prochain chapitre. :waw: Eh bien oui, ça ne lâche jamais... Rendez-vous au prochain chapitre où nous verrons le <strong>multithreading </strong>en .NET.</p><p id="r-378573" data-claire-element-id="378573">** Les icônes proviennent du site suivant : <a href="http://icons8.com/">http://icons8.com/</a> **</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
<span class="arrow"></span>
<span class="next">Les delegates génériques</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">
<span class="next">Le multi-tâche</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lemulti-tche"></a><h2>Le multi-tâche</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
<span class="arrow"></span>
<span class="next">Les méthodes anonymes</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
<span class="next">Les threads</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-378577" data-claire-element-id="378577">Le multi-thread est aujourd'hui un concept des plus importants avec l'apparition des processeurs multi-coeurs il y a quelques années de cela. On se sert du <strong>multithreading </strong>notamment dans les traitements lourds, mais surtout dans les communications réseau et autres opération dites <em>synchrones </em>(ou bloquantes).</p><p id="r-378578" data-claire-element-id="378578">Seulement, l'utilisation des <strong>threads </strong>apporte son lot de complexité et de difficulté avec elle. Il faut, entre autres, penser à la gestion des accès concurrents, à la synchronisation des processus et j'en passe. Dans ce chapitre, je vous propose de jeter un oeil à ce que l'on peut faire en multi-thread avec .NET.</p>
</div><a name="Lesthreads"></a><h2>Les threads</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">
<span class="arrow"></span>
<span class="next">Le multi-tâche</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
<span class="next">Les mécanismes de synchronisation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-threads-2" data-claire-element-id="378641">Les threads</h4><h5 id="r-un-peu-d-histoire-13" data-claire-element-id="378586">Un peu d'histoire</h5><p id="r-378579" data-claire-element-id="378579">On parle beaucoup de threads ces temps-ci. Les processeurs des générations récentes sont des puces conçues afin d'optimiser le traitement des tâches en parallèle. Il y a quelques années de cela, à l'ère du Pentium 4, on ne cessait d'augmenter la fréquence d'horloge afin d'optimiser la vitesse d'un seul coeur. Chaque thread prenait donc un numéro et attendait son tour afin d'être traité par le processeur.</p><p id="r-378580" data-claire-element-id="378580">Ne vous méprenez pas, cela n'a pas vraiment changé, mais les processeurs ont commencé à traiter les threads simultanément; un peu comme on ouvre un deuxième comptoir caisse dans un magasin. Ce virage s'est amorcé avec la technologie HT sur les derniers Pentium 4, puis à l'aide de multiples coeurs avec les Core 2 Duo / Quad. Maintenant, dans les processeur de la génération Nehalem et plus haut (Intel Core i3, i5 et i7), il s'agit d'un mélange des deux, soit de multiples coeurs qui appliquent chacun une technologie HT.</p><div id="r-378582" data-claire-element-id="378582" data-claire-semantic="question"><p id="r-378581" data-claire-element-id="378581">Hé, mais moi j'ai un processeur AMD. Est-ce que je peux faire du multi-thread moi aussi ?</p></div><aside id="r-378584" data-claire-element-id="378584" data-claire-semantic="information"><p id="r-378583" data-claire-element-id="378583">Oui, absolument. Les principes dont j'ai parlé ici s'appliquent aussi bien aux processeurs Intel qu'aux processeurs AMD. Seulement, je suis moins à l'aise avec la marque AMD. ^^</p></aside><p id="r-378585" data-claire-element-id="378585">Cela explique un peu l'évolution de la technique de traitement des threads, mais je ne vous ai toujours pas expliqué comment fonctionne le multi-task en Windows.</p><h5 id="r-le-multi-task-en-windows" data-claire-element-id="378591">Le multi-task en Windows</h5><p id="r-378587" data-claire-element-id="378587">Un ordinateur, ça ne sait faire qu'une seule chose à la fois !</p><p id="r-378588" data-claire-element-id="378588">Windows, comme tout bon SE actuel se sert d'une méthode particulière afin de simuler un multi-task. La technique est bien simple, il s'agit de créer un système de jeton et de le passer à chaque processus pour un certain temps selon sa priorité.</p><p id="r-378589" data-claire-element-id="378589">En ce moment même, vous utilisez votre navigateur préféré pour visiter le site du Zéro, mais cela n'empêche pas votre ordinateur de vaquer à d'autres occupations. Par exemple, vous êtes peut-être en train de copier un fichier, ou même juste en train d'avoir 3 fenêtres ouvertes sur le Bureau en ce moment. Windows doit rafraîchir leur contenu à toutes les x millisecondes afin de créer un sentiment de fluidité chez l'utilisateur.</p><p id="r-378590" data-claire-element-id="378590">Donc, suivant cet exemple, Windows aura un jeton à accorder à votre navigateur web pour tant de temps, puis suspendra ses calculs et opérations et donnera le jeton à un autre traitement. Lorsqu'il reviendra au navigateur, celui-ci sera autorisé à continuer ses opérations. Comme ça, tout le monde est content, mais surtout l'utilisateur qui désire ouvrir Google Chrome en même temps que MSN et Word, ainsi que Visual Studio 2010. Ne riez pas, c'est pas mal le scénario actuel de mon PC en ce moment...</p><h5 id="r-les-threads-enfin" data-claire-element-id="378605">Les threads, enfin !</h5><p id="r-378592" data-claire-element-id="378592">Les threads sont des exécutions que l'on sépare de l'exécution principale pour les raisons suivantes :</p><ul id="r-378599" data-claire-element-id="378599"><li id="r-378594" data-claire-element-id="378594"><p id="r-378593" data-claire-element-id="378593">Tâches exigeantes (gros calculs, gros traitements, etc)</p></li><li id="r-378596" data-claire-element-id="378596"><p id="r-378595" data-claire-element-id="378595">Tâches détachées (impression, recherche, etc)</p></li><li id="r-378598" data-claire-element-id="378598"><p id="r-378597" data-claire-element-id="378597">Tâches bloquantes (ça sent le réseau ici ! :p )</p></li></ul><p id="r-378600" data-claire-element-id="378600">Créer un thread dans ces cas est utile afin de créer un certain parallélisme dans les exécutions.</p><aside id="r-378602" data-claire-element-id="378602" data-claire-semantic="warning"><p id="r-378601" data-claire-element-id="378601">Les threads rendent un code beaucoup plus complexe, non seulement à l'écriture, mais aussi au débogage ! Oh là là, que de frustration passées à programmer avec les threads. Cela dit, ils apportent énormément de puissance à une application ! Cette complexité vient du fait que le système de jeton est imprévisible ! Par exemple, il pourrait passer 3 secondes sur un thread A, mais 2 secondes sur un thread B. Bien-sûr, on ne parle pas de secondes ici, mais bien de nano-secondes. Un autre point frustrant sera que lors du déboggage, vous pourriez vous retrouver dans une méthode complètement différente de celle qui vous intéresse en un clin d'oeil, justement à cause que le système de jeton a changé de thread et vous a projeté dans la méthode qu'il exécute au même moment. Les techniques de débogage s'améliorent avec le temps, mais je dois vous aviser que cela est toujours possible.</p></aside><h6 id="r-le-cas-des-taches-bloquantes" data-claire-element-id="378604">Le cas des tâches bloquantes...</h6><p id="r-378603" data-claire-element-id="378603">Une application Windows Forms est amenée à se rafraîchir assez fréquemment. Lors de grosses opérations ou d'opérations synchrones qui bloquent, tout le temps de calcul est alloué à ces tâches et non plus au rafraîchissement. Après un certain temps, Windows déclare l'application comme &quot;Ne répondant plus&quot;. Si vous planifiez de distribuer votre application, ce comportement est inacceptable, vous en conviendrez. C'est dans ce type de cas qu'on utilisera les threads. Imaginez afficher une belle animation sur un <em>Splash Screen</em> alors que les ressources sont en chargement en arrière plan. Avec les threads, cela devient possible.</p><h5 id="r-les-differents-types-de-thread" data-claire-element-id="378615">Les différents types de thread</h5><p id="r-378606" data-claire-element-id="378606">Il est possible de créer deux types de threads, bien que cela revienne au même. Lors de l'instanciation de la classe <code data-claire-semantic="csharp">Thread</code>, il est possible de garder la référence de l'objet, ou de la laisse flotter. Si on ne la récupère pas, on appellera ce thread &quot;indépendant&quot;. Il sera créé, puis lancé immédiatement. Comme on ne gardera pas la référence, on ne pourra pas contrôler ce thread du tout. Il fera ce qu'il a à faire, sans que l'on puisse intervenir (sauf en utilisant quelques primitives de synchronisation que nous verrons plus tard).</p><p id="r-378607" data-claire-element-id="378607">Voici comment déclarer un thread indépendant :</p><pre id="r-378608" data-claire-element-id="378608"><code data-claire-semantic="csharp">new Thread(fonction).Start();</code></pre><aside id="r-378610" data-claire-element-id="378610" data-claire-semantic="information"><p id="r-378609" data-claire-element-id="378609">Puisqu'il n'y a pas d'opérateur d'affectation ( = ), on laisse partir la référence. Lorsque le thread se terminera, le Garbage Collector passera en arrière et se débarrassera des objets pour nous.</p></aside><p id="r-378611" data-claire-element-id="378611">Le type dépendant est beaucoup plus fréquent. Il s'agit de garder la référence sur l'objet afin de pouvoir l'analyser, le tester, l'influencer. Vous connaissez déjà tous comment le créer, mais pour la forme, voici un exemple :</p><pre id="r-378612" data-claire-element-id="378612"><code data-claire-semantic="csharp">Thread nomThread = new Thread(fonction);</code></pre><aside id="r-378614" data-claire-element-id="378614" data-claire-semantic="warning"><p id="r-378613" data-claire-element-id="378613">Une application Windows s'exécute dans un ou plusieurs <em>Processus</em> (un par application, service et exécutable). Un processus possède également un ou plusieurs threads, dont un principal. Ainsi, tous les threads d'une application Windows sont donc reliés directement à un processus. Cela nous permet donc de développer la conscience tranquille : aucun thread ne sera laissé en mode de <em>flottaison</em> si l'on doit abruptement quitter l'application.</p></aside><h5 id="r-comment-lancer-le-thread" data-claire-element-id="378640">Comment lancer le thread ?</h5><p id="r-378616" data-claire-element-id="378616">Tout d'abord, assurez-vous d'utilisez l'espace de nom suivant : <code data-claire-semantic="csharp">using System.Threading;</code>.</p><p id="r-378617" data-claire-element-id="378617">Déclarer un nouveau thread va comme suit :</p><pre id="r-378618" data-claire-element-id="378618"><code data-claire-semantic="csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;

namespace TestThread
{
    class Program
    {
        static void Main(string[] args)
        {
            //On initialise l'object Thread en lui passant la méthode
            //à exécuter dans le nouveau thread. Ça vous rappelle pas
            //certains delegates ça ?
            Thread th = new Thread(Afficher);

            //Un thread, ça ne part pas tout seul. Il faut lui indiquer de
            //commencer l'exécution.
            th.Start();

            Console.ReadKey();
        }

        static void Afficher()
        {
            //Code tout bête qui affiche la lettre A 1000 fois.
            for (int i = 0; i &lt; 1000; i++)
            {
                Console.Write(&quot;A&quot;);
            }
        }
    }
}</code></pre><p id="r-378619" data-claire-element-id="378619">Ce code fonctionne bien dans le cas où on n'a aucun paramètre à passer à la méthode. Il est un peu plus compliqué d'en passer, mais on s'en sort, vous verrez.</p><pre id="r-378620" data-claire-element-id="378620"><code data-claire-semantic="csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;

namespace TestThread
{
    class Program
    {
        static void Main(string[] args)
        {
            //Il faut créer un objet ParameterizedThreadStart dans le constructeur
            //du thread afin de passer un paramètre.
            Thread th = new Thread(new ParameterizedThreadStart(Afficher));

            Thread th2 = new Thread(new ParameterizedThreadStart(Afficher));

            //Lorsqu'on exécute le thread, on lui donne son paramètre de type Object.
            th.Start(&quot;A&quot;);

            th2.Start(&quot;B&quot;);

            Console.ReadKey();
        }

        //La méthode prend en paramètre un et un seul paramètre de type Object.
        static void Afficher(object texte)
        {
            for (int i = 0; i &lt; 10000; i++)
            {
                //On écrit le texte passer en paramètre. N'oubliez pas de le caster 
                //car il s'agit d'un type Object, pas String.
                Console.Write((string)texte);
            }
            Console.WriteLine(&quot;&lt;------------Thread {0} terminé-----------&gt;&quot;, (string)texte);
        }
    }
}</code></pre><aside id="r-378622" data-claire-element-id="378622" data-claire-semantic="error"><p id="r-378621" data-claire-element-id="378621">Attention, la plus fréquente source d'erreur lors de l'utilisation de ce genre de thread est le paramètre. En effet, ce type de <strong>delegate</strong> a sa propre définition et il requiert un seul et unique paramètre qui sera de type <em>object</em>. Faîtes bien attention à <strong>transtyper (cast)</strong> vos variables correctement !</p></aside><aside id="r-378624" data-claire-element-id="378624" data-claire-semantic="information"><p id="r-378623" data-claire-element-id="378623">Si vous avez besoin de passer plus qu'un paramètre à la fonction, ce n'est pas possible. La classe Thread n'est pas générique et n'accepte pas les delegates de type <code data-claire-semantic="csharp">Action&lt;T&gt;</code> ou <code data-claire-semantic="csharp">Func&lt;T&gt;</code>, mais seulement un <code data-claire-semantic="csharp">ParameterizedThreadStart</code>. On peut contourner ce problème en créant une classe <em>modèle</em>, c'est-à-dire qui n'a pour but que d'agréger d'autre données afin de les regrouper en un seul objet.</p></aside><p id="r-378625" data-claire-element-id="378625">Cet exemple est parfait pour vous montrer comment les threads sont imprévisibles, et c'est ce qui les rend compliqués ! Je vous montre le résultat chez moi.</p><figure id="r-aleatoire-1" data-claire-element-id="378628"><img id="r-378626" data-claire-element-id="378626" src="medias/uploads.siteduzero.com_files_242001_243000_242452.png" alt="Aléatoire 1"/><figcaption>Aléatoire 1</figcaption></figure><p id="r-378629" data-claire-element-id="378629"><em>C'est pas bien beau tout ça. Je suis sûr que chez vous, c'est tout-à-fait différent. Même si je ne fais que le redémarrer, ce sera différent ! La leçon à retenir ici est que les threads sont imprévisibles, comme je l'ai expliqué plus haut. Pour preuve, j'ai relancé le même processus un peu plus tard, et voici le résultat :</em></p><figure id="r-aleatoire-2" data-claire-element-id="378632"><img id="r-378630" data-claire-element-id="378630" src="medias/uploads.siteduzero.com_files_242001_243000_242454.gif" alt="Aléatoire 2"/><figcaption>Aléatoire 2</figcaption></figure><p id="r-378633" data-claire-element-id="378633"><em>On voit très bien que dans ce cas-ci, le Thread B a terminé en premier, ce qui prouve que le même code peut générer des résultats différents d'une exécution à l'autre s'il est programmé avec des threads !</em></p><aside id="r-378636" data-claire-element-id="378636" data-claire-semantic="error"><p id="r-378634" data-claire-element-id="378634">Lorsque vous gardez une référence vers un thread, il peut être tentant de vouloir le lancer plusieurs fois. Ne le faîtes pas. L'objet Thread conserve en effet son état et ne peut être lancé seulement que lorsqu'il est neuf et frais. Tenter de lancer plus d'une fois un thread résulterait en une Exception.</p><p id="r-378635" data-claire-element-id="378635">Si vous n'êtes pas certain de l'état de votre thread, sachez que la propriété <strong>ThreadState</strong> pourra vous renseigner. Il s'agit d'une énumérable qui décrit tous les états possibles.</p></aside><h6 id="r-cas-particuliers-2" data-claire-element-id="378639">Cas particuliers</h6><p id="r-378637" data-claire-element-id="378637">Même si un thread s'exécute en deçà de votre programme principal, il reste que la méthode qu'il exécute fait partie de la classe à laquelle la méthode appartient. Cela signifie que l'accès aux variables globales et membres de votre classe lui seront accessibles sans problème.</p><p id="r-378638" data-claire-element-id="378638">Là où le problème se pose, c'est lorsque plusieurs threads devront accéder à la même variable, y faire des changements et des tests. Imaginez que votre thread A accède aux variables <strong>numérateur</strong> et <strong>dénominateur</strong> qui sont globales (à proscrire, mais bon). Le thread A a le temps de faire quelques tests, à savoir vérifier si le dénominateur n'est pas égal à zéro avant de procéder à une division. Tous les tests passent, mais juste au moment où le thread arrive pour effectuer l'opération, le thread B s'empare du jeton. Le thread B est chargé de réinitialiser le dénominateur à 0, et c'est ce qu'il fait. À ce moment là, le jeton revient au thread A qui tente d'effectuer la division. Oops, ça plante... C'est ce qu'on appelle un problème de synchronisation. Je ne vais pas vous mentir, ces problèmes sont rares. Il faut vraiment que vous soyez malchanceux. Il reste cependant important de bien synchroniser ses threads, surtout si l'on aspire à commercialiser le produit. Ainsi, plusieurs structures de synchronisation existent, et nous allons en survoler quelques unes.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">
<span class="arrow"></span>
<span class="next">Le multi-tâche</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
<span class="next">Les mécanismes de synchronisation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesmcanismesdesynchronisation"></a><h2>Les mécanismes de synchronisation</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
<span class="arrow"></span>
<span class="next">Les threads</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">
<span class="next">Le multithreading en Windows Forms</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-mecanismes-de-synchronisation" data-claire-element-id="378719">Les mécanismes de synchronisation</h4><h5 id="r-les-variables-de-controle" data-claire-element-id="378657">Les variables de contrôle</h5><p id="r-378642" data-claire-element-id="378642">Il peut sembler que les variables de contrôle soient un concept très poussé, mais pas du tout ! Il s'agit bêtement d'une variable globale que seul le thread principal modifiera et que les threads enfants contrôleront. Ce concept est particulièrement efficace dans le cas où le thread effectue une boucle infinie. Encore une fois, ça sent la programmation réseau ici. Je vous illustre le concept à l'aide d'un petit exemple pas très compliqué.</p><pre id="r-378643" data-claire-element-id="378643"><code data-claire-semantic="csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;

namespace VarControle
{
    class Program
    {
        //Quelques variables à portée globale.
        private static bool _quitter = false;
        private static int _identificateur = 0;

        static void Main(string[] args)
        {
            Console.Title = &quot;Variables de contrôle&quot;;

            //On crée un tableau de threads.
            Thread[] threads = new Thread[5];

            //On itère à travers le tableau afin de créer et lancer les threads.
            for(int i = 0; i&lt; threads.Length; i++)
            {
                //Création et lancement des threads.
                threads[i] = new Thread(OperThread);
                threads[i].Start();

                //On laisse passer 500ms entre les création de thread.
                Thread.Sleep(500);
            }

            //On demande à ce que tous les threads quittent.
            _quitter = true;

            Console.ReadKey();
        }

        static void OperThread()
        {
            //On donne au thread un identificateur unique.
            int id = ++_identificateur;

            Console.WriteLine(&quot;Début du thread {0}&quot;, id);

            while (!_quitter)
            {
                //On fait des choses ici tant qu'on ne désire pas quitter...
                Console.WriteLine(&quot;Thread {0} a le contrôle&quot;, id);

                //On met le thread en état de sommeil pour 1000ms / 1s.
                Thread.Sleep(1000);
            }

            Console.WriteLine(&quot;Thread {0} terminé&quot;, id);
        }
    }
}</code></pre><p id="r-378644" data-claire-element-id="378644">Voici le résultat :</p><figure id="r-378646" data-claire-element-id="378647"><img id="r-378645" data-claire-element-id="378645" src="medias/uploads.siteduzero.com_files_315001_316000_315027.gif" alt="Image utilisateur"/></figure><aside id="r-378649" data-claire-element-id="378649" data-claire-semantic="information"><p id="r-378648" data-claire-element-id="378648">Ce qu'il faut comprendre de cet exemple, c'est que les variables de contrôle sont une bonne méthode afin d'influencer le comportement d'un thread, mais généralement seulement lorsque celui-ci est en boucle ou s'il fait des vérifications fréquentes de l'état de la variable de contrôle. Il est aussi TRÈS important de retenir que seul le thread principal doit modifier la valeur de la variable. Sinon, on pourrait retrouver des threads à toutes les sauces. Imaginez qu'à chaque itération, la boucle change la valeur de la variable de contrôle. Les problèmes feraient probablement vite leur apparition. Somme toute, il s'agit d'une bonne méthode à utiliser en fixant certaines règles d'utilisation bien définies.</p></aside><p id="r-378650" data-claire-element-id="378650">Ce mécanisme est très simple et très populaire afin de contrôler le déroulement de ses threads. Cependant, n'oubliez pas de faire en sorte, lors d'un long traitement ou une boucle, de vérifier assez fréquemment que la sortie n'est pas nécessaire. C'est ce que nous ferons lorsque nous serons prêts à faire du développement en réseau.</p><div id="r-378652" data-claire-element-id="378652" data-claire-semantic="question"><p id="r-378651" data-claire-element-id="378651">Avez-vous remarqué un bout de code qui ne vous semblait pas thread-safe ? Si oui, vous comprendrez certainement l'utilité du prochain mécanisme de synchronisation.</p></div><p id="r-378653" data-claire-element-id="378653"></p><div id="r-378656" data-claire-element-id="378656"><pre id="r-378654" data-claire-element-id="378654"><code data-claire-semantic="csharp">//On donne au thread un identificateur unique.
int id = ++_identificateur;</code></pre><p id="r-378655" data-claire-element-id="378655">Ce bout de code n'est pas thread-safe, car on ne sait pas si un autre processus pourrait prendre le contrôle au mauvais moment. Si l'ordre de lancement est très important, cette ligne pourrait ne pas s'exécuter à temps.</p></div><h5 id="r-le-lock" data-claire-element-id="378677">Le lock</h5><p id="r-378658" data-claire-element-id="378658">L'instruction <em>lock</em> permet de verrouiller efficacement une ressource tant et aussi longtemps qu'un bloc d'instruction est en cours. Cela signifie que si d'autres threads tentent d'accéder à la même ressource en même temps, ils ne pourront pas. Cela ne signifie pas qu'ils planteront et se termineront, mais plutôt qu'ils passeront le jeton à un autre thread et attendront patiemment leur tour afin d'accéder à cette ressource.</p><aside id="r-378660" data-claire-element-id="378660" data-claire-semantic="information"><p id="r-378659" data-claire-element-id="378659">On peut d'ailleurs forcer ce comportement en tout temps en appelant la méthode <code data-claire-semantic="csharp">Thread.Yield()</code>.</p></aside><p id="r-378661" data-claire-element-id="378661">Voici un bel exemple :</p><pre id="r-378662" data-claire-element-id="378662"><code data-claire-semantic="csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;

namespace Lock
{
    class Program
    {
        //Variable témoin du lock.
        private static Object _lock = new Object();

        //Sert à initialiser des valeurs pseudos-aléatoires.
        private static Random _rand = new Random((int)DateTime.Now.Ticks);

        //Variable de contrôle.
        private static bool _quitter = false;

        //Variables globales étant affectées par les threads.
        private static int _numerateur;
        private static int _denominateur;

        static void Main(string[] args)
        {
            Console.Title = &quot;Démonstration des lock&quot;;

            //On crée les threads.
            Thread init = new Thread(Initialiser);
            init.Start();

            Thread reinit = new Thread(Reinitialiser);
            reinit.Start();

            Thread div = new Thread(Diviser);
            div.Start();

            //On les laisse travailler pendant 3 seconde.
            Thread.Sleep(3000);
            //Puis on leur demande de quitter.
            _quitter = true;

            Console.ReadKey();
        }

        private static void Initialiser()
        {
            //Boucle infinie contrôlée.
            while (!_quitter)
            {
                //On verouille l'accès aux variables tant que l'on a pas terminé.
                lock (_lock)
                {
                    //Initialisation des valeurs.
                    _numerateur = _rand.Next(20);
                    _denominateur = _rand.Next(2, 30);
                }

                //On recommence dans 250ms.
                Thread.Sleep(250);
            }
        }

        private static void Reinitialiser()
        {
            //Boucle infinie contrôlée.
            while (!_quitter)
            {
                //On verouille l'accès aux variables tant que l'on a pas terminé.
                lock (_lock)
                {
                    //Réinitialisation des valeurs.
                    _numerateur = 0;
                    _denominateur = 0;
                }

                //On recommence dans 300ms.
                Thread.Sleep(300);
            }
        }

        private static void Diviser()
        {
            //Boucle infinie contrôlée.
            while (!_quitter)
            {
                //On verouille pendant les opérations.
                lock (_lock)
                {
                    //Erreur si le dénominateur est nul.
                    if (_denominateur == 0)
                        Console.WriteLine(&quot;Division par 0&quot;);
                    else
                    {
                        Console.WriteLine(&quot;{0} / {1} = {2}&quot;, _numerateur, _denominateur, _numerateur / (double)_denominateur);
                    }
                }

                //On recommence dans 275ms.
                Thread.Sleep(275);
            }
        }
    }
}</code></pre><p id="r-378663" data-claire-element-id="378663">Résultat :</p><figure id="r-378665" data-claire-element-id="378666"><img id="r-378664" data-claire-element-id="378664" src="medias/uploads.siteduzero.com_files_315001_316000_315042.gif" alt="Image utilisateur"/></figure><aside id="r-378668" data-claire-element-id="378668" data-claire-semantic="information"><p id="r-378667" data-claire-element-id="378667">C'est bien comique parce que lorsque je vous ai préparé cet exemple, l'erreur dont je vous ai mentionné plus tôt s'est produite. Je n'avais alors pas englobé mon test du dénominateur dans l'instruction lock, ce qui a permis au thread en charge de réinitialiser les valeurs d'embarquer. Cela a produit une erreur de type NaN (Non-Numérique). Malheureusement, sur le coup, je n'ai pas fait de capture d'écran, et j'ai donc essayé de reproduire l'erreur, mais sans succès. C'est donc vous dire qu'avec les threads, il faut tout prévoir dès le départ, car l'apparition d'une erreur peut être un heureux (ou malheureux) hasard !</p></aside><p id="r-378669" data-claire-element-id="378669">Donc, dans cet exemple, on voit que tout est bien protégé. Aucun thread ne peut venir interférer avec les autres. Remarquez la création d'une instance d'un objet de type <code data-claire-semantic="csharp">Object</code> à la ligne 12. Cela est notre témoin de verrouillage. En réalité, n'importe quel objet qui se passe en référence peut servir de témoin de verrouillage. Comme nous avons travaillé avec des entiers(<code data-claire-semantic="csharp">int</code>) dans cet exemple et que ce type est passé par valeur, nous avons eu à créer cette variable.</p><aside id="r-378671" data-claire-element-id="378671" data-claire-semantic="warning"><p id="r-378670" data-claire-element-id="378670">Il ne faut surtout pas créer de threads qui pourraient finir par s'attendre l'un l'autre. Si cela arrivait, vos threads ne feraient plus rien. Et le pire, c'est qu'aucun exception ne serait levée et aucun bug répertorié. Il faut donc faire attention dans ces cas-là.</p></aside><p id="r-378672" data-claire-element-id="378672">Voici un exemple où une l'instanciation d'un objet témoin supplémentaire est inutile :</p><pre id="r-378673" data-claire-element-id="378673"><code data-claire-semantic="csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;

namespace lockEx
{
    class Program
    {
        static List&lt;string&gt; liste = new List&lt;string&gt;();

        static void Main(string[] args)
        {
            for (int i = 0; i &lt; 6; i++)
                new Thread(Ajouter).Start();
        }

        static void Ajouter()
        {
            lock(liste)
                liste.Add(&quot;abc&quot;);
        }
    }
}</code></pre><p id="r-378674" data-claire-element-id="378674">Ici, on utilisera donc l'objet <code data-claire-semantic="csharp">liste</code> qui se passe par référence, et qui est donc acceptable.</p><aside id="r-378676" data-claire-element-id="378676" data-claire-semantic="information"><p id="r-378675" data-claire-element-id="378675">Il est possible de créer un <code data-claire-semantic="csharp">lock</code> en lui spécifiant un nom de type <code data-claire-semantic="csharp">string</code>. Cependant, Microsoft ne le recommande pas, car cette notation pourrait amener de la confusion. N'oubliez pas non plus qu'il est possible de faire de multiples <code data-claire-semantic="csharp">lock</code> qui ne protègent pas les mêmes ressources (indépendants les uns des autres). Il suffit de changer la variable témoin pour accommoder la situation.</p></aside><h5 id="r-les-mutex-1" data-claire-element-id="378684">Les Mutex</h5><p id="r-378678" data-claire-element-id="378678">Les Mutex sont excessivement similaires aux <code data-claire-semantic="csharp">lock</code>. Cependant, si vous désirez créer de nombreuses sections critiques indépendantes, les Mutex ont l'avantage d'être sous forme d'objets plutôt que d'instructions. Un petit exemple vous éclaira sur l'utilisation des Mutex.</p><pre id="r-378679" data-claire-element-id="378679"><code data-claire-semantic="csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;

namespace MutexEx
{
    class Program
    {
        private const int TAILLE_TABLEAU = 2;

        //On crée les Mutex.
        private static Mutex _muxMultiplier = new Mutex();
        private static Mutex _muxDiviser = new Mutex();

        //On crée les tableaux de valeurs.
        private static int[] _valDiv = new int[TAILLE_TABLEAU];
        private static int[] _valMul = new int[TAILLE_TABLEAU];

        //Objet Random et variable de contrôle.
        private static Random _rand = new Random((int)DateTime.Now.Ticks);
        private static bool _quitter = false;

        static void Main(string[] args)
        {
            Console.Title = &quot;Exemple de Mutex&quot;;

            //On crée et on démarre les threads.
            Thread init = new Thread(Initialiser);
            init.Start();

            Thread mul = new Thread(Multiplier);
            mul.Start();

            Thread div = new Thread(Diviser);
            div.Start();

            //On laisse les threads fonctionner un peu...
            Thread.Sleep(3000);
            //On demande à ce que les opérations se terminent.
            _quitter = true;

            Console.ReadKey();
        }

        private static void Initialiser()
        {
            while (!_quitter)
            {
                //On demande au thread d'attendre jusqu'à ce qu'il ait le contrôle sur les Mutex.
                _muxMultiplier.WaitOne();
                _muxDiviser.WaitOne();

                for (int i = 0; i &lt; TAILLE_TABLEAU; i++)
                {
                    //On assigne au tableau de nouvelles valeurs.
                    _valMul[i] = _rand.Next(2, 20);
                    _valDiv[i] = _rand.Next(2, 20);
                }

                Console.WriteLine(&quot;Nouvelles valeurs !&quot;);

                //On relâche les Mutex
                _muxDiviser.ReleaseMutex();
                _muxMultiplier.ReleaseMutex();

                //On tombe endormi pour 100ms.
                Thread.Sleep(100);
            }
        }

        private static void Multiplier()
        {
            while (!_quitter)
            {
                //On demande le Mutex de multiplication.
                _muxMultiplier.WaitOne();

                //On multiplie.
                Console.WriteLine(&quot;{0} x {1} = {2}&quot;, _valMul[0], _valMul[1], _valMul[0] * _valMul[1]);

                //On relâche le Mutex.
                _muxMultiplier.ReleaseMutex();

                //On tombe endormi pour 200ms.
                Thread.Sleep(200);
            }
        }

        private static void Diviser()
        {
            while (!_quitter)
            {
                //On demande le Mutex de division.
                _muxDiviser.WaitOne();

                //On divise.
                Console.WriteLine(&quot;{0} / {1} = {2}&quot;, _valDiv[0], _valDiv[1], _valDiv[0] * _valDiv[1]);

                //On relâche le Mutex de Division.
                _muxDiviser.ReleaseMutex();

                //On tombe endormi pour 200ms.
                Thread.Sleep(200);
            }
        }
    }
}</code></pre><figure id="r-378681" data-claire-element-id="378682"><img id="r-378680" data-claire-element-id="378680" src="medias/uploads.siteduzero.com_files_315001_316000_315065.gif" alt="Image utilisateur"/></figure><p id="r-378683" data-claire-element-id="378683">Si vous avez fait un peu de programmation en Win32 (langage C), vous pouvez voir la lignée directe des Mutex du .NET et des <code data-claire-semantic="c">CRITICAL_SECTION</code> du Win32. Sinon, vous voyez que les Mutex ont la même fonction que l'instruction <code data-claire-semantic="csharp">lock</code> en un peu plus verbeux. Je tiens cependant à vous avertir que de ne pas relâcher un Mutex peut faire planter votre application, donc faîtes attention à cela.</p><h5 id="r-semaphoreslim" data-claire-element-id="378691">SemaphoreSlim</h5><p id="r-378685" data-claire-element-id="378685">Le SemaphoreSlim sert à contrôler l'accès d'une ressource limitée. Jusqu'à maintenant, les mécanismes de synchronisation dont nous avons parlé ont surtout servi à limiter une ressource à un accès mutuellement exclusif entre des threads concurrents. Qu'en est-il si l'on veut partager une ressource à travers plusieurs threads simultanément tout en gardant un nombre maximal d'accès concurrent ? Les sémaphores existent pour cette raison. En C# .NET, il existe deux types de sémaphores. Le classique <code data-claire-semantic="csharp">Semaphore</code> et le <code data-claire-semantic="csharp">SemaphoreSlim</code>. La différence provient de la complexité de l'objet et des mécanismes internes. Le Semaphore utilise un wrapper autour de l'objet Semaphore du Win32 et rend donc disponible ses fonctionnalités en .NET. Le SemaphoreSlim, lui, est plutôt utilisé lors de courtes durées d'attente et utilise les mécanismes propres au CLR.</p><p id="r-378686" data-claire-element-id="378686">Je ne montrerai que le SemaphoreSlim, les deux se ressemblant beaucoup. Cependant, le SemaphoreSlim reste le plus facile et le plus léger à implémenter. Pour plus d'information sur la différence, veuillez lire cet article sur <a href="http://msdn.microsoft.com/fr-fr/library/z6zx288a.aspx">MSDN</a>. Peu importe la version qui est choisie, vous pouvez voir les Sémaphores comme un &quot;doorman&quot; dans une boîte de nuit. La place à l'intérieur est limitée et le doorman devra contrôler l'accès à la ressource.</p><pre id="r-378687" data-claire-element-id="378687"><code data-claire-semantic="csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;

namespace SemaphoreSlimEx
{
    class Program
    {
        //Déclaration du SemaphoreSlim qui prendra en paramètre le nombre de places disponibles.
        static SemaphoreSlim doorman = new SemaphoreSlim(3);

        static void Main(string[] args)
        {
            Console.Title = &quot;Exemple de SemaphoreSlim&quot;;

            //Création des threads.
            for (int i = 0; i &lt; 10; i++)
                new Thread(Entrer).Start(i);
            Console.ReadKey();
        }

        static void Entrer(object n)
        {
            Console.WriteLine(&quot;La personne #{0} veut entrer&quot;, n);

            //Le doorman attendra qu'il y ait de la place.
            doorman.Wait();
            Console.WriteLine(&quot;#{0} vient d'entrer dans le bar&quot;, n);
            Thread.Sleep((int)n * 1000);
            Console.WriteLine(&quot;#{0} a quitté le building !&quot;, n);

            //Le doorman peut maintenant faire entrer quelqu'un d'autre.
            doorman.Release();
        }
    }
}</code></pre><figure id="r-378689" data-claire-element-id="378690"><img id="r-378688" data-claire-element-id="378688" src="medias/uploads.siteduzero.com_files_315001_316000_315076.gif" alt="Image utilisateur"/></figure><h5 id="r-le-join" data-claire-element-id="378705">Le <em>Join()</em></h5><p id="r-378692" data-claire-element-id="378692">C'est le dernier mécanisme de synchronisation dont je parlerai. Il s'agit très simplement d'attendre la fin d'un autre thread afin de continuer le thread dans lequel le <em>Join()</em> est défini. Cela en fait une méthode bloquante qui pourrait vous causer des problèmes en Windows Forms.</p><p id="r-378693" data-claire-element-id="378693">Petit exemple :</p><pre id="r-378694" data-claire-element-id="378694"><code data-claire-semantic="csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;

namespace TestThread
{
    class Program
    {
        static void Main(string[] args)
        {
            Thread th = new Thread(new ParameterizedThreadStart(Afficher));

            Thread th2 = new Thread(new ParameterizedThreadStart(Afficher));

            th.Start(&quot;A&quot;);

            //On attend la fin du thread A avant de commencer le thread B.
            th.Join();

            th2.Start(&quot;B&quot;);

            Console.ReadKey();
        }

        static void Afficher(object texte)
        {
            for (int i = 0; i &lt; 10000; i++)
            {
                Console.Write((string) texte);
            }
        }
    }
}</code></pre><p id="r-378695" data-claire-element-id="378695">Le <strong>Join </strong>est généralement utilisé en conjoncture avec une variable de contrôle. Ainsi, on demande aux threads dépendants de s'arrêter, puis on les attends avant de continuer. Retenez bien cette façon de fonctionner, parce que c'est comme cela que nous procéderons lorsque notre application devra quitter en ayant des ressources réseau ouvertes.</p><h6 id="r-le-abort" data-claire-element-id="378704">Le <em>Abort()</em></h6><p id="r-378696" data-claire-element-id="378696">Bon, après avoir vu comment bien synchroniser ses threads, voyons ce que vous ne devez <strong>PAS</strong> faire !!! :pirate:</p><pre id="r-378697" data-claire-element-id="378697"><code data-claire-semantic="csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;

namespace ThreadStop
{
    class Program
    {
        static void Main(string[] args)
        {
            Thread thread = new Thread(Test);

            thread.Start();
            Thread.Sleep(100);

            //On tue le processus. À NE PAS FAIRE !
            thread.Abort();

            Console.ReadKey();
        }

        public static void Test()
        {
            for(int i = 0; i &lt; 10000; i++)
                Console.WriteLine(i);
        }
    }
}</code></pre><aside id="r-378699" data-claire-element-id="378699" data-claire-semantic="error"><p id="r-378698" data-claire-element-id="378698">Aux premiers abords, cela semble assez facile à faire, et semble sans grandes conséquences. En fait, vous avez probablement raison dans cet exemple. Cependant, ne prenez pas l'habitude de faire terminer vos threads si abruptement, car il se pourrait que cela vous cause des erreurs éventuellement. En effet, vous ne fermez pas votre ordinateur en débranchant la prise du mur, n'est-ce pas ? ( o_O <strong>N'est-ce pas</strong> !!!???) C'est le même principe ici. Si vous étiez en train de faire quelque chose de vraiment important, et que le thread principal choisissait ce moment pour arrêter le thread, l'application en entier pourrait devenir instable et planter. Puisqu'on ne veut pas cela, il vaut mieux utiliser le <em>Join()</em> et une variable de contrôle, comme dans l'exemple suivant :</p></aside><pre id="r-378700" data-claire-element-id="378700"><code data-claire-semantic="csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;

namespace ThreadStop
{
    class Program
    {
        private static bool _continuer = true;

        static void Main(string[] args)
        {
            Thread thread = new Thread(Test);

            thread.Start();
            Thread.Sleep(100);

            //On demande au thread de s'arrêter au prochain passage d'un moment qui semble naturel.
            _continuer = false;

            //On attend que le thread se termine proprement.
            thread.Join();

            Console.ReadKey();
        }

        public static void Test()
        {
            //On fait 10 000 itérations, tant et aussi longtemps que l'on peut continuer (variable de contrôle).
            for(int i = 0; i &lt; 10000 &amp;&amp; _continuer; i++)
                Console.WriteLine(i);
        }
    }
}</code></pre><p id="r-378701" data-claire-element-id="378701">Et voilà, on se sent toujours mieux quand on fait quelque chose de bien, non ? Comme ça, si le thread a besoin de temps pour bien terminer ses opérations (appeler quelques <em>Dispose()</em>, ou fermer des connexions TCP), il le pourra. Utilisez donc les <em>Join()</em> et pas les <em>Abort()</em>. Les <em>Abort()</em>, c'est mal ! :diable:</p><aside id="r-378703" data-claire-element-id="378703" data-claire-semantic="information"><p id="r-378702" data-claire-element-id="378702">Lorsque vous fermez l'application, Windows tend à simplement appeler <em>Abort()</em> sur les threads en fonction. Ce comportement est hérité du Win32 dont le .NET recouvre à l'aide de <em>wrappers</em> (il s'agit d'une longue histoire, croyez-moi). C'est aussi pourquoi on évitera autant que possible l'usage de threads indépendants, car ils sont moins contrôlables. Prévoyez donc attendre les threads actifs lorsque vous quitter votre application, car comme nous l'avons dit, les <em>Abort()</em>, c'est mal. Quoique avec le Garbage Collector de .NET....NON, NON, C'EST MAL !</p></aside><h5 id="r-en-resume-462" data-claire-element-id="378718">En résumé...</h5><ul id="r-378716" data-claire-element-id="378716"><li id="r-378707" data-claire-element-id="378707"><p id="r-378706" data-claire-element-id="378706">Le système de jetons permet à un système d'exploitation de simuler un parallélisme dans les tâches.</p></li><li id="r-378709" data-claire-element-id="378709"><p id="r-378708" data-claire-element-id="378708">L'implémentation du multithreading dans une application a pour conséquence d’alourdir son code, mais de la rendre plus facile d'utilisation (généralement).</p></li><li id="r-378711" data-claire-element-id="378711"><p id="r-378710" data-claire-element-id="378710">On utilise le multithreading lorsqu'on est confronté à de lourdes tâches, des tâches détachées ou des tâches bloquantes.</p></li><li id="r-378713" data-claire-element-id="378713"><p id="r-378712" data-claire-element-id="378712">L'objet <code data-claire-semantic="csharp">Thread</code> nous permet de créer et de gérer un thread en .NET.</p></li><li id="r-378715" data-claire-element-id="378715"><p id="r-378714" data-claire-element-id="378714">Les applications multi-threads sont imprévisibles. Il est donc importer de maintenir les zones critiques synchronisées.</p></li></ul><p id="r-378717" data-claire-element-id="378717">Nous sommes maintenant prêts à aborder le sujet du multi-tâche en Windows Forms ! Je vous montrerai comment éviter que cela ne vire en catastrophe, ne craignez rien. De plus, si vous êtes intéressé par le multi-thread, je vous conseille de vous informer sur le Parallel Tasking auprès de MSDN. Ce nouvel API très puissant est apparu avec le framework 4.0 de .NET et est très intéressant pour effectuer des traitements lourds.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
<span class="arrow"></span>
<span class="next">Les threads</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">
<span class="next">Le multithreading en Windows Forms</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="LemultithreadingenWindowsForms"></a><h2>Le multithreading en Windows Forms</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
<span class="arrow"></span>
<span class="next">Les mécanismes de synchronisation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
<span class="next">Et les delegates dans tout ça ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-378721" data-claire-element-id="378721">Bon, je sais que les Windows Forms ne sont pas nécessairement d'actualité. Mais croyez-moi, ce sera bien plus simple pour vous expliquer comment les threads peuvent prendre place dans un écosystème graphique. Certaines pratiques que l'on peut considérer comme faciles et courantes peuvent rapidement prendre une tournure plus complexe dès que l'on ajoute le facteur interface graphique.</p><p id="r-378722" data-claire-element-id="378722">Je ne vous en dit pas plus, je vous laisse lire à la place. :D</p>
</div><a name="Etlesdelegatesdanstouta"></a><h2>Et les delegates dans tout ça ?</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">
<span class="arrow"></span>
<span class="next">Le multithreading en Windows Forms</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
<span class="next">Le cas classique</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-et-les-delegates-dans-tout-ca" data-claire-element-id="378742">Et les delegates dans tout ça ?</h4><p id="r-378723" data-claire-element-id="378723">Les delegates ont des utilités que vous ne soupçonnez probablement même pas. Si je vous parle d'évènements, est-ce que cela vous éclaire ?</p><h5 id="r-le-cas-des-evenements" data-claire-element-id="378741">Le cas des évènements</h5><p id="r-378724" data-claire-element-id="378724">Les Windows Forms ont depuis leur tout début fonctionné avec des évènements. Lorsque l'on crée nos formulaires dans le designer, on est loin de se douter que tout un mécanisme se situe en arrière. On se contente généralement d'accéder à son objet, d'ouvrir la fenêtre Propriétés et de cliquer sur la petite éclair. Là, dans ce menu, on trouve un éventail d'évènements auxquels on peut s'abonner afin de bien personnaliser nos interfaces graphiques à notre goût.</p><figure id="r-on-a-l-embarras-du-choix-pour-ce-qui-est-de-evenements-en-windows-forms" data-claire-element-id="378727"><img id="r-378725" data-claire-element-id="378725" src="medias/uploads.siteduzero.com_files_388001_389000_388971.png" alt="On a l'embarras du choix pour ce qui est de évènements en Windows Forms !"/><figcaption>On a l'embarras du choix pour ce qui est de évènements en Windows Forms !</figcaption></figure><p id="r-378728" data-claire-element-id="378728">Cependant, dès que vous double-cliquez sur une de ces entrées, vous vous trouvez en fait à créer un delegate qui fera référence à la méthode qui gère l'évènement. Ainsi, vous, en tant qu'utilisateur du Designer de Visual Studio, vous n'y voyez que du feu. Je vous propose d'ouvrir un fichier Designer juste pour voir tout le travail qui est effectué pour vous automatiquement. Vous n'en reviendriez pas ! Dans votre explorateur de Solution, cliquez sur la flèche qui se situe à gauche d'un de vos formulaires Windows. Vous y découvrirez le fichier suivant : &lt;NomDuFormulaire&gt;.Designer.cs. Ouvrez-le.</p><p id="r-378729" data-claire-element-id="378729">Voici une des lignes qui nous intéresse :</p><pre id="r-378730" data-claire-element-id="378730"><code data-claire-semantic="csharp">this.FormClosing += new System.Windows.Forms.FormClosingEventHandler(this.FrmServer_FormClosing);</code></pre><h6 id="r-l-abonnement-aux-evenements" data-claire-element-id="378740">L'abonnement aux évènements</h6><p id="r-378731" data-claire-element-id="378731">Nous allons voir comment faire pour nous abonner manuellement à un évènement. D'abord, sachez que les évènements se présentent comme des membres de l'instance que vous manipulez. Il s'agit en fait d'une collection de delegates. Cette collection se comporte un peu différemment des collections traditionnelles que vous connaissez. En effet, on peut s'abonner plusieurs fois au même évènement. Voilà pourquoi nous utiliserons l'opérateur <code data-claire-semantic="csharp">+=</code> pour nous abonner. Ensuite, nous allons déclarer une instance de notre delegate. Dans le cas des évènements, on préfère déclarer notre propre type de delegate pour éviter toute confusion. Dans ce cas-ci, le delegate qui nous intéresse se nomme <code data-claire-semantic="csharp">FormClosingEventHandler</code>. Afin de s'abonner, il faudra créer une instance du delegate en question et lui faire pointer sur la méthode que l'on désire exécuter lorsque l'évènement sera déclenché.</p><p id="r-378732" data-claire-element-id="378732">Le résultat est d'une simplicité extraordinaire et la ligne de code est claire et concise ! De plus, pas de code entremêlé, l'action se déroule dans une méthode à part. D'ailleurs, cette méthode pourra avoir de spécificité selon le delegate. La forme la plus courante est celle-ci :</p><pre id="r-378733" data-claire-element-id="378733"><code data-claire-semantic="csharp">private void &lt;NomDeLObjetDeclencheur&gt;_&lt;Evenement&gt;(object sender, EventArgs e)
{

}</code></pre><p id="r-378734" data-claire-element-id="378734">Dans tous les cas ou presque, le premier paramètre contient l'objet qui a déclenché l'évènement. Si vous avez appuyé sur un bouton, c'est ce dernier que vous retrouverez dans <code data-claire-semantic="csharp">sender</code>, merci à l'héritage et au polymorphisme ! Le deuxième paramètre est généralement celui qui détermine le type de delegate que l'on utilise lorsque l'on crée un contrôle personnalisé. Il s'agit d'un paramètre fourre-tout. Ce dernier contient beaucoup d'informations, bien souvent inutiles, mais parfois indispensables. Dans le cas classique, on retrouve un objet de type <code data-claire-semantic="csharp">EventArgs</code>. Sachez cependant que tous les évènements standards en Windows Forms ou presque donnerons dans ce paramètre un objet d'un type qui dérive d'EventArgs.</p><p id="r-378735" data-claire-element-id="378735">Je vous donne un exemple classique d'un évènement et un exemple un peu plus spécial.</p><pre id="r-378736" data-claire-element-id="378736"><code data-claire-semantic="csharp">//Exemple générique...
private void btnEvents_Click(object sender, EventArgs e)
{
    //Faire quelque chose lors du click du bouton.
}

//Exemple plus spécialisé...
private void FrmServer_FormClosing(object sender, FormClosingEventArgs e)
{
    _loop = false;

    //On attend la fin de l'exécution.
    _listenerThread.Join();
}</code></pre><p id="r-378737" data-claire-element-id="378737">Vous devriez maintenant savoir pourquoi vous avez fait royalement planter votre compilateur à vos débuts lorsque vous avez bêtement retiré une méthode de votre code car vous ne pensiez plus avoir à gérer l'évènement d'un tel objet. À bien y penser maintenant, il devient évident que si la méthode était l'objet d'une référence d'un delegate et que l'on retire la soi-disant méthode, il est bien normal que le tout plante.</p><p id="r-378738" data-claire-element-id="378738">Ça ne paraît peut-être pas, mais vous venez de commencer à comprendre les mécanismes en arrière de la programmation évènementielle. Il y en a beaucoup plus à connaître et à maîtriser, mais c'est un grand pas en avant ! ^^</p><p id="r-378739" data-claire-element-id="378739">Comptez-vous chanceux que Microsoft ait décidé d'implémenter ce concept en .NET. Si ça n'avait pas été le cas, nous serions aujourd'hui pris avec la même structure que Java et son API graphique Swing pour ce qui est des évènements : Les interfaces. Bien qu'utiles, je trouve personnellement que de déclarer des classes anonymes en plein milieu du code soit un peu déroutant et surtout, très mélangeant. Avec les delegates, on arrive au même mais beaucoup plus proprement.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">
<span class="arrow"></span>
<span class="next">Le multithreading en Windows Forms</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
<span class="next">Le cas classique</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lecasclassique"></a><h2>Le cas classique</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
<span class="arrow"></span>
<span class="next">Et les delegates dans tout ça ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
<span class="next">Les BackgroundWorkers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-le-cas-classique" data-claire-element-id="378765">Le cas classique</h4><p id="r-378743" data-claire-element-id="378743">Lorsque viendra le temps de faire du réseau, il sera important de respecter la sécurité interne des ressources. Il sera très souvent intéressant de modifier un objet <strong>Windows Forms</strong> avec les données issues d'un autre thread. C'est notamment le cas en réseau, si on fait un programme de <em>ch@t</em>, par exemple.</p><p id="r-378744" data-claire-element-id="378744">Rappelez-vous, un peu plus tôt, quand je vous ai dit qu'un thread, même s'il est séparé, a accès aux membres de sa classe ? Je ne vous ai pas menti. Mais dans le cas des objets Windows Forms, ceux-ci ne sont pas bâties <strong>thread-safe</strong>. Windows Forms limite donc leurs possibilités en multi-thread. Cela signifie malheureusement que les autres threads ne pourront accéder aux propriétés qu'en lecture seule. Il n'y a que le thread propriétaire qui puisse modifier le composant. Je vous donne un exemple :</p><p id="r-378745" data-claire-element-id="378745">J'ai construit une Windows Forms très simple n'ayant que deux éléments :</p><ul id="r-378750" data-claire-element-id="378750"><li id="r-378747" data-claire-element-id="378747"><p id="r-378746" data-claire-element-id="378746">Une ProgressBar</p></li><li id="r-378749" data-claire-element-id="378749"><p id="r-378748" data-claire-element-id="378748">Un Bouton</p></li></ul><figure id="r-378752" data-claire-element-id="378753"><img id="r-378751" data-claire-element-id="378751" src="medias/uploads.siteduzero.com_files_242001_243000_242455.gif" alt="Image utilisateur"/></figure><p id="r-378754" data-claire-element-id="378754">J'ai ajouté le code suivant dans le fichier <em>Form1.cs</em>.</p><pre id="r-378755" data-claire-element-id="378755"><code data-claire-semantic="csharp">using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using System.Threading;

namespace ThreadWForms
{
    public partial class Form1 : Form
    {
        private Random rand = new Random((int)DateTime.Now.Ticks);

        private int[] tableau = new int[100000000];

        public Form1()
        {
            InitializeComponent();

            //On génère un tableau d'entiers aléatoires.
            for (int i = 0; i &lt; tableau.Length; i++)
            {
                tableau[i] = rand.Next(50000);   //...Boucle très simple, avec méthode Random très simple.
            }
        }

        public void Selection()
        {
            //On va simplement compter les nombres du tableau inférieurs à 500.
            int total = 0;

            for (int i = 0; i &lt; tableau.Length; i++)
            {
                if (tableau[i] &lt; 500)
                {
                    total++;
                }

                //Puis, on incrémente le ProgressBar.
                pgbThread.Value = (int)(i / (double)tableau.Length * 100);
            }
        }

        private void btnLancer_Click(object sender, EventArgs e)
        {
            //On crée le thread.
            Thread t1 = new Thread(new ThreadStart(Selection));

            //Puis on le lance !
            t1.Start();
        }
    }
}</code></pre><aside id="r-378757" data-claire-element-id="378757" data-claire-semantic="error"><p id="r-378756" data-claire-element-id="378756">Bien que le code compile, il produira une exception lors de l'exécution. Cela produira cette erreur :</p></aside><figure id="r-378759" data-claire-element-id="378760"><img id="r-378758" data-claire-element-id="378758" src="medias/uploads.siteduzero.com_files_242001_243000_242456.gif" alt="Image utilisateur"/></figure><p id="r-378761" data-claire-element-id="378761">Alors, je vous l'avais pas dit que ça ne marcherait pas ? Il existe heureusement une façon bien simple de contrer ce problème, et c'est de passer par les <em>delegates </em>! En effet, car si ceux-ci peuvent être passés en paramètres, il peuvent aussi servir à exécuter des opérations sur un thread différent à l'aide de la méthode <em>Invoke</em> !</p><pre id="r-378762" data-claire-element-id="378762"><code data-claire-semantic="csharp">using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using System.Threading;

namespace ThreadWForms
{
    public partial class Form1 : Form
    {
        private Random rand = new Random((int)DateTime.Now.Ticks);

        private int[] tableau = new int[500000];

        //On crée notre delagate.
        public delegate void MontrerProgres(int valeur);

        bool termine = true;

        public Form1()
        {
            InitializeComponent();

            //On génère un tableau d'entiers aléatoires.
            for (int i = 0; i &lt; tableau.Length; i++)
            {
                tableau[i] = rand.Next(50000);   //...Boucle très simple, avec méthode Random très simple.
            }
        }

        public void Selection()
        {
            //On va simplement compter les nombres du tableau inférieurs à 500.
            int total = 0;

            for (int i = 0; i &lt; tableau.Length; i++)
            {
                if (tableau[i] &lt; 500)
                {
                    total++;
                }

                //Puis, on incrémente le ProgressBar.
                int valeur = (int)(i / (double)tableau.Length * 100);

                //On achète la paix, on entoure notre Invoke d'un try...catch !
                try
                {
                    //On invoque le delegate pour qu'il effectue la tâche sur le temps
                    //de l'autre thread.
                    Invoke((MontrerProgres)Progres, valeur);
                }
                catch (Exception ex) { return; }
            }

            termine = true;
        }

        private void btnLancer_Click(object sender, EventArgs e)
        {
            //Petite sécurité pour éviter plusieurs threads en même temps.
            if (termine)
            {
                //On crée le thread.
                Thread t1 = new Thread(new ThreadStart(Selection));

                termine = false;

                //Puis on le lance !
                t1.Start();
            }
        }

        public void Progres(int valeur)
        {
            //On met la valeur dans le contrôle Windows Forms.
            pgbThread.Value = valeur;
        }
    }
}</code></pre><p id="r-378763" data-claire-element-id="378763">Petites explications : Un <em>Invoke</em> sert à demander à l'autre thread de s'occuper d'une action dans un moment libre. C'est l'équivalent d'envoyer un email à un webmestre pour qu'il corrige une erreur sur sa page web. Dès qu'il le pourra, le webmestre s'occupera de corriger l'erreur. Il s'agit du même principe ! Cela permet de contourner le manque <em>thread-safe</em> des contrôles Windows Forms, car c'est le thread propriétaire qui finit par effectuer l'action.</p><p id="r-378764" data-claire-element-id="378764">Aussi, vous avez peut-être fait la grimace en apercevant la ligne 55. Il y a un cast d'un delegate juste avant le nom de la méthode. Cela évite d'avoir à créer un delegate. Je pourrais très bien remplacer cette ligne par ceci : <code data-claire-semantic="csharp">Invoke(new MontrerProgres(Progres), valeur);</code> ou même par une méthode anonyme.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
<span class="arrow"></span>
<span class="next">Et les delegates dans tout ça ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
<span class="next">Les BackgroundWorkers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="LesBackgroundWorkers"></a><h2>Les BackgroundWorkers</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
<span class="arrow"></span>
<span class="next">Le cas classique</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">
<span class="next">Travail Pratique</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-backgroundworkers" data-claire-element-id="378784">Les BackgroundWorkers</h4><p id="r-378766" data-claire-element-id="378766">La classe BackgroundWorker fournit un environnement d'exécution multitâche très sécuritaire, mais un peu limité à mon goût. Cependant, je vais quand même vous montrer comment l'utiliser. L'objet BackgroundWorker se trouve dans la barre d'outils dans la catégorie Composants. Il s'agit d'un petit objet pas très personnalisable qui possède très peu de paramètres et d’évènements. Je vous montre par un exemple comment l'utiliser. J'ai fait un simple projet Windows Forms dans Visual Studio qui comporte une ProgressBar et un bouton de départ, tout comme l'exemple précédent.</p><figure id="r-378768" data-claire-element-id="378769"><img id="r-378767" data-claire-element-id="378767" src="medias/uploads.siteduzero.com_files_315001_316000_315089.gif" alt="Image utilisateur"/></figure><pre id="r-378770" data-claire-element-id="378770"><code data-claire-semantic="csharp">using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using System.Threading;

namespace Background_WorkerEx
{
    public partial class Form1 : Form
    {
        private bool _etat = false;

        public Form1()
        {
            InitializeComponent();

            //On demande à ce que le BackgroundWorker supporte le rapport de progrès et l'annulation.
            bwProgress.WorkerReportsProgress = true;
            bwProgress.WorkerSupportsCancellation = true;

            //On abonne le BackgroundWorker aux évenements requis.
            bwProgress.DoWork+=new DoWorkEventHandler(bwProgress_DoWork);
            bwProgress.ProgressChanged+=new ProgressChangedEventHandler(bwProgress_ProgressChanged);
            bwProgress.RunWorkerCompleted+=new RunWorkerCompletedEventHandler(bwProgress_RunWorkerCompleted);
        }

        private void bwProgress_DoWork(object sender, DoWorkEventArgs e)
        {
            int i = 0;

            //Tant et aussi longtemps que la barre n'a pas atteint le 100% et qu'on
            //ne demande pas à annuler...
            while (i &lt; 100 &amp;&amp; !bwProgress.CancellationPending)
            {
                //On attend 150ms.
                Thread.Sleep(150);

                //On retrouve la valeur la plus petite entre 100 et i + 3.
                i = Math.Min(100, i + 3);

                //On rapporte le progrès fait.
                bwProgress.ReportProgress(i);
            }
        }

        private void btnStart_Click(object sender, EventArgs e)
        {
            //Le bouton joue le rôle de démarrage comme d'annulation selon la situation.
            if (!_etat)
            {
                bwProgress.RunWorkerAsync();
                btnStart.Text = &quot;Annuler&quot;;
            }
            else
            {
                bwProgress.CancelAsync();
                btnStart.Text = &quot;Démarrer&quot;;
            }

            _etat = !_etat;
        }

        private void bwProgress_ProgressChanged(object sender, ProgressChangedEventArgs e)
        {
            //On fait avancer la ProgressBar.
            pgProgress.Value = e.ProgressPercentage;
        }

        private void bwProgress_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)
        {
            //Lorsque c'est terminé, on affiche un message indiquant la fin de l'activité.
            MessageBox.Show(&quot;Le BackgroundWorker a terminé&quot;);
        }
    }
}</code></pre><aside id="r-378772" data-claire-element-id="378772" data-claire-semantic="warning"><p id="r-378771" data-claire-element-id="378771">Tout ce qui a été défini dans le constructeur du formulaire aurait pu être mis dans le Designer graphique. Je l'ai mis là pour vous montrer quelles propriétés et évènements ont été affectés.</p></aside><p id="r-378773" data-claire-element-id="378773">Donc avec le BackgroundWorker, le multi-tâche en Windows Forms devient très facile comme vous pouvez le voir. Tous les évènements appelés seront exécutés dans le thread principal, éliminant ainsi l'utilisation de la commande <code data-claire-semantic="csharp">Invoke</code>. Magique n'est-ce pas ? :magicien:</p><h5 id="r-en-resume-463" data-claire-element-id="378783">En résumé...</h5><ul id="r-378780" data-claire-element-id="378780"><li id="r-378775" data-claire-element-id="378775"><p id="r-378774" data-claire-element-id="378774">Les évènements fonctionnent à l'aide des delegates en C# (que ce soit en Windows Forms, en WPF ou même en Console).</p></li><li id="r-378777" data-claire-element-id="378777"><p id="r-378776" data-claire-element-id="378776">Le multithreading en Windows Forms apporte quelques inconvénients, car seulement le thread qui a créé les composants peut les modifier.</p></li><li id="r-378779" data-claire-element-id="378779"><p id="r-378778" data-claire-element-id="378778">La classe <code data-claire-semantic="csharp">BackgroundWorker</code> existe pour faciliter la gestion des threads dans un environnement Windows Forms.</p></li></ul><p id="r-378781" data-claire-element-id="378781">Maintenant que vous avez vu comment l'interface graphique est avare de ses composants, je suis sûr que vous êtes heureux que nous ayons effectué cette petite expérience en Windows Forms. De plus, si vous êtes un jour amené à maintenir une application multi-thread en .NET, je suis prêt à parier que celle-ci sera en Windows Forms, car WPF est encore trop jeune.</p><p id="r-378782" data-claire-element-id="378782">Nous allons enchaîner avec un petit Travail Pratique. Je vous conseille fortement de le faire afin de mettre en pratique ce que nous avons vu dans les derniers chapitres.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
<span class="arrow"></span>
<span class="next">Le cas classique</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">
<span class="next">Travail Pratique</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="TravailPratique"></a><h2>Travail Pratique</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
<span class="arrow"></span>
<span class="next">Les BackgroundWorkers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
<span class="next">La problématique</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-378786" data-claire-element-id="378786">Notre premier Travail Pratique ne sera pas très difficile. Il s'agira surtout de bien assimiler les notions reliées aux delegates, aux méthodes anonymes et au multi-threading. J'ai choisi un travail qui devrait nous permettre de nous familiariser d'avantage avec ces nouvelles notions.</p>
</div><a name="Laproblmatique"></a><h2>La problématique</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">
<span class="arrow"></span>
<span class="next">Travail Pratique</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
<span class="next">Solution à la partie 1</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-la-problematique-2" data-claire-element-id="378841">La problématique</h4><p id="r-378787" data-claire-element-id="378787">Nous voulons créer un nouveau type de liste qui pourra être facilement utilisable en tout contexte, qui sera générique et qui sera triable à souhait. Nous allons appeller cette liste, la <em><strong>ListeTriable</strong></em>. On fera usage du plus simple algorithme de tri (et le plus désastreux au niveau performance), j'ai nommé le tri à bulle. Hourrraaaahhhh ! :D</p><p id="r-378788" data-claire-element-id="378788">Commencez par ouvrir un nouveau projet en Console. Nous commencerons en douceur.</p><h5 id="r-les-classes-de-base" data-claire-element-id="378808">Les classes de base</h5><h6 id="r-la-liste-triable" data-claire-element-id="378803">La liste triable</h6><p id="r-378789" data-claire-element-id="378789">Dans un premier temps, nous allons nous concentrer à créer la classe de base, sans fonctionnalité de tri. Je vais vous donner le code, ça ira plus vite. Cependant, si vous désirez la coder vous-mêmes, ce sera encore mieux. Si vous désirez la faire vous-mêmes, voici quelques règles à suivre.</p><ul id="r-378800" data-claire-element-id="378800"><li id="r-378791" data-claire-element-id="378791"><p id="r-378790" data-claire-element-id="378790">Il faudra s'assurer que la classe soit générique.</p></li><li id="r-378793" data-claire-element-id="378793"><p id="r-378792" data-claire-element-id="378792">La liste devra utiliser un tableau (Array) afin de fonctionner. Plus il y aura d'éléments dans la liste, plus ce tableau grandira. En fait, sa taille doublera lorsque nous aurons à accomoder plus d'éléments. Utilisez la méthode <code data-claire-semantic="csharp">Array.Resize(ref T[] Array, int nouvelleTaille);</code> lorsque nécéssaire.</p></li><li id="r-378795" data-claire-element-id="378795"><p id="r-378794" data-claire-element-id="378794">Vous devrez construire une propriété qui gardera le décompte d'éléments actuellement dans la liste, indépendamment de la taille du tableau.</p></li><li id="r-378797" data-claire-element-id="378797"><p id="r-378796" data-claire-element-id="378796">Vous devrez bâtir un indexeur à cette classe afin de permettre de récupérer les éléments de la liste en vous basant sur leur index.</p></li><li id="r-378799" data-claire-element-id="378799"><p id="r-378798" data-claire-element-id="378798">Il faudra programmer une méthode <code data-claire-semantic="csharp">Ajouter</code> qui permettra d'ajouter un élément de type T à la fin de la liste.</p></li></ul><p id="r-378801" data-claire-element-id="378801">Voici mon résultat.</p><pre id="r-378802" data-claire-element-id="378802"><code data-claire-semantic="csharp">public class ListeTriable&lt;T&gt;
{
    private T[] _liste = new T[4];
    public int Count { get; private set; }

    public ListeTriable()
    {
        Count = 0;
    }

    public T this[int i]
    {
        get
        {
            return _liste[i];
        }
    }

    public void Ajouter(T element)
    {
        //On multiplie la taille par deux si nécéssaire.
        if (_liste.Length &gt;= Count)
        {
            Array.Resize&lt;T&gt;(ref _liste, _liste.Length * 2);
        }

        //Ajout de l'élément à la fin de la liste et incrémentation du décompte d'éléments
        //dans la liste.
        _liste[Count++] = element;
    }
}</code></pre><h6 id="r-la-classe-a-trier" data-claire-element-id="378807">La classe à trier</h6><p id="r-378804" data-claire-element-id="378804">Nous allons maintenant créer une classe assez simple qui permette un tri facile. J'ai choisi de créer une classe <code data-claire-semantic="csharp">Personne</code> afin de remplir ce rôle. Dans cette classe, il y a trois propriétés : le prénom, le nom et l'âge d'une personne. On voudra trier par âge. Pour les besoins de cet exemple, la classe <code data-claire-semantic="csharp">Personne</code> ne sera pas modifiable, comme si elle appartenait à une <strong>libraire dll</strong> dont nous ne possédons pas le code. Pour le moment, voici de quoi cette classe a l'air.</p><pre id="r-378805" data-claire-element-id="378805"><code data-claire-semantic="csharp">public class Personne
{
    public string Prenom { get; set; }
    public string Nom { get; set; }
    public int Age { get; set; }

    public Personne(string prenom, string nom, int age)
    {
        Prenom = prenom;
        Nom = nom;
        Age = age;
    }

    public override string ToString()
    {
        return String.Format(&quot;{0} {1} -&gt; {2}&quot;, Prenom, Nom, Age);
    }
}</code></pre><p id="r-378806" data-claire-element-id="378806">Simple, non ? À partir de maintenant, cette classe est maintenant intouchable. Sous aucun prétexte vous ne pouvez la modifier (sauf si elle ne compile pas, ce qui ne devrait pas arriver).</p><h5 id="r-votre-defi-si-vous-l-acceptez-sera" data-claire-element-id="378840">Votre défi, si vous l'acceptez, sera...</h5><p id="r-378809" data-claire-element-id="378809">Et voilà, maintenant que nous avons une base avec laquelle travailler, voici ce qui est attendu de vous. Vous devez créer une méthode qui fait un tri à bulle sur les éléments contenus dans la ListeTriable. Comme il s'agit d'une liste générique et que nous ne savons pas avec quoi nous allons travailler, nous demanderons une méthode qui sera en mesure de déterminer l'ordre de grandeur entre deux éléments de la liste.</p><h6 id="r-le-tri-a-bulle" data-claire-element-id="378813">Le tri à bulle</h6><p id="r-378810" data-claire-element-id="378810">Cet algorithme de tri devrait vous être familier. Il s'agit du plus facile algorithme de tri qui existe. Il s'agit également du plus lent. Qu'à cela ne tienne, c'est celui que nous utiliserons. Ce sera plus simple. Dans un tri à bulle, on travaille avec deux boucles. Le but est de faire remonter les éléments les plus légers (ou les plus lourds si vous triez en ordre descendant) à la surface. Dans la premier tri, on s'affaire à trouver l'élément le plus petit en le comparant à l'élément au premier index. Si l'élément est plus léger, on échange leur place. Sinon, on ne fait rien. Puis, on continue notre scan de la liste à la recherche d'un valeur plus petite que le premier index. Lorsque le balayage est complet, on recommence un nouveau balayage mais avec l'éléments à l'index 2. On balaye alors la liste pour trouver le deuxième élément le plus léger. Puisque le premier est de toute manière à l'index 1 que l'on peut désormais ignorer, il suffit alors de trouver le plus léger dans les éléments qui sont à gauche des éléments déjà traités. Et on recommence jusqu'à ce que la liste soit triée au grand complet.</p><p id="r-378811" data-claire-element-id="378811"><a href="http://www.youtube.com/v/lUqFelc84XE">http://www.youtube.com/v/lUqFelc84XE</a><br/> Voici une animation qui vous montre comment fonctionne le tri à bulle.</p><p id="r-378812" data-claire-element-id="378812"><a href="http://www.youtube.com/v/t8g-iYGHpEA">http://www.youtube.com/v/t8g-iYGHpEA</a><br/> Je vous présente également différentes méthodes de tri.</p><h6 id="r-la-methode-de-comparaison" data-claire-element-id="378839">La méthode de comparaison</h6><p id="r-378814" data-claire-element-id="378814">La méthode de comparaison sera passée à la liste par un delegate. Le paramètre devra être anonyme, prendre en paramètre les deux éléments que nous voulons comparer (de type T) et retourner un <strong>int</strong> signifiant l'ordre de grandeur tel que :</p><table id="r-378837" data-claire-element-id="378837"><thead id="r-378820" data-claire-element-id="378820"><tr id="r-378819" data-claire-element-id="378819"><th id="r-378816" data-claire-element-id="378816"><p id="r-378815" data-claire-element-id="378815">Valeur</p></th><th id="r-378818" data-claire-element-id="378818"><p id="r-378817" data-claire-element-id="378817">Signification</p></th></tr></thead><tbody id="r-378836" data-claire-element-id="378836"><tr id="r-378825" data-claire-element-id="378825"><td id="r-378822" data-claire-element-id="378822"><p id="r-378821" data-claire-element-id="378821">-1 ou plus petit</p></td><td id="r-378824" data-claire-element-id="378824"><p id="r-378823" data-claire-element-id="378823">Dans un tri ascendant, cela signifie que le premier élément est plus <strong>petit </strong>que le deuxième.</p></td></tr><tr id="r-378830" data-claire-element-id="378830"><td id="r-378827" data-claire-element-id="378827"><p id="r-378826" data-claire-element-id="378826">0</p></td><td id="r-378829" data-claire-element-id="378829"><p id="r-378828" data-claire-element-id="378828">Signifie que la valeur est la même.</p></td></tr><tr id="r-378835" data-claire-element-id="378835"><td id="r-378832" data-claire-element-id="378832"><p id="r-378831" data-claire-element-id="378831">1 ou plus</p></td><td id="r-378834" data-claire-element-id="378834"><p id="r-378833" data-claire-element-id="378833">Dans un tri ascendant, cela signifie que le premier élément est plus <strong>grand </strong>que le deuxième.</p></td></tr></tbody></table><p id="r-378838" data-claire-element-id="378838">Le tout devra être réalisé dans une méthode <strong>Trier</strong>. Ne vous occupez pas du multi-threading pour le moment.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">
<span class="arrow"></span>
<span class="next">Travail Pratique</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
<span class="next">Solution à la partie 1</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Solutionlapartie1"></a><h2>Solution à la partie 1</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
<span class="arrow"></span>
<span class="next">La problématique</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
<span class="next">La suite</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-solution-a-la-partie-1" data-claire-element-id="378851">Solution à la partie 1</h4><div id="r-378843" data-claire-element-id="378843" data-claire-semantic="question"><p id="r-378842" data-claire-element-id="378842">Vous avez terminé la partie 1 du TP ? Merveilleux !!</p></div><div id="r-378845" data-claire-element-id="378845" data-claire-semantic="question"><p id="r-378844" data-claire-element-id="378844">Vous êtes désespéré de ne pas avoir trouvé la réponse ? Ce n'est pas grave. Nous allons voir ensemble la solution. Après tout, on apprend de ses erreurs comme on dit.</p></div><p id="r-378846" data-claire-element-id="378846">Tout d'abord, voici le code de la classe ListTriable.</p><pre id="r-378847" data-claire-element-id="378847"><code data-claire-semantic="csharp">public class ListeTriable&lt;T&gt;
{
    private T[] _liste = new T[4];
    public int Count { get; private set; }

    public ListeTriable()
    {
        Count = 0;
    }

    public T this[int i]
    {
        get
        {
            return _liste[i];
        }
    }

    public void Ajouter(T element)
    {
        //On multiplie la taille par deux si nécéssaire.
        if (_liste.Length &lt;= Count)
        {
            Array.Resize&lt;T&gt;(ref _liste, _liste.Length * 2);
        }

        //Ajout de l'élément à la fin de la liste et incrémentation du décompte d'éléments
        //dans la liste.
        _liste[Count++] = element;
    }

    public void Trier(Func&lt;T, T, int&gt; trieur)
    {
        //Tri à bulle.
        for (int i = 0; i &lt; Count - 1; i++)
        {
            for (int j = i + 1; j &lt; Count; j++)
            {
                int resultat = trieur.Invoke(_liste[i], _liste[j]);

                if (resultat &gt;= 1)
                {
                    //On échange les éléments de place si le deuxième élément est plus grand.
                    T element1 = _liste[i];
                    _liste[i] = _liste[j];
                    _liste[j] = element1;
                }
            }
        }
    }
}</code></pre><p id="r-378848" data-claire-element-id="378848">Voici pour le code dans le Main.</p><pre id="r-378849" data-claire-element-id="378849"><code data-claire-semantic="csharp">class Program
{
    static void Main(string[] args)
    {
        ListeTriable&lt;Personne&gt; liste = new ListeTriable&lt;Personne&gt;();

        liste.Ajouter(new Personne(&quot;Jo&quot;, &quot;Blow&quot;, 42));
        liste.Ajouter(new Personne(&quot;Karine&quot;, &quot;Jonas&quot;, 27));
        liste.Ajouter(new Personne(&quot;Germaine&quot;, &quot;Lachose&quot;, 68));
        liste.Ajouter(new Personne(&quot;Roger&quot;, &quot;Touzignant&quot;, 18));
        liste.Ajouter(new Personne(&quot;Hélène&quot;, &quot;D'Amour&quot;, 27));
        liste.Ajouter(new Personne(&quot;Bob&quot;, &quot;Gêné&quot;, 12));

        //On tri selon la logique spécifiée...
        liste.Trier(delegate(Personne p1, Personne p2)
        {
            return p1.Age - p2.Age;
        });

        for (int i = 0; i &lt; liste.Count; i++)
        {
            Console.WriteLine(liste[i]);
        }

        Console.ReadKey();
    }
}</code></pre><p id="r-378850" data-claire-element-id="378850">Et voilà, ce n'était pas si compliqué, mais cet exercice mettait à profit ce qu'on avait vu avec les delegates et les méthodes anonymes. Comme promis, la classe Personne reste intouchée. Sachez cependant qu'on aurait également pu passer par une interface qui se nomme <code data-claire-semantic="csharp">IComparable&lt;T&gt;</code> et qui permet de spécifier la méthode de tri à l'intérieur même d'une classe.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
<span class="arrow"></span>
<span class="next">La problématique</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
<span class="next">La suite</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lasuite"></a><h2>La suite</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
<span class="arrow"></span>
<span class="next">Solution à la partie 1</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
<span class="next">Solution à la partie 2</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-la-suite-1" data-claire-element-id="378859">La suite</h4><p id="r-378852" data-claire-element-id="378852">Voilà, maintenant que votre superbe liste est en production et que tout le monde dans la compagnie l'utilise, on trouve qu'elle est un peu lente lorsqu'il y a beaucoup d'éléments dedans. Vous décidez donc de mettre à profit tous les coeurs dans le processeur de l'ordinateur afin de faire avancer les choses en parallèle plutôt qu'un à la fois.</p><h5 id="r-enonce-47" data-claire-element-id="378858">Énoncé</h5><p id="r-378853" data-claire-element-id="378853">Modernisez votre méthode de tri afin qu'elle prenne en considération le multi-threading. Cependant, puisque vous utilisez un composant qui est en production en ce moment, il est conseillé d'implémenter cette statégie par le biais d'une nouvelle méthode : <strong>DebuterTri</strong>.</p><p id="r-378854" data-claire-element-id="378854">Cette méthode s'apparentera aux méthodes asynchrones dont nous parlerons plus tard. On appellera la méthode DebuterTri en lui spécifiant comment trier. Cependant, on spécifiera également quelle méthode appeller lorsque le tri sera terminé. Le deuxième argument est ce qu'on appelle un <strong>Callback</strong>. Une fois l'action terminée, on appellera cette méthode.</p><p id="r-378855" data-claire-element-id="378855">Attention, il ne s'agit pas de créer un algorithme de tri en multi-thread, mais bien de séparer l'action de trier du thread principal.</p><aside id="r-378857" data-claire-element-id="378857" data-claire-semantic="warning"><p id="r-378856" data-claire-element-id="378856">N'oubliez pas de penser à la sécurité de vos éléments ! :colere2:</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
<span class="arrow"></span>
<span class="next">Solution à la partie 1</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
<span class="next">Solution à la partie 2</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Solutionlapartie2"></a><h2>Solution à la partie 2</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
<span class="arrow"></span>
<span class="next">La suite</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">
<span class="next">La théorie de départ</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-solution-a-la-partie-2" data-claire-element-id="378875">Solution à la partie 2</h4><p id="r-378860" data-claire-element-id="378860">Et voilà, vous devriez avoir réussi à implémenter la gestion multi-tâche dans cette liste.</p><p id="r-378861" data-claire-element-id="378861">Personnellement, j'ai choisi de faire la sécurité par Mutex par soucis de lisibilité. Voici ma solution.</p><h6 id="r-listetriable-cs" data-claire-element-id="378863">ListeTriable.cs</h6><pre id="r-378862" data-claire-element-id="378862"><code data-claire-semantic="csharp">public void DebuterTri(Func&lt;T, T, int&gt; trieur, Action&lt;ListeTriable&lt;T&gt;&gt; callback)
{
    //On démarre le nouveau thread.
    Thread sortThread = new Thread(delegate()
    {
        //Sécurité par Mutex.
        _security.WaitOne();

        for (int i = 0; i &lt; Count - 1; i++)
        {
            for (int j = i + 1; j &lt; Count; j++)
            {
                int resultat = trieur.Invoke(_liste[i], _liste[j]);

                if (resultat &gt;= 1)
                {
                    T element1 = _liste[i];
                    _liste[i] = _liste[j];
                    _liste[j] = element1;
                }
            }
        }

        //Et on relâche la sécurité.
        _security.ReleaseMutex();

        //On invoque la méthode rappel si elle est défini.
        if (callback != null)
            callback.Invoke(this);
    });

    //Démarrage du thread de tri.
    sortThread.Start();
}</code></pre><h6 id="r-program-cs-1" data-claire-element-id="378874">Program.cs</h6><pre id="r-378864" data-claire-element-id="378864"><code data-claire-semantic="csharp">class Program
{
    static void Main(string[] args)
    {
        ListeTriable&lt;Personne&gt; liste = new ListeTriable&lt;Personne&gt;();

        liste.Ajouter(new Personne(&quot;Jo&quot;, &quot;Blow&quot;, 42));
        liste.Ajouter(new Personne(&quot;Karine&quot;, &quot;Jonas&quot;, 27));
        liste.Ajouter(new Personne(&quot;Germaine&quot;, &quot;Lachose&quot;, 68));
        liste.Ajouter(new Personne(&quot;Roger&quot;, &quot;Touzignant&quot;, 18));
        liste.Ajouter(new Personne(&quot;Hélène&quot;, &quot;D'Amour&quot;, 27));
        liste.Ajouter(new Personne(&quot;Bob&quot;, &quot;Gêné&quot;, 12));

        liste.DebuterTri(delegate(Personne p1, Personne p2)
        {
            return p1.Age - p2.Age;
        }, TriFin);
    }

    private static void TriFin(ListeTriable&lt;Personne&gt; liste)
    {
        for (int i = 0; i &lt; liste.Count; i++)
        {
            Console.WriteLine(liste[i]);
        }

        Console.ReadKey();
    }
}</code></pre><p id="r-378865" data-claire-element-id="378865">Remarquez maintenant que ma liste est thread-safe. Si j'essayais d'ajouter un élément à la liste, il serait soit ajouté avant le tri, soit ajouté après le tri. Jamais pendant. Et c'est ce que nous recherchons comme comportement.</p><aside id="r-378867" data-claire-element-id="378867" data-claire-semantic="information"><p id="r-378866" data-claire-element-id="378866">Sans même vous en rendre compte, vous avez commencer à programmer véritablement en asynchrone. Nous utiliserons beaucoup de ce type de méthodes lorsque nous serons en réseau. Cela nous évitera bien souvent d'avoir à gérer les threads manuellement.</p></aside><h5 id="r-defi-supplementaire" data-claire-element-id="378873">Défi supplémentaire</h5><p id="r-378868" data-claire-element-id="378868">Si vous voulez un défi supplémentaire, vous pouvez essayer d'incorporer le tout dans une Windows Forms.</p><aside id="r-378870" data-claire-element-id="378870" data-claire-semantic="information"><p id="r-378869" data-claire-element-id="378869">Mes félicitations pour ce premier Travail Pratique. Vous pouvez être fiers de vous ! Nous allons maintenant pouvoir enchaîner avec la programmation réseau.</p></aside><p id="r-378871" data-claire-element-id="378871">J'espère que vous avez apprécié le premier TP de ce cours. Il n'était pas excessivement long, mais devrait vous avoir permis de consolider vos connaissances. Les prochains TP devraient plus ardus car ils traiteront de communication réseau. Vous devrez donc mettre à contribution toutes vos connaissances, y compris (et surtout) les delegates, mais aussi les threads.</p><p id="r-378872" data-claire-element-id="378872">Puisque cette partie était très théorique, je vous conseille de vous atteler à quelques exercices et exemples. Nous aurons plus d'occasions de tester ces connaissances lorsque nous aborderons la programmation réseau.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
<span class="arrow"></span>
<span class="next">La suite</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">
<span class="next">La théorie de départ</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lathoriededpart"></a><h2>La théorie de départ</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
<span class="arrow"></span>
<span class="next">Solution à la partie 2</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
<span class="next">Organisation des réseaux</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-378879" data-claire-element-id="378879">Bon, avant de mettre en application tout ce qu'on a appris dans la section précédente, il nous faudra apprendre quelques bases. Quand ça plantera (car ça plantera très certainement dans un premier temps), vous trouverez cette théorie cruciale. Je dois vous avouer que parfois, lorsque nos codes devraient fonctionner et que ce n'est pas le cas, des envies de meurtres peuvent nous prendre. Qu'à cela ne tienne, revenez aux bases exposées dans ce chapitre en premier lieu, puis allez consulter votre bon ami Google si le problème n'est pas résolu. Si vous ne trouvez toujours pas réponse, mettez votre projet de côté et ouvrez un billet dans notre merveilleux forum. Les chances sont que tous ensemble, nous parviendrons à trouver une réponse au problème.</p><p id="r-378880" data-claire-element-id="378880">Mais n'oubliez pas, <strong>revenez aux théories de ce chapitre en premier lieu</strong>. Le problème est bien souvent ce qu'on appelle un code 18 (c'est-à-dire situé 18 pouces en avant de l'écran) ou une erreur de logique. Vous l'aurez compris, la lecture de ce chapitre n'est pas facultative... o_O</p>
</div><a name="Organisationdesrseaux"></a><h2>Organisation des réseaux</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">
<span class="arrow"></span>
<span class="next">La théorie de départ</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
<span class="next">Le protocole UDP</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-organisation-des-reseaux" data-claire-element-id="378953">Organisation des réseaux</h4><p id="r-378881" data-claire-element-id="378881">Les réseaux informatiques peuvent aisément être comparés au réseau routier métropolitain. Parfois, il peut y avoir des bouchons de circulation. Dans les villes les plus grandes, on ne retrouve que rarement un seul chemin pour se rendre à la même place. De plus, chacune des maisons de ces villes détient une identification unique (un numéro de porte ainsi qu'une rue). Vous allez voir qu'il en va de même en informatique.</p><h5 id="r-comment-l-information-transige-t-elle-sur-le-reseau" data-claire-element-id="378887">Comment l'information transige-t-elle sur le réseau ?</h5><p id="r-378882" data-claire-element-id="378882">Au début des communications entre postes, certains experts se sont penchés sur les problèmes que posaient ces échanges. Croyez-moi, les troubles étaient nombreux. Les spécialistes ont donc établi de nombreuses normes et spécifications que nous utilisons encore. Voici ce qu'ils ont créé.</p><figure id="r-modeles-tcp-ip-et-osi" data-claire-element-id="378885"><img id="r-378883" data-claire-element-id="378883" src="medias/uploads.siteduzero.com_files_388001_389000_388976.png" alt="Modèles TCP/IP et OSI"/><figcaption>Modèles TCP/IP et OSI</figcaption></figure><p id="r-378886" data-claire-element-id="378886">À gauche, vous retrouvez le modèle TCP/IP. C'est le plus vieux d'entre eux et c'est celui qui a été implémenté avec le plus de succès. Cependant, le modèle OSI (le modèle de droite) est celui qui est reconnu comme le meilleur. De toute manière, de notre perspective, cela ne change pas grand-chose. Ce sont les couches Applications, TCP / UDP et IP qui nous intéresserons le plus. Laissez-moi vous expliquer un peu comment fonctionnent ces couches.</p><h5 id="r-le-principe-de-couches" data-claire-element-id="378950">Le principe de couches</h5><p id="r-378888" data-claire-element-id="378888">Les modèles que vous voyez ci-dessus tirent leurs forces de leur conception en couches. En effet, chacune est indépendante des autres, et c'est tant mieux. Cela signifie que chacun des composants du modèle peu être aisément remplacé. En tant que programmeur nous nous occuperons seulement de la couche &quot;Application&quot;, car elle nous est réservée. Nous ne programmerons pas les couches plus basses. Ce sera le système d'opération et le framework qui s'en chargeront. Comme ça, nous n'aurons pas à réinventer la roue et cela nous permettra de vraiment personnaliser ce que nous désirons plutôt que de perdre du temps à reprogrammer des normes déjà bien fonctionnelles.</p><h6 id="r-la-couche-physique" data-claire-element-id="378890">La couche Physique</h6><p id="r-378889" data-claire-element-id="378889">La couche physique est la couche qui gère l'entrée et la sortie physique des bits. Généralement, cette partie incombe à votre carte mère ou à votre carte réseau. En tant que programmeur, il est peu intéressant de s'aventurer dans cette partie du modèle TCP/IP.</p><h6 id="r-la-couche-de-liaison-de-donnees" data-claire-element-id="378892">La couche de liaison de données</h6><p id="r-378891" data-claire-element-id="378891">Encore une autre couche qui sera peu intéressante pour nous. Cette couche se charge de gérer les protocoles de bas niveau afin de bien établir les connexions entre les intervenants. Dans certains cas, elle sera capable d'anticiper et de corriger les erreurs de la couche physique. Les protocoles qui sont gérés sont notamment Ethernet, PPP, HDLC et j'en passe. Bref, tant que ça fonctionne à ce niveau-là, nous serons heureux ! C'est dans cette couche que l'on gère les adresses MAC qui permettent d'identifier de façon presque unique un composant. Après avoir passé par cette couche, les données sont deviennent ce que l'on appelle des trames et sont prêtes à être envoyées sur le réseau physique. <a href="http://fr.wikipedia.org/wiki/Couche_liaison_de_données">Voici le lien Wikipédia si vous désirez en apprendre plus sur la couche de liaison de données.</a></p><h6 id="r-la-couche-ip-ou-couche-reseau" data-claire-element-id="378900">La couche IP (ou couche réseau)</h6><p id="r-378893" data-claire-element-id="378893">La couche IP se charge de créer une connexion bout-à-bout avec les membres d'un réseau qui désirent se parler. Bien que nous n'allons jamais intervenir à ce niveau, ça commence à nous intéresser. En effet, cette couche utilise une norme dont vous avez sûrement déjà entendu parler : les adresses IP.</p><p id="r-378894" data-claire-element-id="378894">Les adresses IP sont une façon d'identifier logiquement, efficacement et de manière unique un intervenant dans un niveau de réseau donné. Attention, une adresse IP est unique dans le réseau dans laquelle elle est défini. Passé ce niveau, il faudra faire preuve de ruse et utiliser ce qu'on appelle un NAT. Il existe actuellement deux versions en circulation de ce fameux protocole. Le premier, le plus vieux, est le IPv4. Vous utilisez probablement du IPv4 à la maison pour votre réseau local. Les adresses sont formatées comme suit : 192.168.1.1 .</p><p id="r-378895" data-claire-element-id="378895">La dernière version du protocol, le IPv6, est basé en hexadécimal et devrait fournir assez d'adresses uniques pour couvrir plusieurs centaines de fois les besoins actuels en terme d'adressage pour Internet. La montée des téléphones intelligents et des pays du tiers-monde en terme de technologie nous force en ce moment à mettre de l'avant l'IPv6 pour les besoins d'Internet. Les chances sont que les réseaux locaux resteront en IPv4. Voici à quoi ressemblent les adresses dans les deux protocoles.</p><pre id="r-378896" data-claire-element-id="378896"><code>IPv4 : 192.168.1.104
IPv6 : 2001:0db8:85a3:0000:0000:8a2e:0370:7334</code></pre><p id="r-378897" data-claire-element-id="378897">On voit que les adresses IPv6 sont beaucoup plus grandes et permettent donc <strong>BEAUCOUP</strong> plus de possibilités. Espérons que ce standard résistera de nombreuses années. Si vous voulez en savoir plus sur ce standard, je vous invite à visiter la page de <a href="http://fr.wikipedia.org/wiki/IPv6">Wikipédia à ce sujet</a>. Sachez cependant que nous n'en aurons pas vraiment besoin dans ce tutoriel. En effet, les réseaux domestiques sont plus souvent en IPv4 car ils n'ont pas besoin d'une aussi grande multitude d'adresses. Un jour, peut-être. En attendant, nous utiliserons surtout l'IPv4. De toute manière, .NET est d'ores et déjà dotés de classes qui gèrent l'IPv6, juste au cas.</p><p id="r-378898" data-claire-element-id="378898">Ce qu'il faut retenir des adresses IP, c'est que c'est un moyen efficace pour identifier un interlocuteur. Attention cependant, car ces adresses sont logiques et dynamiques dans la plupart des réseaux. Cela les amène à changer selon le protocole DHCP lorsqu'elles ne sont pas statiques.</p><p id="r-378899" data-claire-element-id="378899">De plus, il est important de retenir que certaines adresses IP sont réservées afin d'offrir certaines fonctionnalités particulières. Entre autres, la dernière adresse d'un sous-réseau est utilisé afin de faire ce que l'on appelle du <strong>broadcast</strong>, c'est-à-dire une diffusion de message à tous les interlocuteurs du sous-réseau. Il y a aussi l'adresse 127.0.0.1 qui est retenue afin de s'autoréférencer. C'est ce qu'on appelle le <strong>localhost</strong>. <a href="http://fr.wikipedia.org/wiki/Adresse_IP">Je vous invite à en lire plus sur certaines plages d'adresses réservées à certains usages, comme le <strong>multicast</strong> et les réseaux locaux.</a> Il est intéressant, à des fins de nomenclature, de dire que les données transitant par la couche IP se transforment en ce qu'on appelle des <em>paquets</em>.</p><h6 id="r-la-couche-tcp-udp-ou-couche-transport" data-claire-element-id="378945">La couche TCP / UDP (ou couche Transport)</h6><p id="r-378901" data-claire-element-id="378901">Cette couche nous sera très familière à la suite de ce tutoriel. Son travail consiste à encadrer la transmission de données en découpant les données en <em>segments</em>. Ce sont ces segments qui seront envoyés dans la couche IP afin d'être traités afin de devenir des paquets. Il existe deux grands protocoles dans cette couche : TCP et UDP. Nous verrons les avantages et les inconvénients de chacun des protocoles, en débutant par l'UDP que je considère plus simple. Ces protocoles définissent comment la communication sera établie, avec quelles règles et sous quelles conditions. Cependant, peu importe lequel de deux protocoles qui sera utilisé, un concept important intervient à ce niveau : celui de port.</p><p id="r-378902" data-claire-element-id="378902">En effet, nous savons tous aujourd'hui à quel point nos machines sont pensées et orientées multitâches. Ainsi, pendant que vous lisez ce tutoriel, il se peut fort bien que vous téléchargiez un logiciel, que vous clavardiez avec vos amis. Afin de permettre à tout ce beau monde de se parler en même temps (ou presque), on a inventé le concept de <strong>Ports</strong>. Un port permet d'acheminer les données à la bonne application une fois le segment rendu à destination sur le réseau. Comme avec les adresses IP, certains ports sont retenus afin d'offrir des services bien connus. Chaque protocole compte 65536 possibilités de port, en débutant par le 0. Les ports en dessous de 1024 nécessitent un enregistrement et plusieurs d'entre eux servent énormément. En parallèle, ceux qui se situent au dessus de 49152 (inclusivement) ne peuvent être réservés et servent de ports dynamiques. Par exemple, pour lire cette page web, votre requête s'est adressée au port 80 du serveur du Site du Zéro, car HTTP est un service bien connu et associé au port 80. De votre côté, le port utilisé pour ouvrir la connexion a été pigé aléatoirement dans le bassin de ports se situant entre 1025 et 49152.</p><aside id="r-378904" data-claire-element-id="378904" data-claire-semantic="warning"><p id="r-378903" data-claire-element-id="378903">Chaque interlocuteur doit identifier ses ports de communication. Le serveur a un port fixe pour communiquer, tandis que le client réserve généralement un port aléatoire dans la zone désignée.</p></aside><p id="r-378905" data-claire-element-id="378905">Je vous fais une liste non-exhaustive des ports les plus populaires :</p><table id="r-378943" data-claire-element-id="378943"><thead id="r-378911" data-claire-element-id="378911"><tr id="r-378910" data-claire-element-id="378910"><th id="r-378907" data-claire-element-id="378907"><p id="r-378906" data-claire-element-id="378906"># Port</p></th><th id="r-378909" data-claire-element-id="378909"><p id="r-378908" data-claire-element-id="378908">Description</p></th></tr></thead><tbody id="r-378942" data-claire-element-id="378942"><tr id="r-378916" data-claire-element-id="378916"><td id="r-378913" data-claire-element-id="378913"><p id="r-378912" data-claire-element-id="378912">20 / 21</p></td><td id="r-378915" data-claire-element-id="378915"><p id="r-378914" data-claire-element-id="378914">File Transfer Protocol (FTP).</p></td></tr><tr id="r-378921" data-claire-element-id="378921"><td id="r-378918" data-claire-element-id="378918"><p id="r-378917" data-claire-element-id="378917">25</p></td><td id="r-378920" data-claire-element-id="378920"><p id="r-378919" data-claire-element-id="378919">SMTP (envoie de courriels)</p></td></tr><tr id="r-378926" data-claire-element-id="378926"><td id="r-378923" data-claire-element-id="378923"><p id="r-378922" data-claire-element-id="378922">53</p></td><td id="r-378925" data-claire-element-id="378925"><p id="r-378924" data-claire-element-id="378924">Résolution de noms (DNS).</p></td></tr><tr id="r-378931" data-claire-element-id="378931"><td id="r-378928" data-claire-element-id="378928"><p id="r-378927" data-claire-element-id="378927">80 /443</p></td><td id="r-378930" data-claire-element-id="378930"><p id="r-378929" data-claire-element-id="378929">HTTP / HTTPS - Consultation de Pages Web.</p></td></tr><tr id="r-378936" data-claire-element-id="378936"><td id="r-378933" data-claire-element-id="378933"><p id="r-378932" data-claire-element-id="378932">110 / 143</p></td><td id="r-378935" data-claire-element-id="378935"><p id="r-378934" data-claire-element-id="378934">POP3 / IMAP - Récupération de courriels.</p></td></tr><tr id="r-378941" data-claire-element-id="378941"><td id="r-378938" data-claire-element-id="378938"><p id="r-378937" data-claire-element-id="378937">389</p></td><td id="r-378940" data-claire-element-id="378940"><p id="r-378939" data-claire-element-id="378939">Connexion à un context LDAP (Active Directory).</p></td></tr></tbody></table><p id="r-378944" data-claire-element-id="378944">Vous pouvez consulter une <a href="http://fr.wikipedia.org/wiki/Liste_des_ports_logiciels">liste plus complète des ports bien connus et réservés sur Wikipédia</a>. Tout port qui est au dessus de 1024 (exclusivement), mais en dessous de 65535 (inclusivement) est libre de réservation. Bien souvent, nous choisirons notre port serveur aléatoirement. Réserver un port coûte de l'argent et c'est un luxe un peu inutile à mon avis.</p><h6 id="r-la-couche-application" data-claire-element-id="378949">La couche Application</h6><p id="r-378946" data-claire-element-id="378946">C'est ici que nous interviendrons. Du moins, en partie. N'oubliez pas que lorsque l'on programmera, on héritera également de toute l'infrastructure .NET qui nous donnera un franc coup de main afin d'utiliser les couches sous-jacentes. C'est ici que l'on pourra se lâcher lousse et inventer nos propres protocoles de communication de haut niveau. Il nous appartiendra de structurer les données comme bon nous semblera. Par contre, comme nous le verrons, certaines techniques seront préférables à d'autres.</p><aside id="r-378948" data-claire-element-id="378948" data-claire-semantic="information"><p id="r-378947" data-claire-element-id="378947">La couche Application considère les échanges réseaux comme des <em>messages </em>et voit seulement le résultat final comme si les couches inférieures n'existaient pas. De plus, ce sont les applications qui s'abonnent à un port qui est relié à la couche Transport, et pas le contraire.</p></aside><h5 id="r-recapitulatif-9" data-claire-element-id="378952">Récapitulatif</h5><p id="r-378951" data-claire-element-id="378951">Bien, après toutes ces explications, vous devriez commencer à comprendre la complexité de communiquer en réseau. Je vous assure que maintenant que vous pensez que c'est compliqué, ça ne peut que se simplifier. Les deux concepts les plus importants à retenir du modèle TCP/IP sont les adresses IP et les ports.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">
<span class="arrow"></span>
<span class="next">La théorie de départ</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
<span class="next">Le protocole UDP</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="LeprotocoleUDP"></a><h2>Le protocole UDP</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
<span class="arrow"></span>
<span class="next">Organisation des réseaux</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
<span class="next">Les types de communication</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-le-protocole-udp-1" data-claire-element-id="378982">Le protocole UDP</h4><p id="r-378954" data-claire-element-id="378954">Le protocole UDP, soit <em>User Datagram Protocol</em>, est le plus simple des deux protocoles. On peut le comparer à un service d'envoi de lettres, car il s'agit d'un protocole dit <em>sans connexion</em>. En UDP, il n'y a aucune garantie que les messages arriveront à destination dans l'ordre. En fait, il n'y a même pas de garantie que les messages arriveront du court. On assume que la couche Application se chargera de vérifier l'intégrité des données. Cependant, ce manque de rigueur s'accompagne de bien meilleures performances. Vous l'aurez deviné, on utilise l'UDP dans les systèmes de communication où la performance est critique. Par exemple, le logiciel de téléphonie Skype. Peu importe si quelques paquets manquent, l'essentiel est que les paquets se rendent le plus rapidement possible afin de constituer une conversation fluide.</p><h6 id="r-inconvenients-3" data-claire-element-id="378962">Inconvénients</h6><ul id="r-378961" data-claire-element-id="378961"><li id="r-378956" data-claire-element-id="378956"><p id="r-378955" data-claire-element-id="378955">Aucune rigueur dans l'ordre d'arrivée des paquets.</p></li><li id="r-378958" data-claire-element-id="378958"><p id="r-378957" data-claire-element-id="378957">Aucune vérification quant à l'arrivée à destination des paquets.</p></li><li id="r-378960" data-claire-element-id="378960"><p id="r-378959" data-claire-element-id="378959">Protocole non-fiable pour ce qui est de la qualité des communications.</p></li></ul><h6 id="r-avantages-4" data-claire-element-id="378972">Avantages</h6><ul id="r-378971" data-claire-element-id="378971"><li id="r-378964" data-claire-element-id="378964"><p id="r-378963" data-claire-element-id="378963">Communication sans connexion (plus facile).</p></li><li id="r-378966" data-claire-element-id="378966"><p id="r-378965" data-claire-element-id="378965">Parfait pour les services où la vitesse est critique.</p></li><li id="r-378968" data-claire-element-id="378968"><p id="r-378967" data-claire-element-id="378967">Possibilité de communiquer à plusieurs clients à la fois à l'aide du <strong>broadcasting</strong> et du <strong>multicasting</strong>.</p></li><li id="r-378970" data-claire-element-id="378970"><p id="r-378969" data-claire-element-id="378969">Permet l'envoie des données en <strong>broadcast</strong> très facilement (à l'aide de l'adresse réservée à cette fin).</p></li></ul><h6 id="r-utilisations-1" data-claire-element-id="378981">Utilisations</h6><ul id="r-378979" data-claire-element-id="378979"><li id="r-378974" data-claire-element-id="378974"><p id="r-378973" data-claire-element-id="378973">Téléphonie IP.</p></li><li id="r-378976" data-claire-element-id="378976"><p id="r-378975" data-claire-element-id="378975">Protocole DNS (résolution de noms de domaine).</p></li><li id="r-378978" data-claire-element-id="378978"><p id="r-378977" data-claire-element-id="378977">Protocole DHCP (assignation d'adresse IP de manière dynamique).</p></li></ul><p id="r-378980" data-claire-element-id="378980">Bref, vous l'aurez compris, quand on ne sait pas à qui l'on parle ou même si l'on parle à quelqu'un, quand on a un besoin critique de performance ou que l'on ne veut pas implémenter une structure de données trop lourde, on préféra utiliser l'UDP.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
<span class="arrow"></span>
<span class="next">Organisation des réseaux</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
<span class="next">Les types de communication</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lestypesdecommunication"></a><h2>Les types de communication</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
<span class="arrow"></span>
<span class="next">Le protocole UDP</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
<span class="next">Les outils</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-types-de-communication" data-claire-element-id="378996">Les types de communication</h4><p id="r-378983" data-claire-element-id="378983">Les communications réseau peuvent s'organiser en plusieurs modèles. Le premier, le plus classique, est le modèle <strong>Client-Serveur</strong>. Le second, un peu plus difficile, est le modèle <strong>Peer-To-Peer</strong>.</p><h5 id="r-le-modele-client-serveur-2" data-claire-element-id="378988">Le modèle Client-Serveur</h5><p id="r-378984" data-claire-element-id="378984">Ce modèle s'organise sur un mode centralisé. Les clients feront des demandes à une application centralisée. On parlera d'ailleurs d'application serveur, mais par abus de langage, on dira simplement <strong>serveur</strong>. Ce serveur sera spécialisé à offrir un ou plusieurs services à tous ceux qui le demandent. Vous pouvez penser à votre jeu en ligne favori, il fonctionne très probablement sur ce modèle. Le Web et les serveurs qui répondent à vos requêtes fonctionnent également comme cela. C'est ce modèle que l'on développera dans la plupart des cas.</p><figure id="r-modele-client-serveur" data-claire-element-id="378987"><img id="r-378985" data-claire-element-id="378985" src="medias/uploads.siteduzero.com_files_388001_389000_388987.png" alt="Modèle Client-Serveur"/><figcaption>Modèle Client-Serveur</figcaption></figure><h5 id="r-le-modele-peer-to-peer-point-a-point" data-claire-element-id="378993">Le modèle Peer-To-Peer (point-à-point)</h5><p id="r-378989" data-claire-element-id="378989">Le modèle point-à-point est considéré plus complexe. Chaque client agit également en tant que serveur. Si vous pensez au modèle des <em>torrents</em> et des téléchargements en P2P, vous comprendrez mieux.</p><figure id="r-modele-peer-to-peer" data-claire-element-id="378992"><img id="r-378990" data-claire-element-id="378990" src="medias/uploads.siteduzero.com_files_388001_389000_388988.png" alt="Modèle Peer-To-Peer"/><figcaption>Modèle Peer-To-Peer</figcaption></figure><h5 id="r-les-autres-modeles" data-claire-element-id="378995">Les autres modèles</h5><p id="r-378994" data-claire-element-id="378994">Il existe d'autres types de modèle. Par exemple, il existe des modes hybrides qui font en sorte qu'un noeud central existe, mais que chaque client est également capable d'être un serveur. Le logiciel de contrôle de source <strong>Git</strong> est un bon exemple de ce mode hybride. Cependant, les logiciels de ce type sont plus rares.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
<span class="arrow"></span>
<span class="next">Le protocole UDP</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
<span class="next">Les outils</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesoutils"></a><h2>Les outils</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
<span class="arrow"></span>
<span class="next">Les types de communication</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">
<span class="next">Première communication</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-outils-3" data-claire-element-id="379087">Les outils</h4><p id="r-378997" data-claire-element-id="378997">Afin de nous aider à programmer en réseau et afin de diagnostiquer certains problèmes qui pourraient survenir, je vous conseille d'installer le logiciel <a href="http://www.wireshark.org/">Wireshark</a>. Ce logiciel est ce qu'on appelle un <strong>analysateur de paquets</strong>. En plus, il est gratuit et très bien conçu. Il est disponible pour Windows (32 bits et 64 bits) et pour Mac OS X.</p><figure id="r-wireshark" data-claire-element-id="379000"><img id="r-378998" data-claire-element-id="378998" src="medias/uploads.siteduzero.com_files_388001_389000_388983.png" alt="Wireshark"/><figcaption>Wireshark</figcaption></figure><h5 id="r-comment-utiliser-wireshark" data-claire-element-id="379075">Comment utiliser Wireshark</h5><p id="r-379001" data-claire-element-id="379001">Wireshark est capable d'enregistrer ou de capter en temps réel les échanges réseau qui surviennent sur votre ordinateur. Ainsi, si vous voulez voir ce qui se passe plus en détail, c'est le logiciel à avoir. De plus, il offre de puissantes fonctionnalités de tri qui permettent de faire des recherches rapides. Cependant, son interface peut paraître austère à première vue.</p><figure id="r-l-ecran-d-accueil-de-wireshark" data-claire-element-id="379004"><img id="r-379002" data-claire-element-id="379002" src="medias/uploads.siteduzero.com_files_388001_389000_388984.png" alt="L'écran d'accueil de Wireshark"/><figcaption>L'écran d'accueil de Wireshark</figcaption></figure><p id="r-379005" data-claire-element-id="379005">Afin de commencer la capture, sélectionnez la bonne interface réseau (<em>Realtek PCIe GBE Family Controller</em> dans mon cas) et appuyez sur le bouton <strong>Start</strong>. La capture en temps réel commence à ce moment-là. Vous serez probablement inondé de paquets qui sortent d'on ne sait trop où. Si vous en avez marre de recevoir un flot constant de données alors que vous avez déjà tout ce qu'il vous faut, vous pouvez appuyer sur le bouton d'arrêt de la capture qui est le 4e bouton dans la barre d'outils en partant de la gauche.</p><p id="r-379006" data-claire-element-id="379006">J'attire aussi votre attention sur la barre de filtre qui se situe juste en dessous de la barre d'outils. Cette fonctionnalité permet de trier instantanément les échanges enregistrées pour ne conserver que ce qui vous intéresse. Le bouton <strong>Expression...</strong> qui se situe juste à droite vous aidera avec la syntaxe. Les filtres les plus courants sont les suivants.</p><table id="r-379072" data-claire-element-id="379072"><thead id="r-379016" data-claire-element-id="379016"><tr id="r-379015" data-claire-element-id="379015"><th id="r-379008" data-claire-element-id="379008"><p id="r-379007" data-claire-element-id="379007">Filtre</p></th><th id="r-379010" data-claire-element-id="379010"><p id="r-379009" data-claire-element-id="379009">Opérateur</p></th><th id="r-379012" data-claire-element-id="379012"><p id="r-379011" data-claire-element-id="379011">Valeur</p></th><th id="r-379014" data-claire-element-id="379014"><p id="r-379013" data-claire-element-id="379013">Effet</p></th></tr></thead><tbody id="r-379071" data-claire-element-id="379071"><tr id="r-379025" data-claire-element-id="379025"><td id="r-379018" data-claire-element-id="379018"><p id="r-379017" data-claire-element-id="379017">tcp</p></td><td id="r-379020" data-claire-element-id="379020"><p id="r-379019" data-claire-element-id="379019">-</p></td><td id="r-379022" data-claire-element-id="379022"><p id="r-379021" data-claire-element-id="379021">-</p></td><td id="r-379024" data-claire-element-id="379024"><p id="r-379023" data-claire-element-id="379023">Ne garde que les paquets qui utilisent le protocole TCP.</p></td></tr><tr id="r-379034" data-claire-element-id="379034"><td id="r-379027" data-claire-element-id="379027"><p id="r-379026" data-claire-element-id="379026">udp</p></td><td id="r-379029" data-claire-element-id="379029"><p id="r-379028" data-claire-element-id="379028">-</p></td><td id="r-379031" data-claire-element-id="379031"><p id="r-379030" data-claire-element-id="379030">-</p></td><td id="r-379033" data-claire-element-id="379033"><p id="r-379032" data-claire-element-id="379032">Ne garde que les paquets qui utilisent le protocole UDP.</p></td></tr><tr id="r-379043" data-claire-element-id="379043"><td id="r-379036" data-claire-element-id="379036"><p id="r-379035" data-claire-element-id="379035">tcp.srcport</p></td><td id="r-379038" data-claire-element-id="379038"><p id="r-379037" data-claire-element-id="379037">==</p></td><td id="r-379040" data-claire-element-id="379040"><p id="r-379039" data-claire-element-id="379039">Port d'origine</p></td><td id="r-379042" data-claire-element-id="379042"><p id="r-379041" data-claire-element-id="379041">Ne conserve que les paquets qui ont comme port d'origine la valeur spécifiée. Existe également en UDP avec le préfix udp.</p></td></tr><tr id="r-379052" data-claire-element-id="379052"><td id="r-379045" data-claire-element-id="379045"><p id="r-379044" data-claire-element-id="379044">tcp.dstport</p></td><td id="r-379047" data-claire-element-id="379047"><p id="r-379046" data-claire-element-id="379046">==</p></td><td id="r-379049" data-claire-element-id="379049"><p id="r-379048" data-claire-element-id="379048">Port de destination</p></td><td id="r-379051" data-claire-element-id="379051"><p id="r-379050" data-claire-element-id="379050">Ne conserve que les paquets qui ont comme port de destination la valeur spécifiée. Existe également en UDP avec le préfix udp.</p></td></tr><tr id="r-379061" data-claire-element-id="379061"><td id="r-379054" data-claire-element-id="379054"><p id="r-379053" data-claire-element-id="379053">ip.src</p></td><td id="r-379056" data-claire-element-id="379056"><p id="r-379055" data-claire-element-id="379055">==</p></td><td id="r-379058" data-claire-element-id="379058"><p id="r-379057" data-claire-element-id="379057">Adresse IP Source</p></td><td id="r-379060" data-claire-element-id="379060"><p id="r-379059" data-claire-element-id="379059">Ne conserve que les paquets qui proviennent de l'adresse IP spécifiée.</p></td></tr><tr id="r-379070" data-claire-element-id="379070"><td id="r-379063" data-claire-element-id="379063"><p id="r-379062" data-claire-element-id="379062">ip.dst</p></td><td id="r-379065" data-claire-element-id="379065"><p id="r-379064" data-claire-element-id="379064">==</p></td><td id="r-379067" data-claire-element-id="379067"><p id="r-379066" data-claire-element-id="379066">Adresse IP de destination</p></td><td id="r-379069" data-claire-element-id="379069"><p id="r-379068" data-claire-element-id="379068">Ne conserve que les paquets qui se rendent à l'adresse IP spécifiée.</p></td></tr></tbody></table><p id="r-379073" data-claire-element-id="379073">Vous pouvez aisément combiner les filtres avec les opérateurs logiques <strong>&amp;&amp;</strong> (AND) et <strong>||</strong> (OR).</p><p id="r-379074" data-claire-element-id="379074">De plus, en cliquant sur un paquet, vous obtenez les détails du paquet, ses données, ce qu'il contient et bien d'autres informations. Comme vous pouvez vous en douter, cet outil est excessivement utile pour les hackers, mais aussi pour les programmeurs honnêtes comme nous. Bref, je vous invite à apprendre à l'utiliser de manière un peu plus poussée si cela vous intéresse. Sinon, ce que nous avons appris ensemble suffira pour ce tutoriel.</p><h5 id="r-en-resume-464" data-claire-element-id="379086">En résumé...</h5><ul id="r-379084" data-claire-element-id="379084"><li id="r-379077" data-claire-element-id="379077"><p id="r-379076" data-claire-element-id="379076">Les communications réseau sont organisés en couches selon les modèles Internet (ou TCP/IP) ou OSI.</p></li><li id="r-379079" data-claire-element-id="379079"><p id="r-379078" data-claire-element-id="379078">Afin de communiquer, les ordinateurs emploient des identificateurs physiques (Adresse MAC), des identificateurs logiques (Adresses IP) et des ports afin de fonctionner en simultané.</p></li><li id="r-379081" data-claire-element-id="379081"><p id="r-379080" data-claire-element-id="379080">UDP est un protocole de communique sans connexion et comparable à l'envoi du courrier par le service postal régulier.</p></li><li id="r-379083" data-claire-element-id="379083"><p id="r-379082" data-claire-element-id="379082">L'application WireShark est ce qu'on appelle un <em>renifleur de paquets</em>. Elle permet d'analyser les échanges réseau à l'aide de nombreux outils offerts pour le modique somme d'un sourire. :D</p></li></ul><p id="r-379085" data-claire-element-id="379085">Je comprends qu'il y avait beaucoup de théorie dans ce passage, mais je crois que vous en avez appris plus que ce vous vous attendiez à apprendre. Le protocole TCP n'a pas été abordé dans ce chapitre de manière intentionnelle, à cause de sa plus grande complexité. Nous l'aborderons lorsque nous en aurons terminé avec le protocole UDP.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
<span class="arrow"></span>
<span class="next">Les types de communication</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">
<span class="next">Première communication</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Premirecommunication"></a><h2>Première communication</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
<span class="arrow"></span>
<span class="next">Les outils</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
<span class="next">Le client</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-379089" data-claire-element-id="379089">C'est enfin le moment tant attendu. On commence à se lancer de la programmation réseau ! Il ne faudra pas s'emballer. Je vais y aller très doucement et il faudra s'assurer de suivre. Nous allons simplement commencer par envoyer une communication UDP sur le réseau puis nous enchaînerons avec le réception de celle-ci.</p><aside id="r-379091" data-claire-element-id="379091" data-claire-semantic="information"><p id="r-379090" data-claire-element-id="379090">Nous communiquerons à l'aide de l'adresse locale (<strong>localhost</strong>) afin de permettre de programmer et de tester sur la même machine.</p></aside>
</div><a name="Leclient"></a><h2>Le client</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">
<span class="arrow"></span>
<span class="next">Première communication</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
<span class="next">Le serveur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-le-client-2" data-claire-element-id="379117">Le client</h4><p id="r-379092" data-claire-element-id="379092">J'ai décidé de vous faire programmer le client en premier lieu. Puisque nous sommes en UDP et qu'aucune connexion n'a besoin d'être établie préalablement à l'envoie de message, je juge qu'il s'agira d'un bon premier exemple.</p><h5 id="r-les-classes-a-utiliser" data-claire-element-id="379098">Les classes à utiliser</h5><h6 id="r-la-classe-socket" data-claire-element-id="379094">La classe Socket</h6><p id="r-379093" data-claire-element-id="379093">La classe Socket est la classe universelle qui sert à établir toutes les communications réseau (ou presque). Cependant, cette classe est très complexe car elle comprend toutes les méthodes nécessaires à tous les protocoles. Il est donc facile de se tromper. On utilisera plutôt des classes spécialisées dans un type de communication.</p><h6 id="r-la-classe-udpclient" data-claire-element-id="379097">La classe UdpClient</h6><p id="r-379095" data-claire-element-id="379095">La classe UdpClient est la classe spécialisée dans la réception et l'envoie de données en UDP. Nous allons apprendre à l'utiliser par la pratique. Cependant, si vous voulez en savoir plus, je vous donne rendez-vous sur <a href="http://msdn.microsoft.com/fr-fr/library/system.net.sockets.udpclient.aspx">MSDN</a>.</p><p id="r-379096" data-claire-element-id="379096">Même si cette classe porte la nomination <strong>client</strong>, ne vous inquiétez pas, elle sert aussi du côté serveur.</p><h5 id="r-creation-du-projet-8" data-claire-element-id="379105">Création du projet</h5><p id="r-379099" data-claire-element-id="379099">Commencez par créer un projet en C# en Console.</p><figure id="r-creation-du-client-en-console" data-claire-element-id="379102"><img id="r-379100" data-claire-element-id="379100" src="medias/uploads.siteduzero.com_files_388001_389000_388985.png" alt="Création du client en Console"/><figcaption>Création du client en Console</figcaption></figure><p id="r-379103" data-claire-element-id="379103">Voici ce que vous devriez mettre dans le fichier <em>Program.cs</em> :</p><pre id="r-379104" data-claire-element-id="379104"><code data-claire-semantic="csharp">using System;
using System.Net.Sockets;
using System.Text;

namespace ExUDP
{
    public class Program
    {
        private static void Main(string[] args)
        {
            bool continuer = true;

            while (continuer)
            {
                Console.Write(&quot;\nEntrez un message : &quot;);
                string message = Console.ReadLine();

                //Sérialisation du message en tableau de bytes.
                byte[] msg = Encoding.Default.GetBytes(message);

                UdpClient udpClient = new UdpClient();

                //La méthode Send envoie un message UDP.
                udpClient.Send(msg, msg.Length, &quot;127.0.0.1&quot;, 5035);

                udpClient.Close();

                Console.Write(&quot;\nContinuer ? (O/N)&quot;);
                continuer = (Console.ReadKey().Key == ConsoleKey.O);
            }
        }
    }
}</code></pre><h5 id="r-explications-du-processus" data-claire-element-id="379114">Explications du processus</h5><p id="r-379106" data-claire-element-id="379106">Mine de rien, on vient de créer un client UDP et on vient d'envoyer notre premier message UDP. En effet, à la ligne 16, on capture le message que l'utilisateur entre dans la console. Ensuite, on le sérialise dans un tableau de bytes (collection de 8 bits) à la ligne 19. Un bit est simplement une représentation d'un 0 ou d'un 1. Le binaire est la base de l'informatique. Toutes les données qui transigent par réseau doivent être sérialisées en bytes. Vous allez devoir vous y faire.</p><p id="r-379107" data-claire-element-id="379107">Ensuite, on crée un objet de type <code data-claire-semantic="csharp">UdpClient</code>. Je sais que je crée une instance à chaque itération de la boucle, mais je voulais vous montrer une séquence afin de vous permettre de vous y retrouver pour votre premier exemple.</p><p id="r-379108" data-claire-element-id="379108">Ensuite, on appelle la méthode Send qui permet d'envoyer des données sur le réseau en UDP. Voici sa signature :</p><pre id="r-379109" data-claire-element-id="379109"><code data-claire-semantic="csharp">public int Send(
	byte[] dgram,
	int bytes,
	string hostname,
	int port
)</code></pre><p id="r-379110" data-claire-element-id="379110">Le premier paramètre est un tableau de bytes. Ce sont les données à envoyer dans le datagram. Peu importe sa taille, il sera séparé en paquets plus bas dans les couches TCP/IP. Dans le cas d'un simple message textuel, il sera rare que le paquet ne soit divisé en plusieurs sous-paquets.</p><p id="r-379111" data-claire-element-id="379111">Le second paramètre est la taille du tableau de bytes. Ce paramètre est simple à fournir. Si vous regardez mon code, vous verrez que j'ai simplement récupéré la propriété <code data-claire-semantic="csharp">Length</code> du tableau sérialisé.</p><p id="r-379112" data-claire-element-id="379112">Le troisième paramètre est le nom de l'hôte à qui est adressé le message. Vous pouvez entrer l'adresse IP en string dans ce paramètre. Dans mon exemple, j'envoie les données au <strong>localhost (127.0.0.1)</strong>, c'est-à-dire moi-même.</p><p id="r-379113" data-claire-element-id="379113">Le dernier paramètre est le port auquel le message est adressé. J'ai choisi un port aléatoire dans cet exemple. Rappelez-vous des lignes directrices quand vous choisissez le port. Si vous choisissez un port illégal, le programme plantera. Ça aurait pu être une bonne idée d'encadrer la communication dans un bloc <em>try...catch</em>.</p><h5 id="r-conclusions" data-claire-element-id="379116">Conclusions</h5><p id="r-379115" data-claire-element-id="379115">Bon, je ne vais pas vous cacher que ce projet n'est pas excessivement ambitieux. Cependant, il vous permet de voir une introduction aux communications en UDP. Nous allons continuer dans la prochaine partie avec un serveur en UDP qui sera un peu plus étoffé.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">
<span class="arrow"></span>
<span class="next">Première communication</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
<span class="next">Le serveur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Leserveur"></a><h2>Le serveur</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
<span class="arrow"></span>
<span class="next">Le client</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">
<span class="next">Travail Pratique : mini-chat</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-le-serveur-2" data-claire-element-id="379170">Le serveur</h4><p id="r-379118" data-claire-element-id="379118">Nous allons maintenant commencer la programmation du serveur. Comme nous avons vu lors des théories de départ, le serveur est une application qui sert à offrir un service aux clients qui le demandent. En UDP, le serveur n'est pas très compliqué à programmer et à concevoir.</p><h5 id="r-preparation-de-la-solution" data-claire-element-id="379125">Préparation de la solution</h5><p id="r-379119" data-claire-element-id="379119">Nous allons commencer par préparer la solution afin d'y accueillir un nouveau projet. Ce nouveau projet générera un exécutable qui sera notre application serveur.</p><p id="r-379120" data-claire-element-id="379120">Dans l'explorateur de solutions, faîtes un clic de droite sur la solution (attention, pas le projet, mais bien la solution. Il s'agit du niveau supérieur). Allez dans le sous-menu <em>Ajouter</em> et sélectionnez l'option <em>Nouveau projet</em>. Dans la fenêtre qui s'ouvrira, choisissez une <strong>Application Console</strong> en C#. On appellera ce projet <strong>UDPServeur</strong>.</p><figure id="r-creation-d-un-projet-dans-une-solution-deja-existante" data-claire-element-id="379123"><img id="r-379121" data-claire-element-id="379121" src="medias/uploads.siteduzero.com_files_389001_390000_389622.png" alt="Création d'un projet dans une solution déjà existante."/><figcaption>Création d'un projet dans une solution déjà existante.</figcaption></figure><p id="r-379124" data-claire-element-id="379124">Une fois le projet créé, Visual Studio devrait ouvrir le nouveau fichier <em>Program.cs</em> du serveur. On pourra maintenant commencer à programmer cette partie de l'architecture.</p><h5 id="r-creation-d-un-serveur" data-claire-element-id="379133">Création d'un serveur</h5><p id="r-379126" data-claire-element-id="379126">Il y a quelques façons de créer un serveur. Bien évidemment, parce que nous sommes en UDP, il nous sera facile de faire un modèle de base. Ça se corsera lorsqu'on fera un serveur TCP.</p><p id="r-379127" data-claire-element-id="379127">Dans cet exemple, on va créer une application serveur qui affichera les messages reçus dans les paquets UDP. Ça tombe bien, on a créé un client qui envoyait justement ça des messages textuels par UDP ! Le hasard fait bien les choses... :-° (IT'S A TRAP !!!)</p><p id="r-379128" data-claire-element-id="379128">Voici la structure qu'on devra suivre.</p><figure id="r-structure-d-ecoute-d-un-serveur-udp" data-claire-element-id="379131"><img id="r-379129" data-claire-element-id="379129" src="medias/uploads.siteduzero.com_files_389001_390000_389631.png" alt="Structure d'écoute d'un serveur UDP."/><figcaption>Structure d'écoute d'un serveur UDP.</figcaption></figure><p id="r-379132" data-claire-element-id="379132">Vous allez voir, c'est relativement simple. D'abord, il faut savoir que ce processus s'exécute généralement à l'intérieur d'un thread séparé. La raison est très simple. En premier lieu, puisqu'on utilise une Console, on voudra éviter que celle-ci ne se ferme tant et aussi longtemps que nous ne voulons pas fermer le serveur. En second lieu, en utilisant un thread séparé, on évite l'effet <em>bloquant </em>des méthodes que nous allons utiliser. Vous ne l'avez pas encore expérimenté car nous sommes en Console, mais les méthodes que nous avons utilisées ont comme défaut d'accaparer le thread actuel jusqu'à ce que leur action ne soit complétée. Dans le cas d'un petit envoie, on ne verra pas vraiment la différence. Cependant, si on envoyait un fichier de quelques mégaoctets, on verrait immédiatement le caractère indésirable de ces méthodes. Comme nous sommes en Console pour le moment, je ne me soucierai pas de ces détails, mais sachez que dans le prochain chapitre, nous verrons comment contourner ce problème lorsque nous serons en Windows Forms.</p><h5 id="r-programmation-du-serveur-udp" data-claire-element-id="379140">Programmation du serveur UDP</h5><p id="r-379134" data-claire-element-id="379134">Je vous fournis immédiatement le code du serveur. J'ai fait exprès de programmer le tout dans la classe Program dans un premier lieu afin de vous simplifier la tâche. Cependant, sachez qu'on créera généralement une classe à part afin d'offrir ces services (séparation des responsabilités par la POO).</p><pre id="r-379135" data-claire-element-id="379135"><code data-claire-semantic="csharp">using System;
using System.Net;
using System.Net.Sockets;
using System.Text;
using System.Threading;

namespace UDPServeur
{
    public class Program
    {
        private static Thread _thEcoute;

        private static void Main(string[] args)
        {
            //Préparation et démarrage du thread en charge d'écouter.
            _thEcoute = new Thread(new ThreadStart(Ecouter));
            _thEcoute.Start();
        }

        private static void Ecouter()
        {
            Console.WriteLine(&quot;Préparation à l'écoute...&quot;);

            //On crée le serveur en lui spécifiant le port sur lequel il devra écouter.
            UdpClient serveur = new UdpClient(5035);

            //Création d'une boucle infinie qui aura pour tâche d'écouter.
            while (true)
            {
                //Création d'un objet IPEndPoint qui recevra les données du Socket distant.
                IPEndPoint client = null;
                Console.WriteLine(&quot;ÉCOUTE...&quot;);

                //On écoute jusqu'à recevoir un message.
                byte[] data = serveur.Receive(ref client);
                Console.WriteLine(&quot;Données reçues en provenance de {0}:{1}.&quot;, client.Address, client.Port);

                //Décryptage et affichage du message.
                string message = Encoding.Default.GetString(data);
                Console.WriteLine(&quot;CONTENU DU MESSAGE : {0}\n&quot;, message);
            }
        }
    }
}</code></pre><p id="r-379136" data-claire-element-id="379136">La première étape est de créer un thread qui servira à écouter les messages UDP. On met donc cette étape dans le <strong>Main</strong>. Ensuite, on lance le thread.</p><p id="r-379137" data-claire-element-id="379137">Dès que le thread est lancé, on prépare les objets nécessaires à l'écoute. Dans ce cas-ci, il s'agit du <strong>UdpClient</strong> qui servira de serveur. Ensuite, on lance une boucle infinie. Dans l'idéal, il faudrait que cette boucle ait une variable de contrôle, mais puisqu'on est en Console, ça n'en vaut pas la peine. De toute manière, en fermant l'application, l'objet <em>serveur</em> sera détruit lors de la collecte de la mémoire.</p><p id="r-379138" data-claire-element-id="379138">Afin de commencer à écouter, il nous faut un objet de type <strong>IPEndPoint</strong> pour pouvoir identifier le client qui enverra le message. Lorsqu'on appelle la méthode <em>Receive</em> à la ligne 35, on doit lui passer en référence l'objet <strong>IPEndPoint</strong>. La méthode retournera un tableau de bytes qui modélisera ce qui a été reçu par le réseau.</p><p id="r-379139" data-claire-element-id="379139">On affiche alors l'adresse IP et le port du client avant de décoder le message envoyé. Puis on recommence. Simple, non ? Ne vous inquiétez pas, ça va se complexifier.</p><h5 id="r-test-de-la-solution" data-claire-element-id="379158">Test de la solution</h5><p id="r-379141" data-claire-element-id="379141">Allez-y, lancez l'application serveur en appuyant sur F5. Voici ce qui apparaîtra.</p><figure id="r-serveur-udp-en-console" data-claire-element-id="379144"><img id="r-379142" data-claire-element-id="379142" src="medias/uploads.siteduzero.com_files_389001_390000_389638.png" alt="Serveur UDP en Console."/><figcaption>Serveur UDP en Console.</figcaption></figure><p id="r-379145" data-claire-element-id="379145">Ouais, il faudrait bien envoyer un message au serveur pour le faire réagir, vous ne pensez pas ?</p><div id="r-379147" data-claire-element-id="379147" data-claire-semantic="question"><p id="r-379146" data-claire-element-id="379146">Ouais, mais là, il va falloir lancer le client en même temps que le serveur, non ? Quel était le but de nous faire programmer un client et un serveur dans la même solution si on doit les lancer séparément ? De plus, si je dois déboguer le client, je ne suis même plus capable de le lancer en mode débogage !</p></div><p id="r-379148" data-claire-element-id="379148">Ne craignez rien, il y a un moyen de contrôler quels projets démarrent en mode débogage. Vous allez faire un clic de droite sur la solution et vous allez sélectionner l'option <strong>Propriétés</strong>. Dans la section de gauche, sélectionnez l'option <em>Propriétés communes &gt; Projet de démarrage.</em> Dans la section de droite, sélectionnez l'option <strong>Projets de démarrage multiples</strong>. Dans la colonne Action, sélectionnez <em>Démarrer</em> dans les deux projets et appuyez sur OK. Vous pouvez maintenant démarrer le débogage et les deux projets seront compilés et lancés dans l'ordre dans laquelle vous les avez placés dans la fenêtre de propriétéd.</p><figure id="r-options-de-demarrage-2" data-claire-element-id="379151"><img id="r-379149" data-claire-element-id="379149" src="medias/uploads.siteduzero.com_files_389001_390000_389639.png" alt="Options de démarrage."/><figcaption>Options de démarrage.</figcaption></figure><p id="r-379152" data-claire-element-id="379152">Maintenant que cela est fait, vous pouvez maintenant facilement tester vos applications. N'oubliez pas d'utiliser le même port dans les deux projets. Sinon, le message ne sera jamais reçu par le serveur.</p><figure id="r-test-de-notre-solution-client-serveur-en-udp" data-claire-element-id="379155"><img id="r-379153" data-claire-element-id="379153" src="medias/uploads.siteduzero.com_files_389001_390000_389640.png" alt="Test de notre solution Client-Serveur en UDP."/><figcaption>Test de notre solution Client-Serveur en UDP.</figcaption></figure><p id="r-379156" data-claire-element-id="379156">Si vous avez bien remarqué, le port duquel le client se connecte et envoie le message est aléatoire. C'est normal parce que chaque acteur dans la communication réseau a besoin d'un port. Vous pouvez également utiliser WireShark afin d'avoir plus d'information sur l'échange de données qui a eu lieu.</p><p id="r-379157" data-claire-element-id="379157">Mes félicitations, vous avez programmé votre tout premier chat en Console ! ;)</p><h5 id="r-en-resume-465" data-claire-element-id="379169">En résumé...</h5><ul id="r-379167" data-claire-element-id="379167"><li id="r-379160" data-claire-element-id="379160"><p id="r-379159" data-claire-element-id="379159">La classe Socket est la classe de base qui permet d'effectuer des communications réseau. On préfèrera cependant l'utilisation d'une classe plus spécialisée dans le type de communication qui nous intéresse.</p></li><li id="r-379162" data-claire-element-id="379162"><p id="r-379161" data-claire-element-id="379161">Les données qui transigent sur le réseau doivent être sérialisées. Nous en apprendrons plus sur le sujet dans quelques chapitres.</p></li><li id="r-379164" data-claire-element-id="379164"><p id="r-379163" data-claire-element-id="379163">La méthode Send permet d'envoyer des datagrams sur le réseau à l'adresse spécifiée. Il existe des surcharges de la méthode Send qui peuvent être utiles dans certaines circonstances.</p></li><li id="r-379166" data-claire-element-id="379166"><p id="r-379165" data-claire-element-id="379165">La classe UdpClient est utilisée afin de créer des clients UDP, mais aussi des serveurs.</p></li></ul><p id="r-379168" data-claire-element-id="379168">J'espère que vous avez bien aimé votre première expérience avec les Sockets et la programmation réseau. Dès le prochain chapitre, nous nous attaquerons à un clavardage par Windows Forms.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
<span class="arrow"></span>
<span class="next">Le client</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">
<span class="next">Travail Pratique : mini-chat</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="TravailPratiquemini-chat"></a><h2>Travail Pratique : mini-chat</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
<span class="arrow"></span>
<span class="next">Le serveur</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
<span class="next">Définition du client</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-379172" data-claire-element-id="379172">C'est maintenant l'occasion de mettre en application ce que vous avez appris. On utiliseras tout ce qu'on a appris jusqu'à maintenant : Threads, cas des Windows Forms et UDP. J'espère que vous êtes prêts ! ;)</p><aside id="r-379174" data-claire-element-id="379174" data-claire-semantic="information"><p id="r-379173" data-claire-element-id="379173">N'hésitez surtout pas à revenir en arrière et à relire les anciens chapitres. Ce TP sera l'occasion de réviser ce que nous avons appris jusqu'à maintenant.</p></aside>
</div><a name="Dfinitionduclient"></a><h2>Définition du client</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">
<span class="arrow"></span>
<span class="next">Travail Pratique : mini-chat</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
<span class="next">Définition du serveur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-definition-du-client" data-claire-element-id="379206">Définition du client</h4><p id="r-379175" data-claire-element-id="379175">Nous allons programmer un mini-chat à la IRC en UDP. Évidemment, l'UDP n'est pas le meilleur protocol pour cela. Cependant, c'est le seul que nous connaissons pour le moment. De toute manière, on testera en <strong>localhost</strong>. La perte de paquets est très difficile quand on s'adresse à soi-même... Même en réseau local (LAN), le protocol UDP offre généralement de bonnes performances. C'est lorsque l'on doit passer par Internet que les choses deviennent plus difficiles.</p><p id="r-379176" data-claire-element-id="379176">Le client, en Windows Forms, devra être capable d'envoyer des messages textes au serveur. On en reparlera plus tard, mais le serveur devra être capable de renvoyer le message à tous les clients sur le sous-réseau à travers le concept de <strong>broadcast</strong>. Parce que les clients doivent être capables de lire ce que renverra le serveur, il faudra que ces derniers soient eux aussi à l'écoute. Le tout doit se dérouler de façon sécuritaire, asynchrone et doit se fermer de la bonne manière. Ne vous cassez pas la tête à tout encapsuler dans des classes pour le moment. En temps normal, il aurait été bien de le faire, mais pour le moment, nous nous contenterons de tout écrire dans la classe du formulaire.</p><p id="r-379177" data-claire-element-id="379177">Voici la liste de ce qui est attendu :</p><ul id="r-379186" data-claire-element-id="379186"><li id="r-379179" data-claire-element-id="379179"><p id="r-379178" data-claire-element-id="379178">Programmer un client graphique qui enverra des messages UDP à un serveur central.</p></li><li id="r-379181" data-claire-element-id="379181"><p id="r-379180" data-claire-element-id="379180">Le client doit être en mesure de recevoir les messages du serveur et doit pouvoir bâtir un historique de ces messages.</p></li><li id="r-379183" data-claire-element-id="379183"><p id="r-379182" data-claire-element-id="379182">Envoyez vos messages sur le port 1523 et écoutez pour une réponse sur le port 5053. Si vous avez des conflits de port avec une autre application, changez les ports.</p></li><li id="r-379185" data-claire-element-id="379185"><p id="r-379184" data-claire-element-id="379184">Amusez-vous !</p></li></ul><aside id="r-379189" data-claire-element-id="379189" data-claire-semantic="warning"><p id="r-379187" data-claire-element-id="379187">Faîtes attention. Il sera impossible pour un client et un serveur de fonctionner sur un même ordinateur si vous écoutez et transmettez sur le même port. C'est pourquoi je vous conseille de ne pas utiliser le même <strong>UdpClient</strong> pour les deux actions.</p><p id="r-379188" data-claire-element-id="379188">N'oubliez pas non plus de définir un <strong>Timeout</strong> sur le UdpClient qui écoute. Cela permettra au Socket de faire une pause régulièrement afin de vérifier si la boucle doit continuer son exécution. On fait comme suit :</p></aside><pre id="r-379190" data-claire-element-id="379190"><code data-claire-semantic="csharp">UdpClient serveur = new UdpClient(5053);
serveur.Client.ReceiveTimeout = 1000;</code></pre><h5 id="r-petit-truc" data-claire-element-id="379196">Petit truc</h5><p id="r-379191" data-claire-element-id="379191">Comme on sait déjà avec qui on communiquera pendant toute la durée de la communication réseau, je vous conseille d'utiliser la méthode <strong>Connect</strong> après avoir instancié le <em>UdpClient</em>. Je vous conseille aussi d'utiliser la signature qui prend en premier paramètre une chaîne de caractères qui définit l'adresse IP de destination et un entier (<code data-claire-semantic="csharp">int</code>) en second paramètre pour définir le port de destination.</p><pre id="r-379192" data-claire-element-id="379192"><code data-claire-semantic="csharp">UdpClient client = new UdpClient();
client.Connect(&quot;127.0.0.1&quot;, 1523);</code></pre><p id="r-379193" data-claire-element-id="379193">Sinon, vous pouvez aussi utiliser la signature qui prend en paramètre un <strong>IPEndPoint</strong> qui peut être plus explicite parfois.</p><pre id="r-379194" data-claire-element-id="379194"><code data-claire-semantic="csharp">UdpClient client = new UdpClient();
client.Connect(new IPEndPoint(IPAddress.Loopback, 1523));</code></pre><p id="r-379195" data-claire-element-id="379195">La classe IPAddress définit certaines propriétés statiques en lecture seule qui peuvent être excessivement utiles. Jetez-y un oeil. Peu importe la signature que vous choisirez, l'utilisation de la méthode <strong>Connect</strong> permet d'alléger le code de la méthode <strong>Send</strong> qui se contente maintenant de prendre en paramètres un tableau de bytes et la longueur de celui-ci. Vous pourrez ainsi faire <code data-claire-semantic="csharp">_client.Send(data, data.Length);</code> à la place de <code data-claire-semantic="csharp">_client.Send(data, data.Length, &quot;127.0.0.1&quot;, 1523);</code>. Plus simple et plus lisible, non ?</p><h5 id="r-guide-d-interface-graphique" data-claire-element-id="379205">Guide d'interface graphique</h5><p id="r-379197" data-claire-element-id="379197">Voici à quoi devrait ressembler votre client :</p><figure id="r-le-client-rien-de-complique-hein" data-claire-element-id="379200"><img id="r-379198" data-claire-element-id="379198" src="medias/uploads.siteduzero.com_files_389001_390000_389823.png" alt="Le client. Rien de compliqué, hein ?"/><figcaption>Le client. Rien de compliqué, hein ?</figcaption></figure><aside id="r-379202" data-claire-element-id="379202" data-claire-semantic="warning"><p id="r-379201" data-claire-element-id="379201">Rappelez-vous que nous manipulons des contrôles Windows Forms. N'oubliez pas d'ajuster en conséquence !</p></aside><div id="r-379204" data-claire-element-id="379204" data-claire-semantic="question"><p id="r-379203" data-claire-element-id="379203">Questions, commentaires ? Action ! Bonne chance à vous.</p></div>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">
<span class="arrow"></span>
<span class="next">Travail Pratique : mini-chat</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
<span class="next">Définition du serveur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Dfinitionduserveur"></a><h2>Définition du serveur</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
<span class="arrow"></span>
<span class="next">Définition du client</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
<span class="next">Correction</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-definition-du-serveur" data-claire-element-id="379240">Définition du serveur</h4><p id="r-379207" data-claire-element-id="379207">Vous devriez maintenant avoir terminé le client. Je vais maintenant définir le serveur. Le serveur sera un peu plus compliqué. Bon, avant de commencer, je dois vous montrer comment faire pour effectuer du <strong>broadcast</strong>.</p><h5 id="r-hein-broadcaster" data-claire-element-id="379215">Hein, broadcaster ??</h5><p id="r-379208" data-claire-element-id="379208">Oui oui, vous avez bien lu. Un autre anglicisme. Si on voulait être correct en français, on parlerait de télédiffusion. Comme je trouve que ce terme s'apparente plus à de la diffusion d'émissions de télévision, j'ai plutôt opté pour l'expression anglaise.</p><p id="r-379209" data-claire-element-id="379209">Broadcaster est l'action d'envoyer un message à tous les membres d'un sous-réseau sans que l'on ait à envoyer un message à chaque client manuellement. En IPv4, dans une configuration de sous-réseau qui s'articule avec un masque de sous-réseau, la dernière adresse disponible est attribuée à cette action. Je ne souhaite par entrer dans les détails car c'est réellement sans importance pour nous. Il suffit de savoir qu'une adresse IP bien distincte est définie dans un réseau afin de pouvoir envoyer un message à tous les hôtes connectés. C'est d'ailleurs le router qui se chargera alors de redistribuer le paquet en plusieurs exemplaires. Sachez cependant utiliser cette méthode avec dilligence. Elle a tendance à ralentir les réseaux car <strong>TOUS</strong> les hôtes du réseau recevront le paquet, qu'ils soient en train d'écouter pour un paquet sur ce port ou non.</p><div id="r-379211" data-claire-element-id="379211" data-claire-semantic="question"><p id="r-379210" data-claire-element-id="379210">Mais si ça tend à ralentir le réseau, pourquoi devrait-on utiliser le <strong>broadcast </strong>?</p></div><p id="r-379212" data-claire-element-id="379212">Bien que la technique ait ses défauts, elle a aussi ses utilités. Par exemple, pour effectuer une détection, cette méthode est parfaite. On envoie à intervalles réguliers (quelques secondes d'espacement) des paquets en mode diffusion pour signaler sa présence sur le réseau. N'importe quel périphérique qui écouterait à ce moment saurait alors que notre service existe et qu'il est prêt à être utilisé. Ce fonctionnement fera l'objet d'un autre Travail Pratique. Retenez cependant que la fonctionnalité peut se révéler très utile lorsqu'on n'en abuse pas.</p><h6 id="r-et-nous-on-implemente-le-broadcast-comment" data-claire-element-id="379214">Et nous, on implémente le broadcast comment ?</h6><p id="r-379213" data-claire-element-id="379213">C'est fort simple, car .NET fait tout le boulot pour nous. Lorsque Windows joint un réseau, il obtient le masque de sous-réseau automatiquement et on peut alors déterminer l'adresse de <strong>broadcast </strong>sans effort. La classe <strong>IPAddress</strong> nous fournit déjà le nécessaire à l'aide de la propriété statique <em>Broadcast</em>. Utilisez-la avec la méthode <strong>Connect</strong> comme nous avons vu et le tour est joué.</p><h5 id="r-le-serveur-3" data-claire-element-id="379239">Le serveur</h5><p id="r-379216" data-claire-element-id="379216">Bon, maintenant que vous avez la pièce manquante du puzzle, il ne vous reste qu'à vous mettre à programmer. Voici ce que je veux que vous réalisiez :</p><ul id="r-379227" data-claire-element-id="379227"><li id="r-379218" data-claire-element-id="379218"><p id="r-379217" data-claire-element-id="379217">Les communications réseaux et les threads doivent être propres et doivent se fermer naturellement. Prévoyez le nécessaire. Les cas limites doivent être couverts et ne pas faire planter l'application. Il n'y a rien de plus frustrant pour un utilisateur que d'utiliser une application qui plante à tout bout de champs !</p></li><li id="r-379220" data-claire-element-id="379220"><p id="r-379219" data-claire-element-id="379219">On pourra contrôler à l'aide de boutons si l'application serveur doit offrir son service ou non. Lorsque l'application s'ouvre, le serveur doit être désactivé.</p></li><li id="r-379222" data-claire-element-id="379222"><p id="r-379221" data-claire-element-id="379221">Le serveur aura pour mission d'écouter les messages de tous les usagers sur le port 1523 et de retransmettre le message avec l'adresse IP et le port du transmetteur sur tout le réseau à l'aide de broadcast sur le port 5053.</p></li><li id="r-379224" data-claire-element-id="379224"><p id="r-379223" data-claire-element-id="379223">Le serveur doit garder trace des activités avec la date et l'heure dans son <strong>Log</strong>.</p></li><li id="r-379226" data-claire-element-id="379226"><p id="r-379225" data-claire-element-id="379225">Le traitement du renvoie du message doit prendre place dans un thread séparé afin de reprendre au plus tôt l'écoute de messages UDP entrants.</p></li></ul><aside id="r-379229" data-claire-element-id="379229" data-claire-semantic="warning"><p id="r-379228" data-claire-element-id="379228">Le fait que l'on ne puisse se lier à un port pour l'écouter qu'une seule fois pourrait vous causer de problèmes. Assurez-vous d'adresser cette possible difficulté. De plus, sachez que lorsque qu'un Socket a été utilisé puis fermé, on doit en créer un nouveau. On ne peut pas le réutiliser. La même situation s'applique lorsque les Sockets plantent, sauf s'il s'agit d'une exception dû à un Timeout qui aurait expiré.</p></aside><h6 id="r-guide-interface-graphique" data-claire-element-id="379238">Guide interface graphique</h6><p id="r-379230" data-claire-element-id="379230">Voici à quoi mon serveur ressemble.</p><figure id="r-le-serveur-devrait-ressembler-a-ceci-embalissez-le-si-vous-le-desirer" data-claire-element-id="379233"><img id="r-379231" data-claire-element-id="379231" src="medias/uploads.siteduzero.com_files_390001_391000_390549.png" alt="Le serveur devrait ressembler à ceci. Embalissez-le si vous le désirer !"/><figcaption>Le serveur devrait ressembler à ceci. Embalissez-le si vous le désirer !</figcaption></figure><figure id="r-voici-comment-devrait-fonctionner-la-paire" data-claire-element-id="379236"><img id="r-379234" data-claire-element-id="379234" src="medias/uploads.siteduzero.com_files_390001_391000_390550.png" alt="Voici comment devrait fonctionner la paire."/><figcaption>Voici comment devrait fonctionner la paire.</figcaption></figure><p id="r-379237" data-claire-element-id="379237"><strong>À vous de jouer ! ^^</strong></p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
<span class="arrow"></span>
<span class="next">Définition du client</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
<span class="next">Correction</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Correction"></a><h2>Correction</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
<span class="arrow"></span>
<span class="next">Définition du serveur</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">
<span class="next">La sérialisation des objets</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-correction-127" data-claire-element-id="379274">Correction</h4><p id="r-379241" data-claire-element-id="379241">Vous avez eu un peu de difficulté ? C'est parfait ! Faire des travaux pratiques devrait être un petit défi en soi selon moi. Voici ma correction. Sachez que certaines méthodes de programmation sont meilleures que d'autres, mais si votre programme fonctionne, c'est ce qui est important pour le moment.</p><h5 id="r-quelques-tests-1" data-claire-element-id="379256">Quelques tests</h5><p id="r-379242" data-claire-element-id="379242">Voici une liste de tests avant que vous ne regardiez le corrigé. Effectuez-les et assurez-vous que vos programmes gèrent ces cas sans planter et sans chigner. Ces test s'adressent surtout au serveur plus qu'au client.</p><h6 id="r-tests-pour-le-client" data-claire-element-id="379246">Tests pour le client</h6><ul id="r-379245" data-claire-element-id="379245"><li id="r-379244" data-claire-element-id="379244"><p id="r-379243" data-claire-element-id="379243">Lancez une deuxième instance du client.</p></li></ul><h6 id="r-tests-pour-le-serveur" data-claire-element-id="379255">Tests pour le serveur</h6><ul id="r-379253" data-claire-element-id="379253"><li id="r-379248" data-claire-element-id="379248"><p id="r-379247" data-claire-element-id="379247">Lancez le serveur, arrêtez-le. Après quelques secondes, relancez-le.</p></li><li id="r-379250" data-claire-element-id="379250"><p id="r-379249" data-claire-element-id="379249">Appuyez rapidement sur les boutons Démarrer et Arrêter.</p></li><li id="r-379252" data-claire-element-id="379252"><p id="r-379251" data-claire-element-id="379251">Lancez une deuxième instance du serveur et démarrez les deux serveurs.</p></li></ul><p id="r-379254" data-claire-element-id="379254">Je ne vous fait pas tester pour des données invalides, mais il faudrait que ce cas soit couvert au niveau du serveur et du client. Après tout, on ne sait pas ce qui peut tenter d'entrer par le port. Les données ne seront pas toujours intègres.</p><h5 id="r-l-heure-de-la-correction-a-sonne" data-claire-element-id="379264">L'heure de la correction a sonné</h5><p id="r-379257" data-claire-element-id="379257">Votre programme fonctionne et survit à ces tests ? Toutes mes félicitations. Vous venez de réaliser votre premier vrai projet viable en programmation réseau sur .NET ! Il se peut aussi que vous n'ayez pas trouvé la solution par vous-même. Dans ce cas, je vous encourage à continuer d'essayer. Si par contre vous avez épuisé tout espoir, la solution est en dessous. Pour des soucis de lisibilité, je vous épargne le code généré par le designer. Vous devrez renommer vos objets pour vous ajuster à mon code si vous désirez faire un copier-coller.</p><h6 id="r-corrige-du-client" data-claire-element-id="379260">Corrigé du client</h6><pre id="r-379258" data-claire-element-id="379258"><code data-claire-semantic="csharp">using System;
using System.Net;
using System.Net.Sockets;
using System.Text;
using System.Threading;
using System.Windows.Forms;

namespace ChatClient
{
    public partial class FrmClient : Form
    {
        //Déclaration des objets nécessaires au client.
        private UdpClient _client;

        private bool _continuer;
        private Thread _thEcouteur;

        /// &lt;summary&gt;
        /// Constructeur de la classe FrmClient.
        /// &lt;/summary&gt;
        public FrmClient()
        {
            InitializeComponent();

            //On crée automatiquement le client qui sera en charge d'envoyer les messages au serveur.
            _client = new UdpClient();
            _client.Connect(&quot;127.0.0.1&quot;, 1523);

            //Initialisation des objets nécessaires au client. On lance également le thread qui en charge d'écouter.
            _continuer = true;
            _thEcouteur = new Thread(new ThreadStart(ThreadEcouteur));
            _thEcouteur.Start();
        }

        /// &lt;summary&gt;
        /// Gestion de l'envoie d'un message. Pas besoin d'un thread séparé pour cela, les données sont
        /// trop légères pour que ça en vaille la peine.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
        private void btnEnvoyer_Click(object sender, EventArgs e)
        {
            byte[] data = Encoding.Default.GetBytes(txtMessage.Text);
            _client.Send(data, data.Length);

            txtMessage.Clear();
            txtMessage.Focus();
        }

        /// &lt;summary&gt;
        /// Gestion de la fermeture du formulaire. On arrête d'écouter et on attend la fermeture complète
        /// du thread d'écoute.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
        private void FrmClient_FormClosing(object sender, FormClosingEventArgs e)
        {
            _continuer = false;
            _client.Close();
            _thEcouteur.Join();
        }

        /// &lt;summary&gt;
        /// Fonction en charge d'écouter les communications réseau.
        /// &lt;/summary&gt;
        private void ThreadEcouteur()
        {
            //Déclaration du Socket d'écoute.
            UdpClient ecouteur = null;

            //Création sécurisée du Socket.
            try
            {
                ecouteur = new UdpClient(5053);
            }
            catch
            {
                MessageBox.Show(&quot;Impossible de se lier au port UDP 5053. Vérifiez vos configurations réseau.&quot;);
                return;
            }

            //Définition du Timeout.
            ecouteur.Client.ReceiveTimeout = 1000;

            //Bouclage infini d'écoute de port.
            while (_continuer)
            {
                try
                {
                    IPEndPoint ip = null;
                    byte[] data = ecouteur.Receive(ref ip);

                    //Invocation du la méthode AjouterLog afin que les données soient inscrites dans
                    //la TextBox.
                    this.Invoke(new Action&lt;string&gt;(AjouterLog), Encoding.Default.GetString(data));
                }
                catch
                {
                }
            }

            ecouteur.Close();
        }

        /// &lt;summary&gt;
        /// Méthode qui sert à ajouter un message à la console du Client.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;data&quot;&gt;&lt;/param&gt;
        private void AjouterLog(string data)
        {
            txtResultat.AppendText(&quot;\r\n&quot; + data);
        }
    }
}</code></pre><p id="r-379259" data-claire-element-id="379259">Le client vous semble clair ? Nous allons donc nous attaquer au serveur qui est un peu plus complexe.</p><h6 id="r-corrige-du-serveur" data-claire-element-id="379263">Corrigé du serveur</h6><pre id="r-379261" data-claire-element-id="379261"><code data-claire-semantic="csharp">using System;
using System.Net;
using System.Net.Sockets;
using System.Text;
using System.Threading;
using System.Windows.Forms;

namespace ChatServer
{
    public partial class FrmServer : Form
    {
        //Définition d'une classe interne privée pour faciliter l'échange de
        //données entre les threads.
        private class CommunicationData
        {
            public IPEndPoint Client { get; private set; }

            public byte[] Data { get; private set; }

            public CommunicationData(IPEndPoint client, byte[] data)
            {
                Client = client;
                Data = data;
            }
        }

        //Déclaration des objets nécessaires au serveur.
        private UdpClient _broadcaster;

        private bool _continuer = true;
        private Thread _thEcouteur;

        /// &lt;summary&gt;
        /// Constructeur du formulaire Serveur.
        /// &lt;/summary&gt;
        public FrmServer()
        {
            InitializeComponent();

            //Initialisation et préparation des objets nécessaires au serveur.
            _broadcaster = new UdpClient();
            _broadcaster.EnableBroadcast = true;
            _broadcaster.Connect(new IPEndPoint(IPAddress.Broadcast, 5053));
        }

        /// &lt;summary&gt;
        /// Méthode Démarrer qui sera appelée lorsqu'on aura besoin de démarrer le serveur.
        /// &lt;/summary&gt;
        private void Demarrer()
        {
            //Ajoute des informations dans le log et modification des bouttons.
            btnDemarrer.Enabled = false;
            btnArreter.Enabled = true;
            AjouterLog(&quot;Démarrage du serveur...&quot;);

            //Démarrage du thread d'écoute.
            _continuer = true;
            _thEcouteur = new Thread(new ThreadStart(EcouterReseau));
            _thEcouteur.Start();
        }

        /// &lt;summary&gt;
        /// Méthode Arrêter qui sera appelée lorsqu'on aura besoin d'arrêter le serveur.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;attendre&quot;&gt;Définie si on attend que les threads aient terminé pour
        /// continuer l'exécution du thread principal. True quand le programme se ferme.&lt;/param&gt;
        private void Arreter(bool attendre)
        {
            btnDemarrer.Enabled = true;
            btnArreter.Enabled = false;
            AjouterLog(&quot;Arrêt du serveur...&quot;);

            _continuer = false;

            //On attend le thread d'écoute seulement si on le demande et si ce dernier était réellement en train de fonctionner.
            if (attendre &amp;&amp; _thEcouteur != null &amp;&amp; _thEcouteur.ThreadState == ThreadState.Running)
                _thEcouteur.Join();
        }

        /// &lt;summary&gt;
        /// Méthode qui écoute le réseau en permance en quête d'un message UDP sur le port 1523.
        /// &lt;/summary&gt;
        private void EcouterReseau()
        {
            //Création d'un Socket qui servira de serveur de manière sécurisée.
            UdpClient serveur = null;
            bool erreur = false;
            int attempts = 0;

            //J'essaie 3 fois car je veux éviter un plantage au serveur juste pour une question de millisecondes.
            do
            {
                try
                {
                    serveur = new UdpClient(1523);
                }
                catch
                {
                    erreur = true;
                    attempts++;
                    Thread.Sleep(400);
                }
            } while (erreur &amp;&amp; attempts &lt; 4);

            //Si c'est vraiment impossible de se lier, on en informe le serveur et on quitte le thread.
            if (serveur == null)
            {
                this.Invoke(new Action&lt;string&gt;(AjouterLog), &quot;Il est impossible de se lier au port 1523. Vérifiez votre configuration réseau.&quot;);
                this.Invoke(new Action&lt;bool&gt;(Arreter), false);
                return;
            }

            serveur.Client.ReceiveTimeout = 1000;

            //Boucle infinie d'écoute du réseau.
            while (_continuer)
            {
                try
                {
                    IPEndPoint ip = null;
                    byte[] data = serveur.Receive(ref ip);

                    //Préparation des données à l'aide de la classe interne.
                    CommunicationData cd = new CommunicationData(ip, data);
                    //On lance un nouveau thread avec les données en paramètre.
                    new Thread(new ParameterizedThreadStart(TraiterMessage)).Start(cd);
                }
                catch
                {
                }
            }

            serveur.Close();
        }

        /// &lt;summary&gt;
        /// Méthode en charge de traiter un message entrant.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;messageArgs&quot;&gt;&lt;/param&gt;
        private void TraiterMessage(object messageArgs)
        {
            try
            {
                //On récupère les données entrantes et on les formatte comme il faut.
                CommunicationData data = messageArgs as CommunicationData;
                string message = string.Format(&quot;{0}:{1} &gt; {2}&quot;, data.Client.Address.ToString(), data.Client.Port, Encoding.Default.GetString(data.Data));

                //On renvoie le message formatté à travers le réseau.
                byte[] donnees = Encoding.Default.GetBytes(message);
                _broadcaster.Send(donnees, donnees.Length);
                this.Invoke(new Action&lt;string&gt;(AjouterLog), message);
            }
            catch { }
        }

        /// &lt;summary&gt;
        /// Méthode en charge d'ajouter au Log les messages.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;message&quot;&gt;&lt;/param&gt;
        private void AjouterLog(string message)
        {
            txtLog.AppendText(&quot;\r\n&quot; + DateTime.Now.ToUniversalTime() + &quot; =&gt; &quot; + message);
        }

        /// &lt;summary&gt;
        /// Gestion du bouton Arrêt.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
        private void btnArreter_Click(object sender, EventArgs e)
        {
            Arreter(false);
        }

        /// &lt;summary&gt;
        /// Gestion du bouton Démarrer.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
        private void btnDemarrer_Click(object sender, EventArgs e)
        {
            Demarrer();
        }

        /// &lt;summary&gt;
        /// Gestion de la fermeture du formulaire.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;
        private void FrmServer_FormClosing(object sender, FormClosingEventArgs e)
        {
            Arreter(true);
        }
    }
}</code></pre><p id="r-379262" data-claire-element-id="379262">Et voilà, le travail pratique est complété !</p><h5 id="r-pistes-d-amelioration" data-claire-element-id="379273">Pistes d'amélioration</h5><p id="r-379265" data-claire-element-id="379265">Vous avez particulièrement aimé ce travail pratique ? Voici quelques pistes d'améliorations.</p><h6 id="r-interface-en-wpf" data-claire-element-id="379267">Interface en WPF</h6><p id="r-379266" data-claire-element-id="379266">Les Windows Forms, ça commence un peu à dater. C'est une technologie mature cependant. Peut-être un peu trop même. Elle commence à devenir incontinente. Pourquoi ne pas renipper votre interface en WPF ?</p><h6 id="r-connexion-du-client" data-claire-element-id="379269">Connexion du client</h6><p id="r-379268" data-claire-element-id="379268">Le client devrait pouvoir choisir de se connecter avec un identifiant. Cet identifiant serait indiqué au début de chaque message envoyé à la place ou en complément de l'adresse IP.</p><h6 id="r-configuration-18" data-claire-element-id="379272">Configuration</h6><p id="r-379270" data-claire-element-id="379270">Le serveur et le client devraient être complètement configurables au démarrage. Si vous voulez aller un peu plus loin, regardez du côté des fichiers de configuration. Ils sont très utiles. ;)</p><p id="r-379271" data-claire-element-id="379271">Et voilà, le premier Travail Pratique sur les sockets est terminé. Vous sentez-vous différent ? Revigoré ? J'espère que vous avez aimé l'exercice que cela vous a permis de bien consolider les connaissances que nous avons obtenu jusqu'à maintenant. La suite ne pourra qu'être plus difficile. Heureusement, elle devient encore plus intéressante !</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
<span class="arrow"></span>
<span class="next">Définition du serveur</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">
<span class="next">La sérialisation des objets</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lasrialisationdesobjets"></a><h2>La sérialisation des objets</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
<span class="arrow"></span>
<span class="next">Correction</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
<span class="next">Introduction à la sérialisation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-379276" data-claire-element-id="379276">J'espère que vous avez apprécié le premier Travail Pratique en réseau, mais j'espère surtout que vous avez eu du plaisir à le programmer. Dans cette section, nous allons commencer à communiquer à travers le réseau en terme d'objets. Oui, on sait maintenant envoyé des chaînes de caractères à travers le réseau. Cependant, on pourrait faire beaucoup beaucoup plus que cela ! C'est là qu'intervient la <strong>sérialisation</strong> des objets.</p>
</div><a name="Introductionlasrialisation"></a><h2>Introduction à la sérialisation</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">
<span class="arrow"></span>
<span class="next">La sérialisation des objets</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
<span class="next">Sérialisation en XML</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-introduction-a-la-serialisation" data-claire-element-id="379292">Introduction à la sérialisation</h4><p id="r-379277" data-claire-element-id="379277">En l'état de vos connaissances sur les Socket en .NET, vous êtes maintenant en mesure d'envoyer des données sur le réseau à l'aide du protocole UDP. Cependant, jusqu'à maintenant, on s'est contenté d'envoyer de bêtes chaînes de caractères. C'est excellent pour un début, mais on voudra vite aller vers une communication plus complexe.</p><p id="r-379278" data-claire-element-id="379278">C'est ici qu'entre en jeu la sérialisation. Beaucoup de débutants ne connaissent pas ce principe que je trouve tout simplement révolutionnaire. Certains viennent me voir et me demandent comment ils devraient s'y prendre pour sauvegarder un objet afin de le charger au prochain lancement de l'application. Ils commencent souvent par se casser la tête en tentant de programmer leur propre standard qui finit bien vite par être un vrai cauchemar. Je leur conseille alors la sérialisation.</p><p id="r-379279" data-claire-element-id="379279">Sérialiser un objet, c'est prendre un cliché de son état actuel afin de pouvoir le retrouver plus tard dans les mêmes conditions. Enfin, plus au moins. Quand on parle du concept de classe, on introduit souvent le principe en distinguant complètement chaque instance des autres. Par exemple, voici l'image que l'on donne souvent aux débutants afin qu'ils puissent mieux comprendre le concept.</p><figure id="r-theorie-afin-de-faire-comprendre-aux-debutants-les-avantages-de-la-poo" data-claire-element-id="379282"><img id="r-379280" data-claire-element-id="379280" src="medias/uploads.siteduzero.com_files_392001_393000_392561.png" alt="Théorie afin de faire comprendre aux débutants les avantages de la POO."/><figcaption>Théorie afin de faire comprendre aux débutants les avantages de la POO.</figcaption></figure><p id="r-379283" data-claire-element-id="379283">Le problème dans ce schéma, c'est que chaque instance apparaît avoir ses propres copies de méthodes. Or, désolé de vous l'apprendre, mais ce modèle est faux. C'est plutôt une simplification afin de rendre temporairement les choses plus simples et plus acceptables. Voici plutôt de quoi a l'air le vrai schéma.</p><figure id="r-comment-ca-se-passe-dans-la-vie-reelle" data-claire-element-id="379286"><img id="r-379284" data-claire-element-id="379284" src="medias/uploads.siteduzero.com_files_392001_393000_392562.png" alt="Comment ça se passe dans la vie réelle."/><figcaption>Comment ça se passe dans la vie réelle.</figcaption></figure><p id="r-379287" data-claire-element-id="379287">Ce schéma illustre ce dont vous deviez vous douter depuis un moment : les instances d'une classe partagent le même code. De toute manière, faire autant de copies que d'instancse aurait été une perte d'espace incroyable. N'oubliez pas que le code doit lui aussi être gardé en mémoire afin d'être exécuté. C'est grâce à cela que l'on peut avoir accès aux delegates, rappelez-vous. Puisque les processus sont communs, il est plus simple de créer des méthodes unique, puis de leur spécifier le contexte (avec le mot-clef <code data-claire-semantic="csharp">this</code>).</p><aside id="r-379289" data-claire-element-id="379289" data-claire-semantic="information"><p id="r-379288" data-claire-element-id="379288">Dans ces exemples, j'ai omis le concept de classes statiques. En fait, oui et non. Une classe statique est aussi une instance d'une classe. Cependant, cette dernière est créée lorsque nécessaire (au premier appel de celle-ci. Cette méthode est communément appelée <em>Lazy Loading</em>) et possède un nom qui nous est inconnu. La seule manière d'y avoir accès est alors de passer par la classe elle-même. Cependant, il s'agit bel et bien d'une instance de notre classe.</p></aside><p id="r-379290" data-claire-element-id="379290">Où je désire en venir avec ces explications est à la sérialisation. Car si toutes les méthodes sont communes et sont définies dans la classe, alors il est inutile de conserver cela dans un fichier externe, n'est-ce pas ? Notre classe s'en charge déjà. Cela signifie que la sérialisation ne se concentre que sur la portion <em>Données</em> de nos instances. C'est cette partie qui caractérise un objet et qui le distingue de toutes les autres instances. Sérialiser, c'est donc extraire les données d'une instance en vue de la <strong>réhydrater</strong> plus tard (à un prochain lancement ou lorsque les données se sont rendues sur un autre poste, par exemple). Sérialiser permet aussi d'échanger des données entre plusieurs langages.</p><p id="r-379291" data-claire-element-id="379291">Nous allons identifier deux méthodes pour sérialiser nos objets : la sérialisation XML et la sérialisation binaire. De ces deux, je vous suggère la dernière pour ce qui est de la communication réseau, car elle a l'avantage d'être généralement plus compacte et donc de produire moins de paquets.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">
<span class="arrow"></span>
<span class="next">La sérialisation des objets</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
<span class="next">Sérialisation en XML</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="SrialisationenXML"></a><h2>Sérialisation en XML</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
<span class="arrow"></span>
<span class="next">Introduction à la sérialisation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
<span class="next">Sérialisation binaire</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-serialisation-en-xml" data-claire-element-id="379404">Sérialisation en XML</h4><p id="r-379293" data-claire-element-id="379293">Nous allons commencer par la méthode qui nous intéresse moins, soit la sérialisation en XML, car c'est la méthode la plus facile. Le XML, pour <strong>eXtensible Markup Language</strong>, est un langage descriptif qui ressemble énormément au HTML. En effet, le XML communique à l'aide de balises, tout comme le HTML. Cependant, dans le cas du standard Web, les balises ont déjà été définies et seront comprises par le navigateur seulement si vous les utiliser bien. En XML, vous n'êtes pas contraints d'utiliser des balises prédéfinies. Le XML est là pour vous permettre de définir vos propres balises. o_O</p><p id="r-379294" data-claire-element-id="379294">Bon, je sais que sans exemple, ça semble un peu grandiose comme concept. Je vous dirais que ça l'est, mais que ça reste excessivement banale. Voici un exemple d'un simple document XML.</p><pre id="r-379295" data-claire-element-id="379295"><code data-claire-semantic="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;Personne&gt;
  &lt;Nom&gt;Despotins&lt;/Nom&gt;
  &lt;Prenom&gt;Yvan&lt;/Prenom&gt;
  &lt;Age&gt;55&lt;/Age&gt;
  &lt;Adresse&gt;
    &lt;Numero&gt;428&lt;/Numero&gt;
    &lt;Rue&gt;Rue des Yvan&lt;/Rue&gt;
    &lt;Ville&gt;Montréal&lt;/Ville&gt;
    &lt;Pays&gt;Canada&lt;/Pays&gt;
  &lt;/Adresse&gt;
&lt;/Personne&gt;</code></pre><p id="r-379296" data-claire-element-id="379296">Comme vous le voyez, il est assez simple d'y représenter des données. D'ailleurs, l'exemple que je vous ai préparé provient de la sérialisation d'une petite application que j'ai créé très rapidement. Nous allons étudier ce standard, bien que nous resterons en superficie.</p><h5 id="r-pourquoi-utiliser-le-xml" data-claire-element-id="379304">Pourquoi utiliser le XML ?</h5><ul id="r-379303" data-claire-element-id="379303"><li id="r-379298" data-claire-element-id="379298"><p id="r-379297" data-claire-element-id="379297">Le XML est un langage spécifiquement conçu pour faire de l'interopératibilité.</p></li><li id="r-379300" data-claire-element-id="379300"><p id="r-379299" data-claire-element-id="379299">Un document XML est aussi bien lisible par la machine que par l'homme. Il s'agit donc d'un bon compromis.</p></li><li id="r-379302" data-claire-element-id="379302"><p id="r-379301" data-claire-element-id="379301">Il s'agit d'un format ouvert qui appartient au Grand Public et qui n'est pas prêt de sombrer dans les oubliettes.</p></li></ul><h5 id="r-dans-quoi-utilise-t-on-le-xml" data-claire-element-id="379316">Dans quoi utilise-t-on le XML ?</h5><ul id="r-379313" data-claire-element-id="379313"><li id="r-379306" data-claire-element-id="379306"><p id="r-379305" data-claire-element-id="379305">Le XML est la base de plusieurs langages très connus. Par exemple, vous devez avoir entendu parler du XAML qui permet la création d'interfaces vectoriels en WPF.</p></li><li id="r-379308" data-claire-element-id="379308"><p id="r-379307" data-claire-element-id="379307">On l'utilise beaucoup sur le web, particulièrement dans les applications SOA (avec SOAP), mais on peut aussi l'utiliser avec AJAX.</p></li><li id="r-379310" data-claire-element-id="379310"><p id="r-379309" data-claire-element-id="379309">Il sont parfaits pour générer des fichiers de configuration. .NET en fait un grand usage dans plusieurs technologies novatrices comme Entity Framework, WCF et WPF, mais aussi dans les plus vieilles technologies comme ASP.NET Web Forms et MVC (fichiers Web.Config) et Windows Forms (fichiers App.Config).</p></li><li id="r-379312" data-claire-element-id="379312"><p id="r-379311" data-claire-element-id="379311">L'interface et les ressources des applications Android sont déclarés en XML.</p></li></ul><aside id="r-379315" data-claire-element-id="379315" data-claire-semantic="warning"><p id="r-379314" data-claire-element-id="379314">On pourrait être porté à croire que le XML est un langage de programmation, mais ce n'est pas le cas. Il s'agit plutôt d'une norme que l'on peut facilement reprendre pour définir des langages déclaratifs ! Il faut faire bien attention à ne pas confondre les deux.</p></aside><h5 id="r-etude-du-standard" data-claire-element-id="379339">Étude du standard</h5><p id="r-379317" data-claire-element-id="379317">Le XML est en fait une suite de règles qui régissent la validité d'un document de ce format. Voici ce que vous devez savoir.</p><h6 id="r-declaration-xml" data-claire-element-id="379326">Déclaration XML</h6><p id="r-379318" data-claire-element-id="379318">La première ligne d'un document XML est <strong>OBLIGATOIREMENT</strong> une balise un peu bizarre du type <code data-claire-semantic="xml">&lt;?xml ?&gt;</code>. Elle prend ce qu'on appelle des <strong>attributs</strong>. Les attributs sont un des moyens de représenter de l'information en XML. Les attributs acceptés dans ce cas sont :</p><ul id="r-379325" data-claire-element-id="379325"><li id="r-379320" data-claire-element-id="379320"><p id="r-379319" data-claire-element-id="379319">La version. À ce jour, il n'existe que la version 1.0 (la version 1.1 étant considérée un peu comme morte-née). Simple non ? Sa déclaration est cependant obligatoire, juste au cas où...</p></li><li id="r-379322" data-claire-element-id="379322"><p id="r-379321" data-claire-element-id="379321">On retrouve ensuite l'encodage du document. Plus souvent qu'autrement, on optera pour l'UTF-8 qui permet de décrire la plupart des caractères utilisés aujourd'hui dans les langues majeures.</p></li><li id="r-379324" data-claire-element-id="379324"><p id="r-379323" data-claire-element-id="379323">Il existe un troisième paramètre, soit <strong>standalone</strong>. Ce dernier est optionnel. Mettre sa valeur à <em>no</em> signifie que l'on doit se référer à un autre document à l'aide du <em>DOCTYPE</em>, car ce dernier aura un impact sur le fichier XML. Bref, vous l'aurez deviner, on ne l'utilisera pas. D'ailleurs, on ne jouera jamais avec le XML nous-même. Ce sera le sérialiseur qui s'en chargera.</p></li></ul><h6 id="r-les-balises-5" data-claire-element-id="379334">Les balises</h6><p id="r-379327" data-claire-element-id="379327">On définit une balise par les caractères &lt; (plus petit que) et &gt; (plus grand que) et le texte qui se trouve à l'intérieur. Cela crée ce qu'on appelle un noeud dans l'arbre XML.</p><p id="r-379328" data-claire-element-id="379328">Chaque balise ouverte doit <strong>OBLIGATOIREMENT</strong> et sans exception être fermée. On ferme une balise en insérant le caractère / devant le texte de la balise. Par exemple : <code data-claire-semantic="xml">&lt;Ville&gt;Montréal&lt;/Ville&gt;</code> est valide, mais <code data-claire-semantic="xml">&lt;Ville&gt;Montréal</code> ne l'est pas car la balise n'est pas fermée. De plus, les balises doivent être identiques. <code data-claire-semantic="xml">&lt;Ville&gt;Londres&lt;/City&gt; n'est pas absolument pas autorisé.</code></p><p id="r-379329" data-claire-element-id="379329">De plus, il ne peut y avoir qu'une seule racine au fichier XML, la balise de déclaration XML ne comptant pas. Il faut se représenter un fichier XML comme une structure en arbre. Un arbre ne peut avoir qu'un seul tronc. À partir de ce tronc, on obtiendra des branches et ces branches se sépareront en plus petites branches, etc. C'est la même chose pour un document XML. Dans l'exemple que je vous ai fourni, la balise <code data-claire-semantic="xml">&lt;Personne&gt;&lt;/Personne&gt;</code> fait office de noeud racine. On appelle d'ailleurs cette conception en arbre le DOM, pour <strong>Document Object Model</strong>. Le DOM est un concept fort utile qui permet une navigation aisée des documents XML, mais aussi et surtout du HTML (jQuery, ça vous dit quelque chose ?). Pour votre connaissance, il existe d'autres représentations du XML, comme le SAX, mais nous ne les verrons pas.</p><p id="r-379330" data-claire-element-id="379330">Autre règle, on ne peut pas interlacer les balises. Une balise qui en englobe une autre ne peut se terminer avant celle-ci. Par exexmple, ceci n'est pas valide :</p><pre id="r-379331" data-claire-element-id="379331"><code data-claire-semantic="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;Personne&gt;
  &lt;Nom&gt;Despotins&lt;/Nom&gt;
  &lt;Prenom&gt;Yvan&lt;/Prenom&gt;
  &lt;Age&gt;55&lt;/Age&gt;
  &lt;Adresse&gt;
    &lt;Numero&gt;428&lt;/Numero&gt;
    &lt;Rue&gt;Rue des Yvan&lt;/Rue&gt;
    &lt;Ville&gt;Montréal&lt;/Ville&gt;
    &lt;Pays&gt;Canada&lt;/Pays&gt;
&lt;/Personne&gt;
&lt;/Adresse&gt;</code></pre><p id="r-379332" data-claire-element-id="379332">On doit d'abord fermer la balise Adresse à la ligne 11, puis on peut fermer la balise Personne à la ligne 12.</p><p id="r-379333" data-claire-element-id="379333">Sachez également que les balises peuvent être encapsulées à des niveaux infinis, en autant que les règles ci-dessus sont appliquées.</p><h6 id="r-les-attributs-15" data-claire-element-id="379338">Les attributs</h6><p id="r-379335" data-claire-element-id="379335">Les attributs sont une autre manière de représenter l'information. Si l'information est contenue dans une forme simple (c'est-à-dire une chaîne de caractère ou un nombre), on peut encapsuler l'information dans un attribut. Cela rend l'information plus lisible et peut du coup rendre le XML moins verbeux. Voici l'exemple que je vous ai présenté plus tôt en employant des attributs.</p><pre id="r-379336" data-claire-element-id="379336"><code data-claire-semantic="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;Personne Nom=&quot;Despotins&quot; Prenom=&quot;Yvan&quot; Age=&quot;55&quot;&gt;
  &lt;Adresse Numero=&quot;428&quot; Rue=&quot;Rue des Yvan&quot; Ville=&quot;Montréal&quot; Pays=&quot;Canada&quot; /&gt;
&lt;/Personne&gt;</code></pre><p id="r-379337" data-claire-element-id="379337">Et voilà, j'ai réduit la taille de mon document XML de 300% ! C'est un gain d'espace énorme quand les fichiers deviennent volumineux. Cependant, remarquez que je n'ai pas pu mettre la balise <code data-claire-semantic="xml">&lt;Adresse&gt;&lt;/Adresse&gt;</code> en attribut, car il s'agit d'une valeur composée. Je n'ai donc pas d'autre choix que de mettre cet objet en balise à l'intérieur de ma balise <strong>Personne</strong>. D'ailleurs, remarquez que les attributs emploient des délimitations avec des guillemets anglais. Les valeurs dans les attributs sont toujours entourées de guillemets, même s'il s'agit de nombres.</p><h5 id="r-bon-et-le-c-dans-tout-ca" data-claire-element-id="379353">Bon, et le C# dans tout ça ?</h5><p id="r-379340" data-claire-element-id="379340">Je comprends que vous soyez impatients de commencer. Comme je le disais plus haut, nous n'allons pas jouer directement nous-mêmes avec le XML lors de la sérialisation, mais nous aurons besoin de ces notions un peu plus loin lorsque nous aborderons le framework WCF. Sachez cependant que le .NET inclut toute une gamme de classes pour vous permettre de construire et d'analyser vos fichiers XML. Il y a également LINQ to XML qui en vaut le détour !</p><p id="r-379341" data-claire-element-id="379341">Dans le cas de la sérialisation, tout se fera presque seul. On demandera au .NET de figer l'état actuel d'un objet dans un <strong>flux </strong>ou dans un <strong>TextWriter </strong>qui s'occupera (dans cet exemple) de l'écrire dans un fichier texte. Voici les classes qui ont servi à générer les fichiers XML que j'ai donné en exemple plus haut.</p><pre id="r-379342" data-claire-element-id="379342"><code data-claire-semantic="csharp">using System;
using System.Xml.Serialization;

namespace SerializationEx
{
    [Serializable]
    public class Personne
    {
        [XmlAttribute()]
        public string Nom { get; set; }

        [XmlAttribute()]
        public string Prenom { get; set; }

        [XmlAttribute()]
        public int Age { get; set; }

        public Adresse Adresse { get; set; }
    }
}</code></pre><pre id="r-379343" data-claire-element-id="379343"><code data-claire-semantic="csharp">using System;
using System.Xml.Serialization;

namespace SerializationEx
{
    [Serializable]
    public class Adresse
    {
        [XmlAttribute()]
        public int Numero { get; set; }

        [XmlAttribute()]
        public string Rue { get; set; }

        [XmlAttribute()]
        public string Ville { get; set; }

        [XmlAttribute()]
        public string Pays { get; set; }
    }
}</code></pre><p id="r-379344" data-claire-element-id="379344">Je vous voit venir : &quot;Attends, mais c'est tout ? C'est pas sérieux, ça peut pas être aussi facile...&quot; o_O</p><p id="r-379345" data-claire-element-id="379345">Ben euh... oui. :-° Je vais vous expliquer un peu quand même parce que certains éléments peuvent vous sembler étranges. C'est peut-être la première fois que vous voyez des attributs en C#.</p><h6 id="r-les-attributs-net" data-claire-element-id="379352">Les attributs .NET</h6><p id="r-379346" data-claire-element-id="379346">Les attributs sont des classes un peu spéciales. Elles permettent de coller un ou plusieurs comportements à une classe ou à un membre d'une classe. Ces comportement pourront alors être récupérés lors de l'exécution du programme grâce à la Réflectivité de .NET. On parle aussi de <strong>metadata</strong> pour caractériser ces comportements, Nous n'allons pas entrer dans les détails, mais cette description devrait vous permettre de commencer à comprendre leur rôle. On déclare les attributs entre crochets en C#. Les parenthèses sont facultatives si on n'a pas de paramètre nommés à passer. Les paramètres nommés permettent de spécifier quelques options supplémentaires par rapport à ces attributs. Nous en aurons besoin lorsque nous ferons du WCF. Pour le moment, utilisons les attributs à saveur &quot;<em>nature</em>&quot;. ^^</p><p id="r-379347" data-claire-element-id="379347">Dans notre classe Personne, on peut voir que l'attribut <code data-claire-semantic="csharp">[Serializable]</code> est déclaré. Ce dernier sert à indiquer que cette classe est sérialisable. Cet attribut, facultatif dans le cas de la sérialisation en XML, se trouve dans le namespace <em>System</em>. Je vous conseille fortement de l'employer quand vous planifiez de sérialiser un classe. Ça rend les intentions plus claires et ça peut vous éviter quelques mauvaises surprises.</p><p id="r-379348" data-claire-element-id="379348">Les attributs <code data-claire-semantic="csharp">[XmlAttribute]</code> sur les propriétés de l'objet permettent de générer les valeurs de ces champs en tant qu'attribut XML plutôt que sous-balise. À noter que vous pouvez les retirer si vous n'aimez pas ce comportement. Si l'on désire qu'une propriété ne soit pas sérialisée, on lui appliquera l'attribut <code data-claire-semantic="csharp">[XmlIgnore]</code> (Cet attribut se trouve dans le namespace <em>System.Xml.Serialization</em>). En effet, dans le cas de la sérialisation XML, Microsoft a opté pour une approche <strong>Opt-Out</strong>. Cela signifie que par défaut, le .NET essaiera de sérialiser tout membre publique. Si on ne souhaite pas sérialiser un membre, il faudra le spécifier.</p><aside id="r-379350" data-claire-element-id="379350" data-claire-semantic="warning"><p id="r-379349" data-claire-element-id="379349">La sérialisation ne s'applique que sur les champs <strong>publics </strong>d'une classe. Il est donc conseillé d'utiliser la sérialisation avec les propriétés plutôt que sur les variables membres elles-mêmes. De toute manière, dû à l'encapsulation, vous ne devriez pas avoir à vous soucier de ce détail car toutes vos variables membres devraient être privées. Par contre, pour ce qui est des membres publics, ils doivent ABSOLUMENT se retrouver en capacité de lecture ET d'écriture. Sinon, la sérialisation ne fonctionnera pas. En fait, votre programme plantera lamentablement en vous donnant une erreur lors de l'exécution. De plus, la classe qui est sérialisable doit également et absolument détenir un <strong>constructeur public par défaut</strong> (sans paramètre). Le constructeur par défaut peut cependant et sans problème définir du code.</p></aside><p id="r-379351" data-claire-element-id="379351">Bref, la sérialisation en .NET vient avec beaucoup de contraintes qui ne sont pas présentes par exemple en Java. Cependant, le principe reste puissant, car il vous évitera une quantité phénoménale de travail ! Il existe probablement d'autres outils de sérialisation XML en .NET qui sont plus flexibles. Je vous laisser chercher sur Google si ça vous intéresse. Il reste encore à savoir comment sérialiser et désérialiser, n'est-ce pas ?</p><h5 id="r-les-methodes-de-serialisation-et-de-deserialisation" data-claire-element-id="379364">Les méthodes de sérialisation et de désérialisation</h5><p id="r-379354" data-claire-element-id="379354">Maintenant que nos classes sont prêtes à être sérialisées, il faudra lancer l'opération. Rappelez-vous, il nous faudra une instance de notre objet afin de mener à bien une sérialisation. Je vais d'abord vous fournir un exemple de chaque opération dans une méthode Main. Par la suite, il vous incombera d'encapsuler ces méthodes dans des classes afin de bien les utiliser.</p><h6 id="r-serialiser" data-claire-element-id="379360">Sérialiser</h6><pre id="r-379355" data-claire-element-id="379355"><code data-claire-semantic="csharp">using System.IO;
using System.Xml.Serialization;

namespace SerializationEx
{
    public class Program
    {
        private static void Main(string[] args)
        {
            Personne p = new Personne()
            {
                Nom = &quot;Despotins&quot;,
                Prenom = &quot;Yvan&quot;,
                Age = 55,
                Adresse = new Adresse()
                {
                    Numero = 422,
                    Rue = &quot;Rue des Yvan&quot;,
                    Ville = &quot;Montréal&quot;,
                    Pays = Pays.CANADA
                }
            };

            //On crée une instance de XmlSerializer dans lequel on lui spécifie le type
            //de l'objet à sérialiser. On utiliser l'opérateur typeof pour cela.
            XmlSerializer serializer = new XmlSerializer(typeof(Personne));

            //Création d'un Stream Writer qui permet d'écrire dans un fichier. On lui spécifie le chemin
            //et si le flux devrait mettre le contenu à la suite de notre document (true) ou s'il devrait
            //l'écraser (false).
            StreamWriter ecrivain = new StreamWriter(&quot;Test.xml&quot;, false);

            //On sérialise en spécifiant le flux d'écriture et l'objet à sérialiser.
            serializer.Serialize(ecrivain, p);

            //IMPORTANT : On ferme le flux en tous temps !!!
            ecrivain.Close();
        }
    }
}</code></pre><p id="r-379356" data-claire-element-id="379356">Remarquez que j'ai un peu modifié la structure de ma classe Adresse pour accepter une Énumération à la place d'une chaîne de caractères pour vous montrer que les énumérations aussi sont sérialisables. Bref, c'est assez simple. On crée un objet <code data-claire-semantic="csharp">Personne</code> et on lui définit ses Propriétés et ses valeurs. Ensuite, on crée un objet de type <code data-claire-semantic="csharp">XmlSerializer</code> et on lui spécifie que l'on travaillera avec le type Personne. Par la suite, on crée un <strong>flux </strong>ou un <strong>TextWriter </strong>qui accueillera les données. On aurait pu créer un <code data-claire-semantic="csharp">MemoryStream</code>, en autant que la classe hérite de <code data-claire-semantic="csharp">Stream</code> ou de <code data-claire-semantic="csharp">TextWriter</code>. Puisque l'on a choisi un <code data-claire-semantic="csharp">StreamWriter</code>, il faut lui spécifier l'emplacement où l'on désire écrire sur le Disque Dur (ici, ce sera dans le dossier de l'exécutable avec le nom Test.xml). D'ailleurs, vous pouvez spécifier vos propres extensions sans problème. Après tout, ce n'est qu'un fichier texte. Ensuite, on lance la sérialisation avec notre objet serializer en lui spécifiant le flux dans lequel il doit écrire et l'objet qu'il doit sérialiser.</p><aside id="r-379358" data-claire-element-id="379358" data-claire-semantic="warning"><p id="r-379357" data-claire-element-id="379357">La dernière étape peut causer bien des maux si elle n'est pas exécutée : Fermez votre flux après son utilisation. Sinon, vous pourriez vous retrouver avec des fichiers illisibles qui ne veulent plus se supprimer, ce qui peut occasionner des exceptions inutiles. Bref, ne courrez pas cette chance.</p></aside><p id="r-379359" data-claire-element-id="379359">Merveilleux ! Si vous vérifiez le dossier dans lequel votre exécutable se situe (soit {...}\Projects\VotreProjet\bin\Debug\), vous trouverez un fichier nommé Test.xml. Vous pouvez l'ouvrir avec votre éditeur de texte favoris. Voilà que nous avons sérialisé notre premier objet !</p><h6 id="r-deserialiser" data-claire-element-id="379363">Désérialiser</h6><p id="r-379361" data-claire-element-id="379361">Si nous avons pu mettre l'information d'un objet dans un fichier XML automatiquement, il est normal que l'on puisse faire le contraire, c'est-à-dire restaurer l'objet à l'aide de la sauvegarde. Il n'y a pas grand chose de nouveau dans cette section, car le processus est littéralement l'inverse, ni plus ni moins.</p><pre id="r-379362" data-claire-element-id="379362"><code data-claire-semantic="csharp">using System.IO;
using System.Xml.Serialization;

namespace SerializationEx
{
    public class Program
    {
        private static void Main(string[] args)
        {
            //On crée une instance de XmlSerializer dans lequel on lui spécifie le type
            //de l'objet à sérialiser. On utiliser l'opérateur typeof pour cela.
            XmlSerializer serializer = new XmlSerializer(typeof(Personne));

            //Création d'un StreamReader qui permet de lire un fichier. On lui spécifie le chemin.
            StreamReader lecteur = new StreamReader(&quot;Test.xml&quot;);

            //On obtient une instance de l'objet désérialisé. Attention, la méthode Deserialize renvoie
            //un objet de type Object. Il faut donc transtyper(caster).
            Personne p = (Personne)serializer.Deserialize(lecteur);

            //IMPORTANT : On ferme le flux en tout temps !!!
            lecteur.Close();
        }
    }
}</code></pre><h5 id="r-creer-des-collections" data-claire-element-id="379375">Créer des collections</h5><p id="r-379365" data-claire-element-id="379365">Je vais vous donner un exemple concret de la sérialisation. Il vous permettra de mieux comprendre l'intérêt de la sérialisation. Comme vous avez pu voir, j'ai performé la sérialisation sur un simple objet. Il est rare de faire cela, car c'est un peu comme de gaspiller les fichiers XML. Comme il ne peut y avoir qu'une seule racine, il nous faudra un autre fichier afin de nous permettre de sauvegarder une autre personne. C'est un peu bête selon moi. Voici ce que je vous propose plutôt.</p><p id="r-379366" data-claire-element-id="379366">J'ai allégé un peu la classe Personne juste pour rendre l'exemple plus simple.</p><pre id="r-379367" data-claire-element-id="379367"><code data-claire-semantic="csharp">using System;

namespace MassSerialisation
{
    [Serializable]
    public class Personne
    {
        public string Nom { get; set; }

        public string Prenom { get; set; }
    }
}</code></pre><p id="r-379368" data-claire-element-id="379368">J'ai introduit une nouvelle classe qui hérite d'une liste de Personne afin de pouvoir y stocker ce dont j'ai besoin. Notez que j'aurais pu utiliser une liste en tant que membre, mais j'aurais eu à recréer quelques méthodes pour les rendre accessibles de l'extérieur de la classe.</p><pre id="r-379369" data-claire-element-id="379369"><code data-claire-semantic="csharp">using System;
using System.Collections.Generic;
using System.IO;
using System.Xml.Serialization;

namespace MassSerialisation
{
    [Serializable()]
    public class Personnes : List&lt;Personne&gt;     //On hérite d'une liste de personnes.
    {
        /// &lt;summary&gt;
        /// Enregistre l'état courant de la classe dans un fichier au format XML.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;chemin&quot;&gt;&lt;/param&gt;
        public void Enregistrer(string chemin)
        {
            XmlSerializer serializer = new XmlSerializer(typeof(Personnes));
            StreamWriter ecrivain = new StreamWriter(chemin);
            serializer.Serialize(ecrivain, this);
            ecrivain.Close();
        }

        public static Personnes Charger(string chemin)
        {
            XmlSerializer deserializer = new XmlSerializer(typeof(Personnes));
            StreamReader lecteur = new StreamReader(chemin);
            Personnes p = (Personnes)deserializer.Deserialize(lecteur);
            lecteur.Close();

            return p;
        }
    }
}</code></pre><p id="r-379370" data-claire-element-id="379370">Et finalement le Main.</p><pre id="r-379371" data-claire-element-id="379371"><code data-claire-semantic="csharp">using System.IO;

namespace MassSerialisation
{
    public class Program
    {
        private const string CHEMIN = &quot;Test.xml&quot;;

        private static void Main(string[] args)
        {
            Personnes personnes = null;

            if (File.Exists(CHEMIN))
            {
                personnes = Personnes.Charger(CHEMIN);
            }
            else
            {
                personnes = new Personnes();
            }

            //Étapes ici.
            personnes.Add(new Personne() { Nom = &quot;Larivière&quot;, Prenom = &quot;Germain&quot; });
            personnes.Add(new Personne() { Nom = &quot;Dancereau&quot;, Prenom = &quot;Nancy&quot; });

            //Sauvegarde
            personnes.Enregistrer(CHEMIN);
        }
    }
}</code></pre><p id="r-379372" data-claire-element-id="379372">Et voilà ! Le résultat est le fichier XML suivant :</p><pre id="r-379373" data-claire-element-id="379373"><code data-claire-semantic="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;ArrayOfPersonne xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;
  &lt;Personne&gt;
    &lt;Nom&gt;Larivière&lt;/Nom&gt;
    &lt;Prenom&gt;Germain&lt;/Prenom&gt;
  &lt;/Personne&gt;
  &lt;Personne&gt;
    &lt;Nom&gt;Dancereau&lt;/Nom&gt;
    &lt;Prenom&gt;Nancy&lt;/Prenom&gt;
  &lt;/Personne&gt;
&lt;/ArrayOfPersonne&gt;</code></pre><p id="r-379374" data-claire-element-id="379374">Et l'on peut y mettre autant de personnes que l'on y désire. Bref, on pourrait faire une petite base de données maison avec ce processus, bien que lorsque la quantité de données devient trop grande, il vaut mieux reléguer ce rôle à un vrai SGBD.</p><h5 id="r-le-cas-de-l-heritage" data-claire-element-id="379403">Le cas de l'héritage</h5><p id="r-379376" data-claire-element-id="379376">Vous le sentez venir votre mal de tête là hein ? :p Ne vous inquiétez pas, il ne fait que commencer. J'ai commencé à programmer un simili jeu de rôle (exemple classique) dans lequel j'ai une classe Personnage qui dérive en Magicien et en Guerrier. Jusque là, rien de bien compliqué. Tenez, je vous fournis même les classes.</p><pre id="r-379377" data-claire-element-id="379377"><code data-claire-semantic="csharp">using System;
using System.Xml.Serialization;

namespace XMLSerialisation
{
    [Serializable()]
    public abstract class Personnage
    {
        public string Nom { get; set; }

        public int Niveau { get; set; }

        public int PointVie { get; set; }
    }
}</code></pre><pre id="r-379378" data-claire-element-id="379378"><code data-claire-semantic="csharp">using System;

namespace XMLSerialisation
{
    [Serializable()]
    public class Magicien : Personnage
    {
        public int PointMagie { get; set; }

        public string NomBaguette { get; set; }
    }
}</code></pre><pre id="r-379379" data-claire-element-id="379379"><code data-claire-semantic="csharp">using System;

namespace XMLSerialisation
{
    [Serializable()]
    public class Guerrier : Personnage
    {
        public int Force { get; set; }

        public string NomEpee { get; set; }
    }
}</code></pre><p id="r-379380" data-claire-element-id="379380">Alors, le but est de créer une équipe de personnages afin que ceux-ci évoluent à peu près à la même vitesse. L'équipe sera composée d'objets de type Personnage. Comme ce type est abstrait et est hérité par tous, on pourra stocker l'équipe dans une liste générique de type Personnage.</p><p id="r-379381" data-claire-element-id="379381">Bien ! Au niveau programmation, il n'y a pas de problème. Allons-y et créons-nous une liste de ce genre.</p><pre id="r-379382" data-claire-element-id="379382"><code data-claire-semantic="csharp">List&lt;Personnage&gt; equipe = new List&lt;Personnage&gt;();

equipe.Add(new Magicien() { Nom = &quot;Galgutta&quot;, Niveau = 12, PointVie = 58, PointMagie = 200, NomBaguette = &quot;Ombra&quot; });
equipe.Add(new Guerrier() { Nom = &quot;Ulgur&quot;, Niveau = 14, PointVie = 200, Force = 62, NomEpee = &quot;Destructor&quot; });</code></pre><p id="r-379383" data-claire-element-id="379383">Maintenant, tentez de sérialiser la collection juste pour voir.</p><pre id="r-379384" data-claire-element-id="379384"><code data-claire-semantic="csharp">using System.Collections.Generic;
using System.IO;
using System.Xml.Serialization;

namespace XMLSerialisation
{
    internal class Program
    {
        private static void Main(string[] args)
        {
            List&lt;Personnage&gt; equipe = new List&lt;Personnage&gt;();

            equipe.Add(new Magicien() { Nom = &quot;Galgutta&quot;, Niveau = 12, PointVie = 58, PointMagie = 200, NomBaguette = &quot;Ombra&quot; });
            equipe.Add(new Guerrier() { Nom = &quot;Ulgur&quot;, Niveau = 14, PointVie = 200, Force = 62, NomEpee = &quot;Destructor&quot; });

            XmlSerializer serialiseur = new XmlSerializer(typeof(List&lt;Personnage&gt;));
            StreamWriter ecrivain = new StreamWriter(&quot;sauvegarde.sav&quot;);
            serialiseur.Serialize(ecrivain, equipe);
            ecrivain.Flush();
            ecrivain.Close();
        }
    }
}</code></pre><aside id="r-379386" data-claire-element-id="379386" data-claire-semantic="error"><p id="r-379385" data-claire-element-id="379385">Oh là ! La belle exception. On a une erreur qui nous dit bêtement qu'il y a eu un problème avec la sérialisation, sans plus ni moins. Il va donc falloir creuser afin de régler ce problème.</p></aside><p id="r-379387" data-claire-element-id="379387">La sérialisateur XML semble véritablement être une perle à vos yeux en ce moment. Cependant, sachez qu'il commence à dater un peu à mon goût. Ce serialisateur est un peu bête et n'a pas toutes les caractéristiques qu'on attendrait d'un excellent sérialisateur. Son homologue en JSON est lui, beaucoup plus intelligent et optimisé à l'orienté objet de nos programmes. Avec notre bête sérialisateur, il faudra bien prendre soin de spécifier dans la classe parent les types enfants qui sont possibles, et non pas l'inverse. :waw:</p><p id="r-379388" data-claire-element-id="379388">Ouais, c'est comme ça. Du coup, vos programmes pourraient vite devenir plus difficiles à gérer. Bon, ce n'est pas non plus la fin du monde. Certaines personnes ont programmé des frameworks alternatifs qui sont plus rapides, plus optimisés et qui omettent d'avoir à utiliser des attributs à toutes les sauces. Cependant, dans notre cas, on se contentera de ce que .NET nous fournit.</p><div id="r-379390" data-claire-element-id="379390" data-claire-semantic="question"><p id="r-379389" data-claire-element-id="379389">Bon, on le règle comment notre problème de sérialisation ?</p></div><p id="r-379391" data-claire-element-id="379391">La réponse est simple : On va ajouter des attributs à notre classe Personnage, ce qui permettra au sérialisateur de connaître les types enfants. On y arrivera avec l'attribut <code data-claire-semantic="csharp">XmlInclude(Type typeDeLEnfant)</code>.</p><p id="r-379392" data-claire-element-id="379392">Voici la classe Personnage renipée pour répondre à nos besoins.</p><pre id="r-379393" data-claire-element-id="379393"><code data-claire-semantic="csharp">using System;
using System.Xml.Serialization;

namespace XMLSerialisation
{
    [Serializable(), XmlInclude(typeof(Guerrier)), XmlInclude(typeof(Magicien))]
    public abstract class Personnage
    {
        public string Nom { get; set; }

        public int Niveau { get; set; }

        public int PointVie { get; set; }
    }
}</code></pre><aside id="r-379395" data-claire-element-id="379395" data-claire-semantic="information"><p id="r-379394" data-claire-element-id="379394">Remarquez comment on peut combiner et enchaîner les attributs dans un même ensemble de crochets.</p></aside><p id="r-379396" data-claire-element-id="379396">Maintenant, si vous tentez de faire fonctionner votre programme, vous obtenez ceci :</p><pre id="r-379397" data-claire-element-id="379397"><code data-claire-semantic="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;ArrayOfPersonnage xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;
  &lt;Personnage xsi:type=&quot;Magicien&quot;&gt;
    &lt;Nom&gt;Galgutta&lt;/Nom&gt;
    &lt;Niveau&gt;12&lt;/Niveau&gt;
    &lt;PointVie&gt;58&lt;/PointVie&gt;
    &lt;PointMagie&gt;200&lt;/PointMagie&gt;
    &lt;NomBaguette&gt;Ombra&lt;/NomBaguette&gt;
  &lt;/Personnage&gt;
  &lt;Personnage xsi:type=&quot;Guerrier&quot;&gt;
    &lt;Nom&gt;Ulgur&lt;/Nom&gt;
    &lt;Niveau&gt;14&lt;/Niveau&gt;
    &lt;PointVie&gt;200&lt;/PointVie&gt;
    &lt;Force&gt;62&lt;/Force&gt;
    &lt;NomEpee&gt;Destructor&lt;/NomEpee&gt;
  &lt;/Personnage&gt;
&lt;/ArrayOfPersonnage&gt;</code></pre><p id="r-379398" data-claire-element-id="379398">Et voilà, le tour est joué !</p><aside id="r-379400" data-claire-element-id="379400" data-claire-semantic="warning"><p id="r-379399" data-claire-element-id="379399">Ne vous laissez pas méprendre. Les attributs .NET ne sont pas héritables. Il faudra les redéfinir à chaque nouvelle classe enfant qui est sérialisable. Dans notre cas, l'héritage ne se rend pas plus bas. Mais si c'était le cas, il faudrait faire attention à cela.</p></aside><aside id="r-379402" data-claire-element-id="379402" data-claire-semantic="error"><p id="r-379401" data-claire-element-id="379401">N'essayez jamais de sérialiser de contrôles Windows Forms. Ce n'est pas une bonne technique. Il vaut mieux utiliser une classe qui servira de tampon entre le contrôle et le sérialiseur afin de ne garder que les propriétés désirées.</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
<span class="arrow"></span>
<span class="next">Introduction à la sérialisation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
<span class="next">Sérialisation binaire</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Srialisationbinaire"></a><h2>Sérialisation binaire</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
<span class="arrow"></span>
<span class="next">Sérialisation en XML</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-serialisation-binaire" data-claire-element-id="379504">Sérialisation binaire</h4><p id="r-379405" data-claire-element-id="379405">Bon, nous y voilà ! La sérialisation binaire. On va pouvoir créer des fichiers plus compactes, ce qui va nous permettre d'envoyer les données sur le réseau.</p><h5 id="r-les-specifications-de-la-serialisation-binaire" data-claire-element-id="379448">Les spécifications de la sérialisation binaire</h5><p id="r-379406" data-claire-element-id="379406">La sérialisation binaire crée un instantané d'un objet de manière plus compacte que la sérialisation XML. Il faut bien reconnaître un défaut au XML : il est verbeux. Plus une norme est verbeuse, plus elle est lourde. Quand on voudra transférer des données sur le réseau, il sera important de réduire le plus possible la taille des messages pour des communications plus rapides. En plus, sérialiser et désérialiser est rendu une opération des plus faciles pour nos puissants processeurs d'aujourd'hui.</p><aside id="r-379408" data-claire-element-id="379408" data-claire-semantic="warning"><p id="r-379407" data-claire-element-id="379407">Pour ce qui est de la sérialisation binaire, il est <strong>IMPÉRATIF</strong> d'avoir l'attribut <em>Serializable</em> attaché à vos classes. Si vous avez suivi mes conseils et que vous avez mis l'attribut même s'il était facultatif, il ne devrait pas y avoir de problèmes.</p></aside><h6 id="r-comment-faire-pour-serialiser" data-claire-element-id="379447">Comment faire pour sérialiser ?</h6><p id="r-379409" data-claire-element-id="379409">Nous allons reprendre comme base notre super jeu RPG. Revoici les différentes classes que nous utiliserons. Vous remarquerez qu'elles ont un peu changé. En effet, j'ai réintroduit l'attribut <em>Serializable </em>et j'ai retiré l'attribut <em>XmlInclude</em>. Vous verrez, nous n'en aurons pas besoin.</p><aside id="r-379411" data-claire-element-id="379411" data-claire-semantic="warning"><p id="r-379410" data-claire-element-id="379410">Tous les attributs que nous avons vu débutant par XML ne seront pas valides en sérialisation binaire. Vous pouvez toujours les employer, mais ils n'auront aucun effet sur le processus, et c'est bien normal. En binaire, les attributs XML n'existent pas.</p></aside><aside id="r-379413" data-claire-element-id="379413" data-claire-semantic="information"><p id="r-379412" data-claire-element-id="379412">Vous rappelez-vous que pour sérialiser en XML, il fallait absolument que les Propriétés soient accessibles en lecture et en écriture et que la classe soit dotée d'un constructeur par défaut ? Eh bien ce n'est pas le cas avec le sérialisateur binaire. En effet, vous êtes libres de faire comme bon vous semble avec vos règles d'encapsulation parce qu'en effet, elles ne seront pas prises en compte lors du processus de sauvegarder et de chargement. Cela vous permet de créer des classes plus solides, et qui gardent leur intégrité en tout temps. Génial, non ?</p></aside><pre id="r-379414" data-claire-element-id="379414"><code data-claire-semantic="csharp">using System;
using System.Xml.Serialization;

namespace XMLSerialisation
{
    [Serializable]
    public abstract class Personnage
    {
        public string Nom { get; set; }

        public int Niveau { get; set; }

        public int PointVie { get; set; }
    }
}</code></pre><pre id="r-379415" data-claire-element-id="379415"><code data-claire-semantic="csharp">using System;

namespace XMLSerialisation
{
    [Serializable]
    public class Magicien : Personnage
    {
        public int PointMagie { get; set; }

        public string NomBaguette { get; set; }
    }
}</code></pre><pre id="r-379416" data-claire-element-id="379416"><code data-claire-semantic="csharp">using System;

namespace XMLSerialisation
{
    [Serializable]
    public class Guerrier : Personnage
    {
        public int Force { get; set; }

        public string NomEpee { get; set; }
    }
}</code></pre><p id="r-379417" data-claire-element-id="379417">Et maintenant, la méthode Main qui contient toute notre logique.</p><pre id="r-379418" data-claire-element-id="379418"><code data-claire-semantic="csharp">using System.Collections.Generic;
using System.IO;
using System.Runtime.Serialization.Formatters.Binary;

namespace XMLSerialisation
{
    public class Program
    {
        private static void Main(string[] args)
        {
            List&lt;Personnage&gt; equipe = Charger&lt;List&lt;Personnage&gt;&gt;(&quot;data.bin&quot;);

            if (equipe == null)
            {
                equipe = new List&lt;Personnage&gt;();

                equipe.Add(new Magicien() { Nom = &quot;Galgutta&quot;, Niveau = 12, PointVie = 58, PointMagie = 200, NomBaguette = &quot;Ombra&quot; });
                equipe.Add(new Guerrier() { Nom = &quot;Ulgur&quot;, Niveau = 14, PointVie = 200, Force = 62, NomEpee = &quot;Destructor&quot; });
            }

            Enregistrer(equipe, &quot;data.bin&quot;);
        }

        private static void Enregistrer(object toSave, string path)
        {
            //On utilise la classe BinaryFormatter dans le namespace System.Runtime.Serialization.Formatters.Binary.
            BinaryFormatter formatter = new BinaryFormatter();
            //La classe BinaryFormatter ne fonctionne qu'avec un flux, et non pas un TextWriter.
            //Nous allons donc utiliser un FileStream. Remarquez que n'importe quel flux est
            //compatible.
            FileStream flux = null;
            try
            {
                //On ouvre le flux en mode création / écrasement de fichier et on
                //donne au flux le droit en écriture seulement.
                flux = new FileStream(path, FileMode.Create, FileAccess.Write);
                //Et hop ! On sérialise !
                formatter.Serialize(flux, toSave);
                //On s'assure que le tout soit écrit dans le fichier.
                flux.Flush();
            }
            catch { }
            finally
            {
                //Et on ferme le flux.
                if(flux != null)
                    flux.Close();
            }
        }

        private static T Charger&lt;T&gt;(string path)
        {
            BinaryFormatter formatter = new BinaryFormatter();
            FileStream flux = null;
            try
            {
                //On ouvre le fichier en mode lecture seule. De plus, puisqu'on a sélectionné le mode Open,
                //si le fichier n'existe pas, une exception sera levée.
                flux = new FileStream(path, FileMode.Open, FileAccess.Read);

                return (T)formatter.Deserialize(flux);
            }
            catch
            {
                //On retourne la valeur par défaut du type T.
                return default(T);
            }
            finally
            {
                if(flux != null)
                    flux.Close();
            }

        }
    }
}</code></pre><p id="r-379419" data-claire-element-id="379419">Nous utiliserons la classe <code data-claire-semantic="csharp">BinaryFormatter</code> pour sérialiser nos objets. Celle-ci doit travailler avec un flux. C'est pour ça qu'on utilisera un <code data-claire-semantic="csharp">FileStream</code> plutôt qu'un <code data-claire-semantic="csharp">StreamWriter</code>, car ce dernier hérite de <code data-claire-semantic="csharp">TextWriter</code> plutôt que de <code data-claire-semantic="csharp">Stream</code>. D'ailleurs, pour ouvrir un FileStream, il existe plusieurs surcharges de constructeurs, mais celle qui me plaît le plus est celle que je vous ai montré dans l'exemple ci-dessus. Elle prend trois paramètres et permet d'ouvrir un flux lié à un fichier exactement de la manière dont vous le désirez. D'abord, on spécifie le nom du fichier auquel le flux doit être lié. Ensuite, on spécifie le mode d'ouverture du fichier. Il existe plusieurs énumérations qui permettent de faire exactement ce que l'on veut :</p><ul id="r-379432" data-claire-element-id="379432"><li id="r-379421" data-claire-element-id="379421"><p id="r-379420" data-claire-element-id="379420"><strong>Append</strong>. Ce mode ouvre un fichier et &quot;accroche&quot; le résultat à la fin de celui-ci. Si le fichier n'existe pas, il est créé.</p></li><li id="r-379423" data-claire-element-id="379423"><p id="r-379422" data-claire-element-id="379422"><strong>Create</strong>. Le mode Create spécifie que peu importe ce qui se passe, un nouveau fichier DOIT être créé. Si un fichier du même nom existe, il sera écrasé. Attention, il faut avoir les permissions d'écriture sur le fichier et dans le répertoire, sinon une exception est levée.</p></li><li id="r-379425" data-claire-element-id="379425"><p id="r-379424" data-claire-element-id="379424"><strong>CreateNew</strong>. Ce mode spécifie qu'un fichier doit être créé, mais que s'il existe déjà, une exception sera levée. Attention à avoir les droits d'écriture sur ce mode également.</p></li><li id="r-379427" data-claire-element-id="379427"><p id="r-379426" data-claire-element-id="379426"><strong>Open</strong>. Ce mode est un mode de lecture. Si le fichier n'existe pas ou si le programme n'a pas les droits de lecture, une exception est levée.</p></li><li id="r-379429" data-claire-element-id="379429"><p id="r-379428" data-claire-element-id="379428"><strong>OpenOrCreate</strong> spécifie que le fichier doit être ouvert, mais que s'il n'existe pas, il doit être créé. Une exception peut être lancée si les droits d'accès ne sont pas valides.</p></li><li id="r-379431" data-claire-element-id="379431"><p id="r-379430" data-claire-element-id="379430"><strong>Truncate</strong> ouvre un fichier et le réinitialise à 0 octets. Essayer de lire un tel flux est illégal et renverra une exception.</p></li></ul><p id="r-379433" data-claire-element-id="379433">Comme vous le voyez, il y a plusieurs modes d'ouverture. Cependant, en troisième paramètre, on spécifie l'accès que le flux aura au fichier.</p><ul id="r-379440" data-claire-element-id="379440"><li id="r-379435" data-claire-element-id="379435"><p id="r-379434" data-claire-element-id="379434"><strong>Write</strong> ne permet que d'écrire dans un fichier. C'est idéal pour notre méthode d'enregistrement.</p></li><li id="r-379437" data-claire-element-id="379437"><p id="r-379436" data-claire-element-id="379436"><strong>Read</strong> ne permet que la lecture d'un fichier.</p></li><li id="r-379439" data-claire-element-id="379439"><p id="r-379438" data-claire-element-id="379438"><strong>ReadWrite</strong> permet de faire ce que l'on désire dans le fichier.</p></li></ul><div id="r-379442" data-claire-element-id="379442" data-claire-semantic="question"><p id="r-379441" data-claire-element-id="379441">Pourquoi avoir plusieurs modes d'ouverture à un fichier ? La question peut sembler banale, mais elle ne l'est pas. Si par exemple vous voulez seulement écrire dans un fichier, pourquoi devriez-vous le lire avant si vous désirez écraser l'information ? Ce serait inutile est représenterait une perte de temps, surtout si le fichier est gros. De plus, définir le mode d'accès est crucial pour éviter des erreurs qui pourraient survenir. Je ne sais pas vous, mais moi, si je m'attendais à ce que ma méthode lise de l'information et n'écrive pas, je ne voudrais pas qu'une erreur d'inattention survienne et altère mon fichier. Je préfère de loin voir mon programme planter.</p></div><aside id="r-379444" data-claire-element-id="379444" data-claire-semantic="warning"><p id="r-379443" data-claire-element-id="379443">Attention à bien accorder ces deux paramètres. Un flux en lecture seule qui n'a que des droits d'écriture, ça ne va pas très loin et ça ne fait pas des enfants forts... ^^</p></aside><p id="r-379445" data-claire-element-id="379445">Remarquez aussi que j'utilise une structure sécuritaire afin d'accéder à mes fichiers sur le Disque Dur. On ne sait jamais ce qui peut se passer. De plus, en employant un bloc <code data-claire-semantic="csharp">finally</code>, je suis certain que peu importe ce qui se passera, mon flux sera fermé à la fin de l'opération, que ce soit l'ouverture du flux ou la sérialisation qui échoue.</p><p id="r-379446" data-claire-element-id="379446">Vous allez aussi probablement remarquer que j'ai déclaré une méthode générique à la ligne 51. Cela me permet de simplifier la lecture de mes flux. Remarquez que pour pouvoir retourner une valeur par défaut (<code data-claire-semantic="csharp">null</code> dans le cas des types références, mais 0 dans le cas d'un int par exemple), j'utilise l'opérateur <code data-claire-semantic="csharp">default</code>.</p><h5 id="r-fichiers-xml-versus-fichiers-binaires" data-claire-element-id="379462">Fichiers XML versus fichiers binaires.</h5><p id="r-379449" data-claire-element-id="379449">Si vous prenez nos deux fichiers et que vous les comparez en taille, vous remarquerez quelque chose d'étonnant.</p><figure id="r-difference-entre-la-taille-des-fichiers-xml-et-binaires" data-claire-element-id="379452"><img id="r-379450" data-claire-element-id="379450" src="medias/uploads.siteduzero.com_files_394001_395000_394615.png" alt="Différence entre la taille des fichiers XML et binaires"/><figcaption>Différence entre la taille des fichiers XML et binaires</figcaption></figure><p id="r-379453" data-claire-element-id="379453">Eh oui, le fichier binaire est plus lourd de quelques centaines d'octets que le fichier XML. Cela est dû au fait que nous n'avons pas beaucoup de données, et que le fichier binaire doit obligatoirement définir un en-tête qui est malheureusement plus long que celui du XML. Cependant, si on lui met plus de données (par exemple 4 éléments plutôt que 2), on voit immédiatement la différence.</p><figure id="r-taille-de-fichiers-contenant-un-peu-plus-de-donnees" data-claire-element-id="379456"><img id="r-379454" data-claire-element-id="379454" src="medias/uploads.siteduzero.com_files_394001_395000_394616.png" alt="Taille de fichiers contenant un peu plus de données."/><figcaption>Taille de fichiers contenant un peu plus de données.</figcaption></figure><p id="r-379457" data-claire-element-id="379457">Imaginez maintenant si on avait un million d'éléments...</p><figure id="r-taille-des-fichiers-a-1-000-000-d-objets-dans-la-liste" data-claire-element-id="379460"><img id="r-379458" data-claire-element-id="379458" src="medias/uploads.siteduzero.com_files_394001_395000_394617.png" alt="Taille des fichiers à 1 000 000 d'objets dans la liste."/><figcaption>Taille des fichiers à 1 000 000 d'objets dans la liste.</figcaption></figure><p id="r-379461" data-claire-element-id="379461">Avouez maintenant que la différence est non négligeable. On sauve près de 150 Mo en transférant les données en binaire plutôt qu'en XML ! Cependant, le format binaire n'a pas la faculté d'être compréhensible par l'humain. J'imagine que pour un delta de 150 Mo, on pourra le lui pardonner. :D</p><h5 id="r-ignorer-des-champs-lors-de-la-serialisation" data-claire-element-id="379467">Ignorer des champs lors de la sérialisation</h5><p id="r-379463" data-claire-element-id="379463">Pour ignorer un ou plusieurs champs lors de la sérialisation, il faudra utiliser l'attribut <strong>NonSerialized</strong>. Seulement, il y a un problème. Jusqu'à maintenant, on sérialisait à l'aide des Propriétés. Il faut savoir que le sérialisateur binaire ne sérialise que les variables membres, et rien d'autre. De plus, comme je l'ai mentionné plus tôt, ce sérialisateur ne prend pas en compte les accesseurs pour faire son boulot. C'est un comportement à double tranchant disons. Certaines informations ne devraient pas être sérialisées, mais le seront par défaut. C'est là qu'entre en vigueur <strong>NonSerialized</strong>. Voici un exemple de ce qu'il faudra faire pour éviter une sérialisation.</p><pre id="r-379464" data-claire-element-id="379464"><code data-claire-semantic="csharp">using System;
using System.Xml.Serialization;

namespace XMLSerialisation
{
    [Serializable, XmlInclude(typeof(Guerrier)), XmlInclude(typeof(Magicien))]
    public abstract class Personnage
    {
        //La variable _nom ne sera pas sérialisée.
        [NonSerialized]
        private string _nom;

        //Malgré son niveau de protection, _niveau SERA sérialisé.
        private int _niveau;

        //Même s'il n'existe pas de Propriété pour cette variable, _nomFamilier sera quand même sérialisé.
        private string _nomFamilier;

        //Il a fallu retourner au modèle classique, car l'attribut NonSerialized ne fonctionne
        //pas sur les Priopriétés, qu'elles soient auto-implémentées ou pas.
        public string Nom { get { return _nom; } set { _nom = value; } }

        public int Niveau { get { return _niveau; } set { _niveau = value; } }

        public int PointVie { get; set; }

        public Personnage(string nom)
        {
            Nom = nom;
        }

        public void InitFamilier(string nom)
        {
            _nomFamilier = nom;
        }
    }
}</code></pre><aside id="r-379466" data-claire-element-id="379466" data-claire-semantic="warning"><p id="r-379465" data-claire-element-id="379465">Notez également que lors de la désérialisation, le constructeur de l'objet n'est pas appelé. On le restaure tel quel ! Ainsi, on ne pourra pas faire de vérifications automatisées afin de restaurer un état particulier. Il faudra programmer une méthode et l'appeler lorsque nécessaire.</p></aside><h5 id="r-en-resume-466" data-claire-element-id="379503">En résumé...</h5><ul id="r-379480" data-claire-element-id="379480"><li id="r-379469" data-claire-element-id="379469"><p id="r-379468" data-claire-element-id="379468">La sérialisation est un processus qui sert à extraire les données d'une instance afin de la <strong>réhydrater</strong> plus tard.</p></li><li id="r-379471" data-claire-element-id="379471"><p id="r-379470" data-claire-element-id="379470">Le format XML est une bonne solution afin d'échanger des données, car il est lisible à la fois par l'homme et par la machine. Cependant, il y a quelques règles à respecter lorsque l'on désire s'en servir.</p></li><li id="r-379473" data-claire-element-id="379473"><p id="r-379472" data-claire-element-id="379472">La sérialisation de .NET en XML n'est pas optimale. On se tournera plutôt vers d'autres frameworks lorsque cela deviendra important de sérialisation.</p></li><li id="r-379475" data-claire-element-id="379475"><p id="r-379474" data-claire-element-id="379474">La sérialisation binaire a l'avantage d'être mieux implémentée en .NET, mais produit un format illisible par l'humain. Cependant, ce format offre des gains incroyables sur l'espace par rapport à d'autres formats qui reposent sur le texte (XML, JSON, etc).</p></li><li id="r-379477" data-claire-element-id="379477"><p id="r-379476" data-claire-element-id="379476">La sérialisation binaire sera très utile lors des communications réseau.</p></li><li id="r-379479" data-claire-element-id="379479"><p id="r-379478" data-claire-element-id="379478">La sérialisation binaire s'applique sur les variables, et non pas sur les propriétés.</p></li></ul><p id="r-379481" data-claire-element-id="379481">Voilà qui était une petite introduction à la sérialisation des objets en .NET. Ce sujet se continue au prochain chapitre, car il sera plus sujet d'interopératibilité que de sérialisation en tant que tel.</p><p id="r-379482" data-claire-element-id="379482">Cette section du cours n'est pas terminée. Je veux aborder la communication en UDP asynchrone et à l'aide d'objets .NET (plutôt que par chaînes de caractères). Par la suite, je m'attaquerai à la communication par TCP.</p><p id="r-379483" data-claire-element-id="379483">Comme vous pouvez le voir, les communications réseaux ne sont pas les transactions les plus aisées, car elles ne sont pas stables et ne sont pas sûres à 100%. Il faut prévoir toutes les situations, et cela peut devenir compliqué. Par contre, avec l'expérience, vous allez commencer à vous y habituer.</p><p id="r-379484" data-claire-element-id="379484">Comme vous pouvez le deviner, ce tutoriel n'est pas terminé. Je voudrais vous donner un bref aperçu de ce qui est à venir :</p><ul id="r-379499" data-claire-element-id="379499"><li id="r-379486" data-claire-element-id="379486"><p id="r-379485" data-claire-element-id="379485">Communication asynchrones en UDP.</p></li><li id="r-379488" data-claire-element-id="379488"><p id="r-379487" data-claire-element-id="379487">Communication en TCP.</p></li><li id="r-379490" data-claire-element-id="379490"><p id="r-379489" data-claire-element-id="379489">Interopératibilité avec un autre langage (probablement Java).</p></li><li id="r-379492" data-claire-element-id="379492"><p id="r-379491" data-claire-element-id="379491">Communications à l'aide du framework WCF (Services web).</p></li><li id="r-379494" data-claire-element-id="379494"><p id="r-379493" data-claire-element-id="379493">Introduction au framework Parallel qui permet de faire aisément des opérations asynchrones.</p></li><li id="r-379496" data-claire-element-id="379496"><p id="r-379495" data-claire-element-id="379495">Les nouveautés quant à l'asynchrone en .NET 4.5 (et elles sont nombreuses).</p></li><li id="r-379498" data-claire-element-id="379498"><p id="r-379497" data-claire-element-id="379497">Introduire les exemples et les explications en VB.NET.</p></li></ul><p id="r-379500" data-claire-element-id="379500">Encore une fois, je réitère mon invitation à commenter le tutoriel pour y laisser vos appréciations, vos suggestions, vos propositions et vos insultes. :p</p><p id="r-379501" data-claire-element-id="379501">Bonne programmation réseau en .NET !</p><p id="r-379502" data-claire-element-id="379502">Les icônes proviennent de ce site : <a href="http://www.iconfinder.com/search/?q=iconset%3Abrightmix">http://www.iconfinder.com/search/?q=iconset%3Abrightmix</a></p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net">La programmation réseau en .NET</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les threads et les delegates
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates">Les delegates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-une-reference-en-la-matiere">
Les delegates, une référence en la matière !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-delegates-generiques">
Les delegates génériques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-methodes-anonymes">
Les méthodes anonymes
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multi-tache">Le multi-tâche</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-threads-2">
Les threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-mecanismes-de-synchronisation">
Les mécanismes de synchronisation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-multithreading-en-windows-forms">Le multithreading en Windows Forms</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/et-les-delegates-dans-tout-ca">
Et les delegates dans tout ça ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-cas-classique">
Le cas classique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-backgroundworkers">
Les BackgroundWorkers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-1">Travail Pratique</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-problematique-2">
La problématique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-1">
Solution à la partie 1
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-suite-1">
La suite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/solution-a-la-partie-2">
Solution à la partie 2
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
La programmation en UDP
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-theorie-de-depart">La théorie de départ</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/organisation-des-reseaux">
Organisation des réseaux
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-protocole-udp-1">
Le protocole UDP
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-types-de-communication">
Les types de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/les-outils-3">
Les outils
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/premiere-communication">Première communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-client-2">
Le client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/le-serveur-2">
Le serveur
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/travail-pratique-mini-chat">Travail Pratique : mini-chat</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-client">
Définition du client
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/definition-du-serveur">
Définition du serveur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/correction-127">
Correction
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/la-serialisation-des-objets">La sérialisation des objets</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/introduction-a-la-serialisation">
Introduction à la sérialisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
Sérialisation en XML
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-binaire">
Sérialisation binaire
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-reseau-en-net/serialisation-en-xml">
<span class="arrow"></span>
<span class="next">Sérialisation en XML</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/la-programmation-reseau-en-net.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 19:59:00 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/la-programmation-reseau-en-net.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:44:21 GMT -->
</html>