<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 03:24:28 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:42:39 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Éviter le renvoi répétitif d&#039;un formulaire en rafraîchissant</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Éviter le renvoi répétitif d&#039;un formulaire en rafraîchissant</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#viterlerenvoirptitifd039unformulaireenrafrachissant">Éviter le renvoi répétitif d&#039;un formulaire en rafraîchissant</a><br/><a href="#L039originedumessage">L&#039;origine du message</a><br/><a href="#Lasolution">La solution</a><br/><a href="#Miseenpratiquedelamthode">Mise en pratique de la méthode</a><br/><a href="#Exempleconcretavecleminichat">Exemple concret avec le minichat</a><br/></div>
<a name="viterlerenvoirptitifd039unformulaireenrafrachissant"></a><h2>Éviter le renvoi répétitif d&#039;un formulaire en rafraîchissant</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/l-origine-du-message">
<span class="next">L&#039;origine du message</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<figure id="r-565278" data-claire-element-id="565279"><img id="r-565277" data-claire-element-id="565277" src="medias/uploads.siteduzero.com_files_148001_149000_148057.jpg" alt="Message d'avertissement POST"/></figure><p id="r-565280" data-claire-element-id="565280">Que voilà un simple message d'avertissement, pourtant source de bien des ennuis.<br/> Il existe malgré tout un moyen efficace de l'éviter, qui n'est malheureusement pas assez connu sur le web. Voilà pourquoi j'ai souhaité écrire ce tutoriel, en espérant aider quelques programmeurs désespérés.<br/> En contournant cet avertissement, vous empêchez le renvoi répétitif de formulaires, évitant ainsi de lourds scripts comparant la dernière entrée de vos tables avec celle que vous tentez d'insérer, en prenant l'exemple d'un minichat.</p><p id="r-565281" data-claire-element-id="565281">Je vous recommande fortement d'avoir pris connaissance <a href="http://www.siteduzero.com/tutoriel-3-14668-un-site-dynamique-avec-php.html">des trois premiers chapitres</a> du tutoriel de M@teo21 sur le PHP, d'être assez à l'aise avec les formulaires ainsi que les sessions, et par la même occasion d'être en bonne forme. :D</p>
</div><a name="L039originedumessage"></a><h2>L&#039;origine du message</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/la-solution-19">
<span class="next">La solution</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-565282" data-claire-element-id="565282">Ce message d'avertissement n'est en réalité rien d'autre qu'une sorte d'erreur envoyée par le navigateur. Ce dernier souhaite vous avertir qu'en rafraîchissant la page où vous vous trouvez, en retournant à la précédente ou en allant à la suivante, vous allez renvoyer le contenu d'un formulaire que vous avez déjà rempli et validé.<br/> Ce n'est qu'une protection formelle contre, comme il l'indique, d'éventuelles répétitions d'achat sur un site de vente, ou autre (c'est qu'en effet, il serait idiot de payer deux fois le même objet, ou d'effectuer deux fois la même transaction sur le site de sa banque ^^ ).</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant">Éviter le renvoi répétitif d&#039;un formulaire en rafraîchissant</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/l-origine-du-message">
L&#039;origine du message
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/la-solution-19">
La solution
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/mise-en-pratique-de-la-methode">
Mise en pratique de la méthode
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/exemple-concret-avec-le-minichat">
Exemple concret avec le minichat
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/la-solution-19">
<span class="next">La solution</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lasolution"></a><h2>La solution</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/l-origine-du-message">
<span class="arrow"></span>
<span class="next">L&#039;origine du message</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/mise-en-pratique-de-la-methode">
<span class="next">Mise en pratique de la méthode</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-565284" data-claire-element-id="565284">Pour éviter ce message d'avertissement, il existe une technique simple : la redirection, qu'on pourrait appeler dans le cas présent &quot;le rafraîchissement forcé&quot;. En effet, une fois qu'un visiteur quelconque enverra un formulaire, nous allons, avant de traiter le contenu de ce dernier, rafraîchir la page où le formulaire a conduit le visiteur (celle qui est indiquée dans <code data-claire-semantic="html">&lt;form action=&quot;&quot;&gt; </code>), ce qui aura pour effet de &quot;contourner&quot; le message d'avertissement : le principe est aussi simple que cela.<br/> Il existe plusieurs méthodes pour rediriger un visiteur : en HTML, en Javascript, et bien sûr en PHP. Nous ne verrons que cette dernière, les autres étant réservées à des situations précises.</p><p id="r-565285" data-claire-element-id="565285">En PHP, il n'existe aucune fonction toute faite pour rediriger. Mais nous pouvons utiliser à bon escient la fonction <code data-claire-semantic="html+php">header() </code>, dont le rôle est d'envoyer au navigateur des &quot;en-têtes http&quot;. Rassurez-vous, elle est déjà toute préparée ; nous allons juste utiliser une syntaxe bien précise de cette dernière, qui est :</p><pre id="r-565286" data-claire-element-id="565286"><code data-claire-semantic="html+php">&lt;?php
header('Location: monFichier.php');
?&gt;</code></pre><aside id="r-565288" data-claire-element-id="565288" data-claire-semantic="warning"><p id="r-565287" data-claire-element-id="565287">Faites toujours bien attention à ne jamais oublier le <code data-claire-semantic="html+php">Location: </code>, sinon vous pourriez avoir de belles surprises. Notez aussi que vous n'êtes pas non plus forcés de coller les deux points au mot, ni de mettre un espace après ; ce sont juste des habitudes que j'ai prise.</p></aside><p id="r-565289" data-claire-element-id="565289">Mais cette fonction est un peu capricieuse, surtout de la façon dont nous nous en servons. En effet, il faut retenir trois choses, qui seront vraiment déterminantes dans la suite de ce tuto.</p><ul id="r-565296" data-claire-element-id="565296"><li id="r-565291" data-claire-element-id="565291"><p id="r-565290" data-claire-element-id="565290">D'une, la fonction <code data-claire-semantic="html+php">header() </code> est allergique à tout code HTML. En d'autres termes, elle fonctionne de la même façon que <code data-claire-semantic="html+php">set_cookie() </code> : il ne faut placer aucun code HTML ni aucun texte avant son utilisation (pour plus de précisions, lisez la description de la fonction <code data-claire-semantic="html+php"><a href="http://php.net/header">header() </a></code> que fournit la documentation). Il faudra donc l'utiliser au début de nos scripts.</p></li><li id="r-565293" data-claire-element-id="565293"><p id="r-565292" data-claire-element-id="565292">Deuxièmement, nous devrons toujours placer un <code data-claire-semantic="html+php">exit; </code> juste après son utilisation. En effet, lorsque PHP lit le script, il voit la fonction <code data-claire-semantic="html+php">header() </code> et se dit : <em>&quot;Je retiens qu'après l'exécution totale du script, il faudra que je redirige notre visiteur sur telle page&quot;</em>. Ainsi, en plaçant un <code data-claire-semantic="html+php">exit; </code> juste après, nous précisons à PHP que le script s'arrête là, et qu'il ne faut pas regarder ce qui suit.</p></li><li id="r-565295" data-claire-element-id="565295"><p id="r-565294" data-claire-element-id="565294">Pour finir, en redirigeant, la fonction <code data-claire-semantic="html+php">header() </code> va vider les variables <code data-claire-semantic="html+php">$_POST </code> et <code data-claire-semantic="html+php">$_FILES </code> qui constituent notre formulaire. Pour éviter de perdre ces informations, nous allons les sauvegarder dans des variables de session (par exemple, <code data-claire-semantic="html+php">$_SESSION['sauvegarde'] </code> et <code data-claire-semantic="html+php">$_SESSION['sauvegardeFILES'] </code>) avant la redirection, et les &quot;réinjecter&quot; ensuite dans d'autres variables. Pour éviter que vous n'ayez à changer toute la structure de vos fichiers, nous allons appeler ces variables <code data-claire-semantic="html+php">$_POST </code> et <code data-claire-semantic="html+php">$_FILES </code>.<br/> Petite parenthèse au passage : vous vous demandez sûrement pourquoi j'introduis ici <code data-claire-semantic="html+php">$_FILES </code>, alors que, pourtant, c'est bien <code data-claire-semantic="html+php">$_POST </code> qui contient notre formulaire. En fait, <code data-claire-semantic="html+php">$_FILES </code> a comme contenu des informations relatives aux éventuelles images envoyées avec le formulaire. Vous pouvez revoir <a href="http://www.siteduzero.com/tutoriel-3-14543-php-et-les-formulaires.html#ss_part_4">ce chapitre </a>si vous ne vous en souvenez plus.</p></li></ul><p id="r-565297" data-claire-element-id="565297">Afin que tout soit bien clair dans vos esprits, voici un petit schéma qui résume ces trois points et la façon de les appliquer à nos codes. Lisez-le bien, il résume presque à lui seul tout le tuto, ou du moins la partie théorique.</p><figure id="r-565299" data-claire-element-id="565300"><img id="r-565298" data-claire-element-id="565298" src="medias/uploads.siteduzero.com_files_162001_163000_162944.png" alt="Schéma traitement formulaire"/></figure>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant">Éviter le renvoi répétitif d&#039;un formulaire en rafraîchissant</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/l-origine-du-message">
L&#039;origine du message
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/la-solution-19">
La solution
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/mise-en-pratique-de-la-methode">
Mise en pratique de la méthode
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/exemple-concret-avec-le-minichat">
Exemple concret avec le minichat
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/l-origine-du-message">
<span class="arrow"></span>
<span class="next">L&#039;origine du message</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/mise-en-pratique-de-la-methode">
<span class="next">Mise en pratique de la méthode</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Miseenpratiquedelamthode"></a><h2>Mise en pratique de la méthode</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/la-solution-19">
<span class="arrow"></span>
<span class="next">La solution</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/exemple-concret-avec-le-minichat">
<span class="next">Exemple concret avec le minichat</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-565302" data-claire-element-id="565302">Voilà maintenant un petit moment qu'on réfléchit à comment résoudre notre problème, alors je pense qu'il est maintenant temps qu'on mette tout ça sur papier, noir sur blanc comme on dit. :) <br/> En réalité, si on lit bien le schéma, on remarque qu'il ne nous manque qu'un seul bout de code pour éviter le message d'avertissement. Si vous n'avez pas encore saisi ça, alors jetez-y une nouvelle fois un p'tit coup d'oeil, et regardez bien les différences entre avant et après.<br/> Étant donné qu'on a toutes les cartes en main, je vais vous donner ce code et le décortiquer partie par partie, pour que vous compreniez bien ses subtilités d'emploi.</p><pre id="r-565303" data-claire-element-id="565303"><code data-claire-semantic="html+php">&lt;?php

// Inutile d'expliquer la présence du session_start().
session_start();

// { Début - Première partie
if(!empty($_POST) OR !empty($_FILES))
{
    $_SESSION['sauvegarde'] = $_POST ;
    $_SESSION['sauvegardeFILES'] = $_FILES ;
    
    $fichierActuel = $_SERVER['PHP_SELF'] ;
    if(!empty($_SERVER['QUERY_STRING']))
    {
        $fichierActuel .= '?' . $_SERVER['QUERY_STRING'] ;
    }
    
    header('Location: ' . $fichierActuel);
    exit;
}
// } Fin - Première partie

// { Début - Seconde partie
if(isset($_SESSION['sauvegarde']))
{
    $_POST = $_SESSION['sauvegarde'] ;
    $_FILES = $_SESSION['sauvegardeFILES'] ;
    
    unset($_SESSION['sauvegarde'], $_SESSION['sauvegardeFILES']);
}
// } Fin - Seconde partie

?&gt;</code></pre><p id="r-565304" data-claire-element-id="565304">Comme vous le voyez, j'ai découpé ce code en deux parties distinctes. Expliquons donc comment tout ça fonctionne.</p><h2 id="r-premiere-partie" data-claire-element-id="565323">Première partie</h2><ol id="r-565322" data-claire-element-id="565322"><li id="r-565306" data-claire-element-id="565306"><p id="r-565305" data-claire-element-id="565305"><code data-claire-semantic="html+php">if(!empty($_POST) OR !empty($_FILES)) </code> : si le visiteur a envoyé un formulaire quelconque, alors [...]. Notez que j'ai utilisé ici un <code data-claire-semantic="html+php">!empty() </code> au lieu d'un <code data-claire-semantic="html+php">isset() </code>. En effet, <code data-claire-semantic="html+php">$_POST </code> et <code data-claire-semantic="html+php">$_FILES </code> sont ce qu'on appelle des superglobales, et les superglobales ont la particularité de toujours exister, quoi qu'il advienne. Utiliser un <code data-claire-semantic="html+php">if(isset($_POST) OR isset($_FILES)) </code> aurait donc été inutile. Dans la suite du code, nous allons rencontrer une autre superglobale qui est <code data-claire-semantic="html+php">$_SERVER </code> ; ne vous étonnez donc pas si j'utilise encore un <code data-claire-semantic="html+php">!empty() </code> au lieu d'un <code data-claire-semantic="html+php">isset() </code>.<br/> Pour ceux qui n'auraient jamais rencontré la fonction <code data-claire-semantic="html+php">empty() </code> : elle sert à vérifier si une variable ou un tableau est vide. Dans notre cas, on vérifie donc la condition : <em>&quot;si $_POST ou $_FILES contiennent quelque chose&quot;</em>, ou formulé en français : <em>&quot;si on a envoyé un formulaire&quot;</em> (voir la définition de la documentation pour plus de précisions sur <code data-claire-semantic="html+php"><a href="http://fr2.php.net/empty">empty() </a></code>).</p></li><li id="r-565309" data-claire-element-id="565309"><pre id="r-565307" data-claire-element-id="565307"><code data-claire-semantic="html+php">&lt;?php
$_POST = $_SESSION['sauvegarde'] ;
$_FILES = $_SESSION['sauvegardeFILES'] ;
?&gt;</code></pre><p id="r-565308" data-claire-element-id="565308">Ici on sauvegarde le formulaire et les éventuels fichiers envoyés dans des variables de session, comme expliqué précédemment.</p></li><li id="r-565318" data-claire-element-id="565318"><pre id="r-565310" data-claire-element-id="565310"><code data-claire-semantic="html+php">&lt;?php
$fichierActuel = $_SERVER['PHP_SELF'] ;

if(!empty($_SERVER['QUERY_STRING']))
{
    $fichierActuel .= '?' . $_SERVER['QUERY_STRING'] ;
}
?&gt;</code></pre><p id="r-565311" data-claire-element-id="565311">Dans cette partie, on détermine le fichier où est le visiteur, pour pouvoir rafraîchir la page. Il faut d'abord savoir que la variable <code data-claire-semantic="html+php">$_SERVER['PHP_SELF'] </code> renvoie le &quot;fichier courant&quot; utilisé (par exemple page.php) et que <code data-claire-semantic="html+php">$_SERVER['QUERY_STRING'] </code> renvoie toutes les informations qui sont dans l'URL, autre que le nom du fichier (par exemple, si je suis sur index.php?new=24&amp;amp;page=3, cette variable contiendra new=24&amp;amp;page=3).<br/> Ces deux variables combinées permettent donc de recomposer l'adresse exacte du fichier où se trouve le visiteur. Traduit en français, le code donne :</p><ul id="r-565316" data-claire-element-id="565316"><li id="r-565313" data-claire-element-id="565313"><p id="r-565312" data-claire-element-id="565312">je donne à la variable <code data-claire-semantic="html+php">$fichierActuel </code> le nom du fichier où le visiteur se trouve,</p></li><li id="r-565315" data-claire-element-id="565315"><p id="r-565314" data-claire-element-id="565314">si on a d'autres renseignements plus précis sur la localisation du visiteur, on les ajoute au nom du fichier. Nous n'avons pas besoin d'utiliser de <code data-claire-semantic="html+php"><a href="http://php.net/http://fr3.php.net/url_encode">urlencode() </a></code> étant donné que la variable <code data-claire-semantic="html+php">$_SERVER['QUERY_STRING'] </code> fait tout pour nous.</p></li></ul><p id="r-565317" data-claire-element-id="565317">Si le <code data-claire-semantic="html+php">.= </code> vous intrigue, revoyez un peu la concaténation.</p></li><li id="r-565321" data-claire-element-id="565321"><pre id="r-565319" data-claire-element-id="565319"><code data-claire-semantic="html+php">&lt;?php
header('Location: ' . $fichierActuel);
exit;
?&gt;</code></pre><p id="r-565320" data-claire-element-id="565320">Comme vu dans le paragraphe précédent, on rafraîchit pour éviter le message d'avertissement, et on place un <code data-claire-semantic="html+php">exit; </code> pour dire à PHP que c'est la fin du voyage. :)</p></li></ol><h2 id="r-seconde-partie" data-claire-element-id="565335">Seconde partie</h2><ol id="r-565331" data-claire-element-id="565331"><li id="r-565325" data-claire-element-id="565325"><p id="r-565324" data-claire-element-id="565324"><code data-claire-semantic="html+php">if(isset($_SESSION['sauvegarde'])) </code> : si un visiteur vient d'être redirigé, alors ...</p></li><li id="r-565328" data-claire-element-id="565328"><pre id="r-565326" data-claire-element-id="565326"><code data-claire-semantic="html+php">&lt;?php
$_POST = $_SESSION['sauvegarde'] ;
$_FILES = $_SESSION['sauvegardeFILES'] ;
?&gt;</code></pre><p id="r-565327" data-claire-element-id="565327">... on récupère le formulaire et les éventuels fichiers qu'il a envoyé pour réinjecter le tout dans les variables <code data-claire-semantic="html+php">$_POST </code> et <code data-claire-semantic="html+php">$_FILES </code>. Attention : comme dit précédemment, les deux variables qu'on utilise ici ne sont pas les <em>vraies</em> variables <code data-claire-semantic="html+php">$_POST </code> et <code data-claire-semantic="html+php">$_FILES </code>, mais juste des intermédiaires pour réintroduire le formulaire envoyé.</p></li><li id="r-565330" data-claire-element-id="565330"><p id="r-565329" data-claire-element-id="565329"><code data-claire-semantic="html+php">unset($_SESSION['sauvegarde'], $_SESSION['sauvegardeFILES']) </code> : Pour finir, on supprime les variables de session qui ont servi à sauvegarder le formulaire, pour ne pas le renvoyer une nouvelle fois si le visiteur rafraîchit la page.</p></li></ol><div id="r-565333" data-claire-element-id="565333" data-claire-semantic="question"><p id="r-565332" data-claire-element-id="565332">OK, mais j'en fais quoi maintenant de ton bout de code ?</p></div><p id="r-565334" data-claire-element-id="565334">En effet, une après avoir compris comment fonctionne et à quoi sert ce code, vous vous demandez sûrement : on en fait quoi ? En réalité il vous suffit de le placer dans les premières parties de vos fichiers (de préférence au tout début), comme indiqué sur le schéma.<br/> Ensuite, celui-ci se chargera de tout, sans que vous n'ayez besoin de retoucher quoi que ce soit dans la structure même de vos fichiers actuels. La meilleure des solutions serait même de créer un nouveau fichier ne contenant que ces quelques lignes, et l'inclure au début de chacun de vos autres fichiers.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant">Éviter le renvoi répétitif d&#039;un formulaire en rafraîchissant</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/l-origine-du-message">
L&#039;origine du message
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/la-solution-19">
La solution
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/mise-en-pratique-de-la-methode">
Mise en pratique de la méthode
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/exemple-concret-avec-le-minichat">
Exemple concret avec le minichat
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/la-solution-19">
<span class="arrow"></span>
<span class="next">La solution</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/exemple-concret-avec-le-minichat">
<span class="next">Exemple concret avec le minichat</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Exempleconcretavecleminichat"></a><h2>Exemple concret avec le minichat</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/mise-en-pratique-de-la-methode">
<span class="arrow"></span>
<span class="next">Mise en pratique de la méthode</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-565337" data-claire-element-id="565337">Je sais que tout cela est encore embrouillé dans vos esprits, c'est pourquoi je pense qu'un petit exercice d'application sur un exemple concret et sur lequel vous avez déjà travaillé ne ferait pas de mal : un minichat.<br/> Je ne copierai pas exactement celui <a href="http://www.siteduzero.com/tutoriel-3-14518-tp-un-mini-chat.html">du TP proposé par M@teo21</a>, du fait qu'il ne reprenne pas tout ce que j'aurais envie de vous montrer, mais je m'en inspirerai.</p><p id="r-565338" data-claire-element-id="565338">En premier lieu, je vous montrerai le code du minichat sans notre méthode pour éviter le renvoi du message, tout en l'expliquant avec des commentaires. Je le comparerai ensuite à un minichat avec notre méthode, pour que vous voyiez bien les différences. Cette seconde partie sera composée de deux fichiers, l'un avec le code du minichat, et l'autre avec le code servant à la redirection, qui sera inclus dans le premier.</p><h2 id="r-minichat-simple" data-claire-element-id="565341">Minichat simple</h2><pre id="r-565339" data-claire-element-id="565339"><code data-claire-semantic="html+php">&lt;?php

// Le minichat ne nécessite pas de session_start(), étant donné qu'il ne manipule pas les sessions.

// Une connexion classique à un serveur MySQL, rien de particulier.
mysql_connect('localhost', 'sdz', 'motDePasse');
mysql_select_db('coursphp');

// Une petite fonction qui allège un peu les codes du traitement d'un formulaire. Elle sert ici plus d'exemple qu'autre chose.
function securisation($variable)
{
	$variable = mysql_real_escape_string($variable);
	$variable = htmlspecialchars($variable);
	
	return $variable ;
}

?&gt;
&lt;!-- Des en-têtes HTML normaux, rien à expliquer. --&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot; lang=&quot;fr&quot;&gt;
&lt;head&gt;
    &lt;title&gt;Minichat&lt;/title&gt;
    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;
&lt;/head&gt;

&lt;body&gt;

&lt;?php

// Le traitement du formulaire d'ajout d'un message.
if(isset($_POST['pseudo'], $_POST['message'])) // Si le formulaire est envoyé.
{
    if(!empty($_POST['pseudo']) AND !empty($_POST['message'])) // Si tous les champs ont été remplis correctement.
    {
        $pseudo = securisation($_POST['pseudo']); // Regardez un peu plus haut pour la fonction.
        $message = securisation($_POST['message']);
        
        // Et une insertion dans la table minichat.
        mysql_query('INSERT INTO minichat VALUES(&quot;&quot;, &quot;' . $pseudo . '&quot;, &quot;' . $message . '&quot;)') OR die(mysql_error());
    }
    else // Si le visiteur n'a pas correctement saisi tous les champs, alors on le lui indique.
    {
        echo '&lt;strong&gt;Erreur : vous n\'avez pas correctement saisi les champs obligatoires.&lt;/strong&gt;' ;
    }
}

?&gt;

&lt;!-- Notre formulaire, sans commentaire nécessaire. --&gt;
&lt;form action=&quot;minichat.php&quot; method=&quot;post&quot;&gt;
&lt;p&gt;
Pseudo : &lt;input type=&quot;text&quot; name=&quot;pseudo&quot; /&gt;&lt;br /&gt;
Message : &lt;input type=&quot;text&quot; name=&quot;message&quot; /&gt;&lt;br /&gt;
&lt;input type=&quot;submit&quot; value=&quot;Envoyer&quot; /&gt;
&lt;/p&gt;
&lt;/form&gt;

&lt;!-- Puis, normalement, le listage des messages du minichat. On passera cette partie, étant donné qu'elle ne nous intéresse pas. --&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-565340" data-claire-element-id="565340">Il n'y a pas grand chose à ajouter, mis à part l'utilisation de la fonction <code data-claire-semantic="html+php">securisation() </code> qui pourrait éventuellement vous perturber, mais elle est plus là en guise d'exemple qu'autre chose.<br/> Passons sans plus attendre au code avec la méthode évitant le renvoi du formulauire.</p><h2 id="r-minichat-evitant-le-message-d-avertissement" data-claire-element-id="565347">Minichat évitant le message d'avertissement</h2><pre id="r-565342" data-claire-element-id="565342"><code data-claire-semantic="html+php">&lt;?php

include('eviterMessageAvertissement.php');

// Connexion au serveur MySQL.
mysql_connect('localhost', 'sdz', 'motDePasse');
mysql_select_db('coursphp');

/* [...]
Et je zappe volontairement tout le reste du code, non seulement pour économiser de la place,
mais aussi pour insister sur le fait que le code reste exactement le même et que le fichier
(que j'ai ici appelé &quot;eviterMessageAvertissement.php&quot;) est bien inclus avant toute autre chose.
*/

?&gt;</code></pre><pre id="r-565343" data-claire-element-id="565343"><code data-claire-semantic="html+php">&lt;?php

session_start();

if(!empty($_POST) OR !empty($_FILES))
{
    $_SESSION['sauvegarde'] = $_POST ;
    $_SESSION['sauvegardeFILES'] = $_FILES ;
    
    $fichierActuel = $_SERVER['PHP_SELF'] ;
    if(!empty($_SERVER['QUERY_STRING']))
    {
        $fichierActuel .= '?' . $_SERVER['QUERY_STRING'] ;
    }
    
    header('Location: ' . $fichierActuel);
    exit;
}

if(isset($_SESSION['sauvegarde']))
{
    $_POST = $_SESSION['sauvegarde'] ;
    $_FILES = $_SESSION['sauvegardeFILES'] ;
    
    unset($_SESSION['sauvegarde'], $_SESSION['sauvegardeFILES']);
}

?&gt;</code></pre><p id="r-565344" data-claire-element-id="565344">Si vous êtes intrigués par le fait que j'ai coupé toute la suite du fichier <code data-claire-semantic="html+php">minichat.php </code>, je ne peux que vous recommander de revoir le schéma, ainsi que le chapitre précédent (la &quot;Mise en pratique de la méthode&quot;).</p><p id="r-565345" data-claire-element-id="565345">Nous voici donc à la fin de ce tutoriel. J'ai mis beaucoup de cœur et d'efforts à le rédiger, j'espère donc avoir été suffisamment clair dans mes explications et mes exemples.<br/> Si, malgré tout, certains points vous semblent encore obscurs, n'hésitez pas à poster un commentaire ou à <a href="http://www.siteduzero.com/mp-273-33452.html">m'envoyer un MP</a>, ce qui me permettra d'améliorer le tuto et en fera profiter tout le monde. :)</p><p id="r-565346" data-claire-element-id="565346">Pour finir, je souhaiterais tout particulièrement remercier l'équipe des zCorrecteurs, qui font vraiment un boulot formidable. :)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant">Éviter le renvoi répétitif d&#039;un formulaire en rafraîchissant</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/l-origine-du-message">
L&#039;origine du message
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/la-solution-19">
La solution
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/mise-en-pratique-de-la-methode">
Mise en pratique de la méthode
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/exemple-concret-avec-le-minichat">
Exemple concret avec le minichat
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant/mise-en-pratique-de-la-methode">
<span class="arrow"></span>
<span class="next">Mise en pratique de la méthode</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 03:24:28 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/eviter-le-renvoi-repetitif-d-un-formulaire-en-rafraichissant.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:42:39 GMT -->
</html>