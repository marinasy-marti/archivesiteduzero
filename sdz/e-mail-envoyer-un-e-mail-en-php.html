<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/e-mail-envoyer-un-e-mail-en-php.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 20:02:04 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/e-mail-envoyer-un-e-mail-en-php.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:45:02 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : [E-mail] Envoyer un e-mail en PHP</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : [E-mail] Envoyer un e-mail en PHP</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#E-mailEnvoyerune-mailenPHP">[E-mail] Envoyer un e-mail en PHP</a><br/><a href="#Avant-propos">Avant-propos</a><br/><a href="#L039en-tte">L&#039;en-tête</a><br/><a href="#Lesdiffrentstypesd039e-mails">Les différents types d&#039;e-mails</a><br/><a href="#Etc039estpartipourl039assemblage">Et c&#039;est parti pour l&#039;assemblage !</a><br/><a href="#Annexejoindreunfichier">Annexe : joindre un fichier</a><br/><a href="#AnnexeFAQ">Annexe : FAQ</a><br/><a href="#Annexelespriorites">Annexe : les prioritées</a><br/></div>
<a name="E-mailEnvoyerune-mailenPHP"></a><h2>[E-mail] Envoyer un e-mail en PHP</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/avant-propos-2">
<span class="next">Avant-propos</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<div id="r-306543" data-claire-element-id="306543" data-claire-semantic="question"><p id="r-306542" data-claire-element-id="306542">Comment envoyer un e-mail en PHP ?</p></div><p id="r-306544" data-claire-element-id="306544">Vous me direz : rien de plus simple ! J'utilise la fonction mail() et je lui donne le destinataire, le sujet, le contenu du courriel.</p><p id="r-306545" data-claire-element-id="306545">Alors oui, ça peut fonctionner, mais le gros problème est que, lorsque l'on utilise cette méthode, l'e-mail a 95 % de chances de partir dans les courriers indésirables... Ce qui n'est pas vraiment très bon pour l'expéditeur.</p><p id="r-306546" data-claire-element-id="306546">C'est pourquoi ce tutoriel va non seulement vous apprendre à envoyer un courriel qui arrivera (presque toujours) à son destinataire, mais aussi à envoyer un e-mail en HTML et même y ajouter une pièce jointe. ;) Eh oui, comme les annonces de publicité que vous recevez, ou encore les courriels du Site du Zéro (e-mails d'avertissement de messages privés ou la <em>Newsletter</em>).</p>
</div><a name="Avant-propos"></a><h2>Avant-propos</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/l-en-tete-1">
<span class="next">L&#039;en-tête</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-306547" data-claire-element-id="306547">Pour commencer ce tutoriel, il faut tout d'abord fixer une chose : tous les serveurs qui reçoivent les e-mails ne suivent pas obligatoirement la norme, comme je viens d'en avoir la confirmation à la suite de la dernière édition de ce tuto. En effet, selon la norme que je cite quelques paragraphes plus loin, un passage à la ligne dans le code source d'un e-mail est « <strong></strong> » ; or, certains hébergeurs remplacent le « » automatiquement par « », ce qui fait que l'on se retrouve avec « », qui occasionne certains bogues au niveau de l'affichage des e-mails.</p><p id="r-306548" data-claire-element-id="306548">Il existe donc deux possibilités soit on tente de filtrer les serveurs à problèmes et donc de respecter le plus souvent la norme, soit on décide de mêttre un peut la norme de coté et l'on utilise « <strong></strong> » qui marche de toutes façons, au cas ou vous voudriez gérer au cas par cas, voici un petit bout de code.</p><pre id="r-306549" data-claire-element-id="306549"><code data-claire-semantic="html+php">&lt;?php
if (!preg_match(&quot;#^[a-z0-9._-]+@(hotmail|live|msn).[a-z]{2,4}$#&quot;, $mail))
{
	$passage_ligne = &quot;\r\n&quot;;
}
else
{
	$passage_ligne = &quot;\n&quot;;
}
?&gt;</code></pre>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php">[E-mail] Envoyer un e-mail en PHP</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/avant-propos-2">
Avant-propos
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/l-en-tete-1">
L&#039;en-tête
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/les-differents-types-d-e-mails">
Les différents types d&#039;e-mails
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/et-c-est-parti-pour-l-assemblage">
Et c&#039;est parti pour l&#039;assemblage !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-joindre-un-fichier">
Annexe : joindre un fichier
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-faq">
Annexe : FAQ
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-les-prioritees">
Annexe : les prioritées
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/l-en-tete-1">
<span class="next">L&#039;en-tête</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="L039en-tte"></a><h2>L&#039;en-tête</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/avant-propos-2">
<span class="arrow"></span>
<span class="next">Avant-propos</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/les-differents-types-d-e-mails">
<span class="next">Les différents types d&#039;e-mails</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-definition-31" data-claire-element-id="306571">Définition</h2><p id="r-306551" data-claire-element-id="306551">L'en-tête d'un e-mail, aussi appelé <strong><em>header</em></strong>, est la partie qui se trouve au début d'un courriel. Elle est <strong>invisible</strong> pour l'utilisateur lambda qui ne fait que lire ses messages.</p><aside id="r-306553" data-claire-element-id="306553" data-claire-semantic="information"><p id="r-306552" data-claire-element-id="306552">Dans ce tutoriel, j'utiliserai le mot anglais <strong><em>header</em></strong> lorsque je parlerai de l'en-tête car, comme vous le savez certainement, le langage informatique utilise pour ainsi dire toujours la langue anglaise ; il sera donc plus facile de se servir de ce terme dans le cours, car il sera réutilisé dans le code.</p></aside><p id="r-306554" data-claire-element-id="306554">Le <em><strong>header</strong></em>, donc, contient toutes les informations de l'e-mail. En voici quelques exemples :</p><ul id="r-306567" data-claire-element-id="306567"><li id="r-306556" data-claire-element-id="306556"><p id="r-306555" data-claire-element-id="306555">l'heure d'envoi,</p></li><li id="r-306558" data-claire-element-id="306558"><p id="r-306557" data-claire-element-id="306557">l'adresse électronique de l'expéditeur,</p></li><li id="r-306560" data-claire-element-id="306560"><p id="r-306559" data-claire-element-id="306559">l'adresse de réponse,</p></li><li id="r-306562" data-claire-element-id="306562"><p id="r-306561" data-claire-element-id="306561">le nom du serveur qui a envoyé l'e-mail,</p></li><li id="r-306564" data-claire-element-id="306564"><p id="r-306563" data-claire-element-id="306563">par où a transité l'e-mail chez votre FAI,</p></li><li id="r-306566" data-claire-element-id="306566"><p id="r-306565" data-claire-element-id="306565">etc.</p></li></ul><div id="r-306569" data-claire-element-id="306569" data-claire-semantic="question"><p id="r-306568" data-claire-element-id="306568">Eh, mais tu viens de nous dire que le <strong><em>header</em></strong>, nous, on ne le voyait pas ! Mais moi, je sais très bien à quelle heure mon e-mail a été envoyé et qui me l'a envoyé !</p></div><p id="r-306570" data-claire-element-id="306570">Alors certes, l'utilisateur lambda voit certaines de ces informations, mais c'est uniquement parce que votre logiciel de messagerie va <strong>lire</strong> le <strong><em>header</em></strong> pour ensuite vous <strong>l'afficher</strong> de manière propre.</p><h2 id="r-schema-1" data-claire-element-id="306596">Schéma</h2><p id="r-306572" data-claire-element-id="306572">Lorsque vous créez le <strong><em>header</em></strong> pour envoyer un e-mail avec la fonction mail() de PHP, vous avez besoin de spécifier quatre arguments :</p><ul id="r-306581" data-claire-element-id="306581"><li id="r-306574" data-claire-element-id="306574"><p id="r-306573" data-claire-element-id="306573">l'adresse de l'<strong>expéditeur,</strong></p></li><li id="r-306576" data-claire-element-id="306576"><p id="r-306575" data-claire-element-id="306575">l'adresse de <strong>retour</strong>,</p></li><li id="r-306578" data-claire-element-id="306578"><p id="r-306577" data-claire-element-id="306577">la version de <strong>MIME</strong>,</p></li><li id="r-306580" data-claire-element-id="306580"><p id="r-306579" data-claire-element-id="306579">le <strong><em>content-type</em></strong> du message.</p></li></ul><p id="r-306582" data-claire-element-id="306582">Bon, maintenant, éclaircissons un peu cette liste. Les deux premiers arguments n'ont pas besoin d'explication (ou bien alors vous êtes en-dessous de zéro :p ).<br/> Pour ce qui est de la version du MIME, il s'agit de donner la version de l'e-mail au serveur qui va le recevoir. En gros, ça permet de lui dire comment le lire. :)</p><aside id="r-306584" data-claire-element-id="306584" data-claire-semantic="information"><p id="r-306583" data-claire-element-id="306583">Si vous voulez plus de renseignements sur le standard MIME, voici un lien : <a href="http://www.commentcamarche.net/courrier-electronique/mime.php3">CCM</a>.</p></aside><p id="r-306585" data-claire-element-id="306585">Pour le <strong><em>content-type</em></strong>, vous l'avez peut-être déjà rencontré. Il va servir dans le cas présent à définir ce que va contenir votre e-mail. Sachez qu'il peut aussi être utilisé en HTML pour définir le contenu d'une page, ou encore en PHP lors de la génération d'une image avec une bibliothèque graphique (pour signaler à votre navigateur de quelle façon il va devoir interpréter ce qui se trouve dans la page). On verra que le <strong><em>content-type</em></strong> va devoir aussi être réutilisé plus tard dans le corps du message.</p><p id="r-306586" data-claire-element-id="306586">Ainsi, pour récapituler, nous avons maintenant le schéma d'un <strong><em>header</em></strong> qui ressemble à cela :</p><ul id="r-306595" data-claire-element-id="306595"><li id="r-306588" data-claire-element-id="306588"><p id="r-306587" data-claire-element-id="306587">expéditeur,</p></li><li id="r-306590" data-claire-element-id="306590"><p id="r-306589" data-claire-element-id="306589">adresse de retour,</p></li><li id="r-306592" data-claire-element-id="306592"><p id="r-306591" data-claire-element-id="306591">MIME,</p></li><li id="r-306594" data-claire-element-id="306594"><p id="r-306593" data-claire-element-id="306593">content-type.</p></li></ul><h2 id="r-comment-bien-declarer-son-header" data-claire-element-id="306627">Comment bien déclarer son <em>header</em> ?</h2><p id="r-306597" data-claire-element-id="306597">Nous allons garder le même schéma que précédemment. Je vous le rappelle :</p><ul id="r-306606" data-claire-element-id="306606"><li id="r-306599" data-claire-element-id="306599"><p id="r-306598" data-claire-element-id="306598">expéditeur,</p></li><li id="r-306601" data-claire-element-id="306601"><p id="r-306600" data-claire-element-id="306600">adresse de retour,</p></li><li id="r-306603" data-claire-element-id="306603"><p id="r-306602" data-claire-element-id="306602">MIME,</p></li><li id="r-306605" data-claire-element-id="306605"><p id="r-306604" data-claire-element-id="306604">content-type.</p></li></ul><aside id="r-306608" data-claire-element-id="306608" data-claire-semantic="information"><p id="r-306607" data-claire-element-id="306607">Je vais commencer à écrire du code, à partir de maintenant. Comme je suis en train de traiter le <strong><em>header</em></strong>, je vais mettre tout ce qui le concerne dans une variable $header.</p></aside><h3 id="r-declaration-de-l-expediteur" data-claire-element-id="306613">Déclaration de l'expéditeur</h3><pre id="r-306609" data-claire-element-id="306609"><code data-claire-semantic="html+php">&lt;?php
$header = &quot;From: \&quot;EXPEDITEUR\&quot;&lt;ADRESSE_EXPEDITEUR&gt;&quot;.$passage_ligne;
?&gt;</code></pre><aside id="r-306612" data-claire-element-id="306612" data-claire-semantic="warning"><p id="r-306610" data-claire-element-id="306610">Certains anti-spam se basent sur la concordance entre l'expéditeur qui est présent dans la balise <strong>FROM</strong> et le serveur depuis lequel le message est envoyer pour détecter un risque de fishing (exemple depuis <a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="0774667147736873682964686a">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script> vous envoyez un mail en tant que <a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="5d2e3c2b1d29342934733e3230">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>) donc il vaut mieux coller à 100%</p><p id="r-306611" data-claire-element-id="306611">Pour cela si vous etes sur un serveur mutualisée pour avoir l'adresse exacte envoyez vous un email avec la fonction mail de php avec juste un destinataire, un corps et un sujet peut importe le contenu vous n'aurez qu'à regarder l'adresse de l'expéditeur pour la mettre à la place de ADRESSE_EXPEDITEUR</p></aside><h3 id="r-declaration-de-l-adresse-de-retour" data-claire-element-id="306615">Déclaration de l'adresse de retour</h3><pre id="r-306614" data-claire-element-id="306614"><code data-claire-semantic="html+php">&lt;?php
$header.= &quot;Reply-to: \&quot;RETOUR\&quot; &lt;ADRESSE_RETOUR&gt;&quot;.$passage_ligne; 
?&gt;</code></pre><h3 id="r-declaration-de-la-version-de-mime" data-claire-element-id="306617">Déclaration de la version de MIME</h3><pre id="r-306616" data-claire-element-id="306616"><code data-claire-semantic="html+php">&lt;?php
$header.= &quot;MIME-Version: 1.0&quot;.$passage_ligne; 
?&gt;</code></pre><h3 id="r-declaration-du-content-type" data-claire-element-id="306619">Déclaration du content-type</h3><pre id="r-306618" data-claire-element-id="306618"><code data-claire-semantic="html+php">&lt;?php
$header.= &quot;Content-Type: multipart/alternative;&quot;.$passage_ligne.&quot; boundary=\&quot;$boundary\&quot;&quot;.$passage_ligne;
?&gt;</code></pre><h3 id="r-quelques-explications-6" data-claire-element-id="306626">Quelques explications</h3><p id="r-306620" data-claire-element-id="306620">Tout d'abord, la valeur de <strong><em>content-type</em></strong> : <strong>multipart/alternative</strong>.<br/> J'ai choisi d'utiliser celle-ci car mon tutoriel a pour but d'envoyer un e-mail en mode texte <strong>et</strong> en mode HTML (je détaillerai ces modes un peu plus tard).</p><aside id="r-306622" data-claire-element-id="306622" data-claire-semantic="information"><p id="r-306621" data-claire-element-id="306621">Il existe également d'autres « sous-types » pour le <strong><em>content-type</em></strong>. Ici, <strong>multipart/alternative</strong> permet au programme qui reçoit l'e-mail de choisir d'afficher soit la partie HTML, soit la partie texte. Je vous donne à nouveau le lien <a href="http://www.commentcamarche.net/courrier-electronique/mime.php3">CCM</a> où vous pourrez trouver les autres types et leurs utilités (ils ne seront pas détaillés ici car ils feront peut-être l'objet d'un autre tutoriel).</p></aside><p id="r-306623" data-claire-element-id="306623">Nous avons aussi la valeur <strong>boundary</strong> à laquelle j'ai affecté $boundary : je suis obligé de déclarer cette valeur ici, mais je vous expliquerai plus tard le contenu de la variable et son utilité.</p><p id="r-306624" data-claire-element-id="306624">Un exemple concret :</p><pre id="r-306625" data-claire-element-id="306625"><code data-claire-semantic="html+php">&lt;?php
//=====Création du header de l'e-mail
$header = &quot;From: \&quot;WeaponsB\&quot;&lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="8cfbe9edfce3e2ffeecce1ede5e0a2eafe">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;&quot;.$passage_ligne;
$header .= &quot;Reply-to: \&quot;WeaponsB\&quot; &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="5e293b3f2e31302d3c1e333f373270382c">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;&quot;.$passage_ligne;
$header .= &quot;MIME-Version: 1.0&quot;.$passage_ligne;
$header .= &quot;Content-Type: multipart/alternative;&quot;.$passage_ligne.&quot; boundary=\&quot;$boundary\&quot;&quot;.$passage_ligne;
//==========
?&gt;</code></pre><h2 id="r-1er-bilan" data-claire-element-id="306629">1er bilan</h2><p id="r-306628" data-claire-element-id="306628">Dans cette première partie, nous avons donc appris de quoi était constitué le <strong><em>header</em></strong> d'un e-mail et comment en créer un à notre convenance. Dans la prochaine partie, nous verrons les différents types de courriels et aussi le code à utiliser pour les déclarer.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php">[E-mail] Envoyer un e-mail en PHP</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/avant-propos-2">
Avant-propos
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/l-en-tete-1">
L&#039;en-tête
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/les-differents-types-d-e-mails">
Les différents types d&#039;e-mails
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/et-c-est-parti-pour-l-assemblage">
Et c&#039;est parti pour l&#039;assemblage !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-joindre-un-fichier">
Annexe : joindre un fichier
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-faq">
Annexe : FAQ
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-les-prioritees">
Annexe : les prioritées
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/avant-propos-2">
<span class="arrow"></span>
<span class="next">Avant-propos</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/les-differents-types-d-e-mails">
<span class="next">Les différents types d&#039;e-mails</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesdiffrentstypesd039e-mails"></a><h2>Les différents types d&#039;e-mails</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/l-en-tete-1">
<span class="arrow"></span>
<span class="next">L&#039;en-tête</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/et-c-est-parti-pour-l-assemblage">
<span class="next">Et c&#039;est parti pour l&#039;assemblage !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-definition-32" data-claire-element-id="306645">Définition</h2><p id="r-306631" data-claire-element-id="306631">J'imagine que vous avez tous reçu des e-mails au moins une fois dans votre vie. ^^ Vous avez donc eu la possibilité de constater que certains possèdent de belles images et une belle mise en forme. Par exemple :</p><figure id="r-format-html" data-claire-element-id="306634"><img id="r-306632" data-claire-element-id="306632" src="medias/uploads.siteduzero.com_files_104001_105000_104475.jpg" alt="Format Html"/><figcaption>Format Html</figcaption></figure><p id="r-306635" data-claire-element-id="306635"><em>Au format HTML</em></p><figure id="r-format-texte" data-claire-element-id="306638"><img id="r-306636" data-claire-element-id="306636" src="medias/uploads.siteduzero.com_files_104001_105000_104476.jpg" alt="Format texte"/><figcaption>Format texte</figcaption></figure><p id="r-306639" data-claire-element-id="306639"><em>Au format texte</em></p><div id="r-306641" data-claire-element-id="306641" data-claire-semantic="question"><p id="r-306640" data-claire-element-id="306640">Hum mais pourquoi existe-il deux format ?</p></div><p id="r-306642" data-claire-element-id="306642">Tous simplement car selon le client mail qui va lire votre message, il ne sauras pas forcément afficher la partie HTML. Par défaut les clients mail tente de convertir l'HTML en texte mais vous voudrez peut-être afficher un texte différent selon les cas</p><aside id="r-306644" data-claire-element-id="306644" data-claire-semantic="information"><p id="r-306643" data-claire-element-id="306643">Comme nous allons envoyer un e-mail en mode texte <strong>et</strong> en mode HTML, il va nous falloir deux variables : la première contenant le contenu de l'e-mail en mode texte que l'on appellera $message_txt, et la seconde, qui contiendra l'e-mail au format HTML, au nom de $message_html. Mais attention : ces messages devront OBLIGATOIREMENT se terminer par un <strong></strong> .</p></aside><h2 id="r-comment-faire-une-declaration-de-type" data-claire-element-id="306671">Comment faire une déclaration de type ?</h2><p id="r-306646" data-claire-element-id="306646">Pour effectuer une déclaration de type, il faut utiliser trois paramètres :</p><ul id="r-306651" data-claire-element-id="306651"><li id="r-306648" data-claire-element-id="306648"><p id="r-306647" data-claire-element-id="306647"><strong>Content-Type</strong> : XXX/XXX; <strong>charset</strong>=XXXXXX</p></li><li id="r-306650" data-claire-element-id="306650"><p id="r-306649" data-claire-element-id="306649"><strong>Content-Transfer-Encoding</strong> : XXXXXXXXXX</p></li></ul><p id="r-306652" data-claire-element-id="306652">Si l'on veut traduire cette partie en code PHP, on obtiendra quelque chose comme cela :</p><pre id="r-306653" data-claire-element-id="306653"><code data-claire-semantic="html+php">&lt;?php
$message = &quot;...&quot;;
$message .= &quot;Content-Type: XXX/XXX; charset=\&quot;XXXXXX\&quot;&quot;.$passage_ligne;
$message .= &quot;Content-Transfer-Encoding: XXXXXXXXXX&quot;.$passage_ligne;
$message .= &quot;...&quot;;
?&gt;</code></pre><aside id="r-306655" data-claire-element-id="306655" data-claire-semantic="information"><p id="r-306654" data-claire-element-id="306654">Pour information, j'utilise ici une nouvelle variable $message. Cette variable sera envoyée à la fonction mail() et contiendra l'intégralité du contenu de l'e-mail (texte et code HTML). <br/> Vous aurez aussi remarqué que j'ai ajouté « ... » avant et après ma déclaration de type. C'est parce qu'en temps normal, il y a autre chose avant et après la déclaration. Je l'aborderai plus tard dans ce tutoriel.</p></aside><h3 id="r-quelques-explications-7" data-claire-element-id="306670">Quelques explications</h3><p id="r-306656" data-claire-element-id="306656">Tout d'abord, le <strong><em>content-type</em></strong> (eh oui encore lui, mais je vous avais dit qu'il reviendrait :) ).<br/> Ici, il va servir à dire si l'on veut placer à la suite du texte ou du code HTML.</p><ul id="r-306661" data-claire-element-id="306661"><li id="r-306658" data-claire-element-id="306658"><p id="r-306657" data-claire-element-id="306657"><strong>Mode Texte</strong> =&gt; text/plain</p></li><li id="r-306660" data-claire-element-id="306660"><p id="r-306659" data-claire-element-id="306659"><strong>Mode HTML</strong> =&gt; text/html</p></li></ul><p id="r-306662" data-claire-element-id="306662">Passons au <strong><em>charset</em></strong>. Il va servir à définir le type d'encodage des caractères qui vont suivre.<br/> J'ai utilisé ici le <strong><em>charset</em></strong>iso-8859-1 car il est supporté par tous les webmails, contrairement à l'UTF-8.<br/> L'UTF-8 peut être utilisé pour l'envoi d'un e-mail multilingue (chinois, arabe...).</p><p id="r-306663" data-claire-element-id="306663">Maintenant, le dernier point : le <strong><em>Content-Transfer-Encoding</em></strong>. Ce paramètre permet de définir sur combien de bits sera encodé le message, ce qui détermine en fait le nombre de caractères différents possibles.<br/> Petit exemple : un e-mail avec un <strong><em>Content-Transfer-Encoding</em></strong> réglé sur 7 bits ne pourra comprendre que 128 caractères différents.</p><p id="r-306664" data-claire-element-id="306664"><cite>Citation : Cours de maths</cite></p><blockquote id="r-306666" data-claire-element-id="306666"><p id="r-306665" data-claire-element-id="306665"><strong>Nombre de caractères</strong> = 2n (bits)<br/> Donc un message sur 7 bits donnera : 27 = 128<br/> et un message sur 8 bits : 28 = 256<br/> etc.</p></blockquote><p id="r-306667" data-claire-element-id="306667">Maintenant, cela va donc dépendre de ce que vous écrivez dans votre courriel. Si vous souhaitez utiliser des accents, vous devrez obligatoirement régler le <strong><em>Content-Transfer-Encoding</em></strong> sur 8 bits. :)</p><p id="r-306668" data-claire-element-id="306668">Ainsi, si nous appliquons ce qui se trouve ci-dessus, on devrait se retrouver, pour une déclaration de mode HTML, avec ceci :</p><pre id="r-306669" data-claire-element-id="306669"><code data-claire-semantic="html+php">&lt;?php
$message = &quot;...&quot;;
$message .= &quot;Content-Type: text/html; charset=\&quot;ISO-8859-1\&quot;&quot;.$passage_ligne;
$message .= &quot;Content-Transfer-Encoding: 8bit&quot;.$passage_ligne;
$message .= &quot;...&quot;;
?&gt;</code></pre><h2 id="r-2e-bilan" data-claire-element-id="306673">2e bilan</h2><p id="r-306672" data-claire-element-id="306672">Eh bien nous y voilà ! :) <br/> Maintenant, nous savons comment définir ce que nous allons placer dans notre courriel. On avance sur le chemin de la quête de l'e-mail qui ne part pas à la corbeille. :p Il ne nous reste plus qu'à voir comment faire la jonction entre les différentes parties.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php">[E-mail] Envoyer un e-mail en PHP</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/avant-propos-2">
Avant-propos
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/l-en-tete-1">
L&#039;en-tête
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/les-differents-types-d-e-mails">
Les différents types d&#039;e-mails
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/et-c-est-parti-pour-l-assemblage">
Et c&#039;est parti pour l&#039;assemblage !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-joindre-un-fichier">
Annexe : joindre un fichier
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-faq">
Annexe : FAQ
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-les-prioritees">
Annexe : les prioritées
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/l-en-tete-1">
<span class="arrow"></span>
<span class="next">L&#039;en-tête</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/et-c-est-parti-pour-l-assemblage">
<span class="next">Et c&#039;est parti pour l&#039;assemblage !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Etc039estpartipourl039assemblage"></a><h2>Et c&#039;est parti pour l&#039;assemblage !</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/les-differents-types-d-e-mails">
<span class="arrow"></span>
<span class="next">Les différents types d&#039;e-mails</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-joindre-un-fichier">
<span class="next">Annexe : joindre un fichier</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-306675" data-claire-element-id="306675">À vos marques, prêts ? Assemb... <strong>STOP !!!</strong></p><p id="r-306676" data-claire-element-id="306676">Eh non, ce n'est pas encore pour tout de suite. :lol: Non, ne me regardez pas avec ces yeux-là ! Oui, ceux-là ! :colere2: <br/> Ça va bientôt venir, mais il faut que je vous explique une dernière chose avant de pouvoir vous lancer.</p><h2 id="r-boundary" data-claire-element-id="306698">Boundary</h2><p id="r-306677" data-claire-element-id="306677">Je vais enfin vous expliquer ce que contient la fameuse variable $boundary. :) <br/> Tout d'abord, pour vous donner une idée, <strong><em>boundary</em></strong> se traduit en français par frontière.</p><p id="r-306678" data-claire-element-id="306678"><strong><em>Boundary</em></strong> va donc nous permettre de séparer les différentes parties de notre e-mail, et c'est <strong>OBLIGATOIRE</strong>. On pourrait les considérer comme des super-balises.</p><p id="r-306679" data-claire-element-id="306679">Le format d'une <strong><em>boundary</em></strong> est le suivant :</p><p id="r-306680" data-claire-element-id="306680"><cite>Citation : Format</cite></p><blockquote id="r-306682" data-claire-element-id="306682"><p id="r-306681" data-claire-element-id="306681">----=Chaîne_aléatoire</p></blockquote><p id="r-306683" data-claire-element-id="306683">Pour générer cette chaîne, nous allons utiliser deux fonctions PHP. Tout d'abord, la fonction rand(), qui permet d'obtenir un nombre aléatoire, puis la fonction md5(), qui permet de hacher une chaîne (ici, nous hacherons ce que la fonction rand() nous sortira).</p><p id="r-306684" data-claire-element-id="306684">Ainsi, si vous avez bien compris ce que je vous ai expliqué, vous devriez avoir écrit un code comme celui-ci :</p><pre id="r-306685" data-claire-element-id="306685"><code data-claire-semantic="html+php">&lt;?php
$boundary = &quot;-----=&quot;.md5(rand());
?&gt;</code></pre><p id="r-306686" data-claire-element-id="306686">Et voilà ! Notre <strong><em>boundary</em></strong> est créée. :)</p><aside id="r-306688" data-claire-element-id="306688" data-claire-semantic="information"><p id="r-306687" data-claire-element-id="306687">Si nous utilisons ces deux méthodes c'est qu'il faut que le texte de la boundary ne soit pas présent dans notre corps de message sinon ça part droit à la catastrophe</p></aside><p id="r-306689" data-claire-element-id="306689">Une <strong><em>boundary</em></strong> étant une frontière, il lui faut donc aussi une fin. Malheureusement, la création de la <strong><em>boundary</em></strong> comme cela ne pourra pas suffire pour le corps du message.<br/> Il va falloir ajouter ces caractères devant à chaque fois que vous les utilisez en dehors de la déclaration qui se situe dans le <strong><em>header</em></strong>.</p><p id="r-306690" data-claire-element-id="306690"><cite>Citation : caractères</cite></p><blockquote id="r-306692" data-claire-element-id="306692"><p id="r-306691" data-claire-element-id="306691">--</p></blockquote><p id="r-306693" data-claire-element-id="306693">Il va aussi falloir fermer la <strong><em>boundary</em></strong>.<br/> Pour fermer, il suffit de la réutiliser en l'ajoutant à la fin.</p><p id="r-306694" data-claire-element-id="306694"><cite>Citation : Fin de boundary</cite></p><blockquote id="r-306696" data-claire-element-id="306696"><p id="r-306695" data-claire-element-id="306695">--</p></blockquote><p id="r-306697" data-claire-element-id="306697">Et voilà qui termine cette partie sur les <strong><em>boundary</em></strong>.</p><h2 id="r-schema-final-du-message" data-claire-element-id="306705">Schéma final du message</h2><p id="r-306699" data-claire-element-id="306699">Voilà ! Je vais maintenant vous dire comment faire l'assemblage avec cette dernière info.</p><p id="r-306700" data-claire-element-id="306700"><cite>Citation : Schéma</cite></p><blockquote id="r-306702" data-claire-element-id="306702"><p id="r-306701" data-claire-element-id="306701">Ouverture <em>boundary</em>.<br/> Déclaration de type (exemple texte).<br/> Texte.<br/> Ouverture <em>boundary</em>.<br/> Déclaration de type (exemple HTML).<br/> HTML.<br/> Fermeture <em>boundary</em>.<br/> Fermeture <em>boundary</em>.</p></blockquote><p id="r-306703" data-claire-element-id="306703">Et voilà ! Je pense que je n'ai plus grand-chose à vous apprendre sur ce sujet. Je vous offre juste un dernier exemple de code complet pour que vous puissiez l'analyser.</p><pre id="r-306704" data-claire-element-id="306704"><code data-claire-semantic="html+php">&lt;?php
$mail = '<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="b8cfddd9c8d7d6cbdaf8d5d9d1d496deca">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>'; // Déclaration de l'adresse de destination.
if (!preg_match(&quot;#^[a-z0-9._-]+@(hotmail|live|msn).[a-z]{2,4}$#&quot;, $mail)) // On filtre les serveurs qui rencontrent des bogues.
{
	$passage_ligne = &quot;\r\n&quot;;
}
else
{
	$passage_ligne = &quot;\n&quot;;
}
//=====Déclaration des messages au format texte et au format HTML.
$message_txt = &quot;Salut à tous, voici un e-mail envoyé par un script PHP.&quot;;
$message_html = &quot;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;b&gt;Salut à tous&lt;/b&gt;, voici un e-mail envoyé par un &lt;i&gt;script PHP&lt;/i&gt;.&lt;/body&gt;&lt;/html&gt;&quot;;
//==========
 
//=====Création de la boundary
$boundary = &quot;-----=&quot;.md5(rand());
//==========
 
//=====Définition du sujet.
$sujet = &quot;Hey mon ami !&quot;;
//=========
 
//=====Création du header de l'e-mail.
$header = &quot;From: \&quot;WeaponsB\&quot;&lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="582f3d392837362b3a1835393134763e2a">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;&quot;.$passage_ligne;
$header.= &quot;Reply-to: \&quot;WeaponsB\&quot; &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="b5c2d0d4c5dadbc6d7f5d8d4dcd99bd3c7">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;&quot;.$passage_ligne;
$header.= &quot;MIME-Version: 1.0&quot;.$passage_ligne;
$header.= &quot;Content-Type: multipart/alternative;&quot;.$passage_ligne.&quot; boundary=\&quot;$boundary\&quot;&quot;.$passage_ligne;
//==========
 
//=====Création du message.
$message = $passage_ligne.&quot;--&quot;.$boundary.$passage_ligne;
//=====Ajout du message au format texte.
$message.= &quot;Content-Type: text/plain; charset=\&quot;ISO-8859-1\&quot;&quot;.$passage_ligne;
$message.= &quot;Content-Transfer-Encoding: 8bit&quot;.$passage_ligne;
$message.= $passage_ligne.$message_txt.$passage_ligne;
//==========
$message.= $passage_ligne.&quot;--&quot;.$boundary.$passage_ligne;
//=====Ajout du message au format HTML
$message.= &quot;Content-Type: text/html; charset=\&quot;ISO-8859-1\&quot;&quot;.$passage_ligne;
$message.= &quot;Content-Transfer-Encoding: 8bit&quot;.$passage_ligne;
$message.= $passage_ligne.$message_html.$passage_ligne;
//==========
$message.= $passage_ligne.&quot;--&quot;.$boundary.&quot;--&quot;.$passage_ligne;
$message.= $passage_ligne.&quot;--&quot;.$boundary.&quot;--&quot;.$passage_ligne;
//==========
 
//=====Envoi de l'e-mail.
mail($mail,$sujet,$message,$header);
//==========
?&gt;</code></pre>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php">[E-mail] Envoyer un e-mail en PHP</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/avant-propos-2">
Avant-propos
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/l-en-tete-1">
L&#039;en-tête
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/les-differents-types-d-e-mails">
Les différents types d&#039;e-mails
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/et-c-est-parti-pour-l-assemblage">
Et c&#039;est parti pour l&#039;assemblage !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-joindre-un-fichier">
Annexe : joindre un fichier
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-faq">
Annexe : FAQ
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-les-prioritees">
Annexe : les prioritées
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/les-differents-types-d-e-mails">
<span class="arrow"></span>
<span class="next">Les différents types d&#039;e-mails</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-joindre-un-fichier">
<span class="next">Annexe : joindre un fichier</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Annexejoindreunfichier"></a><h2>Annexe : joindre un fichier</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/et-c-est-parti-pour-l-assemblage">
<span class="arrow"></span>
<span class="next">Et c&#039;est parti pour l&#039;assemblage !</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-faq">
<span class="next">Annexe : FAQ</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-306707" data-claire-element-id="306707">Voyons maintenant comment joindre un fichier dans un e-mail.</p><h3 id="r-changement-de-l-en-tete" data-claire-element-id="306755">Changement de l'en-tête</h3><p id="r-306708" data-claire-element-id="306708">Bon, comme je vous l'ai déjà expliqué dans les précédentes parties, lorsque l'on souhaite envoyer un e-mail en texte et en HTML, on doit déclarer dans le <em><strong>header</strong></em> le <em><strong>Content-Type</strong></em> : <strong>multipart/alternative</strong>.</p><p id="r-306709" data-claire-element-id="306709">Ça, c'était pour du texte et du HTML. Pour pouvoir joindre un fichier, cela va changer un petit peu. ;) <br/> En effet, le <em><strong>Content-Type</strong></em> : <strong>multipart/alternative</strong> prévient le client qu'il va recevoir du texte et du HTML, mais pas un ou plusieurs fichiers. Pour cela, on va utiliser le <em><strong>Content-Type</strong></em> : <strong>multipart/mixed</strong> qui, lui, prévient juste le client qu'il va recevoir plusieurs parties différentes.</p><p id="r-306710" data-claire-element-id="306710">Maintenant, après les modifications, votre <em><strong>header</strong></em> devrait ressembler à cela :</p><pre id="r-306711" data-claire-element-id="306711"><code data-claire-semantic="html+php">&lt;?php
//=====Création du header de l'e-mail.
$header = &quot;From: \&quot;WeaponsB\&quot;&lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="74031115041b1a07163419151d185a1206">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;&quot;.$passage_ligne;
$header .= &quot;Reply-to: \&quot;WeaponsB\&quot; &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="83f4e6e2f3ecedf0e1c3eee2eaefade5f1">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;&quot;.$passage_ligne;
$header .= &quot;MIME-Version: 1.0&quot;.$passage_ligne;
$header .= &quot;Content-Type: multipart/mixed;&quot;.$passage_ligne.&quot; boundary=\&quot;$boundary\&quot;&quot;.$passage_ligne;
//==========
?&gt;</code></pre><p id="r-306712" data-claire-element-id="306712">Maintenant, avant d'aller plus loin, il va nous falloir comprendre ce qu'est réellement un fichier.</p><p id="r-306713" data-claire-element-id="306713"><cite>Citation : Définition d'un fichier</cite></p><blockquote id="r-306715" data-claire-element-id="306715"><p id="r-306714" data-claire-element-id="306714">Un fichier est en fait une suite de caractères. Ces caractères sont par la suite interprétés par le logiciel que vous utilisez pour l'ouvrir.</p></blockquote><p id="r-306716" data-claire-element-id="306716">Je pense que, maintenant, vous avez compris comment nous allons procéder pour joindre un fichier à un e-mail.<br/> Il va donc nous falloir lire le contenu du fichier pour, par la suite, l'ajouter dans le courriel.<br/> Comme mon tutoriel ne porte pas sur la gestion de fichier en PHP, je vais juste vous donner le code que j'utilise pour lire les fichiers joints à mes e-mails.</p><pre id="r-306717" data-claire-element-id="306717"><code data-claire-semantic="html+php">&lt;?php
$fichier   = fopen(&quot;image.jpg&quot;, &quot;r&quot;);   //on ouvre le fichier en lecture seule.
$attachement = fread($fichier, filesize(&quot;image.jpg&quot;)); //on lit l'ensemble du fichier avec la fonction fread.
fclose($fichier); //on ferme le fichier.
?&gt;</code></pre><p id="r-306718" data-claire-element-id="306718">Maintenant que nous avons le contenu de notre fichier, nous allons devoir l'encoder en 64 bits.</p><div id="r-306720" data-claire-element-id="306720" data-claire-semantic="question"><p id="r-306719" data-claire-element-id="306719">Whaouu !! Encoder ? C'est quoi, ça ? Moi je n'y connais rien en codage !</p></div><p id="r-306721" data-claire-element-id="306721">Pas de problème. Encoder, c'est remplacer un caractère ou une suite de caractères par un ou une autre. :) <br/> Comment encoder un fichier en 64 bits ? Grâce au PHP, rien de plus simple ! En effet, il existe une fonction qui fait ça tout seul. C'est pas beau, ça ?</p><p id="r-306722" data-claire-element-id="306722">Il s'agit de la fonction base64_encode(), que l'on va utiliser comme ceci :</p><pre id="r-306723" data-claire-element-id="306723"><code data-claire-semantic="html+php">&lt;?php
$attachement = chunk_split(base64_encode($attachement));
?&gt;</code></pre><p id="r-306724" data-claire-element-id="306724">Au passage, vous remarquerez que j'ai également utilisé la fonction chunk_split(), qui sert, lorsqu'elle n'a pas de second argument, à effectuer un retour à la ligne tous les 76 caractères, ce qui permet de respecter la norme RFC 2045.</p><p id="r-306725" data-claire-element-id="306725">Voilà. Maintenant que nous avons notre fichier dans une variable et qu'il est au bon format, on va pouvoir l'ajouter à notre e-mail.</p><p id="r-306726" data-claire-element-id="306726">Pour l'ajouter, on va faire comme lorsque l'on voulait déclarer soit du texte, soit du HTML.<br/> La déclaration se voit quand même quelque peu enrichie. On va devoir maintenant déclarer :</p><ul id="r-306731" data-claire-element-id="306731"><li id="r-306728" data-claire-element-id="306728"><p id="r-306727" data-claire-element-id="306727">le nom du fichier ;</p></li><li id="r-306730" data-claire-element-id="306730"><p id="r-306729" data-claire-element-id="306729"><em><strong>Content-Disposition:</strong></em> XXXXXX; filename=&quot;Nom_du_fichier&quot;.</p></li></ul><p id="r-306732" data-claire-element-id="306732">Le <em><strong>Content-Disposition</strong></em> permet de dire que ce qui suit devra être en fichier joint. Pour cela, on lui donnera la valeur attachment.<br/> Ce qui, en code, nous donnera :</p><pre id="r-306733" data-claire-element-id="306733"><code data-claire-semantic="html+php">&lt;?php
$message.= &quot;Content-Disposition: attachment; filename=\&quot;nom_fichier\&quot;&quot;.$passage_ligne;
?&gt;</code></pre><p id="r-306734" data-claire-element-id="306734">Le <em><strong>Content-Type</strong></em> va lui aussi changer. En effet, rappelez-vous, c'est lui qui détermine à quoi correspondent les caractères entre les deux <em><strong>boundary</strong></em>. Le problème dans le cas présent, c'est que le <em><strong>Content-Type</strong></em> dépendra du fichier que vous voulez joindre. :'( Il faudra donc le faire varier en fonction de l'extension du fichier que vous envoyez. Ces types sont définis par l'IANA. Vous trouverez <a href="http://www.commentcamarche.net/courrier-electronique/mime.php3">ici</a> une liste non exhaustive des différents types disponibles, avec descriptions. <br/> Comme dans cet exemple, nous allons joindre le fichier image.jpg et nous allons utiliser le <em><strong>Content-Type:</strong></em>image/jpeg. Lors de la déclaration d'un <em><strong>Content-Type</strong></em> qui sert à joindre un fichier, on doit aussi déclarer le nom du fichier joint. Au final, nous obtiendrons une déclaration du <em><strong>Content-Type</strong></em> similaire à celle-ci :</p><pre id="r-306735" data-claire-element-id="306735"><code data-claire-semantic="html+php">&lt;?php
$message.= &quot;Content-Type: image/jpeg; name=\&quot;nom_fichier\&quot;&quot;.$passage_ligne;
?&gt;</code></pre><p id="r-306736" data-claire-element-id="306736">Maintenant que nous avons vu les différentes étapes, je vous donne la déclaration que vous devriez avoir obtenue si vous m'avez bien suivi.</p><pre id="r-306737" data-claire-element-id="306737"><code data-claire-semantic="html+php">&lt;?php
$message.= &quot;Content-Type: image/jpeg; name=\&quot;image.jpg\&quot;&quot;.$passage_ligne;
$message.= &quot;Content-Transfer-Encoding: base64&quot;.$passage_ligne;
$message.= &quot;Content-Disposition: attachment; filename=\&quot;image.jpg\&quot;&quot;.$passage_ligne;
?&gt;</code></pre><p id="r-306738" data-claire-element-id="306738">Bon, maintenant, vous pensez que l'on va pouvoir directement envoyer le fichier joint ? Eh bien non. :p <br/> Évidemment, cela aurait été trop simple. Car si jamais vous essayez d'insérer directement votre fichier joint dans le courriel, la personne qui va le recevoir aura un e-mail avec ce schéma :</p><ul id="r-306745" data-claire-element-id="306745"><li id="r-306740" data-claire-element-id="306740"><p id="r-306739" data-claire-element-id="306739">e-mail en texte,</p></li><li id="r-306742" data-claire-element-id="306742"><p id="r-306741" data-claire-element-id="306741">e-mail en HTML,</p></li><li id="r-306744" data-claire-element-id="306744"><p id="r-306743" data-claire-element-id="306743">pièce jointe.</p></li></ul><p id="r-306746" data-claire-element-id="306746">Ce problème est dû au changement du <em><strong>Content-Type :</strong></em><strong>multipart/mixed</strong>. Pour résoudre ce problème, on va devoir déclarer à nouveau un <em><strong>Content-Type :</strong></em> et une autre <em><strong>boundary</strong></em>. Pour vous expliquer le mieux possible, je vais vous faire une comparaison entre le schéma actuel et le schéma final.</p><p id="r-306747" data-claire-element-id="306747"><cite>Citation : Schéma actuel</cite></p><blockquote id="r-306749" data-claire-element-id="306749"><p id="r-306748" data-claire-element-id="306748">Ouverture <em>boundary</em>.<br/> Déclaration de type (exemple texte).<br/> Texte.<br/> Ouverture <em>boundary</em>.<br/> Déclaration de type (exemple HTML).<br/> HTML.<br/> Fermeture <em>boundary</em>.<br/> Fermeture <em>boundary</em>.</p></blockquote><p id="r-306750" data-claire-element-id="306750"><cite>Citation : Schéma final</cite></p><blockquote id="r-306752" data-claire-element-id="306752"><p id="r-306751" data-claire-element-id="306751">Ouverture <em>boundary</em>.<br/> Déclaration du nouveau <em>content-type</em> et de la seconde <em>boundary</em>.<br/> Ouverture <em>boundary_2</em>.<br/> Déclaration de type (exemple texte).<br/> Texte.<br/> Ouverture <em>boundary_2</em>.<br/> Déclaration de type (exemple HTML).<br/> HTML.<br/> Fermeture <em>boundary_2</em>.<br/> Ouverture <em>boundary</em>.<br/> Déclaration de la pièce jointe.<br/> Fermeture <em>boundary</em>.</p></blockquote><p id="r-306753" data-claire-element-id="306753">Voilà pour finir le code final.</p><pre id="r-306754" data-claire-element-id="306754"><code data-claire-semantic="html+php">&lt;?php
$mail = '<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="65120004150a0b16072508040c094b0317">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>'; // Déclaration de l'adresse de destination.
if (!preg_match(&quot;#^[a-z0-9._-]+@(hotmail|live|msn).[a-z]{2,4}$#&quot;, $mail)) // On filtre les serveurs qui présentent des bogues.
{
	$passage_ligne = &quot;\r\n&quot;;
}
else
{
	$passage_ligne = &quot;\n&quot;;
}
//=====Déclaration des messages au format texte et au format HTML.
$message_txt = &quot;Salut à tous, voici un e-mail envoyé par un script PHP.&quot;;
$message_html = &quot;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;b&gt;Salut à tous&lt;/b&gt;, voici un e-mail envoyé par un &lt;i&gt;script PHP&lt;/i&gt;.&lt;/body&gt;&lt;/html&gt;&quot;;
//==========
 
//=====Lecture et mise en forme de la pièce jointe.
$fichier   = fopen(&quot;image.jpg&quot;, &quot;r&quot;);
$attachement = fread($fichier, filesize(&quot;image.jpg&quot;));
$attachement = chunk_split(base64_encode($attachement));
fclose($fichier);
//==========
 
//=====Création de la boundary.
$boundary = &quot;-----=&quot;.md5(rand());
$boundary_alt = &quot;-----=&quot;.md5(rand());
//==========
 
//=====Définition du sujet.
$sujet = &quot;Hey mon ami !&quot;;
//=========
 
//=====Création du header de l'e-mail.
$header = &quot;From: \&quot;WeaponsB\&quot;&lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="b9cedcd8c9d6d7cadbf9d4d8d0d597dfcb">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;&quot;.$passage_ligne;
$header.= &quot;Reply-to: \&quot;WeaponsB\&quot; &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="5e293b3f2e31302d3c1e333f373270382c">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;&quot;.$passage_ligne;
$header.= &quot;MIME-Version: 1.0&quot;.$passage_ligne;
$header.= &quot;Content-Type: multipart/mixed;&quot;.$passage_ligne.&quot; boundary=\&quot;$boundary\&quot;&quot;.$passage_ligne;
//==========
 
//=====Création du message.
$message = $passage_ligne.&quot;--&quot;.$boundary.$passage_ligne;
$message.= &quot;Content-Type: multipart/alternative;&quot;.$passage_ligne.&quot; boundary=\&quot;$boundary_alt\&quot;&quot;.$passage_ligne;
$message.= $passage_ligne.&quot;--&quot;.$boundary_alt.$passage_ligne;
//=====Ajout du message au format texte.
$message.= &quot;Content-Type: text/plain; charset=\&quot;ISO-8859-1\&quot;&quot;.$passage_ligne;
$message.= &quot;Content-Transfer-Encoding: 8bit&quot;.$passage_ligne;
$message.= $passage_ligne.$message_txt.$passage_ligne;
//==========
 
$message.= $passage_ligne.&quot;--&quot;.$boundary_alt.$passage_ligne;
 
//=====Ajout du message au format HTML.
$message.= &quot;Content-Type: text/html; charset=\&quot;ISO-8859-1\&quot;&quot;.$passage_ligne;
$message.= &quot;Content-Transfer-Encoding: 8bit&quot;.$passage_ligne;
$message.= $passage_ligne.$message_html.$passage_ligne;
//==========
 
//=====On ferme la boundary alternative.
$message.= $passage_ligne.&quot;--&quot;.$boundary_alt.&quot;--&quot;.$passage_ligne;
//==========
 
 
 
$message.= $passage_ligne.&quot;--&quot;.$boundary.$passage_ligne;
 
//=====Ajout de la pièce jointe.
$message.= &quot;Content-Type: image/jpeg; name=\&quot;image.jpg\&quot;&quot;.$passage_ligne;
$message.= &quot;Content-Transfer-Encoding: base64&quot;.$passage_ligne;
$message.= &quot;Content-Disposition: attachment; filename=\&quot;image.jpg\&quot;&quot;.$passage_ligne;
$message.= $passage_ligne.$attachement.$passage_ligne.$passage_ligne;
$message.= $passage_ligne.&quot;--&quot;.$boundary.&quot;--&quot;.$passage_ligne; 
//========== 
//=====Envoi de l'e-mail.
mail($mail,$sujet,$message,$header);
 
//==========
?&gt;</code></pre>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php">[E-mail] Envoyer un e-mail en PHP</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/avant-propos-2">
Avant-propos
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/l-en-tete-1">
L&#039;en-tête
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/les-differents-types-d-e-mails">
Les différents types d&#039;e-mails
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/et-c-est-parti-pour-l-assemblage">
Et c&#039;est parti pour l&#039;assemblage !
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-joindre-un-fichier">
Annexe : joindre un fichier
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-faq">
Annexe : FAQ
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-les-prioritees">
Annexe : les prioritées
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/et-c-est-parti-pour-l-assemblage">
<span class="arrow"></span>
<span class="next">Et c&#039;est parti pour l&#039;assemblage !</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-faq">
<span class="next">Annexe : FAQ</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="AnnexeFAQ"></a><h2>Annexe : FAQ</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-joindre-un-fichier">
<span class="arrow"></span>
<span class="next">Annexe : joindre un fichier</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-les-prioritees">
<span class="next">Annexe : les prioritées</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<aside id="r-306758" data-claire-element-id="306758" data-claire-semantic="information"><p id="r-306757" data-claire-element-id="306757">J'ai décidé de créer cette partie pour y ranger les informations qui ont été distribuées dans les commentaires, cela permet de tout regrouper clairement.</p></aside><p id="r-306759" data-claire-element-id="306759"><strong>Q :</strong> J'ai suivi le tuto, mais l'e-mail envoyé est vide.<br/><strong>R :</strong> Il faut tenter de remplacer les par des uniquement, certains agents de transfert e-mail remplacent automatiquement le par , ce qui fait que l'on se retrouve alors avec .<br/> Edit : Normalement, problème réglé avec la dernière version du tuto, ajouter le domaine posant problème dans le filtre du RegEx.</p><p id="r-306760" data-claire-element-id="306760"><strong>Q :</strong> J'utilise Wampserver / EasyPhp et j'ai une erreur de ce type :</p><pre id="r-306761" data-claire-element-id="306761"><code data-claire-semantic="html+php">Warning: mail() [function.mail]: Failed to connect to mailserver at &quot;localhost&quot; port 25, verify your &quot;SMTP&quot; and &quot;smtp_port&quot; setting in php.ini or use ini_set() in C:\XXXXXX.php on line XX</code></pre><p id="r-306762" data-claire-element-id="306762"><strong>R :</strong> Il vous faut configurer un serveur smtp pour envoyer votre e-mail depuis votre PC en local ; pour ce faire, il faut éditer le fichier php.ini.</p><p id="r-306763" data-claire-element-id="306763"><strong>Q :</strong> J'ai suivi le tuto, mais mes e-mails tombent toujours dans la corbeille. <br/><strong>R :</strong> Malheureusement, il n'y a pas de solution miracle... Certains serveurs électroniques filtrent plus ou moins...</p><p id="r-306764" data-claire-element-id="306764"><strong>Q :</strong> Je veux pouvoir mettre plusieurs pièces jointes dans un même courriel.<br/><strong>R :</strong> Il faut placer une boundary pour chaque pièce jointe. Exemple avec le schéma du tuto :</p><p id="r-306765" data-claire-element-id="306765"><cite>Citation : Schéma final</cite></p><blockquote id="r-306767" data-claire-element-id="306767"><p id="r-306766" data-claire-element-id="306766">Ouverture <em>boundary</em>.<br/> Déclaration du nouveau <em>content-type</em> et de la seconde <em>boundary</em>.<br/> Ouverture <em>boundary_2</em>.<br/> Déclaration de type (exemple texte).<br/> Texte.<br/> Ouverture <em>boundary_2</em>.<br/> Déclaration de type (exemple HTML).<br/> HTML.<br/> Fermeture <em>boundary_2</em>.<br/> Ouverture <em>boundary</em>.<br/> Déclaration de la pièce jointe 1.<br/> Ouverture <em>boundary</em>.<br/> Déclaration de la pièce jointe 2.<br/> Ouverture <em>boundary</em>.<br/> Déclaration de la pièce jointe [...].<br/> Ouverture <em>boundary</em>.<br/> Déclaration de la pièce jointe n.<br/> Fermeture <em>boundary</em>.</p></blockquote><p id="r-306768" data-claire-element-id="306768"><strong>Q :</strong> Mon fichier joint est corrompu quand je tente de l'ouvrir.<br/><strong>R :</strong> Vérifiez que le content-type est correct.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php">[E-mail] Envoyer un e-mail en PHP</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/avant-propos-2">
Avant-propos
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/l-en-tete-1">
L&#039;en-tête
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/les-differents-types-d-e-mails">
Les différents types d&#039;e-mails
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/et-c-est-parti-pour-l-assemblage">
Et c&#039;est parti pour l&#039;assemblage !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-joindre-un-fichier">
Annexe : joindre un fichier
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-faq">
Annexe : FAQ
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-les-prioritees">
Annexe : les prioritées
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-joindre-un-fichier">
<span class="arrow"></span>
<span class="next">Annexe : joindre un fichier</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-les-prioritees">
<span class="next">Annexe : les prioritées</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Annexelespriorites"></a><h2>Annexe : les prioritées</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-faq">
<span class="arrow"></span>
<span class="next">Annexe : FAQ</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-306770" data-claire-element-id="306770">Aujourd'hui nous allons voir comment définir une priorité à nos emails : attention à cette fonctionnalité, en effet si tous vos emails sont en priorités maximum les personnes qui les reçoivent n'y feront plus attention...</p><p id="r-306771" data-claire-element-id="306771">Il y a 4 priorités différentes (en fait il y en a 5, mais la priorité &quot;normale&quot; n'est à mon sens pas une priorité).</p><table id="r-306804" data-claire-element-id="306804"><thead id="r-306777" data-claire-element-id="306777"><tr id="r-306776" data-claire-element-id="306776"><th id="r-306773" data-claire-element-id="306773"><p id="r-306772" data-claire-element-id="306772">Littérale</p></th><th id="r-306775" data-claire-element-id="306775"><p id="r-306774" data-claire-element-id="306774">Correspondance norme</p></th></tr></thead><tbody id="r-306803" data-claire-element-id="306803"><tr id="r-306782" data-claire-element-id="306782"><td id="r-306779" data-claire-element-id="306779"><p id="r-306778" data-claire-element-id="306778">Maximum</p></td><td id="r-306781" data-claire-element-id="306781"><p id="r-306780" data-claire-element-id="306780">1</p></td></tr><tr id="r-306787" data-claire-element-id="306787"><td id="r-306784" data-claire-element-id="306784"><p id="r-306783" data-claire-element-id="306783">Haute</p></td><td id="r-306786" data-claire-element-id="306786"><p id="r-306785" data-claire-element-id="306785">2</p></td></tr><tr id="r-306792" data-claire-element-id="306792"><td id="r-306789" data-claire-element-id="306789"><p id="r-306788" data-claire-element-id="306788">Normale</p></td><td id="r-306791" data-claire-element-id="306791"><p id="r-306790" data-claire-element-id="306790">3</p></td></tr><tr id="r-306797" data-claire-element-id="306797"><td id="r-306794" data-claire-element-id="306794"><p id="r-306793" data-claire-element-id="306793">Basse</p></td><td id="r-306796" data-claire-element-id="306796"><p id="r-306795" data-claire-element-id="306795">4</p></td></tr><tr id="r-306802" data-claire-element-id="306802"><td id="r-306799" data-claire-element-id="306799"><p id="r-306798" data-claire-element-id="306798">Minimale</p></td><td id="r-306801" data-claire-element-id="306801"><p id="r-306800" data-claire-element-id="306800">5</p></td></tr></tbody></table><p id="r-306805" data-claire-element-id="306805">Maintenant pour définir la priorité dans l'email il faut ajouter une ligne dans le header :</p><pre id="r-306806" data-claire-element-id="306806"><code data-claire-semantic="html+php">&lt;?php
//=====Création du header de l'e-mail
$header = &quot;From: \&quot;WeaponsB\&quot;&lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="265143475649485544664b474f4a084054">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;&quot;.$passage_ligne;
$header .= &quot;Reply-to: \&quot;WeaponsB\&quot; &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="23544642534c4d5041634e424a4f0d4551">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;&quot;.$passage_ligne;
$header .= &quot;MIME-Version: 1.0&quot;.$passage_ligne;
$header .= &quot;X-Priority: 3&quot;.$passage_ligne;
$header .= &quot;Content-Type: multipart/alternative;&quot;.$passage_ligne.&quot; boundary=\&quot;$boundary\&quot;&quot;.$passage_ligne;
//==========
?&gt;</code></pre><p id="r-306807" data-claire-element-id="306807">Ce tutoriel est enfin terminé.</p><p id="r-306808" data-claire-element-id="306808">Je pense avoir réussi à vous apprendre comment envoyer correctement un e-mail en PHP. Certaines personnes me feront peut-être remarquer que je n'ai pas tout traité ! En effet, mais s'il y a des choses que je n'ai pas abordées, c'est tout simplement parce que je ne les maîtrise pas encore totalement (l'inclusion d'une image à l'intérieur d'un e-mail, par exemple). Je préfère donc ne pas en parler du tout, plutôt que de me risquer à écrire n'importe quoi. :)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php">[E-mail] Envoyer un e-mail en PHP</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/avant-propos-2">
Avant-propos
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/l-en-tete-1">
L&#039;en-tête
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/les-differents-types-d-e-mails">
Les différents types d&#039;e-mails
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/et-c-est-parti-pour-l-assemblage">
Et c&#039;est parti pour l&#039;assemblage !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-joindre-un-fichier">
Annexe : joindre un fichier
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-faq">
Annexe : FAQ
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-les-prioritees">
Annexe : les prioritées
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/e-mail-envoyer-un-e-mail-en-php/annexe-faq">
<span class="arrow"></span>
<span class="next">Annexe : FAQ</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/e-mail-envoyer-un-e-mail-en-php.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 20:02:05 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/e-mail-envoyer-un-e-mail-en-php.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:45:02 GMT -->
</html>