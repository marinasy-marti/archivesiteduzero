<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/qt-bien-utiliser-qtxml.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:59:34 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/qt-bien-utiliser-qtxml.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:39:06 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : [Qt] Bien utiliser QtXml</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/qt-bien-utiliser-qtxml.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : [Qt] Bien utiliser QtXml</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#QtBienutiliserQtXml">[Qt] Bien utiliser QtXml</a><br/><a href="#L039objetDOM">L&#039;objet DOM</a><br/><a href="#AgirsurledocumentDOM--techniquedebase">Agir sur le document DOM -- technique de base</a><br/><a href="#AgirsurledocumentDOM--techniquesavances">Agir sur le document DOM -- techniques avancées</a><br/><a href="#criredansledocumentXML">Écrire dans le document XML</a><br/></div>
<a name="QtBienutiliserQtXml"></a><h2>[Qt] Bien utiliser QtXml</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/l-objet-dom">
<span class="next">L&#039;objet DOM</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-575944" data-claire-element-id="575944"><strong>Bienvenue dans le mini-tutoriel pour apprendre à utiliser QtXml qui permet de pouvoir utiliser des données XML dans une application Qt. </strong>Nous apprendrons dans ce chapitre à utiliser le XML via DOM !</p><aside id="r-575947" data-claire-element-id="575947" data-claire-semantic="information"><p id="r-575945" data-claire-element-id="575945">Il est recommandé de connaître les bases de Qt, car je ne les redonnerai pas. Lisez donc en premier <a href="http://www.siteduzero.com/tutoriel-3-11406-apprenez-a-programmer-en-c.html#part_11407">le tutoriel de M@teo21 sur Qt</a> si ce n'est pas encore fait.</p><p id="r-575946" data-claire-element-id="575946">Il est aussi recommandé de connaître le langage XML et de savoir comment il est fait. Si vous ne le savez pas, consultez <a href="http://www.siteduzero.com/tutoriel-3-33440-le-point-sur-xml.html">le tutoriel de Tangui</a>.</p></aside>
</div><a name="L039objetDOM"></a><h2>L&#039;objet DOM</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/agir-sur-le-document-dom-technique-de-base">
<span class="next">Agir sur le document DOM -- technique de base</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-575948" data-claire-element-id="575948">QtXml est un module qui permet d'utiliser des données XML dans un programme Qt. Pour que le compilateur puisse savoir que vous voulez utiliser QtXml, il vous faut rajouter dans le fichier une extension <em>.pro</em> :</p><pre id="r-575949" data-claire-element-id="575949"><code>QT += xml</code></pre><p id="r-575950" data-claire-element-id="575950">Puis il ne nous reste plus qu'à préciser au compilateur que nous voulons utiliser le module en ajoutant un <em>include</em>, celui qui suit :</p><pre id="r-575951" data-claire-element-id="575951"><code data-claire-semantic="cpp">#include &lt;QtXml&gt;</code></pre><p id="r-575952" data-claire-element-id="575952">Cet <em>include</em>, comme vous avez dû le remarquer, permet d'utiliser le module dans son code.<br/> Maintenant, je vais vous donner le code requis pour chaque fichier.</p><h3 id="r-main-cpp-17" data-claire-element-id="575954">main.cpp</h3><pre id="r-575953" data-claire-element-id="575953"><code data-claire-semantic="cpp">#include &lt;QApplication&gt;
#include &lt;QtGui&gt;
#include &lt;QtXml&gt;
#include &quot;Xml_Dom.h&quot;
int main(int argc, char *argv[])
{
	QApplication app(argc,argv);
	Xml_Dom *Dom = new Xml_Dom();
	Dom-&gt;show();
	
	return app.exec();
}</code></pre><h3 id="r-xml-dom-h" data-claire-element-id="575956">Xml_Dom.h</h3><pre id="r-575955" data-claire-element-id="575955"><code data-claire-semantic="cpp">#ifndef XML_DOM
#define XML_DOM

#include &lt;QtGui&gt;
#include &lt;QtXml&gt;
#include &lt;QWidget&gt;

class Xml_Dom : public QWidget
{
	public:
	Xml_Dom();
	~Xml_Dom();
	// On rajoutera des variables et des méthodes après.

};

#endif</code></pre><h3 id="r-xml-dom-cpp" data-claire-element-id="575976">Xml_Dom.cpp</h3><pre id="r-575957" data-claire-element-id="575957"><code data-claire-semantic="cpp">#include &quot;Xml_Dom.h&quot;
#include &lt;iostream&gt;
using namespace std;

Xml_Dom::Xml_Dom() : QWidget()
{
	/*/////////////////////////////////////////////////////////////////////*/
       /* On définira ici le document XML et les actions que l'on va effectuer */
      /*//////////////////////////EN PREMIER LIEU/////////////////////////////*/
     /*/////////////////////////////////////////////////////////////////////*/

}

Xml_Dom::~Xml_Dom()
{

}</code></pre><p id="r-575958" data-claire-element-id="575958">Afin de pouvoir utiliser du XML, nous allons utiliser un objet DOM (<em>Document Objet Model)</em>. Il faut donc définir un objet de ce type qui nous permettra d'agir sur le document XML. <br/> Afin de créer cet objet, il nous suffit d'utiliser la classe <strong>QDomDocument</strong>. Il faut la définir comme ceci :</p><pre id="r-575959" data-claire-element-id="575959"><code data-claire-semantic="cpp">QDomDocument *dom = new QDomDocument(&quot;Nom de votre document QDomDocument&quot;); // Création de l'objet DOM</code></pre><p id="r-575960" data-claire-element-id="575960">Cette façon est la plus simple d'instancier l'objet QDomDocument. Il en existe d'autres qui ne servent pas pour le moment.<br/> Il nous faut maintenant ouvrir le document XML ; pour cela, on utilise alors le code suivant :</p><pre id="r-575961" data-claire-element-id="575961"><code data-claire-semantic="cpp">QFile xml_doc(&quot;nom_du_document_xml.xml&quot;);// On choisit le fichier contenant les informations XML.</code></pre><p id="r-575962" data-claire-element-id="575962">Ensuite, pour savoir si le fichier a bien été ouvert en lecture seule, on écrit :</p><pre id="r-575963" data-claire-element-id="575963"><code data-claire-semantic="cpp">if(!xml_doc.open(QIODevice::ReadOnly))// Si l'on n'arrive pas à ouvrir le fichier XML.
{
     QMessageBox::warning(this,&quot;Erreur à l'ouverture du document XML&quot;,&quot;Le document XML n'a pas pu être ouvert. Vérifiez que le nom est le bon et que le document est bien placé&quot;);
     return;
}</code></pre><p id="r-575964" data-claire-element-id="575964">Enfin, il faut attribuer le fichier XML à l'objet QDomDocument. On fait donc :</p><pre id="r-575965" data-claire-element-id="575965"><code data-claire-semantic="cpp">dom-&gt;setContent(&amp;xml_doc);</code></pre><p id="r-575966" data-claire-element-id="575966">Pour aller plus vite, on peut directement tester ce code. On écrira donc :</p><pre id="r-575967" data-claire-element-id="575967"><code data-claire-semantic="cpp">if (!dom-&gt;setContent(&amp;xml_doc)) // Si l'on n'arrive pas à associer le fichier XML à l'objet DOM.
{
     xml_doc.close();
     QMessageBox::warning(this,&quot;Erreur à l'ouverture du document XML&quot;,&quot;Le document XML n'a pas pu être attribué à l'objet QDomDocument.&quot;);
     return;
 }</code></pre><p id="r-575968" data-claire-element-id="575968">L'objet QDomDocument est maintenant créé ! Si vous avez bien suivi, vous devriez avoir le code suivant :</p><pre id="r-575969" data-claire-element-id="575969"><code data-claire-semantic="cpp">QDomDocument *dom = new QDomDocument(&quot;mon_xml&quot;);
	QFile xml_doc(&quot;xml_doc.xml&quot;);// On choisit le fichier contenant les informations XML.
	if(!xml_doc.open(QIODevice::ReadOnly))// Si l'on n'arrive pas à ouvrir le fichier XML.
	{
		QMessageBox::warning(this,&quot;Erreur à l'ouverture du document XML&quot;,&quot;Le document XML n'a pas pu être ouvert. Vérifiez que le nom est le bon et que le document est bien placé&quot;);
		return;
	}
	if (!dom-&gt;setContent(&amp;xml_doc)) // Si l'on n'arrive pas à associer le fichier XML à l'objet DOM.
	{
            xml_doc.close();
            QMessageBox::warning(this,&quot;Erreur à l'ouverture du document XML&quot;,&quot;Le document XML n'a pas pu être attribué à l'objet QDomDocument.&quot;);
            return;
	}
xml_doc.close(); // Dans tous les cas, on doit fermer le document XML : on n'en a plus besoin, tout est compris dans l'objet DOM.</code></pre><p id="r-575970" data-claire-element-id="575970">Vous n'avez qu'à placer ce code dans le constructeur de la classe <strong>POUR L'INSTANT</strong>.</p><p id="r-575971" data-claire-element-id="575971">Nous sommes maintenant prêts à utiliser l'objet que nous venons de créer !</p><aside id="r-575973" data-claire-element-id="575973" data-claire-semantic="warning"><p id="r-575972" data-claire-element-id="575972">Attention ! N'oubliez pas de fournir les DLL plus <em>QtXmld4.dll</em> ou <em>QtXml4.dll</em> en fonction de votre option de compilation ! N'oubliez pas non plus de mettre le document XML dans le même dossier que l'exécutable, sinon vous n'obtiendrez rien !</p></aside><aside id="r-575975" data-claire-element-id="575975" data-claire-semantic="information"><p id="r-575974" data-claire-element-id="575974">Cela ne vous sert à rien d'exécuter le code maintenant, nous n'avons fait aucun agissement.</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml">[Qt] Bien utiliser QtXml</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/l-objet-dom">
L&#039;objet DOM
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/agir-sur-le-document-dom-technique-de-base">
Agir sur le document DOM -- technique de base
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/agir-sur-le-document-dom-techniques-avancees">
Agir sur le document DOM -- techniques avancées
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/ecrire-dans-le-document-xml">
Écrire dans le document XML
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/agir-sur-le-document-dom-technique-de-base">
<span class="next">Agir sur le document DOM -- technique de base</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="AgirsurledocumentDOM--techniquedebase"></a><h2>Agir sur le document DOM -- technique de base</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/l-objet-dom">
<span class="arrow"></span>
<span class="next">L&#039;objet DOM</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/agir-sur-le-document-dom-techniques-avancees">
<span class="next">Agir sur le document DOM -- techniques avancées</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-575978" data-claire-element-id="575978">Maintenant que nous avons créé notre objet DOM, nous pouvons essayer de récupérer les données XML pour pouvoir les utiliser. Nous allons donc utiliser un objet QDomElement afin de récupérer tous les éléments du document que nous voulons étudier. Pour ce faire, on doit effectuer :</p><pre id="r-575979" data-claire-element-id="575979"><code data-claire-semantic="cpp">QDomElement dom_element = dom.documentElement();</code></pre><p id="r-575980" data-claire-element-id="575980"><strong>Explication :</strong></p><ul id="r-575985" data-claire-element-id="575985"><li id="r-575982" data-claire-element-id="575982"><p id="r-575981" data-claire-element-id="575981"><strong>1</strong> : on crée un objet QDomElement appelé dom_element ;</p></li><li id="r-575984" data-claire-element-id="575984"><p id="r-575983" data-claire-element-id="575983"><strong>2</strong> : on lui donne comme valeur tout le document XML : l'objet QDomDocument récupère le XML mais ne sait pas l'analyser !</p></li></ul><p id="r-575986" data-claire-element-id="575986">On essaye maintenant d'obtenir le premier nœud afin de récupérer les autres et aussi les balises. Pour faire cela, on va utiliser un objet QDomNode. On effectue donc :</p><pre id="r-575987" data-claire-element-id="575987"><code data-claire-semantic="cpp">QDomNode noeud = dom_element.firstChild();</code></pre><p id="r-575988" data-claire-element-id="575988"><strong>Explication :</strong></p><ul id="r-575993" data-claire-element-id="575993"><li id="r-575990" data-claire-element-id="575990"><p id="r-575989" data-claire-element-id="575989"><strong>1</strong> : on crée un objet QDomNode appelé nœud ;</p></li><li id="r-575992" data-claire-element-id="575992"><p id="r-575991" data-claire-element-id="575991"><strong>2</strong> : on lui donne comme valeur le premier nœud que dom_element a. Ce nœud contiendra tous les autres nœuds présents dans le document XML.</p></li></ul><p id="r-575994" data-claire-element-id="575994">Et maintenant, on regarde ce que l'on trouve ! Imaginons un fichier XML comme ceci :</p><pre id="r-575995" data-claire-element-id="575995"><code data-claire-semantic="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
&lt;info_de_TF1&gt;
	&lt;information&gt;Un avion s'est crashé dans l'océan.&lt;/information&gt;
	&lt;information&gt;Une femme a gagné à l'Euro Millions.&lt;/information&gt;
&lt;/info_de_TF1&gt;</code></pre><p id="r-575996" data-claire-element-id="575996">On va effectuer une boucle qui va nous donner des résultats tant qu'il y en a. Nous allons donc faire :</p><pre id="r-575997" data-claire-element-id="575997"><code data-claire-semantic="cpp">while(!noeud.isNull())// Tant que le nœud n'est pas vide.
{


}</code></pre><p id="r-575998" data-claire-element-id="575998">On va ensuite créer un nouvel objet (QDomElement) qui contiendra les éléments courants (ceux que l'on va analyser). On va donc écrire dans le <em>while</em> :</p><pre id="r-575999" data-claire-element-id="575999"><code data-claire-semantic="cpp">QDomElement element = noeud.toElement(); // On utilise cette propriété afin de transformer le nœud en éléments. Cela nous permet aussi de récupérer l'élément ou nœud courant.</code></pre><p id="r-576000" data-claire-element-id="576000">On vérifie ensuite si le résultat n'est pas vide. Devinez... quelle méthode allons-nous utiliser ?</p><div id="r-576002" data-claire-element-id="576002"><p id="r-576001" data-claire-element-id="576001"><em>isNull()</em> :D ! Je suis sûr que vous aviez trouvé !</p></div><p id="r-576003" data-claire-element-id="576003">On va donc écrire :</p><pre id="r-576004" data-claire-element-id="576004"><code data-claire-semantic="cpp">if(!element.isNull())
{
 // On indique le code à effectuer ici.
}</code></pre><p id="r-576005" data-claire-element-id="576005">Maintenant, on va indiquer ce que l'on veut faire. Si nous voulons afficher le nom de la balise, nous n'avons qu'à faire <em>element.tagName()</em>. Mais ce n'est pas le plus intéressant. Nous verrons toutes les méthodes de programmation possibles dans la prochaine sous-partie.<br/> Nous allons quand même rester sur le nom de la balise. Donc, pour pouvoir afficher le nom de la balise dans un <strong>QMessageBox</strong>, on va mettre comme code :</p><pre id="r-576006" data-claire-element-id="576006"><code data-claire-semantic="cpp">QMessageBox::information(this, &quot;Nom de la balise&quot;, &quot;Le nom de la balise est :&quot; + element.tagName());</code></pre><p id="r-576007" data-claire-element-id="576007"><strong>Explication :</strong></p><ul id="r-576012" data-claire-element-id="576012"><li id="r-576009" data-claire-element-id="576009"><p id="r-576008" data-claire-element-id="576008"><strong>1</strong> : on crée un objet QMessageBox::information qui affichera &quot;<em>Le nom de la balise est</em>&quot; plus le nom de la balise courante ;</p></li><li id="r-576011" data-claire-element-id="576011"><p id="r-576010" data-claire-element-id="576010"><strong>2</strong> : on utilise la méthode tagName() afin de pouvoir récupérer le nom de la balise.</p></li></ul><p id="r-576013" data-claire-element-id="576013">Puis enfin, on demande à <em>nœud</em> de prendre le prochain résultat qu'il trouve. Insérer dans le <em>while</em> mais après le <em>if</em> :</p><pre id="r-576014" data-claire-element-id="576014"><code data-claire-semantic="c">noeud = noeud.nextSibling(); // Ce code permet d'aller à l'élément suivant.</code></pre><p id="r-576015" data-claire-element-id="576015">Nous n'avons plus qu'à insérer ce code dans le <em>if</em> qui est lui-même dans le <em>while</em> !<br/> Donc si vous avez tout bien retenu, vous devriez avoir le code complet suivant :</p><h3 id="r-xml-dom-cpp-1" data-claire-element-id="576018">Xml_Dom.cpp</h3><pre id="r-576016" data-claire-element-id="576016"><code data-claire-semantic="cpp">#include &quot;Xml_Dom.h&quot;
#include &lt;iostream&gt;
using namespace std;

Xml_Dom::Xml_Dom() : QWidget()
{
	QDomDocument dom(&quot;mon_xml&quot;);
	QFile xml_doc(&quot;xml_doc.xml&quot;);
	if(!xml_doc.open(QIODevice::ReadOnly))
	{
		QMessageBox::warning(this, &quot;Erreur à l'ouverture du document XML&quot;, &quot;Le document XML n'a pas pu être ouvert. Vérifiez que le nom est le bon et que le document est bien placé&quot;);
		return;
	}
	if (!dom.setContent(&amp;xml_doc)) 
	{
     xml_doc.close();
     QMessageBox::warning(this, &quot;Erreur à l'ouverture du document XML&quot;, &quot;Le document XML n'a pas pu être attribué à l'objet QDomDocument.&quot;);
     return;
	}
	QDomElement dom_element = dom.documentElement();
	QDomNode noeud = dom_element.firstChild();
	while(!noeud.isNull())
	{
		if(!dom_element.isNull())
			QMessageBox::information(this, &quot;Nom de la balise&quot;, &quot;Le nom de la balise est &quot; + dom_element.tagName());
                noeud = noeud.nextSibling();
	}

}

Xml_Dom::~Xml_Dom()
{

}</code></pre><p id="r-576017" data-claire-element-id="576017">Et voilà votre premier document DOM avec Qt réussi ! Mais il faudrait quand même préciser d'autres choses sur ce module qu'est QtXml !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml">[Qt] Bien utiliser QtXml</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/l-objet-dom">
L&#039;objet DOM
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/agir-sur-le-document-dom-technique-de-base">
Agir sur le document DOM -- technique de base
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/agir-sur-le-document-dom-techniques-avancees">
Agir sur le document DOM -- techniques avancées
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/ecrire-dans-le-document-xml">
Écrire dans le document XML
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/l-objet-dom">
<span class="arrow"></span>
<span class="next">L&#039;objet DOM</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/agir-sur-le-document-dom-techniques-avancees">
<span class="next">Agir sur le document DOM -- techniques avancées</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="AgirsurledocumentDOM--techniquesavances"></a><h2>Agir sur le document DOM -- techniques avancées</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/agir-sur-le-document-dom-technique-de-base">
<span class="arrow"></span>
<span class="next">Agir sur le document DOM -- technique de base</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/ecrire-dans-le-document-xml">
<span class="next">Écrire dans le document XML</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-576020" data-claire-element-id="576020">Nous avons écrit un bon code juste au-dessus, mais il ne sert à rien dans cet état : les utilisateurs se fichent pas mal de connaître le nom de la balise. C'est pourquoi nous allons voir les différentes méthodes pour récupérer les informations.</p><h2 id="r-les-methodes-25" data-claire-element-id="576067">Les méthodes</h2><p id="r-576021" data-claire-element-id="576021">Afin de trouver le texte ou d'autres choses dans le document XML, nous pouvons avoir recours aux méthodes de la classe QDomElement. La première est, sans aucun doute, la méthode <em>text</em>. Elle s'écrit <em>element.text()</em> et sert à récupérer le texte situé à l'intérieur d'une balise (avec le document XML fourni plus haut, cela pourrait nous donner : <em>une femme a gagné à l'Euro Millions</em>). Elle ne demande aucun paramètre.</p><p id="r-576022" data-claire-element-id="576022">Considérons maintenant le code XML suivant :</p><pre id="r-576023" data-claire-element-id="576023"><code data-claire-semantic="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
&lt;info_de_TF1&gt;
	&lt;information id=&quot;0&quot; value=&quot;Un avion s'est craché dans l'océan&quot; /&gt;
	&lt;information id=&quot;1&quot; value=&quot;Une femme a gagné à l'Euro Million&quot; /&gt;
&lt;/info_de_TF1&gt;</code></pre><p id="r-576024" data-claire-element-id="576024">Si vous voulez trouver la valeur d'un des attributs d'une balise, il vous suffit d'utiliser la méthode <em>attribute</em>.<br/> Son prototype est :</p><pre id="r-576025" data-claire-element-id="576025"><code data-claire-semantic="cpp">QString QDomElement::attribute (const QString &amp; name, const QString &amp; defValue = QString() ) const</code></pre><p id="r-576026" data-claire-element-id="576026">Elle est utilisée comme ceci :</p><pre id="r-576027" data-claire-element-id="576027"><code data-claire-semantic="cpp">element.attribute(&quot;id&quot;, 0);</code></pre><p id="r-576028" data-claire-element-id="576028">Explication :</p><ul id="r-576033" data-claire-element-id="576033"><li id="r-576030" data-claire-element-id="576030"><p id="r-576029" data-claire-element-id="576029">on recherche dans element si une balise a un attribut <em>id</em> (dans cet exemple) ;</p></li><li id="r-576032" data-claire-element-id="576032"><p id="r-576031" data-claire-element-id="576031">si l'attribut n'est pas trouvé, on renvoie le deuxième argument, ici : 0. Cet argument est facultatif.</p></li></ul><p id="r-576034" data-claire-element-id="576034">Une autre méthode utilisée est la méthode <em>attributeNode()</em>. Son prototype est :</p><pre id="r-576035" data-claire-element-id="576035"><code data-claire-semantic="cpp">QDomAttr QDomElement::attributeNode(const QString &amp; name )</code></pre><p id="r-576036" data-claire-element-id="576036">Cette fonction permet de donner la valeur d'un attribut (<em>name</em>). Elle renvoie 0 si l'attribut n'existe pas.</p><p id="r-576037" data-claire-element-id="576037">Il existe bien d'autres méthodes, mais elles ne seront pas utiles ici. Vous pouvez aller les voir sur <a href="http://doc.trolltech.com/4.3/qtxml.html">la doc de la bibliothèque QtXml</a> (allez voir l'objet QDomElement).</p><p id="r-576038" data-claire-element-id="576038">Imaginons que nous voulions afficher une information en fonction de son ID, il nous faudrait utiliser attribute (ou attributeNode si vous voulez). Comme nous allons le faire :-° , il nous suffira de tester si l'ID que l'on récupère est égal à notre ID précisé. On utilisera aussi cette fonction afin d'afficher l'information.</p><p id="r-576039" data-claire-element-id="576039">Créez une fenêtre et mettez le code suivant dans le constructeur de la classe Xml_Dom :</p><pre id="r-576040" data-claire-element-id="576040"><code data-claire-semantic="cpp">QSpinBox *id_demand = new QSpinBox(this);
    QPushButton *open = new QPushButton(&quot;Voir la prochaine news&quot;, this);
    QHBoxLayout *layout = new QHBoxLayout();
    layout-&gt;addWidget(demand);
    layout-&gt;addWidget(open);
    setLayout(layout);</code></pre><p id="r-576041" data-claire-element-id="576041">Au final, pour l'instant, vous devriez avoir une interface comme celle-ci :</p><figure id="r-576043" data-claire-element-id="576044"><img id="r-576042" data-claire-element-id="576042" src="medias/uploads.siteduzero.com_files_208001_209000_208850.png" alt="Image utilisateur"/></figure><p id="r-576045" data-claire-element-id="576045">Maintenant, nous allons maintenant établir les connections. Toujours dans le constructeur, rajoutez :</p><pre id="r-576046" data-claire-element-id="576046"><code data-claire-semantic="cpp">connect(id_demand, SIGNAL(valueChanged(int)), this, SLOT(change(int)));
connect(open, SIGNAL(clicked()), this, SLOT(openDom()));</code></pre><p id="r-576047" data-claire-element-id="576047">Comme vous pouvez le voir, nous allons utiliser des SLOTS personnalisés. L'un servira à changer la valeur d'une variable qui sera notre ID demandé. L'autre ouvrira le document DOM et agira dessus.</p><aside id="r-576049" data-claire-element-id="576049" data-claire-semantic="information"><p id="r-576048" data-claire-element-id="576048">Avant de commencer à vraiment coder, je précise que ce petit programme sert à afficher une <em>news</em> en fonction de l'id précisé dans le QSpinBox (ou si vous préférez avec des noms de variables <em>id_demand</em>).</p></aside><p id="r-576050" data-claire-element-id="576050">Occupons-nous, dans un premier temps, de l'actualisation de notre variable qui changera. En un premier lieu, vous allez remplacer votre fichier Xml_Dom.h par ce code :</p><pre id="r-576051" data-claire-element-id="576051"><code data-claire-semantic="cpp">#ifndef WIDGET_H
#define WIDGET_H

#include &lt;QtGui&gt;
#include &lt;QWidget&gt;
#include &lt;QtXml&gt;

class Xml_Dom : public QWidget
{
    Q_OBJECT

public:
    Xml_Dom(QWidget *parent = 0);
    ~Xml_Dom();
private:
    QFile xml_doc;
    QDomElement dom;
    QDomNode noeud;
    QDomElement element
    QSpinBox *id_demand;
    QPushButton *open;
    int ids;
private slots:
    void openDom();
    void change(int change);

};

#endif // WIDGET_H</code></pre><p id="r-576052" data-claire-element-id="576052">Ce code nous donne les variables nécessaires ainsi que le constructeur, le destructeur et les SLOTS.</p><aside id="r-576054" data-claire-element-id="576054" data-claire-semantic="warning"><p id="r-576053" data-claire-element-id="576053">Faites les modifications nécessaires avec QWidget si vous en avez besoin !</p></aside><p id="r-576055" data-claire-element-id="576055">On peut voir que la variable qui va nous donner l'id s'appelle ids. Ce sera celle-là qui sera changée.<br/> Rajoutez maintenant dans votre constructeur :</p><pre id="r-576056" data-claire-element-id="576056"><code data-claire-semantic="cpp">ids = 0; // On initialise ids à 0.</code></pre><p id="r-576057" data-claire-element-id="576057">Nous allons maintenant voir le SLOT nommé <em>change</em>. Il est appelé quand le texte de <em>id_demand</em> est modifié. On va donc mettre ce texte dans une nouvelle variable.<br/> Voici le code de notre fonction :</p><pre id="r-576058" data-claire-element-id="576058"><code data-claire-semantic="cpp">void Xml_Dom::change(int change)
{
   ids = change;
}</code></pre><p id="r-576059" data-claire-element-id="576059">Ce code attribue la valeur <em>change</em> à ids.</p><p id="r-576060" data-claire-element-id="576060">Maintenant que l'on a défini ids, on va pouvoir exécuter des opérations sur le document DOM.<br/> Créez la fonction Xml_Dom::openDom() comme ceci :</p><pre id="r-576061" data-claire-element-id="576061"><code data-claire-semantic="cpp">void Xml_Dom::openDom()
{
    QDomDocument dom(&quot;mon_xml&quot;);
     QFile file(&quot;xml_doc.xml&quot;);
     if (!file.open(QIODevice::ReadOnly))
         return;
     if (!dom.setContent(&amp;file)) {
         file.close();
         return;
     }
     file.close();
     QDomElement docElem = dom.documentElement();
     QDomNode n = docElem.firstChild();
     while(!n.isNull()) 
     {
         QDomElement e = n.toElement(); 
         // C'est ici que l'on va marquer le code
         n = n.nextSibling();
     }
}</code></pre><p id="r-576062" data-claire-element-id="576062">On va maintenant rajouter ce qui va nous permettre de vérifier si l'id demandé est égal à ids. Pour cela, on va chercher l'attribut <em>id</em>. Comme ids est un <strong>int</strong>, on va aussi utiliser la fonction toInt(). Le code de test sera donc :</p><pre id="r-576063" data-claire-element-id="576063"><code data-claire-semantic="cpp">if(element.attribute(&quot;id&quot;).toInt() == ids)
             QMessageBox::information(NULL, &quot;Information&quot;, &quot;La nouvelle news est :&lt;br /&gt;&quot; + e.attribute(&quot;value&quot;));</code></pre><p id="r-576064" data-claire-element-id="576064">Vous n'avez plus qu'à intégrer ce code entre la déclaration de <em>element</em> et l'autre partie du code, et celui-ci est fini !</p><aside id="r-576066" data-claire-element-id="576066" data-claire-semantic="information"><p id="r-576065" data-claire-element-id="576065">N'hésitez pas à créer vos propres scripts et tests afin de bien maîtriser la lecture d'un document XML !</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml">[Qt] Bien utiliser QtXml</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/l-objet-dom">
L&#039;objet DOM
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/agir-sur-le-document-dom-technique-de-base">
Agir sur le document DOM -- technique de base
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/agir-sur-le-document-dom-techniques-avancees">
Agir sur le document DOM -- techniques avancées
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/ecrire-dans-le-document-xml">
Écrire dans le document XML
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/agir-sur-le-document-dom-technique-de-base">
<span class="arrow"></span>
<span class="next">Agir sur le document DOM -- technique de base</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/ecrire-dans-le-document-xml">
<span class="next">Écrire dans le document XML</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="criredansledocumentXML"></a><h2>Écrire dans le document XML</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/agir-sur-le-document-dom-techniques-avancees">
<span class="arrow"></span>
<span class="next">Agir sur le document DOM -- techniques avancées</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-576069" data-claire-element-id="576069">Pour écrire dans un document XML, il faut d'abord passer par le document DOM afin de récupérer le fichier déjà pris.</p><p id="r-576070" data-claire-element-id="576070">Créez un nouveau bouton, et appelez-le <em>write_button</em>. Et utilisez la méthode connect() comme ceci :</p><pre id="r-576071" data-claire-element-id="576071"><code data-claire-semantic="cpp">connect(write_button,SIGNAL(clicked()),this,SLOT(writeDom()));</code></pre><p id="r-576072" data-claire-element-id="576072"><em>write_button</em> va servir à lancer la fonction writeDom() qui va écrire dans le document XML.</p><p id="r-576073" data-claire-element-id="576073">Créez la fonction writeDom() et ajoutez dans <em>private slots</em> son prototype.</p><p id="r-576074" data-claire-element-id="576074">Dans la fonction créée, nous allons ajouter le code qui va nous permettre de lire le document XML :</p><pre id="r-576075" data-claire-element-id="576075"><code data-claire-semantic="cpp">QDomDocument dom(&quot;mon_xml&quot;);
QFile doc_xml(&quot;xml_doc.xml&quot;);
if(!doc_xml.open(QIODevice::ReadOnly))
{
    QMessageBox::critical(this,&quot;Erreur&quot;,&quot;Impossible d'ouvrir le ficher XML&quot;);
    doc_xml.close();
    return;
}
if(!dom.setContent(&amp;doc_xml))
{
    QMessageBox::critical(this,&quot;Erreur&quot;,&quot;Impossible d'ouvrir le ficher XML&quot;);
    doc_xml.close();
    return;
}
doc_xml.close();</code></pre><p id="r-576076" data-claire-element-id="576076">On ajoute ensuite le code qui va nous permettre d'explorer le nouveau document DOM :</p><pre id="r-576077" data-claire-element-id="576077"><code data-claire-semantic="cpp">QDomElement docElem = dom.documentElement();</code></pre><p id="r-576078" data-claire-element-id="576078">Nous pouvons maintenant écrire dans le document XML. Pour cela, on va d'abord passer par le document DOM.<br/> Créons un nouveau QDomElement et appelons-le write_elem. On va en même temps préciser comment s'appelle la balise.</p><pre id="r-576079" data-claire-element-id="576079"><code data-claire-semantic="cpp">QDomElement write_elem = dom.createElement(&quot;information&quot;); // On crée un QDomElement qui a comme nom de balise &quot;information&quot;.</code></pre><p id="r-576080" data-claire-element-id="576080">Le code ci-dessus va « préparer » une balise XML en la créant et en lui donnant déjà un nom (ici : information).<br/> On va ensuite lui donner des attributs en utilisant <em>setAttribute</em> :</p><pre id="r-576081" data-claire-element-id="576081"><code data-claire-semantic="cpp">write_elem.setAttribute(&quot;id&quot;, 2); // L'attribut id vaudra 2.
write_elem.setAttribute(&quot;value&quot;, &quot;L'inflation arrive en France&quot;); // L'attribut value vaudra &quot;L'inflation arrive en France&quot;.</code></pre><p id="r-576082" data-claire-element-id="576082">Le code ci-dessus ajoute à l'élément write_elem deux attributs : id et value. Nous leur donnons une valeur prédéfinie mais ce n'est pas obligatoire.<br/> Enfin, on met tout dans le document DOM en passant par un QDomElement. On passera donc par docElem :</p><pre id="r-576083" data-claire-element-id="576083"><code data-claire-semantic="cpp">docElem.appendChild(write_elem);// On associe write_elem à domElem.</code></pre><p id="r-576084" data-claire-element-id="576084">appendChild() est une fonction qui permet d'ajouter au document DOM un nœud ou un élément. Son prototype est :</p><pre id="r-576085" data-claire-element-id="576085"><code data-claire-semantic="cpp">QDomNode QDomNode::appendChild (const QDomNode &amp; newChild)</code></pre><p id="r-576086" data-claire-element-id="576086">Si vous avez bien suivi, vous devriez voir que le code ci-dessus ajoute l'élément write_elem au nœud docElem.<br/> Maintenant que notre balise XML est créée et intégrée au document DOM, nous pouvons actualiser le document XML. Pour ce faire, nous allons devoir écrire directement dans le fichier XML.</p><aside id="r-576088" data-claire-element-id="576088" data-claire-semantic="information"><p id="r-576087" data-claire-element-id="576087">Lisez <a href="http://www.siteduzero.com/tutoriel-3-100412-la-manipulation-des-fichiers.html">le tutoriel sur la manipulation des fichiers de shareman et zAmnellL</a> pour apprendre à écrire dans un fichier avec les flux !</p></aside><p id="r-576089" data-claire-element-id="576089">Pour pouvoir écrire dans le fichier XML, il faut donner une chaîne de caractères de type QString. On va donc devoir transformer un objet QDomDocument en QString. Voici le code pour créer un objet QString appelé write_elem qui reçoit un objet de type QDomDocument :</p><pre id="r-576090" data-claire-element-id="576090"><code data-claire-semantic="cpp">QString write_doc = doc.toString();</code></pre><p id="r-576091" data-claire-element-id="576091">On utilise la méthode toString() pour transformer l'objet QDomDocument en QString. Cela vous donnera peut-être la même chose que si vous utilisez un <em>cast</em>.</p><aside id="r-576093" data-claire-element-id="576093" data-claire-semantic="warning"><p id="r-576092" data-claire-element-id="576092">Cette méthode n'est pas disponible partout !</p></aside><p id="r-576094" data-claire-element-id="576094">Créez un objet de type QFile qui contiendra le fichier dans lequel écrire. Testez-le aussi :</p><pre id="r-576095" data-claire-element-id="576095"><code data-claire-semantic="cpp">QFile fichier(&quot;xml_doc.xml&quot;);
if(!fichier.open(QIODevice::WriteOnly))
{
    fichier.close();
    QMessageBox::critical(this,&quot;Erreur&quot;,&quot;Impossible d'écrire dans le document XML&quot;);
    return;
}</code></pre><p id="r-576096" data-claire-element-id="576096">Ensuite, créez un objet de type QTextStream :</p><pre id="r-576097" data-claire-element-id="576097"><code data-claire-semantic="cpp">QTextStream stream(&amp;fichier);</code></pre><p id="r-576098" data-claire-element-id="576098">Puis nous allons enfin écrire dans notre fichier :</p><pre id="r-576099" data-claire-element-id="576099"><code data-claire-semantic="cpp">stream &lt;&lt; write_doc; // On utilise l'opérateur &lt;&lt; pour écrire write_doc dans le document XML.</code></pre><p id="r-576100" data-claire-element-id="576100">Et à la fin de l'opération, on peut fermer le fichier :</p><pre id="r-576101" data-claire-element-id="576101"><code data-claire-semantic="cpp">fichier.close();</code></pre><p id="r-576102" data-claire-element-id="576105">Voilà ce que donne le code.<br/> Avant le passage du programme : <a href="medias/uploads.siteduzero.com_files_208001_209000_208929.png"><img id="r-576103" data-claire-element-id="576102" src="medias/uploads.siteduzero.com_thb_208001_209000_208929.png" alt="Image utilisateur"/></a><a href="medias/uploads.siteduzero.com_files_208001_209000_208928.png"><img id="r-576104" data-claire-element-id="576103" src="medias/uploads.siteduzero.com_thb_208001_209000_208928.png" alt="Image utilisateur"/></a><a href="medias/uploads.siteduzero.com_files_208001_209000_208930.png"><img id="r-576105" data-claire-element-id="576104" src="medias/uploads.siteduzero.com_thb_208001_209000_208930.png" alt="Image utilisateur"/></a><br/> Le programme : <br/> Après le passage du programme :</p><p id="r-576106" data-claire-element-id="576106">Vous savez maintenant écrire dans un document XML !</p><aside id="r-576108" data-claire-element-id="576108" data-claire-semantic="information"><p id="r-576107" data-claire-element-id="576107">Je le répète, n'hésitez pas à regarder dans <a href="http://doc.trolltech.com/4.3/qtxml.html">la doc de QtXml</a> pour trouver des réponses à vos questions !</p></aside><p id="r-576109" data-claire-element-id="576109">Et voilà ! Ce n'était pas facile, mais j'ai réussi à vous apprendre comment utiliser le DOM avec Qt afin de pouvoir gérer du XML ! Créez des programmes qui contiennent cette technique pour vous entraîner ! <br/> Merci d'avoir suivi ce tutoriel !</p><p id="r-576110" data-claire-element-id="576110">:) :) :)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml">[Qt] Bien utiliser QtXml</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/l-objet-dom">
L&#039;objet DOM
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/agir-sur-le-document-dom-technique-de-base">
Agir sur le document DOM -- technique de base
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/agir-sur-le-document-dom-techniques-avancees">
Agir sur le document DOM -- techniques avancées
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/ecrire-dans-le-document-xml">
Écrire dans le document XML
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/qt-bien-utiliser-qtxml/agir-sur-le-document-dom-techniques-avancees">
<span class="arrow"></span>
<span class="next">Agir sur le document DOM -- techniques avancées</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/qt-bien-utiliser-qtxml.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:59:37 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/qt-bien-utiliser-qtxml.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:39:07 GMT -->
</html>