<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/ecrivez-votre-site-web-en-c-avec-la-cgi.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 06:50:43 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/ecrivez-votre-site-web-en-c-avec-la-cgi.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:14:35 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Écrivez votre site web en C avec la CGI</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Écrivez votre site web en C avec la CGI</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#crivezvotresitewebenCaveclaCGI">Écrivez votre site web en C avec la CGI</a><br/><a href="#Prparation">Préparation</a><br/><a href="#Premierscript">Premier script</a><br/><a href="#Uncompteurdevisites">Un compteur de visites</a><br/><a href="#Traiterlesdonnesd039unformulaire">Traiter les données d&#039;un formulaire</a><br/><a href="#ExerciceUnlivred039or">[Exercice] Un livre d&#039;or</a><br/></div>
<a name="crivezvotresitewebenCaveclaCGI"></a><h2>Écrivez votre site web en C avec la CGI</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/preparation-22">
<span class="next">Préparation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-530912" data-claire-element-id="530912">Vous aimeriez créer un site dynamique, par exemple pour mettre en place un compteur de visites, un livre d'or, ou encore un web-RPG (pourquoi pas ?)...<br/> Mais vous n'utilisez que le C, et les langages tels que PHP ne vous attirent pas... vous pouvez faire avec vos connaissances et ce tutoriel !<br/> Ce tutoriel présente une introduction à la <a href="http://fr.wikipedia.org/wiki/Common_Gateway_Interface">CGI</a> avec ce langage.</p>
</div><a name="Prparation"></a><h2>Préparation</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/premier-script">
<span class="next">Premier script</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-530913" data-claire-element-id="530913">Pour que vos scripts soient exploitables, il faut tout d'abord configurer votre serveur web.</p><p id="r-530914" data-claire-element-id="530914">Sous Apache, il faudra créer un fichier .htaccess, que vous placerez à la racine du site (en effet, ce fichier fonctionne récursivement : tous les répertoires situés dans le répertoire contenant votre .htaccess seront concernés par les règles que vous définirez dans celui-ci). Le voici :</p><pre id="r-530915" data-claire-element-id="530915"><code data-claire-semantic="apache">AddHandler cgi-script .cgi
Options +ExecCGI
DirectoryIndex index.cgi</code></pre><p id="r-530916" data-claire-element-id="530916">Les deux premières lignes indiquent que les fichiers .cgi doivent être exécutés avant d'être envoyés au client. Le comportement par défaut serait d'envoyer le fichier comme s'il s'agissait d'un fichier texte ordinaire. La troisième et dernière ligne dit que votre fichier index.cgi sera exécuté en premier si aucun fichier n'est demandé.</p><p id="r-530917" data-claire-element-id="530917">Une dernière chose, le binaire .cgi devra être exécutable (chmod +x) sur votre serveur pour pouvoir être justement exécuté par le serveur web !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi">Écrivez votre site web en C avec la CGI</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/preparation-22">
Préparation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/premier-script">
Premier script
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/un-compteur-de-visites">
Un compteur de visites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/traiter-les-donnees-d-un-formulaire">
Traiter les données d&#039;un formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/exercice-un-livre-d-or">
[Exercice] Un livre d&#039;or
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/premier-script">
<span class="next">Premier script</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Premierscript"></a><h2>Premier script</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/preparation-22">
<span class="arrow"></span>
<span class="next">Préparation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/un-compteur-de-visites">
<span class="next">Un compteur de visites</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-530919" data-claire-element-id="530919">Pour commencer, nous allons nous intéresser à un classique Hello World sur une page blanche !</p><p id="r-530920" data-claire-element-id="530920">Mais avant de nous y atteler, nous devons en connaître plus sur le fonctionnement du protocole HTTP, en particulier ce que nous nous envoyons au client.</p><figure id="r-530922" data-claire-element-id="530923"><img id="r-530921" data-claire-element-id="530921" src="medias/uploads.siteduzero.com_files_243001_244000_243744.png" alt="Image utilisateur"/></figure><p id="r-530924" data-claire-element-id="530924">Comme vous pouvez le voir, une réponse du serveur est composée de deux parties :</p><ul id="r-530929" data-claire-element-id="530929"><li id="r-530926" data-claire-element-id="530926"><p id="r-530925" data-claire-element-id="530925">Les <strong>en-têtes</strong> qui contiennent des informations sur la réponse ainsi que sur le serveur : une partie est générée par lui-même ;</p></li><li id="r-530928" data-claire-element-id="530928"><p id="r-530927" data-claire-element-id="530927">Le <strong>contenu</strong> qui est simplement ce que le navigateur affichera.</p></li></ul><p id="r-530930" data-claire-element-id="530930">Mais comment devons-nous séparer les deux éléments ? Une simple ligne blanche.</p><p id="r-530931" data-claire-element-id="530931">Ainsi, voici une implémentation de notre Hello World :</p><pre id="r-530932" data-claire-element-id="530932"><code data-claire-semantic="c">#include &lt;stdio.h&gt;

void haut(char *);
void bas();

int main(void)
{
     printf(&quot;Content-Type: text/html;\n\n&quot;);
     haut(&quot;Ma page en C !&quot;);

     printf(&quot;Hello World !&quot;);

     bas();
     return 0;
}

/* On sépare le squelette HTML du reste du code */
void haut(char *title) {
     printf(&quot;&lt;!DOCTYPE html PUBLIC \&quot;-//W3C//DTD XHTML 1.0 Strict//EN\&quot; \&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\&quot;&gt;\n&lt;html xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot; xml:lang=\&quot;fr\&quot; &gt;\n\t&lt;head&gt;&quot;);
     printf(&quot;\t\t&lt;title&gt;%s&lt;/title&gt;&quot;, title);
     printf(&quot;\t\t&lt;meta http-equiv=\&quot;Content-Type\&quot; content=\&quot;text/html; charset=utf-8\&quot; /&gt;\n\t&lt;/head&gt;\n\t&lt;body&gt;&quot;);
}

void bas() {
     printf(&quot;\t&lt;/body&gt;\n&lt;/html&gt;&quot;);
}</code></pre><p id="r-530933" data-claire-element-id="530933">Notez qu'écrire le HTML avec des printf() est relativement sale. Dans un vrai code, on préférera plutôt lire un fichier le contenant.</p><p id="r-530934" data-claire-element-id="530934">Pour le compiler, rien de compliqué, il n'y a rien à inclure, comme vous le voyez :</p><pre id="r-530935" data-claire-element-id="530935"><code data-claire-semantic="console">$ gcc main.c -o index.cgi</code></pre><p id="r-530936" data-claire-element-id="530936">Placez ce nouveau fichier à la racine du site ; vous pouvez maintenant essayer de vous connecter à votre serveur HTTP à l'endroit qu'il convient (l'emplacement de votre site) : une page avec comme seul contenu le texte « Hello World », c'est magique !</p><p id="r-530937" data-claire-element-id="530937">Qui a dit que les sites en C, c'était impossible ? Malheureusement, plein de monde.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi">Écrivez votre site web en C avec la CGI</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/preparation-22">
Préparation
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/premier-script">
Premier script
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/un-compteur-de-visites">
Un compteur de visites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/traiter-les-donnees-d-un-formulaire">
Traiter les données d&#039;un formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/exercice-un-livre-d-or">
[Exercice] Un livre d&#039;or
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/preparation-22">
<span class="arrow"></span>
<span class="next">Préparation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/un-compteur-de-visites">
<span class="next">Un compteur de visites</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Uncompteurdevisites"></a><h2>Un compteur de visites</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/premier-script">
<span class="arrow"></span>
<span class="next">Premier script</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/traiter-les-donnees-d-un-formulaire">
<span class="next">Traiter les données d&#039;un formulaire</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-530939" data-claire-element-id="530939">Vu que vous savez afficher des données (c'est compliqué, il faut l'avouer :p ), je vous propose un petit TP qui consistera à faire un compteur de visites, qui s'incrémente à chaque ouverture de la page. J'utiliserai des fichiers dans ma correction, il est donc nécessaire de savoir les manipuler.</p><p id="r-530940" data-claire-element-id="530940">Pour ce script, nous allons nous baser sur le précédent, en modifiant un peu la fonction <strong>main()</strong>.</p><p id="r-530941" data-claire-element-id="530941">On commence par créer une variable pour les visites, une pour le fichier :</p><pre id="r-530942" data-claire-element-id="530942"><code data-claire-semantic="c">int main(void)
{
     int visites = 1;
     FILE *fichier = NULL;</code></pre><p id="r-530943" data-claire-element-id="530943">On ouvre un fichier compteur.txt et on lit la valeur numérique, en la mettant dans visites :</p><pre id="r-530944" data-claire-element-id="530944"><code data-claire-semantic="c">fichier = fopen(&quot;compteur.txt&quot;, &quot;r+&quot;);
if(fichier != NULL)
{
    fscanf(fichier, &quot;%d&quot;, &amp;visites);</code></pre><p id="r-530945" data-claire-element-id="530945">On modifie la valeur du fichier en l'incrémentant :</p><pre id="r-530946" data-claire-element-id="530946"><code data-claire-semantic="c">/* ..... */
    fseek(fichier, 0, SEEK_SET);
    fprintf(fichier, &quot;%d&quot;, visites+1);
    fclose(fichier);
}</code></pre><p id="r-530947" data-claire-element-id="530947">Et on finit par l'afficher :</p><pre id="r-530948" data-claire-element-id="530948"><code data-claire-semantic="c">/* ..... */
     printf(&quot;Content-Type: text/html;\n\n&quot;);
     haut(&quot;Ma page en C !&quot;);
     printf(&quot;J'ai eu %d visiteur(s) ! :)&quot;, visites);
     bas();

     return 0;
}</code></pre><p id="r-530949" data-claire-element-id="530949">Pour les commentaires, c'est le seul moyen que j'ai trouvé pour régler un problème d'indentation du site sans modifier le sens du code, ne vous étonnez pas s'ils ne veulent rien dire. ;)</p><p id="r-530950" data-claire-element-id="530950">Voici donc ce que donne un bête script de compteur de visites :</p><pre id="r-530951" data-claire-element-id="530951"><code data-claire-semantic="c">int main(void)
{
     int visites = 1;
     FILE *fichier = NULL;
     fichier = fopen(&quot;compteur.txt&quot;, &quot;r+&quot;);
     if(fichier != NULL)
     {
          fscanf(fichier, &quot;%d&quot;, &amp;visites);
          fseek(fichier, 0, SEEK_SET);
          fprintf(fichier, &quot;%d&quot;, visites+1);
          fclose(fichier);
     }

     printf(&quot;Content-Type: text/html;\n\n&quot;);
     haut(&quot;Ma page en C !&quot;);
     printf(&quot;J'ai eu %d visiteur(s) ! :)&quot;, visites);
     bas();
     return 0;
}</code></pre><p id="r-530952" data-claire-element-id="530952">N'oubliez par contre pas de créer votre fichier avec les droits nécessaires pour que l'utilisateur de votre serveur web puisse le modifier.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi">Écrivez votre site web en C avec la CGI</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/preparation-22">
Préparation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/premier-script">
Premier script
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/un-compteur-de-visites">
Un compteur de visites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/traiter-les-donnees-d-un-formulaire">
Traiter les données d&#039;un formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/exercice-un-livre-d-or">
[Exercice] Un livre d&#039;or
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/premier-script">
<span class="arrow"></span>
<span class="next">Premier script</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/traiter-les-donnees-d-un-formulaire">
<span class="next">Traiter les données d&#039;un formulaire</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Traiterlesdonnesd039unformulaire"></a><h2>Traiter les données d&#039;un formulaire</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/un-compteur-de-visites">
<span class="arrow"></span>
<span class="next">Un compteur de visites</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/exercice-un-livre-d-or">
<span class="next">[Exercice] Un livre d&#039;or</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-530954" data-claire-element-id="530954">Un des points inévitables en CGI est le traitement de formulaires. C'est ce que nous allons traiter (sans jeux de mots) dans cette partie.</p><h2 id="r-methode-get-1" data-claire-element-id="530960">Méthode GET</h2><p id="r-530955" data-claire-element-id="530955">La méthode GET, c'est quand les données sont passées dans l'URL. Pour cela, nous allons récupérer une variable environnement qui contient les données avec la fonction <code data-claire-semantic="c">getenv() </code>, qui est définie dans l'en-tête stdlib.h.<br/> Cette variable environnement est QUERY_STRING, son contenu se présentant sous la forme <strong>mavar=mavaleur&amp;unevar=unevaleur&amp;[...]</strong>.</p><p id="r-530956" data-claire-element-id="530956">Imaginons que nous voulions récupérer deux nombres a et b passés dans l'URL et les multiplier, voici comment procéder :</p><pre id="r-530957" data-claire-element-id="530957"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt; // Ne pas oublier pour getenv()

void haut(char *);
void bas();

int main(void)
{
     int a=0, b=0;

     printf(&quot;Content-Type: text/html;\n\n&quot;);
     haut(&quot;Ma page en C !&quot;);

     char *data = getenv(&quot;QUERY_STRING&quot;); // Les variables
     if(data == NULL)
     {
          printf(&quot;&lt;p&gt;Erreur dans le script !&lt;/p&gt;&quot;);
     }
     else
     {
          if(sscanf(data, &quot;a=%d&amp;b=%d&quot;, &amp;a, &amp;b) != 2) // On récupère les deux chiffres a et b
               printf(&quot;&lt;p&gt;Vous devez passer des chiffres en données !&quot;);
          else
               printf(&quot;&lt;p&gt;%dx%d = %d ! :)&lt;/p&gt;&quot;, a, b, a*b);
     }
     bas();
     return 0;
}</code></pre><p id="r-530958" data-claire-element-id="530958">Et si l'on appelle <a href="http://monsite.com/index.cgi?a=4&amp;b=6">http://monsite.com/index.cgi?a=4&amp;b=6</a>, nous nous trouvons bien avec ceci :</p><pre id="r-530959" data-claire-element-id="530959"><code data-claire-semantic="console">4x6 = 24 ! :)</code></pre><h2 id="r-methode-post" data-claire-element-id="530964">Méthode POST</h2><p id="r-530961" data-claire-element-id="530961">Là, les valeurs sont passées hors de l'URL. Nous les récupérons dans le flux d'entrée <strong>stdin</strong>. Au niveau de l'utilisation, on va l'utiliser <em>comme un fichier</em> déjà ouvert en lecture seule, et qu'on a pas besoin de fermer.<br/> Ces données sont passées sous la même forme que pour la méthode GET : <strong>mon_champs_de_texte=unevaleur&amp;un_textarea=uneautrevaleur</strong>.</p><p id="r-530962" data-claire-element-id="530962">Si je veux récupérer par exemple un texte entré dans un formulaire, de 80 caractères, dans un champ nommé <strong>data</strong> et l'afficher (ou en faire ce qu'on veut, même), voici comment il faudrait procéder :</p><pre id="r-530963" data-claire-element-id="530963"><code data-claire-semantic="c">int main(void)
{
     char montexte[80] = &quot;&quot;;
     printf(&quot;Content-Type: text/html;\n\n&quot;);
     haut(&quot;Ma page en C !&quot;);
     if(fscanf(stdin, &quot;data=%80[^&amp;]s&quot;, montexte) &lt; 0)
          printf(&quot;&lt;p&gt;Le formulaire a été mal rempli !&lt;/p&gt;&quot;);
     else
          printf(&quot;Voici ce que vous avez écrit : %s&quot;, montexte);
     bas();
     return 0;
}</code></pre><h2 id="r-decoder-les-donnees" data-claire-element-id="530980">Décoder les données</h2><p id="r-530965" data-claire-element-id="530965">Si vous avez affiché des chaînes avec des espaces et des caractères dits « spéciaux », vous aurez constaté que pour le commun des mortels, ce n'est pas du tout lisible. Je vous propose donc de décoder cette chaîne avec une fonction.<br/> Pour rendre tout ceci pédagogique, ce sera à vous de la coder (une solution sera proposée).</p><p id="r-530966" data-claire-element-id="530966">Il y a donc plusieurs règles :</p><ul id="r-530973" data-claire-element-id="530973"><li id="r-530968" data-claire-element-id="530968"><p id="r-530967" data-claire-element-id="530967">Les espaces sont remplacés par des <strong>+</strong> ;</p></li><li id="r-530970" data-claire-element-id="530970"><p id="r-530969" data-claire-element-id="530969">Les caractères spéciaux (les <strong>+</strong>, <strong>&amp;</strong>, <strong>%</strong>, les retours à la ligne, etc.) sont remplacés par le signe <strong>%</strong> suivi de leur code ascii traduit en hexadécimal ;</p></li><li id="r-530972" data-claire-element-id="530972"><p id="r-530971" data-claire-element-id="530971">Le reste demeure identique.</p></li></ul><p id="r-530974" data-claire-element-id="530974">Et une petite piste, pour récupérer le code sous forme décimale, il suffit de la récupérer avec un <strong>%x</strong> dans la fonction sscanf.</p><h3 id="r-correction-183" data-claire-element-id="530979">Correction</h3><p id="r-530975" data-claire-element-id="530975">Voici donc le code que je vous propose, mais ce n'est bien sûr pas le <strong>seul</strong> qui soit juste.</p><pre id="r-530976" data-claire-element-id="530976"><code data-claire-semantic="c">char *decode(char *str, char *fin)
{
     char *dest = strdup(str);
     if (dest == NULL)
          return NULL;
     char *ret = dest;

     for (; str &lt; fin &amp;&amp; *str != '\0'; str++, dest++)
     {
          if (*str == '+')
               *dest = ' ';
          else if (*str == '%')
          {
               ++str;
               if (*str == '\0')
                    break;
               int code = '?';
               sscanf(str, &quot;%2x&quot;, &amp;code);
               *dest = code;

               str++;
               if (*str == '\0')
                    break;
          }
          else
               *dest = *str;
     }
     *dest = '\0';
     return ret;
}</code></pre><p id="r-530977" data-claire-element-id="530977">Dans le code de la partie précédent, voici comment on l'utiliserait :</p><pre id="r-530978" data-claire-element-id="530978"><code data-claire-semantic="c">printf(&quot;Voici ce que vous avez écrit : %s&quot;, unencode(montexte, montexte+80));</code></pre>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi">Écrivez votre site web en C avec la CGI</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/preparation-22">
Préparation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/premier-script">
Premier script
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/un-compteur-de-visites">
Un compteur de visites
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/traiter-les-donnees-d-un-formulaire">
Traiter les données d&#039;un formulaire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/exercice-un-livre-d-or">
[Exercice] Un livre d&#039;or
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/un-compteur-de-visites">
<span class="arrow"></span>
<span class="next">Un compteur de visites</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/exercice-un-livre-d-or">
<span class="next">[Exercice] Un livre d&#039;or</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="ExerciceUnlivred039or"></a><h2>[Exercice] Un livre d&#039;or</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/traiter-les-donnees-d-un-formulaire">
<span class="arrow"></span>
<span class="next">Traiter les données d&#039;un formulaire</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-530982" data-claire-element-id="530982">Comme exercice final d'application, je vous propose la création d'un petit livre d'or suivi évidemment d'une correction détaillée.</p><p id="r-530983" data-claire-element-id="530983">Voici donc les fichiers nécessaires à ce petit TP :<br/> Le formulaire :</p><pre id="r-530984" data-claire-element-id="530984"><code data-claire-semantic="html">&lt;form method=&quot;post&quot; action=&quot;form.cgi&quot;&gt; 
   &lt;p&gt;&lt;label for=&quot;auteur&quot;&gt;Votre nom (maximum 20 caractères) :&lt;/label&gt;&lt;input type=&quot;text&quot; name=&quot;auteur&quot; id=&quot;auteur&quot; /&gt;&lt;/p&gt; 
   &lt;p&gt;&lt;label for=&quot;data&quot;&gt;Votre message (maximum 100 caractères) :&lt;/label&gt;&lt;input type=&quot;text&quot; name=&quot;data&quot; id=&quot;data&quot; /&gt;&lt;/p&gt; 
   &lt;p&gt;&lt;input type=&quot;submit&quot; value=&quot;C'est parti mon kiki §&quot; /&gt;&lt;/p&gt; 
&lt;/form&gt;</code></pre><p id="r-530985" data-claire-element-id="530985">La syntaxe du fichier des messages <strong>message.txt</strong> :</p><pre id="r-530986" data-claire-element-id="530986"><code>Nom
Message
Nom
Message
[....]</code></pre><p id="r-530987" data-claire-element-id="530987">Il n'y a rien d'autre à dire sauf peut-être une bonne chance !</p><h3 id="r-correction-184" data-claire-element-id="531011">Correction</h3><p id="r-530988" data-claire-element-id="530988">Voici une des corrections possibles. Pour la partie de traitement du formulaire :</p><pre id="r-530989" data-claire-element-id="530989"><code data-claire-semantic="c">#define TAILLE_LIGNE 123
#define TAILLE_AUTEUR 23
#define TAILLE_TEXTE 103
 
int main(void)
{
     char auteur[TAILLE_AUTEUR] = &quot;&quot;;
     char texte[TAILLE_TEXTE] = &quot;&quot;;
     char ligne[TAILLE_LIGNE] = &quot;&quot;;
     char *tdecode = NULL;
     FILE *fichier = NULL;
     printf(&quot;Content-Type: text/html; charset=utf-8\n\n&quot;);
     haut(&quot;Livre d'or&quot;);
 
     fgets(ligne, TAILLE_LIGNE, stdin);
     tdecode = decode(ligne, ligne+TAILLE_LIGNE);
     if(sscanf(tdecode, &quot;auteur=%20[^&amp;]&amp;data=%100[^&amp;]s&quot;, auteur, texte) &gt; 0) {
       free(tdecode);
       if(strlen(auteur) == 0 || strlen(texte) == 0) {
	 printf(&quot;Les deux champs doivent être remplis correctement !&quot;);
       }
       else {
	 printf(&quot;&lt;p&gt;Merci de votre message !&lt;/p&gt;&quot;);
	 fichier = fopen(&quot;messages.txt&quot;, &quot;a+&quot;);
	 if(fichier != NULL) {
	   fprintf(fichier, &quot;%s\n%s\n&quot;, auteur, texte);
	   fclose(fichier);
	 }
       }
     }
 
     fichier = fopen(&quot;messages.txt&quot;, &quot;r&quot;);
     if(fichier == NULL)
       printf(&quot;Erreur à la récupération des messages.&quot;);
     else {
       while(fgets(auteur, TAILLE_AUTEUR, fichier) != NULL) {
	 if(fgets(texte, TAILLE_TEXTE, fichier) != NULL)
	   {
	     printf(&quot;&lt;p&gt;%s a écrit :&lt;br&gt;&lt;p style=\&quot;margin-left: 30px; margin-top: -10px;\&quot;&gt;« %s »&lt;/p&gt;&lt;/p&gt;&quot;, auteur, texte);
	   }
       }
       fclose(fichier);
     }
 
     bas();
     return 0;
}</code></pre><p id="r-530990" data-claire-element-id="530990">C'est simple :</p><ul id="r-531005" data-claire-element-id="531005"><li id="r-530992" data-claire-element-id="530992"><p id="r-530991" data-claire-element-id="530991">On crée quelques tableaux de char et un fichier ;</p></li><li id="r-530994" data-claire-element-id="530994"><p id="r-530993" data-claire-element-id="530993">On écrit les en-têtes ;</p></li><li id="r-530996" data-claire-element-id="530996"><p id="r-530995" data-claire-element-id="530995">On exécute notre petite fonction pour afficher le haut ;</p></li><li id="r-530998" data-claire-element-id="530998"><p id="r-530997" data-claire-element-id="530997">On récupère l'entrée standard à maximum 136 caractères (les limites des deux variables, leurs noms, et l'esperluette) ;</p></li><li id="r-531000" data-claire-element-id="531000"><p id="r-530999" data-claire-element-id="530999">On décode la ligne et on récupère les valeurs ;</p></li><li id="r-531002" data-claire-element-id="531002"><p id="r-531001" data-claire-element-id="531001">On vérifie si l'utilisation a rentré quelque chose ;</p></li><li id="r-531004" data-claire-element-id="531004"><p id="r-531003" data-claire-element-id="531003">Si oui, on ouvre le fichier et on ajoute les valeurs sur deux lignes.</p></li></ul><p id="r-531006" data-claire-element-id="531006">Maintenant, pour l'affichage des autres messages, juste avant d'afficher le bas :</p><pre id="r-531007" data-claire-element-id="531007"><code data-claire-semantic="c">fichier = fopen(&quot;messages.txt&quot;, &quot;r&quot;);
if(fichier == NULL) {
    printf(&quot;Erreur à la récupération des messages.&quot;);
}
else {
       while(fgets(auteur, TAILLE_AUTEUR, fichier) != NULL) {
	 if(fgets(texte, TAILLE_TEXTE, fichier) != NULL)
         {
            printf(&quot;&lt;p&gt;%s a écrit :&lt;br&gt;&lt;p style=\&quot;margin-left: 30px; margin-top: -10px;\&quot;&gt;« %s »&lt;/p&gt;&lt;/p&gt;&quot;, auteur, texte);
         }
    }
    fclose(fichier);
}</code></pre><p id="r-531008" data-claire-element-id="531008">Par contre, attention, ceci étant un code d'apprentissage, je n'ai pas préféré le mettre, mais ce code contient une faille de sécurité, il ne faut donc pas l'utiliser sur un vrai site : on ne traite pas vraiment ce que l'utilisateur a rentré, donc si c'est du HTML ou du Javascript, c'est potentiellement dangereux.<br/> Sur un vrai site, il faudrait écrire une fonction qui remplace les chevrons d'une chaîne par leur équivalent en HTML : ainsi <strong>&lt;</strong> devient <strong>&amp;lt;</strong> et <strong>&gt;</strong> devient <strong>&amp;gt;</strong></p><p id="r-531009" data-claire-element-id="531009">Ce tutoriel traite surtout de l'aspect théorique de CGI ; on aurait pu utiliser n'importe quel langage : aussi bien le Python, que le C++ ou encore le Bash.<br/> Sachez aussi qu'une bibliothèque facilitant l'utilisation de la CGI en C existe : <a href="http://www.boutell.com/cgic/">Documentation de CGIC</a>.<br/> Si vous voulez utiliser des bases de données, c'est tout à fait possible, l'exemple même avec un des tutoriels de ce site : <a href="http://www.siteduzero.com/tutoriel-3-34984-utiliser-l-api-mysql-dans-vos-programmes.html">Utiliser l'API MySQL dans vos programmes</a>.</p><p id="r-531010" data-claire-element-id="531010"><em>Ce tutoriel a été inspiré du tutoriel « <a href="http://www.siteduzero.com/tutoriel-3-39020-apercu-de-la-cgi-avec-python.html">Aperçu de la CGI avec Python</a> » de <a href="http://www.siteduzero.com/membres-294-5223.html">Krankkatze</a> que je remercie d'ailleurs pour ses conseils.<br/> Je tiens aussi à remercier <a href="http://www.siteduzero.com/membres-294-114016.html">coyotte508</a>, <a href="http://www.siteduzero.com/membres-294-24987.html">gnomnain</a>, <a href="http://www.siteduzero.com/membres-294-3160.html">Yno</a>, <a href="http://www.siteduzero.com/membres-294-122546.html">shareman</a> et le canal IRC ##hippie sur Freenode pour leur aide plus ou moins grande dans les codes de ce tutoriel.</em></p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi">Écrivez votre site web en C avec la CGI</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/preparation-22">
Préparation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/premier-script">
Premier script
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/un-compteur-de-visites">
Un compteur de visites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/traiter-les-donnees-d-un-formulaire">
Traiter les données d&#039;un formulaire
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/exercice-un-livre-d-or">
[Exercice] Un livre d&#039;or
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/ecrivez-votre-site-web-en-c-avec-la-cgi/traiter-les-donnees-d-un-formulaire">
<span class="arrow"></span>
<span class="next">Traiter les données d&#039;un formulaire</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/ecrivez-votre-site-web-en-c-avec-la-cgi.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 06:50:45 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/ecrivez-votre-site-web-en-c-avec-la-cgi.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:14:35 GMT -->
</html>