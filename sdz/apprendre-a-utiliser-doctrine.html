<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/apprendre-a-utiliser-doctrine.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 11:23:59 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/apprendre-a-utiliser-doctrine.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:50:25 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Apprendre à utiliser Doctrine</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/apprendre-a-utiliser-doctrine.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Apprendre à utiliser Doctrine</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#ApprendreutiliserDoctrine">Apprendre à utiliser Doctrine</a><br/><a href="#Prsentationetinstallation">Présentation et installation</a><br/><a href="#Doctrinec039estquoi">Doctrine, c&#039;est quoi ?</a><br/><a href="#Installation">Installation</a><br/><a href="#Configurationdelabasededonnes">Configuration de la base de données</a><br/><a href="#Connexion">Connexion</a><br/><a href="#SchmadedonnesYaml">Schéma de données (Yaml)</a><br/><a href="#SchmadedonnesPHP">Schéma de données (PHP)</a><br/><a href="#Gnrationdestablesetmodles">Génération des tables et modèles</a><br/><a href="#Manipulationdesdonnesstockesdanslabase">Manipulation des données stockées dans la base</a><br/><a href="#Utilisationdesobjetsetcollections">Utilisation des objets et collections</a><br/><a href="#LelangageDQL">Le langage DQL</a><br/><a href="#Utilitdesclassesdetables">Utilité des classes de tables</a><br/><a href="#TPCrationd039unCRUD">TP : Création d&#039;un CRUD</a><br/><a href="#Prparationduterrain">Préparation du terrain</a><br/><a href="#Affichagededonnes">Affichage de données</a><br/><a href="#Crationd039objets">Création d&#039;objets</a><br/><a href="#Modificationd039objets">Modification d&#039;objets</a><br/><a href="#Suppressiondedonnes">Suppression de données</a><br/><a href="#LesEventsListeners">Les Events Listeners</a><br/><a href="#IntroductionauxEventsListeners">Introduction aux Events Listeners</a><br/><a href="#Listenerdeconnexion">Listener de connexion</a><br/><a href="#Listenersd039objets">Listeners d&#039;objets</a><br/><a href="#Informationssupplmentaires">Informations supplémentaires</a><br/><a href="#Lestemplates">Les templates</a><br/><a href="#Introduction">Introduction</a><br/><a href="#Utilisationdestemplates">Utilisation des templates</a><br/><a href="#Structured039untemplate">Structure d&#039;un template</a><br/><a href="#TPCrationd039untemplate">TP : Création d&#039;un template</a><br/><a href="#Crersonpropretemplate">Créer son propre template</a><br/><a href="#Correctionletemplate">Correction : le template</a><br/><a href="#Correctionlelistener">Correction : le listener</a><br/><a href="#Conclusion">Conclusion</a><br/><a href="#Personnalisation">Personnalisation</a><br/><a href="#AvecDoctrine_Manager">Avec Doctrine_Manager</a><br/></div>
<a name="ApprendreutiliserDoctrine"></a><h2>Apprendre à utiliser Doctrine</h2><div class="content" role="article">
<p id="r-772442" data-claire-element-id="772442">Bienvenue à tous dans ce tutoriel. :)</p><p id="r-772443" data-claire-element-id="772443">Je vais vous présenter ici un ORM pour PHP : Doctrine.<br/> Si vous ne savez pas ce qu'est un ORM, ça tombe bien, je vous explique tout cela juste après. ;)</p><p id="r-772444" data-claire-element-id="772444"><strong>Connaissances requises</strong><br/> Pour suivre ce tuto, il est nécessaire :</p><ul id="r-772453" data-claire-element-id="772453"><li id="r-772446" data-claire-element-id="772446"><p id="r-772445" data-claire-element-id="772445">de bien connaître PHP et la POO ;</p></li><li id="r-772448" data-claire-element-id="772448"><p id="r-772447" data-claire-element-id="772447">de savoir comment fonctionnent les relations dans une base de données (au moins basiquement) ;</p></li><li id="r-772450" data-claire-element-id="772450"><p id="r-772449" data-claire-element-id="772449">d'avoir un serveur avec PHP 5.2.3 minimum ;</p></li><li id="r-772452" data-claire-element-id="772452"><p id="r-772451" data-claire-element-id="772451">et... d'avoir du temps libre !</p></li></ul><p id="r-772454" data-claire-element-id="772454">En effet, Doctrine est vraiment TRÈS complet, et on ne pourra de toute façon pas tout voir dans ce tutoriel.<br/> Si vous ne connaissez pas la POO, arrêtez-vous là ! ^^ Je vous conseille d'aller faire un tour sur <a href="http://www.siteduzero.com/tutoriel-3-147180-la-programmation-orientee-objet-en-php.html">le tuto de vyk12</a>. Revenez juste après, vous verrez, ça vaut le coup. ;)</p><p id="r-772455" data-claire-element-id="772455">Je vous recommande également de savoir, en gros, ce qu'est l'architecture MVC. Si vous ne la connaissez pas, ce n'est pas dramatique, vous comprendrez comment on organise notre projet au fur et à mesure du tutoriel.</p><p id="r-772456" data-claire-element-id="772456"><strong>Remerciements</strong><br/> Avant de commencer, je souhaite remercier les personnes qui ont contribué à ce tuto, m'ont donné des idées, des conseils, notamment <a href="http://www.siteduzero.com/membres-294-73474.html">Nami Doc</a>. ;)</p><aside id="r-772458" data-claire-element-id="772458" data-claire-semantic="information"><p id="r-772457" data-claire-element-id="772457">La version que j'utiliserai et expliquerai dans ce tutoriel est la version 1.2. Il est possible que je mette à jour le tutoriel lorsque la version 2 sortira en version stable.</p></aside>
</div>
<div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1358423835269-0" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1358423835269-0');
        });
    }
    </script>
</div><a name="Prsentationetinstallation"></a><h2>Présentation et installation</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
<span class="next">Doctrine, c&#039;est quoi ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-772472" data-claire-element-id="772472">Tout d'abord, nous allons voir ce qu'est Doctrine, puis nous l'installerons, pour pouvoir commencer à coder un peu, quand même. :p</p><p id="r-772473" data-claire-element-id="772473">Attention, je vous préviens, je ne serai pas aussi direct que dans <a href="http://www.siteduzero.com/tutoriel-3-197048-utilisation-d-un-orm-les-bases-de-doctrine.html">le tuto de christophetd</a>. Je passerai plus de temps à vous faire découvrir le fonctionnement interne de Doctrine.<br/> Si vous voulez commencer à coder tout de suite, allez voir le sien, il est relativement bien fait pour commencer rapidement. <br/> Si vous souhaitez en savoir un peu plus, et apprendre à bien utiliser Doctrine et pouvoir l'étendre et le personnaliser ensuite (<em>behaviors</em>, et tout ça ! ^^ ), restez ici. ;)</p>
</div><a name="Doctrinec039estquoi"></a><h2>Doctrine, c&#039;est quoi ?</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">
<span class="arrow"></span>
<span class="next">Présentation et installation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
<span class="next">Installation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-772474" data-claire-element-id="772474">Doctrine est un ORM, pour <em>object-relational mapping</em>, soit mapping objet-relationnel en français.</p><div id="r-772476" data-claire-element-id="772476" data-claire-semantic="question"><p id="r-772475" data-claire-element-id="772475">Attends, euh... c'est quoi un ORM ???</p></div><p id="r-772477" data-claire-element-id="772477">Un ORM, c'est en quelque sorte une interface entre votre base de données et vous. Il s'agit d'un ensemble de classes (ou « <em>bibliothèques</em> ») qui fonctionne de manière indépendante. Le but est de nous permettre d'accéder au contenu de la base de données avec un langage orienté objet (PHP en l'occurrence).</p><aside id="r-772479" data-claire-element-id="772479" data-claire-semantic="information"><p id="r-772478" data-claire-element-id="772478">Pour ceux qui ont déjà entendu parler de <a href="http://www.symfony-project.org/">Symfony</a>, sachez que Doctrine est dorénavant l'ORM intégré par défaut.</p></aside><p id="r-772480" data-claire-element-id="772480">Pour comprendre concrètement comment Doctrine fonctionne, voyons un exemple. Imaginons que l'on possède une table contenant des articles, avec un titre, un contenu et une certaine catégorie. On pourra y accéder avec un objet Article en PHP :</p><pre id="r-772481" data-claire-element-id="772481"><code data-claire-semantic="html+php">&lt;?php
$article = new Article();
$article-&gt;title     = 'Tutoriel Doctrine';
$article-&gt;content   = 'blablabla...';
$article-&gt;categorie = $monObjetCategorie;
$article-&gt;save();</code></pre><p id="r-772482" data-claire-element-id="772482">Et voilà !<br/> En quelques lignes, nous avons créé un objet article, l'avons rempli avec des données, et l'avons sauvegardé. Et c'est tout. Doctrine se charge tout seul d'insérer ces données dans les champs de notre table, on ne touche pas au code SQL.</p><p id="r-772483" data-claire-element-id="772483">Et c'est l'un des gros avantages d'un ORM : si vous déplacez votre projet sur un autre serveur, avec un autre SGBD, vous n'aurez pas à vous soucier des différences qu'il peut y avoir entre les langages. En effet, Doctrine repose sur <strong>PDO </strong>et supporte les mêmes drivers. Vous n'aurez pas non plus à écrire les classes (par exemple <code>Categorie</code> ou <code>Article</code>) vous-même, elles sont générées automatiquement. Ce qui ne veut pas dire qu'on ne pourra pas les personnaliser, bien au contraire.</p><p id="r-772484" data-claire-element-id="772484">Voici un schéma pour comprendre rapidement comment Doctrine s'articule :</p><figure id="r-772486" data-claire-element-id="772487"><img id="r-772485" data-claire-element-id="772485" src="medias/uploads.siteduzero.com_files_242001_243000_242089.png" alt="Image utilisateur"/></figure><p id="r-772488" data-claire-element-id="772488">Doctrine est constitué de deux couches distinctes :</p><ul id="r-772493" data-claire-element-id="772493"><li id="r-772490" data-claire-element-id="772490"><p id="r-772489" data-claire-element-id="772489">Je vous l'ai dit, l'une repose sur PDO, à laquelle elle ajoute des fonctionnalités, c'est ce qui s'appelle la DBAL : <em>Database Abstraction Layer</em>. Elle pourrait s'utiliser directement, sans la couche ORM. Son but, comme son nom l'indique, est de fournir une couche d'abstraction, c'est-à-dire que grâce à elle, on ne se soucie plus de comment fonctionne notre base de données. À ce niveau-là, on n'utilise pas encore de langage-objet.</p></li><li id="r-772492" data-claire-element-id="772492"><p id="r-772491" data-claire-element-id="772491">La deuxième couche (ORM, donc) permet de faire le « lien » entre nos objets PHP et la DBAL, c'est ce qui nous fournit une interface orientée objet pour manipuler la base de données. Elle interagit avec la <em>DBAL</em> et nous retourne des résultats sous forme d'objets.</p></li></ul><p id="r-772494" data-claire-element-id="772494">Ne faites pas de confusion avec PDO : j'ai parlé d'<em>abstraction</em> dans le schéma, mais PDO ne propose pas d'abstraction de la base de données. Elle fournit simplement des fonctions communes, peu importe le SGBD, mais il faut quand même se plier au langage « local ».</p><p id="r-772495" data-claire-element-id="772495">Bon assez bavardé, je suppose que vous êtes tous impatients de l'installer ! Comment ça, non ? :p</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">
<span class="arrow"></span>
<span class="next">Présentation et installation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
<span class="next">Installation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Installation"></a><h2>Installation</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
<span class="arrow"></span>
<span class="next">Doctrine, c&#039;est quoi ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">
<span class="next">Configuration de la base de données</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-telechargement-29" data-claire-element-id="772504">Téléchargement</h2><p id="r-772497" data-claire-element-id="772497">Ici, je vais seulement vous montrer la manière la plus simple et accessible à tout le monde pour installer Doctrine.</p><p id="r-772498" data-claire-element-id="772498">Commencez par télécharger le <strong>package .tgz</strong> ici : <a href="http://www.doctrine-project.org/projects/orm/download">http://www.doctrine-project.org/projects/orm/download</a>. La dernière version stable à l'heure où j'écris ces lignes est la <strong>1.2.2</strong>. Pour extraire l'archive, utilisez un logiciel comme 7zip ou Winrar.</p><aside id="r-772500" data-claire-element-id="772500" data-claire-semantic="information"><p id="r-772499" data-claire-element-id="772499">Si vous souhaitez l'installer via SVN ou PEAR, je vous renvoie à la <a href="http://www.doctrine-project.org/documentation/manual/1_2/en/getting-started#installing">documentation en ligne</a> (<em>in english</em>). Mais nous ne nous attarderons pas là-dessus. Notez tout de même qu'il existe un <a href="http://www.siteduzero.com/tutoriel-3-2696-gerez-vos-projets-a-l-aide-du-gestionnaire-de-versions-subversion.html">tuto sur SVN</a> sur le Site du Zéro.</p></aside><p id="r-772501" data-claire-element-id="772501">À la racine de votre projet, créez un répertoire <code>~/lib/</code>. Nous placerons ici toutes nos classes. Nos classes de modèles seront placées dans <code>~/lib/models/</code>.</p><p id="r-772502" data-claire-element-id="772502">Placez le contenu du dossier <em>&lt;Archive&gt;</em>/Doctrine-1.2.2/lib/ que vous venez de télécharger, dans ~/lib/vendor/doctrine/ (que vous créez pour l'occasion ;) ).</p><p id="r-772503" data-claire-element-id="772503">Profitons-en pour créer aussi un répertoire <code>~/web/</code> à la racine. Tous les fichiers destinés à être vus par le visiteur seront placés ici.<br/><strong>J'insiste</strong> sur le fait que la racine Web est <code>~/web/</code>. C'est une bonne habitude à prendre de ne pas laisser vos sources librement accessibles. Ne mettez dans ce dossier Web que le strict nécessaire, notamment vos images, feuilles de style, javascript, etc.</p><h2 id="r-implementation-dans-notre-projet" data-claire-element-id="772524">Implémentation dans notre projet</h2><p id="r-772505" data-claire-element-id="772505">Doctrine peut inclure les fichiers contenant nos classes automatiquement, nous n'aurons pas à faire d'include() ou require() manuellement.<br/> Pour cela, il va falloir ajouter quelques lignes de configuration à votre projet. Créez un fichier <code>~/config/global.php</code>.</p><p id="r-772506" data-claire-element-id="772506">Tout d'abord, définissons quelques constantes et incluons la classe de base de Doctrine :</p><pre id="r-772507" data-claire-element-id="772507"><code data-claire-semantic="html+php">&lt;?php 
// Adaptez bien sûr le DSN à votre cas
define('CFG_DB_DSN', 'mysql://root@localhost/db_doctrine_test');

define('LIB_DIR',  dirname(__FILE__).'/../lib/');
define('CFG_DIR',  dirname(__FILE__).'/');
define('WEB_DIR',  dirname(__FILE__).'/../web/');
define('HTML_DIR', dirname(__FILE__).'/../html/');

require_once(LIB_DIR.'vendor/doctrine/Doctrine.php');
spl_autoload_register(array('Doctrine_Core', 'autoload'));</code></pre><p id="r-772508" data-claire-element-id="772508">Concernant la base de données, il est préférable (et je vous l'ordonne ! ^^ ) de dédier complètement une base de données à Doctrine. Cela permettra de laisser Doctrine s'occuper de toute la configuration. Si vous ne lui dédiez pas de base de données, il pourrait y avoir des interactions non désirées avec vos autres projets.</p><p id="r-772509" data-claire-element-id="772509">Nous enregistrons aussi l'autoloader de Doctrine avec <code>spl_autoload_register()</code>. C'est celui-ci qui va s'occuper d'inclure les fichiers contenant les classes pour nous.</p><div id="r-772511" data-claire-element-id="772511" data-claire-semantic="question"><p id="r-772510" data-claire-element-id="772510">Waaaa, c'est génial ! Comment ça marche ?</p></div><p id="r-772512" data-claire-element-id="772512">En fait, c'est assez simple. Pour commencer, l'autoloader (<code>Doctrine_Core::autoload()</code>) sera appelé par PHP à chaque fois qu'une classe non définie sera utilisée, avec en paramètre le nom de cette classe. C'est à cette fonction de se débrouiller ensuite pour faire les <code>include()</code> ou <code>require()</code> nécessaires.</p><p id="r-772513" data-claire-element-id="772513">Pour trouver où sont rangés ces fichiers, une convention de Doctrine est que le nom des classes indique aussi où elles sont situées : il suffit de remplacer les _ par des / et on obtient le chemin du fichier (relatif par rapport au dossier contenant Doctrine). Par exemple, la classe <code>Doctrine_Record_Abstract</code> est située dans <code>~/lib/vendor/doctrine/Doctrine/Record/Abstract.php</code>. À noter que Doctrine ne nomme pas les fichiers contenant des classes avec l'extension <code>.class.php</code>.</p><p id="r-772514" data-claire-element-id="772514">Cependant, il y a une exception pour les fichiers contenant nos modèles, et Doctrine les inclura toujours (<code>~/lib/models/</code>).</p><aside id="r-772516" data-claire-element-id="772516" data-claire-semantic="information"><p id="r-772515" data-claire-element-id="772515">Si vous êtes curieux et avez ouvert le fichier Doctrine.php, vous avez dû vous apercevoir que la classe Doctrine est vide ! En fait, elle hérite de Doctrine_Core. Je vous recommande d'utiliser Doctrine_Core par la suite, Doctrine.php étant là uniquement pour la rétro-compatibilité.</p></aside><p id="r-772517" data-claire-element-id="772517">Avant de conclure, je vais faire un petit point sur l'organisation du projet que nous allons utiliser pour suivre ce tutoriel.<br/> Je vous ai brièvement parlé de MVC en introduction. Cependant, pour ce tutoriel, il ne sera pas toujours nécessaire de le respecter, et pour ne pas compliquer la compréhension de ceux qui ne connaissent pas cette architecture, il m'arrivera parfois de ne pas suivre le pattern MVC à la lettre.<br/> Je vous conseille la lecture de l'un des tutoriels présents sur ce site, par exemple <a href="http://www.siteduzero.com/tutoriel-3-88620-votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques.html">celui de Savageman</a>, si voulez en savoir plus sur le sujet.<br/> Vous êtes bien sûr libres d'intégrer directement à votre projet les exemples que je vous donnerai. ;)</p><p id="r-772518" data-claire-element-id="772518">Avant d'entrer dans le vif du sujet, créez le fichier <code>~/web/index.php</code> et placez-y les lignes suivantes pour vérifier que Doctrine est bien installé :</p><pre id="r-772519" data-claire-element-id="772519"><code data-claire-semantic="html+php">&lt;?php
require_once(dirname(__FILE__).'/../config/global.php');

echo Doctrine_Core::getPath();</code></pre><p id="r-772520" data-claire-element-id="772520">Si le chemin vers Doctrine s'affiche, c'est bon. ;) Sinon, reprenez depuis le début, mais il ne devrait pas y avoir de problème à ce stade-là.</p><aside id="r-772522" data-claire-element-id="772522" data-claire-semantic="warning"><p id="r-772521" data-claire-element-id="772521">Rappelez-vous bien que le fichier <strong>global.php</strong> devra être inclus dans tous vos fichiers !</p></aside><p id="r-772523" data-claire-element-id="772523">Voilà voilà, le projet est maintenant opérationnel. Dans la partie suivante nous allons pouvoir nous connecter à la base de données. :)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
<span class="arrow"></span>
<span class="next">Doctrine, c&#039;est quoi ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">
<span class="next">Configuration de la base de données</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Configurationdelabasededonnes"></a><h2>Configuration de la base de données</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
<span class="arrow"></span>
<span class="next">Installation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
<span class="next">Connexion</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-772527" data-claire-element-id="772527">Nous allons maintenant voir comment nous connecter avec la base de données, puis configurer nos tables.</p>
</div><a name="Connexion"></a><h2>Connexion</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">
<span class="arrow"></span>
<span class="next">Configuration de la base de données</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
<span class="next">Schéma de données (Yaml)</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-la-classe-doctrine-manager" data-claire-element-id="772534">La classe Doctrine_Manager</h2><p id="r-772528" data-claire-element-id="772528">Toutes les connexions à la base de données sont gérées par un objet <code>Doctrine_Manager</code>.<br/><code>Doctrine_Manager</code> est un singleton, cela signifie qu'il ne peut y en avoir qu'une seule instance à la fois dans votre projet. Si vous êtes allés farfouiller dans <code>~/lib/vendor/doctrine/Doctrine/Manager.php</code> (ce que je vous encourage toujours à faire ;) ), vous avez pu vous apercevoir que la méthode <code>__construct()</code> est privée : on ne pourra donc pas faire de <code data-claire-semantic="html+php">&lt;?php new Doctrine_Manager(); ?&gt;</code>.</p><div id="r-772530" data-claire-element-id="772530" data-claire-semantic="question"><p id="r-772529" data-claire-element-id="772529">Mais alors, pourquoi tu nous parles de cette classe si elle ne sert à rien ? o_O</p></div><p id="r-772531" data-claire-element-id="772531">Je m'attarde un peu là-dessus, parce que c'est le principe du singleton : on ne peut pas instancier des objets comme on veut. On va donc utiliser une méthode statique : <code>Doctrine_Manager::getInstance()</code>. C'est elle qui va nous retourner un nouvel objet ; et l'intérêt est qu'elle nous retournera toujours le même, au lieu d'en créer un à chaque fois. Nous n'avons en effet pas besoin d'utiliser plusieurs objets Doctrine_Manager.</p><aside id="r-772533" data-claire-element-id="772533" data-claire-semantic="information"><p id="r-772532" data-claire-element-id="772532">Doctrine_Manager nous permet de configurer de nombreuses options, mais nous reviendrons dessus au fur et à mesure du tutoriel. Il y a aussi une partie en annexe qui récapitule tout ça.</p></aside><h2 id="r-connexion-a-la-base-de-donnees-3" data-claire-element-id="772540">Connexion à la base de données</h2><p id="r-772535" data-claire-element-id="772535">Doctrine_Manager possède une méthode statique <em>connection()</em>. Cette méthode prend en paramètre un DSN, du même format que PDO (par exemple, <code>mysql://root:@localhost/db_doctrine_test</code>) et nous retourne un objet connexion. Un DSN doit être de la forme <strong>SGBD</strong>://<strong>utilisateur</strong>:<strong>motdepasse</strong>@<strong>serveur</strong>/<strong>nomdelabasededonnées</strong>.</p><p id="r-772536" data-claire-element-id="772536">Modifions le fichier <code>~/config/global.php</code> :</p><pre id="r-772537" data-claire-element-id="772537"><code data-claire-semantic="html+php">&lt;?php 
// Adaptez bien sûr le DSN à votre cas.
define('CFG_DB_DSN', 'mysql://root@localhost/db_doctrine_test');

define('LIB_DIR',  dirname(__FILE__).'/../lib/');
define('CFG_DIR',  dirname(__FILE__).'/');
define('WEB_DIR',  dirname(__FILE__).'/../web/');
define('HTML_DIR', dirname(__FILE__).'/../html/');

require_once(LIB_DIR.'vendor/doctrine/Doctrine.php');
spl_autoload_register(array('Doctrine_Core', 'autoload'));

$conn = Doctrine_Manager::connection(CFG_DB_DSN);</code></pre><aside id="r-772539" data-claire-element-id="772539" data-claire-semantic="information"><p id="r-772538" data-claire-element-id="772538">Note : Doctrine_Manager peut prendre en charge plusieurs connexions à différentes bases de données. Il est conseillé pour cela d'affecter explicitement un label aux connexions créées : <code>Doctrine_Manager::connection('dsn', 'label');</code>. Il est possible ensuite de les récupérer avec <code>Doctrine_Manager::getConnection('label');</code>.</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">
<span class="arrow"></span>
<span class="next">Configuration de la base de données</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
<span class="next">Schéma de données (Yaml)</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="SchmadedonnesYaml"></a><h2>Schéma de données (Yaml)</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
<span class="arrow"></span>
<span class="next">Connexion</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
<span class="next">Schéma de données (PHP)</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-772542" data-claire-element-id="772542">Petite surprise : on va apprendre un nouveau langage. :) Mais pas de panique, c'est un langage très simple, utilisé pour définir le schéma de données de Doctrine.</p><h2 id="r-le-langage-yaml" data-claire-element-id="772564">Le langage Yaml</h2><p id="r-772543" data-claire-element-id="772543">Ce langage est un langage de description, un peu comme le XML, mais moins lourd. Pour info, YAML est un acronyme récursif, tout comme PHP, et signifie <em>YAML Ain't Markup Language</em>.</p><p id="r-772544" data-claire-element-id="772544">Comme vous allez le voir, la syntaxe du Yaml repose presque uniquement sur l'indentation du code. Attention, quelque chose de très important : l'indentation doit se faire <strong>UNIQUEMENT AVEC DES ESPACES</strong>, jamais avec des tabulations.</p><p id="r-772545" data-claire-element-id="772545">Le langage repose sur ces règles principales :</p><ul id="r-772562" data-claire-element-id="772562"><li id="r-772547" data-claire-element-id="772547"><p id="r-772546" data-claire-element-id="772546">Les nombres (entiers, flottants, etc.) sont écrits naturellement.</p></li><li id="r-772549" data-claire-element-id="772549"><p id="r-772548" data-claire-element-id="772548">La valeur Null peut être indiquée avec <code>null</code> ou <code>~</code>.</p></li><li id="r-772551" data-claire-element-id="772551"><p id="r-772550" data-claire-element-id="772550">Les booléens sont exprimés par <code>true</code> ou <code>false</code>.</p></li><li id="r-772553" data-claire-element-id="772553"><p id="r-772552" data-claire-element-id="772552">Les dates sont écrites au format <a href="http://fr.wikipedia.org/wiki/ISO_8601">ISO-8601</a>, c'est-à-dire, par exemple, <code>2010-06-03 23:30:53</code>.</p></li><li id="r-772555" data-claire-element-id="772555"><p id="r-772554" data-claire-element-id="772554">Les chaînes de caractères peuvent être écrites sans délimiteurs, délimitées par des simple quotes ('), ou par des doubles quotes (&quot;). Lorsque la chaîne s'étend sur plusieurs lignes, il faut utiliser le symbole pipe <strong>|</strong> pour l'indiquer.</p></li><li id="r-772557" data-claire-element-id="772557"><p id="r-772556" data-claire-element-id="772556">Les paires clé/valeur sont séparées par ':'.</p></li><li id="r-772559" data-claire-element-id="772559"><p id="r-772558" data-claire-element-id="772558">Plutôt que l'indentation, on peut utiliser les symboles [] et {} pour indiquer explicitement un tableau, par exemple, <code>tableau: { cle: valeur, cle2: valeur2 }</code>. Les accolades indiquent des paires clé/valeur, les crochets indiquent simplement des valeurs. Par exemple : <code>tableau: [valeur1, valeur2, valeur3]</code>.</p></li><li id="r-772561" data-claire-element-id="772561"><p id="r-772560" data-claire-element-id="772560">Les commentaires sont indiqués par <code>#</code>. Toute ligne contenant un # devient commentaire sur le reste de la ligne.</p></li></ul><p id="r-772563" data-claire-element-id="772563">Ces règles sont très intuitives, voyez par vous-mêmes.</p><h2 id="r-le-schema-3" data-claire-element-id="772582">Le schéma</h2><p id="r-772565" data-claire-element-id="772565">Voyons tout de suite le schéma que j'utiliserai dans la suite de ce tutoriel. Nous placerons tout ceci dans le fichier ~/config/schema.yml :</p><pre id="r-772566" data-claire-element-id="772566"><code># Cela représentera nos articles :
Article:
  columns:
    title:
      type: string(255)
      notnull: true
    content:
      type: string
      notnull: true
    user_id:
      type: integer
  relations:
    User:
      class: User
      local: user_id
      foreign: id
      alias: User # Inutile, puisque l'alias par défaut est le nom de la classe.
      foreignAlias: Articles

# Et là les utilisateurs :
User:
  tableName: member
  columns:
    login:
      type: string(255)
      unique: true
      notnull: true
    password:
      type: string(255)
      notnull: true</code></pre><p id="r-772567" data-claire-element-id="772567">Détaillons maintenant le schéma ci-dessus. Les clés de premier niveau représentent nos classes (<code>Article</code> et <code>User</code>). Chaque classe sera représentée par une table dans la base de données. Doctrine déduit automatiquement le nom de la table, si on ne spécifie pas l'option <code>tableName</code>.<br/> À l'intérieur, on retrouve les clés <code>columns</code> (qui contient la définition des colonnes de la table) et <code>relations</code> (qui définit les relations entre les tables).</p><h3 id="r-les-colonnes-3" data-claire-element-id="772578">Les colonnes</h3><p id="r-772568" data-claire-element-id="772568">Chaque colonne accepte plusieurs options, dont :</p><ul id="r-772575" data-claire-element-id="772575"><li id="r-772570" data-claire-element-id="772570"><p id="r-772569" data-claire-element-id="772569"><code>type</code> : un des types suivants : <code>boolean, integer, float, decimal, string, blob, clob, timestamp, time, date, enum, gzip, array, object</code>. Doctrine adapte ensuite le type utilisé dans la base de données selon ce que le SGBD supporte ;</p></li><li id="r-772572" data-claire-element-id="772572"><p id="r-772571" data-claire-element-id="772571"><code>notnull</code> : indique si le champ peut être vide ou s'il doit toujours contenir une valeur (<code>true</code> ou <code>false</code>) ;</p></li><li id="r-772574" data-claire-element-id="772574"><p id="r-772573" data-claire-element-id="772573"><code>unique</code> : indique si le champ doit être unique ou non (<code>true</code> ou <code>false</code>).</p></li></ul><aside id="r-772577" data-claire-element-id="772577" data-claire-semantic="information"><p id="r-772576" data-claire-element-id="772576">Vous avez dû remarquer que l'on peut indiquer comme type <code>array</code> ou <code>object</code> ; or, ces types n'existent pas dans un SGBD classique. En fait, Doctrine va s'occuper de sérialiser/désérialiser automatiquement la valeur de ces champs. Ils sont utiles lorsque l'on veut éviter de créer une table supplémentaire avec des relations, parfois un peu lourdes à gérer pour pas grand-chose.</p></aside><h3 id="r-les-relations-1" data-claire-element-id="772581">Les relations</h3><p id="r-772579" data-claire-element-id="772579">Il y a plusieurs manières de définir les relations. Ici, nous sommes partis de l'objet Article et avons indiqué qu'ils ont un auteur. Nous aurions aussi pu indiquer cette relation à partir de l'objet User et indiquer que chacun peut posséder plusieurs articles.</p><p id="r-772580" data-claire-element-id="772580">Nous commençons par donner un nom à notre relation ('User'). La classe étrangère est indiquée par <code>class</code>. L'identifiant local est spécifié par <code>local</code>, et l'identifiant étranger par <code>foreign</code>. Doctrine nous donne la possibilité de donner des alias avec <code>alias</code> et <code>foreignAlias</code>. Ceci nous permettra d'utiliser ensuite : <code data-claire-semantic="html+php">&lt;?php $article-&gt;AliasPourUser-&gt;login</code>.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
<span class="arrow"></span>
<span class="next">Connexion</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
<span class="next">Schéma de données (PHP)</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="SchmadedonnesPHP"></a><h2>Schéma de données (PHP)</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
<span class="arrow"></span>
<span class="next">Schéma de données (Yaml)</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
<span class="next">Génération des tables et modèles</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-772584" data-claire-element-id="772584">Le langage Yaml n'est en fait qu'une manière alternative de définir notre modèle. Doctrine le traduit ensuite en PHP ; mais nous pouvons bien entendu écrire directement tout cela en PHP.</p><h2 id="r-les-classes-de-modele" data-claire-element-id="772595">Les classes de modèle</h2><p id="r-772585" data-claire-element-id="772585">Voyons l'équivalent du schéma précédent :</p><pre id="r-772586" data-claire-element-id="772586"><code data-claire-semantic="html+php">&lt;?php
class BaseArticle extends Doctrine_Record
{
    public function setTableDefinition()
    {
        $this-&gt;hasColumn('title',   'string',  255,  array('notnull' =&gt; true));
        $this-&gt;hasColumn('content', 'string',  null, array('notnull' =&gt; true));
        $this-&gt;hasColumn('user_id', 'integer', null, array());
    }

    public function setUp()
    {
        $this-&gt;hasOne('User as User', array('local' =&gt; 'user_id', 'foreign' =&gt; 'id'));
        // Même remarque que pour l'alias ici : il s'agit par défaut du nom de la classe, donc il est inutile
        // de préciser 'as User'.
    }
}</code></pre><pre id="r-772587" data-claire-element-id="772587"><code data-claire-semantic="html+php">&lt;?php
class BaseUser extends Doctrine_Record
{
    public function setTableDefinition()
    {
        $this-&gt;setTableName('member');
        $this-&gt;hasColumn('login', 'string', 255, array('unique' =&gt; true, 'notnull' =&gt; true));
        $this-&gt;hasColumn('password', 'string', 255, array('notnull' =&gt; true));
    }

    public function setUp()
    {
        $this-&gt;hasMany('Article as Articles', array('local' =&gt; 'id', 'foreign' =&gt; 'user_id'));
    }
}</code></pre><p id="r-772588" data-claire-element-id="772588">La méthode <code>hasColumn()</code> permet de définir les colonnes ; elle prend en argument le nom, le type, la longueur, et les options supplémentaires. Les méthodes <code>hasOne()</code> / <code>hasMany()</code> permettent de définir les relations ; avec en argument le nom du modèle et éventuellement un alias, et les options.</p><h3 id="r-l-heritage-des-classes-de-base" data-claire-element-id="772594">L'héritage des classes de base</h3><p id="r-772589" data-claire-element-id="772589"><strong>Lisez bien ceci, c'est important.</strong><br/> Vous avez vu que nous avons appelé nos classes BaseArticle et BaseUser et que nous les avons placées dans le dossier generated/. Ceci est peu important si vous écrivez le PHP à la main, et vous pouvez directement nommer vos classes Article et User. Je le fais pour que dans la suite du tuto, la configuration du projet soit la même, peu importe la méthode que vous avez choisie.</p><div id="r-772591" data-claire-element-id="772591" data-claire-semantic="question"><p id="r-772590" data-claire-element-id="772590">Je ne comprends toujours pas l'utilité de ces classes « BaseMachin » moi...</p></div><p id="r-772592" data-claire-element-id="772592">Lorsque nous demanderons à Doctrine de les générer automatiquement à partir du Yaml, Doctrine aura besoin de recréer ces fichiers. Pour ne pas effacer ceux qui nous servent (et que l'on modifiera ensuite), Doctrine génère une classe « intermédiaire », que nous NE MODIFIERONS PAS. Nous modifierons seulement les classes Article et User (qui héritent donc de BaseArticle et BaseUser :-° ).</p><p id="r-772593" data-claire-element-id="772593">Si vous ne comprenez pas tout de suite, ne vous inquiétez pas, je récapitulerai juste après.</p><h2 id="r-les-classes-representant-les-tables" data-claire-element-id="772599">Les classes représentant les tables</h2><p id="r-772596" data-claire-element-id="772596">Si vous décidez d'utiliser le PHP, il vous faudra aussi créer une classe pour chaque table. Elles nous serviront plus tard pour effectuer certaines tâches.</p><pre id="r-772597" data-claire-element-id="772597"><code data-claire-semantic="html+php">&lt;?php
// Fichier ~/lib/models/ArticleTable.php
class ArticleTable extends Doctrine_Table
{ }

// Fichier ~/lib/models/UserTable.php
class UserTable extends Doctrine_Table
{ }</code></pre><p id="r-772598" data-claire-element-id="772598">Vous noterez que nos modèles héritent de <code>Doctrine_Record</code> et que nos tables héritent de <code>Doctrine_Table</code>. Ceci est OBLIGATOIRE ! Les méthodes <code>setTableName()</code>, <code>hasColumn()</code>, <code>hasMany()</code> etc... sont héritées de <code>Doctrine_Record</code>. Allez donc jeter un coup d'oeil au fichier <code>~/lib/vendor/doctrine/Doctrine/Record.php</code>. ;)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
<span class="arrow"></span>
<span class="next">Schéma de données (Yaml)</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
<span class="next">Génération des tables et modèles</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Gnrationdestablesetmodles"></a><h2>Génération des tables et modèles</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
<span class="arrow"></span>
<span class="next">Schéma de données (PHP)</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">
<span class="next">Manipulation des données stockées dans la base</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-772601" data-claire-element-id="772601">Voyons maintenant comment générer automatiquement notre base de données à partir du schéma que nous venons de créer.</p><p id="r-772602" data-claire-element-id="772602">Modifions le fichier <code>~/config/global.php</code> pour correspondre à nos besoins :</p><pre id="r-772603" data-claire-element-id="772603"><code data-claire-semantic="html+php">&lt;?php
// Adaptez bien sûr le DSN à votre cas.
define('CFG_DB_DSN', 'mysql://root@localhost/db_doctrine_test');

define('LIB_DIR',  dirname(__FILE__).'/../lib/');
define('CFG_DIR',  dirname(__FILE__).'/');
define('WEB_DIR',  dirname(__FILE__).'/../web/');
define('HTML_DIR', dirname(__FILE__).'/../html/');

require_once(LIB_DIR.'vendor/doctrine/Doctrine.php');
spl_autoload_register(array('Doctrine_Core', 'autoload'));
spl_autoload_register(array('Doctrine_Core', 'modelsAutoload'));

$manager = Doctrine_Manager::getInstance();
$conn    = Doctrine_Manager::connection(CFG_DB_DSN);

$manager-&gt;setAttribute(Doctrine_Core::ATTR_VALIDATE,               Doctrine_Core::VALIDATE_ALL);
$manager-&gt;setAttribute(Doctrine_Core::ATTR_AUTO_ACCESSOR_OVERRIDE, true);
$manager-&gt;setAttribute(Doctrine_Core::ATTR_AUTOLOAD_TABLE_CLASSES, true);
$manager-&gt;setAttribute(Doctrine_Core::ATTR_MODEL_LOADING,          Doctrine_Core::MODEL_LOADING_CONSERVATIVE);

Doctrine_Core::loadModels(LIB_DIR.'models/');</code></pre><aside id="r-772605" data-claire-element-id="772605" data-claire-semantic="information"><p id="r-772604" data-claire-element-id="772604"><strong>IMPORTANT</strong><br/> Nous ajoutons un autre autoloader (<code>Doctrine_Core::modelsAutoload</code>). Celui-ci se chargera d'inclure les classes de modèles. En effet, l'autoloader basique ne trouve les fichiers que par leur nom (souvenez-vous, je l'ai expliqué en première partie du tuto). Or, les fichiers contenant les modèles ne respectent pas cette règle : souvenez-vous lorsque nous avons défini le schéma. Je vous avais parlé des classes <strong>BaseXXX</strong> : elles sont placées par Doctrine dans un dossier generated/.</p></aside><p id="r-772606" data-claire-element-id="772606">Nous utilisons la méthode <em>setAttribute()</em> de Doctrine_Manager pour personnaliser plusieurs attributs. Je vous invite à vous reporter à la partie Annexes pour une explication détaillée de ces attributs. Sachez simplement que nous définissions le nécessaire pour une utilisation classique, et pour le chargement automatique de tous les fichiers.</p><p id="r-772607" data-claire-element-id="772607">La dernière instruction <code data-claire-semantic="html+php">&lt;?php Doctrine_Core::loadModels(LIB_DIR.'models/')</code> demande d'inclure les modèles se situant dans le dossier indiqué.</p><p id="r-772608" data-claire-element-id="772608">Pour le code des modèles, je vous laisse vous reporter aux chapitres précédents. <br/> Voici les commandes à exécuter pour que Doctrine génère les fichiers de modèle et construise notre base de données :</p><aside id="r-772610" data-claire-element-id="772610" data-claire-semantic="warning"><p id="r-772609" data-claire-element-id="772609">ATTENTION :<br/> Si vous n'avez pas dédié une base de données entière à Doctrine comme je vous l'ai conseillé lors de l'installation, n'exécutez pas <em>Doctrine_Core::dropDatabases()</em> ! Cela efface la base de données avant de la reconstruire. Attention donc aux autres projets partageant la même base de données ! Si vous partagez la base de données avec d'autres applications, vous pouvez simplement supprimer les tables utilisées par Doctrine à la main, ce qui peut vite devenir fastidieux, je vous l'accorde... :-°</p></aside><pre id="r-772611" data-claire-element-id="772611"><code data-claire-semantic="html+php">&lt;?php
require(dirname(__FILE__).'/../config/global.php');

// Si elle existe, supprimez la base existante.
// Attention, cela vide totalement la base de données !
Doctrine_Core::dropDatabases();

// Création de la base (uniquement si elle n'EXISTE PAS)
Doctrine_Core::createDatabases();

// Création des fichiers de modèle à partir du schema.yml
// Si vous n'utilisez pas le Yaml, n'exécutez pas cette ligne !
Doctrine_Core::generateModelsFromYaml(CFG_DIR.'schema.yml', LIB_DIR.'models', array('generateTableClasses' =&gt; true));

// Création des tables
Doctrine_Core::createTablesFromModels(LIB_DIR.'models');</code></pre><p id="r-772612" data-claire-element-id="772612">Lorsque vous appellerez le fichier builder.php, votre base de données et les fichiers des classes BaseXXX seront reconstruits (les autres seront créés s'ils n'existent pas ; s'ils existent déjà, ils ne seront pas modifiés).</p><p id="r-772613" data-claire-element-id="772613">Tout ce fonctionnement <em>automatique</em> peut vous paraître un peu obscur. Exécutez donc le fichier ~/web/builder.php. Je vous laisse maintenant aller jeter un coup d'oeil dans votre base de données et dans le répertoire ~/lib/models/. Un dossier generated/ y a été créé, ainsi que les classes <strong>BaseXXX</strong>. Notez que les classes « normales » (c'est-à-dire <strong>Article</strong>, <strong>User</strong>, <strong>ArticleTable</strong> et <strong>UserTable</strong>) ont été créées parce qu'elles n'existaient pas. Par la suite, si vous régénérez à nouveau tout cela, elles ne seront plus modifiées. C'est donc dans celles-ci que nous travaillerons.</p><p id="r-772614" data-claire-element-id="772614">Pour finir, notez que j'ai indiqué ici (en Yaml et en PHP) les options les plus utilisées, mais il en existe d'autres et je vous les montrerai au cours du tutoriel.</p><p id="r-772615" data-claire-element-id="772615">Rappelez-moi comment vous faisiez jusqu'ici ? Vous construisiez vos bases de données à la main ? Eh bien maintenant vous pouvez oublier tout ça ! :p <br/>(Oui enfin, ne prenez pas non plus à la lettre tout ce que je peux raconter... ^^ )</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
<span class="arrow"></span>
<span class="next">Schéma de données (PHP)</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">
<span class="next">Manipulation des données stockées dans la base</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Manipulationdesdonnesstockesdanslabase"></a><h2>Manipulation des données stockées dans la base</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
<span class="arrow"></span>
<span class="next">Génération des tables et modèles</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
<span class="next">Utilisation des objets et collections</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-772618" data-claire-element-id="772618">On y arrive enfin !</p><p id="r-772619" data-claire-element-id="772619">J'ai pris le temps de bien vous montrer comment fonctionne Doctrine, car cela me paraît important pour la suite. Ce n'est pas primordial pour l'instant, mais comme je l'ai dit, nous explorerons plus en détail le fonctionnement de Doctrine plus loin dans le tuto. Je commence donc à préparer le terrain. ;)</p><p id="r-772620" data-claire-element-id="772620">On va maintenant pouvoir créer des objets, les modifier, les sauvegarder... Cool, n'est-ce pas ? ;) <br/> Voyons cela tout de suite.</p><aside id="r-772622" data-claire-element-id="772622" data-claire-semantic="information"><p id="r-772621" data-claire-element-id="772621">Ne cherchez pas forcément à tester le code qui suit tout de suite. Le prochain chapitre est consacré à un TP qui vous permettra de mettre tout ça en pratique.</p></aside>
</div><a name="Utilisationdesobjetsetcollections"></a><h2>Utilisation des objets et collections</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">
<span class="arrow"></span>
<span class="next">Manipulation des données stockées dans la base</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
<span class="next">Le langage DQL</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-772623" data-claire-element-id="772623">Vous vous rappelez l'exemple que je vous avais donné au début ?<br/> Et bien, on va utiliser exactement cela.</p><h2 id="r-utilisation-des-objets-1" data-claire-element-id="772652">Utilisation des objets</h2><h3 id="r-creer-un-objet-5" data-claire-element-id="772637">Créer un objet</h3><p id="r-772624" data-claire-element-id="772624">Commençons par créer un nouvel objet :</p><pre id="r-772625" data-claire-element-id="772625"><code data-claire-semantic="html+php">&lt;?php
$article = new Article();</code></pre><p id="r-772626" data-claire-element-id="772626">Doctrine nous fournit plusieurs manières d'accéder aux propriétés de nos objets :</p><pre id="r-772627" data-claire-element-id="772627"><code data-claire-semantic="html+php">&lt;?php
$article-&gt;title = 'Mon titre';
$article['title'] = 'Mon titre';
$article-&gt;set('title', 'Mon titre');

$article-&gt;content = &quot;Contenu de l'article...&quot;;
$article['content'] = &quot;Contenu de l'article...&quot;;
// etc.

// Et on les récupère de la même manière :
echo $article-&gt;title;</code></pre><p id="r-772628" data-claire-element-id="772628">Rien que ça !<br/> Personnellement, j'aime bien utiliser la notation <code>$obj-&gt;title</code>, mais vous faites bien sûr comme vous voulez. ;)</p><aside id="r-772630" data-claire-element-id="772630" data-claire-semantic="information"><p id="r-772629" data-claire-element-id="772629">Si vous utilisez Doctrine par l'intermédiaire de <strong>symfony</strong>, notez que ce dernier ajoute la possibilité d'utiliser des <em>getters</em> et <em>setters</em> (des méthodes commençant par <em>get</em> ou <em>set</em> permettant de récupérer/modifier les attributs) ; par exemple, <code data-claire-semantic="html+php">&lt;?php $obj-&gt;setTitle('mon titre')</code> ou <code data-claire-semantic="html+php">&lt;?php echo $obj-&gt;getContent()</code>.</p></aside><p id="r-772631" data-claire-element-id="772631">Définissons maintenant l'auteur de l'article :</p><pre id="r-772632" data-claire-element-id="772632"><code data-claire-semantic="html+php">&lt;?php
// Création d'un nouvel utilisateur :
$author = new User();
$author-&gt;login = 'Gérard';
$author-&gt;password = 'pass';

// Affectation de cet utilisateur à notre article :
$article-&gt;user_id = $author-&gt;id;
// Ou bien directement :
$article-&gt;User = $author;</code></pre><p id="r-772633" data-claire-element-id="772633">Comme vous le voyez, on peut directement affecter l'auteur, sans indiquer explicitement son id, même si c'est cette valeur qui est stockée dans la base de données. Doctrine s'occupe de tout cela automatiquement pour nous simplifier la tâche. :)</p><p id="r-772634" data-claire-element-id="772634">Pour terminer, on sauvegarde tous les changements effectués sur notre article :</p><pre id="r-772635" data-claire-element-id="772635"><code data-claire-semantic="html+php">&lt;?php
$article-&gt;save();</code></pre><p id="r-772636" data-claire-element-id="772636">N'oubliez pas de sauvegarder ; sans ça, la base de données ne sera pas modifiée ! ^^</p><h3 id="r-recuperer-un-objet" data-claire-element-id="772643">Récupérer un objet</h3><p id="r-772638" data-claire-element-id="772638">C'est là que les classes représentant les tables vont nous être utiles. Doctrine nous fournit plusieurs « finders magiques » :</p><pre id="r-772639" data-claire-element-id="772639"><code data-claire-semantic="html+php">&lt;?php
$table = Doctrine_Core::getTable('Article');

// Récupérer un article avec son id, par exemple $id = 1
$article = $table-&gt;find($id);

// Récupérer un article avec une autre propriété
$article = $table-&gt;findOneByTitle('Mon titre');

// Avec deux propriétés
$article = $table-&gt;findOneByTitleAndContent('Mon titre', &quot;Contenu de l'article...&quot;);

// Avec une relation
$article = $table-&gt;findOneByUser($user);</code></pre><div id="r-772641" data-claire-element-id="772641" data-claire-semantic="question"><p id="r-772640" data-claire-element-id="772640">Comment ça marche ? Je n'ai jamais créé ces méthodes moi ! C'est Doctrine_Table qui les définit ?</p></div><p id="r-772642" data-claire-element-id="772642">Haha, mystère... ^^</p><h3 id="r-magie-magie" data-claire-element-id="772651">Magie, magie...</h3><p id="r-772644" data-claire-element-id="772644">Pour répondre à la question, et bien... oui et non.</p><p id="r-772645" data-claire-element-id="772645">En fait, Doctrine utilise très largement une méthode magique de PHP : <a href="http://www.php.net/manual/fr/language.pseudo-types.php#language.types.mixed">__call()</a>. PHP appelle cette méthode lorsque nous en utilisons une qui n'est pas définie. Ensuite, c'est à l'intérieur de cette méthode que tout le travail est fait.</p><p id="r-772646" data-claire-element-id="772646">Par exemple, en appelant <code>findOneByTitleAndContent(&quot;Mon titre&quot;, &quot;Contenu de l'article...&quot;)</code>, Doctrine va se dire <em>« Tiens, il veut que je lui donne un article dont le titre est &quot;Mon titre&quot; et le contenu est &quot;Contenu de l'article&quot;... »</em>, et exécuter une requête en conséquence. Bon, en réalité, c'est un peu moins magique que ça, et je vous invite à aller voir le détail de cette fonction dans le code de Doctrine (essayez de la retrouver :p ).</p><p id="r-772647" data-claire-element-id="772647">Pendant qu'on y est, parlons des attributs de nos objets (<em>title</em>, <em>content</em> et <em>user_id</em>). En fait, ils ne sont pas définis « en dur » en tant qu'attributs. Pour faire simple, c'est comme s'ils étaient stockés dans un tableau.</p><p id="r-772648" data-claire-element-id="772648"><em>Doctrine_Record</em> implémente la méthode magique <a href="http://www.php.net/manual/fr/language.pseudo-types.php#language.types.mixed">__set()</a>, qui est appelée automatiquement lorsque l'on essaye d'utiliser un attribut qui n'existe pas. Ensuite, c'est comme pour <em>__call</em> : c'est ici que l'attribut est récupéré.</p><p id="r-772649" data-claire-element-id="772649">Et pour ce qui est de <code>$article['title'] = '...'</code>, et bien Doctrine_Record implémente l'interface <a href="http://fr.php.net/manual/fr/class.arrayaccess.php">ArrayAccess</a> (dont le nom est assez explicite ;) ).<br/> Je vous encourage par la même occasion à vous documenter au sujet de cette interface. Elle n'est pas extrêmement compliquée à comprendre, et beaucoup de composants de Doctrine l'utilisent.</p><p id="r-772650" data-claire-element-id="772650">J'espère que maintenant tout ce fonctionnement « magique » vous paraîtra un peu moins obscur. ;)</p><h2 id="r-utilisation-des-collections-d-objets" data-claire-element-id="772663">Utilisation des collections d'objets</h2><p id="r-772653" data-claire-element-id="772653">À l'instant, nous avons utilisé des méthodes nommées <code>findOneBy...</code>, qui nous retournent un seul objet. Mais si plusieurs objets peuvent correspondre aux critères, alors il est préférable d'utiliser <code>findBy...</code> qui retourne un objet <code>Doctrine_Collection</code> contenant une liste d'objets. Ces collections peuvent s'utiliser comme des tableaux.</p><p id="r-772654" data-claire-element-id="772654">À noter qu'il existe une méthode <code>findAll()</code> qui retourne TOUS les enregistrements de la table. Attention en l'utilisant sur des tables qui contiennent beaucoup d'enregistrements...</p><p id="r-772655" data-claire-element-id="772655">Voyons un exemple :</p><pre id="r-772656" data-claire-element-id="772656"><code data-claire-semantic="html+php">&lt;?php
$table = Doctrine_Core::getTable('Article');

$articles = $table-&gt;findByTitle('Titre');
foreach($articles as $article)
{
 echo $article-&gt;title;
}</code></pre><p id="r-772657" data-claire-element-id="772657">Il est bien entendu aussi possible de créer/modifier des collections :</p><pre id="r-772658" data-claire-element-id="772658"><code data-claire-semantic="html+php">&lt;?php
$articles = new Doctrine_Collection('Article');
// Ou bien
$articles = $table-&gt;findAll();

$articles[0] = new Article();
$articles[1] = new Article();

$articles[0]-&gt;title   = &quot;Titre de l'article n°1&quot;;
$articles[0]-&gt;content = 'Contenu 1';
$articles[1]-&gt;title   = &quot;Titre de l'article n°2&quot;;
// etc.</code></pre><aside id="r-772660" data-claire-element-id="772660" data-claire-semantic="information"><p id="r-772659" data-claire-element-id="772659">Je vous ai dit que beaucoup de composants de Doctrine implémentaient l'interface <em>ArrayAccess</em>. Et bien comme vous le voyez dans le code ci-dessus, c'est le cas de <em>Doctrine_Collection</em>. Notez aussi que pour pouvoir être parcouru avec <em>foreach</em>, il faut aussi implémenter une interface « iterator » (<em>IteratorAggregate</em> en l'occurrence).</p></aside><p id="r-772661" data-claire-element-id="772661">Pour sauvegarder tous nos objets, il existe un raccourci : nous ne serons pas obligés de sauvegarder nos objets un par un (ouf ! :p ).<br/><code>Doctrine_Collection</code> possède tout simplement une méthode <code>save()</code> qui appelle cette même méthode sur tous ses objets.</p><pre id="r-772662" data-claire-element-id="772662"><code data-claire-semantic="html+php">&lt;?php
$articles-&gt;save();</code></pre>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">
<span class="arrow"></span>
<span class="next">Manipulation des données stockées dans la base</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
<span class="next">Le langage DQL</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="LelangageDQL"></a><h2>Le langage DQL</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
<span class="arrow"></span>
<span class="next">Utilisation des objets et collections</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
<span class="next">Utilité des classes de tables</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-772665" data-claire-element-id="772665">Nous allons ici explorer un peu plus en profondeur Doctrine et découvrir son langage interne : <strong>le DQL</strong>.<br/> DQL signifie <em>Doctrine Query Language</em>. L'intérêt est encore une fois de ne pas se soucier du type de base de données utilisé. En effet, même s'ils utilisent le langage SQL, beaucoup de SGBD (tous ? ^^ ) implémentent leurs propres fonctions et spécificités dans le langage. Doctrine se chargera de traduire le DQL dans le langage approprié.</p><h2 id="r-selection-simple-de-donnees" data-claire-element-id="772679">Sélection simple de données</h2><p id="r-772666" data-claire-element-id="772666">Rassurez-vous, vous n'allez pas devoir apprendre (encore !) un nouveau langage ultra complexe...<br/> Le DQL utilise en fait les mêmes instructions que le SQL.</p><p id="r-772667" data-claire-element-id="772667">Pour ce premier chapitre, nous allons donc utiliser le mot clé... <code data-claire-semantic="sql">SELECT</code> ! ;)</p><p id="r-772668" data-claire-element-id="772668">Tout d'abord, petite explication.<br/> Lorsque vous sélectionnez un objet de cette manière :</p><pre id="r-772669" data-claire-element-id="772669"><code data-claire-semantic="html+php">&lt;?php
$article = Doctrine_Core::getTable('Article')-&gt;find(1);</code></pre><p id="r-772670" data-claire-element-id="772670">Doctrine va générer des instructions en SQL. Mais nous avons la possibilité d'écrire nous-mêmes les requêtes à la main.</p><p id="r-772671" data-claire-element-id="772671">Pour cela, nous allons utiliser des objets <code>Doctrine_Query</code>.</p><pre id="r-772672" data-claire-element-id="772672"><code data-claire-semantic="html+php">&lt;?php
$q = Doctrine_Query::create()
  -&gt;from('Article a')
  -&gt;leftJoin('a.User u')
  -&gt;where('a.id = ?', 1);

$article = $q-&gt;fetchOne();</code></pre><p id="r-772673" data-claire-element-id="772673">Cet exemple produit le même effet que précédemment, le SQL généré étant le même ; mais à la différence près que nous avons construit la requête à la main.<br/> Rassurez-vous, nous allons détailler tout cela juste après. ;)</p><div id="r-772675" data-claire-element-id="772675" data-claire-semantic="question"><p id="r-772674" data-claire-element-id="772674">Euh... C'est quoi l'intérêt de faire ça alors qu'on peut le récupérer en une seule ligne, notre article ?!</p></div><p id="r-772676" data-claire-element-id="772676">Oui, bon, j'avoue, sur cet exemple, l'intérêt n'est pas flagrant. ^^ Mais dès que vous allez vouloir faire des sélections plus complexes qu'avec les <em>finders</em> (souvenez-vous, les méthodes <code>$table-&gt;findByXXX()</code>), cela va devenir indispensable.</p><p id="r-772677" data-claire-element-id="772677">Imaginons que nos articles possèdent un champ <code>publishable</code> dont le contenu indique si l'article est publiable ou non. Pour récupérer un article, il nous faut alors prendre ceci en compte et filtrer les résultats :</p><pre id="r-772678" data-claire-element-id="772678"><code data-claire-semantic="html+php">&lt;?php
$q = Doctrine_Query::create()
  -&gt;from('Article a')
  -&gt;leftJoin('a.User u')
  -&gt;where('a.id = ?', 1)
  -&gt;andWhere('a.publishable = ?', true);

$article = $q-&gt;fetchOne();</code></pre><h2 id="r-select-doctrine-query-en-details" data-claire-element-id="772727">SELECT : Doctrine_Query en détails</h2><p id="r-772680" data-claire-element-id="772680">Passons maintenant en revue les différentes méthodes disponibles pour construire notre <code>Doctrine_Query</code>.</p><h3 id="r-select-3" data-claire-element-id="772682">SELECT</h3><p id="r-772681" data-claire-element-id="772681"><code>Doctrine_Query::select()</code> permet d'indiquer les champs à sélectionner. Notez que pour l'instant, nous récupérons tous nos enregistrements sous forme d'objets ; il est donc inutile de préciser quels champs récupérer, car Doctrine sélectionne automatiquement tous les champs. Nous verrons plus tard comment personnaliser tout ça. ^^</p><h3 id="r-from" data-claire-element-id="772684">FROM</h3><p id="r-772683" data-claire-element-id="772683"><code>Doctrine_Query::from()</code> permet d'indiquer la (ou les) table(s) sur lesquelles effectuer la sélection. Pour ajouter d'autres champs à une requête existante, utilisez <code>Doctrine_Query::addFrom()</code>.</p><h3 id="r-where-2" data-claire-element-id="772688">WHERE</h3><p id="r-772685" data-claire-element-id="772685"><code>Doctrine_Query::where()</code> permet de filtrer les enregistrements. Utilisez la syntaxe « classique » de la clause WHERE du SQL.<br/> Notez que cette méthode efface toutes les conditions précédemment définies. Pour ajouter une condition à celles existantes, il faut utiliser <code>Doctrine_Query::addWhere()</code> (identique à <code>Doctrine_Query::andWhere()</code>) qui ajoute une condition avec <code>AND</code>, ou <code>Doctrine_Query::orWhere()</code> qui ajoute une condition avec <code>OR</code>.</p><p id="r-772686" data-claire-element-id="772686">Cette fonction accepte en deuxième argument la liste des paramètres :</p><pre id="r-772687" data-claire-element-id="772687"><code data-claire-semantic="html+php">&lt;?php
$q-&gt;andWhere('a.id = ? OR a.id = ?', array(1, 2));
$q-&gt;orWhere('a.title = ?', array('Mon titre'));
// Ou :
$q-&gt;orWhere('a.title = ?', 'Mon titre');
// Ou encore :
$q-&gt;orWhere('a.title = :title', array(':title' =&gt; 'Mon titre'));</code></pre><h3 id="r-join-1" data-claire-element-id="772696">JOIN</h3><p id="r-772689" data-claire-element-id="772689">Doctrine supporte deux types de jointures :<code>INNER JOIN</code> et <code>LEFT JOIN</code>. <code>RIGHT JOIN</code> n'est pas supporté, mais il suffit de construire ses requêtes autrement pour y pallier. Les méthodes utilisées sont <code>Doctrine_Query::innerJoin()</code> et <code>Doctrine_Query::leftJoin()</code>.<br/> Par défaut, Doctrine ajoute automatiquement la condition de jointure (mot-clé <code>ON</code>) en fonction des relations définies entre les tables. Pour utiliser une condition personnalisée, il suffit d'inclure le mot clé <code>ON</code> dans le DQL passé à l'une de ces méthodes :</p><pre id="r-772690" data-claire-element-id="772690"><code data-claire-semantic="html+php">&lt;?php
$q = Doctrine_Query::create()
  -&gt;from('Article a')
  -&gt;leftJoin('a.User u ON u.id = ?', 3);</code></pre><ul id="r-772695" data-claire-element-id="772695"><li id="r-772692" data-claire-element-id="772692"><p id="r-772691" data-claire-element-id="772691">Le mot-clé <code>WITH</code> (ajout d'une condition sur la jointure) s'utilise de la même manière.</p></li><li id="r-772694" data-claire-element-id="772694"><p id="r-772693" data-claire-element-id="772693">Les paramètres sont passés de la même façon que pour le <code>WHERE</code> (voir ci-dessus).</p></li></ul><h3 id="r-order-by-2" data-claire-element-id="772698">ORDER BY</h3><p id="r-772697" data-claire-element-id="772697">La clause <code>ORDER BY</code> se définit avec <code>Doctrine_Query::orderBy()</code> (ou <code>Doctrine_Query::addOrderBy()</code>).</p><h3 id="r-limit-et-offset" data-claire-element-id="772702">LIMIT et OFFSET</h3><p id="r-772699" data-claire-element-id="772699">Utilisez <code>Doctrine_Query::limit()</code> et <code>Doctrine_Query::offset()</code>.</p><aside id="r-772701" data-claire-element-id="772701" data-claire-semantic="information"><p id="r-772700" data-claire-element-id="772700">Pour ceux qui formulent leurs limites en faisant <code>LIMIT 14, 50</code> (avec MySQL par exemple), sachez que cela ne fait pas partie des spécifications officielles de SQL. L'autre formulation possible est <code>LIMIT 50 OFFSET 14</code>. Avec Doctrine, vous devrez donc utiliser la deuxième manière et utiliser <code>limit()</code> et <code>offset()</code>.</p></aside><h3 id="r-group-by" data-claire-element-id="772704">GROUP BY</h3><p id="r-772703" data-claire-element-id="772703">Utilisez <code>Doctrine_Query::groupBy()</code> ou <code>Doctrine_Query::addGroupBy()</code>.</p><h3 id="r-having" data-claire-element-id="772706">HAVING</h3><p id="r-772705" data-claire-element-id="772705">Utilisez <code>Doctrine_Query::having()</code> ou <code>Doctrine_Query::addHaving()</code>.</p><h3 id="r-recuperation-des-resultats" data-claire-element-id="772714">Récupération des résultats</h3><p id="r-772707" data-claire-element-id="772707">Pour finir, la requête doit être exécutée pour pouvoir récupérer les résultats. <br/> Doctrine possède plusieurs méthodes pour cela :</p><ul id="r-772712" data-claire-element-id="772712"><li id="r-772709" data-claire-element-id="772709"><p id="r-772708" data-claire-element-id="772708"><strong>execute()</strong> : cette méthode retourne un objet <code>Doctrine_Collection</code> contenant un enregistrement ou plus. Notez que vous pouvez passer en argument un tableau contenant les paramètres n'ayant pas encore été renseignés. On peut également passer en deuxième argument le mode d'hydratation des résultats, mais nous verrons cela plus tard. ;)</p></li><li id="r-772711" data-claire-element-id="772711"><p id="r-772710" data-claire-element-id="772710"><strong>fetchOne()</strong> : cette méthode retourne un objet <code>Doctrine_Record</code>. Cette méthode accepte les mêmes arguments que <code>execute()</code>.</p></li></ul><p id="r-772713" data-claire-element-id="772713">Il existe d'autres méthodes qui retournent des résultats, telle que <code>fetchArray()</code>. Mais nous verrons cela plus tard (oui, encore ^^ ).</p><h3 id="r-note-sur-le-passage-des-parametres" data-claire-element-id="772726">Note sur le passage des paramètres</h3><p id="r-772715" data-claire-element-id="772715">Vous avez vu que les méthodes acceptant des <em>variables</em> peuvent recevoir en paramètre ces valeurs à remplir. Lorsque vous utilisez des valeurs dynamiques comme cela, vous devez toujours les passer en paramètre. De cette manière, les caractères dangereux seront échappés automatiquement, évitant des injections SQL.<br/> Ces paramètres s'utilisent de la même manière qu'avec PDO. Deux choix s'offrent à vous pour indiquer leur emplacement :</p><ul id="r-772720" data-claire-element-id="772720"><li id="r-772717" data-claire-element-id="772717"><p id="r-772716" data-claire-element-id="772716">Utiliser des <strong>?</strong>. <br/> Dans ce cas, les paramètres doivent être passés dans le même ordre que les <strong>?</strong>. <br/> Par exemple : <code data-claire-semantic="html+php">&lt;?php $q-&gt;where('a.title = ?', $title)</code>.</p></li><li id="r-772719" data-claire-element-id="772719"><p id="r-772718" data-claire-element-id="772718">Utiliser des paramètres nommés, comme <strong>:name</strong>. <br/> Dans ce cas, l'argument supplémentaire doit être un tableau associatif de paires <strong>nom</strong> =&gt; <strong>valeur</strong>. <br/> Par exemple : <code data-claire-semantic="html+php">&lt;?php $q-&gt;where('a.title = :title', array(':title' =&gt; $title))</code>.</p></li></ul><p id="r-772721" data-claire-element-id="772721">Pour finir, comme je vous l'ai dit, les méthodes qui exécutent la requête (telles que <em>execute()</em> et <em>fetchOne()</em>) acceptent elles aussi comme premier argument un tableau de paramètres à passer.<br/> Pourquoi ? Et bien, il se peut qu'au moment de construire votre requête, vous ne connaissiez pas encore la valeur des variables que vous utiliserez à l'intérieur. Vous avez donc la possibilité de les passer tout à la fin, juste au moment de l'exécution.</p><p id="r-772722" data-claire-element-id="772722">Par exemple, les deux codes ci-dessous sont identiques :</p><pre id="r-772723" data-claire-element-id="772723"><code data-claire-semantic="html+php">&lt;?php
$q = Doctrine_Query::create()
  -&gt;from('Article a')
  -&gt;where('a.title = :title AND a.publishable = :publishable', array(
      ':title'       =&gt; $title, 
      ':publishable' =&gt; $publishable
    ))
  -&gt;andWhere('a.content LIKE :keyword', '%'.$keyword.'%');

$resultats = $q-&gt;execute();</code></pre><pre id="r-772724" data-claire-element-id="772724"><code data-claire-semantic="html+php">&lt;?php
$q = Doctrine_Query::create()
  -&gt;from('Article a')
  -&gt;where('a.title = :title OR a.publishable = :publishable')
  -&gt;andWhere('a.content LIKE :keyword');

$resultats = $q-&gt;execute(array(
  ':title'       =&gt; $title,
  ':publishable' =&gt; $publishable,
  ':keyword'     =&gt; '%'.$keyword.'%',
));</code></pre><p id="r-772725" data-claire-element-id="772725">Ceci peut vous être utile lorsque vous utilisez des requêtes comme <em>modèles</em>. Notez que dans ce cas, il est conseillé d'utiliser les paramètres nommés (tels que :title), à moins que vous ne connaissiez par coeur l'ordre dans lequel vous devez passer les paramètres. ^^</p><h2 id="r-update-et-delete" data-claire-element-id="772737">UPDATE et DELETE</h2><p id="r-772728" data-claire-element-id="772728">Les mises à jour et suppressions de données se font tout aussi simplement avec un objet <code>Doctrine_Query</code>.</p><h3 id="r-delete" data-claire-element-id="772731">DELETE</h3><p id="r-772729" data-claire-element-id="772729">Ici, au lieu d'utiliser <code>Doctrine_Query::select()</code>, nous allons utiliser... <code>Doctrine_Query::delete()</code> ! Surprenant, hein ? ;) <br/> Nous pouvons appliquer les mêmes filtres que pour un SELECT ; voici un exemple :</p><pre id="r-772730" data-claire-element-id="772730"><code data-claire-semantic="html+php">&lt;?php
$q = Doctrine_Query::create()
  -&gt;delete('Article a')
  -&gt;where('a.title LIKE ?', 'Mauvais titre')
  -&gt;orWhere('a.published = ?', false)
  -&gt;limit(20);
$number = $q-&gt;execute();</code></pre><h3 id="r-update-1" data-claire-element-id="772736">UPDATE</h3><p id="r-772732" data-claire-element-id="772732">De la même manière, nous pouvons mettre à jour des champs. Il faut en revanche spécifier en plus les champs à mettre à jour avec <code>Doctrine_Query::set()</code> :</p><pre id="r-772733" data-claire-element-id="772733"><code data-claire-semantic="html+php">&lt;?php
$q = Doctrine_Query::create()
  -&gt;update('Article a')
  -&gt;where('a.title = ?', 'mon titre')
  -&gt;orWhere('a.id = ?', 1)

  // Soit :
  -&gt;set('content', 'un super texte');
  // ou soit :
  -&gt;set('content', '?', $content);
  // ou encore 
  -&gt;set(array('content' =&gt; $content))

$number = $q-&gt;execute();</code></pre><aside id="r-772735" data-claire-element-id="772735" data-claire-semantic="information"><p id="r-772734" data-claire-element-id="772734">Le nombre de lignes affectées (mises à jour ou supprimées) est retourné par la méthode <code>execute()</code> dans le cas d'un update d'un delete.</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
<span class="arrow"></span>
<span class="next">Utilisation des objets et collections</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
<span class="next">Utilité des classes de tables</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Utilitdesclassesdetables"></a><h2>Utilité des classes de tables</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
<span class="arrow"></span>
<span class="next">Le langage DQL</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">
<span class="next">TP : Création d&#039;un CRUD</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-772739" data-claire-element-id="772739">Au chapitre précédent, je vous avais dit de créer, en plus des classes classiques de modèles, des classes de tables (par exemple <code>ArticleTable.class.php</code>). Mais peut-être n'en voyez-vous pas l'utilité.</p><p id="r-772740" data-claire-element-id="772740">En fait, nous allons nous en servir pour effectuer des traitements lorsqu'il y en aura besoin. Tout le code (ou du moins le plus possible ^^ ) concernant des actions sur la table et ses données devra être placé dans cette classe.</p><p id="r-772741" data-claire-element-id="772741">Prenons un exemple. Imaginons que nos articles contiennent un champ <em>is_publishable</em> qui indique si l'article est publiable ou non. Par défaut, la méthode <em>find()</em> cherche un article avec son id. Mais nous voulons en plus une « sécurité », c'est-à-dire ne pas pouvoir récupérer les articles non publiables, par exemple.</p><p id="r-772742" data-claire-element-id="772742">Pour cela, nous allons redéfinir cette méthode :</p><pre id="r-772743" data-claire-element-id="772743"><code data-claire-semantic="html+php">&lt;?php
class ArticleTable extends Doctrine_Table
{
 public function find($id)
 {
  $q = $this-&gt;createQuery('a')
    -&gt;where('a.id = ?', $id)
    -&gt;andWhere('a.is_publishable = ?', true);
  
  return $q-&gt;fetchOne();
 }
}</code></pre><p id="r-772744" data-claire-element-id="772744">Maintenant, lorsque nous utiliserons <code data-claire-semantic="html+php">&lt;?php Doctrine_Core::getTable('Article')-&gt;find(3)</code>, ce sera cette méthode qui sera appelée (merci l'héritage :p ).</p><p id="r-772745" data-claire-element-id="772745">Remarquez que nous avons utilisé <code data-claire-semantic="html+php">&lt;?php $this-&gt;createQuery('a')</code>. Ceci est en fait un raccourci pour :</p><pre id="r-772746" data-claire-element-id="772746"><code data-claire-semantic="html+php">&lt;?php
Doctrine_Query::create()
    -&gt;from('Article a')</code></pre><p id="r-772747" data-claire-element-id="772747">Mais nous avons encore un problème : si on utilise une autre méthode que <em>find()</em> pour récupérer un article, le filtrage ne sera pas effectué.<br/> Afin de simplifier l'ajout de cette condition à toutes nos requêtes, nous allons créer une méthode <em>getPublishableArticleQuery()</em> :</p><pre id="r-772748" data-claire-element-id="772748"><code data-claire-semantic="html+php">&lt;?php
class ArticleTable extends Doctrine_Table
{
 public function getPublishableArticleQuery(Doctrine_Query $q = null)
 {
  if(null === $q)
  {
   $q = $this-&gt;createQuery();
  }

  // getRootAlias() renvoie l'alias principal de la requête 
  // (jusqu'à maintenant j'ai utilisé 'a' pour cette table,
  // mais j'aurais pu utiliser n'importe quoi).
  $q-&gt;andWhere($q-&gt;getRootAlias().'.is_publishable = ?', true);
  
  return $q;
 }

 public function find($id)
 {
  $q = $this-&gt;createQuery('a')
    -&gt;where('a.id = ?', $id);

  return $this
    -&gt;getPublishableArticleQuery($q)
    -&gt;fetchOne();
 }
}</code></pre><p id="r-772749" data-claire-element-id="772749">Explications :<br/> La méthode <code>ArticleTable::getPublishableArticleQuery()</code> accepte en argument un objet <code>Doctrine_Query</code>, et lui ajoute une condition <code>WHERE</code>, puis la retourne.</p><aside id="r-772751" data-claire-element-id="772751" data-claire-semantic="information"><p id="r-772750" data-claire-element-id="772750">Nous voyons ici toute la puissance de <code>Doctrine_Query</code> : il est possible de modifier la requête à plusieurs endroits dans notre programme, de lui ajouter des conditions, etc. sans se soucier de ce qu'elle fait. Notre méthode <em>getPublishableArticleQuery</em> ajoute la condition, sans savoir comment la requête est construite ni les éléments qu'elle sélectionne déjà.</p></aside><p id="r-772752" data-claire-element-id="772752">Il reste un petit inconvénient : dans toutes les requêtes de sélection telles que <em>find()</em>, nous devrons penser à bien passer par cette méthode afin d'ajouter le filtre. <br/> Nous verrons plus tard une méthode beaucoup plus propre et pratique pour pallier cela, afin que ce soit fait automatiquement (oui oui, Doctrine réserve encore beaucoup de surprises... :D ). Je vous ai expliqué cela ici pour vous montrer la force de l'héritage : nous pouvons redéfinir tous les comportements que nous voulons (tout en restant raisonnable, et en ne « détruisant » pas tout... ^^ ).</p><p id="r-772753" data-claire-element-id="772753">Pour conclure cette partie, notez que l'objet <em>Doctrine_Connection</em> (à ne pas confondre avec <em>Doctrine_Co<strong>ll</strong>ection</em> :) ) possède une méthode <em>flush()</em>, qui permet de sauvegarder tout ce qui a été modifié avec la connexion courante. C'est utile lorsque vous modifiez un grand nombre d'objets et collections différents : cela vous évite de sauvegarder les objets/collections un par un.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
<span class="arrow"></span>
<span class="next">Le langage DQL</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">
<span class="next">TP : Création d&#039;un CRUD</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="TPCrationd039unCRUD"></a><h2>TP : Création d&#039;un CRUD</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
<span class="arrow"></span>
<span class="next">Utilité des classes de tables</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
<span class="next">Préparation du terrain</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-772756" data-claire-element-id="772756">Nous allons maintenant passer un peu plus à la pratique et créer un CRUD. Pour ceux qui ne connaissent pas, un CRUD est un système de manipulation des données de la base : ça signifie <em>Create, Read, Update, Delete</em><em>(Créer, Lire, Mettre à jour, Supprimer)</em>.</p><p id="r-772757" data-claire-element-id="772757">Autrement dit, on va faire une interface pour gérer nos données. Cela peut entre autres servir à créer une interface d'administration pour votre site.</p><aside id="r-772759" data-claire-element-id="772759" data-claire-semantic="warning"><p id="r-772758" data-claire-element-id="772758">Attention, ce TP est là uniquement pour vous faire pratiquer un peu sur des choses simples, pour commencer à retenir un peu le fonctionnement de Doctrine et les méthodes utiles. Je ne traiterai pas, notamment, de la sécurité des scripts. Ceci est à intégrer à un projet, c'est pourquoi je vous donne un contrôleur frontal si basique.</p></aside>
</div><a name="Prparationduterrain"></a><h2>Préparation du terrain</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">
<span class="arrow"></span>
<span class="next">TP : Création d&#039;un CRUD</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
<span class="next">Affichage de données</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-recapitulatif-14" data-claire-element-id="772767">Récapitulatif</h2><p id="r-772760" data-claire-element-id="772760">Avant de commencer, récapitulons la structure de notre projet. Jusqu'à maintenant je vous ai simplement indiqué où placer quelques fichiers.</p><p id="r-772761" data-claire-element-id="772761">Nous utiliserons cette structure :</p><p id="r-772762" data-claire-element-id="772762">~/config/<br/> ----global.php<br/> ----schema.yml<br/> ~/html/<br/> ~/lib/<br/> ----models/<br/> --------Article.php<br/> --------ArticleTable.php<br/> --------User.php<br/> --------UserTable.php<br/> --------generated/<br/> ------------BaseArticle.php<br/> ------------BaseUser.php<br/> ~/web/<br/> ----index.php</p><p id="r-772763" data-claire-element-id="772763">Si vous avez suivi le tutoriel en entier, vous ne devriez rien avoir à faire. Dans le cas contraire, je vous laisse vous reporter aux chapitres précédents pour connaître le contenu de ces fichiers.</p><p id="r-772764" data-claire-element-id="772764">Comme je vous l'ai dit, nous allons grandement simplifier le modèle MVC : nous aurons un contrôleur frontal (<code>~/web/index.php</code>) qui se chargera aussi d'inclure la page HTML.</p><aside id="r-772766" data-claire-element-id="772766" data-claire-semantic="information"><p id="r-772765" data-claire-element-id="772765">Le but ici n'est pas d'expliquer le pattern MVC. Libre à vous d'utiliser votre propre système de templates/framework, d'adapter tout cela à un projet existant, etc. Je vous encourage d'ailleurs à le faire.</p></aside><h2 id="r-le-controleur-21" data-claire-element-id="772770">Le contrôleur</h2><p id="r-772768" data-claire-element-id="772768">Voici la structure de notre contrôleur (tout pas beau tout moche, je sais :p ) :</p><pre id="r-772769" data-claire-element-id="772769"><code data-claire-semantic="html+php">&lt;?php
require(dirname(__FILE__).'/../config/global.php');

// On récupère l'action à effectuer (Create, Read, Update ou Delete).
// Je compte sur vous pour utiliser un système plus perfectionné que ça. ^^
$action = 'read';
if(isset($_GET['action']) &amp;&amp; in_array($_GET['action'], array('create', 'read', 'update', 'delete')))
{
  $action = $_GET['action'];
}

/* Nous ferons ici les traitements concernant la page. */
switch($action)
{
  case 'read':
    break;
  case 'create':
    break;
  case 'update':
    break;
  case 'delete':
    break;
}

/* Nous appellerons ici la page HTML appropriée. */
include(HTML_DIR.$action.'.php');</code></pre><h2 id="r-donnees-de-test" data-claire-element-id="772775">Données de test</h2><p id="r-772771" data-claire-element-id="772771">Avant de commencer, il va bien falloir avoir quelques données pour tester. Insérez donc ceci :</p><pre id="r-772772" data-claire-element-id="772772"><code data-claire-semantic="sql">INSERT INTO member
(login, password)
VALUES
('Jean', 'mypass'),
('Bernard', 'mysuperpass'),
('Superman', 'batman');

INSERT INTO article
(title, content)
VALUES 
(&quot;Mon premier article&quot;, &quot;Voici le contenu de l'article, comme c'est simplement pour tester, je mets du texte tout bidon. D'ailleurs, je ne sais pas si vous avez remarqué, mais je n'ai pas beaucoup d'imagination !&quot;),
(&quot;Mon second article&quot;, &quot;Voici le contenu du deuxième article, comme c'est simplement pour tester, je mets du texte tout bidon. D'ailleurs, je ne sais pas si vous avez remarqué, mais je n'ai pas beaucoup d'imagination !&quot;),
(&quot;Mon troisième et dernier article&quot;, &quot;Voici le contenu du troisième article, comme c'est simplement pour tester, je mets du texte tout bidon. D'ailleurs, je ne sais pas si vous avez remarqué, mais je n'ai pas beaucoup d'imagination !&quot;);</code></pre><p id="r-772773" data-claire-element-id="772773">Bien sûr, si vous avez des données plus intéressantes, utilisez-les. ^^</p><p id="r-772774" data-claire-element-id="772774">À partir d'ici, je vais vous donner le code au fur et à mesure que l'on avance. Je ne vous prends pas pour des gamins, si vous n'avez pas envie de réfléchir et voulez copier/coller directement, libre à vous. ^^ Mais dans ce cas, ce n'est presque pas la peine de lire jusqu'en bas, parce que je ne fais que reprendre ce que l'on a vu jusqu'ici. À vous de voir ce que vous préférez. ;)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">
<span class="arrow"></span>
<span class="next">TP : Création d&#039;un CRUD</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
<span class="next">Affichage de données</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Affichagededonnes"></a><h2>Affichage de données</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
<span class="arrow"></span>
<span class="next">Préparation du terrain</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
<span class="next">Création d&#039;objets</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-772777" data-claire-element-id="772777">Ici, nous voulons afficher une liste de tous nos articles dans un tableau. Nous allons devoir récupérer les données dans la base de données, puis les afficher. Ce n'est vraiment pas compliqué, à vous de jouer.</p><h2 id="r-creation-de-la-requete" data-claire-element-id="772781">Création de la requête</h2><p id="r-772778" data-claire-element-id="772778">Ajoutez ceci dans le contrôleur :</p><pre id="r-772779" data-claire-element-id="772779"><code data-claire-semantic="html+php">&lt;?php
/* ... */
  case 'read':
    $articles = Doctrine_Core::getTable('Article')-&gt;findAll();
    break;
/* ... */</code></pre><p id="r-772780" data-claire-element-id="772780">Comme nous l'avons vu, <em>findAll()</em> nous retourne tous les articles de la table.</p><h2 id="r-affichage-des-donnees-recuperees" data-claire-element-id="772787">Affichage des données récupérées</h2><p id="r-772782" data-claire-element-id="772782">Créons maintenant la vue pour l'action <em>read</em> :</p><pre id="r-772783" data-claire-element-id="772783"><code data-claire-semantic="html+php">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en-US&quot; lang=&quot;en-US&quot;&gt;
&lt;head&gt;
 &lt;title&gt;Tutoriel Doctrine&lt;/title&gt;
 &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=iso-8859-1&quot; /&gt;
&lt;/head&gt;
&lt;body&gt;
 &lt;h1&gt;Liste des articles&lt;/h1&gt;
 &lt;a href=&quot;?action=create&quot;&gt;Ajouter un nouvel article&lt;/a&gt;
 &lt;table&gt;
  &lt;tr&gt;
   &lt;th&gt;Titre&lt;/th&gt;
   &lt;th&gt;Contenu&lt;/th&gt;
   &lt;th&gt;Auteur&lt;/th&gt;
   &lt;th&gt;&lt;em&gt;Action&lt;/em&gt;&lt;/th&gt;
  &lt;/tr&gt;
  &lt;?php foreach($articles as $article): ?&gt;
   &lt;tr&gt;
    &lt;td&gt;&lt;?php echo $article['title'] ?&gt;&lt;/td&gt;
    &lt;td&gt;&lt;?php echo $article['content'] ?&gt;&lt;/td&gt;
    &lt;td&gt;&lt;?php echo $article['User']['login'] ?&gt;&lt;/td&gt;
    &lt;td&gt;
     &lt;a href=&quot;?action=update&amp;amp;id=&lt;?php echo $article['id'] ?&gt;&quot;&gt;Modifier&lt;/a&gt;
     &lt;a href=&quot;?action=delete&amp;amp;id=&lt;?php echo $article['id'] ?&gt;&quot;&gt;Supprimer&lt;/a&gt;
    &lt;/td&gt;
   &lt;/tr&gt;
  &lt;?php endforeach; ?&gt;
 &lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-772784" data-claire-element-id="772784">Tout ceci est assez simple, je ne pense pas qu'il y ait de problème particulier. Nous utilisons simplement <em>findAll()</em> pour récupérer tous les articles. Comme on récupère un objet <code>Doctrine_Collection</code> (qui peut s'utiliser comme un tableau, rappelez-vous), nous utilisons <code>foreach</code> pour les parcourir.</p><aside id="r-772786" data-claire-element-id="772786" data-claire-semantic="information"><p id="r-772785" data-claire-element-id="772785">La notation « tableau » est recommandée lorsque nous accédons à l'objet dans du code HTML. Ceci, simplement parce que si la personne qui s'occupe d'écrire le code HTML n'est pas la même que celle qui écrit le code PHP, elle n'est pas censée savoir comment PHP fonctionne. Cette notation lui permet de ne pas se soucier de la nature de la variable $article. Cela dit, si vous vous occupez de tout, vous faites bien comme vous voulez, vous avez quand même tout à fait le droit d'utiliser la notation objet si ça vous chante. ^^</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
<span class="arrow"></span>
<span class="next">Préparation du terrain</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
<span class="next">Création d&#039;objets</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Crationd039objets"></a><h2>Création d&#039;objets</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
<span class="arrow"></span>
<span class="next">Affichage de données</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
<span class="next">Modification d&#039;objets</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-772789" data-claire-element-id="772789">Cette fois, il va nous falloir afficher un formulaire nous permettant de renseigner les informations sur un nouvel article. Attention, pour l'utilisateur, je suppose que vous ne voulez pas laisser le choix à celui qui écrit l'article de « choisir qui écrit l'article » (logique, non ? ^^ ).</p><h2 id="r-le-formulaire-9" data-claire-element-id="772794">Le formulaire</h2><p id="r-772790" data-claire-element-id="772790">Nous allons voir ici comment créer de nouveaux objets et les sauvegarder dans la base.</p><p id="r-772791" data-claire-element-id="772791">Nous allons avoir besoin d'un formulaire afin de rentrer les informations :</p><pre id="r-772792" data-claire-element-id="772792"><code data-claire-semantic="html+php">&lt;body&gt;
	&lt;h1&gt;Création d'un article&lt;/h1&gt;
	&lt;form action=&quot;index.php?action=create&quot; method=&quot;post&quot;&gt;
		&lt;label for=&quot;article_title&quot;&gt;Titre : &lt;/label&gt;&lt;br /&gt;
		&lt;input type=&quot;text&quot; name=&quot;title&quot; id=&quot;article_title&quot; /&gt;&lt;br /&gt;
		&lt;br /&gt;
		&lt;label for=&quot;article_text&quot;&gt;Texte : &lt;/label&gt;&lt;br /&gt;
		&lt;textarea name=&quot;content&quot; id=&quot;article_text&quot;&gt;&lt;/textarea&gt;&lt;br /&gt;
		&lt;br /&gt;
		&lt;input type=&quot;submit&quot; value=&quot;Sauvegarder&quot; /&gt;
	&lt;/form&gt;
	&lt;a href=&quot;?action=read&quot;&gt;Retour à la liste&lt;/a&gt;
&lt;/body&gt;</code></pre><p id="r-772793" data-claire-element-id="772793">Nous ne mettons pas de champ 'Auteur'. Personnalisez tout cela à votre sauce, par exemple en récupérant l'id de l'auteur depuis une variable de session.</p><h2 id="r-traitement-des-informations" data-claire-element-id="772797">Traitement des informations</h2><pre id="r-772795" data-claire-element-id="772795"><code data-claire-semantic="html+php">&lt;?php
/* ... */
case 'create':
	if(!empty($_POST))
	{
		$article = new Article();
		$article-&gt;title = $_POST['title'];
		$article-&gt;content = $_POST['content'];
	
		// On indique l'auteur. Adaptez cela à votre projet.
		$article-&gt;User = $user;
	
		$article-&gt;save();
	}
	break;
/* ... */</code></pre><p id="r-772796" data-claire-element-id="772796">Nous récupérons ici les données postées par le formulaire, et les affectons à un nouvel article, puis nous le sauvegardons.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
<span class="arrow"></span>
<span class="next">Affichage de données</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
<span class="next">Modification d&#039;objets</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Modificationd039objets"></a><h2>Modification d&#039;objets</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
<span class="arrow"></span>
<span class="next">Création d&#039;objets</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
<span class="next">Suppression de données</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-772799" data-claire-element-id="772799">La modification d'objets sera semblable à la création. La principale différence réside dans le fait que nous allons préremplir le formulaire avec les informations déjà existantes. Il nous faut donc récupérer l'article dans tous les cas. Et si on poste des informations le concernant, il faut le mettre à jour et sauvegarder en conséquence.</p><h2 id="r-le-formulaire-10" data-claire-element-id="772802">Le formulaire</h2><p id="r-772800" data-claire-element-id="772800">Nous allons reprendre le formulaire de création, en ajoutant simplement les valeurs par défaut :</p><pre id="r-772801" data-claire-element-id="772801"><code data-claire-semantic="html+php">&lt;body&gt;
 &lt;h1&gt;Modification d'un article&lt;/h1&gt;
 &lt;form action=&quot;index.php?action=update&quot; method=&quot;post&quot;&gt;
  &lt;label for=&quot;article_title&quot;&gt;Titre : &lt;/label&gt;&lt;br /&gt;
  &lt;input type=&quot;text&quot; name=&quot;title&quot; id=&quot;article_title&quot; value=&quot;&lt;?php echo $article['title'] ?&gt;&quot; /&gt;&lt;br /&gt;
  &lt;br /&gt;
  &lt;label for=&quot;article_text&quot;&gt;Texte : &lt;/label&gt;&lt;br /&gt;
  &lt;textarea name=&quot;content&quot; id=&quot;article_text&quot;&gt;&lt;?php echo $article['content'] ?&gt;&lt;/textarea&gt;&lt;br /&gt;
  &lt;br /&gt;
  &lt;input type=&quot;submit&quot; value=&quot;Sauvegarder&quot; /&gt;
  &lt;!-- Pour se souvenir de quel article il s'agit --&gt;
  &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;&lt;?php echo $article['id'] ?&gt;&quot; /&gt;
 &lt;/form&gt;
 &lt;a href=&quot;?action=read&quot;&gt;Retour à la liste&lt;/a&gt;
&lt;/body&gt;</code></pre><h2 id="r-traitement-des-informations-1" data-claire-element-id="772807">Traitement des informations</h2><pre id="r-772803" data-claire-element-id="772803"><code data-claire-semantic="html+php">&lt;?php
/* ... */
case 'update':
 $id = isset($_POST['id']) ? $_POST['id'] : $_GET['id'];
 // Il faut évidemment s'assurer que l'article existe
 if(!($article = Doctrine_Core::getTable('Article')-&gt;find($id)))
 {
  // À vous de mettre un traitement personnalisé !

  // Par exemple, on considère qu'il s'agit d'un nouvel article.
  $article = new Article();
  // Ou bien :
  exit();
 }
 
 if(!empty($_POST))
 {
  $article-&gt;title = $_POST['title'];
  $article-&gt;content = $_POST['content'];
 
  // On indique l'auteur. Adaptez cela à votre projet, par exemple si vous stockez l'id dans la session.
  $article-&gt;User = $user;
 
  $article-&gt;save();
 }
 break;
/* ... */</code></pre><p id="r-772804" data-claire-element-id="772804">Petit exercice : trouvez-moi l'équivalent en construisant une requête (<code>Doctrine_Query</code>).</p><p id="r-772805" data-claire-element-id="772805">Correction :</p><pre id="r-772806" data-claire-element-id="772806"><code data-claire-semantic="html+php">&lt;?php
if(!empty($_POST))
{
 $q = Doctrine_Query::create()
 $q-&gt;update('Article a')
   -&gt;set('a.title', '?', $_POST['title'])
   -&gt;set('a.content', '?', $_POST['content'])
   -&gt;where('a.id = ?', $id)
   -&gt;execute();
}</code></pre><h2 id="r-refactorisation-du-code" data-claire-element-id="772819">Refactorisation du code</h2><p id="r-772808" data-claire-element-id="772808">Ne voyez-vous pas quelque chose d'évident ?<br/> Les pages <em>create</em> et <em>update</em> sont pratiquement identiques, il est donc intéressant de les fusionner en une seule.</p><h3 id="r-le-formulaire-11" data-claire-element-id="772813">Le formulaire</h3><p id="r-772809" data-claire-element-id="772809">La page contenant le formulaire reste inchangée. Si l'article est « vide », alors les champs seront tout simplement préremplis avec des valeurs vides :</p><pre id="r-772810" data-claire-element-id="772810"><code data-claire-semantic="html+php">&lt;body&gt;
 &lt;?php if($article-&gt;exists()): ?&gt;
  &lt;h1&gt;Modification d'un article&lt;/h1&gt;
 &lt;?php else: ?&gt;
  &lt;h1&gt;Création d'un article&lt;/h1&gt;
 &lt;?php endif; ?&gt;

 &lt;form action=&quot;index.php?action=&lt;?php echo $action ?&gt;&quot; method=&quot;post&quot;&gt;
  &lt;label for=&quot;article_title&quot;&gt;Titre : &lt;/label&gt;&lt;br /&gt;
  &lt;input type=&quot;text&quot; name=&quot;title&quot; id=&quot;article_title&quot; value=&quot;&lt;?php echo $article['title'] ?&gt;&quot; /&gt;&lt;br /&gt;
  &lt;br /&gt;
  &lt;label for=&quot;article_text&quot;&gt;Texte : &lt;/label&gt;&lt;br /&gt;
  &lt;textarea name=&quot;content&quot; id=&quot;article_text&quot;&gt;&lt;?php echo $article['content'] ?&gt;&lt;/textarea&gt;&lt;br /&gt;
  &lt;br /&gt;
  &lt;input type=&quot;submit&quot; value=&quot;Sauvegarder&quot; /&gt;
  &lt;?php if($article-&gt;exists()): ?&gt;
   &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;&lt;?php echo $article['id'] ?&gt;&quot; /&gt;
  &lt;?php endif; ?&gt;
 &lt;/form&gt;
 &lt;a href=&quot;?action=read&quot;&gt;Retour à la liste&lt;/a&gt;
&lt;/body&gt;</code></pre><aside id="r-772812" data-claire-element-id="772812" data-claire-semantic="information"><p id="r-772811" data-claire-element-id="772811">Remarquez la méthode <em>exists()</em> de l'objet Doctrine_Record. Elle indique si l'objet existe dans la base de données, c'est-à-dire s'il est nouveau ou non.</p></aside><h3 id="r-le-controleur-22" data-claire-element-id="772818">Le contrôleur</h3><p id="r-772814" data-claire-element-id="772814">Le traitement devra créer l'objet au cas où il n'existe pas :</p><pre id="r-772815" data-claire-element-id="772815"><code data-claire-semantic="html+php">&lt;?php
/* ... */
case 'create':
case 'update':
 if(!isset($_GET['id']) &amp;&amp; !isset($_POST['id']))
 {
  $article = new Article();
 }
 else
 {
  $id = isset($_POST['id']) ? $_POST['id'] : $_GET['id'];
  if(!($article = Doctrine_Core::getTable('Article')-&gt;find($id)))
  {
   $article = new Article();
  }
 }

 if(!empty($_POST))
 {
  $article-&gt;title = $_POST['title'];
  $article-&gt;content = $_POST['content'];
 
  // On indique l'auteur. Adaptez cela à votre projet, par exemple si vous stockez l'id dans la session.
  $article-&gt;User = $user;
 
  $article-&gt;save();
 }
 break;
/* ... */</code></pre><p id="r-772816" data-claire-element-id="772816">Dans le cas où la page est appelée avec un id, on l'utilise pour récupérer l'article existant correspondant. Sinon, on en crée un nouveau.<br/> Ensuite, peu importe que l'article soit un nouveau ou un existant, le traitement est le même pour modifier les valeurs et sauvegarder.</p><p id="r-772817" data-claire-element-id="772817">Par ailleurs, le fichier <em>create.php</em> ne nous sert maintenant plus à rien. ^^</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
<span class="arrow"></span>
<span class="next">Création d&#039;objets</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
<span class="next">Suppression de données</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Suppressiondedonnes"></a><h2>Suppression de données</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
<span class="arrow"></span>
<span class="next">Modification d&#039;objets</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">
<span class="next">Les Events Listeners</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-772821" data-claire-element-id="772821">La suppression de données est très simple. Pour la vue, je vous invite juste à afficher un message de confirmation, par exemple, dans le fichier <code>~/html/delete.php</code>, vous devriez y arriver sans problème. ^^</p><h2 id="r-traitement-4" data-claire-element-id="772832">Traitement</h2><pre id="r-772822" data-claire-element-id="772822"><code data-claire-semantic="html+php">&lt;?php
/* ... */
case 'delete':
 $id = isset($_POST['id']) ? $_POST['id'] : $_GET['id'];
 // On s'assure que l'article existe
 if($article = Doctrine_Core::getTable('Article')-&gt;find($id))
 {
  $article-&gt;delete();
 }
 break;
/* ... */</code></pre><p id="r-772823" data-claire-element-id="772823">Trouvez-moi maintenant l'équivalent avec une <code>Doctrine_Query</code> :)</p><p id="r-772824" data-claire-element-id="772824">Tout simplement :</p><pre id="r-772825" data-claire-element-id="772825"><code data-claire-semantic="html+php">&lt;?php
$q = Doctrine_Query::create()
$q-&gt;delete('Article a')
  -&gt;where('a.id = ?', $id)
  -&gt;execute();</code></pre><p id="r-772826" data-claire-element-id="772826">Ce TP (extrêmement simple, non ? ^^ ) vous a permis de mettre en pratique simplement ce que nous avons vu jusque là. Bien sûr, comme je l'ai déjà dit, l'intérêt de Doctrine se révèle surtout dans les gros projets, et je ne vous encourage pas forcément à l'utiliser pour de petits projets simples.</p><aside id="r-772828" data-claire-element-id="772828" data-claire-semantic="warning"><p id="r-772827" data-claire-element-id="772827">Attention, comme je l'ai déjà dit dans l'introduction, ce TP n'est pas destiné à être un système complet. Je n'ai notamment pas mis l'accent sur la sécurité, mais il faut bien entendu vous assurer dans chaque action que les données correctes sont fournies.</p></aside><p id="r-772829" data-claire-element-id="772829">Sur ce, et si vous voulez en savoir plus sur Doctrine, passons maintenant à des chapitres un peu plus complexes. Le suivant concerne les templates (ou <em>behaviors</em>).</p><p id="r-772830" data-claire-element-id="772830">Voilà, vous devez être maintenant capables d'utiliser Doctrine dans vos projets. Vous verrez, avec un peu de pratique, ça vous simplifiera grandement la tâche. :p</p><p id="r-772831" data-claire-element-id="772831">Si vous êtes un peu curieux, je vous invite maintenant à entrer un peu plus en profondeur dans les entrailles de Doctrine (oulà, ça fait peur ! ^^ ). Plus vous en connaitrez sur cet ORM, plus vous l'utiliserez d'une façon optimale.<br/> Nous verrons beaucoup de trucs utiles et pratiques, qui simplifieront encore votre code. Je vous encourage vivement à ne pas vous arrêter ici. ^^</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
<span class="arrow"></span>
<span class="next">Modification d&#039;objets</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">
<span class="next">Les Events Listeners</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="LesEventsListeners"></a><h2>Les Events Listeners</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
<span class="arrow"></span>
<span class="next">Suppression de données</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
<span class="next">Introduction aux Events Listeners</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-772837" data-claire-element-id="772837">Dans cette partie, nous nous intéresserons aux Events Listeners. Comme leur nom l'indique, ces choses bizarres permettent... d'écouter des évènements !<br/> Non, je ne vous prends pas pour des billes, nous allons voir immédiatement de quoi il s'agit.</p><p id="r-772838" data-claire-element-id="772838">De manière générale et théorique, lorsqu'un évènement est déclenché, les <em>listeners</em> associés en sont informés, et peuvent agir en conséquence. Ils peuvent non seulement faire leur petit travail de leur côté, mais aussi, et c'est très important, modifier l'exécution de l'évènement.</p><p id="r-772839" data-claire-element-id="772839">Petite précision avant de commencer : cette partie restera assez théorique, mais nous (c'est-à-dire vous :-° ) mettrons tout cela en pratique dans un prochain TP.</p>
</div><a name="IntroductionauxEventsListeners"></a><h2>Introduction aux Events Listeners</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">
<span class="arrow"></span>
<span class="next">Les Events Listeners</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
<span class="next">Listener de connexion</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-declenchement-d-evenements-2" data-claire-element-id="772844">Déclenchement d'évènements</h2><p id="r-772840" data-claire-element-id="772840">La première chose à connaître, lorsque l'on parle d'évènements, est de savoir quand ils sont déclenchés. <br/> Dans Doctrine, nous ne nous occuperons pas de les déclencher, cela est fait automatiquement. Par exemple, lors d'un enregistrement dans la base de données, ou lors d'une sélection de données, etc.</p><aside id="r-772842" data-claire-element-id="772842" data-claire-semantic="information"><p id="r-772841" data-claire-element-id="772841">Pour ceux qui utilisent Symfony ou qui ont l'habitude de déclencher des évènements manuellement, gardez bien à l'esprit qu'avec Doctrine, nous ne parlons que d'<em>Event Listener</em>, ce qui signifie que nous ne faisons que les écouter. Le framework Symfony (entre autres) intègre une gestion complète des évènements, ce qui vous permet d'en déclencher vous-même. Ce n'est pas le cas ici !</p></aside><p id="r-772843" data-claire-element-id="772843">Les différents composants de Doctrine déclenchent à plusieurs moments ces évènements. Nous allons les étudier juste après.</p><h2 id="r-intercepter-un-evenement" data-claire-element-id="772864">Intercepter un évènement</h2><p id="r-772845" data-claire-element-id="772845">C'est le rôle des <em>listeners</em> et des <em>hooks</em>.</p><ul id="r-772850" data-claire-element-id="772850"><li id="r-772847" data-claire-element-id="772847"><p id="r-772846" data-claire-element-id="772846">Un <em>hook</em> est une méthode vide intégrée à l'objet écouté.</p></li><li id="r-772849" data-claire-element-id="772849"><p id="r-772848" data-claire-element-id="772848">Un <em>listener</em> est un objet à part, qui est <em>lié</em> à l'objet écouté. Il implémente lui-même les <em>hooks</em>, ce qui permet une meilleure séparation et organisation des différentes facettes de l'application.</p></li></ul><p id="r-772851" data-claire-element-id="772851">Vous comprendrez mieux tout cela par la suite, ne vous inquiétez pas. ;)</p><p id="r-772852" data-claire-element-id="772852">Les classes susceptibles de déclencher des évènements, sont les suivantes :</p><ul id="r-772863" data-claire-element-id="772863"><li id="r-772854" data-claire-element-id="772854"><p id="r-772853" data-claire-element-id="772853">Doctrine_Record ;</p></li><li id="r-772856" data-claire-element-id="772856"><p id="r-772855" data-claire-element-id="772855">Doctrine_Validator ;</p></li><li id="r-772858" data-claire-element-id="772858"><p id="r-772857" data-claire-element-id="772857">Doctrine_Connection ;</p></li><li id="r-772860" data-claire-element-id="772860"><p id="r-772859" data-claire-element-id="772859">Doctrine_Transaction ;</p></li><li id="r-772862" data-claire-element-id="772862"><p id="r-772861" data-claire-element-id="772861">Doctrine_Connection_Statement.</p></li></ul><h2 id="r-les-methodes-utilisees" data-claire-element-id="772872">Les méthodes utilisées</h2><p id="r-772865" data-claire-element-id="772865">Les méthodes (que ce soient des hooks, ou que ce soient celles des listeners) que nous allons utiliser seront expliquées par la suite. Leur utilisation est intuitive, voyons un exemple :</p><pre id="r-772866" data-claire-element-id="772866"><code data-claire-semantic="html+php">&lt;?php
class Article extends Doctrine_Record
{
    public function preSave($event)
    {
        $this-&gt;user_id = $_SESSION['user_id'];
    }
}</code></pre><p id="r-772867" data-claire-element-id="772867">Dans cet exemple, nous utilisons la méthode <code>preSave()</code> (un hook). Comme son nom l'indique, cette méthode est appelée juste avant l'enregistrement de l'article dans la base de données. Nous en profitons pour indiquer que c'est l'utilisateur courant qui a modifié cet article en dernier. Comme nous sommes à l'intérieur de l'objet en question, nous avons bien entendu accès à la variable <em>$this</em>, et nous pouvons le modifier directement, juste avant son enregistrement.</p><p id="r-772868" data-claire-element-id="772868">Les méthodes utilisées respectent toutes la même logique : elles sont préfixées par <em>pre</em> ou <em>post</em>, selon qu'elles soient appelées <em>avant</em> ou <em>après</em> l'évènement (ici, <em>save</em>).<br/> Pour finir, elles reçoivent en paramètre un objet <code>$event</code>, instance de <em>Doctrine_Event</em>.</p><div id="r-772870" data-claire-element-id="772870" data-claire-semantic="question"><p id="r-772869" data-claire-element-id="772869">Mais comment Doctrine peut-il savoir que j'ai écrit la méthode <em>preSave()</em> si je ne le lui dis pas ?</p></div><p id="r-772871" data-claire-element-id="772871">En fait, tous les hooks sont déjà définis dans la classe <em>Doctrine_Record</em> : allez y jeter un coup d'œil. Ce sont des méthodes vides, et Doctrine les appelle à chaque évènement. Seulement, tant que vous ne redéfinissez pas cette méthode dans une classe fille (merci l'héritage :-° ), et bien il ne se passe rien !<br/> C'est la même chose à chaque fois : l'astuce est simplement d'utiliser des méthodes vides !</p><h2 id="r-doctrine-event" data-claire-element-id="772884">Doctrine_Event</h2><p id="r-772873" data-claire-element-id="772873">Les objets <em>Doctrine_Event</em> permettent d'agir sur certains objets. Par exemple, si l'évènement est l'exécution d'une requête, on peut récupérer celle-ci, et ainsi la modifier.</p><p id="r-772874" data-claire-element-id="772874">Voici quelques méthodes utilisées fréquemment :</p><h3 id="r-getinvoker" data-claire-element-id="772878">getInvoker()</h3><p id="r-772875" data-claire-element-id="772875">Retourne l'objet qui a « invoqué » l'évènement. Par exemple, un objet <em>Doctrine_Record</em>.<br/><strong>Il y a toujours un <em>Invoker</em></strong>, et il s'agit d'une instance de l'une des classes citées plus haut.</p><p id="r-772876" data-claire-element-id="772876">Nous pouvons donc reformuler l'exemple précédent :</p><pre id="r-772877" data-claire-element-id="772877"><code data-claire-semantic="html+php">&lt;?php
class Article extends Doctrine_Record
{
    public function preSave($event)
    {
        $event-&gt;getInvoker()-&gt;user_id = $_SESSION['user_id'];
    }
}</code></pre><h3 id="r-getquery" data-claire-element-id="772880">getQuery()</h3><p id="r-772879" data-claire-element-id="772879">Retourne l'objet <em>Doctrine_Query</em> associé à l'évènement, s'il existe. <br/><strong>Attention, il peut ne pas exister !</strong> Dans l'exemple précédent, cela renverra la valeur <em>null</em>.</p><h3 id="r-getparams" data-claire-element-id="772883">getParams()</h3><p id="r-772881" data-claire-element-id="772881">Retourne un tableau d'éventuels paramètres. Par exemple, le paramètre <em>alias</em> contient l'alias utilisé dans la requête.</p><p id="r-772882" data-claire-element-id="772882">Voici les méthodes les plus courantes. Je vous invite à ouvrir le fichier Event.php pour plus de détails. Si vous avez bien suivi le début du tuto, vous devriez le trouver dans ~/lib/vendor/doctrine/Doctrine/. ;)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">
<span class="arrow"></span>
<span class="next">Les Events Listeners</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
<span class="next">Listener de connexion</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Listenerdeconnexion"></a><h2>Listener de connexion</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
<span class="arrow"></span>
<span class="next">Introduction aux Events Listeners</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
<span class="next">Listeners d&#039;objets</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-772886" data-claire-element-id="772886">Dans ce chapitre, nous nous intéressons aux listeners de connexion, c'est-à-dire les listeners que l'on peut attacher à la classe <em>Doctrine_Connection</em>.<br/> Je vous l'ai dit dans le chapitre précédent, un listener est une classe qui implémente des méthodes spécifiques.</p><h2 id="r-creer-un-listener-1" data-claire-element-id="772903">Créer un listener</h2><p id="r-772887" data-claire-element-id="772887">Il existe trois manières de créer un listener.</p><h3 id="r-etendre-une-classe-de-base" data-claire-element-id="772891">Étendre une classe de base</h3><p id="r-772888" data-claire-element-id="772888">Nous appellerons notre listener fictif <em>CustomListener</em>. <em>Doctrine_EventListener</em> offrant une base pour tout listener, le nôtre en héritera donc :</p><pre id="r-772889" data-claire-element-id="772889"><code data-claire-semantic="html+php">&lt;?php

class CustomListener extends Doctrine_EventListener
{ }</code></pre><p id="r-772890" data-claire-element-id="772890">Ouvrez le fichier ~/lib/vendor/doctrine/Doctrine/EventListener.php. Vous devriez maintenant mieux comprendre l'astuce des <em>méthodes vides</em> que je vous avais expliquée. La seule chose qu'il vous reste à faire maintenant, c'est de surcharger les méthodes que vous voulez implémenter. Chaque méthode porte un nom assez explicite, et je pense que vous devriez vous y retrouver. ;)</p><h3 id="r-etendre-une-autre-classe" data-claire-element-id="772897">Étendre une autre classe</h3><p id="r-772892" data-claire-element-id="772892">Si, pour une raison quelconque, votre listener ne peut pas hériter de <em>Doctrine_EventListener</em> (parce qu'il hérite déjà d'une autre classe, par exemple), il va falloir écrire en dur chaque méthode.</p><p id="r-772893" data-claire-element-id="772893">Explications<br/> La seule condition pour créer un listener, c'est en fait qu'il <strong>implémente l'interface <em>Doctrine_EventListener_Interface</em></strong>. Comme vous avez pu le voir en ouvrant le fichier EventListener.php, la seule chose que fait la classe <em>Doctrine_EventListener</em> est d'implémenter cette interface. Elle définit toutes les méthodes. Ainsi, la classe fille (<em>CustomListener</em>) implémente indirectement cette même interface, tout en n'étant pas obligée de redéfinir toutes les méthodes.<br/> Donc, si vous n'utilisez pas toutes les méthodes dans votre listener, vous devrez quand même les définir !</p><p id="r-772894" data-claire-element-id="772894">Un exemple de code sera certainement plus parlant :</p><pre id="r-772895" data-claire-element-id="772895"><code data-claire-semantic="html+php">&lt;?php

class CustomListener2 extends UneAutreClasse implements Doctrine_EventListener_Interface
{
    public function preTransactionCommit(Doctrine_Event $event)
    { }
    
    public function postTransactionCommit(Doctrine_Event $event)
    { }
    
    // Et ainsi de suite avec toutes les méthodes imposées par l'interface...
}</code></pre><p id="r-772896" data-claire-element-id="772896">Bien sûr, c'est ici que vous personnalisez chaque méthode comme vous le voulez.</p><h3 id="r-le-faux-listener" data-claire-element-id="772902">Le « faux » listener...</h3><p id="r-772898" data-claire-element-id="772898">La dernière manière de créer un listener, est d'implémenter l'interface <em>Doctrine_Overloadable</em>. Cette interface n'impose qu'une chose : l'implémentation de la méthode magique <a href="http://php.net/manual/en/language.oop5.magic.php">__call()</a>.<br/> Cette méthode sera appelée lors de chaque évènement, à vous ensuite de traiter tout ça comme vous le voulez. ;)</p><aside id="r-772900" data-claire-element-id="772900" data-claire-semantic="information"><p id="r-772899" data-claire-element-id="772899">Pour rappel, la méthode __call() reçoit deux paramètres : le nom de la méthode appelée, et un tableau des arguments.</p></aside><pre id="r-772901" data-claire-element-id="772901"><code data-claire-semantic="html+php">&lt;?php
class CustomListener3 implements Doctrine_Overloadable
{
    public function __call($method, $arguments)
    {
        $event = $arguments[0];
    }
}</code></pre><h2 id="r-attacher-un-listener" data-claire-element-id="772915">Attacher un listener</h2><p id="r-772904" data-claire-element-id="772904">La dernière chose à savoir, c'est comment <em>lier</em> le listener à l'objet écouté.<br/> Ceci se fait d'une manière très simple : <em>Doctrine_Connection</em> possède la méthode <em>addListener()</em> qui prend en paramètre... un listener !</p><p id="r-772905" data-claire-element-id="772905">Un exemple est plus simple que de longues explications :</p><pre id="r-772906" data-claire-element-id="772906"><code data-claire-semantic="html+php">&lt;?php

$listener1 = new CustomListener();
$listener2 = new CustomListener2();

$connexion-&gt;addListener($listener1);
$connexion-&gt;addListener($listener2);</code></pre><p id="r-772907" data-claire-element-id="772907">Comme vous le voyez, il est possible d'ajouter plusieurs listeners. Lors d'un évènement, ils seront appelés dans le même ordre que celui dans lequel ils ont été affectés.</p><aside id="r-772909" data-claire-element-id="772909" data-claire-semantic="information"><p id="r-772908" data-claire-element-id="772908">Notez que s'il n'y a qu'un seul listener, vous pouvez utiliser la méthode <em>setListener()</em>. Cela supprime également d'éventuels listeners existants.</p></aside><p id="r-772910" data-claire-element-id="772910">Les listeners attachés à <em>Doctrine_Connection</em> écoutent également les classes proches, comme <em>Doctrine_Transaction</em> et <em>Doctrine_Connection_Statement</em>. Néanmoins, le listener est global à ces trois classes, et doit être attaché à <em>Doctrine_Connection</em>.</p><p id="r-772911" data-claire-element-id="772911">Je vous invite à vous référer à <a href="http://www.doctrine-project.org/projects/orm/1.2/docs/manual/event-listeners/en#connection-listeners">la documentation officielle</a> (<em>in english of course :D </em>) pour avoir le détail de chaque méthode.<br/> Dans les tableaux, la colonne de gauche indique le nom de la méthode du listener, celle du milieu indique quelle méthode est écoutée, et la troisième contient d'éventuels paramètres accessibles de l'objet <em>Doctrine_Event</em>.</p><p id="r-772912" data-claire-element-id="772912">Par exemple, lors de l'appel de <code>Doctrine_Connection::connect()</code>, avant toute action, la méthode <em>preConnect()</em> du/des listener(s) est appelée. Une fois que toutes les actions sont effectuées, c'est au tour de la méthode <em>postConnect()</em>.</p><p id="r-772913" data-claire-element-id="772913"><strong>Je vous rappelle</strong> aussi que toutes les méthodes reçoivent un objet <em>Doctrine_Event</em> en paramètre.</p><p id="r-772914" data-claire-element-id="772914">Je ne m'attarde pas plus sur les listeners de connexion, ça ne vous sera pas forcément utile pour une utilisation basique.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
<span class="arrow"></span>
<span class="next">Introduction aux Events Listeners</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
<span class="next">Listeners d&#039;objets</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Listenersd039objets"></a><h2>Listeners d&#039;objets</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
<span class="arrow"></span>
<span class="next">Listener de connexion</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
<span class="next">Informations supplémentaires</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-772917" data-claire-element-id="772917">Nous allons voir ici des listeners que vous trouverez certainement plus utiles. Ceux-ci sont appelés par les classes <em>Doctrine_Record</em> et <em>Doctrine_Validator</em>.</p><h2 id="r-creer-un-listener-3" data-claire-element-id="772928">Créer un listener</h2><p id="r-772918" data-claire-element-id="772918">De la même manière que pour les connections, il y a trois façons de créer un listener :</p><ul id="r-772925" data-claire-element-id="772925"><li id="r-772920" data-claire-element-id="772920"><p id="r-772919" data-claire-element-id="772919">hériter de la classe <em>Doctrine_Record_Listener</em> ;</p></li><li id="r-772922" data-claire-element-id="772922"><p id="r-772921" data-claire-element-id="772921">implémenter l'interface <em>Doctrine_Record_Listener_Interface</em> ;</p></li><li id="r-772924" data-claire-element-id="772924"><p id="r-772923" data-claire-element-id="772923">implémenter l'interface <em>Doctrine_Overloadable</em>.</p></li></ul><p id="r-772926" data-claire-element-id="772926">La manière de créer cette classe est identique à <em>Doctrine_Connection</em>, référez-vous donc au chapitre précédent. ;)</p><p id="r-772927" data-claire-element-id="772927">Voici le lien vers la doc pour plus de détails et la liste des méthodes : <a href="http://www.doctrine-project.org/projects/orm/1.2/docs/manual/event-listeners/en#record-listeners">www.doctrine-project.org</a>.</p><h2 id="r-attacher-un-listener-1" data-claire-element-id="772940">Attacher un listener</h2><p id="r-772929" data-claire-element-id="772929">Notre listener peut être attaché au niveau global, au niveau d'une connexion ou au niveau d'une table.</p><h3 id="r-globalement" data-claire-element-id="772932">Globalement</h3><p id="r-772930" data-claire-element-id="772930">Il faut l'attacher à <em>Doctrine_Manager</em>. Toutes les tables de toutes les connexions en bénéficieront alors.</p><pre id="r-772931" data-claire-element-id="772931"><code data-claire-semantic="html+php">&lt;?php

class CustomRecordListener extends Doctrine_Record_Listener
{ /* ... */ }

Doctrine_Manager::getInstance()-&gt;addRecordListener(new CustomRecordListener());</code></pre><h3 id="r-par-connexion" data-claire-element-id="772935">Par connexion</h3><p id="r-772933" data-claire-element-id="772933">En attachant le listener à une instance de <em>Doctrine_Connexion</em>, toutes les tables de <strong>cette</strong> connexion sont affectées.<br/> Néanmoins, je pense que la plupart du temps, vous n'avez qu'une connexion à une seule base de données dans votre projet. Dans ce cas, cela équivaut à l'attacher globalement.</p><pre id="r-772934" data-claire-element-id="772934"><code data-claire-semantic="html+php">&lt;?php
$connexion-&gt;addRecordListener(new CustomRecordListener());</code></pre><h3 id="r-par-table" data-claire-element-id="772939">Par table</h3><p id="r-772936" data-claire-element-id="772936">C'est certainement la fonctionnalité la plus intéressante, ou du moins celle dont vous vous servirez le plus. Il est possible d'attacher un listener à une table particulière.</p><pre id="r-772937" data-claire-element-id="772937"><code data-claire-semantic="html+php">&lt;?php

Doctrine_Core::getTable('Article')
    -&gt;addRecordListener(new CustomRecordListener());

// Équivalent à :

class Article extends Doctrine_Record
{
    public function setUp()
    {
        $this-&gt;addListener(new CustomRecordListener());
    }
}</code></pre><p id="r-772938" data-claire-element-id="772938">Ceci nous sera extrêmement utile, notamment, avec l'utilisation de templates...</p><h2 id="r-les-hooks-2" data-claire-element-id="772944">Les hooks</h2><p id="r-772941" data-claire-element-id="772941">Je vous en avais parlé en introduction, les hooks sont des listeners « simplifiés ». Ce sont de simples méthodes implémentées directement dans l'objet.</p><pre id="r-772942" data-claire-element-id="772942"><code data-claire-semantic="html+php">&lt;?php

class Article extends Doctrine_Record
{
    public function preSave($event)
    {
        // On fait ce que l'on veut juste avant l'enregistrement de l'objet.
    }
}</code></pre><p id="r-772943" data-claire-element-id="772943">Comme vous le voyez, les hooks sont plus simples à utiliser que les listeners. Cependant, lorsque vous devez en utiliser beaucoup, préférez les listeners, cela permet une meilleure organisation du code.</p><h2 id="r-intercepter-les-requetes" data-claire-element-id="772959">Intercepter les requêtes</h2><p id="r-772945" data-claire-element-id="772945">Il existe deux méthodes pour intercepter les requêtes : avec des hooks et dans les listeners.</p><p id="r-772946" data-claire-element-id="772946">Elles sont cependant identiques, et consistent en ces trois méthodes :</p><ul id="r-772953" data-claire-element-id="772953"><li id="r-772948" data-claire-element-id="772948"><p id="r-772947" data-claire-element-id="772947"><strong>preDqlSelect()</strong> est appelée lors d'une requête de type <code data-claire-semantic="sql">SELECT</code> ;</p></li><li id="r-772950" data-claire-element-id="772950"><p id="r-772949" data-claire-element-id="772949"><strong>preDqlUpdate()</strong> est appelée lors d'une requête de type <code data-claire-semantic="sql">UPDATE</code> ;</p></li><li id="r-772952" data-claire-element-id="772952"><p id="r-772951" data-claire-element-id="772951"><strong>preDqlDelete()</strong> est appelée lors d'une requête de type <code data-claire-semantic="sql">DELETE</code>.</p></li></ul><p id="r-772954" data-claire-element-id="772954">Leur fonctionnement est identique aux autres méthodes vues précédemment. Notez cependant que <code>Doctrine_Event::getQuery()</code> retourne dans ce cas la requête elle-même, ce qui offre la possibilité de la modifier.</p><pre id="r-772955" data-claire-element-id="772955"><code data-claire-semantic="html+php">&lt;?php

class CustomRecordListener extends Doctrine_Record_Listener
{
    public function preDqlSelect(Doctrine_Event $event)
    {
        $event-&gt;getQuery()-&gt;addWhere('ce que vous voulez...');
    }
}</code></pre><p id="r-772956" data-claire-element-id="772956">Vous pouvez ainsi filtrer des données lors d'un <code data-claire-semantic="sql">SELECT</code>, par exemple.</p><aside id="r-772958" data-claire-element-id="772958" data-claire-semantic="warning"><p id="r-772957" data-claire-element-id="772957"><strong>Attention !</strong><br/> Par défaut, ces trois méthodes ne sont pas appelées ! Pour les utiliser, il faut le spécifier explicitement, comme ceci : <br/><code data-claire-semantic="html+php">&lt;?php $manager-&gt;setAttribute(Doctrine_Core::ATTR_USE_DQL_CALLBACKS, true)</code>.<br/> En effet, ceci ajoute une surcharge de travail, puisque Doctrine doit, pour chaque requête, appeler ces callbacks pour chaque table incluse dans la clause <code data-claire-semantic="sql">FROM</code>.<br/> Rendez-vous dans la partie Annexes pour plus de détails sur les attributs de <em>Doctrine_Manager</em>.</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
<span class="arrow"></span>
<span class="next">Listener de connexion</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
<span class="next">Informations supplémentaires</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Informationssupplmentaires"></a><h2>Informations supplémentaires</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
<span class="arrow"></span>
<span class="next">Listeners d&#039;objets</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">
<span class="next">Les templates</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-interrompre-l-action-en-cours" data-claire-element-id="772964">Interrompre l'action en cours</h2><p id="r-772961" data-claire-element-id="772961">Il est possible d'annuler totalement l'évènement, grâce à la méthode <code>Doctrine_Event::skipOperation()</code>.</p><pre id="r-772962" data-claire-element-id="772962"><code data-claire-semantic="html+php">&lt;?php

class CustomRecordListener extends Doctrine_Record_Listener
{
    public function preSave(Doctrine_Event $event)
    {
        // Vous faites ce que vous voulez ici...

        $event-&gt;skipOperation();
    }
}

class Article extends Doctrine_Record
{
    public function setUp()
    {
        $this-&gt;addListener(new CustomRecordListener());
    }
}</code></pre><p id="r-772963" data-claire-element-id="772963">Attention, avec cet exemple, vos objets ne pourront pas être enregistrés avec la méthode <em>save()</em>... :D</p><h2 id="r-ne-pas-executer-le-listener-suivant" data-claire-element-id="772969">Ne pas exécuter le listener suivant</h2><p id="r-772965" data-claire-element-id="772965">Lorsque vous ajoutez plusieurs listeners à une classe, il peut être utile, lors de l'appel de l'un d'entre eux, que le suivant (celui qui a été attaché juste après) ne soit pas appelé.<br/> Ceci est permis par <code>Doctrine_Event::skipNextListener()</code>.</p><pre id="r-772966" data-claire-element-id="772966"><code data-claire-semantic="html+php">&lt;?php

class CustomRecordListener1 extends Doctrine_Record_Listener
{
    public function preSave(Doctrine_Event $event)
    {
        /* ... */

        $event-&gt;skipNextListener();
    }
}

class CustomRecordListener2 extends Doctrine_Record_Listener
{
    public function preSave(Doctrine_Event $event)
    { /* ... */ }
}

$record-&gt;addListener(new CustomRecordListener1());
$record-&gt;addListener(new CustomRecordListener2());

$record-&gt;save();</code></pre><p id="r-772967" data-claire-element-id="772967">En temps normal, les méthodes <em>preSave()</em> de chaque listener sont appelées dans l'ordre (<code>CustomRecordListener1::preSave()</code> puis <code>CustomRecordListener2::preSave()</code>). Cependant ici, <code>CustomRecordListener1::preSave()</code> demande de « sauter » le prochain listener. <code>CustomRecordListener2::preSave()</code> ne sera donc jamais exécutée.</p><p id="r-772968" data-claire-element-id="772968">Ce petit chapitre est maintenant terminé et il vous a permis de découvrir les <em>Events Listeners</em> de Doctrine. Bien que ce chapitre soit très théorique, dans le prochain nous étudierons les templates. Ce qui permettra de mettre en pratique avec un TP tout ce que vous avez appris : vous ajouterez un listener à un template... ;)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
<span class="arrow"></span>
<span class="next">Listeners d&#039;objets</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">
<span class="next">Les templates</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lestemplates"></a><h2>Les templates</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
<span class="arrow"></span>
<span class="next">Informations supplémentaires</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
<span class="next">Introduction</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-772972" data-claire-element-id="772972">Nous allons maintenant nous attaquer à une partie importante de Doctrine : les <em>templates</em> (on parle aussi de <em>behavior</em>). <br/> Ces <em>behaviors</em> vont nous être utiles lorsque nous avons plusieurs modèles qui partagent des points communs.<br/> Ces points communs peuvent être :</p><ul id="r-772981" data-claire-element-id="772981"><li id="r-772974" data-claire-element-id="772974"><p id="r-772973" data-claire-element-id="772973">des colonnes de la base de données ;</p></li><li id="r-772976" data-claire-element-id="772976"><p id="r-772975" data-claire-element-id="772975">des algorithmes ;</p></li><li id="r-772978" data-claire-element-id="772978"><p id="r-772977" data-claire-element-id="772977">des relations ;</p></li><li id="r-772980" data-claire-element-id="772980"><p id="r-772979" data-claire-element-id="772979">n'importe quoi d'autre... ^^</p></li></ul><aside id="r-772983" data-claire-element-id="772983" data-claire-semantic="information"><p id="r-772982" data-claire-element-id="772982">Dans ce tutoriel, j'utiliserai indifféremment les termes <em>template</em> ou <em>behavior</em>. Littéralement, <em>template</em> signifie <em>modèle</em> alors que <em>behavior</em> se traduirait par <em>comportement</em>.</p></aside>
</div><a name="Introduction"></a><h2>Introduction</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">
<span class="arrow"></span>
<span class="next">Les templates</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
<span class="next">Utilisation des templates</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-qu-est-ce-qu-un-template" data-claire-element-id="772989">Qu'est-ce qu'un template ?</h2><p id="r-772984" data-claire-element-id="772984">De manière générale, en informatique, un <em>template</em> est un modèle. Comme vous le savez, un programmeur est fainéant (M@teo21 le répète pas mal dans ses tutoriels :D ). Cette fainéantise le pousse à détester une chose plus que tout : la <strong>duplication de code</strong>.</p><p id="r-772985" data-claire-element-id="772985">Cette réécriture de code identique (ou presque) se retrouve dans un grand nombre de concepts différents liés à l'informatique (ou pas, d'ailleurs ;) ), et le principal inconvénient est une baisse de la maintenabilité de l'application.</p><h3 id="r-exemples-28" data-claire-element-id="772988">Exemples</h3><p id="r-772986" data-claire-element-id="772986">Peut-être utilisez-vous un système de templates dans votre application afin de séparer le code PHP de la mise en page (en HTML ou autre). Ceci offre un avantage considérable : l'utilisation, par exemple, d'une page HTML sans se soucier de comment sont récupérées les données. On se contente de les afficher. Cette page HTML (<em>template</em>) peut alors être réutilisée par plusieurs scripts différents, tout comme le script peut envoyer ses informations à plusieurs pages HTML différentes.</p><p id="r-772987" data-claire-element-id="772987">Un autre exemple, qui n'existe pas en PHP dû à son typage dynamique faible, mais dans d'autres langages comme le C++, est le template de fonctions. Cela permet d'outrepasser le fait qu'une fonction ne peut accepter qu'un type de paramètre défini à l'avance. Mais je ne m'étends pas trop là-dessus, puisque nous avons affaire au PHP.</p><h2 id="r-et-doctrine-dans-tout-ca" data-claire-element-id="773004">Et Doctrine dans tout ça ?</h2><h3 id="r-lien-avec-doctrine" data-claire-element-id="772997">Lien avec Doctrine</h3><p id="r-772990" data-claire-element-id="772990">Après ces brèves explications concernant les templates, vous ne voyez peut-être pas le rapport avec Doctrine.<br/> Cherchez bien : où pourrions-nous avoir de la <em>duplication</em> de code dans notre projet ?</p><p id="r-772991" data-claire-element-id="772991">Vous ne voyez pas ? Dans notre schéma pardi ! ;) <br/> Bien souvent, dans une application relativement complète, vos objets devront être datés. Ce peut être le cas d'articles, de commentaires liés à l'article, etc. Prenez par exemple Facebook (au hasard :D ), où toutes les actions sont datées : la mise en ligne de photos, publication de messages, ajout d'amis, participation à des évènements...</p><figure id="r-772993" data-claire-element-id="772994"><img id="r-772992" data-claire-element-id="772992" src="medias/uploads.siteduzero.com_files_255001_256000_255981.png" alt="Image utilisateur"/></figure><p id="r-772995" data-claire-element-id="772995">Imaginez que les développeurs veuillent changer quelque chose dans la gestion de la datation des objets. Vous croyez qu'ils vont s'embêter à modifier toutes les classes une par une ? :o Les pauvres !</p><p id="r-772996" data-claire-element-id="772996">Bref, je vous ai assez fait mariner comme ça. Avec Doctrine, nous allons pouvoir définir des modèles de classes. Lorsque vous aurez plusieurs objets (articles, etc.) à dater, vous aurez juste à dire <em>« je veux le dater ! »</em> et Doctrine s'en occupera automatiquement pour vous. Elle est pas belle la vie ? :-°</p><h3 id="r-quand-dois-je-utiliser-les-templates" data-claire-element-id="773003">Quand dois-je utiliser les templates ?</h3><p id="r-772998" data-claire-element-id="772998">Dès qu'il y a quelque chose de commun entre plusieurs classes, utilisez-les ! Votre application n'en sera que plus simple à maintenir en cas de changement.<br/> Un <em>point commun</em> peut être des colonnes identiques (par exemple, une colonne <em>date</em>), un comportement, des relations, etc.</p><div id="r-773000" data-claire-element-id="773000" data-claire-semantic="question"><p id="r-772999" data-claire-element-id="772999">Je ne comprends pas. D'habitude, lorsque j'ai des points communs entre des classes, j'utilise l'héritage, ce n'est pas comme ça qu'il faut faire ?</p></div><p id="r-773001" data-claire-element-id="773001">Et bien, ça dépend. (Quoi, vous vous attendiez à une autre réponse ? :p )<br/> Lorsque des classes ont entre elles une réelle relation parent-enfant, alors oui, l'héritage est là pour ça et il faut l'utiliser. Mais lorsque ce n'est pas le cas, mais qu'il y a des points communs, il paraît stupide de dupliquer du code. De plus, PHP lui-même, en ne supportant pas l'<em>héritage multiple</em>, nous limite.</p><p id="r-773002" data-claire-element-id="773002">La solution pour pallier cela : les <em>templates</em> ! ;)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">
<span class="arrow"></span>
<span class="next">Les templates</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
<span class="next">Utilisation des templates</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Utilisationdestemplates"></a><h2>Utilisation des templates</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
<span class="arrow"></span>
<span class="next">Introduction</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
<span class="next">Structure d&#039;un template</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-773006" data-claire-element-id="773006">Doctrine propose plusieurs <em>behaviors</em> intégrés par défaut. Nous allons commencer par en étudier quelques-uns afin de voir comment ça marche.</p><aside id="r-773008" data-claire-element-id="773008" data-claire-semantic="warning"><p id="r-773007" data-claire-element-id="773007">J'utiliserai le plus souvent le terme <em>objet</em> pour définir une instance d'une classe du modèle (comme <em>Article</em>), et le terme <em>table</em> pour une instance d'une classe représentant une table (comme <em>ArticleTable</em>). Il s'agit d'un abus de langage, mais ça ne vous gênera pas pour comprendre. ;)</p></aside><h2 id="r-decouverte-des-behaviors" data-claire-element-id="773023">Découverte des behaviors</h2><p id="r-773009" data-claire-element-id="773009">Il est très simple d'appliquer un <em>behavior</em> sur nos objets. Il faut l'indiquer dans le schéma de données.</p><h3 id="r-schema-en-yaml" data-claire-element-id="773015">Schéma en Yaml</h3><p id="r-773010" data-claire-element-id="773010">Il suffit d'une ligne dans le schéma Yaml pour appliquer un behavior :</p><pre id="r-773011" data-claire-element-id="773011"><code>Article:
  actAs:
    Timestampable: ~
  columns:
    title:
      type: string(255)
      notnull: true
# ...</code></pre><p id="r-773012" data-claire-element-id="773012">J'ai pris comme exemple le template nommé <em>Timestampable</em> (nous l'étudierons juste après). Comme vous le voyez, nous ajoutons une clé <em>actAs</em> qui indique la liste des behaviors et de leurs options. Ici, il n'y a pas d'option particulière (d'où le <em>~</em>, qui est équivalent à <em>null</em>, pour rappel).</p><p id="r-773013" data-claire-element-id="773013">Notez que si aucun de vos templates n'a d'option, vous pouvez utiliser la notation simple de tableau :</p><pre id="r-773014" data-claire-element-id="773014"><code>Article:
  actAs: [Timestampable, UnAutreTemplate]
# ...</code></pre><h3 id="r-schema-en-php" data-claire-element-id="773022">Schéma en PHP</h3><p id="r-773016" data-claire-element-id="773016">En PHP, il est recommandé de placer la déclaration dans la méthode <em>setUp()</em> :</p><pre id="r-773017" data-claire-element-id="773017"><code data-claire-semantic="html+php">&lt;?php
class BaseArticle extends Doctrine_Record
{
    /* ... */

    public function setUp()
    {
        /* ... */
 
        $this-&gt;actAs('Timestampable');
    }
}</code></pre><p id="r-773018" data-claire-element-id="773018">Pour ceux qui génèrent les classes de base à partir du Yaml, vous aurez peut-être remarqué que le code généré n'est pas tout à fait identique :</p><pre id="r-773019" data-claire-element-id="773019"><code data-claire-semantic="html+php">&lt;?php
$timestampable0 = new Doctrine_Template_Timestampable();
$this-&gt;actAs($timestampable0);</code></pre><p id="r-773020" data-claire-element-id="773020">C'est un objet qui est passé à la méthode <em>actAs()</em>. En effet, les templates sont des classes nommées de la forme Doctrine_Template_<em>NomDuTemplate</em>. Si vous passez juste son nom, Doctrine essayera de l'instancier lui-même.</p><p id="r-773021" data-claire-element-id="773021">Nous allons maintenant passer en revue les templates intégrés.</p><h2 id="r-timestampable" data-claire-element-id="773054">Timestampable</h2><p id="r-773024" data-claire-element-id="773024">C'est probablement le template le plus connu. Il donne le moyen de dater facilement les objets (date de <em>création</em> et date de <em>mise à jour</em>).</p><p id="r-773025" data-claire-element-id="773025">Tous vos objets déclarés comme <em>timestampables</em> se voient ajouter deux nouvelles colonnes : <em>created_at</em> et <em>updated_at</em>. Notez qu'il est possible de personnaliser leur nom, ou même de n'utiliser que l'une des deux. Jetez un œil :</p><pre id="r-773026" data-claire-element-id="773026"><code># ...
actAs:
  Timestampable:
    created:
      disabled: true
    updated:
      name: updated_date
      onInsert: false
      format: Y-m-d
# ...</code></pre><p id="r-773027" data-claire-element-id="773027">Voici la correspondance en PHP :</p><pre id="r-773028" data-claire-element-id="773028"><code data-claire-semantic="html+php">&lt;?php
/* ... */
$this-&gt;actAs('Timestampable', array(
    'created' =&gt; array(
        'disabled' =&gt; true
    ),
    'updated' =&gt; array(
        'name'     =&gt; 'updated_date',
        'onInsert' =&gt; false,
        'format'   =&gt; 'Y-m-d',
    )
));
/* ... */</code></pre><p id="r-773029" data-claire-element-id="773029">Les options sont passées en deuxième argument de <em>actAs()</em>, qui lui-même les passe au constructeur du template. <br/> Pour voir toutes les options disponibles, je vous invite à ouvrir le fichier ~/lib/vendor/doctrine/Doctrine/Template/Timestampable.php. Les options par défaut sont définies dans l'attribut <code>$_options</code>. Voyez ci-dessous pour quelques explications sur chacune.</p><p id="r-773030" data-claire-element-id="773030">(Notez que cela n'a pas beaucoup de sens de désactiver le champ <em>created_at</em> et de mettre l'option <em>onInsert</em> de <em>updated</em> à <em>false</em>, c'est juste un exemple. ^^ )</p><p id="r-773031" data-claire-element-id="773031">Un template possède un comportement très proche d'un objet. Il a, entre autres, la possibilité d'avoir des listeners. Je ne vous en parle pas plus pour l'instant, vous comprendrez leur fonctionnement lorsque nous en créerons un par la suite. ;) <br/> Sachez simplement que cela donne la possibilité d'intervenir juste avant certains évènements, par exemple juste avant la sauvegarde d'un objet dans la base de données. Et c'est précisément comme ça que le template <em>Timestampable</em> fonctionne : juste avant que vous sauvegardiez votre objet (méthode <em>save()</em> par exemple), Doctrine va mettre à jour ces champs avec la valeur de <em>timestamp</em> courante.</p><p id="r-773032" data-claire-element-id="773032">Vous n'avez donc jamais à vous soucier de ces champs. La seule chose qui compte pour vous, c'est de pouvoir les récupérer.<br/> Et cela se fait tout naturellement en y accédant comme on le ferait pour n'importe quel autre champ :</p><pre id="r-773033" data-claire-element-id="773033"><code data-claire-semantic="html+php">&lt;?php
echo $article-&gt;created_at;</code></pre><p id="r-773034" data-claire-element-id="773034">Rien qu'avec ce premier exemple, assez banal en fait, vous voyez la subtilité et la puissance des <em>behaviors</em>. Doctrine fournit un comportement par défaut qui correspond à la plupart des besoins, mais en même temps vous laisse la possibilité de personnaliser chaque détail.</p><h3 id="r-options-disponibles-1" data-claire-element-id="773053">Options disponibles</h3><p id="r-773035" data-claire-element-id="773035">Les options suivantes sont personnalisables. Elles sont identiques pour chacun des deux champs (<em>created</em> et <em>updated</em>).</p><ul id="r-773052" data-claire-element-id="773052"><li id="r-773037" data-claire-element-id="773037"><p id="r-773036" data-claire-element-id="773036"><strong>name</strong> : le nom de la colonne (par défaut, <em>created_at</em> et <em>updated_at</em>).</p></li><li id="r-773039" data-claire-element-id="773039"><p id="r-773038" data-claire-element-id="773038"><strong>alias</strong> : un alias pour chaque colonne. Par défaut il n'y en a pas.</p></li><li id="r-773041" data-claire-element-id="773041"><p id="r-773040" data-claire-element-id="773040"><strong>type</strong> : type du champ, par défaut <em>timestamp</em>.</p></li><li id="r-773043" data-claire-element-id="773043"><p id="r-773042" data-claire-element-id="773042"><strong>format</strong> : le format (nécessaire pour un champ de type timestamp/date). Par défaut <em>Y-m-d H:i:s</em>.</p></li><li id="r-773045" data-claire-element-id="773045"><p id="r-773044" data-claire-element-id="773044"><strong>disabled</strong> : si égal à <em>true</em>, désactive cette colonne. Vaut <em>false</em> par défaut.</p></li><li id="r-773047" data-claire-element-id="773047"><p id="r-773046" data-claire-element-id="773046"><strong>expression</strong> : donne la possibilité d'utiliser une <em>Doctrine_Expression</em> pour le champ. Désactivé par défaut.</p></li><li id="r-773049" data-claire-element-id="773049"><p id="r-773048" data-claire-element-id="773048"><strong>options</strong> : options à passer pour la définition de la colonne. Par défaut, indique seulement que la colonne ne peut être vide (<code data-claire-semantic="sql">NOTNULL</code>).</p></li><li id="r-773051" data-claire-element-id="773051"><p id="r-773050" data-claire-element-id="773050"><strong>onInsert</strong> : utilisé uniquement sur le champ <em>updated</em>. Indique s'il doit être mis à jour aussi lors de la création de l'objet. Par défaut, vaut <em>true</em>.</p></li></ul><h2 id="r-softdelete" data-claire-element-id="773081">SoftDelete</h2><p id="r-773055" data-claire-element-id="773055">Ne vous êtes-vous jamais dit <em>« Ah mince ! Je voulais le garder ! »</em> après avoir supprimé un article (ou n'importe quoi d'autre) ?<br/> SoftDelete est là pour vous !</p><aside id="r-773057" data-claire-element-id="773057" data-claire-semantic="information"><p id="r-773056" data-claire-element-id="773056">Je ne vais pas remettre à chaque fois le code de l'implémentation Yaml ou PHP, ça fonctionne à chaque fois de la même manière. ;) Seules les options sont variables.</p></aside><p id="r-773058" data-claire-element-id="773058">Ce template vous permet de ne pas supprimer réellement vos objets. Il ajoute une colonne <em>deleted_at</em> dans votre modèle, qui indique la date à laquelle l'objet a été supprimé. <br/> À chaque fois que vous ferez <code data-claire-semantic="html+php">&lt;?php $objet-&gt;delete()</code>, votre objet ne sera pas supprimé. À la place, sa colonne <em>deleted_at</em> sera remplie avec la date courante.</p><div id="r-773060" data-claire-element-id="773060" data-claire-semantic="question"><p id="r-773059" data-claire-element-id="773059">Oui mais c'est pas très pratique tout ça, maintenant à chaque fois que je récupèrerai un objet depuis ma base de données, il faudra que je vérifie s'il a été supprimé ou non. C'est nul ton truc !</p></div><p id="r-773061" data-claire-element-id="773061">Vous croyez donc que notre ORM préféré ne gère pas ça ? Erreur ! ^^ <br/> En effet, ce template ajoute un « filtrage » automatique de tout ce que vous sélectionnez dans la base. Et il ne vous renverra pas les éléments <em>virtuellement</em> supprimés. <br/> De votre côté, vous ne vous en souciez donc vraiment plus.</p><p id="r-773062" data-claire-element-id="773062">Pour cela, il faut changer la valeur d'un attribut de <em>Doctrine_Manager</em> :</p><pre id="r-773063" data-claire-element-id="773063"><code data-claire-semantic="html+php">&lt;?php
Doctrine_Manager::getInstance()
    -&gt;setAttribute(Doctrine_Core::ATTR_USE_DQL_CALLBACKS, true);</code></pre><p id="r-773064" data-claire-element-id="773064">En effet, ce template utilise les <em>callbacks</em> DQL dans un listener. Je ne détaille pas plus pour l'instant, mais si vous avez lu le chapitre précédent, vous devriez comprendre de quoi il s'agit. ;) <br/> Placez ceci dans ~/config/global.php par exemple.</p><aside id="r-773067" data-claire-element-id="773067" data-claire-semantic="information"><p id="r-773065" data-claire-element-id="773065">Notez que vous pouvez quand même récupérer ces enregistrements supprimés : il faut pour cela le spécifier explicitement dans une requête :</p><pre id="r-773066" data-claire-element-id="773066"><code data-claire-semantic="html+php">&lt;?php
$deletedArticles = Doctrine_Query::create()
    -&gt;from('Article a')
    -&gt;where('a.deleted_at IS NOT NULL') // Si deleted_at contient une valeur (une date), c'est que l'article est supprimé.
    -&gt;execute();</code></pre></aside><p id="r-773068" data-claire-element-id="773068">Vous avez aussi la possibilité de supprimer définitivement vos objets :</p><pre id="r-773069" data-claire-element-id="773069"><code data-claire-semantic="html+php">&lt;?php
foreach($deletedArticles as $article)
{
    $article-&gt;hardDelete();
}</code></pre><p id="r-773070" data-claire-element-id="773070">Comme vous le voyez, le template ajoute aussi une méthode <em>hardDelete()</em> aux objets (oui, un template, ça peut faire ça aussi ^^ ). Maintenant, si vous supprimez des enregistrements, c'est parce que vous l'aurez bien voulu ! ^^</p><h3 id="r-options-disponibles-2" data-claire-element-id="773080">Options disponibles</h3><ul id="r-773079" data-claire-element-id="773079"><li id="r-773072" data-claire-element-id="773072"><p id="r-773071" data-claire-element-id="773071"><strong>name</strong> : nom de la colonne. Par défaut, c'est <em>deleted_at</em>.</p></li><li id="r-773074" data-claire-element-id="773074"><p id="r-773073" data-claire-element-id="773073"><strong>type</strong> : type de la colonne, <em>timestamp</em> par défaut. Vous pouvez aussi utiliser <em>boolean</em> pour simplement indiquer si l'article est supprimé ou non, sans la date.</p></li><li id="r-773076" data-claire-element-id="773076"><p id="r-773075" data-claire-element-id="773075"><strong>hardDelete</strong> : indique si les enregistrements doivent être supprimés définitivement. Par défaut, vaut <em>false</em>. Je ne vous conseille pas de le mettre à <em>true</em>, sinon le template n'est pas extrêmement utile...</p></li><li id="r-773078" data-claire-element-id="773078"><p id="r-773077" data-claire-element-id="773077"><strong>options</strong> : options à passer lors de la construction de la colonne.</p></li></ul><h2 id="r-versionable" data-claire-element-id="773098">Versionable</h2><p id="r-773082" data-claire-element-id="773082">Ce template vous donne la possibilité de <em>versionner</em> vos objets.<br/> C'est-à-dire que vous conservez tout l'historique des modifications apportées à chaque objet, et que vous avez à tout moment la possibilité de revenir en arrière et d'annuler des modifications.</p><p id="r-773083" data-claire-element-id="773083">En fait, Doctrine va créer une deuxième table (dont vous ne vous servirez jamais directement), qui va stocker toutes les anciennes versions. Cette table est nommée avec le suffixe '_version'.<br/> Une colonne <em>version</em> est aussi ajoutée, qui stocke le numéro de version de l'objet.</p><p id="r-773084" data-claire-element-id="773084">Du point de vue utilisateur (c'est-à-dire vous ;) ), vous ne vous apercevez de presque rien : vous voyez le numéro de version de votre objet s'incrémenter chaque fois que vous y apportez des modifications et le sauvegardez.</p><p id="r-773085" data-claire-element-id="773085">En interne, à chaque modification/suppression, l'ancienne version est déplacée dans la table dédiée, et la dernière version est enregistrée normalement dans la table avec un numéro de version incrémenté.</p><p id="r-773086" data-claire-element-id="773086">Pour finir, vous avez la possibilité de restaurer une ancienne version, grâce à la méthode <em>revert()</em> :</p><pre id="r-773087" data-claire-element-id="773087"><code data-claire-semantic="html+php">&lt;?php
// Nous restaurons l'objet tel qu'il était dans sa version N°2.
$objet-&gt;revert(2);</code></pre><aside id="r-773089" data-claire-element-id="773089" data-claire-semantic="warning"><p id="r-773088" data-claire-element-id="773088">Attention cependant à ne pas abuser de ce behavior. Le fait d'ajouter une table supplémentaire pour chaque table <em>versionnable</em>, et de sauvegarder toutes les versions, peut finir par faire augmenter considérablement la taille de votre base de données.</p></aside><h3 id="r-options-disponibles-3" data-claire-element-id="773097">Options disponibles</h3><p id="r-773090" data-claire-element-id="773090">Je vous invite, comme toujours, à aller voir les options disponibles dans ~/lib/vendor/doctrine/Doctrine/Template/Versionable.php.</p><p id="r-773091" data-claire-element-id="773091">Voici quelques explications :</p><ul id="r-773096" data-claire-element-id="773096"><li id="r-773093" data-claire-element-id="773093"><p id="r-773092" data-claire-element-id="773092"><strong>generateFiles</strong> : Doctrine génère une classe supplémentaire pour la table de version. Par défaut, ces classes ne sont pas créées « en dur », mais générées à la volée. Vous pouvez forcer à créer ces fichiers en passant cette option à <em>true</em>.</p></li><li id="r-773095" data-claire-element-id="773095"><p id="r-773094" data-claire-element-id="773094"><strong>deleteVersions</strong> : Indique tout simplement si oui ou non les anciennes versions doivent être supprimées lorsque la version actuelle est supprimée, ou si elles doivent être conservées.</p></li></ul><h2 id="r-sluggable" data-claire-element-id="773122">Sluggable</h2><p id="r-773099" data-claire-element-id="773099">Si vous avez déjà eu envie de faire apparaître le titre de vos articles (par exemple) dans leur URL, vous vous êtes sûrement heurté au fait que certains caractères posent problème.</p><p id="r-773100" data-claire-element-id="773100">Doctrine apporte une solution à cela aussi, avec le template <em>Sluggable</em>. Celui-ci va ajouter une colonne <em>slug</em> qui contiendra le titre de vos articles, mais adapté à une URL (suppression des caractères spéciaux, etc.).</p><p id="r-773101" data-claire-element-id="773101">Pour indiquer sur quels champs doit être basé le <em>slug</em>, il faut renseigner l'option <em>fields</em>. Dans le cas de notre article, nous indiquerons par exemple la colonne <em>title</em>.</p><p id="r-773102" data-claire-element-id="773102">Vous avez aussi la possibilité de forcer cette colonne à être unique. De cette manière, vous pourrez retrouver un objet précis sans utiliser son ID, mais uniquement avec son <em>slug</em>. Pour cela, passez l'option <em>unique</em> à <em>true</em>. Si plusieurs objets ont le même slug, alors un chiffre sera ajouté pour les différencier.<br/> Vous avez la possibilité de déterminer un slug unique avec des champs particuliers : indiquez-les avec <em>uniqueBy</em>.</p><h3 id="r-options-disponibles-4" data-claire-element-id="773121">Options disponibles</h3><p id="r-773103" data-claire-element-id="773103">Voici un résumé des options :</p><ul id="r-773120" data-claire-element-id="773120"><li id="r-773105" data-claire-element-id="773105"><p id="r-773104" data-claire-element-id="773104"><strong>unique</strong> : si oui ou non l'unicité du champ doit être garantie. <em>True</em> par défaut.</p></li><li id="r-773107" data-claire-element-id="773107"><p id="r-773106" data-claire-element-id="773106"><strong>fields</strong> : champs à utiliser pour le <em>slug</em>.</p></li><li id="r-773109" data-claire-element-id="773109"><p id="r-773108" data-claire-element-id="773108"><strong>uniqueBy</strong> : champs par lesquels l'unicité est garantie.</p></li><li id="r-773111" data-claire-element-id="773111"><p id="r-773110" data-claire-element-id="773110"><strong>uniqueIndex</strong> : si oui ou non l'index est créé sur la colonne.</p></li><li id="r-773113" data-claire-element-id="773113"><p id="r-773112" data-claire-element-id="773112"><strong>indexName</strong> : nom à donner à l'index.</p></li><li id="r-773115" data-claire-element-id="773115"><p id="r-773114" data-claire-element-id="773114"><strong>canUpdate</strong> : si le slug peut être mis à jour à chaque modification de l'objet, ou s'il est défini une fois pour toutes.</p></li><li id="r-773117" data-claire-element-id="773117"><p id="r-773116" data-claire-element-id="773116"><strong>builder</strong> : fonction à utiliser pour construire le slug.</p></li><li id="r-773119" data-claire-element-id="773119"><p id="r-773118" data-claire-element-id="773118"><strong>provider</strong> : fonction à utiliser pour récupérer une <em>valeur</em> représentative de l'objet pour construire le slug. Est utilisé uniquement si aucun champ n'est indiqué dans l'option <strong>fields</strong>.</p></li></ul>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
<span class="arrow"></span>
<span class="next">Introduction</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
<span class="next">Structure d&#039;un template</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Structured039untemplate"></a><h2>Structure d&#039;un template</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
<span class="arrow"></span>
<span class="next">Utilisation des templates</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">
<span class="next">TP : Création d&#039;un template</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-773124" data-claire-element-id="773124">J'espère que vous voyez maintenant un peu mieux ce qu'est un template, et à quoi il sert. Voyons un peu à présent comment tout cela est structuré. Vous pourrez ainsi créer vos propres templates. Alors, lisez avec attention ce qui suit ! ;)</p><h2 id="r-comment-ca-marche-25" data-claire-element-id="773149">Comment ça marche ?</h2><p id="r-773125" data-claire-element-id="773125">Si vous avez lu le début du paragraphe sur l'utilisation des templates, vous devez vous souvenir qu'un template est une <strong>classe</strong> (par exemple, <em>Doctrine_Template_Timestampable</em>). Ouvrez donc le fichier ~/lib/vendor/doctrine/Doctrine/Template/Timestampable.php si vous ne l'avez pas déjà fait, vous suivrez mieux ce qui va suivre.</p><p id="r-773126" data-claire-element-id="773126">Nous allons étudier cette classe en détail, elle nous servira d'exemple.</p><h3 id="r-doctrine-template" data-claire-element-id="773135">Doctrine_Template</h3><p id="r-773127" data-claire-element-id="773127">Première chose que vous remarquez, elle hérite d'une classe de base : <em>Doctrine_Template</em>. Cette classe fournit les éléments essentiels au template :</p><ul id="r-773134" data-claire-element-id="773134"><li id="r-773129" data-claire-element-id="773129"><p id="r-773128" data-claire-element-id="773128">Des <em>mutateurs</em> pour accéder à l'<em>invoker</em>, c'est-à-dire le dernier enregistrement à avoir utilisé ce template : <strong>setInvoker($invoker)</strong> et <strong>getInvoker()</strong>.</p></li><li id="r-773131" data-claire-element-id="773131"><p id="r-773130" data-claire-element-id="773130">La possibilité d'utiliser un plug-in. Un plug-in est utile lorsque le template implique de faire appel à un fonctionnement relativement complexe. Par exemple, le template <em>Doctrine_Template_Searchable</em> (je ne vous en ai pas encore parlé) fait appel à <em>Doctrine_Search</em>. Le fonctionnement de ce plug-in est indépendant du template, et peut être utilisé de l'extérieur. Je vous laisse trouver les méthodes correspondantes... :p (<code>Doctrine_Template::getPlugin()</code> etc.)</p></li><li id="r-773133" data-claire-element-id="773133"><p id="r-773132" data-claire-element-id="773132">Un accesseur vers la table de l'invoker : <em>getTable()</em>. On récupère simplement une instance de <em>Doctrine_Table</em>.</p></li></ul><h3 id="r-heritage-5" data-claire-element-id="773142">Héritage</h3><p id="r-773136" data-claire-element-id="773136"><em>Doctrine_Template</em> possède aussi deux méthodes vides : <em>setUp()</em> et <em>setTableDefinition()</em>.<br/> Comme pour le modèle, ces méthodes servent à définir, entre autres, la table et les relations.</p><p id="r-773137" data-claire-element-id="773137">Les méthodes <em>hasColumn()</em>, <em>hasOne()</em>, <em>hasMany()</em>... sont à utiliser ici.</p><p id="r-773138" data-claire-element-id="773138">Et là vous allez me dire...</p><div id="r-773140" data-claire-element-id="773140" data-claire-semantic="question"><p id="r-773139" data-claire-element-id="773139">Eh ! Mais ça ressemble pas un peu à <em>Doctrine_Record</em> ça ?</p></div><p id="r-773141" data-claire-element-id="773141">Si !</p><h3 id="r-lien-avec-doctrine-record" data-claire-element-id="773148">Lien avec Doctrine_Record</h3><p id="r-773143" data-claire-element-id="773143">Si vous êtes un tant soit peu curieux, vous aurez remarqué que <em>Doctrine_Template</em> et <em>Doctrine_Record</em> étendent tous les deux... <em>Doctrine_Record_Abstract</em> !</p><figure id="r-773145" data-claire-element-id="773146"><img id="r-773144" data-claire-element-id="773144" src="medias/uploads.siteduzero.com_files_256001_257000_256500.png" alt="Image utilisateur"/></figure><p id="r-773147" data-claire-element-id="773147">En effet, il faut bien comprendre qu'un objet est fusionné avec les templates qui lui sont associés (c'est une image hein ^^ ). Cela lui permet de partager tout ce que l'on vient de voir, comme des relations, etc. ainsi que des méthodes !</p><h2 id="r-methodes-deleguees" data-claire-element-id="773167">Méthodes déléguées</h2><p id="r-773150" data-claire-element-id="773150">Un template offre la possibilité d'ajouter des méthodes aux objets et aux tables.</p><h3 id="r-ajout-de-methodes-aux-objets" data-claire-element-id="773157">Ajout de méthodes aux objets</h3><p id="r-773151" data-claire-element-id="773151">Il existe un moyen très simple d'ajouter des méthodes à nos objets : je vous ai dit qu'il fallait considérer un objet et ses templates comme étant fusionnés. Il suffit donc de définir une méthode dans un template, pour qu'elle soit accessible dans tous les objets l'implémentant !</p><pre id="r-773152" data-claire-element-id="773152"><code data-claire-semantic="html+php">&lt;?php

class Doctrine_Template_Timestampable extends Doctrine_Template
{
    /* ... */

    public function isOlderThan($date)
    {
        $date    = new DateTime($date);
        $created = new DateTime($this-&gt;getInvoker()-&gt;{$this-&gt;_options['created']['name']});

        return $date-&gt;getTimestamp() &gt; $created-&gt;getTimestamp();
    }
}</code></pre><p id="r-773153" data-claire-element-id="773153">Nous imaginons ici une méthode <em>isOlderThan()</em> qui indique si la date de création de l'objet est plus ancienne que la date passée en paramètre.</p><p id="r-773154" data-claire-element-id="773154">Maintenant, nous pouvons utiliser cette méthode comme ceci :</p><pre id="r-773155" data-claire-element-id="773155"><code data-claire-semantic="html+php">&lt;?php

if($article-&gt;isOlderThan(&quot;yesterday&quot;)) {
  echo &quot;Cet article a été publié avant hier.&quot;;
}
else {
  echo &quot;Cet article a été publié hier ou aujourd'hui.&quot;;
}</code></pre><p id="r-773156" data-claire-element-id="773156">Difficile de faire plus simple, non ? :D</p><h3 id="r-ajout-de-methodes-aux-tables" data-claire-element-id="773166">Ajout de méthodes aux tables</h3><p id="r-773158" data-claire-element-id="773158">Vous avez aussi la possibilité d'ajouter des méthodes aux classes représentant les tables (<em>ArticleTable</em>, etc.).<br/> Il y a simplement une petite subtilité pour les différencier.</p><p id="r-773159" data-claire-element-id="773159">Voyez plutôt :</p><pre id="r-773160" data-claire-element-id="773160"><code data-claire-semantic="html+php">&lt;?php

class Doctrine_Template_Publishable extends Doctrine_Template
{
    /* ... */

    public function findArticlesOlderThanTableProxy($date)
    {
        $date = new DateTime($date);

        return $this-&gt;getTable()
          -&gt;createQuery('a')
          -&gt;where('a.'.$this-&gt;_options['created']['name'].' &lt; ?', $date-&gt;getTimestamp())
          -&gt;execute();
    }
}</code></pre><p id="r-773161" data-claire-element-id="773161">Vous l'aurez deviné, lorsque vous voulez rendre accessible une méthode depuis la classe de table, il faut suffixer son nom de <em>TableProxy</em>.</p><p id="r-773162" data-claire-element-id="773162">Et vous pouvez l'utiliser comme ceci :</p><pre id="r-773163" data-claire-element-id="773163"><code data-claire-semantic="html+php">&lt;?php
$table = Doctrine_Core::getTable('Article');

// Ne pas mettre 'TableProxy' lors de l'utilisation de la méthode.
$articles = $table-&gt;findArticlesOlderThan(&quot;yesterday&quot;);</code></pre><p id="r-773164" data-claire-element-id="773164">J'espère vous avoir mis l'eau à la bouche avec ce chapitre, parce que maintenant, tout ceci va être mis en pratique. ;)</p><p id="r-773165" data-claire-element-id="773165">Dans le prochain chapitre, vous créerez votre propre template. Un lien sera également fait avec le chapitre précédent, en lui attachant un listener.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
<span class="arrow"></span>
<span class="next">Utilisation des templates</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">
<span class="next">TP : Création d&#039;un template</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="TPCrationd039untemplate"></a><h2>TP : Création d&#039;un template</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
<span class="arrow"></span>
<span class="next">Structure d&#039;un template</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
<span class="next">Créer son propre template</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-773170" data-claire-element-id="773170">Les deux chapitres précédents étaient assez théoriques. Ici, vous allez mettre en pratique tout ça ! ;)</p>
</div><a name="Crersonpropretemplate"></a><h2>Créer son propre template</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">
<span class="arrow"></span>
<span class="next">TP : Création d&#039;un template</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
<span class="next">Correction : le template</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-773171" data-claire-element-id="773171">Maintenant que vous voyez un peu comment les templates fonctionnent, et à quoi ils servent, vous allez certainement vouloir en créer de nouveaux adaptés à vos besoins.</p><h2 id="r-introduction-11" data-claire-element-id="773176">Introduction</h2><p id="r-773172" data-claire-element-id="773172">Nous allons détailler ici toutes les étapes de la création de notre template. <br/> Je vais continuer avec l'exemple de notre article, que j'utilise depuis le début du tutoriel. Nous voulons maintenant que le nom de l'auteur original (celui qui a créé l'article), et le nom de la dernière personne à l'avoir modifié, soient enregistrés automatiquement.<br/> Nous allons aussi ajouter un champ qui indiquera si l'article est disponible ou non en lecture pour les visiteurs. Le fonctionnement ressemblera à <em>SoftDelete</em> et cela permettra d'assimiler un peu mieux le fonctionnement des évènements.</p><p id="r-773173" data-claire-element-id="773173">Je vous propose de nommer notre template <strong>Publishable</strong>. ;)</p><aside id="r-773175" data-claire-element-id="773175" data-claire-semantic="information"><p id="r-773174" data-claire-element-id="773174">Avant de commencer, vous pouvez supprimer la colonne <em>user_id</em> et la relation Article-User que nous avons définies dans le schéma. N'oubliez pas ensuite de tout reconstruire en appelant ~/web/builder.php.</p></aside><h2 id="r-creation-de-la-classe-3" data-claire-element-id="773183">Création de la classe</h2><p id="r-773177" data-claire-element-id="773177">Je vous ai dit dans le chapitre précédent que le fonctionnement des <em>templates</em> ressemblait à celui des objets <em>Doctrine_Record</em>. Et pour cause : <em>Doctrine_Template</em> hérite de la même classe de base, <em>Doctrine_Record_Abstract</em>.<br/> Ils utilisent donc les mêmes méthodes pour se configurer : <em>setUp()</em> et <em>setTableDefinition()</em>.</p><p id="r-773178" data-claire-element-id="773178">Nous définirons donc les colonnes à ajouter à l'intérieur de <em>setTableDefinition()</em>, tandis que <em>setUp()</em> servira à définir les relations.</p><p id="r-773179" data-claire-element-id="773179">Nous allons placer tous nos templates dans ~/lib/models/templates/.</p><pre id="r-773180" data-claire-element-id="773180"><code data-claire-semantic="html+php">&lt;?php

class Doctrine_Template_Publishable extends Doctrine_Template
{ }</code></pre><aside id="r-773182" data-claire-element-id="773182" data-claire-semantic="information"><p id="r-773181" data-claire-element-id="773181">Notez que j'ai préfixé le nom du template de <em>Doctrine_Template_</em>, mais vous n'y êtes pas obligés. Si vous utilisez un préfixe particulier dans votre projet, vous pouvez tout à fait l'utiliser, ou même l'appeler <em>Publishable</em> tout court. <br/> Seul petit détail : si vous placez un préfixe (autre que <em>Doctrine_Template_</em>), il vous faudra utiliser le nom complet lors de la définition avec <em>actAs()</em>, sinon Doctrine ne pourra pas le trouver et le charger automatiquement. À moins de définir votre propre autoloader... mais ça n'entre pas dans le cadre de ce cours. Bref, vous faites comme vous voulez. ;)</p></aside><h2 id="r-details-supplementaires" data-claire-element-id="773187">Détails supplémentaires</h2><p id="r-773184" data-claire-element-id="773184">Vous avez le code de base de la classe, maintenant, à vous de jouer ! ;)</p><p id="r-773185" data-claire-element-id="773185">Trois colonnes seront nécessaires pour ce template. Nommez-les comme vous le voulez. ;) Deux d'entre elles contiendront des références à des utilisateurs (par exemple leur <em>ID</em>). La troisième sera simplement de type booléen.</p><p id="r-773186" data-claire-element-id="773186">Notez qu'il n'est pas obligatoire du tout d'utiliser l'attribut <em>$_options</em>. Néanmoins, je vous encourage à le faire, la personnalisation depuis le schéma étant impossible sinon. À vous de choisir quelles options implémenter (aidez-vous des options « classiques » que vous trouverez dans les autres templates existants ;) ).<br/> Les colonnes supplémentaires sont à ajouter dans la méthode <em>setTableDefinition()</em>, et les relations à l'intérieur de <em>setUp()</em>.</p><h2 id="r-ajout-d-un-listener" data-claire-element-id="773191">Ajout d'un listener</h2><p id="r-773188" data-claire-element-id="773188">Je vous propose d'ajouter un listener au template. Il servira notamment pour la mise à jour automatique de l'auteur de l'article.</p><p id="r-773189" data-claire-element-id="773189">Pour rappel, il doit hériter de <em>Doctrine_Record_Listener</em>.<br/> Créez un répertoire ~/lib/models/templates/listeners/. Nous placerons nos listeners ici.<br/> Je vous propose d'appeler notre classe Doctrine_Template_Listener_Publishable.</p><p id="r-773190" data-claire-element-id="773190">Pour le construire, commencez par vous demander quelles méthodes seront utiles (c'est-à-dire quels évènements intercepter).</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">
<span class="arrow"></span>
<span class="next">TP : Création d&#039;un template</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
<span class="next">Correction : le template</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Correctionletemplate"></a><h2>Correction : le template</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
<span class="arrow"></span>
<span class="next">Créer son propre template</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
<span class="next">Correction : le listener</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-773193" data-claire-element-id="773193">Vous avez bien travaillé ? Vous n'avez pas trouvé comment faire ?</p><p id="r-773194" data-claire-element-id="773194">Voici ci-dessous la correction détaillée.</p><h2 id="r-les-options-5" data-claire-element-id="773198">Les options</h2><p id="r-773195" data-claire-element-id="773195">Tout d'abord, voici un exemple d'options possibles. Bien sûr, ce n'est pas LA correction unique, vous mettez les options que vous voulez ! ;)</p><pre id="r-773196" data-claire-element-id="773196"><code data-claire-semantic="html+php">&lt;?php

class Doctrine_Template_Publishable extends Doctrine_Template
{
    protected $_options = array(
        'created' =&gt; array(
            // Nom de la colonne 'auteur original'.
            'name'     =&gt; 'created_by',
            // Alias. On pourra faire $article-&gt;OriginalAuthor.
            'alias'    =&gt; 'OriginalAuthor',
            // Classe représentant un auteur.
            'class'    =&gt; 'User',
            // Champ de la classe User servant à la relation.
            'foreign'  =&gt; 'id',
            // Type du champ, on stocke l'ID, donc integer.
            'type'     =&gt; 'integer',
            // On donne la possibilité de ne pas utiliser cette colonne.
            'disabled' =&gt; false,
            // Options supplémentaires pour la colonne (notnull, default, etc.).
            'options'  =&gt; array(),
        ),
        // Mêmes options pour la colonne du dernier auteur.
        'updated' =&gt; array(
            'name'     =&gt; 'updated_by',
            'alias'    =&gt; 'Author',
            'class'    =&gt; 'User',
            'foreign'  =&gt; 'id',
            'type'     =&gt; 'integer',
            'disabled' =&gt; false,
            'options'  =&gt; array(),
        ),
        // Options pour la colonne 'publiable'.
        'publishable' =&gt; array(
            'name'     =&gt; 'is_publishable',
            'alias'    =&gt; null,
            'type'     =&gt; 'boolean',
            'disabled' =&gt; false,
            // Par défaut, l'article sera publiable.
            'options'  =&gt; array('notnull' =&gt; true, 'default' =&gt; true),
        ),
    );

    /* ... */
}</code></pre><p id="r-773197" data-claire-element-id="773197">Comme vous le voyez, j'ai repris les options présentes dans la plupart des templates : on donne la possibilité de désactiver certaines colonnes, d'ajouter des alias pour accéder aux auteurs, etc.<br/> L'option <em>class</em> indique quelle classe sera utilisée pour la relation (c'est-à-dire celle qui représente un auteur, un membre, etc. : toute personne susceptible de rédiger l'article), et <em>foreign</em> indique le nom de la colonne sur laquelle la relation est définie (par défaut, <em>id</em>).</p><h2 id="r-les-colonnes-4" data-claire-element-id="773202">Les colonnes</h2><p id="r-773199" data-claire-element-id="773199">Nous allons, comme nous l'avons dit, ajouter deux champs à notre table. Il n'y a rien d'extraordinaire, c'est exactement pareil que lors de la définition du schéma dans les classes de base.</p><pre id="r-773200" data-claire-element-id="773200"><code data-claire-semantic="html+php">&lt;?php

class Doctrine_Template_Publishable extends Doctrine_Template
{
    /* ... */

    public function setTableDefinition()
    {
        if(!$this-&gt;_options['created']['disabled']) {
            $this-&gt;hasColumn(
                $this-&gt;_options['created']['name'],
                $this-&gt;_options['created']['type'],
                null,
                $this-&gt;_options['created']['options']
            );
        }
  
        if(!$this-&gt;_options['updated']['disabled']) {
            $this-&gt;hasColumn(
                $this-&gt;_options['updated']['name'],
                $this-&gt;_options['updated']['type'],
                null,
                $this-&gt;_options['updated']['options']
            );
        }
  
        if(!$this-&gt;_options['publishable']['disabled']) {
            $name = $this-&gt;_options['publishable']['name'];
            if($this-&gt;_options['publishable']['alias']) {
                $name .= ' as '.$this-&gt;_options['publishable']['alias'];
            }
      
            $this-&gt;hasColumn(
                $name,
                $this-&gt;_options['publishable']['type'],
                null,
                $this-&gt;_options['publishable']['options']
            );
        }
    }
  
    /* ... */
}</code></pre><p id="r-773201" data-claire-element-id="773201">Nous vérifions pour chaque élément qu'il n'est pas désactivé, et nous ajoutons la colonne au modèle en conséquence, en utilisant les options définies plus haut. Encore une fois, rien de spécial, la définition des colonnes se fait de la même manière que dans les classes de base.</p><h2 id="r-les-relations-3" data-claire-element-id="773208">Les relations</h2><p id="r-773203" data-claire-element-id="773203">Nous avons choisi d'enregistrer l'ID de l'auteur original, et l'ID du dernier auteur à avoir modifié l'article. Nous allons donc définir deux relations dans la méthode <em>setUp()</em>.</p><pre id="r-773204" data-claire-element-id="773204"><code data-claire-semantic="html+php">&lt;?php

class Doctrine_Template_Publishable extends Doctrine_Template
{
    /* ... */

    public function setUp()
    {
        if(!$this-&gt;_options['created']['disabled']) {
            $name = $this-&gt;_options['created']['class'];
            if($this-&gt;_options['created']['alias']) {
                $name .= ' as '.$this-&gt;_options['created']['alias'];
            }
      
            $this-&gt;hasOne($name, array(
                'local'   =&gt; $this-&gt;_options['created']['name'],
                'foreign' =&gt; $this-&gt;_options['created']['foreign']
            ));
        }

        if(!$this-&gt;_options['updated']['disabled']) {
            $name = $this-&gt;_options['updated']['class'];
            if($this-&gt;_options['updated']['alias']) {
                $name .= ' as '.$this-&gt;_options['updated']['alias'];
            }
      
            $this-&gt;hasOne($name, array(
                'local'   =&gt; $this-&gt;_options['updated']['name'],
                'foreign' =&gt; $this-&gt;_options['updated']['foreign']
            ));
        }
    }
}</code></pre><p id="r-773205" data-claire-element-id="773205">Une fois encore, la manière d'indiquer les relations ne diffère pas de lors de la définition du schéma. L'option <em>name</em> est utilisée en tant que clé locale, et <em>foreign</em> en tant que clé étrangère. <em>class</em> indique la classe à lier, et <em>alias</em> un éventuel alias (par défaut, <em>OriginalAuthor</em> et <em>Author</em>).</p><p id="r-773206" data-claire-element-id="773206">Voilà, à ce stade, nous avons défini toutes les colonnes et relations nécessaires à notre template. Nous pouvons par exemple accéder au login de la dernière personne ayant modifié un article :</p><pre id="r-773207" data-claire-element-id="773207"><code data-claire-semantic="html+php">&lt;?php

echo $article-&gt;Author-&gt;login;

$article-&gt;Author = $monObjetUser;</code></pre>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
<span class="arrow"></span>
<span class="next">Créer son propre template</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
<span class="next">Correction : le listener</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Correctionlelistener"></a><h2>Correction : le listener</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
<span class="arrow"></span>
<span class="next">Correction : le template</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
<span class="next">Conclusion</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-773210" data-claire-element-id="773210">Sans le listener associé, notre template serait bien peu pratique. ^^</p><p id="r-773211" data-claire-element-id="773211">Réfléchissons à ce que nous voulons obtenir.</p><ul id="r-773218" data-claire-element-id="773218"><li id="r-773213" data-claire-element-id="773213"><p id="r-773212" data-claire-element-id="773212">Nous voulons que l'auteur soit ajouté lors du premier enregistrement de notre article. La méthode à utiliser est <strong>preInsert()</strong>.</p></li><li id="r-773215" data-claire-element-id="773215"><p id="r-773214" data-claire-element-id="773214">Nous voulons aussi qu'à chaque modification, le nom de l'auteur soit également mis à jour. Nous nous servirons de <strong>preUpdate()</strong>. <strong>preDqlUpdate()</strong> sera aussi utilisé, lorsque la mise à jour est effectuée depuis une requête DQL (construite à la main, reportez-vous au chapitre sur la manipulation des données pour plus de détails ;) ).</p></li><li id="r-773217" data-claire-element-id="773217"><p id="r-773216" data-claire-element-id="773216">Pour filtrer automatiquement les articles non publiables afin qu'ils n'apparaissent pas lors d'une sélection de données, <strong>preDqlSelect()</strong> sera ici utile.</p></li></ul><p id="r-773219" data-claire-element-id="773219">Voyons dès à présent le code de base de la classe :</p><pre id="r-773220" data-claire-element-id="773220"><code data-claire-semantic="html+php">&lt;?php

class Doctrine_Template_Listener_Publishable extends Doctrine_Record_Listener
{
    protected $_options = array();
  
    public function __construct(array $options)
    {
        $this-&gt;_options = $options;
    }
  
    public function preInsert(Doctrine_Event $event)
    { }
  
    public function preUpdate(Doctrine_Event $event)
    { }
  
    public function preDqlUpdate(Doctrine_Event $event)
    { }

    public function preDqlSelect(Doctrine_Event $event)
    { }

    protected function getCurrentUserId()
    {
        // À adapter à votre projet, bien sûr
        return $_SESSION['user_id'];
    }
}</code></pre><p id="r-773221" data-claire-element-id="773221">Nous avons défini nos quatre méthodes. Nous récupérons aussi les options du template dans l'attribut <code>$_options</code> car nous en aurons besoin.</p><p id="r-773222" data-claire-element-id="773222">Chacune de ces méthodes reçoit en paramètre l'objet <em>Doctrine_Event</em> représentant l'évènement. Il nous sera possible de récupérer les objets concernés à partir de celui-ci.</p><p id="r-773223" data-claire-element-id="773223">Notez que nous savons déjà que l'on va avoir besoin de connaître l'utilisateur courant (celui qui rédige et sauvegarde l'article). Le rôle de la méthode <em>getCurrentUserId()</em> est de nous renvoyer... son ID. :) Bien entendu, la manière de le récupérer va différer selon votre projet. À vous d'adapter cela. ;)</p><aside id="r-773225" data-claire-element-id="773225" data-claire-semantic="information"><p id="r-773224" data-claire-element-id="773224">S'il y en a parmi vous qui utilisent <strong>Symfony</strong>, vous pourrez le récupérer avec quelque chose de similaire à <code data-claire-semantic="html+php">&lt;?php sfContext::getInstance()-&gt;getUser()-&gt;getId();</code>.</p></aside><h2 id="r-pre-insertion-d-un-article" data-claire-element-id="773231">Pré-insertion d'un article</h2><p id="r-773226" data-claire-element-id="773226">Nous allons ici travailler dans la méthode <em>preInsert()</em>, c'est-à-dire lors du premier enregistrement de l'article.</p><pre id="r-773227" data-claire-element-id="773227"><code data-claire-semantic="html+php">&lt;?php

class Doctrine_Template_Listener_Publishable extends Doctrine_Record_Listener
{
    /* ... */
  
    public function preInsert(Doctrine_Event $event)
    {
        // On récupère ce dont on aura besoin.
        $invoker        = $event-&gt;getInvoker();
        $invokerTable   = $invoker-&gt;getTable();
        $modifiedFields = $invoker-&gt;getModified();

        // Si cette colonne n'est pas désactivée :
        if(!$this-&gt;_options['created']['disabled']) {
            $createdField = $invokerTable-&gt;getFieldName($this-&gt;_options['created']['name']);

            // On s'assure que le champ n'a pas été modifié manuellement.
            if(!isset($modifiedFields[$createdField])) {
                // On met le champ à jour.
                $invoker-&gt;$createdField = $this-&gt;getCurrentUserId();
            }
        }

        // Si cette colonne n'est pas désactivée :
        if(!$this-&gt;_options['updated']['disabled']) {
            $updatedField = $invokerTable-&gt;getFieldName($this-&gt;_options['updated']['name']);
    
            // On s'assure que le champ n'a pas été modifié manuellement.
            if(!isset($modifiedFields[$updatedField])) {
                // On met le champ à jour.
                $invoker-&gt;$updatedField = $this-&gt;getCurrentUserId();
            }
        }
    }
  
    /* ... */
}</code></pre><p id="r-773228" data-claire-element-id="773228">L'objet <code>$event</code> est capable de nous retourner l'objet concerné avec la méthode <em>getInvoker()</em>. <em>Doctrine_Record</em> possède une méthode <em>getTable()</em> qui nous retourne une instance de cette table (donc, la classe <em>ArticleTable</em>).</p><p id="r-773229" data-claire-element-id="773229">Petit détail<br/> La méthode <em>Doctrine_Record::getModified()</em> retourne la liste des champs de l'objet qui ont été modifiés. <br/> Avant de mettre à jour les champs concernant l'auteur, nous vérifions que ceux-ci n'ont pas été modifiés manuellement (pour une quelconque raison). Si c'est le cas, alors on ne les modifie pas.</p><p id="r-773230" data-claire-element-id="773230">Enfin, si la colonne n'est pas désactivée (souvenez-vous que nous avons connaissance des options du template), on la met à jour en récupérant l'ID de l'utilisateur courant.</p><h2 id="r-mise-a-jour-d-un-article" data-claire-element-id="773242">Mise à jour d'un article</h2><p id="r-773232" data-claire-element-id="773232">Lors de la mise à jour d'un article, nous modifions seulement la valeur de la colonne <em>updated</em>.<br/> Nous allons ici travailler sur deux méthodes : <em>preUpdate()</em> lors d'une mise à jour par l'objet directement, et <em>preDqlUpdate()</em> lors d'une mise à jour par l'intermédiaire d'une requête DQL.</p><h3 id="r-premier-cas-avec-doctrine-record" data-claire-element-id="773235">Premier cas : avec Doctrine_Record</h3><p id="r-773233" data-claire-element-id="773233">Commençons par <em>preUpdate()</em>. C'est identique à précédemment.</p><pre id="r-773234" data-claire-element-id="773234"><code data-claire-semantic="html+php">&lt;?php

class Doctrine_Template_Listener_Publishable extends Doctrine_Record_Listener
{
    /* ... */

    public function preUpdate(Doctrine_Event $event)
    {
        // On récupère ce dont on aura besoin.
        $invoker        = $event-&gt;getInvoker();
        $invokerTable   = $invoker-&gt;getTable();
        $modifiedFields = $invoker-&gt;getModified();

        // Si cette colonne n'est pas désactivée :
        if(!$this-&gt;_options['updated']['disabled']) {
            $updatedField = $invokerTable-&gt;getFieldName($this-&gt;_options['updated']['name']);
     
            // On s'assure que le champ n'a pas été modifié manuellement.
            if(!isset($modifiedFields[$updatedField])) {
                // On met le champ à jour.
                $invoker-&gt;$updatedField = $this-&gt;getCurrentUserId();
            }
        }
    }

    /* ... */
}</code></pre><h3 id="r-second-cas-avec-doctrine-query" data-claire-element-id="773241">Second cas : avec Doctrine_Query</h3><p id="r-773236" data-claire-element-id="773236">Voyons maintenant comment gérer ça lors d'une requête DQL :</p><pre id="r-773237" data-claire-element-id="773237"><code data-claire-semantic="html+php">&lt;?php

class Doctrine_Template_Listener_Publishable extends Doctrine_Record_Listener
{
    /* ... */

    public function preDqlUpdate(Doctrine_Event $event)
    {
        // Si cette colonne n'est pas désactivée :
        if(!$this-&gt;_options['updated']['disabled']) {
            // On récupère ce dont on aura besoin.
            $invokerTable = $event-&gt;getInvoker()-&gt;getTable();
            $params       = $event-&gt;getParams();
            $updatedField = $invokerTable-&gt;getFieldName($this-&gt;_options['updated']['name']);
            $q            = $event-&gt;getQuery();
            $field        = $params['alias'].'.'.$updatedField;  // Contient par exemple 'a.updated_by'

            // On s'assure que le champ n'a pas été modifié manuellement.
            if(!$q-&gt;contains($field)) {
                // On met le champ à jour.
                $q-&gt;set($field, '?', $this-&gt;getCurrentUserId());
            }
        }
    }

    /* ... */
}</code></pre><p id="r-773238" data-claire-element-id="773238">L'objet <code>$event</code> nous permet de récupérer la requête associée avec <em>getQuery()</em>. <code>$params</code> contient... des paramètres ! En l'occurrence, nous nous intéressons à <code>$params['alias']</code> qui contient l'alias utilisé dans la requête (que j'appelle souvent 'a'). Notez par la même occasion que l'alias principal de la requête peut aussi être récupéré avec <code data-claire-semantic="html+php">&lt;?php $q-&gt;getRootAlias()</code>.</p><p id="r-773239" data-claire-element-id="773239">Pour nous assurer que le champ n'a pas été modifié à la main, et ne pas écraser les modifications, nous vérifions que la requête ne le contient pas avec <em>Doctrine_Query::contains()</em>. Si tout est bon, alors on peut l'ajouter à notre requête avec <em>set()</em>.</p><p id="r-773240" data-claire-element-id="773240">Voilà, à ce stade, à chaque fois que l'on créera/modifiera un article, le nom de l'auteur original et du dernier à l'avoir modifié seront automatiquement renseignés. Magique, non ? ;)</p><h2 id="r-selection-d-articles" data-claire-element-id="773247">Sélection d'articles</h2><p id="r-773243" data-claire-element-id="773243">Reste un détail. Nous ne voulons pas qu'un article marqué comme supprimé apparaisse lorsque nous effectuons des sélections dans la base. Il nous faut pour ça modifier la requête à la volée.<br/> Utilisons <em>preDqlSelect()</em> :</p><pre id="r-773244" data-claire-element-id="773244"><code data-claire-semantic="html+php">&lt;?php

class Doctrine_Template_Listener_Publishable extends Doctrine_Record_Listener
{
    /* ... */
  
    public function preDqlSelect(Doctrine_Event $event)
    {
        // Si cette colonne n'est pas désactivée :
        if(!$this-&gt;_options['publishable']['disabled']) {
            // On récupère ce dont on aura besoin.
            $q      = $event-&gt;getQuery();
            $params = $event-&gt;getParams();
            $field  = $params['alias'].'.'.$this-&gt;_options['publishable']['name'];
    
            // On vérifie qu'il faille appliquer la restriction.
            if(!$q-&gt;contains($field)) {
                $q-&gt;andWhere($field.' = ?', true);
            }
        }
    }
  
    /* ... */
}</code></pre><p id="r-773245" data-claire-element-id="773245">Premièrement, nous nous assurons que la colonne est activée, et nous récupérons les objets dont nous avons besoin.<br/> Ensuite, on s'assure que la requête ne contient pas déjà ce champ, et on ajoute une condition sur celui-ci.</p><p id="r-773246" data-claire-element-id="773246">Et bien, chers amis, j'ai une bonne nouvelle, notre listener est terminé ! :)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
<span class="arrow"></span>
<span class="next">Correction : le template</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
<span class="next">Conclusion</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Conclusion"></a><h2>Conclusion</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
<span class="arrow"></span>
<span class="next">Correction : le listener</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">
<span class="next">Personnalisation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-773249" data-claire-element-id="773249">Notre template ainsi que son listener sont maintenant opérationnels. :soleil:</p><h3 id="r-liaison-des-composants" data-claire-element-id="773253">Liaison des composants</h3><p id="r-773250" data-claire-element-id="773250">Il reste juste une chose à régler : l'utiliser dans le template ! En effet, nous n'avons pas encore indiqué au template qu'il doit l'utiliser.</p><p id="r-773251" data-claire-element-id="773251">La méthode <em>addListener()</em> est là pour ça. Mais vous le saviez déjà, non ? <br/> Nous l'appellerons dans <em>setTableDefinition()</em> :</p><pre id="r-773252" data-claire-element-id="773252"><code data-claire-semantic="html+php">&lt;?php

class Doctrine_Template_Publishable extends Doctrine_Template
{
    /* ... */

    public function setTableDefinition()
    {
        /* ... */

        $this-&gt;addListener(new Doctrine_Template_Listener_Publishable($this-&gt;_options));
    }
    
    /* ... */
}</code></pre><h3 id="r-resume-25" data-claire-element-id="773259">Résumé</h3><p id="r-773254" data-claire-element-id="773254">Je vous donne ci-dessous le code complet du template et du listener. Oh que je suis gentil ! :D</p><p id="r-773255" data-claire-element-id="773255"><strong>Doctrine_Template_Publishable :</strong></p><pre id="r-773256" data-claire-element-id="773256"><code data-claire-semantic="html+php">&lt;?php

class Doctrine_Template_Publishable extends Doctrine_Template
{
    protected $_options = array(
        'created' =&gt; array(
            'name'     =&gt; 'created_by',
            'alias'    =&gt; 'OriginalAuthor',
            'class'    =&gt; 'User',
            'foreign'  =&gt; 'id',
            'type'     =&gt; 'integer',
            'disabled' =&gt; false,
            'options'  =&gt; array(),
        ),
        'updated' =&gt; array(
            'name'     =&gt; 'updated_by',
            'alias'    =&gt; 'Author',
            'class'    =&gt; 'User',
            'foreign'  =&gt; 'id',
            'type'     =&gt; 'integer',
            'disabled' =&gt; false,
            'options'  =&gt; array(),
        ),
        'publishable' =&gt; array(
            'name'     =&gt; 'is_publishable',
            'alias'    =&gt; null,
            'type'     =&gt; 'boolean',
            'disabled' =&gt; false,
            'options'  =&gt; array('notnull' =&gt; true, 'default' =&gt; true),
        ),
    );

    public function setTableDefinition()
    {
        if(!$this-&gt;_options['created']['disabled']) {
            $this-&gt;hasColumn(
                $this-&gt;_options['created']['name'],
                $this-&gt;_options['created']['type'],
                null,
                $this-&gt;_options['created']['options']
            );
        }
  
        if(!$this-&gt;_options['updated']['disabled']) {
            $this-&gt;hasColumn(
                $this-&gt;_options['updated']['name'],
                $this-&gt;_options['updated']['type'],
                null,
                $this-&gt;_options['updated']['options']
            );
        }
  
        if(!$this-&gt;_options['publishable']['disabled']) {
            $name = $this-&gt;_options['publishable']['name'];
            if($this-&gt;_options['publishable']['alias']) {
                $name .= ' as '.$this-&gt;_options['publishable']['alias'];
            }
      
            $this-&gt;hasColumn(
                $name,
                $this-&gt;_options['publishable']['type'],
                null,
                $this-&gt;_options['publishable']['options']
            );
        }

        $this-&gt;addListener(new Doctrine_Template_Listener_Publishable($this-&gt;_options));
    }

    public function setUp()
    {
        if(!$this-&gt;_options['created']['disabled']) {
            $name = $this-&gt;_options['created']['class'];
            if($this-&gt;_options['created']['alias']) {
                $name .= ' as '.$this-&gt;_options['created']['alias'];
            }
      
            $this-&gt;hasOne($name, array(
                'local'   =&gt; $this-&gt;_options['created']['name'],
                'foreign' =&gt; $this-&gt;_options['created']['foreign']
            ));
        }

        if(!$this-&gt;_options['updated']['disabled']) {
            $name = $this-&gt;_options['updated']['class'];
            if($this-&gt;_options['updated']['alias']) {
                $name .= ' as '.$this-&gt;_options['updated']['alias'];
            }
      
            $this-&gt;hasOne($name, array(
                'local'   =&gt; $this-&gt;_options['updated']['name'],
                'foreign' =&gt; $this-&gt;_options['updated']['foreign']
            ));
        }
    }
}</code></pre><p id="r-773257" data-claire-element-id="773257"><strong>Doctrine_Template_Listener_Publishable :</strong></p><pre id="r-773258" data-claire-element-id="773258"><code data-claire-semantic="html+php">&lt;?php

class Doctrine_Template_Listener_Publishable extends Doctrine_Record_Listener
{
    protected $_options = array();
  
    public function __construct(array $options)
    {
        $this-&gt;_options = $options;
    }
  
    public function preInsert(Doctrine_Event $event)
    {
        $invoker        = $event-&gt;getInvoker();
        $invokerTable   = $invoker-&gt;getTable();
        $modifiedFields = $invoker-&gt;getModified();

        if(!$this-&gt;_options['created']['disabled']) {
            $createdField = $invokerTable-&gt;getFieldName($this-&gt;_options['created']['name']);

            if(!isset($modifiedFields[$createdField])) {
                $invoker-&gt;$createdField = $this-&gt;getCurrentUserId();
            }
        }

        if(!$this-&gt;_options['updated']['disabled']) {
            $updatedField = $invokerTable-&gt;getFieldName($this-&gt;_options['updated']['name']);
    
            if(!isset($modifiedFields[$updatedField])) {
                $invoker-&gt;$updatedField = $this-&gt;getCurrentUserId();
            }
        }
    }
  
    public function preUpdate(Doctrine_Event $event)
    {
        $invoker        = $event-&gt;getInvoker();
        $invokerTable   = $invoker-&gt;getTable();
        $modifiedFields = $invoker-&gt;getModified();

        if(!$this-&gt;_options['updated']['disabled']) {
            $updatedField = $invokerTable-&gt;getFieldName($this-&gt;_options['updated']['name']);
     
            if(!isset($modifiedFields[$updatedField])) {
                $invoker-&gt;$updatedField = $this-&gt;getCurrentUserId();
            }
        }
    }
  
    public function preDqlUpdate(Doctrine_Event $event)
    {
        if(!$this-&gt;_options['updated']['disabled']) {
            $invokerTable = $event-&gt;getInvoker()-&gt;getTable();
            $params       = $event-&gt;getParams();
            $updatedField = $invokerTable-&gt;getFieldName($this-&gt;_options['updated']['name']);
            $q            = $event-&gt;getQuery();
            $field        = $params['alias'].'.'.$updatedField;

            if(!$q-&gt;contains($field)) {
                $q-&gt;set($field, '?', $this-&gt;getCurrentUserId());
            }
        }
    }

    public function preDqlSelect(Doctrine_Event $event)
    {
        if(!$this-&gt;_options['publishable']['disabled']) {
            $q      = $event-&gt;getQuery();
            $params = $event-&gt;getParams();
            $field  = $params['alias'].'.'.$this-&gt;_options['publishable']['name'];
    
            if(!$q-&gt;contains($field)) {
                $q-&gt;andWhere($field.' = ?', true);
            }
        }
    }

    protected function getCurrentUserId()
    {
        // À adapter à votre projet, bien sûr.
        return $_SESSION['user_id'];
    }
}</code></pre><h3 id="r-et-maintenant-5" data-claire-element-id="773262">Et maintenant ?</h3><p id="r-773260" data-claire-element-id="773260">Ce TP est bien sûr un exemple parmi tant d'autres. Il y a notamment une notion que nous n'avons pas abordé : le partage de méthodes. Vous vous souvenez ?<br/> Maintenant, à vous de jouer pour trouver des idées afin d'améliorer ce p'tit behavior. ;)</p><p id="r-773261" data-claire-element-id="773261">Vous avez pu apercevoir dans ce chapitre la grande modularité qu'offre Doctrine et l'intérêt des templates.<br/> Attention cependant, ne les utilisez pas à tort et à travers ! Et souvenez-vous aussi que vous pouvez tout à fait ajouter un listener sur <strong>un</strong> objet en particulier, et non obligatoirement sur une classe entière !</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
<span class="arrow"></span>
<span class="next">Correction : le listener</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">
<span class="next">Personnalisation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Personnalisation"></a><h2>Personnalisation</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
<span class="arrow"></span>
<span class="next">Conclusion</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
<span class="next">Avec Doctrine_Manager</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-773266" data-claire-element-id="773266">Doctrine nous permet de personnaliser pas mal de choses dans sa configuration.<br/> Doctrine gère tout cela en <em>Cascade</em>, c'est-à-dire que l'on peut personnaliser certains aspects à plusieurs niveaux.</p><p id="r-773267" data-claire-element-id="773267">Le niveau le plus global est au niveau de Doctrine_Manager. Mais, bien entendu, il est possible de gérer tout cela plus finement.</p><p id="r-773268" data-claire-element-id="773268">Par exemple, nous pouvons récupérer les résultats de toutes les requêtes de différentes manières. On peut définir cela globalement ; par exemple, on choisit de récupérer des objets complets à chaque fois. Mais il reste tout à fait possible, au niveau de la requête elle-même par exemple, de dire « <em>Cette fois, je veux juste récupérer un tableau contenant certaines propriétés, et non l'objet en entier</em> ».</p><p id="r-773269" data-claire-element-id="773269">Notez que je rédigerai prochainement un chapitre spécifique sur l'<em>Hydratation des résultats</em>.</p>
</div><a name="AvecDoctrine_Manager"></a><h2>Avec Doctrine_Manager</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">
<span class="arrow"></span>
<span class="next">Personnalisation</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-773270" data-claire-element-id="773270">Doctrine_Manager possède une méthode <em>setAttribute()</em> qui permet de changer certains... attributs !</p><h2 id="r-comment-ca-marche-26" data-claire-element-id="773274">Comment ça marche ?</h2><p id="r-773271" data-claire-element-id="773271">Tout simplement, en appelant la méthode citée :</p><pre id="r-773272" data-claire-element-id="773272"><code data-claire-semantic="html+php">&lt;?php
$manager = Docrine_Manager::getInstance();

$manager-&gt;setAttribute(Doctrine_Core::ATTR_VALIDATE, Doctrine_Core::VALIDATE_ALL);
$manager-&gt;setAttribute(Doctrine_Core::ATTR_AUTO_ACCESSOR_OVERRIDE, true);</code></pre><p id="r-773273" data-claire-element-id="773273">Les attributs possibles sont définis dans Doctrine_Core et sont de la forme ATTR_<em>NOM_DE_LATTRIBUT</em>.<br/> Leurs valeurs possibles sont des constantes de la forme <em>NOM_DE_LATTRIBUT</em>_<em>VALEUR</em>.</p><h2 id="r-detail-des-principaux-attributs" data-claire-element-id="773319">Détail des principaux attributs</h2><h3 id="r-attr-validate" data-claire-element-id="773291">ATTR_VALIDATE</h3><aside id="r-773276" data-claire-element-id="773276" data-claire-semantic="information"><p id="r-773275" data-claire-element-id="773275">Je mettrai prochainement en ligne un chapitre consacré à la validation des données. Nous parlerons plus en détail de cet attribut à ce moment-là.</p></aside><p id="r-773277" data-claire-element-id="773277">Cet attribut indique la manière dont Doctrine va valider les données ; par exemple, si l'on doit forcer un champ déclaré de type <em>integer</em> à contenir bel et bien un nombre entier.<br/> Les valeurs disponibles sont :</p><ul id="r-773288" data-claire-element-id="773288"><li id="r-773279" data-claire-element-id="773279"><p id="r-773278" data-claire-element-id="773278">VALIDATE_ALL <em>(correspond à l'ensemble des validateurs suivants)</em> ;</p></li><li id="r-773281" data-claire-element-id="773281"><p id="r-773280" data-claire-element-id="773280">VALIDATE_LENGTHS ;</p></li><li id="r-773283" data-claire-element-id="773283"><p id="r-773282" data-claire-element-id="773282">VALIDATE_TYPES ;</p></li><li id="r-773285" data-claire-element-id="773285"><p id="r-773284" data-claire-element-id="773284">VALIDATE_CONSTRAINTS ;</p></li><li id="r-773287" data-claire-element-id="773287"><p id="r-773286" data-claire-element-id="773286">VALIDATE_NONE.</p></li></ul><p id="r-773289" data-claire-element-id="773289">Notez que l'on peut combiner plusieurs valeurs avec l'opérateur bit-à-bit « | ». Par exemple :</p><pre id="r-773290" data-claire-element-id="773290"><code data-claire-semantic="html+php">&lt;?php
$manager-&gt;setAttribute(Doctrine_Core::ATTR_VALIDATE, Doctrine_Core::VALIDATE_LENGTHS | Doctrine_Core::VALIDATE_TYPES);</code></pre><h3 id="r-attr-auto-accessor-override" data-claire-element-id="773294">ATTR_AUTO_ACCESSOR_OVERRIDE</h3><p id="r-773292" data-claire-element-id="773292">Autorise ou non la redéfinition des accesseurs, c'est-à-dire, la possibilité ou non de créer une méthode <em>getProperty()</em> pour accéder à la colonne <em>property</em>. L'intérêt est de pouvoir effectuer des traitements avant de renvoyer la valeur.</p><p id="r-773293" data-claire-element-id="773293">Valeurs possibles : <em>true</em> ou <em>false</em>.</p><h3 id="r-attr-autoload-table-classes" data-claire-element-id="773297">ATTR_AUTOLOAD_TABLE_CLASSES</h3><p id="r-773295" data-claire-element-id="773295">Indique si Doctrine doit ou non charger les classes de table (<em>ArticleTable</em> par exemple) automatiquement.</p><p id="r-773296" data-claire-element-id="773296">Valeurs possibles : <em>true</em> ou <em>false</em>. Je vous recommande de le laisser à <em>true</em> si vous les utilisez. Dans le cas contraire, cela améliorera (légèrement...) les performances.</p><h3 id="r-attr-model-loading" data-claire-element-id="773307">ATTR_MODEL_LOADING</h3><p id="r-773298" data-claire-element-id="773298">Indique la manière dont Doctrine va charger les modèles.</p><p id="r-773299" data-claire-element-id="773299">Les valeurs possibles sont :</p><ul id="r-773306" data-claire-element-id="773306"><li id="r-773301" data-claire-element-id="773301"><p id="r-773300" data-claire-element-id="773300">MODEL_LOADING_AGGRESSIVE : Doctrine inclut TOUS les modèles trouvés, même ceux que vous n'utilisez pas.</p></li><li id="r-773303" data-claire-element-id="773303"><p id="r-773302" data-claire-element-id="773302">MODEL_LOADING_CONSERVATIVE : stocke simplement le chemin de chaque fichier contenant un modèle, et l'inclu uniquement SI BESOIN.</p></li><li id="r-773305" data-claire-element-id="773305"><p id="r-773304" data-claire-element-id="773304">MODEL_LOADING_PEAR : ne précharge pas les modèles, vérifie à chaque appel dans le dossier indiqué à <em>loadModels()</em> (souvenez-vous ^^ ) si le modèle existe.</p></li></ul><h3 id="r-attr-use-dql-callbacks" data-claire-element-id="773311">ATTR_USE_DQL_CALLBACKS</h3><p id="r-773308" data-claire-element-id="773308">Cet attribut indique si oui ou non les <em>hooks DQL</em> doivent être appelés. Reportez-vous au chapitre sur les Events Listeners pour plus de détails sur ces <em>hooks</em>.</p><p id="r-773309" data-claire-element-id="773309">Valeurs possibles : <em>true</em> ou <em>false</em>.</p><p id="r-773310" data-claire-element-id="773310">Attention, cet attribut est à <em>false</em> par défaut. Ceci signifie que vous devez explicitement le définir à <em>true</em>, quelque part dans votre application, pour utiliser les <em>hooks DQL</em>.</p><h3 id="r-attr-quote-identifier" data-claire-element-id="773318">ATTR_QUOTE_IDENTIFIER</h3><p id="r-773312" data-claire-element-id="773312">Cet attribut indique à Doctrine qu'il doit encapsuler tous les noms de tables, champs, etc. dans des délimiteurs.<br/> Pour info, <strong>MySQL</strong> utilise les <em>backticks</em> (`), <strong>Oracle</strong> utilise les guillemets doubles (&quot;), <strong>Access</strong> utilise les crochets ([ et ]), etc.</p><aside id="r-773314" data-claire-element-id="773314" data-claire-semantic="error"><p id="r-773313" data-claire-element-id="773313">Attention. N'utilisez jamais ces délimiteurs <em>en dur</em> dans votre code. Cela CASSE la portabilité de votre application, ce qui est justement tout l'inverse de ce que l'on veut avec Doctrine !</p></aside><p id="r-773315" data-claire-element-id="773315">Valeurs possibles : <em>true</em> ou <em>false</em>. Je vous conseille de le mettre à <em>true</em> uniquement si vous avez des problèmes lors de l'exécution de requêtes.</p><aside id="r-773317" data-claire-element-id="773317" data-claire-semantic="information"><p id="r-773316" data-claire-element-id="773316">Ce tutoriel n'est pas terminé !!!</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine">Apprendre à utiliser Doctrine</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Débuter avec Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/presentation-et-installation-2">Présentation et installation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/doctrine-c-est-quoi">
Doctrine, c&#039;est quoi ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/installation-79">
Installation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/configuration-de-la-base-de-donnees">Configuration de la base de données</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/connexion-7">
Connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-yaml">
Schéma de données (Yaml)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/schema-de-donnees-php">
Schéma de données (PHP)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/generation-des-tables-et-modeles">
Génération des tables et modèles
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/manipulation-des-donnees-stockees-dans-la-base">Manipulation des données stockées dans la base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-objets-et-collections">
Utilisation des objets et collections
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/le-langage-dql">
Le langage DQL
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilite-des-classes-de-tables">
Utilité des classes de tables
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-crud">TP : Création d&#039;un CRUD</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/preparation-du-terrain-5">
Préparation du terrain
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/affichage-de-donnees-2">
Affichage de données
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creation-d-objets">
Création d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/modification-d-objets">
Modification d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/suppression-de-donnees">
Suppression de données
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Utilisation avancée de Doctrine
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-events-listeners">Les Events Listeners</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-aux-events-listeners">
Introduction aux Events Listeners
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listener-de-connexion">
Listener de connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/listeners-d-objets">
Listeners d&#039;objets
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/informations-supplementaires-2">
Informations supplémentaires
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/les-templates-2">Les templates</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/introduction-10">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/utilisation-des-templates">
Utilisation des templates
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/structure-d-un-template">
Structure d&#039;un template
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/tp-creation-d-un-template">TP : Création d&#039;un template</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/creer-son-propre-template">
Créer son propre template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-template">
Correction : le template
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/correction-le-listener">
Correction : le listener
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/conclusion-55">
Conclusion
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 3</span>
Annexes
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">Personnalisation</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/avec-doctrine-manager">
Avec Doctrine_Manager
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/apprendre-a-utiliser-doctrine/personnalisation-3">
<span class="arrow"></span>
<span class="next">Personnalisation</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/apprendre-a-utiliser-doctrine.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 11:24:00 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/apprendre-a-utiliser-doctrine.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:50:26 GMT -->
</html>