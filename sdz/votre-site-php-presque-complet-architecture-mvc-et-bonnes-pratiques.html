<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 08:43:42 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:33:35 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Votre site PHP (presque) complet : architecture MVC et bonnes pratiques</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Votre site PHP (presque) complet : architecture MVC et bonnes pratiques</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#VotresitePHPpresquecompletarchitectureMVCetbonnespratiques">Votre site PHP (presque) complet : architecture MVC et bonnes pratiques</a><br/><a href="#Avant-proposcommentfonctionnecetutoriel">Avant-propos, comment fonctionne ce tutoriel</a><br/><a href="#Introductionobjectifsetpr-requis">Introduction, objectifs et pré-requis</a><br/><a href="#Organisationducodeetdesfichiers">Organisation du code et des fichiers</a><br/><a href="#Bonnespratiquesappliquer">Bonnes pratiques à appliquer</a><br/><a href="#NeverTrustUserInput">Never Trust User Input</a><br/><a href="#L039enferdesguillemetsmagiques">L&#039;enfer des guillemets magiques</a><br/><a href="#Produireuncodelisibleetcomprhensible">Produire un code lisible et compréhensible</a><br/><a href="#Lesclassesutilisesdanscetutoriel">Les classes utilisées dans ce tutoriel</a><br/><a href="#AccslabasededonnesavecPDO2">Accès à la base de données avec PDO2</a><br/><a href="#GestiondesformulairesaveclaclasseForm">Gestion des formulaires avec la classe Form</a><br/><a href="#Labasel039espacemembre">La base : l&#039;espace membre</a><br/><a href="#Objectifsetprparation">Objectifs et préparation</a><br/><a href="#Inscription">Inscription</a><br/><a href="#Connexionetdconnexion">Connexion et déconnexion</a><br/><a href="#Bonusleprofild039unmembre">Bonus : le profil d&#039;un membre</a><br/><a href="#MiniTPAffichaged039unprofilutilisateur">[Mini TP] Affichage d&#039;un profil utilisateur</a><br/><a href="#Modificationd039unprofilutilisateur">Modification d&#039;un profil utilisateur</a><br/></div>
<a name="VotresitePHPpresquecompletarchitectureMVCetbonnespratiques"></a><h2>Votre site PHP (presque) complet : architecture MVC et bonnes pratiques</h2><div class="content" role="article">
<p id="r-732803" data-claire-element-id="732803">Envie de progresser en PHP ?<br/> Envie d'apprendre et de mettre en pratique une architecture MVC à travers la réalisation de différents modules* ?<br/> De connaître des bonnes pratiques et avoir un code sécurisé ?</p><p id="r-732804" data-claire-element-id="732804">Tels sont les <strong>objectifs </strong>de ce tutoriel, alors bienvenue, et j'espère que le voyage vous plaira !</p><p id="r-732805" data-claire-element-id="732805">* Des exemples de modules sont : un espace membre, un livre d'or, une gestion de news, un album photo, un forum, etc. (la liste est longue !). À noter que ces exemples ne seront pas tous traités dans le tutoriel, ça serait beaucoup trop long !</p><p id="r-732806" data-claire-element-id="732806">Mes remerciements chaleureux à mes bêta-testeurs tarzoune, mrjay42, 11 et yøshï pour leurs commentaires et suggestions. Un remerciement particulier à `Haku, ex-membre impliqué et auteur de la majeure partie du chapitre &quot;Bonnes pratiques à appliquer&quot;.<br/> Je remercie également ptipilou pour la correction de ce tutoriel, ainsi que Zopieux qui l'a validé. ;)</p><p id="r-732807" data-claire-element-id="732807"><strong>Historique du tutoriel</strong></p><p id="r-732808" data-claire-element-id="732808"><strong>13 janvier 2009</strong> : deuxième validation avec corrections de nombreux bugs et ajout de la connexion automatique. Les fonctions combinaison_connexion_valide() et lire_infos_utilisateur() ont été mises à jour, pensez à les modifier !<br/><strong>7 janvier 2009</strong> : première validation contenant toute l'introduction (avant-tutoriel), l'espace membre (inscription, (dé)connexion) et le profil (affichage, modification).<br/><strong>21 décembre 2008</strong> : envoi à la zCorrection.<br/><strong>décembre 2008</strong> : relectures et bêta-test.<br/><strong>novembre 2008</strong> : rédaction du tutoriel.</p>
</div>
<div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1358423835269-0" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1358423835269-0');
        });
    }
    </script>
</div><a name="Avant-proposcommentfonctionnecetutoriel"></a><h2>Avant-propos, comment fonctionne ce tutoriel</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/introduction-objectifs-et-pre-requis">
<span class="next">Introduction, objectifs et pré-requis</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
</div><a name="Introductionobjectifsetpr-requis"></a><h2>Introduction, objectifs et pré-requis</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/avant-propos-comment-fonctionne-ce-tutoriel">
<span class="arrow"></span>
<span class="next">Avant-propos, comment fonctionne ce tutoriel</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/organisation-du-code-et-des-fichiers">
<span class="next">Organisation du code et des fichiers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-732819" data-claire-element-id="732819">Dans la mesure du possible, les parties sont d'une difficulté croissante : la première partie est la plus facile, tandis que la dernière est la plus difficile. Les parties du tutoriel doivent êtres lues dans l'ordre, car chacune a comme pré-requis <strong>l'ensemble des parties précédentes</strong>. Par exemple, pour pouvoir faire le forum, il vous faut savoir faire le livre d'or.</p><p id="r-732820" data-claire-element-id="732820">Ce tutoriel est plus difficile que <a href="http://www.siteduzero.com/tutoriel-3-14668-un-site-dynamique-avec-php.html">celui de M@teo21</a>, mais les modules abordés - sous forme de TP quand c'est possible - sont plus approfondis ! Il est donc indispensable d'avoir déjà lu le tutoriel officiel avant de tenter celui-ci (mis à part la partie sur les expressions régulières qui nous sera inutile).</p><p id="r-732821" data-claire-element-id="732821">Il est donc adressé à des novices, mais des pré-requis de POO sont indispensables à sa compréhension. Rassurez-vous, il n'est pas nécessaire de savoir coder des classes en POO (ça sera déjà fait pour vous), seulement de comprendre leur fonctionnement et de savoir les utiliser. Le but n'est pas d'entrer dans le détail à ce niveau. Dans ce tutoriel, 2 classes principales seront utilisées :</p><ul id="r-732826" data-claire-element-id="732826"><li id="r-732823" data-claire-element-id="732823"><p id="r-732822" data-claire-element-id="732822">une pour l'accès à la base de données SQL (<a href="http://dev.mysql.com/doc/">mySQL</a> dans le cas présent) : nous utiliserons PDO, qui définit une excellente interface pour accéder à une BDD depuis PHP 5.1. Il est important de savoir que c'est le futur standard utilisé par PHP ; en effet, dans PHP 6, les fonctions mysql_* et mysqli_* (ou plus généralement les extensions mysql et mysqli) disparaîtront au profit de PDO. <a href="http://www.siteduzero.com/tutoriel-3-34790-pdo-interface-d-acces-aux-bdd.html">Le tutoriel de Draeli sur PDO</a> résume bien la situation et sera largement suffisant dans le cadre de ce tutoriel !</p></li><li id="r-732825" data-claire-element-id="732825"><p id="r-732824" data-claire-element-id="732824">une pour la gestion des formulaires : c'est une classe que j'ai codée et qui simplifie largement la création et surtout le traitement des formulaires ! Je peux vous assurer que vous aurez beaucoup moins de lignes de code à écrire en l'utilisant ! Je la présente rapidement à la fin de la partie afin que vous sachiez vous en servir et que vous ayez un aperçu plus en détails des fonctionnalités de celle-ci.</p></li></ul><p id="r-732827" data-claire-element-id="732827">Une troisième classe nommée Image fait également son apparition (<a href="http://esperat.fr/image.php">code source disponible ici</a>). Elle permet simplement de lire, redimensionner et sauvegarder des images aux formats JPG, PNG et GIF sans se soucier des fonctions à utiliser pour lire et enregistrer l'image.</p><p id="r-732828" data-claire-element-id="732828">Enfin, au niveau de la base de données, les requêtes préparées seront utilisées tout au long du tutoriel. Si vous ne savez pas ce que c'est, une lecture de la partie 5 du <a href="http://www.siteduzero.com/tutoriel-3-34790-pdo-interface-d-acces-aux-bdd.html#ss_part_5">tutoriel de Draeli sur la question</a> vous sera d'une grande utilité ! En résumé, la structure de la requête est stockée sur le serveur, puis le programmeur fait pointer les données qu'il souhaite sur la requête. Ainsi, la structure de la requête est figée avant l'exécution et les données fournies ne peuvent en aucun cas la modifier, ce qui rend les injections SQL tout simplement <strong>impossibles</strong>.</p><aside id="r-732830" data-claire-element-id="732830" data-claire-semantic="information"><p id="r-732829" data-claire-element-id="732829">PHP 5.1 au minimum est nécessaire pour suivre ce tutoriel, étant donné que nous allons utiliser PDO (disponible depuis PHP 5.1) ainsi que ma librairie Form (fonctionnant avec PHP 5+).</p></aside><aside id="r-732832" data-claire-element-id="732832" data-claire-semantic="warning"><p id="r-732831" data-claire-element-id="732831">N'essayez pas de lire la suite du tutoriel si vous n'avez pas lu <a href="http://www.siteduzero.com/tutoriel-3-14668-un-site-dynamique-avec-php.html">le tutoriel officiel</a> ou si vous ne connaissez rien à PDO ou aux requêtes préparées. Vous ne comprendriez tout simplement rien aux codes suggérés...</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques">Votre site PHP (presque) complet : architecture MVC et bonnes pratiques</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction : l&#039;avant-tutoriel
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/avant-propos-comment-fonctionne-ce-tutoriel">Avant-propos, comment fonctionne ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/introduction-objectifs-et-pre-requis">
Introduction, objectifs et pré-requis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/organisation-du-code-et-des-fichiers">
Organisation du code et des fichiers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonnes-pratiques-a-appliquer">Bonnes pratiques à appliquer</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/never-trust-user-input-3">
Never Trust User Input
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/l-enfer-des-guillemets-magiques-2">
L&#039;enfer des guillemets magiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/produire-un-code-lisible-et-comprehensible">
Produire un code lisible et compréhensible
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/les-classes-utilisees-dans-ce-tutoriel">Les classes utilisées dans ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/acces-a-la-base-de-donnees-avec-pdo2">
Accès à la base de données avec PDO2
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/gestion-des-formulaires-avec-la-classe-form">
Gestion des formulaires avec la classe Form
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Des systèmes simples : espace membres et livre d&#039;or
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/la-base-l-espace-membre">La base : l&#039;espace membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/objectifs-et-preparation">
Objectifs et préparation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/inscription-3">
Inscription
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/connexion-et-deconnexion-1">
Connexion et déconnexion
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonus-le-profil-d-un-membre">Bonus : le profil d&#039;un membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/mini-tp-affichage-d-un-profil-utilisateur">
[Mini TP] Affichage d&#039;un profil utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/modification-d-un-profil-utilisateur">
Modification d&#039;un profil utilisateur
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/avant-propos-comment-fonctionne-ce-tutoriel">
<span class="arrow"></span>
<span class="next">Avant-propos, comment fonctionne ce tutoriel</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/organisation-du-code-et-des-fichiers">
<span class="next">Organisation du code et des fichiers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Organisationducodeetdesfichiers"></a><h2>Organisation du code et des fichiers</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/introduction-objectifs-et-pre-requis">
<span class="arrow"></span>
<span class="next">Introduction, objectifs et pré-requis</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonnes-pratiques-a-appliquer">
<span class="next">Bonnes pratiques à appliquer</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-732834" data-claire-element-id="732834">Ce chapitre décrit l'arborescence que nous allons utiliser pour la réalisation de notre site et de nos modules.</p><p id="r-732835" data-claire-element-id="732835">Tous les mots en <strong>bleu et gras</strong> présentent du vocabulaire potentiellement inconnu pour vous. Ces définitions sont très importantes : si donc vous ne comprenez pas un de ces mots, relisez plusieurs fois le paragraphe en question !</p><h2 id="r-modules-et-actions" data-claire-element-id="732847">Modules et actions</h2><p id="r-732836" data-claire-element-id="732836">Chaque partie de ce tutoriel propose la création d'un <strong>module</strong> (exemple : un livre d'or, une gestion de news), qui seront chacun constitués d'<strong>actions</strong> (exemples : lire une news, poster un message dans le livre d'or).</p><p id="r-732837" data-claire-element-id="732837">Dans cette optique, il nous faut une hiérarchie de répertoires capable de bien organiser notre code source à ce niveau. Voici ce que je vous propose et ce que je vais utiliser durant tout le tutoriel.</p><ul id="r-732846" data-claire-element-id="732846"><li id="r-732839" data-claire-element-id="732839"><p id="r-732838" data-claire-element-id="732838">Nous aurons un dossier ~/modules/ qui contiendra tous nos modules.</p></li><li id="r-732841" data-claire-element-id="732841"><p id="r-732840" data-claire-element-id="732840">Chaque module sera contenu dans un dossier portant le nom du module et situé dans ~/modules/.</p></li><li id="r-732843" data-claire-element-id="732843"><p id="r-732842" data-claire-element-id="732842">Chaque action sera placée dans un fichier spécifique dans le dossier du module, portant le nom de l'action.</p></li><li id="r-732845" data-claire-element-id="732845"><p id="r-732844" data-claire-element-id="732844">Toutes ces pages ne seront pas appelées directement, mais par la page principale index.php fournie. Toutes les requêtes passeront par cette page qui s'occupera de charger le bon module et la bonne action de manière sécurisée.</p></li></ul><h2 id="r-le-mvc-ou-separation-des-couches" data-claire-element-id="732854">Le MVC, ou séparation des couches</h2><p id="r-732848" data-claire-element-id="732848">Avant d'aller plus loin, une petite présentation du MVC est indispensable. <strong>MVC signifie Modèle / Vue / Contrôleur.</strong> C'est un découpage couramment utilisé pour développer des applications web.</p><p id="r-732849" data-claire-element-id="732849">Chaque action d'un module appartient en fait à un <strong>contrôleur</strong>. Ce contrôleur sera chargé de générer la page suivant la requête (HTTP) demandée par l'utilisateur. Cette requête inclut des informations comme l'URL, avec ses paramètres GET, des données POST, des COOKIES, etc. Un module peut être divisé en plusieurs contrôleurs, qui contiennent chacun plusieurs actions.</p><p id="r-732850" data-claire-element-id="732850">Pour générer une page, un contrôleur réalise presque systématiquement des opérations basiques telles que lire des données, et les afficher. Avec un peu de capacité d'abstraction, on peut voir deux autres couches qui apparaissent : une pour gérer les données (notre <strong>modèle</strong>) et une autre pour gérer l'affichage des pages (notre <strong>vue</strong>).</p><p id="r-732851" data-claire-element-id="732851">Le <strong>modèle</strong> : une couche pour gérer les données, ça signifie quoi ? Ça signifie qu'à chaque fois que nous voulons créer, modifier, supprimer ou lire une donnée (exemple, lire les informations d'un utilisateur depuis la base de données MySQL), nous ferons appel à une fonction spécifique qui nous retournera le résultat (sous forme d'un tableau généralement). Ainsi, nous n'aurons AUCUNE requête dans notre contrôleur, juste des appels de fonctions s'occupant de gérer ces requêtes.</p><p id="r-732852" data-claire-element-id="732852">La <strong>vue</strong> : une couche pour afficher des pages ? Cela signifie tout simplement que notre contrôleur n'affichera JAMAIS de données directement (via echo ou autre). Il fera appel à une page qui s'occupera d'afficher ce que l'on veut. Cela permet de séparer complètement l'affichage HTML dans le code. Certains utilisent un moteur de templates pour le faire, nous n'en aurons pas besoin : l'organisation des fichiers se suffit à elle-même.<br/> Ceci permet de séparer le travail des <em>designers</em> et graphistes (s'occupant de créer et de modifier des vues) et celui des programmeurs (s'occupant du reste).</p><p id="r-732853" data-claire-element-id="732853">En externalisant les codes du modèle et de la vue de la partie contrôleur, vous verrez que le contenu d'un contrôleur devient vraiment simple et que sa compréhension est vraiment aisée. Il ne contient plus que la logique de l'application, sans savoir comment ça marche derrière : par exemple, on voit une fonction verifier_unicite_pseudo(), on sait qu'il vérifie que le pseudo est unique, mais on ne s'encombre pas des 10 lignes de codes SQL nécessaires en temps normal, celles-ci faisant partie du modèle. De même pour le code HTML qui est externalisé.</p><h2 id="r-a-propos-des-librairies" data-claire-element-id="732858">À propos des librairies</h2><p id="r-732855" data-claire-element-id="732855">Un ensemble de fonctions servant dans un but (plus ou moins) précis peut être mis à disposition sous la forme d'une <strong>librairie</strong> (également appelée bibliothèque de fonctions). Une librairie contient du code utile que l'on ne désire pas avoir à réécrire à chaque fois (car comme tout le monde le sait, un programmeur est fainéant !).</p><p id="r-732856" data-claire-element-id="732856">Par exemple, la classe que nous utiliserons pour la gestion des formulaires (pour rappel : Form) est une librairie externe, et sera donc placée dans le dossier ~/libs/form.php (créé pour l'occasion). Elle permet de ne pas réécrire le code de validation du formulaire à chaque fois, ce qui fait économiser un sacré paquet de lignes de code !</p><p id="r-732857" data-claire-element-id="732857">J'avais dit que nous utiliserons PDO pour l'accès à la BDD MySQL, ce qui n'est pas tout à fait juste. Nous utiliserons en fait une version de PDO implémentant le design pattern <em>Singleton</em>, je l'ai appelée PDO2. Ceci permet de récupérer notre objet PDO à la demande (lorsque nous voulons faire une requête), celui-ci se connectant à la base de données lors de son premier appel. Ainsi, la connexion à la BDD est gérée de façon transparente et se fait uniquement lorsqu'on en a besoin ! Bien que ça ne soit pas vraiment une librairie (mais une interface d'accès à la BDD), nous la placerons quand même dans ~/libs/pdo2.php.</p><h2 id="r-architecture-finale-utilisee" data-claire-element-id="732863">Architecture finale utilisée</h2><p id="r-732859" data-claire-element-id="732859">Je vous ai parlé tout à l'heure de la page index.php par laquelle passeront toutes les requêtes de l'utilisateur. Cette page agit en fait comme un contrôleur frontal et redirige la requête de l'utilisateur vers le bon contrôleur du bon module. Le lecture du tutoriel de <a href="http://www.siteduzero.com/membres-294-43623.html">vincent1870</a>, &quot;<a href="http://www.siteduzero.com/tutoriel-3-31452-adopter-un-style-de-programmation-clair-avec-le-modele-mvc.html">Initiation au modèle MVC, une manière d'organiser son code</a>&quot; à propos du MVC est un très bon approfondissement à ce paragraphe, et il est vivement conseillé de le lire si vous avez des difficultés avec ces notions.</p><p id="r-732860" data-claire-element-id="732860">Il faut également définir un comportement lorsqu'aucun module ni action n'est spécifié. J'ai choisi de charger la page ~/global/accueil.php qui contiendra le code de la page d'accueil (bizarrement :p).</p><p id="r-732861" data-claire-element-id="732861">En partant du constat qu'un modèle peut servir dans plusieurs modules (exemple : les informations d'un utilisateur sont utiles à la fois pour les news et le forum), on placera les fichiers de modèles dans un dossier séparé, bien qu'ils seront toujours regroupés par &quot;modules&quot;.<br/> Ceci permet une meilleure modularité de l'ensemble du code, ce qui permet par exemple d'utiliser un modèle en rapport avec les news dans le module membre pour afficher les news proposées par un utilisateur dans son profil.<br/> Cela permet également un meilleur découpage des modèles et peut éviter d'inclure des fonctions utiles seulement dans une action d'un module. Par exemple, la fonction pour vérifier l'unicité d'une adresse e-mail lors de l'inscription est utile uniquement lors de l'inscription. Nous la mettrons donc dans un fichier séparé pour éviter de surcharger le modèle pour la table &quot;membres&quot;.</p><p id="r-732862" data-claire-element-id="732862">Les vues, quant à elles, seront placées dans un dossier /vues/ présent dans le dossier ~/modules/nom_du_module/. Je ne ferai pas plus de commentaire sur ce choix.</p><h2 id="r-squelette-d-une-page-vierge" data-claire-element-id="732879">Squelette d'une page vierge</h2><p id="r-732864" data-claire-element-id="732864">Une page web sémantique a besoin d'un code HTML minimal pour son bon fonctionnement, à savoir les balises <code data-claire-semantic="html">&lt;html&gt; &lt;head&gt; &lt;title&gt; &lt;body&gt; </code> et parfois quelques <code data-claire-semantic="html">&lt;meta&gt; </code>. Ce code HTML étant global car nécessaire à tous les modules, nous allons les créer dans un nouveau dossier ~/global/, afin de laisser index.php seul à la racine.<br/> Nous avons besoin d'au moins 2 fichiers dans ce dossier ~/global/ : haut.php et bas.php. J'en utilise un troisième : menu.php que j'inclus depuis haut.php. Ceci permet d'avoir accès au menu rapidement, car on aura à modifier cette page au fur et à mesure de l'avancement dans le tutoriel !</p><p id="r-732865" data-claire-element-id="732865">Enfin, deux derniers fichiers sont nécessaires. Il s'agit de global/init.php et global/config.php. Le premier fichier (d'initialisation) contiendra dans un premier temps une suppression des guillemets magiques (on explique plus tard pourquoi c'est nécessaire) et l'inclusion du second fichier (de configuration). Le second fichier définit les constantes de notre site. Les informations de connexion à la base de données ainsi que des chemins vers les modèles et vues à inclure seront présents dans ce fichier de configuration.<br/> Le fichier d'initialisation sera appelé sur toutes les pages depuis index.php, d'où son emplacement dans ~/global/.</p><p id="r-732866" data-claire-element-id="732866">Voici les codes sources des différents fichiers :</p><pre id="r-732867" data-claire-element-id="732867"><code data-claire-semantic="html+php">&lt;?php

// Initialisation
include 'global/init.php';

// Début de la tamporisation de sortie
ob_start();

// Si un module est specifié, on regarde s'il existe
if (!empty($_GET['module'])) {

	$module = dirname(__FILE__).'/modules/'.$_GET['module'].'/';
	
	// Si l'action est specifiée, on l'utilise, sinon, on tente une action par défaut
	$action = (!empty($_GET['action'])) ? $_GET['action'].'.php' : 'index.php';
	
	// Si l'action existe, on l'exécute
	if (is_file($module.$action)) {

		include $module.$action;

	// Sinon, on affiche la page d'accueil !
	} else {

		include 'global/accueil.php';
	}

// Module non specifié ou invalide ? On affiche la page d'accueil !
} else {

	include 'global/accueil.php';
}

// Fin de la tamporisation de sortie
$contenu = ob_get_clean();

// Début du code HTML
include 'global/haut.php';

echo $contenu;

// Fin du code HTML
include 'global/bas.php';</code></pre><p id="r-732868" data-claire-element-id="732868">La <strong>tamporisation de sortie</strong> permet de &quot;capturer&quot; toutes les sorties effectuées entre ob_start() et ob_get_clean(). Ceci permet de faire l'affichage de la page ~/global/haut.php après l'exécution des scripts de la page, qui sont ainsi capables de modifier des informations dont cette page aurait besoin (par exemple les sessions, ou même le titre de la page tout simplement).</p><p id="r-732869" data-claire-element-id="732869">Une <strong>condition ternaire</strong> est utilisée à cette ligne : $action = (!empty($_GET['action'])) ? $_GET['action.php'].'.php' : 'index.php';. Une condition ternaire s'utilise ainsi : (condition) ? (valeur si vrai) : (valeur si faux). Ainsi, si (!empty($_GET['action'])) est vrai, $action prendra pour valeur $_GET['action.php'].'.php', sinon $action prendra pour valeur 'index.php'.</p><pre id="r-732870" data-claire-element-id="732870"><code data-claire-semantic="html+php">&lt;?php

// Inclusion du fichier de configuration (qui définit des constantes)
include 'global/config.php';

// Désactivation des guillemets magiques
ini_set('magic_quotes_runtime', 0);
set_magic_quotes_runtime(0);

if (1 == get_magic_quotes_gpc())
{
	function remove_magic_quotes_gpc(&amp;$value) {
	
		$value = stripslashes($value);
	}
	array_walk_recursive($_GET, 'remove_magic_quotes_gpc');
	array_walk_recursive($_POST, 'remove_magic_quotes_gpc');
	array_walk_recursive($_COOKIE, 'remove_magic_quotes_gpc');
}

// Inclusion de Pdo2, potentiellement utile partout
include CHEMIN_LIB.'pdo2.php';</code></pre><p id="r-732871" data-claire-element-id="732871">Si vous ne savez pas ce que sont les guillemets magiques ni pourquoi les désactiver, c'est expliqué dans la partie suivante : <em>Bonnes pratiques à appliquer &gt; L'enfer des guillemets magiques</em></p><pre id="r-732872" data-claire-element-id="732872"><code data-claire-semantic="html+php">&lt;?php

// Identifiants pour la base de données. Nécessaires a PDO2.
define('SQL_DSN',      'mysql:dbname=tutoriel;host=localhost');
define('SQL_USERNAME', 'root');
define('SQL_PASSWORD', '');

// Chemins à utiliser pour accéder aux vues/modeles/librairies
$module = empty($module) ? !empty($_GET['module']) ? $_GET['module'] : 'index' : $module;
define('CHEMIN_VUE',    'modules/'.$module.'/vues/');
define('CHEMIN_MODELE', 'modeles/');
define('CHEMIN_LIB',    'libs/');</code></pre><pre id="r-732873" data-claire-element-id="732873"><code data-claire-semantic="html+php">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;

&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot;&gt;

&lt;head&gt;

	&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;

	&lt;title&gt;Tutoriel de Savageman - Créez votre site (presque) complet PHP : architecture MVC et bonnes pratiques !&lt;/title&gt;

	&lt;meta http-equiv=&quot;Content-Language&quot; content=&quot;fr&quot; /&gt;

	&lt;link rel=&quot;stylesheet&quot; href=&quot;style/global.css&quot; type=&quot;text/css&quot; media=&quot;screen&quot; /&gt;

&lt;/head&gt;

&lt;body&gt;

	&lt;h1&gt;Créez votre site (presque) complet PHP : architecture MVC et bonnes pratiques !&lt;/h1&gt;

&lt;?php include 'global/menu.php'; ?&gt;

	&lt;div id=&quot;centre&quot;&gt;</code></pre><pre id="r-732874" data-claire-element-id="732874"><code data-claire-semantic="html">&lt;div id=&quot;menu&quot;&gt;
	
		&lt;h2&gt;Menu&lt;/h2&gt;
		
		&lt;ul&gt;
			&lt;li&gt;&lt;a href=&quot;index.php&quot;&gt;Accueil&lt;/a&gt;&lt;/li&gt;
		&lt;/ul&gt;
		
		(rien pour le moment)
		
	&lt;/div&gt;</code></pre><pre id="r-732875" data-claire-element-id="732875"><code data-claire-semantic="html">&lt;/div&gt;

	&lt;div id=&quot;bas&quot;&gt;
		Tutoriel réalisé par Savageman.
	&lt;/div&gt;

&lt;/body&gt;

&lt;/html&gt;</code></pre><pre id="r-732876" data-claire-element-id="732876"><code data-claire-semantic="html">&lt;h2&gt;Page d'accueil&lt;/h2&gt;

&lt;p&gt;Bienvenue dans mon super tutoriel !&lt;br /&gt;
(page que l'on trouvera très intéressante)&lt;/p&gt;</code></pre><p id="r-732877" data-claire-element-id="732877">Enfin, voici le fichier CSS que j'utilise, ne vous moquez pas, mes talents de graphiste sont très limités !</p><pre id="r-732878" data-claire-element-id="732878"><code data-claire-semantic="css">*
{
	font-family: Calibri;
}
body, #menu, #centre
h1, h2, h3, h4, h5, h6
{
	margin: 0;
	padding: 0;
	border: 0;
}
h1
{
	background-color: #1166ff;
	padding: 0.5em;
}
h2, h3, h4, h5, h6
{

	margin-bottom: 0.5em;
}
#menu
{
	float: left;
	width: 18%;
	margin: 0em 1em 1em;
	padding: 1em;
	background-color: #22ff37;
}
#centre
{
	margin: 1em 1em 1em 23%;
	padding: 1em;
	background-color: #eeeeee;
}
#bas
{
	clear: both;
	padding: 1em;
	background-color: #3366ff;
}
label
{
	float: left;
	width: 250px;
	text-align: left;
}
input
{
	margin-bottom: 2px;
}
table, tr, td, th
{
	border-collapse: collapse;
	border: 1px solid black;
}</code></pre><h2 id="r-recapitulatif-de-l-arborescence" data-claire-element-id="732883">Récapitulatif de l'arborescence</h2><figure id="r-732881" data-claire-element-id="732882"><img id="r-732880" data-claire-element-id="732880" src="medias/uploads.siteduzero.com_files_151001_152000_151562.png" alt="Arborescence des répertoires et fichiers pour le squelette de base"/></figure>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques">Votre site PHP (presque) complet : architecture MVC et bonnes pratiques</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction : l&#039;avant-tutoriel
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/avant-propos-comment-fonctionne-ce-tutoriel">Avant-propos, comment fonctionne ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/introduction-objectifs-et-pre-requis">
Introduction, objectifs et pré-requis
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/organisation-du-code-et-des-fichiers">
Organisation du code et des fichiers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonnes-pratiques-a-appliquer">Bonnes pratiques à appliquer</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/never-trust-user-input-3">
Never Trust User Input
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/l-enfer-des-guillemets-magiques-2">
L&#039;enfer des guillemets magiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/produire-un-code-lisible-et-comprehensible">
Produire un code lisible et compréhensible
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/les-classes-utilisees-dans-ce-tutoriel">Les classes utilisées dans ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/acces-a-la-base-de-donnees-avec-pdo2">
Accès à la base de données avec PDO2
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/gestion-des-formulaires-avec-la-classe-form">
Gestion des formulaires avec la classe Form
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Des systèmes simples : espace membres et livre d&#039;or
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/la-base-l-espace-membre">La base : l&#039;espace membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/objectifs-et-preparation">
Objectifs et préparation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/inscription-3">
Inscription
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/connexion-et-deconnexion-1">
Connexion et déconnexion
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonus-le-profil-d-un-membre">Bonus : le profil d&#039;un membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/mini-tp-affichage-d-un-profil-utilisateur">
[Mini TP] Affichage d&#039;un profil utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/modification-d-un-profil-utilisateur">
Modification d&#039;un profil utilisateur
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/introduction-objectifs-et-pre-requis">
<span class="arrow"></span>
<span class="next">Introduction, objectifs et pré-requis</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonnes-pratiques-a-appliquer">
<span class="next">Bonnes pratiques à appliquer</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Bonnespratiquesappliquer"></a><h2>Bonnes pratiques à appliquer</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/organisation-du-code-et-des-fichiers">
<span class="arrow"></span>
<span class="next">Organisation du code et des fichiers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/never-trust-user-input-3">
<span class="next">Never Trust User Input</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-732886" data-claire-element-id="732886">Pas de bol, on ne commence pas encore à coder ! Cette partie a pour but de vous sensibiliser à certains problèmes connus et récurrents. Ces problèmes incluent notamment la sécurité de votre site et de vos applications avec la présentation de la faille XSS ainsi que les guillemets magiques.<br/> Ensuite, nous verrons comment écrire un code lisible en pratiquant ce que j'appelle l'<strong>auto-documentation</strong> et en utilisant des constantes.</p><p id="r-732887" data-claire-element-id="732887">Voici le plan de cette partie :</p><ol id="r-732894" data-claire-element-id="732894"><li id="r-732889" data-claire-element-id="732889"><p id="r-732888" data-claire-element-id="732888"><strong>Never Trust User Input</strong> : la faille XSS ;</p></li><li id="r-732891" data-claire-element-id="732891"><p id="r-732890" data-claire-element-id="732890"><strong>L'enfer des guillemets magiques</strong> : pourquoi et comment les désactiver ?</p></li><li id="r-732893" data-claire-element-id="732893"><p id="r-732892" data-claire-element-id="732892"><strong>Produire un code lisible et compréhensible</strong> :<br/> - un nommage correct de vos variables et fonctions dans un but d'auto-documentation,<br/> - une utilisation judicieuse des constantes.</p></li></ol><aside id="r-732896" data-claire-element-id="732896" data-claire-semantic="warning"><p id="r-732895" data-claire-element-id="732895">Cette partie est très importante pour la suite. Ça n'est pas forcément le plus intéressant car elle aborde beaucoup de théorie, mais c'est une étape indispensable pour commencer à coder sereinement !</p></aside>
</div><a name="NeverTrustUserInput"></a><h2>Never Trust User Input</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonnes-pratiques-a-appliquer">
<span class="arrow"></span>
<span class="next">Bonnes pratiques à appliquer</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/l-enfer-des-guillemets-magiques-2">
<span class="next">L&#039;enfer des guillemets magiques</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<aside id="r-732898" data-claire-element-id="732898" data-claire-semantic="information"><p id="r-732897" data-claire-element-id="732897">Cette partie a entièrement été rédigée par `Haku, ancien membre impliqué du SdZ. Seules quelques modifications mineures y ont été apportées afin de la sortir du contexte de son tutoriel d'origine.</p></aside><p id="r-732899" data-claire-element-id="732899">Les formulaires sont dangereux ! La plupart des failles de sécurité liées au PHP tirent leur origine de $_GET et de $_POST (ainsi que de $_COOKIE, mais c'est pour plus tard). Il y a des risques et on peut se faire avoir !</p><p id="r-732900" data-claire-element-id="732900">Mais dans tous les cas, soyez rassurés. La sécurité en PHP tient en quelques mots : Never Trust User Input.<br/> Littéralement et en français, ça veut dire &quot;Ne jamais croire / faire confiance aux entrées de l'utilisateur&quot;. Quand vous mettez un formulaire à disposition sur votre site, vous le faites généralement pour faire un sondage, ou pour laisser la possibilité aux gens de s'exprimer. Mais beaucoup de dérives sont possibles, à plusieurs niveaux. Ce petit texte n'a pas pour vocation de vous enseigner toutes les ficelles de la sécurité, car c'est avant tout une histoire de comportement. La faille que je vais vous montrer est la faille XSS.</p><p id="r-732901" data-claire-element-id="732901">Dans un dossier séparé, créez une page url.php et mettez-y ce code, puis validez le formulaire.</p><pre id="r-732902" data-claire-element-id="732902"><code data-claire-semantic="html+php">&lt;?php
 
if(isset($_POST['texte'])) {
        echo $_POST['texte'];
}
 
?&gt;
&lt;form action=&quot;./url.php&quot; method=&quot;post&quot;&gt;
        &lt;p&gt;
                &lt;textarea name=&quot;texte&quot; rows=&quot;10&quot; cols=&quot;50&quot;&gt;
                        &lt;script type=&quot;text/javascript&quot;&gt;
                        alert('Ohoh, vous avez été piraté par `Haku !!');
                        &lt;/script&gt;
                &lt;/textarea&gt;
        &lt;input type=&quot;submit&quot; name=&quot;valid&quot; value=&quot;go&quot; /&gt;
        &lt;/p&gt;
&lt;/form&gt;</code></pre><p id="r-732903" data-claire-element-id="732903">Testez ce code et... Oh mon dieu ! Je vous ai piratés. Non, rassurez-vous, je n'ai rien fait de méchant, votre PC ne va pas exploser, votre disque dur ne va pas danser la samba, les aliens ne vont pas débarquer, j'ai juste mis un petit code JavaScript qui permet d'afficher une boîte de dialogue. Ce n'est pas plus méchant qu'une plume.</p><p id="r-732904" data-claire-element-id="732904">Vous voyez donc que si on laisse l'utilisateur mettre ce qu'il veut, il peut faire des choses qui ne sont pas prévues à la base et qui peuvent être ennuyeuses ou même dangereuses.</p><p id="r-732905" data-claire-element-id="732905">Par exemple, faire une boucle infinie qui afficherait tout le temps des boîtes de dialogue comme celle que j'ai affichée, ça serait ennuyeux. Vous devriez tuer le processus de votre navigateur Internet pour sortir de cette situation.<br/> Mais en quoi est-ce dangereux ? C'est simple. En PHP, il existe une superglobale, $_COOKIE, qui permet de sauvegarder des informations sur l'ordinateur d'un visiteur. Ne criez pas au scandale, les cookies sont de simples fichiers texte, ils ne peuvent rien faire sur votre ordinateur, ce n'est pas Big Brother, ce sont juste des fichiers texte qui permettent au script de sauver des informations propres au visiteur (par exemple, si vous allez sur un site qui propose plusieurs designs, il stockera une information dans un cookie qui permettra de ne pas avoir à vous redemander quel design vous voulez à chaque visite).</p><p id="r-732906" data-claire-element-id="732906">Mais on peut mettre des informations beaucoup plus sensibles dans les cookies, comme par exemple des mots de passe pour vous connecter à des espaces membres (les mots de passe ne sont pas là tels quels, ils sont &quot;cachés&quot; grâce à une fonction de hashage).<br/> Et c'est là que la faille XSS arrive. Vous avez vu que je peux injecter du code JavaScript et le faire s'exécuter. Le problème, c'est que le JavaScript <strong>peut accéder aux cookies</strong>. Et donc, si je remplaçais le code qui affiche une boîte de dialogue par un code plus vicieux, qui vous redirigerait vers une page piégée, je pourrais obtenir votre mot de passe et me faire passer pour vous sur tous les sites où vous employez ce mot de passe (c'est d'ailleurs pourquoi il est conseillé de ne pas utiliser tout le temps le même mot de passe, il faut en avoir plusieurs, idéalement, un par site / application).</p><p id="r-732907" data-claire-element-id="732907">Maintenant, comment s'en protéger ?<br/> La méthode est simple et a fait ses preuves : utilisez la fonction PHP htmlspeciachars().<br/> Cette fonction transforme 5 caractères en leur équivalent HTML. Bon, et alors ? Eh bien c'est simple.<br/> Si vous tapez ceci dans une page HTML :</p><pre id="r-732908" data-claire-element-id="732908"><code data-claire-semantic="html">&lt;script type=&quot;text/javascript&quot;&gt;alert('hoho');&lt;/script&gt;</code></pre><p id="r-732909" data-claire-element-id="732909">vous allez revoir une boîte de dialogue.<br/> Maintenant on va remplacer les chevrons (&lt; et &gt;) par leur équivalent HTML respectif : &amp;lt; et &amp;gt;.<br/> Remettez ce code dans une page HTML et regardez ce qu'il se passe :</p><pre id="r-732910" data-claire-element-id="732910"><code data-claire-semantic="html">&amp;lt;script type=&quot;text/javascript&quot;&amp;gt;alert('hoho');&amp;lt;/script&amp;gt;</code></pre><p id="r-732911" data-claire-element-id="732911">Magie, plus de boîte de dialogue. La raison est simple : votre navigateur sait que s'il rencontre les balises &lt;script&gt;&lt;/script&gt;, il doit interpréter ce qu'il y a entre les balises comme du JavaScript. Mais comme on a remplacé les chevrons par leur équivalent HTML (c'est-à-dire une suite de caractères qui affiche la même chose mais qui n'a pas la même valeur), votre navigateur n'interprète pas ce qu'il y a entre les balises comme du JavaScript.</p><p id="r-732912" data-claire-element-id="732912">Et voilà comment se protéger de cette faille.<br/> Reprenons le code du début en y adjoignant la fonction htmlspecialchars() et admirons le résultat :</p><pre id="r-732913" data-claire-element-id="732913"><code data-claire-semantic="html+php">&lt;?php
 
if(isset($_POST['texte'])) {

        echo htmlspecialchars($_POST['texte']);
}
 
?&gt;
&lt;form action=&quot;./url.php&quot; method=&quot;post&quot;&gt;
        &lt;p&gt;
                &lt;textarea name=&quot;texte&quot; rows=&quot;10&quot; cols=&quot;50&quot;&gt;
                        &lt;script type=&quot;text/javascript&quot;&gt;
                        alert('Ohoh, vous avez été piraté par `Haku !!');
                        &lt;/script&gt;
                &lt;/textarea&gt;
        &lt;input type=&quot;submit&quot; name=&quot;valid&quot; value=&quot;go&quot; /&gt;
        &lt;/p&gt;
&lt;/form&gt;</code></pre><p id="r-732914" data-claire-element-id="732914">Voici la liste des caractères remplacés par htmlspecialchars() :</p><ul id="r-732925" data-claire-element-id="732925"><li id="r-732916" data-claire-element-id="732916"><p id="r-732915" data-claire-element-id="732915">&amp; =&gt; <strong>&amp;amp;</strong></p></li><li id="r-732918" data-claire-element-id="732918"><p id="r-732917" data-claire-element-id="732917">&lt; =&gt; <strong>&amp;lt;</strong></p></li><li id="r-732920" data-claire-element-id="732920"><p id="r-732919" data-claire-element-id="732919">&gt; =&gt; <strong>&amp;gt;</strong></p></li><li id="r-732922" data-claire-element-id="732922"><p id="r-732921" data-claire-element-id="732921">&quot; =&gt; <strong>&amp;quot;</strong></p></li><li id="r-732924" data-claire-element-id="732924"><p id="r-732923" data-claire-element-id="732923">' =&gt; <strong>&amp;#039;</strong></p></li></ul><aside id="r-732927" data-claire-element-id="732927" data-claire-semantic="information"><p id="r-732926" data-claire-element-id="732926">Certains caractères ne sont remplacés que si vous donnez un second argument à la fonction ; pour savoir comment ça fonctionne, allez voir dans <a href="http://fr.php.net/htmlspecialchars">la documentation</a> !</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques">Votre site PHP (presque) complet : architecture MVC et bonnes pratiques</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction : l&#039;avant-tutoriel
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/avant-propos-comment-fonctionne-ce-tutoriel">Avant-propos, comment fonctionne ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/introduction-objectifs-et-pre-requis">
Introduction, objectifs et pré-requis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/organisation-du-code-et-des-fichiers">
Organisation du code et des fichiers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonnes-pratiques-a-appliquer">Bonnes pratiques à appliquer</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/never-trust-user-input-3">
Never Trust User Input
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/l-enfer-des-guillemets-magiques-2">
L&#039;enfer des guillemets magiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/produire-un-code-lisible-et-comprehensible">
Produire un code lisible et compréhensible
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/les-classes-utilisees-dans-ce-tutoriel">Les classes utilisées dans ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/acces-a-la-base-de-donnees-avec-pdo2">
Accès à la base de données avec PDO2
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/gestion-des-formulaires-avec-la-classe-form">
Gestion des formulaires avec la classe Form
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Des systèmes simples : espace membres et livre d&#039;or
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/la-base-l-espace-membre">La base : l&#039;espace membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/objectifs-et-preparation">
Objectifs et préparation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/inscription-3">
Inscription
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/connexion-et-deconnexion-1">
Connexion et déconnexion
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonus-le-profil-d-un-membre">Bonus : le profil d&#039;un membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/mini-tp-affichage-d-un-profil-utilisateur">
[Mini TP] Affichage d&#039;un profil utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/modification-d-un-profil-utilisateur">
Modification d&#039;un profil utilisateur
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonnes-pratiques-a-appliquer">
<span class="arrow"></span>
<span class="next">Bonnes pratiques à appliquer</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/l-enfer-des-guillemets-magiques-2">
<span class="next">L&#039;enfer des guillemets magiques</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="L039enferdesguillemetsmagiques"></a><h2>L&#039;enfer des guillemets magiques</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/never-trust-user-input-3">
<span class="arrow"></span>
<span class="next">Never Trust User Input</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/produire-un-code-lisible-et-comprehensible">
<span class="next">Produire un code lisible et compréhensible</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<aside id="r-732930" data-claire-element-id="732930" data-claire-semantic="information"><p id="r-732929" data-claire-element-id="732929">Cette partie a entièrement été rédigée par `Haku, ancien membre impliqué du SdZ.</p></aside><p id="r-732931" data-claire-element-id="732931">Après un petit blabla fort intéressant sur la faille XSS, on va prendre un peu de temps pour discuter d'un autre problème plutôt ennuyeux (je voulais dire emmerdant, mais ce n'est pas très pédagogique !) : les guillemets magiques.</p><p id="r-732932" data-claire-element-id="732932">Ça me pose un problème d'en parler ici, puisque la cause de ces guillemets magiques, les magic_quotes, ce qui a justifié leur création vous est encore inconnu. Je vais donc en parler, mais très brièvement.</p><p id="r-732933" data-claire-element-id="732933">Testez ce code :</p><pre id="r-732934" data-claire-element-id="732934"><code data-claire-semantic="html+php">&lt;?php
 
$text = 'lala des &quot; et encore des &quot; ' . &quot; et des ' sans oublier les '&quot;;
echo $text;
echo addslashes($text);
 
?&gt;</code></pre><p id="r-732935" data-claire-element-id="732935">Vous voyez que les deux echo (echo qui est une structure, pas une fonction, je le rappelle) n'affichent pas la même chose. On aurait pu s'en douter vu que l'un affiche directement $text alors que l'autre affiche la valeur de retour d'une fonction : addslashes(). <br/> Le but de cette fonction est très simple : elle rajoute un backslash (\) devant ces 4 chaînes de caractères : &quot;, ', \ et NULL.</p><p id="r-732936" data-claire-element-id="732936">Bon, vous allez me demander quel est l'intérêt de cette fonction ; je pourrais vous répondre, mais ça servirait à rien parce qu'on n'a pas encore abordé le sujet. Tout ce que je peux dire, c'est que pendant longtemps, cette fonction a été la défense de bien des codeurs face à une possible faille.</p><p id="r-732937" data-claire-element-id="732937">Mais quel rapport avec les formulaires ? Eh bien c'est simple. Dans le fichier de configuration de PHP (un truc obscur que l'on a jamais vu), il y a des directives, c'est-à-dire des ordres que PHP doit suivre. <br/> L'une de ces directives s'appelle <strong>magic_quote_gpc</strong>. Si cette directive est activée, PHP va appliquer la fonction addslashes() à toutes les valeurs présentent dans les arrays GPC ($_GET, $_POST et $_COOKIE). Et donc, on risque de se retrouver avec une panoplie de backslashes en trop !</p><p id="r-732938" data-claire-element-id="732938">Idéalement, il faudrait que cette directive disparaisse : elle n'a été implémentée que pour pallier au manque de mesures de sécurité des codeurs PHP. Seulement, comme cette directive est désactivable, la configuration peut changer. Si vous faites votre script sur un serveur qui a désactivé la directive et qu'ensuite vous décidez de changer de serveur et d'aller sur un autre qui a activé cette directive, vous aurez des backslashes dans tous les coins et vous devrez modifier votre script pour réparer les dégâts.<br/> Heureusement, la version 6 de PHP fera disparaître cette directive. Malheureusement, il y a des tas de serveurs qui resteront avec PHP version 5 pendant un bon moment, et même avec PHP version 4.<br/> Je vais vous donner un code qui va vous permettre de ne plus avoir à vous soucier des guillemets magiques, et je vais vous l'expliquer.</p><pre id="r-732939" data-claire-element-id="732939"><code data-claire-semantic="html+php">&lt;?php
 
if(get_magic_quotes_gpc()) {
        $_POST = array_map('stripslashes', $_POST);
        $_GET = array_map('stripslashes', $_GET);
        $_COOKIE = array_map('stripslashes', $_COOKIE);
}
 
?&gt;</code></pre><p id="r-732940" data-claire-element-id="732940">Le fonctionnement est très simple : d'abord, on vérifie si les magic_quotes sont activés avec la fonction get_magic_quotes_gpc(). Si c'est le cas, on va utiliser la fonction inverse d'addslashes() : stripslashes().<br/> Pour appliquer une fonction à l'ensemble des valeurs d'un array, on utilise la fonction array_map(). Le premier argument est le nom de la fonction qu'on veut appliquer (stripslashes() dans notre cas) et le second argument, l'array sur lequel on va travailler.</p><p id="r-732941" data-claire-element-id="732941">Cette fonction est rudimentaire et peut être améliorée, mais pour le moment, ça suffira amplement. <br/> Mais comme je l'ai dit, l'idéal est de les désactiver. Donc si vous avez accès au fichier de configuration de PHP (php.ini pour les intimes), suivez cette procédure pour désactiver les magic_quotes :</p><ul id="r-732948" data-claire-element-id="732948"><li id="r-732943" data-claire-element-id="732943"><p id="r-732942" data-claire-element-id="732942">ouvrir le php.ini (chez moi, il est dans C:\Wamp\php\php.ini) ;</p></li><li id="r-732945" data-claire-element-id="732945"><p id="r-732944" data-claire-element-id="732944">rechercher la chaîne 'magic_quotes_gpc' ;</p></li><li id="r-732947" data-claire-element-id="732947"><p id="r-732946" data-claire-element-id="732946">mettre Off comme valeur pour les trois directives des magic_quotes pour obtenir ceci :</p></li></ul><pre id="r-732949" data-claire-element-id="732949"><code>; Magic quotes
;
 
; Magic quotes for incoming GET/POST/Cookie data.
magic_quotes_gpc = Off
 
; Magic quotes for runtime-generated data, e.g. data from SQL, from exec(), etc.
magic_quotes_runtime = Off
 
; Use Sybase-style magic quotes (escape ' with '' instead of \').
magic_quotes_sybase = Off</code></pre><p id="r-732950" data-claire-element-id="732950">Reste à redémarrer votre serveur pour que la modification soit effective.</p><p id="r-732951" data-claire-element-id="732951">Boum, plus de magic_quotes !<br/> On reviendra là-dessus dans la partie II de ce tutoriel de toute façon, pour découvrir pourquoi cette directive existe :) .</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques">Votre site PHP (presque) complet : architecture MVC et bonnes pratiques</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction : l&#039;avant-tutoriel
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/avant-propos-comment-fonctionne-ce-tutoriel">Avant-propos, comment fonctionne ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/introduction-objectifs-et-pre-requis">
Introduction, objectifs et pré-requis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/organisation-du-code-et-des-fichiers">
Organisation du code et des fichiers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonnes-pratiques-a-appliquer">Bonnes pratiques à appliquer</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/never-trust-user-input-3">
Never Trust User Input
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/l-enfer-des-guillemets-magiques-2">
L&#039;enfer des guillemets magiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/produire-un-code-lisible-et-comprehensible">
Produire un code lisible et compréhensible
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/les-classes-utilisees-dans-ce-tutoriel">Les classes utilisées dans ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/acces-a-la-base-de-donnees-avec-pdo2">
Accès à la base de données avec PDO2
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/gestion-des-formulaires-avec-la-classe-form">
Gestion des formulaires avec la classe Form
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Des systèmes simples : espace membres et livre d&#039;or
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/la-base-l-espace-membre">La base : l&#039;espace membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/objectifs-et-preparation">
Objectifs et préparation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/inscription-3">
Inscription
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/connexion-et-deconnexion-1">
Connexion et déconnexion
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonus-le-profil-d-un-membre">Bonus : le profil d&#039;un membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/mini-tp-affichage-d-un-profil-utilisateur">
[Mini TP] Affichage d&#039;un profil utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/modification-d-un-profil-utilisateur">
Modification d&#039;un profil utilisateur
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/never-trust-user-input-3">
<span class="arrow"></span>
<span class="next">Never Trust User Input</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/produire-un-code-lisible-et-comprehensible">
<span class="next">Produire un code lisible et compréhensible</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Produireuncodelisibleetcomprhensible"></a><h2>Produire un code lisible et compréhensible</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/l-enfer-des-guillemets-magiques-2">
<span class="arrow"></span>
<span class="next">L&#039;enfer des guillemets magiques</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/les-classes-utilisees-dans-ce-tutoriel">
<span class="next">Les classes utilisées dans ce tutoriel</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-un-nommage-correct-de-vos-variables-et-fonctions-dans-un-but-d-auto-documentation" data-claire-element-id="732959">Un nommage correct de vos variables et fonctions dans un but d'auto-documentation</h2><aside id="r-732954" data-claire-element-id="732954" data-claire-semantic="information"><p id="r-732953" data-claire-element-id="732953">Ce paragraphe a été rédigé en majeure partie par `Haku, ancien membre impliqué du SdZ. Quelques modifications y ont été apportées afin de l'adapter à ce tutoriel.</p></aside><p id="r-732955" data-claire-element-id="732955">Un point très important est le nom de vos variables. En effet, le nom d'une variable est un élément très important. S'il est trop long, ça serait très embêtant à taper (par exemple $NombreDeMessageParPage est un nom de variable certes très clair, mais d'une longueur affolante). Il faut donc vous limiter et ne pas exagérer. <br/> Mais il ne faut pas non plus tomber dans l'excès inverse. Si vous mettez des noms de variables trop court, vous risquez de ne plus savoir ce qu'est telle ou telle variable (par exemple $inf est un nom très court, mais ça ne me dit rien du tout). <br/> Il vous faut donc trouver un juste milieu entre clarté et longueur. L'idéal, c'est d'avoir un style de variable. Prenez les mots que vous utilisez le plus souvent dans vos noms de variables, et trouvez des diminutifs. Par exemple, au lieu de Nombre, vous pouvez mettre Nb, au lieu de Information, mettez Info. Vous pouvez également supprimer tous les mots blancs comme &quot;de&quot;, &quot;par&quot;, etc.</p><p id="r-732956" data-claire-element-id="732956">Si je reprends l'exemple du $NombreDeMessageParPage, ça donnerait $nb_mess_page. C'est bien plus court, mais c'est tout aussi lisible pour autant qu'on conserve toujours la même convention de nommage.</p><p id="r-732957" data-claire-element-id="732957">Un nom de variable bien choisi n'est donc pas trop long à taper tout en restant clair et facilement compréhensible, ce qui contribue à ce que j'appelle l'<strong>auto-documentation</strong> des scripts. Un nom de variable clair permet de ne pas écrire un commentaire qui aurait été utile avec un nom de variable inadapté. Prenez donc 10 secondes à utiliser de jolies noms de variables plutôt que d'écrire des commentaires inutiles. Votre code sera tout autant compréhensible, tout en étant plus court et plus rapide à lire.</p><p id="r-732958" data-claire-element-id="732958">Les mêmes règles de nommage peuvent s'appliquer pour les fonctions, les constantes et même les noms de fichiers.<br/> Par exemple, dans ce tutoriel, je remplacerai &quot;initialisation&quot; par &quot;init&quot;, &quot;configuration&quot; par &quot;config&quot; ou encore &quot;librairie&quot; par &quot;lib&quot;.</p><h2 id="r-une-utilisation-judicieuse-des-constantes" data-claire-element-id="732997">Une utilisation judicieuse des constantes</h2><aside id="r-732961" data-claire-element-id="732961" data-claire-semantic="information"><p id="r-732960" data-claire-element-id="732960">Ce paragraphe a été rédigé en partie par `Haku, ancien membre impliqué du SdZ. Quelques modifications y ont été apportées afin de l'adapter à ce tutoriel.</p></aside><h3 id="r-definition-82" data-claire-element-id="732969">Définition</h3><p id="r-732962" data-claire-element-id="732962">Je vais maintenant vous parler très brièvement des constantes. Vous en avez peut-être déjà entendu parler, mais voici une explication plus poussée.</p><p id="r-732963" data-claire-element-id="732963">Une <strong>constante</strong> est une sorte de variable, dont on définit le nom et la valeur une fois, et dont la valeur sera impossible à modifier tout au long du script.</p><p id="r-732964" data-claire-element-id="732964">Voici comment on déclare une constante :</p><pre id="r-732965" data-claire-element-id="732965"><code data-claire-semantic="html+php">&lt;?php
 
define('NOM_CONSTANTE', 'Valeur de la constante.');
echo NOM_CONSTANTE;
 
?&gt;</code></pre><p id="r-732966" data-claire-element-id="732966">Pour déclarer une constante, on utilise la fonction define(). Le premier argument est le nom qu'aura la constante et le second est la valeur qu'elle prendra (une expression quelconque).</p><p id="r-732967" data-claire-element-id="732967">On peut ensuite utiliser cette constante dans beaucoup de situations : affichage (comme dans l'exemple), concaténation, assignation, calcul, etc. Une constante s'utilise de la même manière qu'une variable, vous ne devriez donc pas avoir de souci à ce niveau.</p><p id="r-732968" data-claire-element-id="732968">Notez que la valeur d'une constante ne peut pas changer : si on essaye de définir une constante qui existe déjà, une belle erreur pointe le bout de son nez. Pour résumer, une constante ne se définit qu'une seule fois.</p><h3 id="r-mais-quel-interet-quand-les-utiliser" data-claire-element-id="732996">Mais quel intérêt ? Quand les utiliser ?</h3><p id="r-732970" data-claire-element-id="732970">Je dirais qu'il y a trois cas majeurs où les constantes sont intéressantes.</p><p id="r-732971" data-claire-element-id="732971"><strong>Le premier cas</strong>, c'est si vous voulez vous assurer qu'une valeur ne change jamais. Une valeur qui resterait constante du début à la fin du script. Par exemple, pour configurer un script (nombre de news affichées par page, si on veut afficher les signatures sur un forum ou non, etc.), c'est très utile, parce qu'on ne risque pas de changer cette valeur.</p><p id="r-732972" data-claire-element-id="732972">-----<br/><strong>Le second cas</strong>, c'est ce que j'appelle les arguments muets, c'est-à-dire sans signification claire. Quand vous créez une fonction, vous lui donnez souvent des arguments, mais il peut arriver que vous ayez besoin de donner des arguments que je qualifie de muets.<br/> Voici la liste des arguments muets :</p><ul id="r-732979" data-claire-element-id="732979"><li id="r-732974" data-claire-element-id="732974"><p id="r-732973" data-claire-element-id="732973">un entier ;</p></li><li id="r-732976" data-claire-element-id="732976"><p id="r-732975" data-claire-element-id="732975">un nombre à virgule ;</p></li><li id="r-732978" data-claire-element-id="732978"><p id="r-732977" data-claire-element-id="732977">un booléen.</p></li></ul><p id="r-732980" data-claire-element-id="732980">Pourquoi sont-ils muets ? <br/> Tout simplement parce qu'on ne sait pas quel est leur rôle, à quoi ils servent. Un exemple vaut mieux qu'un discours et c'est cadeau :</p><pre id="r-732981" data-claire-element-id="732981"><code data-claire-semantic="html+php">&lt;?php
 
echo fonction_affiche_news(NB_NEWS_PAGE);
 
?&gt;</code></pre><pre id="r-732982" data-claire-element-id="732982"><code data-claire-semantic="html+php">&lt;?php
 
echo fonction_affiche_news(20);
 
?&gt;</code></pre><aside id="r-732984" data-claire-element-id="732984" data-claire-semantic="information"><p id="r-732983" data-claire-element-id="732983">La constante NB_NEWS_PAGE est définie comme telle : define('NB_NEWS_PAGE', 20);.</p></aside><p id="r-732985" data-claire-element-id="732985">Imaginez que ce ne soit pas votre script : vous tombez sur l'appel de cette fonction. Qui peut me dire à quoi sert le nombre 20 ? À afficher une news particulière ? Ou une catégorie particulière de news ? À limiter le nombre de news par page ?</p><p id="r-732986" data-claire-element-id="732986">On ne peut pas le deviner sans aller voir la déclaration de la fonction, et on perd du temps.</p><p id="r-732987" data-claire-element-id="732987">Tandis qu'avec une constante, on a un mot, un nom qui nous permet d'identifier l'utilité de ce paramètre. Quand les scripts sont petits et développés seuls, l'intérêt est limité, je l'avoue. Mais quand on a de gros scripts qu'on crée à plusieurs, ça devient vite le bordel et les constantes permettent d'améliorer un peu la lisibilité du code !</p><p id="r-732988" data-claire-element-id="732988">-----<br/> Enfin, <strong>le troisième cas</strong> dans lequel les constantes sont utiles est lorsque que l'on a des valeurs constantes présentes plusieurs fois directement dans son code.</p><p id="r-732989" data-claire-element-id="732989">Citons un cas concret.</p><p id="r-732990" data-claire-element-id="732990">Imaginez que vous placiez toutes vos fonctions dans des fichiers séparés dans un dossier précis, par exemple /include/fonctions/. Chaque fois que vous voudrez inclure une fonction pour l'utiliser, vous devez écrire le chemin vers ce dossier.<br/> Vous utiliserez donc plusieurs fois ce chemin dans vos scripts et cette valeur ne changera pas d'une page à l'autre. C'est là qu'une constante est utile : plutôt que d'écrire à chaque fois ce chemin, vous le définissez une bonne fois pour toute dans une constante. En plus d'éviter de réécrire le chemin complet à chaque fois, vous pourrez facilement changer sa valeur, et donc rendre votre code plus flexible.</p><p id="r-732991" data-claire-element-id="732991">Généralement, c'est une bonne chose de remplacer toutes ses valeurs constantes présentes directement dans son code par une constante.</p><p id="r-732992" data-claire-element-id="732992">-----<br/> De plus, notez que si vous regroupez vos constantes en haut d'un fichier particulier, vous y aurez facilement accès et pourrez les modifier à votre guise. Ainsi organisé, votre fichier vous permettra de <strong>configurer</strong> votre site simplement, juste en modifiant la valeur de ces constantes.</p><aside id="r-732994" data-claire-element-id="732994" data-claire-semantic="warning"><p id="r-732993" data-claire-element-id="732993">Certaines constantes, une fois que vous avez commencé à travailler avec, ne peuvent plus être modifiées sans faire bugger votre script (exemple : le dossier pour stocker les avatars). Il convient donc de rester vigilant lorsqu'on le fait. Par exemple, si vous changez le dossier où sont stockés les avatars, il vous faudra bien penser à transférer les avatars déjà existants vers le nouveau dossier.</p></aside><p id="r-732995" data-claire-element-id="732995">Vous êtes désormais armés contre la faille XSS et les guillemets magiques. Vous devriez également être capables d'écrire du code lisible et compréhensible par tous, ce qui est une bonne chose.<br/> Enfin, n'hésitez pas à utiliser des constantes pour bannir toute forme de paramètres sans signification claire (entiers, flottants et booléens).</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques">Votre site PHP (presque) complet : architecture MVC et bonnes pratiques</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction : l&#039;avant-tutoriel
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/avant-propos-comment-fonctionne-ce-tutoriel">Avant-propos, comment fonctionne ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/introduction-objectifs-et-pre-requis">
Introduction, objectifs et pré-requis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/organisation-du-code-et-des-fichiers">
Organisation du code et des fichiers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonnes-pratiques-a-appliquer">Bonnes pratiques à appliquer</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/never-trust-user-input-3">
Never Trust User Input
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/l-enfer-des-guillemets-magiques-2">
L&#039;enfer des guillemets magiques
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/produire-un-code-lisible-et-comprehensible">
Produire un code lisible et compréhensible
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/les-classes-utilisees-dans-ce-tutoriel">Les classes utilisées dans ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/acces-a-la-base-de-donnees-avec-pdo2">
Accès à la base de données avec PDO2
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/gestion-des-formulaires-avec-la-classe-form">
Gestion des formulaires avec la classe Form
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Des systèmes simples : espace membres et livre d&#039;or
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/la-base-l-espace-membre">La base : l&#039;espace membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/objectifs-et-preparation">
Objectifs et préparation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/inscription-3">
Inscription
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/connexion-et-deconnexion-1">
Connexion et déconnexion
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonus-le-profil-d-un-membre">Bonus : le profil d&#039;un membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/mini-tp-affichage-d-un-profil-utilisateur">
[Mini TP] Affichage d&#039;un profil utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/modification-d-un-profil-utilisateur">
Modification d&#039;un profil utilisateur
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/l-enfer-des-guillemets-magiques-2">
<span class="arrow"></span>
<span class="next">L&#039;enfer des guillemets magiques</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/les-classes-utilisees-dans-ce-tutoriel">
<span class="next">Les classes utilisées dans ce tutoriel</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesclassesutilisesdanscetutoriel"></a><h2>Les classes utilisées dans ce tutoriel</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/produire-un-code-lisible-et-comprehensible">
<span class="arrow"></span>
<span class="next">Produire un code lisible et compréhensible</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/acces-a-la-base-de-donnees-avec-pdo2">
<span class="next">Accès à la base de données avec PDO2</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<aside id="r-733001" data-claire-element-id="733001" data-claire-semantic="information"><p id="r-733000" data-claire-element-id="733000">Les classes distribuées dans ce tutoriel (Pdo2, Form et Image) sont <strong>toutes</strong> libres de droits (contrairement au tutoriel en lui-même). Vous pouvez les modifier et les ré-utiliser (même dans un cadre commercial) comme bon vous semble.</p></aside><aside id="r-733003" data-claire-element-id="733003" data-claire-semantic="information"><p id="r-733002" data-claire-element-id="733002">Je précise seulement qu'elle sont fournies dans l'état et qu'il n'y a aucune garantie ni service après-vente dessus.</p></aside>
</div><a name="AccslabasededonnesavecPDO2"></a><h2>Accès à la base de données avec PDO2</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/les-classes-utilisees-dans-ce-tutoriel">
<span class="arrow"></span>
<span class="next">Les classes utilisées dans ce tutoriel</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/gestion-des-formulaires-avec-la-classe-form">
<span class="next">Gestion des formulaires avec la classe Form</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-733004" data-claire-element-id="733004">Nous allons donc utiliser PDO, qui - je le rappelle - définit une excellente interface pour accéder à une BDD depuis PHP 5.1.</p><p id="r-733005" data-claire-element-id="733005">Le seul problème étant que dans ce que nous avons développé, nous avons besoin d'une seule et unique connexion à la base de données. Je lui ai donc ajouté cette fonctionnalité.</p><p id="r-733006" data-claire-element-id="733006"><strong>Comment ça s'utilise ?</strong><br/> Pour faire simple, lorsque l'on veut faire une requête, nous demandons à récupérer un objet PDO (qui est déjà connecté à la base de données) grâce à la méthode PDO2::getInstance();</p><p id="r-733007" data-claire-element-id="733007">À titre d'information, voici comment ça fonctionne en interne : lorsque l'on demande à récupérer cet objet PDO, 2 solutions s'offrent à la classe :</p><ul id="r-733012" data-claire-element-id="733012"><li id="r-733009" data-claire-element-id="733009"><p id="r-733008" data-claire-element-id="733008">soit l'objet existe déjà et nous le fournissons à l'utilisateur ;</p></li><li id="r-733011" data-claire-element-id="733011"><p id="r-733010" data-claire-element-id="733010">soit l'objet n'existe pas et la classe le crée tout en le connectant à la base de données avant de le fournir également à l'utilisateur.</p></li></ul><p id="r-733013" data-claire-element-id="733013">Au final, pour l'utilisateur de la classe (nous, vous), c'est facile : nous avons juste à demander l'objet PDO prêt à utiliser et la classe nous le retourne dans tous les cas.</p><p id="r-733014" data-claire-element-id="733014">L'avantage est que l'on ne demande jamais soi-même explicitement de se connecter à la base de données : la classe le fait pour nous. Et si l'on ne demande jamais l'objet, la connexion à la base de données ne se fera jamais non plus. ;)</p><p id="r-733015" data-claire-element-id="733015">Sans plus attendre, voici le code source à copier dans un fichier ~/libs/pdo2.php :</p><pre id="r-733016" data-claire-element-id="733016"><code data-claire-semantic="html+php">&lt;?php

/**
 * Classe implémentant le singleton pour PDO
 * @author Savageman
 */

class PDO2 extends PDO {

	private static $_instance;

	/* Constructeur : héritage public obligatoire par héritage de PDO */
	public function __construct( ) {
	
	}
	// End of PDO2::__construct() */

	/* Singleton */
	public static function getInstance() {
	
		if (!isset(self::$_instance)) {
			
			try {
			
				self::$_instance = new PDO(SQL_DSN, SQL_USERNAME, SQL_PASSWORD);
			
			} catch (PDOException $e) {
			
				echo $e;
			}
		} 
		return self::$_instance; 
	}
	// End of PDO2::getInstance() */
}

// end of file */</code></pre><aside id="r-733018" data-claire-element-id="733018" data-claire-semantic="information"><p id="r-733017" data-claire-element-id="733017">On notera que la classe a besoin de 3 constantes pour fonctionner correctement : SQL_DSN, SQL_USERNAME, et SQL_PASSWORD</p></aside><p id="r-733019" data-claire-element-id="733019">Une fois l'objet PDO récupéré avec la méthode PDO2::getInstance();, tout se passe comme si vous manipuliez un objet PDO. Mon but n'est pas de faire un cours là-dessus, étant donné que c'est un des pré-requis du tutoriel : savoir utiliser un objet. Pour les méthodes disponibles dans PDO, on se réfèrera au <a href="http://www.siteduzero.com/tutoriel-3-34790-pdo-interface-d-acces-aux-bdd.html">tutoriel de Draeli</a>, et plus particulièrement <a href="http://www.siteduzero.com/tutoriel-3-34790-pdo-interface-d-acces-aux-bdd.html#ss_part_5">à la partie 5</a> qui parle des requêtes préparées. On pourra également jeter un oeil du côté de la documentation officielle.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques">Votre site PHP (presque) complet : architecture MVC et bonnes pratiques</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction : l&#039;avant-tutoriel
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/avant-propos-comment-fonctionne-ce-tutoriel">Avant-propos, comment fonctionne ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/introduction-objectifs-et-pre-requis">
Introduction, objectifs et pré-requis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/organisation-du-code-et-des-fichiers">
Organisation du code et des fichiers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonnes-pratiques-a-appliquer">Bonnes pratiques à appliquer</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/never-trust-user-input-3">
Never Trust User Input
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/l-enfer-des-guillemets-magiques-2">
L&#039;enfer des guillemets magiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/produire-un-code-lisible-et-comprehensible">
Produire un code lisible et compréhensible
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/les-classes-utilisees-dans-ce-tutoriel">Les classes utilisées dans ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/acces-a-la-base-de-donnees-avec-pdo2">
Accès à la base de données avec PDO2
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/gestion-des-formulaires-avec-la-classe-form">
Gestion des formulaires avec la classe Form
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Des systèmes simples : espace membres et livre d&#039;or
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/la-base-l-espace-membre">La base : l&#039;espace membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/objectifs-et-preparation">
Objectifs et préparation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/inscription-3">
Inscription
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/connexion-et-deconnexion-1">
Connexion et déconnexion
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonus-le-profil-d-un-membre">Bonus : le profil d&#039;un membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/mini-tp-affichage-d-un-profil-utilisateur">
[Mini TP] Affichage d&#039;un profil utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/modification-d-un-profil-utilisateur">
Modification d&#039;un profil utilisateur
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/les-classes-utilisees-dans-ce-tutoriel">
<span class="arrow"></span>
<span class="next">Les classes utilisées dans ce tutoriel</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/gestion-des-formulaires-avec-la-classe-form">
<span class="next">Gestion des formulaires avec la classe Form</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="GestiondesformulairesaveclaclasseForm"></a><h2>Gestion des formulaires avec la classe Form</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/acces-a-la-base-de-donnees-avec-pdo2">
<span class="arrow"></span>
<span class="next">Accès à la base de données avec PDO2</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/la-base-l-espace-membre">
<span class="next">La base : l&#039;espace membre</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-733021" data-claire-element-id="733021">Ce tutoriel étant le mien, j'en profite pour promouvoir un outil que j'ai créé et que j'utilise. C'est un ensemble de classes servant à manipuler des formulaires. Il automatise plusieurs processus en liant la création et la vérification du formulaire. Le principal avantage est que le code de vérification (validation) est beaucoup plus simple, car la classe fait tout pour vous ! De plus, vous pourrez placer le code de création du formulaire et celui de vérification sur la même page, ce qui simplifiera légèrement votre code.</p><div id="r-733023" data-claire-element-id="733023" data-claire-semantic="question"><p id="r-733022" data-claire-element-id="733022">Quoi, déjà une classe ? Je ne comprends pas, alors un ensemble de classes ? :o</p></div><p id="r-733024" data-claire-element-id="733024">Pas de panique ! Vous avez juste besoin de comprendre comment cela fonctionne : je vais vous donner un exemple, vous verrez que ça n'est pas si compliqué que ça !</p><p id="r-733025" data-claire-element-id="733025">Commencez par récupérer le code source à cette adresse : <a href="http://esperat.fr/form.phps">source de la classe Form</a> et placez-le dans le fichier ~/libs/form.php.</p><h2 id="r-creation-et-affichage-d-un-formulaire" data-claire-element-id="733038">Création et affichage d'un formulaire</h2><p id="r-733026" data-claire-element-id="733026">Premier exemple, cas le plus simple :</p><pre id="r-733027" data-claire-element-id="733027"><code data-claire-semantic="html+php">&lt;?php

// Ne pas oublier d'inclure la libraire Form
include 'form.php';

// Création d'un objet Form.  // L'identifiant est obligatoire !
$mon_form = new Form('identifiant_unique');

// Affichage du formulaire
echo $mon_form;</code></pre><p id="r-733028" data-claire-element-id="733028">Résultat :</p><pre id="r-733029" data-claire-element-id="733029"><code data-claire-semantic="html">&lt;form method=&quot;GET&quot;&gt;
	&lt;p&gt;
		&lt;input name=&quot;uniqid&quot; type=&quot;hidden&quot; value=&quot;identifiant_unique&quot; /&gt;
	&lt;/p&gt;
&lt;/form&gt;</code></pre><p id="r-733030" data-claire-element-id="733030">Deuxième exemple, modification des attributs HTML :</p><pre id="r-733031" data-claire-element-id="733031"><code data-claire-semantic="html+php">&lt;?php

// Ne pas oublier d'inclure la libraire Form
include 'form.php';

// Création d'un objet Form.  // L'identifiant est obligatoire !
$mon_form = new Form('identifiant_unique');

// Modification des attributs
$mon_form-&gt;method('POST');
$mon_form-&gt;action('index.php');

// Affichage du formulaire
echo $mon_form;</code></pre><p id="r-733032" data-claire-element-id="733032">Résultat :</p><pre id="r-733033" data-claire-element-id="733033"><code data-claire-semantic="html">&lt;form method=&quot;POST&quot; action=&quot;index.php&quot;&gt;
	&lt;p&gt;
		&lt;input name=&quot;uniqid&quot; type=&quot;hidden&quot; value=&quot;identifiant_unique&quot; /&gt;
	&lt;/p&gt;
&lt;/form&gt;</code></pre><p id="r-733034" data-claire-element-id="733034">Il est également possible de spécifier l'attribut &quot;method&quot; directement dans le constructeur :</p><pre id="r-733035" data-claire-element-id="733035"><code data-claire-semantic="html+php">&lt;?php

// Ne pas oublier d'inclure la libraire Form
include 'form.php';

// Création d'un objet Form.  // L'identifiant est obligatoire !
$mon_form = new Form('identifiant_unique', 'POST');

// Modification de l'attribut &quot;action&quot;
$mon_form-&gt;action('test.php');

// Affichage du formulaire
echo $mon_form;</code></pre><p id="r-733036" data-claire-element-id="733036">Résultat :</p><pre id="r-733037" data-claire-element-id="733037"><code data-claire-semantic="html">&lt;form method=&quot;POST&quot; action=&quot;test.php&quot;&gt;
	&lt;p&gt;
		&lt;input name=&quot;uniqid&quot; type=&quot;hidden&quot; value=&quot;identifiant_unique&quot; /&gt;
	&lt;/p&gt;
&lt;/form&gt;</code></pre><h2 id="r-ajout-d-un-champ" data-claire-element-id="733047">Ajout d'un champ</h2><p id="r-733039" data-claire-element-id="733039">Premier exemple :</p><pre id="r-733040" data-claire-element-id="733040"><code data-claire-semantic="html+php">&lt;?php

// Ne pas oublier d'inclure la libraire Form
include 'form.php';

// Création d'un objet Form.  // L'identifiant est obligatoire !
$mon_form = new Form('identifiant_unique', 'POST'); // 'identifiant_unique'

// Ajout d'un champ de type &quot;Text&quot; nommé &quot;prenom&quot;
$mon_form-&gt;add('Text', 'prenom');

// Affichage du formulaire
echo $mon_form;</code></pre><p id="r-733041" data-claire-element-id="733041">Résultat :</p><pre id="r-733042" data-claire-element-id="733042"><code data-claire-semantic="html">&lt;form method=&quot;POST&quot;&gt;
	&lt;p&gt;
		&lt;input name=&quot;prenom&quot; type=&quot;text&quot; /&gt;
	&lt;/p&gt;
	&lt;p&gt;
		&lt;input name=&quot;uniqid&quot; type=&quot;hidden&quot; value=&quot;identifiant_unique&quot; /&gt;
	&lt;/p&gt;
&lt;/form&gt;</code></pre><p id="r-733043" data-claire-element-id="733043">Deuxième exemple, avec un label :</p><pre id="r-733044" data-claire-element-id="733044"><code data-claire-semantic="html+php">&lt;?php

// Ne pas oublier d'inclure la libraire Form
include 'form.php';

// Création d'un objet Form.  // L'identifiant est obligatoire !
$mon_form = new Form('POST'); // 'identifiant_unique'

// Ajout d'un champ texte nommé &quot;prenom&quot;
$mon_form-&gt;add('Text', 'prenom')
         -&gt;label('Votre prénom SVP');

// Affichage du formulaire
echo $mon_form;</code></pre><p id="r-733045" data-claire-element-id="733045">Résultat :</p><pre id="r-733046" data-claire-element-id="733046"><code data-claire-semantic="html">&lt;form method=&quot;GET&quot;&gt;
	&lt;p&gt;
		&lt;label id=&quot;id_prenom&quot;&gt;Votre prénom SVP :&lt;/label&gt;
		&lt;input for=&quot;id_prenom&quot; name=&quot;prenom&quot; type=&quot;text&quot; /&gt;
	&lt;/p&gt;
	&lt;p&gt;
		&lt;input name=&quot;uniqid&quot; type=&quot;hidden&quot; value=&quot;POST&quot; /&gt;
	&lt;/p&gt;
&lt;/form&gt;</code></pre><h2 id="r-les-differents-types-de-champs-et-leur-utilisation" data-claire-element-id="733136">Les différents types de champs et leur utilisation</h2><p id="r-733048" data-claire-element-id="733048">La classe permet de créer :</p><ul id="r-733071" data-claire-element-id="733071"><li id="r-733050" data-claire-element-id="733050"><p id="r-733049" data-claire-element-id="733049">des zones de texte ;</p></li><li id="r-733052" data-claire-element-id="733052"><p id="r-733051" data-claire-element-id="733051">des zones de texte multi-lignes ;</p></li><li id="r-733054" data-claire-element-id="733054"><p id="r-733053" data-claire-element-id="733053">des champs mot de passe ;</p></li><li id="r-733056" data-claire-element-id="733056"><p id="r-733055" data-claire-element-id="733055">des champs cachés ;</p></li><li id="r-733058" data-claire-element-id="733058"><p id="r-733057" data-claire-element-id="733057">des boutons de validation ;</p></li><li id="r-733060" data-claire-element-id="733060"><p id="r-733059" data-claire-element-id="733059">des listes d'options ;</p></li><li id="r-733062" data-claire-element-id="733062"><p id="r-733061" data-claire-element-id="733061">des listes d'options hiérarchisées ;</p></li><li id="r-733064" data-claire-element-id="733064"><p id="r-733063" data-claire-element-id="733063">des cases à cocher ;</p></li><li id="r-733066" data-claire-element-id="733066"><p id="r-733065" data-claire-element-id="733065">des champs pour uploader un fichier ;</p></li><li id="r-733068" data-claire-element-id="733068"><p id="r-733067" data-claire-element-id="733067">des champs &quot;adresse email&quot; ;</p></li><li id="r-733070" data-claire-element-id="733070"><p id="r-733069" data-claire-element-id="733069">des champs dates / heures.</p></li></ul><h3 id="r-la-zone-de-texte-2" data-claire-element-id="733074">La zone de texte</h3><p id="r-733072" data-claire-element-id="733072">Elle correspond à la balise HTML <code data-claire-semantic="html">&lt;input type=&quot;text&quot; /&gt; </code>. Elle est représenté par le type <strong>Text</strong> et se crée donc ainsi :</p><pre id="r-733073" data-claire-element-id="733073"><code data-claire-semantic="html+php">&lt;?php
// Ajout d'un champ texte nommé &quot;prenom&quot;
$mon_form-&gt;add('Text', 'prenom');</code></pre><h3 id="r-la-zone-de-texte-multi-lignes" data-claire-element-id="733077">La zone de texte multi-lignes</h3><p id="r-733075" data-claire-element-id="733075">Elle correspond à la balise HTML <code data-claire-semantic="html">&lt;textarea&gt;&lt;/textarea&gt; </code>. Elle est représenté par le type <strong>Textarea</strong> et se crée donc ainsi :</p><pre id="r-733076" data-claire-element-id="733076"><code data-claire-semantic="html+php">&lt;?php
// Ajout d'un champ texte nommé &quot;commentaires&quot;
$mon_form-&gt;add('Textarea', 'commentaires');</code></pre><h3 id="r-le-champ-mot-de-passe" data-claire-element-id="733080">Le champ mot de passe</h3><p id="r-733078" data-claire-element-id="733078">Il correspond à la balise HTML <code data-claire-semantic="html">&lt;input type=&quot;password&quot; /&gt; </code>. Il est représenté par le type <strong>Password</strong> et se crée donc ainsi :</p><pre id="r-733079" data-claire-element-id="733079"><code data-claire-semantic="html+php">&lt;?php
// Ajout d'un champ mot de passe nommé &quot;mot_de_passe&quot;
$mon_form-&gt;add('Password', 'mot_de_passe');</code></pre><h3 id="r-le-champ-cache-2" data-claire-element-id="733083">Le champ caché</h3><p id="r-733081" data-claire-element-id="733081">Il correspond à la balise HTML <code data-claire-semantic="html">&lt;input type=&quot;hidden&quot; /&gt; </code>. Il est représenté par le type <strong>Hidden</strong> et se crée donc ainsi :</p><pre id="r-733082" data-claire-element-id="733082"><code data-claire-semantic="html+php">&lt;?php
// Ajout d'un champ cache nommé &quot;secret&quot;
$mon_form-&gt;add('Hidden', 'secret');</code></pre><h3 id="r-le-bouton-de-validation-3" data-claire-element-id="733086">Le bouton de validation</h3><p id="r-733084" data-claire-element-id="733084">Il correspond à la balise HTML <code data-claire-semantic="html">&lt;input type=&quot;submit&quot; /&gt; </code>. Il est représenté par le type <strong>Submit</strong> et se crée donc ainsi :</p><pre id="r-733085" data-claire-element-id="733085"><code data-claire-semantic="html+php">&lt;?php
// Ajout d'un bouton de validation nommé &quot;submit&quot;
$mon_form-&gt;add('Submit', 'submit');</code></pre><h3 id="r-la-liste-d-options" data-claire-element-id="733090">La liste d'options</h3><p id="r-733087" data-claire-element-id="733087">Elle est réalisée grâce à la balise HTML <code data-claire-semantic="html">&lt;input type=&quot;radio&quot; /&gt; </code>. Elle est représentée par le type <strong>Radio</strong> et se crée donc ainsi :</p><pre id="r-733088" data-claire-element-id="733088"><code data-claire-semantic="html+php">&lt;?php
// Ajout d'une liste d'options pour choisir une couleur
$mon_form-&gt;add('Radio', 'couleur')
         -&gt;choices(array(
           'v' =&gt; 'Vert',
           'o' =&gt; 'Orange',
           'r' =&gt; 'Rouge',
           'b' =&gt; 'Bleu'
         ));</code></pre><p id="r-733089" data-claire-element-id="733089">Une liste d'options a besoin d'un tableau de valeurs que l'on passe à la méthode choices(). La clé correspond à la valeur récupérée lorsque l'on fait $mon_form-&gt;get_cleaned_data('couleur'); et la valeur correspond à ce qui est affiché à l'utilisateur dans la page HTML.</p><h3 id="r-la-liste-d-options-hierarchisee" data-claire-element-id="733094">La liste d'options hiérarchisée</h3><p id="r-733091" data-claire-element-id="733091">Elle est réalisée grâce aux balises HTML <code data-claire-semantic="html">&lt;select&gt; </code><code data-claire-semantic="html">&lt;optgroup&gt; </code> et <code data-claire-semantic="html">&lt;option&gt; </code>. Elle est représentée par le type <strong>Select</strong> et se crée donc ainsi :</p><pre id="r-733092" data-claire-element-id="733092"><code data-claire-semantic="html+php">&lt;?php
// Ajout d'une liste d'options pour choisir une pays
$mon_form-&gt;add('Select', 'pays')
         -&gt;choices(array(
           'Europe' =&gt; array(
             'fr' =&gt; 'France',
             'de' =&gt; 'Allemagne'
           ),
           'Asie' =&gt; array(
             'cn' =&gt; 'Chine',
             'jp' =&gt; 'Japon'
           )
         ));</code></pre><p id="r-733093" data-claire-element-id="733093">Elle peut s'utiliser de la même façon que la liste d'options, mais comme le montre l'exemple, on peut également effectuer un regroupement dans les choix possibles, afin d'améliorer la lisibilité de la liste.</p><h3 id="r-la-case-a-cocher-2" data-claire-element-id="733097">La case à cocher</h3><p id="r-733095" data-claire-element-id="733095">Elle correspond à la balise HTML <code data-claire-semantic="html">&lt;input type=&quot;checkbox&quot; /&gt; </code>. Elle est représentée par le type <strong>Checkbox</strong> et se crée donc ainsi :</p><pre id="r-733096" data-claire-element-id="733096"><code data-claire-semantic="html+php">&lt;?php
// Ajout d'une case a cocher nommeé &quot;license&quot;
$mon_form-&gt;add('Checkbox', 'license');</code></pre><h3 id="r-le-champ-pour-uploader-un-fichier" data-claire-element-id="733101">Le champ pour uploader un fichier</h3><p id="r-733098" data-claire-element-id="733098">Il correspond à la balise HTML <code data-claire-semantic="html">&lt;input type=&quot;file&quot; /&gt; </code>. Il est représenté par le type <strong>File</strong> et se crée donc ainsi :</p><pre id="r-733099" data-claire-element-id="733099"><code data-claire-semantic="html+php">&lt;?php
// Ajout d'un champ pour uploader un fichier nommé &quot;fichier&quot;
$mon_form-&gt;add('File', 'fichier')
         -&gt;max_size(4096)
         -&gt;extensions(array('jpg', 'gif', 'png'));</code></pre><p id="r-733100" data-claire-element-id="733100">La classe fournit également une méthode max_size() pour limiter la taille du fichier uploadé (la taille est spécifiée en octets) ainsi qu'une autre méthode extensions() pour filtrer les extensions autorisées. L'exemple proposé n'autorise que les fichiers images ayant une taille inférieure à 4 ko.</p><h3 id="r-le-champ-adresse-email" data-claire-element-id="733105">Le champ &quot;adresse email&quot;</h3><p id="r-733102" data-claire-element-id="733102">Il étend la balise HTML <code data-claire-semantic="html">&lt;input type=&quot;text&quot; /&gt; </code>. Il est représenté par le type <strong>Email</strong> et se crée donc ainsi :</p><pre id="r-733103" data-claire-element-id="733103"><code data-claire-semantic="html+php">&lt;?php
// Ajout d'un champ adresse e-mail nommé &quot;email&quot;
$mon_form-&gt;add('Email', 'email');</code></pre><p id="r-733104" data-claire-element-id="733104">Il possède une règle de validation qui n'autorise l'utilisateur qu'à rentrer une adresse e-mail valide syntaxiquement. Dans la cas contraire, une erreur sera retournée afin que l'utilisateur entre une adresse valide.</p><h3 id="r-le-champ-dates-heures" data-claire-element-id="733109">Le champ dates / heures</h3><p id="r-733106" data-claire-element-id="733106">Il étend la balise HTML <code data-claire-semantic="html">&lt;input type=&quot;text&quot; /&gt; </code>. Il est représenté par le type <strong>Date</strong> et se crée donc ainsi :</p><pre id="r-733107" data-claire-element-id="733107"><code data-claire-semantic="html+php">&lt;?php
// Ajout d'un champ date nommé &quot;date&quot;
$mon_form-&gt;add('Date', 'date')
         -&gt;format('dd/mm/yyyy');</code></pre><p id="r-733108" data-claire-element-id="733108">Un champ date a besoin qu'on lui fournisse un format de date et heure grâce à la méthode format().<br/> Il possède une règle de validation qui n'autorise l'utilisateur qu'à entrer une date dont le format correspond à celui précisé grâce à la méthode format(). Dans la cas contraire, une erreur sera retournée afin que l'utilisateur entre une date ayant le bon format.</p><h3 id="r-liste-des-formats-de-date-et-heure" data-claire-element-id="733126">Liste des formats de date et heure</h3><p id="r-733110" data-claire-element-id="733110">Les formats supportés sont les suivants :</p><ul id="r-733125" data-claire-element-id="733125"><li id="r-733112" data-claire-element-id="733112"><p id="r-733111" data-claire-element-id="733111">dd : jour sur deux chiffres (entre 01 et 31) ;</p></li><li id="r-733114" data-claire-element-id="733114"><p id="r-733113" data-claire-element-id="733113">mm : mois sur deux chiffres (entre 01 et 12) ;</p></li><li id="r-733116" data-claire-element-id="733116"><p id="r-733115" data-claire-element-id="733115">yy : année sur deux chiffres (entre 1970 et 2069) ;</p></li><li id="r-733118" data-claire-element-id="733118"><p id="r-733117" data-claire-element-id="733117">yyyy : année sur quatre chiffres (entre 1900 et 9999) ;</p></li><li id="r-733120" data-claire-element-id="733120"><p id="r-733119" data-claire-element-id="733119">HH : heure sur deux chiffres (entre 01 et 23) ;</p></li><li id="r-733122" data-claire-element-id="733122"><p id="r-733121" data-claire-element-id="733121">MM : minute sur deux chiffres (entre 00 et 59) ;</p></li><li id="r-733124" data-claire-element-id="733124"><p id="r-733123" data-claire-element-id="733123">SS : secondes sur deux chiffres (entre 00 et 59).</p></li></ul><h3 id="r-liste-des-options-communes-a-tous-les-champs" data-claire-element-id="733135">Liste des options communes à tous les champs</h3><p id="r-733127" data-claire-element-id="733127">Tous les champs possèdent les méthodes suivantes.</p><ul id="r-733134" data-claire-element-id="733134"><li id="r-733129" data-claire-element-id="733129"><p id="r-733128" data-claire-element-id="733128">autocomplete($bool) : permet de définir la propriété HTML &quot;autocomplete&quot;. Ceci permet par exemple de ne pas pouvoir pré-remplir un champ particulier. Ne vous en servez pas si vous ne savez pas ce que c'est.</p></li><li id="r-733131" data-claire-element-id="733131"><p id="r-733130" data-claire-element-id="733130">maxlength($int) : permet de définir la longueur maximale que doit avoir champ texte. Si la longueur du champ est plus grande, une erreur sera retournée à l'utilisateur afin qu'il y écrive une valeur moins longue.</p></li><li id="r-733133" data-claire-element-id="733133"><p id="r-733132" data-claire-element-id="733132">minlenght($int) : permet de définir la longueur minimale que doit avoir un champ texte. Si la longueur du champ est plus petite, une erreur sera retournée à l'utilisateur afin qu'il y écrive une valeur plus longue.</p></li></ul><h2 id="r-resume-des-types-de-champs-disponibles-et-de-leurs-options" data-claire-element-id="733226">Résumé des types de champs disponibles et de leurs options</h2><table id="r-733225" data-claire-element-id="733225"><thead id="r-733144" data-claire-element-id="733144"><tr id="r-733143" data-claire-element-id="733143"><th id="r-733138" data-claire-element-id="733138"><p id="r-733137" data-claire-element-id="733137">Type du champ</p></th><th id="r-733140" data-claire-element-id="733140"><p id="r-733139" data-claire-element-id="733139">Résultat HTML</p></th><th id="r-733142" data-claire-element-id="733142"><p id="r-733141" data-claire-element-id="733141">Remarques</p></th></tr></thead><tbody id="r-733224" data-claire-element-id="733224"><tr id="r-733151" data-claire-element-id="733151"><td id="r-733146" data-claire-element-id="733146"><p id="r-733145" data-claire-element-id="733145">Text</p></td><td id="r-733148" data-claire-element-id="733148"><p id="r-733147" data-claire-element-id="733147"><code data-claire-semantic="html">&lt;input type=&quot;text&quot; /&gt;</code></p></td><td id="r-733150" data-claire-element-id="733150"><p id="r-733149" data-claire-element-id="733149">-</p></td></tr><tr id="r-733158" data-claire-element-id="733158"><td id="r-733153" data-claire-element-id="733153"><p id="r-733152" data-claire-element-id="733152">Password</p></td><td id="r-733155" data-claire-element-id="733155"><p id="r-733154" data-claire-element-id="733154"><code data-claire-semantic="html">&lt;input type=&quot;password&quot; /&gt;</code></p></td><td id="r-733157" data-claire-element-id="733157"><p id="r-733156" data-claire-element-id="733156">La valeur initiale est toujours vide.</p></td></tr><tr id="r-733165" data-claire-element-id="733165"><td id="r-733160" data-claire-element-id="733160"><p id="r-733159" data-claire-element-id="733159">Hidden</p></td><td id="r-733162" data-claire-element-id="733162"><p id="r-733161" data-claire-element-id="733161"><code data-claire-semantic="html">&lt;input type=&quot;hidden&quot; /&gt;</code></p></td><td id="r-733164" data-claire-element-id="733164"><p id="r-733163" data-claire-element-id="733163">-</p></td></tr><tr id="r-733172" data-claire-element-id="733172"><td id="r-733167" data-claire-element-id="733167"><p id="r-733166" data-claire-element-id="733166">Submit</p></td><td id="r-733169" data-claire-element-id="733169"><p id="r-733168" data-claire-element-id="733168"><code data-claire-semantic="html">&lt;input type=&quot;submit&quot; /&gt;</code></p></td><td id="r-733171" data-claire-element-id="733171"><p id="r-733170" data-claire-element-id="733170">-</p></td></tr><tr id="r-733179" data-claire-element-id="733179"><td id="r-733174" data-claire-element-id="733174"><p id="r-733173" data-claire-element-id="733173">Textarea</p></td><td id="r-733176" data-claire-element-id="733176"><p id="r-733175" data-claire-element-id="733175"><code data-claire-semantic="html">&lt;textarea&gt;&lt;/textarea&gt;</code></p></td><td id="r-733178" data-claire-element-id="733178"><p id="r-733177" data-claire-element-id="733177">Possibilité de spécifier le nombre de lignes et de colonnes affichées grâce aux méthodes rows($nombre) et cols($nombre).</p></td></tr><tr id="r-733186" data-claire-element-id="733186"><td id="r-733181" data-claire-element-id="733181"><p id="r-733180" data-claire-element-id="733180">Email</p></td><td id="r-733183" data-claire-element-id="733183"><p id="r-733182" data-claire-element-id="733182"><code data-claire-semantic="html">&lt;input type=&quot;text&quot; /&gt;</code></p></td><td id="r-733185" data-claire-element-id="733185"><p id="r-733184" data-claire-element-id="733184">La valeur doit être une adresse e-mail valide.</p></td></tr><tr id="r-733194" data-claire-element-id="733194"><td id="r-733188" data-claire-element-id="733188"><p id="r-733187" data-claire-element-id="733187">Date</p></td><td id="r-733190" data-claire-element-id="733190"><p id="r-733189" data-claire-element-id="733189"><code data-claire-semantic="html">&lt;input type=&quot;text&quot; /&gt;</code></p></td><td id="r-733193" data-claire-element-id="733193"><p id="r-733191" data-claire-element-id="733191">La date doit respecter le format donné.</p><p id="r-733192" data-claire-element-id="733192">Un format doit être donné à l'aide de la méthode -&gt;format($format).</p></td></tr><tr id="r-733202" data-claire-element-id="733202"><td id="r-733196" data-claire-element-id="733196"><p id="r-733195" data-claire-element-id="733195">File</p></td><td id="r-733198" data-claire-element-id="733198"><p id="r-733197" data-claire-element-id="733197"><code data-claire-semantic="html">&lt;input type=&quot;file&quot; /&gt;</code></p></td><td id="r-733201" data-claire-element-id="733201"><p id="r-733199" data-claire-element-id="733199">Possibilité de filtrer les extensions autorisées avec la méthode extensions($liste).</p><p id="r-733200" data-claire-element-id="733200">Possibilité de limiter la taille maximale du fichier (en octets) grâce à la méthode max_size($taille).</p></td></tr><tr id="r-733209" data-claire-element-id="733209"><td id="r-733204" data-claire-element-id="733204"><p id="r-733203" data-claire-element-id="733203">Radio</p></td><td id="r-733206" data-claire-element-id="733206"><p id="r-733205" data-claire-element-id="733205"><code data-claire-semantic="html">&lt;input type=&quot;radio&quot; /&gt;</code></p></td><td id="r-733208" data-claire-element-id="733208"><p id="r-733207" data-claire-element-id="733207">La liste des choix disponibles se fait grâce à la méthode choices($tableau).</p></td></tr><tr id="r-733216" data-claire-element-id="733216"><td id="r-733211" data-claire-element-id="733211"><p id="r-733210" data-claire-element-id="733210">Select</p></td><td id="r-733213" data-claire-element-id="733213"><p id="r-733212" data-claire-element-id="733212"><code data-claire-semantic="html">&lt;select&gt; </code><code data-claire-semantic="html">&lt;option&gt; </code> et <code data-claire-semantic="html">&lt;optgroup&gt;</code></p></td><td id="r-733215" data-claire-element-id="733215"><p id="r-733214" data-claire-element-id="733214">La liste des options et des groupes d'options disponibles se fait grâce à la méthode choices($tableau).</p></td></tr><tr id="r-733223" data-claire-element-id="733223"><td id="r-733218" data-claire-element-id="733218"><p id="r-733217" data-claire-element-id="733217">Checkbox</p></td><td id="r-733220" data-claire-element-id="733220"><p id="r-733219" data-claire-element-id="733219"><code data-claire-semantic="html">&lt;input type=&quot;checkbox&quot; /&gt;</code></p></td><td id="r-733222" data-claire-element-id="733222"><p id="r-733221" data-claire-element-id="733221">Possibilité de régler l'état coché ou non de la case avec la méthode checked($booleen).</p></td></tr></tbody></table><h2 id="r-validation-verification-du-formulaire-et-recuperation-des-valeurs-des-champs" data-claire-element-id="733233">Validation / vérification du formulaire et récupération des valeurs des champs</h2><p id="r-733227" data-claire-element-id="733227">Prenons comme exemple ce formulaire :</p><pre id="r-733228" data-claire-element-id="733228"><code data-claire-semantic="html+php">&lt;?php

// Ne pas oublier d'inclure la libraire Form
include 'form.php';

// Création d'un objet Form.  // L'identifiant est obligatoire !
$mon_form = new Form('exemple', 'POST');

// Ajout d'un champ texte nommé &quot;pseudo&quot;
$mon_form-&gt;add('Text', 'pseudo')
               -&gt;label('Votre pseudo SVP');

// Ajout d'une liste d'options pour choisir un pays
$mon_form-&gt;add('Select', 'pays')
         -&gt;label('Quel est votre pays préféré')
         -&gt;choices(array(
           'Europe' =&gt; array(
             'fr' =&gt; 'France',
             'de' =&gt; 'Allemagne'
           ),
           'Asie' =&gt; array(
             'cn' =&gt; 'Chine',
             'jp' =&gt; 'Japon'
           )
         ));

// Affichage du formulaire
echo $mon_form;</code></pre><p id="r-733229" data-claire-element-id="733229">Nous allons désormais afficher le résultat de ce formulaire après en avoir vérifié sa validité. C'est très simple :</p><pre id="r-733230" data-claire-element-id="733230"><code data-claire-semantic="html+php">&lt;?php

// Début identique
// [...]

// Si le formulaire est valide avec les données issues du tableau $_POST
if ($mon_form-&gt;is_valid($_POST)) {

	// On récupère les valeurs
	list($pseudo, $pays) = $mon_form-&gt;get_cleaned_data('pseudo', 'pays');
	
	// Et on les affiche
	echo 'Vous êtes '.$pseudo.' et votre pays préféré est &quot;'.$pays.'&quot;.';

} else {

	// Sinon on affichage le formulaire jusqu'à ce que ça soit valide
	echo $mon_form;
}</code></pre><p id="r-733231" data-claire-element-id="733231">Ça n'est pas plus compliqué ! ;)</p><p id="r-733232" data-claire-element-id="733232"><em>Note : </em>get_cleaned_data()<em> prend soit la liste des clés dont on veut récupérer la valeur, soit un tableau listant les clés que l'on veut récupérer. Elle peut également prendre une chaîne unique si l'on souhaite ne récupérer les données que d'un seul champ.</em></p><h2 id="r-la-suite-5" data-claire-element-id="733235">La suite ?</h2><p id="r-733234" data-claire-element-id="733234">Vous découvrirez d'autres fonctions utiles lors de la lecture de ce tutoriel, mais vous avez un aperçu global du fonctionnement de la classe, de son utilité et des manières de l'utiliser, ça suffira pour le moment.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques">Votre site PHP (presque) complet : architecture MVC et bonnes pratiques</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction : l&#039;avant-tutoriel
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/avant-propos-comment-fonctionne-ce-tutoriel">Avant-propos, comment fonctionne ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/introduction-objectifs-et-pre-requis">
Introduction, objectifs et pré-requis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/organisation-du-code-et-des-fichiers">
Organisation du code et des fichiers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonnes-pratiques-a-appliquer">Bonnes pratiques à appliquer</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/never-trust-user-input-3">
Never Trust User Input
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/l-enfer-des-guillemets-magiques-2">
L&#039;enfer des guillemets magiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/produire-un-code-lisible-et-comprehensible">
Produire un code lisible et compréhensible
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/les-classes-utilisees-dans-ce-tutoriel">Les classes utilisées dans ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/acces-a-la-base-de-donnees-avec-pdo2">
Accès à la base de données avec PDO2
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/gestion-des-formulaires-avec-la-classe-form">
Gestion des formulaires avec la classe Form
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Des systèmes simples : espace membres et livre d&#039;or
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/la-base-l-espace-membre">La base : l&#039;espace membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/objectifs-et-preparation">
Objectifs et préparation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/inscription-3">
Inscription
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/connexion-et-deconnexion-1">
Connexion et déconnexion
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonus-le-profil-d-un-membre">Bonus : le profil d&#039;un membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/mini-tp-affichage-d-un-profil-utilisateur">
[Mini TP] Affichage d&#039;un profil utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/modification-d-un-profil-utilisateur">
Modification d&#039;un profil utilisateur
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/acces-a-la-base-de-donnees-avec-pdo2">
<span class="arrow"></span>
<span class="next">Accès à la base de données avec PDO2</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/la-base-l-espace-membre">
<span class="next">La base : l&#039;espace membre</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Labasel039espacemembre"></a><h2>La base : l&#039;espace membre</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/gestion-des-formulaires-avec-la-classe-form">
<span class="arrow"></span>
<span class="next">Gestion des formulaires avec la classe Form</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/objectifs-et-preparation">
<span class="next">Objectifs et préparation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-733242" data-claire-element-id="733242">Cette partie aborde la mise en place de l'espace membre, qui est une brique indispensable à la mise en place d'une tonne d'autres modules (comme par exemple des news).</p><aside id="r-733244" data-claire-element-id="733244" data-claire-semantic="information"><p id="r-733243" data-claire-element-id="733243">Cette partie est volontairement plus &quot;assistée&quot; que les suivantes. C'est pour vous permettre de vous habituer aux outils que vous n'avez sans doute pas l'habitude d'utiliser, comme par exemple la classe PDO2 ou bien la classe Form. De plus l'architecture est sans doute nouvelle pour vous, cette première partie vous permettra de bien comprendre comment tout fonctionne afin que je puisse vous lâcher dans la nature plus librement dans les parties suivantes.</p></aside>
</div><a name="Objectifsetprparation"></a><h2>Objectifs et préparation</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/la-base-l-espace-membre">
<span class="arrow"></span>
<span class="next">La base : l&#039;espace membre</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/inscription-3">
<span class="next">Inscription</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-objectifs-14" data-claire-element-id="733256">Objectifs</h2><p id="r-733245" data-claire-element-id="733245">L'objectif est de créer un espace membre. Parmi les fonctionnalités, on trouvera :</p><ul id="r-733254" data-claire-element-id="733254"><li id="r-733247" data-claire-element-id="733247"><p id="r-733246" data-claire-element-id="733246">inscription d'un membre ;</p></li><li id="r-733249" data-claire-element-id="733249"><p id="r-733248" data-claire-element-id="733248">connexion et déconnexion ;</p></li><li id="r-733251" data-claire-element-id="733251"><p id="r-733250" data-claire-element-id="733250">affichage du profil utilisateur ;</p></li><li id="r-733253" data-claire-element-id="733253"><p id="r-733252" data-claire-element-id="733252">modification du profil utilisateur.</p></li></ul><p id="r-733255" data-claire-element-id="733255">Il vous sera nécessaire de connaître la partie sur les sessions en PHP, étant donné que nous allons nous en servir lors de la réalisation.</p><h2 id="r-la-table-sql-1" data-claire-element-id="733262">La table SQL</h2><pre id="r-733257" data-claire-element-id="733257"><code data-claire-semantic="sql">CREATE TABLE membres (

  id               int(10) unsigned NOT NULL AUTO_INCREMENT,
  nom_utilisateur  varchar(32)  NOT NULL,
  mot_de_passe     char(40)     NOT NULL,
  adresse_email    varchar(128) NOT NULL,
  hash_validation  char(32)     NOT NULL,
  date_inscription date NOT     NULL,
  avatar           varchar(128) NOT NULL DEFAULT '',

  PRIMARY KEY (id),
  UNIQUE KEY nom_utilisateur (nom_utilisateur),
  UNIQUE KEY adresse_email (adresse_email),
  KEY mot_de_passe (mot_de_passe)

) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;</code></pre><p id="r-733258" data-claire-element-id="733258">Les champs sont explicites, je ne pense pas qu'il soit nécessaire de revenir dessus.<br/> La taille du champ mot_de_passe est de 40 caractères pour pouvoir stocker le SHA1 du mot de passe.<br/> Le champ hash_validation contient le hash de validation (un MD5) tant que le membre n'a pas validé son compte via l'e-mail qui lui a été envoyé. En gros, si ce champ est vide, le compte est validé ; sinon il n'est pas validé.</p><p id="r-733259" data-claire-element-id="733259">Créez donc la table SQL dans votre base de données (si ce n'est déjà fait).</p><aside id="r-733261" data-claire-element-id="733261" data-claire-semantic="information"><p id="r-733260" data-claire-element-id="733260"><strong>Bonne pratique</strong> : utiliser des index et des contraintes unique là où c'est nécessaire dans votre base de données. Cela assurera un fonctionnement rapide de votre base de données ainsi qu'une intégrité des données qu'elles contient.</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques">Votre site PHP (presque) complet : architecture MVC et bonnes pratiques</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction : l&#039;avant-tutoriel
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/avant-propos-comment-fonctionne-ce-tutoriel">Avant-propos, comment fonctionne ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/introduction-objectifs-et-pre-requis">
Introduction, objectifs et pré-requis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/organisation-du-code-et-des-fichiers">
Organisation du code et des fichiers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonnes-pratiques-a-appliquer">Bonnes pratiques à appliquer</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/never-trust-user-input-3">
Never Trust User Input
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/l-enfer-des-guillemets-magiques-2">
L&#039;enfer des guillemets magiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/produire-un-code-lisible-et-comprehensible">
Produire un code lisible et compréhensible
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/les-classes-utilisees-dans-ce-tutoriel">Les classes utilisées dans ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/acces-a-la-base-de-donnees-avec-pdo2">
Accès à la base de données avec PDO2
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/gestion-des-formulaires-avec-la-classe-form">
Gestion des formulaires avec la classe Form
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Des systèmes simples : espace membres et livre d&#039;or
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/la-base-l-espace-membre">La base : l&#039;espace membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/objectifs-et-preparation">
Objectifs et préparation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/inscription-3">
Inscription
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/connexion-et-deconnexion-1">
Connexion et déconnexion
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonus-le-profil-d-un-membre">Bonus : le profil d&#039;un membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/mini-tp-affichage-d-un-profil-utilisateur">
[Mini TP] Affichage d&#039;un profil utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/modification-d-un-profil-utilisateur">
Modification d&#039;un profil utilisateur
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/la-base-l-espace-membre">
<span class="arrow"></span>
<span class="next">La base : l&#039;espace membre</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/inscription-3">
<span class="next">Inscription</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Inscription"></a><h2>Inscription</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/objectifs-et-preparation">
<span class="arrow"></span>
<span class="next">Objectifs et préparation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/connexion-et-deconnexion-1">
<span class="next">Connexion et déconnexion</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-preparation-du-terrain-2" data-claire-element-id="733267">Préparation du terrain</h2><p id="r-733264" data-claire-element-id="733264">Nous travaillons sur l'inscription d'un membre. Elle correspond logiquement à l'action inscription du module membres. Créez donc le fichier ~/modules/membres/inscription.php. Afin d'accéder facilement à cette page, nous allons ajouter l'inscription dans le menu :</p><pre id="r-733265" data-claire-element-id="733265"><code data-claire-semantic="html">&lt;div id=&quot;menu&quot;&gt;
	
		&lt;h2&gt;Menu&lt;/h2&gt;
		
		&lt;ul&gt;
			&lt;li&gt;&lt;a href=&quot;index.php&quot;&gt;Accueil&lt;/a&gt;&lt;/li&gt;
		&lt;/ul&gt;
		
		&lt;h3&gt;Espace membre&lt;/h3&gt;
		&lt;ul&gt;
			&lt;li&gt;&lt;a href=&quot;index.php?module=membres&amp;amp;action=inscription&quot;&gt;Inscription&lt;/a&gt;&lt;/li&gt;
		&lt;/ul&gt;
		
	&lt;/div&gt;</code></pre><p id="r-733266" data-claire-element-id="733266">Nous aurons besoin de vues, créez donc également le dossier ~/modules/membres/vues/.</p><h2 id="r-le-formulaire-1" data-claire-element-id="733288">Le formulaire</h2><p id="r-733268" data-claire-element-id="733268">L'id, le hash de validation et la date d'inscription sont générés automatiquement, nous n'avons pas besoin de demander ces informations à l'utilisateur lors de son inscription. Dans notre formulaire, nous avons donc besoin :</p><ul id="r-733277" data-claire-element-id="733277"><li id="r-733270" data-claire-element-id="733270"><p id="r-733269" data-claire-element-id="733269">d'un nom d'utilisateur ;</p></li><li id="r-733272" data-claire-element-id="733272"><p id="r-733271" data-claire-element-id="733271">d'un mot de passe ;</p></li><li id="r-733274" data-claire-element-id="733274"><p id="r-733273" data-claire-element-id="733273">d'une adresse e-mail ;</p></li><li id="r-733276" data-claire-element-id="733276"><p id="r-733275" data-claire-element-id="733275">d'un avatar facultatif.</p></li></ul><p id="r-733278" data-claire-element-id="733278">Ce qui nous mène à la création du formulaire suivant (en utilisant la classe Form) :</p><pre id="r-733279" data-claire-element-id="733279"><code data-claire-semantic="html+php">&lt;?php

// Ne pas oublier d'inclure la librarie Form
include CHEMIN_LIB.'form.php';

// &quot;formulaire_inscription&quot; est l'ID unique du formulaire
$form_inscription = new Form('formulaire_inscription');

$form_inscription-&gt;method('POST');

$form_inscription-&gt;add('Text', 'nom_utilisateur')
                 -&gt;label(&quot;Votre nom d'utilisateur&quot;);

$form_inscription-&gt;add('Password', 'mdp')
                 -&gt;label(&quot;Votre mot de passe&quot;);

$form_inscription-&gt;add('Password', 'mdp_verif')
                 -&gt;label(&quot;Votre mot de passe (vérification)&quot;);

$form_inscription-&gt;add('Email', 'adresse_email')
                 -&gt;label(&quot;Votre adresse email&quot;); 

$form_inscription-&gt;add('File', 'avatar')
                 -&gt;filter_extensions('jpg', 'png', 'gif')
                 -&gt;max_size(8192) // 8 Kb
                 -&gt;label(&quot;Votre avatar (facultatif)&quot;)
                 -&gt;Required(false);

$form_inscription-&gt;add('Submit', 'submit')
                 -&gt;value(&quot;Je veux m'inscrire !&quot;);

// Pré-remplissage avec les valeurs précédemment entrées (s'il y en a)
$form_inscription-&gt;bound($_POST);</code></pre><aside id="r-733281" data-claire-element-id="733281" data-claire-semantic="information"><p id="r-733280" data-claire-element-id="733280"><strong>Bonne pratique</strong> : remarquez que chaque ligne de code est alignée avec la précédente, ce qui rend le code très lisible. L'indentation utilisée permet donc de lire rapidement et facilement le code du formulaire.</p></aside><p id="r-733282" data-claire-element-id="733282">Voilà, le formulaire est créé : ça n'est pas très compliqué et tout de même bien pratique !<br/> Par exemple, pour l'avatar, on peut demander directement à la classe de filtrer certaines extensions et de limiter la taille du fichier. ;)</p><p id="r-733283" data-claire-element-id="733283">Vous ne voyez pas le joli formulaire que l'on vient de créer ? C'est normal, rien ne s'affiche pour le moment, et devinez pourquoi ? Allez, un petit effort...! Oui, c'est ça ! Nous n'avons encore aucune vue ! Réglons ça tout de suite.</p><p id="r-733284" data-claire-element-id="733284">Ajoutons ceci à la fin du fichier du fichier ~/modules/membres/inscription.php fraîchement créé :</p><pre id="r-733285" data-claire-element-id="733285"><code data-claire-semantic="html+php">&lt;?php

// Affichage du formulaire
include CHEMIN_VUE.'formulaire_inscription.php';</code></pre><p id="r-733286" data-claire-element-id="733286">Voici la vue correspondante (si vous avez suivi, l'emplacement du chemin pour ce fichier ne devrait pas vous poser de problème) :</p><pre id="r-733287" data-claire-element-id="733287"><code data-claire-semantic="html+php">&lt;h2&gt;Inscription au site&lt;/h2&gt;

&lt;?php

echo $form_inscription;</code></pre><h2 id="r-la-verification-1" data-claire-element-id="733300">La vérification</h2><h3 id="r-le-code-du-controleur" data-claire-element-id="733291">Le code du contrôleur</h3><p id="r-733289" data-claire-element-id="733289">Il est temps de vérifier si les données du formulaire sont valides (mots de passe identiques, adresse e-mail valide) et si un membre n'a pas déjà le nom d'utilisateur et / ou l'adresse e-mail demandés.</p><pre id="r-733290" data-claire-element-id="733290"><code data-claire-semantic="html+php">&lt;?php

// Création d'un tableau des erreurs
$erreurs_inscription = array();

// Validation des champs suivant les règles en utilisant les données du tableau $_POST
if ($form_inscription-&gt;is_valid($_POST)) {

	// On vérifie si les 2 mots de passe correspondent
	if ($form_inscription-&gt;get_cleaned_data('mdp') != $form_inscription-&gt;get_cleaned_data('mdp_verif')) {

		$erreurs_inscription[] = &quot;Les deux mots de passes entrés sont différents !&quot;;
	}

	// Si d'autres erreurs ne sont pas survenues
	if (empty($erreurs_inscription)) {

		// Traitement du formulaire à faire ici

	} else {

		// On affiche à nouveau le formulaire d'inscription
		include CHEMIN_VUE.'formulaire_inscription.php';
	}

} else {

	// On affiche à nouveau le formulaire d'inscription
	include CHEMIN_VUE.'formulaire_inscription.php';
}</code></pre><h3 id="r-la-vue-associee" data-claire-element-id="733293">La vue associée</h3><pre id="r-733292" data-claire-element-id="733292"><code data-claire-semantic="html+php">&lt;h2&gt;Inscription au site&lt;/h2&gt;

&lt;?php

if (!empty($erreurs_inscription)) {

	echo '&lt;ul&gt;'.&quot;\n&quot;;
	
	foreach($erreurs_inscription as $e) {
	
		echo '	&lt;li&gt;'.$e.'&lt;/li&gt;'.&quot;\n&quot;;
	}
	
	echo '&lt;/ul&gt;';
}

echo $form_inscription;</code></pre><h3 id="r-commentaires-et-explications" data-claire-element-id="733299">Commentaires et explications</h3><p id="r-733294" data-claire-element-id="733294">$form_inscription-&gt;is_valid($_POST) s'occupe de vérifier l'intégralité du formulaire (champs obligatoires, format de l'adresse e-mail, extension de l'avatar, etc.). Si la condition passe, tous les champs sont valides syntaxiquement.</p><p id="r-733295" data-claire-element-id="733295">On réalise ensuite les tests spécifiques à notre application : un mot de passe correct. On stocke l'erreur potentielle dans un tableau qui permettra à la vue de l'afficher (d'autres erreurs peuvent survenir plus tard, d'où l'utilisation d'un tableau et non d'une simple chaîne de caractères).</p><aside id="r-733297" data-claire-element-id="733297" data-claire-semantic="warning"><p id="r-733296" data-claire-element-id="733296">On notera que la vérification de l'unicité du nom d'utilisateur et de l'adresse e-mail se font plus tard.</p></aside><p id="r-733298" data-claire-element-id="733298">En effet, il ne faut pas utiliser de requête du type <code data-claire-semantic="sql">SELECT COUNT(*) FROM membres WHERE nom_utilisateur = :nom_utiliateur_souhaite </code> (avec un COUNT(*)) car si deux utilisateurs s'inscrivent en même temps avec le même pseudo, une erreur pourrait se produire, et la base de données nous renverrait un joli message d'erreur car nous avons défini ce champ en <code data-claire-semantic="sql">UNIQUE </code> dans le schéma de notre table.<br/> Nous allons plutôt utiliser ce message d'erreur retourné par MySQL lors de la requête <code data-claire-semantic="sql">INSERT INTO </code> pour savoir si un utilisateur avec le même nom et / ou la même adresse e-mail existe déjà. Après tout, la base de données elle-même est mieux placée que nous pour savoir si l'utilisateur existe déjà ou non ! Elle n'a pas besoin de notre COUNT(*) (qui en plus peut poser des problèmes si 2 utilisateurs s'inscrivent en même temps avec le même nom ou la même adresse e-mail).</p><h2 id="r-fin-de-la-verification-et-traitement-quand-tout-s-est-bien-passe" data-claire-element-id="733333">Fin de la vérification et traitement quand tout s'est bien passé</h2><p id="r-733301" data-claire-element-id="733301">Il s'agit d'ajouter le nouveau membre dans la base de données, puis de générer le hash de validation, d'envoyer le mail pour confirmer l'inscription, de redimensionner et de déplacer l'avatar éventuel dans le bon dossier (ne pas le laisser dans le dossier temporaire) - si tout s'est bien passé . Le traitement de l'avatar utilise la librairie Image qui permet d'ouvrir, de redimensionner et de sauvegarder une image dans les formats PNG, GIF et JPG. Vous pouvez télécharger le code de la classe <a href="http://esperat.fr/image.phps">à cette adresse</a>. Mettez le dans un fichier nommé ~/libs/image.php</p><p id="r-733302" data-claire-element-id="733302">À nouveau, je vous donne le code directement pour que vous puissiez vous habituer progressivement à la méthode de travail.</p><h3 id="r-le-code-du-controleur-1" data-claire-element-id="733305">Le code du contrôleur</h3><pre id="r-733303" data-claire-element-id="733303"><code data-claire-semantic="html+php">&lt;?php
// Tire de la documentation PHP sur &lt;http://fr.php.net/uniqid&gt;
$hash_validation = md5(uniqid(rand(), true));

// Tentative d'ajout du membre dans la base de donnees
list($nom_utilisateur, $mot_de_passe, $adresse_email, $avatar) =
	$form_inscription-&gt;get_cleaned_data('nom_utilisateur', 'mdp', 'adresse_email', 'avatar');

// On veut utiliser le modele de l'inscription (~/modeles/inscription.php)
include CHEMIN_MODELE.'inscription.php';

// ajouter_membre_dans_bdd() est défini dans ~/modeles/inscription.php
$id_utilisateur = ajouter_membre_dans_bdd($nom_utilisateur, sha1($mot_de_passe), $adresse_email, $hash_validation);

// Si la base de données a bien voulu ajouter l'utliisateur (pas de doublons)
if (ctype_digit($id_utilisateur)) {

	// On transforme la chaine en entier
	$id_utilisateur = (int) $id_utilisateur;
	
	// Preparation du mail
	$message_mail = '&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;
	&lt;p&gt;Merci de vous être inscrit sur &quot;mon site&quot; !&lt;/p&gt;
	&lt;p&gt;Veuillez cliquer sur &lt;a href=&quot;'.$_SERVER['PHP_SELF'].'?module=membres&amp;amp;action=valider_compte&amp;amp;hash='.$hash_validation.'&quot;&gt;ce lien&lt;/a&gt; pour activer votre compte !&lt;/p&gt;
	&lt;/body&gt;&lt;/html&gt;';
	
	$headers_mail  = 'MIME-Version: 1.0'                           .&quot;\r\n&quot;;
	$headers_mail .= 'Content-type: text/html; charset=utf-8'      .&quot;\r\n&quot;;
	$headers_mail .= 'From: &quot;Mon site&quot; &lt;<a class="__cf_email__" href="http://www.cloudflare.com/email-protection" data-cfemail="ee8d81809a8f8d9aae8381809d879a8bc08d8183">[email&nbsp;protected]</a><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script>&gt;'      .&quot;\r\n&quot;;
	
	// Envoi du mail
	mail($form_inscription-&gt;get_cleaned_data('adresse_email'), 'Inscription sur &lt;monsite.com&gt;', $message_mail, $headers_mail);
	
	// Redimensionnement et sauvegarde de l'avatar (eventuel) dans le bon dossier
	if (!empty($avatar)) {

		// On souhaite utiliser la librairie Image
		include CHEMIN_LIB.'image.php';
	
		// Redimensionnement et sauvegarde de l'avatar
		$avatar = new Image($avatar);
		$avatar-&gt;resize_to(100, 100); // Image-&gt;resize_to($largeur_maxi, $hauteur_maxi)
		$avatar_filename = 'images/avatar/'.$id_utilisateur .'.'.strtolower(pathinfo($avatar-&gt;get_filename(), PATHINFO_EXTENSION));
		$avatar-&gt;save_as($avatar_filename);

		// On veut utiliser le modele des membres (~/modeles/membres.php)
		include CHEMIN_MODELE.'membres.php';
		
		// Mise à jour de l'avatar dans la table
		// maj_avatar_membre() est défini dans ~/modeles/membres.php
		maj_avatar_membre($id_utilisateur , $avatar_filename);

	}
	
	// Affichage de la confirmation de l'inscription
	include CHEMIN_VUE.'inscription_effectuee.php';

// Gestion des doublons
} else {

	// Changement de nom de variable (plus lisible)
	$erreur =&amp; $id_utilisateur;
	
	// On vérifie que l'erreur concerne bien un doublon
	if (23000 == $erreur[0]) { // Le code d'erreur 23000 siginife &quot;doublon&quot; dans le standard ANSI SQL
	
		preg_match(&quot;`Duplicate entry '(.+)' for key \d+`is&quot;, $erreur[2], $valeur_probleme);
		$valeur_probleme = $valeur_probleme[1];
		
		if ($nom_utilisateur == $valeur_probleme) {
		
			$erreurs_inscription[] = &quot;Ce nom d'utilisateur est déjà utilisé.&quot;;
		
		} else if ($adresse_email == $valeur_probleme) {
		
			$erreurs_inscription[] = &quot;Cette adresse e-mail est déjà utilisée.&quot;;
		
		} else {
		
			$erreurs_inscription[] = &quot;Erreur ajout SQL : doublon non identifié présent dans la base de données.&quot;;
		}
	
	} else {
	
		$erreurs_inscription[] = sprintf(&quot;Erreur ajout SQL : cas non traité (SQLSTATE = %d).&quot;, $erreur[0]);
	}
	
	// On reaffiche le formulaire d'inscription
	include CHEMIN_VUE.'formulaire_inscription.php';
}</code></pre><p id="r-733304" data-claire-element-id="733304">Ça vous paraît pas mal ? Pourtant, <strong>2 mauvaises pratiques ont été utilisées</strong> dans ce code... Saurez-vous les identifier ?</p><h3 id="r-aparte-sur-les-bonnes-pratiques" data-claire-element-id="733316">Aparté sur les bonnes pratiques</h3><p id="r-733306" data-claire-element-id="733306">Voyez-vous la ligne resize_to(100, 100) dans le code ? Rappelez-vous la partie sur les bonnes pratiques à appliquer...<br/> Non, toujours pas ? Eh bien si ! 100 est un argument muet et on ne sait pas trop à quoi il correspond (imaginez que je n'aie pas mis le commentaire à côté)... La largeur absolue ? La hauteur maximale ? On ne sait d'ailleurs même pas quel argument correspond à la largeur et quel argument correspond à la hauteur...</p><p id="r-733307" data-claire-element-id="733307">Il faut donc créer 2 constantes pour éliminer toute ambiguïté dans le code. Rendez-vous dans votre fichier de configuration ~/global/config.php et rajoutez ces 2 constantes :</p><pre id="r-733308" data-claire-element-id="733308"><code data-claire-semantic="html+php">&lt;?php

// Identifiants pour la base de données. Nécessaires à PDO2.
// [...]

// Chemins à utiliser pour accéder aux vues/modèles/librairies
// [...]

// Configurations relatives à l'avatar
define('AVATAR_LARGEUR_MAXI', 100);
define('AVATAR_HAUTEUR_MAXI', 100);</code></pre><p id="r-733309" data-claire-element-id="733309">Modifiez également le fichier ~/modules/membres/inscription.php afin d'y intégrer ces constantes :<br/><code data-claire-semantic="html+php">&lt;?php $avatar-&gt;resize_to(AVATAR_LARGEUR_MAXI, AVATAR_HAUTEUR_MAXI); </code>. On peut même se payer le luxe d'enlever le commentaire à côté, ça n'est plus nécessaire car nous avons auto-documenté le code.</p><aside id="r-733311" data-claire-element-id="733311" data-claire-semantic="information"><p id="r-733310" data-claire-element-id="733310"><strong>Bonne pratique</strong> : utiliser des constantes pour éliminer les paramètres muets et les valeurs constantes présentes dans le code. Vous vous souvenez ?</p></aside><p id="r-733312" data-claire-element-id="733312">Si vous regardez bien, il reste encore une valeur constante présente dans le code. C'est images/avatars/. Nous allons mettre en application dès maintenant une bonne pratique en créant une constante DOSSIER_AVATAR !</p><p id="r-733313" data-claire-element-id="733313">Direction notre fichier ~/global/config.php pour rajouter la définition de la constante : <code data-claire-semantic="html+php">&lt;?php define('DOSSIER_AVATAR', 'images/avatars/'); </code>. N'oubliez pas non plus de remplacer images/avatars/ par la constante dans le fichier ~/modules/membres/inscription.php.</p><p id="r-733314" data-claire-element-id="733314">En bonus, on remarquera que si on veut modifier la largeur ou la hauteur maximale autorisée, il suffit d'aller faire un tour dans ~/global/config.php et de modifier la valeur de ces constantes. Elles agissent comme une configuration pour notre application.</p><p id="r-733315" data-claire-element-id="733315"><strong>L'objectif de cet aparté était de vous apprendre à repérer et à éliminer les paramètres muets et les valeurs constantes. J'espère qu'à partir de maintenant vous y penserez et que vous n'en utiliserez (presque) plus jamais !</strong></p><h3 id="r-les-fonctions-des-modeles-inscription-et-membres" data-claire-element-id="733319">Les fonctions des modèles inscription et membres</h3><pre id="r-733317" data-claire-element-id="733317"><code data-claire-semantic="html+php">&lt;?php

function ajouter_membre_dans_bdd($nom_utilisateur, $mdp, $adresse_email, $hash_validation) {

	$pdo = PDO2::getInstance();

	$requete = $pdo-&gt;prepare(&quot;INSERT INTO membres SET
		nom_utilisateur = :nom_utilisateur,
		mot_de_passe = :mot_de_passe,
		adresse_email = :adresse_email,
		hash_validation = :hash_validation,
		date_inscription = NOW()&quot;);

	$requete-&gt;bindValue(':nom_utilisateur', $nom_utilisateur);
	$requete-&gt;bindValue(':mot_de_passe',    $mdp);
	$requete-&gt;bindValue(':adresse_email',   $adresse_email);
	$requete-&gt;bindValue(':hash_validation', $hash_validation);

	if ($requete-&gt;execute()) {
	
		return $pdo-&gt;lastInsertId();
	}
	return $requete-&gt;errorInfo();
}</code></pre><pre id="r-733318" data-claire-element-id="733318"><code data-claire-semantic="html+php">&lt;?php

function maj_avatar_membre($id_utilisateur , $avatar) {

	$pdo = PDO2::getInstance();

	$requete = $pdo-&gt;prepare(&quot;UPDATE membres SET
		avatar = :avatar
		WHERE
		id = :id_utilisateur&quot;);

	$requete-&gt;bindValue(':id_utilisateur', $id_utilisateur);
	$requete-&gt;bindValue(':avatar',         $avatar);

	return $requete-&gt;execute();
}</code></pre><h3 id="r-la-vue-associee-1" data-claire-element-id="733321">La vue associée</h3><pre id="r-733320" data-claire-element-id="733320"><code data-claire-semantic="html">&lt;h2&gt;Inscription confirmée&lt;/h2&gt;

&lt;p&gt;L'inscription s'est déroulée avec succès !&lt;/p&gt;

&lt;p&gt;Vous allez bientôt recevoir un mail vous permettant d'activer votre compte afin de pouvoir vous connecter.&lt;/p&gt;</code></pre><h3 id="r-commentaires-et-explications-1" data-claire-element-id="733332">Commentaires et explications</h3><p id="r-733322" data-claire-element-id="733322">La vérification sur les doublons (nom d'utilisateur et / ou adresse e-mail) est faite à cet endroit. Je ne vous demanderai pas de savoir la refaire, mais essayez au moins de la comprendre, c'est toujours utile. :) Quelques cas bonus (qui ne devraient théoriquement pas arriver) sont même gérés : bref, c'est cadeau !</p><p id="r-733323" data-claire-element-id="733323">La fonction ajouter_membre_dans_bdd() nous retourne :</p><ul id="r-733328" data-claire-element-id="733328"><li id="r-733325" data-claire-element-id="733325"><p id="r-733324" data-claire-element-id="733324">soit l'id du nouvel utilisateur enregistré ;</p></li><li id="r-733327" data-claire-element-id="733327"><p id="r-733326" data-claire-element-id="733326">soit le tableau d'erreur fourni par errorInfo() (qui nous permet de vérifier les doublons).</p></li></ul><p id="r-733329" data-claire-element-id="733329">Pour vérifier que la requête SQL s'est bien passée, on vérifie donc que le résultat de la fonction ajouter_membre_dans_bdd() est numérique. On aurait également pu vérifier que ça n'est pas un tableau (au choix), mais il est préférable de s'assurer que le résultat est un entier, car l'id d'un utilisateur DOIT être numérique. C'est donc logiquement et sémantiquement plus correct.</p><p id="r-733330" data-claire-element-id="733330">La fonction ajouter_membre_dans_bdd() est spécifique à la phase d'inscription. Théoriquement, aucun autre module n'en a besoin, c'est pourquoi nous la placerons dans un fichier de modèle séparé (~/modeles/inscription.php), que l'on utilise seulement pour l'inscription, plutôt que dans le modèle global portant le nom de la table (~/modeles/membres.php). Ceci permet d'alléger le modèle global &quot;membres&quot; de cette fonction. La fonction maj_avatar_membre() pourra nous resservir, elle trouve donc sa place dans le modèle ~/modeles/membres.php.</p><p id="r-733331" data-claire-element-id="733331">Le reste du code contient un envoi de mail classique (si vous ne saviez pas faire, c'est désormais le cas, mais je ne pense pas qu'il soit utile de s'y attarder) ainsi qu'une utilisation de la classe Image pour redimensionner l'avatar et l'enregistrer dans le bon dossier. Notez que la classe ne modifie pas l'image originale s'il n'y a pas besoin de le faire et que la transparence est préservée entre les formats compatibles (GIF et PNG).</p><h2 id="r-la-validation-par-mail" data-claire-element-id="733343">La validation par mail</h2><p id="r-733334" data-claire-element-id="733334">L'utilisateur doit maintenant recevoir un mail et cliquer sur le lien présent pour activer son compte. Le lien pointe vers index.php?module=membres&amp;amp;action=valider_compte&amp;amp;hash=[_le_hash_]. L'action appelée est donc &quot;valider_compte&quot;, du module &quot;membres&quot;, et correspond donc au fichier ~/modules/membres/valider_compte.php, qu'il vous faut créer.</p><p id="r-733335" data-claire-element-id="733335">Si vous avez bien suivi, lors de l'inscription, un hash de validation est généré et inséré dans la table membres de la base de données. Tant que ce hash est présent, le compte n'est pas validé. Si le hash est absent, c'est que le compte a été validé. Valider le compte revient donc à supprimer ce hash de la base de données. Libre à vous de faire autrement si vous le souhaitez ! ;)</p><h3 id="r-le-code-du-controleur-2" data-claire-element-id="733337">Le code du contrôleur</h3><pre id="r-733336" data-claire-element-id="733336"><code data-claire-semantic="html+php">&lt;?php

// On vérifie qu'un hash est présent
if (!empty($_GET['hash'])) {

	// On veut utiliser le modèle des membres (~/modeles/membres.php)
	include CHEMIN_MODELE.'membres.php';

	// valider_compte_avec_hash() est définit dans ~/modeles/membres.php
	if (valider_compte_avec_hash($_GET['hash'])) {
	
		// Affichage de la confirmation de validation du compte
		include CHEMIN_VUE.'compte_valide.php';
	
	} else {
	
		// Affichage de l'erreur de validation du compte
		include CHEMIN_VUE.'erreur_activation_compte.php';
	}

} else {

	// Affichage de l'erreur de validation du compte
	include CHEMIN_VUE.'erreur_activation_compte.php';
}</code></pre><h3 id="r-la-fonction-du-modele-membres" data-claire-element-id="733339">La fonction du modèle membres</h3><pre id="r-733338" data-claire-element-id="733338"><code data-claire-semantic="html+php">&lt;?php

function valider_compte_avec_hash($hash_validation) {

	$pdo = PDO2::getInstance();

	$requete = $pdo-&gt;prepare(&quot;UPDATE membres SET
		hash_validation = ''
		WHERE
		hash_validation = :hash_validation&quot;);

	$requete-&gt;bindValue(':hash_validation', $hash_validation);
	
	$requete-&gt;execute();

	return ($requete-&gt;rowCount() == 1);
}</code></pre><h3 id="r-les-vues-associees" data-claire-element-id="733342">Les vues associées</h3><pre id="r-733340" data-claire-element-id="733340"><code data-claire-semantic="html">&lt;h2&gt;Confirmation de validation d'un compte&lt;/h2&gt;

&lt;p&gt;Le compte demandé a été validé avec succès !&lt;/p&gt;</code></pre><pre id="r-733341" data-claire-element-id="733341"><code data-claire-semantic="html">&lt;h2&gt;Erreur d'activation d'un compte&lt;/h2&gt;

&lt;p&gt;Le compte demandé n'a pas pu être activé, plusieurs raisons sont possibles :
- le hash de validation est manquant ou invalide ;
- le compte a déjà été validé.&lt;/p&gt;</code></pre>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques">Votre site PHP (presque) complet : architecture MVC et bonnes pratiques</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction : l&#039;avant-tutoriel
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/avant-propos-comment-fonctionne-ce-tutoriel">Avant-propos, comment fonctionne ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/introduction-objectifs-et-pre-requis">
Introduction, objectifs et pré-requis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/organisation-du-code-et-des-fichiers">
Organisation du code et des fichiers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonnes-pratiques-a-appliquer">Bonnes pratiques à appliquer</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/never-trust-user-input-3">
Never Trust User Input
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/l-enfer-des-guillemets-magiques-2">
L&#039;enfer des guillemets magiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/produire-un-code-lisible-et-comprehensible">
Produire un code lisible et compréhensible
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/les-classes-utilisees-dans-ce-tutoriel">Les classes utilisées dans ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/acces-a-la-base-de-donnees-avec-pdo2">
Accès à la base de données avec PDO2
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/gestion-des-formulaires-avec-la-classe-form">
Gestion des formulaires avec la classe Form
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Des systèmes simples : espace membres et livre d&#039;or
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/la-base-l-espace-membre">La base : l&#039;espace membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/objectifs-et-preparation">
Objectifs et préparation
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/inscription-3">
Inscription
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/connexion-et-deconnexion-1">
Connexion et déconnexion
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonus-le-profil-d-un-membre">Bonus : le profil d&#039;un membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/mini-tp-affichage-d-un-profil-utilisateur">
[Mini TP] Affichage d&#039;un profil utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/modification-d-un-profil-utilisateur">
Modification d&#039;un profil utilisateur
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/objectifs-et-preparation">
<span class="arrow"></span>
<span class="next">Objectifs et préparation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/connexion-et-deconnexion-1">
<span class="next">Connexion et déconnexion</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Connexionetdconnexion"></a><h2>Connexion et déconnexion</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/inscription-3">
<span class="arrow"></span>
<span class="next">Inscription</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonus-le-profil-d-un-membre">
<span class="next">Bonus : le profil d&#039;un membre</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-preparation-du-terrain-8" data-claire-element-id="733350">Préparation du terrain</h2><p id="r-733345" data-claire-element-id="733345">Nous travaillons dans cette partie sur la connexion et la déconnexion d'un membre. Ceci correspond logiquement aux actions connexion et deconnexion du module membres. Créez donc les fichiers ~/modules/membres/connexion.php et ~/modules/membres/deconnexion.php.</p><p id="r-733346" data-claire-element-id="733346">Nous commençons par coder la connexion. Afin d'accéder facilement à cette page, nous allons l'ajouter dans le menu :</p><pre id="r-733347" data-claire-element-id="733347"><code data-claire-semantic="html">&lt;div id=&quot;menu&quot;&gt;
	
		&lt;h2&gt;Menu&lt;/h2&gt;
		
		&lt;ul&gt;
			&lt;li&gt;&lt;a href=&quot;index.php&quot;&gt;Accueil&lt;/a&gt;&lt;/li&gt;
		&lt;/ul&gt;
		
		&lt;h3&gt;Espace membre&lt;/h3&gt;
		&lt;ul&gt;
			&lt;li&gt;&lt;a href=&quot;index.php?module=membres&amp;amp;action=inscription&quot;&gt;Inscription&lt;/a&gt;&lt;/li&gt;
			&lt;li&gt;&lt;a href=&quot;index.php?module=membres&amp;amp;action=connexion&quot;&gt;Connexion&lt;/a&gt;&lt;/li&gt;
		&lt;/ul&gt;
		
	&lt;/div&gt;</code></pre><p id="r-733348" data-claire-element-id="733348">Enfin, à partir de maintenant nous aurons besoin d'utiliser les sessions. Rendez-vous donc directement dans le fichier ~/global/init.php pour les activer.</p><pre id="r-733349" data-claire-element-id="733349"><code data-claire-semantic="html+php">&lt;?php

// Inclusion du fichier de configuration (qui définit des constantes)
include 'global/config.php';

// Utilisation et démarrage des sessions
session_start();

// Reste du fichier inchangé</code></pre><h2 id="r-le-formulaire-de-connexion-2" data-claire-element-id="733354">Le formulaire de connexion</h2><p id="r-733351" data-claire-element-id="733351">Celui-ci est particulièrement facile : c'est le même que l'inscription, avec plein de champs en moins ! Je vous le donne, profitez-en bien, ça ne durera pas !</p><h3 id="r-le-code-du-controleur-3" data-claire-element-id="733353">Le code du contrôleur</h3><pre id="r-733352" data-claire-element-id="733352"><code data-claire-semantic="html+php">&lt;?php

// Ne pas oublier d'inclure la librairie Form
include CHEMIN_LIB.'form.php';

// &quot;formulaire_connexion&quot; est l'ID unique du formulaire
$form_connexion = new Form('formulaire_connexion');

$form_connexion-&gt;method('POST');

$form_connexion-&gt;add('Text', 'nom_utilisateur')
               -&gt;label(&quot;Votre nom d'utilisateur&quot;);

$form_connexion-&gt;add('Password', 'mot_de_passe')
               -&gt;label(&quot;Votre mot de passe&quot;);

$form_connexion-&gt;add('Submit', 'submit')
               -&gt;value(&quot;Connectez-moi !&quot;);

// Pré-remplissage avec les valeurs précédemment entrées (s'il y en a)
$form_connexion-&gt;bound($_POST);</code></pre><h2 id="r-la-verification-du-formulaire-de-connexion" data-claire-element-id="733363">La vérification du formulaire de connexion</h2><p id="r-733355" data-claire-element-id="733355">Le code est très similaire à celui de l'inscription, mais - encore une fois - en plus simple.</p><h3 id="r-le-code-du-controleur-4" data-claire-element-id="733357">Le code du contrôleur</h3><pre id="r-733356" data-claire-element-id="733356"><code data-claire-semantic="html+php">&lt;?php

// Création d'un tableau des erreurs
$erreurs_connexion = array();

// Validation des champs suivant les règles
if ($form_connexion-&gt;is_valid($_POST)) {
	
	list($nom_utilisateur, $mot_de_passe) =
		$form_connexion-&gt;get_cleaned_data('nom_utilisateur', 'mot_de_passe');
	
	// On veut utiliser le modèle des membres (~/modeles/membres.php)
	include CHEMIN_MODELE.'membres.php';
	
	// combinaison_connexion_valide() est définit dans ~/modeles/membres.php
	$id_utilisateur = combinaison_connexion_valide($nom_utilisateur, sha1($mot_de_passe));
	
	// Si les identifiants sont valides
	if (false !== $id_utilisateur) {

		$infos_utilisateur = lire_infos_utilisateur($id_utilisateur);
		
		// On enregistre les informations dans la session
		$_SESSION['id']     = $id_utilisateur;
		$_SESSION['pseudo'] = $nom_utilisateur;
		$_SESSION['avatar'] = $infos_utilisateur['avatar'];
		$_SESSION['email']  = $infos_utilisateur['adresse_email'];
		
		// Affichage de la confirmation de la connexion
		include CHEMIN_VUE.'connexion_ok.php';
	
	} else {

		$erreurs_connexion[] = &quot;Couple nom d'utilisateur / mot de passe inexistant.&quot;;
		
		// On réaffiche le formulaire de connexion
		include CHEMIN_VUE.'formulaire_connexion.php';
	}
	
} else {

    // On réaffiche le formulaire de connexion
    include CHEMIN_VUE.'formulaire_connexion.php';
}</code></pre><h3 id="r-la-fonction-du-modele-membres-1" data-claire-element-id="733359">La fonction du modèle membres</h3><pre id="r-733358" data-claire-element-id="733358"><code data-claire-semantic="html+php">&lt;?php

function combinaison_connexion_valide($nom_utilisateur, $mot_de_passe) {

	$pdo = PDO2::getInstance();

	$requete = $pdo-&gt;prepare(&quot;SELECT id FROM membres
		WHERE
		nom_utilisateur = :nom_utilisateur AND 
		mot_de_passe = :mot_de_passe AND
		hash_validation = ''&quot;);

	$requete-&gt;bindValue(':nom_utilisateur', $nom_utilisateur);
	$requete-&gt;bindValue(':mot_de_passe', $mot_de_passe);
	$requete-&gt;execute();
	
	if ($result = $requete-&gt;fetch(PDO::FETCH_ASSOC)) {
	
		$requete-&gt;closeCursor();
		return $result['id'];
	}
	return false;
}

function lire_infos_utilisateur($id_utilisateur) {

	$pdo = PDO2::getInstance();

	$requete = $pdo-&gt;prepare(&quot;SELECT nom_utilisateur, mot_de_passe, adresse_email, avatar, date_inscription, hash_validation
		FROM membres
		WHERE
		id = :id_utilisateur&quot;);

	$requete-&gt;bindValue(':id_utilisateur', $id_utilisateur);
	$requete-&gt;execute();
	
	if ($result = $requete-&gt;fetch(PDO::FETCH_ASSOC)) {
	
		$requete-&gt;closeCursor();
		return $result;
	}
	return false;
}</code></pre><h3 id="r-les-vues-associees-1" data-claire-element-id="733362">Les vues associées</h3><pre id="r-733360" data-claire-element-id="733360"><code data-claire-semantic="html+php">&lt;h2&gt;Connexion au site&lt;/h2&gt;

&lt;p&gt;Si vous n'êtes pas encore inscrit, vous pouvez le faire en &lt;a href=&quot;index.php?module=membres&amp;amp;action=inscription&quot;&gt;cliquant sur ce lien&lt;/a&gt;.&lt;/p&gt;

&lt;?php

if (!empty($erreurs_connexion)) {

	echo '&lt;ul&gt;'.&quot;\n&quot;;
	
	foreach($erreurs_connexion as $e) {
	
		echo '	&lt;li&gt;'.$e.'&lt;/li&gt;'.&quot;\n&quot;;
	}
	
	echo '&lt;/ul&gt;';
}

echo $form_connexion;</code></pre><pre id="r-733361" data-claire-element-id="733361"><code data-claire-semantic="html+php">&lt;h2&gt;Confirmation de connexion&lt;/h2&gt;

&lt;p&gt;Bienvenue, &lt;?php echo $_SESSION['pseudo']; ?&gt;.&lt;br /&gt;
Vous êtes maintenant connecté !&lt;/p&gt;</code></pre><h2 id="r-commentaires-et-explications-2" data-claire-element-id="733367">Commentaires et explications</h2><p id="r-733364" data-claire-element-id="733364">Ça va commencer à devenir une habitude, $form_connexion-&gt;is_valid($_POST) nous assure que les champs sont bien remplis. Il faut ensuite faire les tests spécifiques à notre application, dans notre cas : vérifier que le couple nom d'utilisateur / mot de passe est correct !</p><p id="r-733365" data-claire-element-id="733365">La fonction combinaison_connexion_valide() retourne false si la combinaison nom d'utilisateur / mot de passe est mauvaise, et retourne l'id de l'utilisateur de succès. Nous avons besoin d'une deuxième fonction lire_infos_utilisateur() pour remplir la session.</p><p id="r-733366" data-claire-element-id="733366">Les informations sont enregistrées en SESSION si l'utilisateur a fourni les bonnes informations pour se connecter. Une erreur est affichée à l'utilisateur dans le cas contraire.</p><h2 id="r-verifier-que-l-utilisateur-est-connecte" data-claire-element-id="733372">Vérifier que l'utilisateur est connecté</h2><p id="r-733368" data-claire-element-id="733368">Étant donné que lors d'une connexion réussie, nous enregistrons les informations en session, il suffit de vérifier si la variable de session existe pour voir si l'utilisateur est connecté.</p><pre id="r-733369" data-claire-element-id="733369"><code data-claire-semantic="html+php">&lt;?php

if (!empty($_SESSION['id'])) {

	// L'utilisateur connecté, on peut récupérer :
	// $_SESSION['id']     - son id utilisateur    
	// $_SESSION['pseudo'] - son nom d'utilisateur 
	// $_SESSION['avatar'] - son avatar (s'il existe)

} else {

	// Utilisateur non connecté
}</code></pre><p id="r-733370" data-claire-element-id="733370">Comme vous allez le voir, nous aurons besoin d'utiliser cette vérification très régulièrement, et comme nous n'aimons pas répéter le code, nous allons créer une fonction pour le faire à notre place. :) Nous avons besoin de cette fonction partout, je propose donc de la mettre dans le fichier ~/global/init.php :</p><pre id="r-733371" data-claire-element-id="733371"><code data-claire-semantic="html+php">&lt;?php

// Début du fichier identique

// Vérifie si l'utilisateur est connecté   
function utilisateur_est_connecte() {
 
	return !empty($_SESSION['id']);
}</code></pre><h2 id="r-modification-du-menu-et-des-droits-d-acces" data-claire-element-id="733384">Modification du menu et des droits d'accès</h2><p id="r-733373" data-claire-element-id="733373">Maintenant que l'on sait vérifier si l'utilisateur est connecté, nous allons afficher les liens d'inscription et de connexion du menu uniquement si l'utilisateur est connecté. Sinon, on affiche son pseudo (attention à la sécurité) et un lien de déconnexion.</p><pre id="r-733374" data-claire-element-id="733374"><code data-claire-semantic="html+php">&lt;h3&gt;Espace membre&lt;/h3&gt;

&lt;?php if (!utilisateur_est_connecte()) { ?&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;index.php?module=membres&amp;amp;action=inscription&quot;&gt;Inscription&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;index.php?module=membres&amp;amp;action=connexion&quot;&gt;Connexion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;?php } else { ?&gt;
&lt;p&gt;Bienvenue, &lt;?php echo htmlspecialchars($_SESSION['pseudo']); ?&gt;.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;index.php?module=membres&amp;amp;action=deconnexion&quot;&gt;Déconnexion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;?php } ?&gt;</code></pre><p id="r-733375" data-claire-element-id="733375">Cependant cette &quot;protection&quot; n'est pas du tout suffisante... Si l'utilisateur est déjà connecté et qu'il tape à la main l'adresse index.php?module=membres&amp;amp;action=inscription, il pourra tout de même s'inscrire...<br/> Il faut donc vérifier que l'utilisateur n'est pas connecté pour accéder aux actions inscription.php, connexion.php et valider_compte.php et que l'utilisateur est connecté pour accéder à deconnexion.php.<br/> Ces vérifications seront désormais à ajouter sur toutes les pages ! Plutôt que de copier les fichiers de vues dans chaque dossier de module, nous allons placer ces vues dans un dossier commun, et donc en profiter pour créer une nouvelle constante CHEMIN_VUE_GLOBALE pour y accéder. Nous pouvons ainsi placer nos 2 nouveaux fichiers de vues erreur_deja_connecte.php et erreur_non_connecte.php dans le dossier ~/vues_globales/.</p><p id="r-733376" data-claire-element-id="733376">Allez donc dans le fichier ~/global/config.php afin de rajouter la définition de la constante <code data-claire-semantic="html+php">&lt;?php define('CHEMIN_VUE_GLOBALE', 'vues_globales/'); </code>.</p><p id="r-733377" data-claire-element-id="733377">Voici le code à rajouter pour protéger les 3 pages inscription.php, connexion.php et valider_compte.php présentes dans le dossier ~/modules/membres/.</p><pre id="r-733378" data-claire-element-id="733378"><code data-claire-semantic="html+php">&lt;?php

// Vérification des droits d'accès de la page
if (utilisateur_est_connecte()) {

	// On affiche la page d'erreur comme quoi l'utilisateur est déjà connecté   
	include CHEMIN_VUE_GLOBALE.'erreur_deja_connecte.php';
	
} else {

	// Reste de la page comme avant	
}</code></pre><p id="r-733379" data-claire-element-id="733379">Pour la page ~/modules/membres/deconnexion.php, c'est l'inverse :</p><pre id="r-733380" data-claire-element-id="733380"><code data-claire-semantic="html+php">&lt;?php

// Vérification des droits d'accès de la page
if (!utilisateur_est_connecte()) {

	// On affiche la page d'erreur comme quoi l'utilisateur doit être connecté pour voir la page
	include CHEMIN_VUE_GLOBALE.'erreur_non_connecte.php';
	
} else {

	// Reste de la page comme avant	
}</code></pre><p id="r-733381" data-claire-element-id="733381">Enfin, voici les codes des vues erreur_deja_connecte.php et erreur_non_connecte.php :</p><pre id="r-733382" data-claire-element-id="733382"><code data-claire-semantic="html">&lt;h2&gt;Accès interdit !&lt;/h2&gt;

&lt;p&gt;Inutile d'accéder à cette page si vous êtes connecté.&lt;/p&gt;</code></pre><pre id="r-733383" data-claire-element-id="733383"><code data-claire-semantic="html">&lt;h2&gt;Accès interdit !&lt;/h2&gt;

&lt;p&gt;Vous devez être connecté pour accéder à cette page.&lt;/p&gt;</code></pre><h2 id="r-la-connexion-automatique" data-claire-element-id="733403">La connexion automatique</h2><h3 id="r-un-peu-de-theorie-15" data-claire-element-id="733395">Un peu de théorie</h3><p id="r-733385" data-claire-element-id="733385">Voici quelque chose de très pratique... mais de très risqué aussi. Une connexion automatique est très intéressante à mettre en place, car les exigences en terme de sécurité y sont élevées. En effet, nous allons utiliser les COOKIES, qui sont l'une des premières cibles des <em>hackeurs</em> lorsqu'ils veulent s'en prendre à votre site : leur but va être de voler les cookies d'un membre, afin de le fouiller et voir les informations qu'ils peuvent en tirer. Je vais lister quelques cas courants pouvant se produire :</p><ul id="r-733392" data-claire-element-id="733392"><li id="r-733387" data-claire-element-id="733387"><p id="r-733386" data-claire-element-id="733386">Parfois, le mot de passe de l'utilisateur est stocké en clair dans le cookie. Le hackeur peut alors simplement se connecter avec le nom d'utilisateur connu et le mot de passe récupéré. C'est très mal.</p></li><li id="r-733389" data-claire-element-id="733389"><p id="r-733388" data-claire-element-id="733388">Parfois, le mot de passe est stocké en version hashé (par exemple, avec l'algorithme SHA-1). On peut penser que dans ce cas le hackeur ne peut rien faire, mais <strong>c'est faux</strong> ! De nombreux dictionnaires en ligne existent : ils stockent les hashs de nombreuses valeurs et il n'est plus rare de pouvoir récupérer le mot de passe à partir de la valeur hashée. Cette technique s'appelle un <em>brute-force</em> (test de toutes les possibilités jusqu'à ce que le mot de passe soit trouvé), et ces dictionnaires la rende très efficace !</p></li><li id="r-733391" data-claire-element-id="733391"><p id="r-733390" data-claire-element-id="733390">Enfin si ces deux solutions échouent, il reste un dernier recours au hackeur : utiliser une attaque de type <em>replay</em>. Elle consiste à répéter la séquence de connexion automatique qui a permis au possesseur du cookie de s'identifier. Cette attaque est très difficile à contrer simplement, c'est pourquoi la protection que nous allons mettre en place ne sera pas efficace à 100%.</p></li></ul><p id="r-733393" data-claire-element-id="733393">De cette leçon, nous pouvons retenir qu'il faut que le cookie ne stocke pas directement le mot de passe, même hashé. Pour se protéger du <em>brute-force</em>, on utilise un <em>salt</em> (grain de sel). Ça consiste à ajouter au mot de passe une chaîne quelconque assez longue avant de le hasher, afin que les dictionnaires ne puissent pas retrouver la valeur originale du hash. Par exemple, si les dictionnaires connaissent la valeur de sha1('mdp_facile'), ils ne connaissent pas celle de sha1('grain_de_sel_long_et_compliqué_mdp_facile'). Ici, le grain de sel est rajouté devant, mais on peut également le rajouter derrière ou bien - mieux encore - à la fois devant et derrière.</p><p id="r-733394" data-claire-element-id="733394">Arrêtons de jouer les astronautes et revenons-en à notre but principal : connecter l'utilisateur automatiquement. Nous aurons besoin d'un cookie contenant 2 valeurs : l'id de l'utilisateur (pour savoir qui on veut connecter), et un hash unique <strong>associé à l'utilisateur</strong> (chaque utilisateur doit avoir un hash différent) : pour cela, nous utiliserons son nom d'utilisateur et son mot de passe. Le hash doit bien entendu être salé pour être protégé contre une attaque de type <em>brute-force</em>. Enfin, pour se protéger des attaques de type <em>replay</em>, il nous faut quelque chose d'unique à l'utilisateur et que l'on peut connaître à chaque fois qu'il visite le site. On pourrait d'abord penser à son adresse IP, mais ça ne fonctionnerait pas chez les gens dont l'IP change entre 2 connexions, nous utiliserons donc <strong>l'identifiant fournit par son navigateur</strong>. C'est là qu'on ne se protège pas à 100% contre l'attaque de type <em>replay</em> : si le hackeur utilise le même navigateur que notre victime (qui s'est fait volé ses cookies), alors il pourra quand même se connecter sur son compte... C'est à vous de voir si vous vous autorisez un tel risque. Rassurez-vous : si votre site ne contient pas de faille XSS (que vous connaissez dorénavant sur le bout des doigts), aucun hackeur n'aura de moyen simple de voler des cookies sur votre site.</p><h3 id="r-passons-au-code" data-claire-element-id="733399">Passons au code !</h3><pre id="r-733396" data-claire-element-id="733396"><code data-claire-semantic="html+php">&lt;?php

// Ajoutons d'abord une case à cocher au formulaire de connexion
$form_connexion-&gt;add('Checkbox', 'connexion_auto')
               -&gt;label(&quot;Connexion automatique&quot;);</code></pre><pre id="r-733397" data-claire-element-id="733397"><code data-claire-semantic="html+php">&lt;?php

	// Si les identifiants sont valides
	if (false !== $id_utilisateur) {

		$infos_utilisateur = lire_infos_utilisateur($id_utilisateur);
		
		// On enregistre les informations dans la session
		$_SESSION['id']     = $id_utilisateur;
		$_SESSION['pseudo'] = $nom_utilisateur;
		$_SESSION['avatar'] = $infos_utilisateur['avatar'];
		$_SESSION['email']  = $infos_utilisateur['adresse_email'];
		
		// Mise en place des cookies de connexion automatique
		if (false != $form_connexion-&gt;get_cleaned_data('connexion_auto'))
		{
			$navigateur = (!empty($_SERVER['HTTP_USER_AGENT'])) ? $_SERVER['HTTP_USER_AGENT'] : '';
			$hash_cookie = sha1('aaa'.$nom_utilisateur.'bbb'.$mot_de_passe.'ccc'.$navigateur.'ddd');
			
			setcookie( 'id',            $_SESSION['id'], strtotime(&quot;+1 year&quot;), '/');
			setcookie('connexion_auto', $hash_cookie,    strtotime(&quot;+1 year&quot;), '/');
		}
		
		// Affichage de la confirmation de la connexion
		include CHEMIN_VUE.'connexion_ok.php';
	
	} else {

		$erreurs_connexion[] = &quot;Couple nom d'utilisateur / mot de passe inexistant.&quot;;
		
		// Suppression des cookies de connexion automatique
		setcookie('id', '');
		setcookie('connexion_auto', '');
		
		// On réaffiche le formulaire de connexion
		include CHEMIN_VUE.'formulaire_connexion.php';
	}</code></pre><pre id="r-733398" data-claire-element-id="733398"><code data-claire-semantic="html+php">&lt;?php

// Vérifications pour la connexion automatique

// On a besoin du modèle des membres
include CHEMIN_MODELE.'membres.php';

// Le mec n'est pas connecté mais les cookies sont là, on y va !
if (!utilisateur_est_connecte() &amp;&amp; !empty($_COOKIE['id']) &amp;&amp; !empty($_COOKIE['connexion_auto']))
{
	$infos_utilisateur = lire_infos_utilisateur($_COOKIE['id']);
	
	if (false !== $infos_utilisateur)
	{
		$navigateur = (!empty($_SERVER['HTTP_USER_AGENT'])) ? $_SERVER['HTTP_USER_AGENT'] : '';
		$hash = sha1('aaa'.$infos_utilisateur['nom_utilisateur'].'bbb'.$infos_utilisateur['mot_de_passe'].'ccc'.$navigateur.'ddd');
		
		if ($_COOKIE['connexion_auto'] == $hash)
		{
			// On enregistre les informations dans la session
			$_SESSION['id']     = $_COOKIE['id'];
			$_SESSION['pseudo'] = $infos_utilisateur['nom_utilisateur'];
			$_SESSION['avatar'] = $infos_utilisateur['avatar'];
			$_SESSION['email']  = $infos_utilisateur['adresse_email'];
		}
	}
}</code></pre><h3 id="r-commentaires-et-explications-3" data-claire-element-id="733402">Commentaires et explications</h3><p id="r-733400" data-claire-element-id="733400">Notez que désormais, le modèle des membres est chargé sur TOUTES les pages, vous pouvez donc le supprimer des autres pages qui en ont besoin. ;) <br/> Au niveau du sel, remplacez bien évidemment aaa bbb ccc et ddd par des valeurs assez <strong>longues</strong> et <strong>compliquées</strong> (exemple : °savageman°rox}trop[ ) et différentes pour chaque sel (celui présent au début, ceux du milieu et celui à la fin).</p><p id="r-733401" data-claire-element-id="733401">Vous voilà (normalement) parés pour un système sécurisé de connexion automatique.</p><h2 id="r-deconnexion-3" data-claire-element-id="733410">Déconnexion</h2><p id="r-733404" data-claire-element-id="733404">Nous terminons par le plus simple pour cette partie. Nous n'avons en effet pas besoin de formulaire pour déconnecter l'utilisateur ; il suffit de détruire sa session. Nous n'oublierons pas de supprimer les cookies concernant la connexion automatique, sinon l'utilisateur l'ayant activée se verrait à nouveau connecté immédiatement. Voici le code pour y parvenir :</p><h3 id="r-le-code-du-controleur-5" data-claire-element-id="733406">Le code du contrôleur</h3><pre id="r-733405" data-claire-element-id="733405"><code data-claire-semantic="html+php">&lt;?php

// Suppression de toutes les variables et destruction de la session
$_SESSION = array();
session_destroy();

// Suppression des cookies de connexion automatique
setcookie('id', '');
setcookie('connexion_auto', '');

include CHEMIN_VUE.'deconnexion_ok.php';</code></pre><h3 id="r-la-vue-associee-2" data-claire-element-id="733409">La vue associée</h3><pre id="r-733407" data-claire-element-id="733407"><code data-claire-semantic="html+php">&lt;h2&gt;Confirmation de déconnexion&lt;/h2&gt;

&lt;p&gt;Vous êtes maintenant déconnecté.&lt;br /&gt;
&lt;a href=&quot;&lt;?php echo $_SERVER['HTTP_REFERER']; ?&gt;&quot;&gt;Revenir à la page précédente&lt;/a&gt;&lt;br /&gt;
&lt;a href=&quot;index.php&quot;&gt;Revenir à la page d'accueil&lt;/a&gt;&lt;/p&gt;</code></pre><p id="r-733408" data-claire-element-id="733408">Vous avez désormais un espace membre certe assez minimaliste, mais fonctionnel. J'espère que ça vous a plu !</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques">Votre site PHP (presque) complet : architecture MVC et bonnes pratiques</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction : l&#039;avant-tutoriel
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/avant-propos-comment-fonctionne-ce-tutoriel">Avant-propos, comment fonctionne ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/introduction-objectifs-et-pre-requis">
Introduction, objectifs et pré-requis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/organisation-du-code-et-des-fichiers">
Organisation du code et des fichiers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonnes-pratiques-a-appliquer">Bonnes pratiques à appliquer</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/never-trust-user-input-3">
Never Trust User Input
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/l-enfer-des-guillemets-magiques-2">
L&#039;enfer des guillemets magiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/produire-un-code-lisible-et-comprehensible">
Produire un code lisible et compréhensible
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/les-classes-utilisees-dans-ce-tutoriel">Les classes utilisées dans ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/acces-a-la-base-de-donnees-avec-pdo2">
Accès à la base de données avec PDO2
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/gestion-des-formulaires-avec-la-classe-form">
Gestion des formulaires avec la classe Form
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Des systèmes simples : espace membres et livre d&#039;or
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/la-base-l-espace-membre">La base : l&#039;espace membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/objectifs-et-preparation">
Objectifs et préparation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/inscription-3">
Inscription
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/connexion-et-deconnexion-1">
Connexion et déconnexion
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonus-le-profil-d-un-membre">Bonus : le profil d&#039;un membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/mini-tp-affichage-d-un-profil-utilisateur">
[Mini TP] Affichage d&#039;un profil utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/modification-d-un-profil-utilisateur">
Modification d&#039;un profil utilisateur
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/inscription-3">
<span class="arrow"></span>
<span class="next">Inscription</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonus-le-profil-d-un-membre">
<span class="next">Bonus : le profil d&#039;un membre</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Bonusleprofild039unmembre"></a><h2>Bonus : le profil d&#039;un membre</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/connexion-et-deconnexion-1">
<span class="arrow"></span>
<span class="next">Connexion et déconnexion</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/mini-tp-affichage-d-un-profil-utilisateur">
<span class="next">[Mini TP] Affichage d&#039;un profil utilisateur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
</div><a name="MiniTPAffichaged039unprofilutilisateur"></a><h2>[Mini TP] Affichage d&#039;un profil utilisateur</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonus-le-profil-d-un-membre">
<span class="arrow"></span>
<span class="next">Bonus : le profil d&#039;un membre</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/modification-d-un-profil-utilisateur">
<span class="next">Modification d&#039;un profil utilisateur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-affichage-d-un-profil-premier-tp" data-claire-element-id="733443">Affichage d'un profil [Premier TP]</h2><h3 id="r-introduction-et-objectifs-du-tp" data-claire-element-id="733439">Introduction et objectifs du TP</h3><p id="r-733413" data-claire-element-id="733413">Afficher un profil, c'est bien gentil, mais nous avons plusieurs membres sur le site : il faut donc pouvoir choisir le profil de quel membre nous souhaitons afficher. Cette page aura donc besoin d'un argument GET dans l'URL, nous l'appellerons id et contiendra l'id de l'utilisateur pour lequel nous souhaitons afficher le membre.</p><p id="r-733414" data-claire-element-id="733414">Vous êtes (normalement) désormais assez préparés pour coder cette page tout seuls, comme des grands ! C'est pourquoi je vous propose un mini-TP, afin que <strong>vous</strong> puissiez travailler ! Voici les consignes :</p><ul id="r-733421" data-claire-element-id="733421"><li id="r-733416" data-claire-element-id="733416"><p id="r-733415" data-claire-element-id="733415">la page affichera les informations suivantes : nom d'utilisateur, avatar, adresse e-mail et date d'inscription ;</p></li><li id="r-733418" data-claire-element-id="733418"><p id="r-733417" data-claire-element-id="733417">si un utilisateur connecté regarde son profil, on lui proposera de l'éditer avec un lien vers l'action modifier_profil (qui sera codé dans la sous-partie suivante) ;</p></li><li id="r-733420" data-claire-element-id="733420"><p id="r-733419" data-claire-element-id="733419">vous gèrerez le cas d'erreur où le membre n'existe pas.</p></li></ul><p id="r-733422" data-claire-element-id="733422">Plutôt trivial, non ? Assez parlé, au travail ! La correction est disponible un peu plus bas...</p><p id="r-733423" data-claire-element-id="733423">.</p><p id="r-733424" data-claire-element-id="733424">..</p><p id="r-733425" data-claire-element-id="733425">...</p><p id="r-733426" data-claire-element-id="733426">....</p><p id="r-733427" data-claire-element-id="733427">.....</p><p id="r-733428" data-claire-element-id="733428">......</p><p id="r-733429" data-claire-element-id="733429">.......</p><p id="r-733430" data-claire-element-id="733430">........</p><p id="r-733431" data-claire-element-id="733431">.........</p><p id="r-733432" data-claire-element-id="733432">..........</p><p id="r-733433" data-claire-element-id="733433">Ne trichez pas, c'est pour votre bien ! Voici la correction.</p><p id="r-733434" data-claire-element-id="733434">Premièrement, l'affichage du profil est une nouvelle action pour le module membres ! Il faut donc créer une page afficher_profil.php dans le dossier ~/modules/membres/. Nous ne l'ajouterons pas dans le menu, l'affichage du profil se fera depuis des liens sur d'autres pages du site. Si vous le souhaitez, vous pouvez tout de même ajouter un lien pour que l'utilisateur affiche son propre profil (en utilisant $_SESSION['id'] comme attribut GET nommé id dans le lien) dans le menu.</p><pre id="r-733435" data-claire-element-id="733435"><code data-claire-semantic="html+php">&lt;?php

// Pas de vérification de droits d'accès nécessaire : tout le monde peut voir un profil utilisateur :)

// Si le paramètre id est manquant ou invalide
if (empty($_GET['id']) or !is_numeric($_GET['id'])) {

	include CHEMIN_VUE.'erreur_parametre_profil.php';

} else {

	// On veut utiliser le modèle des membres (~/modules/membres.php)
	include CHEMIN_MODELE.'membres.php';
	
	// lire_infos_utilisateur() est défini dans ~/modules/membres.php
	$infos_utilisateur = lire_infos_utilisateur($_GET['id']);
	
	// Si le profil existe et que le compte est validé
	if (false !== $infos_utilisateur &amp;&amp; $infos_utilisateur['hash_validation'] == '') {

		list($nom_utilisateur, ,$avatar, $adresse_email, $date_inscription, ) = $infos_utilisateur;
		include CHEMIN_VUE.'profil_infos_utilisateur.php';

	} else {

		include CHEMIN_VUE.'erreur_profil_inexistant.php';
	}
}</code></pre><pre id="r-733436" data-claire-element-id="733436"><code data-claire-semantic="html+php">&lt;h2&gt;Profil de &lt;?php echo htmlspecialchars($nom_utilisateur); ?&gt;&lt;/h2&gt;

&lt;p&gt;
	&lt;img class=&quot;flottant_droite&quot; src=&quot;&lt;?php echo DOSSIER_AVATAR.urlencode($avatar); ?&gt;&quot; title=&quot;Avatar de &lt;?php echo htmlspecialchars($nom_utilisateur); ?&gt;&quot; /&gt;
	&lt;span class=&quot;label_profil&quot;&gt;Adresse email&lt;/span&gt; : &lt;?php echo htmlspecialchars($adresse_email); ?&gt;&lt;br /&gt;
	&lt;span class=&quot;label_profil&quot;&gt;Date d'inscription&lt;/span&gt; : &lt;?php echo $date_inscription; ?&gt;
&lt;/p&gt;</code></pre><pre id="r-733437" data-claire-element-id="733437"><code data-claire-semantic="html">&lt;h2&gt;Erreur d'affichage du profil&lt;/h2&gt;
&lt;p&gt;Cet utilisateur n'existe pas.&lt;/p&gt;</code></pre><pre id="r-733438" data-claire-element-id="733438"><code data-claire-semantic="css">.flottant_droite {

	float: right;
}
span.label_profil {

	font-weight: bold;
}</code></pre><h3 id="r-commentaires-et-explications-4" data-claire-element-id="733442">Commentaires et explications</h3><p id="r-733440" data-claire-element-id="733440">C'est une page d'affichage, ça reste donc assez simple. En plus, la fonction lire_infos_utilisateur() existait déjà car on s'en sert pour la connexion ;) . On remarquera seulement que la structure du language list() peut prendre des arguments vides pour les valeurs que l'on ne veut pas récupérer (mot_de_passe et hash_validation dans notre cas).</p><p id="r-733441" data-claire-element-id="733441">Pensez juste à ne pas oublier d'utiliser la fonction htmlspecialchars() dans vos vues sur les données saisies par l'utilisateur, ou vous seriez vulnérables face à la faille XSS (vol de cookie, puis de compte) ! Celui-ci choisit son nom d'utilisateur et son adresse e-mail, il faut donc protéger ces variables à l'affichage.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques">Votre site PHP (presque) complet : architecture MVC et bonnes pratiques</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction : l&#039;avant-tutoriel
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/avant-propos-comment-fonctionne-ce-tutoriel">Avant-propos, comment fonctionne ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/introduction-objectifs-et-pre-requis">
Introduction, objectifs et pré-requis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/organisation-du-code-et-des-fichiers">
Organisation du code et des fichiers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonnes-pratiques-a-appliquer">Bonnes pratiques à appliquer</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/never-trust-user-input-3">
Never Trust User Input
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/l-enfer-des-guillemets-magiques-2">
L&#039;enfer des guillemets magiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/produire-un-code-lisible-et-comprehensible">
Produire un code lisible et compréhensible
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/les-classes-utilisees-dans-ce-tutoriel">Les classes utilisées dans ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/acces-a-la-base-de-donnees-avec-pdo2">
Accès à la base de données avec PDO2
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/gestion-des-formulaires-avec-la-classe-form">
Gestion des formulaires avec la classe Form
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Des systèmes simples : espace membres et livre d&#039;or
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/la-base-l-espace-membre">La base : l&#039;espace membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/objectifs-et-preparation">
Objectifs et préparation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/inscription-3">
Inscription
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/connexion-et-deconnexion-1">
Connexion et déconnexion
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonus-le-profil-d-un-membre">Bonus : le profil d&#039;un membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/mini-tp-affichage-d-un-profil-utilisateur">
[Mini TP] Affichage d&#039;un profil utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/modification-d-un-profil-utilisateur">
Modification d&#039;un profil utilisateur
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonus-le-profil-d-un-membre">
<span class="arrow"></span>
<span class="next">Bonus : le profil d&#039;un membre</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/modification-d-un-profil-utilisateur">
<span class="next">Modification d&#039;un profil utilisateur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Modificationd039unprofilutilisateur"></a><h2>Modification d&#039;un profil utilisateur</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/mini-tp-affichage-d-un-profil-utilisateur">
<span class="arrow"></span>
<span class="next">[Mini TP] Affichage d&#039;un profil utilisateur</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-modification-d-un-profil" data-claire-element-id="733451">Modification d'un profil</h2><p id="r-733445" data-claire-element-id="733445">Voici une partie (un peu) plus difficile, mais également plus intéressante ! Cependant, je vais vous guider, car il y aura plusieurs subtilités.</p><p id="r-733446" data-claire-element-id="733446">L'objectif est de fournir à l'utilisateur une interface lui permettant de modifier les informations concernant son profil.</p><p id="r-733447" data-claire-element-id="733447">Un membre, c'est quoi ? Réponse : un id, un nom d'utilisateur, un mot de passe, une adresse e-mail, un avatar et une date d'inscription. Parmi ces 6 champs, nous en rendrons modifiables seulement 3 : mot de passe, adresse e-mail et avatar ! En effet, l'id et la date d'inscription sont fixés lors de l'inscription ; quant au nom d'utilisateur, c'est un choix que de ne pas permettre à l'utilisateur de le modifier. En tout cas, ça simplifie déjà le travail par deux, étant donné que l'on a seulement 3 champs à traiter sur les 6 ! Mais... ça n'est pas si simple que ça !</p><p id="r-733448" data-claire-element-id="733448">Le mot de passe étant une information très sensible (critique), il va falloir demander l'ancien afin de confirmer que c'est bien le membre en question qui est connecté.<br/> Au niveau de l'adresse e-mail et de l'avatar, ça restera classique. :) Nous ferons juste attention aux doublons possibles pour l'adresse e-mail.</p><p id="r-733449" data-claire-element-id="733449">Dans cette optique, nous ferons 2 formulaires différents sur la même page : le premier pour modifier l'adresse e-mail et l'avatar. Le second pour modifier le mot de passe.</p><p id="r-733450" data-claire-element-id="733450">Je vous laisse créer l'action modifier_profil dans le module membres et y ajouter la vérification des droits d'accès (il faut que le membre soit connecté, vous l'aurez bien entendu deviné !). On ajoutera également la page dans le menu. Je ne vous passe pas les codes, vous avez j'en suis sûr réussi le TP précédent avec succès et je vous ai montré 2 fois comment faire avant !</p><h2 id="r-mise-en-place-des-formulaires" data-claire-element-id="733458">Mise en place des formulaires</h2><p id="r-733452" data-claire-element-id="733452">On va très largement s'inspirer du formulaire d'inscription et utiliser les champs qui nous conviennent.</p><pre id="r-733453" data-claire-element-id="733453"><code data-claire-semantic="html+php">&lt;?php

// Vérification des droits d'accès de la page
if (!utilisateur_est_connecte()) {

	// On affiche la page d'erreur comme quoi l'utilisateur doit être connecté pour voir la page
	include CHEMIN_VUE_GLOBALE.'erreur_non_connecte.php';
	
} else {
	
	// Ne pas oublier d'inclure la librairie Form
	include CHEMIN_LIB.'form.php';
	
	// &quot;form_modif_infos&quot; est l'ID unique du formulaire
	$form_modif_infos = new Form(&quot;form_modif_infos&quot;);
	
	$form_modif_infos-&gt;add('Email', 'adresse_email')
                         -&gt;label(&quot;Votre adresse email&quot;)
                         -&gt;Required(false)
                         -&gt;value($_SESSION['email']);
	
	$form_modif_infos-&gt;add('Checkbox', 'suppr_avatar')
                         -&gt;label(&quot;Je veux supprimer mon avatar&quot;)
                         -&gt;Required(false);
	
	$form_modif_infos-&gt;add('File', 'avatar')
                         -&gt;filter_extensions('jpg', 'png', 'gif')
                         -&gt;max_size(8192) // 8 Kb
                         -&gt;label(&quot;Votre avatar (facultatif)&quot;)
                         -&gt;Required(false);
	
	$form_modif_infos-&gt;add('Submit', 'submit')
                         -&gt;initial(&quot;Modifier ces informations !&quot;);
	
	// &quot;form_modif_mdp&quot; est l'ID unique du formulaire
	$form_modif_mdp = new Form(&quot;form_modif_mdp&quot;);
	
	$form_modif_mdp-&gt;add('Password', 'mdp_ancien')
                       -&gt;label(&quot;Votre ancien mot de passe&quot;);
	
	$form_modif_mdp-&gt;add('Password', 'mdp')
                       -&gt;label(&quot;Votre nouveau mot de passe&quot;);
	
	$form_modif_mdp-&gt;add('Password', 'mdp_verif')
                       -&gt;label(&quot;Votre nouveau mot de passe (vérification)&quot;);
	
	$form_modif_mdp-&gt;add('Submit', 'submit')
                       -&gt;initial(&quot;Modifier mon mot de passe !&quot;);
	
	// Création des tableaux des erreurs (un par formulaire)
	$erreurs_form_modif_infos = array();
	$erreurs_form_modif_mdp   = array();
	
	// et d'un tableau des messages de confirmation
	$msg_confirm = array();
	
	// Validation des champs suivant les règles en utilisant les données du tableau $_POST
	if ($form_modif_infos-&gt;is_valid($_POST)) {
	
		list($adresse_email, $suppr_avatar, $avatar) = $form_modif_infos-&gt;get_cleaned_data('adresse_email', 'suppr_avatar', 'avatar');
	
		// On veut utiliser le modèle de l'inscription(~/modules/membres.php)
		include CHEMIN_MODELE.'membres.php';
	
		// Si l'utilisateur veut modifier son adresse e-mail
		if (!empty($adresse_email)) {
	
			$test = maj_adresse_email_membre($_SESSION['id'], $adresse_email);
	
			if (true === $test) {
	
				// Ça a marché, trop cool !
				$msg_confirm[] = &quot;Adresse e-mail mise à jour avec succès !&quot;;
	
			// Gestion des doublons
			} else {
	
				// Changement de nom de variable (plus lisible)
				$erreur =&amp; $test;
	
				// On vérifie que l'erreur concerne bien un doublon
				if (23000 == $erreur[0]) { // Le code d'erreur 23000 signifie &quot;doublon&quot; dans le standard ANSI SQL
	
					preg_match(&quot;`Duplicate entry '(.+)' for key \d+`is&quot;, $erreur[2], $valeur_probleme);
					$valeur_probleme = $valeur_probleme[1];
	
					if ($adresse_email == $valeur_probleme) {
	
						$erreurs_form_modif_infos[] = &quot;Cette adresse e-mail est déjà utilisée.&quot;;
	
					} else {
	
						$erreurs_form_modif_infos[] = &quot;Erreur ajout SQL : doublon non identifié présent dans la base de données.&quot;;
					}
	
				} else {
	
					$erreurs_form_modif_infos[] = sprintf(&quot;Erreur ajout SQL : cas non traité (SQLSTATE = %d).&quot;, $erreur[0]);
				}
	
			}
		}
	
		// Si l'utilisateur veut supprimer son avatar...
		if (!empty($suppr_avatar)) {
	
			maj_avatar_membre($_SESSION['id'], '');
			$_SESSION['avatar'] = '';
	
			$msg_confirm[] = &quot;Avatar supprimé avec succès !&quot;;
	
		// ... ou le modifier !
		} else if (!empty($avatar)) {
	
			// On souhaite utiliser la librairie Image
			include CHEMIN_LIB.'image.php';
	
			// Redimensionnement et sauvegarde de l'avatar
			$avatar = new Image($avatar);
			$avatar-&gt;resize_to(100, 100); // Image-&gt;resize_to($largeur_maxi, $hauteur_maxi)
			$avatar_filename = DOSSIER_AVATAR.$id_utilisateur .'.'.strtlower(pathinfo($avatar-&gt;get_filename(), PATHINFO_EXTENSION));
			$avatar-&gt;save_as($avatar_filename);
	
			// On veut utiliser le modèle des membres (~/modules/membres.php)
			include CHEMIN_MODELE.'membres.php';
	
			// Mise à jour de l'avatar dans la table
			// maj_avatar_membre() est définit dans ~/modules/membres.php
			maj_avatar_membre($_SESSION['id'] , $avatar_filename);
			$_SESSION['avatar'] = $avatar_filename;
	
			$msg_confirm[] = &quot;Avatar modifié avec succès !&quot;;
		}
	
	} else if ($form_modif_mdp-&gt;is_valid($_POST)) {
	
		// On vérifie si les 2 mots de passe correspondent
		if ($form_modif_mdp-&gt;get_cleaned_data('mdp') != $form_modif_mdp-&gt;get_cleaned_data('mdp_verif')) {
	
			$erreurs_form_modif_mdp[] = &quot;Les deux mots de passes entrés sont différents !&quot;;
	
		// C'est bon, on peut modifier la valeur dans la BDD
		} else {
	
	
			// On veut utiliser le modèle de l'inscription (~/modules/membres.php)
			include CHEMIN_MODELE.'membres.php';
			maj_mot_de_passe_membre($_SESSION['id'], $mdp);
	
			$msg_confirm[] = &quot;Votre mot de passe a été modifié avec succès !&quot;;
		}
	
	}
}

// Affichage des formulaires de modification du profil
include ('formulaires_modifier_profil.php');</code></pre><h3 id="r-fonctions-du-modele-membres" data-claire-element-id="733455">Fonctions du modèle membres</h3><p id="r-733454" data-claire-element-id="733454">maj_avatar_membre() existe déjà. Il faut donc seulement ajouter maj_email_membre() et maj_mot_de_passe_membre().<br/> Allez, je vous laisse faire : il n'y a absolument aucun piège, c'est presque du recopiage de maj_avatar_membre(). Faites juste attention à ne pas oublier d'utiliser sha1() pour crypter le mot de passe ! (Comme dans ajouter_membre_dans_bdd() du fichier ~/modeles/inscription.php.)</p><h3 id="r-la-vue-utilisee" data-claire-element-id="733457">La vue utilisée</h3><pre id="r-733456" data-claire-element-id="733456"><code data-claire-semantic="html+php">&lt;h2&gt;Modification de votre profil utilisateur&lt;/h2&gt;

&lt;?php

if (!empty($msg_confirm)) {

	echo '&lt;ul&gt;'.&quot;\n&quot;;

	foreach($msg_confirm as $m) {

		echo '	&lt;li&gt;'.$m.'&lt;/li&gt;'.&quot;\n&quot;;
	}

	echo '&lt;/ul&gt;';
}

if (!empty($erreurs_form_modif_infos)) {

	echo '&lt;ul&gt;'.&quot;\n&quot;;

	foreach($erreurs_form_modif_infos as $e) {

		echo '	&lt;li&gt;'.$e.'&lt;/li&gt;'.&quot;\n&quot;;
	}

	echo '&lt;/ul&gt;';
}

$form_modif_infos-&gt;fieldsets(&quot;Modification de l'e-mail et de l'avatar&quot;, array('adresse_email', 'suppr_avatar', 'avatar'));

echo $form_modif_infos;

if (!empty($erreurs_form_modif_mdp)) {

	echo '&lt;ul&gt;'.&quot;\n&quot;;

	foreach($erreurs_form_modif_mdp as $e) {

		echo '	&lt;li&gt;'.$e.'&lt;/li&gt;'.&quot;\n&quot;;
	}

	echo '&lt;/ul&gt;';
}

$form_modif_mdp-&gt;fieldsets(&quot;Modification du mot de passe&quot;, array('mdp_ancien', 'mdp', 'mdp_verif'));

echo $form_modif_mdp;</code></pre><h2 id="r-commentaires-et-explications-5" data-claire-element-id="733466">Commentaires et explications</h2><p id="r-733459" data-claire-element-id="733459">Ouf, c'était plus long que d'habitude ! C'est normal, nous avons deux formulaires au lieu d'un seul auparavant. D'ailleurs, la création des formulaires étant aisée, je ne m'attarderai pas dessus.</p><aside id="r-733461" data-claire-element-id="733461" data-claire-semantic="warning"><p id="r-733460" data-claire-element-id="733460">N'oubliez pas la vérification des droits dans votre contrôleur ! Pour modifier son profil, il faut bien entendu être connecté !</p></aside><p id="r-733462" data-claire-element-id="733462">Nous avons une nouveauté : $messages_confirmation. Pour le formulaire de modification des informations (adresse e-mail et avatar), la mise à jour de l'avatar peut réussir, alors que celle de l'adresse e-mail échoue. Il faut donc un nouveau tableau pour un nouveau type de messages : ceux qui indiquent à l'utilisateur qu'une action s'est bien déroulée. Avant, nous utilisions une vue spéciale pour afficher la confirmation d'un formulaire. Ici, le traitement du formulaire peut échouer (tentative de mise à jour de l'adresse e-mail pour une déjà existante, ce qui provoque <strong>erreur de doublon</strong>), alors que d'autres actions ont réussi (mise à jour de l'avatar). Nous affichons donc tout sur la même page : c'est presque plus simple, étant donné que nous avons une seule vue au lieu de plusieurs !<br/> Étant donné qu'un seul des deux formulaires peut être validé à la fois, nous aurions pu utiliser un seul tableau pour stocker les messages d'erreur. Cependant, pour afficher les messages au-dessus du bon formulaire, il est plus simple d'utiliser deux tableaux distincts.</p><p id="r-733463" data-claire-element-id="733463">Je crois qu'il n'y a pas besoin de plus d'explications, tout le reste a déjà été vu avant !</p><p id="r-733464" data-claire-element-id="733464">Ça n'est bien entendu pas terminé. La prochaine partie devrait concerner la mise en place d'un petit livre d'or sous forme de TP.</p><p id="r-733465" data-claire-element-id="733465">Un problème, une question ? J'ai mis en place un <a href="http://www.siteduzero.com/forum-83-356916-p1-tuto-mvc-bonnes-pratiques-et-site-complet.html">topic dédié au tutoriel</a> dans le forum PHP, n'hésitez pas à y faire un tour.<br/> Vous pouvez également <a href="http://www.siteduzero.com/mp-273-395.html">m'envoyer un MP</a> pour les demandes particulières.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques">Votre site PHP (presque) complet : architecture MVC et bonnes pratiques</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Introduction : l&#039;avant-tutoriel
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/avant-propos-comment-fonctionne-ce-tutoriel">Avant-propos, comment fonctionne ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/introduction-objectifs-et-pre-requis">
Introduction, objectifs et pré-requis
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/organisation-du-code-et-des-fichiers">
Organisation du code et des fichiers
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonnes-pratiques-a-appliquer">Bonnes pratiques à appliquer</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/never-trust-user-input-3">
Never Trust User Input
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/l-enfer-des-guillemets-magiques-2">
L&#039;enfer des guillemets magiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/produire-un-code-lisible-et-comprehensible">
Produire un code lisible et compréhensible
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/les-classes-utilisees-dans-ce-tutoriel">Les classes utilisées dans ce tutoriel</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/acces-a-la-base-de-donnees-avec-pdo2">
Accès à la base de données avec PDO2
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/gestion-des-formulaires-avec-la-classe-form">
Gestion des formulaires avec la classe Form
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Des systèmes simples : espace membres et livre d&#039;or
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/la-base-l-espace-membre">La base : l&#039;espace membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/objectifs-et-preparation">
Objectifs et préparation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/inscription-3">
Inscription
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/connexion-et-deconnexion-1">
Connexion et déconnexion
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/bonus-le-profil-d-un-membre">Bonus : le profil d&#039;un membre</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/mini-tp-affichage-d-un-profil-utilisateur">
[Mini TP] Affichage d&#039;un profil utilisateur
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/modification-d-un-profil-utilisateur">
Modification d&#039;un profil utilisateur
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques/mini-tp-affichage-d-un-profil-utilisateur">
<span class="arrow"></span>
<span class="next">[Mini TP] Affichage d&#039;un profil utilisateur</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 08:43:42 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/votre-site-php-presque-complet-architecture-mvc-et-bonnes-pratiques.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:33:36 GMT -->
</html>