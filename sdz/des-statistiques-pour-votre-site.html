<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/des-statistiques-pour-votre-site.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 05:51:21 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/des-statistiques-pour-votre-site.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:03:42 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Des statistiques pour votre site !</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/des-statistiques-pour-votre-site.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Des statistiques pour votre site !</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Desstatistiquespourvotresite">Des statistiques pour votre site !</a><br/><a href="#TPn1combienai-jedevisites">TP n°1 : combien ai-je de visites ?</a><br/><a href="#TPn2quiestconnectsurmonsite">TP n°2 : qui est connecté sur mon site ?</a><br/><a href="#TPn3maisd039oviennentmesvisiteurs">TP n°3 : mais d&#039;où viennent mes visiteurs ?</a><br/><a href="#TPn4affluencesetheuresdepointe">TP n°4 : affluences et heures de pointe</a><br/></div>
<a name="Desstatistiquespourvotresite"></a><h2>Des statistiques pour votre site !</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg1-combien-ai-je-de-visites">
<span class="next">TP n°1 : combien ai-je de visites ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-554172" data-claire-element-id="554172">Référencement, publicité, vous devez les maîtriser pour pouvoir mettre votre site en valeur. Mais, afin d'optimiser un maximum vos efforts, pourquoi ne pas faire des statistiques ?</p><p id="r-554173" data-claire-element-id="554173">Par statistiques, j'entends à la fois vos performances (visiteurs connectés, nombre maximum de visiteurs connectés, pages visitées) mais aussi l'impact qu'a votre publicité sur les utilisateurs (provenance, intérêt). Celles-ci vont vous permettre de pouvoir gérer vous-mêmes vos campagnes afin de faire connaître le mieux possible votre site !</p><p id="r-554174" data-claire-element-id="554174">Ce tutoriel est une sorte de cours / TP guidé, garni d'infos qui vont vous permettre de mettre pleins de statistiques partout sur votre site. :soleil:</p>
</div><a name="TPn1combienai-jedevisites"></a><h2>TP n°1 : combien ai-je de visites ?</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg2-qui-est-connecte-sur-mon-site">
<span class="next">TP n°2 : qui est connecté sur mon site ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-554175" data-claire-element-id="554175">Ce script devra se diviser en plusieurs parties :</p><ul id="r-554180" data-claire-element-id="554180"><li id="r-554177" data-claire-element-id="554177"><p id="r-554176" data-claire-element-id="554176">nombre de visites ;</p></li><li id="r-554179" data-claire-element-id="554179"><p id="r-554178" data-claire-element-id="554178">nombre de visites par jour (nombre moyen, nombre maximum).</p></li></ul><aside id="r-554182" data-claire-element-id="554182" data-claire-semantic="warning"><p id="r-554181" data-claire-element-id="554181">Certaines parties du script ressemblent fortement à celles du <a href="http://www.siteduzero.com/tutoriel-3-14668-un-site-dynamique-avec-php.html">tutoriel officiel de M@teo21</a>.<br/> J'en tiens compte mais sachez que ma correction sera différente. Vous pouvez néanmoins vous en inspirer si vous bloquez.<br/> De plus les scripts seront en général plus complets car nous allons beaucoup travailler dessus.</p></aside><h2 id="r-nombre-de-visites" data-claire-element-id="554207">Nombre de visites</h2><p id="r-554183" data-claire-element-id="554183">Nous avons juste à stocker un nombre, celui du nombre de visites. En effet, ce script s'exécute sur toutes les pages de votre site. À chaque visite on devra incrémenter ce nombre.</p><p id="r-554184" data-claire-element-id="554184">Il est évident que nous n'allons pas stocker ce nombre dans une base de données SQL, la connexion est bien trop lente et si on devait se reconnecter à chaque ouverture de page pour afficher UN NOMBRE, le serveur ralentirait inutilement.</p><p id="r-554185" data-claire-element-id="554185">Un fichier contenant ce nombre semble donc parfaitement indiqué.<br/> On rangera tous les scripts de ce tutoriel dans un dossier &quot;stats&quot;.<br/> Ce fichier s'appellera visiteurs.txt et il contiendra une seule ligne, le nombre de visiteurs. Pour faire marcher votre script à la première utilisation, on l'initialise en mettant comme valeur 0.</p><aside id="r-554187" data-claire-element-id="554187" data-claire-semantic="warning"><p id="r-554186" data-claire-element-id="554186">N'oubliez pas de régler le CHMOD à 777 !</p></aside><p id="r-554188" data-claire-element-id="554188">Voici comment se divisera votre script :</p><ul id="r-554199" data-claire-element-id="554199"><li id="r-554190" data-claire-element-id="554190"><p id="r-554189" data-claire-element-id="554189">ouverture en lecture et écriture du fichier visiteurs.txt ;</p></li><li id="r-554192" data-claire-element-id="554192"><p id="r-554191" data-claire-element-id="554191">lecture de l'unique ligne du fichier contenant le nombre de visiteurs ;</p></li><li id="r-554194" data-claire-element-id="554194"><p id="r-554193" data-claire-element-id="554193">incrémentation de ce nombre ;</p></li><li id="r-554196" data-claire-element-id="554196"><p id="r-554195" data-claire-element-id="554195">écriture du nombre incrémenté dans le fichier ;</p></li><li id="r-554198" data-claire-element-id="554198"><p id="r-554197" data-claire-element-id="554197">affichage du nombre incrémenté.</p></li></ul><p id="r-554200" data-claire-element-id="554200">Nous utiliserons l'extension mysqli_ dans ce tutoriel. <br/> Avant tout le script du tutoriel, on se connecte à notre base de données comme ceci :</p><pre id="r-554201" data-claire-element-id="554201"><code data-claire-semantic="html+php">&lt;?php
$connexion = mysqli_connect('host', 'username', 'password');
$db = mysqli_select_db($connexion, 'stats');
?&gt;</code></pre><h3 id="r-correction-194" data-claire-element-id="554206">Correction !</h3><p id="r-554202" data-claire-element-id="554202">Avouez que ce n'était pas bien dur !<br/> Comment ça vous n'avez pas réussi ? o_O <br/> Si c'est le cas, il serait préférable de revoir vos bases, non ?</p><pre id="r-554203" data-claire-element-id="554203"><code data-claire-semantic="html+php">&lt;?php
$nb_visites = file_get_contents('data/pagesvues.txt');
$nb_visites++;
file_put_contents('data/pagesvues.txt', $nb_visites);
echo 'Nombre de pages vues : &lt;strong&gt;' . $nb_visites . '&lt;/strong&gt;&lt;br/&gt;';
?&gt;</code></pre><p id="r-554204" data-claire-element-id="554204">Comme vous pouvez le voir, ce n'était pas compliqué. :p</p><p id="r-554205" data-claire-element-id="554205">On attaque le...</p><h2 id="r-nombre-de-visites-par-jour" data-claire-element-id="554237">Nombre de visites par jour</h2><p id="r-554208" data-claire-element-id="554208">Vous l'aurez compris, ce script est applicable pour les mois, les années, bref ici on prendra les jours car c'est le plus utilisé.<br/> Votre mission (si vous l'acceptez :soleil: ) sera d'obtenir les statistiques suivantes pour les afficher sur votre site :</p><ul id="r-554217" data-claire-element-id="554217"><li id="r-554210" data-claire-element-id="554210"><p id="r-554209" data-claire-element-id="554209">nombre de visites aujourd'hui ;</p></li><li id="r-554212" data-claire-element-id="554212"><p id="r-554211" data-claire-element-id="554211">garder en mémoire les nombres de visites de chaque jour ;</p></li><li id="r-554214" data-claire-element-id="554214"><p id="r-554213" data-claire-element-id="554213">afficher le nombre maximum de visites en un jour suivi de la mention « Établi le ...» ;</p></li><li id="r-554216" data-claire-element-id="554216"><p id="r-554215" data-claire-element-id="554215">faire la moyenne du nombre de visites par jour.</p></li></ul><p id="r-554218" data-claire-element-id="554218">Eh oui, ça se complexifie. :-°</p><aside id="r-554220" data-claire-element-id="554220" data-claire-semantic="information"><p id="r-554219" data-claire-element-id="554219">Il est tout à fait possible d'utiliser un fichier pour ce script, mais par mesure de confort et de facilité, nous allons faire ça avec une table SQL. C'est plus simple pour débuter.</p></aside><p id="r-554221" data-claire-element-id="554221">Allez, cette fois je donne pas plus d'indications. ;)</p><p id="r-554222" data-claire-element-id="554222">Bonne chance !</p><aside id="r-554224" data-claire-element-id="554224" data-claire-semantic="information"><p id="r-554223" data-claire-element-id="554223">Si vous avez du mal avec les données temporelles de MySQL, je vous conseille ce tutoriel : <a href="http://www.siteduzero.com/tutoriel-3-32877-mysql-et-les-donnees-temporelles.html">MySQL et les données temporelles</a>.</p></aside><h3 id="r-1-2-3-correction" data-claire-element-id="554236">1, 2, 3... Correction !</h3><p id="r-554225" data-claire-element-id="554225">Alors, c'est plus compliqué que ça en a l'air hein ?</p><div id="r-554227" data-claire-element-id="554227" data-claire-semantic="question"><p id="r-554226" data-claire-element-id="554226">Euh... :euh:</p></div><p id="r-554228" data-claire-element-id="554228">Ne vous inquiétez pas si vous n'y êtes pas arrivé directement, servez-vous de la correction pour compléter votre code.</p><p id="r-554229" data-claire-element-id="554229">On commence par la structure de la table SQL que je vais utiliser.</p><pre id="r-554230" data-claire-element-id="554230"><code data-claire-semantic="sql">--
-- Structure de la table `visites_jour`
--

CREATE TABLE `visites_jour` (
  `visites` mediumint(9) NOT NULL,
  `date` date NOT NULL
);</code></pre><p id="r-554231" data-claire-element-id="554231">On voit donc que c'est une table très basique, mais nous n'aurons pas besoin de plus.</p><p id="r-554232" data-claire-element-id="554232">Passons au code PHP.</p><pre id="r-554233" data-claire-element-id="554233"><code data-claire-semantic="html+php">&lt;?php
//ETAPE 1 - Affichage du nombre de visites d'aujourd'hui
	$retour_count = mysqli_query($connexion, 'SELECT COUNT(*) AS nbre_entrees FROM visites_jour WHERE date=CURRENT_DATE()');//On compte le nombre d'entrées pour aujourd'hui
	$donnees_count = mysqli_fetch_assoc($retour_count); //Fetch-array
	echo 'Pages vues aujourd\'hui : &lt;strong&gt;'; // On affiche tout de suite pour pas le retaper 2 fois après
	
        if ($donnees_count['nbre_entrees'] == 0) //Si la date d'aujourd'hui n'a pas encore été enregistrée (première visite de la journée)
	{
		mysqli_query($connexion, 'INSERT INTO visites_jour(visites, date) VALUES (1, CURRENT_DATE());'); //On rentre la date d'aujourd'hui et on marque 1 comme nombre de visites.
		echo '1'; //On affiche une visite car c'est la première visite de la journée
	} else { //Si la date a déjà été enregistrée
		$retour = mysqli_query($connexion, 'SELECT visites FROM visites_jour WHERE date=CURRENT_DATE()'); //On sélectionne l'entrée qui correspond à notre date
		$donnees = mysqli_fetch_assoc($retour);
		$visites = $donnees['visites'] + 1; //Incrémentation du nombre de visites
		mysqli_query($connexion, 'UPDATE visites_jour SET visites = visites + 1 WHERE date=CURRENT_DATE()'); //Update dans la base de données
		echo $visites; //Enfin, on affiche le nombre de visites d'aujourd'hui !
	}
	echo '&lt;/strong&gt;&lt;/br/&gt;';

//ETAPE 2 - Record des connectés par jour
	
	$retour_max = mysqli_query($connexion, 'SELECT visites, date FROM visites_jour ORDER BY visites DESC LIMIT 0, 1'); //On sélectionne l'entrée qui a le nombre visite le plus important
	$donnees_max = mysqli_fetch_assoc($retour_max);
	echo 'Record : &lt;strong&gt;' . $donnees_max['visites'] . '&lt;/strong&gt; établi le &lt;strong&gt;' . $donnees_max['date'] . '&lt;/strong&gt;&lt;br/&gt;'; //On l'affiche ainsi que la date à laquelle le record a été établi

//ETAPE 3 - Moyenne du nombre de visites par jour
	$total_visites = 0; //Nombre de visites
    /*(pour éviter les bugs on ne prendra pas le nombre du premier exercice, 
	mais celui-ci reste utile pour être affiché sur toutes les pages car il est plus rapide, 
	contrairement à $total_visites dont on ne se servira que pour la page de stats)*/
	
	$total_jours = 0;//Nombre de jours enregistrés dans la base

        $total_visites = mysqli_fetch_assoc(mysqli_query($connexion, 'SELECT SUM(visites) FROM visites_jour AS total_visites'));
	$total_visites = $total visites['total visites'];

	$total_jours = mysqli_fetch_assoc(mysqli_query($connexion, 'SELECT COUNT(*) FROM visites_jour AS total_jours'));
        $total_jours = $total_jours['total_jours'];

	$moyenne = $total_visites/$total_jours; //on fait la moyenne
	echo 'Moyenne : &lt;strong&gt;' . $moyenne . '&lt;/strong&gt; visiteurs par jour&lt;br/&gt;'; // On affiche ! Terminé !!!

?&gt;</code></pre><aside id="r-554235" data-claire-element-id="554235" data-claire-semantic="information"><p id="r-554234" data-claire-element-id="554234">Vous pouvez ajouter un champ &quot;id_page&quot; dans la table qui vous permettra d'enregistrer le nom de la page qui a été vue et ainsi voir les pages qui intéressent le plus vos internautes. ;)</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site">Des statistiques pour votre site !</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg1-combien-ai-je-de-visites">
TP n°1 : combien ai-je de visites ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg2-qui-est-connecte-sur-mon-site">
TP n°2 : qui est connecté sur mon site ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg3-mais-d-ou-viennent-mes-visiteurs">
TP n°3 : mais d&#039;où viennent mes visiteurs ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg4-affluences-et-heures-de-pointe">
TP n°4 : affluences et heures de pointe
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg2-qui-est-connecte-sur-mon-site">
<span class="next">TP n°2 : qui est connecté sur mon site ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="TPn2quiestconnectsurmonsite"></a><h2>TP n°2 : qui est connecté sur mon site ?</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg1-combien-ai-je-de-visites">
<span class="arrow"></span>
<span class="next">TP n°1 : combien ai-je de visites ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg3-mais-d-ou-viennent-mes-visiteurs">
<span class="next">TP n°3 : mais d&#039;où viennent mes visiteurs ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-554239" data-claire-element-id="554239">Ce script se déroulera en trois parties :</p><ul id="r-554246" data-claire-element-id="554246"><li id="r-554241" data-claire-element-id="554241"><p id="r-554240" data-claire-element-id="554240">affichage du nombre de visiteurs connectés ;</p></li><li id="r-554243" data-claire-element-id="554243"><p id="r-554242" data-claire-element-id="554242">affichage du record du nombre de connectés suivi de la date où il a été établi ;</p></li><li id="r-554245" data-claire-element-id="554245"><p id="r-554244" data-claire-element-id="554244">affichage de la liste des connectés avec leurs IP et la page qu'ils visitent (il est déconseillé d'afficher les IP des visiteurs publiquement, on préfèrera séparer cette partie dans le panel admin).</p></li></ul><h2 id="r-affichage-du-nombre-de-visiteurs-connectes" data-claire-element-id="554268">Affichage du nombre de visiteurs connectés</h2><p id="r-554247" data-claire-element-id="554247">Mettons-nous d'accord sur un point : il est impossible de réellement savoir qui lit nos pages. En effet, même si l'internaute reste connecté pour lire un article de notre site pendant 1 heure, on ne le saura pas, on va donc faire des <strong>approximations</strong>.</p><p id="r-554248" data-claire-element-id="554248">Nous allons donc considérer que :</p><ul id="r-554257" data-claire-element-id="554257"><li id="r-554250" data-claire-element-id="554250"><p id="r-554249" data-claire-element-id="554249">lorsqu'un internaute affiche notre page, il reste connecté dessus 5 minutes ;</p></li><li id="r-554252" data-claire-element-id="554252"><p id="r-554251" data-claire-element-id="554251">si au bout des 5 minutes il n'a pas changé de page (donc s'il n'en a pas chargé une autre) on le supprime, il n'est plus connecté ;</p></li><li id="r-554254" data-claire-element-id="554254"><p id="r-554253" data-claire-element-id="554253">nous allons identifier les connectés grâce à leur IP ;</p></li><li id="r-554256" data-claire-element-id="554256"><p id="r-554255" data-claire-element-id="554255">quand l'internaute change de page, on recommence le décompte de 5 minutes.</p></li></ul><aside id="r-554259" data-claire-element-id="554259" data-claire-semantic="warning"><p id="r-554258" data-claire-element-id="554258">Nous allons faire un truc intéressant : on va aussi mettre dans un champ la page où se trouve le visiteur, ce qui permettra de faire une liste des visiteurs connectés plus complète !</p></aside><aside id="r-554261" data-claire-element-id="554261" data-claire-semantic="information"><p id="r-554260" data-claire-element-id="554260">Je vous rappelle que l'IP d'un visiteur se récupère grâce à la variable Superglobale <code data-claire-semantic="html+php">$_SERVER['REMOTE_ADDR'] </code>. Pour la convertir en nombre, utilisez la fonction ip2long(). Pour convertir ce nombre en IP, utilisez long2ip(). Cela facilitera l'enregistrement dans la base de données.</p></aside><p id="r-554262" data-claire-element-id="554262">Si vous bloquez, vous pouvez aller <a href="http://www.siteduzero.com/tutoriel-3-14569-tp-nombre-de-visiteurs-connectes.html#ss_part_1">voir ce TP</a> qui est (très) similaire et qui vous donnera quelques indications en plus. ;)</p><h3 id="r-3-2-1-correction" data-claire-element-id="554267">3, 2, 1, correction !</h3><p id="r-554263" data-claire-element-id="554263">Structure de la table 'connectes' :</p><pre id="r-554264" data-claire-element-id="554264"><code data-claire-semantic="sql">CREATE TABLE IF NOT EXISTS `connectes` (
  `ip` int(12) NOT NULL,
  `timestamp` int(11) NOT NULL,
  `page` varchar(50) NOT NULL
);</code></pre><p id="r-554265" data-claire-element-id="554265">Script PHP :</p><pre id="r-554266" data-claire-element-id="554266"><code data-claire-semantic="html+php">&lt;?php
//On prend l'adresse de la page à laquelle on enlève le \ du début (1er caractère) :
$page = substr($_SERVER['PHP_SELF'], 1);
// On stocke dans une variable le timestamp qu'il était il y a 5 minutes :
$timestamp_5min = time() - (60 * 5); // 60 * 5 = nombre de secondes écoulées en 5 minutes
//On commence par virer les entrées trop vieilles (+ de 5 minutes)
mysqli_query($connexion, 'DELETE FROM connectes WHERE timestamp &lt; ' . $timestamp_5min);

$retour = mysqli_query($connexion, 'SELECT COUNT(*) AS nb_connectes FROM connectes WHERE ip=\'' . ip2long($_SERVER['REMOTE_ADDR']) . '\'');
$donnees = mysqli_fetch_assoc($retour); //On regarde si le visiteur est déjà dans la table

if ($donnees['nb_connectes'] == 0) // Si il n'y est pas, on l'ajoute
{
    mysqli_query($connexion, 'INSERT INTO connectes(ip, timestamp, page) VALUES(\'' . ip2long($_SERVER['REMOTE_ADDR']) . '\', NOW()), \'' . $page . '\'');
}
else // Sinon, on remet le décompte de 5 minutes à 0
{
    mysqli_query($connexion, 'UPDATE connectes SET timestamp=NOW(), page=\'' . $page . '\' WHERE ip=\'' . ip2long($_SERVER['REMOTE_ADDR']) . '\'');
}

//Enfin, on calcule le nombre total d'entrées puis on l'affiche !
$retour = mysqli_query($connexion, 'SELECT COUNT(*) AS nb_connectes FROM connectes');
$donnees = mysqli_fetch_assoc($retour);

$visiteurs_connectes = $donnees['nb_connectes'];
// Affichage
echo 'Visiteurs connectés : &lt;strong&gt;' . $donnees['nb_connectes'] . '&lt;/strong&gt;&lt;br/&gt;';

?&gt;</code></pre><h2 id="r-affichage-du-record-de-connectes" data-claire-element-id="554285">Affichage du record de connectés</h2><p id="r-554269" data-claire-element-id="554269">Ce script va directement à la suite du premier vu qu'on aura besoin de la variable $visiteurs_connectes.</p><p id="r-554270" data-claire-element-id="554270">Ce script est très simple, on doit stocker deux nombres :</p><ul id="r-554275" data-claire-element-id="554275"><li id="r-554272" data-claire-element-id="554272"><p id="r-554271" data-claire-element-id="554271">le record ;</p></li><li id="r-554274" data-claire-element-id="554274"><p id="r-554273" data-claire-element-id="554273">la date à laquelle il a été établi.</p></li></ul><p id="r-554276" data-claire-element-id="554276">Inutile de faire une table rien que pour ça, on va donc utiliser...</p><div id="r-554278" data-claire-element-id="554278"><p id="r-554277" data-claire-element-id="554277">... les fichiers !</p></div><div id="r-554280" data-claire-element-id="554280" data-claire-semantic="question"><p id="r-554279" data-claire-element-id="554279">Comment allons-nous faire ?</p></div><p id="r-554281" data-claire-element-id="554281">On va organiser les données du fichier en une ligne, contenant le record suivi de la date.<br/> Le fichier se situe dans le répertoire de nos statistiques : <code>stats/records.txt</code>.<br/> On l'initialise en mettant &quot;0 0/0/0&quot; dedans, puis on met son CHMOD à 777.</p><p id="r-554282" data-claire-element-id="554282">Pour séparer les données de vos chaînes de caractères, il existe la fonction <a href="http://fr.php.net/manual/fr/function.explode.php">explode()</a> qui va vous permettre de couper en plusieurs morceaux le contenu de votre fichier.</p><h3 id="r-correction-195" data-claire-element-id="554284">Correction ?</h3><pre id="r-554283" data-claire-element-id="554283"><code data-claire-semantic="html+php">&lt;?php

$f_records = fopen('records.txt', 'r+'); //On ouvre le fichier
$dernierRecord = fgets($f_records); //On prend sa première ligne
$dernierRecord = explode(' ', $dernierRecord); //Je vous avais dit de regarder la fonction explode !
//Elle va permettre de séparer notre fichier en 2 parties :
//Le record (0) dans $dernierRecord[0] et la date (0/0/0) dans $dernierRecord[1]
echo 'Record du nombre de connectés : &lt;strong&gt;'; //On le marque tout de suite
//Ici on va avoir besoin de la variable $visiteurs_connectes de l'exercice précédent
if ($visiteurs_connectes &gt; $dernierRecord[0]) //Si le nombre de connecté est plus important que le record actuel
{
	rewind($f_records); //On &quot;rebobine &quot; le fichier
	$ligne = $visiteurs_connectes . ' ' . date('d/m/Y'); 
	fwrite($f_records, $ligne); //On écrit la ligne sous la forme fixée au départ
	echo $visiteurs_connectes . '&lt;/strong&gt; établi le &lt;strong&gt;' . date('d/m/Y');
} else { //sinon, on affiche le record du fichier.
	echo $dernierRecord[0] . '&lt;/strong&gt; établi le &lt;strong&gt;' . $dernierRecord[1];
}

// On ferme la balise puis le fichier
echo '&lt;/strong&gt;&lt;br/&gt;'; 
fclose($f_records); 
?&gt;</code></pre><h2 id="r-affichage-de-la-liste-des-connectes" data-claire-element-id="554304">Affichage de la liste des connectés</h2><p id="r-554286" data-claire-element-id="554286">Script archi-simple, on va juste afficher :</p><ul id="r-554291" data-claire-element-id="554291"><li id="r-554288" data-claire-element-id="554288"><p id="r-554287" data-claire-element-id="554287">l'IP du visiteur ;</p></li><li id="r-554290" data-claire-element-id="554290"><p id="r-554289" data-claire-element-id="554289">la page qu'il visite.</p></li></ul><h3 id="r-euh-hum-correction-p" data-claire-element-id="554303">Euh... Hum... Correction :p</h3><pre id="r-554292" data-claire-element-id="554292"><code data-claire-semantic="html+php">&lt;?php
echo '&lt;strong&gt;Liste des connectés : &lt;/strong&gt;(' . $visiteurs_connectes . ')&lt;br/&gt;';
$retour = mysqli_query($connexion, 'SELECT ip, page FROM connectes');
while ($donnees = mysqli_fetch_assoc($retour))
{
	echo long2ip($donnees['ip']) . ' : ' . $donnees['page'] . '&lt;br /&gt;';
}
?&gt;</code></pre><p id="r-554293" data-claire-element-id="554293">Pas trop dur ? &gt;_</p><div id="r-554295" data-claire-element-id="554295" data-claire-semantic="question"><p id="r-554294" data-claire-element-id="554294">Eh bah dis donc ! Ça c'est du beau boulot !</p></div><p id="r-554296" data-claire-element-id="554296">Eh oui, vous avez vu ce qu'on est capable de faire ? Ces parties 1 et 2 n'étaient pas si faciles que ça finalement. o_O</p><p id="r-554297" data-claire-element-id="554297">Allez, contemplez ce magnifique résultat (le mien est un peu plus sophistiqué, mais bon, c'est du pareil au même :) ) :</p><figure id="r-554299" data-claire-element-id="554300"><img id="r-554298" data-claire-element-id="554298" src="medias/uploads.siteduzero.com_files_210001_211000_210507.png" alt="Image utilisateur"/></figure><p id="r-554301" data-claire-element-id="554301">La partie suivante est encore plus compliquée à réaliser (quoique moins longue). Mais elle est super utile et quand vous l'aurez finie, je peux vous garantir que vous serez fier de vous !</p><p id="r-554302" data-claire-element-id="554302">Prenez un peu de repos et... À vos claviers !!!</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site">Des statistiques pour votre site !</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg1-combien-ai-je-de-visites">
TP n°1 : combien ai-je de visites ?
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg2-qui-est-connecte-sur-mon-site">
TP n°2 : qui est connecté sur mon site ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg3-mais-d-ou-viennent-mes-visiteurs">
TP n°3 : mais d&#039;où viennent mes visiteurs ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg4-affluences-et-heures-de-pointe">
TP n°4 : affluences et heures de pointe
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg1-combien-ai-je-de-visites">
<span class="arrow"></span>
<span class="next">TP n°1 : combien ai-je de visites ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg3-mais-d-ou-viennent-mes-visiteurs">
<span class="next">TP n°3 : mais d&#039;où viennent mes visiteurs ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="TPn3maisd039oviennentmesvisiteurs"></a><h2>TP n°3 : mais d&#039;où viennent mes visiteurs ?</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg2-qui-est-connecte-sur-mon-site">
<span class="arrow"></span>
<span class="next">TP n°2 : qui est connecté sur mon site ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg4-affluences-et-heures-de-pointe">
<span class="next">TP n°4 : affluences et heures de pointe</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-554306" data-claire-element-id="554306">Allez, ne me mentez pas, je suis sûr que vous vous êtes déjà posé cette question ! Si si ! :p <br/> Sérieusement, ça ne vous arrive jamais de vous poser la question « Mais au fait, comment je fais pour avoir autant de visiteurs avec mon site tout pourri ? »</p><p id="r-554307" data-claire-element-id="554307">Eh bien dans cette partie nous allons pouvoir y répondre ! Et ceci grâce à un merveilleux instrument : la variable Superglobale <code data-claire-semantic="html+php">$_SERVER['HTTP_REFERER'] </code>.</p><aside id="r-554309" data-claire-element-id="554309" data-claire-semantic="information"><p id="r-554308" data-claire-element-id="554308">Si vous ne vous rappelez pas ce que veut dire &quot;Variable Superglobale&quot;, je vous conseille d'aller voir par là : <a href="http://www.siteduzero.com/tutoriel-3-14563-les-variables-superglobales.html">Les variables Superglobales</a>.</p></aside><p id="r-554310" data-claire-element-id="554310">D'ailleurs je vais citer l'auteur brillantissime de ce chapitre :</p><p id="r-554311" data-claire-element-id="554311"><cite>Citation : M@teo21</cite></p><blockquote id="r-554313" data-claire-element-id="554313"><p id="r-554312" data-claire-element-id="554312">$_SERVER['HTTP_REFERER'] : C'est l'URL de la page qui a amené le visiteur sur la page courante. Cela peut être utile notamment pour faire des statistiques : vous saurez par exemple que le site &quot;supersite.com&quot; a fait un lien vers votre site et vous amène des visiteurs. :)</p></blockquote><p id="r-554314" data-claire-element-id="554314">Si vous allez voir ce chapitre, vous êtes clairement averti par M@teo :</p><aside id="r-554316" data-claire-element-id="554316" data-claire-semantic="warning"><p id="r-554315" data-claire-element-id="554315">La documentation de PHP nous avertit clairement que vous ne pouvez pas vous fier à 100% à $_SERVER['HTTP_REFERER'] car le client peut très facilement refuser d'envoyer cette information ou même la modifier.<br/> Bref, n'ayez pas trop confiance en elle.</p></aside><p id="r-554317" data-claire-element-id="554317">Bon, alors, passons aux choses sérieuses. :diable: <br/> Nous ne nous occupons QUE de l'enregistrement dans ce tutoriel. À vous de gérer l'affichage au mieux pour vos statistiques.</p><p id="r-554318" data-claire-element-id="554318">Voici ce que votre script devra faire :</p><ul id="r-554329" data-claire-element-id="554329"><li id="r-554320" data-claire-element-id="554320"><p id="r-554319" data-claire-element-id="554319">vérifier que le HTTP REFERER ne vient pas d'une de vos pages pour éviter que quelqu'un arrive sur votre index alors qu'il était déjà sur le site ;</p></li><li id="r-554322" data-claire-element-id="554322"><p id="r-554321" data-claire-element-id="554321">vérifier que l'utilisateur n'a pas ouvert deux fois un lien par inadvertance en mettant un timeout de 5 minutes ;</p></li><li id="r-554324" data-claire-element-id="554324"><p id="r-554323" data-claire-element-id="554323">sinon, enregistrer le HTTP REFERER et l'IP du visiteur dans une base de données ;</p></li><li id="r-554326" data-claire-element-id="554326"><p id="r-554325" data-claire-element-id="554325">ce n'est pas obligatoire, mais un champ ID ne serait pas de trop pour gérer vos stats ensuite ;</p></li><li id="r-554328" data-claire-element-id="554328"><p id="r-554327" data-claire-element-id="554327">vous aurez besoin d'un autre champ, lisez bien l'énoncé. ^^</p></li></ul><p id="r-554330" data-claire-element-id="554330">...</p><p id="r-554331" data-claire-element-id="554331">Eh oui c'est dur hein !<br/> Tu-tut ! on ne regarde pas la correction avant d'avoir fini !</p><p id="r-554332" data-claire-element-id="554332">C'est bon ?</p><h3 id="r-3-2-1-correction-1" data-claire-element-id="554339">3, 2, 1... Correction !</h3><p id="r-554333" data-claire-element-id="554333">Structure de ma table &quot;provenance&quot; :</p><pre id="r-554334" data-claire-element-id="554334"><code data-claire-semantic="sql">CREATE TABLE IF NOT EXISTS `provenance` (
  `id` int(11) NOT NULL auto_increment,
  `ip` int(12) NOT NULL,
  `http_referer` text NOT NULL,
  `heure` timestamp NOT NULL default CURRENT_TIMESTAMP,
  PRIMARY KEY  (`id`)
);</code></pre><p id="r-554335" data-claire-element-id="554335">Et oui, comment auriez-vous fait si vous n'aviez pas enregistré le timestamp dans un champ &quot;heure&quot; ? Impossible de faire le time-out !</p><p id="r-554336" data-claire-element-id="554336">On passe au PHP ?</p><pre id="r-554337" data-claire-element-id="554337"><code data-claire-semantic="html+php">&lt;?php
if (strpos(strtolower($_SERVER['HTTP_REFERER']), 'monsite.com') === 0)//Si le visiteur provient d'un autre site. 
{
	$heureAffichage = time()-60*5; //Le temps qu'il était il y a 5 minutes
	echo $heureAffichage;

//On sélectionne toutes les entrées ayant l'IP du visiteur pour lesquelles l'heure enregistrée est plus grande que l'heure qu'il était il y a 5 minutes.
	$retour = mysqli_query($connexion, 'SELECT COUNT(*) AS nbre_entrees FROM provenance WHERE ip=\'' . ip2long($_SERVER['REMOTE_ADDR']) . '\'  AND UNIX_TIMESTAMP(heure) &gt; ' . $heureAffichage); 
	$donnees = mysqli_fetch_assoc($retour); //Fetch-array
	if ($donnees['nbre_entrees'] == 0) // S'il n'y a aucune entrée qui a notre IP et qui a été enregistrée il y a 5 minutes
	{
		mysqli_query($connexion, &quot;INSERT INTO provenance(id, ip, http_referer, heure) VALUES ('', '&quot; . ip2long($_SERVER['REMOTE_ADDR']) . &quot;', '&quot; . mysqli_real_escape_string($_SERVER['HTTP_REFERER']) . &quot;', CURRENT_TIMESTAMP());&quot;); //Insérer une nouvelle entrée
	}
}
?&gt;</code></pre><p id="r-554338" data-claire-element-id="554338">Alors, heureux ? :waw: C'est dingue ce qu'on sait faire !</p><h3 id="r-affichage-8" data-claire-element-id="554352">Affichage :</h3><aside id="r-554341" data-claire-element-id="554341" data-claire-semantic="information"><p id="r-554340" data-claire-element-id="554340">Si ça vous intéresse, voilà un bout de code que j'ai écrit. Il va vous permettre d'afficher tout d'abord les sites d'où proviennent vos visiteurs, et ces sites seront sous forme de liens qui montreront les pages des sites.</p></aside><p id="r-554342" data-claire-element-id="554342">Exemple :</p><p id="r-554343" data-claire-element-id="554343"><cite>Citation</cite></p><blockquote id="r-554345" data-claire-element-id="554345"><p id="r-554344" data-claire-element-id="554344"><a href="http://www.siteduzero.com/">www.siteduzero.com</a><br/><a href="http://www.machinchose.truc/">www.machinchose.truc</a></p></blockquote><p id="r-554346" data-claire-element-id="554346">Et quand on clique sur &quot;www.siteduzero.com&quot; :</p><p id="r-554347" data-claire-element-id="554347"><cite>Citation</cite></p><blockquote id="r-554349" data-claire-element-id="554349"><p id="r-554348" data-claire-element-id="554348"><a href="http://www.siteduzero.com/tutoriel-10-202092.html">http://www.siteduzero.com/tutoriel-10-202092.html</a><br/><a href="http://www.siteduzero.com/news.html">http://www.siteduzero.com/news.html</a></p></blockquote><pre id="r-554350" data-claire-element-id="554350"><code data-claire-semantic="html+php">&lt;?
if (!empty($_GET['url']))
{
	$url = mysqli_real_escape_string($_GET['url']);
	echo '&lt;a href=&quot;admin.php&quot;&gt;Retour à la liste complète&lt;/a&gt;&lt;br /&gt;';
	$retour = mysqli_query($connexion, 'SELECT http_referer, COUNT(http_referer) AS nb_vues_tot FROM provenance WHERE http_referer LIKE \'http_//' . $url . '%\' GROUP BY http_referer');
	while ($donnees = mysqli_fetch_assoc($retour))
			echo $donnees['nb_vues_tot'] . ' &lt;a href=&quot;' . $donnees['http_referer'] . '&quot;&gt;' . $donnees['http_referer'] . '&lt;/a&gt;&lt;br/&gt;';
} else {
	$retour = mysqli_query($connexion, 'SELECT http_referer, COUNT(http_referer) AS nb_vues_tot FROM provenance GROUP BY http_referer');
	$url = array();
	while ($donnees = mysqli_fetch_assoc($retour))
	{
		if ($donnees['http_referer'] == '')
		{
			$donnees['http_referer'] = 'URL directe';
			echo $donnees['http_referer'] . $donnees['nb_vues_tot'] . '&lt;br/&gt;';
		} else {
			$referer = explode('/', $donnees['http_referer']);
			if (array_key_exists($referer[2], $url))
				$url[$referer[2]] = $url[$referer[2]] + $donnees['nb_vues_tot'];
			else
			$url[$referer[2]] = $donnees['nb_vues_tot'];
		}
	}

	foreach($url as $key =&gt; $value)
		echo '&lt;a href=&quot;admin.php?url=' . $key . '&quot;&gt;' . $key . '&lt;/a&gt;' . $value . '&lt;br/&gt;';
}
?&gt;</code></pre><p id="r-554351" data-claire-element-id="554351">PS : ne me remerciez pas. :D</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site">Des statistiques pour votre site !</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg1-combien-ai-je-de-visites">
TP n°1 : combien ai-je de visites ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg2-qui-est-connecte-sur-mon-site">
TP n°2 : qui est connecté sur mon site ?
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg3-mais-d-ou-viennent-mes-visiteurs">
TP n°3 : mais d&#039;où viennent mes visiteurs ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg4-affluences-et-heures-de-pointe">
TP n°4 : affluences et heures de pointe
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg2-qui-est-connecte-sur-mon-site">
<span class="arrow"></span>
<span class="next">TP n°2 : qui est connecté sur mon site ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg4-affluences-et-heures-de-pointe">
<span class="next">TP n°4 : affluences et heures de pointe</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="TPn4affluencesetheuresdepointe"></a><h2>TP n°4 : affluences et heures de pointe</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg3-mais-d-ou-viennent-mes-visiteurs">
<span class="arrow"></span>
<span class="next">TP n°3 : mais d&#039;où viennent mes visiteurs ?</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-554354" data-claire-element-id="554354">Voici le but de ce TP : visualiser l'affluence de votre site en fonction des heures de visite des internautes.<br/> Pour chaque heure, on verra donc le nombre de visites total que cette heure a recensé depuis que ce module est en place.</p><aside id="r-554356" data-claire-element-id="554356" data-claire-semantic="information"><p id="r-554355" data-claire-element-id="554355">Le script sera facilement adaptable à la fin pour visualiser l'affluence de votre site à un jour précis.</p></aside><div id="r-554358" data-claire-element-id="554358" data-claire-semantic="question"><p id="r-554357" data-claire-element-id="554357">o_O T'es sûr qu'on va y arriver ?</p></div><p id="r-554359" data-claire-element-id="554359">Mais oui. :) Par contre ça ne va pas être de tout repos.</p><p id="r-554360" data-claire-element-id="554360">Là je sens que vous allez avoir besoin d'infos parce que moi-même j'ai mis du temps à élaborer la technique. :D</p><p id="r-554361" data-claire-element-id="554361">Nous allons avoir une table, nommons-la &quot;affluence&quot;.<br/> Elle comportera trois champs : la date, l'heure et le nombre de visites.</p><aside id="r-554363" data-claire-element-id="554363" data-claire-semantic="warning"><p id="r-554362" data-claire-element-id="554362">Ne faites pas un champ DATETIME pour les deux premiers éléments que j'ai cités. Ce serait possible de le faire comme ça, mais extrêmement plus complexe.</p></aside><p id="r-554364" data-claire-element-id="554364">Notre champ date sera simplement de type DATE, notre champ heure sera TINYINT(2). En effet, à moins que vous ayez besoin de visualiser le nombre de visites chaque minute, on va se contenter de voir le nombre de visites pour chaque heure de la journée. :)</p><p id="r-554365" data-claire-element-id="554365">Voilà la technique que nous allons utiliser.</p><p id="r-554366" data-claire-element-id="554366"><strong>Enregistrement :</strong></p><ul id="r-554373" data-claire-element-id="554373"><li id="r-554368" data-claire-element-id="554368"><p id="r-554367" data-claire-element-id="554367">un visiteur va sur une page ;</p></li><li id="r-554370" data-claire-element-id="554370"><p id="r-554369" data-claire-element-id="554369">si l'heure (ex : 12) et la date (ex : 2010-01-04) de l'instant où il va sur la page ne sont pas dans une entrée présente dans la table, on la crée et on initialise son &quot;Nombre de visites&quot; à 1 ;</p></li><li id="r-554372" data-claire-element-id="554372"><p id="r-554371" data-claire-element-id="554371">si au contraire l'entrée (date+heure du moment où il se connecte) est présente, on incrémente le nombre de visites.</p></li></ul><p id="r-554374" data-claire-element-id="554374"><strong>Affichage :</strong></p><aside id="r-554376" data-claire-element-id="554376" data-claire-semantic="information"><p id="r-554375" data-claire-element-id="554375">On ne doit pas afficher les données d'aujourd'hui, car si un visiteur se connecte à midi, il verra une affluence plus élevée pour le matin que pour l'après-midi. On n'affichera donc que les données de la veille et antérieures.</p></aside><p id="r-554377" data-claire-element-id="554377">On va donc, pour chaque heure, en utilisant les boucles (ah, un indice :-° *note note note*), compter le nombre de visites totales de tous les jours précédents à l'heure choisie et l'afficher sous forme de tableau.</p><h3 id="r-correction-enregistrement" data-claire-element-id="554380">Correction : Enregistrement</h3><p id="r-554378" data-claire-element-id="554378">C'est pas ça le plus compliqué, si vous suivez mes indications vous tombez dessus sans problème. :)</p><pre id="r-554379" data-claire-element-id="554379"><code data-claire-semantic="html+php">&lt;?php
$heure = date ('H');
$retour_afflu = mysqli_query($connexion, 'SELECT COUNT(*) AS maintenant FROM affluence WHERE date = CURRENT_DATE() AND heure = ' . $heure);
$donnees_afflu = mysqli_fetch_assoc($retour_afflu);
if ($donnees_afflu['maintenant'] == 0) //Si l'heure n'a pas encore été enregistrée
{
	mysqli_query($connexion, 'INSERT INTO affluence(heure, date, visites) VALUES (' . $heure . ', CURRENT_DATE(), 1);'); //On rentre la date et l'heure et on marque 1 comme nombre de visites.
} else {
	mysqli_query($connexion, 'UPDATE affluence SET visites = visites + 1 WHERE date = CURRENT_DATE() AND heure = ' .$heure); //On rentre l'heure et la date d'aujourd'hui et on marque 1 comme nombre de visites.
}
?&gt;</code></pre><h3 id="r-correction-affichage" data-claire-element-id="554382">Correction : Affichage</h3><pre id="r-554381" data-claire-element-id="554381"><code data-claire-semantic="html+php">&lt;?php 

echo '&lt;table&gt;';

echo '&lt;tr&gt;';
for ($i = 0; $i &lt; 23; $i++)
{
	echo '&lt;td&gt;&lt;strong&gt;' . $i . 'h&lt;/strong&gt;&lt;/td&gt;';
}
echo '&lt;/tr&gt;';

echo '&lt;tr&gt;';
$req = mysqli_query($connexion, &quot;SELECT SUM(visites) AS nb_visites FROM affluence WHERE date != CURRENT_DATE() GROUP BY heure ORDER BY heure ASC&quot;);
while($dat = mysqli_fetch_assoc($req))
   echo '&lt;td&gt;' . $dat['nb_visites'] . '&lt;/td&gt;';

echo '&lt;/tr&gt;';
echo '&lt;/table&gt;';
?&gt;</code></pre><h3 id="r-affichage-graphique" data-claire-element-id="554392">Affichage graphique</h3><p id="r-554383" data-claire-element-id="554383">Si vous voulez afficher un graphique, vous pouvez apprendre à vous servir d'une librarie graphique comme JpGraph, Artichow... Vous pouvez également vous servir d'un site sympa qui vous permettra d'afficher un graphique sans installation : <a href="http://www.info.univ-angers.fr/~gh/jphistopct.php">Jphistopct</a>.</p><p id="r-554384" data-claire-element-id="554384">Le détail du fonctionnement est expliqué sur le site. Vous devez juste envoyer un lien contenant les valeurs que vous obtenez. <br/> Voici que que vous pouvez être capable de réaliser :</p><figure id="r-554386" data-claire-element-id="554387"><img id="r-554385" data-claire-element-id="554385" src="medias/uploads.siteduzero.com_files_210001_211000_210848.png" alt="Image utilisateur"/></figure><p id="r-554388" data-claire-element-id="554388">Bonne chance ! ;)</p><p id="r-554389" data-claire-element-id="554389">Ce tutoriel s'arrête là.</p><p id="r-554390" data-claire-element-id="554390">J'espère qu'il vous aura aidé mais surtout fait découvrir de nouvelles choses. :) <br/> Et n'oubliez jamais, c'est en phpant que l'on devient phperon. :p</p><p id="r-554391" data-claire-element-id="554391">Bonne chance pour la suite !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site">Des statistiques pour votre site !</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg1-combien-ai-je-de-visites">
TP n°1 : combien ai-je de visites ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg2-qui-est-connecte-sur-mon-site">
TP n°2 : qui est connecté sur mon site ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg3-mais-d-ou-viennent-mes-visiteurs">
TP n°3 : mais d&#039;où viennent mes visiteurs ?
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg4-affluences-et-heures-de-pointe">
TP n°4 : affluences et heures de pointe
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/des-statistiques-pour-votre-site/tp-ndeg3-mais-d-ou-viennent-mes-visiteurs">
<span class="arrow"></span>
<span class="next">TP n°3 : mais d&#039;où viennent mes visiteurs ?</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/des-statistiques-pour-votre-site.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 05:51:24 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/des-statistiques-pour-votre-site.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:03:43 GMT -->
</html>