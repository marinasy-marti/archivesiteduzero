<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 11:05:19 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:47:22 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Envoyer un mail à vos membres exceptionnellement et automatiquement</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Envoyer un mail à vos membres exceptionnellement et automatiquement</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Envoyerunmailvosmembresexceptionnellementetautomatiquement">Envoyer un mail à vos membres exceptionnellement et automatiquement</a><br/><a href="#Prparatifs">Préparatifs</a><br/><a href="#Notrecode">Notre code</a><br/><a href="#WebcronnotreSauveur">Webcron notre Sauveur</a><br/></div>
<a name="Envoyerunmailvosmembresexceptionnellementetautomatiquement"></a><h2>Envoyer un mail à vos membres exceptionnellement et automatiquement</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement/preparatifs-9">
<span class="next">Préparatifs</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-567130" data-claire-element-id="567130">Vous voulez envoyer un mail à tous vos membres pour une occasion particulière (Noël, jour de l'an, Halloween, résultat d'un concours, sortie d'un album, d'un livre, etc.) ? Je vais vous apprendre dans ce tutoriel à vous servir du site <em>webcron</em> pour faire un envoi automatisé et rapide. Il faudra dans un premier temps rédiger notre code puis ensuite nous inscrire et le soumettre à <em>webcron</em>.</p><p id="r-567131" data-claire-element-id="567131">Ce tutoriel vous permettra donc de maîtriser le site <em>webcron</em>, qui est très utile, ainsi que de revoir de nombreuses petites fonctions bien utiles en PHP. :)</p>
</div><a name="Prparatifs"></a><h2>Préparatifs</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement/notre-code">
<span class="next">Notre code</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-567132" data-claire-element-id="567132">Rédigeant ce tutoriel en période de fêtes de fin d'année, je vous propose de prendre comme exemple l'envoi d'un e-mail à 23 h 59 le 24/12/06 pour souhaiter un joyeux Noël à tous vos membres.</p><ul id="r-567137" data-claire-element-id="567137"><li id="r-567134" data-claire-element-id="567134"><p id="r-567133" data-claire-element-id="567133">Pour réaliser ceci, on va commencer par rédiger notre code (dans le fichier mail-noel.php).</p></li><li id="r-567136" data-claire-element-id="567136"><p id="r-567135" data-claire-element-id="567135">On poursuivra ensuite par une petite visite du site <em>webcron</em> pour finir de réaliser notre projet.</p></li></ul><h2 id="r-un-peu-de-culture-4" data-claire-element-id="567148">Un peu de culture</h2><p id="r-567138" data-claire-element-id="567138">Tout d'abord, il faut savoir que le site webcron n'est pas indispensable pour réaliser l'envoi de ce mail, il existe plusieurs manières de procéder.<br/> La première est la méthode manuelle. C'est très simple ; à l'heure voulue, vous allez sur votre page pour exécuter le script. Le seul problème est que vous devez donc être là pour le déclencher. :( Et je pense que le jour de Noël, vous avez d'autres choses à faire, non ? :p</p><p id="r-567139" data-claire-element-id="567139">La deuxième méthode consiste donc à créer ce que l'on appelle un <strong>cron</strong>.<br/> Je vous entends déjà dire « mais qu'est-ce qu'il raconte, lui, là-bas derrière son écran, il parle chinois ? :D ».<br/> Non, je ne parle pas chinois.</p><aside id="r-567144" data-claire-element-id="567144" data-claire-semantic="information"><p id="r-567140" data-claire-element-id="567140">Voici la définition d'un cron, d'après <a href="http://fr.wikipedia.org/wiki/Cron">Wikipédia</a> :</p><p id="r-567141" data-claire-element-id="567141"><cite>Citation : Wikipédia</cite></p><blockquote id="r-567143" data-claire-element-id="567143"><p id="r-567142" data-claire-element-id="567142"><strong>cron</strong> est le nom d'un programme qui permet aux utilisateurs des systèmes Unix d'exécuter automatiquement des logiciels (ou fichiers) à une date et une heure spécifiées à l'avance, ou selon un cycle défini à l'avance.</p></blockquote></aside><p id="r-567145" data-claire-element-id="567145">Je ne vous en dis pas plus sur le fait que le cron soit un <em>daemon</em>, ça n'a pas d'utilité dans ce tutoriel. Vous pouvez cependant lire <a href="http://fr.wikipedia.org/wiki/Cron">l'article complet et intéressant</a> à son sujet.</p><p id="r-567146" data-claire-element-id="567146">Le site <em>webcron</em> fait donc exactement la même chose, par Internet.<br/> L'avantage de le faire par le site est que grâce à cela, nous n'avons pas besoin d'avoir un serveur dédié pour utiliser les merveilleux crons.<br/> Eh oui, malheureusement, je ne connais aucun hébergeur mutualisé qui accepte les crons, car cela entreprendrait une modification des fichiers du système.</p><p id="r-567147" data-claire-element-id="567147">Voilà : je pense que vous êtes maintenant prêt pour commencer et que vous savez où l'on va (enfin je l'espère, car pas moi :p ).</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement">Envoyer un mail à vos membres exceptionnellement et automatiquement</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement/preparatifs-9">
Préparatifs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement/notre-code">
Notre code
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement/webcron-notre-sauveur">
Webcron notre Sauveur
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement/notre-code">
<span class="next">Notre code</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Notrecode"></a><h2>Notre code</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement/preparatifs-9">
<span class="arrow"></span>
<span class="next">Préparatifs</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement/webcron-notre-sauveur">
<span class="next">Webcron notre Sauveur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-567150" data-claire-element-id="567150">Nous allons donc dans cette sous-partie nous attarder sur le code nécessaire au bon fonctionnement du projet.</p><p id="r-567151" data-claire-element-id="567151">Il faut savoir que pour des raisons de sécurité, nous allons vérifier que nous sommes bien à la date et l'heure voulue. Sinon, des petits malins découvrant le fichier auraient vite fait de l'activer et vos membres recevraient tous ce mail avant l'heure. :-°</p><p id="r-567152" data-claire-element-id="567152">Nous allons donc voir le code par étapes.</p><pre id="r-567153" data-claire-element-id="567153"><code data-claire-semantic="html+php">&lt;?php
$timestamp_noel = mktime(23, 00, 00, 12, 24, 2006);    // On initialise le timestamp lorsqu'il sera à Noël</code></pre><p id="r-567154" data-claire-element-id="567154">J'utilise ici la fonction <a href="http://www.php.net/mktime">mktime</a> pour récupérer le timestamp de Noël 2006.<br/> Ici, j'ai choisi de prendre le 24 décembre 2006 à 23 h 00 et 00 sec. Je mets cette heure-ci car il n'est pas possible de choisir les minutes sur le site webcron. Eh oui, c'est moins précis que si vous le faisiez sur votre serveur dédié.</p><p id="r-567155" data-claire-element-id="567155">Notez que si vous souhaitez réutiliser votre script, vous pouvez mettre l'année dans une variable, comme ceci :</p><pre id="r-567156" data-claire-element-id="567156"><code data-claire-semantic="html+php">&lt;?php
$annee = date('Y');
$timestamp_noel = mktime(23, 00, 00, 12, 24, $annee);</code></pre><p id="r-567157" data-claire-element-id="567157">J'ai choisi de définir juste après nos variables message et sujet, contenant le message que vous allez envoyer à vos membres.</p><pre id="r-567158" data-claire-element-id="567158"><code data-claire-semantic="html+php">&lt;?php
$message = '
     &lt;html&gt;
     &lt;head&gt;
 
     &lt;/head&gt;
     &lt;body&gt;
&lt;h1&gt;Joyeux Noël et très bonnes fêtes de fin d\'année&lt;/h1&gt;
&lt;p&gt;Toute l\'équipe de [votre site] vous souhaite de très bonnes fêtes de fin d\'année, en espérant une très bonne nouvelle année&lt;/p&gt;
&lt;p&gt;Blabla, blabla, etc.&lt;/p&gt;
     &lt;/body&gt;
     &lt;/html&gt;
';
$sujet = 'Joyeux Noël';</code></pre><p id="r-567159" data-claire-element-id="567159">Vous mettez ce que vous souhaitez dans votre code, pour annoncer d'éventuelles nouveautés, un concours ou autre chose.</p><p id="r-567160" data-claire-element-id="567160">Ensuite, nous allons nous attaquer aux <em>headers</em> ; c'est quelque chose d'obligatoire pour le bon envoi de votre e-mail. Je ne vous demanderai pas de comprendre ce morceau de code, sachez juste qu'il va permettre de régler le format de l'e-mail, pour que le HTML soit pris en compte et que les caractères s'y affichent normalement.</p><pre id="r-567161" data-claire-element-id="567161"><code data-claire-semantic="html+php">&lt;?php
$headers  = 'MIME-Version: 1.0' . &quot;\r\n&quot;;
$headers .= 'Content-type: text/html; charset=iso-8859-1' . &quot;\r\n&quot;;</code></pre><p id="r-567162" data-claire-element-id="567162">Avant de passer au reste, il nous faut vérifier si la date actuelle est la même que celle précédemment évoquée.</p><p id="r-567163" data-claire-element-id="567163">Nous le faisons donc simplement grâce à un if.</p><pre id="r-567164" data-claire-element-id="567164"><code data-claire-semantic="html+php">&lt;?php
if(time() == $timestamp_noel) // Pour plus de sécurité, on compare le timestamp actuel à celui de Noël
{
//Notre code d'envoi d'e-mail
}</code></pre><p id="r-567165" data-claire-element-id="567165">Nous passons maintenant au listage des e-mails de vos membres :</p><pre id="r-567166" data-claire-element-id="567166"><code data-claire-semantic="html+php">&lt;?php
mysql_connect(&quot;localhost&quot;, &quot;login&quot;, &quot;*****&quot;);
mysql_select_db(&quot;bdd&quot;);
$req = mysql_query(&quot;SELECT mail FROM membres&quot;);</code></pre><p id="r-567167" data-claire-element-id="567167">Maintenant, il est simple d'envoyer notre message à chaque membre grâce à une boucle while.</p><pre id="r-567168" data-claire-element-id="567168"><code data-claire-semantic="html+php">&lt;?php
while($mail = mysql_fetch_array($req))
{
   mail($mail['mail'], $sujet, $message, $headers);
   echo 'Mail bien envoyé à '.$mail['mail'].'';
}</code></pre><p id="r-567169" data-claire-element-id="567169">Voilà : à présent, votre script est prêt à fonctionner. Pour le compléter, je vous propose juste un petit else.</p><pre id="r-567170" data-claire-element-id="567170"><code data-claire-semantic="html+php">&lt;?php
else
{
echo 'Désolé, c\'est pas le bon jour. :p';
}
mysql_close();
?&gt;</code></pre><p id="r-567171" data-claire-element-id="567171">Allez : comme cadeau de Noël de ma part, je vous offre le code en entier.</p><pre id="r-567172" data-claire-element-id="567172"><code data-claire-semantic="html+php">&lt;?php
$timestamp_noel = mktime(23, 59, 15, 12, 24, 2006);    // On initialise le timestamp qu'il sera à Noël
$message = '&lt;html&gt;
     &lt;head&gt;
 
     &lt;/head&gt;
     &lt;body&gt;
&lt;h1&gt;Joyeux Noël et très bonnes fêtes de fin d\'année&lt;/h1&gt;
&lt;p&gt;Toute l\'équipe de Image-Studio vous souhaite de très bonnes fêtes de fin d\'année en espérant une très bonne nouvelle année&lt;/p&gt;\n
&lt;p&gt;Pas mal de nouveautés sont à prévoir cette année sur le site, et nous vous rappelons que le site dispose d\'un forum communautaire pour partager vos passions&lt;/p&gt;
     &lt;/body&gt;
     &lt;/html&gt;
';
$sujet = 'Joyeux Noël';
$headers  = 'MIME-Version: 1.0' . &quot;\r\n&quot;;
     $headers .= 'Content-type: text/html; charset=iso-8859-1' . &quot;\r\n&quot;;
if(time() == $timestamp_noel) // Pour plus de sécurité, on compare le timestamp actuel à celui de Noël
{
 mysql_connect(&quot;localhost&quot;, &quot;login&quot;, &quot;******&quot;);
 mysql_select_db(&quot;bdd&quot;);
 $req = mysql_query(&quot;SELECT * FROM mail&quot;);
 while($mail = mysql_fetch_array($req))
 {
  mail($mail['mail'], $sujet, $message, $headers);
  echo 'Mail bien envoyé à '.$mail['mail'].'';
 }
}
else
{
  echo 'Désolé c\'est pas le bon jour :p';
}
mysql_close();
?&gt;</code></pre><p id="r-567173" data-claire-element-id="567173">Nous pouvons maintenant passer à la seconde partie.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement">Envoyer un mail à vos membres exceptionnellement et automatiquement</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement/preparatifs-9">
Préparatifs
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement/notre-code">
Notre code
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement/webcron-notre-sauveur">
Webcron notre Sauveur
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement/preparatifs-9">
<span class="arrow"></span>
<span class="next">Préparatifs</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement/webcron-notre-sauveur">
<span class="next">Webcron notre Sauveur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="WebcronnotreSauveur"></a><h2>Webcron notre Sauveur</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement/notre-code">
<span class="arrow"></span>
<span class="next">Notre code</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-567175" data-claire-element-id="567175">Eh oui ! Il ne manquait que lui pour conclure notre projet.<br/> Alors tout d'abord, voici l'adresse du site : <a href="http://webcron.org/">Webcron.org</a>.</p><p id="r-567176" data-claire-element-id="567177"><a href="medias/uploads.siteduzero.com_files_50001_51000_50519.jpg"><img id="r-567177" data-claire-element-id="567176" src="medias/uploads.siteduzero.com_thb_50001_51000_50519.jpg" alt="Image utilisateur"/></a>(Cliquez sur l'image pour l'agrandir)<br/> Je ne vous en refais pas de présentation. Inscrivez-vous, cette étape ne devrait pas poser trop de problèmes. :p <br/> Une fois ceci réalisé et l'inscription confirmée, connectez-vous à votre compte.<br/> Rendez-vous ensuite sur la page <em>Mes tâches</em>, et cliquez sur <strong>Nouvelle tâche</strong>. Vous devriez avoir la page suivante qui apparaît.</p><p id="r-567178" data-claire-element-id="567179"><a href="medias/uploads.siteduzero.com_files_50001_51000_50521.jpg"><img id="r-567179" data-claire-element-id="567178" src="medias/uploads.siteduzero.com_thb_50001_51000_50521.jpg" alt="Image utilisateur"/></a>Remplissez le champ URL en mettant l'URL du fichier d'envoi de mail.<br/> Ensuite, ne remplissez pas <em><strong>login</strong></em> et <em><strong>mot de passe</strong></em>, renseignez l'heure, la date, le mois, le jour, etc.<br/> Puis validez, vous devriez obtenir ceci :</p><p id="r-567180" data-claire-element-id="567181"><a href="medias/uploads.siteduzero.com_files_50001_51000_50523.jpg"><img id="r-567181" data-claire-element-id="567180" src="medias/uploads.siteduzero.com_thb_50001_51000_50523.jpg" alt="Image utilisateur"/></a>Et voilà : maintenant, tout est prêt pour que vos membres reçoivent un joli petit mail.<br/> Vous pouvez le modifier un peu en y ajoutant des couleurs, etc.</p><p id="r-567182" data-claire-element-id="567182">Voilà qui conclut mon premier tutoriel ; si vous avez des commentaires, surtout n'hésitez pas à laisser une note et un commentaire.</p><p id="r-567183" data-claire-element-id="567183">J'espère que cela vous aura permis de faire de bien jolis petits codes pour le plaisir de vos membres. <br/> C'est dommage que l'envoi ne puisse se faire sur <em>webcron</em> à la minute près, mais bon ce n'est pas très grave.</p><p id="r-567184" data-claire-element-id="567184"><em>Webcron</em> propose aussi la fonction tester, qui permet de voir si tout est « OK » avant l'heure.</p><p id="r-567185" data-claire-element-id="567185">Merci à vous ! ;)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement">Envoyer un mail à vos membres exceptionnellement et automatiquement</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement/preparatifs-9">
Préparatifs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement/notre-code">
Notre code
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement/webcron-notre-sauveur">
Webcron notre Sauveur
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement/notre-code">
<span class="arrow"></span>
<span class="next">Notre code</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 11:05:28 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/envoyer-un-mail-a-vos-membres-exceptionnellement-et-automatiquement.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:47:24 GMT -->
</html>