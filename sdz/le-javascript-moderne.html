<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/le-javascript-moderne.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 03:37:57 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/le-javascript-moderne.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:43:54 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Le JavaScript moderne</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/le-javascript-moderne.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Le JavaScript moderne</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#LeJavaScriptmoderne">Le JavaScript moderne</a><br/><a href="#L039histoiremouvementedeJavaScript">L&#039;histoire mouvementée de JavaScript</a><br/><a href="#L039assembleurduweb">L&#039;assembleur du web</a><br/><a href="#ECMAScriptHarmony">ECMAScript Harmony</a><br/></div>
<a name="LeJavaScriptmoderne"></a><h2>Le JavaScript moderne</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne/l-histoire-mouvementee-de-javascript">
<span class="next">L&#039;histoire mouvementée de JavaScript</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-333764" data-claire-element-id="333764">Ces dernières années, l'utilisation de JavaScript a évolué jusqu'à en faire un <strong>incontournable du web</strong>. L'écrasante majorité des navigateurs supportent JavaScript, que ce soit pour les ordinateurs de bureau ou les téléphones portables. Les navigateurs web optimisent continuellement leurs moteurs JavaScript et les développeurs en profitent pour apporter des applications entières sur le web. Le succès de JavaScript est tel qu'il s'étend désormais à d'autres usages :</p><ul id="r-333769" data-claire-element-id="333769"><li id="r-333766" data-claire-element-id="333766"><p id="r-333765" data-claire-element-id="333765"><a href="http://nodejs.org/">Node.js</a>, <a href="http://couchdb.apache.org/">CouchDB</a> ou encore <a href="http://www.meteor.com/">Meteor</a> utilisent JavaScript pour créer des sites web, mais cette fois aussi du côté serveur ! Un seul langage est utilisé, ce qui facilite le développement.</p></li><li id="r-333768" data-claire-element-id="333768"><p id="r-333767" data-claire-element-id="333767">Les applications de bureau ne sont pas en reste : JavaScript fera partie des langages supportés pour écrire des applications dans <a href="http://msdn.microsoft.com/en-us/library/windows/apps/br211385.aspx">Windows 8</a> et <a href="http://arstechnica.com/business/news/2012/04/an-in-depth-look-at-qt-5-making-javascript-a-first-class-citizen-for-native-cross-platform-developme.ars">Qt 5</a>, deux mastodontes pour les interfaces utilisateur de demain.</p></li></ul><p id="r-333770" data-claire-element-id="333770">Paradoxalement, la réputation de JavaScript a longtemps été mauvaise, et on n'imagine pas forcément au premier abord toutes les possibilités aujourd'hui offertes par JavaScript. Dans ce contexte, tout programmeur a intérêt à se pencher sur JavaScript pour comprendre ses origines, savoir ce qui est possible aujourd'hui et ce qu'on peut espérer du langage dans le futur. C'est dans cette optique que se place cette article : nous espérons qu'elle puisse vous être utile en tant que programmeur et/ou décideur pour mieux comprendre ce que peut vous apporter ce langage <strong>aujourd'hui et dans les années qui viennent</strong>.</p><p id="r-333771" data-claire-element-id="333771">L'utilisation principale de JavaScript reste aujourd'hui l'aide à la <strong>navigation sur un site web</strong>. L'idée est de proposer aux utilisateurs ayant activé JavaScript des petites fonctionnalités pratiques rendant la navigation plus rapide et plus confortable sans pour autant impacter les utilisateurs ne disposant pas de JavaScript (tels que les moteurs de recherche). Cette façon d'utiliser JavaScript s'inscrit dans le cadre plus général du <em>progressive enhancement</em>. On se contente initialement de HTML pour apporter les fonctionnalités de bases aux clients les plus basiques : moteurs de recherche, lecteurs d'écrans, navigateurs texte. On conçoit ensuite la présentation en CSS avec des techniques de <strong><em>responsive design</em></strong> : on pense d'abord aux petits écrans des smartphones, puis le rendu est adapté aux écrans plus larges via les <a href="http://mediaqueri.es/">media queries CSS3</a>.</p><p id="r-333772" data-claire-element-id="333772">JavaScript permet ensuite de peaufiner l'expérience utilisateur par petites touches : nous prendrons pour exemple le Site du Zéro qui a toujours <a href="http://www.siteduzero.com/savoirplus.html#technologies">suivi cette philosophie</a>. Par exemple, la <em>speedbarre</em> située en haut de chaque page permet d'accéder rapidement aux divers contenus du site : l'utilisation de JavaScript améliore ici l'ergonomie en respectant mieux la <a href="http://fr.wikipedia.org/wiki/Règle_des_trois_clics">règle des trois clics</a>. Nous ferons plus tard dans l'article un état des lieux plus complet de l'utilisation de JavaScript sur le Site du Zéro, qui se cache parfois où on ne l'attend pas.</p>
</div><a name="L039histoiremouvementedeJavaScript"></a><h2>L&#039;histoire mouvementée de JavaScript</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne/l-assembleur-du-web">
<span class="next">L&#039;assembleur du web</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-333773" data-claire-element-id="333773">Il est important de réaliser que JavaScript et les bibliothèques telles que jQuery qui ont fait son succès ne sont pas apparues du jour au lendemain. Au contraire ! Cette section explique le long chemin parcouru depuis les années 1990.</p><h2 id="r-la-prehistoire" data-claire-element-id="333781">La préhistoire</h2><figure id="r-333775" data-claire-element-id="333776"><img id="r-333774" data-claire-element-id="333774" src="medias/uploads.siteduzero.com_files_378001_379000_378405.png" alt="JavaScript"/></figure><p id="r-333777" data-claire-element-id="333777">C'est en 1995 qu'a eu lieu sur le web le début de la guerre des navigateurs. Netscape Navigator 1 et Internet Explorer 1 étaient les deux navigateurs les plus populaires, et chacun se battait pour grappiller des parts de marché à l'autre. Une des stratégies les plus utilisées à l'époque était d'ajouter des <a href="http://www.howtocreate.co.uk/jshistory.html">améliorations</a> propriétaires puis d'encourager les webmasters à s'en servir. Les sites web ainsi créés ne fonctionnant pas aussi bien chez le concurrent, les utilisateurs étaient ainsi encouragés à installer le navigateur prévu par le webmaster. Naturellement, dès qu'une fonctionnalité devenait populaire, le concurrent l'implémentait aussitôt, et le cycle pouvait recommencer.</p><p id="r-333778" data-claire-element-id="333778">C'est dans ce contexte que Brendan Eich a été recruté par Netscape, toujours en 1995. Sa mission était initialement d'<a href="http://brendaneich.com/2008/04/popularity/">intégrer le langage fonctionnel Scheme</a> à Netscape 2 pour donner la possibilité à des personnes peu expérimentées <strong>d'ajouter des effets à leurs pages</strong>. La direction de Netscape a insisté pour que ce langage ressemble à Java, qui allait lui aussi être intégré pour rendre possible la création de composants plus sérieux, les applets Java. Le nom JavaScript viendrait d'ailleurs de la volonté <a href="http://kb.mozillazine.org/JavaScript_is_not_Java">d'attirer l'attention des médias</a> sur ce nouveau langage, et d'entretenir la confusion avec Java. Néanmoins, ce sont deux langages très différents : Brendan Eich déclare s'être principalement inspiré de Scheme et Self pendant les 10 jours qu'il a eu pour concevoir un prototype. Au-delà du langage en lui-même, c'est à cette époque qu'est apparu DOM 0 qui permet d'utiliser JavaScript pour interagir avec une page web. Par exemple, ce code permet d'afficher une popup à l'utilisateur lors d'un clic sur un lien :</p><pre id="r-333779" data-claire-element-id="333779"><code data-claire-semantic="html">&lt;a href=&quot;#clickme&quot; onclick='alert(&quot;Vous avez cliqué !&quot;)'&gt;Cliquez-moi !&lt;/a&gt;</code></pre><p id="r-333780" data-claire-element-id="333780">Au fil des années, de <a href="http://fr.wikipedia.org/wiki/ECMAScript%23Correspondance">nombreuses versions</a> de JavaScript sont apparues dans Netscape et Internet Explorer, apportant à chaque fois leur lot de nouveautés. À cette époque, l'utilisation de JavaScript dans des pages web s’appelait <strong>DHTML</strong>, et de nombreux <a href="http://www.crockford.com/javascript/javascript.html">mauvais livres</a> en enseignaient les possibilités sans pour autant indiquer les bonnes pratiques. Les <code data-claire-semantic="javascript">alert()</code>, les curseurs personnalisés, les <a href="http://www.pompage.net/traduction/menu-survol-et-utilisateurs">menus déroulants inaccessibles</a> voire la <a href="http://www.schillmania.com/projects/snowstorm/">neige sur les pages web</a> étaient une plaie pour les utilisateurs. JavaScript était alors considéré comme un « <a href="http://www.crockford.com/javascript/javascript.html">langage pour amateurs</a> ».</p><h2 id="r-redecouverte-de-javascript" data-claire-element-id="333794">Redécouverte de JavaScript</h2><p id="r-333782" data-claire-element-id="333782">Ce n'est que depuis le milieu des années 2000 que les développeurs ont compris que JavaScript pouvait être utilisé judicieusement afin d'améliorer l'expérience de certains utilisateurs sans pénaliser les autres. C'est aussi à cette époque que l'objet <code data-claire-semantic="javascript">XMLHttpRequest</code> a été rendu disponible sur les principaux navigateurs, ouvrant la voie à des sites web plus dynamiques, capables de ne recharger qu'une partie des pages web : cette technique est connue sous le nom d'AJAX. <a href="http://rubyonrails.org/">Ruby on Rails</a> proposait dès 2005 l'utilisation d'AJAX de <a href="http://onlamp.com/onlamp/2005/06/09/rails_ajax.html">manière simple et transparente</a> ; de nombreux frameworks ont suivi par la suite.</p><p id="r-333783" data-claire-element-id="333783">Cependant, écrire du JavaScript restait réservé à une certaine élite du fait des différences entre les navigateurs. Afin de gommer ces différences, des bibliothèques telles que jQuery, Prototype ou encore Mootols deviennent disponibles en <a href="http://www.google.com/trends/?q=javascript,prototype.js,jquery,mootools,underscore.js&amp;ctab=0&amp;geo=all&amp;date=all&amp;sort=0">2005/2006</a>. Elles offrent notamment la possibilité de sélectionner des éléments de la page en utilisant de simples <a href="http://www.w3.org/TR/selectors/">sélecteurs CSS</a>. Par exemple, si je veux afficher tous les éléments cachés d'une page ayant la classe <em>secret</em>, il me suffit d'écrire <code data-claire-semantic="javascript">$('.secret[display=&quot;none&quot;]').show()</code>. Les apports de ces bibliothèques vont au-delà de ce simple exemple :</p><ul id="r-333792" data-claire-element-id="333792"><li id="r-333785" data-claire-element-id="333785"><p id="r-333784" data-claire-element-id="333784">un simple appel de fonction permet de récupérer des données du serveur via AJAX ;</p></li><li id="r-333787" data-claire-element-id="333787"><p id="r-333786" data-claire-element-id="333786">il est facile de réagir à des évènements tel qu'un clic ou une soumission de formulaire ;</p></li><li id="r-333789" data-claire-element-id="333789"><p id="r-333788" data-claire-element-id="333788">de nombreuses animations tels que les fondus apportent des transitions plus douces ;</p></li><li id="r-333791" data-claire-element-id="333791"><p id="r-333790" data-claire-element-id="333790">et de <a href="http://microjs.com/#">nombreuses autres fonctionnalités</a>.</p></li></ul><p id="r-333793" data-claire-element-id="333793">Contrairement à ce qu'on pourrait croire, ces bibliothèques ne dispensent pas de connaître et comprendre les concepts JavaScript utilisés. Quoiqu'il en soit, ces bibliothèques ont ouvert la voie à une utilisation massive de JavaScript en facilitant grandement l'écriture de nombreux programmes allant du petit script à l'application complète.</p><h2 id="r-normalisation" data-claire-element-id="333803">Normalisation</h2><figure id="r-333796" data-claire-element-id="333797"><img id="r-333795" data-claire-element-id="333795" src="medias/uploads.siteduzero.com_files_373001_374000_373520.png" alt="jQuery Word Cloud"/></figure><p id="r-333798" data-claire-element-id="333798"><a href="http://weblogs.asp.net/infinitiesloop/archive/2010/04/21/tokenizing-javascript-a-look-at-what-s-left-after-minification.aspx">Source: Infinities Loop</a>Pour s'assurer que JavaScript soit implémenté de la même manière dans tous les navigateurs, un <strong>standard</strong> spécifiant en détail le fonctionnement du langage est une condition nécessaire, même si pas forcément suffisante. Le comité TC39 existe au sein d'ECMA depuis 1996 pour réaliser ce travail d'équilibriste : il s'agit à la fois d'incorporer les extensions les plus pertinentes et de proposer les évolutions les plus prometteuse pour le langage, le tout devant former un ensemble cohérent. Le langage ainsi spécifié se nomme <strong>ECMAScript</strong>. C'est d'ailleurs un abus de langage de parler de JavaScript qui n'est finalement que le nom de l'implémentation initialement proposée par Netscape et maintenant développée par Mozilla. Quand nous disons programmer en JavaScript, nous utilisons en fait une version spécifique d'ECMAScript.</p><p id="r-333799" data-claire-element-id="333799">Pendant longtemps, c'est ECMAScript 3 qui a été utilisé. Au début des années 2000, le comité s'est penché sur une mise à jour très ambitieuse : ECMAScript 4. Malheureusement, le langage était tellement complexe que les membres du comité n'ont pas réussi à se mettre d'accord et cette version a fini par être abandonnée. Les organisations n'étant pas favorables à ES4 (parmi lesquelles figuraient Microsoft, Google et Yahoo!) ont décidé de former leur propre comité pour proposer une mise à jour plus réaliste et moins ambitieuse. Le comité TC39 l'a finalement adoptée à la place d'ECMAScript 4, et c'est ainsi qu'ECMAScript 5 a été finalisé à la fin de l'année 2009.</p><p id="r-333800" data-claire-element-id="333800">Parmi les fonctionnalités apportées par ES5 figurent des fonctions capables d'opérer sur des collections. Par exemple, <code>filter()</code> prend en paramètre une fonction et retourne une nouvelle collection contenant les éléments que la fonction a choisi de conserver :</p><pre id="r-333801" data-claire-element-id="333801"><code data-claire-semantic="javascript">var ages = [12, 89, 23, 45, 5, 37];
var majeurs = ages.filter(function(age) { return age &gt; 18; });
// Désormais, majeurs vaut [89, 23, 45, 37]</code></pre><p id="r-333802" data-claire-element-id="333802">Le comité TC39 a décidé de ne pas s'arrêter avec ECMAScript 5 et travaille aujourd'hui sur ECMAScript Harmony, une nouvelle version prometteuse qui reprend certains éléments d'ECMAScript 4 et qui vise à faciliter l'utilisation de JavaScript dans des applications modernes. La dernière section de cette news vous présentera les nouveautés les plus intéressantes de cette nouvelle version d'ECMAScript.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne">Le JavaScript moderne</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne/l-histoire-mouvementee-de-javascript">
L&#039;histoire mouvementée de JavaScript
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne/l-assembleur-du-web">
L&#039;assembleur du web
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne/ecmascript-harmony">
ECMAScript Harmony
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne/l-assembleur-du-web">
<span class="next">L&#039;assembleur du web</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="L039assembleurduweb"></a><h2>L&#039;assembleur du web</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne/l-histoire-mouvementee-de-javascript">
<span class="arrow"></span>
<span class="next">L&#039;histoire mouvementée de JavaScript</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne/ecmascript-harmony">
<span class="next">ECMAScript Harmony</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-333805" data-claire-element-id="333805">JavaScript a principalement évolué en tant que langage de script pour les navigateurs. Cependant, son utilisation dépasse aujourd'hui ce cadre, et cette section se propose aussi de vous introduire à d'autres possibilités qui n'auraient pas été imaginables il y a quelques années.</p><p id="r-333806" data-claire-element-id="333806">Si vous êtes intéressés par ces technologies, sachez que <a href="http://www.siteduzero.com/membres-294-8276.html">Nesquik69</a> et <a href="http://www.siteduzero.com/membres-294-1398.html">Thunderseb</a> nous proposent deux tutoriels de qualité sur le Site du Zéro : <em><a href="http://www.siteduzero.com/tutoriel-3-309961-dynamisez-vos-sites-web-avec-javascript.html">Dynamisez vos sites web avec Javascript !</a></em> et <em><a href="http://www.siteduzero.com/tutoriel-3-4745-ajax-et-l-echange-de-donnees-en-javascript.html">AJAX et l'échange de données en JavaScript</a></em>. Ils ne sont pas spécifiques à une bibliothèque telle que jQuery et constituent un excellent moyen de comprendre le fonctionnement de JavaScript tout en apprenant à l'utiliser au mieux : il est ensuite très facile d'utiliser jQuery, par exemple. Une autre excellente ressource est <em><a href="http://shop.oreilly.com/product/9780596517748.do">JavaScript: The Good Parts</a></em> qui couvre en profondeur les bonnes pratiques à utiliser avec JavaScript.</p><h2 id="r-cas-d-utilisation-le-site-du-zero" data-claire-element-id="333840">Cas d'utilisation : le Site du Zéro</h2><p id="r-333807" data-claire-element-id="333807">Pour rendre cet article plus concret, nous avons décidé de montrer comment est utilisé JavaScript dans un vrai site web : le Site du Zéro. Ce n'est pas le seul site à le faire : Google Search, Wikipédia, <a href="http://37signals.com/svn/posts/3112-how-basecamp-next-got-to-be-so-damn-fast-without-using-much-client-side-ui">BaseCamp Next</a> ou encore <a href="http://blog.fogcreek.com/the-trello-tech-stack/">Trello</a> sont d'autres exemples de site tirant profit intelligemment des possibilités de JavaScript. Néanmoins, il est intéressant de proposer un « instantané » de l'utilisation du JavaScript sur un site web donné qui a toujours déclaré utiliser JavaScript pour <a href="http://www.siteduzero.com/savoirplus.html#technologies">améliorer le confort</a> des utilisateurs, et non pour céder à une quelconque mode. Sur le Site du Zéro, une lecture du code JavaScript indique qu'il y a trois grandes utilisations :</p><ul id="r-333814" data-claire-element-id="333814"><li id="r-333809" data-claire-element-id="333809"><p id="r-333808" data-claire-element-id="333808">les publicités qui sont chargées en JavaScript après le reste de la page afin d’accélérer le chargement ;</p></li><li id="r-333811" data-claire-element-id="333811"><p id="r-333810" data-claire-element-id="333810">les outils de mesure (activité de l'utilisateur, performance de la page) ;</p></li><li id="r-333813" data-claire-element-id="333813"><p id="r-333812" data-claire-element-id="333812">les aides à la navigation.</p></li></ul><p id="r-333815" data-claire-element-id="333815">Les <strong>publicités</strong> sont chargées une fois la page affichée pour ne pas ralentir l'utilisateur qui vient avant tout pour le contenu du site web : il n'y a rien de plus frustrant que d'attendre qu'une publicité s'affiche pour voir le contenu d'une page. Les publicités semblent être servies par Google AdSense, Smart AdServer ou parfois directement par le site pour le site : il s'agit alors d'auto-promotion pour des parties spécifiques du site (la boutique, par exemple). Il est intéressant de noter que le Site du Zéro n'impose pas les publicités à ses utilisateurs : il est possible de les <a href="http://www.simple-it.fr/blog/2011/08/publicite-en-ligne-donner-le-choix-aux-utilisateurs/">désactiver complètement</a> pour les utilisateurs qui le souhaitent. C'est exceptionnel sur le web et mérite d'être souligné.</p><p id="r-333816" data-claire-element-id="333816">Au niveau des <strong>mesures</strong>, il y a d'abord la performance côté client : diverses mesures dont le temps d'affichage sont effectuées via l'outil <a href="https://newrelic.com/docs/features/how-does-real-user-monitoring-work">Real User Monitoring</a> de New Relic. Cet outil permet aux développeurs de savoir ce qui prend du temps <em>en pratique</em> sur la page. Est-ce que c'est l'affichage des pubs ? Le téléchargement de jQuery ? Le traitement du JavaScript pour le navigateur ? C'est un outil précieux pour garder le site performant et rapide à utiliser.</p><figure id="r-logo-chartbeat" data-claire-element-id="333819"><img id="r-333817" data-claire-element-id="333817" src="medias/uploads.siteduzero.com_files_378001_379000_378407.png" alt="Logo Chartbeat"/><figcaption>Logo Chartbeat</figcaption></figure><p id="r-333820" data-claire-element-id="333820">Du point de vue de l'activité de l'utilisateur, une analyse des pages vues est faite via Google Analytics et XiTi. Au-delà du suivi des clics, l'activité sur chaque page est mesurée via <a href="http://chartbeat.com/">Chartbeat</a>. Êtes-vous en train de bouger la souris ou de faire défiler la page ? C'est ce qui indique à Chartbeat et au Site du Zéro que vous êtes en train de lire cet article. Si vous décidez de laisser un commentaire, les lettres tapées permettront de savoir que vous avez commencé à taper un message, avant même que vous ne décidiez de le soumettre. Ces statistiques ont de nombreuses utilités potentielles. Un exemple farfelu : elles pourraient être utilisées pour améliorer les articles. En effet, si tout le monde arrête sa lecture après ce passage, c'est peut-être qu'il était décourageant. :)</p><p id="r-333821" data-claire-element-id="333821">Enfin, la plus grande partie du JavaScript écrit sur le Site du Zéro concerne les <strong>aides à la navigation</strong>. Elles sont nombreuses, mais jamais obstrusives : il est possible d'utiliser les mêmes fonctionnalités sans JavaScript, c'est simplement moins agréable. Il y a plusieurs dizaines de telles fonctionnalités. Citons en quelques-unes :</p><ul id="r-333838" data-claire-element-id="333838"><li id="r-333823" data-claire-element-id="333823"><p id="r-333822" data-claire-element-id="333822">tous les formulaires du site sont équipées de la zForm, permettant de faciliter l'ajout de balises zCode permettant d'écrire du contenu plus riche (liens, titres, mise en forme, etc.),</p></li><li id="r-333825" data-claire-element-id="333825"><p id="r-333824" data-claire-element-id="333824">la sauvegarde automatique intégrée à la zForm permettant de ne pas perdre le contenu écrit suite à une fausse manipulation,</p></li><li id="r-333827" data-claire-element-id="333827"><p id="r-333826" data-claire-element-id="333826">le carrousel de la page d'accueil met en avant différents contenus les uns après les autres,</p></li><li id="r-333829" data-claire-element-id="333829"><p id="r-333828" data-claire-element-id="333828">les spoilers ne sont affichés en JavaScript qu'à la demande de l'utilisateur,</p></li><li id="r-333831" data-claire-element-id="333831"><p id="r-333830" data-claire-element-id="333830">l'auto-complétion lors de la recherche de membres,</p></li><li id="r-333833" data-claire-element-id="333833"><p id="r-333832" data-claire-element-id="333832">l'affichage de la timeline twitter ou du flux RSS des membres directement sous leur avatar,</p></li><li id="r-333835" data-claire-element-id="333835"><p id="r-333834" data-claire-element-id="333834">le calcul du prix total lors d'une commande de livres,</p></li><li id="r-333837" data-claire-element-id="333837"><p id="r-333836" data-claire-element-id="333836">ou encore l'affichage des avatars des auteurs d'un tutoriel au <a href="http://www.siteduzero.com/tutoriel-3-51781-algorithmique-pour-l-apprenti-programmeur.html">survol de leur pseudo</a>.</p></li></ul><p id="r-333839" data-claire-element-id="333839">Certains ajouts ont une utilité limitée, d'autres comme la sauvegarde automatique sont rapidement devenus indispensables, mais rien de toute cela n'aurait été possible sans JavaScript.</p><h2 id="r-applications-web" data-claire-element-id="333855">Applications web</h2><figure id="r-logo-html5" data-claire-element-id="333843"><img id="r-333841" data-claire-element-id="333841" src="medias/uploads.siteduzero.com_files_378001_379000_378408.png" alt="Logo HTML5"/><figcaption>Logo HTML5</figcaption></figure><p id="r-333844" data-claire-element-id="333844">Même si le Site du Zéro reste relativement conservateur dans son utilisation de JavaScript, il est possible de franchir un autre palier : écrire une véritable <strong>application</strong> avec JavaScript. La distinction entre une application web et un site web est <a href="http://adactio.com/journal/1714/">très floue</a>, mais reste un moyen rapide de désigner des sites faisant énormément appel à JavaScript tels que GMail, la version classique de Twitter, ou encore Facebook. Étant donné que JavaScript est <strong>le</strong> langage que les navigateurs savent interpréter <em>rapidement</em>, ces applications peuvent se permettre d'utiliser de grandes quantités de JavaScript en sachant que le site restera rapide à l'utilisation. Différents moteurs tels que V8 ou SpiderMonkey ont été améliorés au fil des années pour apporter le meilleur des techniques de compilation à la volée afin d'apporter des performances toujours meilleurs aux applications web. Cette performance a rendu possible l'écriture d'applications entières en JavaScript.</p><p id="r-333845" data-claire-element-id="333845">Pour écrire de tels applications, de nombreux frameworks web ont vu le jour, permettant aux développeurs de mieux s'organiser. <a href="http://documentcloud.github.com/backbone/">Backbone.js</a> a pour but de redonner de la structure au développement d'applications web en s'inspirant du <a href="http://documentcloud.github.com/backbone/#FAQ-mvc">modèle MVC</a> très répandu dans les frameworks web tels que <a href="http://guides.rubyonrails.org/getting_started.html#the-components-of-rails">Ruby on Rails</a>, <a href="https://docs.djangoproject.com/en/dev/faq/general/#django-appears-to-be-a-mvc-framework-but-you-call-the-controller-the-view-and-the-view-the-template-how-come-you-don-t-use-the-standard-names">Django</a> ou encore <a href="http://codeigniter.com/user_guide/overview/mvc.html">Code Igniter</a>. Plus récemment, <a href="http://www.meteor.com/">Meteorjs</a> et <a href="http://angularjs.org/">Angularjs</a> ont fait parler d'eux pour l'approche novatrice qu'ils apportent au développement d'applications web en JavaScript. De tels frameworks sont un gros atout pour JavaScript : il n'a jamais été aussi simple d'écrire une application directement en JavaScript.</p><p id="r-333846" data-claire-element-id="333846">L'arrivée d'HTML5 est l'occasion pour le W3C de continuer à étendre les fonctionnalités accessibles à JavaScript, qui vont désormais bien plus loin que la manipulation de la page. Citons ici :</p><ul id="r-333853" data-claire-element-id="333853"><li id="r-333848" data-claire-element-id="333848"><p id="r-333847" data-claire-element-id="333847">l'accès à la position de l'utilisateur (jusque-là réservée aux applications natives) ;</p></li><li id="r-333850" data-claire-element-id="333850"><p id="r-333849" data-claire-element-id="333849">la présence d'un cache dans le navigateur, permettant à la fois d'utiliser des applications hors-ligne et de les démarrer plus rapidement ;</p></li><li id="r-333852" data-claire-element-id="333852"><p id="r-333851" data-claire-element-id="333851">canvas et WebGL pour des <a href="http://www.siteduzero.com/news-62-38456-p1-le-point-sur-les-futures-technologies-du-web-javascript-html5-et-css3.html">applications en 2D/3D toujours plus impressionnantes</a>.</p></li></ul><p id="r-333854" data-claire-element-id="333854">De plus en plus d'applications mobiles peuvent ainsi être développées directement en JavaScript, ce qui évite la lourdeur du développement des applications classiques : l'application fonctionne sur tous les smartphones, l'installation est aussi simple que la visite d'une page web, les mises à jour sont automatiques et la validation n'est plus nécessaire.</p><h2 id="r-compilateurs-source-a-source" data-claire-element-id="333930">Compilateurs source à source</h2><figure id="r-logo-js-of-ocaml" data-claire-element-id="333858"><img id="r-333856" data-claire-element-id="333856" src="medias/uploads.siteduzero.com_files_378001_379000_378409.png" alt="Logo js_of_ocaml"/><figcaption>Logo js_of_ocaml</figcaption></figure><p id="r-333859" data-claire-element-id="333859">De nombreux développeurs ne souhaitent pas attendre que la prochaine version de JavaScript soit disponible avant de commencer à l'utiliser. D'autres souhaitent un langage proche mais plus facile à écrire. D'autres encore peuvent considérer qu'un langage entièrement différent correspond mieux à leurs besoins ! Par exemple, si un zéro moyen souhaite écrire son application web en OCaml plutôt qu'en JavaScript, cela ne pose aucun problème : il suffit d'avoir un moyen de traduire le code OCaml en JavaScript ; par exemple <a href="http://ocsigen.org/js_of_ocaml/">js_of_ocaml</a>.</p><p id="r-333860" data-claire-element-id="333860">Le principe est le même que pour un compilateur classique : on transforme un programme écrit dans un langage dans un autre langage. Par exemple, gcc est capable de transformer du C en langage assembleur adapté à un processeur donné. js_of_ocaml fait la même chose ; mais traduit de l'OCaml en JavaScript. C'est pour cette raison qu'on appelle JavaScript <strong>l'assembleur du web</strong>.</p><figure id="r-logo-coffeescript" data-claire-element-id="333863"><img id="r-333861" data-claire-element-id="333861" src="medias/uploads.siteduzero.com_files_378001_379000_378410.png" alt="Logo CoffeeScript"/><figcaption>Logo CoffeeScript</figcaption></figure><p id="r-333864" data-claire-element-id="333864">Le compilateur source à source le plus utilisé est certainement CoffeeScript. Sa particularité est de rester proche du JavaScript en ajoutant différentes formes de sucre syntaxique rendant le programme source plus concis. Par exemple, il est possible en CoffeeScript d'écrire le code suivant :</p><pre id="r-333865" data-claire-element-id="333865"><code data-claire-semantic="javascript">arroseur = &quot;Jacques&quot;
arrose = &quot;Martin&quot;

[arroseur, arrose] = [arrose, arroseur]</code></pre><p id="r-333866" data-claire-element-id="333866">Ce code permet d'échanger les deux variables sans passer par une variable temporaire. Le compilateur CoffeeScript produit alors ce code JavaScript qui sera exécuté sur le navigateur :</p><pre id="r-333867" data-claire-element-id="333867"><code data-claire-semantic="javascript">var arroseur = &quot;Jacques&quot;;
var arrose = &quot;Martin&quot;;

var _ref;
_ref = [arroseur, arrose];
arrose = _ref[0]
arroseur = _ref[1];</code></pre><p id="r-333868" data-claire-element-id="333868">C'est bien plus verbeux et désagréable à lire et écrire. CoffeeScript dispose de nombreuses autres fonctionnalités permettant au programmeur de se simplifier la vie. Parmi ces fonctionnalités, citons :</p><ul id="r-333877" data-claire-element-id="333877"><li id="r-333870" data-claire-element-id="333870"><p id="r-333869" data-claire-element-id="333869"><a href="http://coffeescript.org/#conditionals">une syntaxe sans accolades</a> inspirée de Python,</p></li><li id="r-333872" data-claire-element-id="333872"><p id="r-333871" data-claire-element-id="333871"><a href="http://coffeescript.org/#loops">les listes définies par compréhension</a>, existant notamment en Python, Haskell ou Erlang,</p></li><li id="r-333874" data-claire-element-id="333874"><p id="r-333873" data-claire-element-id="333873"><a href="http://coffeescript.org/#literals">une notation courte pour les fonctions anonymes</a>, omniprésentes dans les langages fonctionnels mais existants aussi dans des langages tels que C#, PHP ou Scala,</p></li><li id="r-333876" data-claire-element-id="333876"><p id="r-333875" data-claire-element-id="333875">ou encore la possibilité d'utiliser un système de <a href="http://coffeescript.org/#classes">classes et d'héritage</a> plus classique.</p></li></ul><p id="r-333878" data-claire-element-id="333878">CoffeeScript apporte un bénéfice tangible au développement JavaScript et fait partie des langages qui <a href="http://brendaneich.com/2011/01/harmony-of-my-dreams/">inspirent le comité ECMAScript</a>. D'autres compilateurs vers JavaScript existent pour répondre à différents besoins.</p><p id="r-333879" data-claire-element-id="333879">Les <em>minifieurs</em> ont pour rôle de rendre un programme JavaScript le plus petit possible afin d'accélérer le transfert vers la navigateur. En minifiant et compressant jQuery, la taille du code passe de 247KB à 32KB : c'est un gain d'espace non négligeable ! Les <em>minifieurs</em> utilisent de <a href="https://github.com/mishoo/UglifyJS/#readme">nombreuses techniques</a> pour gagner de l'espace. Ce tableau résume quelques-unes des opérations réalisées par UglifyJS, l'outil utilisé par jQuery :</p><table id="r-333924" data-claire-element-id="333924"><thead id="r-333887" data-claire-element-id="333887"><tr id="r-333886" data-claire-element-id="333886"><th id="r-333881" data-claire-element-id="333881"><p id="r-333880" data-claire-element-id="333880">Description</p></th><th id="r-333883" data-claire-element-id="333883"><p id="r-333882" data-claire-element-id="333882">Avant</p></th><th id="r-333885" data-claire-element-id="333885"><p id="r-333884" data-claire-element-id="333884">Après</p></th></tr></thead><tbody id="r-333923" data-claire-element-id="333923"><tr id="r-333894" data-claire-element-id="333894"><td id="r-333889" data-claire-element-id="333889"><p id="r-333888" data-claire-element-id="333888">Suppression des espaces</p></td><td id="r-333891" data-claire-element-id="333891"><p id="r-333890" data-claire-element-id="333890"><code data-claire-semantic="javascript">var message = &quot;Bonjour !&quot;</code></p></td><td id="r-333893" data-claire-element-id="333893"><p id="r-333892" data-claire-element-id="333892"><code data-claire-semantic="javascript">var message=&quot;Bonjour !&quot;</code></p></td></tr><tr id="r-333901" data-claire-element-id="333901"><td id="r-333896" data-claire-element-id="333896"><p id="r-333895" data-claire-element-id="333895">Renommage</p></td><td id="r-333898" data-claire-element-id="333898"><p id="r-333897" data-claire-element-id="333897"><code data-claire-semantic="javascript">var message = &quot;Bonjour !&quot;</code></p></td><td id="r-333900" data-claire-element-id="333900"><p id="r-333899" data-claire-element-id="333899"><code data-claire-semantic="javascript">var a = &quot;Bonjour !&quot;</code></p></td></tr><tr id="r-333908" data-claire-element-id="333908"><td id="r-333903" data-claire-element-id="333903"><p id="r-333902" data-claire-element-id="333902">Conditions</p></td><td id="r-333905" data-claire-element-id="333905"><p id="r-333904" data-claire-element-id="333904"><code data-claire-semantic="javascript">if (foo) return a(); else return b();</code></p></td><td id="r-333907" data-claire-element-id="333907"><p id="r-333906" data-claire-element-id="333906"><code data-claire-semantic="javascript">return foo?a():b();</code></p></td></tr><tr id="r-333915" data-claire-element-id="333915"><td id="r-333910" data-claire-element-id="333910"><p id="r-333909" data-claire-element-id="333909">Indexation</p></td><td id="r-333912" data-claire-element-id="333912"><p id="r-333911" data-claire-element-id="333911"><code data-claire-semantic="javascript">foo[&quot;bar&quot;]</code></p></td><td id="r-333914" data-claire-element-id="333914"><p id="r-333913" data-claire-element-id="333913"><code data-claire-semantic="javascript">foo.bar</code></p></td></tr><tr id="r-333922" data-claire-element-id="333922"><td id="r-333917" data-claire-element-id="333917"><p id="r-333916" data-claire-element-id="333916">Code &quot;mort&quot;</p></td><td id="r-333919" data-claire-element-id="333919"><p id="r-333918" data-claire-element-id="333918"><code data-claire-semantic="javascript">var a = 1; if (a === 1) { ........ }</code></p></td><td id="r-333921" data-claire-element-id="333921"><p id="r-333920" data-claire-element-id="333920"><code data-claire-semantic="javascript">var a = 1;</code></p></td></tr></tbody></table><figure id="r-logo-dart" data-claire-element-id="333927"><img id="r-333925" data-claire-element-id="333925" src="medias/uploads.siteduzero.com_files_378001_379000_378411.png" alt="Logo Dart"/><figcaption>Logo Dart</figcaption></figure><p id="r-333928" data-claire-element-id="333928">En octobre 2011, un autre langage a beaucoup fait parler de lui : Google Dart. Il est possible de le compiler vers JavaScript, mais l'objectif annoncé est de remplacer JavaScript entièrement. Dart a été influencé par Java, un langage largement répandu et pour lequel les approches possibles pour créer de <a href="http://en.wikipedia.org/wiki/Programming_in_the_large_and_programming_in_the_small">larges</a> applications sont bien comprises. Google Chrome devrait être le premier navigateur à supporter Google Dart nativement, au même rang que JavaScript. Parmi les <a href="http://progmod.org/forum/sujet/237/dart/">différents reproches</a> faits à Dart, notons le <a href="http://conway.rutgers.edu/~ccshan/wiki/blog/posts/Unsoundness/">système de types non sûr</a> et la <a href="https://news.ycombinator.com/item?id=2982949">balkanisation du web</a>. En effet, le risque de voir fleurir les sites web &quot;optimisés pour Dart&quot; et &quot;optimisés pour Webkit&quot; est important, ce qui est un danger pour le <a href="http://tantek.com/2010/281/b1/what-is-the-open-web">web ouvert</a>.</p><p id="r-333929" data-claire-element-id="333929">CoffeeScript, UglifyJS et Dart ne sont que trois exemples de compilation vers JavaScript. Le nombre de <a href="https://github.com/jashkenas/coffee-script/wiki/List-of-languages-that-compile-to-JS">compilateurs capables de produire du JavaScript</a> est bien plus important, et il y a de fortes chances pour que votre langage favori soit dans la liste.</p><h2 id="r-modules-javascript" data-claire-element-id="333941">Modules JavaScript</h2><p id="r-333931" data-claire-element-id="333931">Malgré l'existence de nombreuses bibliothèques écrites en JavaScript, il n'y a pas de moyen <strong>standard</strong> de les écrire. Premièrement, il est difficile de cacher dans une bibliothèque les fonctions internes, que l'utilisateur ne doit pas manipuler. Ensuite, la gestion des dépendances se fait de manière totalement <em>ad hoc</em> : on inclut dans l'ordre les bibliothèques nécessaires nous-mêmes, au lieu de dire pour chaque bibliothèque quelles sont les dépendances, ce qui permettrait au moteur JavaScript de gérer le chargement lui-même.</p><p id="r-333932" data-claire-element-id="333932">Pour rendre notre propos plus concret, admettons qu'on veuille écrire un module JavaScript de correction orthographique. C'est une tâche potentiellement complexe nécessitant de découper notre code en de nombreuses fonctions, mais au final l'utilisateur ne va se servir que d'une seule fonction : <code data-claire-semantic="javascript">liste_erreurs()</code>, qui va retourner la liste des erreurs potentielles. Voyons un exemple d'utilisation d'une telle bibliothèque :</p><pre id="r-333933" data-claire-element-id="333933"><code data-claire-semantic="html">&lt;script type=&quot;text/javascript&quot; src=&quot;correction.js&quot;&gt;&lt;/script&gt;

...

&lt;script&gt;
function surligner_erreurs(texte) {
    var erreurs = Correction.liste_erreurs(texte);
    for (var i in erreurs) {
        surligner(erreurs[i].debut, erreur[i].fin, erreurs[i].alternatives);
    }
}
&lt;/script&gt;</code></pre><p id="r-333934" data-claire-element-id="333934">On récupère ainsi la liste des erreurs potentielles, et la fonction <code>surligner()</code> (définie dans un autre module) s'occupe de surligner le texte contenant les erreurs et d'ajouter un évènement qui se déclenchera lorsque l'utilisateur cliquera sur le texte surligné. L'utilisateur n'aura plus alors qu'à choisir la version correcte. Pour proposer une telle interface, la solution la plus simple est de placer dans <code>correction.js</code> un objet JavaScript :</p><pre id="r-333935" data-claire-element-id="333935"><code data-claire-semantic="javascript">var Correction = {
    dictionnaire: undefined,

    // nécessaire de placer ces fonctions auxiliaires dans l'objet pour
    // ne pas polluer l'espace global
    init_dict: function(...) { ... },
    tokenize: function(...) { ... },
    contexte: function(...) { ... },
    erreurs_mot: function(...) { ... },

    liste_erreurs: function (texte) {
        var mots = tokenize(texte),
          erreurs = new Array();

        for(var mot in mots) {
            var contexte = contexte(mot, texte);
            if(this.erreur(mot, contexte)) {
                erreurs.push(erreurs_mot(mot, contexte));
            }
         }

         return erreurs;
     }
}

Correction.dictionnaire = Correction.init_dict();</code></pre><p id="r-333936" data-claire-element-id="333936">Le problème qui se pose ici est que n'importe quel code est capable de modifier le dictionnaire ou d’appeler des fonctions internes de <code>Correction</code>. D'un point de vue conception, c'est problématique : toutes les variables et fonctions sont publiques. On est obligé de placer nos fonctions comme membres de l'objet, ce qui n'est pas agréable et moins pratique pour débugger.</p><p id="r-333937" data-claire-element-id="333937">L'idée est donc de <em>cacher</em><code>dictionnaire</code>, mais d'exposer les fonctions le manipulant. Comment cacher une variable ? En JavaScript, la portée des variables est la fonction. Encapsuler notre code dans une fonction nous permettra de n'exposer que les fonctions qui nous intéressent :</p><pre id="r-333938" data-claire-element-id="333938"><code data-claire-semantic="javascript">var Correction = (function() {
   var dictionnaire;

   function init_dict(...) { ... },
   function tokenize(...) { ... },
   function contexte(...) { ... },
   function erreurs_mot(...) { ... },
   function liste_erreurs(...) { ... },

   dictionnaire = init_dict();

   return {
       liste_erreurs: liste_erreurs
   };
)();</code></pre><p id="r-333939" data-claire-element-id="333939">Intéressons-nous ici d'abord à la déclaration de Correction (<code data-claire-semantic="javascript">var Correction = (function() { ... })();</code>. Pourquoi autant de parenthèses ? Il s'agit en fait ici de déclarer une fonction, de l’appeler <strong>immédiatement après sa déclaration</strong>, puis de stocker l'objet reçu dans <code>Correction</code>. Notre variable <code>Correction</code> contient désormais <code>liste_erreurs</code> qu'il est possible d’appeler depuis l'extérieur. Grâce au concept de closure, <code>liste_erreurs</code> peut manipuler le dictionnaire, et c'est le seul moyen de le manipuler ! Nous venons ici de faire quelque chose de très intéressant : on n'expose à l'utilisateur que l'interface qu'il doit utiliser, et le reste est caché.</p><p id="r-333940" data-claire-element-id="333940">Des variantes de cette approche sont utilisées par de nombreuses bibliothèques, dont jQuery (cf. le <a href="../../code.jquery.com/jquery-1.7.2.js">code</a>) qui commence avant tout par déclarer une fonction puis déclare à la fin du code que <code data-claire-semantic="javascript">window.jQuery = window.$ = jQuery;</code>, ce qui permet d'ajouter <code>jQuery</code> et <code>$</code> aux variables utilisables partout dans la page web.</p><h2 id="r-requirejs" data-claire-element-id="333951">RequireJs</h2><figure id="r-logo-require-js" data-claire-element-id="333944"><img id="r-333942" data-claire-element-id="333942" src="medias/uploads.siteduzero.com_files_378001_379000_378412.png" alt="Logo Require.js"/><figcaption>Logo Require.js</figcaption></figure><p id="r-333945" data-claire-element-id="333945">Comment déclarer les dépendances entre les différentes bibliothèques qu'on est amenés à utiliser dans le navigateur ? Il est naturellement possible d'inclure les fichiers les uns à la suite des autres, mais c'est une méthode primitive pour laquelle il est facile de se tromper. Un projet nommé <a href="http://requirejs.org/">RequireJS</a> nous propose de spécifier les dépendances entre les différentes bibliothèques que nous utilisons, pour les charger dynamiquement ou créer un fichier JavaScript compact contenant uniquement le code nécessaire pour un site web donné.</p><p id="r-333946" data-claire-element-id="333946">Pour demander le chargement d'un fichier puis d'exécuter du code, il suffit d'utiliser <code>require()</code>. Ainsi, <code data-claire-semantic="javascript">require([&quot;correction.js&quot;], liste_erreurs);</code> se chargera d’appeler la fonction <code>liste_erreurs</code> une fois le chargement de correction effectuée.</p><p id="r-333947" data-claire-element-id="333947">Pour définir un module et ses dépendances, c'est tout aussi simple : il suffit d'utiliser <code>define</code>. Supposons que nous avons séparé la correction et la tokenization (qui est utilisée ailleurs). On peut demander le chargement de la tokenization de cette manière :</p><pre id="r-333948" data-claire-element-id="333948"><code data-claire-semantic="javascript">define([&quot;./tokenize&quot;], function() {
    ...

    return {
       liste_erreurs: liste_erreurs
    };
});</code></pre><p id="r-333949" data-claire-element-id="333949">RequireJS permet avant tout de faciliter le développement en permettant au développeur de découper ses fichiers et de déclarer ses dépendances comme il le souhaite. Il devient donc facile d'inclure des bibliothèques et leurs dépendances via un simple appel à <code>require()</code>, ce qui facilite le développement. Une fois que le site passe en production, il suffit de demander à RequireJS d'optimiser le code utilisé : regrouper les modules utilisés, et <em>minifier</em> le tout. Le développement web devient alors plus facile !</p><p id="r-333950" data-claire-element-id="333950">Un autre intérêt est qu'un code proprement séparé en modules offre de nouvelles opportunités d'optimisation. Au lieu d'envoyer tout le code JavaScript d'un coup, il devient possible d'identifier les modules nécessaires dès le chargement et ceux qui <a href="http://37signals.com/svn/posts/3137-using-event-capturing-to-improve-basecamp-page-load-times">peuvent au contraire attendre plus longtemps</a>. C'est exactement ce qu'a décidé de faire Twitter en mai 2012, et cela a aidé à <a href="http://engineering.twitter.com/2012/05/improving-performance-on-twittercom.html">réduire le temps d'affichage du premier tweet par cinq</a>, ce qui n'aurait pas été possible sans un découpage propre en modules.</p><h2 id="r-pourquoi-se-limiter-au-navigateur" data-claire-element-id="333973">Pourquoi se limiter au navigateur ?</h2><p id="r-333952" data-claire-element-id="333952">Jusqu'ici, nous nous sommes intéressés à l'utilisation de JavaScript exclusivement dans le navigateur, ce qui est le rôle classique du langage. En effet, on utilise plutôt dans le <a href="http://www.siteduzero.com/tutoriel-3-197288-introduction-a-php.html#ss_part_2">serveur</a> des langages tels que Python, Ruby ou encore PHP. C'est notamment le modèle qu'a adopté le Site du Zéro, en écrivant le serveur en PHP avec Symfony 2. C'est parfaitement raisonnable pour la plupart des applications, mais il s'avère que pour des applications très gourmandes en JavaScript, cela oblige souvent à écrire le même code deux fois : une fois en PHP et une autre fois en JavaScript.</p><p id="r-333953" data-claire-element-id="333953">Par exemple, pour un formulaire, on peut vouloir le valider en JavaScript avant de permettre l'envoi, ce qui laisse à l'utilisateur l'opportunité de corriger ses erreurs au plus tôt. Un autre exemple est celui d'un panier web : le calcul du prix est souvent fait en JavaScript (pour une actualisation instantanée du prix) mais aussi sur le serveur lors de la validation finale. D'une manière générale, plus il y a de données à afficher et modifier dans une page web, plus le code sera <strong>dupliqué sur le navigateur et le serveur</strong> : une fois pour rendre la visite plus rapide et agréable, et l'autre fois pour traiter les données réelles et les sauver pour plus tard.</p><p id="r-333954" data-claire-element-id="333954">Une solution pour éviter ce problème est d'écrire tout dans un langage donné, puis de convertir en JavaScript les parties qui vont s'exécuter sur le serveur web. C'est la solution adoptée par <a href="http://opalang.org/">OPA</a> et <a href="http://ocsigen.org/">Ocsigen</a>, pour ne citer qu'eux.</p><figure id="r-logo-node-js" data-claire-element-id="333957"><img id="r-333955" data-claire-element-id="333955" src="medias/uploads.siteduzero.com_files_378001_379000_378413.png" alt="Logo Node.js"/><figcaption>Logo Node.js</figcaption></figure><p id="r-333958" data-claire-element-id="333958">Une autre solution qui semble avoir plus de popularité est d'utiliser JavaScript sur le serveur web ! Il n'y pas alors à se demander comment est-ce que notre JavaScript va être généré. <a href="http://nodejs.org/">Node.js</a> utilise cette approche, et permet aux développeurs de spécifier le comportement du serveur directement en JavaScript, en tirant avantage de la facilité de déclarer des fonctions pour encourager un style de programmation à base de callbacks, ce qui évite d'être handicapé par les entrées/sorties bloquantes. Pour créer un serveur, il suffit d'écrire le code suivant :</p><pre id="r-333959" data-claire-element-id="333959"><code data-claire-semantic="javascript">var http = require('http');

http.createServer(function(request, response) {
  response.writeHead(200, {&quot;Content-Type&quot;: &quot;text/plain&quot;});
  response.write(&quot;Hello World&quot;);
  response.end();
}).listen(8888);</code></pre><p id="r-333960" data-claire-element-id="333960">On passe ici à <code>http.createServer</code> une fonction qui sera appelée pour chaque requête. Node.js réutilise le concept de la programmation évènementielle : une boucle se charge de lancer les fonctions prêtes à être exécutées, c'est-à-dire n'attendant plus la fin d'une entrée/sortie telle que la lecture d'un fichier ou une requête vers une base de données. Typiquement, le code ci-dessus ne fait rien tant que personne n'accède au serveur, et exécute notre fonction une fois que quelqu'un y accède avec son navigateur.</p><p id="r-333961" data-claire-element-id="333961">Jusque-là, la seule différence avec le fonctionnement d'un serveur classique est l'utilisation de JavaScript. La vraie différence se fait sentir au moment de faire des entrées/sorties pendant le traitement d'une requête. C'est très fréquent : il faut bien accéder à une base de donnée quelconque pour savoir quelles informations afficher.</p><pre id="r-333962" data-claire-element-id="333962"><code data-claire-semantic="javascript">var mysql = require(&quot;db-mysql&quot;);

new mysql.Database().connect(function() {
    this.query().select([&quot;auteur&quot;, &quot;texte&quot;]).from(&quot;billets&quot;).limit(10)
        .execute(function(error, billets) {
            http.write(&quot;Affichage de &quot; + length(billets) + &quot; billets&quot;);
            // Boucle d'affichage
        });
});</code></pre><p id="r-333963" data-claire-element-id="333963">Dans ce code, on commence par se connecter à une base de données, puis on déclare une requête SQL. Pour schématiser, l'appel à <code>execute()</code> se fait en trois temps :</p><ol id="r-333970" data-claire-element-id="333970"><li id="r-333965" data-claire-element-id="333965"><p id="r-333964" data-claire-element-id="333964">exécution de la requête SQL,</p></li><li id="r-333967" data-claire-element-id="333967"><p id="r-333966" data-claire-element-id="333966">attente de la réponse,</p></li><li id="r-333969" data-claire-element-id="333969"><p id="r-333968" data-claire-element-id="333968">et traitement du résultat (pour affichage, par exemple).</p></li></ol><p id="r-333971" data-claire-element-id="333971">Node.js s'assure que le serveur ne chôme pas pendant la phase d'attente. Une fois que la requête est terminée, la boucle d'évènements s'assurera que la fonction passée à <code>execute</code> soit exécutée. C'est pour cette raison qu'on l'appelle <em>callback</em> (rappel) : elle est appelée une fois qu'on a besoin d'elle.</p><p id="r-333972" data-claire-element-id="333972">Alors que les entrées/sorties sont le problème numéro un des sites voulant passer à l'échelle, Node.js propose donc une alternative permettant de limiter ce problème. Bien sûr, ce n'est qu'un compromis, et d'autres problèmes spécifiques à Node.js se posent : par exemple, l'utilisation de nombreux callbacks imbriqués rend le code <a href="http://technosophos.com/content/javascript-nodejs-and-flying-wedge-anti-pattern">plus difficile à lire</a>. Des modules Node.js existent pour pallier ce problème, tels que <a href="https://github.com/kriszyp/node-promise#readme">node-promise</a> où il suffit de spécifier les dépendances entre les fonctions, la bibliothèque se chargeant du reste.</p><h2 id="r-le-retour-des-modules" data-claire-element-id="333982">Le retour des modules</h2><p id="r-333974" data-claire-element-id="333974">Nous venons de citer un module Node.js, et il existe en réalité des milliers. Le problème qui se posait dans le navigateur existe aussi sur le serveur, et Node.js a choisi de suivre une convention permettant aux modules de déclarer leurs noms et leurs dépendances. Concrètement, ceci se fait grâce au fichier packages.json présent dans tout module Node.js. Par exemple, voilà comment nous pourrions déclarer notre module de correction orthographique :</p><pre id="r-333975" data-claire-element-id="333975"><code data-claire-semantic="javascript">{
  &quot;name&quot;: &quot;correction&quot;,
  &quot;description&quot;: &quot;Liste les alternatives possibles des mots mal orthographiés d'un texte&quot;,
  &quot;version&quot;: &quot;0.1alpha1&quot;,
  &quot;author&quot;: &quot;Robert Larousse&quot;,
  &quot;dependencies&quot;: {
    &quot;tokenize&quot;: &quot;0.3&quot;,
    &quot;debug&quot;: &quot;*&quot;
  },
}</code></pre><p id="r-333976" data-claire-element-id="333976">Ainsi, avant d'installer ce module, Node.js devra s'assurer d'avoir installé la version 0.3 de <code>tokenize</code> et une version quelconque de <code>debug</code>. Grâce à cette convention, une plateforme comme Node.js jouit d'un <a href="http://toolbox.no.de/">large écosystème de modules</a> permettant à chaque développeur de ne pas avoir à réinventer la roue à chaque projet.</p><figure id="r-logo-commonjs" data-claire-element-id="333979"><img id="r-333977" data-claire-element-id="333977" src="medias/uploads.siteduzero.com_files_378001_379000_378414.png" alt="Logo CommonJS"/><figcaption>Logo CommonJS</figcaption></figure><p id="r-333980" data-claire-element-id="333980">Néanmoins, il existe d'autres plateformes exécutant du JavaScript : cela peut aller de la base de données CouchDB (où les « requêtes » sont écrites en JavaScript) aux applications utilisant JavaScript comme un langage de script. C'est le cas par exemple du jeu de stratégie <a href="http://www.wildfiregames.com/0ad/">0 A.D.</a> qui utilise JavaScript pour <a href="http://trac.wildfiregames.com/wiki/EngineDocumentation">l'intelligence artificielle des unités</a>. Est-il possible d'utiliser des modules Node.js sur ces plateformes ?</p><p id="r-333981" data-claire-element-id="333981">À la manière de RequireJS dans le navigateur, la solution se nomme ici CommonJS. CommonJS a pour but de spécifier différentes conventions que peuvent suivre les bibliothèques écrites en JavaScript afin de coopérer entre elles. La spécification CommonJS la plus importante se nomme <code>Modules</code>, et spécifie comment un module JavaScript peut expliciter son nom, sa version, et les dépendances nécessaires. Les dépendances sont ensuite chargées automatiquement avec la fonction <code>require()</code>. C'est exactement ce qu'il faut faire avec Node.js, et pour cause : Node.js implémente la spécification Modules, ce qui permet à de nombreux modules d'être réutilisés par ailleurs.</p><h2 id="r-un-langage-moderne" data-claire-element-id="333991">Un langage moderne</h2><p id="r-333983" data-claire-element-id="333983">Nous l'avons vu : le langage JavaScript rend très difficile l'utilisation de certains concepts aussi simples que les modules, longtemps acquis dans d'autres langages. On pourrait penser que le langage n'a eu du succès que parce que c'était la seule solution dans le navigateur, mais ce serait oublier que c'est un langage qui reste moderne en offrant des fonctionnalités permettant d'écrire du code expressif et puissant et qui ne se trouvent pas nécessairement dans d'autres langages.</p><p id="r-333984" data-claire-element-id="333984">Les fonctions, tableaux ou encore les expressions régulières sont tous des objets qu'il est possible de manipuler, passer en paramètre et de retourner à la fin d'une fonction. Cela permet à JavaScript d'utiliser le paradigme fonctionnel quand c'est le plus adapté.</p><p id="r-333985" data-claire-element-id="333985">On compte aussi parmi les fonctionnalités le tout aussi controversé que puissant &quot;prototype&quot;. C'est en effet une fonctionnalité relativement peu utilisée par les développeurs permettant entre autres d'obtenir de l'héritage. Intéressons-nous ici plutôt à l'ajout de fonctionnalité à des objets existants. Par exemple, si vous désirez tester l'égalité de deux <code data-claire-semantic="javascript">Array</code>, il n'y a pas de moyen simple de faire ça. C'est donc l'opportunité de déclarer une telle fonction :</p><pre id="r-333986" data-claire-element-id="333986"><code data-claire-semantic="javascript">Array.prototype.equals = function (otherArray) {
    if (!Array.isArray(otherArray)) {
        return false;
    }

    return this.every(function(element, i) {
        if (Array.isArray(element)) {
            return element.equals(otherArray[i]);
        } else {
            return element === otherArray[i];
        }
    });
};</code></pre><p id="r-333987" data-claire-element-id="333987">Désormais, <code data-claire-semantic="javascript">[1, 2, 3].equals([1, 2, 4])</code> renvoie faux. Cette astuce est utilisée pour s'assurer que les fonctions ajoutées dans ECMAScript 5 seront disponibles dans tous les navigateurs : si elles n'existent pas, il suffit de les créer. On appelle ceci la &quot;feature detection&quot;. Elle permet aux développeurs d'écrire du JavaScript moderne qui sera exécuté rapidement dans les navigateurs récents, mais qui fonctionnera tout de même dans les navigateurs les plus vieux. C'est ainsi que <a href="https://github.com/kriskowal/es5-shim">es5-shim</a> émule de nombreuses fonctions ajoutées dans ECMAScript 5 et que <a href="http://modernizr.com/">Modernizr</a> apporte des fonctionnalités ajoutées récemment dans HTML5 et CSS3. À chaque fois, les navigateurs récents utilisent une implémentation efficace, et les autres exécuteront une émulation de ces fonctionnalités : moins rapide, mais fonctionnelle. L'adoption des technologies récentes n'est donc pas freinée par les vieux navigateurs.</p><p id="r-333988" data-claire-element-id="333988">Une autre force de JavaScript se situe dans les <em>closures</em>, ou fermetures en français. En pratique, ce sont simplement des fonctions qui sont déclarées dans le corps d'une autre fonction, et qui accèdent aux membres de la fonction parente. C'est un concept à la fois simple et puissant qui permet par exemple de <a href="http://javascript.crockford.com/private.html">simuler les membres privés</a> en JavaScript, comme nous l'avons vu plus haut dans notre module <code>Correction</code>. Une des possibilités offertes par les closures est l'amélioration des performances en ne calculant qu'une fois certaines expressions. C'est avantageux pour les accès au DOM qui peuvent être long suivant le navigateur. Voyez ce code :</p><pre id="r-333989" data-claire-element-id="333989"><code data-claire-semantic="javascript">//exemple sans closure
var addDescription = function(texteDescription){
    var baliseDescription = document.getElementById('description'); //appel au DOM
    var child = document.createElement('p');
    child.innerHTML = texteDescription;
    baliseDescription.appendChild(child);
}
addDescription('première description'); //un appel au DOM
addDescription('deuxième description'); //deuxième appel au DOM ...

//avec closure
var addDescription = (function(){
    var baliseDescription = document.getElementById('description'); //appel au DOM
    return function(texteDescription){
       var child = document.createElement('p');
       child.innerHTML = texteDescription;
       baliseDescription.appendChild(child);
    }
})();//premier appel au DOM

addDescription('première description'); //pas d'appel au DOM
addDescription('deuxième description'); //pas d'appel au DOM ...</code></pre><p id="r-333990" data-claire-element-id="333990">Pour vous assurer du gain de performance entre différentes solutions que vous avez codé, vous pouvez vous rendre sur le site JSPerf. <a href="http://jsperf.com/sdz-closure-exemple">Un petit test pour l'exemple ci-dessus</a> permet par exemple de comparer les performances des deux versions suivant les navigateurs.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne">Le JavaScript moderne</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne/l-histoire-mouvementee-de-javascript">
L&#039;histoire mouvementée de JavaScript
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne/l-assembleur-du-web">
L&#039;assembleur du web
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne/ecmascript-harmony">
ECMAScript Harmony
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne/l-histoire-mouvementee-de-javascript">
<span class="arrow"></span>
<span class="next">L&#039;histoire mouvementée de JavaScript</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne/ecmascript-harmony">
<span class="next">ECMAScript Harmony</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="ECMAScriptHarmony"></a><h2>ECMAScript Harmony</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne/l-assembleur-du-web">
<span class="arrow"></span>
<span class="next">L&#039;assembleur du web</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-333993" data-claire-element-id="333993">Comme nous le disions dans l'historique, le comité TC39 responsable de l'évolution d'ECMAScript travaille actuellement sur la prochaine version : ECMAScript Harmony. Afin d'éviter les déboires de la version 4 qui n'a jamais abouti et de prendre en compte les différents usages de JavaScript, des objectifs précis ont étés <a href="http://wiki.ecmascript.org/doku.php?id=harmony:harmony">définis</a>. L'objectif numéro un est de concevoir un langage plus adapté pour :</p><ul id="r-334000" data-claire-element-id="334000"><li id="r-333995" data-claire-element-id="333995"><p id="r-333994" data-claire-element-id="333994">les applications complexes,</p></li><li id="r-333997" data-claire-element-id="333997"><p id="r-333996" data-claire-element-id="333996">les bibliothèques utilisées par ces applications,</p></li><li id="r-333999" data-claire-element-id="333999"><p id="r-333998" data-claire-element-id="333998">et les compilateurs vers JavaScript.</p></li></ul><p id="r-334001" data-claire-element-id="334001">Il ne s'agit donc pas de créer un langage qui soit « théoriquement mieux », mais bien de répondre à des problèmes <strong>concrets</strong>. Le deuxième objectif est de produire une spécification qui puisse être implémentée en JavaScript : cela permettra de :</p><ul id="r-334008" data-claire-element-id="334008"><li id="r-334003" data-claire-element-id="334003"><p id="r-334002" data-claire-element-id="334002">utiliser et de tester ECMAScript 6 avant qu'il soit prêt dans nos navigateurs,</p></li><li id="r-334005" data-claire-element-id="334005"><p id="r-334004" data-claire-element-id="334004">d'avoir à disposition une implémentation de référence,</p></li><li id="r-334007" data-claire-element-id="334007"><p id="r-334006" data-claire-element-id="334006">et potentiellement d'utiliser cet interpréteur sur les navigateurs les plus réticents, à la manière d'<a href="https://github.com/kriskowal/es5-shim">es5-shim</a> pour ECMAScript 5.</p></li></ul><p id="r-334009" data-claire-element-id="334009">Parmi les objectifs restants, un troisième objectif est d'intégrer directement dans le langage les patrons de conception les plus <a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/">répandus en JavaScript</a> pour les intégrer dans le langage. Paul Graham de YCombinator se demande dans un de <a href="http://www.paulgraham.com/icad.html">ses essais</a> si les patrons de conceptions ne sont pas l’œuvre d'un &quot;compilateur humain&quot;. Si c'est le cas, c'est certainement une indication d'un manque dans le langage qui ne demande qu'à être comblé. En JavaScript, le manque le plus évident en concerne les modules.</p><h2 id="r-modules" data-claire-element-id="334013">Modules</h2><p id="r-334010" data-claire-element-id="334010">Comme nous l'avons vu précédemment, les &quot;modules&quot; ont étés développés sans l'aide réelle du langage, mais seulement avec des closures (IIFE) et des conventions (CommonJS). ECMAScript Harmony souhaite reprendre ces excellentes idées en les intégrant dans le langage pour imposer ces standards établis, et les rendre plus facile à utiliser. On peut ainsi voir les modules en ECMAScript Harmony comme du sucre syntaxique : on pourrait faire sans, mais ils sont désormais bien plus faciles à écrire. Par conséquent, la bibliothèque décrite plus haut peut se réécrire plus simplement :</p><pre id="r-334011" data-claire-element-id="334011"><code data-claire-semantic="javascript">import &quot;tokenize.js&quot;;

module Correction {
  var dictionnaire = init_dict();

  function init_dict(...) { ... }
  ...

  export function liste_erreurs() { ... }
}</code></pre><p id="r-334012" data-claire-element-id="334012">Il sera désormais bien plus simple d'écrire des modules sans erreur, en spécifiant facilement les méthodes et variables qu'on veut rendre disponibles à tout le monde et les dépendances nécessaires, à la façon de CommonJS et RequireJS. Mieux, cette nouvelle syntaxe permet d'expliciter qu'on est bien en train d'écrire un module destiné à être utilisé ailleurs, ce qui améliore la lisibilité du code. Un langage comme CoffeeScript pourrait aisément implémenter une telle syntaxe, étant donné qu'elle est de toute façon destinée à être employée dans le futur.</p><h2 id="r-templates" data-claire-element-id="334062">Templates</h2><p id="r-334014" data-claire-element-id="334014">Dès lors qu'on fait un appel AJAX en JavaScript, il est nécessaire de présenter à l'utilisateur les données reçues. Ces données sont souvent sous la forme de JSON, et il faut donc les transformer en HTML avant affichage. C'est une tâche très classique en développement web et il existe des dizaines de <a href="http://en.wikipedia.org/wiki/Template_engine_(web)">moteurs de template</a> sur le web. Sur le Site du Zéro, karamilo a même développé les <a href="http://www.siteduzero.com/savoirplus.html#technologies">KaraTemplates</a> qui ont été utilisés pour faciliter l'écriture de contenu sur le site. PHP lui-même a une syntaxe pour écrire des templates facilement : par exemple, <code data-claire-semantic="html+php">&lt;?= $score ?&gt;</code> est équivalent à <code data-claire-semantic="html+php">&lt;?php echo $score; ?&gt;</code>.</p><p id="r-334015" data-claire-element-id="334015">En JavaScript, la situation est toute autre, et il n'y a pas actuellement de solution simple et standard pour écrire des templates. Prenons l'exemple de jQuery : les <a href="http://api.jquery.com/tmpl/">jQuery templates</a> ont été dépréciées et ne sont plus maintenues, et la solution du futur, <a href="https://github.com/BorisMoore/jsrender">JsRender</a> n'est même pas encore en beta. D'autres solutions populaires tels que <a href="http://mustache.github.com/">Mustache</a> ne proposent pas de protection et ne garantissent pas que le HTML rendu sera bien formé. Cela témoigne à la fois de la difficulté de l'écriture d'une telle solution en JavaScript pur et du besoin de tels templates. C'était l'occasion pour le comité de proposer une solution pour écrire des templates qui soit facile à utiliser, sécurisée et performante : les <a href="http://wiki.ecmascript.org/doku.php?id=harmony:quasis">quasi-literals</a>. Voici un exemple :</p><pre id="r-334016" data-claire-element-id="334016"><code data-claire-semantic="javascript">url = &quot;http://example.com/&quot;,
message = query = &quot;Hello &amp; Goodbye&quot;,
color = &quot;red&quot;,
safehtml`&lt;a href=&quot;${url}?q=${query}&quot; onclick=alert(${message})&gt;${message}&lt;/a&gt;`</code></pre><p id="r-334017" data-claire-element-id="334017">(Vous remarquerez que la coloration syntaxique n'est pas encore adaptée à ECMAScript Harmony)</p><p id="r-334018" data-claire-element-id="334018">Cette syntaxe n'est en faite que du <a href="http://fr.wikipedia.org/wiki/Sucre_syntaxique">sucre syntaxique</a>. Plus précisément, le code écrit plus haut est strictement équivalent au charabia suivant :</p><pre id="r-334019" data-claire-element-id="334019"><code data-claire-semantic="javascript">var $$callSite0 = Object.freeze({
    raw: Object.freeze([&quot;&lt;a href=\&quot;&quot;,&quot;?q=&quot;,&quot;\&quot; onclick=alert(&quot;,&quot;)&gt;&quot;,&quot;&lt;/a&gt;&quot;]),
    cooked: Object.freeze([&quot;&lt;a href=\&quot;&quot;,&quot;?q=&quot;,&quot;\&quot; onclick=alert(&quot;,&quot;)&gt;&quot;,&quot;&lt;/a&gt;&quot;])
  });
url = &quot;http://example.com/&quot;,
message = query = &quot;Hello &amp; Goodbye&quot;,
color = &quot;red&quot;,
safehtml($$callSite0, (url), (query), (message), (color), (message))</code></pre><p id="r-334020" data-claire-element-id="334020">La méthode safehtml sera intégrée à JavaScript, et lors de son appel, elle produit simplement le résultat HTML suivant :</p><pre id="r-334021" data-claire-element-id="334021"><code data-claire-semantic="html">&lt;a href=&quot;http://example.com/?q=Hello%20%26%20Goodbye&quot;
   onclick=alert(&amp;#39;Hello&amp;#32;\x26&amp;#32;Goodbye&amp;#39;)
   style=&quot;color: red&quot;&gt;
Hello &amp;amp; Goodbye
&lt;/a&gt;</code></pre><p id="r-334022" data-claire-element-id="334022">Les sauts à la ligne ont étés insérés manuellement, mais l'idée est là : <code data-claire-semantic="javascript">safehtml</code> vous permet de produire du HTML sécurisé en toute confiance étant donné que la fonction prend en compte le contexte et sait quels caractères il faut transformer. On évite non seulement le HTML mal formaté qui peut &quot;casser&quot; l'affichage d'un site web mais aussi des surprises telles que les <a href="http://en.wikipedia.org/wiki/Cross-site_scripting">failles XSS</a> qui sont une plaie réelle pour de nombreux sites web, y compris le Site du Zéro qui en a corrigé plusieurs au fil des années et des petits rigolos. Il est naturellement possible de définir sa propre fonction qui pourra avoir d'autres intérêts : par exemple l'internationalisation, en choisissant le texte à afficher suivant la langue de l'utilisateur.</p><p id="r-334023" data-claire-element-id="334023">Plus généralement, c'est aussi un très bon moyen d'écrire un <a href="http://en.wikipedia.org/wiki/Domain-specific_language">Domain-Specific Language (DSL)</a>. Voyons quelques exemples simples :</p><table id="r-334051" data-claire-element-id="334051"><thead id="r-334029" data-claire-element-id="334029"><tr id="r-334028" data-claire-element-id="334028"><th id="r-334025" data-claire-element-id="334025"><p id="r-334024" data-claire-element-id="334024">Domaine</p></th><th id="r-334027" data-claire-element-id="334027"><p id="r-334026" data-claire-element-id="334026">Code</p></th></tr></thead><tbody id="r-334050" data-claire-element-id="334050"><tr id="r-334034" data-claire-element-id="334034"><td id="r-334031" data-claire-element-id="334031"><p id="r-334030" data-claire-element-id="334030">appel jQuery</p></td><td id="r-334033" data-claire-element-id="334033"><p id="r-334032" data-claire-element-id="334032"><code>$`a.${className}[href=~'//${domain}/']`</code></p></td></tr><tr id="r-334039" data-claire-element-id="334039"><td id="r-334036" data-claire-element-id="334036"><p id="r-334035" data-claire-element-id="334035">Requête HTTP</p></td><td id="r-334038" data-claire-element-id="334038"><p id="r-334037" data-claire-element-id="334037"><code>GET`http://example.org/service?a=${a}&amp;b=${b}`</code></p></td></tr><tr id="r-334044" data-claire-element-id="334044"><td id="r-334041" data-claire-element-id="334041"><p id="r-334040" data-claire-element-id="334040">Expression rationnelle</p></td><td id="r-334043" data-claire-element-id="334043"><p id="r-334042" data-claire-element-id="334042"><code>re`\d+(${localeSpecificDecimalPoint}\d+)?`</code></p></td></tr><tr id="r-334049" data-claire-element-id="334049"><td id="r-334046" data-claire-element-id="334046"><p id="r-334045" data-claire-element-id="334045">Chaîne brute</p></td><td id="r-334048" data-claire-element-id="334048"><p id="r-334047" data-claire-element-id="334047"><code>raw`In JavaScript ' ' is a line-feed.`</code></p></td></tr></tbody></table><p id="r-334052" data-claire-element-id="334052">Les templates sont donc un bon exemple des objectifs que s'est fixé ECMAScript Harmony. Cette nouvelle fonctionnalité :</p><ul id="r-334061" data-claire-element-id="334061"><li id="r-334054" data-claire-element-id="334054"><p id="r-334053" data-claire-element-id="334053">correspond à un problème récurrent en JavaScript ;</p></li><li id="r-334056" data-claire-element-id="334056"><p id="r-334055" data-claire-element-id="334055">dispose d'une implémentation pouvant être testée dès aujourd'hui ;</p></li><li id="r-334058" data-claire-element-id="334058"><p id="r-334057" data-claire-element-id="334057">s'intègre bien dans le langage et offre de nombreuses possibilités (cf. tableau plus haut) ;</p></li><li id="r-334060" data-claire-element-id="334060"><p id="r-334059" data-claire-element-id="334059">s'inspire de bonnes idées existantes dans d'autres langages : (les <a href="http://community.schemewiki.org/?scheme-faq-macros">macros hygiéniques de Scheme</a>, l'<a href="http://js-quasis-libraries-and-repl.googlecode.com/svn/trunk/safetemplate.html">inférence de type</a>, ou encore les <a href="http://www.erights.org/elang/grammar/quasi-overview.html">quasi-quotes de Lisp</a>).</p></li></ul><h2 id="r-quelques-autres-nouveautes" data-claire-element-id="334072">Quelques autres nouveautés</h2><p id="r-334063" data-claire-element-id="334063">Ces deux nouveautés ne sont pas les seules prévues ! Parmi les nouveautés présentées sur le wiki ECMAScript, nous en citerons trois. Les <strong><em>destructuring assignments</em></strong> proposés par CoffeeScript seront intégrés au langage et auront un comportement uniformes dans de nombreux cas :</p><pre id="r-334064" data-claire-element-id="334064"><code data-claire-semantic="javascript">// échanger deux variables
[a, b] = [b, a];

// retourner plusieurs valeurs dans une fonction
var [tete, queue] = decouperListe(l);

// déclarer une fonction prenant en paramètre un objet
function showPixel({&quot;x&quot;: x, &quot;y&quot;: x}) { ... }

// boucler sur une liste d'objet
for (let [clef, valeur] in obj) { ... }</code></pre><p id="r-334065" data-claire-element-id="334065">La <strong>notation courte pour les lambdas</strong> permet d'écrire des fonctions anonymes plus simplement. Voyons la différence en reprenant un exemple déjà utilisé :</p><pre id="r-334066" data-claire-element-id="334066"><code data-claire-semantic="javascript">var ages = [12, 89, 23, 45, 5, 37];
var majeurs = ages.filter(function(age) { return age &gt; 18; });
var majeurs = ages.filter(age =&gt; age &gt; 18)
// majeurs == [89, 23, 45, 37];</code></pre><p id="r-334067" data-claire-element-id="334067">Cette fois, ce n'est pas uniquement la syntaxe qui change, et il y une légère différence quant à la valeur de <a href="http://www.siteduzero.com/tutoriel-3-429688-les-objets.html">this</a> dans chacune des fonctions. Néanmoins, dans tous les cas où <code data-claire-semantic="javascript">this</code> n'est pas utilisé, ces deux formes sont équivalentes.</p><p id="r-334068" data-claire-element-id="334068">Dans cette nouvelle version d'ECMAScript, lLes compilateurs vers JavaScript ne seront pas en reste. En particulier, une nouvelle forme de tableaux va faire son apparition. En effet, les tableaux JavaScript ne sont que des objets : l'indice est stocké sous forme de chaîne ce qui implique une <a href="http://es5.github.com/#x15.4">conversion entier/chaîne</a> à l'exécution. Ainsi, le tableau <code data-claire-semantic="javascript">[23, 42, 118]</code> est en fait équivalent à l'objet <code>{&quot;0&quot;: 23, &quot;1&quot;: 42, &quot;2&quot;: 118, &quot;length&quot;: 3}</code>, ce qui est une source importante d'inefficacité. C'est pour cette raison qu'ECMAScript Harmony facilitera la manipulation de <a href="http://wiki.ecmascript.org/doku.php?id=harmony:binary_data">données compactes</a> : il incorpore des tableaux typés (<a href="http://www.khronos.org/registry/typedarray/specs/latest/">inspirés de WebGL</a>) et des <em>bit fields</em> qui permettront de représenter des données binaires de manière compacte et efficace. C'est une fonctionnalité essentielle pour les langages compilant vers JavaScript. Ainsi, <a href="http://mbebenita.github.com/LLJS/">LLJS</a> utilise ces tableaux pour compiler un sous-ensemble du JavaScript vers... du JavaScript. La différence est que la mémoire est gérée explicitement via les tableaux typés, ce qui rend le code illisible pour un humain mais qui nécessite beaucoup moins d'efforts de la part du <a href="http://www.siteduzero.com/tutoriel-3-36456-problematique-et-principes-fondamentaux-du-recyclage-automatique-de-la-memoire.html">ramasse-miettes</a> du moteur JavaScript exécutant le code, et permettra potentiellement de rendre le code plus lisible.</p><p id="r-334069" data-claire-element-id="334069">Il est enfin intéressant de noter que <code data-claire-semantic="javascript">let</code> pourra être utilisé comme <code data-claire-semantic="javascript">var</code> mais avec une portée limitée au bloc au lieu de la fonction, ce qui évitera nombre de confusions : la portée des variables est actuellement celle de la fonction entière, ce qui n'est pas le cas dans la plupart des langages de programmation.</p><p id="r-334070" data-claire-element-id="334070">Pour terminer, sachez qu'il est possible de participer au développement d'ECMAScript Harmony en tant que simple programmeur JavaScript. Partant du constat que faire partie du comité <a href="https://twitter.com/#!/BrendanEich/status/193904741732990976">n'était pas accessible à moins d'être embauché par une association ou une université</a>, des développeurs ont décidé de se <a href="http://javascriptweblog.wordpress.com/2012/05/07/putting-the-developer-back-in-es-next/">réunir pour faire remonter au comité tous les problèmes</a> qu'ils ont, à la fois avec la version actuelle de JavaScript et avec les propositions de la version suivante. Cette initiative s'appelle <a href="https://github.com/JSFixed/JSFixed">JSFixed</a> et un <a href="https://github.com/JSFixed/JSFixed/issues">bon nombre de points a déjà été identifié</a>. Si votre niveau d'expertise en anglais et en JavaScript vous permet de participer à la discussion, c'est l'occasion parfaite de participer à l'avenir de JavaScript.</p><p id="r-334071" data-claire-element-id="334071">JavaScript ne se limite donc pas à faire clignoter votre page web, loin s'en faut. Les possibilités sont sans cesse plus nombreuses : il est entièrement réaliste aujourd'hui de n'utiliser que JavaScript pour un site web. Sa popularité est grandissante, et ses évolutions sont prometteuses : c'est donc un langage à ne pas négliger qui est là pour rester. Il serait dommage de l'ignorer.</p><h2 id="r-sources-3" data-claire-element-id="334095">Sources</h2><ul id="r-334093" data-claire-element-id="334093"><li id="r-334075" data-claire-element-id="334076"><img id="r-334076" data-claire-element-id="334075" src="../../openclassrooms.com/Templates/images/designs/2/pays/gb.html" alt="Image utilisateur"/><img id="r-334073" data-claire-element-id="334073" src="../../openclassrooms.com/Templates/images/designs/2/pays/gb.html" alt="Image utilisateur"/><p id="r-334074" data-claire-element-id="334074"><a href="http://www.yuiblog.com/blog/2011/11/21/video-yuiconf2011-dherma/">YUI Theater — Dave Herman: “The Future of JavaScript” (48 min.)</a></p></li><li id="r-334079" data-claire-element-id="334080"><img id="r-334080" data-claire-element-id="334079" src="../../openclassrooms.com/Templates/images/designs/2/pays/gb.html" alt="Image utilisateur"/><img id="r-334077" data-claire-element-id="334077" src="../../openclassrooms.com/Templates/images/designs/2/pays/gb.html" alt="Image utilisateur"/><p id="r-334078" data-claire-element-id="334078"><a href="http://www.crockford.com/javascript/javascript.html">JavaScript: The World's Most Misunderstood Programming Language</a></p></li><li id="r-334083" data-claire-element-id="334084"><img id="r-334084" data-claire-element-id="334083" src="../../openclassrooms.com/Templates/images/designs/2/pays/gb.html" alt="Image utilisateur"/><img id="r-334081" data-claire-element-id="334081" src="../../openclassrooms.com/Templates/images/designs/2/pays/gb.html" alt="Image utilisateur"/><p id="r-334082" data-claire-element-id="334082"><a href="http://wiki.ecmascript.org/doku.php">ECMAScript Wiki</a> (<a href="http://wiki.ecmascript.org/doku.php?id=harmony:modules">modules</a>, <a href="http://wiki.ecmascript.org/doku.php?id=harmony:quasis">quasis</a>, <a href="http://wiki.ecmascript.org/doku.php?id=harmony:destructuring">destructuring</a>, <a href="http://wiki.ecmascript.org/doku.php?id=harmony:iterators">iterators</a>, <a href="http://wiki.ecmascript.org/doku.php?id=harmony:let">let</a>, <a href="http://wiki.ecmascript.org/doku.php?id=strawman:shorter_function_syntax">shorter function syntax</a>)</p></li><li id="r-334087" data-claire-element-id="334088"><img id="r-334088" data-claire-element-id="334087" src="../../openclassrooms.com/Templates/images/designs/2/pays/gb.html" alt="Image utilisateur"/><img id="r-334085" data-claire-element-id="334085" src="../../openclassrooms.com/Templates/images/designs/2/pays/gb.html" alt="Image utilisateur"/><p id="r-334086" data-claire-element-id="334086"><a href="http://s3.amazonaws.com/four.livejournal/20091117/jsconf.pdf">Slides de la présentation de Node.js à la jsconf 2009</a></p></li><li id="r-334091" data-claire-element-id="334092"><img id="r-334092" data-claire-element-id="334091" src="../../openclassrooms.com/Templates/images/designs/2/pays/gb.html" alt="Image utilisateur"/><img id="r-334089" data-claire-element-id="334089" src="../../openclassrooms.com/Templates/images/designs/2/pays/gb.html" alt="Image utilisateur"/><p id="r-334090" data-claire-element-id="334090"><a href="http://javascriptweekly.com/">JavaScript Weekly</a></p></li></ul><p id="r-334094" data-claire-element-id="334094">Merci à Hellish, Arthur, Nesquik69, bluestorm, Golmote et Kineolyan pour leurs relectures et à l'équipe du site pour son travail de l'ombre.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne">Le JavaScript moderne</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne/l-histoire-mouvementee-de-javascript">
L&#039;histoire mouvementée de JavaScript
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne/l-assembleur-du-web">
L&#039;assembleur du web
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne/ecmascript-harmony">
ECMAScript Harmony
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/le-javascript-moderne/l-assembleur-du-web">
<span class="arrow"></span>
<span class="next">L&#039;assembleur du web</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/le-javascript-moderne.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 03:38:02 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/le-javascript-moderne.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:43:58 GMT -->
</html>