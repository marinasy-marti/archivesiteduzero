<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/c-maitriser-le-compilateur-g.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 03:09:27 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/c-maitriser-le-compilateur-g.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:41:48 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : [C++] Maîtriser le compilateur g++</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/c-maitriser-le-compilateur-g.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : [C++] Maîtriser le compilateur g++</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#CMatriserlecompilateurg">[C++] Maîtriser le compilateur g++</a><br/><a href="#Brefrappelsurlefonctionnementducompilateur">Bref rappel sur le fonctionnement du compilateur</a><br/><a href="#Changerlesoptionsdecompilation">Changer les options de compilation</a><br/><a href="#Plusdewarnings">Plus de warnings !</a><br/><a href="#Optimisersonprogramme">Optimiser son programme</a><br/></div>
<a name="CMatriserlecompilateurg"></a><h2>[C++] Maîtriser le compilateur g++</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/bref-rappel-sur-le-fonctionnement-du-compilateur">
<span class="next">Bref rappel sur le fonctionnement du compilateur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-529025" data-claire-element-id="529025">Bonjour à tous !</p><p id="r-529026" data-claire-element-id="529026">Si vous avez débuté la programmation en C++ avec <a href="http://www.siteduzero.com/tutoriel-3-11406-apprenez-a-programmer-en-c.html">le cours officiel</a> présent sur ce site, vous avez appris à utiliser un compilateur pour transformer votre code source en programme exécutable. <br/> Le compilateur que beaucoup de monde utilise s'appelle <strong>g++</strong>. Il est disponible par défaut sous Linux et est aussi fourni (sous le nom <em>MinGW</em>) avec le logiciel Code::Blocks si vous travaillez sous Windows. Vous utilisez donc probablement ce logiciel tous les jours, mais le connaissez-vous vraiment ? :lol:</p><p id="r-529027" data-claire-element-id="529027">G++ possède à ce jour plus de 1 500 (!) options différentes permettant de modifier son comportement. Je ne vais bien évidemment pas vous détailler chacune d'entre elles, mais vous en présenter quelques-unes que je trouve importantes.</p><p id="r-529028" data-claire-element-id="529028">Vous avez certainement déjà reçu beaucoup de messages complexes de la part de votre compilateur, ce qui n'est pas toujours très réjouissant à lire. Je vais, au travers de ce tutoriel, vous aider à vous familiariser un peu plus avec cet outil et peut-être deviendra-t-il un jour votre nouveau meilleur ami.</p>
</div><a name="Brefrappelsurlefonctionnementducompilateur"></a><h2>Bref rappel sur le fonctionnement du compilateur</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/changer-les-options-de-compilation">
<span class="next">Changer les options de compilation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-principe-de-fonctionnement-7" data-claire-element-id="529033">Principe de fonctionnement</h2><p id="r-529029" data-claire-element-id="529029">Un compilateur est un logiciel très (très) complexe, et je ne vais pas vous en décrire le fonctionnement exact. De toute façon, on n'a pas besoin de le connaître pour l'utiliser, comme vous l'avez fait jusqu'à aujourd'hui. <br/> Il est cependant important d'en connaître les grands principes pour mieux l'apprivoiser et l'utiliser dans les meilleures conditions.</p><p id="r-529030" data-claire-element-id="529030">Très brièvement, un compilateur est un programme qui va traduire votre <strong>code source</strong> en un fichier contenant des instructions exécutables par le processeur de votre ordinateur. Cela se passe en plusieurs étapes que je vais vous présenter sommairement au travers d'un exemple bien connu, le fameux « Hello World ! ».</p><p id="r-529031" data-claire-element-id="529031">Voici donc notre code source de départ :</p><pre id="r-529032" data-claire-element-id="529032"><code data-claire-semantic="cpp">#include &lt;iostream&gt;
using namespace std;

int main(int argc, char* argv[])
{
  cout &lt;&lt; &quot;Hello World !&quot; &lt;&lt; endl;
  return 0;
}</code></pre><h2 id="r-le-preprocesseur-2" data-claire-element-id="529039">Le préprocesseur</h2><p id="r-529034" data-claire-element-id="529034">La première chose que g++ va faire, c'est appeler le <strong>préprocesseur</strong>. Vous avez déjà entendu ce nom lorsque l'on vous a parlé des directives de <em>preprocessing</em>, les célèbres lignes commençant par #. Ce sont des lignes que le préprocesseur va lire, puis effectuer l'action associée. Dans notre exemple, il va inclure le contenu du fichier <em>iostream</em> en haut de notre programme.</p><p id="r-529035" data-claire-element-id="529035">Si l'on exécute uniquement le préprocesseur sur notre code d'exemple, on obtient un fichier de plus de 18 000 lignes. :o <br/> Voici à quoi ressemble la fin du fichier généré :</p><div id="r-529037" data-claire-element-id="529037"><pre id="r-529036" data-claire-element-id="529036"><code data-claire-semantic="cpp">//....
namespace std __attribute__ ((__visibility__ (&quot;default&quot;))) {
# 58 &quot;/usr/include/c++/4.4/iostream&quot; 3
  extern istream cin;
  extern ostream cout;
  extern ostream cerr;
  extern ostream clog;


  extern wistream wcin;
  extern wostream wcout;
  extern wostream wcerr;
  extern wostream wclog;




  static ios_base::Init __ioinit;

}
# 2 &quot;hello.cpp&quot; 2
using namespace std;

int main(int argc, char* argv[])
{
  cout &lt;&lt; &quot;Hello World !&quot; &lt;&lt; endl;
  return 0;
}</code></pre></div><p id="r-529038" data-claire-element-id="529038">On reconnaît notre code source original à la fin et on peut aussi observer que la ligne <code data-claire-semantic="cpp">#include &lt;iostream&gt;</code> a été remplacée par une quantité d'autres choses.</p><h2 id="r-la-compilation-6" data-claire-element-id="529045">La compilation</h2><p id="r-529040" data-claire-element-id="529040">La deuxième étape est la plus intéressante, c'est l'étape de <strong>compilation</strong>. C'est à ce moment-là que le code va être effectivement traduit. La traduction se fait vers un autre langage, l'assembleur. C'est à ce moment aussi que g++ va afficher des messages d'erreur s'il trouve des choses non conformes dans votre code source. Comme notre code d'exemple est correct, rien ne s'affiche et la traduction vers l'assembleur se passe bien.</p><p id="r-529041" data-claire-element-id="529041">Cette fois, le fichier obtenu est bien plus court.</p><div id="r-529043" data-claire-element-id="529043"><pre id="r-529042" data-claire-element-id="529042"><code data-claire-semantic="gas">_GLOBAL__I_main:
.LFB1003:
        .cfi_startproc
        .cfi_personality 0x3,__gxx_personality_v0
        subq        $8, %rsp
        .cfi_def_cfa_offset 16
        movl        $_ZStL8__ioinit, %edi
        call        _ZNSt8ios_base4InitC1Ev
        popq        %rax
        movl        $__dso_handle, %edx
        movl        $_ZStL8__ioinit, %esi
        movl        $_ZNSt8ios_base4InitD1Ev, %edi
        jmp        __cxa_atexit
        .cfi_endproc
.LFE1003:
        .size        _GLOBAL__I_main, .-_GLOBAL__I_main
        .section        .ctors,&quot;aw&quot;,@progbits
        .align 8
        .quad        _GLOBAL__I_main
        .section        .rodata.str1.1,&quot;aMS&quot;,@progbits,1
.LC0:
        .string        &quot;Hello World !&quot;
        .text
.globl main
        .type        main, @function
main:
.LFB993:
        .cfi_startproc
        .cfi_personality 0x3,__gxx_personality_v0
        subq        $8, %rsp
        .cfi_def_cfa_offset 16
        movl        $13, %edx
        movl        $.LC0, %esi
        movl        $_ZSt4cout, %edi
        call        _ZSt16__ostream_insertIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_PKS3_l
        movl        $_ZSt4cout, %edi
        call        _ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_
        xorl        %eax, %eax
        popq        %rdx
        ret
        .cfi_endproc
.LFE993:
        .local        _ZStL8__ioinit
        .comm        _ZStL8__ioinit,1,1</code></pre></div><p id="r-529044" data-claire-element-id="529044">Si vous connaissez l'assembleur, vous saurez reconnaître certaines lignes. En tout cas, moi, je n'y comprends rien. ;)</p><h2 id="r-assemblage" data-claire-element-id="529050">Assemblage</h2><p id="r-529046" data-claire-element-id="529046">Que reste-t-il à faire ? Une deuxième traduction, pardi ! Il faut transformer ce code assembleur en un <strong>fichier objet</strong> qui contient des instructions que le processeur comprend. Cette deuxième et dernière traduction s'appelle l'<strong>assemblage</strong>. Comme on n'a pas eu de problème jusque là, il n'y a pas de raison que cela ne continue pas : g++ nous fournit un exécutable qui va, sans surprise, nous donner le résultat attendu à l'exécution.</p><pre id="r-529047" data-claire-element-id="529047"><code data-claire-semantic="console">Hello World !</code></pre><aside id="r-529049" data-claire-element-id="529049" data-claire-semantic="information"><p id="r-529048" data-claire-element-id="529048">Si votre programme est constitué de plusieurs fichiers, g++ devra les lier pour générer l'exécutable final. C'est ce qu'on appelle l'édition des liens. Je n'en ai pas parlé ici pour simplifier le propos.</p></aside><h2 id="r-et-alors-1" data-claire-element-id="529054">Et alors ?</h2><p id="r-529051" data-claire-element-id="529051">Si je vous ai raconté tout cela, c'est pour vous familiariser un peu avec l'outil et pour vous montrer toute la complexité de la chose. C'est aussi parce que, dans la suite, je vais vous parler d'options permettant de régler le comportement de g++ lors du passage du préprocesseur et de la compilation principalement. <br/> Par exemple, si je demande à g++ d'être plus strict sur la conformité du code, je peux obtenir beaucoup de messages d'information. Notre code source initial semblait bien innocent mais, si j'affiche plus de messages, j'obtiens les <em>warnings</em> (nous verrons plus loin ce dont il s'agit) suivants :</p><pre id="r-529052" data-claire-element-id="529052"><code data-claire-semantic="console">hello.cpp:4: warning: unused parameter ‘argc’
hello.cpp:4: warning: unused parameter ‘argv’</code></pre><p id="r-529053" data-claire-element-id="529053">Dans ce cas, il ne s'agit pas d'un message très intéressant, mais les informations données par g++ peuvent se révéler très importantes. Nous allons voir dans la suite comment demander à notre nouveau meilleur ami d'être plus bavard.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g">[C++] Maîtriser le compilateur g++</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/bref-rappel-sur-le-fonctionnement-du-compilateur">
Bref rappel sur le fonctionnement du compilateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/changer-les-options-de-compilation">
Changer les options de compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/plus-de-warnings">
Plus de warnings !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/optimiser-son-programme">
Optimiser son programme
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/changer-les-options-de-compilation">
<span class="next">Changer les options de compilation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Changerlesoptionsdecompilation"></a><h2>Changer les options de compilation</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/bref-rappel-sur-le-fonctionnement-du-compilateur">
<span class="arrow"></span>
<span class="next">Bref rappel sur le fonctionnement du compilateur</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/plus-de-warnings">
<span class="next">Plus de warnings !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-529056" data-claire-element-id="529056">Bon, je vous ai montré que l'on pouvait obtenir plus d'informations lors de la compilation. Je vous ai également dit que cela se faisait en changeant les paramètres de compilation que l'on passe à g++. Donc, en théorie, vous savez tout. :) <br/> Il ne reste plus qu'à voir comment ces réglages se font. C'est ce que nous allons voir dans cette sous-partie.</p><p id="r-529057" data-claire-element-id="529057">Un paramètre de compilation se compose toujours de la forme <strong>-paramètre</strong> ou <strong>--paramètre</strong>, c'est-à-dire qu'il est constitué d'un tiret suivi du nom de l'option. Dans la très longue liste des paramètres, on trouve par exemple les options suivantes :</p><ul id="r-529066" data-claire-element-id="529066"><li id="r-529059" data-claire-element-id="529059"><p id="r-529058" data-claire-element-id="529058"><strong>-Wall ;</strong></p></li><li id="r-529061" data-claire-element-id="529061"><p id="r-529060" data-claire-element-id="529060"><strong>-fomit-frame-pointer ;</strong></p></li><li id="r-529063" data-claire-element-id="529063"><p id="r-529062" data-claire-element-id="529062"><strong>-S ;</strong></p></li><li id="r-529065" data-claire-element-id="529065"><p id="r-529064" data-claire-element-id="529064"><strong>etc.</strong></p></li></ul><p id="r-529067" data-claire-element-id="529067">Comme vous pouvez le voir, certaines options ne sont constituées que d'une lettre, d'autres d'un mot ou même de plusieurs.</p><div id="r-529069" data-claire-element-id="529069" data-claire-semantic="question"><p id="r-529068" data-claire-element-id="529068">O.K., mais comment les utilise-t-on ? Et lesquelles faut-il utiliser ?</p></div><p id="r-529070" data-claire-element-id="529070">Je vais déjà commencer par la première de vos questions. Voyons comment passer un paramètre de compilation à <strong>g++</strong>. Je vais prendre l'exemple du paramètre <strong>-Wall</strong> puisque, comme vous le verrez dans la suite, c'est une option très courante.</p><h2 id="r-avec-code-blocks-2" data-claire-element-id="529083">Avec Code::Blocks</h2><p id="r-529071" data-claire-element-id="529071">Sous Code::Blocks, la plupart des options de compilation usuelles sont facilement activables. Pour ce faire, il suffit de vous rendre dans le menu <strong>Projet</strong> et de choisir ensuite l'entrée <strong>Build options.</strong><br/> Vous devriez vous retrouver avec une fenêtre ressemblant à celle se trouvant sur l'image.</p><figure id="r-529073" data-claire-element-id="529074"><img id="r-529072" data-claire-element-id="529072" src="medias/uploads.siteduzero.com_files_273001_274000_273002.png" alt="Image utilisateur"/></figure><p id="r-529075" data-claire-element-id="529075">Devant vous devrait se trouver un long menu composé de lignes compliquées. Mais, à la fin de ces lignes, vous devriez reconnaître les fameuses options ayant la forme <strong>-paramètre</strong>. <br/> Il n'y a donc rien de difficile à ce stade. Il suffit de cocher les cases qui vous intéressent.</p><div id="r-529077" data-claire-element-id="529077" data-claire-semantic="question"><p id="r-529076" data-claire-element-id="529076">Et si l'option que je souhaite ne se trouve pas dans la liste ?</p></div><p id="r-529078" data-claire-element-id="529078">J'y viens. Cela ne devrait pas vous arriver souvent puisque les options principales se trouvent sur cette page. Mais si cela devait malgré tout être le cas, il vous suffit de cliquer sur l'onglet <strong>Other options</strong> et d'indiquer les paramètres de compilation dans le champ de texte qui apparaît.</p><figure id="r-529080" data-claire-element-id="529081"><img id="r-529079" data-claire-element-id="529079" src="medias/uploads.siteduzero.com_files_273001_274000_273004.png" alt="Image utilisateur"/></figure><p id="r-529082" data-claire-element-id="529082">Toutefois, comme je vous l'ai dit, il est rare de devoir utiliser ce champ texte. Les créateurs de Code::Blocks ont pensé aux pauvres zéros comme nous et à nos besoins très standards en mettant presque tout ce qui est utile dans les cases à cocher.</p><h2 id="r-sous-linux-en-ligne-de-commande" data-claire-element-id="529093">Sous Linux en ligne de commande</h2><p id="r-529084" data-claire-element-id="529084">Si vous travaillez sous Linux et que vous compilez en ligne de commande, ce sera encore plus simple. Il suffit d'ajouter les options que vous désirez lors de l'appel à <strong>g++</strong>.</p><p id="r-529085" data-claire-element-id="529085">Pour compiler le fichier <em>hello.cpp</em> en un programme <em>hello</em>, la syntaxe habituelle est la suivante :</p><pre id="r-529086" data-claire-element-id="529086"><code data-claire-semantic="console">g++ hello.cpp -o hello</code></pre><p id="r-529087" data-claire-element-id="529087">Pour utiliser un paramètre de compilation, on l'ajoute simplement à la commande. Ce qui donne, par exemple :</p><pre id="r-529088" data-claire-element-id="529088"><code data-claire-semantic="console">g++ hello.cpp -o hello -Wall</code></pre><aside id="r-529090" data-claire-element-id="529090" data-claire-semantic="information"><p id="r-529089" data-claire-element-id="529089">Vous pouvez mettre les paramètres de compilation à n'importe quel endroit dans l'appel à <strong>g++</strong>, sauf entre le <strong>-o</strong> et le nom de l'exécutable.</p></aside><p id="r-529091" data-claire-element-id="529091">Je pense qu'on ne peut pas vraiment faire plus simple… :p</p><p id="r-529092" data-claire-element-id="529092">Bon, il est maintenant temps de répondre à votre deuxième question. Quelles options de compilation faut-il choisir ?</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g">[C++] Maîtriser le compilateur g++</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/bref-rappel-sur-le-fonctionnement-du-compilateur">
Bref rappel sur le fonctionnement du compilateur
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/changer-les-options-de-compilation">
Changer les options de compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/plus-de-warnings">
Plus de warnings !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/optimiser-son-programme">
Optimiser son programme
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/bref-rappel-sur-le-fonctionnement-du-compilateur">
<span class="arrow"></span>
<span class="next">Bref rappel sur le fonctionnement du compilateur</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/plus-de-warnings">
<span class="next">Plus de warnings !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Plusdewarnings"></a><h2>Plus de warnings !</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/changer-les-options-de-compilation">
<span class="arrow"></span>
<span class="next">Changer les options de compilation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/optimiser-son-programme">
<span class="next">Optimiser son programme</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-529095" data-claire-element-id="529095">La première grande catégorie d'options de GCC est l'ajout de <em>warnings</em>. Lorsque l'on rédige du code, il arrive que l'on fasse de petites erreurs d'inattention comme confondre les symboles <strong>=</strong> et <strong>==</strong> ou oublier d'initialiser une variable. Le code obtenu est souvent valide et le compilateur le traduit sans broncher. Par contre, le programme obtenu ne fait pas ce que l'on pensait et certaines erreurs sont difficiles à repérer. Le compilateur peut nous aider à repérer des instructions syntaxiquement valides, mais potentiellement erronées.</p><p id="r-529096" data-claire-element-id="529096">Le compilateur peut aussi nous aider à écrire du code entièrement conforme à la norme, ce qui devrait, en théorie, aider à porter le code d'une plate-forme à l'autre.</p><p id="r-529097" data-claire-element-id="529097">Je ne vais pas vous présenter tous les <em>warnings</em> existants car il y en a bien trop, mais je vais vous parler des plus courants ou, en tout cas, de ceux que j'utilise régulièrement.</p><h2 id="r-les-options-de-base" data-claire-element-id="529119">Les options de base</h2><p id="r-529098" data-claire-element-id="529098">Pour simplifier la vie des utilisateurs, les concepteurs de GCC ont regroupé les <em>warnings</em> les plus utiles dans ce que l'on pourrait appeler des <em>super-options</em>. Celle que tout le monde utilise est <strong>-Wall</strong>. Lorsque l'on active cette option, la plupart des erreurs courantes sont relevées et pourront ainsi être corrigées. <br/> Par exemple, si l'on oublie un <code>return</code> dans une fonction, le compilateur nous le dira. La fonction suivante ne prend pas en compte le cas <code data-claire-semantic="cpp">a==0</code>, mais on ne le remarque pas forcément au premier coup d'œil. Le compilateur, lui, détectera cette erreur.</p><pre id="r-529099" data-claire-element-id="529099"><code data-claire-semantic="cpp">int f(int a)
{
    if(a&lt;0)
        return 2*a;
    else if(a&gt;0)
        return 3*a;
}</code></pre><p id="r-529100" data-claire-element-id="529100">Le message correspondant sera le suivant :</p><pre id="r-529101" data-claire-element-id="529101"><code data-claire-semantic="console">fonction.cpp: In function ‘int f(int)’:
fonction.cpp:7:1: warning: control reaches end of non-void function</code></pre><p id="r-529102" data-claire-element-id="529102">Ce qu'on peut traduire par : « Il est possible d'atteindre la fin d'une fonction qui ne renvoie pas <em>void</em> ». Effectivement, si <code data-claire-semantic="cpp">a==0</code>, on atteint l'accolade fermante sans avoir passé par un <code data-claire-semantic="cpp">return</code>, ce qui est certainement une erreur. :)</p><p id="r-529103" data-claire-element-id="529103">Prenons un autre exemple classique, que j'ai repris du forum en le modifiant quelque peu :</p><pre id="r-529104" data-claire-element-id="529104"><code data-claire-semantic="cpp">int f(int a)
{
  if(a=0)
    return 2;
  else
    return 3;
}</code></pre><p id="r-529105" data-claire-element-id="529105">Ce code est valide. Dans le <code data-claire-semantic="cpp">if</code>, la valeur 0 est assignée à <code data-claire-semantic="cpp">a</code> puis le test est effectué et, puisque la valeur est égale à 0, on passe toujours dans le <code data-claire-semantic="cpp">else</code>. Au premier coup d'œil, on ne remarque pas forcément qu'il manque un <strong>=</strong>. Le compilateur, lui, nous dit ceci :</p><pre id="r-529106" data-claire-element-id="529106"><code data-claire-semantic="console">fonction2.cpp: In function ‘int f(int)’:
fonction2.cpp:3:9: warning: suggest parentheses around assignment used as truth value</code></pre><p id="r-529107" data-claire-element-id="529107">Ce que l'on peut traduire par : « Je vous suggère de mettre des parenthèses autour de l'assignation si vous voulez l'utiliser comme test ». Le compilateur est poli, il suppose que mettre un seul symbole <strong>=</strong> était ce que vous vouliez faire. Il vous propose donc de mettre des parenthèses autour pour bien montrer que c'est intentionnel.</p><p id="r-529108" data-claire-element-id="529108">À part ces deux exemples classiques d'erreurs, l'option <strong>-Wall</strong> va aussi indiquer les parenthèses ambiguës, les <code data-claire-semantic="cpp">switch</code> où des <code data-claire-semantic="cpp">case</code> manquent, les déclarations de variables et fonctions inutilisées dans le reste du code et bien d'autres choses encore.</p><aside id="r-529110" data-claire-element-id="529110" data-claire-semantic="information"><p id="r-529109" data-claire-element-id="529109">Malgré ce que son nom laisse suggérer, <strong>-Wall</strong> n'active <strong>pas</strong> tous les <em>warnings</em> possibles mais seulement les plus courants.</p></aside><p id="r-529111" data-claire-element-id="529111">L'autre option de base est <strong>-Wextra</strong>. Cette super-option active elle aussi une série de tests de conformité du code en particulier, elle autorise le compilateur à indiquer les variables initialisées ainsi que les arguments de fonctions inutilisés, par exemple :</p><pre id="r-529112" data-claire-element-id="529112"><code data-claire-semantic="cpp">int f(int a, int b)
{
  int c;
  if(c&gt;a)
    return 2;
  else
    return 3;
}</code></pre><p id="r-529113" data-claire-element-id="529113">Cette fonction engendre deux messages d'avertissement :</p><pre id="r-529114" data-claire-element-id="529114"><code data-claire-semantic="console">fonction3.cpp:1:5: warning: unused parameter ‘b’
fonction3.cpp: In function ‘int f(int, int)’:
fonction3.cpp:4:3: warning: ‘c’ is used uninitialized in this function</code></pre><p id="r-529115" data-claire-element-id="529115">Cette fois, les messages sont très explicites : la variable <code data-claire-semantic="cpp">b</code> n'est pas utilisée dans la fonction, ce qui est certainement une erreur et <code data-claire-semantic="cpp">c</code> n'a pas de valeur lors du test, ce qui est à coup sûr une erreur. ;) Même si le code est valide et compile. J'espère que ça va vous convaincre d'utiliser au maximum les <em>warnings</em> du compilateur.</p><aside id="r-529117" data-claire-element-id="529117" data-claire-semantic="information"><p id="r-529116" data-claire-element-id="529116">Je vous conseille de <strong>toujours</strong> compiler avec les options <strong>-Wall</strong> et <strong>-Wextra</strong> : elles permettent d'éliminer les erreurs les plus courantes.</p></aside><p id="r-529118" data-claire-element-id="529118">Il reste une dernière super-option à voir : <strong>-pedantic</strong>. Elle vérifie que le code est conforme en tout point à la norme. Avec cette option activée et aucun message d'avertissement affiché, votre code devrait pouvoir compiler sur un autre OS et avec un autre compilateur. Mais ce n'est pas toujours aussi simple. Sachez simplement que cette option existe pour le jour où vous devrez créer du code portable.</p><h2 id="r-plus-d-options-1" data-claire-element-id="529156">Plus d'options</h2><p id="r-529120" data-claire-element-id="529120">Après les options de base, je vous propose une petite sélection d'avertissements bien pratiques.</p><h3 id="r-les-problemes-de-pointeurs" data-claire-element-id="529130">Les problèmes de pointeurs</h3><p id="r-529121" data-claire-element-id="529121">Quand on manipule des pointeurs, il se peut que certaines opérations soient dangereuses ou aient des effets inattendus. Pour nous aider à repérer ces choses, il y a trois options à activer :</p><ul id="r-529128" data-claire-element-id="529128"><li id="r-529123" data-claire-element-id="529123"><p id="r-529122" data-claire-element-id="529122"><strong>-Wpointer-arith</strong> qui affiche des messages si l'on fait des calculs du type <em>pointeur + nombre</em> ;</p></li><li id="r-529125" data-claire-element-id="529125"><p id="r-529124" data-claire-element-id="529124"><strong>-Wcast-qual</strong> qui affiche des messages si l'on convertit un pointeur sur une constante en un pointeur sur une variable non constante ;</p></li><li id="r-529127" data-claire-element-id="529127"><p id="r-529126" data-claire-element-id="529126"><strong>-Wcast-align</strong> qui affiche des messages si l'on convertit des pointeurs d'un type à l'autre alors que leur taille en mémoire est différente (par exemple de <code data-claire-semantic="cpp">char*</code> vers <code data-claire-semantic="cpp">int*</code>).</p></li></ul><p id="r-529129" data-claire-element-id="529129">Mais comme manipuler directement des pointeurs est une opération assez rare en C++, on n'a pas souvent besoin de ces options.</p><h3 id="r-les-conversions-1" data-claire-element-id="529140">Les conversions</h3><p id="r-529131" data-claire-element-id="529131">Le compilateur est autorisé à convertir des nombres d'un type à l'autre, par exemple de <code data-claire-semantic="cpp">double</code> vers <code data-claire-semantic="cpp">int</code> et vice-versa. Cela peut avoir des conséquences sur la précision des calculs et il est possible de demander au compilateur de nous avertir quand il fait ce genre de conversions.</p><ul id="r-529138" data-claire-element-id="529138"><li id="r-529133" data-claire-element-id="529133"><p id="r-529132" data-claire-element-id="529132"><strong>-Wconversion</strong> avertit quand des conversions automatiques sont effectuées.</p></li><li id="r-529135" data-claire-element-id="529135"><p id="r-529134" data-claire-element-id="529134"><strong>-Wdouble-promotion</strong> avertit quand un <code data-claire-semantic="cpp">float</code> est converti en <code data-claire-semantic="cpp">double</code>.</p></li><li id="r-529137" data-claire-element-id="529137"><p id="r-529136" data-claire-element-id="529136"><strong>-Wold-style-cast</strong> avertit quand des conversions « à la C » sont utilisées. En C++, on devrait toujours utiliser des <code data-claire-semantic="cpp">static_cast</code> ou les autres membres de la famille des <em>casts</em>.</p></li></ul><p id="r-529139" data-claire-element-id="529139">Finalement, voyons quelques inclassables.</p><h3 id="r-les-inclassables-3" data-claire-element-id="529155">Les inclassables</h3><p id="r-529141" data-claire-element-id="529141">Dans cette liste, il y a un peu de tout mais, comme toujours, il y a des cas particuliers qui pourront être évités grâce à ces options.</p><ul id="r-529150" data-claire-element-id="529150"><li id="r-529143" data-claire-element-id="529143"><p id="r-529142" data-claire-element-id="529142"><strong>-Wfloat-equal</strong> avertit si l'on teste l'égalité de deux nombres à virgule. Une erreur courante lorsque l'on fait du calcul scientifique.</p></li><li id="r-529145" data-claire-element-id="529145"><p id="r-529144" data-claire-element-id="529144"><strong>-Woverloaded-virtual</strong> affiche un message si une fonction virtuelle n'a pas la même signature dans une classe fille que dans sa classe mère.</p></li><li id="r-529147" data-claire-element-id="529147"><p id="r-529146" data-claire-element-id="529146"><strong>-Wshadow</strong> affiche un message s'il y a deux variables de même nom dans la même portion de code.</p></li><li id="r-529149" data-claire-element-id="529149"><p id="r-529148" data-claire-element-id="529148"><strong>-Weffc++</strong> affiche un message si l'on ne suit pas les conseils de <a href="http://en.wikipedia.org/wiki/Scott_Meyers">Scott Meyers</a> présentés dans son livre <a href="http://www.amazon.com/Effective-Specific-Addison-Wesley-Professional-Computing/dp/0201924889">Effective C++</a>.</p></li></ul><p id="r-529151" data-claire-element-id="529151">La liste est encore longue. Pour plus de détails, je vous renvoie à la <a href="http://gcc.gnu.org/onlinedocs/">documentation de GCC</a> où vous pourrez trouver une centaine d'autres options plus ou moins intéressantes pour augmenter le niveau d'avertissement de votre compilateur.</p><p id="r-529152" data-claire-element-id="529152">Personnellement, j'utilise toujours beaucoup de <em>warnings</em> pour mes programmes afin de minimiser les erreurs de programmation. Voici ma liste d'options :</p><pre id="r-529153" data-claire-element-id="529153"><code data-claire-semantic="console">-pedantic -Wall -Wextra -Wold-style-cast -Woverloaded-virtual -Wfloat-equal 
-Wwrite-strings -Wpointer-arith -Wcast-qual -Wcast-align -Wconversion 
-Wshadow -Weffc++ -Wredundant-decls -Wdouble-promotion -Winit-self -Wswitch-default 
-Wswitch-enum -Wundef -Wlogical-op -Winline</code></pre><p id="r-529154" data-claire-element-id="529154">Cela fait beaucoup, mais c'est pour la bonne cause. :p</p><h2 id="r-pour-les-masochistes" data-claire-element-id="529159">Pour les masochistes</h2><p id="r-529157" data-claire-element-id="529157">Finalement, sachez qu'il est possible de convertir les messages d'avertissement en messages d'erreur. Votre code ne pourra alors compiler que si vous n'avez aucun <em>warning</em>. Pour ce faire, il faut activer l'option <strong>-Werror</strong>. <br/> Et si vraiment vous êtes paranoïaques, vous pouvez demander à GCC de s'arrêter à la première erreur plutôt que d'essayer de continuer un peu plus loin et d'afficher toutes les erreurs rencontrées. Dans ce cas, il faut utiliser l'option <strong>-Wfatal-errors</strong>.</p><p id="r-529158" data-claire-element-id="529158">Voyons maintenant une deuxième catégorie d'options de compilation : les optimisations.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g">[C++] Maîtriser le compilateur g++</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/bref-rappel-sur-le-fonctionnement-du-compilateur">
Bref rappel sur le fonctionnement du compilateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/changer-les-options-de-compilation">
Changer les options de compilation
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/plus-de-warnings">
Plus de warnings !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/optimiser-son-programme">
Optimiser son programme
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/changer-les-options-de-compilation">
<span class="arrow"></span>
<span class="next">Changer les options de compilation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/optimiser-son-programme">
<span class="next">Optimiser son programme</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Optimisersonprogramme"></a><h2>Optimiser son programme</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/plus-de-warnings">
<span class="arrow"></span>
<span class="next">Plus de warnings !</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-529161" data-claire-element-id="529161">Lorsqu'un programme est terminé et fonctionne conformément aux spécifications, les programmeurs attaquent la dernière étape : l'optimisation. C'est une tâche difficile et ce cours n'est pas là pour enseigner comment faire. Je vais juste vous présenter les options de base de g++ dans ce domaine.</p><aside id="r-529163" data-claire-element-id="529163" data-claire-semantic="warning"><p id="r-529162" data-claire-element-id="529162">Attention : il faut avoir acquis une certaine expérience pour utiliser les options d'optimisation les plus avancées.</p></aside><h2 id="r-optimiser-la-taille-de-son-programme" data-claire-element-id="529167">Optimiser la taille de son programme</h2><p id="r-529164" data-claire-element-id="529164">Optimiser un programme ne signifie pas nécessairement le faire aller plus vite. On a parfois envie de minimiser la taille qu'il prend en mémoire. C'est le cas des gens qui travaillent sur des micro-contrôleurs ou des systèmes embarqués, par exemple. Bien sûr, cela se fait parfois au détriment de la vitesse du programme. On ne peut pas gagner à la fois sur la vitesse et l'utilisation de la mémoire. ;)</p><p id="r-529165" data-claire-element-id="529165">L'option principale de g++ pour diminuer la taille de l'exécutable est <strong>-Os</strong>. Par exemple, le <a href="http://www.siteduzero.com/tutoriel-3-452334-tp-la-poo-en-pratique-avec-zfraction.html">TP ZFraction</a> du <a href="http://www.siteduzero.com/tutoriel-3-11406-programmez-avec-le-langage-c.html">cours officiel</a> a une taille de 14 415 octets sans options, et une taille de 14 283 octets avec l'option <strong>-Os</strong> activée. La différence ici est assez minime, mais comme ce programme n'est pas très gros, il n'y a pas non plus énormément de place à gagner. ;)</p><p id="r-529166" data-claire-element-id="529166">L'autre option importante est <strong>-s</strong> qui supprime toutes les informations de débogage de l'exécutable. Il devient alors plus difficile d'utiliser un débogueur ou des outils comme <em>valgrind</em> pour analyser son programme. Mais comme on est dans la phase d'optimisation, ce n'est normalement plus le moment de chercher des erreurs. Tout doit déjà fonctionner correctement. Avec l'option <strong>-s</strong>, le TP ZFraction a une taille de seulement 10 392 octets. La différence semble importante, mais c'est à nouveau un résultat faussé puisque le programme est très court mais possède beaucoup de fonctions. Sachez simplement que la plupart des programmes que vous installez sur votre ordinateur ont été compilés avec l'option <strong>-s</strong>.</p><h2 id="r-optimiser-la-vitesse" data-claire-element-id="529176">Optimiser la vitesse</h2><p id="r-529168" data-claire-element-id="529168">L'autre catégorie d'optimisation est bien sûr la recherche de vitesse.</p><p id="r-529169" data-claire-element-id="529169">Votre compilateur favori propose trois niveaux d'optimisation, <strong>-O1</strong>, <strong>-O2</strong> et <strong>-O3</strong>, du moins optimisé au plus rapide. Les programmes générés seront en général de plus en plus gros et, surtout, la compilation devient de plus en plus longue au fur et à mesure que l'on monte dans les niveaux. <br/> Mais comme l'optimisation n'est pas une science exacte, il arrive souvent que le meilleur niveau soit <strong>-O2</strong>, le dernier pouvant parfois introduire des erreurs dans le code généré ou simplement ne pas être le plus rapide. <strong>-O2</strong> est donc très souvent le meilleur choix à faire. À vous de tester, cela dépend énormément des algorithmes utilisés et de la manière dont vous accédez à la mémoire.</p><p id="r-529170" data-claire-element-id="529170">Il existe ensuite un très grand nombre d'options permettant d'optimiser des points particuliers, tels que l'ordre d'exécution des boucles imbriquées ou la manière dont les fonctions sont « <em>inlinées</em> ». À nouveau, la documentation vous permettra de faire vos choix parmi le nombre considérable d'options.</p><p id="r-529171" data-claire-element-id="529171">Personnellement, j'essaie toujours d'utiliser les options suivantes pour les versions <em>release</em> de mes programmes :</p><pre id="r-529172" data-claire-element-id="529172"><code data-claire-semantic="console">-O2 -s</code></pre><p id="r-529173" data-claire-element-id="529173">Il faut ensuite jouer un peu avec d'autres options pour essayer de grappiller un peu plus de performance, mais, comme je vous l'ai dit, l'optimisation est une tâche difficile qui dépend non seulement du programme, mais aussi de la machine sur laquelle le programme est exécuté. Sachez simplement que ces options existent et où trouver les informations nécessaires.</p><p id="r-529174" data-claire-element-id="529174">Il existe encore bon nombre d'autres options, mais je pense avoir fait le tour des plus importantes d'entre elles. Si vous souhaitez en consulter la liste complète, je vous invite à aller faire un tour dans la <a href="http://gcc.gnu.org/onlinedocs/gcc/index.html">documentation officielle</a>, plus précisément <a href="http://gcc.gnu.org/onlinedocs/gcc/Option-Summary.html">ici</a>.</p><p id="r-529175" data-claire-element-id="529175">N'hésitez pas non plus à venir faire un tour sur les <a href="http://www.siteduzero.com/forum-81-237-langage-c.html">forums</a> pour discuter de ce texte et poser vos questions.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g">[C++] Maîtriser le compilateur g++</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/bref-rappel-sur-le-fonctionnement-du-compilateur">
Bref rappel sur le fonctionnement du compilateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/changer-les-options-de-compilation">
Changer les options de compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/plus-de-warnings">
Plus de warnings !
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/optimiser-son-programme">
Optimiser son programme
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/c-maitriser-le-compilateur-g/plus-de-warnings">
<span class="arrow"></span>
<span class="next">Plus de warnings !</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/c-maitriser-le-compilateur-g.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 03:09:27 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/c-maitriser-le-compilateur-g.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:41:48 GMT -->
</html>