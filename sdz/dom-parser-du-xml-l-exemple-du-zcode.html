<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/dom-parser-du-xml-l-exemple-du-zcode.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 19:59:17 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/dom-parser-du-xml-l-exemple-du-zcode.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:44:26 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : [DOM] Parser du XML - L&#039;exemple du zCode</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : [DOM] Parser du XML - L&#039;exemple du zCode</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#DOMParserduXML-L039exempleduzCode">[DOM] Parser du XML - L&#039;exemple du zCode</a><br/><a href="#Avantdecommencer">Avant de commencer</a><br/><a href="#ladcouvertedeDOM">À la découverte de DOM</a><br/><a href="#Labased039unparseur">La base d&#039;un parseur</a><br/><a href="#Allerplusloin">Aller plus loin</a><br/></div>
<a name="DOMParserduXML-L039exempleduzCode"></a><h2>[DOM] Parser du XML - L&#039;exemple du zCode</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/avant-de-commencer-19">
<span class="next">Avant de commencer</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-416530" data-claire-element-id="416530">Bonjour à tous, chers Zéros !</p><p id="r-416531" data-claire-element-id="416531">Si vous vous demandez ce qu'est un <strong><em>parseur</em></strong> (ou « <em>parser</em> ») XML, à quoi cela peut bien servir ou encore comment élaborer un langage comme le zCode, ce tutoriel est fait pour vous. ^^</p><p id="r-416532" data-claire-element-id="416532">Nous aborderons ensemble les bases du parsage en XML à travers la mise en place d'un système de parsage pour le zCode ! Mais je vous sens intrigués, pleins de fougue et d'entrain : entrons donc sans plus tarder dans le vif du sujet. ;)</p>
</div><a name="Avantdecommencer"></a><h2>Avant de commencer</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/a-la-decouverte-de-dom">
<span class="next">À la découverte de DOM</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-prerequis-20" data-claire-element-id="416534">Prérequis</h2><p id="r-416533" data-claire-element-id="416533">Avant de mettre les mains dans le cambouis, je tiens à vous avertir qu'il vous faut avoir suivi <strong>en entier</strong><a href="http://www.siteduzero.com/tuto-3-4-0-un-site-dynamique-avec-php.html">le cours de M@teo21 sur le PHP</a> (expressions régulières comprises) ainsi que le tuto de Tangui <a href="http://www.siteduzero.com/tuto-3-2882-1-le-point-sur-xml.html">qui introduit le langage XML</a>.</p><h2 id="r-un-parseur-xml" data-claire-element-id="416554">Un parseur XML…</h2><h3 id="r-qu-est-ce-que-c-est-22" data-claire-element-id="416538">… qu'est-ce que c'est ?</h3><p id="r-416535" data-claire-element-id="416535">Si vous avez lu les chapitres concernant les Regex, vous avez codé <a href="http://www.siteduzero.com/tuto-3-170-1-les-expressions-regulieres-partie-2-2.html#ss_part_4">un parseur pour le bbcode</a>. En réalité, un parseur XML fait exactement la même chose, à la différence près que le langage à parser est fondé sur du XML. Le parseur est chargé de traduire le code XML en XHTML : il s'agit donc d'un script PHP qui va réaliser cette transformation.</p><aside id="r-416537" data-claire-element-id="416537" data-claire-semantic="information"><p id="r-416536" data-claire-element-id="416536">« Parseur » est le mot francisé de « <em>parser</em> » en anglais. On parle aussi d'analyseur syntaxique.</p></aside><h3 id="r-pourquoi-xml" data-claire-element-id="416553">Pourquoi XML ?</h3><p id="r-416539" data-claire-element-id="416539">En plus des avantages du parsage en général, un parseur XML offre son (gros) lot d'avantages. En effet, grâce à <strong>l'API DOM</strong> intégré à PHP5, on peut non seulement élaborer très facilement un parseur, mais aussi gérer des fonctionnalités plus poussées de ce langage. :) <br/> Voici une liste non exhaustive des atouts de DOM par rapport aux Regex :</p><ul id="r-416546" data-claire-element-id="416546"><li id="r-416541" data-claire-element-id="416541"><p id="r-416540" data-claire-element-id="416540">plus « subtil » ;</p></li><li id="r-416543" data-claire-element-id="416543"><p id="r-416542" data-claire-element-id="416542">plus complet ;</p></li><li id="r-416545" data-claire-element-id="416545"><p id="r-416544" data-claire-element-id="416544">permet de gérer des fichiers XML (sauvegarde, ouverture, fermeture).</p></li></ul><p id="r-416547" data-claire-element-id="416547"><strong>La seule contrainte de DOM est qu'il faut respecter les règles élémentaires du XML</strong> (balises entre chevrons, etc.).</p><p id="r-416548" data-claire-element-id="416548">Dites, ça ne vous fait pas penser à un langage existant, ce genre de système ? :-° <br/> Mais si ! Le <strong>zCode</strong> ! Effectivement, le zCode utilise DOM et le XML pour parser ses messages (<a href="http://www.siteduzero.com/savoirplus.html#technologies">consultez cette page pour en avoir la confirmation</a>). Au final, votre langage ressemblera peut-être au zCode. Nous nous fonderons sur ce dernier pour illustrer l'utilisation de DOM.</p><p id="r-416549" data-claire-element-id="416549">J'utiliserai des balises spécifiques au zCode. Pour nos visiteurs qui ne seraient pas encore familiers avec ce langage, voici (« Encore ? », me direz-vous) <a href="http://www.siteduzero.com/tuto-3-198-1-bien-utiliser-le-zcode.html">un peu de lecture.</a></p><aside id="r-416551" data-claire-element-id="416551" data-claire-semantic="warning"><p id="r-416550" data-claire-element-id="416550">DOM n'est disponible que pour PHP5. Son prédécesseur DOM XML (PHP4) et lui n'ont pas grand-chose en commun, bien que le principe reste le même.</p></aside><p id="r-416552" data-claire-element-id="416552">Jetez <a href="http://www.siteduzero.com/tuto-3-2882-1-le-point-sur-xml.html#ss_part_9">un coup d'œil à cette brève présentation de DOM</a>, puis découvrons ensemble la magie du parsage XML. :magicien:</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode">[DOM] Parser du XML - L&#039;exemple du zCode</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/avant-de-commencer-19">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/a-la-decouverte-de-dom">
À la découverte de DOM
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/la-base-d-un-parseur">
La base d&#039;un parseur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/aller-plus-loin-32">
Aller plus loin
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/a-la-decouverte-de-dom">
<span class="next">À la découverte de DOM</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="ladcouvertedeDOM"></a><h2>À la découverte de DOM</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/avant-de-commencer-19">
<span class="arrow"></span>
<span class="next">Avant de commencer</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/la-base-d-un-parseur">
<span class="next">La base d&#039;un parseur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-but-de-cette-partie" data-claire-element-id="416559">But de cette partie</h2><p id="r-416556" data-claire-element-id="416556">L'objectif est de vous initier à DOM en parsant une balise <code data-claire-semantic="xml">&lt; gras&gt; </code>. Ce n'est peut-être pas encore le nirvana, mais il s'agit d'un passage nécessaire avant de réaliser dans la prochaine partie un parseur digne de ce nom.</p><aside id="r-416558" data-claire-element-id="416558" data-claire-semantic="information"><p id="r-416557" data-claire-element-id="416557">Vous pouvez intégrer les feuilles de style du SdZ afin d'obtenir un résultat très fidèle au rendu de ce dernier.</p></aside><h2 id="r-chargeons-le-xml" data-claire-element-id="416578">Chargeons le XML</h2><p id="r-416560" data-claire-element-id="416560">Comment charger du XML pour l'utiliser dans DOM ? C'est ce que nous allons voir.</p><h3 id="r-la-notion-d-arbre-xml" data-claire-element-id="416563">La notion d'arbre XML</h3><p id="r-416561" data-claire-element-id="416561">Ce terme désigne l'arborescence d'un langage XML, c'est-à-dire l'enchaînement de nœuds qui s'imbriquent les uns dans les autres. DOM se sert de cet arbre pour fonctionner : on dit qu'il adopte un fonctionnement <strong>hiérarchique</strong>. Ci-dessous, un exemple d'arbre XML.</p><pre id="r-416562" data-claire-element-id="416562"><code data-claire-semantic="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
&lt;zcode&gt;
        &lt;gras&gt;Bonjour&lt;/gras&gt;, ça va ?
        &lt;couleur nom=&quot;rouge&quot;&gt;Très bien, merci.&lt;/couleur&gt;
        &lt;liste&gt;
                &lt;puce&gt;Et tes enfants ?&lt;/puce&gt;
                &lt;puce&gt;Ils passent trop de temps sur le SdZ. :)&lt;/puce&gt;
        &lt;/liste&gt;
&lt;/zcode&gt;</code></pre><h3 id="r-recuperer-du-contenu-xml" data-claire-element-id="416577">Récupérer du contenu XML</h3><p id="r-416564" data-claire-element-id="416564">Nous allons voir comment récupérer cet arbre avec DOM. Cette étape est <strong>indispensable</strong>.</p><aside id="r-416566" data-claire-element-id="416566" data-claire-semantic="information"><p id="r-416565" data-claire-element-id="416565">DOM est orienté objet. Par conséquent, il comporte forcément des classes et des méthodes que nous allons utiliser. Nous allons nous familiariser avec ces classes au fur et à mesure de notre progression dans ce tutoriel.</p></aside><p id="r-416567" data-claire-element-id="416567">On commence par initialiser deux éléments : le premier est le document XML chargé par DOM, le second est la chaîne de caractères qui va contenir le code XHTML à afficher (cet élément est facultatif).</p><pre id="r-416568" data-claire-element-id="416568"><code data-claire-semantic="html+php">&lt;?php
$document_xml = new DomDocument(); // Instanciation de la classe DomDocument : création d'un nouvel objet
$resultat_html = ''; // Initialisation de la chaîne qui contient le résultat
?&gt;</code></pre><p id="r-416569" data-claire-element-id="416569">On voit que le premier type de classe que nous utilisons est DomDocument : il s'agit d'un document DOM . ;) <br/> Pour l'instant, $document_xml est vide : il faut donc le remplir avec du XML. On peut le faire de deux manières.</p><p id="r-416570" data-claire-element-id="416570">Imaginons que vous ayez un fichier <em>zcode.xml</em> dans le même dossier que votre script ; il vous faut l'ouvrir avec DOM. Pour cela, on utilise la méthode load (c'est une méthode DomDocument, bien entendu).</p><pre id="r-416571" data-claire-element-id="416571"><code data-claire-semantic="html+php">&lt;?php
$document_xml-&gt;load('zcode.xml'); // Chargement à partir de zcode.xml
?&gt;</code></pre><p id="r-416572" data-claire-element-id="416572">Vous remarquez que l'on obtient la méthode load grâce à « -&gt; » : il en sera de même pour les variables d'un objet.</p><p id="r-416573" data-claire-element-id="416573">On peut faire la même chose à partir d'une chaîne de caractères tout à fait banale.</p><pre id="r-416574" data-claire-element-id="416574"><code data-claire-semantic="html+php">&lt;?php
$chaine_xml = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;? &gt;
&lt;zcode&gt;&lt;gras&gt;Bonjour&lt;/gras&gt;, ça va ?
&lt;couleur nom=&quot;rouge&quot;&gt;Très bien, merci.&lt;/couleur&gt;
&lt;liste&gt;
&lt;puce&gt;Et tes enfants ?&lt;/puce&gt;
&lt;puce&gt;Ils passent trop de temps sur le SdZ. :)&lt;/puce&gt;
&lt;/liste&gt;
&lt;/zcode&gt;'; // Chaîne de caractères contenant le texte XML à parser.
 $document_xml-&gt;loadXML($chaine_xml); // On charge du XML à partir de $chaine_xml.
?&gt;</code></pre><p id="r-416575" data-claire-element-id="416575">Vous pouvez aussi sauvegarder une chaîne de caractères XML dans un fichier.</p><pre id="r-416576" data-claire-element-id="416576"><code data-claire-semantic="html+php">&lt;?php
$document_xml-&gt;save('un_nouveau_fichier_xml.xml');
?&gt;</code></pre><h2 id="r-comment-recuperer-des-balises" data-claire-element-id="416701">Comment récupérer des balises ?</h2><p id="r-416579" data-claire-element-id="416579">Nous avons chargé le XML : comment récupérer les balises afin de les parser ?</p><h3 id="r-la-notion-de-noeud" data-claire-element-id="416608">La notion de nœud</h3><p id="r-416580" data-claire-element-id="416580">Un nœud est un <strong>élément de l'arbre XML</strong>. Dans notre exemple, on peut distinguer les nœuds <em>zcode</em>, <em>gras</em>, <em>couleur</em>, <em>liste</em>, <em>nom</em>, etc.</p><p id="r-416581" data-claire-element-id="416581">Un nœud peut donc être :</p><ul id="r-416590" data-claire-element-id="416590"><li id="r-416583" data-claire-element-id="416583"><p id="r-416582" data-claire-element-id="416582">un ensemble de balises qui vont par paires (<code data-claire-semantic="xml">&lt;zcode&gt;&lt;/zcode&gt; </code>) ;</p></li><li id="r-416585" data-claire-element-id="416585"><p id="r-416584" data-claire-element-id="416584">un contenu textuel (à l'intérieur de balises <code data-claire-semantic="xml">&lt; gras&gt;&lt;/ gras&gt; </code>, par exemple) ;</p></li><li id="r-416587" data-claire-element-id="416587"><p id="r-416586" data-claire-element-id="416586">l'attribut d'une balise (son nom) ;</p></li><li id="r-416589" data-claire-element-id="416589"><p id="r-416588" data-claire-element-id="416588">la valeur de l'attribut (entre guillemets).</p></li></ul><p id="r-416591" data-claire-element-id="416591">Quand on parle du nœud <em>zcode</em>, on parle de tout ce qui se trouve entre <code data-claire-semantic="xml">&lt;zcode&gt; </code> et <code data-claire-semantic="xml">&lt;/zcode&gt; </code> :</p><pre id="r-416592" data-claire-element-id="416592"><code data-claire-semantic="xml">&lt;gras&gt;Bonjour&lt;/gras&gt;, ça va ?
&lt;couleur nom=&quot;rouge&quot;&gt;Très bien, merci.&lt;/couleur&gt;
&lt;liste&gt;
        &lt;puce&gt;Et tes enfants ?&lt;/puce&gt;
        &lt;puce&gt;Ils passent trop de temps sur le SdZ. :)&lt;/puce&gt;
&lt;/liste&gt;</code></pre><p id="r-416593" data-claire-element-id="416593">Le nœud <em>gras</em>, quant à lui, contient :</p><pre id="r-416594" data-claire-element-id="416594"><code data-claire-semantic="xml">Bonjour</code></pre><aside id="r-416596" data-claire-element-id="416596" data-claire-semantic="information"><p id="r-416595" data-claire-element-id="416595">En fait, <em>gras</em> contient un nœud textuel appelé <em>#text</em>, qui lui contient bien uniquement une valeur « Bonjour ».</p></aside><p id="r-416597" data-claire-element-id="416597">On distingue différentes catégories de nœuds, définies selon leur organisation.</p><ul id="r-416606" data-claire-element-id="416606"><li id="r-416599" data-claire-element-id="416599"><p id="r-416598" data-claire-element-id="416598"><strong>Nœud racine :</strong> c'est celui qui englobe le contenu du fichier XML. Ici, il s'agit de <em>zcode</em>. Il ne peut y avoir qu'un nœud racine par document.</p></li><li id="r-416601" data-claire-element-id="416601"><p id="r-416600" data-claire-element-id="416600"><strong>Nœud parent :</strong> on parle du nœud qui englobe le nœud dont on parle. Pour nous, le nœud parent de <em>puce</em> est <em>liste</em>, celui de <em>liste</em> est <em>zcode</em>. Notez bien que <em>nom</em> a pour nœud parent <em>couleur</em>.</p></li><li id="r-416603" data-claire-element-id="416603"><p id="r-416602" data-claire-element-id="416602"><strong>Nœud associé :</strong> on utilise ce terme pour désigner les attributs. Le nœud associé de <em>couleur</em> est <em>nom</em>. En revanche, <em>liste</em> n'a pas de nœud associé.</p></li><li id="r-416605" data-claire-element-id="416605"><p id="r-416604" data-claire-element-id="416604"><strong>Nœud enfant :</strong> on veut parler des nœuds compris dans le nœud dont on parle. Par exemple, le nœud enfant de <em>liste</em> est <em>puce</em>. Notez que le nœud enfant de <em>nom</em> est <em>rouge</em> : cela désigne aussi les valeurs des attributs.</p></li></ul><p id="r-416607" data-claire-element-id="416607">On peut également les distinguer selon leur type (nœud textuel, attribut, etc).</p><h3 id="r-dom-un-veritable-sac-de-noeuds" data-claire-element-id="416682">DOM : un véritable sac de nœuds</h3><p id="r-416609" data-claire-element-id="416609">DOM repose <strong>entièrement</strong> sur les nœuds, et vous serez inexorablement amenés à les utiliser. DOM « découpe les nœuds » et les trie selon leur position dans l'arbre XML.</p><table id="r-416675" data-claire-element-id="416675"><thead id="r-416617" data-claire-element-id="416617"><tr id="r-416616" data-claire-element-id="416616"><th id="r-416611" data-claire-element-id="416611"><p id="r-416610" data-claire-element-id="416610">Nom du nœud</p></th><th id="r-416613" data-claire-element-id="416613"><p id="r-416612" data-claire-element-id="416612">Caractéristiques du nœud</p></th><th id="r-416615" data-claire-element-id="416615"><p id="r-416614" data-claire-element-id="416614">Contenu du nœud</p></th></tr></thead><tbody id="r-416674" data-claire-element-id="416674"><tr id="r-416624" data-claire-element-id="416624"><td id="r-416619" data-claire-element-id="416619"><p id="r-416618" data-claire-element-id="416618">puce (no 2)</p></td><td id="r-416621" data-claire-element-id="416621"><p id="r-416620" data-claire-element-id="416620">Nœud enfant de <em>liste</em> et de <em>zcode</em>.<br/> A pour enfant un nœud <em>#text</em> invisible contenant le vrai texte.</p></td><td id="r-416623" data-claire-element-id="416623"><pre id="r-416622" data-claire-element-id="416622"><code data-claire-semantic="xml">Ils passent trop de temps sur le SdZ. :)</code></pre></td></tr><tr id="r-416631" data-claire-element-id="416631"><td id="r-416626" data-claire-element-id="416626"><p id="r-416625" data-claire-element-id="416625">puce (no 1)</p></td><td id="r-416628" data-claire-element-id="416628"><p id="r-416627" data-claire-element-id="416627">Nœud enfant de <em>liste</em> et de <em>zcode</em>.<br/> A pour enfant un nœud <em>#text</em> invisible contenant le vrai texte.</p></td><td id="r-416630" data-claire-element-id="416630"><pre id="r-416629" data-claire-element-id="416629"><code data-claire-semantic="xml">Et tes enfants ?</code></pre></td></tr><tr id="r-416638" data-claire-element-id="416638"><td id="r-416633" data-claire-element-id="416633"><p id="r-416632" data-claire-element-id="416632">liste</p></td><td id="r-416635" data-claire-element-id="416635"><p id="r-416634" data-claire-element-id="416634">Nœud enfant de <em>zcode</em>.<br/> Nœud parent de <em>puce</em>.</p></td><td id="r-416637" data-claire-element-id="416637"><pre id="r-416636" data-claire-element-id="416636"><code data-claire-semantic="xml">&lt;puce&gt;Et tes enfants ?&lt;/puce&gt;
&lt;puce&gt;Ils passent trop de temps sur le SdZ. :)&lt;/puce&gt;</code></pre></td></tr><tr id="r-416645" data-claire-element-id="416645"><td id="r-416640" data-claire-element-id="416640"><p id="r-416639" data-claire-element-id="416639">nom</p></td><td id="r-416642" data-claire-element-id="416642"><p id="r-416641" data-claire-element-id="416641">Nœud enfant de <em>couleur</em>.<br/> A pour enfant un nœud <em>#text</em> invisible contenant le vrai texte.</p></td><td id="r-416644" data-claire-element-id="416644"><pre id="r-416643" data-claire-element-id="416643"><code data-claire-semantic="xml">&lt;police nom=&quot;courrier&quot;&gt;rouge&lt;/police&gt;</code></pre></td></tr><tr id="r-416652" data-claire-element-id="416652"><td id="r-416647" data-claire-element-id="416647"><p id="r-416646" data-claire-element-id="416646">couleur</p></td><td id="r-416649" data-claire-element-id="416649"><p id="r-416648" data-claire-element-id="416648">Nœud enfant de <em>zcode</em>.<br/> A pour enfant un nœud <em>#text</em> invisible contenant le vrai texte.</p></td><td id="r-416651" data-claire-element-id="416651"><pre id="r-416650" data-claire-element-id="416650"><code data-claire-semantic="xml">Très bien, merci.</code></pre></td></tr><tr id="r-416659" data-claire-element-id="416659"><td id="r-416654" data-claire-element-id="416654"><p id="r-416653" data-claire-element-id="416653">Texte (sans nœud particulier)</p></td><td id="r-416656" data-claire-element-id="416656"><p id="r-416655" data-claire-element-id="416655">Nœud enfant de <em>zcode</em>.<br/> A pour enfant un nœud <em>#text</em> invisible contenant le vrai texte.</p></td><td id="r-416658" data-claire-element-id="416658"><pre id="r-416657" data-claire-element-id="416657"><code data-claire-semantic="xml">, ça va ?</code></pre></td></tr><tr id="r-416666" data-claire-element-id="416666"><td id="r-416661" data-claire-element-id="416661"><p id="r-416660" data-claire-element-id="416660">gras</p></td><td id="r-416663" data-claire-element-id="416663"><p id="r-416662" data-claire-element-id="416662">Nœud enfant de <em>zcode</em>.<br/> A pour enfant un nœud <em>#text</em> invisible contenant le vrai texte.</p></td><td id="r-416665" data-claire-element-id="416665"><pre id="r-416664" data-claire-element-id="416664"><code data-claire-semantic="xml">Bonjour</code></pre></td></tr><tr id="r-416673" data-claire-element-id="416673"><td id="r-416668" data-claire-element-id="416668"><p id="r-416667" data-claire-element-id="416667">zcode</p></td><td id="r-416670" data-claire-element-id="416670"><p id="r-416669" data-claire-element-id="416669">Nœud racine.</p></td><td id="r-416672" data-claire-element-id="416672"><pre id="r-416671" data-claire-element-id="416671"><code data-claire-semantic="xml">&lt;gras&gt;Bonjour&lt;/gras&gt;, ça va ?
&lt;couleur nom=&quot;rouge&quot;&gt;Très bien, merci.&lt;/couleur&gt;
&lt;liste&gt;
&lt;puce&gt;Et tes enfants ?&lt;/puce&gt;
&lt;puce&gt;Ils passent trop de temps sur le sdz :)&lt;/puce&gt;
&lt;/liste&gt;</code></pre></td></tr></tbody></table><p id="r-416676" data-claire-element-id="416676">Vous voyez que DOM décompose l'arbre XML en détaillant beaucoup. Tout ce qu'il nous reste à faire, c'est exploiter cette décomposition intelligemment. On peut également représenter une interprétation DOM sous la forme d'un arbre :</p><figure id="r-416678" data-claire-element-id="416679"><img id="r-416677" data-claire-element-id="416677" src="medias/uploads.siteduzero.com_files_89001_90000_89255.jpg" alt="Image utilisateur"/></figure><p id="r-416680" data-claire-element-id="416680"><em>Un document XML selon DOM</em></p><p id="r-416681" data-claire-element-id="416681">Vous comprenez à présent les appellations « arbre » et « nœud » : les programmeurs filent souvent la métaphore. ^^</p><h3 id="r-en-pratique-12" data-claire-element-id="416700">En pratique</h3><p id="r-416683" data-claire-element-id="416683">Récupérons le nœud <em>zcode</em>.</p><pre id="r-416684" data-claire-element-id="416684"><code data-claire-semantic="html+php">&lt;?php
$elements = $document_xml-&gt;getElementsByTagName('zcode');
?&gt;</code></pre><p id="r-416685" data-claire-element-id="416685">Nous utilisons getElementsByTagName, ce qui signifie <em>obtenirElementsParNomDeBalise</em>. On récupère ainsi le nœud <em>zcode</em> (il n'y en a qu'un car c'est le nœud racine).</p><p id="r-416686" data-claire-element-id="416686">Cette méthode retourne un objet de type DomNodeList. C'est une classe qui a pour caractéristique de lister des nœuds.</p><aside id="r-416688" data-claire-element-id="416688" data-claire-semantic="warning"><p id="r-416687" data-claire-element-id="416687">Ce ne sont pas des <em>array</em> ! On ne peut pas obtenir les entrées avec des crochets ! Par contre, on peut se servir de la structure foreach.</p></aside><p id="r-416689" data-claire-element-id="416689">Pour récupérer des éléments d'une instance de DomNodeList, vous devez utiliser la méthode item. Exemple :</p><pre id="r-416690" data-claire-element-id="416690"><code data-claire-semantic="html+php">&lt;?php
$premier_element_liste = $liste_dom-&gt;item(0);
?&gt;</code></pre><p id="r-416691" data-claire-element-id="416691">Les DomNodeList sont composées d'objets de type DomNode. DomNode est une classe qui représente un nœud. Si, par exemple, vous récupériez les nœuds <em>puce</em>, vous pourriez les obtenir avec foreach.</p><pre id="r-416692" data-claire-element-id="416692"><code data-claire-semantic="html+php">&lt;?php
foreach($elements as $element)
{
        // Effectuez les opérations sur $element
}
?&gt;</code></pre><p id="r-416693" data-claire-element-id="416693">Mais nous ne ferons pas comme cela, pour la simple et bonne raison qu'avec cette méthode, on parse par nom de balise, mais pas dans l'ordre du texte. o_O Essayez, vous verrez !<br/> Nous récupérerons donc <em>zcode</em> avec item, car comme il n'y a qu'un nœud <em>zcode</em>, il est forcément le premier (et le seul) élément de la liste.</p><pre id="r-416694" data-claire-element-id="416694"><code data-claire-semantic="html+php">&lt;?php
$element = $elements-&gt;item(0); // On obtient le nœud zcode
$enfants = $element-&gt;childNodes; // On récupère les nœuds enfants de zcode avec childNodes
?&gt;</code></pre><p id="r-416695" data-claire-element-id="416695">ChildNodes est une variable d'instance contenant les enfants de <em>zcode</em> sous forme d'une liste DOMNodeList. Le reste coule de source : nous allons prendre chaque nœud enfant séparément, l'analyser et le parser en fonction du type de nœud rencontré.<br/> Pour ce faire, je dois préciser que DomNode dispose de deux variables qui contiennent respectivement le nom du nœud et son contenu : ce sont nodeName et nodeValue. De plus, chaque élément de texte « banal » s'appelle <em>#text</em>.</p><pre id="r-416696" data-claire-element-id="416696"><code data-claire-semantic="html+php">&lt;?php
$element = $elements-&gt;item(0); // On obtient le nœud zcode
$enfants = $element-&gt;childNodes; // On récupère les nœuds enfants de zcode avec childNodes
                
foreach($enfants as $enfant) // On prend chaque nœud enfant séparément
{
      $nom = $enfant-&gt;nodeName; // On prend le nom de chaque nœud
                
      if ($nom == 'gras')
      {
            $resultat_html .= '&lt;strong&gt;'.$enfant-&gt;nodeValue.'&lt;/strong&gt;';
      }
      elseif($nom == '#text')
      {
            $resultat_html .= $enfant-&gt;nodeValue;
      }
      else
      {
            $resultat_html .= $enfant-&gt;nodeValue;
      }
} ?&gt;</code></pre><aside id="r-416698" data-claire-element-id="416698" data-claire-semantic="information"><p id="r-416697" data-claire-element-id="416697">Peut-être ne connaissez-vous pas le signe « .= » : il ajoute quelque chose à une variable. Écrire <strong>$truc.= 'machin';</strong> revient à écrire <strong>$truc = $truc . 'machin';</strong> .</p></aside><p id="r-416699" data-claire-element-id="416699">Nous avons réalisé quelque chose d'assez complexe, il faut bien le dire. Mais c'est maintenant que le vrai travail commence ! :o</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode">[DOM] Parser du XML - L&#039;exemple du zCode</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/avant-de-commencer-19">
Avant de commencer
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/a-la-decouverte-de-dom">
À la découverte de DOM
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/la-base-d-un-parseur">
La base d&#039;un parseur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/aller-plus-loin-32">
Aller plus loin
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/avant-de-commencer-19">
<span class="arrow"></span>
<span class="next">Avant de commencer</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/la-base-d-un-parseur">
<span class="next">La base d&#039;un parseur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Labased039unparseur"></a><h2>La base d&#039;un parseur</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/a-la-decouverte-de-dom">
<span class="arrow"></span>
<span class="next">À la découverte de DOM</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/aller-plus-loin-32">
<span class="next">Aller plus loin</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-416703" data-claire-element-id="416703">C'est bien beau de pouvoir mettre en gras votre texte, mais ce n'est pas cela qui va nous faire avancer ; l'exemple précédent avait seulement pour objectif de vous faire assimiler la technique de base. Qu'attendons-nous pour passer à la vitesse supérieure, que diable ? :p <br/> C'est à partir de maintenant que cela devient très intéressant.</p><h2 id="r-une-veritable-strategie" data-claire-element-id="416716">Une véritable stratégie</h2><p id="r-416704" data-claire-element-id="416704">Décrivons d'abord le principe de base de notre parseur.</p><figure id="r-416706" data-claire-element-id="416707"><img id="r-416705" data-claire-element-id="416705" src="medias/uploads.siteduzero.com_files_63001_64000_63803.png" alt="Fonctionnement du parseur"/></figure><p id="r-416708" data-claire-element-id="416708"><em>Principe de notre parseur xml</em></p><p id="r-416709" data-claire-element-id="416709">Vous saisissez l'idée principale, non ? En fait, ce système permet :</p><ul id="r-416714" data-claire-element-id="416714"><li id="r-416711" data-claire-element-id="416711"><p id="r-416710" data-claire-element-id="416710">de parcourir <strong>tout</strong> l'arbre XML dans l'ordre de lecture, et ce quel que soit le nombre d'enfants ou de ramifications ;</p></li><li id="r-416713" data-claire-element-id="416713"><p id="r-416712" data-claire-element-id="416712">de ne parser que des nœuds dont le contenu a déjà été traité, pour éviter « d'oublier » des nœuds.</p></li></ul><p id="r-416715" data-claire-element-id="416715">Ce système se fonde sur trois fonctions principales.</p><h2 id="r-les-fonctions-24" data-claire-element-id="416731">Les fonctions</h2><h3 id="r-parsage-nom-document" data-claire-element-id="416719">parsage($nom_document)</h3><p id="r-416717" data-claire-element-id="416717">Dans un premier temps, on récupère tous les éléments enfants <strong>directs</strong> du nœud racine <em>zcode</em>. Là, c'est très simple : nous savons que <em>zcode</em> contient <em>forcément</em> des enfants, ou alors c'est que vous n'avez strictement rien mis entre <code data-claire-semantic="xml">&lt;zcode&gt; </code> et <code data-claire-semantic="xml">&lt;/zcode&gt; </code>. Partant de ce principe, nous allons envoyer <em>zcode</em> vers la fonction parsage_enfant, qui se charge de parcourir l'arbre XML.</p><pre id="r-416718" data-claire-element-id="416718"><code data-claire-semantic="html+php">&lt;?php
function parsage($document)
{
        $document_xml = new DomDocument;
        $document_xml-&gt;load($document);
        $elements = $document_xml-&gt;getElementsByTagName('zcode');
        $resultat_html = '';
        $arbre = $elements-&gt;item(0);
 
        $resultat_html = parsage_enfant($arbre);
 
        return $resultat_html;
}
?&gt;</code></pre><h3 id="r-parsage-normal-noeud-contenu-a-inserer" data-claire-element-id="416727">parsage_normal($noeud, $contenu_a_inserer)</h3><p id="r-416720" data-claire-element-id="416720">Cette fonction est primordiale : c'est en fait la seule « vraie » fonction de parsage ( :D ) , car c'est la seule qui va vraiment remplacer les balises zcode en HTML. Cette fonction renvoie invariablement un nœud parsé.</p><p id="r-416721" data-claire-element-id="416721">Nous allons dresser trois tableaux : le premier pour les balises ouvrantes (<code data-claire-semantic="html">&lt;strong&gt; </code>, <code data-claire-semantic="html">&lt;span couleur=&quot;$1&quot;&gt; </code>, etc), le deuxième pour les balises fermantes (<code data-claire-semantic="html">&lt;/strong&gt; </code>, <code data-claire-semantic="html">&lt;/span&gt; </code>, <code data-claire-semantic="html">&lt;/div&gt; </code>, etc), le troisième pour les attributs qui correspondent à une balise (<code data-claire-semantic="xml">&lt;couleur&gt; </code> =&gt; nom, <code data-claire-semantic="xml">&lt;taille&gt; </code> =&gt; valeur, etc.). On utilisera str_replace pour placer les attributs dans la première balise ($1 pour le premier attribut, $2 pour le second). On devra également prendre en compte la balise <code data-claire-semantic="html">&lt;image/&gt; </code> qui fonctionne un peu différemment.</p><p id="r-416722" data-claire-element-id="416722">Je dois également mentionner le cas où nous devrons parfois parser une balise dont le contenu a déjà été parsé par d'autres fonctions. Dans ce cas, nous voulons récupérer le code HTML déjà créé et parsé. Nous devons donc ajouter une seconde variable de fonction ($contenu_a_inserer) pour parer à cette éventualité.</p><p id="r-416723" data-claire-element-id="416723">Enfin, nous allons nous occuper des attributs. Pour récupérer l'attribut d'un nœud (de classe DomNode), on récupère la variable attributes qui est de type DomNameNodeMap. Pour obtenir un attribut sous forme de nœud (DomNode), on utilise la méthode getNamedItem($nom_de_lattribut). Je vous recommande également de vous servir de la méthode hasAttributes sur un nœud pour savoir s'il contient des attributs. Elle renvoie true s'il y en a et false s'il n'y en a pas.</p><p id="r-416724" data-claire-element-id="416724">Ultime précision : les dernières lignes concernent le saut de ligne. Je l'ai empêché à l'intérieur des <code data-claire-semantic="html">&lt;li&gt; </code> et autres <code data-claire-semantic="html">&lt;ul&gt; </code> pour éviter quelques bugs. :)</p><pre id="r-416725" data-claire-element-id="416725"><code data-claire-semantic="html+php">&lt;?php
function parsage_normal($noeud, $contenu_a_inserer='')
{
     $balise_1 = array('gras' =&gt; '&lt;strong&gt;',
                                'italique' =&gt; '&lt;span class=&quot;italique&quot;&gt;',
                                'position' =&gt; '&lt;div class=&quot;$1&quot;&gt;',
                                'flottant' =&gt; '&lt;div class=&quot;flot_$1&quot;&gt;',
                                'taille' =&gt; '&lt;span class=&quot;$1&quot;&gt;',
                                'couleur' =&gt; '&lt;span class=&quot;$1&quot;&gt;',
                                'police' =&gt; '&lt;span class=&quot;$1&quot;&gt;',
                                'attention' =&gt; '&lt;span class=&quot;rmq $1&quot;&gt;',
                                'liste' =&gt; '&lt;ul&gt;',
                                'puce' =&gt; '&lt;li&gt;',
                                'lien' =&gt; '&lt;a href=&quot;$1&quot;&gt;',
                                'image' =&gt; '&lt;img src=&quot;$1&quot; alt=&quot;$2&quot; /&gt;',
                                'citation' =&gt; '&lt;span class=&quot;citation&quot;&gt;',
                                '#text' =&gt; ''); // Tableau des balises ouvrantes
                                                
$balise_2 = array('gras' =&gt; '&lt;/strong&gt;',
                                'italique' =&gt; '&lt;/span&gt;',
                                'position' =&gt; '&lt;/div&gt;',
                                'flottant' =&gt; '&lt;/div&gt;',
                                'taille' =&gt; '&lt;/span&gt;',
                                'couleur' =&gt; '&lt;/span&gt;',
                                'police' =&gt; '&lt;/span&gt;',
                                'attention' =&gt; '&lt;/span&gt;',
                                'information' =&gt; '&lt;/span&gt;',
                                'liste' =&gt; '&lt;/ul&gt;',
                                'puce' =&gt; '&lt;/li&gt;',
                                'lien' =&gt; '&lt;/a&gt;',
                                'image' =&gt; '',
                                'citation' =&gt; '&lt;/span&gt;',
                                '#text' =&gt; ''); // Tableau des balises fermantes
 
$attributs = array('position' =&gt; 'valeur',
                                'flottant' =&gt; 'valeur',
                                'taille' =&gt; 'valeur',
                                'couleur' =&gt; 'nom',
                                'police' =&gt; 'nom',
                                'lien' =&gt; 'url',
                                'image' =&gt; 'legende',
                                'citation' =&gt; 'auteur'); // Tableau des attributs
                                                                
        $nom = $noeud-&gt;nodeName; // On récupère le nom du nœud
        
        if(!empty($contenu_a_inserer)) // On détermine si on veut spécifier du contenu préparsé
        {
                $contenu = $contenu_a_inserer; // Si c'est le cas, on met la variable de fonction en contenu
        }
        else
        {
                $contenu = $noeud-&gt;nodeValue; // Sinon, le contenu du nœud
        }
        
        $premiere_balise = $balise_1[$nom];     // Première balise (ouvrante)
        
        if($noeud-&gt;hasAttributes() and $nom != 'image') // On remplace les attributs (sauf pour les images)
        {              
                        
                $un = $noeud-&gt;attributes-&gt;getNamedItem($attributs[$nom])-&gt;nodeValue; // Récupération de la valeur de l'attribut 
                $premiere_balise = str_replace(&quot;$1&quot;, $un, $premiere_balise); // On remplace la valeur $1 par celle de l'attribut
                
        }
        
        if($nom == 'image') // Cas particulier des images
                
        {
                $un = $contenu; // Dans ce cas, c'est $1 qui récupère le contenu du nœud (l'URL de l'image).
                $premiere_balise = str_replace(&quot;$1&quot;, $un, $premiere_balise);
                
                if($noeud-&gt;hasAttributes()) // Si l'image contient une légende (attribut $2)
                
                {
                        $deux = $noeud-&gt;attributes-&gt;getNamedItem('legende')-&gt;nodeValue; // Récupération de l'attribut « legende »
                }
                else // Par défaut, la légende (alt) est « Image »
                {
                        $deux = 'Image';
                }
        
                $premiere_balise = str_replace(&quot;$2&quot;, $deux, $premiere_balise);
                $intermediaire = $premiere_balise;
        
        }
        else // Cas général
        {
               $intermediaire = $premiere_balise . $contenu . $balise_2[$nom]; // On assemble le tout
                if($nom == 'liste'  or $nom == 'puce')
                {
                        $intermediaire = preg_replace(&quot;#&lt;ul&gt;(\s)*&lt;li&gt;#sU&quot;, &quot;&lt;ul&gt;&lt;li&gt;&quot;, $intermediaire);
                        $intermediaire = preg_replace(&quot;#&lt;/li&gt;(\s)*&lt;li&gt;#sU&quot;, &quot;&lt;/li&gt;&lt;li&gt;&quot;, $intermediaire);
                        $intermediaire = preg_replace(&quot;#&lt;/li&gt;(\s)*&lt;/ul&gt;#sU&quot;, &quot;&lt;/li&gt;&lt;/ul&gt;&quot;, $intermediaire);
                }
                
                if($nom == 'zcode')
                {
                        $intermediaire = nl2br($intermediaire); // On saute des lignes au résultat final
                }
        }
        return $intermediaire; // On renvoie le texte parsé
}
?&gt;</code></pre><p id="r-416726" data-claire-element-id="416726">Et voilà une bonne chose de faite ! :D</p><h3 id="r-parsage-enfant-noeud" data-claire-element-id="416730">parsage_enfant($noeud)</h3><p id="r-416728" data-claire-element-id="416728">Dans cette fonction, on va distinguer les nœuds possédant des enfants de ceux qui n'en possèdent pas. Ceux qui en ont vont vers parsage_normal tandis que ceux qui contiennent des éléments enfants sont redirigés vers… parsage_enfant lui-même ! Vicieux, non ? ;) <br/> De cette manière, on parcourt l'arbre XML jusqu'à ce que l'on atteigne les branches les plus éloignées, en quelque sorte.</p><pre id="r-416729" data-claire-element-id="416729"><code data-claire-semantic="html+php">&lt;?php
function parsage_enfant($noeud)// Fonction de parsage d'enfants
{
        if(!isset($accumulation)) // Si c'est la première balise, on initialise $accumulation
        {
                $accumulation = '';
        }
        
        $enfants_niv1 = $noeud-&gt;childNodes; // Les enfants du nœud traité
        
        foreach($enfants_niv1 as $enfant) // Pour chaque enfant, on vérifie…
        {
                if($enfant-&gt;hasChildNodes() == true) // …s'il a lui-même des enfants
                {
                        $accumulation .= parsage_enfant($enfant); // Dans ce cas, on revient sur parsage_enfant
                }
                else // ... s'il n'en a plus !
                {
                        $accumulation .= parsage_normal($enfant); // On parse comme un nœud normal
                }
        }
        return parsage_normal($noeud, $accumulation);
}
?&gt;</code></pre><h2 id="r-le-jour-de-gloire-est-arrive" data-claire-element-id="416735">Le jour de gloire est arrivé</h2><p id="r-416732" data-claire-element-id="416732">Pour parser, il vous suffit d'écrire ceci :</p><pre id="r-416733" data-claire-element-id="416733"><code data-claire-semantic="html+php">&lt;?php
echo parsage('zcode.xml'); // Mettez le nom du fichier XML
?&gt;</code></pre><p id="r-416734" data-claire-element-id="416734">Et voilà le travail ! :waw:</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode">[DOM] Parser du XML - L&#039;exemple du zCode</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/avant-de-commencer-19">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/a-la-decouverte-de-dom">
À la découverte de DOM
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/la-base-d-un-parseur">
La base d&#039;un parseur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/aller-plus-loin-32">
Aller plus loin
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/a-la-decouverte-de-dom">
<span class="arrow"></span>
<span class="next">À la découverte de DOM</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/aller-plus-loin-32">
<span class="next">Aller plus loin</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Allerplusloin"></a><h2>Aller plus loin</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/la-base-d-un-parseur">
<span class="arrow"></span>
<span class="next">La base d&#039;un parseur</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-dom-sur-php-net" data-claire-element-id="416738">DOM sur php.net</h2><p id="r-416737" data-claire-element-id="416737">N'oubliez pas de consulter régulièrement <a href="http://fr2.php.net/manual/fr/ref.dom.php">la page DOM de php.net</a>, très utile : vous y trouverez toutes les classes. Leurs méthodes sont listées en premier, puis viennent leurs variables dans un tableau : autant d'informations indispensables ! ;)</p><h2 id="r-allez-plus-loin-grace-a-dom" data-claire-element-id="416788">Allez plus loin grâce à DOM</h2><p id="r-416739" data-claire-element-id="416739">Si vous êtes un peu curieux, vous avez remarqué que mon parseur ne gère pas :</p><ul id="r-416750" data-claire-element-id="416750"><li id="r-416741" data-claire-element-id="416741"><p id="r-416740" data-claire-element-id="416740">les caractères accentués (é, à, ç, …) ;</p></li><li id="r-416743" data-claire-element-id="416743"><p id="r-416742" data-claire-element-id="416742">les <em>smilies</em> ;</p></li><li id="r-416745" data-claire-element-id="416745"><p id="r-416744" data-claire-element-id="416744">quelques balises zcode ;</p></li><li id="r-416747" data-claire-element-id="416747"><p id="r-416746" data-claire-element-id="416746">la balise <code data-claire-semantic="xml">&lt;code&gt; </code> ;</p></li><li id="r-416749" data-claire-element-id="416749"><p id="r-416748" data-claire-element-id="416748">les erreurs de rédaction (balises mal fermées…).</p></li></ul><p id="r-416751" data-claire-element-id="416751">Ce qui, au final, fait pas mal de choses ! :p Je n'ai pas abordé ces notions pour ne pas vous donner trop d'informations à mémoriser, <strong>mais vous pouvez faire certaines choses par vous-mêmes !</strong> Voici quelques pistes pour vous exercer et améliorer votre parseur.</p><h3 id="r-coloration-du-code" data-claire-element-id="416769">Coloration du code</h3><p id="r-416752" data-claire-element-id="416752">Vous allez pouvoir colorer votre code grâce à GeSHi (<a href="http://www.siteduzero.com/tuto-3-7340-1-colorer-son-code.html">consultez ce tuto pour découvrir GeSHi</a>). Je vous recommande de vous entraîner avec ce parsage, cela va vous former.</p><p id="r-416753" data-claire-element-id="416753">Il faut d'abord que vous transformiez le contenu des nœuds <em>code</em> en section CDATA. Je vous laisse chercher comment faire. Puis il va falloir qu'à chaque nœud <em>code</em> rencontré on récupère le contenu de la section CDATA. À tout hasard, j'ajoute qu'une instance de DOMNode a une variable qui renferme le premier nœud, firstChild. Je précise aussi que pour récupérer le contenu d'une section CDATA, on utilise la variable d'instance data.</p><p id="r-416754" data-claire-element-id="416754">Je ne vous en dis pas plus, bon courage !</p><p id="r-416755" data-claire-element-id="416755">…</p><p id="r-416756" data-claire-element-id="416756">C'est bon ? Allez, je vous donne quelques pistes :</p><p id="r-416757" data-claire-element-id="416757"></p><div id="r-416767" data-claire-element-id="416767"><p id="r-416758" data-claire-element-id="416758">Notez que c'est encore à améliorer, car le code ci-dessus ne parse pas tous les langages… cherchez du côté des attributs type et de leur contenu. :-°</p><pre id="r-416759" data-claire-element-id="416759"><code data-claire-semantic="html+php">&lt;?php
include_once('geshi.php');
function parsage_cdata($cdata, $type_code = 'php')
{
        $geshi =&amp; new GeSHi($cdata, $type_code);
        $geshi-&gt;set_header_type(GESHI_HEADER_NONE);
        $parse = $geshi-&gt;parse_code();
        $resultat = '&lt;span class=&quot;code&quot;&gt;Code : '. $type_code .'&lt;/span&gt;&lt;div class=&quot;code2 '. $type_code .'&quot;&gt;'. $parse .'&lt;/div&gt;';
        return $resultat;
}
?&gt;</code></pre><p id="r-416760" data-claire-element-id="416760">Voici la fonction parsage_cdata :</p><pre id="r-416761" data-claire-element-id="416761"><code data-claire-semantic="html+php">&lt;?php
function parsage_enfant($noeud)// Fonction de parsage d'enfants
{
        if(!isset($accumulation)) // Si c'est la première balise, on initialise $accumulation
        {
                $accumulation = '';
        }
       
        $enfants_niv1 = $noeud-&gt;childNodes; // Les enfants du nœud traité
       
        foreach($enfants_niv1 as $enfant) // Pour chaque enfant, on vérifie…
        {
                if($enfant-&gt;nodeName == 'code')
                {
                        $cdata = $enfant-&gt;firstChild-&gt;data;
                        $type_code = $enfant-&gt;attributes-&gt;getNamedItem('type')-&gt;nodeValue;
                        $resultat_html .= parsage_cdata($cdata, $type_code);
                }
                elseif($enfant-&gt;hasChildNodes() == true) // … s'il a lui-même des enfants
                {
                        $accumulation .= parsage_enfant($enfant); // Dans ce cas, on revient sur parsage_enfant
                }
                else // ... s'il n'en a plus !
                {
                        $accumulation .= parsage_normal($enfant); // On parse comme un nœud normal
                }
        }
        return parsage_normal($noeud, $accumulation);
}
?&gt;</code></pre><p id="r-416762" data-claire-element-id="416762">La nouvelle fonction parsage_enfant :</p><aside id="r-416764" data-claire-element-id="416764" data-claire-semantic="warning"><p id="r-416763" data-claire-element-id="416763">Remplacez les crochets par des chevrons ! J'ai dû effectuer ce changement pour éviter un <em>bug</em> du zcode, mais n'oubliez pas de faire cette modification, ou cela ne fonctionnera pas !</p></aside><pre id="r-416765" data-claire-element-id="416765"><code data-claire-semantic="html+php">&lt;?php
$chaine = preg_replace(&quot;#[code(\stype=&quot;(.+)&quot;)](.+)[/code]#isU&quot;, &quot;[code type=&quot;$2&quot;]&lt;![CDATA[$3]]&gt;[/code]&quot;, $chaine);
?&gt;</code></pre><p id="r-416766" data-claire-element-id="416766">Pour transformer en CDATA, insérez la Regex ci-dessous dans parsage et modifiez un peu le code au besoin.</p></div><p id="r-416768" data-claire-element-id="416768">Vous voyez, ce n'était pas si difficile que ça.</p><h3 id="r-gestion-des-caracteres-accentues" data-claire-element-id="416779">Gestion des caractères accentués</h3><p id="r-416770" data-claire-element-id="416770">Nous autres, pauvres Français, utilisons des accents dont nos confrères anglophones se moquent royalement. :colere2: <br/> Laissez-moi vous expliquer : les développeurs de DOM sont sûrement anglais ou n'ont pas voulu s'embêter à gérer les caractères accentués. On ne va pas leur en vouloir, mais c'est quand même un grave problème pour nous. Exemple :</p><p id="r-416771" data-claire-element-id="416771"><cite>Citation</cite></p><blockquote id="r-416773" data-claire-element-id="416773"><p id="r-416772" data-claire-element-id="416772">Le site du z@©&amp;ro.</p></blockquote><p id="r-416774" data-claire-element-id="416774">Avouons que ce n'est pas lisible. Bien que l'en-tête du document XML contienne l'encodage, DOM l'ignore (quel grincheux ;) ) et code tout en UTF-8, incompatible avec notre propre norme qui est, je le rappelle, ISO-8859-1. Conclusion, nous allons <em>à la sortie</em> du parsage décoder tout ce joyeux bazar pour obtenir du bon français, digne des plus grands auteurs classiques. La solution tient en un mot (ou en une fonction) : <strong>utf8_decode</strong>, notre sauveur. ^^ <br/> C'est donc la dernière ligne de la fonction parsage($document) qu'il faut changer :</p><pre id="r-416775" data-claire-element-id="416775"><code data-claire-semantic="html+php">&lt;?php
return utf8_decode($resultat_html);
?&gt;</code></pre><p id="r-416776" data-claire-element-id="416776">Et voilà !</p><aside id="r-416778" data-claire-element-id="416778" data-claire-semantic="warning"><p id="r-416777" data-claire-element-id="416777">Je tiens à dire que le problème d'encodage n'est pas aussi simple que ce je viens d'expliquer sommairement. Il est tout à fait possible d'obtenir des caractères accentués en UTF-8, comme le fait le Site du Zéro. C'est, très grossièrement, une histoire de « rangement » et d'attribution de valeurs. Par exemple, la valeur 468 renvoie « é » en ISO-8859-1 mais « @ » en UTF-8 (ce sont des exemples non vérifiés). Ce dernier encodage est d'ailleurs censé être universel, c'est-à-dire que vous pouvez aussi bien écrire en grec qu'en chinois avec de l'UTF-8. Cependant, des manipulations sont nécessaires pour parvenir à afficher correctement les accents en UTF-8, ce qui n'est d'ailleurs pas dans l'intérêt de tous les sites.</p></aside><h3 id="r-les-zforms-ou-formulaires" data-claire-element-id="416781">Les « zForms » ou formulaires</h3><p id="r-416780" data-claire-element-id="416780">Vous savez que la zForm du Site du Zéro propose deux aperçus : l'un se réalise en temps réel, l'autre génère l'affichage final. Le premier est codé en JavaScript, le second utilise AJAX — et donc le parseur PHP. Vous pouvez éventuellement réaliser sans trop de difficultés le second aperçu ; le premier devra quant à lui être retouché et adapté pour le JavaScript.</p><h3 id="r-ameliorations-diverses" data-claire-element-id="416787">Améliorations diverses</h3><p id="r-416782" data-claire-element-id="416782">Les <em>smilies</em>. Faut pas les laisser tomber ceux-là, hein ? On peut les introduire dans notre parseur avec str_replace ou des Regex, par exemple.<br/> Essayez aussi de vous entraîner à utiliser DOM en tentant de parser les balises <code data-claire-semantic="xml">&lt;tableau&gt; </code> ; elles sont très intéressantes. Pensez également à la gestion de chaînes de caractères contenant le texte à parser, ou encore à un module de sauvegarde. :)</p><div id="r-416784" data-claire-element-id="416784" data-claire-semantic="question"><p id="r-416783" data-claire-element-id="416783">Et pour gérer les erreurs de syntaxe ?</p></div><p id="r-416785" data-claire-element-id="416785">Alors il faudrait parler des DTD, ce qui serait trop long. Cependant, cela fera peut-être l'objet d'un futur tutoriel. Notez aussi que l'on peut parser en utilisant des feuilles de style XSLT, mais c'est encore une autre histoire.</p><p id="r-416786" data-claire-element-id="416786">N'hésitez pas non plus à créer des fonctions qui gèrent les « exceptions » — je parle ici de balises originales —, les erreurs, etc.</p><h2 id="r-la-securite-avec-dom" data-claire-element-id="416798">La sécurité avec DOM</h2><p id="r-416789" data-claire-element-id="416789">J'ai vu dans de nombreux forums et dans les commentaires de ce tuto des interrogations quant à la sécurité d'un tel système. Vous n'êtes pas sans savoir que la sécurité est quelque chose de très important en informatique ; se poser des questions à ce sujet est donc tout à fait justifié. Nous allons considérer le cas de tentatives de violation de sécurité simples.</p><p id="r-416790" data-claire-element-id="416790"><strong>EXEMPLE 1 : </strong> une des failles les plus connues consiste à insérer dans un formulaire du contenu JavaScript exécutable. Par exemple, dans un système non sécurisé, l'insertion du code ci-dessous affichera un message : « Mouahaha ton système n'est pas sécurisé ».</p><pre id="r-416791" data-claire-element-id="416791"><code data-claire-semantic="javascript">&lt;script type='text/javascript'&gt;
alert('Mouahaha ton système n\'est pas sécurisé.');
&lt;/script&gt;</code></pre><p id="r-416792" data-claire-element-id="416792">Évidemment, par la suite, on pourrait exploiter la faille de manière bien plus nuisible.</p><p id="r-416793" data-claire-element-id="416793">Dans le cas d'un parseur XML, tout va pour le mieux. DOM interprète cet extrait de code comme un nœud normal et l'envoie donc à parsage_normal. Dans la fonction parsage_normal, on recherche pour chaque nom de nœud s'il correspond à une balise HTML quelconque (exemple : <code data-claire-semantic="xml">&lt;paragraphe&gt; </code> correspond à <code data-claire-semantic="html">&lt;p&gt; </code>). Si ce n'est pas le cas, la balise et son contenu ne sont pas parsés (au sens qu'ils ne seront pas traduits en XHTML), car $premiere_balise ne contient rien ($balise_2 non plus). Quand on construit $intermediaire, la variable ne contient que le contenu du nœud script, soit : « alert('Mouahaha ton système n'est pas sécurisé.''); ». Et c'est d'ailleurs tout ce qui s'affichera à l'écran. ;)</p><p id="r-416794" data-claire-element-id="416794"><strong>EXEMPLE 2 :</strong> on pourrait également introduire le code suivant.</p><pre id="r-416795" data-claire-element-id="416795"><code>&lt;meta http-equiv='refresh' content='0; url=http://hacker.php' /&gt;</code></pre><p id="r-416796" data-claire-element-id="416796">Mais là, il n'y a absolument aucun danger. Si <code data-claire-semantic="html">&lt;meta/&gt; </code> ne fait pas partie du zCode (ou de votre langage), rien ne s'affichera.</p><p id="r-416797" data-claire-element-id="416797">On peut toujours rechercher des moyens de sécuriser davantage son système ; à vous de trouver les bons endroits où placer quelques fonctions intéressantes.</p><h2 id="r-comment-integrer-intelligemment-son-parseur-a-son-site" data-claire-element-id="416815">Comment intégrer intelligemment son parseur à son site ?</h2><p id="r-416799" data-claire-element-id="416799">J'ai remarqué que beaucoup de personnes, notamment dans les commentaires, hésitaient sur la façon d'utiliser un parseur XML. Je vous propose un modèle parmi d'autres, en supposant que vous utilisez MySQL comme base de données. De plus, je considère que vous souhaitez que l'on puisse :</p><ul id="r-416808" data-claire-element-id="416808"><li id="r-416801" data-claire-element-id="416801"><p id="r-416800" data-claire-element-id="416800">écrire du contenu (dans les forums, les tutoriels, le livre d'or, que sais-je encore ^^ ) ;</p></li><li id="r-416803" data-claire-element-id="416803"><p id="r-416802" data-claire-element-id="416802">éditer n'importe quel contenu en zCode ;</p></li><li id="r-416805" data-claire-element-id="416805"><p id="r-416804" data-claire-element-id="416804">l'afficher correctement en XHTML, bien sûr ;</p></li><li id="r-416807" data-claire-element-id="416807"><p id="r-416806" data-claire-element-id="416806">exporter son contenu en zCode dans des fichiers XML.</p></li></ul><p id="r-416809" data-claire-element-id="416809">Je vous propose ceci :</p><figure id="r-416811" data-claire-element-id="416812"><img id="r-416810" data-claire-element-id="416810" src="medias/uploads.siteduzero.com_files_89001_90000_89258.jpg" alt="organisation"/></figure><p id="r-416813" data-claire-element-id="416813"><em>Comment bien intégrer un parseur XML à son site</em></p><p id="r-416814" data-claire-element-id="416814">Évidemment, à vous de déterminer quelle organisation vous correspond le mieux. Là, seuls le papier et le crayon seront vos compagnons, mais aussi vos plus sûrs alliés !</p><h2 id="r-erreurs-de-code" data-claire-element-id="416827">Erreurs de code</h2><p id="r-416816" data-claire-element-id="416816">Autant vous le dire franchement, il est rare que cela fonctionne du premier coup, surtout si vous modifiez le code que je vous ai proposé. ^^ <br/> C'est une gymnastique très surprenante au début, voilà pourquoi il est capital que vous maîtrisiez parfaitement les bases de DOM présentées ici. Voici les principales sources d'erreur que j'ai pu relever.</p><ul id="r-416825" data-claire-element-id="416825"><li id="r-416818" data-claire-element-id="416818"><p id="r-416817" data-claire-element-id="416817">Vérifiez votre version de PHP et sa configuration.</p></li><li id="r-416820" data-claire-element-id="416820"><p id="r-416819" data-claire-element-id="416819">Utilisez loadHTML au lieu de loadXML si vous chargez un document HTML.</p></li><li id="r-416822" data-claire-element-id="416822"><p id="r-416821" data-claire-element-id="416821">N'oubliez <strong>jamais</strong> (c'est la cause d'une erreur sur deux) de préciser l'encodage, dans le fichier XML ou bien dans votre code même.</p></li><li id="r-416824" data-claire-element-id="416824"><p id="r-416823" data-claire-element-id="416823">Vérifiez que votre document XML est correctement formé.</p></li></ul><p id="r-416826" data-claire-element-id="416826">Le problème du code ci-dessus, c'est que les messages d'erreur indiquent rarement les bonnes lignes. N'hésitez pas non plus à tester les autres lignes en cas de <em>bugs</em>.</p><h2 id="r-le-choix-de-dom" data-claire-element-id="416836">Le choix de DOM</h2><p id="r-416828" data-claire-element-id="416828">Ce tutoriel touche à sa fin. Vous avez maintenant une idée claire de ce qu'est le parsage XML, du moins dans ses grandes lignes. C'est donc maintenant que vous savez dans quoi vous vous lancez en décidant d'utiliser DOM plutôt que des Regex.</p><p id="r-416829" data-claire-element-id="416829"><strong>N'oubliez pas qu'on ne choisit pas un outil pour montrer ou dire qu'on l'utilise, mais seulement si cet outil s'avère utile pour son projet.</strong></p><p id="r-416830" data-claire-element-id="416830">DOM a d'énormes avantages d'un point de vue structurel et organisationnel. En revanche, pour certains langages, les Regex seront bien plus rapides et adaptées. Le choix de l'une ou l'autre de ces technologies va avoir une influence très forte sur votre site entier. Dressez d'abord une liste de ce dont vous avez besoin et comparez les fonctionnalités proposées par DOM avec celles proposées par les Regex. Prenez celui qui ira le mieux, en faisant la balance entre court terme et long terme. DOM demande beaucoup d'investissement (intellectuel, bien sûr, pas financier :) ), ne vous lancez pas dedans à la légère.</p><p id="r-416831" data-claire-element-id="416831">Après ce petit conseil d'ami, passons au QCM ! :diable:</p><p id="r-416832" data-claire-element-id="416832">Vous connaissez maintenant les bases de DOM. J'espère que cette initiation vous aura plu et vous aura donné envie d'utiliser cette API dans votre site.</p><p id="r-416833" data-claire-element-id="416833">Alors au travail ! :D</p><p id="r-416834" data-claire-element-id="416834">À vos claviers, et bon code !</p><p id="r-416835" data-claire-element-id="416835">J'aimerais remercier toutes les personnes qui ont commenté mon tutoriel ; elles contribuent beaucoup à l'amélioration du contenu. N'hésitez donc pas vous non plus à y participer ! Je ne réponds pas instantanément, mais je prends note des remarques avant de faire une mise à jour.<br/> Vous trouverez également dans les commentaires des extraits de code dont je ne peux pas parler dans le tuto, et bien d'autres choses encore.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode">[DOM] Parser du XML - L&#039;exemple du zCode</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/avant-de-commencer-19">
Avant de commencer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/a-la-decouverte-de-dom">
À la découverte de DOM
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/la-base-d-un-parseur">
La base d&#039;un parseur
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/aller-plus-loin-32">
Aller plus loin
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/dom-parser-du-xml-l-exemple-du-zcode/la-base-d-un-parseur">
<span class="arrow"></span>
<span class="next">La base d&#039;un parseur</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/dom-parser-du-xml-l-exemple-du-zcode.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 19:59:21 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/dom-parser-du-xml-l-exemple-du-zcode.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:44:26 GMT -->
</html>