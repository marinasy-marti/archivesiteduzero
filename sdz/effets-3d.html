<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/effets-3d.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:12:21 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/effets-3d.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:31:28 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Effets 3D</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/effets-3d.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Effets 3D</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Effets3D">Effets 3D</a><br/><a href="#tape1crationdudocument">Étape 1 : création du document</a><br/><a href="#tape2crationduclip">Étape 2 : création du clip</a><br/><a href="#tape3lecode">Étape 3 : le code</a><br/></div>
<a name="Effets3D"></a><h2>Effets 3D</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/effets-3d/etape-1-creation-du-document">
<span class="next">Étape 1 : création du document</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-593396" data-claire-element-id="593396">Hier je surfais sur la toile, à la recherche d'informations pour la création d'un moteur 3D, et je suis tombé sur quelques effets sympa, que j'ai essayé de reproduire.</p><p id="r-593397" data-claire-element-id="593397">Voilà ce que l'on va apprendre à réaliser dans ce tutoriel (il est bien évident qu'une fois le principe compris, c'est à vous de l'exploiter pour l'améliorer) :<br/><a href="http://heero.blog.free.fr/blog/autres/menu3D.swf">http://heero.blog.free.fr/blog/autres/menu3D.swf</a></p><p id="r-593398" data-claire-element-id="593398"><strong>Note :</strong> ce tutoriel est destiné aux utilisateurs de Flash ayant un minimum de bases en ActionScript, je ne détaillerai donc pas tout.</p>
</div><a name="tape1crationdudocument"></a><h2>Étape 1 : création du document</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/effets-3d/etape-2-creation-du-clip">
<span class="next">Étape 2 : création du clip</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-593399" data-claire-element-id="593399">1) Créez un nouveau document flash : Fichier =&gt; Nouveau =&gt; Document Flash.</p><p id="r-593400" data-claire-element-id="593400">2) Modifiez les propriétés du document : Modification =&gt; Document (Ctrl + J).<br/> Modifiez les dimensions (200 px * 200 px) et la couleur de fond (noir).</p><p id="r-593401" data-claire-element-id="593401">3) Enregistrez votre document (ça peut paraître idiot comme instruction mais c'est une excellente habitude à prendre, croyez-moi ;) ).</p><p id="r-593402" data-claire-element-id="593402">Voilà, l'étape la plus difficile est finie... C'est une blague, bien sûr. :lol:</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/effets-3d">Effets 3D</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/effets-3d/etape-1-creation-du-document">
Étape 1 : création du document
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/effets-3d/etape-2-creation-du-clip">
Étape 2 : création du clip
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/effets-3d/etape-3-le-code">
Étape 3 : le code
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/effets-3d/etape-2-creation-du-clip">
<span class="next">Étape 2 : création du clip</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="tape2crationduclip"></a><h2>Étape 2 : création du clip</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/effets-3d/etape-1-creation-du-document">
<span class="arrow"></span>
<span class="next">Étape 1 : création du document</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/effets-3d/etape-3-le-code">
<span class="next">Étape 3 : le code</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-593404" data-claire-element-id="593404">1) Créez un nouveau movieClip : Insertion =&gt; Nouveau Symbole (ctrl + F8).<br/> Puis modifiez les propriétés comme ci-dessous :</p><figure id="r-593406" data-claire-element-id="593407"><img id="r-593405" data-claire-element-id="593405" src="medias/uploads.siteduzero.com_files_90001_91000_90552.png" alt="Image utilisateur"/></figure><aside id="r-593409" data-claire-element-id="593409" data-claire-semantic="information"><p id="r-593408" data-claire-element-id="593408"><strong>Note : </strong>l'identifiant nous servira plus tard pour créer des copies du clip sur la scène via l'ActionScript.</p></aside><p id="r-593410" data-claire-element-id="593410">2) Sur la première image du scénario (toujours dans le clip <code><strong>cercle</strong></code>), dessinez un cercle. (couleur du centre : gris, et couleur des contours : blanc).<br/> Enfin, modifiez ses dimensions (H : 50 px / L : 50 px), et ses coordonnées, pour que celui-ci se trouve centré (X : -25 px / Y : -25 px).</p><figure id="r-593412" data-claire-element-id="593413"><img id="r-593411" data-claire-element-id="593411" src="medias/uploads.siteduzero.com_files_90001_91000_90558.png" alt="Image utilisateur"/></figure><p id="r-593414" data-claire-element-id="593414">3) Insérez une 2e image-clef (encore et toujours dans le clip <code><strong>cercle</strong></code>), dans laquelle vous modifiez la couleur de fond du cercle (rouge par exemple).</p><p id="r-593415" data-claire-element-id="593415">4) Sur la première image d'un nouveau calque, ajoutez le code suivant dans la fenêtre <code><strong>action</strong></code> :</p><pre id="r-593416" data-claire-element-id="593416"><code data-claire-semantic="actionscript">stop(); // On stoppe la lecture en boucle.</code></pre><aside id="r-593418" data-claire-element-id="593418" data-claire-semantic="warning"><p id="r-593417" data-claire-element-id="593417">Encore une fois, il est important de sauvegarder votre travail.</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/effets-3d">Effets 3D</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/effets-3d/etape-1-creation-du-document">
Étape 1 : création du document
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/effets-3d/etape-2-creation-du-clip">
Étape 2 : création du clip
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/effets-3d/etape-3-le-code">
Étape 3 : le code
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/effets-3d/etape-1-creation-du-document">
<span class="arrow"></span>
<span class="next">Étape 1 : création du document</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/effets-3d/etape-3-le-code">
<span class="next">Étape 3 : le code</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="tape3lecode"></a><h2>Étape 3 : le code</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/effets-3d/etape-2-creation-du-clip">
<span class="arrow"></span>
<span class="next">Étape 2 : création du clip</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-593420" data-claire-element-id="593420">1) Voilà, tous les éléments ont été créés, il ne nous reste plus qu'à nous attaquer à la partie la plus 'difficile' de ce tuto : le code.<br/> En effet, nous n'allons pas créer un véritable moteur 3D (ce qui, entre nous, est au-delà de mon niveau :p ) mais plutôt d'en simuler un.<br/> Tout notre code sera placé sur la première image du scénario de la scène principale.</p><p id="r-593421" data-claire-element-id="593421">2) On commence par créer quelques variables sur lesquelles va se baser notre animation.</p><pre id="r-593422" data-claire-element-id="593422"><code data-claire-semantic="actionscript">var profondeur:Number = 1000;
var largeur:Number = 200; // ou Stage.width
var hauteur:Number = 200; // ou Stage.height
var centre_x:Number = 100; // ou largeur/2
var centre_y:Number = 100; // ou hauteur/2
var frein:Number = 5;
var interval:Number;</code></pre><p id="r-593423" data-claire-element-id="593423">Ici on veut que l'animation prenne toute la taille du document, et que son centre soit aussi le centre de notre document.</p><aside id="r-593425" data-claire-element-id="593425" data-claire-semantic="warning"><p id="r-593424" data-claire-element-id="593424">Je vous rappelle que sur la scène principale, le point de coordonnées (0;0) est le coin supérieur gauche de votre document.</p></aside><p id="r-593426" data-claire-element-id="593426">La variable <code><strong>profondeur</strong></code> va être l'une des bases les plus importantes de notre 'simulation' d'effet 3D.<br/> Nous verrons plus tard l'utilité de la variable <code><strong>frein</strong></code> (qui ne porte pas ce nom par hasard, vous vous en doutez :) ).</p><p id="r-593427" data-claire-element-id="593427">3) On crée une liste de noms, vous pouvez les remplacer par n'importe quoi bien, évidemment (ce seront les mots qui apparaîtront dans les cercles) :</p><pre id="r-593428" data-claire-element-id="593428"><code data-claire-semantic="actionscript">var tab_nom_1:Array = new Array(&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,&quot;5&quot;,&quot;6&quot;,&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;);</code></pre><p id="r-593429" data-claire-element-id="593429">4) Maintenant, nous allons créer une fonction qui crée et place nos occurrences (les copies) du clip <code><strong>cercle</strong></code> de la bibliothèque :</p><p id="r-593430" data-claire-element-id="593430">on crée la fonction <code><strong>creer_btns</strong></code> à laquelle on passe 2 paramètres.<br/> Le premier, <code><strong>chem1</strong></code> sera l'adresse du clip conteneur de notre animation : dans notre exemple, celle-ci aura pour valeur <code><strong>_root</strong></code>, c'est-à-dire la racine de notre animation.<br/> Le deuxième <code><strong>tab_nom</strong></code> est un tableau contenant des noms (comme son nom l'indique ^^ ).</p><pre id="r-593431" data-claire-element-id="593431"><code data-claire-semantic="actionscript">function creer_btns(chem1:MovieClip, tab_nom:Array):Void {
    // les instructions de la fonction
}</code></pre><aside id="r-593433" data-claire-element-id="593433" data-claire-semantic="information"><p id="r-593432" data-claire-element-id="593432"><strong>Note :</strong> en programmation, il faut toujours essayer de nommer les variables judicieusement, pour qu'au premier coup d'oeil on sache vaguement ce qu'elles contiennent ; ainsi, notre variable <code><strong>tab_nom</strong></code> est le diminutif de 'tableau_de_noms', ce qui se passe d'explications.</p></aside><p id="r-593434" data-claire-element-id="593434">Ensuite on crée une boucle <code><strong>For</strong></code> qui va créer autant de clips que de lignes dans le tableau <code><strong>tab_nom</strong></code> (pour obtenir le nombre de lignes, on utilise la méthode : <code><strong>monTableau.length</strong></code>).</p><pre id="r-593435" data-claire-element-id="593435"><code data-claire-semantic="actionscript">var taille:Number = tab_nom.length
for (var i:Number=0 ; i&lt;taille ; i++) {
    // mes instructions
}</code></pre><p id="r-593436" data-claire-element-id="593436">On va maintenant créer une variable qui nous servira à contenir le niveau de notre clip, celle-ci contiendra un nombre entre 1 et la valeur de la variable <code><strong>profondeur</strong></code> (1000 dans notre cas).<br/> Pour cela on utilise la méthode <code><strong>Math.random()</strong></code> qui nous renvoie un nombre à virgule entre 0 et 1 que l'on multiplie par la valeur de la variable <code><strong>profondeur</strong></code>. Et pour obtenir un nombre entier, on utilise la méthode <code><strong>Math.round()</strong></code> qui arrondit notre nombre à l'entier le plus proche.</p><pre id="r-593437" data-claire-element-id="593437"><code data-claire-semantic="actionscript">var var_profondeur:Number = Math.round(Math.random()*profondeur);</code></pre><p id="r-593438" data-claire-element-id="593438">On crée un clip <code><strong>conteneur</strong></code> vide, que l'on nomme en fonction de 'i' (si i=0, le clip sera nommé <code><strong>clip0</strong></code>, si i=1 =&gt; <code><strong>clip1</strong></code>, etc.).</p><pre id="r-593439" data-claire-element-id="593439"><code data-claire-semantic="actionscript">chem1.createEmptyMovieClip(&quot;clip&quot;+i, var_profondeur);</code></pre><aside id="r-593441" data-claire-element-id="593441" data-claire-semantic="information"><p id="r-593440" data-claire-element-id="593440"><strong>Note :</strong> on remarque l'utilisation de <code><strong>chem1.</strong></code> avant l'utilisation de la méthode de création du clip : cela signifie que l'on veut que le clip soit créé à l'intérieur du clip <code><strong>chem1</strong></code> qui, je vous le rappelle, est l'un des paramètres envoyés à la fonction (dans notre cas, ce sera <code><strong>_root</strong></code>).</p></aside><p id="r-593442" data-claire-element-id="593442">Lors de la création dynamique de plusieurs clips en fonction d'une variable, la modification des propriétés de ceux-ci nécessite de connaître leur nom. Ce qui à première vue n'est pas si facile que ça. <br/> Ex. : soient plusieurs clips &quot;clip+i&quot; ; si i=5, on veut donc travailler uniquement sur le clip <code><strong>clip5</strong></code>, il est bien évident que l'on ne peut pas écrire &quot;clip&quot;<code><strong>+i._x</strong></code> (<code><strong>_x</strong></code> retourne l'abscisse du clip). Pour cela, on utilisera la syntaxe suivante : <code><strong>clipConteneur[&quot;clip&quot;+i]</strong></code>. En lisant cette ligne, Flash travaillera sur un seul et unique clip (si i=5, alors il traduira cette ligne par <code><strong>clipConteneur.clip5</strong></code>).<br/> Mais cette notation est lourde : pour simplifier l'écriture du code, on va donc créer une variable-raccourci :</p><pre id="r-593443" data-claire-element-id="593443"><code data-claire-semantic="actionscript">var chem2:MovieClip = chem1[&quot;clip&quot;+i];</code></pre><aside id="r-593447" data-claire-element-id="593447" data-claire-semantic="information"><p id="r-593444" data-claire-element-id="593444">On peut aussi remplacer les deux dernières lignes de code par celle-ci : :</p><pre id="r-593445" data-claire-element-id="593445"><code data-claire-semantic="actionscript">var chem2:MovieClip = chem1.createEmptyMovieClip(&quot;clip&quot;+i, var_profondeur);</code></pre><p id="r-593446" data-claire-element-id="593446">C'était juste pour vous présenter une méthode pour récupérer un nom de variable.</p></aside><p id="r-593448" data-claire-element-id="593448">On va maintenant créer plusieurs variables incluses dans chaque clip.<br/> Les 2 premières sont les positions verticale et horizontale des clips quand ils seront au premier plan, on veut donc une valeur entre -largeur/2 et +largeur/2 (idem avec la variable <code><strong>hauteur</strong></code>).</p><div id="r-593450" data-claire-element-id="593450" data-claire-semantic="question"><p id="r-593449" data-claire-element-id="593449">Pourquoi ne pas prendre une valeur entre 0 et <code><strong>largeur</strong></code> pour faire plus simple ?</p></div><p id="r-593451" data-claire-element-id="593451">C'est une simple question de représentation mentale ; souvenez-vous, on a défini un centre (avec les variables <code><strong>centre_x</strong></code> et <code><strong>centre_y</strong></code>), on calcule donc les coordonnées des clips en fonction de ce centre.<br/> On doit aussi enregistrer la profondeur du clip (puisque l'on aura besoin de la récupérer pour la faire varier).<br/> Enfin, la dernière nous sert juste à enregistrer la valeur actuelle de 'i' (elle nous sera utile pour récupérer les valeurs des variables du clip sur lequel on a cliqué).</p><pre id="r-593452" data-claire-element-id="593452"><code data-claire-semantic="actionscript">chem2.var_x = Math.round(Math.random()*largeur-largeur/2); 
chem2.var_y = Math.round(Math.random()*hauteur-hauteur/2); 
chem2.var_niv = var_profondeur; 
chem2.i = i;</code></pre><p id="r-593453" data-claire-element-id="593453">Enfin on positionne le clip en fonction du centre et de ses coordonnées calculées plus haut.</p><pre id="r-593454" data-claire-element-id="593454"><code data-claire-semantic="actionscript">chem2._x = centre_x+chem2.var_x;
chem2._y = centre_y+chem2.var_y;</code></pre><p id="r-593455" data-claire-element-id="593455">Maintenant que l'on a créé les variables et positionné le clip, il faut le remplir avec quelque chose (puisque voir se déplacer des clips vides, entre nous, c'est un peu difficile :D ).<br/> On va donc y attacher le clip <code><strong>cercle</strong></code> créé à l'étape 2, ainsi qu'un champ texte, dans lequel on va écrire la valeur de la ligne 'i' du tableau <code><strong>tab_nom</strong></code> (qui, je vous le rappelle, contient des noms).</p><pre id="r-593456" data-claire-element-id="593456"><code data-claire-semantic="actionscript">chem2.attachMovie(&quot;cercle&quot;, &quot;cercle&quot;, 1); 
chem2.createTextField(&quot;texte&quot;, 2, -10, -10, 20, 20); 
chem2.texte.text = tab_nom[i]; 
chem2.texte.selectable = false;</code></pre><aside id="r-593458" data-claire-element-id="593458" data-claire-semantic="information"><p id="r-593457" data-claire-element-id="593457"><strong>Note : </strong>la propriété <code><strong>selectable</strong></code> nous indique si le champ texte est sélectionnable ; par défaut, elle est égale à 'True' (vrai en anglais), on la place donc sur 'False' (faux, en anglais aussi ^^ ).<br/><strong>Note 2 :</strong> la première ligne d'une liste se récupère via l'instruction <code><strong>monTableau[0]</strong></code> ; or justement, cela tombe bien, notre boucle <code><strong>For</strong></code> fait démarrer la variable 'i' à 0.</p></aside><p id="r-593459" data-claire-element-id="593459">Bon : les clips sont créés, mais il ont tous la même taille (logique, ce sont des copies parfaites) et vous serez (j'espère) d'accord avec moi que pour donner un effet d'éloignement, ce n'est pas le top ^^ .<br/> On va donc arranger cela en modifiant les propriétés <code><strong>_xscale</strong></code> et <code><strong>_yscale</strong></code> des clips (elles modifient le % de la taille : par défaut, elles sont à 100 (%)).</p><pre id="r-593460" data-claire-element-id="593460"><code data-claire-semantic="actionscript">chem2._xscale = Math.ceil(chem2.var_niv/(profondeur/100)); 
chem2._yscale = Math.ceil(chem2.var_niv/(profondeur/100));</code></pre><aside id="r-593462" data-claire-element-id="593462" data-claire-semantic="information"><p id="r-593461" data-claire-element-id="593461"><strong>Note :</strong><code><strong>chem2.var_niv</strong></code> varie entre 0 et la valeur de la variable <code><strong>profondeur</strong></code>, il faut donc diviser cette valeur par <code><strong>profondeur</strong></code>/100 pour obtenir une valeur entre 0 et 100.</p></aside><p id="r-593463" data-claire-element-id="593463">Maintenant il reste une étape à initialiser, c'est-à-dire l'exécution des actions quand on clique sur le clip.<br/> On déplace la tête de lecture de ce clip sur la deuxième image (le cercle à fond rouge, dans notre cas).<br/> Puis on supprime la temporisation que désigne la variable <code><strong>interval</strong></code> pour éviter de créer 2 fois une même temporisation (ce qui aurait pour effet de doubler la fréquence d'exécution de la fonction temporisée).<br/> Puis on recrée une temporisation de la fonction <code><strong>deplacement</strong></code> toutes les 40 millisecondes, à laquelle on envoie 3 paramètres (<code><strong>chem1</strong></code> pour l'adresse du clip conteneur ; le numéro d'index du clip sur lequel on a cliqué ; et enfin la taille du tableau <code><strong>tab_nom</strong></code>, soit le nombre de clips).</p><pre id="r-593464" data-claire-element-id="593464"><code data-claire-semantic="actionscript">chem2.onRelease = function():Void{ 
    this.cercle.gotoAndStop(2); 
    clearInterval(interval); 
    interval = setInterval(deplacement,40,chem1,this.i,tab_nom.length); 
};</code></pre><p id="r-593465" data-claire-element-id="593465">Récapitulatif de la fonction créée :</p><div id="r-593467" data-claire-element-id="593467"><pre id="r-593466" data-claire-element-id="593466"><code data-claire-semantic="actionscript">function creer_btns(chem1:MovieClip, tab_nom:Array) {
    var taille:Number = tab_nom.length
    for (var i:Number=0 ; i&lt;taille ; i++) {
        var var_profondeur:Number = Math.round(Math.random()*profondeur);
        var chem2:MovieClip = chem1.createEmptyMovieClip(&quot;clip&quot;+i, var_profondeur);
        chem2.var_x = Math.round(Math.random()*largeur-largeur/2);
        chem2.var_y = Math.round(Math.random()*hauteur-hauteur/2);
        chem2.var_niv = var_profondeur;
        chem2.i = i;
        chem2._x = centre_x+chem2.var_x;
        chem2._y = centre_y+chem2.var_y;
        chem2.attachMovie(&quot;cercle&quot;, &quot;cercle&quot;, 1);
        chem2.createTextField(&quot;texte&quot;, 2, -10, -10, 20, 20);
        chem2.texte.text = tab_nom[i];
        chem2.texte.selectable = false;
        chem2._xscale = Math.ceil(chem2.var_niv/(profondeur/100));
        chem2._yscale = Math.ceil(chem2.var_niv/(profondeur/100));
        chem2.onRelease = function():Void{
            this.cercle.gotoAndStop(2);
            clearInterval(interval);
            interval=setInterval(deplacement,40,chem1,this.i,tab_nom.length);
        };
    }
}</code></pre></div><p id="r-593468" data-claire-element-id="593468">5) On crée une deuxième fonction prévue pour être exécutée en boucle pour simuler notre effet 3D : la fonction <code><strong>deplacement</strong></code>.<br/> On a vu dans la fonction 1 que l'on avait besoin d'envoyer 3 paramètres importants à la fonction <code><strong>deplacement</strong></code>, il faut donc créer des variables réceptrices.</p><pre id="r-593469" data-claire-element-id="593469"><code data-claire-semantic="actionscript">function deplacement(chem:MovieClip, var_i:Number, nbr:Number):Void {
    // instructions
}</code></pre><p id="r-593470" data-claire-element-id="593470">La première étape consiste à récupérer le chemin pour accéder aux variables du clip sur lequel on a cliqué : pour cela, aucun problème puisque l'on a pensé à envoyer la valeur de la variable 'i' du clip sur lequel on a cliqué.</p><pre id="r-593471" data-claire-element-id="593471"><code data-claire-semantic="actionscript">var chem1:MovieClip = chem[&quot;clip&quot;+var_i];</code></pre><p id="r-593472" data-claire-element-id="593472">À ce niveau, une petite vérification s'impose : il faut regarder si le clip est arrivé au premier plan, c'est-à-dire que son niveau est maximal. Si c'est le cas, on supprime la temporisation <code><strong>interval</strong></code>.</p><pre id="r-593473" data-claire-element-id="593473"><code data-claire-semantic="actionscript">if (chem1.var_niv != profondeur) {
    // instruction
} else { 
    clearInterval(interval); 
}</code></pre><p id="r-593474" data-claire-element-id="593474">Si le clip sur lequel on a cliqué n'est pas au premier plan, alors il faut déplacer tous les clips ; pour cela, je vous propose de créer un effet de vitesse qui ralentit.<br/> Je m'explique : on calcule la distance restante à parcourir, puis on demande au clip d'en parcourir la moitié.<br/> À la prochaine exécution de la fonction, on lui demande de faire de même, mais comme la distance qu'il restera à parcourir a été divisée par 2, le clip avancera 2 fois moins vite, et ainsi de suite.</p><aside id="r-593476" data-claire-element-id="593476" data-claire-semantic="warning"><p id="r-593475" data-claire-element-id="593475">Si on applique cette méthode telle quelle, le clip n'arrivera jamais à destination : en effet, il parcourra toujours la moitié de la distance restante ; pour pallier ce petit problème de logique mathématique (qui peut donner mal à la tête :D ), on utilisera la méthode <code><strong>Math.ceil()</strong></code> qui nous renvoie l'arrondi supérieur.<br/> Le déplacement du clip se fera donc toujours d'un nombre entier, et quand la distance restante sera inférieure à 1, alors le clip arrivera à la position finale.</p></aside><p id="r-593477" data-claire-element-id="593477">C'est ici qu'apparaît l'utilité de la variable <code><strong>frein</strong></code> : c'est elle qui va fixer le % de chemin restant à parcourir (frein=2, la moitié ; frein=3, le tiers, etc.).</p><pre id="r-593478" data-claire-element-id="593478"><code data-claire-semantic="actionscript">var vitesse:Number = Math.ceil((profondeur-chem1.var_niv)/frein); 
var vitesse_x:Number = Math.ceil(chem1.var_x/frein); 
var vitesse_y:Number = Math.ceil(chem1.var_y/frein);</code></pre><p id="r-593479" data-claire-element-id="593479">Une fois les vitesses calculées, il faut modifier les variables et les propriétés des clips ; on crée donc une boucle <code><strong>For</strong></code> pour traiter tous les clips (le nombre de clips est contenu dans la variable <code><strong>nbr</strong></code>).</p><pre id="r-593480" data-claire-element-id="593480"><code data-claire-semantic="actionscript">for (var i:Number=0 ; i&lt;nbr ; i++) {
    // instructions
}</code></pre><p id="r-593481" data-claire-element-id="593481">On édite les variables des clips (on crée aussi un autre raccourci, toujours pour simplifier l'écriture du code).</p><pre id="r-593482" data-claire-element-id="593482"><code data-claire-semantic="actionscript">var chem2:MovieClip = chem[&quot;clip&quot;+i]; 
chem2.var_niv += vitesse; 
chem2.var_x -= vitesse_x; 
chem2.var_y -= vitesse_y;</code></pre><p id="r-593483" data-claire-element-id="593483">Comme on augmente la valeur de la variable de niveau de tous les clips, il faut faire en sorte que les clips qui dépassent le premier plan soient remis en arrière-plan (on en profite aussi pour replacer la tête de lecture du clip <code><strong>cercle</strong></code> sur l'image 1).</p><pre id="r-593484" data-claire-element-id="593484"><code data-claire-semantic="actionscript">if (chem2.var_niv&gt;profondeur) { 
        chem2.cercle.gotoAndStop(1); 
        chem2.var_niv -= profondeur; 
}</code></pre><p id="r-593485" data-claire-element-id="593485">Il ne nous reste plus qu'à déplacer les clips.</p><h3 id="r-modifier-son-niveau" data-claire-element-id="593487">Modifier son niveau</h3><pre id="r-593486" data-claire-element-id="593486"><code data-claire-semantic="actionscript">chem2.swapDepths(chem2.var_niv);</code></pre><h3 id="r-modifier-sa-taille" data-claire-element-id="593507">Modifier sa taille</h3><pre id="r-593488" data-claire-element-id="593488"><code data-claire-semantic="actionscript">chem2._xscale=Math.ceil(chem2.var_niv/(profondeur/100)); 
chem2._yscale=Math.ceil(chem2.var_niv/(profondeur/100));</code></pre><aside id="r-593492" data-claire-element-id="593492" data-claire-semantic="information"><p id="r-593489" data-claire-element-id="593489">Note : on peut aussi écrire cette double instruction comme ceci :</p><pre id="r-593490" data-claire-element-id="593490"><code data-claire-semantic="actionscript">chem2._xscale = chem2._yscale = Math.ceil(chem2.var_niv/(profondeur/100));</code></pre><p id="r-593491" data-claire-element-id="593491">Ce qui va diviser son temps d'exécution par 2 (puisqu'avant on faisait faire à l'ordinateur 2 fois le même calcul).</p></aside><p id="r-593493" data-claire-element-id="593493">Enfin, la dernière difficulté : pour donner l'impression que les clips viennent de loin (notion de fuyantes), on calcule le % du chemin parcouru et on le réutilise dans le positionnement des clips.</p><pre id="r-593494" data-claire-element-id="593494"><code data-claire-semantic="actionscript">var coef:Number = (chem2.var_niv/profondeur); 
chem2._x = centre_x+coef*chem2.var_x; 
chem2._y = centre_y+coef*chem2.var_y;</code></pre><p id="r-593495" data-claire-element-id="593495">Récapitulatif de la deuxième fonction créée :</p><div id="r-593497" data-claire-element-id="593497"><pre id="r-593496" data-claire-element-id="593496"><code data-claire-semantic="actionscript">function deplacement(chem:MovieClip, var_i:Number, nbr:Number):Void{
    var chem1:MovieClip = chem[&quot;clip&quot;+var_i];
    if (chem1.var_niv != profondeur) {
        var vitesse:Number = Math.ceil((profondeur-chem1.var_niv)/frein);
        var vitesse_x:Number = Math.ceil(chem1.var_x/frein);
        var vitesse_y:Number = Math.ceil(chem1.var_y/frein);
        for (var i:Number=0 ; i&lt;nbr ; i++) {
            var chem2:MovieClip = chem[&quot;clip&quot;+i];
            chem2.var_niv += vitesse;
            chem2.var_x -= vitesse_x;
            chem2.var_y -= vitesse_y;
            if (chem2.var_niv&gt;profondeur) {
                chem2.cercle.gotoAndStop(1);
                chem2.var_niv -= profondeur;
            }
            chem2.swapDepths(chem2.var_niv);
            chem2._xscale=Math.ceil(chem2.var_niv/(profondeur/100));
            chem2._yscale=Math.ceil(chem2.var_niv/(profondeur/100));
            var coef:Number = (chem2.var_niv/profondeur);
            chem2._x = centre_x+coef*chem2.var_x;
            chem2._y = centre_y+coef*chem2.var_y;
        }
    } else {
        clearInterval(interval);
    }
}</code></pre></div><p id="r-593498" data-claire-element-id="593498">6) Maintenant il suffit d'exécuter la fonction <code><strong>creer_btns</strong></code> pour lancer l'animation (et de lui passer les bons paramètres).</p><pre id="r-593499" data-claire-element-id="593499"><code data-claire-semantic="actionscript">creer_btns(_root, tab_nom_1);</code></pre><p id="r-593500" data-claire-element-id="593500">7) Récapitulatif global (avec commentaires) :</p><div id="r-593502" data-claire-element-id="593502"><pre id="r-593501" data-claire-element-id="593501"><code data-claire-semantic="actionscript">// Création de la fonction 'creer_btns'.
function creer_btns(chem1:MovieClip, tab_nom:Array):Void{
    var taille:Number = tab_nom.length;
    for (var i:Number=0 ; i&lt;taille ; i++) {
        var var_profondeur:Number = Math.round(Math.random()*profondeur);
        // Création du clip conteneur et du raccourci.
        var chem2:MovieClip = chem1.createEmptyMovieClip(&quot;clip&quot;+i, var_profondeur);
        // Création des variables de sauvegarde.
        chem2.var_x = Math.round(Math.random()*largeur-largeur/2);
        chem2.var_y = Math.round(Math.random()*hauteur-hauteur/2);
        chem2.var_niv = var_profondeur;
        chem2.i = i;
        // Positionnement du clip.
        chem2._x = centre_x+chem2.var_x;
        chem2._y = centre_y+chem2.var_y;
        // On y attache le clip 'cercle'.
        chem2.attachMovie(&quot;cercle&quot;, &quot;cercle&quot;, 1);
        // Création du champ texte.
        chem2.createTextField(&quot;texte&quot;, 2, -10, -10, 20, 20);
        // Écriture dans le champ texte.
        chem2.texte.text = tab_nom[i];
        // Rend le texte impossible à sélectionner.
        chem2.texte.selectable = false;
        // Redéfinit la taille du clip (en %).
        chem2._xscale = chem2._yscale = Math.ceil(chem2.var_niv/(profondeur/100));
        // Définit les actions à exécuter lors du clic sur le clip.
        chem2.onRelease = function():Void{
            // On place la tête de lecture du clip 'cercle' sur l'image 2.
            this.cercle.gotoAndStop(2);
            // On supprime la temporisation 'interval' pour ne pas la déclencher 2 fois.
            clearInterval(interval);
            // On recrée la temporisation 'interval' qui exécutera la fonction 'deplacement', avec 3 paramètres, toutes les 40 millisecondes.
            interval = setInterval(deplacement, 40, chem1, this.i, tab_nom.length);
        };
    }
}
// Création de la fonction 'deplacement'.
function deplacement(chem:MovieClip, var_i:Number, nbr:Number):Void{
    // On crée un racourci.
    var chem1:MovieClip = chem[&quot;clip&quot;+var_i];
    // On vérifie si le clip n'est pas déjà au premier plan.
    if (chem1.var_niv != profondeur) {
        // On calcule les vitesses de déplacement.
        // Note : la variable 'frein' diminue les vitesses et donc augmente le temps de déplacement des clips.
        var vitesse:Number = Math.ceil((profondeur-chem1.var_niv)/frein);
        var vitesse_x:Number = Math.ceil(chem1.var_x/frein);
        var vitesse_y:Number = Math.ceil(chem1.var_y/frein);
        // On édite les variables et les coordonnées de tous les clips.
        for (var i:Number=0 ; i&lt;nbr ; i++) {
            // Création d'un raccourci.
            var chem2:MovieClip = chem[&quot;clip&quot;+i];
            // On édite les variables.
            chem2.var_niv += vitesse;
            chem2.var_x -= vitesse_x;
            chem2.var_y -= vitesse_y;
            // Si le clip a dépassé le niveau de premier plan.
            if (chem2.var_niv&gt;profondeur) {
                // On place la tête de lecture du clip 'cercle' sur l'image 1.
                chem2.cercle.gotoAndStop(1);
                // On édite la variable de niveau.
                chem2.var_niv -= profondeur;
            }
            // On édite le niveau du clip.
            chem2.swapDepths(chem2.var_niv);
            // On modifie la largeur et la hauteur du clip (en %).
            // Note : chem2.var_niv et profondeur, varient entre 0 et 1000, suite au petit calcul de valeur de sortie sont comprises entre 0 et 100.
            chem2._xscale = chem2._yscale=Math.ceil(chem2.var_niv/(profondeur/100));
            // On calcule le % du chemin parcouru.
            var coef:Number = (chem2.var_niv/profondeur);
            // On modifie les coordonnées du clip.
            chem2._x = centre_x+coef*chem2.var_x;
            chem2._y = centre_y+coef*chem2.var_y;
        }
    } else {
        // On supprime la temporisation 'interval' puisque le clip est arrivé au premier plan.
        clearInterval(interval);
    }
}
// Déclaration des variables globales.
var profondeur:Number = 1000;
var largeur:Number = 200;
var hauteur:Number = 200;
var centre_x:Number = 100;
var centre_y:Number = 100;
var frein:Number = 5;
var interval:Number;
// Création du tableau des noms.
var tab_nom_1:Array = new Array(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;10&quot;);
// Exécution de la fonction 'creer_btns' à laquelle on envoie le chemin du clip conteneur (ici la scène principale '_root') et le tableau des noms.
creer_btns(_root, tab_nom_1);</code></pre></div><aside id="r-593504" data-claire-element-id="593504" data-claire-semantic="information"><p id="r-593503" data-claire-element-id="593503"><strong>Note :</strong> les lignes précédées de '//' sont des commentaires, vous pouvez donc les supprimer sans aucun risque.</p></aside><p id="r-593505" data-claire-element-id="593505">8) Et pour finir, la dernière étape, celle que vous attendiez tous : l'ENREGISTREMENT. Mais vous l'avez fait tout au long de l'écriture du code bien évidemment :) ... :euh: ... comment ça, non ? :colere2: RHHAAA... pas bien !</p><p id="r-593506" data-claire-element-id="593506">Voilà : il ne vous reste plus qu'à publier votre document.</p><h3 id="r-idees" data-claire-element-id="593513">Idées</h3><ul id="r-593512" data-claire-element-id="593512"><li id="r-593509" data-claire-element-id="593509"><p id="r-593508" data-claire-element-id="593508">Pour transformer cette animation en menu, vous pouvez modifier le code pour qu'un clic sur un clip qui est déjà situé au premier plan déclenche une autre action (un <code>getURL();</code> par exemple).</p></li><li id="r-593511" data-claire-element-id="593511"><p id="r-593510" data-claire-element-id="593510">Il y a aussi un petit problème dans le code à régler : en effet, si l'on crée 2 clips au même niveau, le dernier clip créé va écraser le précédent. Je vous laisse donc imaginer un système pour éviter que cela se produise dans notre application.</p></li></ul>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/effets-3d">Effets 3D</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/effets-3d/etape-1-creation-du-document">
Étape 1 : création du document
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/effets-3d/etape-2-creation-du-clip">
Étape 2 : création du clip
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/effets-3d/etape-3-le-code">
Étape 3 : le code
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/effets-3d/etape-2-creation-du-clip">
<span class="arrow"></span>
<span class="next">Étape 2 : création du clip</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/effets-3d.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:12:25 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/effets-3d.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:31:28 GMT -->
</html>