<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/introduction-aux-systemes-de-construction-logicielle-avec-cmake.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 06:37:03 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/introduction-aux-systemes-de-construction-logicielle-avec-cmake.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:11:03 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Introduction aux systèmes de construction logicielle avec CMake</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Introduction aux systèmes de construction logicielle avec CMake</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#IntroductionauxsystmesdeconstructionlogicielleavecCMake">Introduction aux systèmes de construction logicielle avec CMake</a><br/><a href="#Prsentationduconcept">Présentation du concept</a><br/><a href="#CMakeLists.txtetlacompilationd039unprogrammesimple">CMakeLists.txt et la compilation d&#039;un programme simple</a><br/><a href="#Lacompilationaveclibrairiesexternes">La compilation avec librairies externes</a><br/><a href="#Compilerunelibrairie">Compiler une librairie</a><br/></div>
<a name="IntroductionauxsystmesdeconstructionlogicielleavecCMake"></a><h2>Introduction aux systèmes de construction logicielle avec CMake</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/presentation-du-concept">
<span class="next">Présentation du concept</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-561609" data-claire-element-id="561609">Dans le développement ou redistribution d'un programme, qu'il soit libre ou propriétaire, il sera sûrement amené à être modifié par plusieurs personnes, tournant sous différents systèmes et EDI.<br/> Néanmoins, un programme un tant soit peu complet sera souvent amené à utiliser quelques librairies supplémentaires, et il est souvent embêtant de devoir configurer les différentes dépendances du projet, sous les différents systèmes et programmes, vérifier si tout est présent, etc. <br/> C'est là qu'intervient le concept que je vais vous expliquer.</p>
</div><a name="Prsentationduconcept"></a><h2>Présentation du concept</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/cmakelists-txt-et-la-compilation-d-un-programme-simple">
<span class="next">CMakeLists.txt et la compilation d&#039;un programme simple</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-les-systemes-de-construction-logicielle" data-claire-element-id="561616">Les systèmes de construction logicielle</h2><p id="r-561610" data-claire-element-id="561610">Ce système ne compilera pas directement le programme mais il va créer un projet capable de le faire (par exemple, un projet Code::Blocks, un Makefile, un projet Visual Studio, etc.) à partir d'un même fichier.<br/> Il en existe plusieurs, le plus connu étant autoconf (vous savez, <code data-claire-semantic="console">./configure</code> !), qui lui ne gère que les Makefiles.<br/> L'avantage de l'outil que je vais vous présenter dans ce tutoriel est qu'il est portable (il générera donc tout type de projet sous tous les systèmes).</p><p id="r-561611" data-claire-element-id="561611">Pour illustrer le fonctionnement, voici un simple schéma :</p><figure id="r-561613" data-claire-element-id="561614"><img id="r-561612" data-claire-element-id="561612" src="medias/uploads.siteduzero.com_files_234001_235000_234360.png" alt="Image utilisateur"/></figure><p id="r-561615" data-claire-element-id="561615">Le premier rectangle en haut, sous CMake, va représenter un fichier à la syntaxe simple, nommé <em>CMakeLists.txt</em> (il est commun à tous les utilisateurs), celui d'en dessous à un fichier généré par CMake, nommé <em>CMakeCache.txt</em> (et lui est propre à chacun, il donne des informations sur la configuration).</p><h2 id="r-c-est-parti-installation" data-claire-element-id="561623">C'est parti, installation !</h2><p id="r-561617" data-claire-element-id="561617">L'installation de cet outil magique est simple.</p><ul id="r-561622" data-claire-element-id="561622"><li id="r-561619" data-claire-element-id="561619"><p id="r-561618" data-claire-element-id="561618">Si vous utilisez GNU/Linux, il se trouve à coup sûr dans les dépôts de votre distribution.</p></li><li id="r-561621" data-claire-element-id="561621"><p id="r-561620" data-claire-element-id="561620">Si ce n'est pas le cas ou que vous utilisez Windows ou Mac OS, il vous suffit de télécharger l'exécutable de la dernière version sur <a href="http://www.cmake.org/cmake/resources/software.html">cette page</a>.<br/> Petite note, sous Windows, il faut utiliser la console et remplacer la commande <code data-claire-semantic="console">cmake</code> par <code data-claire-semantic="console">C:\Program Files\CMake x.x\bin\cmake.exe</code> où x.x est la version de CMake.</p></li></ul>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake">Introduction aux systèmes de construction logicielle avec CMake</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/presentation-du-concept">
Présentation du concept
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/cmakelists-txt-et-la-compilation-d-un-programme-simple">
CMakeLists.txt et la compilation d&#039;un programme simple
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/la-compilation-avec-librairies-externes">
La compilation avec librairies externes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/compiler-une-librairie">
Compiler une librairie
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/cmakelists-txt-et-la-compilation-d-un-programme-simple">
<span class="next">CMakeLists.txt et la compilation d&#039;un programme simple</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="CMakeLists.txtetlacompilationd039unprogrammesimple"></a><h2>CMakeLists.txt et la compilation d&#039;un programme simple</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/presentation-du-concept">
<span class="arrow"></span>
<span class="next">Présentation du concept</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/la-compilation-avec-librairies-externes">
<span class="next">La compilation avec librairies externes</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-561625" data-claire-element-id="561625">À noter que par « simple » j'entends programme n'incluant aucune librairie supplémentaire.</p><h2 id="r-la-syntaxe-du-fichier" data-claire-element-id="561628">La syntaxe du fichier</h2><p id="r-561626" data-claire-element-id="561626">La syntaxe est très claire et est exclusivement constituée d'appels de commandes. Les arguments des commandes sont placés entre parenthèses et séparés par des espaces ou des sauts de ligne (la parenthèse ouvrante ne peut être séparée par des retours à la ligne du nom de la fonction). Si vous voulez un argument avec des espaces, il suffit de les entourer de guillemets.<br/> Et bien sûr, on a les inévitables commentaires qui sont marqués par un # en début de ligne.<br/> Enfin, il reste les variables que l'on utilisera pour une liste dynamique des fichiers ou pour lier des librairies ; elles se présentent sous la forme <strong>${nom}</strong> et sont modifiées grâce à la fonction <strong>set</strong>.</p><pre id="r-561627" data-claire-element-id="561627"><code data-claire-semantic="bash">nom_de_la_commande(argument1 argument2 argument3)

set(une_variable &quot;une valeur&quot;)
				
nom_d_une_autre_commande(
	&quot;argument1 et la suite&quot;
	argument2
        ${une_variable}
)

# un commentaire</code></pre><h2 id="r-premier-exemple-7" data-claire-element-id="561658">Premier exemple</h2><p id="r-561629" data-claire-element-id="561629">Imaginons une simple architecture pour un projet quelconque :</p><ul id="r-561643" data-claire-element-id="561643"><li id="r-561638" data-claire-element-id="561638"><p id="r-561630" data-claire-element-id="561630">src/</p><ul id="r-561637" data-claire-element-id="561637"><li id="r-561632" data-claire-element-id="561632"><p id="r-561631" data-claire-element-id="561631">main.c</p></li><li id="r-561634" data-claire-element-id="561634"><p id="r-561633" data-claire-element-id="561633">fonctions.h</p></li><li id="r-561636" data-claire-element-id="561636"><p id="r-561635" data-claire-element-id="561635">fonctions.c</p></li></ul></li><li id="r-561640" data-claire-element-id="561640"><p id="r-561639" data-claire-element-id="561639">bin/</p></li><li id="r-561642" data-claire-element-id="561642"><p id="r-561641" data-claire-element-id="561641">CMakeLists.txt</p></li></ul><p id="r-561644" data-claire-element-id="561644">Pour les fichiers, je vais vous fournir un code, que vous puissiez tester la compilation :</p><pre id="r-561645" data-claire-element-id="561645"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &quot;fonctions.h&quot;

int main(int argCount, char **argValue) {
    printf(&quot;12 + 31 = %d\n&quot;, addition(12, 31));
    return 0;
}</code></pre><pre id="r-561646" data-claire-element-id="561646"><code data-claire-semantic="c">#ifndef FONCTIONS
#define FONCTIONS

int addition(int, int);

#endif</code></pre><pre id="r-561647" data-claire-element-id="561647"><code data-claire-semantic="c">#include &quot;fonctions.h&quot;

int addition(int a, int b)
{
    return a + b;
}</code></pre><p id="r-561648" data-claire-element-id="561648">Passons maintenant à notre fichier et voyons quel genre de monstre il est :</p><pre id="r-561649" data-claire-element-id="561649"><code data-claire-semantic="bash"># Nom du projet
project(Addition)

# Déclaration de l'exécutable
add_executable(
    bin/addition
    src/main.c
    src/fonctions.h
    src/fonctions.c
)</code></pre><p id="r-561650" data-claire-element-id="561650">Mon dieu, c'est si compliqué ! :-°</p><p id="r-561651" data-claire-element-id="561651">Expliquons rapidement les deux commandes utilisées :</p><ul id="r-561656" data-claire-element-id="561656"><li id="r-561653" data-claire-element-id="561653"><p id="r-561652" data-claire-element-id="561652"><strong>project</strong> : ce sera le nom du projet dans les fichiers générés ;</p></li><li id="r-561655" data-claire-element-id="561655"><p id="r-561654" data-claire-element-id="561654"><strong>add_executable</strong> : on déclare l'exécutable, le premier argument sera le chemin de l'exécutable après compilation, la suite sera la liste des fichiers à compiler.</p></li></ul><p id="r-561657" data-claire-element-id="561657">Maintenant, il nous faut exploiter ce fichier !</p><h2 id="r-cmake-generer-un-projet" data-claire-element-id="561667"><code data-claire-semantic="console">cmake</code> : générer un projet</h2><p id="r-561659" data-claire-element-id="561659">Notre fichier <em>CMakeLists.txt</em> est prêt, lançons sans plus attendre CMake ! Pour générer un projet, rendez-vous à la racine de votre projet et lancez la commande de cette forme :</p><pre id="r-561660" data-claire-element-id="561660"><code data-claire-semantic="console">cmake . -G &quot;générateur&quot;</code></pre><p id="r-561661" data-claire-element-id="561661">Le premier paramètre désigne le répertoire où se trouve le <em>CMakeLists.txt</em>, chez moi c'est la racine. Quant à l'option -G, elle définit le générateur que l'on va utiliser. Par générateur, je désigne ce qui va être utilisé comme type de sortie (Makefile, projet d'EDI, etc.). Pour obtenir la liste des générateurs que vous pouvez utiliser avec votre système, il vous suffit d'entrer la commande <code data-claire-semantic="console">cmake --help</code>.</p><p id="r-561662" data-claire-element-id="561662">Par exemple, si je veux générer un Makefile pour un dérivé d'Unix, je vais entrer la commande :</p><pre id="r-561663" data-claire-element-id="561663"><code data-claire-semantic="console">cmake . -G &quot;Unix Makefiles&quot;</code></pre><p id="r-561664" data-claire-element-id="561664">Après, CMake va se débrouiller pour savoir que c'est du C et me générer mon fameux Makefile.<br/> Si nous lançons la compilation, nous obtiendrons bien notre programme :</p><pre id="r-561665" data-claire-element-id="561665"><code data-claire-semantic="console">$ make
[ 50%] Building C object CMakeFiles/bin/add.dir/src/main.c.o
[100%] Building C object CMakeFiles/bin/add.dir/src/fonctions.c.o
Linking C executable bin/addition
[100%] Built target bin/addition

$ ls bin/
addition

$ ./bin/addition
12 + 31 = 43</code></pre><p id="r-561666" data-claire-element-id="561666">À noter que vous devez relancer CMake à la modification du <em>CMakeLists.txt,</em> pas à chaque changement du code.</p><h2 id="r-utilisation-propre-un-dossier-build" data-claire-element-id="561672">Utilisation propre : un dossier build/</h2><p id="r-561668" data-claire-element-id="561668">Comme vous l'avez remarqué, CMake génère quand même un nombre important de fichiers.<br/> Pour pouvoir les concentrer et pouvoir les supprimer rapidement, on va exécuter CMake dans un répertoire build (que l'on va créer, bien sûr) en laissant juste le <em>CMakeLists.txt</em> à la racine. Pour l'exécutable, on ne va donc plus préciser de répertoire et donner directement le nom.<br/> Le fichier<em> CMakeLists.txt</em> lui ne change pas et l'exécution se déroule plutôt comme ceci :</p><pre id="r-561669" data-claire-element-id="561669"><code data-claire-semantic="bash">~/monprojet/build/ $ cmake .. -G &quot;Unix Makefiles&quot;
~/monprojet/build/ $ make
~/monprojet/build/ $ ./addition</code></pre><p id="r-561670" data-claire-element-id="561670">On notera que, comme nous sommes dans un sous-répertoire du projet et que notre fichier est à la racine, on utilise les deux points (« répertoire père »).</p><p id="r-561671" data-claire-element-id="561671">Ainsi, pour supprimer proprement l'exécutable et les fichiers temporaires, on fera bêtement un <code data-claire-semantic="console">rm -rf build/</code>.</p><h2 id="r-liste-automatique-des-fichiers" data-claire-element-id="561684">Liste automatique des fichiers</h2><p id="r-561673" data-claire-element-id="561673">Au fur et à mesure que votre projet grandit, l'arborescence du code fait de même. Ainsi, il devient gênant de devoir ajouter les nouveaux fichiers manuellement à chaque fois. Pour régler ce problème, CMake a tout prévu !<br/> En effet, avec la fonction <strong>file()</strong>, on peut récupérer simplement la liste complète des fichiers qui répondent à un masque. Cette fonction prend donc trois arguments :</p><ul id="r-561680" data-claire-element-id="561680"><li id="r-561675" data-claire-element-id="561675"><p id="r-561674" data-claire-element-id="561674">le premier est le type d'opération que l'on va faire : dans notre cas, nous allons mettre <strong>GLOB_RECURSE</strong> pour récupérer les fichiers de façon récursive ;</p></li><li id="r-561677" data-claire-element-id="561677"><p id="r-561676" data-claire-element-id="561676">le deuxième argument prend le nom de la variable où l'on va placer la liste ;</p></li><li id="r-561679" data-claire-element-id="561679"><p id="r-561678" data-claire-element-id="561678">le troisième argument est l'expression à laquelle le chemin de chaque fichier doit correspondre.</p></li></ul><p id="r-561681" data-claire-element-id="561681">Voici ce que cela donnerait dans notre <em>CMakeLists.txt</em> :</p><pre id="r-561682" data-claire-element-id="561682"><code data-claire-semantic="bash">cmake_minimum_required(VERSION 2.6) # Pour éviter un warning au lancement de CMake, on doit préciser la version minimale

# Nom du projet
project(Addition)

file(
    GLOB_RECURSE
    source_files
    src/*
)

# Déclaration de l'exécutable
add_executable(
    bin/addition
    ${source_files}
)</code></pre><p id="r-561683" data-claire-element-id="561683">Attention : quand on ajoute ou retire un fichier, il faut relancer CMake !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake">Introduction aux systèmes de construction logicielle avec CMake</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/presentation-du-concept">
Présentation du concept
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/cmakelists-txt-et-la-compilation-d-un-programme-simple">
CMakeLists.txt et la compilation d&#039;un programme simple
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/la-compilation-avec-librairies-externes">
La compilation avec librairies externes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/compiler-une-librairie">
Compiler une librairie
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/presentation-du-concept">
<span class="arrow"></span>
<span class="next">Présentation du concept</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/la-compilation-avec-librairies-externes">
<span class="next">La compilation avec librairies externes</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lacompilationaveclibrairiesexternes"></a><h2>La compilation avec librairies externes</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/cmakelists-txt-et-la-compilation-d-un-programme-simple">
<span class="arrow"></span>
<span class="next">CMakeLists.txt et la compilation d&#039;un programme simple</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/compiler-une-librairie">
<span class="next">Compiler une librairie</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-561686" data-claire-element-id="561686">Un peu plus compliqué maintenant, on va essayer (et réussir, je vous rassure !) d'ajouter une librairie à notre programme (par exemple la SDL).<br/> Il existe deux méthodes pour lier une librairie : une méthode manuelle et une méthode dite assistée. Néanmoins, comme la méthode assistée est limitée dans les librairies, je vais vous les présenter toutes les deux.</p><h2 id="r-methode-manuelle-1" data-claire-element-id="561694">Méthode manuelle</h2><p id="r-561687" data-claire-element-id="561687">Pour préciser le répertoire des headers de la librairie, on va utiliser la fonction <strong>include_directories()</strong> qui prend comme argument un chemin vers ce répertoire. Pour les binaires de la librairie, on utilise <strong>link_directories()</strong> qui prend aussi un chemin en argument.<br/> Et pour faire encore plus compliqué maintenant, on doit utiliser la fonction <strong>target_link_libraries()</strong> pour <em>linker</em> la librairie à l'exécutable. Cette fonction quant à elle prend comme premier argument le chemin vers l'exécutable, puis le nom de la librairie qu'on <em>linke</em> (par exemple, la SDL est <em>linkée</em> sous gcc avec -lSDL, on va passer SDL comme argument).<br/> Mais attention, vu que ces données sont spécifiques à l'utilisateur, on va passer par un autre fichier pour les préciser : <em>CMakeCache.txt</em>. Dans notre <em>CMakeLists.txt</em>, cependant, nous allons passer des variables.</p><p id="r-561688" data-claire-element-id="561688">Voici un exemple de <em>CMakeLists.txt</em> pour charger une bibliothèque.</p><pre id="r-561689" data-claire-element-id="561689"><code data-claire-semantic="bash">cmake_minimum_required(VERSION 2.6)

project(MyProject)
include_directories(${sdl_include_dir})
link_directories(${sdl_lib_dir})

#Configuration de l'exécutable
file(
        GLOB_RECURSE
        source_files
        src/*
)
add_executable(
        bin/sdl
        ${source_files}
)

target_link_libraries(
        bin/sdl
        ${sdl_lib_name}
)</code></pre><p id="r-561690" data-claire-element-id="561690">Lancez la commande <code data-claire-semantic="console">cmake</code> puis nous allons éditer le fichier <em>CMakeCache.txt</em>.</p><p id="r-561691" data-claire-element-id="561691">Dedans, nous allons ajouter les valeurs des variables dans la partie « External ». Par exemple, chez moi je vais ajouter ceci :</p><pre id="r-561692" data-claire-element-id="561692"><code data-claire-semantic="bash">sdl_include_dir:FILEPATH=/usr/include/SDL/

sdl_lib_dir:FILEPATH=/usr/lib/

sdl_lib_name:STRING=SDL</code></pre><p id="r-561693" data-claire-element-id="561693">Vous n'avez plus qu'à compiler votre programme avec la commande <code data-claire-semantic="console">make</code> et démarrer le binaire dans bin/ pour constater que la librairie a bien été <em>linkée</em> !</p><h2 id="r-methode-assistee-1" data-claire-element-id="561705">Méthode « assistée »</h2><p id="r-561695" data-claire-element-id="561695">Certaines librairies courantes possèdent un module d'inclusion automatisée grâce à la fonction <strong>Find_Package()</strong>.<br/> Pour en avoir la liste, vous pouvez regarder dans le répertoire <em>/usr/share/cmake-x.x/Modules/</em> ou <em>C:\Program Files\Cmake x.x\share\cmake-x.x\Modules\</em>, que j'abrégerai <strong>${MODULE_DIR}</strong> dans la suite.</p><p id="r-561696" data-claire-element-id="561696">La fonction <strong>Find_Package()</strong> prend donc en premier paramètre le nom de la librairie, il s'agit du même nom que dans <em>${MODULE_DIR}/Find[NOM].cmake</em>. Pour la SDL, c'est donc tout bêtement SDL ! :-° <br/> Après, pour le deuxième argument, on précise si l'inclusion doit être muette ou non (<strong>QUIET</strong>).<br/> Quant au troisième argument, on précise si la librairie est requise ou non (<strong>REQUIRED</strong>).</p><p id="r-561697" data-claire-element-id="561697">En général, ça donnera quelque chose comme :</p><pre id="r-561698" data-claire-element-id="561698"><code data-claire-semantic="bash">Find_Package(SDL REQUIRED)</code></pre><p id="r-561699" data-claire-element-id="561699">Maintenant, que fait cette fonction ? Elle va exécuter un script, et ce qui nous intéresse, c'est que ce même script va créer des variables contenant les différents chemins vers la librairie.<br/> Vous aurez la liste en haut du fichier du module, par exemple pour la SDL :</p><pre id="r-561700" data-claire-element-id="561700"><code data-claire-semantic="console">$ head /usr/share/cmake-2.6/Modules/FindSDL.cmake 
# Locate SDL library
# This module defines
# SDL_LIBRARY, the name of the library to link against
# SDL_FOUND, if false, do not try to link to SDL
# SDL_INCLUDE_DIR, where to find SDL.h
#
# This module responds to the the flag:
# SDL_BUILDING_LIBRARY
# If this is defined, then no SDL_main will be linked in because 
# only applications need main().</code></pre><p id="r-561701" data-claire-element-id="561701">Voici donc ce qui changerait dans notre <em>CMakeLists.txt</em> précédent :</p><pre id="r-561702" data-claire-element-id="561702"><code data-claire-semantic="bash">Find_Package(SDL REQUIRED)

include_directories(${SDL_INCLUDE_DIR})

target_link_libraries(
    bin/sdl
    ${SDL_LIBRARY}
)</code></pre><p id="r-561703" data-claire-element-id="561703">Néanmoins, pour l'instant, il y a un manque de sécurité : si la librairie n'est pas trouvée, on devrait stopper l'exécution de CMake avant qu'il génère le projet.<br/> Pour cela, on va utiliser une structure conditionnelle pour vérifier si la variable <strong>SDL_FOUND</strong> vaut <strong>false</strong> (voir le haut du fichier plus haut, c'est expliqué) : si c'est le cas, on arrête l'exécution.</p><pre id="r-561704" data-claire-element-id="561704"><code data-claire-semantic="bash">Find_Package(SDL REQUIRED)

if ( NOT SDL_FOUND )
    message(FATAL_ERROR &quot;SDL not found !&quot;)
endif ( NOT SDL_FOUND )

# ...</code></pre>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake">Introduction aux systèmes de construction logicielle avec CMake</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/presentation-du-concept">
Présentation du concept
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/cmakelists-txt-et-la-compilation-d-un-programme-simple">
CMakeLists.txt et la compilation d&#039;un programme simple
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/la-compilation-avec-librairies-externes">
La compilation avec librairies externes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/compiler-une-librairie">
Compiler une librairie
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/cmakelists-txt-et-la-compilation-d-un-programme-simple">
<span class="arrow"></span>
<span class="next">CMakeLists.txt et la compilation d&#039;un programme simple</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/compiler-une-librairie">
<span class="next">Compiler une librairie</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Compilerunelibrairie"></a><h2>Compiler une librairie</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/la-compilation-avec-librairies-externes">
<span class="arrow"></span>
<span class="next">La compilation avec librairies externes</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-561707" data-claire-element-id="561707">Je ne vois pas comment je pourrais parler de CMake sans vous expliquer comment compiler une librairie, étant donné qu'il est utilisé pour nombre d'entre elles (par exemple OpenCV, librairie de traitement d'images) !</p><p id="r-561708" data-claire-element-id="561708">Reprenons un projet simple de librairie mathématique comportant une fonction d'addition :</p><pre id="r-561709" data-claire-element-id="561709"><code>| include/
|------------ libsmaths/
|-------------------------- addition.h
| lib/
| src/
|------- addition.c
| CMakeFiles.txt</code></pre><p id="r-561710" data-claire-element-id="561710">Le répertoire lib/ va accueillir la librairie compilée.</p><p id="r-561711" data-claire-element-id="561711">Au niveau du <em>CMakeFiles.txt,</em> rien de compliqué, il n'y a que la déclaration de l'exécutable qui va changer en déclaration d'une librairie. Ainsi, on va utiliser la fonction <strong>add_library()</strong> à la place de la fonction <strong>add_executable()</strong>. Il n'y a qu'une petite différence au niveau des paramètres : avant de prendre la liste des fichiers, on prend aussi le type de librairie (<strong>SHARED</strong> si on la lie dynamiquement et <strong>STATIC</strong> si on la lie statiquement).</p><p id="r-561712" data-claire-element-id="561712">Le nom de la librairie est celui de <em>libNOM.so</em>.<br/> Pour préciser le répertoire où l'on va mettre le résultat, on va par contre modifier la variable <strong>LIBRARY_OUTPUT_PATH</strong>.</p><p id="r-561713" data-claire-element-id="561713">Voici donc un exemple concret :</p><pre id="r-561714" data-claire-element-id="561714"><code data-claire-semantic="bash">cmake_minimum_required(VERSION 2.6)
project(maths)
set(LIBRARY_OUTPUT_PATH lib)
include_directories(include)
file(
        GLOB_RECURSE
        source_files
        src/*
        include/*
)

add_library(
        maths
        SHARED
        ${source_files}
)</code></pre><p id="r-561715" data-claire-element-id="561715">Vous connaissez maintenant la base des bases pour utiliser CMake, mais cet outil est vraiment très complet, et vous n'avez pas encore idée de la puissance du côté obscur de la force ! <br/> Renseignez-vous sur les différentes variables que vous pouvez modifier, comme <strong>CMAKE_CXX_FLAGS</strong> qui représente les <em>flags</em> de compilation, ou encore sur les différentes fonctions disponibles.<br/> Le meilleur moyen pour cela est de vous rendre sur <a href="http://cmake.org/">le site officiel de CMake</a> et de le parcourir, en particulier <a href="http://www.cmake.org/Wiki/CMake">le wiki</a> qui contient divers articles intéressants.</p><p id="r-561716" data-claire-element-id="561716">Je tiens à remercier <a href="http://www.siteduzero.com/membres-294-67116.html">ordiclic</a> pour sa relecture.</p><p id="r-561717" data-claire-element-id="561717">Bon développement !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake">Introduction aux systèmes de construction logicielle avec CMake</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/presentation-du-concept">
Présentation du concept
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/cmakelists-txt-et-la-compilation-d-un-programme-simple">
CMakeLists.txt et la compilation d&#039;un programme simple
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/la-compilation-avec-librairies-externes">
La compilation avec librairies externes
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/compiler-une-librairie">
Compiler une librairie
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/introduction-aux-systemes-de-construction-logicielle-avec-cmake/la-compilation-avec-librairies-externes">
<span class="arrow"></span>
<span class="next">La compilation avec librairies externes</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/introduction-aux-systemes-de-construction-logicielle-avec-cmake.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 06:37:03 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/introduction-aux-systemes-de-construction-logicielle-avec-cmake.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:11:04 GMT -->
</html>