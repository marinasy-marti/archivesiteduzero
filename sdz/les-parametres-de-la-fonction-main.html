<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/les-parametres-de-la-fonction-main.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:50:21 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/les-parametres-de-la-fonction-main.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:37:24 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Les paramètres de la fonction main</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/les-parametres-de-la-fonction-main.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Les paramètres de la fonction main</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Lesparamtresdelafonctionmain">Les paramètres de la fonction main</a><br/><a href="#Descriptiondesparamtres">Description des paramètres</a><br/><a href="#Utiliserlesparamtres">Utiliser les paramètres</a><br/><a href="#Ledossierdelancement">Le dossier de lancement</a><br/></div>
<a name="Lesparamtresdelafonctionmain"></a><h2>Les paramètres de la fonction main</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main/description-des-parametres">
<span class="next">Description des paramètres</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-439047" data-claire-element-id="439047">Bonjour à tous et à toutes :) .<br/> Avant toute chose, je tiens à vous dire que la lecture des deux premières parties du cours de C / C++ de m@teo21 est nécessaire à la compréhension de ce tutoriel. Plus précisément, vous devez connaître les notions suivantes en C :</p><ul id="r-439056" data-claire-element-id="439056"><li id="r-439049" data-claire-element-id="439049"><p id="r-439048" data-claire-element-id="439048">fonctions</p></li><li id="r-439051" data-claire-element-id="439051"><p id="r-439050" data-claire-element-id="439050">pointeurs</p></li><li id="r-439053" data-claire-element-id="439053"><p id="r-439052" data-claire-element-id="439052">tableaux</p></li><li id="r-439055" data-claire-element-id="439055"><p id="r-439054" data-claire-element-id="439054">ouverture de fichiers texte</p></li></ul><p id="r-439057" data-claire-element-id="439057">Dans ce tutoriel, je vais tenter de vous expliquer l'utilité des paramètres de la fonction <em>main</em> en C.<br/> Vous verrez qu'ils nous permettent de faire des choses très intéressantes :p .<br/> Prêts ? On y va :) !</p>
</div><a name="Descriptiondesparamtres"></a><h2>Description des paramètres</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main/utiliser-les-parametres">
<span class="next">Utiliser les paramètres</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-439058" data-claire-element-id="439058">Avant toute chose, on va se mettre d'accord sur la syntaxe <strong>correcte</strong> à utiliser pour la fonction <em>main</em> que voici :</p><pre id="r-439059" data-claire-element-id="439059"><code data-claire-semantic="c">int main (int argc, char *argv[])</code></pre><p id="r-439060" data-claire-element-id="439060">C'est la forme utilisée dans le cours de m@teo21 et c'est celle que j'utiliserai tout au long de ce tutorial.<br/> Maintenant, voyons ce que sont ces <em>argc</em> et <em>argv</em>.</p><h2 id="r-les-parametres-argc-et-argv" data-claire-element-id="439073">Les paramètres : argc et argv</h2><p id="r-439061" data-claire-element-id="439061">Le paramètre <em>argv</em> est en réalité un tableau de pointeurs.<br/> Chacun de ces pointeurs pointe sur des chaînes de caractères :</p><figure id="r-439063" data-claire-element-id="439064"><img id="r-439062" data-claire-element-id="439062" src="medias/uploads.siteduzero.com_files_39001_40000_39490.jpg" alt="Image utilisateur"/></figure><p id="r-439065" data-claire-element-id="439065"><em>Note : si vous ne comprenez vraiment pas le sens de ce diagramme, je vous conseille de (re)lire le chapitre sur les chaînes de caractères et/ou celui sur les pointeurs du cours de m@teo21.</em></p><p id="r-439066" data-claire-element-id="439066">Le paramètre <em>argc</em> quant à lui, indique simplement le nombre de chaînes de caractères sur lequel pointe <em>argv</em>.</p><p id="r-439067" data-claire-element-id="439067">Par exemple, si <em>argc</em> vaut 2, cela veut dire que <em>argv</em> pointe sur deux chaînes de caractères, qu'on notera ainsi :</p><pre id="r-439068" data-claire-element-id="439068"><code data-claire-semantic="c">argv[0]
argv[1]</code></pre><p id="r-439069" data-claire-element-id="439069">Voilà, vous savez comment ça marche :) .<br/> Et maintenant, la question qui tue...</p><div id="r-439071" data-claire-element-id="439071" data-claire-semantic="question"><p id="r-439070" data-claire-element-id="439070">A quoi ça sert ?</p></div><p id="r-439072" data-claire-element-id="439072">C'est ce que nous allons voir maintenant :) .</p><h2 id="r-le-systeme-d-exploitation-et-argv" data-claire-element-id="439078">Le système d'exploitation et argv</h2><p id="r-439074" data-claire-element-id="439074">Ces chaînes de caractères sont en réalité envoyées par votre système d'exploitation (Windows, Linux, etc...) au programme au lancement de ce dernier.</p><p id="r-439075" data-claire-element-id="439075">La première case de <em>argv</em> pointe généralement sur une chaîne de caractères qui sera le chemin de votre programme (ex : &quot;<em>C:/mon_super_programme/mon_super_programme.exe</em>&quot;), plus exactement <em>la commande utilisée pour lancer votre programme</em> (on y reviendra tout à l'heure, ne vous en faites pas ;) ) ; et si le chemin n'est pas disponible (sait-on jamais :p ), argv[0] doit alors pointer sur une chaîne vide.</p><p id="r-439076" data-claire-element-id="439076">Par ailleurs, la norme veut que argc soit strictement supérieur à 0 et elle veut enfin que argv[argc] pointe sur NULL.</p><p id="r-439077" data-claire-element-id="439077">Les autres cases peuvent pointer sur d'autres chaînes de caractères envoyées par le système d'exploitation qui sont généralement indiquées par l'utilisateur en ligne de commande, grâce à la <strong>console</strong>.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main">Les paramètres de la fonction main</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main/description-des-parametres">
Description des paramètres
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main/utiliser-les-parametres">
Utiliser les paramètres
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main/le-dossier-de-lancement">
Le dossier de lancement
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main/utiliser-les-parametres">
<span class="next">Utiliser les paramètres</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Utiliserlesparamtres"></a><h2>Utiliser les paramètres</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main/description-des-parametres">
<span class="arrow"></span>
<span class="next">Description des paramètres</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main/le-dossier-de-lancement">
<span class="next">Le dossier de lancement</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-passer-des-arguments-en-console" data-claire-element-id="439109">Passer des arguments en console</h2><p id="r-439080" data-claire-element-id="439080"><em>Note : Sous Windows et Linux, la démarche à suivre est la même hormis pour l'ouverture de la console.</em></p><p id="r-439081" data-claire-element-id="439081">Supposons que mon programme soit dans le répertoire suivant :<br/><em>C:\mon_super_programme\mon_super_programme.exe</em></p><p id="r-439082" data-claire-element-id="439082">Tout d'abord, ouvrez une console <em>(Démarrer &gt; Exécuter &gt; tapez &quot;cmd&quot; sous Windows)</em>.</p><p id="r-439083" data-claire-element-id="439083">Ensuite, placez-vous à la racine du disque dur ou de la partition où se trouve votre programme (C: sous Windows, généralement) en tapant simplement sa lettre :</p><pre id="r-439084" data-claire-element-id="439084"><code data-claire-semantic="console">C:</code></pre><p id="r-439085" data-claire-element-id="439085">Ensuite, vous devez indiquer le chemin relatif du dossier où se situe votre programme par rapport à la racine du disque sur lequel vous êtes précédé de la commande &quot;cd&quot;) comme ceci :</p><pre id="r-439086" data-claire-element-id="439086"><code data-claire-semantic="console">cd mon_super_programme</code></pre><p id="r-439087" data-claire-element-id="439087">Enfin, vous devez indiquer le nom de votre exécutable suivi des paramètres que vous voulez :</p><pre id="r-439088" data-claire-element-id="439088"><code data-claire-semantic="console">mon_super_programme.exe coucou test toto</code></pre><p id="r-439089" data-claire-element-id="439089">Chaque mot après le nom du programme sera placé dans une chaîne de caractères à laquelle vous pourrez accéder grâce à <em>argv</em>.<br/> Ainsi, dans mon exemple, on aura :</p><ul id="r-439098" data-claire-element-id="439098"><li id="r-439091" data-claire-element-id="439091"><p id="r-439090" data-claire-element-id="439090"><strong>dans argv[0]</strong> : mon_super_programme.exe <em>(oui, souvenez-vous, je vous ai dit que par convention, le chemin du programme était indiqué dans argv[0] ;) )</em></p></li><li id="r-439093" data-claire-element-id="439093"><p id="r-439092" data-claire-element-id="439092"><strong>dans argv[1]</strong> : coucou</p></li><li id="r-439095" data-claire-element-id="439095"><p id="r-439094" data-claire-element-id="439094"><strong>dans argv[2]</strong> : test</p></li><li id="r-439097" data-claire-element-id="439097"><p id="r-439096" data-claire-element-id="439096"><strong>dans argv[3]</strong> : toto</p></li></ul><p id="r-439099" data-claire-element-id="439099">Ainsi, on pourra facilement récupérer ces arguments dans notre programme en C.<br/> C'est d'ailleurs ce qu'on va faire avec un petit exercice ;) .</p><h3 id="r-exercice-d-application-1" data-claire-element-id="439108">Exercice d'application</h3><p id="r-439100" data-claire-element-id="439100">Le but de cet exercice sera de vous familiariser à la gestion de <em>argc</em> et <em>argv</em>. Le principe est simple : afficher dans notre programme les arguments qui lui ont été passés par la console.<br/> Essayez de le faire vous-même puis regardez cette correction :</p><pre id="r-439101" data-claire-element-id="439101"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int main(int argc, char *argv[])
{
    int i;

    for (i=0; i &lt; argc; i++)
    {
        printf(&quot;Argument %ld : %s \n&quot;, i+1, argv[i]);
    }

    getchar();
    return EXIT_SUCCESS;
}</code></pre><p id="r-439102" data-claire-element-id="439102">Notez que j'indique dans <em>printf</em> &quot;i+1&quot; pour le numéro du paramètre car i commence à 0 dans ma boucle.</p><p id="r-439103" data-claire-element-id="439103">Une fois lancé en console en suivant la démarche de tout à l'heure, vous devriez voir quelque chose comme ça :</p><pre id="r-439104" data-claire-element-id="439104"><code data-claire-semantic="console">C:\mon_super_programme&gt;mon_super_programme.exe coucou test toto

Argument 1 : mon_super_programme.exe

Argument 2 : coucou

Argument 3 : test

Argument 4 : toto</code></pre><div id="r-439106" data-claire-element-id="439106" data-claire-semantic="question"><p id="r-439105" data-claire-element-id="439105">Pourquoi le chemin du programme est juste &quot;console.exe&quot; ?</p></div><p id="r-439107" data-claire-element-id="439107">En fait, c'est parce que le programme a été lancé depuis la console : comme je vous l'ai dit, argv[0] pointe en réalité sur la commande envoyée en console pour exécuter votre programme. En l'occurence, nous avons seulement tapé &quot;mon_super_programme.exe&quot; pour exécuter le programme donc argv[0] ne contient que &quot;mon_super_programme.exe&quot; :) .<br/> Cependant, lorsque votre programme est lancé à travers une interface graphique (en cliquant sur son icône), argv[0] contiendra bien le chemin entier de votre programmme, et c'est justement ce que nous allons voir maitenant ;) .</p><h2 id="r-l-association-de-fichiers" data-claire-element-id="439148">L'association de fichiers</h2><p id="r-439110" data-claire-element-id="439110">Bon, maintenant que vous connaissez le principe, je vais vous parler d'une fonctionnalité que l'on retrouve sous plusieurs systèmes d'exploitation, j'ai nommé : <em>L'association de fichiers</em>.</p><p id="r-439111" data-claire-element-id="439111">Cette fonction vous permet d'associer un programme à un fichier de sorte que lorsque vous choisissez ce fichier, le programme approprié se lance et s'en sert.<br/> Par exemple, vos fichiers musicaux (.mp3) sont probablement associés à un lecteur (Winamp, Windows Media Player, etc...) de sorte que lorsque vous double-cliquez sur un fichier MP3, le lecteur approprié se lance et joue ce fichier.</p><p id="r-439112" data-claire-element-id="439112">Eh bien figurez-vous qu'en C, le chemin absolu de ce fichier sera contenu dans <strong><em>argv[1]</em></strong> :) (si aucune autre information n'est pasée à la fonction <em>main</em> hormis le chemin du programme).</p><p id="r-439113" data-claire-element-id="439113">En effet, lorsque vous associez un fichier à un programme et que vous double-cliquez sur ce fichier, votre système d'exploitation va lancer le programme en question en lui envoyant comme paramètre le chemin du fichier.</p><h3 id="r-exercice-d-application-2" data-claire-element-id="439119">Exercice d'application</h3><p id="r-439114" data-claire-element-id="439114">De cette façon, vous pouvez créer des applications qui gèrent l'association de fichiers, tenez par exemple, essayez de faire un programme en console qui permettrait d'afficher le contenu d'un fichier .txt qui lui serait passé en paramètre (dans argv[1] donc) :</p><pre id="r-439115" data-claire-element-id="439115"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int main (int argc, char *argv[])
{
    FILE *fichier = NULL;
    char caractere;
    if (argc &gt; 1)
    {
        fichier = fopen (argv[1], &quot;r&quot;); /* On ouvre le fichier dont le chemin est accessible via argv[1] */
    }

    if (fichier != NULL)
    {
        do
        {
            caractere = fgetc (fichier);
            printf(&quot;%c&quot;, caractere);
        } while (caractere != EOF);
    }
    else exit(EXIT_FAILURE);

    getchar();

    return EXIT_SUCCESS;
}</code></pre><p id="r-439116" data-claire-element-id="439116">Dans ce code, notez que la condition</p><pre id="r-439117" data-claire-element-id="439117"><code data-claire-semantic="c">if (fichier != NULL)</code></pre><p id="r-439118" data-claire-element-id="439118">est d'autant plus importante que l'on ne sait pas si le chemin donné dans <em>argv[1]</em> est bien celui d'un fichier texte (l'utilisateur peut associer un programme au type de fichier qu'il veut). <br/> Tiens, justement, parlons-en de l'association de fichiers :</p><h3 id="r-associer-un-programme-a-un-type-de-fichier" data-claire-element-id="439147">Associer un programme à un type de fichier</h3><aside id="r-439121" data-claire-element-id="439121" data-claire-semantic="information"><p id="r-439120" data-claire-element-id="439120"><strong>Aux utilisateurs de Linux :</strong> étant donné que chaque distribution de Linux n'utilise pas le même système d'association de fichiers, je vous recommande <a href="http://www.lea-linux.org/documentations/index.php/Admin-admin_env-binfmt">ce tutoriel de Frédéric Bonnaud</a> qui explique comment réaliser une association de fichiers qui marche avec n'importe quelle distribution grâce à <em>binfmt</em>.</p></aside><p id="r-439122" data-claire-element-id="439122">Sous Windows, pour associer un programme à vos fichiers .txt, compilez (sans l'exécuter) le programme que vous venez de réaliser puis faites un clic droit sur un fichier texte et allez dans &quot;Propriétés&quot;.<br/> Dans le champ &quot;S'ouvre avec&quot;, cliquez sur le bouton &quot;Modifier...&quot;.</p><figure id="r-439124" data-claire-element-id="439125"><img id="r-439123" data-claire-element-id="439123" src="medias/uploads.siteduzero.com_files_39001_40000_39492.jpg" alt="Image utilisateur"/></figure><p id="r-439126" data-claire-element-id="439126">Une fenêtre s'ouvre.<br/> Cliquez sur &quot;Parcourir&quot; et choisissez votre programme. Cliquez alors sur OK et fermez la fenêtre des Propriétés.<br/> Désormais, lorsque vous cliquerez sur vos fichiers texte, ils s'ouvriront dans votre programme.</p><figure id="r-439128" data-claire-element-id="439129"><img id="r-439127" data-claire-element-id="439127" src="medias/uploads.siteduzero.com_files_39001_40000_39493.jpg" alt="Image utilisateur"/></figure><p id="r-439130" data-claire-element-id="439130"><strong>Remarque importante :</strong> ce procédé fonctionne également quand vous faites un glissé-déplacé d'un fichier sur l'icône de votre programme ; le chemin absolu du fichier se trouvera également dans argv[1] :) .</p><figure id="r-439132" data-claire-element-id="439133"><img id="r-439131" data-claire-element-id="439131" src="medias/uploads.siteduzero.com_files_39001_40000_39494.jpg" alt="Image utilisateur"/></figure><p id="r-439134" data-claire-element-id="439134">Plutôt sympa, non :D ?</p><p id="r-439135" data-claire-element-id="439135"><strong>Problème avec les arguments sous Windows</strong><br/> Ce passage traite d'un problème qui peut arriver le plus souvent lorsque vous créez votre propre extension sous Windows et que vous envoyez en paramètre à votre programme un fichier possédant cette extension.</p><p id="r-439136" data-claire-element-id="439136">Il arrive dans ce cas que le chemin du fichier que vous passez en paramètre soit incomplet.<br/> Plus exactement, dès qu'un espace est présent dans son chemin (ex : C:/Mes fichiers/fichier.ext), le chemin sera alors &quot;fragmenté&quot; en deux morceaux à partir de l'espace : le premier morceau sera dans argv[1] et le second dans argv[2].</p><div id="r-439138" data-claire-element-id="439138" data-claire-semantic="question"><p id="r-439137" data-claire-element-id="439137">Pourquoi ?</p></div><p id="r-439139" data-claire-element-id="439139">Sans trop rentrer dans les détails, le problème vient du fait que l'extension du fichier que vous utilisez est mal paramétrée sous Windows. Il nous faudra donc appliquer une légère modification.</p><p id="r-439140" data-claire-element-id="439140">Allez dans <em>Démarrer -&gt; Paramètres -&gt; Panneau de Configuration -&gt; Options des Dossiers -&gt; onglet &quot;Types de Fichiers&quot;</em>.<br/> Ici, vous aurez une liste des extensions connues par Windows.<br/> Dans cette liste, cherchez votre extension, puis cliquez sur le bouton &quot;Avancé&quot;.<br/> Une liste d'actions devrait alors apparaître à votre écran. Choisissez &quot;open&quot; (action d'ouvrir le fichier en anglais) puis cliquez sur &quot;Modifier...&quot;. Dans la nouvelle fenêtre, observez le champ &quot;Application utilisée pour exécuter cette action&quot;. Vous devriez y voir le chemin de votre programme entre guillemets suivi d'un obscur <em>%1</em>.</p><p id="r-439141" data-claire-element-id="439141">Vous devez alors remplacer ce <em>%1</em> par <em>&quot;%1&quot;</em>avec des guillemets.</p><figure id="r-439143" data-claire-element-id="439144"><img id="r-439142" data-claire-element-id="439142" src="medias/uploads.siteduzero.com_files_42001_43000_42391.jpg" alt="Image utilisateur"/></figure><p id="r-439145" data-claire-element-id="439145">De cette façon le chemin complet de votre fichier sera passé dans argv[1]. <br/> Je sais que je vous ai donné peu d'explications sur ce point mais l'on touche au système de gestion des fichiers de Windows et ce n'est pas le sujet de ce tutoriel donc je préfère ne pas m'étendre dessus :) .</p><p id="r-439146" data-claire-element-id="439146">Cependant, on n'en a pas fini avec l'association de fichiers : en effet, il y a un léger problème...<br/> Rien de grave, lisez plutôt :p .</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main">Les paramètres de la fonction main</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main/description-des-parametres">
Description des paramètres
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main/utiliser-les-parametres">
Utiliser les paramètres
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main/le-dossier-de-lancement">
Le dossier de lancement
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main/description-des-parametres">
<span class="arrow"></span>
<span class="next">Description des paramètres</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main/le-dossier-de-lancement">
<span class="next">Le dossier de lancement</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Ledossierdelancement"></a><h2>Le dossier de lancement</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main/utiliser-les-parametres">
<span class="arrow"></span>
<span class="next">Utiliser les paramètres</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-439150" data-claire-element-id="439150">Vous vous rappelez quand je vous ai dit que argv[0] contenait le chemin du programme relatif au dossier d'où vous le lanciez ? :) <br/> Eh bien, le problème avec l'association de fichier est que lorsque vous ouvrez un fichier auquel votre programme est associé, votre programme est lancé depuis le dossier où se trouve votre fichier (vous me suivez :p ?).</p><p id="r-439151" data-claire-element-id="439151">Prenons un exemple :<br/> Je lance un fichier toto.txt qui se trouve dans C: exte\ : le dossier de lancement de mon programme sera <strong>C: exte</strong>.</p><div id="r-439153" data-claire-element-id="439153" data-claire-semantic="question"><p id="r-439152" data-claire-element-id="439152">Et alors, je ne vois pas le problème ?</p></div><p id="r-439154" data-claire-element-id="439154">Le problème, c'est que si votre programme utilise des ressources comme par exemple des images qui sont stockées dans le dossier où il est installé, le chemin que vous indiquerez pour ces dernières ne sera plus valide, puisqu'il est relatif au dossier d'installation de votre programme !</p><p id="r-439155" data-claire-element-id="439155">Heureusement, il existe des fonctions en C pour pallier à ce problème :) .</p><h2 id="r-premiere-fonction-getcwd" data-claire-element-id="439161">Première fonction : getcwd</h2><p id="r-439156" data-claire-element-id="439156">Cette fonction au nom étrange (comme beaucoup d'autres d'ailleurs :-° ) stocke dans une chaîne de caractères le dossier de lancement de votre programme. On l'utilise de cette façon :</p><pre id="r-439157" data-claire-element-id="439157"><code data-claire-semantic="c">char dossier_lancement[30];
getcwd (dossier_lancement, 30);</code></pre><p id="r-439158" data-claire-element-id="439158">Comme vous le voyez, le premier paramètre est la chaîne de caractères où vous voulez stocker le nom du dossier de lancement, et le second est le nombre maximal de caractères.<br/> De cette façon, vous pouvez vérifier si le dossier de lancement est bien celui où votre programme est installé. Justement, je vous propose de coder une fonction qui à ce rôle ; disons qu'elle renvoie 0 si le dossier de lancement correspond au dossier d'installation du programme et 1 si ce n'est pas le cas.</p><pre id="r-439159" data-claire-element-id="439159"><code data-claire-semantic="c">int verifier_dossier_lancement (char dossier_programme[])
{
        char dossier_lancement[30];
        getcwd (dossier_lancement, 30);
        if (strcmp (dossier_lancement, dossier_programme) != 0)
        {
                return EXIT_SUCCESS;
        }
        else 
        {
                return EXIT_FAILURE;
        }
}</code></pre><p id="r-439160" data-claire-element-id="439160">Et voilà pour getcwd :) .</p><h2 id="r-deuxieme-fonction-chdir" data-claire-element-id="439190">Deuxième fonction : chdir</h2><p id="r-439162" data-claire-element-id="439162">Cette fonction permet de changer le répertoire de lancement du programme durant l'exécution de celui-ci. Voici sa syntaxe :</p><pre id="r-439163" data-claire-element-id="439163"><code data-claire-semantic="c">chdir (&quot;C:\\dossier_programme&quot;);</code></pre><p id="r-439164" data-claire-element-id="439164">Elle renvoie 0 si tout s'est bien passé et -1 si une erreur est survenue.<br/> Pour pouvoir l'utiliser, il faut inclure le fichier d'en-tête <em>unistd.h</em> (en pratique le compilateur doit pouvoir se débrouiller tout seul, mais renverra tout de même un warning).<br/> Maintenant, je vous propose d'améliorer notre fonction pour faire en sorte qu'elle change le dossier de lancement du programme si celui-ci n'est pas le dossier d'installation du programme.</p><pre id="r-439165" data-claire-element-id="439165"><code data-claire-semantic="c">int verifier_dossier_lancement (char dossier_programme[])
{
        char dossier_lancement[30];
        getcwd (dossier_lancement, 30);
        if (strcmp (dossier_lancement, dossier_programme) != 0)
        { /* Si le dossier de lancement est différent du dossier d'installation du programme... */
                if (chdir(dossier_programme[]) == 0)
                { /* On change le répertoire de lancement et on vérifie que tout se passe bien */
                        return EXIT_SUCCESS;
                }
                else 
                {
                        return EXIT_FAILURE;
                }
        }
        else 
        {
                return EXIT_SUCCESS;
        }
}</code></pre><p id="r-439166" data-claire-element-id="439166">Et voilà :) .</p><div id="r-439168" data-claire-element-id="439168" data-claire-semantic="question"><p id="r-439167" data-claire-element-id="439167">Mais comment on le connaît, le chemin du programme ?</p></div><p id="r-439169" data-claire-element-id="439169">Il suffit de regarder dans argv[0], souvenez-vous ;) !<br/> Vous aurez quelque chose comme ça : &quot;C:\\dossier_programme\\programme.exe&quot; - il vous suffit de faire une fonction enlevant le &quot;programme.exe&quot; pour récupérer le dossier d'installation de votre programme et le tour est joué :p .</p><p id="r-439170" data-claire-element-id="439170">Tiens...et si on la codait, cette fonction :) ?</p><pre id="r-439171" data-claire-element-id="439171"><code data-claire-semantic="c">void dossier_lancement (char chemin_programme[], char dossier[])
{
        int i;

        for (i= strlen(chemin_programme) ; i&gt;0; i--)
        {
                if (chemin_programme[i] == '\\')
                /* Lorsqu'on tombe sur le premier &quot;\&quot;, on commence à recopier chemin_programme dans dossier */
                {
                        dossier[i] = '\0'; 
                        i--; /* On passe au caractère précédent pour commencer à recopier le dossier de lancement */
                        while (i &gt;= 0)
                        {
                                dossier[i] = chemin_programme[i];
                                i--;
                        }
                }
        }
}</code></pre><p id="r-439172" data-claire-element-id="439172">Ici, <em>chemin_programme</em> est le chemin de votre programme tel qu'il est écrit dans argv[0] et <em>dossier</em> est la chaîne de caractères dans laquelle on va écrire le chemin du dossier de lancement.</p><p id="r-439173" data-claire-element-id="439173">Vous remarquerez que la fonction étudie la chaîne en partant du dernier caractère ; cela ne doit pas vous perturber : c'est le moyen le plus simple de savoir lorsqu'on atteint un dossier (indiqué par le symbole &quot;\&quot;).</p><p id="r-439174" data-claire-element-id="439174">Et voilà, c'est fini. Ce n'était pas si dur après tout :p .</p><aside id="r-439176" data-claire-element-id="439176" data-claire-semantic="information"><p id="r-439175" data-claire-element-id="439175">Une petite précision avant de clore ce tutoriel, notez que les fonctions <strong>chdir</strong> et <strong>getcwd</strong> sont conformes à une norme appelée <em>POSIX.1</em>. Si vous voulez en savoir plus, je vous recommande <a href="http://fr.wikipedia.org/wiki/POSIX">cet article Wikipédia en Français</a> et <a href="http://en.wikipedia.org/wiki/POSIX">cet article Wikipédia en Anglais</a>.</p></aside><p id="r-439177" data-claire-element-id="439177">Et voilà, c'est fini :) .<br/> Désormais, vous pouvez faire plein de programmes intéressants avec les paramètres de la fonction <em>main</em> et l'association de fichiers :</p><ul id="r-439186" data-claire-element-id="439186"><li id="r-439179" data-claire-element-id="439179"><p id="r-439178" data-claire-element-id="439178">Un lecteur de fichiers son avec FMOD</p></li><li id="r-439181" data-claire-element-id="439181"><p id="r-439180" data-claire-element-id="439180">Une visionneuse d'images avec SDL</p></li><li id="r-439183" data-claire-element-id="439183"><p id="r-439182" data-claire-element-id="439182">Un éditeur de texte avec GTK+</p></li><li id="r-439185" data-claire-element-id="439185"><p id="r-439184" data-claire-element-id="439184">Et encore plein de choses...</p></li></ul><p id="r-439187" data-claire-element-id="439187">Merci d'avoir lu ce tutoriel jusqu'au bout, j'espère que vous avez tout compris et que vous pourrez vous en servir pour faire de beaux programmes : la partie théorique n'était pas évidente, mais avouez que ça valait quand même le coup :p !</p><p id="r-439188" data-claire-element-id="439188"><em>Merci à <a href="http://www.siteduzero.com/membres-294-3791.html">Nigel</a> qui m'a donné le tuyau de la fonction chdir. <br/> Merci également à <a href="http://www.siteduzero.com/membres-294-19422.html">Darkelfe</a> qui m'a présenté le problème avec les extensions crées sous Windows ainsi que sa solution.</em></p><p id="r-439189" data-claire-element-id="439189"><em>Si vous avez apprécié (ou pas :D ) ce tutoriel, qu'un point vous semble obscur ou imprécis, n'hésitez pas à le signaler dans les commentaires.</em></p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main">Les paramètres de la fonction main</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main/description-des-parametres">
Description des paramètres
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main/utiliser-les-parametres">
Utiliser les paramètres
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main/le-dossier-de-lancement">
Le dossier de lancement
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-parametres-de-la-fonction-main/utiliser-les-parametres">
<span class="arrow"></span>
<span class="next">Utiliser les paramètres</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/les-parametres-de-la-fonction-main.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:50:26 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/les-parametres-de-la-fonction-main.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:37:25 GMT -->
</html>