<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/ml5-web-workers-le-monde-parallele-du-javascript.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 23:27:27 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/ml5-web-workers-le-monde-parallele-du-javascript.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:07:52 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : HTML5, web-workers : le monde parallèle du javascript</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : HTML5, web-workers : le monde parallèle du javascript</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#HTML5web-workerslemondeparallledujavascript">HTML5, web-workers : le monde parallèle du javascript</a><br/><a href="#Introductionlaprogrammationparallle">Introduction à la programmation parallèle</a><br/><a href="#Laprogrammationsquentielle">La programmation séquentielle</a><br/><a href="#Laprogrammationparallle">La programmation parallèle</a><br/><a href="#LesDedicatedWorkers">Les Dedicated Workers</a><br/><a href="#Premierspas">Premiers pas</a><br/><a href="#LacommunicationEnvoyeretrecevoirdesmessages">La communication : Envoyer et recevoir des messages</a><br/><a href="#Grerunworker">Gérer un worker</a><br/><a href="#Lesshared-workers">Les shared-workers</a><br/><a href="#Premierspas">Premiers pas</a><br/><a href="#Lacommunication">La communication</a><br/><a href="#NommervosShared-workers">Nommer vos Shared-workers</a><br/><a href="#Neplusutiliserunshared-worker">Ne plus utiliser un shared-worker</a><br/><a href="#TPJeudeschiffresetdeslettres">TP : Jeu des chiffres et des lettres</a><br/><a href="#Prsentationdel039exercice">Présentation de l&#039;exercice</a><br/><a href="#Correction">Correction</a><br/><a href="#Toutestcommunication">Tout est communication</a><br/><a href="#Lecanaldecommunication">Le canal de communication</a><br/><a href="#Mieuxcommuniquer">Mieux communiquer</a><br/><a href="#Terminerunecommunication">Terminer une communication</a><br/><a href="#Manipulerlesworkers">Manipuler les workers</a><br/><a href="#Lagestiondeserreurs">La gestion des erreurs</a><br/><a href="#Connatresesorigines">Connaître ses origines</a><br/><a href="#AjouterunscriptdynamiquementimportScripts">Ajouter un script dynamiquement : importScripts</a><br/><a href="#Enchanerlesworkers">Enchaîner les workers</a><br/><a href="#Crerunworkerinline">Créer un worker inline</a><br/><a href="#Quandutiliserdesweb-workers">Quand utiliser des web-workers ?</a><br/><a href="#Quandnepasutiliserlesworkers">Quand ne pas utiliser les workers ?</a><br/><a href="#Quandutiliserlesworkers">Quand utiliser les workers ?</a><br/><a href="#Laperformance">La performance</a><br/><a href="#Lesupportdesnavigateurs">Le support des navigateurs</a><br/><a href="#Tourd039horizon">Tour d&#039;horizon</a><br/><a href="#Chrome_SafariWebkit">Chrome / Safari (Webkit)</a><br/><a href="#Firefox">Firefox</a><br/><a href="#InternetExplorer">Internet Explorer</a><br/><a href="#Opera">Opera</a><br/><a href="#TPjeuduGomoku">TP : jeu du Gomoku</a><br/><a href="#Prsentationdel039exercice">Présentation de l&#039;exercice</a><br/><a href="#Correction">Correction</a><br/><a href="#Exercicesupplmentairetraitementd039image">Exercice supplémentaire : traitement d&#039;image</a><br/></div>
<a name="HTML5web-workerslemondeparallledujavascript"></a><h2>HTML5, web-workers : le monde parallèle du javascript</h2><div class="content" role="article">
<p id="r-412016" data-claire-element-id="412016">Dans ce qu'on nomme le HTML5, de nombreuses nouvelles fonctionnalités ont été ajoutées au javascript. Parmi celles-ci se trouvent les <strong>web-workers</strong> ou la possibilité d'exécuter du code en parallèle en javascript.<br/> Effectivement depuis sa création, le javascript souffre d'un défaut de taille : il est mono-thread !</p><div id="r-412018" data-claire-element-id="412018" data-claire-semantic="question"><p id="r-412017" data-claire-element-id="412017">Qui n'a jamais vu ses pages ne répondant plus pendant un certain temps ?<br/> Qui n'a jamais vu ses animations saccader lorsqu'un autre script démarre ?<br/> Qui n'a jamais vu son super code être coupé par une alerte invitant l'utilisateur à interrompre le script ?</p></div><figure id="r-delai-d-execution-d-un-script-atteint" data-claire-element-id="412021"><img id="r-412019" data-claire-element-id="412019" src="medias/uploads.siteduzero.com_files_360001_361000_360271.png" alt="Délai d'exécution d'un script atteint."/><figcaption>Délai d'exécution d'un script atteint.</figcaption></figure><p id="r-412022" data-claire-element-id="412022">Dans ce tutoriel, nous allons voir comment résoudre ces problèmes, en réalisant des exécutions de code en simultané.</p><p id="r-412023" data-claire-element-id="412023">Pour bien comprendre ce tutoriel, il est nécessaire d'avoir une connaissance solide du javascript. Avoir suivi et bien compris les trois premières parties <a href="http://www.siteduzero.com/tutoriel-3-309961-dynamisez-vos-sites-web-avec-javascript.html">du tutoriel sur le javascript</a> est le strict minimum.</p><p id="r-412024" data-claire-element-id="412024">Le fait que ce tutoriel traite de fonctionnalités HTML5 implique que seuls les navigateurs récents (Firefox 3.5, Chrome 3, Opera 10.60, Internet Explorer 10, …) pourront les supporter. Toutefois selon les navigateurs certaines fonctionnalités sont plus ou moins bien supportées, comme nous allons le voir dans la dernière partie de ce tutoriel.</p>
</div>
<div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1358423835269-0" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1358423835269-0');
        });
    }
    </script>
</div><a name="Introductionlaprogrammationparallle"></a><h2>Introduction à la programmation parallèle</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
<span class="next">La programmation séquentielle</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-412026" data-claire-element-id="412026">Avant de plonger dans les web-workers, nous allons d'abord voir, et surtout comprendre, ce qu'est la programmation parallèle.</p><p id="r-412027" data-claire-element-id="412027">Le but d'un programme est d'exécuter une tâche. Pour réaliser celle-ci, on donne à l'ordinateur une liste d'instructions qu'il va effectuer. Il existe plusieurs manières de traiter ces instructions.</p><p id="r-412028" data-claire-element-id="412028">Ainsi nous allons voir ici, et surtout comprendre, différentes manières d'exécuter des instructions.</p><p id="r-412029" data-claire-element-id="412029">Il s'agit d'une partie théorique, mais rassurez-vous ça sera la seule de ce tutoriel.</p>
</div><a name="Laprogrammationsquentielle"></a><h2>La programmation séquentielle</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">
<span class="arrow"></span>
<span class="next">Introduction à la programmation parallèle</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
<span class="next">La programmation parallèle</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-la-programmation-sequentielle" data-claire-element-id="412074">La programmation séquentielle</h4><h5 id="r-la-programmation-imperative" data-claire-element-id="412047">La programmation impérative</h5><p id="r-412030" data-claire-element-id="412030">Il s'agit sans doute de la méthode la plus naturelle, et il s'agit de la base de la programmation. Lorsque l'ordinateur a fini de traiter une instruction, il exécute la suivante.</p><p id="r-412031" data-claire-element-id="412031">Imaginez un jardinier. Dans son jardin, il fait pousser des plantes, les soigne et répond aux questions de quelques curieux.<br/> Ainsi s'il s'agissait d'un programme, nous lui donnerions les tâches suivantes :</p><ul id="r-412038" data-claire-element-id="412038"><li id="r-412033" data-claire-element-id="412033"><p id="r-412032" data-claire-element-id="412032">Arroser les plantes</p></li><li id="r-412035" data-claire-element-id="412035"><p id="r-412034" data-claire-element-id="412034">Soigner les plantes</p></li><li id="r-412037" data-claire-element-id="412037"><p id="r-412036" data-claire-element-id="412036">Répondre aux questions</p></li></ul><p id="r-412039" data-claire-element-id="412039">Ainsi il commence par arroser les plantes. Dès qu'il a fini, il va les soigner. Et lorsqu'il a fini de les soigner, il va répondre aux questions des curieux.</p><p id="r-412040" data-claire-element-id="412040">Bien sûr, une liste d'instructions n'est pas forcément linéaire. On peut ajouter des structures de contrôle (comme les structures conditionnelles avec les <code data-claire-semantic="javascript">if</code>), des boucles (comme <code data-claire-semantic="javascript">for</code> ou <code data-claire-semantic="javascript">while</code>), ou des sous-ensembles d'instructions (comme les fonctions). Toutefois cela ne change pas le fait que le code reste séquentiel : dès qu'une instruction est terminée, on passe à la suivante.</p><p id="r-412041" data-claire-element-id="412041">Si j'écris ce code :</p><pre id="r-412042" data-claire-element-id="412042"><code data-claire-semantic="javascript">var a = 1;
var b = 2;

function calcul1(c,d){
  return c * d;
}

function calcul2(c, d){
  return c + d;
}

a = calcul1(a, b);
b = calcul2(a, b);

alert(&quot;a=&quot; + a + &quot;\nb=&quot; + b);</code></pre><div id="r-412044" data-claire-element-id="412044" data-claire-semantic="question"><p id="r-412043" data-claire-element-id="412043">Qu'est-ce qui s'affiche avec ce code ?</p></div><p id="r-412045" data-claire-element-id="412045">Normalement, en lisant ce code, vous êtes capable de me dire le résultat de l'affichage. Car il suffit de partir du haut, de traiter les instructions une à une séquentiellement, et on finit par trouver le résultat.</p><p id="r-412046" data-claire-element-id="412046">Jusqu'ici, tout est clair ?<br/> Cela vous paraît évident que le résultat d'un code est prévisible ? En fait ça ne l'est pas tant que ça …</p><h5 id="r-la-programmation-evenementielle-1" data-claire-element-id="412073">La programmation événementielle</h5><p id="r-412048" data-claire-element-id="412048">Imaginez une page html, dans laquelle il y a trois boutons. Un bouton qui réalise le <code data-claire-semantic="javascript">calcul1</code>, un bouton pour le <code data-claire-semantic="javascript">calcul2</code> et un troisième pour l'affichage.<br/> Cela pourrait donner cette page :</p><pre id="r-412049" data-claire-element-id="412049"><code data-claire-semantic="html">&lt;!doctype html&gt;
&lt;html lang=&quot;fr&quot;&gt;
&lt;head&gt;
	&lt;meta charset=&quot;utf-8&quot;&gt;
	&lt;title&gt;Page avec 3 boutons&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;button onclick=&quot;a = calcul1(a, b);&quot;&gt;Calcul 1&lt;/button&gt;
	&lt;button onclick=&quot;b = calcul2(a, b);&quot;&gt;Calcul 2&lt;/button&gt;
	&lt;br&gt;
	&lt;button onclick=&quot;alert('a=' + a + '\nb=' + b);&quot;&gt;Alert&lt;/button&gt;
	
	&lt;script&gt;
		var a = 1;
		var b = 2;

		function calcul1(c, d){
		  return c * d;
		}

		function calcul2(c, d){
		  return c + d;
		}
	&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-412050" data-claire-element-id="412050">Cela correspond au même code que précédemment. Sauf que si je pose la même question : qu'est-ce qui s'affiche avec ce code ?<br/> Vous voilà bien embêtés… Et oui ! Car le résultat dépend des actions de l'utilisateur avant qu'il demande l'affichage. Il peut aussi bien cliquer 2 fois sur le bouton <code data-claire-semantic="javascript">calcul2</code> puis sur le bouton <code data-claire-semantic="javascript">calcul1</code> et enfin demander l'affichage. Mais il peut très bien demander tout de suite l'affichage sans avoir réalisé aucun calcul. Il n'est pas possible d'anticiper le résultat.</p><p id="r-412051" data-claire-element-id="412051">C'est ce qu'on appelle la <strong>programmation événementielle</strong> : une action est déclenchée lors d'un événement.<br/> Dans notre code précédent, les événements déclencheurs sont les clics de la souris sur les boutons. Les fonctions ne seront exécutées que lorsque l'utilisateur aura cliqué sur un bouton.</p><p id="r-412052" data-claire-element-id="412052">Ce type de programmation rejoint la <strong>programmation asynchrone</strong>. Lorsqu'on exécute une tâche de manière asynchrone, son résultat n'est pas connu tout de suite. Pour obtenir son résultat, on écrit une fonction qui se déclenchera lorsque le résultat est connu. On voit bien qu'on a besoin d'un événement (quand le résultat est accessible) pour continuer l'exécution du code.<br/> Dans le cas d'une <strong>programmation synchrone</strong>, lorsqu'on exécute la fonction, le résultat est connu tout de suite (on ne continue pas tant que le résultat n'est pas connu).</p><p id="r-412053" data-claire-element-id="412053">Pour mettre en évidence ce caractère asynchrone et événementiel dans la programmation en javascript, étudions ensemble un cas pratique : le chargement d'une image.</p><p id="r-412054" data-claire-element-id="412054">Si vous souhaitez afficher une nouvelle image et récupérer ses dimensions, qu'allez-vous faire ?</p><p id="r-412055" data-claire-element-id="412055">Si vous écrivez <code data-claire-semantic="javascript">var img = new Image(); img.src = cheminImage;</code>, vous ne pourrez pas obtenir ses dimensions tout de suite. En effet l'objet image va charger l'image de manière asynchrone. Ainsi pour obtenir ses dimensions, il va falloir utiliser l'événement <em>onload</em> pour lire les informations lorsque l'image est chargée.</p><aside id="r-412057" data-claire-element-id="412057" data-claire-semantic="information"><p id="r-412056" data-claire-element-id="412056">Mais même si les séquences sont exécutées de manière asynchrone, à chaque fois il n'y en a qu'une qui travaille. Les autres séquences attendent que la séquence active se termine pour remplir leur tâche.</p></aside><p id="r-412058" data-claire-element-id="412058">Reprenons l'analogie du jardinier, et rendons-le un peu plus intelligent :</p><ul id="r-412065" data-claire-element-id="412065"><li id="r-412060" data-claire-element-id="412060"><p id="r-412059" data-claire-element-id="412059">Il ne va arroser les plantes que lorsqu'elles manquent d'eau.</p></li><li id="r-412062" data-claire-element-id="412062"><p id="r-412061" data-claire-element-id="412061">Il ne va soigner les plantes que lorsqu'il observera des parasites.</p></li><li id="r-412064" data-claire-element-id="412064"><p id="r-412063" data-claire-element-id="412063">Il ne répondra aux curieux que lorsqu'ils auront une question à poser.</p></li></ul><p id="r-412066" data-claire-element-id="412066">Donc dès que les plantes sont envahies par des parasites, le jardinier se met alors à la tâche et s'en va soigner ses plantes.</p><p id="r-412067" data-claire-element-id="412067">Imaginons, alors, que pendant son travail, les deux autres événements apparaissent : les plantes manquent d'eau, et un curieux désire poser une question.</p><p id="r-412068" data-claire-element-id="412068">Notre jardinier termine alors son travail de soin, s'en va chercher de l'eau, les arrose. Puis, enfin, va rejoindre le curieux pour répondre à sa question. On peut alors facilement estimer que dans ce cas de figure, le curieux peut avoir passé beaucoup de temps à attendre. Et s'il s'agit d'une personne importante, comme un client, il serait dommage de le vexer en le faisant attendre aussi longtemps. :(</p><p id="r-412069" data-claire-element-id="412069">Malheureusement en javascript, il n'est pas possible d'ordonnancer les tâches qui ont été déclenchées en fonction de leur priorité. Elles seront exécutées dans l'ordre de déclenchement.<br/> On pourrait essayer de le faire manuellement. Ainsi au début d'une nouvelle tâche, on vérifie s'il ne faut pas en exécuter d'abord une autre plus prioritaire, et remettre celle en cours à plus tard.<br/> Non seulement c'est compliqué à mettre en place, mais on a toujours un problème : si la tâche en cours au moment du déclenchement de l'événement est très longue, notre important client devra toujours patienter jusqu'à la fin de celle-ci.</p><div id="r-412071" data-claire-element-id="412071" data-claire-semantic="question"><p id="r-412070" data-claire-element-id="412070">Mais alors comment faire ?</p></div><p id="r-412072" data-claire-element-id="412072">Il suffit d'embaucher une nouvelle personne :)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">
<span class="arrow"></span>
<span class="next">Introduction à la programmation parallèle</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
<span class="next">La programmation parallèle</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Laprogrammationparallle"></a><h2>La programmation parallèle</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
<span class="arrow"></span>
<span class="next">La programmation séquentielle</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">
<span class="next">Les Dedicated Workers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-la-programmation-parallele" data-claire-element-id="412115">La programmation parallèle</h4><p id="r-412075" data-claire-element-id="412075">La <strong>programmation parallèle</strong> consiste à exécuter plusieurs tâches en même temps !</p><p id="r-412076" data-claire-element-id="412076">Ça ne semble pas difficile, n'est-ce pas ? Et pourtant c'est loin d'être simple !</p><p id="r-412077" data-claire-element-id="412077">À la question précédente, certains petits malins ont dû penser : il suffit que le jardinier arrose ses plantes et réponde en criant :D <br/> Oui, mais le jardinier doit quand même faire deux actions en même temps : arroser et crier. Cela est possible, car l'humain est une machine formidable capable de réaliser de très nombreuses choses en même temps.<br/> Cependant pour un ordinateur, ce n'est pas aussi simple. Car initialement, les ordinateurs sont conçus pour traiter les informations séquentiellement : le processeur exécute les instructions les unes à la suite des autres. Dans ce contexte, il est difficile d'imaginer de pouvoir réaliser plusieurs actions en même temps.</p><p id="r-412078" data-claire-element-id="412078">Et pourtant, quand vous utilisez votre ordinateur et que vous copiez un (gros) fichier, vous pouvez toujours continuer à naviguer dans vos répertoires. Vous n'êtes pas (plus) obligé d'attendre la fin de la copie.<br/> Ceci est possible, car votre système d'exploitation gère ce qu'on appelle un <strong>scheduler</strong> (ordonnanceur en français). Il va allouer un certain temps d'exécution à chaque code qui désire fonctionner à cet instant. Ainsi, il va exécuter un premier code (comme la copie du fichier), puis l'interrompre pour démarrer un deuxième code (comme la navigation dans les répertoires), puis interrompre ce dernier pour relancer le premier là où il en était précédemment ... et alterner ainsi de suite avec tous les programmes qui tournent à ce moment.<br/> Bien que chaque code s'exécute à tour de rôle, il s'agit bien d'actions simultanées puisque lorsque la première tâche est en cours d'exécution, la deuxième est également en cours d'exécution.</p><p id="r-412079" data-claire-element-id="412079">Depuis les années 2000, les ordinateurs multiprocesseurs ou les processeurs multicœurs se sont généralisés. Aujourd'hui, pratiquement tout le monde possède un ordinateur disposant de cette technologie. Or cette technologie permet de réellement exécuter plusieurs instructions en même temps (1 par cœur ou par processeur).<br/> Cependant, pour qu'un programme puisse bénéficier de ces avantages, et donc exécuter deux codes (ou plus) de manière concurrente, il doit indiquer qu'un certain code ne s'exécute plus dans la même pile que le code principal.</p><p id="r-412080" data-claire-element-id="412080">Une pile, ou plutôt <strong>pile sémantique</strong> (pour ne pas la confondre avec la pile d'exécution qui liste les fonctions actives du programme, et même si dans chaque pile sémantique se trouve une pile d'exécution) est un ensemble d'instructions que l'ordinateur doit exécuter.<br/> Il est possible que vous entendiez les termes <strong>thread</strong> ou <strong>processus</strong>.</p><aside id="r-412083" data-claire-element-id="412083" data-claire-semantic="information"><p id="r-412081" data-claire-element-id="412081">Un <strong>thread</strong> (ou fil d'exécution en français) contient une pile sémantique et se charge de l'exécuter.</p><p id="r-412082" data-claire-element-id="412082">Un <strong>processus</strong> (ou process en anglais) contient un ou plusieurs threads. Le scheduler se chargera de séquencer ces processus afin qu'ils puissent tous fonctionner en même temps.<br/> Les threads à l'intérieur du même processus peuvent partager une mémoire commune alors que les processus ne partagent pas de mémoire entre eux.</p></aside><p id="r-412084" data-claire-element-id="412084">En javascript, c'est au moteur de choisir s'il crée un nouveau thread dans le même processus, ou s'il crée un nouveau processus (avec un thread dedans bien sûr). Le programmeur ne peut pas choisir spécifiquement l'un ou l'autre.<br/> Dans la suite de ce tutoriel, j'utiliserai le terme <strong>thread</strong> pour désigner ce qui est en fait une pile sémantique, car ce terme est très généralement utilisé sur le web sans faire la distinction entre ces différents concepts. Comme nous ne gérons pas le programme dans le système d'exploitation, nous n'aurons donc pas de quiproquo.</p><p id="r-412085" data-claire-element-id="412085">En programmation parallèle, il est très souvent nécessaire d'avoir un système de communication entre les threads. Il existe deux principaux modèles de communication : le modèle par mémoire partagée, et le modèle par passage de messages.</p><h5 id="r-communication-par-memoire-partagee" data-claire-element-id="412091">Communication par mémoire partagée</h5><p id="r-412086" data-claire-element-id="412086">Dans un modèle utilisant la mémoire partagée (<strong>shared memory</strong> en anglais), chaque thread exécute sa propre séquence d'instructions, mais ils peuvent accéder à des données communes.<br/> En gros, cela signifie qu'il existe une zone mémoire où sont stockées des variables utilisées par plusieurs threads.<br/> Ce système présente des inconvénients très délicats, comme l'<strong>accès concurrent</strong> à la même variable, les <strong>deadlocks</strong> , etc...</p><aside id="r-412089" data-claire-element-id="412089" data-claire-semantic="information"><p id="r-412087" data-claire-element-id="412087"><strong>Accès concurrent</strong> : Plusieurs threads accèdent aux mêmes ressources en même temps. Par exemple : <em>Deux threads veulent incrémenter un compteur initialisé à 0. Si les deux threads y accèdent en même temps, ils lisent tous les deux 0, ajoutent 1 et enregistrent la modification. La valeur du compteur sera alors 1 au lieu de 2, car un thread aura écrasé la valeur enregistrée par l'autre thread.</em></p><p id="r-412088" data-claire-element-id="412088">Les <strong>deadlocks</strong> : C'est un problème qui peut survenir quand plusieurs threads désirent accéder à plusieurs ressources partagées en même temps. Par exemple : <em>Un thread bloque une ressource partagée (afin d'éviter un problème d'accès concurrent) et désire accéder à une autre ressource bloquée par un autre thread qui désire accéder à la ressource bloquée par le premier. Résultat : tout le monde attend et le programme est bloqué !</em></p></aside><p id="r-412090" data-claire-element-id="412090">Désolé, je ne vais pas détailler ces problèmes plus que ça, car, en javascript, c'est l'autre modèle qui est utilisé ! Si le sujet vous intéresse, je vous invite à consulter de nombreux sites dédiés à ce sujet.</p><h5 id="r-communication-par-passage-de-message" data-claire-element-id="412114">Communication par passage de message</h5><p id="r-412092" data-claire-element-id="412092">Dans un modèle &quot;passage de message&quot; (<strong>message passing</strong> en anglais), contrairement au modèle précédent, chaque thread est complètement distinct des autres. Ils ne partagent rien. Le seul lien qu'ils peuvent avoir est un canal de communication afin qu'ils puissent s'envoyer des messages.</p><p id="r-412093" data-claire-element-id="412093">Pour reprendre l'analogie du jardinier : nous désirons maintenant satisfaire au mieux les clients, et donc ne pas les faire patienter inutilement. Ainsi nous avons maintenant deux personnes : un jardinier qui s'occupe des plantes et un commercial qui s'occupe des clients. Le commercial ne va pas au jardin, et le jardinier ne se rend pas à la boutique. Mais régulièrement le jardinier envoie des messages au commercial pour lui donner un état des lieux. Et le commercial lui en envoie pour lui demander de préparer telle ou telle plante.</p><p id="r-412094" data-claire-element-id="412094">Le principe du &quot;message passing&quot; c'est ça : <strong>on ne touche pas aux affaires des autres !</strong>(même pas avec les yeux)</p><p id="r-412095" data-claire-element-id="412095">Comme il existe de nombreuses variantes, je vais me contenter de vous parler de celle qui concerne le javascript : le passage par message asynchrone, et on pourrait ajouter qu'il s'agit d'un dialogue.</p><p id="r-412096" data-claire-element-id="412096">o_O</p><div id="r-412098" data-claire-element-id="412098" data-claire-semantic="question"><p id="r-412097" data-claire-element-id="412097">Qu'est-ce que je veux dire par là avec tous ces mots compliqués ?</p></div><p id="r-412099" data-claire-element-id="412099">Analysons-les un par un.</p><p id="r-412100" data-claire-element-id="412100"><strong>Dialogue</strong> : La communication ne se fait qu'entre deux tâches. On aurait pu imaginer envoyer un message à tout le monde et que seul celui que ça concerne le lit (c'est ce qu'on fait lorsqu'on crie à son copain qui est de l'autre côté de la rue : tous les passants reçoivent aussi le message). Mais là, non ! Il n'y a que le destinataire du message qui pourra le lire.<br/> Un dialogue signifie aussi que les deux peuvent initier un message. Une tâche n'est pas obligée d'attendre que l'autre lui parle pour lui envoyer un message. Sinon ça serait un monologue. :)</p><p id="r-412101" data-claire-element-id="412101"><strong>Asynchrone</strong> : Lorsqu'une tâche envoie son message, elle n'attend pas de réponse. C'est-à-dire que dès qu'elle a envoyé son message, elle peut s'occuper des instructions suivantes. Cela ne veut pas dire qu'il n'y aura pas de réponse, mais juste qu'elle pourra arriver (beaucoup) plus tard.<br/> Si vous appelez une amie au téléphone, votre communication sera synchrone car lorsque vous posez une question, vous attendez votre réponse et vous ne faites rien d'autre en attendant.<br/> Si par contre vous lui écrivez, votre communication est asynchrone. Car lorsque vous avez envoyé votre lettre, vous n'attendez pas devant la poste sa réponse.</p><p id="r-412102" data-claire-element-id="412102"><strong>Passage par message</strong> : ben … euh, on communique avec des messages. :-°</p><p id="r-412103" data-claire-element-id="412103">Un petit résumé de ce qu'il faut bien retenir de ce principe :</p><ul id="r-412112" data-claire-element-id="412112"><li id="r-412105" data-claire-element-id="412105"><p id="r-412104" data-claire-element-id="412104">Les messages ne sont envoyés qu'à un seul autre thread.</p></li><li id="r-412107" data-claire-element-id="412107"><p id="r-412106" data-claire-element-id="412106">L'envoi d'un message n'est pas bloquant.</p></li><li id="r-412109" data-claire-element-id="412109"><p id="r-412108" data-claire-element-id="412108">La lecture des messages est événementielle, ce qui peut mener à avoir plusieurs messages en attente de lecture : ils sont en file d'attente (<strong>message queue</strong> en anglais).</p></li><li id="r-412111" data-claire-element-id="412111"><p id="r-412110" data-claire-element-id="412110">Et surtout on ne sait rien de ce qu'il se passe chez son voisin mis à part ce qu'il nous dit dans ses messages.</p></li></ul><p id="r-412113" data-claire-element-id="412113">Et voilà la partie théorique est terminée ! Vous pouvez vous réveiller !<br/> Il y avait plein de notions à comprendre, mais maintenant rassurez-vous, nous allons pouvoir passer à la pratique.<br/> Et grâce à toutes ces notions, vous allez surtout bien comprendre tout ce que vous allez faire avec les web-workers (et aussi ce que vous ne pouvez pas faire).</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
<span class="arrow"></span>
<span class="next">La programmation séquentielle</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">
<span class="next">Les Dedicated Workers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="LesDedicatedWorkers"></a><h2>Les Dedicated Workers</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
<span class="arrow"></span>
<span class="next">La programmation parallèle</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
<span class="next">Premiers pas</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-412117" data-claire-element-id="412117">Maintenant qu'on a rapidement vu en quoi consistait la programmation concurrentielle, nous allons entrer dans le vif du sujet. Nous allons découvrir dans ce chapitre comment créer un code s'exécutant en parallèle en javascript.</p><p id="r-412118" data-claire-element-id="412118">Ne vous en faîtes pas, vous serez bien guidé :)</p>
</div><a name="Premierspas"></a><h2>Premiers pas</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">
<span class="arrow"></span>
<span class="next">Les Dedicated Workers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
<span class="next">La communication : Envoyer et recevoir des messages</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-premiers-pas-12" data-claire-element-id="412184">Premiers pas</h4><p id="r-412119" data-claire-element-id="412119">Il existe deux types de <strong>web-workers</strong>. Le premier que nous allons analyser ici correspond aux <strong>dedicated-workers</strong> (workers dédiés). Ces workers, une fois créés, sont liés à leur créateur et uniquement à celui-ci.</p><h5 id="r-mon-premier-worker" data-claire-element-id="412183">Mon premier Worker</h5><p id="r-412120" data-claire-element-id="412120">Pour commencer, nous allons tout de suite voir à quoi ressemble un dedicated-worker.</p><p id="r-412121" data-claire-element-id="412121">Nous allons créer un jardinier, qui arrosera continuellement ses plantes, et les récoltera quand elles auront bien grandi. Et nous afficherons le nombre de plantes qui ont été récoltées.<br/> Nous avons donc deux fichiers : un qui est directement inclus dans la page web (que j'ai appelé main.js) qui sert à afficher le nombre de plantes récoltées ; et un qui correspond au code devant s'exécuter en parallèle (que j'ai nommé worker.js) qui sert à simuler le potager du jardinier.</p><table id="r-412137" data-claire-element-id="412137"><thead id="r-412127" data-claire-element-id="412127"><tr id="r-412126" data-claire-element-id="412126"><th id="r-412123" data-claire-element-id="412123"><p id="r-412122" data-claire-element-id="412122">main.js</p></th><th id="r-412125" data-claire-element-id="412125"><p id="r-412124" data-claire-element-id="412124">worker.js</p></th></tr></thead><tbody id="r-412136" data-claire-element-id="412136"><tr id="r-412132" data-claire-element-id="412132"><td id="r-412129" data-claire-element-id="412129"><pre id="r-412128" data-claire-element-id="412128"><code data-claire-semantic="javascript">//Création d'une zone d'affichage
var elem=document.createElement(&quot;output&quot;);
elem.value = &quot;Le jardinier marche&quot;+
                 &quot; vers le potager&quot;;
document.body.appendChild(elem);


//Création d'un worker

if(window.Worker){
//le navigateur supporte les workers

    var worker=new Worker(&quot;worker.js&quot;);
    worker.onmessage=function(event){
        elem.value = event.data;
    };

}else{
//le navigateur ne supporte pas les workers
    alert(&quot;Désolé votre navigateur &quot;+
        &quot;ne supporte pas les workers ! ☹&quot;);
}</code></pre></td><td id="r-412131" data-claire-element-id="412131"><pre id="r-412130" data-claire-element-id="412130"><code data-claire-semantic="javascript">setTimeout(function(){
//le setTimeout ne sert qu'à permettre
//de bien voir les premiers messages

  postMessage(&quot;Le jardinier est dans son potager&quot;+
    &quot; et est en train de faire pousser ses &quot;+
    &quot;premières plantes&quot;);

  var jardin = [0,0,0,0,0];
  var plantePrete = 0;
  var parcelle;

  while(true){
//boucle infinie, on arrose toujours les plantes

    for(parcelle = 0; parcelle &lt; 5; parcelle++){
//on arrose un peu, et ça fait grandir la plante
      jardin[parcelle] += Math.random();

      if(jardin[parcelle] &gt; 1000000){
//la plante est suffisamment grande et on la cueille
        jardin[parcelle] = 0;
        plantePrete++;

        postMessage(&quot;Le jardinier a pu récolter &quot;+
                plantePrete +&quot; plantes&quot;);
      }

    }//boucle de fin de la parcelle
  }//boucle infinie
},1000);</code></pre></td></tr><tr id="r-412135" data-claire-element-id="412135"><td id="r-412134" data-claire-element-id="412134"><p id="r-412133" data-claire-element-id="412133"><a href="http://restimel.github.com/Tutoriels/webWorkers/dedicated1/index.html">Essayer !</a></p></td></tr></tbody></table><aside id="r-412139" data-claire-element-id="412139" data-claire-semantic="warning"><p id="r-412138" data-claire-element-id="412138">Si vous testez ce code avec le moteur Webkit (qui est utilisé par Chrome et Safari), vous devez mettre la page en ligne. Car, <a href="http://www.siteduzero.com/tutoriel-3-598831-1-le-support-des-navigateurs.html">comme nous le verrons à la fin de ce tutoriel</a>, webkit refuse d'utiliser les web-workers en local !</p></aside><p id="r-412140" data-claire-element-id="412140">Qu'observons-nous ? Juste un texte indiquant le nombre de plantes récoltées, et ce nombre qui grandit. Pas grand-chose d'impressionnant, certes ! Mais en analysant le code, vous devriez remarquer quelques subtilités.</p><p id="r-412141" data-claire-element-id="412141">Que pouvons-nous observer d'intéressant dans le fichier main.js ?</p><ul id="r-412148" data-claire-element-id="412148"><li id="r-412143" data-claire-element-id="412143"><p id="r-412142" data-claire-element-id="412142">À la ligne 13 : <code data-claire-semantic="javascript">new Worker(&quot;worker.js&quot;)</code>. C'est la création et le démarrage d'un nouveau worker. Le paramètre correspond à l'url du code javascript à exécuter dans ce worker.</p></li><li id="r-412145" data-claire-element-id="412145"><p id="r-412144" data-claire-element-id="412144">À la ligne 14 : <code data-claire-semantic="javascript">worker.onmessage</code>, il s'agit d'un listener appliqué sur le worker. Nous reviendrons là-dessus dans peu de temps.</p></li><li id="r-412147" data-claire-element-id="412147"><p id="r-412146" data-claire-element-id="412146">À la ligne 15 : <code data-claire-semantic="javascript">event.data</code>, il s'agit du message reçu. Nous reviendrons aussi là-dessus.</p></li></ul><p id="r-412149" data-claire-element-id="412149">Pour le fichier worker.js, il y a deux choses à remarquer :</p><ul id="r-412154" data-claire-element-id="412154"><li id="r-412151" data-claire-element-id="412151"><p id="r-412150" data-claire-element-id="412150">Ligne 5 et ligne 25 : <code data-claire-semantic="javascript">postMessage()</code>, il s'agit d'une fonction permettant d'envoyer des messages au thread principal. Nous y reviendrons dans peu de temps.</p></li><li id="r-412153" data-claire-element-id="412153"><p id="r-412152" data-claire-element-id="412152">Ligne 13 : <code data-claire-semantic="javascript">while(true)</code> ! Une boucle infinie o_O ! Vous ne rêvez pas, à la ligne 8, c'est bien le commencement d'une boucle qui ne se termine jamais !<br/> Alors non, dans un worker il n'est pas nécessaire d'écrire une boucle infinie, c'est juste que dans cet exemple je voulais écrire une tâche qui ne se finissait jamais.</p></li></ul><p id="r-412155" data-claire-element-id="412155">Et pour les plus perspicaces, cela signifie bien que dans ce thread, l'interpréteur javascript ne rend jamais la main. Or vous avez sans doute remarqué que le texte qui s'affichait correspond à celui de la ligne 25, et vous devriez savoir que d'habitude les modifications du DOM ne se font que lorsque l'interpréteur rend la main. Oui mais là, nous avons 2 threads, un qui garde toujours la main et l'autre qui gère l'affichage (et dans cet exemple, il est plutôt fainéant). Cela n'aurait donc pas été faisable sans la parallélisation.</p><div id="r-412157" data-claire-element-id="412157" data-claire-semantic="question"><p id="r-412156" data-claire-element-id="412156">Alors que se passe-t-il réellement dans cette page ?</p></div><ul id="r-412179" data-claire-element-id="412179"><li id="r-412159" data-claire-element-id="412159"><p id="r-412158" data-claire-element-id="412158">Au commencement était la page HTML</p></li><li id="r-412161" data-claire-element-id="412161"><p id="r-412160" data-claire-element-id="412160">La page charge le fichier main.js</p></li><li id="r-412163" data-claire-element-id="412163"><p id="r-412162" data-claire-element-id="412162">Une balise output est créée pour gérer l'affichage</p></li><li id="r-412176" data-claire-element-id="412176"><p id="r-412164" data-claire-element-id="412164">On crée un worker :</p><ul id="r-412175" data-claire-element-id="412175"><li id="r-412166" data-claire-element-id="412166"><p id="r-412165" data-claire-element-id="412165">Le fichier worker.js est chargé dans un environnement qui tourne en tâche de fond (qu'on nomme souvent background), il s'agit d'un thread différent du thread principal.</p></li><li id="r-412168" data-claire-element-id="412168"><p id="r-412167" data-claire-element-id="412167">Un message est envoyé à main.js pour lui dire que le jardinier travaille</p></li><li id="r-412170" data-claire-element-id="412170"><p id="r-412169" data-claire-element-id="412169">On définit le jardin</p></li><li id="r-412172" data-claire-element-id="412172"><p id="r-412171" data-claire-element-id="412171">Dans la boucle infinie, pour chaque parcelle on fait pousser la plante</p></li><li id="r-412174" data-claire-element-id="412174"><p id="r-412173" data-claire-element-id="412173">Lorsqu'une plante est cueillie, on envoie un message indiquant le nombre de plantes cueillies.</p></li></ul></li><li id="r-412178" data-claire-element-id="412178"><p id="r-412177" data-claire-element-id="412177">Quand un message du worker est reçu, on l'affiche</p></li></ul><p id="r-412180" data-claire-element-id="412180">Et voilà vous avez réalisé votre premier programme javascript à exécution parallèle :)</p><aside id="r-412182" data-claire-element-id="412182" data-claire-semantic="information"><p id="r-412181" data-claire-element-id="412181">Vous avez pu remarquer qu'à la ligne 10, la condition vérifie que le navigateur supporte l'objet <code data-claire-semantic="javascript">Worker</code>. Cela est fortement conseillé pour garder une compatibilité avec les vieux navigateurs et leur proposer une autre solution.<br/> Afin d'éviter de trop surcharger les codes qui suivent, je n'ajouterai plus ce test. Cependant, cela ne vous dispense pas de le faire quand même :)</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">
<span class="arrow"></span>
<span class="next">Les Dedicated Workers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
<span class="next">La communication : Envoyer et recevoir des messages</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="LacommunicationEnvoyeretrecevoirdesmessages"></a><h2>La communication : Envoyer et recevoir des messages</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
<span class="arrow"></span>
<span class="next">Premiers pas</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
<span class="next">Gérer un worker</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-la-communication-envoyer-et-recevoir-des-messages" data-claire-element-id="412234">La communication : Envoyer et recevoir des messages</h4><p id="r-412185" data-claire-element-id="412185">Je vais me répéter, mais pour bien comprendre le modèle de passage de messages, il faut garder en tête que chaque thread travaille dans son coin. Et lorsque un thread désire donner un ordre ou une information à un autre thread, il va devoir lui envoyer un message.<br/> Pour cela il devra prendre une lettre, écrire son message, et l'envoyer par la poste. Son destinataire n'a plus qu'à lire le message et lui répondre par le même intermédiaire.<br/> Vous croyez que je plaisante ? :lol: En fait pas du tout, c'est exactement ça ! o_O Bien sûr la lettre n'est pas faite en papier, et la poste est électronique, mais le principe est exactement celui-ci.</p><p id="r-412186" data-claire-element-id="412186">Les plus perspicaces auront vite remarqué un petit problème dans cette méthode : pour avoir une réponse, il faut attendre. Il faut attendre que son interlocuteur prenne le temps de lire la réponse puis envoie à son tour un message. La communication est asynchrone. Toutefois cela ne devrait pas vous inquiéter, l'AJAX fonctionne exactement de la même manière.</p><h5 id="r-envoyer-un-message-postmessage" data-claire-element-id="412192">Envoyer un message : <code data-claire-semantic="javascript">postMessage()</code></h5><p id="r-412187" data-claire-element-id="412187">Pour envoyer un message, il suffit d'utiliser <strong>postMessage</strong>.<br/> Cette fonction possède un paramètre de type string : c'est le message à envoyer !</p><p id="r-412188" data-claire-element-id="412188">Il s'agit d'une méthode de l'objet <code data-claire-semantic="javascript">worker</code>.</p><pre id="r-412189" data-claire-element-id="412189"><code data-claire-semantic="javascript">var w = new Worker(&quot;cheminDuWorker.js&quot;); //création du dedicated-worker
w.postMessage(&quot;un message&quot;); //on envoie &quot;un message&quot; au worker w</code></pre><p id="r-412190" data-claire-element-id="412190">Depuis le worker c'est encore plus simple, il suffit d'utiliser directement la fonction <strong>postMessage</strong>.</p><pre id="r-412191" data-claire-element-id="412191"><code data-claire-semantic="javascript">postMessage(&quot;un message depuis le worker&quot;); //le worker envoie son message au thread principal</code></pre><h5 id="r-recevoir-des-messages-onmessage" data-claire-element-id="412233">Recevoir des messages : <code data-claire-semantic="javascript">onmessage</code></h5><p id="r-412193" data-claire-element-id="412193">Envoyer des messages, c'est bien, mais il faut aussi pouvoir les lire :) <br/> On peut le faire grâce au listener <strong>onmessage</strong>. Comme c'est un listener (comme onclick, onload, etc...) il va falloir lui passer une fonction callback qui sera exécutée lors de son déclenchement.<br/> Pour lire le message, il suffira d'accéder à la propriété <strong>data</strong> de l'événement.</p><p id="r-412194" data-claire-element-id="412194">Vous êtes maintenant capable d'écrire un petit échange avec le worker. En voici un par exemple :</p><table id="r-412210" data-claire-element-id="412210"><thead id="r-412200" data-claire-element-id="412200"><tr id="r-412199" data-claire-element-id="412199"><th id="r-412196" data-claire-element-id="412196"><p id="r-412195" data-claire-element-id="412195">main.js</p></th><th id="r-412198" data-claire-element-id="412198"><p id="r-412197" data-claire-element-id="412197">worker.js</p></th></tr></thead><tbody id="r-412209" data-claire-element-id="412209"><tr id="r-412205" data-claire-element-id="412205"><td id="r-412202" data-claire-element-id="412202"><pre id="r-412201" data-claire-element-id="412201"><code data-claire-semantic="javascript">//création du worker
var w = new Worker(&quot;worker.js&quot;);

//réception des messages
w.onmessage = function(event){
    alert(&quot;Le worker a répondu :\n&quot; + event.data);
    if(event.data.substr(0,7) == &quot;Bonjour&quot;){
        //Si le message commence par &quot;Bonjour&quot;
        var nom=prompt(&quot;Quel est ton nom ?&quot;);
        w.postMessage(&quot;L'utilisateur s'appelle : &quot;+nom);
    }
};

w.postMessage(&quot;Bonjour&quot;);</code></pre></td><td id="r-412204" data-claire-element-id="412204"><pre id="r-412203" data-claire-element-id="412203"><code data-claire-semantic="javascript">//réception d'un message
onmessage=function(event){
    if(event.data == &quot;Bonjour&quot;){
        postMessage(&quot;Bonjour, je suis un worker&quot;);
    }else{
        postMessage(&quot;Maintenant je sais que tu es &quot;+
            event.data.substr(26) +&quot; !&quot;);
    }
};</code></pre></td></tr><tr id="r-412208" data-claire-element-id="412208"><td id="r-412207" data-claire-element-id="412207"><p id="r-412206" data-claire-element-id="412206"><a href="http://restimel.github.com/Tutoriels/webWorkers/dedicated2/index.html">Essayer !</a></p></td></tr></tbody></table><p id="r-412211" data-claire-element-id="412211">On commence par créer un worker, on met en place un listener puis on lui envoie &quot;Bonjour&quot;.<br/> Du côté du worker, il n'y a qu'un listener qui répond au message reçu.</p><aside id="r-412213" data-claire-element-id="412213" data-claire-semantic="information"><p id="r-412212" data-claire-element-id="412212">Dans de très nombreuses fonctions liées aux listeners, vous devez être habitué à voir une ligne du style : <code data-claire-semantic="javascript">event=event||window.event;</code>. Cette ligne sert à assurer la compatibilité avec IE. Toutefois, comme les workers ne fonctionnent qu'à partir de IE10 et que celui-ci supporte la gestion des événements préconisée par le DOM, il n'est pas nécessaire d'ajouter cette ligne. :)</p></aside><div id="r-412215" data-claire-element-id="412215" data-claire-semantic="question"><p id="r-412214" data-claire-element-id="412214">Est-ce qu'il est possible d'utiliser addEventListener ?</p></div><p id="r-412216" data-claire-element-id="412216">Bien sûr, il s'agit d'un événement comme un autre, il est donc possible d'ajouter des listeners. Ainsi les codes précédents donneraient :</p><table id="r-412232" data-claire-element-id="412232"><thead id="r-412222" data-claire-element-id="412222"><tr id="r-412221" data-claire-element-id="412221"><th id="r-412218" data-claire-element-id="412218"><p id="r-412217" data-claire-element-id="412217">main.js</p></th><th id="r-412220" data-claire-element-id="412220"><p id="r-412219" data-claire-element-id="412219">worker.js</p></th></tr></thead><tbody id="r-412231" data-claire-element-id="412231"><tr id="r-412227" data-claire-element-id="412227"><td id="r-412224" data-claire-element-id="412224"><pre id="r-412223" data-claire-element-id="412223"><code data-claire-semantic="javascript">//création du worker
var w=new Worker(&quot;worker.js&quot;);

//ajout d'un listener pour réception d'un message
w.addEventListener(&quot;message&quot;, function(event){
    alert(&quot;Le worker a répondu :\n&quot; + event.data);
    if(event.data.substr(0,7) == &quot;Bonjour&quot;){
        var nom=prompt(&quot;Quel est ton nom ?&quot;);
        w.postMessage(&quot;L'utilisateur s'appelle : &quot;+nom);
    }
},false);

w.postMessage(&quot;Bonjour&quot;);</code></pre></td><td id="r-412226" data-claire-element-id="412226"><pre id="r-412225" data-claire-element-id="412225"><code data-claire-semantic="javascript">function reponse(event){
    if(event.data == &quot;Bonjour&quot;){
        postMessage(&quot;Bonjour, je suis un worker&quot;);
    }else{
        postMessage(&quot;Maintenant je sais que tu es &quot;+
            event.data.substr(26) + &quot; !&quot;);
    }
}

//ajout d'un listener
addEventListener(&quot;message&quot;,reponse,false);</code></pre></td></tr><tr id="r-412230" data-claire-element-id="412230"><td id="r-412229" data-claire-element-id="412229"><p id="r-412228" data-claire-element-id="412228"><a href="http://restimel.github.com/Tutoriels/webWorkers/dedicated3/index.html">Essayer !</a></p></td></tr></tbody></table>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
<span class="arrow"></span>
<span class="next">Premiers pas</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
<span class="next">Gérer un worker</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Grerunworker"></a><h2>Gérer un worker</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
<span class="arrow"></span>
<span class="next">La communication : Envoyer et recevoir des messages</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">
<span class="next">Les shared-workers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-gerer-un-worker" data-claire-element-id="412289">Gérer un worker</h4><h5 id="r-restrictions-3" data-claire-element-id="412237">Restrictions</h5><p id="r-412235" data-claire-element-id="412235">Comme je l'ai déjà répété plusieurs fois, le worker travaille dans un espace qui lui est dédié et qui est complètement séparé de l'environnement d'origine. Cela a pour conséquence de ne pouvoir accéder à de nombreuses ressources comme l'objet <code data-claire-semantic="javascript">document</code> et l'objet <code data-claire-semantic="javascript">window</code>. Cela signifie donc que les variables globales dans la tâche principale ne sont pas accessibles dans le worker. Cela signifie aussi que la page (et le DOM) n'est pas accessible. Il n'est donc pas possible de manipuler ces éléments depuis le worker.</p><p id="r-412236" data-claire-element-id="412236">Ne désespérez pas ! Car en plus de l'utilisation des objets de bases comme <code data-claire-semantic="javascript">Math</code>, <code data-claire-semantic="javascript">Date</code>, <code data-claire-semantic="javascript">XMLHttpRequest</code>,… les workers disposent aussi de quelques outils permettant de compenser l'absence d'accès aux propriétés de l'objet <code data-claire-semantic="javascript">window</code>. Nous verrons cela dans le chapitre avancé, pour l'instant nous allons nous contenter des bases.</p><h5 id="r-l-espace-global" data-claire-element-id="412241">L'espace global</h5><p id="r-412238" data-claire-element-id="412238">L'espace global est l'espace de nom principal qui contient tous les autres espaces de noms qui sont utilisés.</p><p id="r-412239" data-claire-element-id="412239">L'espace global est à l'intérieur du worker, il ne peut pas accéder à l'extérieur et il n'est pas accessible depuis l'extérieur.<br/> À l'intérieur du worker, on peut y faire référence, non pas avec <code data-claire-semantic="javascript">window</code>, mais grâce à la variable <code data-claire-semantic="javascript"><strong>self</strong></code>.</p><pre id="r-412240" data-claire-element-id="412240"><code data-claire-semantic="javascript">var toto = 1;
var tata = self.toto; //vaut 1</code></pre><h5 id="r-arreter-un-worker" data-claire-element-id="412288">Arrêter un worker</h5><p id="r-412242" data-claire-element-id="412242">Jusqu'à présent, nous avons créé et fait vivre un worker. Maintenant on va voir comment le tuer.</p><div id="r-412244" data-claire-element-id="412244" data-claire-semantic="question"><p id="r-412243" data-claire-element-id="412243">Pourquoi avons-nous besoin de tuer un worker ?</p></div><p id="r-412245" data-claire-element-id="412245">La raison principale est d'économiser des ressources. Car un worker consomme de la mémoire et du CPU. Si vous n'avez plus besoin de ses services, alors il est intéressant de libérer les ressources consommées. D'autant plus que certains navigateurs, comme Firefox, gèrent très mal la consommation excessive de mémoire. Le worker devient alors inaccessible mais existe toujours (et donc la mémoire est toujours consommée).</p><p id="r-412246" data-claire-element-id="412246">Tout d'abord on peut remarquer que désassigner la variable qui a servi à créer le worker ne suffit pas à l'arrêter. Prenons ces codes :</p><table id="r-412259" data-claire-element-id="412259"><thead id="r-412252" data-claire-element-id="412252"><tr id="r-412251" data-claire-element-id="412251"><th id="r-412248" data-claire-element-id="412248"><p id="r-412247" data-claire-element-id="412247">main.js</p></th><th id="r-412250" data-claire-element-id="412250"><p id="r-412249" data-claire-element-id="412249">worker.js</p></th></tr></thead><tbody id="r-412258" data-claire-element-id="412258"><tr id="r-412257" data-claire-element-id="412257"><td id="r-412254" data-claire-element-id="412254"><pre id="r-412253" data-claire-element-id="412253"><code data-claire-semantic="javascript">// initialisation du worker
var w = new Worker(&quot;worker.js&quot;);
delete w;</code></pre></td><td id="r-412256" data-claire-element-id="412256"><pre id="r-412255" data-claire-element-id="412255"><code data-claire-semantic="javascript">var l = 50000000;
var tab = [];

//on remplit un tableau
for(var i = 0; i &lt; l; i++){
//À chaque itération la mémoire consommée augmente
  tab.push(&quot;message&quot;);
}</code></pre></td></tr></tbody></table><p id="r-412260" data-claire-element-id="412260">Afin de constater l'état de la mémoire lors de l'exécution de ce code, vous pouvez ouvrir le &quot;Gestionnaire des tâches&quot;/onglet &quot;Performances&quot; (sous Windows) ou le &quot;Moniteur système&quot;/onglet &quot;Ressources&quot; (sous Linux). Les graphiques que vous pouvez observer indiquent le pourcentage de capacités du processeur et la quantité de mémoire vive (RAM) utilisés par les programmes en cours d'exécution.<br/> Vous remarquerez le taux d'utilisation de la mémoire qui continue de monter, alors que juste après sa création, à la ligne 3, nous n'avons plus aucune référence au worker. Le garbage collector ne s'occupe pas du worker car il s'agit d'un script indépendant. Il faut donc explicitement arrêter ce script.<br/> Vous avez pu remarquer que lorsque la boucle s'est terminée, la mémoire est restée stable. Elle n'a pas diminué. Car même si le script n'a plus de code à exécuter, il n'est pas fini pour autant. Donc le tableau reste dans l'environnement global du script et donc en mémoire.</p><aside id="r-412262" data-claire-element-id="412262" data-claire-semantic="error"><p id="r-412261" data-claire-element-id="412261">Si vous générez une erreur dans le worker, vous verrez que cela revient au même. En effet, lorsqu'une erreur survient, l'interpréteur s'arrête, mais le script vit toujours. Il est toujours possible de lancer d'autres fonctions.</p></aside><p id="r-412263" data-claire-element-id="412263">On peut toujours fermer la page, mais c'est un peu violent quand même. :-° <br/> Il existe donc des méthodes propres aux workers pour les arrêter.</p><h6 id="r-eliminer-un-worker-terminate" data-claire-element-id="412287">Éliminer un worker : <code data-claire-semantic="javascript">terminate()</code></h6><p id="r-412264" data-claire-element-id="412264">La fonction la plus efficace est <code data-claire-semantic="javascript">terminate</code> qui permet d'arrêter brutalement le worker. Elle s'applique sur le worker : <code data-claire-semantic="javascript">worker.terminate()</code></p><p id="r-412265" data-claire-element-id="412265">Lorsqu'on fait appel à cette méthode, le worker arrête immédiatement sa tâche en cours puis libère les ressources dont il avait besoin.</p><table id="r-412281" data-claire-element-id="412281"><thead id="r-412271" data-claire-element-id="412271"><tr id="r-412270" data-claire-element-id="412270"><th id="r-412267" data-claire-element-id="412267"><p id="r-412266" data-claire-element-id="412266">main.js</p></th><th id="r-412269" data-claire-element-id="412269"><p id="r-412268" data-claire-element-id="412268">worker.js</p></th></tr></thead><tbody id="r-412280" data-claire-element-id="412280"><tr id="r-412276" data-claire-element-id="412276"><td id="r-412273" data-claire-element-id="412273"><pre id="r-412272" data-claire-element-id="412272"><code data-claire-semantic="javascript">//préparation pour l'affichage
var elem = document.createElement(&quot;output&quot;);
elem.value = &quot;en cours de création&quot;;
document.body.appendChild(elem);

// initialisation du worker
var w=new Worker(&quot;worker.js&quot;);

//ajout d'un listener
w.addEventListener(&quot;message&quot;, function(event){
  elem.value=&quot;Le worker a déjà fait &quot;+
    event.data+&quot; tours&quot;;
});

setTimeout(function(){
// Au bout d'une seconde, on arrête le worker
  w.terminate();

    document.body.appendChild(
      document.createTextNode(
        &quot;Worker Éliminé&quot;));
  },1000);</code></pre></td><td id="r-412275" data-claire-element-id="412275"><pre id="r-412274" data-claire-element-id="412274"><code data-claire-semantic="javascript">var l = 50000000;
var tab = [];

//on remplit un tableau
for(var i = 0; i &lt; l; i++){
//À chaque itération la mémoire consommée augmente
  tab.push(&quot;message&quot;);

//tous les 100 tours, on informe le thread principal
  if(i%100 === 0){
    postMessage(i);
  }
}</code></pre></td></tr><tr id="r-412279" data-claire-element-id="412279"><td id="r-412278" data-claire-element-id="412278"><p id="r-412277" data-claire-element-id="412277"><a href="http://restimel.github.com/Tutoriels/webWorkers/dedicated7/index.html">Essayer !</a></p></td></tr></tbody></table><p id="r-412282" data-claire-element-id="412282">Vous pouvez maintenant voir que la mémoire consommée augmente pendant une seconde puis revient à son niveau initial. Car cette fois le worker a été éliminé. :pirate: <br/> Désormais si vous essayez de lui envoyer un message, vous rencontrerez une erreur car le worker n'existe plus.</p><aside id="r-412284" data-claire-element-id="412284" data-claire-semantic="information"><p id="r-412283" data-claire-element-id="412283">Si vous voulez relancer le worker, il faut en créer un nouveau ! Il n'est pas possible de le relancer là où il en était.</p></aside><p id="r-412285" data-claire-element-id="412285">Maintenant vous pouvez déjà utiliser les dedicated-workers pour embellir vos programmes.</p><p id="r-412286" data-claire-element-id="412286">Dans la partie suivante, vous découvrirez un deuxième type de worker: le shared-worker.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
<span class="arrow"></span>
<span class="next">La communication : Envoyer et recevoir des messages</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">
<span class="next">Les shared-workers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesshared-workers"></a><h2>Les shared-workers</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
<span class="arrow"></span>
<span class="next">Gérer un worker</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
<span class="next">Premiers pas</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-412291" data-claire-element-id="412291">Dans ce chapitre, nous allons découvrir un deuxième type de web-worker : les shared-worker.</p><p id="r-412292" data-claire-element-id="412292">Nous allons voir quels sont les différences avec les dedicated-worker. Nous allons y aller pas à pas afin de les manipuler sans crainte :)</p>
</div><a name="Premierspas"></a><h2>Premiers pas</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">
<span class="arrow"></span>
<span class="next">Les shared-workers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
<span class="next">La communication</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-premiers-pas-13" data-claire-element-id="412318">Premiers pas</h4><p id="r-412293" data-claire-element-id="412293">Nous avons vu dans le précédent chapitre comment manipuler un worker et plus particulièrement les dedicated-workers.</p><p id="r-412294" data-claire-element-id="412294">Nous allons maintenant voir un deuxième type de workers disponible en javascript : les <strong>shared-workers</strong> (workers partagés en français). Contrairement aux dedicated-workers, ils peuvent être contrôlés par plusieurs threads.<br/> Il est donc possible de créer plusieurs références vers le même worker, et ces références peuvent même provenir de pages différentes.</p><p id="r-412295" data-claire-element-id="412295">Un exemple vaudra sans doute bien mieux qu'une longue explication.</p><table id="r-412311" data-claire-element-id="412311"><thead id="r-412301" data-claire-element-id="412301"><tr id="r-412300" data-claire-element-id="412300"><th id="r-412297" data-claire-element-id="412297"><p id="r-412296" data-claire-element-id="412296">main.js</p></th><th id="r-412299" data-claire-element-id="412299"><p id="r-412298" data-claire-element-id="412298">worker.js</p></th></tr></thead><tbody id="r-412310" data-claire-element-id="412310"><tr id="r-412306" data-claire-element-id="412306"><td id="r-412303" data-claire-element-id="412303"><pre id="r-412302" data-claire-element-id="412302"><code data-claire-semantic="javascript">//Création d'une zone d'affichage
var elem = document.createElement(&quot;output&quot;);
elem.value = &quot;Log :&quot;;
document.body.appendChild(elem);

if(window.SharedWorker){
//le navigateur supporte les shared-workers
  var w = new SharedWorker(&quot;worker.js&quot;);
  w.port.onmessage = function(e){
    elem.innerHTML += &quot;&lt;br /&gt;&quot; + e.data;
  };
  w.port.postMessage(&quot;Bonjour&quot;);

}else{
  elem.textContent=&quot;Votre navigateur ne &quot;+
    &quot;supporte pas les shared-workers ☹&quot;;
}</code></pre></td><td id="r-412305" data-claire-element-id="412305"><pre id="r-412304" data-claire-element-id="412304"><code data-claire-semantic="javascript">var num = 0;

//nouvelle connexion
onconnect=function(e){
  var port = e.ports[0];
  port.postMessage(&quot;pret #&quot; + num);
  num++;

  //réception des messages
  port.onmessage = function(event){
    port.postMessage(&quot;réponse à &quot;+
      event.data);
  };
};</code></pre></td></tr><tr id="r-412309" data-claire-element-id="412309"><td id="r-412308" data-claire-element-id="412308"><p id="r-412307" data-claire-element-id="412307"><a href="http://restimel.github.com/Tutoriels/webWorkers/shared1/index.html">Essayer à partir de la page 1 !</a><a href="http://restimel.github.com/Tutoriels/webWorkers/shared1/index2.html">Essayer à partir de la page 2 !</a></p></td></tr></tbody></table><p id="r-412312" data-claire-element-id="412312">À première vue, en essayant ce code, vous vous dîtes qu'il n'y a rien de bien exceptionnel.<br/> Essayez maintenant d'ouvrir la page contenant ce code une deuxième fois (donc cette page sera ouverte dans deux onglets ou deux fenêtres). Qu'observez-vous ?<br/> L'affichage de la page est différent alors qu'il s'agit du même code qui est exécuté o_O !</p><p id="r-412313" data-claire-element-id="412313">Et si vous l'ouvrez une troisième fois, un #3 apparaît alors. Et le numéro s'incrémente pour chaque nouvelle page. Ou plus précisément pour chaque nouvelle connexion au worker.<br/> Car contrairement aux dedicated-workers, celui-ci est partagé entre toutes ces pages. C'est-à-dire que ces pages communiquent avec le même thread, et <code data-claire-semantic="javascript">num</code> s'incrémente à chaque nouvelle connexion.</p><p id="r-412314" data-claire-element-id="412314">Et lorsqu'on ouvre ce code depuis une autre page, c'est toujours la même chose ! Ainsi il est possible de réaliser une communication entre deux pages différentes issues du même site.</p><p id="r-412315" data-claire-element-id="412315">Toutefois il n'est pas possible de communiquer avec un autre utilisateur. Les workers, étant des composants javascript, sont toujours exécutés &quot;côté client&quot;, c'est-à-dire au niveau du navigateur d'un utilisateur. Les workers possèdent aussi une restriction : ces pages doivent provenir du même domaine(same origin policy).</p><p id="r-412316" data-claire-element-id="412316">Le shared-worker sera éliminé dès qu'il n'y a plus aucune référence à celui-ci. Ainsi si vous fermez toutes vos pages, et que vous en rouvrez une, le worker repartira de 0.</p><p id="r-412317" data-claire-element-id="412317">Le principe d'utilisation reste le même que pour les dedicated-workers et s'utilise de la même manière. Cependant vous avez pu remarquer que l'appel des méthodes diffère légèrement. Nous allons voir comment appréhender tout ça :)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">
<span class="arrow"></span>
<span class="next">Les shared-workers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
<span class="next">La communication</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lacommunication"></a><h2>La communication</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
<span class="arrow"></span>
<span class="next">Premiers pas</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
<span class="next">Nommer vos Shared-workers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-la-communication-1" data-claire-element-id="412359">La communication</h4><p id="r-412319" data-claire-element-id="412319">Le concept est toujours le même, les objets appartenant au worker ne sont accessibles que par lui, et lui ne peut pas accéder aux objets extérieurs. Leur seul lien reste toujours un canal de communication.</p><h5 id="r-recevoir-une-nouvelle-connexion-onconnect" data-claire-element-id="412323">Recevoir une nouvelle connexion : <code data-claire-semantic="javascript">onconnect</code></h5><p id="r-412320" data-claire-element-id="412320">La première nouveauté par rapport aux dedicated-workers est le listener <code data-claire-semantic="javascript">onconnect</code>.<br/> Ce listener est appelé à chaque fois qu'un code fait appel à ce worker. Il est donc particulièrement pratique pour adapter son code au nouveau venu (et surtout communiquer avec lui).</p><p id="r-412321" data-claire-element-id="412321">Dans l'événement généré, il y a une propriété qui va particulièrement nous intéresser. Il s'agit de <strong>ports</strong> qui est une liste d'objets de type <em>port</em>.</p><p id="r-412322" data-claire-element-id="412322">Avant d'aller plus loin, nous allons regarder ce qu'est un port.<br/>Non ce n'est pas là où on abrite les bateaux. &gt;_</p><h5 id="r-les-ports" data-claire-element-id="412334">Les ports</h5><p id="r-412324" data-claire-element-id="412324">Un <strong>port logiciel</strong> est un point de contact qui permet de communiquer avec un interlocuteur. Cela permet de bien distinguer tous les interlocuteurs puisqu'ils seront associés chacun à un port différent.</p><p id="r-412325" data-claire-element-id="412325">On peut considérer les ports comme des portes. Quand vous ouvrez une porte vous pouvez accéder à une autre pièce. Si vous désirez atteindre une troisième pièce, vous allez utiliser une porte différente. Si vous voulez que deux pièces de votre maison communiquent ensemble, il vous faudra une porte entre elles.</p><p id="r-412326" data-claire-element-id="412326">En informatique, c'est un peu la même chose ! Les ports vont nous servir à communiquer entre deux threads.</p><p id="r-412327" data-claire-element-id="412327">Ainsi quand on crée un shared-worker, deux ports sont aussi créés :</p><ul id="r-412332" data-claire-element-id="412332"><li id="r-412329" data-claire-element-id="412329"><p id="r-412328" data-claire-element-id="412328">L'un est attaché à l'objet shared-worker créé et se nomme <code data-claire-semantic="javascript">port</code>.</p></li><li id="r-412331" data-claire-element-id="412331"><p id="r-412330" data-claire-element-id="412330">L'autre est envoyé au thread du worker via l'événement <code data-claire-semantic="javascript">connect</code>, et est accessible via le premier élément de <code data-claire-semantic="javascript">ports</code></p></li></ul><p id="r-412333" data-claire-element-id="412333">Dans le code d'introduction, vous pouvez remarquer qu'à la ligne 4 du worker, je récupère explicitement ce port. Et dans le code de main.js, je fais appel à son frère en utilisant la syntaxe : <code data-claire-semantic="javascript">w.port</code>.</p><h5 id="r-postmessage-et-onmessage" data-claire-element-id="412358"><code data-claire-semantic="javascript">postMessage()</code> et <code data-claire-semantic="javascript">onmessage</code></h5><p id="r-412335" data-claire-element-id="412335"><code data-claire-semantic="javascript">postMessage()</code> et <code data-claire-semantic="javascript">onmessage</code> s'utilisent exactement de la même manière qu'avec les dedicated-workers. La seule différence est qu'ils sont associés à un port.</p><p id="r-412336" data-claire-element-id="412336">En réalité, avec les dedicated-workers il y a aussi des ports, mais ils sont intégrés à l'objet et à l'espace global. Du coup il n'est pas nécessaire d'y faire appel explicitement. Cela se justifie facilement puisqu'un dedicated-worker est dédié à celui qui l'a créé et donc ne communique qu'avec lui.<br/> Il en va autrement des shared-workers qui peuvent avoir une multitude de correspondants. Il est donc nécessaire de bien préciser avec lequel on souhaite correspondre.</p><div id="r-412338" data-claire-element-id="412338" data-claire-semantic="question"><p id="r-412337" data-claire-element-id="412337">J'ai voulu utiliser <code data-claire-semantic="javascript">addEventListener</code> mais ça ne marche pas ! Pourquoi ?</p></div><p id="r-412339" data-claire-element-id="412339">Effectivement, il s'agit de la principale différence avec les dedicated-workers. Sur un port, si on souhaite lire les messages en attente il faut explicitement démarrer la distribution.<br/> Ce démarrage se fait grâce à la fonction <code data-claire-semantic="javascript"><strong>start()</strong></code>.</p><table id="r-412355" data-claire-element-id="412355"><thead id="r-412345" data-claire-element-id="412345"><tr id="r-412344" data-claire-element-id="412344"><th id="r-412341" data-claire-element-id="412341"><p id="r-412340" data-claire-element-id="412340">main.js</p></th><th id="r-412343" data-claire-element-id="412343"><p id="r-412342" data-claire-element-id="412342">worker.js</p></th></tr></thead><tbody id="r-412354" data-claire-element-id="412354"><tr id="r-412350" data-claire-element-id="412350"><td id="r-412347" data-claire-element-id="412347"><pre id="r-412346" data-claire-element-id="412346"><code data-claire-semantic="javascript">//Création d'une zone d'affichage
var elem = document.createElement(&quot;output&quot;);
elem.textContent = &quot;Log :&quot;;
document.body.appendChild(elem);

//Création du worker
var w = new SharedWorker(&quot;worker.js&quot;);

w.port.addEventListener(&quot;message&quot;,
  function(e){
    elem.innerHTML += &quot;&lt;br /&gt;&quot;+e.data;
  },false);

w.port.start();
/*
La ligne précédente est très importante
pour démarrer la réception des messages
sur ce port
*/


w.port.postMessage(&quot;Bonjour&quot;);</code></pre></td><td id="r-412349" data-claire-element-id="412349"><pre id="r-412348" data-claire-element-id="412348"><code data-claire-semantic="javascript">var num = 0;

//ajout d'un listener de connexion
addEventListener(&quot;connect&quot;,
 function(e){
  var port = e.ports[0];
  port.postMessage(&quot;Pret #&quot; + num);
  num++;

  //on écoute sur le port
  port.addEventListener(&quot;message&quot;,
   function(e){
    port.postMessage(&quot;Réponse à &quot;+e.data);
   },false);

  /*
   Pour démarrer la réception
   des messages sur ce port
  */
  port.start();
 },false);</code></pre></td></tr><tr id="r-412353" data-claire-element-id="412353"><td id="r-412352" data-claire-element-id="412352"><p id="r-412351" data-claire-element-id="412351"><a href="http://restimel.github.com/Tutoriels/webWorkers/shared3/index.html">Essayer !</a></p></td></tr></tbody></table><aside id="r-412357" data-claire-element-id="412357" data-claire-semantic="information"><p id="r-412356" data-claire-element-id="412356">Il n'est pas nécessaire d'utiliser <code data-claire-semantic="javascript">port.start()</code> lorsqu'on utilise <code data-claire-semantic="javascript">port.onmessage</code>, car avec cette méthode il n'y a pas de &quot;distribution&quot; puisqu'il s'agit du seul endroit où est réceptionné le message. Le démarrage est donc réalisé de manière implicite.</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
<span class="arrow"></span>
<span class="next">Premiers pas</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
<span class="next">Nommer vos Shared-workers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="NommervosShared-workers"></a><h2>Nommer vos Shared-workers</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
<span class="arrow"></span>
<span class="next">La communication</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
<span class="next">Ne plus utiliser un shared-worker</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-nommer-vos-shared-workers" data-claire-element-id="412387">Nommer vos Shared-workers</h4><p id="r-412360" data-claire-element-id="412360">Si dans un code on veut créer deux shared-workers distincts à partir du même fichier, on ne pourra pas s'y prendre de cette façon :</p><pre id="r-412361" data-claire-element-id="412361"><code data-claire-semantic="javascript">var w1 = new SharedWorker(&quot;toto.js&quot;);
var w2 = new SharedWorker(&quot;toto.js&quot;);</code></pre><p id="r-412362" data-claire-element-id="412362">Puisque w1 et w2 feront appel au même worker partagé.</p><p id="r-412363" data-claire-element-id="412363">Le constructeur <code data-claire-semantic="javascript">SharedWorker</code> possède un deuxième argument qui permet de nommer un shared-worker.</p><p id="r-412364" data-claire-element-id="412364">Si maintenant je fais :</p><pre id="r-412365" data-claire-element-id="412365"><code data-claire-semantic="javascript">var w1 = new SharedWorker(&quot;toto.js&quot;,&quot;toto&quot;);
var w2 = new SharedWorker(&quot;toto.js&quot;,&quot;tata&quot;);</code></pre><p id="r-412366" data-claire-element-id="412366">Je possède désormais deux workers distincts car ils ne possèdent pas le même nom. Il est aussi possible d'utiliser ce nom pour faire explicitement appel à un worker existant.</p><table id="r-412382" data-claire-element-id="412382"><thead id="r-412372" data-claire-element-id="412372"><tr id="r-412371" data-claire-element-id="412371"><th id="r-412368" data-claire-element-id="412368"><p id="r-412367" data-claire-element-id="412367">main.js</p></th><th id="r-412370" data-claire-element-id="412370"><p id="r-412369" data-claire-element-id="412369">worker.js</p></th></tr></thead><tbody id="r-412381" data-claire-element-id="412381"><tr id="r-412377" data-claire-element-id="412377"><td id="r-412374" data-claire-element-id="412374"><pre id="r-412373" data-claire-element-id="412373"><code data-claire-semantic="javascript">//Création d'une zone d'affichage
var elem = document.createElement(&quot;div&quot;);
elem.textContent = &quot;Log :&quot;;
document.body.appendChild(elem);

//Création de workers
var w1=new SharedWorker(&quot;worker.js&quot;,&quot;monWorker&quot;);
w1.port.onmessage = function(e){
    elem.innerHTML += &quot;&lt;br&gt;W1 &quot; + e.data;
};

var w2=new SharedWorker(&quot;worker.js&quot;,&quot;worker2&quot;);
w2.port.onmessage = function(e){
    elem.innerHTML += &quot;&lt;br&gt;W2 &quot; + e.data;
};

var w3=new SharedWorker(&quot;worker.js&quot;,&quot;monWorker&quot;);
w3.port.onmessage = function(e){
    elem.innerHTML += &quot;&lt;br&gt;W3 &quot;+e.data;
};


w1.port.postMessage(&quot;Bonjour&quot;);
w2.port.postMessage(&quot;Bonjour&quot;);
w3.port.postMessage(&quot;Bonjour&quot;);</code></pre></td><td id="r-412376" data-claire-element-id="412376"><pre id="r-412375" data-claire-element-id="412375"><code data-claire-semantic="javascript">var num = 0;

onconnect = function(e){
  var port = e.ports[0];

  port.postMessage(&quot;pret #&quot; + num +
    &quot; ? &quot; + self.name);
  num++;


  port.onmessage=function(event){

    port.postMessage(&quot;réponse à &quot; +
      event.data);

  };
};</code></pre></td></tr><tr id="r-412380" data-claire-element-id="412380"><td id="r-412379" data-claire-element-id="412379"><p id="r-412378" data-claire-element-id="412378"><a href="http://restimel.github.com/Tutoriels/webWorkers/shared2/index.html">Essayer !</a></p></td></tr></tbody></table><p id="r-412383" data-claire-element-id="412383"><code data-claire-semantic="javascript">w1</code> et <code data-claire-semantic="javascript">w2</code> ne partagent pas le même worker. Par contre <code data-claire-semantic="javascript">w1</code> et <code data-claire-semantic="javascript">w3</code> partagent le même worker. Car ils ont utilisé le même nom.</p><p id="r-412384" data-claire-element-id="412384">Si on crée un shared-worker à partir d'un nom qui existe déjà et d'une url différente de celle utilisée, alors une erreur apparaît.</p><aside id="r-412386" data-claire-element-id="412386" data-claire-semantic="information"><p id="r-412385" data-claire-element-id="412385">Au passage, vous avez pu remarquer que <code data-claire-semantic="javascript"><strong>self.name</strong></code> permet de connaître le nom attribué à ce worker.</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
<span class="arrow"></span>
<span class="next">La communication</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
<span class="next">Ne plus utiliser un shared-worker</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Neplusutiliserunshared-worker"></a><h2>Ne plus utiliser un shared-worker</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
<span class="arrow"></span>
<span class="next">Nommer vos Shared-workers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">
<span class="next">TP : Jeu des chiffres et des lettres</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-ne-plus-utiliser-un-shared-worker" data-claire-element-id="412394">Ne plus utiliser un shared-worker</h4><p id="r-412388" data-claire-element-id="412388">Il est bien sûr toujours possible d'utiliser <code data-claire-semantic="javascript"><strong>worker.terminate()</strong></code> pour l'achever. Cela signifie que le worker se terminera pour toutes les pages qui utilisent ce worker.</p><p id="r-412389" data-claire-element-id="412389">Avec un dedicated-worker, lorsque vous fermiez la page, vous étiez assuré que le worker disparaissait. Avec les shared-workers, ce n'est plus aussi évident car il se peut qu'une autre page fasse toujours appel à celui-ci. Assurez-vous de bien fermer les shared-workers lorsque vous ne les utilisez plus. Cela vous évitera une consommation de mémoire inutile.</p><p id="r-412390" data-claire-element-id="412390">Mais à l'inverse, faites aussi attention à ne pas terminer un shared-worker prématurément s'il est toujours utilisé par une autre page.</p><p id="r-412391" data-claire-element-id="412391">Si vous désirez juste interrompre la connexion entre deux threads mais laisser le worker intact pour les autres threads, alors je vous propose d'utiliser la fermeture de port que nous verrons dans la section &quot;Pour en savoir plus&quot;.</p><p id="r-412392" data-claire-element-id="412392">À présent vous savez manipuler tous les types de workers disponibles en javascript. Vous pouvez dès à présent vous entraîner pour mieux comprendre leur fonctionnement.</p><p id="r-412393" data-claire-element-id="412393">Dans la suite de ce tutoriel, nous allons donc mettre en pratique ensemble ces connaissances nouvellement acquises.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
<span class="arrow"></span>
<span class="next">Nommer vos Shared-workers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">
<span class="next">TP : Jeu des chiffres et des lettres</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="TPJeudeschiffresetdeslettres"></a><h2>TP : Jeu des chiffres et des lettres</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
<span class="arrow"></span>
<span class="next">Ne plus utiliser un shared-worker</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
<span class="next">Présentation de l&#039;exercice</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-412396" data-claire-element-id="412396">Voici venu le moment de vérifier si vous avez bien compris les bases.</p><p id="r-412397" data-claire-element-id="412397">Dans ce chapitre, vous allez découvrir un exercice vous permettant de vous familiariser avec les workers.</p>
</div><a name="Prsentationdel039exercice"></a><h2>Présentation de l&#039;exercice</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">
<span class="arrow"></span>
<span class="next">TP : Jeu des chiffres et des lettres</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
<span class="next">Correction</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-presentation-de-l-exercice-6" data-claire-element-id="412418">Présentation de l'exercice</h4><p id="r-412398" data-claire-element-id="412398">Vous connaissez sans doute le jeu des chiffres et des lettres. Je vous propose de travailler sur ce sujet.</p><p id="r-412399" data-claire-element-id="412399">Bien sûr le thème de ce tutoriel correspond aux web-workers. Ainsi je ne vais pas vous demander de tout écrire (bien que si vous en avez envie vous pouvez le faire), mais d'améliorer le code que je vais vous donner.</p><h5 id="r-le-jeu-des-chiffres" data-claire-element-id="412401">Le jeu des chiffres</h5><p id="r-412400" data-claire-element-id="412400">Pour ceux qui ne connaissent pas, le jeu des chiffres dans le jeu &quot;des chiffres et des lettres&quot;, consiste à effectuer des opérations (addition, soustraction, multiplication et division) sur 6 nombres afin de trouver un nombre donné (ou s'en approcher le plus possible) dans un temps donné.</p><h5 id="r-le-programme-sans-worker" data-claire-element-id="412412">Le programme sans worker</h5><p id="r-412402" data-claire-element-id="412402">Dans cet exercice, je vous propose de partir sur un code existant.</p><div id="r-412405" data-claire-element-id="412405"><pre id="r-412403" data-claire-element-id="412403"><code data-claire-semantic="html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;fr&quot;&gt;
	&lt;head&gt;
		&lt;meta charset=&quot;UTF-8&quot; /&gt;
		&lt;title&gt;TP : jeu des chiffres&lt;/title&gt;
		&lt;style&gt;
			.info{
				position: absolute;
				left: 0;
				right: 0;
				top: 0;
				height: 7em;
			}
			#zonePlaque{
				display: block;
			}
			#jeuCible{ /*le nombre à trouver*/
				display: inline-block;
				width: 4em;
				padding: 0.3em;
				margin: 0.5em;
				letter-spacing: 0.3em;
				font-weight: bold;
				text-align: center;
				font-size: 1.5em;
				color: #0C0;
				text-shadow: 2px 2px 5px #090;
				background-color: #000;
			}
			#jeuTemps{ /*le chronomètre*/
				display: inline-block;
				width: 5em;
				padding: 0.3em;
				margin: 0.5em 0.5em 0.5em 2em;
				text-align: center;
				font-size: 1.5em;
				color: #DC3;
				text-shadow: 2px 2px 2px #00A;
				background-color: #EFE;
				border: 1px solid #000;
			}
			#jeuTemps:after{
				content: &quot; s&quot;;
			}
			#zonePlaque &gt; div{ /*les plaques*/
				width: 3em;
				padding: 0.5em;
				margin: 0 0.5em 0 0.5em;
				text-align: center;
				background-color: #000;
				color:#FFF;
				font-weight: bold;
				display: inline-block;
				cursor: pointer;
			}
			#zoneResultat{ /*espace de jeu*/
				position: absolute;
				left: 0;
				right: 0;
				top: 7em;
				bottom: 0;
				background-color: #CCF;
				display: none;
			}
			#zoneCalcul{ /*zone d'affichage des opérations*/
				right: 10em;
				padding: 1em;
			}
			#resultatIA{ /*zone d'affichage de l'IA*/
				position: absolute;
				top:0.5em;
				bottom:0;
				right: 0;
				width: 15em;
				background-color: #DDD;
				border:1px solid #000;
				box-shadow: inset 0 0 0.3em 0.1em #999;
			}
			#entreeFormule{ /*espace où l'utilisateur entre sa formule*/
				position: absolute;
				display: block;
				bottom: 0.5em;
				left: 0.5em;
			}
			#jeuDistance{ /*distance obtenue par le joueur*/
				position: absolute;
				display: block;
				bottom: 0.5em;
				right: 17em;
			}
			#resultatIA &gt; div{ /*distance obtenue par l'IA*/
				position:absolute;
				display: block;
				bottom: 0.5em;
				right: 1em;
			}

			#zoneCalcul &gt; div, #resultatIA{ /*les opérations*/
				margin: 0.5em 1em 0 0;
				color:#333;
				text-shadow: 1px 1px 0 #111;
				display: block;
				cursor: pointer;
			}
			#zoneJeu &gt; button{
				float: right;
			}

			.erreur{
				background-color: #FCC;
			}
			.compteBon{
				color:#393 !important;
			}
		&lt;/style&gt;
	&lt;/head&gt;
	&lt;body&gt;
		&lt;section class=&quot;info&quot; id=&quot;zoneJeu&quot; style=&quot;display:none;&quot;&gt;
			&lt;button onclick=&quot;initialisation()&quot;&gt;Rejouer&lt;/button&gt;
			&lt;output id=&quot;jeuCible&quot;&gt;&lt;/output&gt;
			&lt;output id=&quot;jeuTemps&quot;&gt;&lt;/output&gt;
			&lt;section id=&quot;zonePlaque&quot;&gt;&lt;/section&gt;
		&lt;/section&gt;
		&lt;section class=&quot;info&quot; id=&quot;zoneParametres&quot;&gt;
			&lt;label&gt;Nombre de plaques : &lt;input type=&quot;number&quot; min=&quot;2&quot; value=&quot;6&quot; id=&quot;regleNbPlaques&quot;/&gt;&lt;/label&gt;
			&lt;label&gt;Temps de jeu : &lt;input type=&quot;number&quot; min=&quot;1&quot; value=&quot;45&quot; id=&quot;regleTemps&quot;/&gt; secondes&lt;/label&gt;
			&lt;br/&gt;
			&lt;button onclick=&quot;initialisation()&quot;&gt;Commencer une partie&lt;/button&gt;
		&lt;/section&gt;
		&lt;fieldset id=&quot;zoneResultat&quot;&gt;
			&lt;legend&gt;Résultat&lt;/legend&gt;
			&lt;section id=&quot;zoneCalcul&quot;&gt;&lt;/section&gt;
			&lt;aside id=&quot;resultatIA&quot;&gt;&lt;/aside&gt;
			&lt;input type=&quot;text&quot; id=&quot;entreeFormule&quot; title=&quot;Entrez ici vos formules de calculs&quot; placeholder=&quot;Entrez les calculs ici&quot; /&gt;
			&lt;output id=&quot;jeuDistance&quot;&gt;&lt;/output&gt;
		&lt;/fieldset&gt;

		&lt;script src=&quot;jeu.js&quot;&gt;&lt;/script&gt;
	&lt;/body&gt;
&lt;/html&gt;</code></pre><pre id="r-412404" data-claire-element-id="412404"><code data-claire-semantic="javascript">/*
  Références globales aux éléments HTML frequemment utilisés
*/

var regleTemps = document.getElementById(&quot;regleTemps&quot;); //élément indiquant le temps total de réflexion
var jeuTemps = document.getElementById(&quot;jeuTemps&quot;); //élément indiquant le temps restant pour jouer
var jeuCible = document.getElementById(&quot;jeuCible&quot;); //élément indiquant le nombre à trouver

var listeNombre = []; //liste des nombres utilisables par l'utilisateur

//paramétrage par défaut
document.getElementById(&quot;regleNbPlaques&quot;).value=6;
regleTemps.value=45;



// initialisation d'une nouvelle partie
function initialisation(){
	//cache les paramètres de règles
	document.getElementById(&quot;zoneParametres&quot;).style.display = &quot;none&quot;;

	//préparation de la zone de jeu
	document.getElementById(&quot;zoneResultat&quot;).style.display = &quot;block&quot;;
	document.getElementById(&quot;zoneJeu&quot;).style.display = &quot;block&quot;;
	jeuCible.value = &quot;???&quot;;
	jeuTemps.value = regleTemps.value;

	document.getElementById(&quot;zonePlaque&quot;).innerHTML = &quot;&quot;;
	document.getElementById(&quot;resultatIA&quot;).innerHTML = &quot;&quot;;
	document.getElementById(&quot;zoneCalcul&quot;).innerHTML = &quot;&quot;;

	//initialisation des nombres
	listeNombre = [];
	generateNombre();

	//gestion de l'input servant à entrer un calcul
	var inputFormule = document.getElementById(&quot;entreeFormule&quot;);
	inputFormule.style.display = &quot;&quot;;
	inputFormule.value = &quot;&quot;;
	inputFormule.addEventListener(&quot;blur&quot;,restoreFocus,false);
	inputFormule.addEventListener(&quot;keypress&quot;,analyseFormule,false);
	inputFormule.addEventListener(&quot;blur&quot;,analyseFormule,false);
	inputFormule.focus();
}

//gestion du chronometre
var chronometre=(function(){
	var init,timer=-1
	function chrono(){
		var temps = (Date.now() - init)/1000; //temps écoulé depuis le début du jeu
		jeuTemps.value = Math.round(regleTemps.value - temps);
		if(temps&gt;regleTemps.value){
			//le temps est écoulé
			clearInterval(timer);

			//On retire le formulaire
			var inputFormule = document.getElementById(&quot;entreeFormule&quot;);
			inputFormule.style.display = &quot;none&quot;;
			inputFormule.removeEventListener(&quot;blur&quot;,restoreFocus,false);
			inputFormule.removeEventListener(&quot;keypress&quot;,analyseFormule,false);
			inputFormule.removeEventListener(&quot;blur&quot;,analyseFormule,false);

			//on affiche l'analyse de l'ordinateur
			analyseIA();
		}
	}

	return function(){
		//démarrage du chronomètre
		init = Date.now();
		clearInterval(timer);
		timer = setInterval(chrono,400);
	};
})();

//permet de rechercher une solution et de l'afficher
function analyseIA(){
	//recherche une des meilleures solutions 
	var liste = [];
	listeNombre.forEach(function(el){
		if(!el.parent1) liste.push(el.valeur);
	}); //récupération des nombres de départ
	var resultat = chercheSolution(liste,jeuCible.value);
	var explication = resultat[1].replace(/\n/g,&quot;&lt;br&gt;&quot;);
	if(resultat[0]){
		explication += &quot;&lt;div&gt;Compte approchant : &quot; + resultat[0] + &quot;&lt;/div&gt;&quot;;
	}else{
		explication += &quot;&lt;div&gt;Le compte est bon !&lt;/div&gt;&quot;;
	}
	document.getElementById(&quot;resultatIA&quot;).innerHTML = explication;
}


//permet de générer les nombres pour jouer et définit la cible
function generateNombre(){
	var choix = [1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,25,50,75,100]; //plaques possibles
	var nbPlaque = parseInt(document.getElementById(&quot;regleNbPlaques&quot;).value,10);
	if(listeNombre.length &lt; nbPlaque){
		listeNombre.push(new Nombre(null,null,null,choix[Math.floor(Math.random()*choix.length)]));
		setTimeout(generateNombre,500);
	}else{
		jeuCible.value = Math.floor(Math.random()*898)+101; //le nombre à trouver doit être compris entre 101 et 999
		chronometre(); //on démarre le compte à rebours
	}
}

//permet de redonner le focus à l'input quand il le perd
function restoreFocus(event){
	setTimeout(function(){event.target.focus();},20);
}

//permet d'analyser l'entrée de l'utilisateur
function analyseFormule(event){
	var key = event.keyCode || event.which;
	if(key === undefined || key === 13 || key === 61 || key === 9){ //demande de valider l'opération

		var operation = this.value.match(/(\d+)\s*([-+*_\\/÷&amp;xX×])\s*(\d+)/); // permet de vérifier que l'opération contient un nombre, un opérateur, et un nombre
		if(operation){
			var n1 = getNombre(operation[1]),
			    n2 = getNombre(operation[3],n1);

			//analyse de l'opérateur utilisé
			switch(operation[2]){
				case &quot;&amp;&quot;:
				case &quot;+&quot;:
					operation = &quot;+&quot;;
				break;
				case &quot;_&quot;:
				case &quot;-&quot;:
					operation = &quot;-&quot;;
				break;
				case &quot;*&quot;:
				case &quot;x&quot;:
				case &quot;X&quot;:
				case &quot;×&quot;:
					operation = &quot;×&quot;;
				break;
				case &quot;/&quot;:
				case &quot;\\&quot;:
				case &quot;÷&quot;:
					operation = &quot;÷&quot;;
				break;
				default:
					operation = null;
			}
		}
		if(operation &amp;&amp; n1 &amp;&amp; n2){
			//toutes les composantes sont correctes, on peut créer le Nombre
			var n = new Nombre(n1,n2,operation);
			if(n.valeur){ // si n.valeur vaut 0, c'est que l'opération ne respecte pas les règles
				listeNombre.push(n);
				this.value = &quot;&quot;;
				majDistance();
			}
		}else{
			this.className = &quot;erreur&quot;;
		}
	}else{
		this.className = &quot;&quot;; // au cas où l'état précédent était en &quot;erreur&quot;
	}
}

//permet de trouver un objet Nombre parmi ceux disponibles qui possède la valeur recherchée
// valeur : valeur à chercher
// except : continue la recherche si l'objet trouvé est celui indiqué par except
function getNombre(valeur, except){
	function filtre(el){
		//on ne veut que les objets non utilisés et ayant la bonne valeur
		return !el.usedBy &amp;&amp; el.valeur == valeur &amp;&amp; el !== except;
	}
	var liste = listeNombre.filter(filtre); //récupère la liste de tous les objets correspondant aux critères
	return liste[0]; //seul le premier objet est retourné
}

//met à jour la distance entre les nombres trouvés et la cible
function majDistance(){
	var distance = Infinity;
	var cible = jeuCible.value;
	listeNombre.forEach(function(el){
		distance = Math.min(distance,Math.abs(el.valeur-cible));
	});
	var jeuDistance = document.getElementById(&quot;jeuDistance&quot;);
	if(distance){
		jeuDistance.value = &quot;Compte approchant : &quot; + distance;
	}else{
		jeuDistance.value = &quot;Le compte est bon !&quot;;
	}
}

//création et affichage d'une plaque
function creationPlaque(nb){
	var plaque = document.createElement(&quot;div&quot;);
	plaque.textContent = nb;
	plaque.addEventListener(&quot;click&quot;,ajouteValeur,false);
	document.getElementById(&quot;zonePlaque&quot;).appendChild(plaque);
	return plaque;
}

//permet d'ajouter la valeur d'une plaque à la formule de calcul
function ajouteValeur(event){
	document.getElementById(&quot;entreeFormule&quot;).value += event.target.textContent;
}


//Nombre est un objet représentant les nombres manipulés par l'utilisateur
//Il permet de savoir quel nombre a permis de réaliser une opération. Ce qui facilite le retour en arrière pour supprimer une opération
function Nombre(parent1,parent2,op,init){
	this.parent1 = parent1; //le premier nombre de l'opération
	this.parent2 = parent2; //le deuxième nombre de l'opération
	this.operateur = op; //l'opérateur de l'opération
	this.usedBy = null; //autre opération qui utilise ce nombre

	if(init){
		this.valeur = init;
		creationPlaque(init);
	}else{
		//réalisation du calcul
		switch(op){
			case &quot;+&quot;:
				this.valeur = parent1.valeur + parent2.valeur;
			break;
			case &quot;-&quot;:
				this.valeur = parent1.valeur - parent2.valeur;
			break;
			case &quot;×&quot;:
				this.valeur = parent1.valeur * parent2.valeur;
			break;
			case &quot;÷&quot;:
				this.valeur = parent1.valeur / parent2.valeur;
			break;
		}
		//vérification du calcul
		if(this.valeur &lt; 0 || this.valeur !== Math.round(this.valeur)){
			this.valeur = 0;
			return null;
		}
		this.parent1.utilise(this);
		this.parent2.utilise(this);
		this.createCalcul();
	}
}

//affichage du calcul correspondant à ce nombre
Nombre.prototype.createCalcul = function(){
	this.refCalcul = document.createElement(&quot;div&quot;);
	this.refCalcul.textContent = this.parent1.valeur + &quot; &quot; + this.operateur + &quot; &quot; + this.parent2.valeur + &quot; = &quot; + this.valeur;
	if(this.valeur == jeuCible.value){
		this.refCalcul.className = &quot;compteBon&quot;;
	}else{
		var that = this;
		this.refCalcul.addEventListener(&quot;click&quot;,function(){that.supprime();},false);
	}
	document.getElementById(&quot;zoneCalcul&quot;).appendChild(this.refCalcul);
};

//définit l'utilisation de ce nombre dans un opération
Nombre.prototype.utilise = function(parent){
	this.usedBy = parent;
};

//définit le fait que ce nombre n'est plus utilisé dans une opération
Nombre.prototype.libre = function(){
	this.usedBy = null;
};

//suppression de ce nombre et donc de l'opération
Nombre.prototype.supprime = function(){
	if(this.usedBy){
		this.usedBy.supprime();
	}
	if(this.parent1){
		this.parent1.libre();
	}
	if(this.parent2){
		this.parent2.libre();
	}
	this.refCalcul.parentNode.removeChild(this.refCalcul);
	listeNombre.splice(listeNombre.indexOf(this),1);
};


//recherche une solution
function chercheSolution(nombres,cible){ //il s'agit d'une fonction récursive
	var nb1,nb2; //nombres utilisés pour étudier une opération
	var i,j; //index itératifs
	var li = nombres.length; //taille de la liste des nombres parmi lesquels il faut chercher le premier nombre de l'opération
	var lj = li - 1; //taille de la liste des nombres moins nb1 parmi lesquels le deuxième nombre de l'opération est recherché
	var calcul; //résultat de l'opération en cours
	var rslt; //résultat d'une recherche avec moins de nombres
	var distance = Infinity; //distance de la solution actuelle par rapport à la cible
	var solution = &quot;&quot;; //meilleure solution actuelle

	var nombresSansNb1; //liste de nombre sans le premier nombre de l'opération (nb1)
	var nombresSansNb2; //liste de nombre sans les nombres de l'opération (nb1 et nb2)

	for(i=0; i&lt;li &amp;&amp; distance; i++){
		nb1 = nombres[i]; //analyse avec ce premier nombre
		nombresSansNb1 = nombres.concat([]); //copie de la liste
		nombresSansNb1.splice(i,1); //on retire le nombre de la liste

		for(j=0; j&lt;lj; j++){
			nb2 = nombresSansNb1[j]; //analyse avec ce deuxième nombre
			nombresSansNb2 = nombresSansNb1.concat([]); //copie de la liste
			nombresSansNb2.splice(j,1); //on retire le nombre de la liste

			//calcul ×
			calcul = nb1 * nb2;
			if(Math.abs(cible - calcul)&lt;distance){
				distance = Math.abs(cible - calcul);
				solution = nb1 +&quot; × &quot; + nb2 + &quot; = &quot; + calcul;
				if(!distance) break; //on a trouvé une solution on arrête la boucle
			}
			rslt = chercheSolution(nombresSansNb2.concat([calcul]),cible); // on relance la recherche avec les nombres restant + ce résultat
			if(rslt[0]&lt;distance){
				distance = rslt[0];
				solution = nb1 +&quot; × &quot; + nb2 + &quot; = &quot; + calcul + &quot;\n&quot; + rslt[1];
				if(!distance) break; //on a trouvé une solution on arrête la boucle
			}

			//calcul +
			calcul = nb1 + nb2;
			if(Math.abs(cible - calcul)&lt;distance){
				distance = Math.abs(cible - calcul);
				solution = nb1 +&quot; + &quot; + nb2 + &quot; = &quot; + calcul;
				if(!distance) break; //on a trouvé une solution on arrête la boucle
			}
			rslt = chercheSolution(nombresSansNb2.concat([calcul]),cible); // on relance la recherche avec les nombres restant + ce résultat
			if(rslt[0]&lt;distance){
				distance = rslt[0];
				solution = nb1 +&quot; + &quot; + nb2 + &quot; = &quot; + calcul + &quot;\n&quot; + rslt[1];
				if(!distance) break; //on a trouvé une solution on arrête la boucle
			}

			//calcul -
			calcul = nb1 - nb2;
			if(calcul&gt;0){
				if(Math.abs(cible - calcul)&lt;distance){
					distance = Math.abs(cible - calcul);
					solution = nb1 +&quot; - &quot; + nb2 + &quot; = &quot; + calcul;
					if(!distance) break; //on a trouvé une solution on arrête la boucle
				}
				rslt = chercheSolution(nombresSansNb2.concat([calcul]),cible); // on relance la recherche avec les nombres restant + ce résultat
				if(rslt[0]&lt;distance){
					distance = rslt[0];
					solution = nb1 +&quot; - &quot; + nb2 + &quot; = &quot; + calcul + &quot;\n&quot; + rslt[1];
					if(!distance) break; //on a trouvé une solution on arrête la boucle
				}
			}

			//calcul ÷
			calcul = nb1 / nb2;
			if(calcul === Math.floor(calcul)){
				if(Math.abs(cible - calcul)&lt;distance){
					distance = Math.abs(cible - calcul);
					solution = nb1 +&quot; ÷ &quot; + nb2 + &quot; = &quot; + calcul;
					if(!distance) break; //on a trouvé une solution on arrête la boucle
				}
				rslt = chercheSolution(nombresSansNb2.concat([calcul]),cible); // on relance la recherche avec les nombres restant + ce résultat
				if(rslt[0]&lt;distance){
					distance = rslt[0];
					solution = nb1 +&quot; ÷ &quot; + nb2 + &quot; = &quot; + calcul + &quot;\n&quot; + rslt[1];
					if(!distance) break; //on a trouvé une solution on arrête la boucle
				}
			}

		}
	}

	return [distance,solution];
}</code></pre></div><p id="r-412406" data-claire-element-id="412406"><a href="http://restimel.github.com/Tutoriels/webWorkers/TP_chiffres/sansWorker/index.html">Tester le jeu sans les workers !</a></p><p id="r-412407" data-claire-element-id="412407">Ce code permet à un utilisateur de jouer au jeu des Chiffres, mais aussi de présenter une solution au problème qui a été posé.<br/> L'algorithme pour trouver cette solution est un simple brute-force qui analyse tous les cas possibles.</p><h6 id="r-des-problemes-1" data-claire-element-id="412411">Des problèmes</h6><p id="r-412408" data-claire-element-id="412408">En testant ce jeu, vous devriez remarquer un problème de taille : lorsque le temps est écoulé, la page se fige pendant un certain temps.</p><p id="r-412409" data-claire-element-id="412409">Effectivement lorsque le temps est écoulé, l'ordinateur se met à chercher une solution. Et dans certains cas (surtout quand le bon compte n'est pas atteignable) cette recherche prend du temps.<br/> Dans certains cas, avec des ordinateurs un peu lents, on peut même voir apparaître la fameuse alerte demandant d'interrompre le script.</p><p id="r-412410" data-claire-element-id="412410">Même si c'est fonctionnel, l'utilisateur peut en ressentir une très grande gêne.</p><h5 id="r-a-vous-de-jouer-22" data-claire-element-id="412417">À vous de jouer</h5><p id="r-412413" data-claire-element-id="412413">Le but de l'exercice consiste à améliorer la performance de la recherche de solution afin que l'utilisateur soit le moins gêné possible par cette recherche.</p><p id="r-412414" data-claire-element-id="412414">Une façon de résoudre cet exercice pourrait consister à améliorer l’algorithme de recherche. C'est tout à fait possible mais c'est compliqué ^^</p><p id="r-412415" data-claire-element-id="412415">Une solution beaucoup plus simple consiste à réaliser la recherche pendant que le joueur réfléchit à sa solution. Ainsi l'ordinateur dispose du même temps que le joueur pour trouver une solution, ce qui est souvent largement suffisant.</p><p id="r-412416" data-claire-element-id="412416">Et là si vous avez bien suivi le cours, une solution technique devrait vous sauter aux yeux : <strong>utiliser un worker !</strong></p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">
<span class="arrow"></span>
<span class="next">TP : Jeu des chiffres et des lettres</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
<span class="next">Correction</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Correction"></a><h2>Correction</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
<span class="arrow"></span>
<span class="next">Présentation de l&#039;exercice</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">
<span class="next">Tout est communication</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-correction-141" data-claire-element-id="412463">Correction</h4><p id="r-412419" data-claire-element-id="412419">N'oubliez pas qu'il n'y a pas une seule solution. Mais celle que je vais vous montrer peut vous donner des pistes sur la manière d'intégrer un worker dans un projet.</p><h5 id="r-identifier-les-besoins" data-claire-element-id="412423">Identifier les besoins</h5><p id="r-412420" data-claire-element-id="412420">Tout d'abord il est important de repérer les fonctions qui seront mises dans un worker.<br/> Nous souhaitons paralléliser la recherche de solution, la fonction qui réalise cette action est <code data-claire-semantic="javascript">chercheSolution</code>.</p><p id="r-412421" data-claire-element-id="412421">Cette fonction peut être appelée indépendamment des autres. Il s'agit donc de la seule fonction à déplacer.</p><p id="r-412422" data-claire-element-id="412422">Il faut donc créer un fichier solution.js qui contiendra cette fonction.</p><h5 id="r-instanciation-du-worker" data-claire-element-id="412428">Instanciation du worker</h5><p id="r-412424" data-claire-element-id="412424">Si le navigateur ne supporte pas les workers, il est possible de créer un contournement en chargeant dynamiquement le fichier solution.js.</p><p id="r-412425" data-claire-element-id="412425">Dans le cas où les workers sont supportés, on démarre un nouveau thread.</p><pre id="r-412426" data-claire-element-id="412426"><code data-claire-semantic="javascript">if(window.Worker){
	//le navigateur supporte les workers
	var solutionWorker = new Worker(&quot;./solution.js&quot;);
	solutionWorker.addEventListener(&quot;message&quot;,reponseWorker,false);
}else{
	//le navigateur ne supporte pas les Workers, on charge le fichier dynamiquement
	(function(){//pour éviter de polluer l'espace globale
		var script = document.createElement(&quot;script&quot;);
		script.src=&quot;./solution.js&quot;;
		document.body.appendChild(script);
	})();
}</code></pre><p id="r-412427" data-claire-element-id="412427">À ce stade, le code doit toujours fonctionner si le navigateur ne supporte pas les workers. Pour essayer, vous pouvez mal orthographier la condition <code data-claire-semantic="javascript">if(window.Worker)</code> afin de la rendre fausse et charger le script sans Worker.</p><h5 id="r-la-communication-avec-le-worker" data-claire-element-id="412438">La communication avec le Worker</h5><p id="r-412429" data-claire-element-id="412429">Avant de s'occuper de la communication, on va analyser plusieurs cas de fonctionnement. Par exemple on peut avoir un cas où le jeu se termine avant que la solution ne soit encore trouvée. Dans ce cas, dès que nous avons la réponse il faut l'afficher.<br/> Ensuite on a le cas inverse (qui devrait être plus fréquent), où il faudra conserver la réponse jusqu'à la fin du jeu.</p><p id="r-412430" data-claire-element-id="412430">Pour pouvoir distinguer ces cas, nous allons ajouter une propriété à notre worker (il s'agit d'un objet comme les autres), qui nous servira à conserver la réponse ou indiquer que la réponse doit être envoyée immédiatement.<br/> Ainsi dans la fonction <code data-claire-semantic="javascript">analyseIA</code>, on sépare les différents cas :</p><pre id="r-412431" data-claire-element-id="412431"><code data-claire-semantic="javascript">//permet de rechercher une solution et de l'afficher
function analyseIA(){
	if(solutionWorker){
		//les workers sont utilisés
		if(solutionWorker.resultat){
			//le résultat a déjà été trouvé
			affichageIA(solutionWorker.resultat);
		}else{
			//le résultat n'a pas encore été trouvé
			solutionWorker.resultat = -1;
			document.getElementById(&quot;resultatIA&quot;).textContent = &quot;recherche en cours...&quot;; //on avertit l'utilisateur
		}
	}else{
		//Le worker n'est pas utilisé ainsi on lance la recherche de solutions 
		var liste = [];
		listeNombre.forEach(function(el){
			if(!el.parent1) liste.push(el.valeur);
		}); //récupération des nombres de départ
		affichageIA(chercheSolution(liste,jeuCible.value));
	}

}

//affiche le résultat trouvé par l'ordinateur
function affichageIA(resultat){
	var explication = resultat[1].replace(/\n/g,&quot;&lt;br&gt;&quot;);
	if(resultat[0]){
		explication += &quot;&lt;div&gt;Compte approchant : &quot; + resultat[0] + &quot;&lt;/div&gt;&quot;;
	}else{
		explication += &quot;&lt;div&gt;Le compte est bon !&lt;/div&gt;&quot;;
	}
	document.getElementById(&quot;resultatIA&quot;).innerHTML = explication;
}</code></pre><h6 id="r-recevoir-des-messages-du-worker" data-claire-element-id="412434">Recevoir des messages du worker</h6><p id="r-412432" data-claire-element-id="412432">On peut maintenant s'occuper de la fonction <code data-claire-semantic="javascript">reponseWorker</code> qui analysera les réponses du worker.</p><pre id="r-412433" data-claire-element-id="412433"><code data-claire-semantic="javascript">//permet d'analyser la réponse du worker
function reponseWorker(event){
	var reponse = event.data.split(&quot;|&quot;);
	if(solutionWorker.resultat === -1){
		//il faut afficher le resultat tout de suite
		affichageIA(reponse);
	}else{
		//on garde la réponse au chaud
		solutionWorker.resultat = reponse;
	}
}</code></pre><h6 id="r-demarrer-la-recherche" data-claire-element-id="412437">Démarrer la recherche</h6><p id="r-412435" data-claire-element-id="412435">Pour ce qui est du démarrage du calcul, contrairement à l'architecture sans worker, il doit se faire au début du jeu. Il faut donc modifier la fonction <code data-claire-semantic="javascript">generateNombre</code> pour démarrer le calcul à ce moment.</p><pre id="r-412436" data-claire-element-id="412436"><code data-claire-semantic="javascript">//permet de générer les nombres pour jouer et défini la cible
function generateNombre(){
	var choix = [1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,25,50,75,100]; //plaques possibles
	var nbPlaque = parseInt(document.getElementById(&quot;regleNbPlaques&quot;).value,10);
	if(listeNombre.length &lt; nbPlaque){
		listeNombre.push(new Nombre(null,null,null,choix[Math.floor(Math.random()*choix.length)]));
		setTimeout(generateNombre,500);
	}else{
		jeuCible.value = Math.floor(Math.random()*898)+101; //le nombre à trouver doit être compris entre 101 et 999		
		if(solutionWorker){
			//on utilise un worker pour trouver la solution
			var liste = &quot;&quot;;
			listeNombre.forEach(function(el){liste += el.valeur+&quot;,&quot;;}); //on prépare la liste des nombres
			liste += jeuCible.value; //on ajoute la cible à la fin de la liste
			solutionWorker.postMessage(liste); //on envoit la liste pour démarrer la recherche
			solutionWorker.resultat = null; //on réinitialise la propriété resultat
		}
		chronometre(); //on démarre le compte à rebours
	}
}</code></pre><h5 id="r-le-worker" data-claire-element-id="412443">Le worker</h5><p id="r-412439" data-claire-element-id="412439">Maintenant, il reste à nous occuper de la communication dans le worker. Il faut donc démarrer le calcul en fonction des informations reçues.</p><pre id="r-412440" data-claire-element-id="412440"><code data-claire-semantic="javascript">//listener qui permet de contrôler le worker
onmessage = function(event){
	var nombres = event.data.split(&quot;,&quot;); //on récupère la liste des nombres
	var cible = parseInt(nombres.pop(),10); //on récupère la cible
	nombres = nombres.map(function(v){return parseInt(v,10);}); // conversion de toutes les valeurs en nombre
	var resultat = chercheSolution(nombres,cible); //on effectue le calcul
	postMessage(resultat.join(&quot;|&quot;)); //on renvoie la solution
};</code></pre><aside id="r-412442" data-claire-element-id="412442" data-claire-semantic="information"><p id="r-412441" data-claire-element-id="412441">À la ligne 7, on convertit le résultat qui se présente sous forme de tableau, en chaîne de caractères. Dans la partie avancée du tutoriel, nous verrons qu'il est possible d'envoyer autre chose que des chaînes de caractères, et qu'il est possible de se passer de cette conversion.</p></aside><h5 id="r-cas-particulier-1" data-claire-element-id="412454">Cas particulier</h5><p id="r-412444" data-claire-element-id="412444">Comme il est possible d'exécuter plusieurs codes en même temps, il faut regarder si des cas particuliers ne se présentent pas.<br/> Par exemple : Si l'utilisateur demande de recommencer à jouer alors que l'ordinateur est toujours en train de chercher la solution.</p><div id="r-412446" data-claire-element-id="412446" data-claire-semantic="question"><p id="r-412445" data-claire-element-id="412445">Que se passe-t-il ?</p></div><p id="r-412447" data-claire-element-id="412447">Le jeu va recommencer, on aura donc de nouveaux nombres, et ces nombres seront à nouveau envoyés au worker. Or celui-ci est déjà en train de chercher la réponse au jeu précédent (qui a été arrêté). Il ne s'occupera de ces nouveaux nombres que lorsqu'il aura fini avec les premiers.<br/> Ainsi, si le jeu se termine avant qu'il ait fini avec ces derniers, il affichera la solution des premiers nombres qui n'ont rien à voir avec les nombres en cours.<br/> Et même si on se dit qu'il reste une bonne marge, l'utilisateur peut très bien cliquer sur recommencer 20 fois de suite. Et l'ordinateur recherchera une solution pour tous ces jeux.</p><p id="r-412448" data-claire-element-id="412448">Une solution consiste à arrêter le worker grâce à <code data-claire-semantic="javascript">terminate</code> lorsqu'un nouveau jeu est démarré. Ainsi pour faire simple il suffit de tuer le worker et d'en recréer un autre à chaque fois qu'on initialise une nouvelle partie, même si le worker avait fini son travail.</p><p id="r-412449" data-claire-element-id="412449">Comme le worker peut être créé à différents endroits, autant créer une fonction :</p><pre id="r-412450" data-claire-element-id="412450"><code data-claire-semantic="javascript">//création d'un worker
function createWorker(){
	var w = new Worker(&quot;./solution.js&quot;);
	w.addEventListener(&quot;message&quot;,reponseWorker,false);
	return w;
}

if(window.Worker){
	//le navigateur supporte les workers
	var solutionWorker = createWorker();
}</code></pre><p id="r-412451" data-claire-element-id="412451">Et dans la fonction <code data-claire-semantic="javascript">initialisation</code>, il suffit d'ajouter :</p><pre id="r-412452" data-claire-element-id="412452"><code data-claire-semantic="javascript">if(solutionWorker){
	//pour éviter de calculer la solution d'une autre partie on tue le worker
	solutionWorker.terminate();
	solutionWorker = createWorker();
}</code></pre><p id="r-412453" data-claire-element-id="412453">Et voilà le jeu est prêt !</p><h5 id="r-solution-avec-un-worker" data-claire-element-id="412462">Solution avec un worker</h5><div id="r-412458" data-claire-element-id="412458"><pre id="r-412455" data-claire-element-id="412455"><code data-claire-semantic="html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;fr&quot;&gt;
	&lt;head&gt;
		&lt;meta charset=&quot;UTF-8&quot; /&gt;
		&lt;title&gt;TP : jeu des chiffres&lt;/title&gt;
		&lt;style&gt;
			.info{
				position: absolute;
				left: 0;
				right: 0;
				top: 0;
				height: 7em;
			}
			#zonePlaque{
				display: block;
			}
			#jeuCible{ /*le nombre à trouver*/
				display: inline-block;
				width: 4em;
				padding: 0.3em;
				margin: 0.5em;
				letter-spacing: 0.3em;
				font-weight: bold;
				text-align: center;
				font-size: 1.5em;
				color: #0C0;
				text-shadow: 2px 2px 5px #090;
				background-color: #000;
			}
			#jeuTemps{ /*le chronomètre*/
				display: inline-block;
				width: 5em;
				padding: 0.3em;
				margin: 0.5em 0.5em 0.5em 2em;
				text-align: center;
				font-size: 1.5em;
				color: #DC3;
				text-shadow: 2px 2px 2px #00A;
				background-color: #EFE;
				border: 1px solid #000;
			}
			#jeuTemps:after{
				content: &quot; s&quot;;
			}
			#zonePlaque &gt; div{ /*les plaques*/
				width: 3em;
				padding: 0.5em;
				margin: 0 0.5em 0 0.5em;
				text-align: center;
				background-color: #000;
				color:#FFF;
				font-weight: bold;
				display: inline-block;
				cursor: pointer;
			}
			#zoneResultat{ /*espace de jeu*/
				position: absolute;
				left: 0;
				right: 0;
				top: 7em;
				bottom: 0;
				background-color: #CCF;
				display: none;
			}
			#zoneCalcul{ /*zone d'affichage des opérations*/
				right: 10em;
				padding: 1em;
			}
			#resultatIA{ /*zone d'affichage de l'IA*/
				position: absolute;
				top:0.5em;
				bottom:0;
				right: 0;
				width: 15em;
				background-color: #DDD;
				border:1px solid #000;
				box-shadow: inset 0 0 0.3em 0.1em #999;
			}
			#entreeFormule{ /*espace où l'utilisateur entre sa formule*/
				position: absolute;
				display: block;
				bottom: 0.5em;
				left: 0.5em;
			}
			#jeuDistance{ /*distance obtenue par le joueur*/
				position: absolute;
				display: block;
				bottom: 0.5em;
				right: 17em;
			}
			#resultatIA &gt; div{ /*distance obtenue par l'IA*/
				position:absolute;
				display: block;
				bottom: 0.5em;
				right: 1em;
			}

			#zoneCalcul &gt; div, #resultatIA{ /*les opérations*/
				margin: 0.5em 1em 0 0;
				color:#333;
				text-shadow: 1px 1px 0 #111;
				display: block;
				cursor: pointer;
			}
			#zoneJeu &gt; button{
				float: right;
			}

			.erreur{
				background-color: #FCC;
			}
			.compteBon{
				color:#393 !important;
			}
		&lt;/style&gt;
	&lt;/head&gt;
	&lt;body&gt;
		&lt;section class=&quot;info&quot; id=&quot;zoneJeu&quot; style=&quot;display:none;&quot;&gt;
			&lt;button onclick=&quot;initialisation()&quot;&gt;Rejouer&lt;/button&gt;
			&lt;output id=&quot;jeuCible&quot;&gt;&lt;/output&gt;
			&lt;output id=&quot;jeuTemps&quot;&gt;&lt;/output&gt;
			&lt;section id=&quot;zonePlaque&quot;&gt;&lt;/section&gt;
		&lt;/section&gt;
		&lt;section class=&quot;info&quot; id=&quot;zoneParametres&quot;&gt;
			&lt;label&gt;Nombre de plaques : &lt;input type=&quot;number&quot; min=&quot;2&quot; value=&quot;6&quot; id=&quot;regleNbPlaques&quot;/&gt;&lt;/label&gt;
			&lt;label&gt;Temps de jeu : &lt;input type=&quot;number&quot; min=&quot;1&quot; value=&quot;45&quot; id=&quot;regleTemps&quot;/&gt; secondes&lt;/label&gt;
			&lt;br/&gt;
			&lt;button onclick=&quot;initialisation()&quot;&gt;Commencer une partie&lt;/button&gt;
		&lt;/section&gt;
		&lt;fieldset id=&quot;zoneResultat&quot;&gt;
			&lt;legend&gt;Résultat&lt;/legend&gt;
			&lt;section id=&quot;zoneCalcul&quot;&gt;&lt;/section&gt;
			&lt;aside id=&quot;resultatIA&quot;&gt;&lt;/aside&gt;
			&lt;input type=&quot;text&quot; id=&quot;entreeFormule&quot; title=&quot;Entrez ici vos formules de calculs&quot; placeholder=&quot;Entrez les calculs ici&quot; /&gt;
			&lt;output id=&quot;jeuDistance&quot;&gt;&lt;/output&gt;
		&lt;/fieldset&gt;

		&lt;script src=&quot;jeu.js&quot;&gt;&lt;/script&gt;
	&lt;/body&gt;
&lt;/html&gt;</code></pre><pre id="r-412456" data-claire-element-id="412456"><code data-claire-semantic="javascript">/*
  Références globales aux éléments HTML fréquemment utilisés
*/

var regleTemps = document.getElementById(&quot;regleTemps&quot;); //élément indiquant le temps total de réflexion
var jeuTemps = document.getElementById(&quot;jeuTemps&quot;); //élément indiquant le temps restant pour jouer
var jeuCible = document.getElementById(&quot;jeuCible&quot;); //élément indiquant le nombre à trouver

var listeNombre = []; //liste des nombres utilisables par l'utilisateur

//paramétrage par défaut
document.getElementById(&quot;regleNbPlaques&quot;).value=6;
regleTemps.value=45;



// initialisation d'une nouvelle partie
function initialisation(){
	if(solutionWorker){
		//pour éviter de calculer la solution d'une autre partie
		solutionWorker.terminate();
		solutionWorker = createWorker();
	}

	//cache les paramètres de règles
	document.getElementById(&quot;zoneParametres&quot;).style.display = &quot;none&quot;;

	//préparation de la zone de jeu
	document.getElementById(&quot;zoneResultat&quot;).style.display = &quot;block&quot;;
	document.getElementById(&quot;zoneJeu&quot;).style.display = &quot;block&quot;;
	jeuCible.value = &quot;???&quot;;
	jeuTemps.value = regleTemps.value;

	document.getElementById(&quot;zonePlaque&quot;).innerHTML = &quot;&quot;;
	document.getElementById(&quot;resultatIA&quot;).innerHTML = &quot;&quot;;
	document.getElementById(&quot;zoneCalcul&quot;).innerHTML = &quot;&quot;;

	//initialisation des nombres
	listeNombre = [];
	generateNombre();

	//gestion de l'input servant à entrer un calcul
	var inputFormule = document.getElementById(&quot;entreeFormule&quot;);
	inputFormule.style.display = &quot;&quot;;
	inputFormule.value = &quot;&quot;;
	inputFormule.addEventListener(&quot;blur&quot;,restoreFocus,false);
	inputFormule.addEventListener(&quot;keypress&quot;,analyseFormule,false);
	inputFormule.addEventListener(&quot;blur&quot;,analyseFormule,false);
	inputFormule.focus();
}

//gestion du chronometre
var chronometre=(function(){
	var init,timer=-1;
	function chrono(){
		var temps = (Date.now() - init)/1000; //temps écoulé depuis le début du jeu
		jeuTemps.value = Math.round(regleTemps.value - temps);
		if(temps&gt;regleTemps.value){
			//le temps est écoulé
			clearInterval(timer);

			//On retire le formulaire
			var inputFormule = document.getElementById(&quot;entreeFormule&quot;);
			inputFormule.style.display = &quot;none&quot;;
			inputFormule.removeEventListener(&quot;blur&quot;,restoreFocus,false);
			inputFormule.removeEventListener(&quot;keypress&quot;,analyseFormule,false);
			inputFormule.removeEventListener(&quot;blur&quot;,analyseFormule,false);

			//on affiche l'analyse de l'ordinateur
			analyseIA();
		}
	}

	return function(){
		//démarrage du chronomètre
		init = Date.now();
		clearInterval(timer);
		timer = setInterval(chrono,400);
	};
})();

//permet de rechercher une solution et de l'afficher
function analyseIA(){
	if(solutionWorker){
		//les workers sont utilisés
		if(solutionWorker.resultat){
			//le résultat a déjà été trouvé
			affichageIA(solutionWorker.resultat);
		}else{
			//le résultat n'a pas encore été trouvé
			solutionWorker.resultat = -1;
			document.getElementById(&quot;resultatIA&quot;).textContent = &quot;recherche en cours...&quot;; //on avertit l'utilisateur
		}
	}else{
		//Le worker n'est pas utilisé ainsi on lance la recherche de solutions 
		var liste = [];
		listeNombre.forEach(function(el){
			if(!el.parent1) liste.push(el.valeur);
		}); //récupération des nombres de départ
		affichageIA(chercheSolution(liste,jeuCible.value));
	}

}

//affiche le résultat trouvé par l'ordinateur
function affichageIA(resultat){
	var explication = resultat[1].replace(/\n/g,&quot;&lt;br&gt;&quot;);
	if(resultat[0]&gt;0){
		explication += &quot;&lt;div&gt;Compte approchant : &quot; + resultat[0] + &quot;&lt;/div&gt;&quot;;
	}else{
		explication += &quot;&lt;div&gt;Le compte est bon !&lt;/div&gt;&quot;;
	}
	document.getElementById(&quot;resultatIA&quot;).innerHTML = explication;
}

//permet de générer les nombres pour jouer et définit la cible
function generateNombre(){
	var choix = [1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,25,50,75,100]; //plaques possibles
	var nbPlaque = parseInt(document.getElementById(&quot;regleNbPlaques&quot;).value,10);
	if(listeNombre.length &lt; nbPlaque){
		listeNombre.push(new Nombre(null,null,null,choix[Math.floor(Math.random()*choix.length)]));
		setTimeout(generateNombre,500);
	}else{
		jeuCible.value = Math.floor(Math.random()*898)+101; //le nombre à trouver doit être compris entre 101 et 999		
		if(solutionWorker){
			//on utilise un worker pour trouver la solution
			var liste = &quot;&quot;;
			listeNombre.forEach(function(el){liste += el.valeur+&quot;,&quot;;}); //on prépare la liste des nombres
			liste += jeuCible.value; //on ajoute la cible à la fin de la liste
			solutionWorker.postMessage(liste); //on envoit la liste pour démarrer la recherche
			solutionWorker.resultat = null; //on réinitialise la propriété resultat
		}
		chronometre(); //on démarre le compte à rebours
	}
}

//permet de redonner le focus à l'input quand il le perd
function restoreFocus(event){
	setTimeout(function(){event.target.focus();},20);
}

//permet d'analyser l'entrée de l'utilisateur
function analyseFormule(event){
	var key = event.keyCode || event.which;
	if(key === undefined || key === 13 || key === 61 || key === 9){ //demande de valider l'opération

		var operation = this.value.match(/(\d+)\s*([-+*_\\/÷&amp;xX×])\s*(\d+)/); // permet de vérifier que l'opération contient un nombre, un opérateur, et un nombre
		if(operation){
			var n1 = getNombre(operation[1]),
			    n2 = getNombre(operation[3],n1);

			//analyse de l'opérateur utilisé
			switch(operation[2]){
				case &quot;&amp;&quot;:
				case &quot;+&quot;:
					operation = &quot;+&quot;;
				break;
				case &quot;_&quot;:
				case &quot;-&quot;:
					operation = &quot;-&quot;;
				break;
				case &quot;*&quot;:
				case &quot;x&quot;:
				case &quot;X&quot;:
				case &quot;×&quot;:
					operation = &quot;×&quot;;
				break;
				case &quot;/&quot;:
				case &quot;\\&quot;:
				case &quot;÷&quot;:
					operation = &quot;÷&quot;;
				break;
				default:
					operation = null;
			}
		}
		if(operation &amp;&amp; n1 &amp;&amp; n2){
			//toutes les composantes sont correctes, on peut créer le Nombre
			var n = new Nombre(n1,n2,operation);
			if(n.valeur){ // si n.valeur vaut 0, c'est que l'opération ne respecte pas les règles
				listeNombre.push(n);
				this.value = &quot;&quot;;
				majDistance();
			}
		}else{
			this.className = &quot;erreur&quot;;
		}
	}else{
		this.className = &quot;&quot;; // au cas où l'état précédent était en &quot;erreur&quot;
	}
}

//permet de trouver un objet Nombre parmi ceux disponibles qui possède la valeur recherchée
// valeur : valeur à chercher
// except : continue la recherche si l'objet trouvé est celui indiqué par except
function getNombre(valeur, except){
	function filtre(el){
		//on ne veut que les objets non utilisés et ayant la bonne valeur
		return !el.usedBy &amp;&amp; el.valeur == valeur &amp;&amp; el !== except;
	}
	var liste = listeNombre.filter(filtre); //récupère la liste de tous les objets correspondant aux critères
	return liste[0]; //seul le premier objet est retourné
}

//met à jour la distance entre les nombres trouvés et la cible
function majDistance(){
	var distance = Infinity;
	var cible = jeuCible.value;
	listeNombre.forEach(function(el){
		distance = Math.min(distance,Math.abs(el.valeur-cible));
	});
	var jeuDistance = document.getElementById(&quot;jeuDistance&quot;);
	if(distance){
		jeuDistance.value = &quot;Compte approchant : &quot; + distance;
	}else{
		jeuDistance.value = &quot;Le compte est bon !&quot;;
	}
}

//création et affichage d'une plaque
function creationPlaque(nb){
	var plaque = document.createElement(&quot;div&quot;);
	plaque.textContent = nb;
	plaque.addEventListener(&quot;click&quot;,ajouteValeur,false);
	document.getElementById(&quot;zonePlaque&quot;).appendChild(plaque);
	return plaque;
}

//permet d'ajouter la valeur d'une plaque à la formule de calcul
function ajouteValeur(event){
	document.getElementById(&quot;entreeFormule&quot;).value += event.target.textContent;
}


//Nombre est un objet représentant les nombres manipulés par l'utilisateur
//Il permet de savoir quel nombre a permis de réaliser une opération. Ce qui facilite le retour en arrière pour supprimer une opération
function Nombre(parent1,parent2,op,init){
	this.parent1 = parent1; //le premier nombre de l'opération
	this.parent2 = parent2; //le deuxième nombre de l'opération
	this.operateur = op; //l'opérateur de l'opération
	this.usedBy = null; //autre opération qui utilise ce nombre

	if(init){
		this.valeur = init;
		creationPlaque(init);
	}else{
		//réalisation du calcul
		switch(op){
			case &quot;+&quot;:
				this.valeur = parent1.valeur + parent2.valeur;
			break;
			case &quot;-&quot;:
				this.valeur = parent1.valeur - parent2.valeur;
			break;
			case &quot;×&quot;:
				this.valeur = parent1.valeur * parent2.valeur;
			break;
			case &quot;÷&quot;:
				this.valeur = parent1.valeur / parent2.valeur;
			break;
		}
		//vérification du calcul
		if(this.valeur &lt; 0 || this.valeur !== Math.round(this.valeur)){
			this.valeur = 0;
			return null;
		}
		this.parent1.utilise(this);
		this.parent2.utilise(this);
		this.createCalcul();
	}
}

//affichage du calcul correspondant à ce nombre
Nombre.prototype.createCalcul = function(){
	this.refCalcul = document.createElement(&quot;div&quot;);
	this.refCalcul.textContent = this.parent1.valeur + &quot; &quot; + this.operateur + &quot; &quot; + this.parent2.valeur + &quot; = &quot; + this.valeur;
	if(this.valeur == jeuCible.value){
		this.refCalcul.className = &quot;compteBon&quot;;
	}else{
		var that = this;
		this.refCalcul.addEventListener(&quot;click&quot;,function(){that.supprime();},false);
	}
	document.getElementById(&quot;zoneCalcul&quot;).appendChild(this.refCalcul);
};

//définit l'utilisation de ce nombre dans un opération
Nombre.prototype.utilise = function(parent){
	this.usedBy = parent;
};

//définit le fait que ce nombre n'est plus utilisé dans une opération
Nombre.prototype.libre = function(){
	this.usedBy = null;
};

//suppression de ce nombre et donc de l'opération
Nombre.prototype.supprime = function(){
	if(this.usedBy){
		this.usedBy.supprime();
	}
	if(this.parent1){
		this.parent1.libre();
	}
	if(this.parent2){
		this.parent2.libre();
	}
	this.refCalcul.parentNode.removeChild(this.refCalcul);
	listeNombre.splice(listeNombre.indexOf(this),1);
};

//permet d'analyser la réponse du worker
function reponseWorker(event){
	var reponse = event.data.split(&quot;|&quot;);
	console.log(reponse[2]/1000);
	if(solutionWorker.resultat === -1){
		//il faut afficher le resultat tout de suite
		affichageIA(reponse);
	}else{
		//on garde la réponse au chaud
		solutionWorker.resultat = reponse;
	}
}

//création d'un worker
function createWorker(){
	var w = new Worker(&quot;./solution.js&quot;);
	w.addEventListener(&quot;message&quot;,reponseWorker,false);
	return w;
}

if(window.Worker){
	//le navigateur supporte les workers
	var solutionWorker = createWorker();
}else{
	//le navigateur ne supporte pas les Workers, on charge le fichier dynamiquement
	(function(){//pour éviter de polluer l'espace globale
		var script = document.createElement(&quot;script&quot;);
		script.src=&quot;./solution.js&quot;;
		document.body.appendChild(script);
	})();
}</code></pre><pre id="r-412457" data-claire-element-id="412457"><code data-claire-semantic="javascript">//fichier utilisé par le worker

//recherche une solution
function chercheSolution(nombres,cible){ //il s'agit d'une fonction récursive
	var nb1,nb2; //nombres utilisés pour étudier une opération
	var i,j; //index itératifs
	var li = nombres.length; //taille de la liste des nombres parmi lesquels il faut chercher le premier nombre de l'opération
	var lj = li - 1; //taille de la liste des nombres moins nb1 parmi lesquels le deuxième nombre de l'opération est recherché
	var calcul; //résultat de l'opération en cours
	var rslt; //résultat d'une recherche avec moins de nombres
	var distance = Infinity; //distance de la solution actuelle par rapport à la cible
	var solution = &quot;&quot;; //meilleure solution actuelle

	var nombresSansNb1; //liste de nombre sans le premier nombre de l'opération (nb1)
	var nombresSansNb2; //liste de nombre sans les nombres de l'opération (nb1 et nb2)

	for(i=0; i&lt;li &amp;&amp; distance; i++){
		nb1 = nombres[i]; //analyse avec ce premier nombre
		nombresSansNb1 = nombres.concat([]); //copie de la liste
		nombresSansNb1.splice(i,1); //on retire le nombre de la liste

		for(j=0; j&lt;lj; j++){
			nb2 = nombresSansNb1[j]; //analyse avec ce deuxième nombre
			nombresSansNb2 = nombresSansNb1.concat([]); //copie de la liste
			nombresSansNb2.splice(j,1); //on retire le nombre de la liste

			//calcul ×
			calcul = nb1 * nb2;
			if(Math.abs(cible - calcul)&lt;distance){
				distance = Math.abs(cible - calcul);
				solution = nb1 +&quot; × &quot; + nb2 + &quot; = &quot; + calcul;
				if(!distance) break; //on a trouvé une solution on arrête la boucle
			}
			rslt = chercheSolution(nombresSansNb2.concat([calcul]),cible); // on relance la recherche avec les nombres restant + ce résultat
			if(rslt[0]&lt;distance){
				distance = rslt[0];
				solution = nb1 +&quot; × &quot; + nb2 + &quot; = &quot; + calcul + &quot;\n&quot; + rslt[1];
				if(!distance) break; //on a trouvé une solution on arrête la boucle
			}

			//calcul +
			calcul = nb1 + nb2;
			if(Math.abs(cible - calcul)&lt;distance){
				distance = Math.abs(cible - calcul);
				solution = nb1 +&quot; + &quot; + nb2 + &quot; = &quot; + calcul;
				if(!distance) break; //on a trouvé une solution on arrête la boucle
			}
			rslt = chercheSolution(nombresSansNb2.concat([calcul]),cible); // on relance la recherche avec les nombres restant + ce résultat
			if(rslt[0]&lt;distance){
				distance = rslt[0];
				solution = nb1 +&quot; + &quot; + nb2 + &quot; = &quot; + calcul + &quot;\n&quot; + rslt[1];
				if(!distance) break; //on a trouvé une solution on arrête la boucle
			}

			//calcul -
			calcul = nb1 - nb2;
			if(calcul&gt;0){
				if(Math.abs(cible - calcul)&lt;distance){
					distance = Math.abs(cible - calcul);
					solution = nb1 +&quot; - &quot; + nb2 + &quot; = &quot; + calcul;
					if(!distance) break; //on a trouvé une solution on arrête la boucle
				}
				rslt = chercheSolution(nombresSansNb2.concat([calcul]),cible); // on relance la recherche avec les nombres restant + ce résultat
				if(rslt[0]&lt;distance){
					distance = rslt[0];
					solution = nb1 +&quot; - &quot; + nb2 + &quot; = &quot; + calcul + &quot;\n&quot; + rslt[1];
					if(!distance) break; //on a trouvé une solution on arrête la boucle
				}
			}

			//calcul ÷
			calcul = nb1 / nb2;
			if(calcul === Math.floor(calcul)){
				if(Math.abs(cible - calcul)&lt;distance){
					distance = Math.abs(cible - calcul);
					solution = nb1 +&quot; ÷ &quot; + nb2 + &quot; = &quot; + calcul;
					if(!distance) break; //on a trouvé une solution on arrête la boucle
				}
				rslt = chercheSolution(nombresSansNb2.concat([calcul]),cible); // on relance la recherche avec les nombres restant + ce résultat
				if(rslt[0]&lt;distance){
					distance = rslt[0];
					solution = nb1 +&quot; ÷ &quot; + nb2 + &quot; = &quot; + calcul + &quot;\n&quot; + rslt[1];
					if(!distance) break; //on a trouvé une solution on arrête la boucle
				}
			}

		}
	}

	return [distance,solution];
}

//listener qui permet de contrôler le worker
onmessage = function(event){
	var d = Date.now();
	var nombres = event.data.split(&quot;,&quot;); //on récupère la liste des nombres
	var cible = parseInt(nombres.pop(),10); //on récupère la cible
	nombres = nombres.map(function(v){return parseInt(v,10);}); // conversion de toutes les valeurs en nombre
	var resultat = chercheSolution(nombres,cible); //on effectue le calcul
	resultat.push(Date.now() - d);
	postMessage(resultat.join(&quot;|&quot;)); //on renvoie la solution
};</code></pre></div><p id="r-412459" data-claire-element-id="412459"><a href="http://restimel.github.com/Tutoriels/webWorkers/TP_chiffres/worker/index.html">Essayer le jeu avec un worker !</a></p><p id="r-412460" data-claire-element-id="412460">Et voilà, vous avez vu comment intégrer un worker dans un projet existant :)</p><p id="r-412461" data-claire-element-id="412461">Maintenant que vous avez assimilé les bases, vous allez pouvoir étudier les workers plus en profondeur.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
<span class="arrow"></span>
<span class="next">Présentation de l&#039;exercice</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">
<span class="next">Tout est communication</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Toutestcommunication"></a><h2>Tout est communication</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
<span class="arrow"></span>
<span class="next">Correction</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
<span class="next">Le canal de communication</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-412467" data-claire-element-id="412467">Maintenant que vous savez manipuler les workers, nous allons regarder tous les détails qui tournent autour. Vous allez bientôt tout savoir. Absolument tout ! ou presque…</p><p id="r-412468" data-claire-element-id="412468">Comme les workers n'ont qu'un accès restreint au monde extérieur, et afin qu'ils puissent fournir le résultat de leur dur labeur, il faut bien qu'ils transmettent leurs informations correctement aux autres threads. La communication avec les autres threads est donc un élément essentiel du fonctionnement des workers.<br/> Cela ne vous surprendra donc pas si je clame que <strong>tout est communication</strong> ; et que je dédie tout un chapitre à ce sujet.</p><p id="r-412469" data-claire-element-id="412469">Nous allons étudier ici comment créer des canaux de communications et comment les manipuler. Nous verrons ensuite des détails qui ont été passés sous silence pendant la prise en main. Et enfin on verra une méthode pour arrêter une communication sans arrêter le worker.</p>
</div><a name="Lecanaldecommunication"></a><h2>Le canal de communication</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">
<span class="arrow"></span>
<span class="next">Tout est communication</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
<span class="next">Mieux communiquer</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-le-canal-de-communication" data-claire-element-id="412518">Le canal de communication</h4><p id="r-412470" data-claire-element-id="412470">Un canal de communication est ce qui permet de gérer la communication entre les éléments qui communiquent. Autant dire que, dans notre cas, c'est très important.</p><h5 id="r-messagechannel" data-claire-element-id="412517">MessageChannel</h5><p id="r-412471" data-claire-element-id="412471">Depuis le début je vous parle des web-workers, mais je vous ai fait manipuler, sans vous le dire, un deuxième objet issu des API HTML5 : les <strong>message-channels</strong> (ou, en français, les canaux de communications).</p><p id="r-412472" data-claire-element-id="412472">Avec les shared-workers, je vous ai parlé des ports. Un port est toujours attaché à un autre port. Ces deux objets sont liés. Si on envoie un message à un de ces objets, l'autre le reçoit. Ainsi lorsque ces deux ports appartiennent à deux threads distincts, il suffit qu'un thread envoie un message à travers son port pour que l'autre thread puisse le récupérer. Il s'agit de la base de la communication entre les threads.<br/> Et bien <strong>le canal de communication correspond au lien entre ces deux ports</strong>.</p><p id="r-412473" data-claire-element-id="412473">Lorsque vous créez un worker, l'interpréteur se charge de créer en même temps deux ports liés et les place chacun dans un thread différent. Ce qui nous permet de communiquer facilement entre ces threads. Mais grâce à l'objet <code data-claire-semantic="javascript">MessageChannel</code>, vous pouvez créer explicitement deux ports liés entre eux, et vous pourrez en faire ce que vous voulez.</p><p id="r-412474" data-claire-element-id="412474">L'objet <code data-claire-semantic="javascript">MessageChannel</code> créé possède deux objets : <code data-claire-semantic="javascript"><strong>port1</strong></code> et <code data-claire-semantic="javascript"><strong>port2</strong></code>. Comme leurs noms l'indiquent il s'agit de ports. Et, vous l'aurez deviné, ces deux ports sont liés.</p><pre id="r-412475" data-claire-element-id="412475"><code data-claire-semantic="javascript">var channel = new MessageChannel(); //on a créé un canal de communication entre channel.port1 et channel.port2

channel.port1.onmessage=function(e){ //on écoute sur le port1
	alert(e.data);
};

channel.port2.postMessage(&quot;Bonjour&quot;); //on envoie un message dans le port2</code></pre><p id="r-412476" data-claire-element-id="412476"><a href="http://restimel.github.com/Tutoriels/webWorkers/channel1/index.html">Essayer !</a></p><p id="r-412477" data-claire-element-id="412477">Vous pouvez remarquer que le message du <code data-claire-semantic="javascript">port2</code> a bien été reçu par le <code data-claire-semantic="javascript">port1</code>.</p><div id="r-412479" data-claire-element-id="412479" data-claire-semantic="question"><p id="r-412478" data-claire-element-id="412478">C'est bien tout ça, mais c'est un peu parler à soi-même. C'est rarement très utile …<br/> Ne pourrait-on pas, au moins, envoyer ce port à un autre thread ?</p></div><h6 id="r-transferer-des-objets" data-claire-element-id="412516">Transférer des objets</h6><p id="r-412480" data-claire-element-id="412480">Et bien oui on va transférer un port à un autre thread. Pour cela on va utiliser le deuxième argument de <code data-claire-semantic="javascript">postMessage</code>. Cet argument permet d'envoyer une liste d'objets transférables. Pour tout vous dire, actuellement, il n'existe qu'un seul type d'objet transférable : les ports (ou plus exactement les <code data-claire-semantic="javascript">MessagePort</code>).</p><p id="r-412481" data-claire-element-id="412481">Donc l'envoi est simple :</p><pre id="r-412482" data-claire-element-id="412482"><code data-claire-semantic="javascript">//création du canal de communication
var channel = new MessageChannel();
channel.port1.onmessage = function(e){
	alert(e.data);
};

//création du worker
var w = new Worker(&quot;worker.js&quot;);
w.onmessage = function(e){
	alert(&quot;Je ne veux pas recevoir de message par ce canal&quot;);
};
 
//transfert du port2 vers le thread
w.postMessage(&quot;Voici le port2&quot;,[channel.port2]);</code></pre><p id="r-412483" data-claire-element-id="412483">Il faut bien retenir que le transfert est une liste, il ne faut donc pas oublier les <code data-claire-semantic="javascript"><strong>[]</strong></code>. Cela signifie qu'il est possible de transférer plusieurs ports en même temps !</p><p id="r-412484" data-claire-element-id="412484">C'est bien, on a pu envoyer un port. Ça serait bien de le récupérer maintenant ! Pour cela on va lire l'attribut <code data-claire-semantic="javascript"><strong>ports</strong></code> de l'événement <code data-claire-semantic="javascript">onmessage</code>. Et comme on a envoyé une liste d'objets, nous allons récupérer son premier élément avec <code data-claire-semantic="javascript">[0]</code>. Cela ne vous rappelle rien ?<br/> C'est exactement de cette manière qu'on a récupéré le port dans le shared-worker lors de sa connexion !</p><p id="r-412485" data-claire-element-id="412485">Voici donc le code de notre worker :</p><pre id="r-412486" data-claire-element-id="412486"><code data-claire-semantic="javascript">self.onmessage = function(e){
	var port = e.ports[0];
	port.postMessage(&quot;Hello canal&quot;);
}</code></pre><p id="r-412487" data-claire-element-id="412487"><a href="http://restimel.github.com/Tutoriels/webWorkers/channel2/index.html">Essayer !</a></p><p id="r-412488" data-claire-element-id="412488">Maintenant si vous testez ces deux codes, vous devriez obtenir le message &quot;Hello canal&quot; qui a été envoyé par le canal que vous avez créé et non pas par celui du worker !</p><div id="r-412490" data-claire-element-id="412490" data-claire-semantic="question"><p id="r-412489" data-claire-element-id="412489">Avez-vous essayé de faire <code data-claire-semantic="javascript">channel.port2.postMessage(&quot;test&quot;);</code> après la ligne 14 dans le premier code ?</p></div><p id="r-412491" data-claire-element-id="412491">Vous obtenez un message d'erreur o_O <br/> Alors qu'il fonctionne très bien si vous le placez avant la ligne 14 ! Que s'est-il passé ?</p><p id="r-412492" data-claire-element-id="412492">C'est parce que votre port a été transféré, il n'est donc plus disponible dans votre premier thread. C'est pourquoi depuis le début de cette section, je vous parle de transfert et d'objet transférable.<br/> En réalité, pour éviter le <em>cross-site scripting</em> (exécution de script provenant d'un autre site) et pour rester dans le modèle de séparation des données. Le port a été copié, le lien a été transféré à la copie, puis l'objet original a été supprimé. Ainsi si vous ajoutez des attributs ou définissez des listeners, ils ne seront pas transmis.</p><aside id="r-412494" data-claire-element-id="412494" data-claire-semantic="warning"><p id="r-412493" data-claire-element-id="412493">N'oubliez pas qu'on écoute sur des ports. Donc si vous utilisez <code data-claire-semantic="javascript">addEventListener</code>, vous devez d'abord utiliser <code data-claire-semantic="javascript"><strong>start()</strong></code> pour recevoir la communication.</p></aside><p id="r-412495" data-claire-element-id="412495">C'est bien beau tout ça, mais communiquer avec le worker, on pouvait déjà le faire !<br/> Oui mais parfois il est pratique d'avoir plusieurs points d'entrée. Mais sinon, avec les shared-workers, nous avons plusieurs interlocuteurs en même temps. Grâce au <code data-claire-semantic="javascript">MessageChannel</code>, nous pouvons désormais faire communiquer deux pages ensemble sans interlocuteur intermédiaire !</p><table id="r-412511" data-claire-element-id="412511"><thead id="r-412501" data-claire-element-id="412501"><tr id="r-412500" data-claire-element-id="412500"><th id="r-412497" data-claire-element-id="412497"><p id="r-412496" data-claire-element-id="412496">main.js</p></th><th id="r-412499" data-claire-element-id="412499"><p id="r-412498" data-claire-element-id="412498">workers.js</p></th></tr></thead><tbody id="r-412510" data-claire-element-id="412510"><tr id="r-412506" data-claire-element-id="412506"><td id="r-412503" data-claire-element-id="412503"><pre id="r-412502" data-claire-element-id="412502"><code data-claire-semantic="javascript">//création d'une zone d'échange
var input = document.createElement(&quot;input&quot;);
input.disabled = true;
input.onchange = function(){
  port.postMessage(this.value);
  this.value = &quot;&quot;;
};
document.body.appendChild(input);

//création d'une zone d'affichage
var output = document.createElement(&quot;output&quot;);
output.value = &quot;En attente d'un interlocuteur&quot;;
document.body.appendChild(output);


var port;

//création du worker
var w = new SharedWorker(&quot;worker.js&quot;);
w.port.onmessage = function(e){
  if(e.ports &amp;&amp; e.ports.length){
    input.disabled = false;
    output.value = &quot;&quot;;

    port = e.ports[0];

    port.onmessage = function(e){
        output.value = e.data;
    };

    w.terminate();
  }
};</code></pre></td><td id="r-412505" data-claire-element-id="412505"><pre id="r-412504" data-claire-element-id="412504"><code data-claire-semantic="javascript">var port = null;

//gestion des connections
onconnect = function(e){
  var port2 = e.ports[0];

  if(!port){
//première connexion

    port = port2;

  }else{
//un autre thread est déjà connecté

    var ch = new MessageChannel();

    port.postMessage(&quot;&quot;, [ch.port1]);
    port2.postMessage(&quot;&quot;, [ch.port2]);

    port = null;
  }
};</code></pre></td></tr><tr id="r-412509" data-claire-element-id="412509"><td id="r-412508" data-claire-element-id="412508"><p id="r-412507" data-claire-element-id="412507"><a href="http://restimel.github.com/Tutoriels/webWorkers/channel3/index.html">Essayer !</a></p></td></tr></tbody></table><p id="r-412512" data-claire-element-id="412512">Avec ces codes nous pouvons créer un mini-chat entre deux pages. Vous pouvez remarquer qu'à la ligne 31 on arrête le worker. Donc une fois le port reçu, le worker est tué. Et pourtant la communication fonctionne toujours. Car le canal de communication vit désormais entre les deux pages et non plus via le worker.<br/> Malheureusement comme le javascript fonctionne côté client (le navigateur), il n'est pas possible de réaliser un chat entre différents utilisateurs de cette manière. :(</p><div id="r-412514" data-claire-element-id="412514" data-claire-semantic="question"><p id="r-412513" data-claire-element-id="412513">Tous les ports sont-ils transférables ?</p></div><p id="r-412515" data-claire-element-id="412515">Non ! Vous ne pouvez pas transférer le port source ou le port de destination dans son propre canal. Et dans une liste de ports vous ne devez pas mettre un port en double. Sinon la diffusion ne se fera pas.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">
<span class="arrow"></span>
<span class="next">Tout est communication</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
<span class="next">Mieux communiquer</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Mieuxcommuniquer"></a><h2>Mieux communiquer</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
<span class="arrow"></span>
<span class="next">Le canal de communication</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
<span class="next">Terminer une communication</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-mieux-communiquer" data-claire-element-id="412550">Mieux communiquer</h4><h5 id="r-en-savoir-plus-sur-celui-qui-nous-parle" data-claire-element-id="412531">En savoir plus sur celui qui nous parle</h5><p id="r-412519" data-claire-element-id="412519">Quelques détails qui peuvent parfois s'avérer utiles. Lorsqu'un listener de type <code data-claire-semantic="javascript">onmessage</code> se déclenche, un événement est créé. À partir de cet événement, on obtient de nombreuses informations :</p><ul id="r-412530" data-claire-element-id="412530"><li id="r-412521" data-claire-element-id="412521"><p id="r-412520" data-claire-element-id="412520"><code data-claire-semantic="javascript">event.data</code> : On l'a vu plusieurs fois, il permet de récupérer les données.</p></li><li id="r-412523" data-claire-element-id="412523"><p id="r-412522" data-claire-element-id="412522"><code data-claire-semantic="javascript">event.ports</code> : On vient juste de le voir, il permet d'obtenir la liste des objets transférés.</p></li><li id="r-412525" data-claire-element-id="412525"><p id="r-412524" data-claire-element-id="412524"><code data-claire-semantic="javascript">event.target</code> : Il s'agit du port ayant reçu le message. Donc si vous voulez répondre, il suffit d'utiliser cet attribut pour répondre au bon interlocuteur. Dans le cadre des dedicated-workers, il est équivalent à <code data-claire-semantic="javascript">self</code>.<br/> Vous pouvez aussi trouver les attributs <code data-claire-semantic="javascript">currentTarget</code>, <code data-claire-semantic="javascript">srcElement</code> et parfois <code data-claire-semantic="javascript">source</code> qui sont équivalents à celui-ci (mais ils sont plus imprévisibles en fonction des navigateurs).</p></li><li id="r-412527" data-claire-element-id="412527"><p id="r-412526" data-claire-element-id="412526"><code data-claire-semantic="javascript">event.origin</code> : Ce champ nous renseigne sur l'identité de celui qui a envoyé le message. Il s'agit de l'URL de la page appelante. Il n'est pas forcément très utile dans le cadre des web-workers, mais peut s'avérer utile pour vérifier l'origine de l'interlocuteur (et éviter de parler avec des inconnus).</p></li><li id="r-412529" data-claire-element-id="412529"><p id="r-412528" data-claire-element-id="412528"><code data-claire-semantic="javascript">event.type</code> : Il vaut &quot;message&quot; c'est le type de l'événement ;) .</p></li></ul><h5 id="r-communiquer-avec-des-objets" data-claire-element-id="412549">Communiquer avec des objets</h5><p id="r-412532" data-claire-element-id="412532">Vous avez peut-être remarqué que tous les messages qui ont été envoyés n'étaient que du texte. À un moment vous voudrez forcément transmettre un objet.</p><h6 id="r-le-json-2" data-claire-element-id="412539">Le JSON</h6><p id="r-412533" data-claire-element-id="412533">La première idée qu'on peut avoir est d'utiliser le JSON.<br/> JSON permet de convertir un objet en une chaîne de caractères. Il suffit de transformer l'objet en chaîne de caractères avant de l'envoyer, puis de le retransformer en objet à l'arrivée.</p><pre id="r-412534" data-claire-element-id="412534"><code data-claire-semantic="javascript">var message=JSON.stringify(obj); //on sérialise l'objet
var nvlObj=JSON.parse(message); //on décode le message pour reconstruire l'objet</code></pre><p id="r-412535" data-claire-element-id="412535">Le JSON n'est pas l'objectif de ce tutoriel, je ne vais donc pas détailler son fonctionnement davantage.</p><p id="r-412536" data-claire-element-id="412536">Toutefois le JSON a ses limites.<br/> Premièrement tous les types des objets sont perdus. Ils deviennent de simples objets, même pour les objets &quot;fondamentaux&quot; tels que les objets <code data-claire-semantic="javascript">Date</code>.<br/> Ensuite le JSON n'aime pas du tout les références circulaires.</p><pre id="r-412537" data-claire-element-id="412537"><code data-claire-semantic="javascript">var obj1 = {};
var obj2 = {};

obj1.frere = obj2;
obj2.frere = obj1;

var pere = {enfant:[obj1,obj2]};</code></pre><p id="r-412538" data-claire-element-id="412538">Dans ce code, il n'est pas possible de &quot;stringifier&quot; l'objet <code data-claire-semantic="javascript">pere</code> avec JSON, à cause de la référence circulaire entre <code data-claire-semantic="javascript">obj1</code> et <code data-claire-semantic="javascript">obj2</code>.</p><h6 id="r-envoyer-des-objets-javascript" data-claire-element-id="412548">Envoyer des objets javascript</h6><p id="r-412540" data-claire-element-id="412540">Heureusement il est tout à fait possible d'envoyer des objets javascript à travers nos canaux de communications.<br/> Cependant il faut faire attention, car tous les objets ne sont pas acceptés. Seuls ceux qui sont clonables peuvent être envoyés (les structured clone). Les objets clonables correspondent aux variables primitives (nombres, chaînes de caractères, booléens…), les Arrays et les objets contenant des attributs clonable.<br/> Ainsi l'objet <code data-claire-semantic="javascript">{msg:&quot;message&quot;,nb:10, liste:[{txt:&quot;texte&quot;},false]}</code> sera accepté mais l'objet <code data-claire-semantic="javascript">{a:10,fct:function(){return this.a;}}</code> sera refusé car les fonctions ne sont pas clonables.</p><aside id="r-412542" data-claire-element-id="412542" data-claire-semantic="information"><p id="r-412541" data-claire-element-id="412541">Contrairement aux objets transférés, un objet cloné reste disponible dans le thread d'origine.</p></aside><p id="r-412543" data-claire-element-id="412543">Le premier avantage de cloner des objets est que le type des objets &quot;fondamentaux&quot; est conservé.<br/> Par exemple si une des références est un objet de type <code data-claire-semantic="javascript">Array</code>, <code data-claire-semantic="javascript">Date</code>, <code data-claire-semantic="javascript">RegExp</code>, ImageData, File, FileList, ou Blob, leurs références et leur type seront conservés.<br/> Par contre si vous clonez un objet que vous avez créé à partir d'un constructeur &quot;maison&quot;, il perd son type et ses prototypes.</p><p id="r-412544" data-claire-element-id="412544">Le deuxième gros avantage est qu'il est tout à fait possible de cloner des objets ayant des références circulaires. Ainsi dans l'exemple précédent, il est tout à fait possible de cloner l'objet <code data-claire-semantic="javascript">pere</code>.</p><aside id="r-412546" data-claire-element-id="412546" data-claire-semantic="warning"><p id="r-412545" data-claire-element-id="412545">Si l'objet que l'on souhaite envoyer contient des objets de type <code data-claire-semantic="javascript">Error</code> ou <code data-claire-semantic="javascript">Function</code> alors une erreur de type <code data-claire-semantic="javascript">DataCloneError</code> se produira et aucune donnée ne sera transmise.<br/> De même, s'il y a une référence à un nœud DOM (attaché ou non au document).</p></aside><p id="r-412547" data-claire-element-id="412547">Certaines propriétés ne sont pas clonées comme la propriété <code data-claire-semantic="javascript">lastIndex</code> d'un objet de type <code data-claire-semantic="javascript">RegExp</code>.<br/> Les getters et les setters (ainsi que toutes les propriétés associées aux metadata) ne sont pas clonés.<br/> Le prototype (et toutes ses références) n'est pas cloné non plus.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
<span class="arrow"></span>
<span class="next">Le canal de communication</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
<span class="next">Terminer une communication</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Terminerunecommunication"></a><h2>Terminer une communication</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
<span class="arrow"></span>
<span class="next">Mieux communiquer</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">
<span class="next">Manipuler les workers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-terminer-une-communication" data-claire-element-id="412561">Terminer une communication</h4><h5 id="r-close-arreter-la-communication" data-claire-element-id="412560"><code data-claire-semantic="javascript">close()</code> : arrêter la communication</h5><p id="r-412551" data-claire-element-id="412551">Nous avions vu l'utilisation de <code data-claire-semantic="javascript">terminate()</code> pour arrêter un worker. Cependant, parfois, on désirerait simplement couper la connexion sans arrêter le worker. Par exemple dans les cas d'utilisation des shared-workers ou de message-Channel.</p><p id="r-412552" data-claire-element-id="412552">Je vous présente maintenant une autre méthode, plus douce, pour arrêter une communication : <code data-claire-semantic="javascript"><strong>close()</strong></code>. <code data-claire-semantic="javascript">close</code> permet de fermer la communication sur laquelle elle est appliquée. Le worker n'est pas arrêté, seul le canal de communication désigné est interrompu.</p><p id="r-412553" data-claire-element-id="412553">Il faut l'appliquer directement sur le port visé : <code data-claire-semantic="javascript">port.close();</code></p><p id="r-412554" data-claire-element-id="412554">Quand <code data-claire-semantic="javascript">close</code> est invoqué. Il n'est plus possible de redémarrer cette connexion. Le canal de communication est détruit. Si vous voulez redémarrer une communication, il faudra recréer un canal de communication avec <code data-claire-semantic="javascript">MessageChannel</code>.</p><h6 id="r-onclose-quand-la-communication-s-arrete" data-claire-element-id="412559"><code data-claire-semantic="javascript">onclose</code> : quand la communication s'arrête</h6><p id="r-412555" data-claire-element-id="412555">Il peut être particulièrement utile de savoir quand la communication est interrompue. Pour cela vous pouvez utiliser le listener <code data-claire-semantic="javascript"><strong>onclose</strong></code>. Cependant cette méthode n'appartient pas aux spécifications ! Les navigateurs ne sont donc pas tenus de l'implémenter.</p><p id="r-412556" data-claire-element-id="412556">Actuellement, seul Firefox semble l'avoir implémenté.</p><p id="r-412557" data-claire-element-id="412557">Il va donc falloir patienter avant de pouvoir vraiment l'utiliser :(</p><p id="r-412558" data-claire-element-id="412558">Maintenant que la communication n'a plus de secret pour vous, nous allons pouvoir continuer dans le prochain chapitre la découverte des workers et voir toutes les possibilités qu'ils nous offrent :)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
<span class="arrow"></span>
<span class="next">Mieux communiquer</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">
<span class="next">Manipuler les workers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Manipulerlesworkers"></a><h2>Manipuler les workers</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
<span class="arrow"></span>
<span class="next">Terminer une communication</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
<span class="next">La gestion des erreurs</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-412563" data-claire-element-id="412563">Dans ce chapitre, nous verrons les derniers détails concernant l'utilisation des workers.</p><p id="r-412564" data-claire-element-id="412564">Nous allons regarder comment appréhender les erreurs qui se déclenchent dans les workers. Nous allons découvrir comment obtenir des informations sur l'environnement d'exécution. Et nous allons aussi voir comment triturer un peu plus les workers.</p>
</div><a name="Lagestiondeserreurs"></a><h2>La gestion des erreurs</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">
<span class="arrow"></span>
<span class="next">Manipuler les workers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
<span class="next">Connaître ses origines</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-la-gestion-des-erreurs-2" data-claire-element-id="412615">La gestion des erreurs</h4><p id="r-412565" data-claire-element-id="412565">Il est possible que vos codes ne soient pas parfaits (pas la peine de se cacher, ça arrive même aux meilleurs). Il peut donc arriver que le worker plante, il vous sera alors utile de le savoir afin de le redémarrer ou plus simplement pour débugger.</p><h5 id="r-onerror-detecter-une-erreur" data-claire-element-id="412596"><code data-claire-semantic="javascript">onerror</code> : détecter une erreur</h5><p id="r-412566" data-claire-element-id="412566">Pour se tenir au courant de la moindre erreur, il suffit d'utiliser le listener <code data-claire-semantic="javascript"><strong>onerror</strong></code>. Et pour récupérer le message d'erreur, vous pouvez lire la propriété <code data-claire-semantic="javascript"><strong>message</strong></code> de l'objet événement.<br/> Vous pourrez aussi avoir besoin des propriétés suivantes :</p><ul id="r-412571" data-claire-element-id="412571"><li id="r-412568" data-claire-element-id="412568"><p id="r-412567" data-claire-element-id="412567"><code data-claire-semantic="javascript"><strong>filename</strong></code>, qui indique le fichier qui a produit l'erreur ;</p></li><li id="r-412570" data-claire-element-id="412570"><p id="r-412569" data-claire-element-id="412569"><code data-claire-semantic="javascript"><strong>lineno</strong></code>, qui nous renseigne sur ligne où l'erreur s'est produite.</p></li></ul><p id="r-412572" data-claire-element-id="412572">Le listener peut être placé sur le worker, ou dans le worker. Si une erreur se produit dans le worker, ces deux listeners seront déclenchés.</p><aside id="r-412574" data-claire-element-id="412574" data-claire-semantic="information"><p id="r-412573" data-claire-element-id="412573">Même si vous pouvez le trouver dans quelques navigateurs, il n'existe pas officiellement de fonction <code data-claire-semantic="javascript">postError</code>. Car le <code data-claire-semantic="javascript">onerror</code> est censé détecter un problème majeur dans le code.<br/> Toutefois si vous tenez à générer une erreur, vous pouvez utiliser <code data-claire-semantic="javascript">throw</code> pour envoyer une erreur, et s'il n'y a pas de <code data-claire-semantic="javascript">try{}catch()</code> l'erreur sera alors propagée et même jusqu'au thread parent via le <code data-claire-semantic="javascript">onerror</code>.<br/> Vous pouvez aussi créer un événement représentant une erreur et le propager.</p></aside><p id="r-412575" data-claire-element-id="412575">Bien sûr, il est tout à fait possible d'utiliser <code data-claire-semantic="javascript">addEventListener</code>.</p><table id="r-412591" data-claire-element-id="412591"><thead id="r-412581" data-claire-element-id="412581"><tr id="r-412580" data-claire-element-id="412580"><th id="r-412577" data-claire-element-id="412577"><p id="r-412576" data-claire-element-id="412576">main.js</p></th><th id="r-412579" data-claire-element-id="412579"><p id="r-412578" data-claire-element-id="412578">worker.js</p></th></tr></thead><tbody id="r-412590" data-claire-element-id="412590"><tr id="r-412586" data-claire-element-id="412586"><td id="r-412583" data-claire-element-id="412583"><pre id="r-412582" data-claire-element-id="412582"><code data-claire-semantic="javascript">//création du worker
var w = new Worker(&quot;worker.js&quot;);

//réception des messages
w.addEventListener(&quot;message&quot;,function(event){
  alert(&quot;Le worker a répondu : &quot; + event.data);
  if(event.data.substr(0,7) == &quot;Bonjour&quot;){
    var nom = prompt(&quot;Quel est ton nom ?&quot;);
    w.postMessage(&quot;L'utilisateur s'appelle : &quot;+
      nom);
  }
},false);

//gestion des erreurs
w.addEventListener(&quot;error&quot;,function(event){
  alert(&quot;Il a planté ! Son excuse est :\n&quot;+
    event.message+
    &quot;\n\nfichier : &quot;+event.filename+
    &quot;\nligne : &quot;+event.lineno);
},false);

w.postMessage(&quot;Bonjour&quot;);</code></pre></td><td id="r-412585" data-claire-element-id="412585"><pre id="r-412584" data-claire-element-id="412584"><code data-claire-semantic="javascript">//gestion des messages
function dialogue(event){
  if(event.data == &quot;Bonjour&quot;){
    throw &quot;J'aime pas dire bonjour&quot;;
  }
}

addEventListener(&quot;message&quot;,dialogue,false);

//gestion des erreurs en interne
addEventListener(&quot;error&quot;,function(e){
  postMessage(&quot;J'ai une erreur : &quot;+
    e.message);
},false);</code></pre></td></tr><tr id="r-412589" data-claire-element-id="412589"><td id="r-412588" data-claire-element-id="412588"><p id="r-412587" data-claire-element-id="412587"><a href="http://restimel.github.com/Tutoriels/webWorkers/dedicated5/index.html">Essayer !</a></p></td></tr></tbody></table><aside id="r-412593" data-claire-element-id="412593" data-claire-semantic="information"><p id="r-412592" data-claire-element-id="412592">Il n'y a aucune raison que les erreurs soient propagées à travers un canal de communication. On ne peut donc pas les observer à travers les ports de <code data-claire-semantic="javascript">MessageChannel</code>, ni à travers les ports des shared-workers.</p></aside><h6 id="r-comportement-des-navigateurs" data-claire-element-id="412595">Comportement des navigateurs</h6><p id="r-412594" data-claire-element-id="412594">Il est à noter que les navigateurs ne sont pas encore parfaits sur ce point. Par exemple Opera n'écoutera pas toutes les erreurs à l'intérieur du worker si vous utilisez <code data-claire-semantic="javascript">addEventListener(&quot;error&quot;,f,false);</code>.<br/> Avec les shared-Workers, aucun navigateur actuel ne semble récupérer les erreurs sur le worker. Heureusement ils les capturent quand même à l'intérieur du worker.</p><h5 id="r-debugger-un-worker" data-claire-element-id="412614">Débugger un worker</h5><p id="r-412597" data-claire-element-id="412597">Débugger les workers s'avère plus difficile que du code 'normal' pour la simple raison qu'en tant qu'utilisateur on ne se trouve pas dans le même thread. Avec la séparation des données, il n'est pas simple de savoir ce qu'il se passe à l'intérieur du worker. Et donc récupérer les erreurs devient un allié très utile.</p><p id="r-412598" data-claire-element-id="412598">Tous les navigateurs ont maintenant une console intégrée, qui permet d'afficher des informations très utiles. Cependant à l'intérieur des workers cette console n'est pas accessible. Certains navigateurs ont donc contourné les problèmes.<br/> Avec Opera, la console est partagée avec celle du thread principal. Ceci est particulièrement pratique mais contredit le principe de zones distinctes.<br/> Avec Webkit, il est possible d'ouvrir un espace de développement dans le worker grâce au &quot;worker inspection&quot;. Cet espace de développement offre une console dédiée au worker et donc d'envoyer des messages dedans. Mais aussi de poser des breakpoints dans le worker afin de l'analyser pas à pas. Il y a de fortes chances qu'à terme tous les navigateurs proposeront une fonctionnalité similaire.</p><p id="r-412599" data-claire-element-id="412599">Vous pouvez aussi trouver sur internet des codes qui permettent de créer une référence à la console dans le worker en redirigeant son contenu dans celle du thread principal. Par exemple <a href="https://github.com/davidflanagan/WorkerConsole">le script de David Flanagan</a> pour créer une console partagée grâce au <code data-claire-semantic="javascript">MessageChannel</code>.</p><p id="r-412600" data-claire-element-id="412600">Sinon vous pouvez vous contenter d'envoyer via le <code data-claire-semantic="javascript">postMessage</code> vos informations de debug en les encapsulant dans un objet.<br/> Par exemple :</p><table id="r-412613" data-claire-element-id="412613"><thead id="r-412606" data-claire-element-id="412606"><tr id="r-412605" data-claire-element-id="412605"><th id="r-412602" data-claire-element-id="412602"><p id="r-412601" data-claire-element-id="412601">main.js</p></th><th id="r-412604" data-claire-element-id="412604"><p id="r-412603" data-claire-element-id="412603">worker.js</p></th></tr></thead><tbody id="r-412612" data-claire-element-id="412612"><tr id="r-412611" data-claire-element-id="412611"><td id="r-412608" data-claire-element-id="412608"><pre id="r-412607" data-claire-element-id="412607"><code data-claire-semantic="javascript">var w = new Worker(&quot;worker.js&quot;);

w.addEventListener(&quot;message&quot;,function(event){
  if(typeof event.data === &quot;object&quot; &amp;&amp;
    event.data.cmd &amp;&amp;
    event.data.cmd === &quot;debug&quot;){
      //il s'agit d'un message de debug
      console.debug(event.data.msg);
    }
  },false);</code></pre></td><td id="r-412610" data-claire-element-id="412610"><pre id="r-412609" data-claire-element-id="412609"><code data-claire-semantic="javascript">function debug(obj){
  postMessage({cmd:&quot;debug&quot;,msg:obj});
}
/*
  maintenant, à n'importe quel
  endroit où l'on souhaite
  analyser la valeur d'un
  objet il suffit de faire :
  debug(objet);
  et sa valeur s'affichera
  dans la console.
  ATTENTION: l'objet doit
  être clonable
*/</code></pre></td></tr></tbody></table>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">
<span class="arrow"></span>
<span class="next">Manipuler les workers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
<span class="next">Connaître ses origines</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Connatresesorigines"></a><h2>Connaître ses origines</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
<span class="arrow"></span>
<span class="next">La gestion des erreurs</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
<span class="next">Ajouter un script dynamiquement : importScripts</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-connaitre-ses-origines" data-claire-element-id="412654">Connaître ses origines</h4><p id="r-412616" data-claire-element-id="412616">Afin d'obtenir des informations sur le contexte d'exécution, deux objets sont disponibles dans l'espace global du worker : <code data-claire-semantic="javascript"><strong>location</strong></code> et <code data-claire-semantic="javascript"><strong>navigator</strong></code>.</p><h5 id="r-location" data-claire-element-id="412640"><code data-claire-semantic="javascript">location</code></h5><p id="r-412617" data-claire-element-id="412617">L'objet location permet d'obtenir des informations sur l'appel du fichier d'origine qui fait fonctionner le script. Toutes les propriétés sont en read-only, il n'est donc pas possible de les modifier comme on peut le faire avec <code data-claire-semantic="javascript">window.location</code>.</p><p id="r-412618" data-claire-element-id="412618">Pour indiquer un exemple de ce que retournent les propriétés, on va considérer que notre worker a été appelé de cette manière <code data-claire-semantic="javascript">new Worker('http://www.siteduzero.com:80/tutoriel/javascript/toto.js?tata=tutu#titi');</code></p><ul id="r-412635" data-claire-element-id="412635"><li id="r-412620" data-claire-element-id="412620"><p id="r-412619" data-claire-element-id="412619"><code data-claire-semantic="javascript"><strong>href</strong></code> : Il s'agit de l'url complète (<code>http://www.siteduzero.com:80/tutoriel/javascript/toto.js?tata=tutu#titi</code>)</p></li><li id="r-412622" data-claire-element-id="412622"><p id="r-412621" data-claire-element-id="412621"><code data-claire-semantic="javascript"><strong>protocol</strong></code> : Il s'agit du protocole utilisé (<code>http:</code>)</p></li><li id="r-412624" data-claire-element-id="412624"><p id="r-412623" data-claire-element-id="412623"><code data-claire-semantic="javascript"><strong>host</strong></code> : Il s'agit du serveur mais aussi du port utilisé (<code>http://www.siteduzero.com:80</code>)</p></li><li id="r-412626" data-claire-element-id="412626"><p id="r-412625" data-claire-element-id="412625"><code data-claire-semantic="javascript"><strong>hostname</strong></code> : Cette fois, il ne s'agit du que du serveur (<code>http://www.siteduzero.com</code>)</p></li><li id="r-412628" data-claire-element-id="412628"><p id="r-412627" data-claire-element-id="412627"><code data-claire-semantic="javascript"><strong>port</strong></code> : Et là, il ne s'agit que du port (<code>80</code>)</p></li><li id="r-412630" data-claire-element-id="412630"><p id="r-412629" data-claire-element-id="412629"><code data-claire-semantic="javascript"><strong>pathname</strong></code> : Il s'agit du chemin relatif depuis le serveur (<code>/tutoriel/javascript/toto.js</code>)</p></li><li id="r-412632" data-claire-element-id="412632"><p id="r-412631" data-claire-element-id="412631"><code data-claire-semantic="javascript"><strong>search</strong></code> : Il s'agit de la partie derrière le ? (<code>?tata=tutu</code>)</p></li><li id="r-412634" data-claire-element-id="412634"><p id="r-412633" data-claire-element-id="412633"><code data-claire-semantic="javascript"><strong>hash</strong></code> : Il s'agit de la partie derrière le # (<code>#titi</code>)</p></li></ul><aside id="r-412637" data-claire-element-id="412637" data-claire-semantic="warning"><p id="r-412636" data-claire-element-id="412636">Ces propriétés sont proches de celle de <code data-claire-semantic="javascript">window.location</code>, toutefois <code data-claire-semantic="javascript">self.location</code> ne comporte aucune méthode. Ceci peut facilement s'expliquer par le fait que les propriétés sont ici en lecture seule. Et même <code data-claire-semantic="javascript">toString()</code> ne retournera pas l'url comme on pourrait s'y attendre (il faut alors utiliser <code data-claire-semantic="javascript">self.location.href</code>).</p></aside><aside id="r-412639" data-claire-element-id="412639" data-claire-semantic="information"><p id="r-412638" data-claire-element-id="412638">Avec les shared-workers, pour qu'un code soit partagé il doit être appelé avec la même <code data-claire-semantic="javascript">location</code>. Ainsi si le hash ou le search est différent, les codes seront distincts et ne seront pas partagés.</p></aside><h5 id="r-navigator" data-claire-element-id="412653"><code data-claire-semantic="javascript">navigator</code></h5><p id="r-412641" data-claire-element-id="412641">L'objet <code data-claire-semantic="javascript">navigator</code> permet d'obtenir des informations sur le navigateur dans lequel le script s'exécute.</p><ul id="r-412652" data-claire-element-id="412652"><li id="r-412643" data-claire-element-id="412643"><p id="r-412642" data-claire-element-id="412642"><code data-claire-semantic="javascript"><strong>appName</strong></code> : Il s'agit du nom officiel du navigateur.</p></li><li id="r-412645" data-claire-element-id="412645"><p id="r-412644" data-claire-element-id="412644"><code data-claire-semantic="javascript"><strong>appVersion</strong></code> : Il s'agit de la version du navigateur (sous forme de chaîne de caractères).</p></li><li id="r-412647" data-claire-element-id="412647"><p id="r-412646" data-claire-element-id="412646"><code data-claire-semantic="javascript"><strong>platform</strong></code> : Il s'agit du nom de la plate-forme dans laquelle le navigateur fonctionne (Windows, Linux,…).</p></li><li id="r-412649" data-claire-element-id="412649"><p id="r-412648" data-claire-element-id="412648"><code data-claire-semantic="javascript"><strong>userAgent</strong></code> : Il s'agit de la chaîne d'identification complète du navigateur.</p></li><li id="r-412651" data-claire-element-id="412651"><p id="r-412650" data-claire-element-id="412650"><code data-claire-semantic="javascript"><strong>online</strong></code> : Permet d'indiquer si le navigateur travaille &quot;en-ligne&quot; ou non.</p></li></ul>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
<span class="arrow"></span>
<span class="next">La gestion des erreurs</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
<span class="next">Ajouter un script dynamiquement : importScripts</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="AjouterunscriptdynamiquementimportScripts"></a><h2>Ajouter un script dynamiquement : importScripts</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
<span class="arrow"></span>
<span class="next">Connaître ses origines</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
<span class="next">Enchaîner les workers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-ajouter-un-script-dynamiquement-importscripts" data-claire-element-id="412680">Ajouter un script dynamiquement : importScripts</h4><p id="r-412655" data-claire-element-id="412655">Dans un worker, il est bien sûr possible d'utiliser <code data-claire-semantic="javascript">XMLHTTPRequests</code> pour lire le contenu d'un fichier grâce à l'AJAX.</p><p id="r-412656" data-claire-element-id="412656">Toutefois si vous désirez charger un script dynamiquement, cela se complique fortement. En effet, vous ne pouvez pas créer de balise script et exécuter un code externe de cette manière. Pour pallier ce problème, il existe une nouvelle fonction disponible uniquement dans les workers : <code data-claire-semantic="javascript"><strong>importScripts</strong></code>.</p><p id="r-412657" data-claire-element-id="412657">Cette fonction permet de charger de manière synchrone un code situé dans un fichier.</p><p id="r-412658" data-claire-element-id="412658">Supposons que vous ayez écrit une API nommée calcul.js.</p><pre id="r-412659" data-claire-element-id="412659"><code data-claire-semantic="javascript">function addition(a, b){
	return a + b;
}</code></pre><p id="r-412660" data-claire-element-id="412660">Dans votre worker, vous pouvez écrire :</p><pre id="r-412661" data-claire-element-id="412661"><code data-claire-semantic="javascript">importScripts(&quot;calcul.js&quot;);
var resultat = addition(1, 2); // resultat vaut 3</code></pre><p id="r-412662" data-claire-element-id="412662">À la ligne 1, l'interpréteur va charger et exécuter le code situé dans le fichier calcul.js. Puis, une fois fini, il va exécuter la deuxième ligne.</p><p id="r-412663" data-claire-element-id="412663">Il est aussi possible d'inclure directement plusieurs fichiers d'un coup :</p><pre id="r-412664" data-claire-element-id="412664"><code data-claire-semantic="javascript">importScripts(&quot;calcul1.js&quot;, &quot;calcul2.js&quot;, &quot;calcul3.js&quot;, &quot;calcul4.js&quot;);</code></pre><p id="r-412665" data-claire-element-id="412665">L'ordre de chargement est du premier au dernier (de gauche à droite).</p><aside id="r-412667" data-claire-element-id="412667" data-claire-semantic="warning"><p id="r-412666" data-claire-element-id="412666">Le contexte d'exécution des scripts importés est toujours l'espace global du worker (donc <code data-claire-semantic="javascript">self</code>).</p></aside><p id="r-412668" data-claire-element-id="412668">Ce point est très important ! Examinons quelques exemples pour mieux comprendre sa signification.</p><p id="r-412669" data-claire-element-id="412669">Si on a dans le fichier toto.js :</p><pre id="r-412670" data-claire-element-id="412670"><code data-claire-semantic="javascript">a = b + c;</code></pre><p id="r-412671" data-claire-element-id="412671">Et dans le worker :</p><pre id="r-412672" data-claire-element-id="412672"><code data-claire-semantic="javascript">var a = 10,
    b = 20,
    c = 30;

importScripts(&quot;toto.js&quot;);
var resultat = a; //vaut 50</code></pre><p id="r-412673" data-claire-element-id="412673">Effectivement la variable <code data-claire-semantic="javascript">a</code> a été modifiée dans le fichier importé.<br/> Ceci nous confirme le caractère synchrone de l'import.</p><p id="r-412674" data-claire-element-id="412674">Intégrons maintenant cet import dans une fonction (c'est-à-dire qu'il est appelé dans un contexte d'exécution qui est différent de l'espace global). Notre worker ressemble à ceci :</p><pre id="r-412675" data-claire-element-id="412675"><code data-claire-semantic="javascript">var a = 10,
    b = 20,
    c = 30;

function test(){
	var a = 1,
	    b = 2,
	    c = 3;
	importScripts(&quot;toto.js&quot;);
	var resultat1 = a; //vaut 1
	var resultat2 = self.a; //vaut 50
}

test();</code></pre><p id="r-412676" data-claire-element-id="412676">Bien que <code data-claire-semantic="javascript">importScripts</code> ait été appelé dans la fonction, son environnement de travail est l'espace global. Ce sont donc les variables <code data-claire-semantic="javascript">a</code>, <code data-claire-semantic="javascript">b</code> et <code data-claire-semantic="javascript">c</code> de <code data-claire-semantic="javascript">self</code> qui ont été modifiées et non pas les variables locales de la fonction <code data-claire-semantic="javascript">test</code>.</p><p id="r-412677" data-claire-element-id="412677">Il ne s'agit donc pas d'une &quot;copie&quot; de code à l'endroit où il est appelé (comme pour l'<code data-claire-semantic="html+php">include</code> en PHP) mais bien d'une exécution de code.</p><aside id="r-412679" data-claire-element-id="412679" data-claire-semantic="information"><p id="r-412678" data-claire-element-id="412678">Si le même fichier est importé dans plusieurs workers, il s'exécutera de manière indépendante dans chaque worker. Ses actions ne seront pas partagées entre les workers, mais seront bien effectives dans l'environnement de chaque worker.</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
<span class="arrow"></span>
<span class="next">Connaître ses origines</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
<span class="next">Enchaîner les workers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Enchanerlesworkers"></a><h2>Enchaîner les workers</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
<span class="arrow"></span>
<span class="next">Ajouter un script dynamiquement : importScripts</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
<span class="next">Créer un worker inline</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-enchainer-les-workers" data-claire-element-id="412715">Enchaîner les workers</h4><p id="r-412681" data-claire-element-id="412681">Et oui ! Il est tout à fait possible d'enchaîner les workers !<br/> Ainsi dans un worker, il est possible de créer un ou plusieurs nouveau(x) worker(s).</p><table id="r-412701" data-claire-element-id="412701"><thead id="r-412689" data-claire-element-id="412689"><tr id="r-412688" data-claire-element-id="412688"><th id="r-412683" data-claire-element-id="412683"><p id="r-412682" data-claire-element-id="412682">main.js</p></th><th id="r-412685" data-claire-element-id="412685"><p id="r-412684" data-claire-element-id="412684">worker1.js</p></th><th id="r-412687" data-claire-element-id="412687"><p id="r-412686" data-claire-element-id="412686">worker2.js</p></th></tr></thead><tbody id="r-412700" data-claire-element-id="412700"><tr id="r-412696" data-claire-element-id="412696"><td id="r-412691" data-claire-element-id="412691"><pre id="r-412690" data-claire-element-id="412690"><code data-claire-semantic="javascript">//  initialisation du worker
var w = new Worker(&quot;worker1.js&quot;);
w.addEventListener(&quot;message&quot;,
  function(event){
    alert(&quot;j'ai reçu le message suivant :\n&quot;
      +event.data);
},false);

// on envoie un message
w.postMessage(&quot;Bonjour&quot;);</code></pre></td><td id="r-412693" data-claire-element-id="412693"><pre id="r-412692" data-claire-element-id="412692"><code data-claire-semantic="javascript">if(self.Worker){
  //on crée un nouveau worker
  var w=new Worker(&quot;worker2.js&quot;);

  w.addEventListener(&quot;message&quot;,
    function(event){
      /*
      transmission du message au
      parent (en le modifiant)
      */
    postMessage('worker2 a ce '+
       'message pour toi : &quot;'+
       event.data + '&quot;');
    },
    false);

  /*
  gestion de la communication
  avec le parent
  */
  addEventListener(&quot;message&quot;,
    function(event){
      /*
      transmition du message au
      worker (sans changement)
      */
      w.postMessage(event.data);
    },
    false);

}else{
  /*le navigateur ne gère pas
  les workers dans un worker*/
  postMessage(&quot;Votre navigateur &quot;+
    &quot;ne supporte pas les Workers&quot;+
    &quot; dans les Workers ☹&quot;);
}</code></pre></td><td id="r-412695" data-claire-element-id="412695"><pre id="r-412694" data-claire-element-id="412694"><code data-claire-semantic="javascript">addEventListener(&quot;message&quot;,
  function(event){
    postMessage(&quot;Merci de m'écrire&quot;);
  },
  false);</code></pre></td></tr><tr id="r-412699" data-claire-element-id="412699"><td id="r-412698" data-claire-element-id="412698"><p id="r-412697" data-claire-element-id="412697"><a href="http://restimel.github.com/Tutoriels/webWorkers/dedicated4/index.html">Essayer !</a></p></td></tr></tbody></table><p id="r-412702" data-claire-element-id="412702">Ce code transmet un message au premier worker qui le transmet au deuxième. Celui-ci répond, le premier worker le reçoit et le modifie puis le retransmet au script d'origine.</p><p id="r-412703" data-claire-element-id="412703">Vous aurez compris par vous même que worker2.js ne peut pas communiquer directement avec main.js, puisqu'il ne le connait pas. Il est obligé de passer par son parent pour lui adresser un message.</p><p id="r-412704" data-claire-element-id="412704">Il est bien sûr possible de créer plusieurs workers par thread et donc de gérer toute une ribambelle de scripts de cette manière :lol:</p><aside id="r-412706" data-claire-element-id="412706" data-claire-semantic="warning"><p id="r-412705" data-claire-element-id="412705">Bien que cela soit possible, il n'est pas vraiment recommandé d'enchaîner trop de workers. Principalement à cause de leur consommation de ressources. Comme nous le verrons dans le prochain chapitre.</p></aside><p id="r-412707" data-claire-element-id="412707">Lorsque vous créez un worker, vous lui adressez une url relative au script en cours. Ainsi dans la page HTML, l'origine se trouve au niveau de la page HTML.<br/> Dans un worker, l'origine se trouve au niveau du fichier s'exécutant dans le worker.</p><p id="r-412708" data-claire-element-id="412708">Imaginons que vous ayez deux répertoires nommés <em>html</em> et <em>scripts</em> qui contiennent respectivement vos fichiers html et vos fichiers javascript. Ces répertoires sont situés tous deux dans le même répertoire parent.<br/> Dans un fichier index.html, on appelle donc un script de cette manière :</p><pre id="r-412709" data-claire-element-id="412709"><code data-claire-semantic="html">&lt;script src=&quot;../scripts/main.js&quot;&gt;&lt;/script&gt;</code></pre><p id="r-412710" data-claire-element-id="412710">Dans ce fichier javascript on pourra donc créer un worker en l'appelant de cette manière :</p><pre id="r-412711" data-claire-element-id="412711"><code data-claire-semantic="javascript">var w = new Worker(&quot;../scripts/worker1.js&quot;);</code></pre><p id="r-412712" data-claire-element-id="412712">Dans ce worker, si l'on veut créer un autre worker, on devra faire :</p><pre id="r-412713" data-claire-element-id="412713"><code data-claire-semantic="javascript">var w = new Worker(&quot;worker2.js&quot;);</code></pre><p id="r-412714" data-claire-element-id="412714">Faites donc bien attention à l'origine du script en cours d'exécution lorsque vous créez un worker.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
<span class="arrow"></span>
<span class="next">Ajouter un script dynamiquement : importScripts</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
<span class="next">Créer un worker inline</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Crerunworkerinline"></a><h2>Créer un worker inline</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
<span class="arrow"></span>
<span class="next">Enchaîner les workers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">
<span class="next">Quand utiliser des web-workers ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-creer-un-worker-inline" data-claire-element-id="412734">Créer un worker inline</h4><p id="r-412716" data-claire-element-id="412716">Dans certains cas, il peut être pratique de créer un worker dans le même code que celui qui va l'appeler.<br/> Je tiens à préciser que cette méthode n'est à réserver que pour quelques cas très limités. En fait, je vous conseille même de l'éviter tant que vous le pouvez. Mais comme je vous ai promis de tout vous montrer sur les workers, je vais quand même vous le montrer.</p><p id="r-412717" data-claire-element-id="412717">Pour créer un worker il nous faut une URL.</p><p id="r-412718" data-claire-element-id="412718">Nous allons donc créer un <strong>Blob</strong> et créer une url vers son contenu.</p><h6 id="r-creation-du-blob" data-claire-element-id="412724">Création du BLOB</h6><p id="r-412719" data-claire-element-id="412719">Pour créer un BLOB, il suffit d'utiliser l'objet <code data-claire-semantic="javascript"><strong>BlobBuilder</strong></code> (sous certains navigateurs, il faut le préfixer, cela donnera donc <code data-claire-semantic="javascript">WebKitBlobBuilder</code> ou <code data-claire-semantic="javascript">MozBlobBuilder</code>).</p><pre id="r-412720" data-claire-element-id="412720"><code data-claire-semantic="javascript">var blob = new BlobBuilder();</code></pre><p id="r-412721" data-claire-element-id="412721">Il faut ensuite le remplir, pour cela on utilise la fonction <code data-claire-semantic="javascript"><strong>append</strong></code>. Par exemple :</p><pre id="r-412722" data-claire-element-id="412722"><code data-claire-semantic="javascript">blob.append(&quot;onmessage = function(e){ postMessage('je réponds au message : ' + e.data); };&quot;);</code></pre><p id="r-412723" data-claire-element-id="412723">Bien sûr, vu que c'est une chaîne de caractères, vous pouvez la modifier comme vous le voulez avec du contenu issu du DOM ou d'ailleurs. Mais une fois créé, le contenu du worker ne sera plus accessible.</p><h6 id="r-creation-de-l-url" data-claire-element-id="412727">Création de l'url</h6><p id="r-412725" data-claire-element-id="412725">Pour créer une url vers le blob, on va utiliser la fonction <code data-claire-semantic="javascript"><strong>createObjectURL</strong></code> de l'objet URL (sous certains navigateurs, il faut le préfixer, ce qui donnera <code data-claire-semantic="javascript">webkitURL</code> ou <code data-claire-semantic="javascript">MozURL</code>).</p><pre id="r-412726" data-claire-element-id="412726"><code data-claire-semantic="javascript">var blobUrl = URL.createObjectURL(blob.getBlob());</code></pre><h6 id="r-creation-du-worker" data-claire-element-id="412733">Création du worker</h6><p id="r-412728" data-claire-element-id="412728">Ce qui nous donne au final :</p><pre id="r-412729" data-claire-element-id="412729"><code data-claire-semantic="javascript">var blob = new BlobBuilder();
blob.append(&quot;onmessage = function(e){ postMessage('je réponds au message : ' + e.data); };&quot;);
var blobUrl = URL.createObjectURL(blob.getBlob());

var worker = new Worker(blobUrl);
worker.onmessage = function(e){
    alert(e.data);
};

worker.postMessage(&quot;Bonjour&quot;);</code></pre><p id="r-412730" data-claire-element-id="412730"><a href="http://restimel.github.com/Tutoriels/webWorkers/inline/index.html">Essayer !</a></p><p id="r-412731" data-claire-element-id="412731">Maintenant, vous savez tout sur les workers. Il ne vous reste plus qu'à les utiliser et à profiter des nouvelles possibilités qui s'offrent à vous.</p><p id="r-412732" data-claire-element-id="412732">Dans le prochain chapitre je vous propose de voir quand il est sage de les utiliser ou non.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
<span class="arrow"></span>
<span class="next">Enchaîner les workers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">
<span class="next">Quand utiliser des web-workers ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Quandutiliserdesweb-workers"></a><h2>Quand utiliser des web-workers ?</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
<span class="arrow"></span>
<span class="next">Créer un worker inline</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
<span class="next">Quand ne pas utiliser les workers ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-412736" data-claire-element-id="412736">Vous savez maintenant presque tout sur les workers, vous devez alors être tenté de les utiliser partout. Mais les workers n'ont pas que des avantages :(</p><p id="r-412737" data-claire-element-id="412737">Dans ce cours, nous allons voir quand il est judicieux d'utiliser ou non les workers. <br/> Dans quels contextes se révèlent-ils utiles ? C'est ce que nous allons voir tout de suite.</p><p id="r-412738" data-claire-element-id="412738">De par leur apparition récente, il est assez difficile de faire une liste exacte de bonnes pratiques. Cette partie se contentera donc de donner des idées sur ce qui paraît cohérent et des pistes pour en faire un bon usage.</p>
</div><a name="Quandnepasutiliserlesworkers"></a><h2>Quand ne pas utiliser les workers ?</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">
<span class="arrow"></span>
<span class="next">Quand utiliser des web-workers ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
<span class="next">Quand utiliser les workers ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-quand-ne-pas-utiliser-les-workers" data-claire-element-id="412749">Quand ne pas utiliser les workers ?</h4><p id="r-412739" data-claire-element-id="412739">Vous venez d'apprendre à utiliser les workers et, je le comprends, vous voulez maintenant les utiliser. Toutefois je vais vous arrêter :( Certes, comme nous allons le voir dans la section suivante, les workers ont un intérêt. Mais il faut garder en tête que la programmation concurrente apporte aussi une complexité à votre code.</p><p id="r-412740" data-claire-element-id="412740">Nous allons donc lister les cas où les workers sont inutiles.</p><ul id="r-412748" data-claire-element-id="412748"><li id="r-412743" data-claire-element-id="412743"><p id="r-412741" data-claire-element-id="412741">Ne les utilisez pas quand vous n'en avez pas besoin !<br/> Si vous n'avez pas besoin de réaliser plusieurs tâches en même temps, alors vous n'avez pas besoin de la parallélisation et donc des workers.</p><p id="r-412742" data-claire-element-id="412742">Jusqu'à présent, vous aviez dû écrire de nombreux codes javascript sans ressentir le besoin d'utiliser la programmation parallèle. En avez-vous vraiment besoin maintenant ?</p></li><li id="r-412745" data-claire-element-id="412745"><p id="r-412744" data-claire-element-id="412744">Si vous avez besoin d'un résultat avant de continuer l'exécution du script, l'utilisation des workers n'est pas forcément la plus judicieuse car il vous faudra gérer le caractère asynchrone de la réponse.</p></li><li id="r-412747" data-claire-element-id="412747"><p id="r-412746" data-claire-element-id="412746">Attention aux performances ! Contrairement aux idées reçues, les workers n'améliorent que rarement la performance de votre code. Et il faut aussi tenir compte du temps de transfert des messages.<br/> Les workers n'amélioreront pas la performance de votre code d'un coup de baguette magique. Il est possible de l'améliorer grâce aux workers mais il faut savoir les utiliser correctement. Sinon, dans la plupart des cas, elles seront dégradées.<br/> Nous reviendrons sur la performance, dans la dernière section de ce chapitre.</p></li></ul>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">
<span class="arrow"></span>
<span class="next">Quand utiliser des web-workers ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
<span class="next">Quand utiliser les workers ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Quandutiliserlesworkers"></a><h2>Quand utiliser les workers ?</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
<span class="arrow"></span>
<span class="next">Quand ne pas utiliser les workers ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
<span class="next">La performance</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-quand-utiliser-les-workers" data-claire-element-id="412767">Quand utiliser les workers ?</h4><p id="r-412750" data-claire-element-id="412750">Ne désespérez pas !<br/> Les workers sont utiles. Il faut juste les utiliser à bon escient ;) .</p><p id="r-412751" data-claire-element-id="412751">D'une manière générale, puisqu'ils n'ont pas accès à l'interface, les workers se prêtent bien aux calculs.</p><p id="r-412752" data-claire-element-id="412752">Voici une petite liste où les workers apportent un réel intérêt :</p><ul id="r-412765" data-claire-element-id="412765"><li id="r-412754" data-claire-element-id="412754"><p id="r-412753" data-claire-element-id="412753">Quand vous cherchez à réaliser plusieurs actions en même temps. Par exemple vous cherchez à réaliser un calcul mais vous souhaitez que l'utilisateur puisse toujours accéder à d'autres fonctionnalités.</p></li><li id="r-412756" data-claire-element-id="412756"><p id="r-412755" data-claire-element-id="412755">Quand vous désirez afficher l'état d'avancement d'une tâche sans trop impacter son temps de calcul.<br/> Attention à ne pas vous tromper de sens. Dans la majorité des cas, c'est le thread actif (le calcul) qui doit envoyer son état au thread d'affichage. Libre ensuite à celui-ci d'exploiter ou non cette information. Si vous communiquez dans l'autre sens, le tread d'affichage demande au thread de calcul où il en est (comme cela est souvent effectué avec d'autres langages pour ce genre de réalisation), le thread n'y répondra pas avant d'avoir fini. Effectivement, lorsque le thread reçoit le message, il est mis en attente. Il ne sera lu que lorsque le calcul aura rendu la main, et il y a donc de fortes chances pour qu'il ne rende la main qu'une fois le calcul terminé.</p></li><li id="r-412758" data-claire-element-id="412758"><p id="r-412757" data-claire-element-id="412757">Dans certains cas, il est possible d'améliorer les performances de votre calcul.<br/> Attention, les cas réels, où l'optimisation est possible, sont plutôt rares. Pour que cela puisse bien marcher, il est absolument nécessaire que le calcul soit distribuable entre plusieurs tâches, et que chaque tâche soit indépendante.<br/> Mais il est possible d'obtenir un résultat sans avoir à attendre la fin d'une autre tâche :)</p></li><li id="r-412760" data-claire-element-id="412760"><p id="r-412759" data-claire-element-id="412759">Anticiper un résultat. Vous pouvez calculer des informations qui seront utilisées plus tard. Par exemple, dans un jeu, vous pouvez calculer la solution en arrière-plan pendant que l'utilisateur cherche par lui-même. Ainsi l'utilisateur ne subit aucun ralentissement pendant que la solution est recherchée par votre programme. Et la solution lui sera proposée instantanément quand il la demandera. Il s'agit d'une amélioration de performance facile à mettre en place s'il est possible d'anticiper une demande (qu'elle provienne de l'utilisateur ou d'une fonction qui sera utilisée plus tard).</p></li><li id="r-412762" data-claire-element-id="412762"><p id="r-412761" data-claire-element-id="412761">Dans un modèle en couches, les workers peuvent permettre de s'assurer qu'un thread sera dédié à l'affichage et un autre (ou plusieurs) au moteur. Chaque couche pouvant être représentée par un thread.</p></li><li id="r-412764" data-claire-element-id="412764"><p id="r-412763" data-claire-element-id="412763">Les shared-workers offrent la possibilité de surveiller la présence d'un utilisateur sur plusieurs pages de votre site ou même plusieurs fois la même page. Ils permettent ainsi de mettre à jour toutes ses pages actives en fonction de ses actions sur les autres. Ou de le prévenir qu'il a déjà ouvert cette page dans un autre onglet ou une autre fenêtre.<br/> On peut aussi imaginer, par ce biais, d'utiliser les onglets du navigateur pour utiliser son site au lieu de créer ses propres onglets (ce cas ne devrait être envisagé que dans le cas d'une application afin de ne pas gêner l'utilisateur dans sa manière de naviguer)</p></li></ul><p id="r-412766" data-claire-element-id="412766">Je ne peux pas lister tous les cas de figure, car cela appelle à votre imagination et à votre innovation. Mais sachez que de nouvelles possibilités vous sont maintenant ouvertes.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
<span class="arrow"></span>
<span class="next">Quand ne pas utiliser les workers ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
<span class="next">La performance</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Laperformance"></a><h2>La performance</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
<span class="arrow"></span>
<span class="next">Quand utiliser les workers ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">
<span class="next">Le support des navigateurs</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-la-performance" data-claire-element-id="412776">La performance</h4><p id="r-412768" data-claire-element-id="412768">Pour terminer ce chapitre, je vais garder quelques mots pour la performance. Si vous avez l'intention d'utiliser les workers sans vous soucier des problèmes de performances alors pas de soucis. Mais si la performance est un de vos sujets de préoccupation, alors vous devrez lire ces lignes.</p><p id="r-412769" data-claire-element-id="412769">La performance est un sujet délicat. Tout d'abord parce que les meilleures améliorations viendront d'abord de l'architecture de votre programme. Ensuite parce que les résultats peuvent varier fortement d'un navigateur à l'autre. Mais en ce qui concerne les workers, il y a des règles immuables.</p><p id="r-412770" data-claire-element-id="412770">Tout d'abord il faut bien garder en tête qu'un worker coûte cher. Non pas en argent ! Mais en ressources, surtout en mémoire. Le navigateur doit gérer un espace global supplémentaire …<br/> Et leur initialisation prend un certain temps (qui n'existe pas quand on ne les utilise pas).</p><p id="r-412771" data-claire-element-id="412771">Généralement pour démarrer un calcul, il faudra lui envoyer un message. Et si ce message est volumineux (afin de paramétrer correctement le calcul), la transmission de ce message peut prendre beaucoup de temps. D'autant plus, comme on l'a vu au chapitre précédent, que les messages sont copiés et non transférés.<br/> Le temps nécessaire à l'émission et/ou à la réception ne sont pas à négliger. Surtout si vous recherchez l'optimisation d'un calcul avec des workers.</p><p id="r-412772" data-claire-element-id="412772">Il faut donc les utiliser avec parcimonie. Mais surtout un worker est fait pour vivre ! Si vous les utilisez pour améliorer vos performances alors faites-les vivre le plus longtemps possible. Si vous les utilisez pour des petits calculs alors le temps d'initialisation aura fait perdre tout l'intérêt de la parallélisation.<br/> Donc plus le worker vit (et est utilisé) longtemps, plus le rendement sera bon.</p><p id="r-412773" data-claire-element-id="412773">Il ne faut pas oublier aussi que la plupart des navigateurs implémentent les workers en thread et non en processus. Du coup, si plusieurs workers travaillent en même temps, ils ne vont pas forcément bénéficier du multicœur de la machine ; ils vont se partager le même temps de fonctionnement alloué au processus. Ils vont donc se ralentir les uns les autres.</p><p id="r-412774" data-claire-element-id="412774">Avant d'utiliser un worker pour des raisons de performance, il est donc nécessaire de bien mesurer le coût de fonctionnement d'un worker. Si vous estimez que malgré ces inconvénients vous gagnerez encore en performance, alors n'hésitez plus : foncez ! :D</p><p id="r-412775" data-claire-element-id="412775">Cette petite section est loin d'être exhaustive. D'autant plus qu'il est encore bien trop tôt pour donner des règles précises. Mais cela vous donne déjà un bon aperçu où l'utilisation de workers apporte un intérêt ou au contraire sont déconseillés.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
<span class="arrow"></span>
<span class="next">Quand utiliser les workers ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">
<span class="next">Le support des navigateurs</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesupportdesnavigateurs"></a><h2>Le support des navigateurs</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
<span class="arrow"></span>
<span class="next">La performance</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
<span class="next">Tour d&#039;horizon</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-412778" data-claire-element-id="412778">Le support des navigateurs a toujours été un problème en javascript. Cela reste d'autant plus vrai avec l'HTML5, où les fonctionnalités sont ajoutées au fur et à mesure et chaque navigateur a un rythme de développement différent (et des priorités différentes).</p><p id="r-412779" data-claire-element-id="412779">Nous allons voir ici ce qu'il en ait à propos des web-workers et de ce qui tourne autour.</p>
</div><a name="Tourd039horizon"></a><h2>Tour d&#039;horizon</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">
<span class="arrow"></span>
<span class="next">Le support des navigateurs</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
<span class="next">Chrome / Safari (Webkit)</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-tour-d-horizon-1" data-claire-element-id="412852">Tour d'horizon</h4><p id="r-412780" data-claire-element-id="412780">Voici un récapitulatif du support des web-workers par les principaux navigateurs :</p><table id="r-412846" data-claire-element-id="412846"><thead id="r-412845" data-claire-element-id="412845"><tr id="r-412792" data-claire-element-id="412792"><th id="r-412781" data-claire-element-id="412781"></th><th id="r-412783" data-claire-element-id="412783"><p id="r-412782" data-claire-element-id="412782">Chrome</p></th><th id="r-412785" data-claire-element-id="412785"><p id="r-412784" data-claire-element-id="412784">Firefox</p></th><th id="r-412787" data-claire-element-id="412787"><p id="r-412786" data-claire-element-id="412786">Internet Explorer</p></th><th id="r-412789" data-claire-element-id="412789"><p id="r-412788" data-claire-element-id="412788">Opera</p></th><th id="r-412791" data-claire-element-id="412791"><p id="r-412790" data-claire-element-id="412790">Safari</p></th></tr><tr id="r-412805" data-claire-element-id="412805"><th id="r-412794" data-claire-element-id="412794"><p id="r-412793" data-claire-element-id="412793">Worker</p></th><td id="r-412796" data-claire-element-id="412796"><p id="r-412795" data-claire-element-id="412795">3+</p></td><td id="r-412798" data-claire-element-id="412798"><p id="r-412797" data-claire-element-id="412797">3.5+</p></td><td id="r-412800" data-claire-element-id="412800"><p id="r-412799" data-claire-element-id="412799">10+</p></td><td id="r-412802" data-claire-element-id="412802"><p id="r-412801" data-claire-element-id="412801">10.60+</p></td><td id="r-412804" data-claire-element-id="412804"><p id="r-412803" data-claire-element-id="412803">4+</p></td></tr><tr id="r-412818" data-claire-element-id="412818"><th id="r-412807" data-claire-element-id="412807"><p id="r-412806" data-claire-element-id="412806">SharedWorker</p></th><td id="r-412809" data-claire-element-id="412809"><p id="r-412808" data-claire-element-id="412808">5+</p></td><td id="r-412811" data-claire-element-id="412811"><p id="r-412810" data-claire-element-id="412810">:(</p></td><td id="r-412813" data-claire-element-id="412813"><p id="r-412812" data-claire-element-id="412812">:(</p></td><td id="r-412815" data-claire-element-id="412815"><p id="r-412814" data-claire-element-id="412814">10.60+</p></td><td id="r-412817" data-claire-element-id="412817"><p id="r-412816" data-claire-element-id="412816">5+</p></td></tr><tr id="r-412831" data-claire-element-id="412831"><th id="r-412820" data-claire-element-id="412820"><p id="r-412819" data-claire-element-id="412819">MessageChannel</p></th><td id="r-412822" data-claire-element-id="412822"><p id="r-412821" data-claire-element-id="412821">5+</p></td><td id="r-412824" data-claire-element-id="412824"><p id="r-412823" data-claire-element-id="412823">:(</p></td><td id="r-412826" data-claire-element-id="412826"><p id="r-412825" data-claire-element-id="412825">10+</p></td><td id="r-412828" data-claire-element-id="412828"><p id="r-412827" data-claire-element-id="412827">10.60+</p></td><td id="r-412830" data-claire-element-id="412830"><p id="r-412829" data-claire-element-id="412829">5+</p></td></tr><tr id="r-412844" data-claire-element-id="412844"><th id="r-412833" data-claire-element-id="412833"><p id="r-412832" data-claire-element-id="412832">Inline</p></th><td id="r-412835" data-claire-element-id="412835"><p id="r-412834" data-claire-element-id="412834">8+</p></td><td id="r-412837" data-claire-element-id="412837"><p id="r-412836" data-claire-element-id="412836">6+</p></td><td id="r-412839" data-claire-element-id="412839"><p id="r-412838" data-claire-element-id="412838">???</p></td><td id="r-412841" data-claire-element-id="412841"><p id="r-412840" data-claire-element-id="412840">:(</p></td><td id="r-412843" data-claire-element-id="412843"><p id="r-412842" data-claire-element-id="412842">5.1+</p></td></tr></thead></table><p id="r-412847" data-claire-element-id="412847">Les <strong>dedicated-workers</strong> peuvent être utilisés sans soucis sur tous les navigateurs récents et même des plus anciens (mis à part Internet Explorer). La seule inquiétude reste donc si vous ciblez un usage professionnel où les utilisateurs restent souvent avec de vieilles versions d'Internet Explorer.</p><p id="r-412848" data-claire-element-id="412848">Le support des <strong>shared-workers</strong> est plus délicat, puisque les deux principaux navigateurs (en terme de parts de marché) ne les supportent pas. Cela signifie qu'il n'est actuellement pas possible de construire un site ou une application recherchant une large diffusion où les shared-workers sont absolument nécessaires. Ils doivent donc rester optionnels et n'apporter qu'un confort ou une aide de plus.</p><aside id="r-412850" data-claire-element-id="412850" data-claire-semantic="information"><p id="r-412849" data-claire-element-id="412849">En plus de ces supports majeurs, il y a également quelques difficultés de compatibilité pour certaines fonctionnalités. Je vous ai présenté les fonctionnalités telles qu'elles devraient fonctionner d'après les spécifications. Nous allons voir maintenant en détail les problèmes des principaux navigateurs.</p></aside><p id="r-412851" data-claire-element-id="412851">Dans un but d'impartialité, les navigateurs sont présentés par ordre alphabétique. Ces informations ont été testées sur la dernière version stable disponible du navigateur au moment de l'écriture de ce tutoriel. Elles sont donc sujettes à modification.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">
<span class="arrow"></span>
<span class="next">Le support des navigateurs</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
<span class="next">Chrome / Safari (Webkit)</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Chrome_SafariWebkit"></a><h2>Chrome / Safari (Webkit)</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
<span class="arrow"></span>
<span class="next">Tour d&#039;horizon</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
<span class="next">Firefox</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-chrome-safari-webkit" data-claire-element-id="412871">Chrome / Safari (Webkit)</h4><p id="r-412853" data-claire-element-id="412853">Je présente Chrome et Safari en même temps, vu qu'ils utilisent le même moteur, leur comportement est très proche.</p><ol id="r-412870" data-claire-element-id="412870"><li id="r-412855" data-claire-element-id="412855"><p id="r-412854" data-claire-element-id="412854">En local : Pour des raisons de sécurité, les workers ne sont pas appelés dans les pages situées en local sur votre ordinateur.<br/> Il est nécessaire de mettre les pages en ligne pour faire fonctionner les workers. Ou alors il faut démarrer le navigateur avec une option permettant de lire les fichiers locaux:<br/><code data-claire-semantic="console">Chrome --disable-web-security</code> ou <code data-claire-semantic="console">Chrome --allow-file-access-from-files</code><em>(en fonction de la plateforme ou des versions utilisées)</em><br/> Le mot clef <code data-claire-semantic="bash">Chrome</code> doit être remplacé par le nom de votre navigateur (<code data-claire-semantic="bash">chromium-browser</code> pour Chromium, <code data-claire-semantic="bash">Safari</code> pour Safari)</p></li><li id="r-412857" data-claire-element-id="412857"><p id="r-412856" data-claire-element-id="412856">Chaînage de workers : Il n'est pas possible d'insérer un nouveau Worker à l'intérieur d'un autre Worker.<br/> Il s'agit d'un choix technique de la part de ses développeurs pour des soucis de performance. Espérons qu'un jour cette fonctionnalité soit également disponible pour ces navigateurs.</p></li><li id="r-412859" data-claire-element-id="412859"><p id="r-412858" data-claire-element-id="412858">Le nombre de workers : Pour des raisons de performance, il n'est possible de créer qu'un maximum de 50 workers environ par page, puis la page crashe. Raison de plus pour bien terminer vos workers.</p></li><li id="r-412861" data-claire-element-id="412861"><p id="r-412860" data-claire-element-id="412860">Lorsqu'un listener de type &quot;message&quot; se déclenche, l'attribut <code data-claire-semantic="javascript">origin</code> vaut &quot;&quot; (chaîne vide). Ce qui est assez dommage pour identifier celui qui nous envoie le message.</p></li><li id="r-412863" data-claire-element-id="412863"><p id="r-412862" data-claire-element-id="412862">Il n'est pas possible de fermer un port avec <code data-claire-semantic="javascript">close()</code>.</p></li><li id="r-412865" data-claire-element-id="412865"><p id="r-412864" data-claire-element-id="412864">Il n'est pas possible de terminer un shared-worker avec <code data-claire-semantic="javascript">terminate()</code>. Ce bug est extrêmement contraignant en terme de performance. J'espère qu'il sera corrigé rapidement.</p></li><li id="r-412867" data-claire-element-id="412867"><p id="r-412866" data-claire-element-id="412866">Lorsqu'une erreur survient dans un shared-worker, les threads parents ne sont pas prévenus (<code data-claire-semantic="javascript">worker.onerror</code> ne se déclenche pas).</p></li><li id="r-412869" data-claire-element-id="412869"><p id="r-412868" data-claire-element-id="412868">Lors d'une consommation excessive de mémoire, le worker fait crasher la page. Mis à part l'interruption de tout le code de la page, et de l'inaccessibilité de celle-ci, ce problème n'est pas si grave, car cela permet de protéger l'utilisateur contre un usage abusif du worker.</p></li></ol>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
<span class="arrow"></span>
<span class="next">Tour d&#039;horizon</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
<span class="next">Firefox</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Firefox"></a><h2>Firefox</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
<span class="arrow"></span>
<span class="next">Chrome / Safari (Webkit)</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
<span class="next">Internet Explorer</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-firefox" data-claire-element-id="412881">Firefox</h4><ol id="r-412880" data-claire-element-id="412880"><li id="r-412873" data-claire-element-id="412873"><p id="r-412872" data-claire-element-id="412872">Les shared-workers : Les shared-workers ne sont absolument pas supportés.</p></li><li id="r-412875" data-claire-element-id="412875"><p id="r-412874" data-claire-element-id="412874">Les MessageChannel : La création d'un canal de communication n'est absolument pas supportée.</p></li><li id="r-412877" data-claire-element-id="412877"><p id="r-412876" data-claire-element-id="412876">Lorsqu'un listener de type &quot;message&quot; se déclenche, l'attribut <code data-claire-semantic="javascript">origin</code> vaut &quot;&quot; (chaine vide). Ce qui est assez dommage pour identifier celui qui nous envoie le message.</p></li><li id="r-412879" data-claire-element-id="412879"><p id="r-412878" data-claire-element-id="412878">Lors d'une consommation excessive de mémoire, le worker ne continue plus sa tâche et ne répond plus au thread principal (même au <code data-claire-semantic="javascript">terminate()</code>). C'est un comportement extrêmement gênant dans des situations critiques.</p></li></ol>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
<span class="arrow"></span>
<span class="next">Chrome / Safari (Webkit)</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
<span class="next">Internet Explorer</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="InternetExplorer"></a><h2>Internet Explorer</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
<span class="arrow"></span>
<span class="next">Firefox</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
<span class="next">Opera</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-internet-explorer-4" data-claire-element-id="412887">Internet Explorer</h4><aside id="r-412883" data-claire-element-id="412883" data-claire-semantic="information"><p id="r-412882" data-claire-element-id="412882">À l'heure où j'écris ces lignes, Internet Explorer 10 n'est pas encore disponible et je n'ai donc pas pu le tester. Il n'est donc pas possible actuellement de connaître le détail de son support.</p></aside><ol id="r-412886" data-claire-element-id="412886"><li id="r-412885" data-claire-element-id="412885"><p id="r-412884" data-claire-element-id="412884">Les shared-workers : Les shared-workers ne sont absolument pas supportés (selon Microsoft).</p></li></ol>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
<span class="arrow"></span>
<span class="next">Firefox</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
<span class="next">Opera</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Opera"></a><h2>Opera</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
<span class="arrow"></span>
<span class="next">Internet Explorer</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">
<span class="next">TP : jeu du Gomoku</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-opera-1" data-claire-element-id="412902">Opera</h4><ol id="r-412900" data-claire-element-id="412900"><li id="r-412889" data-claire-element-id="412889"><p id="r-412888" data-claire-element-id="412888">Après un importScripts, un deuxième importScripts avec le ou les mêmes fichiers ne fonctionne pas.</p></li><li id="r-412891" data-claire-element-id="412891"><p id="r-412890" data-claire-element-id="412890">Dans un worker, <code data-claire-semantic="javascript">addEventListener(&quot;error&quot;,f,false);</code> ne fonctionne pas sauf si <code data-claire-semantic="javascript">self.onerror</code> est défini.</p></li><li id="r-412893" data-claire-element-id="412893"><p id="r-412892" data-claire-element-id="412892">Avec <code data-claire-semantic="javascript">self.onerror</code> (ou avec <code data-claire-semantic="javascript">addEventListener</code>), l'événement créé n'est pas un objet mais une chaîne de caractères correspondant au message d'erreur.</p></li><li id="r-412895" data-claire-element-id="412895"><p id="r-412894" data-claire-element-id="412894">Lorsqu'une erreur survient dans un shared-worker, les threads parents ne sont pas prévenus (<code data-claire-semantic="javascript">worker.onerror</code> ne se déclenche pas).</p></li><li id="r-412897" data-claire-element-id="412897"><p id="r-412896" data-claire-element-id="412896">Il n'est pas possible de créer un worker inline (la création d'un Blob et la création d'une URL à partir d'un objet ne fonctionnent pas)</p></li><li id="r-412899" data-claire-element-id="412899"><p id="r-412898" data-claire-element-id="412898">Le nombre de workers : Pour des raisons de performance, il n'est possible de créer qu'un maximum de 16 workers par page ou de 128 workers par session. Ensuite toute tentative de créer un nouveau worker générera une erreur de type QUOTA_EXCEEDED_ERR. Raison de plus pour bien terminer vos workers.<br/> Ces limites sont configurables par l'utilisateur (dans le <code data-claire-semantic="html">opera:config</code>).</p></li></ol><p id="r-412901" data-claire-element-id="412901">Vous voilà prêt à affronter les différences entre les navigateurs. Mais n'oubliez pas que ces différences peuvent changer à chaque sortie d'une nouvelle version d'un navigateur.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
<span class="arrow"></span>
<span class="next">Internet Explorer</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">
<span class="next">TP : jeu du Gomoku</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="TPjeuduGomoku"></a><h2>TP : jeu du Gomoku</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
<span class="arrow"></span>
<span class="next">Opera</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
<span class="next">Présentation de l&#039;exercice</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-412904" data-claire-element-id="412904">Nous allons finir ce tutoriel par quelques exercices afin de consolider votre maîtrise des web-workers.</p><p id="r-412905" data-claire-element-id="412905">Dans l'exercice principal, nous allons améliorer le confort de l'utilisateur d'un jeu grâce aux web-workers. Vous trouverez aussi à la fin de ce chapitre d'autres exercices mais qui ne seront pas commentés : il n'y aura que l'énoncé et une solution possible.</p><p id="r-412906" data-claire-element-id="412906">Les solutions peuvent bien sûr être améliorées, elles n'ont été écrites que pour répondre à l'exercice et rester le plus compréhensible possible.</p>
</div><a name="Prsentationdel039exercice"></a><h2>Présentation de l&#039;exercice</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">
<span class="arrow"></span>
<span class="next">TP : jeu du Gomoku</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
<span class="next">Correction</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-presentation-de-l-exercice-7" data-claire-element-id="412931">Présentation de l'exercice</h4><p id="r-412907" data-claire-element-id="412907">À partir d'un jeu de gomoku, l'ordinateur (une IA) répond aux coups d'un joueur.<br/> Le sujet de cet exercice consiste à rendre la page disponible pendant que l'IA du jeu fonctionne. Le but sera aussi d'informer l'utilisateur de l'avancée de la recherche de l'IA.</p><h5 id="r-quelques-explications-14" data-claire-element-id="412910">Quelques explications</h5><p id="r-412908" data-claire-element-id="412908">Le gomoku est un jeu de stratégie où le but est d'aligner 5 pions de sa couleur. Un pion joué ne peut plus être bougé. Chaque joueur joue à tour de rôle, les noirs commencent. Si le plateau est rempli et qu'aucun joueur n'a réussi à gagner, la partie est déclarée nulle.</p><p id="r-412909" data-claire-element-id="412909">Cela ressemble au morpion, mais sur un plateau plus grand et où il faut aligner plus de pions.</p><h5 id="r-a-vous-de-jouer-23" data-claire-element-id="412930">À vous de jouer</h5><p id="r-412911" data-claire-element-id="412911">N'oubliez pas qu'il n'existe pas une seule solution, et que chacun peut avoir une conception différente. Seul le résultat est important.</p><p id="r-412912" data-claire-element-id="412912">Je rappelle que le but est de permettre à l'utilisateur une interface fluide dans laquelle il peut continuer à agir pendant que l'IA cherche une solution. La performance n'est pas le sujet de ce TP.</p><h6 id="r-le-jeu-sans-worker" data-claire-element-id="412924">Le jeu sans worker</h6><p id="r-412913" data-claire-element-id="412913">Voici les codes de bases d'un jeu de Gomoku.</p><div id="r-412922" data-claire-element-id="412922"><p id="r-412914" data-claire-element-id="412914">Le HTML :</p><pre id="r-412915" data-claire-element-id="412915"><code data-claire-semantic="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
	&lt;head&gt;
		&lt;meta charset=&quot;utf-8&quot;/&gt;
		&lt;title&gt;TP : jeu du Morpion&lt;/title&gt;
		&lt;style&gt;
			table{
				background-color:#FFCC66;
			}
			td{
				border: 1px solid black;
				border-radius: 25px;
				width: 25px;
				height:25px;
				cursor:pointer;
			}
			td.empty{
				background-color:inherit;
			}
			td.noir{
				background-color:#000000;
				box-shadow: inset 4px 3px 20px -6px #146717;
			}
			td.blanc{
				background-color:#EEEEFF;
				box-shadow: inset 4px 3px 20px -6px #7f8f8f;
			}
			fieldset{
				display: inline-block;
			}
			fieldset label{
				display: block;
			}
		&lt;/style&gt;
	&lt;/head&gt;
	&lt;body&gt;
		&lt;script src=&quot;./grille.js&quot;&gt;&lt;/script&gt;
		&lt;script src=&quot;./IA.js&quot;&gt;&lt;/script&gt;
	&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-412916" data-claire-element-id="412916">Le javascript permettant de gérer l'affichage de la grille et la gestion du jeu :</p><pre id="r-412917" data-claire-element-id="412917"><code data-claire-semantic="javascript">var nx = 7; //nombre de cellules en largeur
var ny = 7; //nombre de cellules en hauteur
var nbAligne = 5; //nombre de jetons à aligner pour gagner
var couleurTour = 1; //couleur dont c'est le tour
var continueJeu = false; //permet d'indiquer si le jeu est arrêté ou non

var iaProfondeurMax = 4; //indique la profondeur de recherche de l'IA
var iaNoir = false; //indique si le joueur noir est une IA
var iaBlanc = true; //indique si le joueur blanc est une IA

var grille = []; //grille du jeu
var iaWorker; // worker gérant l'IA (si le navigateur supportent les workers)

var elemTable; //élément contenant les éléments d'affichage du jeu
var elemIA; //élément indiquant que l'ordinateur réfléchi
var progressIA; //élément permettant d'indiquer où en est l'ordinateur


//Affichage des éléments pour le paramétrage
function affichageDOM(){
	//Règles
	var fieldset = document.createElement(&quot;fieldset&quot;);
	var legend = document.createElement(&quot;legend&quot;);
	legend.textContent = &quot;Règles&quot;;
	fieldset.appendChild(legend);

	//NX
	var label = document.createElement(&quot;label&quot;);
	label.textContent = &quot;Largeur :&quot;;
	var inputNX = document.createElement(&quot;input&quot;);
	inputNX.type=&quot;number&quot;;
	inputNX.min=1;
	inputNX.value=nx;
	label.appendChild(inputNX);
	fieldset.appendChild(label);

	//NY
	label = document.createElement(&quot;label&quot;);
	label.textContent = &quot;Hauteur :&quot;;
	var inputNY = document.createElement(&quot;input&quot;);
	inputNY.type=&quot;number&quot;;
	inputNY.min=1;
	inputNY.value=ny;
	label.appendChild(inputNY);
	fieldset.appendChild(label);

	//aligne
	label = document.createElement(&quot;label&quot;);
	label.textContent = &quot;Nombre de jetons à aligner pour gagner :&quot;;
	var inputAlign = document.createElement(&quot;input&quot;);
	inputAlign.type=&quot;number&quot;;
	inputAlign.min=1;
	inputAlign.value=nbAligne;
	label.appendChild(inputAlign);
	fieldset.appendChild(label);

	document.body.appendChild(fieldset);

	//Pour l'IA
	fieldset = document.createElement(&quot;fieldset&quot;);
	legend = document.createElement(&quot;legend&quot;);
	legend.textContent = &quot;configuration de l'IA&quot;;
	fieldset.appendChild(legend);

	//IA noir?
	label = document.createElement(&quot;label&quot;);
	label.textContent = &quot;Le joueur noir est un ordinateur :&quot;;
	input = document.createElement(&quot;input&quot;);
	input.type=&quot;checkbox&quot;;
	input.checked=false;
	input.onchange=function(){
		iaNoir=this.checked;
		iaToPlay(); //on vérifie si c'est au tour de l'IA de jouer
	};
	label.appendChild(input);
	fieldset.appendChild(label);

	//IA blanc?
	label = document.createElement(&quot;label&quot;);
	label.textContent = &quot;Le joueur blanc est un ordinateur :&quot;;
	input = document.createElement(&quot;input&quot;);
	input.type=&quot;checkbox&quot;;
	input.checked=true;
	input.onchange=function(){
		iaBlanc=this.checked;
		iaToPlay(); //on vérifie si c'est au tour de l'IA de jouer
	};
	label.appendChild(input);
	fieldset.appendChild(label);

	//Profondeur
	label = document.createElement(&quot;label&quot;);
	label.textContent = &quot;Profondeur de recherche :&quot;;
	input = document.createElement(&quot;input&quot;);
	input.type=&quot;number&quot;;
	input.min=1;
	input.value=iaProfondeurMax;
	input.onchange=function(){iaProfondeurMax=parseInt(this.value,10);};
	label.appendChild(input);
	fieldset.appendChild(label);

	document.body.appendChild(fieldset);

	//bouton permettant de lancer la partie
	var btnStart = document.createElement(&quot;button&quot;);
	btnStart.textContent = &quot;Commencer&quot;;
	btnStart.onclick=function(){
		nx = parseInt(inputNX.value,10);
		ny = parseInt(inputNY.value,10);
		nbAligne = parseInt(inputAlign.value,10);
		init();
	}
	document.body.appendChild(btnStart);

	//Indicateur que l'ordinateur réfléchit
	elementIA = document.createElement(&quot;div&quot;);
	elementIA.textContent = &quot;L'ordinateur est en train de réfléchir...&quot;;
	elementIA.style.visibility = &quot;hidden&quot;;
	document.body.appendChild(elementIA);


	document.body.appendChild(document.createElement(&quot;hr&quot;));
}

window.addEventListener(&quot;load&quot;,affichageDOM,false);

//Initialisation d'une partie
function init(){

	//initialisation de la grille
	for(var x=0;x&lt;nx;x++){
		grille[x] = [];
		for(var y=0;y&lt;ny;y++){
			grille[x][y] = 0;
		}
	}

	//suppression de l'élément HTML de la grille précédente
	if(elemTable){
		document.body.removeChild(elemTable);
	}

	//affichage de la grille de jeu
	elemTable = document.createElement(&quot;table&quot;);
	var row,cel;
	for(y=0;y&lt;ny;y++){
		row = elemTable.insertRow(-1);
		for(x=0;x&lt;nx;x++){
			cel = row.insertCell(-1);
			cel.id = &quot;grille&quot;+x+&quot;_&quot;+y;
			cel.onclick=setClick(x,y);
			switch(grille[x][y]){
				case 1:
					cel.className = &quot;noir&quot;;
					break;
				case 2:
					cel.className = &quot;blanc&quot;;
					break;
				case 0:
				default:
					cel.className = &quot;empty&quot;;
			}
		}
	}
	document.body.appendChild(elemTable);
	couleurTour = 1;
	continueJeu = true;
	iaToPlay(); //on vérifie si c'est au tour de l'IA de jouer
};

//permet de changer la couleur lors d'un coup
function changeCouleur(x,y){
	grille[x][y]=couleurTour;
	var elem = document.getElementById(&quot;grille&quot;+x+&quot;_&quot;+y);
	if(elem){
		elem.className=couleurTour===1?&quot;noir&quot;:&quot;blanc&quot;;
	}
}

//permet de jouer un coup en x,y
function joue(x,y){
	if(!continueJeu) return false;
	if(grille[x][y]) return false;
	var rslt;
	changeCouleur(x,y);
	couleurTour = couleurTour%2+1;
	if(rslt=verifVainqueur(x,y)){
		continueJeu = false;
		alert((rslt===1?&quot;Noirs&quot;:&quot;Blancs&quot;)+&quot; vainqueurs&quot;);
	}

	if(!verifNbLibre()){
		continueJeu = false;
		alert(&quot;Parie nulle : égalité&quot;);
	}

	//est-ce que le prochain coup doit être joué par l'IA ?
	iaToPlay();
}

//est-ce que le prochain coup doit être joué par l'IA ?
function iaToPlay(){
	if(!continueJeu) return false;
	if((couleurTour === 1 &amp;&amp; iaNoir) || (couleurTour === 2 &amp;&amp; iaBlanc)){
		continueJeu = false; //pour empêcher un humain de jouer
		elementIA.style.visibility = &quot;visible&quot;;
		setTimeout(function(){
			var rslt = iaJoue(grille,couleurTour);
			continueJeu = true;
			elementIA.style.visibility = &quot;hidden&quot;;
			joue(rslt[0],rslt[1]);
		},10); //au cas où deux ordi jouent ensemble et pour voir le coup pendant que l'IA réfléchit
	}
}

//permet de créer une fonction listener sur un élément x,y
function setClick(x,y){
	return function(){
		joue(x,y);
	};
}

//permet de vérifier s'il reste des coups jouables
function verifNbLibre(){
	var nbLibre=0;
	for(var x=0;x&lt;nx;x++){
		for(var y=0;y&lt;ny;y++){
			if(grille[x][y]===0){
				nbLibre++;
			}
		}
	}
	return nbLibre;
}

//permet de vérifier s'il y a un vainqueur (en ne regardant que le dernier coup joué)
function verifVainqueur(x,y,vGrille){
	vGrille = vGrille || grille;
	var col = vGrille[x][y]; //couleur du jeton qui vient d'être joué
	var alignH = 1; //nombre de jetons alignés horizontalement
	var alignV = 1; //nombre de jetons alignés verticalement
	var alignD1 = 1; //nombre de jetons alignés diagonalement NO-SE
	var alignD2 = 1; //nombre de jetons alignés diagonalement SO-NE
	var xt,yt;

	//vérification horizontale
	xt=x-1;
	yt=y;
	while(xt&gt;=0 &amp;&amp; vGrille[xt][yt]===col){
		xt--;
		alignH++;
	}
	xt=x+1;
	yt=y;
	while(xt&lt;nx &amp;&amp; vGrille[xt][yt]===col){
		xt++;
		alignH++;
	}

	//vérification verticale
	xt=x;
	yt=y-1;
	while(yt&gt;=0 &amp;&amp; vGrille[xt][yt]===col){
		yt--;
		alignV++;
	}
	xt=x;
	yt=y+1;
	while(yt&lt;ny &amp;&amp; vGrille[xt][yt]===col){
		yt++;
		alignV++;
	}

	//vérification diagonale NO-SE
	xt=x-1;
	yt=y-1;
	while(xt&gt;=0 &amp;&amp; yt&gt;=0 &amp;&amp; vGrille[xt][yt]===col){
		xt--;
		yt--;
		alignD1++;
	}
	xt=x+1;
	yt=y+1;
	while(xt&lt;nx &amp;&amp; yt&lt;ny &amp;&amp; vGrille[xt][yt]===col){
		xt++;
		yt++;
		alignD1++;
	}

	//vérification diagonale SO-NE
	xt=x-1;
	yt=y+1;
	while(xt&gt;=0 &amp;&amp; yt&lt;ny &amp;&amp; vGrille[xt][yt]===col){
		xt--;
		yt++;
		alignD2++;
	}
	xt=x+1;
	yt=y-1;
	while(xt&lt;nx &amp;&amp; yt&gt;=0 &amp;&amp; vGrille[xt][yt]===col){
		xt++;
		yt--;
		alignD2++;
	}

	//parmis tous ces résultats on regarde s'il y en a un qui dépasse le nombre nécessaire pour gagner
	if(Math.max(alignH,alignV,alignD1,alignD2)&gt;=nbAligne){
		return col;
	}else{
		return 0;
	}
}</code></pre><p id="r-412918" data-claire-element-id="412918">Le javascript permettant de gérer l'Intelligence Artificielle :</p><pre id="r-412919" data-claire-element-id="412919"><code data-claire-semantic="javascript">//demande à l'IA de jouer
function iaJoue(grilleOrig,couleur){
	var grille = copieGrille(grilleOrig);
	return iaAlphaBeta(grille, couleur, 0, -Infinity, Infinity);
}

//fonction gérant l'algorithme minimax et l'élagage alpha-beta
function iaAlphaBeta(grille, couleur, profondeur, alpha, beta){
	if(profondeur === iaProfondeurMax){
		//on a atteint la limite de profondeur de calcul on retourne donc une estimation de la position actuelle
		if(couleur === 1){
			return iaEstimation(grille);
		}else{
			return -iaEstimation(grille);
		}
	}else{
		var meilleur = -Infinity; //estimation du meilleur coup actuel
		var estim; //estimation de la valeur d'un coup
		var coup=null; //meilleur coup actuel
		var couleurOpp = couleur%2+1; //optimisation pour calculer la couleur adverse

		//on va essayer toutes les combinaisons possibles
		for(var x=0;x&lt;nx;x++){
			for(var y=0;y&lt;ny;y++){
				if(grille[x][y]) continue; //case déjà occupée

				if(!coup){coup=[x,y];} //pour proposer au moins un coup

				grille[x][y]=couleur; //on va essayer avec ce coup
				//vérifie si le coup est gagnant
				if(estim=verifVainqueur(x,y,grille)){
					grille[x][y]=0; //restauration de la grille
					if(!profondeur){
						return [x,y];
					}else{
						return Infinity;
					}
				}
				estim = -iaAlphaBeta(grille, couleurOpp, profondeur+1, -beta, -alpha); //on calcule la valeur de ce coup

				if(estim &gt; meilleur){
					//on vient de trouver un meilleur coup
					meilleur = estim;
					if(meilleur &gt; alpha){
						alpha = meilleur;
						coup = [x,y];
						if(alpha &gt;= beta){
					/*ce coup est mieux que le meilleur des coups qui aurait pu être joué si on avait joué un autre
					coup. Cela signifie que jouer le coup qui a amené cette position n'est pas bon. Il est inutile
					de continuer à estimer les autres possibilités de cette position (principe de l'élagage alpha-beta). */
							grille[x][y]=0; //restauration de la grille
							if(!profondeur){
								return coup;
							}else{
								return meilleur;
							}
						}
					}
				}
				grille[x][y]=0; //restauration de la grille
			}
		}
		if(!profondeur){
			return coup;
		}else{
			if(coup) return meilleur;
			else return 0; //si coup n'a jamais été défini c'est qu'il n'y a plus de possibilité de jeu. C'est partie nulle.
		}
	}
}


//permet d'estimer la position
function iaEstimation(grille){
	var estimation = 0; //estimation globale de la position

	for(var x=0;x&lt;nx;x++){
		for(var y=0;y&lt;ny;y++){
			if(!grille[x][y]) continue;
			//estimation de la valeur de ce jeton et ajout au calcul d'estimation global
			switch(grille[x][y]){
				case 1:
					estimation += iaAnalyse(grille,x,y);
					break;
				case 2: 
					estimation -= iaAnalyse(grille,x,y);
					break;
			}
		}
	}
	return estimation;
}

//permet de calculer le nombre de &quot;libertés&quot; pour la case donnée
function iaAnalyse(grille,x,y){
	var couleur = grille[x][y];
	var estimation = 0; //estimation pour toutes les directions
	var compteur = 0; //compte le nombre de possibilités pour une direction
	var centre = 0; //regarde si le jeton a de l'espace de chaque côté
	var bonus = 0; //point bonus liée aux jetons alliés dans cette même direction
	var i,j; //pour les coordonnées temporaires
	var pass=false; //permet de voir si on a passé la case étudiée
	var pLiberte = 1; //pondération sur le nombre de liberté
	var pBonus = 1; //pondération Bonus
	var pCentre = 2; //pondération pour l'espace situé de chaque côté

	//recherche horizontale
	for(i=0;i&lt;nx;i++){
		if(i==x){
			centre = compteur++;
			pass=true;
			continue;
		}
		switch(grille[i][y]){
			case 0: //case vide
				compteur++;
				break;
			case couleur: //jeton allié
				compteur++;
				bonus++;
				break;
			default: //jeton adverse
				if(pass){
					i=nx; //il n'y aura plus de liberté supplémentaire, on arrête la recherche ici
				}else{
					//on réinitialise la recherche
					compteur = 0;
					bonus = 0;
				}
		}
	}
	if(compteur&gt;=nbAligne){
		//il est possible de gagner dans cette direction
		estimation += compteur*pLiberte + bonus*pBonus + (1-Math.abs(centre/(compteur-1)-0.5))*compteur*pCentre;
	}

	//recherche verticale
	compteur=0;
	bonus=0;
	pass=false;
	for(j=0;j&lt;ny;j++){
		if(j==y){
			centre=compteur++;
			pass=true;
			continue;
		}
		switch(grille[x][j]){
			case 0: //case vide
				compteur++;
				break;
			case couleur: //jeton allié
				compteur++;
				bonus++;
				break;
			default: //jeton adverse
				if(pass){
					j=ny; //il n'y aura plus de liberté supplémentaire, on arrête la recherche ici
				}else{
					//on réinitialise la recherche
					compteur = 0;
					bonus = 0;
				}
		}
	}
	if(compteur&gt;=nbAligne){
		//il est possible de gagner dans cette direction
		estimation += compteur*pLiberte + bonus*pBonus + (1-Math.abs(centre/(compteur-1)-0.5))*compteur*pCentre;
	}

	//recherche diagonale (NO-SE)
	compteur=0;
	bonus=0;
	i=x;
	j=y;
	while(i--&gt;0 &amp;&amp; j--&gt;0){
		switch(grille[i][j]){
			case 0: //case vide
				compteur++;
				break;
			case couleur: //jeton allié
				compteur++;
				bonus++;
				break;
			default: //jeton adverse, on arrête de rechercher
				i=0;
		}
	}
	centre=compteur++;
	i=x;
	j=y;
	while(++i&lt;nx &amp;&amp; ++j&lt;ny){
		switch(grille[i][j]){
			case 0: //case vide
				compteur++;
				break;
			case couleur: //jeton allié
				compteur++;
				bonus++;
				break;
			default: //jeton adverse, on arrête de rechercher
				i=nx;
		}
	}
	if(compteur&gt;=nbAligne){
		//il est possible de gagner dans cette direction
		estimation += compteur*pLiberte + bonus*pBonus + (1-Math.abs(centre/(compteur-1)-0.5))*compteur*pCentre;
	}

	//recherche diagonale (NE-SO)
	compteur=0;
	bonus=0;
	i=x;
	j=y;
	while(i--&gt;0 &amp;&amp; ++j&lt;ny){
		switch(grille[i][j]){
			case 0: //case vide
				compteur++;
				break;
			case couleur: //jeton allié
				compteur++;
				bonus++;
				break;
			default: //jeton adverse, on arrête de rechercher
				i=0;
		}
	}
	centre=compteur++;
	i=x;
	j=y;
	while(++i&lt;nx &amp;&amp; j--&gt;0){
		switch(grille[i][j]){
			case 0: //case vide
				compteur++;
				break;
			case couleur: //jeton allié
				compteur++;
				bonus++;
				break;
			default: //jeton adverse, on arrête de rechercher
				i=nx;
		}
	}
	if(compteur&gt;=nbAligne){
		//il est possible de gagner dans cette direction
		estimation += compteur*pLiberte + bonus*pBonus + (1-Math.abs(centre/(compteur-1)-0.5))*compteur*pCentre;
	}

	return estimation;
}

//permet de copier une grille, cela permet d'éviter de modifier par inadvertance la grille de jeu originale
function copieGrille(grille){
	var nvGrille=[];
	for(var x=0;x&lt;nx;x++){
		nvGrille[x]=grille[x].concat([]);//effectue une copie de la liste
	}
	return nvGrille;
}</code></pre><p id="r-412920" data-claire-element-id="412920">Dans cette IA, l'algorithme principal est un Minimax avec un élagage alpha-beta. Il s'agit d'une recherche en profondeur d'abord. Même si vous ne comprenez pas comment il fonctionne, ce qu'il faut retenir c'est que la fonction principale est <code data-claire-semantic="javascript">iaAlphaBeta</code> ; il s'agit d'une fonction récursive (elle se rappelle elle-même en fonction de la profondeur recherchée).</p><p id="r-412921" data-claire-element-id="412921">Dans un algorithme Minimax, l'estimation d'une position est très importante. Dans ce code, l'estimation est gérée par les fonctions <code data-claire-semantic="javascript">iaEstimation</code> et <code data-claire-semantic="javascript">iaAnalyse</code>. L'estimation est basée sur le nombre de pions alliés et le nombre de cases vides autour de chaque pion. Cette estimation est très coûteuse, et il existe de nombreuses autre estimations plus rapides. Mais le sujet de ce TP n'est pas la performance mais d'améliorer le ressenti de l'utilisateur.</p></div><p id="r-412923" data-claire-element-id="412923"><a href="http://restimel.github.com/Tutoriels/webWorkers/TP_gomoku/sansWorker/index.html">Essayer le jeu sans les workers !</a></p><h6 id="r-des-problemes-2" data-claire-element-id="412929">Des problèmes</h6><p id="r-412925" data-claire-element-id="412925">Comme vous pouvez le remarquer, il souffre de quelques défauts lorsque l'ordinateur prend du temps pour réfléchir (si sur votre ordinateur, cela ne prend pas beaucoup de temps, vous pouvez agrandir le plateau ou augmenter la profondeur de recherche).<br/> On ne sait pas combien de temps on doit encore attendre avant que l'ordinateur joue son coup.</p><p id="r-412926" data-claire-element-id="412926">Pire si le plateau est particulièrement grand ou si la profondeur de recherche est importante, un message apparaît demandant s'il faut interrompre le script.</p><p id="r-412927" data-claire-element-id="412927">De plus lorsqu'on clique sur une case pour voir si le jeu réagit, ce coup sera joué lorsque l'ordinateur rend la main...</p><p id="r-412928" data-claire-element-id="412928">Tout ceci n'est pas très joli, mais vous allez pouvoir l'améliorer en utilisant la technologie des workers :) .</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">
<span class="arrow"></span>
<span class="next">TP : jeu du Gomoku</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
<span class="next">Correction</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Correction"></a><h2>Correction</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
<span class="arrow"></span>
<span class="next">Présentation de l&#039;exercice</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
<span class="next">Exercice supplémentaire : traitement d&#039;image</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-correction-142" data-claire-element-id="413043">Correction</h4><p id="r-412932" data-claire-element-id="412932">Avant de se lancer dans un code en intégrant les workers, il est toujours utile de commencer par réaliser un code qui fonctionne sans web-worker.<br/> Tout d'abord cela nous permet de déboguer plus facilement le code.<br/> Ensuite, puisque nous avons déjà écrit ce code, il est plus facile de proposer une solution alternative à ceux qui utilisent un navigateur ne supportant pas les web-workers.<br/> Et enfin, une fois cette phase finie, on peut juger si les workers apporteront vraiment quelque chose au programme. On peut alors se rendre compte qu'il est inutile de rendre son code plus complexe (car cela le rendra aussi plus difficile à maintenir) et de s'arrêter là.</p><p id="r-412933" data-claire-element-id="412933">Dans le cas de ce TP, le code sans worker était déjà fourni (à moins que vous ne l'ayez écrit vous-même :soleil: ) et la liste de ses défauts a déjà été exposée.<br/> Nous allons donc nous atteler à la tâche pour ajouter un worker.</p><h5 id="r-explication-de-la-mise-en-place-d-un-worker" data-claire-element-id="413012">Explication de la mise en place d'un worker</h5><p id="r-412934" data-claire-element-id="412934">Tout d'abord il est important de cerner les fonctions qui devront être externalisées dans le worker. Pour cela il faut avoir une idée précise de la manière dont il sera utilisé.<br/> Ensuite on pourra effectuer les modifications pour rendre le code compatible avec un worker.<br/> Et enfin créer toutes les communications utiles à chaque thread.</p><h6 id="r-analyse-des-besoins" data-claire-element-id="412945">Analyse des besoins</h6><p id="r-412935" data-claire-element-id="412935">Dans ce TP, le problème principal est le temps de réflexion de l'IA. Comme le but n'est pas d'améliorer la performance de l'IA (ceci serait un sujet d'algorithmie), nous allons donc placer toute la partie réflexion de l'IA dans un worker. Ainsi le thread principal sera libéré et l'utilisateur ne se retrouvera pas devant une page figée ou avec un message l'incitant à interrompre le script.</p><p id="r-412936" data-claire-element-id="412936">Pour faire fonctionner cette IA dans un thread séparé, il faudra lui envoyer la grille de jeu (à partir de laquelle elle doit trouver le meilleur coup), les règles et les options (profondeur de recherche, et le nombre de pions à aligner), et bien sûr la couleur avec laquelle elle doit maintenant jouer.</p><p id="r-412937" data-claire-element-id="412937">Ainsi la séparation est déjà faite : le fichier grille.js sera le thread principal, et le fichier IA.js correspondra à notre fichier de base pour le worker.</p><p id="r-412938" data-claire-element-id="412938">Si vous regardez bien la fonction <code data-claire-semantic="javascript">iaAlphaBeta</code>, vous pouvez remarquer qu'elle fait appel à la fonction <code data-claire-semantic="javascript">verifVainqueur</code> afin de voir si un coup donne un gagnant. Or cette fonction fait partie du fichier grille.js et est utilisée dans celui-ci (dans la fonction <code data-claire-semantic="javascript">joue</code>).</p><div id="r-412940" data-claire-element-id="412940" data-claire-semantic="question"><p id="r-412939" data-claire-element-id="412939">Mais alors que faire ?</p></div><p id="r-412941" data-claire-element-id="412941">La première idée qu'on a est de copier cette fonction dans le fichier IA.js. Certes cela fonctionnera.<br/> Mais imaginons que plus tard, vous désireriez changer les règles. Cela peut arriver si vous avez remarqué une erreur, ou si vous voulez ajouter des options (par exemple, un joueur ne gagne que s'il a strictement 5 pions alignés).<br/> Il ne faudra pas oublier d'effectuer vos modifications dans les deux fonctions !</p><p id="r-412942" data-claire-element-id="412942">Rappelez-vous ce que vous avez appris dans le chapitre précèdent : <code data-claire-semantic="javascript">importScripts</code>.<br/> Grâce à <code data-claire-semantic="javascript">importScripts</code> on pourra écrire la fonction dans un fichier et l'appeler dans chaque thread.<br/> Ainsi si une modification doit être apportée, il ne faudra l'effectuer qu'une seule fois ! :magicien:</p><p id="r-412943" data-claire-element-id="412943">On va donc déplacer la fonction <code data-claire-semantic="javascript">verifVainqueur</code> dans un fichier verifFin.js.<br/> Il ne faut pas oublier d'ajouter l'appel à ce fichier dans le fichier html :</p><pre id="r-412944" data-claire-element-id="412944"><code data-claire-semantic="html">&lt;script src=&quot;./verifFin.js&quot;&gt;&lt;/script&gt;</code></pre><h6 id="r-preparation-du-worker" data-claire-element-id="412964">Préparation du worker</h6><p id="r-412946" data-claire-element-id="412946">Maintenant que la stratégie est prête, place à l'action !</p><p id="r-412947" data-claire-element-id="412947">Tout d'abord, il va falloir enlever l'appel au fichier IA.js.</p><pre id="r-412948" data-claire-element-id="412948"><code data-claire-semantic="html">&lt;script src=&quot;./IA.js&quot;&gt;&lt;/script&gt;</code></pre><p id="r-412949" data-claire-element-id="412949">Dans le thread principal (donc le fichier grille.js), on ajoute une variable globale qui contiendra l'instance du worker :</p><pre id="r-412950" data-claire-element-id="412950"><code data-claire-semantic="javascript">var iaWorker; // worker gérant l'IA (si le navigateur supporte les workers)</code></pre><p id="r-412951" data-claire-element-id="412951">Le but est aussi de proposer une solution aux utilisateurs ayant un navigateur ne supportant pas les workers. Il suffit de tester l'existence du constructeur <code data-claire-semantic="javascript">Worker</code> et de proposer un contournement sinon.<br/> Le contournement consiste simplement à exécuter le script IA.js dynamiquement :</p><pre id="r-412952" data-claire-element-id="412952"><code data-claire-semantic="javascript">if(window.Worker){
    iaWorker = new Worker(&quot;./IA.js&quot;);
}else{
    //solution du substitution au worker
    iaWorker = document.createElement(&quot;script&quot;);
    iaWorker.src = &quot;./IA.js&quot;;
    document.body.appendChild(iaWorker);
    iaWorker = null; //afin que iaWorker ne soit définit QUE si le worker existe
}</code></pre><p id="r-412953" data-claire-element-id="412953">Comme on souhaite ajouter une information concernant la progression de la recherche de l'IA, on ajoute également une variable globale qui contiendra une référence à l'élément HTML donnant cette information.</p><pre id="r-412954" data-claire-element-id="412954"><code data-claire-semantic="javascript">var progressIA; //élément permettant d'indiquer où en est l'ordinateur</code></pre><p id="r-412955" data-claire-element-id="412955">Il reste maintenant à créer cet élément et le lier au document. Ainsi dans la fonction <code data-claire-semantic="javascript">affichageDOM</code>, on ajoute :</p><pre id="r-412956" data-claire-element-id="412956"><code data-claire-semantic="javascript">//barre de progression indiquant l'avancée de la recherche de l'ordinateur
progressIA = document.createElement(&quot;progress&quot;);
progressIA.max = 100;
elementIA.appendChild(progressIA);</code></pre><p id="r-412957" data-claire-element-id="412957">Pour l'instant aucune <code data-claire-semantic="javascript">value</code> n'est définie, afin que la barre utilise le comportement par défaut jusqu'à ce qu'on définisse explicitement une valeur. Le maximum a été défini à 100, il faudra donc définir l'état d'avancement en pourcentage.</p><p id="r-412958" data-claire-element-id="412958">Il ne faut donc pas oublier que maintenant le fichier IA.js peut être appelée de deux manières : soit à l'intérieur d'un worker, soit de manière traditionnelle.<br/> Et il doit pouvoir fonctionner correctement dans les deux cas !</p><p id="r-412959" data-claire-element-id="412959">Ne vous en faites pas, ce ne sera pas si difficile.</p><p id="r-412960" data-claire-element-id="412960">Pour que le code puisse fonctionner dans un worker, il lui manque encore une chose : l'appel à la fonction <code data-claire-semantic="javascript">verifVainqueur</code> qui se trouve maintenant dans le fichier verifFin.js.<br/> Dans le cas où IA.js est appelé hors worker, la fonction <code data-claire-semantic="javascript">verifVainqueur</code> est déjà accessible puisque le fichier a été chargé dans le HTML.</p><p id="r-412961" data-claire-element-id="412961">Il reste donc à charger le fichier dans le cas du worker. En sachant que <code data-claire-semantic="javascript">importScripts</code> est une fonction qui n'existe que dans un worker, on peut en profiter pour définir une variable nous indiquant cet état (ce qui facilitera cette détection ultérieurement) :</p><pre id="r-412962" data-claire-element-id="412962"><code data-claire-semantic="javascript">if(typeof importScripts === &quot;function&quot;){
	//dans le cas d'un worker, on importe le script permettant de vérifier la fin d'une partie
	importScripts(&quot;./verifFin.js&quot;);
	self.inWorker = true;
}else{
	window.inWorker = false;
}</code></pre><p id="r-412963" data-claire-element-id="412963">Voilà maintenant tout le travail préparatoire est terminé. Dans le cas où le navigateur ne supporte pas <code data-claire-semantic="javascript">Worker</code>, le programme doit toujours fonctionner normalement. Pour tester ce bon fonctionnement, il suffit de mal orthographier <code data-claire-semantic="javascript">window.Worker</code>. Vous pouvez ainsi passer en mode sans worker et vérifier que cela fonctionne toujours correctement.</p><h6 id="r-gestion-des-communications" data-claire-element-id="412985">Gestion des communications</h6><p id="r-412965" data-claire-element-id="412965">Actuellement si on teste le fonctionnement de la page avec le Worker, aucune erreur ne devrait apparaître, mais l'IA ne fonctionnera pas car il n'y a actuellement aucune communication.</p><p id="r-412966" data-claire-element-id="412966">Le thread principal n'enverra qu'un seul type de demande : quel coup l'IA désire jouer ?</p><p id="r-412967" data-claire-element-id="412967">Le worker va envoyer deux types de messages :</p><ul id="r-412972" data-claire-element-id="412972"><li id="r-412969" data-claire-element-id="412969"><p id="r-412968" data-claire-element-id="412968">Lorsque l'IA indique quel coup est le meilleur. Ce qui indique aussi que le worker a fini de travailler.</p></li><li id="r-412971" data-claire-element-id="412971"><p id="r-412970" data-claire-element-id="412970">Lors d'une information sur l'avancée de la recherche, qui consistera à mettre à jour la barre de progression</p></li></ul><p id="r-412973" data-claire-element-id="412973">Pour distinguer ces messages, on peut les intégrer à un objet et définir un attribut &quot;commande&quot; avec un mot clef.</p><p id="r-412974" data-claire-element-id="412974">Préparons la réception des messages dans le thread principal.<br/> Au niveau de la création du worker, on peut donc écrire le listener message du worker :</p><pre id="r-412975" data-claire-element-id="412975"><code data-claire-semantic="javascript">iaWorker.onmessage = function(e){
	//réception des messages du workers
	var data = e.data;
	switch(data.cmd){
		case &quot;update&quot;:
			progressIA.value = data.value;
		break;
		case &quot;coup&quot;:
			continueJeu = true;
			elementIA.style.visibility = &quot;hidden&quot;;
			joue(data.x,data.y);
		break;
	}
};</code></pre><p id="r-412976" data-claire-element-id="412976">Pour réaliser la mise à jour, il faut donc envoyer un objet ayant un attribut <code data-claire-semantic="javascript">cmd</code> ayant pour valeur <code data-claire-semantic="javascript">&quot;update&quot;</code> et un attribut <code data-claire-semantic="javascript">value</code> ayant pour valeur l'avancée de la recherche en pourcentage.</p><p id="r-412977" data-claire-element-id="412977">Ce message peut être envoyé depuis la fonction <code data-claire-semantic="javascript">iaAlphaBeta</code>.<br/> Afin d'éviter d'envoyer ce message trop fréquemment, cette information ne sera envoyée que lorsque la profondeur de recherche est à 0, c'est à dire lorsque l'IA explore un nouveau coup qu'elle est susceptible de proposer.</p><pre id="r-412978" data-claire-element-id="412978"><code data-claire-semantic="javascript">//on va essayer toutes les combinaisons possible
for(var x=0;x&lt;nx;x++){
	for(var y=0;y&lt;ny;y++){
		if(grille[x][y]) continue; //case déjà occupée
		if(!profondeur &amp;&amp; inWorker){
			postMessage({cmd:&quot;update&quot;,value:(x*ny+y)*100/(nx*ny)});
		}
		...</code></pre><p id="r-412979" data-claire-element-id="412979">Dans le worker, la réalisation du listener &quot;message&quot; permet d'initialiser toutes les variables utilisées pour la recherche. Une fois celle-ci finie, il ne reste plus qu'à envoyer le résultat selon le modèle défini précédemment.</p><pre id="r-412980" data-claire-element-id="412980"><code data-claire-semantic="javascript">//réception des messages
onmessage = function(e){
	var data = e.data;
	self.iaProfondeurMax = data.profondeur;
	self.nx=data.grille.length;
	self.ny=data.grille[0].length;
	self.nbAligne=data.nbAligne;
	var coup = iaAlphaBeta(data.grille, data.tour, 0, -Infinity, Infinity);
	postMessage({cmd:&quot;coup&quot;,x:coup[0],y:coup[1]});
};</code></pre><p id="r-412981" data-claire-element-id="412981">L'écriture de ce listener permet de montrer exactement les besoins du worker pour fonctionner. Il faut lui envoyer un objet avec les attributs suivants : <code data-claire-semantic="javascript">grille</code>, <code data-claire-semantic="javascript">profondeur</code>, <code data-claire-semantic="javascript">nbAligne</code>, et <code data-claire-semantic="javascript">tour</code>.</p><p id="r-412982" data-claire-element-id="412982">Nous pouvons donc maintenant écrire l'envoi du message qui déclenchera la mise en route de l'IA.<br/> Dans la fonction <code data-claire-semantic="javascript">iaToPlay</code>, il est possible de modifier le déclenchement de l'IA de cette manière :</p><pre id="r-412983" data-claire-element-id="412983"><code data-claire-semantic="javascript">if(iaWorker){
	iaWorker.postMessage({grille:grille,tour:couleurTour,profondeur:iaProfondeurMax,nbAligne:nbAligne});
}else{
	setTimeout(function(){
		var rslt = iaJoue(grille,couleurTour);
		continueJeu = true;
		elementIA.style.visibility = &quot;hidden&quot;;
		joue(rslt[0],rslt[1]);
	},10); //au cas où deux ordi jouent ensemble et pour voir le coup pendant que l'IA réfléchit
}</code></pre><p id="r-412984" data-claire-element-id="412984">À ce stade, le programme répond à l'énoncé : l'utilisateur n'est plus figé sur la page pendant que l'IA réfléchit et il est informé de l'avancée de la recherche.<br/> Toutefois il reste quelques détails qui posent problème, c'est ce que nous allons voir maintenant.</p><h6 id="r-analyse-des-problemes-d-actions-simultanees" data-claire-element-id="413011">Analyse des problèmes d'actions simultanées</h6><p id="r-412986" data-claire-element-id="412986">Imaginez que l'IA est en train de fonctionner, et qu'à ce moment l'utilisateur clique sur le bouton <kbd>Commencer</kbd>, que se passe-t-il ?</p><p id="r-412987" data-claire-element-id="412987">Le jeu est réinitialisé, et une nouvelle grille est affichée. Et quand le worker a fini son travail, un coup est ajouté ! Alors que ce n'était même pas son tour !<br/> Il s'agit d'un problème qui arrive parce que plusieurs tâches peuvent être exécutées en même temps.</p><p id="r-412988" data-claire-element-id="412988">Il y a aussi un autre cas à étudier : lorsque l'utilisateur décide qu'une couleur n'est plus jouée par l'ordinateur.</p><div id="r-412990" data-claire-element-id="412990" data-claire-semantic="question"><p id="r-412989" data-claire-element-id="412989">Comment résoudre ces problèmes ?</p></div><p id="r-412991" data-claire-element-id="412991">Tout d'abord, il devient intéressant de savoir s'il y a une recherche en cours ou non. Pour cela on va attacher une variable <code data-claire-semantic="javascript">playing</code> à notre objet <code data-claire-semantic="javascript">iaWorker</code>.<br/> Il faut donc bien mettre à jour cette variable quand on démarre l'IA (dans <code data-claire-semantic="javascript">iaToPlay</code>).</p><pre id="r-412992" data-claire-element-id="412992"><code data-claire-semantic="javascript">if(iaWorker){
	iaWorker.playing = true;
	iaWorker.postMessage({grille:grille,tour:couleurTour,profondeur:iaProfondeurMax,nbAligne:nbAligne});
}</code></pre><p id="r-412993" data-claire-element-id="412993">Mais il faut aussi la mettre à jour quand celle-ci a fini son travail (dans le listener de &quot;message&quot;).</p><pre id="r-412994" data-claire-element-id="412994"><code data-claire-semantic="javascript">case &quot;coup&quot;:
	continueJeu = true;
	elementIA.style.visibility = &quot;hidden&quot;;
	iaWorker.playing = false;
	joue(data.x,data.y);
	break;</code></pre><p id="r-412995" data-claire-element-id="412995">Maintenant qu'on sait si le worker travaille ou non, nous allons pouvoir corriger les problèmes.<br/> Puisqu'on demande de recommencer une nouvelle partie, cela signifie que le travail du worker est devenu inutile. Il suffit donc de tuer le worker et d'en créer un nouveau qui sera prêt à être lancé.</p><p id="r-412996" data-claire-element-id="412996">Comme on souhaite créer le worker à différents endroits, autant créer une fonction dédiée à cette tâche.</p><pre id="r-412997" data-claire-element-id="412997"><code data-claire-semantic="javascript">//Création d'un worker pour l'IA
function createIAWorker(){
	iaWorker = new Worker(&quot;./IA.js&quot;); //création du worker
	iaWorker.playing = false; // initialement le worker ne travaille pas
	
	iaWorker.onmessage = function(e){
		//réception des messages du workers
		var data = e.data;
		switch(data.cmd){
			case &quot;update&quot;:
				progressIA.value = data.value;
				break;
			case &quot;coup&quot;:
				continueJeu = true;
				elementIA.style.visibility = &quot;hidden&quot;;
				iaWorker.playing = false;
				joue(data.x,data.y);
				break;
		}
	};
	
	iaWorker.onerror = function(e){
		//Gestion des erreurs
		alert(e.message);
	};
}</code></pre><p id="r-412998" data-claire-element-id="412998">Dans la fonction <code data-claire-semantic="javascript">init</code>, on peut donc maintenant écrire :</p><pre id="r-412999" data-claire-element-id="412999"><code data-claire-semantic="javascript">if(iaWorker &amp;&amp; iaWorker.playing){ //si le worker ne travaille pas inutile de le tuer
	iaWorker.terminate();
	createIAWorker();
	elementIA.style.visibility = &quot;hidden&quot;;
}</code></pre><p id="r-413000" data-claire-element-id="413000">Pour ce qui est des changements de joueur humain/IA, il y a plusieurs choix possibles :</p><ol id="r-413007" data-claire-element-id="413007"><li id="r-413002" data-claire-element-id="413002"><p id="r-413001" data-claire-element-id="413001">l'IA continue de travailler, le changement ne sera effectif qu'au prochain tour.</p></li><li id="r-413004" data-claire-element-id="413004"><p id="r-413003" data-claire-element-id="413003">l'humain peut jouer, mais l'IA continue de réfléchir au cas où la case serait à nouveau cochée.</p></li><li id="r-413006" data-claire-element-id="413006"><p id="r-413005" data-claire-element-id="413005">l'humain peut jouer et le travail de l'IA est interrompu. Mais si la case est à nouveau cochée, l'IA doit reprendre de zéro.</p></li></ol><p id="r-413008" data-claire-element-id="413008">Par simplicité, je vais choisir le premier cas. Pourquoi par simplicité ? Simplement par ce qu'il n'y a rien à faire !</p><p id="r-413009" data-claire-element-id="413009">Pour finir une petite amélioration, dans le worker, comme la grille a déjà été copiée lors de l'envoi du message (objet cloné), on peut optimiser légèrement l'IA en évitant la copie de la grille :</p><pre id="r-413010" data-claire-element-id="413010"><code data-claire-semantic="javascript">function iaJoue(grilleOrig,couleur){
	var grille = inWorker?grilleOrig:copieGrille(grilleOrig);
	return iaAlphaBeta(grille, couleur, 0, -Infinity, Infinity);
}</code></pre><h5 id="r-solution-avec-le-worker" data-claire-element-id="413021">Solution avec le worker</h5><p id="r-413013" data-claire-element-id="413013">En effectuant toutes ces modifications, vous devriez maintenant obtenir une page qui répond aux critères de l'énoncé.<br/> Voici les codes qui contiennent ces modifications :</p><p id="r-413014" data-claire-element-id="413014"></p><div id="r-413019" data-claire-element-id="413019"><pre id="r-413015" data-claire-element-id="413015"><code data-claire-semantic="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
	&lt;head&gt;
		&lt;meta charset=&quot;utf-8&quot;/&gt;
		&lt;title&gt;TP : jeu du Morpion&lt;/title&gt;
		&lt;style&gt;
			table{
				background-color:#FFCC66;
			}
			td{
				border: 1px solid black;
				border-radius: 25px;
				width: 25px;
				height:25px;
				cursor:pointer;
			}
			td.empty{
				background-color:inherit;
			}
			td.noir{
				background-color:#000000;
				box-shadow: inset 4px 3px 20px -6px #146717;
			}
			td.blanc{
				background-color:#EEEEFF;
				box-shadow: inset 4px 3px 20px -6px #7f8f8f;
			}
			fieldset{
				display: inline-block;
			}
			fieldset label{
				display: block;
			}
		&lt;/style&gt;
	&lt;/head&gt;
	&lt;body&gt;
		&lt;script src=&quot;./grille.js&quot;&gt;&lt;/script&gt;
		&lt;script src=&quot;./verifFin.js&quot;&gt;&lt;/script&gt;
	&lt;/body&gt;
&lt;/html&gt;</code></pre><pre id="r-413016" data-claire-element-id="413016"><code data-claire-semantic="javascript">var nx = 7; //nombre de cellules en largeur
var ny = 7; //nombre de cellules en hauteur
var nbAligne = 5; //nombre de jetons à aligner pour gagner
var couleurTour = 1; //couleur dont c'est le tour
var continueJeu = false; //permet d'indiquer si le jeu est arrêté ou non

var iaProfondeurMax = 4; //indique la profondeur de recherche de l'IA
var iaNoir = false; //indique si le joueur noir est une IA
var iaBlanc = true; //indique si le joueur blanc est une IA

var grille = []; //grille du jeu
var iaWorker; // worker gérant l'IA (si le navigateur supporte les workers)

var elemTable; //élément contenant les éléments d'affichage du jeu
var elemIA; //élément indiquant que l'ordinateur réfléchi
var progressIA; //élément permettant d'indiquer où en est l'ordinateur


//Affichage des éléments pour le paramétrage
function affichageDOM(){
	//Règles
	var fieldset = document.createElement(&quot;fieldset&quot;);
	var legend = document.createElement(&quot;legend&quot;);
	legend.textContent = &quot;Règles&quot;;
	fieldset.appendChild(legend);

	//NX
	var label = document.createElement(&quot;label&quot;);
	label.textContent = &quot;Largeur :&quot;;
	var inputNX = document.createElement(&quot;input&quot;);
	inputNX.type=&quot;number&quot;;
	inputNX.min=1;
	inputNX.value=nx;
	label.appendChild(inputNX);
	fieldset.appendChild(label);

	//NY
	label = document.createElement(&quot;label&quot;);
	label.textContent = &quot;Hauteur :&quot;;
	var inputNY = document.createElement(&quot;input&quot;);
	inputNY.type=&quot;number&quot;;
	inputNY.min=1;
	inputNY.value=ny;
	label.appendChild(inputNY);
	fieldset.appendChild(label);

	//aligne
	label = document.createElement(&quot;label&quot;);
	label.textContent = &quot;Nombre de jetons à aligner pour gagner :&quot;;
	var inputAlign = document.createElement(&quot;input&quot;);
	inputAlign.type=&quot;number&quot;;
	inputAlign.min=1;
	inputAlign.value=nbAligne;
	label.appendChild(inputAlign);
	fieldset.appendChild(label);
	
	document.body.appendChild(fieldset);
	
	//Pour l'IA
	fieldset = document.createElement(&quot;fieldset&quot;);
	legend = document.createElement(&quot;legend&quot;);
	legend.textContent = &quot;configuration de l'IA&quot;;
	fieldset.appendChild(legend);

	//IA noir?
	label = document.createElement(&quot;label&quot;);
	label.textContent = &quot;Le joueur noir est un ordinateur :&quot;;
	input = document.createElement(&quot;input&quot;);
	input.type=&quot;checkbox&quot;;
	input.checked=false;
	input.onchange=function(){
		iaNoir=this.checked;
		iaToPlay(); //on vérifie si c'est au tour de l'IA de jouer
	};
	label.appendChild(input);
	fieldset.appendChild(label);
	
	//IA blanc?
	label = document.createElement(&quot;label&quot;);
	label.textContent = &quot;Le joueur blanc est un ordinateur :&quot;;
	input = document.createElement(&quot;input&quot;);
	input.type=&quot;checkbox&quot;;
	input.checked=true;
	input.onchange=function(){
		iaBlanc=this.checked;
		iaToPlay(); //on vérifie si c'est au tour de l'IA de jouer
	};
	label.appendChild(input);
	fieldset.appendChild(label);
	
	//Profondeur
	label = document.createElement(&quot;label&quot;);
	label.textContent = &quot;Profondeur de recherche :&quot;;
	input = document.createElement(&quot;input&quot;);
	input.type=&quot;number&quot;;
	input.min=1;
	input.value=iaProfondeurMax;
	input.onchange=function(){iaProfondeurMax=parseInt(this.value,10);};
	label.appendChild(input);
	fieldset.appendChild(label);
	
	document.body.appendChild(fieldset);

	//bouton permettant de lancer la partie
	var btnStart = document.createElement(&quot;button&quot;);
	btnStart.textContent = &quot;Commencer&quot;;
	btnStart.onclick=function(){
		nx = parseInt(inputNX.value,10);
		ny = parseInt(inputNY.value,10);
		nbAligne = parseInt(inputAlign.value,10);
		init();
	}
	document.body.appendChild(btnStart);
	
	//Indicateur que l'ordinateur réfléchit
	elementIA = document.createElement(&quot;div&quot;);
	elementIA.textContent = &quot;L'ordinateur est en train de réfléchir...&quot;;
	elementIA.style.visibility = &quot;hidden&quot;;
	
	//barre de progression indiquant l'avancée de la recherche de l'ordinateur
	progressIA = document.createElement(&quot;progress&quot;);
	progressIA.max = 100;
	elementIA.appendChild(progressIA);
	document.body.appendChild(elementIA);
	

	document.body.appendChild(document.createElement(&quot;hr&quot;));
}

window.addEventListener(&quot;load&quot;,affichageDOM,false);

//Initialisation d'une partie
function init(){
	if(iaWorker &amp;&amp; iaWorker.playing){
		//l'IA est encore en train de chercher une solution. On va donc l'arrêter
		iaWorker.terminate();
		createIAWorker();
		elementIA.style.visibility = &quot;hidden&quot;;
	}
	
	//initialisation de la grille
	for(var x=0;x&lt;nx;x++){
		grille[x] = [];
		for(var y=0;y&lt;ny;y++){
			grille[x][y] = 0;
		}
	}
	
	//suppression de l'élément HTML de la grille précédente
	if(elemTable){
		document.body.removeChild(elemTable);
	}

	//affichage de la grille de jeu
	elemTable = document.createElement(&quot;table&quot;);
	var row,cel;
	for(y=0;y&lt;ny;y++){
		row = elemTable.insertRow(-1);
		for(x=0;x&lt;nx;x++){
			cel = row.insertCell(-1);
			cel.id = &quot;grille&quot;+x+&quot;_&quot;+y;
			cel.onclick=setClick(x,y);
			switch(grille[x][y]){
				case 1:
					cel.className = &quot;noir&quot;;
					break;
				case 2:
					cel.className = &quot;blanc&quot;;
					break;
				case 0:
				default:
					cel.className = &quot;empty&quot;;
			}
		}
	}
	document.body.appendChild(elemTable);
	couleurTour = 1;
	continueJeu = true;
	iaToPlay(); //on vérifie si c'est au tour de l'IA de jouer
};

//permet de changer l'affichage de la couleur d'un jeton
function changeCouleur(x,y){
	grille[x][y]=couleurTour;
	var elem = document.getElementById(&quot;grille&quot;+x+&quot;_&quot;+y);
	if(elem){
		elem.className=couleurTour===1?&quot;noir&quot;:&quot;blanc&quot;;
	}
}

//permet de jouer un coup en x,y
function joue(x,y){
	if(!continueJeu) return false;
	if(grille[x][y]) return false;
	var rslt;
	changeCouleur(x,y);
	couleurTour = couleurTour%2+1;
	if(rslt=verifVainqueur(x,y)){ //y a-t-il un gagnant ?
		continueJeu = false;
		alert((rslt===1?&quot;Noirs&quot;:&quot;Blancs&quot;)+&quot; vainqueurs&quot;);
	}
	
	if(!verifNbLibre()){
		continueJeu = false;
		alert(&quot;Parie nulle : égalité&quot;);
	}
	
	//est-ce que le prochain coup doit être joué par l'IA ?
	iaToPlay();
}

//Permet de vérifier si le prochain coup doit être joué par l'IA
function iaToPlay(){
	if(!continueJeu) return false;
	if((couleurTour === 1 &amp;&amp; iaNoir) || (couleurTour === 2 &amp;&amp; iaBlanc)){
		continueJeu = false; //pour empêcher un humain de jouer
		elementIA.style.visibility = &quot;visible&quot;;
		if(iaWorker){
			iaWorker.playing = true;
			iaWorker.postMessage({grille:grille,tour:couleurTour,profondeur:iaProfondeurMax,nbAligne:nbAligne});
		}else{
			setTimeout(function(){
				var rslt = iaJoue(grille,couleurTour);
				continueJeu = true;
				elementIA.style.visibility = &quot;hidden&quot;;
				joue(rslt[0],rslt[1]);
			},10); //au cas où deux ordi jouent ensemble et pour voir le coup pendant que l'IA réfléchi
		}
	}
}

//permet de créer une fonction listener sur un élément x,y
function setClick(x,y){
	return function(){
		joue(x,y);
	};
}

//permet de vérifier s'il reste des coups jouable
function verifNbLibre(){
	var nbLibre=0;
	for(var x=0;x&lt;nx;x++){
		for(var y=0;y&lt;ny;y++){
			if(grille[x][y]===0){
				nbLibre++;
			}
		}
	}
	return nbLibre;
}

//Création d'un worker pour l'IA
function createIAWorker(){
	iaWorker = new Worker(&quot;./IA.js&quot;); //création du worker
	iaWorker.playing = false;
	
	iaWorker.onmessage = function(e){
		//réception des messages du workers
		var data = e.data;
		switch(data.cmd){
			case &quot;update&quot;:
				progressIA.value = data.value;
				break;
			case &quot;coup&quot;:
				continueJeu = true;
				elementIA.style.visibility = &quot;hidden&quot;;
				iaWorker.playing = false;
				joue(data.x,data.y);
				break;
		}
	};
	
	iaWorker.onerror = function(e){
		//Gestion des erreurs
		alert(e.message);
	};
}

if(window.Worker){
	createIAWorker();
}else{
	//solution du substitution au worker
	iaWorker = document.createElement(&quot;script&quot;);
	iaWorker.src = &quot;./IA.js&quot;;
	document.body.appendChild(iaWorker);
	iaWorker = null; //afin que iaWorker ne soit définit QUE si le worker existe
}</code></pre><pre id="r-413017" data-claire-element-id="413017"><code data-claire-semantic="javascript">//permet de vérifier s'il y a un vainqueur (en ne regardant que le dernier coup joué)
function verifVainqueur(x,y,vGrille){
	vGrille = vGrille || grille;
	var col = vGrille[x][y]; //couleur du jeton qui vient d'être joué
	var alignH = 1; //nombre de jetons alignés horizontalement
	var alignV = 1; //nombre de jetons alignés verticalement
	var alignD1 = 1; //nombre de jetons alignés diagonalement NO-SE
	var alignD2 = 1; //nombre de jetons alignés diagonalement SO-NE
	var xt,yt;
	
	//vérification horizontale
	xt=x-1;
	yt=y;
	while(xt&gt;=0 &amp;&amp; vGrille[xt][yt]===col){
		xt--;
		alignH++;
	}
	xt=x+1;
	yt=y;
	while(xt&lt;nx &amp;&amp; vGrille[xt][yt]===col){
		xt++;
		alignH++;
	}
	
	//vérification verticale
	xt=x;
	yt=y-1;
	while(yt&gt;=0 &amp;&amp; vGrille[xt][yt]===col){
		yt--;
		alignV++;
	}
	xt=x;
	yt=y+1;
	while(yt&lt;ny &amp;&amp; vGrille[xt][yt]===col){
		yt++;
		alignV++;
	}
	
	//vérification diagonale NO-SE
	xt=x-1;
	yt=y-1;
	while(xt&gt;=0 &amp;&amp; yt&gt;=0 &amp;&amp; vGrille[xt][yt]===col){
		xt--;
		yt--;
		alignD1++;
	}
	xt=x+1;
	yt=y+1;
	while(xt&lt;nx &amp;&amp; yt&lt;ny &amp;&amp; vGrille[xt][yt]===col){
		xt++;
		yt++;
		alignD1++;
	}
	
	//vérification diagonale SO-NE
	xt=x-1;
	yt=y+1;
	while(xt&gt;=0 &amp;&amp; yt&lt;ny &amp;&amp; vGrille[xt][yt]===col){
		xt--;
		yt++;
		alignD2++;
	}
	xt=x+1;
	yt=y-1;
	while(xt&lt;nx &amp;&amp; yt&gt;=0 &amp;&amp; vGrille[xt][yt]===col){
		xt++;
		yt--;
		alignD2++;
	}
	
	//parmis tous ces résultats on regarde s'il y en a un qui dépasse le nombre nécessaire pour gagner
	if(Math.max(alignH,alignV,alignD1,alignD2)&gt;=nbAligne){
		return col;
	}else{
		return 0;
	}
}</code></pre><pre id="r-413018" data-claire-element-id="413018"><code data-claire-semantic="javascript">if(typeof importScripts === &quot;function&quot;){
	//dans le cas d'un worker, on importe le script permettant de vérifier la fin d'une partie
	importScripts(&quot;./verifFin.js&quot;);
	//si importScripts existe c'est qu'on est dans un worker. On va en profiter pour définir une variable afin de facilter la détection ultérieur
	self.inWorker = true;
}else{
	window.inWorker = false;
}

//réception des messages
onmessage = function(e){
	var data = e.data;
	self.iaProfondeurMax = data.profondeur;
	self.nx=data.grille.length;
	self.ny=data.grille[0].length;
	self.nbAligne=data.nbAligne;
	var coup = iaJoue(data.grille,data.tour);
	postMessage({cmd:&quot;coup&quot;,x:coup[0],y:coup[1]});
};

//demande à l'IA de jouer
function iaJoue(grilleOrig,couleur){
	var grille = inWorker?grilleOrig:copieGrille(grilleOrig);
	return iaAlphaBeta(grille, couleur, 0, -Infinity, Infinity);
}

//fonction gérant l'algorithme minimax et l'élagage alpha-beta
function iaAlphaBeta(grille, couleur, profondeur, alpha, beta){
	if(profondeur === iaProfondeurMax){
		//on a atteint la limite de profondeur de calcul on retourne donc une estimation de la position actuelle
		if(couleur === 1){
			return iaEstimation(grille);
		}else{
			return -iaEstimation(grille);
		}
	}else{
		var meilleur = -Infinity; //estimation du meilleur coup actuel
		var estim; //estimation de la valeur d'un coup
		var coup=null; //meilleur coup actuel
		var couleurOpp = couleur%2+1; //optimisation pour calculer la couleur adverse

		//on va essayer toutes les combinaisons possible
		for(var x=0;x&lt;nx;x++){
			for(var y=0;y&lt;ny;y++){
				if(grille[x][y]) continue; //case déjà occupée
				if(!profondeur &amp;&amp; inWorker){
					postMessage({cmd:&quot;update&quot;,value:(x*ny+y)*100/(nx*ny)});
				}
				
				if(!coup){coup=[x,y];} //pour proposer au moins un coup
				
				grille[x][y]=couleur; //on va essayer ce coup
				//vérifie si le coup est gagnant
				if(estim=verifVainqueur(x,y,grille)){
					grille[x][y]=0; //restauration de la grille
					if(!profondeur){
						return [x,y];
					}else{
						return Infinity;
					}
				}
				estim = -iaAlphaBeta(grille, couleurOpp, profondeur+1, -beta, -alpha); //on calcule la valeur de ce coup

				if(estim &gt; meilleur){
					//on vient de trouver un meilleur coup
					meilleur = estim;
					if(meilleur &gt; alpha){
						alpha = meilleur;
						coup = [x,y];
						if(alpha &gt;= beta){
					/*ce coup est mieux que le meilleur des coups qui auraient put être joués si on avait joué un autre
					coup. Cela signifie que jouer le coup qui a amené à cette position n'est pas bon. Il est inutile
					de continuer à estimer les autres possibilités de cette position (principe de l'élagage alpha-beta). */
							grille[x][y]=0; //restauration de la grille
							if(!profondeur){
								return coup;
							}else{
								return meilleur;
							}
						}
					}
				}
				grille[x][y]=0; //restauration de la grille
			}
		}
		if(!profondeur){
			return coup;
		}else{
			if(coup) return meilleur;
			else return 0; //si coup n'a jamais été défini c'est qu'il n'y plus de possibilité de jeu. C'est partie nulle.
		}
	}
}


//permet d'estimer la position
function iaEstimation(grille){
	var estimation = 0; //estimation global de la position
	
	for(var x=0;x&lt;nx;x++){
		for(var y=0;y&lt;ny;y++){
			if(!grille[x][y]) continue;
			//estimation de la valeur de ce jeton et ajout au calcul d'estimation global
			switch(grille[x][y]){
				case 1:
					estimation += iaAnalyse(grille,x,y);
					break;
				case 2: 
					estimation -= iaAnalyse(grille,x,y);
					break;
			}
		}
	}
	return estimation;
}

//permet de calculer le nombre de &quot;liberté&quot; pour la case donnée
function iaAnalyse(grille,x,y){
	var couleur = grille[x][y];
	var estimation = 0; //estimation pour toutes les directions
	var compteur = 0; //compte le nombre de possibilité pour une direction
	var centre = 0; //regarde si le jeton a de l'espace de chaque côté
	var bonus = 0; //point bonus lié aux jetons alliés dans cette même direction
	var i,j; //pour les coordonées temporaires
	var pass=false; //permet de voir si on a dépassé la case étudiée
	var pLiberte = 1; //pondération sur le nombre de liberté
	var pBonus = 1; //pondération Bonus
	var pCentre = 2; //pondération pour l'espace situé de chaque côté

	//recherche horizontale
	for(i=0;i&lt;nx;i++){
		if(i==x){
			centre = compteur++;
			pass=true;
			continue;
		}
		switch(grille[i][y]){
			case 0: //case vide
				compteur++;
				break;
			case couleur: //jeton allié
				compteur++;
				bonus++;
				break;
			default: //jeton adverse
				if(pass){
					i=nx; //il n'y aura plus de liberté supplémentaire, on arrête la recherche ici
				}else{
					//on réinitialise la recherche
					compteur = 0;
					bonus = 0;
				}
		}
	}
	if(compteur&gt;=nbAligne){
		//il est possible de gagner dans cette direction
		estimation += compteur*pLiberte + bonus*pBonus + (1-Math.abs(centre/(compteur-1)-0.5))*compteur*pCentre;
	}
	
	//recherche verticale
	compteur=0;
	bonus=0;
	pass=false;
	for(j=0;j&lt;ny;j++){
		if(j==y){
			centre=compteur++;
			pass=true;
			continue;
		}
		switch(grille[x][j]){
			case 0: //case vide
				compteur++;
				break;
			case couleur: //jeton allié
				compteur++;
				bonus++;
				break;
			default: //jeton adverse
				if(pass){
					j=ny; //il n'y aura plus de liberté supplémentaire, on arrête la recherche ici
				}else{
					//on réinitialise la recherche
					compteur = 0;
					bonus = 0;
				}
		}
	}
	if(compteur&gt;=nbAligne){
		//il est possible de gagner dans cette direction
		estimation += compteur*pLiberte + bonus*pBonus + (1-Math.abs(centre/(compteur-1)-0.5))*compteur*pCentre;
	}
	
	//recherche diagonale (NO-SE)
	compteur=0;
	bonus=0;
	i=x;
	j=y;
	while(i--&gt;0 &amp;&amp; j--&gt;0){
		switch(grille[i][j]){
			case 0: //case vide
				compteur++;
				break;
			case couleur: //jeton allié
				compteur++;
				bonus++;
				break;
			default: //jeton adverse, on arrete de rechercher
				i=0;
		}
	}
	centre=compteur++;
	i=x;
	j=y;
	while(++i&lt;nx &amp;&amp; ++j&lt;ny){
		switch(grille[i][j]){
			case 0: //case vide
				compteur++;
				break;
			case couleur: //jeton allié
				compteur++;
				bonus++;
				break;
			default: //jeton adverse, on arrete de rechercher
				i=nx;
		}
	}
	if(compteur&gt;=nbAligne){
		//il est possible de gagner dans cette direction
		estimation += compteur*pLiberte + bonus*pBonus + (1-Math.abs(centre/(compteur-1)-0.5))*compteur*pCentre;
	}
	
	//recherche diagonale (NE-SO)
	compteur=0;
	bonus=0;
	i=x;
	j=y;
	while(i--&gt;0 &amp;&amp; ++j&lt;ny){
		switch(grille[i][j]){
			case 0: //case vide
				compteur++;
				break;
			case couleur: //jeton allié
				compteur++;
				bonus++;
				break;
			default: //jeton adverse, on arrete de rechercher
				i=0;
		}
	}
	centre=compteur++;
	i=x;
	j=y;
	while(++i&lt;nx &amp;&amp; j--&gt;0){
		switch(grille[i][j]){
			case 0: //case vide
				compteur++;
				break;
			case couleur: //jeton allié
				compteur++;
				bonus++;
				break;
			default: //jeton adverse, on arrete de rechercher
				i=nx;
		}
	}
	if(compteur&gt;=nbAligne){
		//il est possible de gagner dans cette direction
		estimation += compteur*pLiberte + bonus*pBonus + (1-Math.abs(centre/(compteur-1)-0.5))*compteur*pCentre;
	}
	
	return estimation;
}

//permet de copier une grille, cela permet d'éviter de modifier par inadvertance la grille de jeu originale
function copieGrille(grille){
	var nvGrille=[];
	for(var x=0;x&lt;nx;x++){
		nvGrille[x]=grille[x].concat([]);//effectue une copie de la liste
	}
	return nvGrille;
}</code></pre></div><p id="r-413020" data-claire-element-id="413020"><a href="http://restimel.github.com/Tutoriels/webWorkers/TP_gomoku/worker/index.html">Essayer la solution !</a></p><h5 id="r-pour-aller-plus-loin-33" data-claire-element-id="413042">Pour aller plus loin</h5><p id="r-413022" data-claire-element-id="413022">Vous voulez encore améliorer ce programme ? Alors voici quelques idées de défi :</p><ul id="r-413040" data-claire-element-id="413040"><li id="r-413024" data-claire-element-id="413024"><p id="r-413023" data-claire-element-id="413023">Implémenter un autre comportement, lorsque l'utilisateur décide que ce n'est plus à l'IA de jouer.<br/> Vous pouvez implémenter le 2e (le plus complet) ou le 3e cas.</p></li><li id="r-413026" data-claire-element-id="413026"><p id="r-413025" data-claire-element-id="413025">Améliorer la performance de l'IA.<br/> Il faudra sans doute reprendre l'algorithme et améliorer la performance de l'estimation.<br/> Ensuite il est possible de construire une autre architecture où l'IA commence à chercher pendant que ce n'est pas son tour. La difficulté consistera à réaffiner au bon moment la recherche lorsque l'adversaire joue son coup.<br/> Sinon il peut être possible de construire une architecture où les coups calculés lors d'une précédente recherche ne sont pas oubliés.</p></li><li id="r-413037" data-claire-element-id="413037"><p id="r-413027" data-claire-element-id="413027">Ajouter des options aux règles. Il existe plusieurs variantes pour jouer au gomoku. Voici quelques variantes :</p><ul id="r-413036" data-claire-element-id="413036"><li id="r-413029" data-claire-element-id="413029"><p id="r-413028" data-claire-element-id="413028">Il faut aligner strictement cinq pions pour gagner. Si un joueur aligne 6 pions, il n'a pas gagné.</p></li><li id="r-413031" data-claire-element-id="413031"><p id="r-413030" data-claire-element-id="413030">Le joueur noir n'a pas le droit d'avoir deux séries de 3 pions alignés (où les deux extrémités sont libres).</p></li><li id="r-413033" data-claire-element-id="413033"><p id="r-413032" data-claire-element-id="413032">Le joueur noir n'a pas le droit d'avoir deux séries de 4 pions alignés (où l'une des extrémités est libre).</p></li><li id="r-413035" data-claire-element-id="413035"><p id="r-413034" data-claire-element-id="413034">Permettre des captures et déclarer vainqueur celui qui réussit à réaliser 5 captures.<br/> Une capture peut être considérée lorsqu'en jouant un coup à la tête de deux pions adverse, si à l'autre bout de ces deux pions se trouvent aussi un de nos pions. Alors on peut capturer (retirer) les pions adverse.<br/> On peut aussi considérer une capture à la manière du jeu de Go : un pion (ou un groupe de pions) est(sont) retiré(s) s'il(s) est(sont) complètement entouré par des pions adverses.</p></li></ul></li><li id="r-413039" data-claire-element-id="413039"><p id="r-413038" data-claire-element-id="413038">Dans une autre page, permettre d'avoir des informations détaillées de l'état de la recherche de coups. Comme avoir une carte d'estimation pour une position. Avoir l'estimation de la partie pour une profondeur de recherche donnée (surtout utile si la recherche est effectuée en &quot;largeur d'abord&quot;).</p></li></ul><p id="r-413041" data-claire-element-id="413041">Certaines de ces idées sont plutôt faciles à réaliser et d'autres beaucoup moins. Certaines demandent de réécrire complètement les workers, et d'autres juste de réfléchir à l'impact sur le code dans le worker.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
<span class="arrow"></span>
<span class="next">Présentation de l&#039;exercice</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
<span class="next">Exercice supplémentaire : traitement d&#039;image</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Exercicesupplmentairetraitementd039image"></a><h2>Exercice supplémentaire : traitement d&#039;image</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
<span class="arrow"></span>
<span class="next">Correction</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-exercice-supplementaire-traitement-d-image" data-claire-element-id="413141">Exercice supplémentaire : traitement d'image</h4><aside id="r-413045" data-claire-element-id="413045" data-claire-semantic="warning"><p id="r-413044" data-claire-element-id="413044">Ce sujet est plutôt difficile si vous n'avez pas déjà un bon bagage technique, à la fois en javascript et en mathématiques. Toutefois vous pouvez vous contenter de la version sans worker et la modifier pour ajouter un worker.</p></aside><p id="r-413046" data-claire-element-id="413046">Le sujet de cet exercice consiste à appliquer un filtre convolutif sur une image et afficher son résultat.<br/> Le but sera d'informer l'utilisateur de la progression du traitement et aussi de permettre de démarrer plusieurs traitements en même temps.</p><h5 id="r-la-marche-a-suivre-1" data-claire-element-id="413100">La marche à suivre</h5><p id="r-413047" data-claire-element-id="413047">Le but sera d'appliquer un traitement sur une image. Il nous faut donc d'abord une image et récupérer les valeurs de ses pixels. Pour cela je vous propose d'utiliser <code data-claire-semantic="javascript">canvas</code>.<br/> Canvas nous permet à la fois de réaliser un dessin (que ce soit l'utilisateur qui le crée ou une image qui est chargée) et de récupérer les pixels du canvas.</p><aside id="r-413049" data-claire-element-id="413049" data-claire-semantic="warning"><p id="r-413048" data-claire-element-id="413048">Si vous chargez une image dans Canvas, vous ne pourrez récupérer ses pixels que si cette image appartient au même domaine (principe du same origin policy)</p></aside><p id="r-413050" data-claire-element-id="413050">Une fois que l'utilisateur demandera l'application d'un filtre, le traitement devra avoir lieu. Pendant ce temps l'utilisateur peut très bien demander un nouveau traitement ou modifier le dessin.</p><p id="r-413051" data-claire-element-id="413051">Une fois le traitement terminé, l'utilisateur doit pouvoir consulter le résultat.</p><h6 id="r-resume-19" data-claire-element-id="413070">Résumé</h6><p id="r-413052" data-claire-element-id="413052">Voici les points à réaliser :</p><ul id="r-413069" data-claire-element-id="413069"><li id="r-413054" data-claire-element-id="413054"><p id="r-413053" data-claire-element-id="413053">Créer un dessin dans un canvas.</p></li><li id="r-413056" data-claire-element-id="413056"><p id="r-413055" data-claire-element-id="413055">Permettre à l'utilisateur de choisir son filtre.</p></li><li id="r-413066" data-claire-element-id="413066"><p id="r-413057" data-claire-element-id="413057">Réaliser le traitement de l'image :</p><ul id="r-413064" data-claire-element-id="413064"><li id="r-413059" data-claire-element-id="413059"><p id="r-413058" data-claire-element-id="413058">Récupérer les pixels du Canvas.</p></li><li id="r-413061" data-claire-element-id="413061"><p id="r-413060" data-claire-element-id="413060">Récupérer le filtre.</p></li><li id="r-413063" data-claire-element-id="413063"><p id="r-413062" data-claire-element-id="413062">Appliquer le filtre sur l'image pour créer une nouvelle image.</p></li></ul><p id="r-413065" data-claire-element-id="413065">L'utilisateur doit être informé de l'avancement du traitement.</p></li><li id="r-413068" data-claire-element-id="413068"><p id="r-413067" data-claire-element-id="413067">Afficher le résultat.</p></li></ul><h6 id="r-quelques-explications-15" data-claire-element-id="413099">Quelques explications</h6><p id="r-413071" data-claire-element-id="413071">En traitement d'image, les filtres permettent de mettre en valeur certaines propriétés intéressantes de l'image ou de donner un style à l'image.<br/> Les filtres sont définis par des tableaux en deux dimensions représentant les valeurs à appliquer aux pixels voisins.</p><p id="r-413072" data-claire-element-id="413072">Par exemple, pour appliquer un flou à l'image, il faut effectuer une moyenne des pixels environnants. On appliquera alors un filtre moyenneur :</p><table id="r-413095" data-claire-element-id="413095"><tbody id="r-413094" data-claire-element-id="413094"><tr id="r-413079" data-claire-element-id="413079"><td id="r-413074" data-claire-element-id="413074"><p id="r-413073" data-claire-element-id="413073">1/9</p></td><td id="r-413076" data-claire-element-id="413076"><p id="r-413075" data-claire-element-id="413075">1/9</p></td><td id="r-413078" data-claire-element-id="413078"><p id="r-413077" data-claire-element-id="413077">1/9</p></td></tr><tr id="r-413086" data-claire-element-id="413086"><td id="r-413081" data-claire-element-id="413081"><p id="r-413080" data-claire-element-id="413080">1/9</p></td><td id="r-413083" data-claire-element-id="413083"><p id="r-413082" data-claire-element-id="413082">1/9</p></td><td id="r-413085" data-claire-element-id="413085"><p id="r-413084" data-claire-element-id="413084">1/9</p></td></tr><tr id="r-413093" data-claire-element-id="413093"><td id="r-413088" data-claire-element-id="413088"><p id="r-413087" data-claire-element-id="413087">1/9</p></td><td id="r-413090" data-claire-element-id="413090"><p id="r-413089" data-claire-element-id="413089">1/9</p></td><td id="r-413092" data-claire-element-id="413092"><p id="r-413091" data-claire-element-id="413091">1/9</p></td></tr></tbody></table><p id="r-413096" data-claire-element-id="413096">Une convolution est une opération consistant à appliquer un motif sur tous les points d'un espace.</p><p id="r-413097" data-claire-element-id="413097">Dans notre cas, l'espace correspond aux pixels de l'image (un tableau en deux dimensions). Et le motif est le filtre (qui est aussi un tableau en deux dimensions).</p><p id="r-413098" data-claire-element-id="413098">Plus simplement, cela consiste à effectuer un calcul pour chaque pixel de l'image. Ce calcul correspond à une somme des produits des valeurs du filtre avec celles des pixels avoisinant notre pixel cible.</p><h5 id="r-solution-sans-worker" data-claire-element-id="413107">Solution sans worker</h5><div id="r-413104" data-claire-element-id="413104"><pre id="r-413101" data-claire-element-id="413101"><code data-claire-semantic="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
	&lt;meta charset=&quot;utf-8&quot;/&gt;
	&lt;title&gt;Traitement d'image&lt;/title&gt;
	&lt;style&gt;
		body{
			height:100%;
		}
		canvas{
			border: 1px solid #000000;
			z-index:1;
			margin : 0px;
		}
		menu{
			height: 70px;
			margin : 0px;
			padding : 10px;
			margin-right : 300px;
		}
		.filteredCanvas{
			width : 50px;
			height : 25px;
		}
		.zoom{
			position : fixed;
			top : 98px;
			bottom : 10px;
			left : 8px;
			right : 300px;
			display : none;
		}
		.traitement{
			width:300px;
			position:absolute;
			right:0px;
			top:10px;
		}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;script src=&quot;./canvas.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;./gestionFiltre.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><pre id="r-413102" data-claire-element-id="413102"><code data-claire-semantic="javascript">/*
 * création de la zone d'interaction
 */

//création d'un zone d'affichage pour les options liées au Canvas
var outils = document.createElement(&quot;menu&quot;);
document.body.appendChild(outils);

//création du canvas
var canvas = document.createElement(&quot;canvas&quot;);
canvas.addEventListener(&quot;mousedown&quot;,function(event){
		canvas.addEventListener(&quot;mousemove&quot;,draw,false);
		draw(event);
	},false);
canvas.addEventListener(&quot;mouseup&quot;,function(event){
		canvas.removeEventListener(&quot;mousemove&quot;,draw,false);
	},false);
canvas.addEventListener(&quot;mouseout&quot;,function(event){
		canvas.removeEventListener(&quot;mousemove&quot;,draw,false);
	},false);
canvas.width = window.innerWidth - 320; //largeur du canvas
canvas.height = window.innerHeight - 120; //hauteur du canvas
document.body.appendChild(canvas);

//création des options de modification du pinceau
var elem_couleur = document.createElement(&quot;input&quot;);
elem_couleur.type = &quot;color&quot;;
elem_couleur.value = &quot;#000000&quot;;
elem_couleur.addEventListener(&quot;change&quot;,function(){ctx.fillStyle=this.value;},false);
outils.appendChild(elem_couleur);

var elem_taille = document.createElement(&quot;input&quot;);
elem_taille.type = &quot;number&quot;;
elem_taille.min = 1;
elem_taille.value = 20;
elem_taille.title = &quot;Taille du pinceau&quot;;
outils.appendChild(elem_taille);

//création d'un bouton de reset
var elem_reset = document.createElement(&quot;button&quot;);
elem_reset.textContent = &quot;Reset&quot;;
elem_reset.addEventListener(&quot;click&quot;,erase,false);
outils.appendChild(elem_reset);


/**
 * Fonctions de gestion du Canvas
 */
function erase(){
	ctx.save();
	ctx.fillStyle=&quot;#FFFFFF&quot;;
	ctx.fillRect(0, 0, canvas.width, canvas.height);
	ctx.restore();
}

//permet de dessiner dans le canvas au niveau du curseur
function draw(event){
	var x = event.offsetX,//on récupère la position de la souris sur le canvas
		y = event.offsetY;
	ctx.beginPath();
	ctx.arc(x,y,elem_taille.value,0,Math.PI*2,true);//on trace un cercle
	ctx.fill();
}


/*
 * Initialisation
 */
var ctx = canvas.getContext(&quot;2d&quot;); //référence au contexte de dessin
ctx.fillStyle = elem_couleur.value;

erase();</code></pre><pre id="r-413103" data-claire-element-id="413103"><code data-claire-semantic="javascript">/*
 * création de la zone d'interaction
 */

//Création d'une zone pour réaliser des traitements sur l'image
var elem_zoneTraitement = document.createElement(&quot;aside&quot;);
elem_zoneTraitement.className = &quot;traitement&quot;;
document.body.appendChild(elem_zoneTraitement);

//ajout d'une liste de filtre
elem_zoneTraitement.appendChild( document.createTextNode(&quot;Filtre : &quot;) );
var elem_listeFiltre = document.createElement(&quot;select&quot;);
elem_zoneTraitement.appendChild(elem_listeFiltre);

//ajout du bouton de démarrage
var btn_run = document.createElement(&quot;button&quot;);
btn_run.textContent = &quot;Appliquer ce filtre&quot;;
btn_run.addEventListener(&quot;click&quot;,prepareFiltre,false);
elem_zoneTraitement.appendChild(btn_run);

//création de la zone de résultat
var elem_result = document.createElement(&quot;table&quot;);
elem_zoneTraitement.appendChild(elem_result);

//création d'une zone d'affichage pour le zoom du résultat
var elem_zoom = document.createElement(&quot;div&quot;);
elem_zoom.className = &quot;zoom&quot;;
elem_zoneTraitement.appendChild(elem_zoom);

//création d'un canvas pour voir le résultat des filtres
var elem_canvasZoom = document.createElement(&quot;canvas&quot;);
elem_canvasZoom.width = canvas.width;
elem_canvasZoom.height = canvas.height;
elem_zoom.appendChild(elem_canvasZoom);



/**
 * Fonctions de gestion des filtres
 */
var listeFiltre = [
{
	nom:&quot;Flou (petit)&quot;,
	filtre:[
	[1/10,1/10,1/10],
	[1/10,2/10,1/10],
	[1/10,1/10,1/10]
	]
},
{
	nom:&quot;Flou (moyen)&quot;,
	filtre:[
	[1/26,1/26,1/26,1/26,1/26],
	[1/26,1/26,1/26,1/26,1/26],
	[1/26,1/26,2/26,1/26,1/26],
	[1/26,1/26,1/26,1/26,1/26],
	[1/26,1/26,1/26,1/26,1/26]
	]
},
{
	nom:&quot;Flou (grand)&quot;,
	filtre:[
	[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
	[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
	[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
	[1/50,1/50,1/50,2/50,1/50,1/50,1/50],
	[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
	[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
	[1/50,1/50,1/50,1/50,1/50,1/50,1/50]
	]
},
{
	nom:&quot;Flou Gaussien (moyen, σ=0.7)&quot;,
	filtre:[
	[0.0001,0.002,0.0055,0.002,0.0001],
	[0.002,0.0422,0.1171,0.0422,0.002],
	[0.0055,0.1171,0.3248,0.1171,0.0055],
	[0.002,0.0422,0.1171,0.0422,0.002],
	[0.0001,0.002,0.0055,0.002,0.0001]
	]
},
{
	nom:&quot;Filtre de Laplace (petit)&quot;,
	filtre:[
	[-1,-1,-1],
	[-1,8,-1],
	[-1,-1,-1]
	]
},
{
	nom:&quot;Sobel (vertical)&quot;,
	filtre:[
	[-1,0,1],
	[-2,0,2],
	[-1,0,1]
	]
},
{
	nom:&quot;Sobel (horizontal)&quot;,
	filtre:[
	[-1,-2,-1],
	[0,0,0],
	[1,2,1]
	]
}
];

//permet de préparer la liste des filtres disponibles
function generateFilterList(){
	var i = 0,
	li = listeFiltre.length,
	option;
	do{
		option = document.createElement(&quot;option&quot;);
		option.textContent = listeFiltre[i].nom;
		option.value = i;
		elem_listeFiltre.add(option, null);
	}while(++i&lt;li);
}

//permet de préparer tout ce qui est nécessaire pour appliquer le filtre sur le canvas
function prepareFiltre(){
	var idFiltre = elem_listeFiltre.value;

	var image1D = []; //contiendra la liste des pixels correspondant à l'image du Canvas
	var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height); //récupération des données binaires du Canvas
	if(imageData){
		// on a réussi à extraire les données du Canvas, dans ce cas on remplit imagePixels
		image1D = imageData.data;
	}//si on n'a pas réussi à extraire les données, alors on laisse le tableau vide.

	//génération d'une nouvelle ligne de résultat
	var ligne = elem_result.insertRow(-1);
	var cellule = ligne.insertCell(0);
	cellule.textContent = listeFiltre[idFiltre].nom;

	cellule = ligne.insertCell(1);
	cellule.id = &quot;filtre_&quot;+uid;
	cellule.textContent = &quot;en cours de génération&quot;;

	var image2D = conversionImage(image1D,canvas.width); //prepare l'image en 2D (+RVB)
	image2D = appliquerFiltre(image2D, idFiltre, uid);//on applique le filtre à l'image
	finalisationFiltre(image2D,uid++); //on affiche le résultat
}

//permet de convertir un tableaude pixel 1D en 2D
function conversionImage(image1D,w,uid){
	//prepare l'image en 2D (+RVB)
	var image2D = [],
	i,
	x=0,
	y=0,
	li = image1D.length;

	for(i=0 ; i&lt;li; i++){
		if(y===0){
			image2D[x]=[];
		}
		image2D[x][y]=[];
		image2D[x][y][0]=image1D[i++];
		image2D[x][y][1]=image1D[i++];
		image2D[x][y][2]=image1D[i++];
		if(++x&gt;=w){
			x=0;
			y++;
		}
	}

	return image2D;
}

//permet d'appliquer le filtre sur l'image
function appliquerFiltre(image, idFiltre){
	var filtre = (listeFiltre[idFiltre] &amp;&amp; listeFiltre[idFiltre].filtre) || [[]], //récupère le filtre s'il existe ou alors génère un filtre vide
	imgX, //position X sur l'image
	imgY, //position Y sur l'image
	imgMaxX = image.length, // largeur de l'image
	imgMaxY = image[0].length, //hauteur de l'image
	fltX, //position X sur le filtre
	fltY, //position Y sur le filtre
	fltMaxX = filtre.length, //largeur du filtre
	fltMaxY = filtre[0].length, //hauteur du filtre
	fltOffsetX = (fltMaxX - 1)/2, //offset X à appliquer sur le filtre pour trouver le bon pixel sur l'image
	fltOffsetY = (fltMaxY - 1)/2, //offset Y à appliquer sur le filtre pour trouver le bon pixel sur l'image
	index, //sert à identifier la position par rapport à la liste des pixels
	sommeRouge, //valeur temporaire pour l'application du filtre sur un pixel
	sommeVert, //valeur temporaire pour l'application du filtre sur un pixel
	sommeBleu, //valeur temporaire pour l'application du filtre sur un pixel
	x, //index X temporaire pour chercher le bon pixel dans l'image
	y, //index Y temporaire pour chercher le bon pixel dans l'image
	imageFinale=[]; // liste des pixels finales

	//on parcourt tous les pixels de l'image
	imageX:for(imgX = 0; imgX&lt;imgMaxX; imgX++){
		imageFinale[imgX] = [];
		imageY:for(imgY = 0; imgY&lt;imgMaxY; imgY++){
			sommeRouge = 0;
			sommeVert = 0;
			sommeBleu = 0;

			//on parcourt toutes les valeurs du filtre
			filtreX:for(fltX = 0; fltX&lt;fltMaxX; fltX++){
				x = imgX + fltX - fltOffsetX; //on calcule la valeur de x de l'image sur laquelle est appliqué le filtre
				if( x &lt; 0 || x &gt;= imgMaxX){
					//on est en dehors de l'image
					continue filtreX;
				}
				filtreY:for(fltY = 0; fltY&lt;fltMaxY; fltY++){
					y = imgY + fltY - fltOffsetY; //on calcule la valeur de y de l'image sur laquelle est appliqué le filtre
					if( y &lt; 0 || y &gt;= imgMaxY){
						//on est en dehors de l'image
						continue filtreY;
					}
					//on effectue les sommes
					sommeRouge += image[x][y][0] * filtre[fltX][fltY];
					sommeVert += image[x][y][1] * filtre[fltX][fltY];
					sommeBleu += image[x][y][2] * filtre[fltX][fltY];
				}
			}
			//on affecte le résultat au pixel cible
			imageFinale[imgX][imgY] = [sommeRouge, sommeVert, sommeBleu];
		}
	}

	return imageFinale;
}

//permet d'afficher le résultat du filtre
function finalisationFiltre(image2D,uid){
	//création du canvas résultat
	var canvasResult = document.createElement(&quot;canvas&quot;);
	canvasResult.width = canvas.width;
	canvasResult.height = canvas.height;
	canvasResult.className = &quot;filteredCanvas&quot;;

	var elem=document.getElementById(&quot;filtre_&quot;+uid);
	elem.removeChild(elem.firstChild);
	elem.appendChild(canvasResult);

	elem.parentNode.onmouseover = zoomCanvasOver;
	elem.parentNode.onmouseout = zoomCanvasOut;

	var ctx = canvasResult.getContext(&quot;2d&quot;);
	var imageData = ctx.getImageData(0, 0, canvasResult.width, canvasResult.height);

	var x,
	y,
	lx = image2D.length,
	ly = image2D[0].length,
	i=0,
	image1D = imageData.data;

	for(y = 0; y&lt;ly; y++){
		for(x = 0; x&lt;lx; x++){
			image1D[i++] = image2D[x][y][0];
			image1D[i++] = image2D[x][y][1];
			image1D[i++] = image2D[x][y][2];
			image1D[i++] = image2D[x][y][3] || 255;
		}
	}

	ctx.putImageData(imageData,0,0);
}

//permet d'afficher en plus grand un résultat
function zoomCanvasOver(event){
	var fcanvas = this.lastChild.firstChild;
	if(fcanvas.nodeName !== &quot;CANVAS&quot;){
		return false;
	}
	var ctx = fcanvas.getContext(&quot;2d&quot;),
	imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
	ctx = elem_canvasZoom.getContext(&quot;2d&quot;);
	ctx.putImageData(imageData,0,0);
	elem_zoom.style.display = &quot;block&quot;;
}

//enlève l'affichage de résultat
function zoomCanvasOut(event){
	elem_zoom.style.display = &quot;none&quot;;
}


/*
 * Initialisation
 */

var uid = 0; //id unique de traitement pour identifier la bonne ligne
generateFilterList(); //on remplit le select</code></pre></div><p id="r-413105" data-claire-element-id="413105"><a href="http://restimel.github.com/Tutoriels/webWorkers/TP_traitement_image/sansWorker/index.html">Essayer cet application sans les workers !</a></p><p id="r-413106" data-claire-element-id="413106">Remarque sur l'exemple en ligne : Pour faciliter le test, j'ai ajouté un script qui permet de charger un dessin pré-enregistré.</p><h5 id="r-solution-avec-worker" data-claire-element-id="413140">Solution avec worker</h5><p id="r-413108" data-claire-element-id="413108">Je vais encore me répéter mais il ne s'agit que d'UNE solution, et il est tout à fait possible de résoudre ce TP d'une manière totalement différente.</p><p id="r-413109" data-claire-element-id="413109"></p><div id="r-413114" data-claire-element-id="413114"><pre id="r-413110" data-claire-element-id="413110"><code data-claire-semantic="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
	&lt;meta charset=&quot;utf-8&quot;/&gt;
	&lt;title&gt;Traitement d'image avec Worker&lt;/title&gt;
	&lt;style&gt;
		canvas{
			border: 1px solid #000000;
			z-index:1;
			margin : 0px;
		}
		menu{
			height: 70px;
			margin : 0px;
			padding : 10px;
			margin-right : 300px;
		}
		.filteredCanvas{
			width : 50px;
			height : 25px;
		}
		.zoom{
			position : fixed;
			top : 98px;
			bottom : 10px;
			left : 8px;
			right : 300px;
			display : none;
		}
		.traitement{
			width:300px;
			position:absolute;
			right:0px;
			top:10px;
		}
	&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;script src=&quot;./canvas.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><pre id="r-413111" data-claire-element-id="413111"><code data-claire-semantic="javascript">/*
 * création de la zone d'interaction
 */
var canvas_width = document.body.clientWidth - 300;
var canvas_height = Math.round(canvas_width/3);
//alert(canvas_height);

//création d'un zone d'affichage pour les options liées au Canvas
var outils = document.createElement(&quot;menu&quot;);
document.body.appendChild(outils);

//création du canvas
var canvas = document.createElement(&quot;canvas&quot;);
canvas.addEventListener(&quot;mousedown&quot;,function(event){
	canvas.addEventListener(&quot;mousemove&quot;,draw,false);
	draw(event);
},false);
canvas.addEventListener(&quot;mouseup&quot;,function(event){
	canvas.removeEventListener(&quot;mousemove&quot;,draw,false);
},false);
canvas.addEventListener(&quot;mouseout&quot;,function(event){
	canvas.removeEventListener(&quot;mousemove&quot;,draw,false);
},false);
canvas.width = canvas_width;
canvas.height = canvas_height;
document.body.appendChild(canvas);

//création des options de modification du pinceau
var elem_couleur = document.createElement(&quot;input&quot;);
elem_couleur.type = &quot;color&quot;;
elem_couleur.value = &quot;#000000&quot;;
elem_couleur.addEventListener(&quot;change&quot;,function(){ctx.fillStyle=this.value;},false);
outils.appendChild(elem_couleur);

var elem_taille = document.createElement(&quot;input&quot;);
elem_taille.type = &quot;number&quot;;
elem_taille.min = 1;
elem_taille.value = 10;
elem_taille.title = &quot;Taille du pinceau&quot;;
outils.appendChild(elem_taille);

//création d'un bouton de reset
var elem_reset = document.createElement(&quot;button&quot;);
elem_reset.textContent = &quot;Reset&quot;;
elem_reset.addEventListener(&quot;click&quot;,erase,false);
outils.appendChild(elem_reset);


//Création d'une zone pour réaliser des traitements sur l'image
var elem_zoneTraitement = document.createElement(&quot;aside&quot;);
elem_zoneTraitement.className = &quot;traitement&quot;;
document.body.appendChild(elem_zoneTraitement);

//ajout d'une liste de filtre
elem_zoneTraitement.appendChild( document.createTextNode(&quot;Filtre : &quot;) );
var elem_listeFiltre = document.createElement(&quot;select&quot;);
elem_zoneTraitement.appendChild(elem_listeFiltre);

//ajout du bouton de démarrage
var btn_run = document.createElement(&quot;button&quot;);
btn_run.textContent = &quot;Appliquer ce filtre&quot;;
btn_run.addEventListener(&quot;click&quot;,prepareFiltre,false);
elem_zoneTraitement.appendChild(btn_run);

//création de la zone de résultat
var elem_result = document.createElement(&quot;table&quot;);
elem_zoneTraitement.appendChild(elem_result);

//création d'une zone d'affichage pour le zoom du résultat
var elem_zoom = document.createElement(&quot;div&quot;);
elem_zoom.className = &quot;zoom&quot;;
elem_zoneTraitement.appendChild(elem_zoom);

//création d'un canvas pour voir le résultat des filtres
var elem_canvasZoom = document.createElement(&quot;canvas&quot;);
elem_canvasZoom.width = canvas_width;
elem_canvasZoom.height = canvas_height;
elem_zoom.appendChild(elem_canvasZoom);

/**
 * Fonctions de gestion du Canvas
 */
function erase(){
	ctx.save();
	ctx.fillStyle=&quot;#FFFFFF&quot;;
	ctx.fillRect(0, 0, canvas.width, canvas.height);
	ctx.restore();
}

//permet de dessiner dans le canvas au niveau du curseur
function draw(event){
		var x = offset_X(event),
			y = offset_Y(event);
		ctx.beginPath();
		ctx.arc(x,y,elem_taille.value,0,Math.PI*2,true);
		ctx.fill();
}

/**
 * Fonctions de gestion des filtres
 */
 
//ajout d'un script permettant de définir la liste des filtres (création de la variable globale listeFiltre)
var scr_filtre = document.createElement(&quot;script&quot;);
scr_filtre.src = &quot;filtres.js&quot;;
document.body.appendChild(scr_filtre);

//permet de préparer la liste des filtres disponibles
function generateFilterList(){
	var i = 0,
		li = listeFiltre.length,
		option;
	do{
		option = document.createElement(&quot;option&quot;);
		option.textContent = listeFiltre[i].nom;
		option.value = i;
		elem_listeFiltre.add(option, null);
	}while(++i&lt;li);
}

//permet de préparer tout ce qui est nécessaire pour appliquer le filtre sur le canvas
function prepareFiltre(){
	var idFiltre = elem_listeFiltre.value;
	
	var image1D = []; //contiendra la liste des pixels correspondant à l'image du Canvas
	var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height); //récupération des données binaires du Canvas
	if(imageData){
		// on a réussi à extraire les données du Canvas, dans ce cas on remplit imagePixels
		image1D = imageData.data;
	}//si on n'a pas réussi à extraire les données, alors on laisse le tableau vide.
	
	//génération d'une nouvelle ligne de résultat
	var ligne = elem_result.insertRow(-1);
	var cellule = ligne.insertCell(0);
	cellule.textContent = listeFiltre[idFiltre].nom;
	
	cellule = ligne.insertCell(1);
	cellule.id = &quot;filtre_&quot;+uid;
	
	var progressBar = document.createElement(&quot;progress&quot;);
	progressBar.max = 200;
	progressBar.id = &quot;progress_&quot;+uid;
	cellule.appendChild(progressBar);

	if(worker){
		//if(image1D instanceof Array){
		try{
			worker.postMessage({idFiltre:idFiltre,image:image1D,width:canvas.width,uid:uid});
		}catch(e){
			worker.postMessage({idFiltre:idFiltre,image:JSON.stringify(image1D),width:canvas.width,uid:uid});
		}
		uid++;
		worker = createNewWorker(); //on crée un nouveau worker afin de pouvoir lancer un 2e filtre en même temps.
	}else{
		var image2D = conversionImage(image1D,canvas.width); //prepare l'image en 2D (+RVB)
		image2D = appliquerFiltre(image2D, idFiltre, uid);//on applique le filtre à l'image
		finalisationFiltre(image2D,uid++); //on affiche le résultat
	}
}

//permet d'afficher le résultat du filtre
function finalisationFiltre(image2D,uid){
	//création du canvas résultat
	var canvas = document.createElement(&quot;canvas&quot;);
	canvas.width = canvas_width;
	canvas.height = canvas_height;
	canvas.className = &quot;filteredCanvas&quot;;

	var elem=document.getElementById(&quot;filtre_&quot;+uid);
	elem.removeChild(elem.firstChild);
	elem.appendChild(canvas);
	
	elem.parentNode.onmouseover = zoomCanvasOver;
	elem.parentNode.onmouseout = zoomCanvasOut;
	
	var ctx = canvas.getContext(&quot;2d&quot;);
	var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
	
	var x,
		y,
		lx = image2D.length,
		ly = image2D[0].length,
		i=0,
		image1D = imageData.data;
	
	for(y = 0; y&lt;ly; y++){
		for(x = 0; x&lt;lx; x++){
			image1D[i++] = image2D[x][y][0];
			image1D[i++] = image2D[x][y][1];
			image1D[i++] = image2D[x][y][2];
			image1D[i++] = image2D[x][y][3] || 255;
		}
	}
	
	ctx.putImageData(imageData,0,0);
}

//permet d'afficher en plus grand un résultat
function zoomCanvasOver(event){
	var fcanvas = this.lastChild.firstChild;
	if(fcanvas.nodeName !== &quot;CANVAS&quot;){
		return false;
	}
	var ctx = fcanvas.getContext(&quot;2d&quot;),
	imageData = ctx.getImageData(0,0,canvas_width,canvas_height);
	ctx = elem_canvasZoom.getContext(&quot;2d&quot;);
	ctx.putImageData(imageData,0,0);
	elem_zoom.style.display = &quot;block&quot;;
}

//enlève l'affichage de résultat
function zoomCanvasOut(event){
	elem_zoom.style.display = &quot;none&quot;;
}

/**
 * gestion des workers
 */
function createNewWorker(){
	var w = new Worker(&quot;traitement.js&quot;);
	w.onmessage = function(event){
		var data = event.data;
		switch(data.status){
			case &quot;start&quot;: //surtout pour le debug
				console.log(&quot;traitement commencé pour &quot;+data.uid);
			break;
			case &quot;debug&quot;: //debug
console.log(&quot;debug...&quot;);				
console.debug(data.debug);
				break;
			case &quot;update&quot;:
				var elem = document.getElementById(&quot;progress_&quot;+data.uid);
				if(elem){
					elem.value = data.progression;
					elem.textContent = Math.round(data.progression/2) +&quot;%&quot;;
				}
			break;
			case &quot;end&quot;:
				finalisationFiltre(data.image,data.uid);
				w.terminate(); //le worker a fini sa tâche, on ne le réutilisera plus
			break;
		}
	}
	w.onerror=function(e){console.error(e);}; // pour aider à déboguer
	return w;
}

/**
 * Shim &amp; polyfill
 */
//permet de redéfinir la fonction event.offsetX
if(typeof(offset_X)===&quot;undefined&quot;){
	function offset_X(event){
		if(event.offsetX) return event.offsetX;
		var el = event.target, ox = -el.offsetLeft;
		while(el=el.offsetParent){
			ox += el.scrollLeft - el.offsetLeft;
		}
		if(window.scrollX){
			ox += window.scrollX;
		}
		return event.clientX + ox -7;
	}
}

//permet de redéfinir la fonction event.offsetY
if(typeof(offset_Y)===&quot;undefined&quot;){
	function offset_Y(event){
		if(event.offsetY) return event.offsetY;
		var el = event.target, oy = -el.offsetTop;
		while(el=el.offsetParent){
			oy += el.scrollTop - el.offsetTop;
		}
		if(window.scrollY){
			oy += window.scrollY;
		}
		return event.clientY + oy -7;
	}
}

/*
 * Initialisation
 */
var ctx = canvas.getContext(&quot;2d&quot;); //référence au contexte de dessin
ctx.fillStyle = elem_couleur.value;

var uid = 0; //id unique pour identifier le traitement

if(window.Worker){
	var worker = createNewWorker();
}else{
	var scrpt_traitement = document.createElement(&quot;script&quot;);
	scrpt_traitement.src = &quot;traitement.js&quot;;
	document.body.appendChild(scrpt_traitement);
}

window.onload=function(){
	erase();
	generateFilterList();
}</code></pre><pre id="r-413112" data-claire-element-id="413112"><code data-claire-semantic="javascript">var listeFiltre = [
	{
		nom:&quot;Flou (petit)&quot;,
		filtre:[
				[1/10,1/10,1/10],
				[1/10,2/10,1/10],
				[1/10,1/10,1/10]
			]
	},
	{
		nom:&quot;Flou (moyen)&quot;,
		filtre:[
				[1/26,1/26,1/26,1/26,1/26],
				[1/26,1/26,1/26,1/26,1/26],
				[1/26,1/26,2/26,1/26,1/26],
				[1/26,1/26,1/26,1/26,1/26],
				[1/26,1/26,1/26,1/26,1/26]
			]
	},
	{
		nom:&quot;Flou (grand)&quot;,
		filtre:[
				[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
				[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
				[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
				[1/50,1/50,1/50,2/50,1/50,1/50,1/50],
				[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
				[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
				[1/50,1/50,1/50,1/50,1/50,1/50,1/50]
			]
	},
	{
		nom:&quot;Flou Gaussien (moyen, σ=0.7)&quot;,
		filtre:[
			[0.0001,0.002,0.0055,0.002,0.0001],
			[0.002,0.0422,0.1171,0.0422,0.002],
			[0.0055,0.1171,0.3248,0.1171,0.0055],
			[0.002,0.0422,0.1171,0.0422,0.002],
			[0.0001,0.002,0.0055,0.002,0.0001]
		]
	},
/*	{
		nom:&quot;Flou Gaussien (grand)&quot;,
		filtre:[
		[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
		[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
		[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
		[1/50,1/50,1/50,2/50,1/50,1/50,1/50],
		[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
		[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
		[1/50,1/50,1/50,1/50,1/50,1/50,1/50]
		]
	},*/
	{
		nom:&quot;Filtre de Laplace (petit)&quot;,
		filtre:[
			[-1,-1,-1],
			[-1,8,-1],
			[-1,-1,-1]
		]
	},
/*	{
		nom:&quot;Filtre de Laplace (moyen)&quot;,
		filtre:[
		[1/26,1/26,1/26,1/26,1/26],
		[1/26,1/26,1/26,1/26,1/26],
		[1/26,1/26,2/26,1/26,1/26],
		[1/26,1/26,1/26,1/26,1/26],
		[1/26,1/26,1/26,1/26,1/26]
		]
	},
	{
		nom:&quot;Filtre de Laplace (grand)&quot;,
		filtre:[
		[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
		[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
		[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
		[1/50,1/50,1/50,2/50,1/50,1/50,1/50],
		[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
		[1/50,1/50,1/50,1/50,1/50,1/50,1/50],
		[1/50,1/50,1/50,1/50,1/50,1/50,1/50]
		]
	},*/
	{
		nom:&quot;Sobel (vertical)&quot;,
		filtre:[
				[-1,0,1],
				[-2,0,2],
				[-1,0,1]
			]
	},
	{
		nom:&quot;Sobel (horizontal)&quot;,
		filtre:[
			[-1,-2,-1],
			[0,0,0],
			[1,2,1]
		]
	}
];</code></pre><pre id="r-413113" data-claire-element-id="413113"><code data-claire-semantic="javascript">//ajout d'un script permettant de définir la liste des filtres (création de la variable globale listeFiltre)
if(self.importScripts){
	importScripts(&quot;filtres.js&quot;);
}

function gestionMessage(event){
	var data = event.data,
		uid = data.uid;
	self.postMessage({status:&quot;start&quot;,uid:uid});
	var image1D = data.image;
	if(typeof image1D === &quot;string&quot;){
			image1D = JSON.parse(image1D);
	}
	self.postMessage({status:&quot;update&quot;,uid:uid,progression:0});
	var image2D = conversionImage(image1D,data.width, uid); //prepare l'image en 2D (+RVB)
	self.postMessage({status:&quot;update&quot;,uid:uid,progression:100});
	image2D = appliquerFiltre(image2D, data.idFiltre, uid); //on applique le filtre à l'image
	self.postMessage({status:&quot;end&quot;,uid:uid,image:image2D}); //on envoit le résultat
}

self.onmessage = gestionMessage;

//permet de convertir un tableaude pixel 1D en 2D
function conversionImage(image1D,w,uid){
	//prepare l'image en 2D (+RVB)
	var image2D = [],
		i,
		x=0,
		y=0,
		li = image1D.length;
	
	for(i=0 ; i&lt;li; i++){
		if(y===0){
			image2D[x]=[];
		}
		image2D[x][y]=[];
		image2D[x][y][0]=image1D[i++];
		image2D[x][y][1]=image1D[i++];
		image2D[x][y][2]=image1D[i++];
		if(++x&gt;=w){
			x=0;
			y++;
			if(!(y%30) &amp;&amp; typeof window === &quot;undefined&quot;){ //dans le cas où on est dans un worker on envoit une mise à jour
				self.postMessage({status:&quot;update&quot;,uid:uid,progression:i*100/li});
			}
		}
	}
	return image2D;
}

//permet d'appliquer le filtre sur l'image
function appliquerFiltre(image, idFiltre, uid){
	var filtre = (listeFiltre[idFiltre] &amp;&amp; listeFiltre[idFiltre].filtre) || [[]], //récupère le filtre s'il existe ou alors génère un filtre vide
		imgX, //position X sur l'image
		imgY, //position Y sur l'image
		imgMaxX = image.length, // largeur de l'image
		imgMaxY = image[0].length, //hauteur de l'image
		fltX, //position X sur le filtre
		fltY, //position Y sur le filtre
		fltMaxX = filtre.length, //largeur du filtre
		fltMaxY = filtre[0].length, //hauteur du filtre
		fltOffsetX = (fltMaxX - 1)/2, //offset X à appliquer sur le filtre pour trouver le bon pixel sur l'image
		fltOffsetY = (fltMaxY - 1)/2, //offset Y à appliquer sur le filtre pour trouver le bon pixel sur l'image
		index, //sert à identifier la position par rapport à la liste des pixels
		sommeRouge, //valeur temporaire pour l'application du filtre sur un pixel
		sommeVert, //valeur temporaire pour l'application du filtre sur un pixel
		sommeBleu, //valeur temporaire pour l'application du filtre sur un pixel
		x, //index X temporaire pour chercher le bon pixel dans l'image
		y, //index Y temporaire pour chercher le bon pixel dans l'image
		imageFinale=[]; // liste des pixels finales
	
	//on parcourt tous les pixels de l'image
	imageX:for(imgX = 0; imgX&lt;imgMaxX; imgX++){
		if(!(imgX%20) &amp;&amp; typeof window === &quot;undefined&quot;){ //dans le cas où on est dans un worker on envoit une mise à jour
			self.postMessage({status:&quot;update&quot;,uid:uid,progression:100+imgX*100/imgMaxX});
		}
		imageFinale[imgX] = [];
		imageY:for(imgY = 0; imgY&lt;imgMaxY; imgY++){
			sommeRouge = 0;
			sommeVert = 0;
			sommeBleu = 0;
			
			//on parcourt toutes les valeurs du filtre
			filtreX:for(fltX = 0; fltX&lt;fltMaxX; fltX++){
				x = imgX + fltX - fltOffsetX; //on calcule la valeur de x de l'image sur laquelle est appliqué le filtre
				if( x &lt; 0 || x &gt;= imgMaxX){
					//on est en dehors de l'image
					continue filtreX;
				}
				filtreY:for(fltY = 0; fltY&lt;fltMaxY; fltY++){
					y = imgY + fltY - fltOffsetY; //on calcule la valeur de y de l'image sur laquelle est appliqué le filtre
					if( y &lt; 0 || y &gt;= imgMaxY){
						//on est en dehors de l'image
						continue filtreY;
					}
					//on effectue les sommes
					sommeRouge += image[x][y][0] * filtre[fltX][fltY];
					sommeVert += image[x][y][1] * filtre[fltX][fltY];
					sommeBleu += image[x][y][2] * filtre[fltX][fltY];
				}
			}
			//on affecte le résultat au pixel cible
			imageFinale[imgX][imgY] = [sommeRouge, sommeVert, sommeBleu];
		}
	}
	
	return imageFinale;
}</code></pre></div><p id="r-413115" data-claire-element-id="413115"><a href="http://restimel.github.com/Tutoriels/webWorkers/TP_traitement_image/worker/index.html">Essayer cette solution !</a><br/> Remarque sur l'exemple en ligne : Pour faciliter le test, j'ai ajouté un script qui permet de charger un dessin pré-enregistré.</p><h6 id="r-ameliorations-possibles-6" data-claire-element-id="413128">Améliorations possibles</h6><p id="r-413116" data-claire-element-id="413116">Voici quelques idées pour améliorer cet exercice :</p><ul id="r-413123" data-claire-element-id="413123"><li id="r-413118" data-claire-element-id="413118"><p id="r-413117" data-claire-element-id="413117">Permettre de récupérer un résultat pour lui appliquer un filtre.</p></li><li id="r-413120" data-claire-element-id="413120"><p id="r-413119" data-claire-element-id="413119">Permettre d'effectuer d'autres types de filtres (désaturation, déformation de l'image, etc...).</p></li><li id="r-413122" data-claire-element-id="413122"><p id="r-413121" data-claire-element-id="413121">Afficher chaque image dans une page distincte. Ainsi une page servira à la gestion des traitements, les autres à l'affichage. Les shared-workers vont vous être utiles pour gérer les modifications effectuées sur une image et les transmettre à la page de gestion.<br/> L'utilisateur dispose alors de toute sa page pour modifier/contempler son image. Il peut également ouvrir plusieurs instances de son navigateur pour comparer ses images (à la manière de &quot;The GIMP&quot;).</p></li></ul><p id="r-413124" data-claire-element-id="413124">Voilà qui conclut ce tutoriel.</p><p id="r-413125" data-claire-element-id="413125">J'espère que cela vous a aidés à comprendre comment fonctionnent les web-workers et vous a donné des idées sur leurs utilisations possibles.</p><p id="r-413126" data-claire-element-id="413126">Et voilà vous savez tout sur les web-workers.<br/> Vous allez pouvoir optimiser vos applications javascript et ne pas laisser vos visiteurs poireauter devant un écran inactif. :soleil:</p><p id="r-413127" data-claire-element-id="413127">Maintenant, vous disposez d'un nouvel arsenal pour présenter vos applications web. À vous de savoir en profiter.</p><h6 id="r-sources-et-documentations" data-claire-element-id="413139">Sources et documentations</h6><ul id="r-413137" data-claire-element-id="413137"><li id="r-413130" data-claire-element-id="413130"><p id="r-413129" data-claire-element-id="413129"><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/workers.html">Spécification : Web-workers (en)</a></p></li><li id="r-413132" data-claire-element-id="413132"><p id="r-413131" data-claire-element-id="413131"><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html">Spécification : Communications (en)</a></p></li><li id="r-413134" data-claire-element-id="413134"><p id="r-413133" data-claire-element-id="413133"><a href="https://developer.mozilla.org/En/DOM/Worker">Documentation de Mozilla : Worker (en)</a></p></li><li id="r-413136" data-claire-element-id="413136"><p id="r-413135" data-claire-element-id="413135"><a href="http://blogs.msdn.com/b/davrous/archive/2011/07/08/introduction-aux-web-workers-d-html5-le-multithreading-version-javascript.aspx">Article de Microsoft à propos des web-Workers (fr)</a></p></li></ul><p id="r-413138" data-claire-element-id="413138">Merci à <a href="http://www.siteduzero.com/membres-294-123919.html">Golmote</a>, <a href="http://www.siteduzero.com/membres-294-138869.html">xavierm02</a>, et <a href="http://www.siteduzero.com/membres-294-8276.html">Nesquick69</a> pour leurs retours et leurs conseils pour améliorer ce tutoriel.<br/> Et un grand merci à <a href="http://www.siteduzero.com/membres-294-170564.html">Milena2</a> pour son soutien et ses relectures.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript">HTML5, web-workers : le monde parallèle du javascript</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
La base des web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/introduction-a-la-programmation-parallele">Introduction à la programmation parallèle</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-sequentielle">
La programmation séquentielle
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-programmation-parallele">
La programmation parallèle
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-dedicated-workers">Les Dedicated Workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-12">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-envoyer-et-recevoir-des-messages">
La communication : Envoyer et recevoir des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/gerer-un-worker">
Gérer un worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/les-shared-workers">Les shared-workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/premiers-pas-13">
Premiers pas
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-communication-1">
La communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/nommer-vos-shared-workers">
Nommer vos Shared-workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ne-plus-utiliser-un-shared-worker">
Ne plus utiliser un shared-worker
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-des-chiffres-et-des-lettres">TP : Jeu des chiffres et des lettres</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-6">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-141">
Correction
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Pour tout savoir sur les web-workers
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tout-est-communication">Tout est communication</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-canal-de-communication">
Le canal de communication
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/mieux-communiquer">
Mieux communiquer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/terminer-une-communication">
Terminer une communication
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/manipuler-les-workers">Manipuler les workers</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-gestion-des-erreurs-2">
La gestion des erreurs
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/connaitre-ses-origines">
Connaître ses origines
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/ajouter-un-script-dynamiquement-importscripts">
Ajouter un script dynamiquement : importScripts
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/enchainer-les-workers">
Enchaîner les workers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/creer-un-worker-inline">
Créer un worker inline
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-des-web-workers">Quand utiliser des web-workers ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-ne-pas-utiliser-les-workers">
Quand ne pas utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/quand-utiliser-les-workers">
Quand utiliser les workers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/la-performance">
La performance
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/le-support-des-navigateurs">Le support des navigateurs</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tour-d-horizon-1">
Tour d&#039;horizon
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/chrome-safari-webkit">
Chrome / Safari (Webkit)
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/firefox">
Firefox
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/internet-explorer-4">
Internet Explorer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/opera-1">
Opera
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/tp-jeu-du-gomoku">TP : jeu du Gomoku</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/presentation-de-l-exercice-7">
Présentation de l&#039;exercice
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
Correction
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/exercice-supplementaire-traitement-d-image">
Exercice supplémentaire : traitement d&#039;image
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/html5-web-workers-le-monde-parallele-du-javascript/correction-142">
<span class="arrow"></span>
<span class="next">Correction</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/ml5-web-workers-le-monde-parallele-du-javascript.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 23:27:27 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/ml5-web-workers-le-monde-parallele-du-javascript.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:07:52 GMT -->
</html>