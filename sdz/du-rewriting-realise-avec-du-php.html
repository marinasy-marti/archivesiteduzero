<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/du-rewriting-realise-avec-du-php.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 06:48:18 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/du-rewriting-realise-avec-du-php.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:13:45 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Du rewriting réalisé avec du PHP</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/du-rewriting-realise-avec-du-php.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Du rewriting réalisé avec du PHP</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#DurewritingralisavecduPHP">Du rewriting réalisé avec du PHP</a><br/><a href="#Utilisationpourunenews">Utilisation pour une news</a><br/><a href="#Amliorationsetastuces">Améliorations et astuces</a><br/></div>
<a name="DurewritingralisavecduPHP"></a><h2>Du rewriting réalisé avec du PHP</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/du-rewriting-realise-avec-du-php/utilisation-pour-une-news">
<span class="next">Utilisation pour une news</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-453389" data-claire-element-id="453389"><em>L'URL Rewriting</em> est souvent nécessaire pour les sites de grande envergure, tout simplement pour masquer le nom des paramètres envoyés dans les URL, pour rendre les adresses plus séduisantes, mais aussi pour accroître le référencement (mais pas dans tous les cas). Vous aurez sans doute remarqué que les hébergeurs ne proposent pas tous l'<em>URL Rewriting</em>, c'est le cas de Free. Les choses sont révolues maintenant, nous pouvons aussi, à présent, créer de l'<em>URL Rewriting</em> avec un peu de tricherie, mais intelligemment.</p><p id="r-453390" data-claire-element-id="453390">Vous avez toujours rêvé d'avoir de beaux liens comme celui-ci : <a href="http://monsite.fr/page-1.html">http://monsite.fr/page-1.html</a>, ou encore <a href="http://monsite.fr/forum-1-maphraseavec-des-tirets.html">http://monsite.fr/forum-1-maphraseavec-des-tirets.html</a> ?<br/> Vous en avez marre d'avoir ce type de lien : <a href="http://monsite.fr/page.php?id=1">http://monsite.fr/page.php?id=1</a> ?<br/> Ou encore ceci : <a href="http://monsite.fr/?/page-1.html">http://monsite.fr/?/page-1.html</a> ?</p><p id="r-453391" data-claire-element-id="453391">Alors suivez le guide !</p><p id="r-453392" data-claire-element-id="453392">Liens utiles :</p><ul id="r-453403" data-claire-element-id="453403"><li id="r-453394" data-claire-element-id="453394"><p id="r-453393" data-claire-element-id="453393">le <a href="http://www.siteduzero.com/tutoriel-3-14668-un-site-dynamique-avec-php.html">cours de php</a> de M@teo21, mais plus particulièrement les <a href="http://www.siteduzero.com/tutoriel-3-14608-les-expressions-regulieres-partie-1-2.html">expressions régulières</a></p></li><li id="r-453396" data-claire-element-id="453396"><p id="r-453395" data-claire-element-id="453395">explication de l'URL Rewriting sur <a href="http://www.webrankinfo.com/analyses/autres/url-rewriting-debutants.php">Webrankinfo.com</a></p></li><li id="r-453398" data-claire-element-id="453398"><p id="r-453397" data-claire-element-id="453397">explication de l'URL Rewriting sur <a href="http://www.urlrewriting.fr/">Urlrewriting.fr</a></p></li><li id="r-453400" data-claire-element-id="453400"><p id="r-453399" data-claire-element-id="453399">comment définir correctement des URL (à partir de la section : <a href="http://www.webrankinfo.com/analyses/autres/mettre-en-place-url-rewriting.php">définir les schémas d'URL</a>)</p></li><li id="r-453402" data-claire-element-id="453402"><p id="r-453401" data-claire-element-id="453401"><a href="http://www.urlrewriting.fr/tutoriel-urlrewriting-sans-moteur-rewrite.htm">du Rewriting sans le moteur rewrite</a></p></li></ul><aside id="r-453405" data-claire-element-id="453405" data-claire-semantic="warning"><p id="r-453404" data-claire-element-id="453404">Dans ce tutoriel, je ne vous apprends pas l'astuce qui permet de créer ce type d'URL, car tout est indiqué dans le dernier lien utile, mais plutôt comment s'en servir de façon plus rigoureuse avec des exemples et des astuces.</p></aside>
</div><a name="Utilisationpourunenews"></a><h2>Utilisation pour une news</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/du-rewriting-realise-avec-du-php/ameliorations-et-astuces">
<span class="next">Améliorations et astuces</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-453406" data-claire-element-id="453406">Pour comprendre son utilisation, rien de mieux que de l'expliquer en donnant un exemple concret. Pour cela, nous allons nous intéresser au système de news. J'ai choisi cet exemple, tout simplement parce que je suis sûr que vous aurez déjà vu comment cela fonctionne, si vous avez lu le tutoriel de M@teo21.</p><aside id="r-453408" data-claire-element-id="453408" data-claire-semantic="information"><p id="r-453407" data-claire-element-id="453407">Pour éviter de trop se prendre la tête avec les URL, les <em>includes</em>, etc., nous commencerons par mettre nos fichiers à la racine du FTP.</p></aside><h3 id="r-code-pour-la-news" data-claire-element-id="453412">Code pour la news</h3><pre id="r-453409" data-claire-element-id="453409"><code data-claire-semantic="sql">CREATE TABLE IF NOT EXISTS `news` (
  `id` mediumint(9) NOT NULL auto_increment,
  `auteur` varchar(50) NOT NULL,
  `titre` varchar(200) NOT NULL,
  `message` text NOT NULL,
  `temps` datetime NOT NULL,
  PRIMARY KEY  (`id`)
) ENGINE=MyISAM  DEFAULT CHARSET=latin1 AUTO_INCREMENT=4 ;

INSERT INTO `news` (`id`, `auteur`, `titre`, `message`, `temps`) VALUES
(1, 'Jérémy_B', 'L''URL rewriting', 'C''était pas si dur que ça !', '2008-12-31 01:36:14'),
(2, 'Jean', 'Re !', 'C''est vrai que c''est tout simple.', '2009-01-10 12:46:24'),
(3, 'Paul', 'Re re !', 'Merci Jérémy_B. :)', '2009-01-10 13:39:13');</code></pre><pre id="r-453410" data-claire-element-id="453410"><code data-claire-semantic="html+php">&lt;?php

	mysql_connect('localhost', 'root', '');
	mysql_select_db('urlrewriting'); // Mettez ici le nom de votre base de données.

?&gt;

&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot; &gt;
	&lt;head&gt;
		&lt;title&gt;Page de news avec URL Rewriting !&lt;/title&gt;
		&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=iso-8859-1&quot; /&gt;
	&lt;/head&gt;
	&lt;body&gt;

&lt;?php

$requete = &quot;SELECT id, auteur, titre, message, DATE_FORMAT(temps, '%d/%m/%Y') AS temps_formate FROM news&quot;;

if (!empty($match)) {
	$requete .= &quot; WHERE id = &quot;.$match[1];
}

$resultat = mysql_query($requete);

while ($donnees = mysql_fetch_assoc($resultat)) {
	echo &quot;Id : &quot;.$donnees['id'].&quot;&lt;br /&gt;&quot;;
	echo &quot;Auteur : &quot;.stripslashes($donnees['auteur']).&quot;&lt;br /&gt;&quot;;
	echo &quot;Titre : &quot;.stripslashes($donnees['titre']).&quot;&lt;br /&gt;&quot;;
	echo &quot;Message : &quot;.stripslashes($donnees['message']).&quot;&lt;br /&gt;&quot;;
	echo &quot;Temps : &quot;.$donnees['temps_formate'].&quot;&lt;br /&gt;&quot;;
}

?&gt;

	&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-453411" data-claire-element-id="453411">Voilà, jusque-là, rien de compliqué. Si vous avez été attentifs, vous aurez vu une petite condition vérifiant si la variable $match existe, et si elle n'est pas nulle. Elle nous sera utile lorsqu'on aura mis en place les codes pour l'<em>URL Rewriting</em>. D'ailleurs, il est temps de passer aux pages qui nous intéressent le plus.</p><h3 id="r-code-pour-l-url-rewriting" data-claire-element-id="453431">Code pour l'<em>URL Rewriting</em></h3><pre id="r-453413" data-claire-element-id="453413"><code>php 1
ErrorDocument 404 /rewriting.php</code></pre><p id="r-453414" data-claire-element-id="453414"><strong>Explication</strong></p><ul id="r-453419" data-claire-element-id="453419"><li id="r-453416" data-claire-element-id="453416"><p id="r-453415" data-claire-element-id="453415"><em>php 1</em> : ça n'a aucun rapport avec l'<em>URL Rewriting</em>, à part activer PHP 5 chez Free. Donc, si vous n'êtes pas chez cet hébergeur, ne mettez pas cette ligne dans votre &quot;.htaccess&quot;.</p></li><li id="r-453418" data-claire-element-id="453418"><p id="r-453417" data-claire-element-id="453417"><em>ErrorDocument 404 / rewriting.php</em> : cette ligne permet de créer une petite personnalisation lorsque vous avez une erreur 404. En gros, au lieu de voir la page d'erreur générée par PHP, on verra votre page rewriting.php. Les plus malins d'entre vous auront compris que c'est avec cette page qu'on va un peu tricher. <br/>Note : vous n'êtes pas obligés d'appeler votre page rewriting.php, vous pouvez l'appeler, par exemple, urlrewriting.php ou autre.</p></li></ul><pre id="r-453420" data-claire-element-id="453420"><code data-claire-semantic="html+php">&lt;?php

if (preg_match('#news-([0-9-]+)\.html#isU', $_SERVER['REDIRECT_URL'], $match)) {
	// Modification du code retour, pour que les moteurs de recherche indexent nos pages !
	header(&quot;Status: 200 OK&quot;, false, 200);

	require 'news.php';
}
else {
	require 'erreur404.php';
}</code></pre><p id="r-453421" data-claire-element-id="453421"><strong>Explication</strong></p><ul id="r-453426" data-claire-element-id="453426"><li id="r-453423" data-claire-element-id="453423"><p id="r-453422" data-claire-element-id="453422"><em>$_SERVER['REDIRECT_URL']</em> : c'est une variable prédéfinie créée par PHP, qui nous permet d'obtenir l'URL de la page souhaitée. <br/>Note : il se peut que votre hébergeur n'ait pas activé toutes les variables $_SERVER dont celle-ci. Vérifiez, ainsi, dans le <a href="http://fr.php.net/phpinfo">PHP Info</a> &gt; PHP Variables, qu'elle est bien activée.</p></li><li id="r-453425" data-claire-element-id="453425"><p id="r-453424" data-claire-element-id="453424"><em>preg_match('#news-([0-9-]+)\.html#isU', $_SERVER['REDIRECT_URL'], $match)</em> : un exemple pour comprendre ce code. Soit <a href="http://monsite.fr/news-1.html">http://monsite.fr/news-1.html</a>, la page qu'on souhaite afficher (donc, $_SERVER['REDIRECT_URL'] = /news-1.html). Avec cette fonction, on peut récupérer le chiffre 1, grâce à l'expression régulière ([0-9]+) (ou appeler plutôt <a href="http://www.urlrewriting.fr/ressources-classes.html">class</a>), qui sera stocké dans la variable $match.</p></li></ul><aside id="r-453428" data-claire-element-id="453428" data-claire-semantic="information"><p id="r-453427" data-claire-element-id="453427">$match n'est pas qu'une simple variable, mais un tableau (à noter que $match[0] vaut : /news-1.html). Par exemple, si vous voulez transférer deux paramètres dans l'URL, votre expression régulière devrait être : &quot;^/news-([0-9]+)-([0-9]+)\.html$&quot;, vous pourrez les récupérer avec $match[1] et $match[2]. Vous pouvez aussi récupérer autre chose que des chiffres, comme du texte. Par exemple, avec <a href="http://monsite.php/news-maphraseavec-des-tirets.html">http://monsite.php/news-maphraseavec-des-tirets.html</a>, votre REGEX sera : &quot;^/news-([a-zA-Z_-]+)\.html$&quot; et $match[1] vaudra : maphraseavec-des-tirets.</p></aside><aside id="r-453430" data-claire-element-id="453430" data-claire-semantic="warning"><p id="r-453429" data-claire-element-id="453429">Il faut absolument que le paramètre contenant du texte dans l'URL soit accroché par quelque chose (lettre collée, tiret, etc.), mais surtout pas d'espace !</p></aside><h3 id="r-deroulement-des-evenements" data-claire-element-id="453446">Déroulement des évènements</h3><p id="r-453432" data-claire-element-id="453432">On va donc faire appel à la page de news, pour afficher la toute première actualité. Ainsi, rentrons dans la barre d'adresse de notre navigateur, l'adresse suivante : <a href="http://monsite.fr/news-1.html">http://monsite.fr/news-1.html</a>.</p><div id="r-453434" data-claire-element-id="453434" data-claire-semantic="question"><p id="r-453433" data-claire-element-id="453433">Mais cette page n'existe pas sur notre FTP... ça va me retourner une erreur, non ?</p></div><p id="r-453435" data-claire-element-id="453435">Exact, et pas n'importe quelle erreur, la 404. C'est là que notre tricherie va opérer ! Je vous ai dit qu'avec le fichier .htaccess, on allait rediriger l'erreur sur la page rewriting.php. Avec notre page de code, on fait une condition sur l'URL qu'on nous a envoyée, on récupère le chiffre 1, nous permettant, en réalité, de prendre l'id de la news, on renvoie un <em>header</em> pour dire que ce n'était pas une erreur, puis on inclut la page news.php, qui elle, existe réellement.</p><p id="r-453436" data-claire-element-id="453436">Je vous rappelle qu'on a récupéré l'id dans la variable $match[1]. Je vous rappelle aussi qu'une variable peut être transmise dans une autre page qu'on inclut juste après sa déclaration, à condition que dans la deuxième page, la variable ait le même nom.</p><p id="r-453437" data-claire-element-id="453437">Pour en revenir au déroulement des opérations, on vient donc d'inclure la page news.php. Sur cette page, notre requête peut avoir deux cas de figure :</p><ul id="r-453442" data-claire-element-id="453442"><li id="r-453439" data-claire-element-id="453439"><p id="r-453438" data-claire-element-id="453438">soit il y a un paramètre, l'id de la news, qui vaudra 1 pour nous. La condition sera donc validée et nous concaténerons la variable $requete grâce au &quot;.=&quot;, afin d'ajouter un critère de sélection à notre requête ;</p></li><li id="r-453441" data-claire-element-id="453441"><p id="r-453440" data-claire-element-id="453440">soit notre URL n'avait pas de paramètre, on ignore alors la condition, car $match sera vide et n'existera tout simplement pas.</p></li></ul><aside id="r-453444" data-claire-element-id="453444" data-claire-semantic="warning"><p id="r-453443" data-claire-element-id="453443">Pas la peine de protéger notre variable $match[1] dans la requête avec la fonction intval() ou autre de PHP, puisqu'elle a déjà eu le droit à un petit test avec la REGEX (([0-9]+), vous vous en souvenez ?). Nous sommes sûrs d'avoir affaire à un chiffre, donc pas d'inquiétude, nous n'aurons pas d'injection SQL ici.</p></aside><p id="r-453445" data-claire-element-id="453445">Et voilà, miracle, ça marche ! Qu'on appelle notre page avec l'adresse <a href="http://monsite.fr/news-1.html">http://monsite.fr/news-1.html</a> ou avec <a href="http://monsite.fr/news.html">http://monsite.fr/news.html</a>, on visualise bien notre news.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/du-rewriting-realise-avec-du-php">Du rewriting réalisé avec du PHP</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/du-rewriting-realise-avec-du-php/utilisation-pour-une-news">
Utilisation pour une news
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/du-rewriting-realise-avec-du-php/ameliorations-et-astuces">
Améliorations et astuces
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/du-rewriting-realise-avec-du-php/ameliorations-et-astuces">
<span class="next">Améliorations et astuces</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Amliorationsetastuces"></a><h2>Améliorations et astuces</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/du-rewriting-realise-avec-du-php/utilisation-pour-une-news">
<span class="arrow"></span>
<span class="next">Utilisation pour une news</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-453448" data-claire-element-id="453448">Pour que notre script soit le plus intéressant possible, il faudrait qu'on puisse avoir plusieurs possibilités dans nos URL. Mais notre script a ses limites, on ne peut pas tout faire. Nous devrons donc mettre en place une cohérence dans nos liens, sinon, on ne s'en sortira jamais. Ainsi, dans les paramètres de l'URL, nous mettrons, dans un premier temps, les chiffres (id de la news, du membre, du commentaire, du topic, etc.), puis, dans un second temps, les chaînes de caractères. Nous pourrons donc arriver à ce type de lien :</p><ul id="r-453461" data-claire-element-id="453461"><li id="r-453450" data-claire-element-id="453450"><p id="r-453449" data-claire-element-id="453449"><a href="http://monsite.fr/page.html">http://monsite.fr/page.html</a></p></li><li id="r-453452" data-claire-element-id="453452"><p id="r-453451" data-claire-element-id="453451"><a href="http://monsite.fr/page-1.html">http://monsite.fr/page-1.html</a></p></li><li id="r-453454" data-claire-element-id="453454"><p id="r-453453" data-claire-element-id="453453"><a href="http://monsite.fr/page-1-2.html">http://monsite.fr/page-1-2.html</a></p></li><li id="r-453456" data-claire-element-id="453456"><p id="r-453455" data-claire-element-id="453455"><a href="http://monsite.fr/page-1-le-super-titre.html">http://monsite.fr/page-1-le-super-titre.html</a></p></li><li id="r-453458" data-claire-element-id="453458"><p id="r-453457" data-claire-element-id="453457"><a href="http://monsite.fr/page-1-2-le-2-em-super-titre.html">http://monsite.fr/page-1-2-le-2-em-super-titre.html</a> (la chaîne de caractères peut contenir des chiffres)</p></li><li id="r-453460" data-claire-element-id="453460"><p id="r-453459" data-claire-element-id="453459">etc.</p></li></ul><pre id="r-453462" data-claire-element-id="453462"><code data-claire-semantic="html+php">&lt;?php

$page_du_site = array(&quot;/news&quot;); // Super important les / devant le nom du fichier !
$url_sans_parametre = str_replace('.html', '', $_SERVER['REDIRECT_URL']);
$url_avec_parametre = substr($_SERVER['REDIRECT_URL'], 0, strpos($_SERVER['REDIRECT_URL'], &quot;-&quot;));

if (in_array($url_sans_parametre, $page_du_site)) {
	$url = dirname(__FILE__).$url_sans_parametre;
}
elseif (in_array($url_avec_parametre, $page_du_site)) {
	$url = dirname(__FILE__).$url_avec_parametre;
}
else {
	$url = 'erreur404';
}

$page = basename($url_avec_parametre);

if (preg_match('#'.$page.'-([0-9-]+)-([^0-9](?:.+))\.html#isU', $_SERVER['REDIRECT_URL'], $match)) {
	header(&quot;Status: 200 OK&quot;, false, 200);
}
elseif (preg_match('#'.$page.'-([0-9-]+)\.html#isU', $_SERVER['REDIRECT_URL'], $match)) {
	header(&quot;Status: 200 OK&quot;, false, 200);
}
else {
	header(&quot;Status: 200 OK&quot;, false, 200);
}

require $url.'.php';</code></pre><p id="r-453463" data-claire-element-id="453463"><strong>Explication</strong></p><ul id="r-453476" data-claire-element-id="453476"><li id="r-453465" data-claire-element-id="453465"><p id="r-453464" data-claire-element-id="453464"><em>$page_du_site = array(&quot;/news&quot;);</em> : on cherche dans le tableau $page_du_site, si notre URL correspond à une de ces valeurs. Si elle existe, on crée une URL valide, pour la future inclusion, sinon, on indique la page pour gérer, cette fois-ci, la véritable erreur 404. Rien de bien compliqué en soit.</p></li><li id="r-453467" data-claire-element-id="453467"><p id="r-453466" data-claire-element-id="453466"><em>str_replace('.html', '', $_SERVER['REDIRECT_URL']);</em> : ce code nous permet d'éliminer tout ce qui ne nous convient pas dans la variable $_SERVER. En effet, si on souhaite juste appeler la page /news.html, on souhaiterait avoir simplement le mot &quot;/news&quot; pour pouvoir comparer avec d'autres mots.</p></li><li id="r-453469" data-claire-element-id="453469"><p id="r-453468" data-claire-element-id="453468"><em>substr($_SERVER['REDIRECT_URL'], 0, strpos($_SERVER['REDIRECT_URL'], &quot;-&quot;));</em> : si nous avions l'URL suivante : <a href="http://monsite.fr/news-1.html">http://monsite.fr/news-1.html</a>, le code nous permettrait de ne récupérer que &quot;/news&quot;. Utile, puisqu'on va pouvoir le comparer avec les valeurs du tableau $page_du_site.</p></li><li id="r-453471" data-claire-element-id="453471"><p id="r-453470" data-claire-element-id="453470"><em>-([^0-9](?:.+))</em> : dans les deux conditions, la seule différence se situe avec cette classe, qui permet de récupérer une chaîne qui ne commence pas par un chiffre.</p></li><li id="r-453473" data-claire-element-id="453473"><p id="r-453472" data-claire-element-id="453472"><em>require $url.'.php';</em> : on inclut la page qui nous intéresse, d'où l'intérêt de nos trois premières lignes de code. Ainsi, avec n'importe quelle page de notre FTP, on peut faire de l'<em>URL Rewriting</em>.</p></li><li id="r-453475" data-claire-element-id="453475"><p id="r-453474" data-claire-element-id="453474">Ainsi, le code nous permet de vérifier l'existence de la page sur notre FTP, auquel cas on le renvoie sur l'erreur 404.php. Ensuite, on fait différentes conditions pour savoir si l'URL a des paramètres (chiffre, ou chiffre et lettre) ou non. Et dans tous les cas, on indique, grâce au <em>header</em>, que tout se passe bien, qu'il y avait un malentendu ^^ . Puis on inclut la page que l'on voulait.</p></li></ul><aside id="r-453478" data-claire-element-id="453478" data-claire-semantic="information"><p id="r-453477" data-claire-element-id="453477">N'oubliez pas que si vous voulez faire de l'<em>URL Rewriting</em>, sans passer d'argument (ou de paramètre), il faut que le nom de la page soit aussi dans le tableau, sinon, pas d'<em>include</em> (enfin si, l'erreur 404) !</p></aside><p id="r-453479" data-claire-element-id="453479">Maintenant que nous avons mis le code en place, créez la page page.php, permettant de bien comprendre ce que fait notre script du dessus. Voici le code :</p><pre id="r-453480" data-claire-element-id="453480"><code data-claire-semantic="html+php">&lt;?php

$taille = count($match);

for ($i=0; $i&lt;$taille; $i++) {
	echo 'match['.$i.'] vaut : '.$match[$i].'&lt;br /&gt;';
}</code></pre><aside id="r-453482" data-claire-element-id="453482" data-claire-semantic="warning"><p id="r-453481" data-claire-element-id="453481">Si vous utilisez cette page pour faire vos tests, n'oubliez pas qu'il faut rajouter le nom de cette page dans le tableau $page_du_site !</p></aside><p id="r-453483" data-claire-element-id="453483">Il ne vous reste plus qu'à tester les différentes URL possibles, et vous comprendrez bien mieux ce qu'on a voulu faire. Pour que tout le monde ait le même résultat, testez les URL que je vous ai données au début de ce sous-chapitre. Par exemple, pour <a href="http://monsite.fr/page-1-le-super-titre.html">http://monsite.fr/page-1-le-super-titre.html</a>, on obtient ceci :</p><pre id="r-453484" data-claire-element-id="453484"><code>match[0] vaut : page-1-2-le-super-titre.html &lt;--&gt; correspond aussi à $_SERVER['REDIRECT_URL']
match[1] vaut : 1-2
match[2] vaut : le-super-titre</code></pre><div id="r-453486" data-claire-element-id="453486" data-claire-semantic="question"><p id="r-453485" data-claire-element-id="453485">Mais... match[1] vaut 1-2 ! C'est nul ton truc ! Comment on fait si je ne voulais que le 1 ou le 2 ?</p></div><p id="r-453487" data-claire-element-id="453487">Pas de panique, on y va tranquillement pour bien comprendre. Pour séparer une chaîne en tableau avec PHP, il faut utiliser la fonction <a href="http://fr.php.net/explode">explode</a>. Nous allons donc passer $match[1] dans <em>explode</em>, et nous pourrons ainsi récupérer nos paramètres 1 et 2.</p><pre id="r-453488" data-claire-element-id="453488"><code data-claire-semantic="html+php">&lt;?php

$parametre = explode('-', $match[1]);
print_r($parametre); // Array ( [0] =&gt; 1 [1] =&gt; 2 )</code></pre><p id="r-453489" data-claire-element-id="453489">Et voilà, nous pouvons maintenant avoir nos beaux paramètres dans des variables : $parametre[0] = 1 et $parametre[1] = 2. Le code ci-dessus (sans le print_r()), est à placer, bien évidemment, dans le fichier rewriting.php, au niveau des deux conditions utilisant preg_match(). Il ne nous reste plus qu'à faire la même chose pour $match[2], qui contient, cette fois-ci, une chaîne. Sauf que là, on veut juste remplacer les tirets (-) par des espaces et, pourquoi pas, mettre une lettre majuscule pour la première lettre !</p><pre id="r-453490" data-claire-element-id="453490"><code data-claire-semantic="html+php">&lt;?php

$titre = ucfirst(str_replace('-', ' ', $match[2]));
echo $titre; // Le super titre</code></pre><aside id="r-453492" data-claire-element-id="453492" data-claire-semantic="information"><p id="r-453491" data-claire-element-id="453491">On peut aussi s'aider du CSS, si on le souhaite pour la première lettre, d'après le <a href="http://www.siteduzero.com/tutoriel-3-13539-les-pseudo-formats.html#ss_part_2">cours de M@teo21</a> !</p></aside><p id="r-453493" data-claire-element-id="453493">Nous avons vu comment avoir les bons paramètres dans plusieurs variables pour nous faciliter la tâche, mais nous n'avons pas vu comment créer ces liens ! Eh oui, car bon, pour les chiffres, il n'y a pas trop de problèmes, mais pour les chaînes de caractères... c'est une tout autre paire de manches. On a, facilement, la possibilité de faire des URL invalides... et ce n'est pas notre but. Bref, voyons comment régler ce problème.</p><p id="r-453494" data-claire-element-id="453494">Tout d'abord, reprenons l'exemple de notre news. On va, cette fois-ci, sélectionner une news avec tous ses champs, et ainsi, on pourra, avec son id et son titre, créer un lien pour notre belle URL :</p><pre id="r-453495" data-claire-element-id="453495"><code data-claire-semantic="html+php">&lt;?php

	mysql_connect('localhost', 'root', '');
	mysql_select_db('urlrewriting'); // Mettez ici le nom de votre base de données

	function caractereValideUrl($string) {
		$string= strtr($string,
			&quot;ÀÁÂÃÄÅàáâãäåÒÓÔÕÖØòóôõöøÈÉÊËèéêëÇçÌÍÎÏìíîïÙÚÛÜùúûüÿÑñ&quot;,
			&quot;aaaaaaaaaaaaooooooooooooeeeeeeeecciiiiiiiiuuuuuuuuynn&quot;);

		// Mettez ici les caractères spéciaux qui seraient susceptibles d'apparaître dans les titres. La liste ci-dessous est indicative.
		$speciaux = array(&quot;?&quot;,&quot;!&quot;,&quot;@&quot;,&quot;#&quot;,&quot;%&quot;,&quot;&amp;amp;&quot;,&quot;*&quot;,&quot;(&quot;,&quot;)&quot;,&quot;[&quot;,&quot;]&quot;,&quot;=&quot;,&quot;+&quot;,&quot; &quot;,&quot;;&quot;,&quot;:&quot;,&quot;'&quot;,&quot;.&quot;,&quot;_&quot;);
		$string = str_replace($speciaux, &quot;-&quot;, $string); // Les caractères spéciaux dont les espaces, sont remplacés par un tiret.
		$string = strtolower(strip_tags($string));

		return $string;
	}

?&gt;

&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot; &gt;
	&lt;head&gt;
		&lt;title&gt;Les news !&lt;/title&gt;
		&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=iso-8859-1&quot; /&gt;
	&lt;/head&gt;
	&lt;body&gt;

&lt;?php

$requete = &quot;SELECT id, auteur, titre, message, DATE_FORMAT(temps, '%d/%m/%Y') AS temps_formate FROM news&quot;;

if (!empty($match)) {
	$requete .= &quot; WHERE id = &quot;.$match[1];
}

$resultat = mysql_query($requete);

while ($donnees = mysql_fetch_assoc($resultat)) {
	// Tout ce qu'on souhaite afficher pour la news, comme au tout début...
	echo '&lt;a href=&quot;http://monsite.fr/news-'.$donnees['id'].'-
	'.caractereValideUrl('Jérémy B')))).'.html&quot;&gt;Un superbe lien !&lt;/a&gt;';
	// http://monsite.fr/news-1-jeremy-b.html
}

?&gt;

	&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-453496" data-claire-element-id="453496"><strong>Explication</strong></p><ul id="r-453507" data-claire-element-id="453507"><li id="r-453498" data-claire-element-id="453498"><p id="r-453497" data-claire-element-id="453497"><em>function caractereValideUrl($string)</em> : c'est une petite fonction nécessaire pour rendre l'URL plus &quot;valide&quot;.</p></li><li id="r-453500" data-claire-element-id="453500"><p id="r-453499" data-claire-element-id="453499"><em>strtr(...)</em> : cette fonction nous permet de transformer les occurrences de chaque caractère accentué en caractère... sans accent.</p></li><li id="r-453502" data-claire-element-id="453502"><p id="r-453501" data-claire-element-id="453501"><em>str_replace(...)</em> : on remplace, tout simplement, les caractères spéciaux, qui peuvent rendre invalide l'URL, par des tirets.</p></li><li id="r-453504" data-claire-element-id="453504"><p id="r-453503" data-claire-element-id="453503"><em>strip_tags(...)</em> : <a href="http://fr3.php.net/strip_tags">strip_tags</a> permet de supprimer d'éventuelles insertions malveillantes de code HTML ou PHP, dans le cas où le formulaire est public.</p></li><li id="r-453506" data-claire-element-id="453506"><p id="r-453505" data-claire-element-id="453505"><em>strtolower(...)</em> : un lien ou une URL peut contenir des majuscules, mais avec cette petite fonction bien pratique, on va faire une URL plus propre.</p></li></ul><aside id="r-453509" data-claire-element-id="453509" data-claire-semantic="warning"><p id="r-453508" data-claire-element-id="453508">En réalité, $match[2] ne nous sert finalement à rien... Pourquoi ? Tout simplement parce qu'on ne va pas s'amuser à faire la conversion, alors qu'on ne saura pas s'il y avait bien un accent, une apostrophe, etc. Autant le sélectionner directement dans la base de données. Son intérêt est de faire des liens plus explicites, qui nous parle.</p></aside><p id="r-453510" data-claire-element-id="453510">Et une dernière amélioration pour la route : tout ceci se passe à la racine du FTP, mais qu'en est-il pour les autres fichiers qui se trouvent dans des dossiers ? Comme à notre habitude, on va devoir modifier la page qui nous intéresse : rewriting.php. La solution est toute simple, il suffit de mettre le nom du dossier avec la page dans le tableau $page_du_site.</p><pre id="r-453511" data-claire-element-id="453511"><code data-claire-semantic="html+php">&lt;?php

$page_du_site = array(&quot;/test/page&quot;, &quot;/news&quot;);</code></pre><p id="r-453512" data-claire-element-id="453512">Bon, je crois qu'on a fait le tour des améliorations possibles. Comme quoi, avec notre script, nous avions au départ un code tout simple, nous l'avons complexifié, en rajoutant diverses améliorations, et nous avons fait en sorte d'avoir pensé à toutes les éventualités.</p><p id="r-453513" data-claire-element-id="453513">Voilà, le tutoriel touche à sa fin. Vous savez maintenant qu'on peut faire du <em>Rewriting</em>, sans pour autant avoir le moteur adéquat dans Apache (désactivé par Free, par exemple). Ne me dites pas, par contre, que ça ne marche pas ou autre, car j'ai bien tout testé avant d'avoir écrit ce tutoriel.</p><p id="r-453514" data-claire-element-id="453514">Le tutoriel n'est sûrement pas parfait, il doit bien y avoir quelques erreurs, mais il n'est cependant pas figé. Venez donc m'en faire part pour que je puisse l'améliorer !</p><p id="r-453515" data-claire-element-id="453515">La seule chose qui me manque comme information, ce serait de savoir si cette méthode est plus lente que celle du véritable moteur. Je n'ai, hélas, pas les connaissances suffisantes, mais bon, vu que notre système et celui du moteur utilisent tous les deux les REGEX, il ne doit pas y avoir d'énorme différence (de temps, bien sûr).</p><p id="r-453516" data-claire-element-id="453516">Merci, en tout cas, d'avoir lu jusqu'au bout, et j'espère en avoir aidé plus d'un !</p><p id="r-453517" data-claire-element-id="453517">Je remercie aussi au passage ptipilou pour sa Zcorrection.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/du-rewriting-realise-avec-du-php">Du rewriting réalisé avec du PHP</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/du-rewriting-realise-avec-du-php/utilisation-pour-une-news">
Utilisation pour une news
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/du-rewriting-realise-avec-du-php/ameliorations-et-astuces">
Améliorations et astuces
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/du-rewriting-realise-avec-du-php/utilisation-pour-une-news">
<span class="arrow"></span>
<span class="next">Utilisation pour une news</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/du-rewriting-realise-avec-du-php.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 06:48:18 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/du-rewriting-realise-avec-du-php.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:13:45 GMT -->
</html>