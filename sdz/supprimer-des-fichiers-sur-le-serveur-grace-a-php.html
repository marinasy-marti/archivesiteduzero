<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/supprimer-des-fichiers-sur-le-serveur-grace-a-php.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 07:14:20 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/supprimer-des-fichiers-sur-le-serveur-grace-a-php.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:18:20 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Supprimer des fichiers sur le serveur grâce à PHP</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Supprimer des fichiers sur le serveur grâce à PHP</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#SupprimerdesfichierssurleserveurgrcePHP">Supprimer des fichiers sur le serveur grâce à PHP</a><br/><a href="#Lafonctiondesuppressiond039unfichier">La fonction de suppression d&#039;un fichier</a><br/><a href="#Ouvriretlireunrpertoire">Ouvrir et lire un répertoire</a><br/><a href="#Crerunebouclequieffacelecontenud039unrpertoire">Créer une boucle qui efface le contenu d&#039;un répertoire</a><br/><a href="#Unefonctionentirementparamtrable">Une fonction entièrement paramétrable</a><br/></div>
<a name="SupprimerdesfichierssurleserveurgrcePHP"></a><h2>Supprimer des fichiers sur le serveur grâce à PHP</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/la-fonction-de-suppression-d-un-fichier">
<span class="next">La fonction de suppression d&#039;un fichier</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-380678" data-claire-element-id="380678">Grâce à ce tuto, vous apprendrez à supprimer automatiquement les fichiers stockés sur votre serveur. Par « automatiquement », j'entends le fait que l'on ne passe pas par le serveur, mais par une page PHP sur le Web ! De même, vous aurez la possibilité de choisir des critères de suppression pour ne supprimer que les fichiers voulus. Cela peut s'avérer utile lorsque l'on veut effacer des fichiers temporaires ou encore des fichiers uploadés intempestifs :) .</p>
</div><a name="Lafonctiondesuppressiond039unfichier"></a><h2>La fonction de suppression d&#039;un fichier</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/ouvrir-et-lire-un-repertoire">
<span class="next">Ouvrir et lire un répertoire</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-380690" data-claire-element-id="380690">Pour mener à bien ce tuto, nous aurons besoin des fonctions de fichiers (file et dir). Il n'est pas nécessaire de connaître le <a href="http://www.siteduzero.com/tuto-3-172-1-lire-et-ecrire-dans-un-fichier.html">tuto sur les fichiers</a> de PHP pour arriver au script final. Je vous conseille cependant d'y jeter un coup d'œil pour comprendre ce que sont les fonctions file, ou encore de vous référer au site <a href="http://www.php.net/">php.net</a>.</p><aside id="r-380692" data-claire-element-id="380692" data-claire-semantic="information"><p id="r-380691" data-claire-element-id="380691">Comme tous les Zéros le savent, PHP est un langage puissant qui contient de nombreuses fonctions prédéfinies. C'est ici le cas avec notre fonction de suppression. :D</p></aside><p id="r-380693" data-claire-element-id="380693">La fonction en question se nomme <strong>unlink</strong>.</p><p id="r-380694" data-claire-element-id="380694">Elle est suivie d'<strong>un paramètre</strong> qui est… le fichier que l'on va supprimer. :p</p><p id="r-380695" data-claire-element-id="380695">Ce qui nous donne :</p><pre id="r-380696" data-claire-element-id="380696"><code data-claire-semantic="html+php">&lt;?php unlink(&quot;fichier&quot;); ?&gt;</code></pre><p id="r-380697" data-claire-element-id="380697">Ici, on renseignera le paramètre « fichier » par le chemin <strong>relatif</strong> de celui-ci, c'est-à-dire en partant de la racine du serveur.</p><p id="r-380698" data-claire-element-id="380698">Prenons un exemple concret.<br/> J'ai un fichier nommé toto.jpg dans le répertoire images/jpeg/ de mon serveur. Le chemin absolu est <a href="../../monsite.ext/images/jpeg/toto.jpg"><em>http://monsite.ext/images/jpeg/toto.jpg</em></a>. Le chemin relatif sera donc : <em>images/jpeg/toto.jpg</em>.</p><aside id="r-380700" data-claire-element-id="380700" data-claire-semantic="warning"><p id="r-380699" data-claire-element-id="380699">Le chemin relatif à la racine peut parfois s'écrire ainsi <strong>./</strong>, ou encore <strong>../</strong> . Ces caractères font référence à la racine, c'est-à-dire au premier répertoire possible de votre serveur. Dans notre cas, on aurait <em>../images/jpeg/toto.jpg</em>.<br/> Ce qui est valable dans notre cas ne l'est pas forcément ailleurs : en effet, ces caractères signifient aussi « répertoire courant » (celui dans lequel on est) et « répertoire du niveau supérieur. »</p></aside><p id="r-380701" data-claire-element-id="380701">Dans notre code PHP, on obtient donc ceci :</p><pre id="r-380702" data-claire-element-id="380702"><code data-claire-semantic="html+php">&lt;?php unlink (&quot;images/jpeg/toto.jpg&quot;); ?&gt;</code></pre><aside id="r-380704" data-claire-element-id="380704" data-claire-semantic="information"><p id="r-380703" data-claire-element-id="380703">Si ce code est placé tel quel dans un script PHP correct, il effacera le fichier toto.jpg au chargement de la page.</p></aside><aside id="r-380706" data-claire-element-id="380706" data-claire-semantic="error"><p id="r-380705" data-claire-element-id="380705">Si le fichier ou le répertoire en question n'existe pas, PHP ne fera évidemment rien ou retournera une erreur vous indiquant que le chemin n'est pas correct !</p></aside><p id="r-380707" data-claire-element-id="380707">Voilà pour la présentation de notre fonction qui effacera les fichiers. Bien sûr, on ne s'arrêtera pas là, puisque répéter l'opération pour chaque fichier serait fastidieux. On combinera donc cette fonction à une boucle ainsi qu'à des variables (étant donné qu'on ne connaît pas forcément le nom du fichier à supprimer… ;) ).</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php">Supprimer des fichiers sur le serveur grâce à PHP</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/la-fonction-de-suppression-d-un-fichier">
La fonction de suppression d&#039;un fichier
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/ouvrir-et-lire-un-repertoire">
Ouvrir et lire un répertoire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/creer-une-boucle-qui-efface-le-contenu-d-un-repertoire">
Créer une boucle qui efface le contenu d&#039;un répertoire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/une-fonction-entierement-parametrable">
Une fonction entièrement paramétrable
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/ouvrir-et-lire-un-repertoire">
<span class="next">Ouvrir et lire un répertoire</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Ouvriretlireunrpertoire"></a><h2>Ouvrir et lire un répertoire</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/la-fonction-de-suppression-d-un-fichier">
<span class="arrow"></span>
<span class="next">La fonction de suppression d&#039;un fichier</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/creer-une-boucle-qui-efface-le-contenu-d-un-repertoire">
<span class="next">Créer une boucle qui efface le contenu d&#039;un répertoire</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<div id="r-380710" data-claire-element-id="380710" data-claire-semantic="question"><p id="r-380709" data-claire-element-id="380709">Pourquoi faut-il ouvrir un dossier ?</p></div><p id="r-380711" data-claire-element-id="380711">Tout comme PHP, qui doit se connecter à MySQL avant de donner des instructions, <strong>unlink</strong> ne peut fonctionner que si le répertoire que l'on va traiter a été précédemment ouvert.</p><p id="r-380712" data-claire-element-id="380712">Dans cette partie, nous allons apprendre à nous servir correctement des fonctions dir. Il en existe de nombreuses, mais celles que nous utiliserons sont les principales. Elles servent en effet à ouvrir un répertoire, à lire les fichiers contenus dans ce répertoire, puis à le fermer.</p><div id="r-380714" data-claire-element-id="380714" data-claire-semantic="question"><p id="r-380713" data-claire-element-id="380713">Comment ouvrir et fermer un répertoire ?</p></div><p id="r-380715" data-claire-element-id="380715">Les fonctions correspondantes sont <strong>opendir</strong> et <strong>closedir</strong> (très recherché, n'est-ce pas ? ^^ ). Elles sont composées de deux paramètres mais nous nous pencherons seulement sur le premier, que voici :</p><pre id="r-380716" data-claire-element-id="380716"><code data-claire-semantic="html+php">&lt;?php
// J'ai gardé le même exemple que précédemment. 
$ouverture = opendir (&quot;images/jpeg&quot;); // On ouvre le dossier (dans une variable qui sera utilisée par la suite).
 
// Ici seront données les instructions.
 
closedir ($ouverture); // On ferme le dossier.</code></pre><p id="r-380717" data-claire-element-id="380717">Vous l'aurez compris, le paramètre en question est le <strong>chemin du répertoire</strong> auquel on se connecte. Jusqu'ici, tout paraît logique : on ouvre le dossier avec <strong>opendir</strong> grâce à son chemin relatif, on supprime le fichier avec <strong>unlink</strong> grâce à son chemin relatif. :)</p><div id="r-380719" data-claire-element-id="380719" data-claire-semantic="question"><p id="r-380718" data-claire-element-id="380718">Maintenant, comment lire dans ce répertoire ?</p></div><p id="r-380720" data-claire-element-id="380720">On va utiliser pour cela la fonction <strong>readdir</strong> de PHP.<br/> Grâce à readdir, nous allons lire le contenu du répertoire que nous avons ouvert. On va donc se servir de variables pour stocker les informations « d'ouverture » du répertoire. Mais un exemple vaut bien mieux qu'un long discours, voici donc le code :</p><pre id="r-380721" data-claire-element-id="380721"><code data-claire-semantic="html+php">&lt;?php
$ouverture = opendir(&quot;images/jpeg&quot;);
// Maintenant que le répertoire est ouvert, on le lit :
$lecture = readdir($ouverture);
 
// On peut afficher $lecture, PHP retournera le premier fichier rencontré dans le répertoire jpeg, ici notre fichier toto.jpg.
 
closedir($ouverture); // On n'oublie pas de fermer ce qu'on a ouvert. ;-}</code></pre><aside id="r-380723" data-claire-element-id="380723" data-claire-semantic="information"><p id="r-380722" data-claire-element-id="380722"><strong>readdir</strong> lit un répertoire et affiche le premier fichier rencontré dans celui-ci. Pour que PHP puisse retourner tous les fichiers de ce répertoire, il faudra créer une boucle. Ce sera l'objet de notre prochaine étape. :)</p></aside><p id="r-380724" data-claire-element-id="380724">Vous êtes maintenant en mesure de créer vous-mêmes un script capable de supprimer tous les fichiers d'un dossier. Correction dans la partie suivante. ;o)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php">Supprimer des fichiers sur le serveur grâce à PHP</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/la-fonction-de-suppression-d-un-fichier">
La fonction de suppression d&#039;un fichier
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/ouvrir-et-lire-un-repertoire">
Ouvrir et lire un répertoire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/creer-une-boucle-qui-efface-le-contenu-d-un-repertoire">
Créer une boucle qui efface le contenu d&#039;un répertoire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/une-fonction-entierement-parametrable">
Une fonction entièrement paramétrable
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/la-fonction-de-suppression-d-un-fichier">
<span class="arrow"></span>
<span class="next">La fonction de suppression d&#039;un fichier</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/creer-une-boucle-qui-efface-le-contenu-d-un-repertoire">
<span class="next">Créer une boucle qui efface le contenu d&#039;un répertoire</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Crerunebouclequieffacelecontenud039unrpertoire"></a><h2>Créer une boucle qui efface le contenu d&#039;un répertoire</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/ouvrir-et-lire-un-repertoire">
<span class="arrow"></span>
<span class="next">Ouvrir et lire un répertoire</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/une-fonction-entierement-parametrable">
<span class="next">Une fonction entièrement paramétrable</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-380726" data-claire-element-id="380726">Maintenant que vous vous êtes familiarisés avec les fonctions de fichiers, nous allons accélérer les choses en combinant ce que vous avez appris et ce que vous savez déjà. Nous allons nous servir d'une boucle pour effacer entièrement le contenu d'un répertoire.</p><div id="r-380728" data-claire-element-id="380728" data-claire-semantic="question"><p id="r-380727" data-claire-element-id="380727">Mais, comment effacer un répertoire de 5 000 fichiers ? On va pas taper tout les noms, quand même ?! o_O</p></div><p id="r-380729" data-claire-element-id="380729">Non, pas du tout. On va effacer le contenu d'un répertoire dont les noms de fichiers n'ont pas besoin d'être connus. ^^ En effet, on veut tout effacer, on va donc demander à PHP de tout effacer, sans se préoccuper des noms . ;)</p><aside id="r-380731" data-claire-element-id="380731" data-claire-semantic="information"><p id="r-380730" data-claire-element-id="380730">Ici, il va être nécessaire d'utiliser une boucle while ainsi qu'une condition pour s'assurer que l'on n'efface pas le répertoire du niveau supérieur, c'est-à-dire le <strong>..</strong> ou <strong>.</strong> que tout le monde voit sur son serveur dans un quelconque répertoire.</p></aside><aside id="r-380733" data-claire-element-id="380733" data-claire-semantic="warning"><p id="r-380732" data-claire-element-id="380732">D'ailleurs, faites bien attention à ne pas oublier cette condition si vous ne voulez pas vous retrouver avec des dossiers en moins. :p</p></aside><p id="r-380734" data-claire-element-id="380734">Voici le code, annoté de commentaires :</p><pre id="r-380735" data-claire-element-id="380735"><code data-claire-semantic="html+php">&lt;?php
$dossier_traite = &quot;images/jpeg&quot;;
 
$repertoire = opendir($dossier_traite); // On définit le répertoire dans lequel on souhaite travailler.
 
while (false !== ($fichier = readdir($repertoire))) // On lit chaque fichier du répertoire dans la boucle.
{
$chemin = $dossier_traite.&quot;/&quot;.$fichier; // On définit le chemin du fichier à effacer.
 
// Si le fichier n'est pas un répertoire…
if ($fichier != &quot;..&quot; AND $fichier != &quot;.&quot; AND !is_dir($fichier))
       {
       unlink($chemin); // On efface.
       }
}
closedir($repertoire); // Ne pas oublier de fermer le dossier ***EN DEHORS de la boucle*** ! Ce qui évitera à PHP beaucoup de calculs et des problèmes liés à l'ouverture du dossier.</code></pre><p id="r-380736" data-claire-element-id="380736">Comme vous le voyez dans cet exemple, gérer les répertoires, fichiers et chemins qui vont avec requiert de l'organisation. J'ai donc utilisé plusieurs variables, ce qui permet d'une part d'avoir un script propre, et d'autre part de personnaliser entièrement celui-ci, évitant ainsi de réécrire tout le code en cas de changement de répertoire. On verra par la suite que cette organisation se révèle très utile pour créer une fonction entièrement paramétrable. ;)</p><p id="r-380737" data-claire-element-id="380737">J'ai utilisé une concaténation dans la variable $chemin. Prenez garde à ne pas oublier le « / » entre le nom de dossier et celui du fichier.<br/> En ce qui concerne la condition, j'ai exclu de la suppression tous les noms de fichiers qui seraient « .. » ou « . » et les dossiers, avec la fonction is_dir (<em>est_dossier</em>).</p><aside id="r-380739" data-claire-element-id="380739" data-claire-semantic="information"><p id="r-380738" data-claire-element-id="380738">Vous remarquez l'utilisation d'une syntaxe un peu particulière utilisant l'opérateur de comparaison !==.<br/> Cet opérateur permet non seulement de comparer la valeur de retour à false (cas d'échec de la fonction readdir) mais aussi les types. En effet, readdir renvoie false en cas d'erreur, mais également 0 ou &quot;&quot; (chaîne vide), qui peuvent implicitement valoir &quot;faux&quot;. En comparant false, qui est un booléen, à ce que retourne readdir en cas d'erreur, qui est aussi un booléen false, on s'assure de traiter de manière exacte la valeur de retour.</p></aside><p id="r-380740" data-claire-element-id="380740">Notre petit script va supprimer tous les fichiers du répertoire jpeg/. <br/> Mais maintenant, je fais comment si je veux supprimer seulement les images, ou si je veux supprimer les fichiers trop âgés ? <br/> C'est ce sur quoi portera la prochaine partie. :magicien:</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php">Supprimer des fichiers sur le serveur grâce à PHP</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/la-fonction-de-suppression-d-un-fichier">
La fonction de suppression d&#039;un fichier
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/ouvrir-et-lire-un-repertoire">
Ouvrir et lire un répertoire
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/creer-une-boucle-qui-efface-le-contenu-d-un-repertoire">
Créer une boucle qui efface le contenu d&#039;un répertoire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/une-fonction-entierement-parametrable">
Une fonction entièrement paramétrable
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/ouvrir-et-lire-un-repertoire">
<span class="arrow"></span>
<span class="next">Ouvrir et lire un répertoire</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/une-fonction-entierement-parametrable">
<span class="next">Une fonction entièrement paramétrable</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Unefonctionentirementparamtrable"></a><h2>Une fonction entièrement paramétrable</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/creer-une-boucle-qui-efface-le-contenu-d-un-repertoire">
<span class="arrow"></span>
<span class="next">Créer une boucle qui efface le contenu d&#039;un répertoire</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-380742" data-claire-element-id="380742">Voici la dernière partie de ce tuto. C'est donc la plus importante puisque l'on va réutiliser tout ce que l'on a vu précédemment. Notre but est de créer une fonction qui sera capable de supprimer automatiquement les fichiers dont l'extension et l'âge ont été choisis. Pour associer ces critères à notre fonction, nous allons avoir besoin de quelques outils que PHP a prédéfinis.</p><p id="r-380743" data-claire-element-id="380743">Liste des outils nécessaires à la réalisation de notre fonction :</p><ul id="r-380750" data-claire-element-id="380750"><li id="r-380745" data-claire-element-id="380745"><p id="r-380744" data-claire-element-id="380744">toutes les étapes vues ci-dessus ; :D</p></li><li id="r-380747" data-claire-element-id="380747"><p id="r-380746" data-claire-element-id="380746">la fonction <strong>pathinfo</strong>, qui retourne 3 informations sur un fichier dans un tableau associatif. À savoir, le chemin relatif du dossier contenant le fichier, le nom du fichier, et enfin, ce dont nous avons besoin : <strong>l'extension de ce fichier</strong>. Nous verrons comment l'utiliser dans notre cas.</p></li><li id="r-380749" data-claire-element-id="380749"><p id="r-380748" data-claire-element-id="380748">La fonction <strong>filemtime</strong>, qui retourne le timestamp de la dernière modification d'un fichier. Elle est très simple à utiliser puisque nous aurons juste à renseigner le <strong>chemin du fichier</strong> pour obtenir sa dernière modification. ;)</p></li></ul><p id="r-380751" data-claire-element-id="380751"><strong>Commençons donc par notre fonction et ses paramètres.</strong><br/> Pour cela, nous avons besoin de prendre en compte l'âge minimum que le fichier doit avoir pour être supprimé, l'extension recherchée, et, bien sûr, le répertoire traité. :)</p><pre id="r-380752" data-claire-element-id="380752"><code data-claire-semantic="html+php">&lt;?php
// Notre fonction contiendra 3 paramètres, comme on vient de le voir.
/* Dans l'ordre : 
— le dossier traité ; rappelez-vous, le chemin relatif ;
— l'extension cherchée : ici, je veux que ce soit les gif qui doivent être supprimés (il n'est pas nécessaire de mettre le point avant l'extension) ;
— l'âge minimum, en secondes ; ici j'ai choisi une heure. */
suppression( &quot;images/jpeg&quot; , &quot;gif&quot; , &quot;3600&quot; );
?&gt;</code></pre><p id="r-380753" data-claire-element-id="380753">Comme on peut le voir, j'ai choisi d'exécuter une fonction <em><strong>suppression</strong></em>. Il va donc falloir créer cette fonction, en prenant en compte les paramètres choisis. On les placera dans des variables que je vous donne :</p><ul id="r-380760" data-claire-element-id="380760"><li id="r-380755" data-claire-element-id="380755"><p id="r-380754" data-claire-element-id="380754">$dossier_traite ;</p></li><li id="r-380757" data-claire-element-id="380757"><p id="r-380756" data-claire-element-id="380756">$extension_choisie ;</p></li><li id="r-380759" data-claire-element-id="380759"><p id="r-380758" data-claire-element-id="380758">$age_requis.</p></li></ul><p id="r-380761" data-claire-element-id="380761">Pour l'instant, on ne s'occupe pas de l'extension et du temps dans la fonction. On va se contenter de faire une fonction qui contiendra la même chose que l'on a vue à l'étape précédente. À vous de jouer. ;)</p><h3 id="r-correction-128" data-claire-element-id="380781">Correction</h3><pre id="r-380762" data-claire-element-id="380762"><code data-claire-semantic="html+php">&lt;?php
// Notre fonction paramétrée.
suppression( &quot;images/jpeg&quot; , &quot;gif&quot; , &quot;3600&quot; );
 
// La fonction en question.
function suppression($dossier_traite , $extension_choisie, $age_requis)
{
// On ouvre le dossier.
$repertoire = opendir($dossier_traite);
 
// On lance notre boucle qui lira les fichiers un par un.
        while(false !== ($fichier = readdir($repertoire)))
        {
        // On met le chemin du fichier dans une variable simple.
        $chemin = $dossier_traite.&quot;/&quot;.$fichier;
                
// On n'oublie pas LA condition sous peine d'avoir quelques surprises. :p
                if($fichier!=&quot;.&quot; AND $fichier!=&quot;..&quot; AND !is_dir($fichier))
                {
                unlink($chemin);
                }
        }
closedir($repertoire); // On ferme !
}
?&gt;</code></pre><p id="r-380763" data-claire-element-id="380763">Voici donc notre fonction. Il n'y a rien à ajouter puisque c'est la même chose que tout à l'heure. Maintenant, nous allons la compléter avec nos critères pour finaliser ce tuto. :)</p><h2 id="r-la-fonction-et-ses-criteres" data-claire-element-id="380780">La fonction et ses critères</h2><div id="r-380765" data-claire-element-id="380765" data-claire-semantic="question"><p id="r-380764" data-claire-element-id="380764">Tout d'abord, comment fonctionne pathinfo ?</p></div><p id="r-380766" data-claire-element-id="380766">La fonction pathinfo renvoie, comme je l'ai dit, 3 infos sur le chemin qu'on lui donne. Nous allons nous servir de l'info correspondant à l'extension. Nous intégrerons cette fonction ainsi :</p><pre id="r-380767" data-claire-element-id="380767"><code data-claire-semantic="html+php">&lt;?php $infos = pathinfo($chemin);
$extension = $infos['extension']; ?&gt;</code></pre><div id="r-380769" data-claire-element-id="380769" data-claire-semantic="question"><p id="r-380768" data-claire-element-id="380768">Et la fonction filemtime ?</p></div><p id="r-380770" data-claire-element-id="380770">Pour connaître l'âge du fichier, on peut soustraire la date de dernière modification du fichier (son timestamp, bien sûr) au timestamp actuel. Ce qui donne :</p><pre id="r-380771" data-claire-element-id="380771"><code data-claire-semantic="html+php">&lt;?php $age_fichier = time() - filemtime($chemin);
// Ici aussi, il faut renseigner la fonction avec le chemin du fichier.
?&gt;</code></pre><p id="r-380772" data-claire-element-id="380772">Vous pouvez dorénavant créer la fonction entièrement en assimilant ce que nous venons de voir à notre condition <strong>if</strong>.</p><p id="r-380773" data-claire-element-id="380773">Correction et script final ici :</p><p id="r-380774" data-claire-element-id="380774"></p><div id="r-380777" data-claire-element-id="380777"><div id="r-380776" data-claire-element-id="380776"><pre id="r-380775" data-claire-element-id="380775"><code data-claire-semantic="html+php">&lt;?php
// Notre fonction paramétrée.
suppression( &quot;images/jpeg&quot; , &quot;gif&quot; , &quot;3600&quot; );
 
// La fonction en question.
function suppression($dossier_traite , $extension_choisie, $age_requis)
{
// On ouvre le dossier.
$repertoire = opendir($dossier_traite);
 
// On lance notre boucle qui lira les fichiers un par un.
        while(false !== ($fichier = readdir($repertoire)))
        {
        // On met le chemin du fichier dans une variable simple
        $chemin = $dossier_traite.&quot;/&quot;.$fichier;
                
                // Les variables qui contiennent toutes les infos nécessaires.
                $infos = pathinfo($chemin);
                $extension = $infos['extension'];
 
                $age_fichier = time() - filemtime($chemin);
                
// On n'oublie pas LA condition sous peine d'avoir quelques surprises. :p
                if($fichier!=&quot;.&quot; AND $fichier!=&quot;..&quot; AND !is_dir($fichier)
$extension == $extension_choisie AND $age_fichier &gt; $age_requis)
                {
                unlink($chemin);
                }
        }
closedir($repertoire); // On ferme !
}
?&gt;</code></pre></div></div><p id="r-380778" data-claire-element-id="380778">Ce script permettra de supprimer les fichiers voulus à chaque chargement de la page PHP dans laquelle il se trouve. Ici, j'ai choisi d'effacer tous les fichiers gif et tous les fichiers dont l'âge est supérieur à 1 heure.<br/> Vous pouvez vous-mêmes personnaliser cette fonction en changeant seulement les paramètres en haut du script.</p><p id="r-380779" data-claire-element-id="380779">Voilà, ce tuto touche à sa fin. Sachez que ce script n'est pas la seule possibilité pour effacer des fichiers, néanmoins il reste simple. Il peut être aussi très complet si vous ajoutez votre touche personnelle en le complétant de conditions diverses. ;)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php">Supprimer des fichiers sur le serveur grâce à PHP</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/la-fonction-de-suppression-d-un-fichier">
La fonction de suppression d&#039;un fichier
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/ouvrir-et-lire-un-repertoire">
Ouvrir et lire un répertoire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/creer-une-boucle-qui-efface-le-contenu-d-un-repertoire">
Créer une boucle qui efface le contenu d&#039;un répertoire
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/une-fonction-entierement-parametrable">
Une fonction entièrement paramétrable
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/supprimer-des-fichiers-sur-le-serveur-grace-a-php/creer-une-boucle-qui-efface-le-contenu-d-un-repertoire">
<span class="arrow"></span>
<span class="next">Créer une boucle qui efface le contenu d&#039;un répertoire</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/supprimer-des-fichiers-sur-le-serveur-grace-a-php.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 07:14:20 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/supprimer-des-fichiers-sur-le-serveur-grace-a-php.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:18:24 GMT -->
</html>