<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/arcourir-les-dossiers-avec-dirent-h.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 09:01:15 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/arcourir-les-dossiers-avec-dirent-h.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:36:43 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Parcourir les dossiers avec dirent.h</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Parcourir les dossiers avec dirent.h</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Parcourirlesdossiersavecdirent.h">Parcourir les dossiers avec dirent.h</a><br/><a href="#Ouvertureetfermeturededossiers">Ouverture et fermeture de dossiers</a><br/><a href="#Utilisererrno">Utiliser errno</a><br/><a href="#Manipulerdesfichiersl039intrieurd039undossier">Manipuler des fichiers à l&#039;intérieur d&#039;un dossier</a><br/><a href="#Dplacementdansunrpertoire">Déplacement dans un répertoire</a><br/><a href="#Exercices">Exercices</a><br/></div>
<a name="Parcourirlesdossiersavecdirent.h"></a><h2>Parcourir les dossiers avec dirent.h</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/ouverture-et-fermeture-de-dossiers">
<span class="next">Ouverture et fermeture de dossiers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-561034" data-claire-element-id="561034">Bonjour à tous ! :)</p><p id="r-561035" data-claire-element-id="561035">Sur la plupart des forums, on peut voir des Zér0s se poser ce genre de question : « Comment parcourir les dossiers en C ? », « Comment lister les fichiers qui se trouvent dedans ? », etc.</p><p id="r-561036" data-claire-element-id="561036">Ce mini-tuto est pour eux ! Grâce au fichier d'en-tête <strong>dirent.h</strong>, nous allons pouvoir faire ce genre de chose, et plus encore ! :magicien:</p><aside id="r-561038" data-claire-element-id="561038" data-claire-semantic="warning"><p id="r-561037" data-claire-element-id="561037">Les bases du C sont nécessaires pour suivre et comprendre ce tutoriel. Si vous pensez ne pas les posséder, lisez le <a href="http://www.siteduzero.com/tutoriel-3-14189-apprenez-a-programmer-en-c.html">tutoriel officiel</a> du site.</p></aside><p id="r-561039" data-claire-element-id="561039">N.B. : Si vous êtes à l'aise concernant la manipulation des fichiers, alors ce tutoriel ne devrait <em>a priori</em> vous poser aucun problème. ;)</p>
</div><a name="Ouvertureetfermeturededossiers"></a><h2>Ouverture et fermeture de dossiers</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/utiliser-errno">
<span class="next">Utiliser errno</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-le-point-sur-dirent-h" data-claire-element-id="561044">Le point sur dirent.h</h2><p id="r-561040" data-claire-element-id="561040">Pour commencer, qu'est-ce que dirent.h ? Comme le .h pouvait le laisser supposer, c'est un header, et il va falloir l'inclure dans nos programmes. ;) <br/> Ce header est <em>portable</em>, il est donc disponible sur Windows, Mac et Linux. D'ailleurs, vous pouvez aller voir dans le dossier include de votre compilateur, il s'y trouve bel et bien. :p <br/> Mais si j'ai mis le mot « portable » en italique, c'est parce qu'il ne l'est pas totalement. dirent.h est un header sous la norme POSIX... Ce qui signifie que c'est un header <strong>standard</strong> pour les systèmes UNIX. Les codes et les possibilités seront exactement les mêmes pour Linux et Mac par exemple.</p><div id="r-561042" data-claire-element-id="561042" data-claire-semantic="question"><p id="r-561041" data-claire-element-id="561041">Mais... :euh: et pour Windows alors ?</p></div><p id="r-561043" data-claire-element-id="561043">dirent.h est bien disponible sous Windows, puisqu'il a été adapté sur cet OS. ^^ Néanmoins, certaines petites choses sont différentes, mais dans les grandes lignes, rien ne change énormément, ne vous inquiétez pas. :p</p><h2 id="r-les-directives-de-preprocesseur-2" data-claire-element-id="561051">Les directives de préprocesseur</h2><p id="r-561045" data-claire-element-id="561045">Je vois que vous en avez déjà marre du blabla. Bien. Passons donc au code. :) <br/> Nous allons avoir besoin de quelques headers à inclure :</p><pre id="r-561046" data-claire-element-id="561046"><code data-claire-semantic="c">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;

#include &lt;dirent.h&gt;

#ifndef WIN32
    #include &lt;sys/types.h&gt;
#endif</code></pre><p id="r-561047" data-claire-element-id="561047">J'ai décidé d'inclure stdio et stdlib pour pouvoir utiliser quelques fonctions standards. Vient ensuite notre fameux dirent.</p><div id="r-561049" data-claire-element-id="561049" data-claire-semantic="question"><p id="r-561048" data-claire-element-id="561048">Qu'est-ce que c'est sys/types ?</p></div><p id="r-561050" data-claire-element-id="561050">Cela fait partie des changements dont j'ai parlé précédemment. Ces lignes de codes signifient : « Si on n'utilise <strong>pas</strong> un système d'exploitation Windows, alors on inclut sys/types.h ».<br/> Ce header contient des types « inventés » qui ne seront pas forcément indispensables au long de ce chapitre, mais qui se révèleront utiles. Sous Windows (ne me demandez pas pourquoi), on n'a pas besoin d'utiliser ces types. ;)</p><h2 id="r-ouvrir-un-repertoire" data-claire-element-id="561060">Ouvrir un répertoire</h2><p id="r-561052" data-claire-element-id="561052">Vous allez voir, les prototypes des fonctions d'ouverture et de fermeture de dossier ne vont pas vous dépayser des fichiers, la manière de procéder est grosso modo la même. :p</p><pre id="r-561053" data-claire-element-id="561053"><code data-claire-semantic="c">DIR* opendir(const char* chemin) ;</code></pre><p id="r-561054" data-claire-element-id="561054"><a href="http://www.linux-kheops.com/doc/man/manfr/man-html-0.9/man3/opendir.3.html">opendir()</a> attend une chaîne de caractères et renvoie un pointeur sur FILE DIR.</p><div id="r-561056" data-claire-element-id="561056" data-claire-semantic="question"><p id="r-561055" data-claire-element-id="561055">Cékoiça DIR ? Et quel chemin faut-il mettre ?</p></div><p id="r-561057" data-claire-element-id="561057">Je vais y aller pas à pas.<br/><strong>DIR</strong> est une structure qui <em>simule</em> le dossier que l'on a ouvert. D'ailleurs, petite question... Que signifie DIR ? Directory ! Et que signifie directory ? ... C'est la traduction anglaise de <strong>répertoire</strong> !<br/> Ensuite, le chemin à mettre, ça, vous avez appris à le faire dans le tutoriel officiel sur la manipulation des fichiers ! Si vous avez un petit trou de mémoire, c'est <a href="http://www.siteduzero.com/tutoriel-3-14052-lire-et-ecrire-dans-des-fichiers.html#ss_part_1">par ici</a>. N'oubliez pas d'adapter le chemin pour chaque OS (&quot;C:\&quot; pour Windows, &quot;/&quot; pour UNIX).</p><aside id="r-561059" data-claire-element-id="561059" data-claire-semantic="warning"><p id="r-561058" data-claire-element-id="561058">Si le dossier n'a pas pu être ouvert, opendir() renverra NULL.</p></aside><h2 id="r-fermer-un-repertoire" data-claire-element-id="561063">Fermer un répertoire</h2><pre id="r-561061" data-claire-element-id="561061"><code data-claire-semantic="c">int closedir(DIR* repertoire);</code></pre><p id="r-561062" data-claire-element-id="561062">On dirait fclose pas vrai ? ^^ <br/> Cette fonction attend un pointeur sur DIR et renvoie un int qui correspond à un code d'erreur, 0 si la fermeture s'est bien exécutée, -1 s'il y a eu un souci.</p><h2 id="r-le-code-complet-commente" data-claire-element-id="561066">Le code complet commenté</h2><pre id="r-561064" data-claire-element-id="561064"><code data-claire-semantic="c">#include &lt;stdlib.h&gt; 
#include &lt;stdio.h&gt; 
/* stdlib pour exit(), et stdio pour puts() */

#include &lt;dirent.h&gt; 
/* Pour l'utilisation des dossiers */

#ifndef WIN32
    #include &lt;sys/types.h&gt;
#endif

int main(void)
{
    DIR* rep = NULL;
    rep = opendir(&quot;D:\\Mes Documents\\JaKy&quot;); /* Ouverture d'un dossier */

    if (rep == NULL) /* Si le dossier n'a pas pu être ouvert */
        exit(1); /* (mauvais chemin par exemple) */
        

    puts(&quot;Le dossier a ete ouvert avec succes&quot;);

    if (closedir(rep) == -1) /* S'il y a eu un souci avec la fermeture */
        exit(-1);

    puts(&quot;Le dossier a ete ferme avec succes&quot;);

    return 0;
}</code></pre><p id="r-561065" data-claire-element-id="561065">Je pense que ce code est suffisamment explicite pour ne pas être expliqué. ^^</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h">Parcourir les dossiers avec dirent.h</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/ouverture-et-fermeture-de-dossiers">
Ouverture et fermeture de dossiers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/utiliser-errno">
Utiliser errno
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/manipuler-des-fichiers-a-l-interieur-d-un-dossier">
Manipuler des fichiers à l&#039;intérieur d&#039;un dossier
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/deplacement-dans-un-repertoire">
Déplacement dans un répertoire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/exercices-33">
Exercices
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/utiliser-errno">
<span class="next">Utiliser errno</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Utilisererrno"></a><h2>Utiliser errno</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/ouverture-et-fermeture-de-dossiers">
<span class="arrow"></span>
<span class="next">Ouverture et fermeture de dossiers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/manipuler-des-fichiers-a-l-interieur-d-un-dossier">
<span class="next">Manipuler des fichiers à l&#039;intérieur d&#039;un dossier</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<div id="r-561069" data-claire-element-id="561069" data-claire-semantic="question"><p id="r-561068" data-claire-element-id="561068">errno ? Drôle de nom... Cela a-t-il un rapport direct avec la manipulation des dossiers ?</p></div><p id="r-561070" data-claire-element-id="561070">Non en effet, les deux ne sont pas directement liés. Néanmoins, j'ai décidé d'en toucher quelques mots pour deux raisons :</p><ul id="r-561075" data-claire-element-id="561075"><li id="r-561072" data-claire-element-id="561072"><p id="r-561071" data-claire-element-id="561071">si j'en parle, c'est qu'il y a quand même un rapport avec dirent :) ;</p></li><li id="r-561074" data-claire-element-id="561074"><p id="r-561073" data-claire-element-id="561073">j'ai l'impression que l'utilisation d'errno est très méconnue sur le SdZ... Elle est pourtant très utile, alors pourquoi ne pas vous expliquer son fonctionnement ?</p></li></ul><h2 id="r-la-variable-errno" data-claire-element-id="561083">La variable errno</h2><p id="r-561076" data-claire-element-id="561076">Entrons dans le vif du sujet. Je pose le problème : vous avez essayé d'ouvrir un dossier mais pour une raison obscure, l'ouverture a échoué. Comment faire pour savoir d'où vient le problème ? Est-ce tout simplement parce que le dossier n'existe pas, ou peut-être est-il protégé ?<br/><a href="http://www.linux-kheops.com/doc/man/manfr/man-html-0.9/man3/errno.3.html"><strong>errno</strong></a> est là pour tout nous éclaircir. ;) <br/> Cette variable (globale) de type <strong>int</strong> peut prendre plusieurs valeurs de defines prédéfinies. Si vous regardez ce <a href="http://www.linux-kheops.com/doc/man/manfr/man-html-0.9/man3/errno.3.html">lien</a>, vous pouvez voir une longue liste de defines ayant chacun une valeur (valeur que nous ne connaissons pas, et d'ailleurs on s'en moque bien :p ). <br/> Quand une erreur est déclarée, errno prend la valeur d'une de ces valeurs pour permettre au programmeur de connaître la source du problème.</p><div id="r-561078" data-claire-element-id="561078" data-claire-semantic="question"><p id="r-561077" data-claire-element-id="561077">Comment utiliser errno ?</p></div><p id="r-561079" data-claire-element-id="561079">C'est une simple variable, vous n'avez qu'à faire un test d'égalité pour connaître sa valeur :</p><pre id="r-561080" data-claire-element-id="561080"><code data-claire-semantic="c">if (errno == EACCES) /* Accès interdit */
    puts(&quot;Acces interdit&quot;);</code></pre><aside id="r-561082" data-claire-element-id="561082" data-claire-semantic="warning"><p id="r-561081" data-claire-element-id="561081">N'oubliez pas d'inclure errno.h dans votre code, sinon c'est l'erreur de compilation assurée !</p></aside><h2 id="r-une-autre-maniere-d-utiliser-errno" data-claire-element-id="561099">Une autre manière d'utiliser errno</h2><p id="r-561084" data-claire-element-id="561084">Utiliser errno de cette façon, c'est bien, mais c'est assez barbant de faire des tests d'égalité, surtout quand on voit qu'il y a environ 40 valeurs d'erreurs possibles à tester... C'est pour cette raison qu'il existe une autre fonction, <a href="http://www.linux-kheops.com/doc/man/manfr/man-html-0.9/man3/perror.3.html"><strong>perror()</strong></a> permettant d'obtenir les erreurs dans un format lisible. :)</p><pre id="r-561085" data-claire-element-id="561085"><code data-claire-semantic="c">void perror(const char* str) ;</code></pre><p id="r-561086" data-claire-element-id="561086">La fonction attend une chaîne de caractères qui sera écrite à l'écran (à la manière d'un printf()). Ensuite, perror() se contentera de décrire l'erreur (<em>in English of course</em>).</p><pre id="r-561087" data-claire-element-id="561087"><code data-claire-semantic="c">/* Imaginons que errno ait pris la valeur ENOENT. */
perror(&quot;Erreur : &quot;);</code></pre><pre id="r-561088" data-claire-element-id="561088"><code data-claire-semantic="console">Erreur : : No such file or directory</code></pre><p id="r-561089" data-claire-element-id="561089">Ce qui signifie : Pas de fichier ou de répertoire.</p><div id="r-561091" data-claire-element-id="561091" data-claire-semantic="question"><p id="r-561090" data-claire-element-id="561090">C'est pratique. :) Mais pourquoi y a-t-il deux points en plus ?</p></div><p id="r-561092" data-claire-element-id="561092">Si la chaîne envoyée à perror est nulle, alors les deux points ne seront pas imprimés. Mais si vous envoyez une chaîne de caractères non nulle, ils le seront. :)</p><h3 id="r-coupler-perror-et-opendir" data-claire-element-id="561098">Coupler perror et opendir</h3><p id="r-561093" data-claire-element-id="561093">Maintenant que vous connaissez perror(), tout devient plus simple pour connaître la source d'une erreur !</p><pre id="r-561094" data-claire-element-id="561094"><code data-claire-semantic="c">DIR* rep = NULL;
rep = opendir(&quot;D:\\Mes Documents\\JaKy&quot;); /* Ouverture d'un dossier */

if (rep == NULL) /* Si le dossier n'a pas pu être ouvert, */
    perror(&quot;&quot;); /* perror() va nous écrire l'erreur. */</code></pre><p id="r-561095" data-claire-element-id="561095">Sachez que errno, c'est encore mieux que ça ! Si vous regardez <a href="http://www.linux-kheops.com/doc/man/manfr/man-html-0.9/man3/opendir.3.html">la documentation de la fonction opendir</a> (man pages), vous pourrez voir une liste de valeurs que errno peut prendre. :) <br/> D'ailleurs, vous pouvez faire de même pour la fonction <a href="http://www.linux-kheops.com/doc/man/manfr/man-html-0.9/man3/closedir.3.html">closedir()</a>. S'il y a échec de cette fonction, errno prendra la valeur EBADF. ;)</p><aside id="r-561097" data-claire-element-id="561097" data-claire-semantic="information"><p id="r-561096" data-claire-element-id="561096">Rappelez-vous : errno ne se limite pas à la manipulation des dossiers. D'autres fonctions standards l'utilisent, comme fopen() par<br/> exemple. :)</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h">Parcourir les dossiers avec dirent.h</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/ouverture-et-fermeture-de-dossiers">
Ouverture et fermeture de dossiers
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/utiliser-errno">
Utiliser errno
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/manipuler-des-fichiers-a-l-interieur-d-un-dossier">
Manipuler des fichiers à l&#039;intérieur d&#039;un dossier
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/deplacement-dans-un-repertoire">
Déplacement dans un répertoire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/exercices-33">
Exercices
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/ouverture-et-fermeture-de-dossiers">
<span class="arrow"></span>
<span class="next">Ouverture et fermeture de dossiers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/manipuler-des-fichiers-a-l-interieur-d-un-dossier">
<span class="next">Manipuler des fichiers à l&#039;intérieur d&#039;un dossier</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Manipulerdesfichiersl039intrieurd039undossier"></a><h2>Manipuler des fichiers à l&#039;intérieur d&#039;un dossier</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/utiliser-errno">
<span class="arrow"></span>
<span class="next">Utiliser errno</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/deplacement-dans-un-repertoire">
<span class="next">Déplacement dans un répertoire</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-561101" data-claire-element-id="561101">Après s'être intéressés à errno, nous allons pouvoir coder des choses intéressantes. :) Maintenant que l'on sait ouvrir et fermer un répertoire, pourquoi n'irait-on pas regarder ce qui se trouve dedans ?</p><h2 id="r-la-fonction-readdir" data-claire-element-id="561118">La fonction readdir</h2><p id="r-561102" data-claire-element-id="561102">C'est sûrement la fonction la plus importante du tutoriel. :p Voyons son prototype :</p><pre id="r-561103" data-claire-element-id="561103"><code data-claire-semantic="c">struct dirent* readdir(DIR* repertoire) ;</code></pre><p id="r-561104" data-claire-element-id="561104"><a href="http://www.linux-kheops.com/doc/man/manfr/man-html-0.9/man3/readdir.3.html">readdir()</a> prend en paramètre un pointeur sur DIR ; ça, vous connaissez. ;) <br/> Par contre elle renvoie... un pointeur sur une structure dirent. o_O</p><p id="r-561105" data-claire-element-id="561105">Eh bien cette structure, elle <em>simule</em> le fichier du dossier qui sera lu ! C'est une structure qui est également définie dans dirent.h. ;) D'ailleurs, encore un peu d'<em>english</em> : dirent signifie <strong>DIRectory ENTity</strong>, qui signifie entité de répertoire, qui signifie : c'est l'objet que contient un répertoire (dossier, fichiers...).</p><p id="r-561106" data-claire-element-id="561106">Pour ne pas vous embrouiller avec le mot entité, j'emploierai le terme de fichier, mais ne faites pas de confusions avec les FILE*. :-°</p><aside id="r-561108" data-claire-element-id="561108" data-claire-semantic="information"><p id="r-561107" data-claire-element-id="561107">readdir() renvoie NULL s'il n'y a plus de fichier à lire.</p></aside><p id="r-561109" data-claire-element-id="561109">Vous voulez du code ? Parfait. Ce code permet de lire le premier fichier d'un répertoire (je vous passe les directives de préprocesseur) :</p><pre id="r-561110" data-claire-element-id="561110"><code data-claire-semantic="c">int main()
{
    DIR* rep = NULL;
    struct dirent* fichierLu = NULL; /* Déclaration d'un pointeur vers la structure dirent. */
    rep = opendir(&quot;D:\\Mes Documents\\JaKy&quot;);
    if (rep == NULL)
        exit(1);

    fichierLu = readdir(rep); /* On lit le premier répertoire du dossier. */

    if (closedir(rep) == -1)
        exit(-1);

    return 0;
}</code></pre><p id="r-561111" data-claire-element-id="561111">Après l'appel de readdir, le pointeur de structure <em>fichierLu</em> pointe vers le premier répertoire du dossier JaKy !</p><div id="r-561113" data-claire-element-id="561113" data-claire-semantic="question"><p id="r-561112" data-claire-element-id="561112">Le mot-clé struct me gêne ! J'ai essayé de l'enlever et j'ai une erreur de compilation : dirent undeclared...</p></div><p id="r-561114" data-claire-element-id="561114">En effet, les développeurs n'ont pas fait de typedef à cette structure. Néanmoins, je suis persuadé que vous savez le faire.</p><figure id="r-561116" data-claire-element-id="561117"><img id="r-561115" data-claire-element-id="561115" src="medias/nayi.free.fr_smilies_s_bigrin.gif" alt="Image utilisateur"/></figure><h2 id="r-lister-le-contenu-d-un-repertoire" data-claire-element-id="561138">Lister le contenu d'un répertoire</h2><p id="r-561119" data-claire-element-id="561119">C'est bien joli d'utiliser readdir mais... comment savoir quel est le nom du fichier qui est lu ?<br/> C'est bien simple : la structure dirent contient une variable membre, une chaîne de caractères précisément, appelée <strong>d_name</strong>, qui contient le nom de notre fichier !</p><pre id="r-561120" data-claire-element-id="561120"><code data-claire-semantic="c">fichierLu = readdir(rep);
printf(&quot;Le fichier lu s'appelle '%s'&quot;, fichierLu-&gt;d_name); /* On utilise la flèche
car fichierLu est un POINTEUR de structure. */</code></pre><p id="r-561121" data-claire-element-id="561121">Résultat :</p><pre id="r-561122" data-claire-element-id="561122"><code data-claire-semantic="console">Le fichier lu s'appelle '.'</code></pre><div id="r-561124" data-claire-element-id="561125" data-claire-semantic="question"><img id="r-561125" data-claire-element-id="561124" src="medias/nayi.free.fr_smilies_s_mort.gif" alt="Image utilisateur"/><p id="r-561123" data-claire-element-id="561123">Gné ? Pourquoi on a droit à un point ?</p></div><p id="r-561126" data-claire-element-id="561126">Le point représente le dossier actuel, celui dans lequel on se trouve ! Si vous connaissez la commande cd, alors :</p><pre id="r-561127" data-claire-element-id="561127"><code data-claire-semantic="bash">cd ./Machin/Truc</code></pre><p id="r-561128" data-claire-element-id="561128">Ceci devrait vous éclairer l'esprit. :)</p><p id="r-561129" data-claire-element-id="561129">Je vous propose maintenant de continuer à lire notre répertoire. On va donc rajouter une 2e fois la fonction readdir().</p><pre id="r-561130" data-claire-element-id="561130"><code data-claire-semantic="c">fichierLu = readdir(rep);
printf(&quot;Le fichier lu s'appelle '%s'\n&quot;, fichierLu-&gt;d_name);
fichierLu = readdir(rep);
printf(&quot;Le fichier lu s'appelle '%s'&quot;, fichierLu-&gt;d_name);</code></pre><pre id="r-561131" data-claire-element-id="561131"><code data-claire-semantic="console">Le fichier lu s'appelle '.'
Le fichier lu s'appelle '..'</code></pre><p id="r-561132" data-claire-element-id="561132">Les deux points représentent le dossier précédent, le dossier qui <em>contient</em> celui dans lequel on se trouve.</p><p id="r-561133" data-claire-element-id="561133">Continuons encore un peu. Comme nous voulons lister TOUT le répertoire, il va donc falloir utiliser une boucle qui lira le fichier tant que l'on n'est pas à la fin du dossier... autrement dit, tant que notre fichier est différent de NULL, je l'avais précisé juste avant. ;)</p><pre id="r-561134" data-claire-element-id="561134"><code data-claire-semantic="c">while ((fichierLu = readdir(rep)) != NULL)
    printf(&quot;Le fichier lu s'appelle '%s'\n&quot;, fichierLu-&gt;d_name);</code></pre><p id="r-561135" data-claire-element-id="561135">Normalement vous devriez reconnaître la syntaxe de la boucle while() dans le TP du Pendu et dans l'annexe sur la saisie sécurisée. On lit le répertoire tant qu'il y a quelque chose à lire, et on affiche le nom.</p><aside id="r-561137" data-claire-element-id="561137" data-claire-semantic="information"><p id="r-561136" data-claire-element-id="561136">Pour savoir quel fichier readdir() doit lire, un curseur virtuel est créé : à chaque appel de cette fonction(), le curseur avance d'un pas. ;)</p></aside><h2 id="r-ouvrir-un-fichier-3" data-claire-element-id="561144">Ouvrir un fichier</h2><p id="r-561139" data-claire-element-id="561139">O.K., maintenant, on sait lire et afficher le contenu de tout le répertoire. Afficher, c'est bien beau, mais pas très utile, alors pourquoi ne pas charger quelque chose, comme un fichier .txt ou un .jpg par exemple ?<br/> La plupart des fonctions permettant de charger une ressource (comme <a href="http://sdl.beuc.net/sdl.wiki/SDL_LoadBMP">SDL_LoadBMP</a> (de SDL) pour les .bmp, <a href="http://www.fmod.org/docs/HTML/FSOUND_Sample_Load.html">FSOUND_Sample_Load</a> (de FMOD) pour un .mp3, ou même opendir :) ) attendent, comme argument, une chaîne de caractères qui elle-même contient le nom de la ressource à charger.<br/> Quelle coïncidence ! La variable membre de la structure dirent est aussi une chaîne de caractères !<br/> Conclusion : pour charger quelque chose, il suffit juste de passer en paramètre <strong>d_name</strong>. :D</p><pre id="r-561140" data-claire-element-id="561140"><code data-claire-semantic="c">/* Imaginons que d_name = &quot;image.bmp&quot; */
img = SDL_LoadBMP(fichierLu-&gt;d_name);</code></pre><aside id="r-561142" data-claire-element-id="561143" data-claire-semantic="warning"><img id="r-561143" data-claire-element-id="561142" src="medias/nayi.free.fr_smilies_s_neutre_final.gif" alt="Image utilisateur"/><p id="r-561141" data-claire-element-id="561141">Si vous utilisez des chemins absolus, vous devez créer une nouvelle chaîne assez grande contenant C:\Program Files\ + leNomDuFichier par exemple, car d_name contient seulement le nom du fichier lu et <strong>PAS</strong> son arborescence.</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h">Parcourir les dossiers avec dirent.h</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/ouverture-et-fermeture-de-dossiers">
Ouverture et fermeture de dossiers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/utiliser-errno">
Utiliser errno
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/manipuler-des-fichiers-a-l-interieur-d-un-dossier">
Manipuler des fichiers à l&#039;intérieur d&#039;un dossier
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/deplacement-dans-un-repertoire">
Déplacement dans un répertoire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/exercices-33">
Exercices
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/utiliser-errno">
<span class="arrow"></span>
<span class="next">Utiliser errno</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/deplacement-dans-un-repertoire">
<span class="next">Déplacement dans un répertoire</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Dplacementdansunrpertoire"></a><h2>Déplacement dans un répertoire</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/manipuler-des-fichiers-a-l-interieur-d-un-dossier">
<span class="arrow"></span>
<span class="next">Manipuler des fichiers à l&#039;intérieur d&#039;un dossier</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/exercices-33">
<span class="next">Exercices</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-561146" data-claire-element-id="561146">Ça y est ! On a fini le &quot;gros&quot; du tutoriel. Néanmoins, dirent.h propose quelques fonctions utiles à connaître dont il serait impensable que je ne parle pas. :p</p><h2 id="r-theorie-21" data-claire-element-id="561162">Théorie</h2><aside id="r-561148" data-claire-element-id="561148" data-claire-semantic="warning"><p id="r-561147" data-claire-element-id="561147">Cette partie est uniquement théorique, la pratique arrive juste après, je vous expliquerai pourquoi.</p></aside><p id="r-561149" data-claire-element-id="561149">Juste avant, je vous ai parlé d'un curseur virtuel, qui s'incrémente à chaque fois que l'on lit un fichier. Je vais vous montrer les quelques fonctions qui permettent de l'utiliser. :)</p><h3 id="r-ou-sommes-nous-dans-le-repertoire" data-claire-element-id="561153">Où sommes-nous dans le répertoire ?</h3><p id="r-561150" data-claire-element-id="561150">Il existe une fonction qui nous permet de savoir où se trouve ce curseur. Si vous avez de la mémoire (concernant les fichiers) et un peu de jugeote, vous ne devriez pas peiner à trouver le nom de la fonction... c'est <strong>telldir()</strong>. ;)</p><pre id="r-561151" data-claire-element-id="561151"><code data-claire-semantic="c">long telldir(DIR* rep) ;</code></pre><p id="r-561152" data-claire-element-id="561152">Je ne vais même pas détailler cette fonction tellement elle coule de source. ;)</p><h3 id="r-si-on-retournait-au-debut" data-claire-element-id="561157">Si on retournait au début ?</h3><p id="r-561154" data-claire-element-id="561154">La fonction <strong>rewinddir()</strong> permet de faire cela :</p><pre id="r-561155" data-claire-element-id="561155"><code data-claire-semantic="c">void rewinddir(DIR* rep) ;</code></pre><p id="r-561156" data-claire-element-id="561156">Je vous l'avais dit : ça ressemble énormément aux fichiers !</p><h3 id="r-je-veux-aller-ici" data-claire-element-id="561161">Je veux aller ici !</h3><p id="r-561158" data-claire-element-id="561158">La fonction <strong>seekdir()</strong> permet de se positionner dans un dossier.</p><pre id="r-561159" data-claire-element-id="561159"><code data-claire-semantic="c">void seekdir(DIR* rep, long pos) ;</code></pre><p id="r-561160" data-claire-element-id="561160">Elle attend un répertoire, et un long correspondant à la position à laquelle le curseur doit se placer.</p><h2 id="r-pratique-16" data-claire-element-id="561183">Pratique</h2><p id="r-561163" data-claire-element-id="561163">La raison pour laquelle j'ai fait deux parties est la suivante : il y a des différences (celles dont je vous ai parlé au début du tutoriel) entre Unix et Windows. L'utilisation des fonctions énoncées juste avant est plus <em>simple</em> sous Windows par rapport à un système UNIX (ce n'est pas un troll je vous rassure) : par exemple, la fonction telldir() renverra des positions lisibles pour nous alors que ce n'est pas le cas pour les systèmes UNIX. Je vais donc découper la suite en 2 partie : une pour Unix et une autre pour Windows.</p><aside id="r-561165" data-claire-element-id="561165" data-claire-semantic="warning"><p id="r-561164" data-claire-element-id="561164">Je vous parlerai uniquement de telldir() et seekdir(), puisque la fonction rewinddir() ne change pas.</p></aside><h3 id="r-windows-13" data-claire-element-id="561172">Windows</h3><p id="r-561166" data-claire-element-id="561166">Pour prouver ce que j'ai dit précédemment, un petit exemple s'impose :</p><pre id="r-561167" data-claire-element-id="561167"><code data-claire-semantic="c">while ((fichierLu = readdir(rep)) != NULL)
    printf(&quot;%ld -&gt; %s\n&quot;, telldir(rep), fichierLu-&gt;d_name); 

seekdir(rep, 2); /* On se place au 2e fichier. */
printf(&quot;\n%s\n&quot;, readdir(rep)-&gt;d_name);

seekdir(rep, 4); /* On se place au 4e fichier. */
printf(&quot;\n%s\n&quot;, readdir(rep)-&gt;d_name);</code></pre><pre id="r-561168" data-claire-element-id="561168"><code data-claire-semantic="console">1 -&gt; .
2 -&gt; ..
3 -&gt; Boulot
4 -&gt; Lettre.doc
5 -&gt; guitare.mp3
6 -&gt; text.txt

Boulot

guitare.mp3</code></pre><aside id="r-561170" data-claire-element-id="561170" data-claire-semantic="information"><p id="r-561169" data-claire-element-id="561169">Comme readdir() avance d'un pas, nos informations sont décalées. ;)</p></aside><p id="r-561171" data-claire-element-id="561171">Voilà, vous pouvez vous amuser à vous placer, déplacer, un p'tit coup de rewinddir, etc. :D Il n'y a rien de déroutant ici.</p><h3 id="r-unix" data-claire-element-id="561182">Unix</h3><p id="r-561173" data-claire-element-id="561173">Vous allez peut-être trouver ça étrange, mais la valeur renvoyée par la fonction telldir() n'est pas faite pour être comprise par les humains. o_O D'ailleurs, vous pouvez essayer par vous-même :</p><pre id="r-561174" data-claire-element-id="561174"><code data-claire-semantic="c">for (i = 0; i &lt; 5; i++)
{
    ent = readdir(rep);
    printf(&quot;%s a la position %ld\n&quot;, ent-&gt;d_name, telldir(rep));
}</code></pre><p id="r-561175" data-claire-element-id="561175">Vous pouvez constater que pour la position numéro 1, on a bien droit à 1. :) Mais par la suite, vous allez avoir des chiffres faramineux comme 17548554 ou 754104119...</p><div id="r-561177" data-claire-element-id="561177" data-claire-semantic="question"><p id="r-561176" data-claire-element-id="561176">Mais alors, cette fonction ne nous sert à rien ! Et c'est pareil pour seekdir, non ?</p></div><p id="r-561178" data-claire-element-id="561178">En effet, pour la première question, utiliser telldir() tel quel ne nous sert à rien... Mais couplée à seekdir(), elle peut se révéler utile !</p><p id="r-561179" data-claire-element-id="561179">La fonction seekdir(), elle aussi, attend une position incompréhensible pour nous... mais elle comprend la position renvoyée par telldir().<br/> Vous ne voyez pas où je veux en venir ? Eh bien, imaginez que vous avez besoin de lire un certain nombre précis de fichiers, et que vous devez retourner au début du répertoire, puis retourner au dernier fichier qu'on a lu tout à l'heure... Vous n'allez pas refaire une boucle de readdir(). :waw:</p><pre id="r-561180" data-claire-element-id="561180"><code data-claire-semantic="c">for (i = 0; i &lt; 5; i++)
{
    ent = readdir(rep); /* On lit jusqu'au 5e fichier du répertoire. */
}

pos = telldir(rep); /* On récupère la position actuelle dans une variable de type long. */
printf(&quot;%s : %ld\n&quot;, ent-&gt;d_name, pos);

rewinddir(rep); /* Pour une quelconque raison, on doit revenir au début. */

seekdir(rep, pos); /* On se place à la 5e position en envoyant la variable pos. */
    
ent = readdir(rep); /* On lit le répertoire suivant. */</code></pre><p id="r-561181" data-claire-element-id="561181">Voilà la seule utilisation possible de seekdir() et de telldir(). C'est certes compliqué, mais de toute façon, il y a peu de chances que vous utilisiez le curseur virtuel vous-même. ;)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h">Parcourir les dossiers avec dirent.h</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/ouverture-et-fermeture-de-dossiers">
Ouverture et fermeture de dossiers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/utiliser-errno">
Utiliser errno
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/manipuler-des-fichiers-a-l-interieur-d-un-dossier">
Manipuler des fichiers à l&#039;intérieur d&#039;un dossier
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/deplacement-dans-un-repertoire">
Déplacement dans un répertoire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/exercices-33">
Exercices
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/manipuler-des-fichiers-a-l-interieur-d-un-dossier">
<span class="arrow"></span>
<span class="next">Manipuler des fichiers à l&#039;intérieur d&#039;un dossier</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/exercices-33">
<span class="next">Exercices</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Exercices"></a><h2>Exercices</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/deplacement-dans-un-repertoire">
<span class="arrow"></span>
<span class="next">Déplacement dans un répertoire</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-561185" data-claire-element-id="561185">Quoi de mieux pour s'entraîner, me direz-vous ?<br/> Dans cette partie, je vais vous proposer 3 exercices, à difficulté croissante. :)</p><h2 id="r-compter-le-nombre-de-fichiers" data-claire-element-id="561191">Compter le nombre de fichiers</h2><p id="r-561186" data-claire-element-id="561186">Créez une fonction qui attend un pointeur sur DIR* et qui renvoie un int contenant le nombre de fichiers et/ou de dossiers (vous pouvez faire les 2 :) ) dans ce répertoire. Attention : les dossiers parents et actuels (. et ..) ne seront pas comptés !</p><h3 id="r-corrige-7" data-claire-element-id="561190">Corrigé</h3><div id="r-561188" data-claire-element-id="561188"><pre id="r-561187" data-claire-element-id="561187"><code data-claire-semantic="c">int compterFichier(DIR* dir)
{
    int nbr = 0;
    struct dirent* ent = NULL;

    while ((ent = readdir(dir)) != NULL)
    {
        if (strcmp(ent-&gt;d_name, &quot;.&quot;) != 0 &amp;&amp; /* Si le fichier lu n'est pas . */
            strcmp(ent-&gt;d_name, &quot;..&quot;) != 0) /*  Et n'est pas .. non plus */
        nbr++; /* Alors on incrémente le compteur */
    }

    return nbr;
}</code></pre></div><p id="r-561189" data-claire-element-id="561189">Pas très très difficile n'est-ce pas ? :p</p><h2 id="r-savoir-si-le-fichier-lu-est-un-repertoire-ou-non" data-claire-element-id="561200">Savoir si le fichier lu est un répertoire ou non</h2><p id="r-561192" data-claire-element-id="561192">Votre mission, si vous l'acceptez, est la suivante : vous devez créer une fonction qui prend en paramètre un pointeur sur une structure dirent (ou une chaîne de caractères qui contiendrait un chemin) et qui renvoie 1 si ce pointeur de structure est un répertoire, ou 0 s'il n'en est pas un.</p><pre id="r-561193" data-claire-element-id="561193"><code data-claire-semantic="c">int isDir(struct dirent* ent) ;</code></pre><p id="r-561194" data-claire-element-id="561194">Voici un très très gros indice si vous ne voyez pas comment procéder. ;)</p><div id="r-561196" data-claire-element-id="561196"><p id="r-561195" data-claire-element-id="561195">Vérifier si le nom du fichier a une extension (.jpg, .mp3, etc.).</p></div><h3 id="r-corrige-8" data-claire-element-id="561199">Corrigé</h3><div id="r-561198" data-claire-element-id="561198"><pre id="r-561197" data-claire-element-id="561197"><code data-claire-semantic="c">int isDir(struct dirent* ent)
{
    if ((strchr(ent-&gt;d_name, '.')) == NULL) /* Si le nom du fichier n'a pas de point (une extension). */
        return 1;
    else
        return 0;
}</code></pre></div><h2 id="r-se-deplacer-librement-dans-un-repertoire" data-claire-element-id="561239">Se déplacer librement dans un répertoire</h2><p id="r-561201" data-claire-element-id="561201">Là, on passe à un cran au-dessus ! Le but est de se déplacer librement dans une arborescence de répertoire. Voici comment le programme devra se dérouler.</p><ul id="r-561210" data-claire-element-id="561210"><li id="r-561203" data-claire-element-id="561203"><p id="r-561202" data-claire-element-id="561202">L'utilisateur ouvre un dossier de son choix par le biais d'une chaîne de caractères sous la forme &quot;nomDuDossier/&quot;. Si l'entrée n'existe pas, on quitte tout.</p></li><li id="r-561205" data-claire-element-id="561205"><p id="r-561204" data-claire-element-id="561204">On affiche tous les fichiers du répertoire ouvert.</p></li><li id="r-561207" data-claire-element-id="561207"><p id="r-561206" data-claire-element-id="561206">L'utilisateur entre une nouvelle chaîne de caractères. Si c'est un fichier, on le précise et on ferme le programme, si c'est un répertoire, on efface l'écran, on entre dans ce répertoire, et on affiche les fichiers qui sont dedans.</p></li><li id="r-561209" data-claire-element-id="561209"><p id="r-561208" data-claire-element-id="561208">Etc.</p></li></ul><p id="r-561211" data-claire-element-id="561211">Voilà qui devrait vous occuper plus de temps. :) Mais je ne vais tout de même pas vous abandonner là, je vais vous donner quelques conseils pour procéder :</p><p id="r-561212" data-claire-element-id="561212"></p><div id="r-561214" data-claire-element-id="561214"><p id="r-561213" data-claire-element-id="561213">Créer un main() contenant 2 variables : le chemin du fichier et un DIR*. Envoyez ces variables à une fonction parcourirDossier. La fonction parcourirDossier appellera d'autres fonctions : une fonction lire() permettant de lire le chemin, une fonction lireDossier permettant de faire une boucle de readdir() et faire en sorte qu'on rappelle la fonction parcourirDossier pour continuer... Voici quelques pistes pour démarrer. :)</p></div><h3 id="r-corrige-9" data-claire-element-id="561218">Corrigé</h3><div id="r-561216" data-claire-element-id="561216"><pre id="r-561215" data-claire-element-id="561215"><code data-claire-semantic="c">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;dirent.h&gt;

#ifndef WIN32
    #include &lt;sys/types.h&gt;
    #define CLEAR &quot;clear&quot; 
    /* system(&quot;clear&quot;) pour UNIX */
#else
    #define CLEAR &quot;cls&quot; 
    /* system(&quot;cls&quot;) pour Windows */
#endif

int isDir(char* s)
{
    if ((strchr(s, '.')) == NULL) /* Si le nom du chemin n'a pas de point (une extension). */
        return 1;
    else
        return 0;
}

void lire(char* s)
{
    char *enter = NULL;
    char temp[100] = &quot;&quot;; /* Chaîne de caractères temporaire contenant la saisie de l'utilisateur. */

    fgets(temp, 99, stdin);

    enter = strchr(temp, '\n'); /* Voir le chapitre des saisies sécurisées. */
    if (enter != NULL)
        *enter = '\0';

    strcat(s, temp); /* On ajoute à la suite le nom du dossier
    pour obtenir quelque chose comme C:/nom/nom/ pour Win
    ou /nom/nom/ pour UNIX. */
}


void lireDossier(char* s, DIR* rep)
{
    struct dirent* ent = NULL;

    printf(&quot; -- Lecture du dossier '%s' -- \n&quot;, s);

    while ((ent = readdir(rep)) != NULL) /* Lecture du dossier. */
        printf(&quot;%s\n&quot;, ent-&gt;d_name);

    printf(&quot;\n\n -- Que voulez-vous ouvrir -- ?\n&quot;);
}

void parcourirDossier(DIR* rep, char* chemin)
{
    lire(chemin); /* Lecture du nouveau chemin; */

    system(CLEAR); /* On efface l'écran. */

    if (!isDir(chemin))
    {
        printf(&quot;%s n'est pas un dossier&quot;, chemin);
        exit(-1);
    }

    rep = opendir(chemin);

    if (rep == NULL)
    {
        printf(&quot;Le dossier '%s' n'a pas pu etre ouvert&quot;, chemin);
        exit(-1);
    }

    lireDossier(chemin, rep); /* Lecture... */

    closedir(rep); /* Fermeture du répertoire. */

    parcourirDossier(rep, chemin); /* On rappelle la fonction parcourirDossier (récursivité). */
}

int main()
{
    DIR* rep = NULL;
    char chemin[500] = &quot;&quot;;

    parcourirDossier(rep, chemin);

    closedir(rep);

    return 0;
}</code></pre></div><p id="r-561217" data-claire-element-id="561217">Si vous avez réussi ce programme sans regarder la solution, je vous félicite. :) Pour les autres, l'exercice étant difficile, ce n'est pas très grave. ;) Néanmoins, jetez un coup d'œil à mon code source, essayez de le comprendre et de faire... quelques améliorations !</p><h3 id="r-ameliorations-29" data-claire-element-id="561238">Améliorations</h3><p id="r-561219" data-claire-element-id="561219">Pour vous exercer (et aussi parce que le code ci-dessus a encore quelques défauts), voici quelques améliorations que vous pouvez implémenter.</p><ul id="r-561232" data-claire-element-id="561232"><li id="r-561221" data-claire-element-id="561221"><p id="r-561220" data-claire-element-id="561220">C'est assez barbant pour l'utilisateur de devoir retaper &quot;/&quot; à chaque fois que l'on entre dans un nouveau dossier... Pourquoi ne pas faire en sorte qu'il n'ait pas besoin de le taper ?</p></li><li id="r-561223" data-claire-element-id="561223"><p id="r-561222" data-claire-element-id="561222">Le point ( . ) ne marche pas... Ré-affichez le dossier actuel. :)</p></li><li id="r-561225" data-claire-element-id="561225"><p id="r-561224" data-claire-element-id="561224">Plus difficile : les deux points ( .. ) qui permettent de retourner au dossier précédent.</p></li><li id="r-561227" data-claire-element-id="561227"><p id="r-561226" data-claire-element-id="561226">Faire un petit menu qui contiendrait plusieurs actions : rename, remove...</p></li><li id="r-561230" data-claire-element-id="561231"><img id="r-561231" data-claire-element-id="561230" src="medias/nayi.free.fr_smilies_s_yurk.gif" alt="Image utilisateur"/><p id="r-561228" data-claire-element-id="561228">Si le fichier lu n'est pas un dossier, utilisez un FILE* et affichez le contenu du fichier :) (attention à certains formats comme les images, c'est assez...</p><p id="r-561229" data-claire-element-id="561229">, préférez les .txt !).</p></li></ul><p id="r-561233" data-claire-element-id="561233">Et maintenant, histoire de fatiguer vos méninges encore plus, voici un QCM. :diable:</p><p id="r-561234" data-claire-element-id="561234">Vous êtes arrivés à la fin de ce tutoriel ! Félicitations !</p><p id="r-561235" data-claire-element-id="561235">Avant de nous quitter, j'ai plusieurs choses à vous dire : sous Windows, pour manipuler les répertoires de manière standard, vous devez pouvez utiliser l'API Windows. Un début de piste <a href="http://c.developpez.com/faq/index.php?page=fichiers#FICHIERS_dir_list">ici</a>. ;) Car comme je l'ai dit au début, dirent est un standard pour UNIX qui a été porté pour Windows par la suite. :)</p><p id="r-561236" data-claire-element-id="561236">Je tiens à énormément remercier <strong>Pierre89</strong>, qui m'a donné accès au tutoriel qu'il avait fait sur le même sujet et qui n'avait malheureusement pas été validé, qui m'a donné une base pour écrire le mien, et qui m'a donné quelques renseignements ; un merci à <strong>Lunaro</strong> aussi pour la relecture du tutoriel, et à <strong>Nanoc</strong> pour ses conseils. :)</p><p id="r-561237" data-claire-element-id="561237">Sur ce, j'espère vous avoir aidé. ;) <br/> Monsieur_JaKy.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h">Parcourir les dossiers avec dirent.h</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/ouverture-et-fermeture-de-dossiers">
Ouverture et fermeture de dossiers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/utiliser-errno">
Utiliser errno
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/manipuler-des-fichiers-a-l-interieur-d-un-dossier">
Manipuler des fichiers à l&#039;intérieur d&#039;un dossier
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/deplacement-dans-un-repertoire">
Déplacement dans un répertoire
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/exercices-33">
Exercices
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/parcourir-les-dossiers-avec-dirent-h/deplacement-dans-un-repertoire">
<span class="arrow"></span>
<span class="next">Déplacement dans un répertoire</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/arcourir-les-dossiers-avec-dirent-h.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 09:01:17 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/arcourir-les-dossiers-avec-dirent-h.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:36:44 GMT -->
</html>