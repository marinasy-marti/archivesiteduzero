<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/introduction-au-scripting-avec-python.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 22:48:45 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/introduction-au-scripting-avec-python.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:01:52 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Introduction au scripting avec Python</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/introduction-au-scripting-avec-python.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Introduction au scripting avec Python</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#IntroductionauscriptingavecPython">Introduction au scripting avec Python</a><br/><a href="#Avant-propos">Avant-propos</a><br/><a href="#ExcuterducodePython">Exécuter du code Python</a><br/><a href="#AppelerunefonctionCviaPython">Appeler une fonction C++ via Python</a><br/></div>
<a name="IntroductionauscriptingavecPython"></a><h2>Introduction au scripting avec Python</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python/avant-propos-11">
<span class="next">Avant-propos</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-569595" data-claire-element-id="569595">Le scripting est une méthode qui permet de modifier ou exécuter du code sans avoir à recompiler le programme, juste en modifiant des fichiers de scripts. L'un des meilleurs exemples est votre navigateur Web, probablement codé en C ou en C++, mais contrôlable grâce au langage Javascript. Ici, nous allons voir comment utiliser l'interpréteur Python dans un programme en C++.</p>
</div><a name="Avant-propos"></a><h2>Avant-propos</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python/executer-du-code-python">
<span class="next">Exécuter du code Python</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-569596" data-claire-element-id="569596">Tout d'abord, nous allons voir ce dont nous avons besoin pour intégrer l'interpréteur de Python dans nos programmes en C++ :</p><ul id="r-569601" data-claire-element-id="569601"><li id="r-569598" data-claire-element-id="569598"><p id="r-569597" data-claire-element-id="569597">Une version de Python (dans le tuto, j'utiliserai la 2.6)</p></li><li id="r-569600" data-claire-element-id="569600"><p id="r-569599" data-claire-element-id="569599">Un IDE (dans le tuto, j'utiliserai Dev-C++). Si vous compilez sans IDE, il faudra alors vous adapter ;) .</p></li></ul><p id="r-569602" data-claire-element-id="569602">Maintenant, il faut créer notre projet. Appelez-le comme vous le souhaitez, laissez le projet en &quot;Console application&quot;. Ensuite, allez dans les options du projet (Alt+P sous Dev-C++). Allez dans l'onglet &quot;Répertoires&quot;.<br/> Dans la catégorie &quot;Répertoire Bibliothèques&quot; rajoutez le chemin vers le dossier &quot;libs&quot; de Python (par exemple : <em>C:\Python26\libs</em>) :</p><figure id="r-569604" data-claire-element-id="569605"><img id="r-569603" data-claire-element-id="569603" src="medias/uploads.siteduzero.com_files_201001_202000_201191.jpg" alt="Image utilisateur"/></figure><p id="r-569606" data-claire-element-id="569606">Puis, dans la catégorie &quot;Répertoire d'inclusion&quot; rajoutez le chemin vers le dossier &quot;include&quot; de Python (par exemple : <em>C:\Python26\include</em>) :</p><figure id="r-569608" data-claire-element-id="569609"><img id="r-569607" data-claire-element-id="569607" src="medias/uploads.siteduzero.com_files_201001_202000_201192.jpg" alt="Image utilisateur"/></figure><p id="r-569610" data-claire-element-id="569610">A présent, choisissez l'onglet &quot;Paramètres&quot; et ajoutez &quot;-lPython26&quot; dans &quot;Editeur de liens&quot; (si vous n'avez pas Python 2.6 ; il faudra changer les deux chiffres) :</p><figure id="r-569612" data-claire-element-id="569613"><img id="r-569611" data-claire-element-id="569611" src="medias/uploads.siteduzero.com_files_201001_202000_201193.jpg" alt="Image utilisateur"/></figure><p id="r-569614" data-claire-element-id="569614">Enfin, dans votre source, il faut rajouter :</p><pre id="r-569615" data-claire-element-id="569615"><code data-claire-semantic="cpp">#include &lt;Python.h&gt;</code></pre><p id="r-569616" data-claire-element-id="569616">Pour distribuer vos programmes, il vous faudra la DLL de Python (dans mon cas : Python26.dll). Essayez de la trouver dans <em>C:\Windows\system32</em>. Si vous ne la trouvez pas, voici un lien vers elle (lien Megaupload) : <a href="http://www.megaupload.com/?d=Z3S8YY6L">Python26.dll</a>.<br/> Une fois cette DLL obtenue, il faut la copier dans le dossier de votre exécutable.</p><p id="r-569617" data-claire-element-id="569617">Voilà, vous êtes prêts pour programmer en Python depuis un code en C++ et vice-versa :waw: !</p><p id="r-569618" data-claire-element-id="569618">Cependant, avant de commencer à programmer, il faut savoir que les variables utilisées avec Python seront des <strong>pointeurs</strong> de type <em>PyObject</em>. Tout : un nombre, une chaîne, etc...</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python">Introduction au scripting avec Python</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python/avant-propos-11">
Avant-propos
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python/executer-du-code-python">
Exécuter du code Python
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python/appeler-une-fonction-c-via-python">
Appeler une fonction C++ via Python
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python/executer-du-code-python">
<span class="next">Exécuter du code Python</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="ExcuterducodePython"></a><h2>Exécuter du code Python</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python/avant-propos-11">
<span class="arrow"></span>
<span class="next">Avant-propos</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python/appeler-une-fonction-c-via-python">
<span class="next">Appeler une fonction C++ via Python</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-569620" data-claire-element-id="569620">Il y a deux façons d'exécuter du code Python dans un programme en C++ (elles reviennent à peu près au même) : directement à partir d'une chaîne (telle que <code data-claire-semantic="cpp">&quot;print 'test'&quot; </code>) ou à partir d'un fichier.</p><p id="r-569621" data-claire-element-id="569621">Mais d'abord, il faut initialiser l'interpréteur. Heureusement, il suffit simplement de faire appel à la fonction <code data-claire-semantic="cpp">void Py_Initialize(); </code>. Si vous voulez mettre l'interpréteur dans le même environnement que le programme, il faudra lui passer la première chaîne de <em>argv</em> comme ceci :</p><pre id="r-569622" data-claire-element-id="569622"><code data-claire-semantic="cpp">int main(int argc, char *argv[])
{
    Py_SetProgramName(argv[0]);
    /* Tout le reste*/
    return 0;
}</code></pre><h3 id="r-executer-une-chaine" data-claire-element-id="569633">Exécuter une chaîne</h3><p id="r-569623" data-claire-element-id="569623">Bonne nouvelle ! Il existe une fonction simple permettant d'exécuter une chaîne : <code data-claire-semantic="cpp">int PyRun_SimpleStringFlags(const char *commande, PyCompilerFlags *flags); </code> où <em>commande</em> est la chaîne en question et <em>flags</em> des flags pour le compilateur. Nous n'utiliserons pas cette variable, nous la laisserons donc à <code data-claire-semantic="cpp">NULL </code>.<br/> C'est tout :magicien: ! Ainsi, nous pouvons créer une fonction ou une macro <em>exec</em> prenant pour argument un <code data-claire-semantic="cpp">char * </code> (ne pas oublier de faire un <code data-claire-semantic="cpp">reinterpret_cast </code>) :</p><pre id="r-569624" data-claire-element-id="569624"><code data-claire-semantic="cpp">void exec(char *commandes)
{
    PyRun_SimpleStringFlags(reinterpret_cast&lt;const char*&gt;(commandes),NULL);
}</code></pre><p id="r-569625" data-claire-element-id="569625">Vous pouvez essayer ceci :</p><pre id="r-569626" data-claire-element-id="569626"><code data-claire-semantic="cpp">#include &lt;cstdlib&gt;
#include &lt;Python.h&gt;

void exec(char *commandes);

int main(int argc,char *argv[])
{
    Py_Initialize();
    exec(&quot;print 'test'&quot;); // Affiche &quot;test&quot;

    exec(&quot;a=3\n\
print str(a)&quot;); //Waouh ! Ca fonctionne sur plusieurs lignes !
    
    exec(&quot;b=5&quot;);
    exec(&quot;print str(b)&quot;); //Ca fonctionne même avec un appel différent à exec !
    system(&quot;pause&quot;);
    return 0;
}

void exec(char *commandes)
{
    PyRun_SimpleStringFlags(reinterpret_cast&lt;const char*&gt;(commandes),NULL);
}</code></pre><aside id="r-569632" data-claire-element-id="569632" data-claire-semantic="warning"><p id="r-569627" data-claire-element-id="569627">Lorsque vous faites sur plusieurs lignes, vous pouvez faire comme ceci :</p><pre id="r-569628" data-claire-element-id="569628"><code data-claire-semantic="cpp">&quot;a=3\nprint str(a)&quot;</code></pre><p id="r-569629" data-claire-element-id="569629">Ou encore comme ceci :</p><pre id="r-569630" data-claire-element-id="569630"><code data-claire-semantic="cpp">&quot;a=3\n\
print str(a)&quot;</code></pre><p id="r-569631" data-claire-element-id="569631">En aucun cas il ne faudra mettre d'espace en début de ligne, sauf si c'est de l'indentation, car les espaces en début de ligne sont très importants en Python. Vous pouvez faire l'indentation avec des espaces, ou alors avec des tabulations (<code data-claire-semantic="cpp">' ' </code>).</p></aside><h3 id="r-executer-un-fichier" data-claire-element-id="569640">Exécuter un fichier</h3><p id="r-569634" data-claire-element-id="569634">Pas la peine de faire une fonction très compliquée. Il existe une fonction <code data-claire-semantic="cpp">int PyRun_SimpleFile(FILE *fp, const char *nom); </code> où <em>fp</em> est un pointeur sur le fichier et <em>nom</em> le nom du fichier.<br/> Il faut d'abord créer un <strong>pointeur</strong> de type <em>PyObject</em> qui contiendra le fichier :</p><pre id="r-569635" data-claire-element-id="569635"><code data-claire-semantic="cpp">PyObject *fichier=PyFile_FromString(fn,&quot;r&quot;);</code></pre><p id="r-569636" data-claire-element-id="569636">Ensuite, il faut tester si elle est valide ou pas. Dans le cas où elle n'est pas valide, sa valeur vaudra NULL.<br/> Ensuite, il faut transformer cette variable en pointeur de fichier avec : <code data-claire-semantic="cpp">FILE* PyFile_AsFile(PyObject *p); </code><br/> Après avoir passé cette variable à <em>PyRun_SimpleFile</em>, il faut libérer la variable contenant le pointeur sur le fichier avec <code data-claire-semantic="cpp">void Py_DECREF(PyObject *o); </code>.</p><p id="r-569637" data-claire-element-id="569637">Ainsi, on se retrouve avec un code du genre :</p><pre id="r-569638" data-claire-element-id="569638"><code data-claire-semantic="cpp">bool run_py(char *fn) // Le type bool sert à renvoyer si le fichier a pu être lu ou pas
{
    PyObject *fichier=PyFile_FromString(fn,&quot;r&quot;);
    if(fichier==NULL)
        return false;
    PyRun_SimpleFile(PyFile_AsFile(fichier),fn);
    Py_DECREF(fichier);
    return true;
}</code></pre><p id="r-569639" data-claire-element-id="569639">Maintenant, nous allons voir comment exécuter une fonction écrite dans la source C++ dans un script Python.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python">Introduction au scripting avec Python</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python/avant-propos-11">
Avant-propos
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python/executer-du-code-python">
Exécuter du code Python
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python/appeler-une-fonction-c-via-python">
Appeler une fonction C++ via Python
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python/avant-propos-11">
<span class="arrow"></span>
<span class="next">Avant-propos</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python/appeler-une-fonction-c-via-python">
<span class="next">Appeler une fonction C++ via Python</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="AppelerunefonctionCviaPython"></a><h2>Appeler une fonction C++ via Python</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python/executer-du-code-python">
<span class="arrow"></span>
<span class="next">Exécuter du code Python</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-569642" data-claire-element-id="569642">Nous allons apprendre à utiliser une fonction écrite dans un code C++ dans un script Python. Attention, il ne s'agit pas d'interpréter du C++ dans Python, mais juste d'appeler des fonctions qui sont codées sous une certaine forme que nous verrons bientôt.<br/> Mais tout d'abord, il faut comprendre le mécanisme des <strong>modules</strong> en Python. Vous le connaissez sûrement, mais il est bon de se le rappeler. En effet, les fonctions ne seront utilisables par l'interpréteur Python si et seulement si vous les déclarez dans un module.<br/> En Python, voici un exemple de code utilisant un module :</p><pre id="r-569643" data-claire-element-id="569643"><code data-claire-semantic="python">import math #On importe le module
print str(math.cos(0))</code></pre><p id="r-569644" data-claire-element-id="569644">A présent, nous pouvons coder une fonction que nous intégrerons plus tard dans un module. Nous allons créer une fonction qui prend en argument un nombre et qui en retourne le carré. En C++ &quot;pur&quot;, nous aurions écrit :</p><pre id="r-569645" data-claire-element-id="569645"><code data-claire-semantic="cpp">int carre(int n)
{
    return n*n;
}</code></pre><p id="r-569646" data-claire-element-id="569646">Sachez que toutes les fonctions Python doivent retourner un <strong>pointeur</strong> de type <em>Py0bject</em>.</p><div id="r-569648" data-claire-element-id="569648" data-claire-semantic="question"><p id="r-569647" data-claire-element-id="569647">Mais si on ne veut rien retourner ?</p></div><p id="r-569649" data-claire-element-id="569649">Dans ce cas, nous allons retourner l'équivalent de <code data-claire-semantic="python">None </code> : <em>Py_None</em>.<br/> Nos fonctions devront comporter deux arguments : deux <strong>pointeurs</strong> de type <em>PyObject</em>.<br/> Le premier argument ne sera utile que s'il s'agit d'une méthode (dans une classe, donc) sinon elle vaudra <code data-claire-semantic="cpp">NULL </code> : c'est la variable <em>self</em> que l'on retrouve en Python comme ceci :</p><pre id="r-569650" data-claire-element-id="569650"><code data-claire-semantic="python">class Test:
    def __init__(self):
        self.x=0</code></pre><p id="r-569651" data-claire-element-id="569651">L'autre argument représente les arguments sous forme de tuple. Déjà, voyons le prototype de notre fonction :</p><pre id="r-569652" data-claire-element-id="569652"><code data-claire-semantic="cpp">PyObject *carre(PyObject *self,PyObject *args);</code></pre><p id="r-569653" data-claire-element-id="569653">Maintenant, il faut savoir extraire les arguments contenus dans la variable <em>args</em>.<br/> Nous allons utiliser une fonction qui peut s'apparenter à <em>scanf</em> : <code data-claire-semantic="cpp">int PyArg_ParseTuple(PyObject *args, const char *format, ...); </code><br/> Cependant, le contenu de la variable <em>format</em> sera différent du format que l'on a avec <em>scanf</em>.<br/> Par exemple, pour une chaîne, avec <em>scanf</em> nous utilisons <code data-claire-semantic="cpp">&quot;%s&quot; </code>, alors qu'avec <em>PyArg_ParseTuple</em> nous utiliserons <code data-claire-semantic="cpp">&quot;s&quot; </code>.<br/> Voici une petite liste de types (la complète se trouve <a href="http://docs.python.org/c-api/arg.html">ici</a>) :</p><ul id="r-569676" data-claire-element-id="569676"><li id="r-569655" data-claire-element-id="569655"><p id="r-569654" data-claire-element-id="569654">s : chaîne de caractères</p></li><li id="r-569657" data-claire-element-id="569657"><p id="r-569656" data-claire-element-id="569656">z : comme s, sauf que la valeur peut être <code data-claire-semantic="cpp">NULL</code></p></li><li id="r-569659" data-claire-element-id="569659"><p id="r-569658" data-claire-element-id="569658">b : octet non signé (<code data-claire-semantic="cpp">unsigned char </code>)</p></li><li id="r-569661" data-claire-element-id="569661"><p id="r-569660" data-claire-element-id="569660">c : caractère (<code data-claire-semantic="cpp">char </code>)</p></li><li id="r-569663" data-claire-element-id="569663"><p id="r-569662" data-claire-element-id="569662">h : <code data-claire-semantic="cpp">short int</code></p></li><li id="r-569665" data-claire-element-id="569665"><p id="r-569664" data-claire-element-id="569664">H : <code data-claire-semantic="cpp">unsigned short int</code></p></li><li id="r-569667" data-claire-element-id="569667"><p id="r-569666" data-claire-element-id="569666">i : <code data-claire-semantic="cpp">int</code></p></li><li id="r-569669" data-claire-element-id="569669"><p id="r-569668" data-claire-element-id="569668">I : <code data-claire-semantic="cpp">unsigned int</code></p></li><li id="r-569671" data-claire-element-id="569671"><p id="r-569670" data-claire-element-id="569670">f : <code data-claire-semantic="cpp">float</code></p></li><li id="r-569673" data-claire-element-id="569673"><p id="r-569672" data-claire-element-id="569672">d : <code data-claire-semantic="cpp">double</code></p></li><li id="r-569675" data-claire-element-id="569675"><p id="r-569674" data-claire-element-id="569674">o : un objet de type quelconque sans cast</p></li></ul><p id="r-569677" data-claire-element-id="569677">Par exemple, si vous voulez récupérer un <code data-claire-semantic="cpp">int </code>, un <code data-claire-semantic="cpp">float </code> et un <code data-claire-semantic="cpp">char </code>, il faudra faire :</p><pre id="r-569678" data-claire-element-id="569678"><code data-claire-semantic="cpp">int entier;
float flottant;
char caractere;
PyArg_ParseTuple(args,&quot;ifc&quot;,&amp;entier,&amp;flottant,&amp;caractere);</code></pre><aside id="r-569680" data-claire-element-id="569680" data-claire-semantic="information"><p id="r-569679" data-claire-element-id="569679">Pour les formats &quot;s&quot; et &quot;z&quot;, vous pouvez rajouter une &quot;#&quot; pour demander la longueur de la chaîne. N'oubliez pas de rajouter dans les &quot;...&quot; un pointeur vers un entier. Comme ceci :</p></aside><pre id="r-569681" data-claire-element-id="569681"><code data-claire-semantic="cpp">char *chaine;
int longueur;
PyArg_ParseTuple(args,&quot;s#&quot;,&amp;chaine,&amp;longueur);</code></pre><p id="r-569682" data-claire-element-id="569682">Autre différence avec <em>scanf</em> : il faut mettre le signe '&amp;' même devant une chaîne de caractère, sinon c'est l'erreur de segmentation assurée ^^ !</p><p id="r-569683" data-claire-element-id="569683">Pour la valeur de retour, nous allons utiliser le procédé inverse : on donne le contenu du tuple qui sera compilé en un pointeur de type <em>PyObject</em> grâce à la fonction <code data-claire-semantic="cpp">PyObject* Py_BuildValue(const char *format, ...); </code>.<br/> Par exemple, pour retourner la variable <em>retour</em> de type <code data-claire-semantic="cpp">int </code>, on fera :</p><pre id="r-569684" data-claire-element-id="569684"><code data-claire-semantic="cpp">int resultat=42;
return Py_BuildValue(&quot;i&quot;,resultat);</code></pre><p id="r-569685" data-claire-element-id="569685">Donc revenons à nos moutons. Il faut créer une fonction qui retourne le nombre passé en argument au carré.<br/> A vos claviers :) !<br/> Petite correction :</p><div id="r-569687" data-claire-element-id="569687"><pre id="r-569686" data-claire-element-id="569686"><code data-claire-semantic="cpp">PyObject *carre(PyObject *self, PyObject *args)
{
    int x=0;
    PyArg_ParseTuple(args,&quot;i&quot;,&amp;x); //On récupère le nombre passé en argument
    return Py_BuildValue(&quot;i&quot;,x*x); //On retourne le nombre au carré
}</code></pre></div><p id="r-569688" data-claire-element-id="569688">Et ce n'est pas tout :diable: !<br/> Pour utiliser cette fonction via un script Python, il va falloir créer notre module. Vous l'appelez comme vous le voulez (pour moi ce sera &quot;mathC&quot;).<br/> Notre module sera contenu dans un tableau de type <em>PyMethodDef</em> défini comme ceci :</p><pre id="r-569689" data-claire-element-id="569689"><code data-claire-semantic="cpp">PyMethodDef module_mathC[]={{&quot;nom_de_la_fonction&quot;,fonction,METH_VARARGS,NULL},
                           {NULL,NULL,0,NULL}};</code></pre><p id="r-569690" data-claire-element-id="569690">Expliquons cette instruction. Chaque méthode doit être définie par un tableau sous la forme :</p><ul id="r-569699" data-claire-element-id="569699"><li id="r-569692" data-claire-element-id="569692"><p id="r-569691" data-claire-element-id="569691">Nom de la fonction : <code data-claire-semantic="cpp">const char*</code></p></li><li id="r-569694" data-claire-element-id="569694"><p id="r-569693" data-claire-element-id="569693">Callback vers la fonction</p></li><li id="r-569696" data-claire-element-id="569696"><p id="r-569695" data-claire-element-id="569695">Type d'arguments (on va laisser à METH_VARARGS ; pour une liste complète voir <a href="http://docs.python.org/c-api/structures.html#METH_VARARGS">ici</a>)</p></li><li id="r-569698" data-claire-element-id="569698"><p id="r-569697" data-claire-element-id="569697">Une chaîne de caractères qui ne nous sert à rien, nous la laisserons à NULL</p></li></ul><p id="r-569700" data-claire-element-id="569700">Ensuite, le module est un tableau de méthodes. Mais il faut mettre une méthode vide (<code data-claire-semantic="cpp">{NULL,NULL,0,NULL} </code>) sinon vous vous retrouverez avec une belle erreur lors de l'exécution ^^ ...<br/> Dernière étape (enfin ;) ) : initialiser le module. Nous utiliserons la fonction <code data-claire-semantic="cpp">PyObject* Py_InitModule(char *nom, PyMethodDef *methodes); </code> où <em>name</em> est le nom du module à créer et <em>méthodes</em> votre tableau de méthodes (ici <em>module_mathC</em>) :</p><pre id="r-569701" data-claire-element-id="569701"><code data-claire-semantic="cpp">Py_InitModule(&quot;mathC&quot;,module_mathC);</code></pre><p id="r-569702" data-claire-element-id="569702">En récapitulant, on obtient :</p><pre id="r-569703" data-claire-element-id="569703"><code data-claire-semantic="cpp">#include &lt;cstdlib&gt;
#include &lt;Python.h&gt;

PyObject *carre(PyObject *self,PyObject *args);

int main(int argc,char *argv[])
{
    Py_SetProgramName(argv[0]);
    Py_Initialize();

    PyMethodDef module_mathC[]={{&quot;carre&quot;,carre,METH_VARARGS,NULL},
                                {NULL,NULL,0,NULL}};
    Py_InitModule(&quot;mathC&quot;,module_mathC);
    system(&quot;pause&quot;);
    return 0;
}

PyObject *carre(PyObject *self,PyObject *args)
{ 
    int x=0;
    PyArg_ParseTuple(args,&quot;i&quot;,&amp;x);
    return Py_BuildValue(&quot;i&quot;,x*x);
}</code></pre><p id="r-569704" data-claire-element-id="569704">Maintenant, il faut aller dans le code en Python. Il faut importer le module. Vous avez différents choix :</p><pre id="r-569705" data-claire-element-id="569705"><code data-claire-semantic="python">import mathC
#Ou
from mathC import carre
#Ou encore
from mathC import *</code></pre><p id="r-569706" data-claire-element-id="569706">Sachant que dans le premier cas, pour accéder à la fonction <em>carre</em>, il faudra écrire <code data-claire-semantic="python">mathC.carre </code>, et dans les deux autres il faudra écrire <code data-claire-semantic="cpp">carre </code> tout simplement.<br/> Voici un exemple de script :</p><pre id="r-569707" data-claire-element-id="569707"><code data-claire-semantic="python">from mathC import *
x=input(&quot;Entrez un nombre : &quot;)
print &quot;Voici son carre : &quot;+str(carre(x))</code></pre><p id="r-569708" data-claire-element-id="569708">Si vous l'enregistrez dans un fichier .py, vous pouvez le lancer, mais vous aurez une erreur disant que le module &quot;mathC&quot; n'existe pas. Par contre, si vous exécutez ce fichier via la fonction <em>run_py</em> (que nous avions créée auparavant) après l'appel à <em>Py_InitModule</em>, le code s'exécutera. On vous demandera d'entrer un nombre, puis son carré sera affiché.<br/> Simple, non ;) ?</p><p id="r-569709" data-claire-element-id="569709">Et voilà, vous pouvez utiliser Python dans vos applications en C++ :soleil: !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python">Introduction au scripting avec Python</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python/avant-propos-11">
Avant-propos
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python/executer-du-code-python">
Exécuter du code Python
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python/appeler-une-fonction-c-via-python">
Appeler une fonction C++ via Python
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/introduction-au-scripting-avec-python/executer-du-code-python">
<span class="arrow"></span>
<span class="next">Exécuter du code Python</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/introduction-au-scripting-avec-python.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 22:48:49 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/introduction-au-scripting-avec-python.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:01:53 GMT -->
</html>