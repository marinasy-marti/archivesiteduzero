<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/-zozor-dans-son-enclos.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 20:00:33 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/-zozor-dans-son-enclos.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:44:45 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : [TP] Zozor dans son enclos</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/tp-zozor-dans-son-enclos.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : [TP] Zozor dans son enclos</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#TPZozordanssonenclos">[TP] Zozor dans son enclos</a><br/><a href="#Leprojet">Le projet</a><br/><a href="#Lasolution">La solution</a><br/></div>
<a name="TPZozordanssonenclos"></a><h2>[TP] Zozor dans son enclos</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/tp-zozor-dans-son-enclos/le-projet-2">
<span class="next">Le projet</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-335080" data-claire-element-id="335080"><em>Amis de la SPA (Société Protectrice des Animaux), ce tuto n'est pas pour vous :p ! En effet, il consiste purement et simplement à confiner notre cher Zozor (la mascotte du Site du Zér0) comme on le fait de nos jours pour de vulgaires volailles (clin d'oeil à la crise de la grippe aviaire :lol: ). Mais cette séquestration ne sera pas sans but, elle vous permettra au moins d'entretenir vos connaissances en C ! Alors, pourquoi pas ? ^^</em></p><aside id="r-335082" data-claire-element-id="335082" data-claire-semantic="information"><p id="r-335081" data-claire-element-id="335081">À la base, j'avais créé ce petit programme, certes inutile mais assez marrant, pour entretenir mes connaissances après la lecture du tuto de M@teo jusqu'au chapitre des évènements. Ceci détermine d'ailleurs le niveau requis pour bien comprendre mon tuto. Donc, si vous n'avez pas encore lu le tuto de M@teo, je vous recommande de le faire jusqu'au chapitre des évènements.</p></aside>
</div><a name="Leprojet"></a><h2>Le projet</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/tp-zozor-dans-son-enclos/la-solution-11">
<span class="next">La solution</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<div id="r-335084" data-claire-element-id="335084" data-claire-semantic="question"><p id="r-335083" data-claire-element-id="335083">Mettre Zozor dans son enclos o_O ? Je ne comprends pas trop où tu veux en venir :o !</p></div><p id="r-335085" data-claire-element-id="335085">C'est simple : dans ce TP, nous allons ouvrir une fenêtre dans laquelle le curseur est remplacé par une image de Zozor (à fond transparent). On placera dans cette fenêtre, à 40 pixels de chaque bord, une clôture de 10 px d'épaisseur (représentée par un simple rectangle noir). Les mouvements de Zozor (dirigés par la souris) seront limités à l'intérieur des &quot;clôtures&quot; (autrement dit on ne pourra pas approcher la souris à moins de 50 pixels du bord de la fenêtre). :)</p><div id="r-335087" data-claire-element-id="335087" data-claire-semantic="question"><p id="r-335086" data-claire-element-id="335086">Par où commencer ? :euh:</p></div><p id="r-335088" data-claire-element-id="335088">Je vais vous aider en vous donnant la structure du code ainsi que quelques informations ;) . Ah oui, je vous fournis aussi l'image de Zozor ;) (clic droit + Enregistrer l'image sous... pour la télécharger) :</p><figure id="r-335090" data-claire-element-id="335091"><img id="r-335089" data-claire-element-id="335089" src="../../user.oc-static.com/files/9001_10000/9651.png" alt="Image utilisateur"/></figure><h2 id="r-1-les-variables" data-claire-element-id="335093">1. Les variables</h2><p id="r-335092" data-claire-element-id="335092">Je ne m'étends pas là-dessus, vous verrez bien au fur et à mesure de quelles variables &amp; pointeurs vous aurez besoin. Par contre, je précise que vous n'aurez pas besoin de 4 surfaces pour les &quot;clôtures&quot;. En effet, une surface pour les verticales (gauche / droite) et une autre pour les horizontales (haut / bas) suffisent. Celles-ci seront <em>blittées</em> 2 fois chacune à deux endroits différents. ;)</p><h2 id="r-2-la-fenetre" data-claire-element-id="335095">2. La fenêtre</h2><p id="r-335094" data-claire-element-id="335094">Petite précision : la fenêtre fera 640 px de large sur 480 px de haut et sera en 32 bits. N'oubliez pas le double <em>buffering</em>. Je vous laisse choisir le titre et la couleur de fond (bien qu'un vert imitation herbe serait pas mal :p )!</p><h2 id="r-3-les-clotures" data-claire-element-id="335101">3. Les &quot;clôtures&quot;</h2><p id="r-335096" data-claire-element-id="335096">Dans cette section, vous allez déterminer la dimension des clôtures, de préférence par rapport à la largeur / hauteur de la fenêtre. Il suffit de faire une soustraction entre la hauteur / largeur de la fenêtre (ecran-&gt;w ou ecran-&gt;h) et les deux &quot;marges&quot; à laisser entre le bord de celle-ci et la &quot;clôture&quot;. N'oubliez pas ce que j'ai dit au début : 40 px de &quot;marge&quot; (que l'on peut considérer comme l'extérieur de l'enclos) + 10 px d'épaisseur de &quot;clôture&quot; pour un total de 50 px de chaque bord dans lesquels Zozor ne pourra pas gambader ;) . Oups! J'en ai déjà trop dit :-° :p ...</p><p id="r-335097" data-claire-element-id="335097">Pour vous aider, voici un schéma qui vous permettra de mieux comprendre ce que j'attends de vous.</p><figure id="r-335099" data-claire-element-id="335100"><img id="r-335098" data-claire-element-id="335098" src="medias/uploads.siteduzero.com_files_10001_11000_10227.jpg" alt="Image utilisateur"/></figure><h2 id="r-4-placement-initial-de-zozor" data-claire-element-id="335105">4. Placement initial de Zozor</h2><p id="r-335102" data-claire-element-id="335102">On charge bien sûr l'image de Zozor dans sa surface et on la rend transparente, mais nous allons aussi nous occuper de deux petites choses qui feront la différence. Premièrement, il faut faire disparaître le curseur pour que l'utilisateur ait l'impression de faire bouger Zozor et non pas un curseur avec notre cher animal derrière car, comme je l'ai dit au début, l'image du mulet suivra le déplacement de la souris. En second lieu, il faut placer initialement Zozor (et donc le curseur) au centre de la fenêtre.</p><aside id="r-335104" data-claire-element-id="335104" data-claire-semantic="warning"><p id="r-335103" data-claire-element-id="335103">J'ai bien dit placer <strong>Zozor</strong> au centre. Il faut donc que l'image soit centrée mais si vous vous contentez de placer le point curseur au milieu de la fenêtre, l'image ne le sera pas tout à fait, car le curseur se situe dans le bord supérieur gauche de celle-ci, et non pas en son centre. À vous de réfléchir (utilisez les dimensions de l'image) ;) !</p></aside><h2 id="r-5-la-boucle-des-evenements" data-claire-element-id="335107">5. La boucle des évènements</h2><p id="r-335106" data-claire-element-id="335106">Voici venir... la boucle!!! :D <br/> En bref, quand on clique sur la croix en haut à droite, le programme doit se fermer, idem quand on appuie sur n'importe quelle touche du clavier. Jusque-là, c'est simple. Ensuite vient le moment de limiter les déplacements de la souris (de Zozor) grâce au type d'évènement SDL_MOUSEMOTION. À l'aide de 4 conditions if (une pour chaque bord), vous allez vérifier si le curseur a dépassé une certaine abcisse (x) ou une certaine ordonnée (y). Si tel est le cas, il faudra le déplacer à nouveau à l'intérieur de l'enclos. (Non pas au milieu mais contre le bord, ce qui donnera à l'utilisateur l'impression que Zozor se heurte à la clôture et ne peut la franchir :lol: . Je suis sadique, mouahaha :p .) N'oubliez quand même pas qu'après il faut mettre à jour la position de la surface de Zozor selon les coordonnées de l'emplacement du curseur (pour créer l'impression que Zozor suit le déplacement de la souris).<br/> Pour terminer, à chaque passage dans la boucle (et donc à chaque changement de position de Zozor), il faut effacer la fenêtre et <em>blitter</em> à nouveau l'ensemble des surfaces (attention au SDL_Flip() ;) ).</p><h2 id="r-6-on-libere-la-memoire" data-claire-element-id="335109">6. On libère la mémoire</h2><p id="r-335108" data-claire-element-id="335108">Juste pour rappel, il n'y a que la surface principale (ecran) qui ne doit pas être libérée par la fonction SDL_FreeSurface() : il y en a donc quelques-uns à faire ^^ .</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/tp-zozor-dans-son-enclos">[TP] Zozor dans son enclos</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/tp-zozor-dans-son-enclos/le-projet-2">
Le projet
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/tp-zozor-dans-son-enclos/la-solution-11">
La solution
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/tp-zozor-dans-son-enclos/la-solution-11">
<span class="next">La solution</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lasolution"></a><h2>La solution</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/tp-zozor-dans-son-enclos/le-projet-2">
<span class="arrow"></span>
<span class="next">Le projet</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-335111" data-claire-element-id="335111">Alors... vous avez réussi ? :) J'espère que oui. Mais si ce n'est pas le cas, pas d'inquiétude ; on n'apprend pas qu'en réussissant ;) mais aussi en se trompant (à condition de se corriger). Voici donc la solution présentée de la même manière que le projet.</p><h2 id="r-0-les-includes" data-claire-element-id="335115">(0. Les includes)</h2><p id="r-335112" data-claire-element-id="335112">Je les mets pour être sûr que vous n'en oublierez aucun ;) .</p><pre id="r-335113" data-claire-element-id="335113"><code data-claire-semantic="c">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;SDL/SDL.h&gt;

int main(int argc, char *argv[])
{</code></pre><p id="r-335114" data-claire-element-id="335114">J'espère que vous n'aviez pas oublié la SDL (sinon honte à vous, mouahaha :p ).</p><h2 id="r-1-les-variables-1" data-claire-element-id="335134">1. Les variables</h2><pre id="r-335116" data-claire-element-id="335116"><code data-claire-semantic="c">/*
1. Déclaration des variables
*/
SDL_Surface *ecran = NULL, *zozor = NULL;
SDL_Surface *clotureVerticale = NULL, *clotureHorizontale = NULL;
SDL_Event event;
SDL_Rect positionZozor;
SDL_Rect positionClotureGH, positionClotureD, positionClotureB;
int continuer = 1;</code></pre><p id="r-335117" data-claire-element-id="335117">Alors, dans l'ordre on a :</p><ul id="r-335130" data-claire-element-id="335130"><li id="r-335119" data-claire-element-id="335119"><p id="r-335118" data-claire-element-id="335118">2 surfaces (la principale et celle de Zozor) ;</p></li><li id="r-335121" data-claire-element-id="335121"><p id="r-335120" data-claire-element-id="335120">encore 2 surfaces (pour les 2 types de clôtures : verticales &amp; horizontales) ;</p></li><li id="r-335123" data-claire-element-id="335123"><p id="r-335122" data-claire-element-id="335122">une variable pour stocker les évènements ;</p></li><li id="r-335125" data-claire-element-id="335125"><p id="r-335124" data-claire-element-id="335124">la variable du positionnement de Zozor ;</p></li><li id="r-335127" data-claire-element-id="335127"><p id="r-335126" data-claire-element-id="335126">3 variables de positionnement pour les clôtures ;</p></li><li id="r-335129" data-claire-element-id="335129"><p id="r-335128" data-claire-element-id="335128">1 booléen pour la boucle des évènements.</p></li></ul><p id="r-335131" data-claire-element-id="335131">Petite précision à propos des variables de positionnement des clôtures : la lettre en majuscule à la fin du nom de la variable signifie son emplacement (G pour gauche, H pour haut, D pour droite et B pour bas).</p><aside id="r-335133" data-claire-element-id="335133" data-claire-semantic="information"><p id="r-335132" data-claire-element-id="335132">On peut s'apercevoir que la clôture gauche et celle du haut auront la même position. Si vous ne comprenez pas pourquoi maintenant, patientez un peu, je vous le montrerai lors de leur <em>blittage</em>.</p></aside><h2 id="r-2-la-fenetre-1" data-claire-element-id="335137">2. La fenêtre</h2><pre id="r-335135" data-claire-element-id="335135"><code data-claire-semantic="c">/*
2. On s'occupe de la fenêtre
*/
SDL_Init(SDL_INIT_VIDEO);

ecran = SDL_SetVideoMode(640, 480, 32, SDL_HWSURFACE | SDL_DOUBLEBUF);
SDL_WM_SetCaption(&quot;Pauvre Zozor.&quot;, NULL);
//On colore le fond en vert (imitation herbe... :lol: )
SDL_FillRect(ecran, NULL, SDL_MapRGB(ecran-&gt;format, 10,255,10));</code></pre><p id="r-335136" data-claire-element-id="335136">Pas besoin d'explications, je présume. Il ne fallait pas oublier de mettre le double <em>buffering</em>.</p><h2 id="r-3-les-clotures-1" data-claire-element-id="335152">3. Les clôtures</h2><p id="r-335138" data-claire-element-id="335138">Ici, j'affiche les réponses en plusieurs fois.</p><pre id="r-335139" data-claire-element-id="335139"><code data-claire-semantic="c">/*
3. Les clôtures
*/
// On détermine les dimensions des clôtures verticales et horizontales
clotureVerticale = SDL_CreateRGBSurface(SDL_HWSURFACE, 10, ecran-&gt;h - 2*40, 32, 0, 0, 0, 0);
clotureHorizontale = SDL_CreateRGBSurface(SDL_HWSURFACE, ecran-&gt;w - 2*40, 10, 32, 0, 0, 0, 0);</code></pre><p id="r-335140" data-claire-element-id="335140">Commençons par le début : la dimension des fameuses barrières.<br/> Le calcul des dimensions que j'ai mis dans la fonction SDL_CreateRGBSurface est assez logique.<br/> Parlons de la clôture verticale. Pour la largeur, nous nous étions mis d'accord (ou plutôt je vous ai dit :p ) de mettre 10 px. Pour la hauteur, c'est plus compliqué. On commence par prendre la hauteur de la fenetre (ecran-&gt;h) à laquelle on doit soustraire 2 * 40 px (ce sont les marges de part et d'autre de l'extérieur de l'enclos). Et voilà, c'est tout ^^ ! Pour la clôture horizontale, il suffit d'intervertir ces deux données (la largeur devient la hauteur et vice-versa). On continue :</p><pre id="r-335141" data-claire-element-id="335141"><code data-claire-semantic="c">// On détermine la position des 4 clôtures
// Celle de gauche et celle du haut (elles ont la même origine)
positionClotureGH.x = 40;
positionClotureGH.y = 40;
// Celle de droite
positionClotureD.x = ecran-&gt;w - 50;
positionClotureD.y = 40;
// Celle du bas
positionClotureB.x = 40;
positionClotureB.y = ecran-&gt;h -50;</code></pre><p id="r-335142" data-claire-element-id="335142">C'est ici que c'est un peu casse-tête (pour ne pas dire casse-gu*** :-° ). En effet, il faut bien comprendre que le positionnement d'une surface est déterminé par son coin supérieur gauche (c'est son origine). À partir de ce moment-là, on peut s'aider d'un petit schéma :</p><figure id="r-335144" data-claire-element-id="335145"><img id="r-335143" data-claire-element-id="335143" src="medias/uploads.siteduzero.com_files_10001_11000_10231.png" alt="Image utilisateur"/></figure><p id="r-335146" data-claire-element-id="335146">Grâce aux mesures que j'ai affichées en dessous, on peut maintenant facilement déterminer les coordonnées de chaque origine et s'apercevoir qu'il faut, pour obtenir l'ordonnée de la clôture du bas, faire &quot;la hauteur de la fenêtre moins 50 px&quot; (soit ecran-&gt;h - 50 pour l'ordonnée) alors que pour obtenir l'abcisse de la clôture de droite, on fait &quot;la largeur de l'écran moins 50 px&quot; (soit ecran-&gt;w - 50 pour l'abcisse). Compris ? :p</p><aside id="r-335148" data-claire-element-id="335148" data-claire-semantic="information"><p id="r-335147" data-claire-element-id="335147">Si vous n'aviez pas compris tout à l'heure pourquoi la clôture du haut et celle de gauche avaient la même position, vous en avez maintenant l'explication : les points G et H se superposent ^^ .</p></aside><p id="r-335149" data-claire-element-id="335149">Fiou, il reste plus qu'à <em>blitter</em> tout ça :D :</p><pre id="r-335150" data-claire-element-id="335150"><code data-claire-semantic="c">// On blitte les 4 clôtures aux bons endroits
//Celle de gauche
SDL_BlitSurface(clotureVerticale, NULL, ecran, &amp;positionClotureGH);
//Celle de droite
SDL_BlitSurface(clotureVerticale, NULL, ecran, &amp;positionClotureD);
//Celle du haut
SDL_BlitSurface(clotureHorizontale, NULL, ecran, &amp;positionClotureGH);
//Celle du bas
SDL_BlitSurface(clotureHorizontale, NULL, ecran, &amp;positionClotureB);</code></pre><p id="r-335151" data-claire-element-id="335151">Et voilà, on en a fini avec les clôtures.</p><h2 id="r-4-placement-initial-de-zozor-1" data-claire-element-id="335157">4. Placement initial de Zozor</h2><pre id="r-335153" data-claire-element-id="335153"><code data-claire-semantic="c">/*
4. Placement initial de Zozor
*/
//On charge l'image de Zozor dans la surface et on rend le fond transparent
zozor = SDL_LoadBMP(&quot;zozor.bmp&quot;);
SDL_SetColorKey(zozor, SDL_SRCCOLORKEY, SDL_MapRGB(zozor-&gt;format, 0, 0, 255));

// On rend le curseur invisible et on le centre (Zozor devient le curseur)
SDL_ShowCursor(SDL_DISABLE);
SDL_WarpMouse((ecran-&gt;w / 2 - zozor-&gt;w / 2), (ecran-&gt;h / 2 - zozor-&gt;h / 2));</code></pre><p id="r-335154" data-claire-element-id="335154">Hormis le fait qu'on charge l'image de Zozor dans sa surface et qu'on rend le fond transparent (je suppose que ça, c'était OK de votre côté), il faut rendre le curseur invisible grâce à la fonction SDL_ShowCursor(). De plus, on doit déplacer Zozor au milieu de la fenêtre. Mais il ne faut pas perdre de vue que, lorsque la boucle d'évènements fera que Zozor suit les déplacements de la souris, le curseur sera dans le coin supérieur gauche de l'image (testez en n'effaçant pas le curseur et vous verrez). De ce fait, il ne suffit pas de faire :</p><pre id="r-335155" data-claire-element-id="335155"><code data-claire-semantic="c">SDL_WarpMouse(ecran-&gt;w / 2, ecran-&gt;h / 2);</code></pre><p id="r-335156" data-claire-element-id="335156">En effet, il faut faire une soustraction entre la largeur / hauteur de la fenêtre et la largeur / hauteur de Zozor pour obtenir les bonnes coordonnées (comme dans la solution ci-dessus). Vous ne comprenez pas ? Pas de bol, c'est comme ça, les maths :lol: !</p><h2 id="r-5-la-boucle-principale" data-claire-element-id="335162">5. La boucle principale</h2><pre id="r-335158" data-claire-element-id="335158"><code data-claire-semantic="c">/*
5. La boucle principale
*/
while(continuer)
{
    SDL_WaitEvent(&amp;event);

    switch(event.type)
    {
        case SDL_QUIT:
           continuer = 0;
           break;

        // En appuyant sur une touche, on quitte le programme
        case SDL_KEYDOWN:
           continuer = 0;
           break;

        // On limite les déplacements de Zozor à son enclos (mouahaha)
        case SDL_MOUSEMOTION:
        // Empêcher le dépassement vers la droite
           if(event.motion.x &gt; ecran-&gt;w - zozor-&gt;w - 50)
                SDL_WarpMouse(ecran-&gt;w - zozor-&gt;w - 50, event.motion.y);

        // Empêcher le dépassement vers la gauche
           if(event.motion.x &lt; 50)
                SDL_WarpMouse(50, event.motion.y);

        // Empêcher le dépassement vers le haut
           if(event.motion.y &lt; 50)
                SDL_WarpMouse(event.motion.x, 50);

        // Empêcher le dépassement vers le bas
           if(event.motion.y &gt; ecran-&gt;h - zozor-&gt;h - 50)
                SDL_WarpMouse(event.motion.x, ecran-&gt;h - zozor-&gt;h - 50);

           positionZozor.x = event.motion.x;
           positionZozor.y = event.motion.y;
           break;
        }

    // On efface et on blitte à nouveau toutes les surfaces aux éventuels nouveaux emplacements
    SDL_FillRect(ecran, NULL, SDL_MapRGB(ecran-&gt;format, 0, 255, 0));
    // Zozor
    SDL_BlitSurface(zozor, NULL, ecran, &amp;positionZozor);
    // Les clôtures
    SDL_BlitSurface(clotureVerticale, NULL, ecran, &amp;positionClotureGH);
    SDL_BlitSurface(clotureVerticale, NULL, ecran, &amp;positionClotureD);
    SDL_BlitSurface(clotureHorizontale, NULL, ecran, &amp;positionClotureGH);
    SDL_BlitSurface(clotureHorizontale, NULL, ecran, &amp;positionClotureB);

    SDL_Flip(ecran);
}</code></pre><p id="r-335159" data-claire-element-id="335159">Parlons un peu du traitement des évènements. En dehors de l'habituelle fermeture en cliquant sur la croix, on retrouve un autre moyen de fermeture en appuyant sur une touche du clavier. J'ai fait cela pour permettre de quitter plus facilement le programme car, comme la souris est coincée dans l'enclos, il n'est pas possible d'atteindre la croix (sauf en faisant un mouvement rapide ;) ). Ensuite, en cas d'évènement MOUSEMOTION (quand la souris bouge), à l'aide des conditions if, on teste si Zozor ne sort pas de ses frontières :p . Si c'est le cas, on déplace la souris.</p><p id="r-335160" data-claire-element-id="335160">Lors du même évènement il faut modifier le positionnement de Zozor en remplaçant l'initial par les coordonnées de la souris.</p><p id="r-335161" data-claire-element-id="335161">Pour terminer, on efface et on blitte à nouveau toutes les surfaces aux éventuels nouveaux emplacements :D (sans oublier le SDL_Flip() ;) ).</p><h2 id="r-6-on-libere-la-memoire-1" data-claire-element-id="335165">6. On libère la mémoire</h2><pre id="r-335163" data-claire-element-id="335163"><code data-claire-semantic="c">/*
6. Pour terminer
*/
SDL_Flip(ecran);
SDL_FreeSurface(zozor);
SDL_FreeSurface(clotureVerticale);
SDL_FreeSurface(clotureHorizontale);
SDL_Quit();

return EXIT_SUCCESS;
}</code></pre><p id="r-335164" data-claire-element-id="335164">Aucune explication n'est nécessaire, on libère seulement la mémoire utilisée pour stocker les surfaces ^^ .</p><h2 id="r-le-code-en-entier" data-claire-element-id="335170">Le code en entier</h2><pre id="r-335166" data-claire-element-id="335166"><code data-claire-semantic="c">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;SDL/SDL.h&gt;

int main(int argc, char *argv[])
{
    /*
    1. Déclaration des variables
    */
    SDL_Surface *ecran = NULL, *zozor = NULL;
    SDL_Surface *clotureVerticale = NULL, *clotureHorizontale = NULL;
    SDL_Event event;
    SDL_Rect positionZozor;
    SDL_Rect positionClotureGH, positionClotureD, positionClotureB;
    int continuer = 1;


    /*
    2. On s'occupe de la fenêtre
    */
    SDL_Init(SDL_INIT_VIDEO);

    ecran = SDL_SetVideoMode(640, 480, 32, SDL_HWSURFACE | SDL_DOUBLEBUF);
    SDL_WM_SetCaption(&quot;Pauvre Zozor.&quot;, NULL);
    //On colore le fond en vert (imitation herbe... :lol: )
    SDL_FillRect(ecran, NULL, SDL_MapRGB(ecran-&gt;format, 10,255,10));


    /*
    3. Les clôtures
    */
    // On détermine les dimensions des clôtures verticales et horizontales
    clotureVerticale = SDL_CreateRGBSurface(SDL_HWSURFACE, 10, ecran-&gt;h - 2*40, 32, 0, 0, 0, 0);
    clotureHorizontale = SDL_CreateRGBSurface(SDL_HWSURFACE, ecran-&gt;w - 2*40, 10, 32, 0, 0, 0, 0);

    // On détermine la position des 4 clôtures
    // Celle de gauche et celle du haut (elles ont la même origine)
    positionClotureGH.x = 40;
    positionClotureGH.y = 40;
    // Celle de droite
    positionClotureD.x = ecran-&gt;w - 50;
    positionClotureD.y = 40;
    // Celle du bas
    positionClotureB.x = 40;
    positionClotureB.y = ecran-&gt;h -50;

    // On blitte les 4 clôtures aux bons endroits
    //Celle de gauche
    SDL_BlitSurface(clotureVerticale, NULL, ecran, &amp;positionClotureGH);
    //Celle de droite
    SDL_BlitSurface(clotureVerticale, NULL, ecran, &amp;positionClotureD);
    //Celle du haut
    SDL_BlitSurface(clotureHorizontale, NULL, ecran, &amp;positionClotureGH);
    //Celle du bas
    SDL_BlitSurface(clotureHorizontale, NULL, ecran, &amp;positionClotureB);


    /*
    4. Placement initial de Zozor
    */
    //On charge l'image de Zozor dans la surface et on rend le fond transparent
    zozor = SDL_LoadBMP(&quot;zozor.bmp&quot;);
    SDL_SetColorKey(zozor, SDL_SRCCOLORKEY, SDL_MapRGB(zozor-&gt;format, 0, 0, 255));

    // On rend le curseur invisible et on le centre (Zozor devient le curseur)
    SDL_ShowCursor(SDL_DISABLE);
    SDL_WarpMouse((ecran-&gt;w / 2 - zozor-&gt;w / 2), (ecran-&gt;h / 2 - zozor-&gt;h / 2));


    /*
    5. La boucle principale
    */
    while(continuer)
    {

        SDL_WaitEvent(&amp;event);

        switch(event.type)
        {
            case SDL_QUIT:
                continuer = 0;
                break;

            // En appuyant sur une touche, on quitte le programme
            case SDL_KEYDOWN:
                continuer = 0;
                break;

            // On limite les déplacements de Zozor à son enclos (mouahaha)
            case SDL_MOUSEMOTION:
            // Empêcher le dépassement vers la droite
                if(event.motion.x &gt; ecran-&gt;w - zozor-&gt;w - 50)
                    SDL_WarpMouse(ecran-&gt;w - zozor-&gt;w - 50, event.motion.y);

            // Empêcher le dépassement vers la gauche
                if(event.motion.x &lt; 50)
                    SDL_WarpMouse(50, event.motion.y);

            // Empêcher le dépassement vers le haut
                if(event.motion.y &lt; 50)
                    SDL_WarpMouse(event.motion.x, 50);

            // Empêcher le dépassement vers le bas
                if(event.motion.y &gt; ecran-&gt;h - zozor-&gt;h - 50)
                    SDL_WarpMouse(event.motion.x, ecran-&gt;h - zozor-&gt;h - 50);

                positionZozor.x = event.motion.x;
                positionZozor.y = event.motion.y;
                break;
        }

        // On efface et on blitte à nouveau toutes les surfaces aux éventuels nouveaux emplacements
        SDL_FillRect(ecran, NULL, SDL_MapRGB(ecran-&gt;format, 0, 255, 0));
        // Zozor
        SDL_BlitSurface(zozor, NULL, ecran, &amp;positionZozor);
        // Les clotures
        SDL_BlitSurface(clotureVerticale, NULL, ecran, &amp;positionClotureGH);
        SDL_BlitSurface(clotureVerticale, NULL, ecran, &amp;positionClotureD);
        SDL_BlitSurface(clotureHorizontale, NULL, ecran, &amp;positionClotureGH);
        SDL_BlitSurface(clotureHorizontale, NULL, ecran, &amp;positionClotureB);

        SDL_Flip(ecran);
    }


    /*
    6. Pour terminer
    */
    SDL_Flip(ecran);
    SDL_FreeSurface(zozor);
    SDL_FreeSurface(clotureVerticale);
    SDL_FreeSurface(clotureHorizontale);
    SDL_Quit();

    return EXIT_SUCCESS;
}</code></pre><p id="r-335167" data-claire-element-id="335167">J'espère que ce TP vous a plu et surtout vous a permis de bien ancrer une partie de ce que vous avez appris jusqu'ici.</p><p id="r-335168" data-claire-element-id="335168">Il y a bien sûr moyen de mettre des images à la place des clôtures noires toutes moches. On peut aussi envisager de mettre une image d'herbe de 640 * 480 à la place du fond vert pour un meilleur effet. Si vous le faites, je serais très intéressé de voir le résultat :) .</p><p id="r-335169" data-claire-element-id="335169">Je terminerai en disant qu'aucun animal (en l'occurrence Zozor) n'a souffert pendant le codage de ce programme :lol: !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/tp-zozor-dans-son-enclos">[TP] Zozor dans son enclos</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/tp-zozor-dans-son-enclos/le-projet-2">
Le projet
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/tp-zozor-dans-son-enclos/la-solution-11">
La solution
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/tp-zozor-dans-son-enclos/le-projet-2">
<span class="arrow"></span>
<span class="next">Le projet</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/-zozor-dans-son-enclos.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 20:00:34 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/-zozor-dans-son-enclos.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:44:46 GMT -->
</html>