<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/utiliser-l-api-mysql-dans-vos-programmes.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 03:59:46 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/utiliser-l-api-mysql-dans-vos-programmes.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:46:46 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Utiliser l&#039;API MySQL dans vos programmes</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Utiliser l&#039;API MySQL dans vos programmes</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Utiliserl039APIMySQLdansvosprogrammes">Utiliser l&#039;API MySQL dans vos programmes</a><br/><a href="#Prface">Préface</a><br/><a href="#Installation">Installation</a><br/><a href="#Unpeudethorie">Un peu de théorie</a><br/><a href="#Lapratique">La pratique</a><br/></div>
<a name="Utiliserl039APIMySQLdansvosprogrammes"></a><h2>Utiliser l&#039;API MySQL dans vos programmes</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/preface-1">
<span class="next">Préface</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-374833" data-claire-element-id="374833">Tout d'abord <strong>bonjour tout le monde</strong> et bienvenue dans mon premier tutoriel pour le site du zéro !</p><p id="r-374834" data-claire-element-id="374834">Je vous apprendrai ici à utiliser l'<em>API MySQL</em> dans vos programmes pour les rendre encore plus complets et intéressants, à condition pour cela que vous compreniez bien ce que je vais vous apprendre. ;) <br/> A la fin de ce cours, vous devriez être capable de vous connecter à une base de données (<em>BDD</em>) et de faire des requêtes SQL depuis vos programmes <em>C/C++</em>.</p><p id="r-374835" data-claire-element-id="374835">Si vous êtes toujours partant, attachez vos ceintures, et préparez-vous à partir à l'aventure ! :pirate:</p>
</div><a name="Prface"></a><h2>Préface</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/installation-42">
<span class="next">Installation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-pre-requis-1" data-claire-element-id="374842">Pré-requis</h2><p id="r-374836" data-claire-element-id="374836">Pour pouvoir comprendre au mieux ce tutoriel, quelques connaissances sont requises.</p><h3 id="r-mysql" data-claire-element-id="374839">MySQL</h3><p id="r-374837" data-claire-element-id="374837">Vous devez savoir ce qu'est une BDD (<em>base de données</em>), ainsi que tout le vocabulaire comme : <em>table, champ, ligne, requête SQL, ...</em><br/> Il vous est aussi conseillé de connaître les bases du langage <em>SQL</em> pour pouvoir comprendre les requêtes de base.</p><p id="r-374838" data-claire-element-id="374838">S'il vous manque certaines connaissances à ce sujet je vous conseille de lire <a href="http://www.siteduzero.com/tuto-3-4-0-un-site-dynamique-avec-php.html#part_20">le tuto de M@teo sur le PHP</a>, de cette manière vous serez plus en mesure de comprendre ce tutoriel. ;)</p><h3 id="r-c-c" data-claire-element-id="374841">C/C++</h3><p id="r-374840" data-claire-element-id="374840">Il vous faudra avoir des bases en <em>C</em> (pointeurs, fonctions, conditions, boucles, installation d'une bibliothèque, etc.) pour comprendre ce tutoriel. Dans le cas échéant, je vous conseille encore une fois <a href="http://www.siteduzero.com/tuto-3-8-0-apprenez-a-programmer-en-c.html">un cours de M@teo21</a> (jusqu'à la partie 3 minimum).</p><h2 id="r-api-mysql-mais-pour-faire-quoi" data-claire-element-id="374849">API MySQL, mais pour faire quoi?</h2><div id="r-374844" data-claire-element-id="374844" data-claire-semantic="question"><p id="r-374843" data-claire-element-id="374843">Ben oui, à quoi ça nous sert d'apprendre à utiliser MySQL dans nos programmes?</p></div><p id="r-374845" data-claire-element-id="374845">Je vais répondre à cette question par un exemple simple.</p><p id="r-374846" data-claire-element-id="374846">Imaginons que vous vouliez faire un jeu dans lequel le joueur à un score final, alors vous allez faire un fichier score et y stocker le score. De cette manière, le joueur et ses amis pourront se concurrencer pour voir lequel est le meilleur. Mais, dans ce cas-là, pourquoi ne pas le faire à une plus grande échelle ?</p><p id="r-374847" data-claire-element-id="374847">En effet, vous pourriez enregistrer le score du joueur dans une <em>BDD</em> en utilisant l'<em>API MySQL</em>. Ainsi, ce n'est plus qu'avec ses amis que le joueur va concurrencer, mais avec tout le monde puisque tous les scores seront répertoriés dans cette <em>BDD</em>. Il vous suffira ensuite de faire une requête pour récupérer ces scores, pour que le joueur puisse voir s'il est le meilleur... ou pas.</p><p id="r-374848" data-claire-element-id="374848">Bien sûr, ce n'est qu'un exemple parmi tant d'autres. ;)</p><h2 id="r-portabilite" data-claire-element-id="374851">Portabilité</h2><p id="r-374850" data-claire-element-id="374850">Utilisant les sockets de Windows, les exemples qui seront proposés dans ce tutoriel ne pourront être compatibles qu'avec Windows. Pour les utilisateurs UNIX, il vous faudra vous renseigner davantage (<a href="http://www.siteduzero.com/tutoriel-3-3293-les-sockets.html">via ce cours sur les sockets par exemple</a>).</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes">Utiliser l&#039;API MySQL dans vos programmes</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/preface-1">
Préface
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/installation-42">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/un-peu-de-theorie-7">
Un peu de théorie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/la-pratique-11">
La pratique
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/installation-42">
<span class="next">Installation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Installation"></a><h2>Installation</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/preface-1">
<span class="arrow"></span>
<span class="next">Préface</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/un-peu-de-theorie-7">
<span class="next">Un peu de théorie</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-374853" data-claire-element-id="374853">Nous allons maintenant passer à l'installation de la librairie MySQL.</p><h3 id="r-dev-c" data-claire-element-id="374867">Dev-C++</h3><ul id="r-374866" data-claire-element-id="374866"><li id="r-374855" data-claire-element-id="374855"><p id="r-374854" data-claire-element-id="374854">Allez tout d'abord dans <strong>Aide</strong> puis cliquez sur <strong>A propos de Dev-C++</strong>.</p></li><li id="r-374857" data-claire-element-id="374857"><p id="r-374856" data-claire-element-id="374856">Une fenêtre apparaît ; cliquez sur <strong>Nouvelle version</strong>.</p></li><li id="r-374859" data-claire-element-id="374859"><p id="r-374858" data-claire-element-id="374858">De là, sélectionnez le serveur <strong>devpack.org comunity devpacks</strong> puis cliquez sur <strong>Check for update</strong>.</p></li><li id="r-374861" data-claire-element-id="374861"><p id="r-374860" data-claire-element-id="374860">Dans <strong>groups</strong>, choisissez <strong>databases</strong> puis sélectionnez <strong>libmysql</strong>.</p></li><li id="r-374863" data-claire-element-id="374863"><p id="r-374862" data-claire-element-id="374862">Téléchargez-le.</p></li><li id="r-374865" data-claire-element-id="374865"><p id="r-374864" data-claire-element-id="374864">Allez dans les <strong>options du projet</strong>, onglet <strong>paramètres</strong>, case <strong>éditeur de liens</strong> et marquez <strong>-lmysql</strong>.</p></li></ul><h3 id="r-vc" data-claire-element-id="374880">VC</h3><p id="r-374868" data-claire-element-id="374868">Pour VC, il vous faut télécharger les fichiers d'en-têtes et les bibliothèques <a href="http://www.archive-host.com/compteur.php?url=http://sd-1.archive-host.com/membres/up/1394874161/download/vc.zip">ici</a>. Par la suite :</p><ul id="r-374877" data-claire-element-id="374877"><li id="r-374870" data-claire-element-id="374870"><p id="r-374869" data-claire-element-id="374869">placez les fichiers <code data-claire-semantic="c">.h</code> dans <strong>../vc/include/mysql</strong> ;</p></li><li id="r-374872" data-claire-element-id="374872"><p id="r-374871" data-claire-element-id="374871">placez le fichier <code data-claire-semantic="c">.lib</code> dans <strong>../vc/lib</strong> ;</p></li><li id="r-374874" data-claire-element-id="374874"><p id="r-374873" data-claire-element-id="374873">ajoutez <strong>libmysql.lib</strong> dans les options du projet <strong>/editeur de lien/entrée/dependence suplementaire</strong> ;</p></li><li id="r-374876" data-claire-element-id="374876"><p id="r-374875" data-claire-element-id="374875">ajoutez <strong>libmysql.dll</strong> dans le dossier du projet.</p></li></ul><aside id="r-374879" data-claire-element-id="374879" data-claire-semantic="information"><p id="r-374878" data-claire-element-id="374878">Merci à <a href="http://www.siteduzero.com/membres-294-31627.html">dorone</a> pour ces informations sur VC.</p></aside><h3 id="r-code-blocks-2" data-claire-element-id="374892">Code::blocks</h3><p id="r-374881" data-claire-element-id="374881">Tout d'abord, je vous ai préparé un petit fichier compressé avec tout ce que vous allez avoir besoin pour l'installation.</p><p id="r-374882" data-claire-element-id="374882"><a href="http://www.archive-host.com/compteur.php?url=http://sd-1.archive-host.com/membres/up/1394874161/download/api_mysql.zip">Télécharger le ZIP (766 Ko)</a></p><p id="r-374883" data-claire-element-id="374883">Vous y trouverez :</p><ul id="r-374890" data-claire-element-id="374890"><li id="r-374885" data-claire-element-id="374885"><p id="r-374884" data-claire-element-id="374884">le fichier <strong>libmysql.dll</strong>, que vous mettrez dans le dossier de tous vos programmes utilisant l'API MySQL (comme vous le faite habituellement pour tous vos fichiers <code data-claire-semantic="c">.dll</code>) ;</p></li><li id="r-374887" data-claire-element-id="374887"><p id="r-374886" data-claire-element-id="374886">le fichier <strong>libmysqlclient.a</strong>, que vous mettrez dans le dossier <strong>lib</strong> du dossier <strong>mingw32</strong> de Code::Blocks ;</p></li><li id="r-374889" data-claire-element-id="374889"><p id="r-374888" data-claire-element-id="374888">un dossier <strong>MYSQL</strong> où se trouvent tous les fichiers d'en-têtes dont vous pourrez avoir besoin. Copiez ce dossier et collez-le dans le dossier <strong>include</strong> du dossier <strong>mingw32</strong> de Code::Blocks.</p></li></ul><p id="r-374891" data-claire-element-id="374891">Maintenant vous n'avez plus qu'à créer un nouveau projet, à ajouter le fichier <code data-claire-semantic="c">.dll</code> dans le répertoire de celui-ci et à lier le fichier <strong>libmysqlclient.a</strong>. Voilà, la bibliothèque est installée ; vous allez enfin pouvoir commencer à coder !</p><h3 id="r-linux-5" data-claire-element-id="374897">Linux</h3><p id="r-374893" data-claire-element-id="374893">Pour Linux, voici la commande pour installer l'API MySQL (adaptez-la à votre distribution).</p><pre id="r-374894" data-claire-element-id="374894"><code data-claire-semantic="console">$ sudo su
# apt-get install libmysqlclient15-dev</code></pre><aside id="r-374896" data-claire-element-id="374896" data-claire-semantic="information"><p id="r-374895" data-claire-element-id="374895">Merci à <a href="http://www.siteduzero.com/membres-294-60132.html">Xhtml_boys</a> pour ces informations sous Linux.</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes">Utiliser l&#039;API MySQL dans vos programmes</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/preface-1">
Préface
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/installation-42">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/un-peu-de-theorie-7">
Un peu de théorie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/la-pratique-11">
La pratique
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/preface-1">
<span class="arrow"></span>
<span class="next">Préface</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/un-peu-de-theorie-7">
<span class="next">Un peu de théorie</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Unpeudethorie"></a><h2>Un peu de théorie</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/installation-42">
<span class="arrow"></span>
<span class="next">Installation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/la-pratique-11">
<span class="next">La pratique</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-374899" data-claire-element-id="374899">Nous arrivons maintenant à la partie « théorique » du tutoriel. Nous allons étudier les principales fonctions de l'API MySQL pour pouvoir ensuite créer un petit jeu utilisant tout ce qu'on aura appris.</p><h2 id="r-connexion-deconnexion" data-claire-element-id="374951">Connexion/déconnexion</h2><p id="r-374900" data-claire-element-id="374900">Tout d'abord, créez et configurez un nouveau projet en console, en utilisant les informations de la sous-partie précédente.</p><p id="r-374901" data-claire-element-id="374901">Pour pouvoir utiliser l'API MySQL, il faut commencer par inclure deux fichiers d'en-têtes :</p><pre id="r-374902" data-claire-element-id="374902"><code data-claire-semantic="c">#include &lt;winsock.h&gt;
#include &lt;MYSQL/mysql.h&gt;</code></pre><aside id="r-374904" data-claire-element-id="374904" data-claire-semantic="warning"><p id="r-374903" data-claire-element-id="374903">Vérifiez que vous avez bien mis <code data-claire-semantic="c">#include &lt;winsock.h&gt;</code> avant <code data-claire-semantic="c">#include &lt;MYSQL/mysql.h&gt;</code>, car, dans le cas contraire, vous aurez droit à une belle petite erreur. ;)</p></aside><p id="r-374905" data-claire-element-id="374905">Maintenant nous allons faire quelque chose d'indispensable pour pouvoir faire des requêtes dans votre programme : l'<strong>initialisation</strong>, la <strong>connexion</strong> et la <strong>déconnexion</strong>. Tout d'abord, il va falloir que nous déclarions un objet de type <code data-claire-semantic="c">MYSQL</code>. Ce dernier nous servira tout au long du tutoriel, afin de pouvoir utiliser la plupart des fonctions.</p><pre id="r-374906" data-claire-element-id="374906"><code data-claire-semantic="c">MYSQL mysql;</code></pre><p id="r-374907" data-claire-element-id="374907">Puis, initialisons MySQL, grâce à la fonction :</p><pre id="r-374908" data-claire-element-id="374908"><code data-claire-semantic="c">mysql_init(MYSQL *mysql);</code></pre><p id="r-374909" data-claire-element-id="374909">.</p><p id="r-374910" data-claire-element-id="374910">Une fois l'initialisation réalisée, il faut se connecte. Dans cette optique, nous allons utiliser deux fonctions, que voici :</p><pre id="r-374911" data-claire-element-id="374911"><code data-claire-semantic="c">mysql_options(MYSQL *mysql, enum mysql_option option, const char *arg);
mysql_real_connect(MYSQL *mysql, const char *host, const char *user, const char *passwd, const char *db, unsigned int port, const char *unix_socket, unsigned long client_flag);</code></pre><p id="r-374912" data-claire-element-id="374912">Prenons-les dans l'ordre:</p><ul id="r-374941" data-claire-element-id="374941"><li id="r-374921" data-claire-element-id="374921"><p id="r-374913" data-claire-element-id="374913"><code data-claire-semantic="c">mysql_options</code> :</p><ul id="r-374920" data-claire-element-id="374920"><li id="r-374915" data-claire-element-id="374915"><p id="r-374914" data-claire-element-id="374914">Le premier argument est un pointeur de structure, que nous avons vu juste avant.</p></li><li id="r-374917" data-claire-element-id="374917"><p id="r-374916" data-claire-element-id="374916">Le deuxième argument est l'option que nous voulons configurer, nous utiliserons toujours <code data-claire-semantic="c">MYSQL_READ_DEFAULT_GROUP</code>, qui lie les options spécifiées dans le fichier <code data-claire-semantic="c">my.cnf</code>.</p></li><li id="r-374919" data-claire-element-id="374919"><p id="r-374918" data-claire-element-id="374918">Enfin, le troisième argument est la valeur de cette option ; vous pouvez mettre le nom que vous souhaitez.</p></li></ul></li><li id="r-374940" data-claire-element-id="374940"><p id="r-374922" data-claire-element-id="374922"><code data-claire-semantic="c">mysql_real_connect</code> :</p><ul id="r-374939" data-claire-element-id="374939"><li id="r-374924" data-claire-element-id="374924"><p id="r-374923" data-claire-element-id="374923">Le premier argument est toujours un pointeur vers votre structure.</p></li><li id="r-374926" data-claire-element-id="374926"><p id="r-374925" data-claire-element-id="374925">Le deuxième argument est le nom de domaine ou l'adresse de votre hébergeur (dans mon cas, c'est <a href="http://www.goldzoneweb.info/">www.goldzoneweb.info</a>). S'il est marqué « localhost », je vous conseille de faire comme moi, et de mettre l'adresse de votre hébergeur car l'utilisation de « localhost » peut engendrer des erreurs.</p></li><li id="r-374928" data-claire-element-id="374928"><p id="r-374927" data-claire-element-id="374927">Le troisième argument est votre identifiant de connexion.</p></li><li id="r-374930" data-claire-element-id="374930"><p id="r-374929" data-claire-element-id="374929">Le quatrième argument est votre mot de passe.</p></li><li id="r-374932" data-claire-element-id="374932"><p id="r-374931" data-claire-element-id="374931">Le cinquième argument est le nom de votre base de données.</p></li><li id="r-374934" data-claire-element-id="374934"><p id="r-374933" data-claire-element-id="374933">Le sixième argument est le port, je vous conseille de mettre 0 pour éviter les erreurs.</p></li><li id="r-374936" data-claire-element-id="374936"><p id="r-374935" data-claire-element-id="374935">Le septième argument est le socket à utiliser, je vous conseille de mettre <code data-claire-semantic="c">NULL</code> ici.</p></li><li id="r-374938" data-claire-element-id="374938"><p id="r-374937" data-claire-element-id="374937">Et le huitième argument est le <em>flag</em>, je vous conseille de mettre 0.</p></li></ul></li></ul><aside id="r-374943" data-claire-element-id="374943" data-claire-semantic="information"><p id="r-374942" data-claire-element-id="374942">Pour travailler en local (avec EasyPHP par exemple), il faut mettre <strong>localhost</strong> comme 2e argument, puis root en identifiant, et il faut laisser vide pour le mot de passe. (information de <a href="http://www.siteduzero.com/membres-294-27255.html">Arabesque356</a>)</p></aside><aside id="r-374945" data-claire-element-id="374945" data-claire-semantic="warning"><p id="r-374944" data-claire-element-id="374944">Certains hébergeurs bloquent le port pour la connexion, il vous est donc impossible d'utiliser l'API avec ces hébergeurs. (information de <a href="http://www.siteduzero.com/membres-294-27255.html">Arabesque356</a>)</p></aside><p id="r-374946" data-claire-element-id="374946">Comme vous l'aurez sûrement compris, <code data-claire-semantic="c">mysql_options</code> sert à spécifier des options de connexion, et <code data-claire-semantic="c">mysql_real_connect</code> sert à se connecter à une base de données. Pour terminer, il ne vous reste plus qu'à fermer la connexion MySQL à l'aide de la fonction :</p><pre id="r-374947" data-claire-element-id="374947"><code data-claire-semantic="c">mysql_close(MYSQL *mysql);</code></pre><p id="r-374948" data-claire-element-id="374948">.</p><pre id="r-374949" data-claire-element-id="374949"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;winsock.h&gt;
#include &lt;MYSQL/mysql.h&gt;



int main(void)
{
    MYSQL mysql;
    mysql_init(&amp;mysql);
    mysql_options(&amp;mysql,MYSQL_READ_DEFAULT_GROUP,&quot;option&quot;);

    if(mysql_real_connect(&amp;mysql,&quot;www.goldzoneweb.info&quot;,&quot;mon_pseudo&quot;,&quot;******&quot;,&quot;ma_base&quot;,0,NULL,0))
    {
        mysql_close(&amp;mysql);
    }
    else
    {
        printf(&quot;Une erreur s'est produite lors de la connexion à la BDD!&quot;);
    }

    return 0;
}</code></pre><p id="r-374950" data-claire-element-id="374950">Voilà je ne crois pas avoir besoin d'expliquer ce code, si ce n'est que, lorsque la connexion plante, <code data-claire-semantic="c">mysql_real_connect</code> renvoie <code data-claire-semantic="c">NULL</code>, ce qui nous permet de gérer les erreurs.</p><h2 id="r-les-requetes-n-attendant-aucun-jeu-de-resultats" data-claire-element-id="374960">Les requêtes n'attendant aucun jeu de résultats</h2><div id="r-374953" data-claire-element-id="374953" data-claire-semantic="question"><p id="r-374952" data-claire-element-id="374952">Hein, c'est quoi que ça, un nouveau type de requêtes ?</p></div><p id="r-374954" data-claire-element-id="374954">Non non, rassurez-vous ! En fait, vous les connaissez déjà : <code data-claire-semantic="sql">INSERT, DELETE, CREATE, UPDATE</code> par exemple n'attendent aucune réponse. Au contraire, des requêtes comme <code data-claire-semantic="sql">SELECT</code> ou <code data-claire-semantic="sql">SHOW</code> attendent une réponse. Voyons maintenant la fonction permettant de faire des requêtes MySQL :</p><pre id="r-374955" data-claire-element-id="374955"><code data-claire-semantic="c">mysql_query(MYSQL *mysql, const char *query);</code></pre><p id="r-374956" data-claire-element-id="374956">Il vous faudra spécifier pour cette fonction le pointeur de structures ainsi que la requête. Voici un exemple de son utilisation:</p><pre id="r-374957" data-claire-element-id="374957"><code data-claire-semantic="c">mysql_query(&amp;mysql, &quot;INSERT INTO ma_table VALUES('valeur 1', 'valeur 2', 'etc')&quot;);</code></pre><p id="r-374958" data-claire-element-id="374958">Comme vous pouvez le voir, cette requête va enregistrer dans la table <code data-claire-semantic="c">ma_table</code> les valeurs que j'ai mises dans l'exemple. Maintenant, si vous voulez savoir combien de lignes ont été affectées par votre requête, il suffit d'appeler la fonction :</p><pre id="r-374959" data-claire-element-id="374959"><code data-claire-semantic="c">mysql_affected_rows(MYSQL *mysql);</code></pre><h2 id="r-les-requetes-attendant-un-jeu-de-resultats" data-claire-element-id="375003">Les requêtes attendant un jeu de résultats</h2><p id="r-374961" data-claire-element-id="374961">Ce type de requête n'est pas plus compliqué que l'autre, si ce n'est que, comme on attend un résultat, il faut faire des opérations en plus. ;) Pour la requête en elle même ça ne change pas, il faut toujours utiliser la fonction <code data-claire-semantic="c">mysql_query</code>. Cependant, pour récupérer le résultat il y a deux façons de faire, que nous allons étudier ensemble.</p><h3 id="r-mysql-use-result-mysql-mysql" data-claire-element-id="374990"><code data-claire-semantic="c">mysql_use_result(MYSQL *mysql)</code></h3><p id="r-374962" data-claire-element-id="374962">Cette fonction récupère le jeu de résultat, mais ne l'enregistre pas dans le client. Son principal avantage réside dans sa rapidité et dans sa faible utilisation de la mémoire. Toutefois, vous ne pourrez pas faire d'opérations comme revenir au résultat n°2, etc. Vous devrez stocker la valeur de retour de cette fonction dans un pointeur de structure de type <code data-claire-semantic="c">MYSQL_RES</code>, qui est fait spécialement pour stocker le jeu de résultats.</p><p id="r-374963" data-claire-element-id="374963">Stocker un jeu de résultat ne suffit pas pour le lire ; pour cela, vous devrez appeler une autre fonction :</p><pre id="r-374964" data-claire-element-id="374964"><code data-claire-semantic="c">mysql_fetch_row(MYSQL_RES *result);</code></pre><p id="r-374965" data-claire-element-id="374965">La valeur de retour de cette fonction devra quant à elle être stockée dans un objet de type <code data-claire-semantic="c">MYSQL_ROW</code> (correspondant généralement à un tableau de chaînes de caractères) <code data-claire-semantic="c">mysql_fetch_row</code> stocke les valeurs de la ligne suivante dans le jeu de résultats. Il est nécessaire, de libérer la mémoire allouée par cette fonction.</p><pre id="r-374966" data-claire-element-id="374966"><code data-claire-semantic="c">mysql_free_result(MYSQL_RES *result);</code></pre><aside id="r-374968" data-claire-element-id="374968" data-claire-semantic="warning"><p id="r-374967" data-claire-element-id="374967">Pensez à vérifier que <code data-claire-semantic="c">mysql_use_result</code> renvoie quelque chose.</p></aside><p id="r-374969" data-claire-element-id="374969">Voici un exemple récapitulatif.</p><pre id="r-374970" data-claire-element-id="374970"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;winsock.h&gt;
#include &lt;MYSQL/mysql.h&gt;



int main(void)
{
    //Déclaration du pointeur de structure de type MYSQL
    MYSQL mysql;
    //Initialisation de MySQL
    mysql_init(&amp;mysql);
    //Options de connexion
    mysql_options(&amp;mysql,MYSQL_READ_DEFAULT_GROUP,&quot;option&quot;);

    //Si la connexion réussie...
    if(mysql_real_connect(&amp;mysql,&quot;www.goldzoneweb.info&quot;,&quot;mon_pseudo&quot;,&quot;*****&quot;,&quot;ma_base&quot;,0,NULL,0))
    {
        //Requête qui sélectionne tout dans ma table scores
        mysql_query(&amp;mysql, &quot;SELECT * FROM scores&quot;);
        //Déclaration des objets
        MYSQL_RES *result = NULL;
        MYSQL_ROW row;
        int i = 1;

        //On met le jeu de résultat dans le pointeur result
        result = mysql_use_result(&amp;mysql);
        //Tant qu'il y a encore un résultat ...
        while ((row = mysql_fetch_row(result)))
        {
           printf(&quot;Resultat %ld\n&quot;, i);
           i++;
        }
        //Libération du jeu de résultat
        mysql_free_result(result);

        //Fermeture de MySQL
        mysql_close(&amp;mysql);
    }
    else  //Sinon ...
    {
        printf(&quot;Une erreur s'est produite lors de la connexion à la BDD!&quot;);
    }

    return 0;
}</code></pre><pre id="r-374971" data-claire-element-id="374971"><code data-claire-semantic="console">Resultat 1 
Resultat 2 
Resultat 3 
Resultat 4 
Resultat 5 
Resultat 6 

Press any key to continue.</code></pre><p id="r-374972" data-claire-element-id="374972">Le jeu de résultats est mis dans <code data-claire-semantic="c">result</code>, puis on fait une boucle pour lister toutes les lignes. Mais ça n'indique toujours pas la <em>valeur</em> de la ligne : deux nouvelles fonctions vont nous le permettre.</p><pre id="r-374973" data-claire-element-id="374973"><code data-claire-semantic="c">mysql_num_fields(MYSQL_RES *result);</code></pre><p id="r-374974" data-claire-element-id="374974">Elle retourne un entier non signé qui correspond au nombre de champs de la table sélectionnée. Donc, pour pouvoir avoir les valeurs de notre requête, il va falloir stocker dans une variable le nombre de champs, puis faire une boucle pour avoir chaque valeur, une par une.</p><pre id="r-374975" data-claire-element-id="374975"><code data-claire-semantic="c">mysql_fetch_lengths(MYSQL_RES *result);</code></pre><p id="r-374976" data-claire-element-id="374976">Elle retourne un tableau d'entiers non signés qui correspondent à la taille de la valeur de chaque champ du résultat. Avec ces informations, voici un exemple de requête complète ::</p><pre id="r-374977" data-claire-element-id="374977"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;winsock.h&gt;
#include &lt;MYSQL/mysql.h&gt;



int main(void)
{
    //Déclaration du pointeur de structure de type MYSQL
    MYSQL mysql;
    //Initialisation de MySQL
    mysql_init(&amp;mysql);
    //Options de connexion
    mysql_options(&amp;mysql,MYSQL_READ_DEFAULT_GROUP,&quot;option&quot;);
 
    //Si la connexion réussie...
    if(mysql_real_connect(&amp;mysql,&quot;www.goldzoneweb.info&quot;,&quot;mon_pseudo&quot;,&quot;*****&quot;,&quot;ma_base&quot;,0,NULL,0))
    {
        //Requête qui sélectionne tout dans ma table scores
        mysql_query(&amp;mysql, &quot;SELECT * FROM scores&quot;);

        //Déclaration des objets
        MYSQL_RES *result = NULL;
        MYSQL_ROW row;

        unsigned int i = 0;
        unsigned int num_champs = 0;

        //On met le jeu de résultat dans le pointeur result
        result = mysql_use_result(&amp;mysql);

        //On récupère le nombre de champs
        num_champs = mysql_num_fields(result);

        //Tant qu'il y a encore un résultat ...
        while ((row = mysql_fetch_row(result)))
        {
            //On déclare un pointeur long non signé pour y stocker la taille des valeurs
            unsigned long *lengths;

            //On stocke ces tailles dans le pointeur
            lengths = mysql_fetch_lengths(result);

            //On fait une boucle pour avoir la valeur de chaque champs
            for(i = 0; i &lt; num_champs; i++)
            {
               //On ecrit toutes les valeurs
               printf(&quot;[%.*s] &quot;, (int) lengths[i], row[i] ? row[i] : &quot;NULL&quot;);
            }
            printf(&quot;\n&quot;);
        }

        //Libération du jeu de résultat
        mysql_free_result(result);

        //Fermeture de MySQL
        mysql_close(&amp;mysql);

    }
    else  //Sinon ...
    {
        printf(&quot;Une erreur s'est produite lors de la connexion à la BDD!&quot;);
    }

    return 0;
}</code></pre><pre id="r-374978" data-claire-element-id="374978"><code data-claire-semantic="console">[1] [The BasheR] [130000] 
[2] [Rom] [10005120] 
[3] [Tib] [51203] 
[4] [Joe] [78491] 
[5] [Fab] [12054] 
[6] [Nic] [1102350]</code></pre><p id="r-374979" data-claire-element-id="374979">La seule ligne qui peut vous poser problème est la suivante :</p><pre id="r-374980" data-claire-element-id="374980"><code data-claire-semantic="c">printf(&quot;[%.*s] &quot;, (int) lengths[i], row[i] ? row[i] : &quot;NULL&quot;);</code></pre><p id="r-374981" data-claire-element-id="374981">D'abord, la chaîne de conversion de <code data-claire-semantic="c">printf</code>, <code data-claire-semantic="c">%.*s</code>, est assez austère, il faut l'avouer. Cependant, en prenant les éléments un par un, on arrive à la comprendre sans problème. Tout d'abord, le <code data-claire-semantic="c">%</code> indique le début d'un format. Ensuite vient le point, qui sert à séparer un nombre éventuel indiquant la largeur du champ et la précision désirés. Par exemple, avec <code data-claire-semantic="c">%10.20s</code>, on aura une largeur de champ de 10 et on écrira au maximum 20 caractères. Enfin, on trouve l'étoile, qui permet, en réalité, de spécifier la largeur ou la précision à l'aide d'une variable du programme. Celle-ci doit être de type <code data-claire-semantic="c">int</code> (d'où le transtypage).</p><p id="r-374982" data-claire-element-id="374982">Ainsi, l'appel à <code data-claire-semantic="c">printf</code> suivant (tiré du K&amp;R) signifiera : « imprimer sur <code data-claire-semantic="c">stdout</code> au plus <code data-claire-semantic="c">max</code> caractères de la chaîne <code data-claire-semantic="c">s</code> ».</p><pre id="r-374983" data-claire-element-id="374983"><code data-claire-semantic="c">printf(&quot;%.*s&quot;, max, s);</code></pre><p id="r-374984" data-claire-element-id="374984">Ensuite, la condition ternaire. Voici son équivalent sous forme classique :</p><pre id="r-374985" data-claire-element-id="374985"><code data-claire-semantic="c">if (row[i])
    printf(&quot;%.*s&quot;, (int) lengths[i], row[i]);
else
    printf(&quot;NULL&quot;);</code></pre><p id="r-374986" data-claire-element-id="374986">Aussi la syntaxe est-elle la suivante :</p><pre id="r-374987" data-claire-element-id="374987"><code>(condition) ? (a_faire_si_vrai) : (a_faire_si_faux)</code></pre><aside id="r-374989" data-claire-element-id="374989" data-claire-semantic="information"><p id="r-374988" data-claire-element-id="374988">Merci à <a href="http://www.siteduzero.com/membres-294-2500.html">mleg</a> pour l'explication de ce point.</p></aside><h3 id="r-mysql-store-result-mysql-mysql" data-claire-element-id="375002"><code data-claire-semantic="c">mysql_store_result(MYSQL *mysql)</code></h3><p id="r-374991" data-claire-element-id="374991">Le principe est le même, à la différence que cette fonction stocke le jeu de résultat dans une mémoire tampon, ce qui rend possible des éventuelles opérations à partir de ce jeu. Notez néanmoins que la fonction peut se révéler plus lente que <code data-claire-semantic="c">mysql_use_result</code>.</p><p id="r-374992" data-claire-element-id="374992">Pour réaliser une requête similaire à celle de l'exemple précédent il suffit juste de changer <code data-claire-semantic="c">mysql_use_result</code> par <code data-claire-semantic="c">mysql_store_result</code>.</p><pre id="r-374993" data-claire-element-id="374993"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;winsock.h&gt;
#include &lt;MYSQL/mysql.h&gt;



int main(void)
{
    //Déclaration du pointeur de structure de type MYSQL
    MYSQL mysql;
    //Initialisation de MySQL
    mysql_init(&amp;mysql);
    //Options de connexion
    mysql_options(&amp;mysql,MYSQL_READ_DEFAULT_GROUP,&quot;option&quot;);

    //Si la connexion réussie...
    if(mysql_real_connect(&amp;mysql,&quot;www.goldzoneweb.info&quot;,&quot;mon_pseudo&quot;,&quot;*****&quot;,&quot;ma_base&quot;,0,NULL,0))
    {
        //Requête qui sélectionne tout dans ma table scores
        mysql_query(&amp;mysql, &quot;SELECT * FROM scores&quot;);

        //Déclaration des objets
        MYSQL_RES *result = NULL;
        MYSQL_ROW row;

        unsigned int i = 0;
        unsigned int num_champs = 0;

        //On met le jeu de résultat dans le pointeur result (maintenant on utilise mysql_store_result
        result = mysql_store_result(&amp;mysql);

        //On récupère le nombre de champs
        num_champs = mysql_num_fields(result);

        //Tant qu'il y a encore un résultat ...
        while ((row = mysql_fetch_row(result)))
        {
            //On déclare un pointeur long non signé pour y stocker la taille des valeurs
            unsigned long *lengths;

            //On stocke cette taille dans le pointeur
            lengths = mysql_fetch_lengths(result);

            //On fait une boucle pour avoir la valeur de chaque champs
            for(i = 0; i &lt; num_champs; i++)
            {
                //On ecrit toutes les valeurs
                printf(&quot;[%.*s] &quot;, (int) lengths[i], row[i] ? row[i] : &quot;NULL&quot;);
            }
            printf(&quot;\n&quot;);
        }

        //Libération du jeu de résultat
        mysql_free_result(result);

        //Fermeture de MySQL
        mysql_close(&amp;mysql);

    }
    else  //Sinon ...
    {
        printf(&quot;Une erreur s'est produite lors de la connexion à la BDD!&quot;);
    }

    return 0;
}</code></pre><div id="r-374995" data-claire-element-id="374995" data-claire-semantic="question"><p id="r-374994" data-claire-element-id="374994">Mais alors pourquoi utiliser cette fonction si elle fait la même chose, en plus de temps ? o_O</p></div><p id="r-374996" data-claire-element-id="374996">Eh bien, c'est vrai qu'à première vue ça ne sert pas à grand chose, mais en fait l'intérêt de cette fonction est qu'on peut « voyager » dans le jeu de résultat, c'est-à-dire qu'on peut demander à avoir seulement le résultat n°2, ou n°3, etc. Pour cela, il existe une fonction que voici :</p><pre id="r-374997" data-claire-element-id="374997"><code data-claire-semantic="c">mysql_data_seek(MYSQL_RES *result, my_ulonglong offset);</code></pre><p id="r-374998" data-claire-element-id="374998">Elle prend en argument le jeu de résultat ainsi que le numéro de la ligne qu'on veut obtenir.</p><pre id="r-374999" data-claire-element-id="374999"><code data-claire-semantic="c">//Requête qui sélectionne tout dans ma table scores
            mysql_query(&amp;mysql, &quot;SELECT * FROM livreor&quot;);

            //Déclaration des variables
            MYSQL_RES *result = NULL;
            MYSQL_ROW row;

            unsigned int i = 0;
            unsigned int num_champs = 0;

            //On met le jeu de résultats dans le pointeur result.
            result = mysql_store_result(&amp;mysql);
            
            //On choisit une ligne.
            mysql_data_seek(result, 4);

            //On récupère le nombre de champs
            num_champs = mysql_num_fields(result);

            //On stocke les valeurs de la ligne choisie.
            row = mysql_fetch_row(result);

            //On déclare un pointeur long non signé pour y stocker la taille des valeurs.
            unsigned long *lengths;

            //On stocke cette taille dans le pointeur.
            lengths = mysql_fetch_lengths(result);

            //On fait une boucle pour avoir la valeur de chaque champ.
            for(i = 0; i &lt; num_champs; i++)
            {
                //On ecrit toutes les valeurs
                printf(&quot;[%.*s] &quot;, (int) lengths[i], row[i] ? row[i] : &quot;NULL&quot;);
            }</code></pre><pre id="r-375000" data-claire-element-id="375000"><code data-claire-semantic="console">[4] [Joe] [78491]</code></pre><p id="r-375001" data-claire-element-id="375001">Voilà, nous en avons donc terminé avec la théorie, nous allons maintenant passer à la pratique dans un petit TP, que de réjouissances en perspective. :ange:</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes">Utiliser l&#039;API MySQL dans vos programmes</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/preface-1">
Préface
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/installation-42">
Installation
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/un-peu-de-theorie-7">
Un peu de théorie
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/la-pratique-11">
La pratique
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/installation-42">
<span class="arrow"></span>
<span class="next">Installation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/la-pratique-11">
<span class="next">La pratique</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lapratique"></a><h2>La pratique</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/un-peu-de-theorie-7">
<span class="arrow"></span>
<span class="next">Un peu de théorie</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-375005" data-claire-element-id="375005">Nous y voilà enfin ! Après toute cette attente nous allons enfin pouvoir pratiquer ! :D Ce petit TP ne sera pas bien compliqué et utilisera ce que vous venez d'apprendre.</p><h2 id="r-concept-2" data-claire-element-id="375014">Concept</h2><p id="r-375006" data-claire-element-id="375006">Le concept de ce jeu est assez simple, nous allons reprendre le jeu du plus ou moins en console, et y apporter quelques modifications. Tout d'abord, il va nous falloir une table pour stocker les scores, dont voici le code :</p><pre id="r-375007" data-claire-element-id="375007"><code data-claire-semantic="sql">CREATE TABLE `scores` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `pseudo` varchar(20) NOT NULL,
  `score` int(11) NOT NULL,
  KEY `id` (`id`)
);</code></pre><p id="r-375008" data-claire-element-id="375008">Au début, il y aura un menu demandant si on jouer ou voir les scores.</p><h3 id="r-jouer" data-claire-element-id="375010">Jouer</h3><p id="r-375009" data-claire-element-id="375009">Si le joueur choisit de jouer, alors on entre dans le jeu du plus ou moins : un nombre est généré aléatoirement, l'utilisateur doit essayer de le trouver. Une fois cela fait, on indique au joueur le nombre de coups qu'il a fait et on lui demande son pseudo. Il suffit ensuite d'enregistrer le tout dans la table « scores ».</p><h3 id="r-scores" data-claire-element-id="375013">Scores</h3><p id="r-375011" data-claire-element-id="375011">Pour afficher les scores, nous utiliserons le format suivant, avec les scores dans l'ordre croissant :</p><pre id="r-375012" data-claire-element-id="375012"><code>1- pseudo1 score1 pts

2- pseudo2 score2 pts

...

...</code></pre><h2 id="r-correction-125" data-claire-element-id="375027">Correction</h2><div id="r-375016" data-claire-element-id="375016"><pre id="r-375015" data-claire-element-id="375015"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;time.h&gt;
#include &lt;winsock.h&gt;
#include &lt;MYSQL/mysql.h&gt;



int main(void)
{
    long nombreMystere = 0, nombreEntre = 0, choix = 0;
    const long MAX = 100, MIN = 1;
    char pseudo[20] = &quot;&quot;;

    // Génération du nombre aléatoire

    srand(time(NULL));

    //Choix de voir les scores ou de jouer
    printf(&quot;Bienvenue dans mon jeu de plus ou moins!\n\n&quot;);

    printf(&quot;1- Jouer\n&quot;);
    printf(&quot;2- Scores\n\n&quot;);

    scanf(&quot;%ld&quot;, &amp;choix);


    switch (choix)
    {
        //Si on veut jouer
        case 1:
            //On génére le nombre aléatoire
            nombreMystere = (rand() % (MAX - MIN + 1)) + MIN;

            int i = 1;

            do
            {
                // On demande le nombre
                printf(&quot;Quel est le nombre ? &quot;);
                scanf(&quot;%ld&quot;, &amp;nombreEntre);

                // On compare le nombre entré avec le nombre mystère

                if (nombreMystere &gt; nombreEntre)
                    printf(&quot;C'est plus !\n\n&quot;);
                else if (nombreMystere &lt; nombreEntre)
                    printf(&quot;C'est moins !\n\n&quot;);
                else
                    printf (&quot;Bravo, vous avez trouve le nombre mystere !!!\n\n&quot;);

                i++;
            } while (nombreEntre != nombreMystere);

            printf(&quot;Votre score est de: %ld\n\n&quot;, i);
            printf(&quot;Veuillez entrer votre pseudo\n&quot;);
            scanf(&quot;%s&quot;, pseudo);

            //Déclaration de l'objet de type MYSQL
            MYSQL mysql;
            //Initialisation de MySQL
            mysql_init(&amp;mysql);
            //Options de connexion
            mysql_options(&amp;mysql,MYSQL_READ_DEFAULT_GROUP,&quot;option&quot;);

            //Si la connexion réussie...
            if(mysql_real_connect(&amp;mysql,&quot;www.votrehebergeur.com&quot;,&quot;mon_pseudo&quot;,&quot;*****&quot;,&quot;ma_base&quot;,0,NULL,0))
            {
                //On déclare un tableau de char pour y stocker la requete
                char requete[150] = &quot;&quot;;

                //On stock la requete dans notre tableau de char
                sprintf(requete, &quot;INSERT INTO scores VALUES('', '%s', '%ld')&quot;, pseudo, i);


                //On execute la requete
                mysql_query(&amp;mysql, requete);


                //Fermeture de MySQL
                mysql_close(&amp;mysql);
            }
            else
            {
                printf(&quot;Une erreur s'est produite lors de la connexion a la BDD!\n&quot;);
            }


            break;

        //On veut voir les scores
        case 2:
            printf(&quot;Liste des scores du jeu: \n\n&quot;);

            //Déclaration de l'objet de type MYSQL
            MYSQL mysql2;
                //Initialisation de MySQL
                mysql_init(&amp;mysql2);
                //Options de connexion
                mysql_options(&amp;mysql2,MYSQL_READ_DEFAULT_GROUP,&quot;option2&quot;);

                //Si la connexion réussie...
                if(mysql_real_connect(&amp;mysql2,&quot;www.votrehebergeur.com&quot;,&quot;mon_pseudo&quot;,&quot;*****&quot;,&quot;ma_base&quot;,0,NULL,0))
                {
                    //Requête qui sélectionne tout dans ma table scores
                    mysql_query(&amp;mysql2, &quot;SELECT * FROM scores ORDER BY score&quot;);

                    //Déclaration des pointeurs de structure
                    MYSQL_RES *result = NULL;
                    MYSQL_ROW row;

                    unsigned int i = 0;
                    unsigned int num_champs = 0;
                    int j =1;

                    //On met le jeu de résultat dans le pointeur result
                    result = mysql_use_result(&amp;mysql2);

                    //On récupère le nombre de champs
                    num_champs = mysql_num_fields(result);

                    //on stock les valeurs de la ligne choisie
                    while ((row = mysql_fetch_row(result)))
                    {

                        //On déclare un pointeur long non signé pour y stocker la taille des valeurs
                        unsigned long *lengths;

                        //On stocke ces tailles dans le pointeur
                        lengths = mysql_fetch_lengths(result);

                        //On affiche la position du joueur
                        printf(&quot;%ld- &quot;, j);

                        //On fait une boucle pour avoir la valeur de chaque champs
                       for(i = 1; i &lt; num_champs; i++)
                       {

                           //On ecrit toutes les valeurs
                           printf(&quot;%.*s &quot;, (int) lengths[i], row[i] ? row[i] : &quot;NULL&quot;);
                       }
                       printf(&quot;pts\n&quot;);

                       //On incrémente la position du joueur
                       j++;

                    }

                    //Libération du jeu de résultat
                    mysql_free_result(result);


                    //Fermeture de MySQL
                    mysql_close(&amp;mysql2);

                }
                else  //Sinon ...
                {
                    printf(&quot;Une erreur s'est produite lors de la connexion a la BDD!&quot;);
                }

            break;

        //Sinon
        default:
            printf(&quot;Le choix que vous avez entre n'est pas valide!&quot;);
            break;


    }




    return 0;
}</code></pre></div><p id="r-375017" data-claire-element-id="375017">Voilà, ce cours sur l'<em>API MySQL</em> est maintenant fini, j'espère qu'il a été assez clair et que vous avez bien tout compris.</p><p id="r-375018" data-claire-element-id="375018">Voici quelques idées d'amélioration du mini-jeu que l'on vient de faire, que l'on réaliser au niveau de MySQL :</p><ul id="r-375023" data-claire-element-id="375023"><li id="r-375020" data-claire-element-id="375020"><p id="r-375019" data-claire-element-id="375019">limiter le nombre de scores à afficher à 10 pour éviter que ça prenne trop de place ;</p></li><li id="r-375022" data-claire-element-id="375022"><p id="r-375021" data-claire-element-id="375021">prévenir le joueur que l'enregistrement de son score s'est bien déroulé.</p></li></ul><p id="r-375024" data-claire-element-id="375024">De plus, vous pouvez laisser libre cours à votre imagination. ;)</p><p id="r-375025" data-claire-element-id="375025">Nous pouvons donc nous quitter maintenant (j'en vois qui se réjouissent dans le fond ! :p ). Si vous voulez en apprendre encore plus sur cette bibliothèque, je vous conseille <a href="http://dev.mysql.com/doc/refman/5.0/fr/c-api-functions.html">cette page</a> : c'est la liste de toutes les fonctions de l'<em>API MySQL</em> avec leur description, en français !</p><p id="r-375026" data-claire-element-id="375026">Sur ce, au revoir tout le monde, et à bientôt pour de nouvelles aventures !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes">Utiliser l&#039;API MySQL dans vos programmes</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/preface-1">
Préface
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/installation-42">
Installation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/un-peu-de-theorie-7">
Un peu de théorie
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/la-pratique-11">
La pratique
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/utiliser-l-api-mysql-dans-vos-programmes/un-peu-de-theorie-7">
<span class="arrow"></span>
<span class="next">Un peu de théorie</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/utiliser-l-api-mysql-dans-vos-programmes.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 03:59:46 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/utiliser-l-api-mysql-dans-vos-programmes.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:46:46 GMT -->
</html>