<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/insertion-de-balises-dans-une-zone-de-texte.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 20:00:45 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/insertion-de-balises-dans-une-zone-de-texte.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:44:54 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Insertion de balises dans une zone de texte</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Insertion de balises dans une zone de texte</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Insertiondebalisesdansunezonedetexte">Insertion de balises dans une zone de texte</a><br/><a href="#MiseenplaceduHTML">Mise en place du HTML</a><br/><a href="#Lescriptd039insertion">Le script d&#039;insertion</a><br/><a href="#Lesinsertionsspciales">Les insertions spéciales</a><br/><a href="#Listesdroulantesetsmilies">Listes déroulantes et smilies</a><br/><a href="#Laprvisualisation">La prévisualisation</a><br/><a href="#Lavisualisationfinale">La visualisation finale</a><br/></div>
<a name="Insertiondebalisesdansunezonedetexte"></a><h2>Insertion de balises dans une zone de texte</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/mise-en-place-du-html">
<span class="next">Mise en place du HTML</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-351467" data-claire-element-id="351467">Dans ce tutoriel, je vais vous expliquer comment créer un système pour insérer des balises, un peu comme la zForm qu'utilise le Site du Zéro pour insérer des balises ZCode dans la zone de texte. La technique que je vais vous présenter peut bien évidemment être utilisée avec du BBCode, du WikiCode ou encore du XHTML. :)</p><p id="r-351468" data-claire-element-id="351468">Le tutoriel n'est pas très compliqué, mais je vous recommande chaudement d'avoir quelques bases en Javascript et en HTML.</p><aside id="r-351470" data-claire-element-id="351470" data-claire-semantic="information"><p id="r-351469" data-claire-element-id="351469"><a href="http://nayi.free.fr/tutoriels/zform/base.html">Voici un aperçu</a> de ce que vous saurez faire à la fin de ce mini-tuto :) . Le code Javascript est inclus dans le fichier HTML, pour plus de simplicité. <br/> J'utilise le ZCode pour illustrer l'insertion des balises, mais il est bien évidemment possible d'insérer des balises BBCode, du WikiCode ou n'importe quoi d'autre en fait ^^ .</p></aside>
</div><a name="MiseenplaceduHTML"></a><h2>Mise en place du HTML</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/le-script-d-insertion">
<span class="next">Le script d&#039;insertion</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-351471" data-claire-element-id="351471">Tout d'abord, nous allons créer la page HTML qui contiendra le système d'insertion. Voici le code simple :</p><pre id="r-351472" data-claire-element-id="351472"><code data-claire-semantic="html">&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;
    &lt;div&gt;
        &lt;p&gt;
            &lt;input type=&quot;button&quot; value=&quot;G&quot; /&gt;
            &lt;input type=&quot;button&quot; value=&quot;I&quot; /&gt;
            &lt;input type=&quot;button&quot; value=&quot;Lien&quot; /&gt;
            &lt;input type=&quot;button&quot; value=&quot;Image&quot; /&gt;
            &lt;input type=&quot;button&quot; value=&quot;Citation&quot; /&gt;
            &lt;select onchange=&quot;insertTag('&lt;' + this.options[this.selectedIndex].value + '&gt;', '&lt;/' + this.options[this.selectedIndex].value + '&gt;');&quot;&gt;
                &lt;option value=&quot;none&quot; class=&quot;selected&quot; selected=&quot;selected&quot;&gt;Taille&lt;/option&gt;
                &lt;option value=&quot;ttpetit&quot;&gt;Très très petit&lt;/option&gt;
                &lt;option value=&quot;tpetit&quot;&gt;Très petit&lt;/option&gt;
                &lt;option value=&quot;petit&quot;&gt;Petit&lt;/option&gt;
                &lt;option value=&quot;gros&quot;&gt;Gros&lt;/option&gt;
                &lt;option value=&quot;tgros&quot;&gt;Très gros&lt;/option&gt;
                &lt;option value=&quot;ttgros&quot;&gt;Très très gros&lt;/option&gt;
            &lt;/select&gt;
            &lt;img src=&quot;smile.gif&quot; alt=&quot;smiley&quot; /&gt;
            &lt;img src=&quot;unsure2.gif&quot; alt=&quot;smiley&quot; /&gt;
        &lt;/p&gt;
        &lt;p&gt;
            &lt;input name=&quot;previsualisation&quot; type=&quot;checkbox&quot; id=&quot;previsualisation&quot; value=&quot;previsualisation&quot; /&gt;
            &lt;label for=&quot;previsualisation&quot;&gt;Prévisualisation automatique&lt;/label&gt;
        &lt;/p&gt;
    &lt;/div&gt;

	&lt;textarea id=&quot;textarea&quot; cols=&quot;150&quot; rows=&quot;10&quot;&gt;&lt;/textarea&gt;
    
	&lt;div id=&quot;previewDiv&quot;&gt;&lt;/div&gt;

	&lt;p&gt;
        &lt;input type=&quot;button&quot; value=&quot;Visualiser&quot; onclick=&quot;view('textarea','viewDiv');&quot; /&gt;
    &lt;/p&gt;

    &lt;div id=&quot;viewDiv&quot;&gt;&lt;/div&gt;
&lt;/form&gt;</code></pre><p id="r-351473" data-claire-element-id="351473">Donc en gros, comme vous pouvez le voir, le code se compose de différents éléments <code>INPUT</code> qui feront office de boutons pour insérer les balises. Un élément <code>SELECT</code> est aussi présent pour insérer des balises avec des valeurs, comme dans la zForm. Les deux petites images sont des smilies, et réagiront de la même manière que les boutons d'insertion, mais pour insérer des smilies.</p><p id="r-351474" data-claire-element-id="351474">J'ai déjà mis une case à cocher pour activer ou non la prévisualisation. <br/><strong>previewDiv</strong> et <strong>viewDiv</strong> seront les deux éléments dans lesquels la prévisualisation et la visualisation seront affichées.</p><p id="r-351475" data-claire-element-id="351475">Maintenant que le HTML est en place, commençons le javascriptage.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte">Insertion de balises dans une zone de texte</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/mise-en-place-du-html">
Mise en place du HTML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/le-script-d-insertion">
Le script d&#039;insertion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/les-insertions-speciales">
Les insertions spéciales
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/listes-deroulantes-et-smilies">
Listes déroulantes et smilies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/la-previsualisation">
La prévisualisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/la-visualisation-finale">
La visualisation finale
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/le-script-d-insertion">
<span class="next">Le script d&#039;insertion</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lescriptd039insertion"></a><h2>Le script d&#039;insertion</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/mise-en-place-du-html">
<span class="arrow"></span>
<span class="next">Mise en place du HTML</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/les-insertions-speciales">
<span class="next">Les insertions spéciales</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-351477" data-claire-element-id="351477">Le script d'insertion n'est absolument pas compliqué (d'ailleurs, il n'y a rien de compliqué dans ce tuto ^^ ).<br/> Je vais créer la fonction insertTag() qui permettra d'insérer une balise autour de la sélection (ou juste le curseur, s'il n'y a pas de sélection).</p><pre id="r-351478" data-claire-element-id="351478"><code data-claire-semantic="javascript">function insertTag(startTag, endTag, textareaId, tagType) {
    var field  = document.getElementById(textareaId); // On récupère la zone de texte
    var scroll = field.scrollTop;                     // On met en mémoire la position du scroll
    field.focus(); // On remet le focus sur la zone de texte, suivant les navigateurs, on perd le focus en appelant la fonction. 
        
        
    // Reste du code ici...
        
}</code></pre><p id="r-351479" data-claire-element-id="351479">Les arguments <strong>startTag</strong> et <strong>endTag</strong> représentent respectivement la balise d'ouverture et la balise de fermeture. <strong>textareaId</strong> est l'<code>ID</code> de la zone de texte dans laquelle sera insérée la balise. <strong>tagType</strong> servira pour après pour les insertions de balises &quot;exotiques&quot;, comme les citations, les liens, enfin, pour tout ce qui demande un traitement autre que simplement ajouter une balise d'ouverture et une balise de fermeture. :)</p><p id="r-351480" data-claire-element-id="351480">Maintenant que la fonction principale est définie, on peut créer les appels au sein du code HTML, avec un événement <code>onClick</code> :</p><pre id="r-351481" data-claire-element-id="351481"><code data-claire-semantic="html">onclick=&quot;insertTag('&lt;balise&gt;','&lt;/balise&gt;','textarea');&quot;</code></pre><p id="r-351482" data-claire-element-id="351482">Donc, ajoutez cet événement sur les différents éléments cliquables, comme ceci :</p><pre id="r-351483" data-claire-element-id="351483"><code data-claire-semantic="html">&lt;input type=&quot;button&quot; value=&quot;G&quot; onclick=&quot;insertTag('&lt;gras&gt;','&lt;/gras&gt;','textarea');&quot; /&gt;</code></pre><p id="r-351484" data-claire-element-id="351484">Comme cela, quand l'utilisateur cliquera sur le bouton G (pour mettre en gras), les balises <code data-claire-semantic="xml">&lt;gras&gt; et &lt;/gras&gt;</code> seront insérées de part et d'autre du curseur, ou de la sélection.</p><h2 id="r-fonctionnement-de-la-fonction-d-insertion" data-claire-element-id="351486">Fonctionnement de la fonction d'insertion</h2><p id="r-351485" data-claire-element-id="351485">Dans un premier temps, il faut récupérer la portion de texte sélectionnée (la sélection). Ensuite, il faut introduire, de part et d'autre de la sélection les balises. Dans les deux cas, la manière de procéder diffère suivant les navigateurs. Internet Explorer ne gère pas du tout les sélections de la même façon que les autres navigateurs. Enfin, en réalité, IE gère bien la sélection, car il est possible de ne récupérer que la sélection directement, alors qu'avec les autres navigateurs, il faut faire un peu plus d'analyses. ^^</p><h2 id="r-recuperer-la-selection" data-claire-element-id="351500">Récupérer la sélection</h2><p id="r-351487" data-claire-element-id="351487">La première étape de la fonction insertTag() est de récupérer la sélection. Si l'utilisateur n'a rien sélectionné, la sélection est vide (ouais, logique ça ^^ ). <br/> Internet Explorer possède son propre système pour récupérer une sélection.</p><h3 id="r-internet-explorer-2" data-claire-element-id="351491">Internet Explorer</h3><p id="r-351488" data-claire-element-id="351488">Internet Explorer utilise l'objet <code>selection</code> pour manipuler les sélections de texte (pas seulement dans les zones de texte). Le principe est le suivant : on récupère la sélection (on crée un <strong>TextRange</strong>) avec la méthode <code>createRange()</code>, et on convertit cette sélection en texte pour pouvoir l'utiliser. La méthode <code>createRange()</code> récupère en fait le début et la fin de la sélection, c'est pour cela qu'il faut transformer, avec la propriété <code>text</code> :</p><pre id="r-351489" data-claire-element-id="351489"><code data-claire-semantic="javascript">var textRange = document.selection.createRange(); // On récupère sous forme de TextRange
var currentSelection = textRange.text;            // On convertit ce TextRange en chaine de caractères</code></pre><p id="r-351490" data-claire-element-id="351490">La variable <strong>currentSelection</strong> contient donc le texte de la sélection. :)</p><h3 id="r-les-autres-navigateurs" data-claire-element-id="351499">Les autres navigateurs</h3><p id="r-351492" data-claire-element-id="351492">La méthode n'est pas du tout la même que pour Internet Explorer. Ici, il faut récupérer la position du début de la sélection, ainsi que la fin, et récupérer &quot;manuellement&quot; la sélection courante. Pour trouver le début et la fin de la sélection, on doit utiliser respectivement les propriétés <code><strong>selectionStart</strong></code> et <code><strong>selectionEnd</strong></code> :</p><pre id="r-351493" data-claire-element-id="351493"><code data-claire-semantic="javascript">var startSelection   = field.value.substring(0, field.selectionStart);
var currentSelection = field.value.substring(field.selectionStart, field.selectionEnd);
var endSelection     = field.value.substring(field.selectionEnd);</code></pre><aside id="r-351495" data-claire-element-id="351495" data-claire-semantic="information"><p id="r-351494" data-claire-element-id="351494">Remarquez que <strong>field</strong> intervient ici, car les propriétés doivent s'appliquer sur l'objet considéré (le textarea), au contraire d'IE qui récupère une sélection n'importe où dans la page !</p></aside><div id="r-351497" data-claire-element-id="351497" data-claire-semantic="question"><p id="r-351496" data-claire-element-id="351496">Mais en fait, quelle était l'utilité de récupérer la sélection ?</p></div><p id="r-351498" data-claire-element-id="351498">Bah c'est assez simple en fait : ça permet de savoir où se trouve le curseur (le curseur est en fait une sélection dont le début est égal à la fin, elle est nulle). Et en connaissant ça, on va pouvoir injecter les balises avant et après... De plus, on pourra agir et analyser le texte sélectionné pour faire des insertions spéciales, comme des liens ou des citations.</p><h2 id="r-reintroduire-les-balises" data-claire-element-id="351532">Réintroduire les balises</h2><p id="r-351501" data-claire-element-id="351501">Ici encore, les méthodes pour les deux navigateurs sont différentes.</p><h3 id="r-internet-explorer-3" data-claire-element-id="351520">Internet Explorer</h3><p id="r-351502" data-claire-element-id="351502">On continue avec l'objet<code>selection</code> ! On va reprendre la variable <strong>textRange</strong> et modifier son contenu. La sélection dans le champ de texte est alors &quot;mise à jour&quot; :</p><pre id="r-351503" data-claire-element-id="351503"><code data-claire-semantic="javascript">textRange.text = startTag + currentSelection + endTag;</code></pre><p id="r-351504" data-claire-element-id="351504">En théorie, tout fonctionne. Mais en pratique, il y a quelque chose d'embêtant : le curseur d'écriture : il n'est plus dans le champ ! Ce qu'on veut arriver à faire, c'est resélectionner ce qui se trouve entre les balises fraîchement insérées. Ainsi par exemple, réinsérer une nouvelle paire de balises sans devoir resélectionner.</p><p id="r-351505" data-claire-element-id="351505">Internet Explorer offre 3 méthodes permettant d'agir sur une sélection : <code><a href="http://msdn2.microsoft.com/en-us/library/ms536616.aspx">move()</a></code><code><a href="http://msdn2.microsoft.com/en-us/library/ms536623.aspx">moveStart()</a></code> et <code><a href="http://msdn2.microsoft.com/en-us/library/ms536620.aspx">moveEnd()</a></code>.</p><ul id="r-351512" data-claire-element-id="351512"><li id="r-351507" data-claire-element-id="351507"><p id="r-351506" data-claire-element-id="351506">move() sert à déplacer la sélection complète. On ne va pas l'utiliser, mais elle peut être utile ;</p></li><li id="r-351509" data-claire-element-id="351509"><p id="r-351508" data-claire-element-id="351508">moveStart() sert à déplacer le début de la sélection ;</p></li><li id="r-351511" data-claire-element-id="351511"><p id="r-351510" data-claire-element-id="351510">moveEnd() sert donc à déplacer la fin de la sélection.</p></li></ul><p id="r-351513" data-claire-element-id="351513">Voici comment effectuer ces déplacements :</p><pre id="r-351514" data-claire-element-id="351514"><code data-claire-semantic="javascript">textRange.moveStart(&quot;character&quot;, -endTag.length - currentSelection.length);
textRange.moveEnd(&quot;character&quot;, -endTag.length);</code></pre><p id="r-351515" data-claire-element-id="351515">Les méthodes <code>move(</code><code>sUnit</code><code>,</code><code>iCount</code><code>)</code> prennent deux arguments : sUnit et iCount. sUnit est un peu spécial : c'est la manière de déplacer la sélection. En indiquant <strong>character</strong> on indique qu'on veut déplacer lettre par lettre. D'autres valeurs sont acceptées comme <strong>word</strong> ou <strong>sentence</strong>. iCount, c'est tout simplement la grandeur du déplacement.</p><p id="r-351516" data-claire-element-id="351516">Dans le cas du <code>moveStart()</code>, iCount vaudra la longueur de la balise de fin (endTag) plus la longueur de la sélection. C'est présenté sous la forme d'une soustraction car on recule le début de la sélection. :)</p><p id="r-351517" data-claire-element-id="351517">Dans le cas du <code>moveEnd()</code>, iCount vaudra juste la longueur de endTag, toujours en négatif.</p><p id="r-351518" data-claire-element-id="351518">Pour terminer, on applique la méthode <code>select()</code> à notre TextRange pour remplacer sélectionner.</p><pre id="r-351519" data-claire-element-id="351519"><code data-claire-semantic="javascript">textRange.select();</code></pre><h3 id="r-les-autres-navigateurs-1" data-claire-element-id="351531">Les autres navigateurs</h3><p id="r-351521" data-claire-element-id="351521">Le principe n'est toujours pas le même que pour IE. Ici, nous allons tout simplement remplacer le contenu de la zone de texte par le nouveau contenu comprenant les balises :</p><pre id="r-351522" data-claire-element-id="351522"><code data-claire-semantic="javascript">field.value = startSelection + startTag + currentSelection + endTag + endSelection;
field.focus(); // On remet le focus sur la zone de texte</code></pre><p id="r-351523" data-claire-element-id="351523">Comme avec Internet Explorer, on va redéfinir la sélection. On va utiliser la méthode <code><a href="http://developer.mozilla.org/en/docs/XUL:Method:setSelectionRange">setSelectionRange(Debut, Fin)</a></code> que l'on va appliquer sur <strong>field</strong>.</p><p id="r-351524" data-claire-element-id="351524">Cette méthode requiert deux arguments : la position de départ de la sélection, et la position de fin. Pas besoin de deux méthodes comme avec Internet Explorer. :)</p><ul id="r-351529" data-claire-element-id="351529"><li id="r-351526" data-claire-element-id="351526"><p id="r-351525" data-claire-element-id="351525">La position de départ se calcule en faisant la somme de tout ce qu'il y a avant : <strong>startSelection</strong> et <strong>startTag</strong>.</p></li><li id="r-351528" data-claire-element-id="351528"><p id="r-351527" data-claire-element-id="351527">Pour la position de fin, on ajoute simplement la longueur de <strong>currentSelection</strong>.</p></li></ul><pre id="r-351530" data-claire-element-id="351530"><code data-claire-semantic="javascript">field.setSelectionRange(startSelection.length + startTag.length, startSelection.length + startTag.length + currentSelection.length);</code></pre><h2 id="r-recapitulatif-du-script" data-claire-element-id="351542">Récapitulatif du script</h2><p id="r-351533" data-claire-element-id="351533">Pour détecter si le navigateur est Internet Explorer, il suffit théoriquement de vérifier s'il gère l'objet <code data-claire-semantic="javascript">document.selection</code>. J'ai bien dit théoriquement, car il y a un petit fauteur de trouble qui est... Opera.</p><p id="r-351534" data-claire-element-id="351534">Opera, non content de supporter le JavaScript, supporte aussi le <em>JScript</em>, qui est l'implémentation de Javascript dans Internet Explorer. Les exceptions que nous avons vues précédemment pour IE sont en fait du JScript, qui ajoutait à l'époque des fonctions en plus au Javascript.</p><p id="r-351535" data-claire-element-id="351535">Donc, comme Opera gère le JScript, si on fait un <code data-claire-semantic="javascript">document.selection</code>, la valeur retournée sera <code data-claire-semantic="javascript">true</code>.</p><div id="r-351537" data-claire-element-id="351537" data-claire-semantic="question"><p id="r-351536" data-claire-element-id="351536">Mais si Opera gère le JScript, où est le problème ?</p></div><p id="r-351538" data-claire-element-id="351538">Le problème est juste que Opera gère mal le JScript et plus particulièrement le repositionnement du curseur si il n'y a pas de sélection. C'est plutôt gênant. Il faut donc faire en sorte que seul IE utilise les portions de code en Jscript, et pour cela, il suffit de tester si le navigateur prend en charge ActiveX, que seul IE gère !</p><p id="r-351539" data-claire-element-id="351539">Voici donc ce que peut donner le script :</p><pre id="r-351540" data-claire-element-id="351540"><code data-claire-semantic="javascript">function insertTag(startTag, endTag, textareaId, tagType) {
    var field  = document.getElementById(textareaId); 
    var scroll = field.scrollTop;
    field.focus();
        
    if (window.ActiveXObject) { // C'est IE
        var textRange = document.selection.createRange();            
        var currentSelection = textRange.text;
                
        textRange.text = startTag + currentSelection + endTag;
        textRange.moveStart(&quot;character&quot;, -endTag.length - currentSelection.length);
        textRange.moveEnd(&quot;character&quot;, -endTag.length);
        textRange.select();     
    } else { // Ce n'est pas IE
        var startSelection   = field.value.substring(0, field.selectionStart);
        var currentSelection = field.value.substring(field.selectionStart, field.selectionEnd);
        var endSelection     = field.value.substring(field.selectionEnd);
                
        field.value = startSelection + startTag + currentSelection + endTag + endSelection;
        field.focus();
        field.setSelectionRange(startSelection.length + startTag.length, startSelection.length + startTag.length + currentSelection.length);
    } 

    field.scrollTop = scroll; // et on redéfinit le scroll.
}</code></pre><p id="r-351541" data-claire-element-id="351541">Et voilà. Le script principal est quasi fini. Il est temps maintenant de l'améliorer pour qu'il puisse gérer les différentes sortes d'insertions (comme les liens, les citations...).</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte">Insertion de balises dans une zone de texte</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/mise-en-place-du-html">
Mise en place du HTML
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/le-script-d-insertion">
Le script d&#039;insertion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/les-insertions-speciales">
Les insertions spéciales
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/listes-deroulantes-et-smilies">
Listes déroulantes et smilies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/la-previsualisation">
La prévisualisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/la-visualisation-finale">
La visualisation finale
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/mise-en-place-du-html">
<span class="arrow"></span>
<span class="next">Mise en place du HTML</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/les-insertions-speciales">
<span class="next">Les insertions spéciales</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesinsertionsspciales"></a><h2>Les insertions spéciales</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/le-script-d-insertion">
<span class="arrow"></span>
<span class="next">Le script d&#039;insertion</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/listes-deroulantes-et-smilies">
<span class="next">Listes déroulantes et smilies</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-351544" data-claire-element-id="351544">Ce que je qualifie d'insertions spéciales, ce sont les insertions qui, par exemple, demandent quelque chose à l'utilisateur comme pour l'insertion de liens ou encore de citations...</p><p id="r-351545" data-claire-element-id="351545">Le type d'insertion sera renseigné dans l'argument <strong>tagType</strong> de la fonction insertTag(). Pour garder un script simple, je vais procéder en 3 étapes :</p><ol id="r-351552" data-claire-element-id="351552"><li id="r-351547" data-claire-element-id="351547"><p id="r-351546" data-claire-element-id="351546">on récupère la sélection ;</p></li><li id="r-351549" data-claire-element-id="351549"><p id="r-351548" data-claire-element-id="351548">on regarde si le <strong>tagType</strong> est renseigné. S'il ne l'est pas, on ne fait rien ;</p></li><li id="r-351551" data-claire-element-id="351551"><p id="r-351550" data-claire-element-id="351550">on insère le tout.</p></li></ol><p id="r-351553" data-claire-element-id="351553">J'obtiens donc ce code :</p><pre id="r-351554" data-claire-element-id="351554"><code data-claire-semantic="javascript">function insertTag(startTag, endTag, textareaId, tagType) {
        var field  = document.getElementById(textareaId); 
        var scroll = field.scrollTop;
        field.focus();
        
        /* === Partie 1 : on récupère la sélection === */
        if (window.ActiveXObject) {
                var textRange = document.selection.createRange();            
                var currentSelection = textRange.text;
        } else {
                var startSelection   = field.value.substring(0, field.selectionStart);
                var currentSelection = field.value.substring(field.selectionStart, field.selectionEnd);
                var endSelection     = field.value.substring(field.selectionEnd);               
        }
        
        /* === Partie 2 : on analyse le tagType === */
        if (tagType) {
                switch (tagType) {
                        case &quot;lien&quot;:
                                // Si c'est un lien
                        break;
                        case &quot;citation&quot;:
                                // Si c'est une citation
                        break;
                }
        }
        
        /* === Partie 3 : on insère le tout === */
        if (window.ActiveXObject) {
                textRange.text = startTag + currentSelection + endTag;
                textRange.moveStart(&quot;character&quot;, -endTag.length - currentSelection.length);
                textRange.moveEnd(&quot;character&quot;, -endTag.length);
                textRange.select();     
        } else {
                field.value = startSelection + startTag + currentSelection + endTag + endSelection;
                field.focus();
                field.setSelectionRange(startSelection.length + startTag.length, startSelection.length + startTag.length + currentSelection.length);
        } 

        field.scrollTop = scroll;     
}</code></pre><p id="r-351555" data-claire-element-id="351555">J'utilise un <code>switch()</code>. Ce n'est pas vraiment utile dans mon cas, puisque je n'ai que deux choix et donc un simple <code>if()</code>...<code>else()</code> aurait suffi. Mais le <code>switch</code> sera plus simple à utiliser si vous faites plus de balises spéciales. ;) Je n'ai pas non plus mis de <strong>default</strong>. Ce n'est pas utile non plus, puisqu'il n'y a rien à faire si <strong>TagType</strong> ne correspond pas, et comme c'est vous qui le définissez, je suppose que vous saurez bien le définir. :p</p><div id="r-351557" data-claire-element-id="351557" data-claire-semantic="question"><p id="r-351556" data-claire-element-id="351556">Mais on aurait très bien pu analyser le TagType et puis récupérer la sélection, non ?</p></div><p id="r-351558" data-claire-element-id="351558">Non, car on va se servir du contenu de <strong>CurrentSelection</strong> pour déterminer quoi faire avec l'analyse du <strong>TagType</strong>. Regardez, voici la partie qui s'occupe des liens. En gros, on analyse le <strong>CurrentSelection</strong> et on réagit en fonction. Le code est commenté et est très simple, c'est surtout une question de logique :) :</p><pre id="r-351559" data-claire-element-id="351559"><code data-claire-semantic="javascript">case &quot;lien&quot;:
        endTag = &quot;&lt;/lien&gt;&quot;;
        if (currentSelection) { // Il y a une sélection
                if (currentSelection.indexOf(&quot;http://&quot;) == 0 || currentSelection.indexOf(&quot;https://&quot;) == 0 || currentSelection.indexOf(&quot;ftp://&quot;) == 0 || currentSelection.indexOf(&quot;www.&quot;) == 0) {
                        // La sélection semble être un lien. On demande alors le libellé
                        var label = prompt(&quot;Quel est le libellé du lien ?&quot;) || &quot;&quot;;
                        startTag = &quot;&lt;lien url=\&quot;&quot; + currentSelection + &quot;\&quot;&gt;&quot;;
                        currentSelection = label;
                } else {
                        // La sélection n'est pas un lien, donc c'est le libelle. On demande alors l'URL
                        var URL = prompt(&quot;Quelle est l'url ?&quot;);
                        startTag = &quot;&lt;lien url=\&quot;&quot; + URL + &quot;\&quot;&gt;&quot;;
                }
        } else { // Pas de sélection, donc on demande l'URL et le libelle
                var URL = prompt(&quot;Quelle est l'url ?&quot;) || &quot;&quot;;
                var label = prompt(&quot;Quel est le libellé du lien ?&quot;) || &quot;&quot;;
                startTag = &quot;&lt;lien url=\&quot;&quot; + URL + &quot;\&quot;&gt;&quot;;
                currentSelection = label;                     
        }
break;</code></pre><div id="r-351561" data-claire-element-id="351561" data-claire-semantic="question"><p id="r-351560" data-claire-element-id="351560">Mais pourquoi redéfinis-tu currentSelection ?</p></div><p id="r-351562" data-claire-element-id="351562">Bonne question. :) Il faut garder à l'esprit que l'insertion se fait avec trois choses : <strong>startTag</strong> + <strong>currentSelection</strong> + <strong>endTag</strong>. Dans le premier <code>if()</code>, je conclus que <strong>currentSelection</strong> est l'url. Or, l'url se place en attribut dans <strong>startTag</strong>, et à la place de <strong>currentSelection</strong>, c'est le libellé qui vient. :)</p><p id="r-351563" data-claire-element-id="351563">Voici, en total bonus, la partie pour analyser une citation :</p><pre id="r-351564" data-claire-element-id="351564"><code data-claire-semantic="javascript">case &quot;citation&quot;:
        endTag = &quot;&lt;/citation&gt;&quot;;
        if (currentSelection) { // Il y a une sélection
                if (currentSelection.length &gt; 30) { // La longueur de la sélection est plus grande que 30. C'est certainement la citation, le pseudo fait rarement 20 caractères
                        var auteur = prompt(&quot;Quel est l'auteur de la citation ?&quot;) || &quot;&quot;;
                        startTag = &quot;&lt;citation nom=\&quot;&quot; + auteur + &quot;\&quot;&gt;&quot;;
                } else { // On a l'Auteur, on demande la citation
                        var citation = prompt(&quot;Quelle est la citation ?&quot;) || &quot;&quot;;
                        startTag = &quot;&lt;citation nom=\&quot;&quot; + currentSelection + &quot;\&quot;&gt;&quot;;
                        currentSelection = citation;    
                }
        } else { // Pas de selection, donc on demande l'Auteur et la Citation
                var auteur = prompt(&quot;Quel est l'auteur de la citation ?&quot;) || &quot;&quot;;
                var citation = prompt(&quot;Quelle est la citation ?&quot;) || &quot;&quot;;
                startTag = &quot;&lt;citation nom=\&quot;&quot; + auteur + &quot;\&quot;&gt;&quot;;
                currentSelection = citation;    
        }
break;</code></pre>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte">Insertion de balises dans une zone de texte</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/mise-en-place-du-html">
Mise en place du HTML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/le-script-d-insertion">
Le script d&#039;insertion
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/les-insertions-speciales">
Les insertions spéciales
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/listes-deroulantes-et-smilies">
Listes déroulantes et smilies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/la-previsualisation">
La prévisualisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/la-visualisation-finale">
La visualisation finale
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/le-script-d-insertion">
<span class="arrow"></span>
<span class="next">Le script d&#039;insertion</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/listes-deroulantes-et-smilies">
<span class="next">Listes déroulantes et smilies</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Listesdroulantesetsmilies"></a><h2>Listes déroulantes et smilies</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/les-insertions-speciales">
<span class="arrow"></span>
<span class="next">Les insertions spéciales</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/la-previsualisation">
<span class="next">La prévisualisation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-les-listes-deroulantes-2" data-claire-element-id="351573">Les listes déroulantes</h2><p id="r-351566" data-claire-element-id="351566">Les listes déroulantes sont un bon moyen pour présenter des options sans prendre trop de place, et permettent généralement de rassembler plusieurs options ayant le même thème.</p><p id="r-351567" data-claire-element-id="351567">Mettre en place une liste déroulante est relativement simple. Il suffit d'appeler insertTag() via l'évènement <code>onChange</code>. Il convient, lors de l'appel de la fonction, de récupérer la valeur de l'option sélectionnée, comme ceci :</p><pre id="r-351568" data-claire-element-id="351568"><code data-claire-semantic="javascript">this.options[this.selectedIndex].value;</code></pre><p id="r-351569" data-claire-element-id="351569">Voilà donc ce que l'appel de la fonction insertTag() peut donner pour la liste déroulante permettant de choisir la taille :</p><pre id="r-351570" data-claire-element-id="351570"><code data-claire-semantic="javascript">insertTag('&lt;taille valeur=' + this.options[this.selectedIndex].value + '&gt;', '&lt;/taille&gt;', 'textarea');</code></pre><p id="r-351571" data-claire-element-id="351571">Et voici ce que ça donne une fois dans le code HTML :</p><pre id="r-351572" data-claire-element-id="351572"><code data-claire-semantic="html">&lt;select onchange=&quot;insertTag('&lt;taille valeur=&amp;quot;' + this.options[this.selectedIndex].value + '&amp;quot;&gt;', '&lt;/taille&gt;', 'textarea');&quot;&gt;
	&lt;option value=&quot;none&quot; class=&quot;selected&quot; selected=&quot;selected&quot;&gt;Taille&lt;/option&gt;
	&lt;option value=&quot;ttpetit&quot;&gt;Très très petit&lt;/option&gt;
	&lt;option value=&quot;tpetit&quot;&gt;Très petit&lt;/option&gt;
	&lt;option value=&quot;petit&quot;&gt;Petit&lt;/option&gt;
	&lt;option value=&quot;gros&quot;&gt;Gros&lt;/option&gt;
	&lt;option value=&quot;tgros&quot;&gt;Très gros&lt;/option&gt;
	&lt;option value=&quot;ttgros&quot;&gt;Très très gros&lt;/option&gt;

&lt;/select&gt;</code></pre><h2 id="r-les-smilies" data-claire-element-id="351578">Les smilies</h2><p id="r-351574" data-claire-element-id="351574">Bah ce n'est pas bien compliqué, il suffit de réutiliser notre fonction insertTag() pour lui faire insérer un smiley et non une balise. Mais attention, vous devez bien faire attention à échapper correctement les caractères qui doivent l'être !</p><pre id="r-351575" data-claire-element-id="351575"><code data-claire-semantic="javascript">insertTag(':D', '', 'textarea');</code></pre><p id="r-351576" data-claire-element-id="351576">Bien évidemment, utilisez l'évènement <code>onClick</code> des éléments <code>IMG</code> pour appeler la fonction :</p><pre id="r-351577" data-claire-element-id="351577"><code data-claire-semantic="html">&lt;img src=&quot;http://users.teledisnet.be/web/mde28256/smiley/smile.gif&quot; alt=&quot;:)&quot; onclick=&quot;insertTag(':)', '', 'textarea');&quot; /&gt;
&lt;img src=&quot;http://users.teledisnet.be/web/mde28256/smiley/unsure2.gif&quot; alt=&quot;:euh:&quot; onclick=&quot;insertTag(':euh:', '', 'textarea');&quot; /&gt;</code></pre>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte">Insertion de balises dans une zone de texte</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/mise-en-place-du-html">
Mise en place du HTML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/le-script-d-insertion">
Le script d&#039;insertion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/les-insertions-speciales">
Les insertions spéciales
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/listes-deroulantes-et-smilies">
Listes déroulantes et smilies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/la-previsualisation">
La prévisualisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/la-visualisation-finale">
La visualisation finale
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/les-insertions-speciales">
<span class="arrow"></span>
<span class="next">Les insertions spéciales</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/la-previsualisation">
<span class="next">La prévisualisation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Laprvisualisation"></a><h2>La prévisualisation</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/listes-deroulantes-et-smilies">
<span class="arrow"></span>
<span class="next">Listes déroulantes et smilies</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/la-visualisation-finale">
<span class="next">La visualisation finale</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-introduction-48" data-claire-element-id="351587">Introduction</h2><p id="r-351580" data-claire-element-id="351580">Faire une prévisualisation en temps réel est assez facile. Il suffit de détecter quand l'utilisateur entre un caractère dans la zone de texte, puis de récupérer le contenu, convertir les balises à coup de regex et afficher le résultat dans un <code>DIV</code>.</p><p id="r-351581" data-claire-element-id="351581">Tout bon script de preview (<em>prévisualisation</em>) qui se respecte se doit de demander à l'utilisateur s'il souhaite activer cette prévisualisation. On le fera à l'aide d'une case à cocher, décochée par défaut. J'insiste sur le <em>décochée</em>. Personnellement, je déteste ce genre de truc, et je préfère que ce soit désactivé pas défaut. :)</p><h3 id="r-detecter-la-frappe-dans-le-textarea" data-claire-element-id="351586">Détecter la frappe dans le textarea</h3><p id="r-351582" data-claire-element-id="351582">Pour cela on va tout simplement utiliser les événements <code>onKeyUp</code> et <code>onSelect</code> dont dispose l'élément <strong>textarea</strong>. On leur associera la fonction preview(), laquelle comportera un argument <strong>textareaId</strong> représentant le <strong>textarea</strong> et un argument <strong>previewDiv</strong> qui contiendra l'<code>ID</code> de l'élément dans lequel on inscrira le texte prévisualisé. On utilisera <code>this</code> pour définir <strong>textareaID</strong>, ça nous permettra de ne pas s'embêter avec un <code>getElementById()</code> pour récupérer le contenu du <strong>textarea</strong> :) :</p><pre id="r-351583" data-claire-element-id="351583"><code data-claire-semantic="html">&lt;textarea onkeyup=&quot;preview(this, 'previewDiv');&quot; onselect=&quot;preview(this, 'previewDiv');&quot; id=&quot;textarea&quot; cols=&quot;150&quot; rows=&quot;10&quot;&gt;&lt;/textarea&gt;</code></pre><p id="r-351584" data-claire-element-id="351584">Et voici la déclaration de la fonction :</p><pre id="r-351585" data-claire-element-id="351585"><code data-claire-semantic="javascript">function preview(textareaId, previewDiv) {
    var field = textareaId.value; // Le contenu du textarea est dans la variable field
}</code></pre><h2 id="r-a-coups-de-regex" data-claire-element-id="351595">À coups de regex</h2><p id="r-351588" data-claire-element-id="351588">Pour convertir les balises zCode en balises HTML affichables dans le previewDiv, on va utiliser la méthode <strong>replace()</strong> qui contiendra une regex.</p><p id="r-351589" data-claire-element-id="351589">Voici toute la fonction de prévisualisation. Je ne donne que les regex qui servent à convertir ce que les boutons peuvent insérer (eh oh, j'allais pas tout écrire quand même ^^ ) :</p><pre id="r-351590" data-claire-element-id="351590"><code data-claire-semantic="javascript">function preview(textareaId, previewDiv) {
	var field = textareaId.value;
	if (document.getElementById('previsualisation').checked &amp;&amp; field) {
		
		var smiliesName = new Array(':magicien:', ':colere:', ':diable:', ':ange:', ':ninja:', '&amp;gt;_&amp;lt;', ':pirate:', ':zorro:', ':honte:', ':soleil:', ':\'\\(', ':waw:', ':\\)', ':D', ';\\)', ':p', ':lol:', ':euh:', ':\\(', ':o', ':colere2:', 'o_O', '\\^\\^', ':\\-°');
		var smiliesUrl  = new Array('magicien.png', 'angry.gif', 'diable.png', 'ange.png', 'ninja.png', 'pinch.png', 'pirate.png', 'zorro.png', 'rouge.png', 'soleil.png', 'pleure.png', 'waw.png', 'smile.png', 'heureux.png', 'clin.png', 'langue.png', 'rire.gif', 'unsure.gif', 'triste.png', 'huh.png', 'mechant.png', 'blink.gif', 'hihi.png', 'siffle.png');
		var smiliesPath = &quot;http://www.siteduzero.com/Templates/images/smilies/&quot;;
	
		field = field.replace(/&amp;/g, '&amp;amp;');
		field = field.replace(/&lt;/g, '&amp;lt;').replace(/&gt;/g, '&amp;gt;');
		field = field.replace(/\n/g, '&lt;br /&gt;').replace(/\t/g, '&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;');
		
		field = field.replace(/&amp;lt;gras&amp;gt;([\s\S]*?)&amp;lt;\/gras&amp;gt;/g, '&lt;strong&gt;$1&lt;/strong&gt;');
		field = field.replace(/&amp;lt;italique&amp;gt;([\s\S]*?)&amp;lt;\/italique&amp;gt;/g, '&lt;em&gt;$1&lt;/em&gt;');
		field = field.replace(/&amp;lt;lien&amp;gt;([\s\S]*?)&amp;lt;\/lien&amp;gt;/g, '&lt;a href=&quot;$1&quot;&gt;$1&lt;/a&gt;');
		field = field.replace(/&amp;lt;lien url=&quot;([\s\S]*?)&quot;&amp;gt;([\s\S]*?)&amp;lt;\/lien&amp;gt;/g, '&lt;a href=&quot;$1&quot; title=&quot;$2&quot;&gt;$2&lt;/a&gt;');
		field = field.replace(/&amp;lt;image&amp;gt;([\s\S]*?)&amp;lt;\/image&amp;gt;/g, '&lt;img src=&quot;$1&quot; alt=&quot;Image&quot; /&gt;');
		field = field.replace(/&amp;lt;citation nom=\&quot;(.*?)\&quot;&amp;gt;([\s\S]*?)&amp;lt;\/citation&amp;gt;/g, '&lt;br /&gt;&lt;span class=&quot;citation&quot;&gt;Citation : $1&lt;/span&gt;&lt;div class=&quot;citation2&quot;&gt;$2&lt;/div&gt;');
		field = field.replace(/&amp;lt;citation lien=\&quot;(.*?)\&quot;&amp;gt;([\s\S]*?)&amp;lt;\/citation&amp;gt;/g, '&lt;br /&gt;&lt;span class=&quot;citation&quot;&gt;&lt;a href=&quot;$1&quot;&gt;Citation&lt;/a&gt;&lt;/span&gt;&lt;div class=&quot;citation2&quot;&gt;$2&lt;/div&gt;');
		field = field.replace(/&amp;lt;citation nom=\&quot;(.*?)\&quot; lien=\&quot;(.*?)\&quot;&amp;gt;([\s\S]*?)&amp;lt;\/citation&amp;gt;/g, '&lt;br /&gt;&lt;span class=&quot;citation&quot;&gt;&lt;a href=&quot;$2&quot;&gt;Citation : $1&lt;/a&gt;&lt;/span&gt;&lt;div class=&quot;citation2&quot;&gt;$3&lt;/div&gt;');
		field = field.replace(/&amp;lt;citation lien=\&quot;(.*?)\&quot; nom=\&quot;(.*?)\&quot;&amp;gt;([\s\S]*?)&amp;lt;\/citation&amp;gt;/g, '&lt;br /&gt;&lt;span class=&quot;citation&quot;&gt;&lt;a href=&quot;$1&quot;&gt;Citation : $2&lt;/a&gt;&lt;/span&gt;&lt;div class=&quot;citation2&quot;&gt;$3&lt;/div&gt;');
		field = field.replace(/&amp;lt;citation&amp;gt;([\s\S]*?)&amp;lt;\/citation&amp;gt;/g, '&lt;br /&gt;&lt;span class=&quot;citation&quot;&gt;Citation&lt;/span&gt;&lt;div class=&quot;citation2&quot;&gt;$1&lt;/div&gt;');
		field = field.replace(/&amp;lt;taille valeur=\&quot;(.*?)\&quot;&amp;gt;([\s\S]*?)&amp;lt;\/taille&amp;gt;/g, '&lt;span class=&quot;$1&quot;&gt;$2&lt;/span&gt;');
		
		for (var i=0, c=smiliesName.length; i&lt;c; i++) {
			field = field.replace(new RegExp(&quot; &quot; + smiliesName[i] + &quot; &quot;, &quot;g&quot;), &quot;&amp;nbsp;&lt;img src=\&quot;&quot; + smiliesPath + smiliesUrl[i] + &quot;\&quot; alt=\&quot;&quot; + smiliesUrl[i] + &quot;\&quot; /&gt;&amp;nbsp;&quot;);
		}
		
		document.getElementById(previewDiv).innerHTML = field;
	}
}</code></pre><p id="r-351591" data-claire-element-id="351591">Remarquez, je vérifie avec l'<strong>if()</strong> si la case à cocher est cochée, et s'il y a quelque chose dans le textarea.</p><p id="r-351592" data-claire-element-id="351592">La conversion des smilies est un peu particulière. Un array, smiliesName, contient les noms des smilies. Un autre, smiliesUrl, contient le nom des images (qui correspond bien sûr au nom des smilies du premier array). J'utilise ensuite une boucle <code>for</code>, qui va appliquer une regex pour chaque élément de l'array. Comme j'ai besoin de spécifier une variable au sein de l'expression régulière, je crée cette dernière de façon explicite, avec <code data-claire-semantic="javascript">new Regexp </code>. :)</p><p id="r-351593" data-claire-element-id="351593">Quand toutes les conversions sont faites, on écrit la valeur de <strong>field</strong> dans le div qui sert à la prévisualisation à l'aide d'<code>innerHTML</code>.</p><p id="r-351594" data-claire-element-id="351594">Les regex ici sont relativement simples. Mon but n'est pas de vous apprendre à faire des regex ni même à analyser des portions de texte pour faire un système de prévisualisation qui gère des conversions plus avancées (comme plus de 3 attributs...).</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte">Insertion de balises dans une zone de texte</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/mise-en-place-du-html">
Mise en place du HTML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/le-script-d-insertion">
Le script d&#039;insertion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/les-insertions-speciales">
Les insertions spéciales
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/listes-deroulantes-et-smilies">
Listes déroulantes et smilies
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/la-previsualisation">
La prévisualisation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/la-visualisation-finale">
La visualisation finale
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/listes-deroulantes-et-smilies">
<span class="arrow"></span>
<span class="next">Listes déroulantes et smilies</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/la-visualisation-finale">
<span class="next">La visualisation finale</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lavisualisationfinale"></a><h2>La visualisation finale</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/la-previsualisation">
<span class="arrow"></span>
<span class="next">La prévisualisation</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-fonctionnement-28" data-claire-element-id="351603">Fonctionnement</h2><p id="r-351597" data-claire-element-id="351597">La création d'une visualisation finale se fait avec AJAX, en exploitant l'objet <code>XMLHttpRequest</code>.</p><p id="r-351598" data-claire-element-id="351598">XMLHttpRequest va nous permettre d'envoyer le contenu de la zone de texte vers une page contenant un script PHP. Ce script va convertir le contenu en HTML un peu comme le faisait javascript pour la prévisualisation. Ce contenu est renvoyé par <code>XMLHttpRequest</code> et est affiché dans un <code>DIV</code>. L'intérêt, c'est que tout se fait sans devoir recharger la page. :)</p><div id="r-351600" data-claire-element-id="351600" data-claire-semantic="question"><p id="r-351599" data-claire-element-id="351599">Mais, quelle est donc l'utilité de ce système ?</p></div><p id="r-351601" data-claire-element-id="351601">Franchement, pour visualiser des balises <code>GRAS</code> et des <code>LIEN</code>, javascript suffit amplement. Le traitement par PHP peut être plus pratique pour par exemple colorer le code, trouver des erreurs d'imbrication de balises...</p><p id="r-351602" data-claire-element-id="351602">Par exemple, sur le Site du Zér0, la visualisation finale (via XMLHttpRequest et PHP) permet de visualiser le code coloré, les tableaux, d'avoir une gestion des erreurs, et le convertisseur est plus performant que le convertisseur javascript (car c'est un parseur XML qui est utilisé).</p><h2 id="r-le-script-javascript" data-claire-element-id="351608">Le script javascript</h2><aside id="r-351605" data-claire-element-id="351605" data-claire-semantic="information"><p id="r-351604" data-claire-element-id="351604">L'utilisation d'<code>XMLHttpRequest</code> n'est pas l'objet de ce tuto, je ne vais donc pas l'expliquer en profondeur. Mais ne vous inquiétez pas, j'ai aussi rédigé <a href="http://www.siteduzero.com/tuto-3-6936-0-ajax-et-l-echange-de-donnees-en-javascript.html">un big-tuto sur les techniques AJAX</a>, dont un très gros <a href="http://www.siteduzero.com/tutoriel-3-100294-l-objet-xmlhttprequest.html">chapitre sur <code>XMLHttpRequest</code></a>, dans lequel tout est expliqué en détail. D'ailleurs, je reprends le même script d'instanciation (parce que c'est le meilleur ^^ ).</p></aside><p id="r-351606" data-claire-element-id="351606">Voici donc la fonction d'instanciation que j'utilise. Elle sert à définir un objet <code>XMLHttpRequest</code>, suivant les différents navigateurs :</p><pre id="r-351607" data-claire-element-id="351607"><code data-claire-semantic="javascript">function getXMLHttpRequest() {
	var xhr = null;
	
	if (window.XMLHttpRequest || window.ActiveXObject) {
		if (window.ActiveXObject) {
			try {
				xhr = new ActiveXObject(&quot;Msxml2.XMLHTTP&quot;);
			} catch(e) {
				xhr = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);
			}
		} else {
			xhr = new XMLHttpRequest();
		}
	} else {
		alert(&quot;Votre navigateur ne supporte pas l'objet XMLHTTPRequest...&quot;);
		return null;
	}
	
	return xhr;
}</code></pre><h2 id="r-mise-en-place-15" data-claire-element-id="351615">Mise en place</h2><p id="r-351609" data-claire-element-id="351609">Commencez par mettre un événement <code>onClick</code> sur le bouton servant à visualiser, comme ceci :</p><pre id="r-351610" data-claire-element-id="351610"><code data-claire-semantic="html">&lt;input type=&quot;button&quot; value=&quot;Visualiser&quot; onclick=&quot;view('textarea', 'viewDiv');&quot; /&gt;</code></pre><p id="r-351611" data-claire-element-id="351611">Maintenant, il s'agit de créer la fonction pour traiter l'envoi et la réception des données du textarea :</p><pre id="r-351612" data-claire-element-id="351612"><code data-claire-semantic="javascript">function view(textareaId, viewDiv){
	var content = encodeURIComponent(document.getElementById(textareaId).value);
	var xhr = getXMLHttpRequest();
	
	if (xhr &amp;&amp; xhr.readyState != 0) {
		xhr.abort();
		delete xhr;
	}
	
	xhr.onreadystatechange = function() {
		if (xhr.readyState == 4 &amp;&amp; xhr.status == 200){
			document.getElementById(viewDiv).innerHTML = xhr.responseText;
		} else if (xhr.readyState == 3){
			document.getElementById(viewDiv).innerHTML = &quot;&lt;div style=\&quot;text-align: center;\&quot;&gt;Chargement en cours...&lt;/div&gt;&quot;;
		}
	}
	
	xhr.open(&quot;POST&quot;, &quot;view.php&quot;, true);
	xhr.setRequestHeader(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;);
	xhr.send(&quot;string=&quot; + content);
}</code></pre><p id="r-351613" data-claire-element-id="351613">La fonction view(), tout comme la fonction preview() reçoit deux arguments : <strong>textareaId</strong> qui contient l'<code>ID</code> de la zone de texte, et <strong>viewDiv</strong> qui contient l'<code>ID</code> du <code>DIV</code> dans lequel le code visualisé sera inséré.</p><p id="r-351614" data-claire-element-id="351614">La fonction <strong>view()</strong> se charge donc de récupérer le contenu de la zone de texte et de l'envoyer (en l'ayant préalablement encodé, avec <code>encodeURIComponent</code>) à la page <strong>view.php</strong> qui contient le script PHP nécessaire pour convertir le code afin qu'il soit visualisé. Le code converti est renvoyé, et réceptionné puis est affiché dans le <strong>viewDiv</strong> au moyen d'un <code>innerHTML</code>.</p><h2 id="r-la-page-view-php" data-claire-element-id="351626">La page view.php</h2><p id="r-351616" data-claire-element-id="351616">La page <strong>view.php</strong> contient en fait un script simple, quasi identique à celui de la fonction preview(). Pour les besoins du tuto, je n'allais pas utiliser un parseur XML bien compliqué. L'important ici c'est que vous compreniez. Cependant, si vous voulez utiliser un parseur XML, allez voir <a href="http://www.siteduzero.com/tuto-3-16497-1-parser-du-xml---l-exemple-du-zcode.html">ce tuto</a>.</p><pre id="r-351617" data-claire-element-id="351617"><code data-claire-semantic="html+php">&lt;?php 

function parseZCode($content) {
	// Parsage des balises
	$zcode = array(  
		'`&amp;lt;italique&amp;gt;(.+)&amp;lt;/italique&amp;gt;`isU',  
		'`&amp;lt;gras&amp;gt;(.+)&amp;lt;/gras&amp;gt;`isU',
		'`&amp;lt;barre&amp;gt;(.+)&amp;lt;/barre&amp;gt;`isU',
		'`&amp;lt;lien&amp;gt;(.+)&amp;lt;/lien&amp;gt;`isU',
		'`&amp;lt;lien url=&amp;quot;(.+)&amp;quot;&amp;gt;(.+)&amp;lt;/lien&amp;gt;`isU',
		'`&amp;lt;image&amp;gt;(.+)&amp;lt;/image&amp;gt;`isU',
		'`&amp;lt;citation&amp;gt;(.+)&amp;lt;/citation&amp;gt;`isU',
		'`&amp;lt;citation nom=&amp;quot;(.+)&amp;quot;&amp;gt;(.+)&amp;lt;/citation&amp;gt;`isU',
		'`&amp;lt;citation lien=&amp;quot;(.+)&amp;quot;&amp;gt;(.+)&amp;lt;/citation&amp;gt;`isU',
		'`&amp;lt;taille valeur=&amp;quot;(.+)&amp;quot;&amp;gt;(.+)&amp;lt;/taille&amp;gt;`isU'
	);  
	
	$html = array(  
		'&lt;em&gt;$1&lt;/em&gt;',  
		'&lt;strong&gt;$1&lt;/strong&gt;',
		'&lt;del&gt;$1&lt;/del&gt;', 
		'&lt;a href=&quot;$1&quot;&gt;$1&lt;/a&gt;',
		'&lt;a href=&quot;$1&quot;&gt;$2&lt;/a&gt;',
		'&lt;img src=&quot;$1&quot; alt=&quot;Image utilisateur&quot; /&gt;',
		'&lt;br /&gt;&lt;span class=&quot;citation&quot;&gt;Citation&lt;/span&gt;&lt;div class=&quot;citation2&quot;&gt;$1&lt;/div&gt;',
		'&lt;br /&gt;&lt;span class=&quot;citation&quot;&gt;Citation : $1&lt;/span&gt;&lt;div class=&quot;citation2&quot;&gt;$2&lt;/div&gt;',
		'&lt;br /&gt;&lt;span class=&quot;citation&quot;&gt;&lt;a href=&quot;$1&quot;&gt;Citation&lt;/a&gt;&lt;/span&gt;&lt;div class=&quot;citation2&quot;&gt;$2&lt;/div&gt;',
		'&lt;span class=&quot;$1&quot;&gt;$2&lt;/span&gt;'
	); 
	
	$content = htmlspecialchars($content, ENT_QUOTES);
	$content = preg_replace($zcode, $html, $content);
	
	// parsage des smilies
	$smiliesName = array(':magicien:', ':colere:', ':diable:', ':ange:', ':ninja:', '&amp;gt;_&amp;lt;', ':pirate:', ':zorro:', ':honte:', ':soleil:', ':\'\\(', ':waw:', ':\\)', ':D', ';\\)', ':p', ':lol:', ':euh:', ':\\(', ':o', ':colere2:', 'o_O', '\\^\\^', ':\\-°');
	$smiliesUrl  = array('magicien.png', 'angry.gif', 'diable.png', 'ange.png', 'ninja.png', 'pinch.png', 'pirate.png', 'zorro.png', 'rouge.png', 'soleil.png', 'pleure.png', 'waw.png', 'smile.png', 'heureux.png', 'clin.png', 'langue.png', 'rire.gif', 'unsure.gif', 'triste.png', 'huh.png', 'mechant.png', 'blink.gif', 'hihi.png', 'siffle.png');
	$smiliesPath = &quot;http://www.siteduzero.com/Templates/images/smilies/&quot;;
	
	for ($i = 0, $c = count($smiliesName); $i &lt; $c; $i++) {
		$content = preg_replace('`' . $smiliesName[$i] . '`isU', '&lt;img src=&quot;' . $smiliesPath . $smiliesUrl[$i] . '&quot; alt=&quot;smiley&quot; /&gt;', $content);
	}
	
	// Rtours à la ligne
	$content = preg_replace('`\n`isU', '&lt;br /&gt;', $content); 
	
	return $content;

}

if (isset($_POST[&quot;string&quot;])) {
	$content = $_POST[&quot;string&quot;];
	
	if (get_magic_quotes_gpc()) {
		$content = stripslashes($content);
	}

	echo parseZCode($content); // Ecriture du contenu parsé. 
}
?&gt;</code></pre><p id="r-351618" data-claire-element-id="351618">Comme vous le voyez, c'est un bête script de conversion avec des regex. Pour plus de simplicité, c'est organisé en deux tableaux, et j'ai mis tout ça dans une fonction :) . Le contenu de la zone de texte est récupéré dans la variable <code data-claire-semantic="html+php">$_POST[&quot;string&quot;]</code>, exactement comme si on récupérait le contenu d'un formulaire via <code>POST</code>. <br/> Le contenu est converti, et est écrit directement dans la page. C'est ce qui est écrit qui va être récupéré par le code javascript et affiché dans la zone de visualisation. :)</p><aside id="r-351620" data-claire-element-id="351620" data-claire-semantic="warning"><p id="r-351619" data-claire-element-id="351619">Au risque de me répéter, il ne faut pas utiliser ce genre de script pour convertir les balises. Le ZCode est un langage de type XML, donc il vaut mieux utiliser <a href="http://www.siteduzero.com/tuto-3-16497-1-parser-du-xml---l-exemple-du-zcode.html">un parseur XML</a> (un script qui parcourt le XML et qui réplique le contenu au fur et à mesure en convertissant les balises), c'est plus rapide et surtout plus sécurisé. Par contre, si vous utilisez du BBCode ou n'importe quoi d'autre qui n'est pas du XML, il faudra bien passer par des regex.</p></aside><p id="r-351621" data-claire-element-id="351621">Et voilà, à vos codes, et faites de belles zForms</p><figure id="r-351623" data-claire-element-id="351624"><img id="r-351622" data-claire-element-id="351622" src="medias/uploads.siteduzero.com_files_358001_359000_358627.gif" alt="Image utilisateur"/></figure><p id="r-351625" data-claire-element-id="351625">.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte">Insertion de balises dans une zone de texte</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/mise-en-place-du-html">
Mise en place du HTML
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/le-script-d-insertion">
Le script d&#039;insertion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/les-insertions-speciales">
Les insertions spéciales
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/listes-deroulantes-et-smilies">
Listes déroulantes et smilies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/la-previsualisation">
La prévisualisation
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/la-visualisation-finale">
La visualisation finale
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/insertion-de-balises-dans-une-zone-de-texte/la-previsualisation">
<span class="arrow"></span>
<span class="next">La prévisualisation</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/insertion-de-balises-dans-une-zone-de-texte.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 20:00:46 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/insertion-de-balises-dans-une-zone-de-texte.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:44:54 GMT -->
</html>