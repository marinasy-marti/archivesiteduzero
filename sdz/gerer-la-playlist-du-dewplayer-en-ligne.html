<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/gerer-la-playlist-du-dewplayer-en-ligne.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 08:29:19 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/gerer-la-playlist-du-dewplayer-en-ligne.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:31:31 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Gérer la playlist du dewplayer en ligne</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Gérer la playlist du dewplayer en ligne</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Grerlaplaylistdudewplayerenligne">Gérer la playlist du dewplayer en ligne</a><br/><a href="#Leprincipedefonctionnement">Le principe de fonctionnement</a><br/><a href="#Lapartieadministration">La partie administration</a><br/><a href="#Lelecteur">Le lecteur</a><br/><a href="#LeJavaScript">Le JavaScript</a><br/></div>
<a name="Grerlaplaylistdudewplayerenligne"></a><h2>Gérer la playlist du dewplayer en ligne</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-principe-de-fonctionnement-2">
<span class="next">Le principe de fonctionnement</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-338251" data-claire-element-id="338251">Salut les Zér0s.</p><p id="r-338252" data-claire-element-id="338252">Il existe sur le net de nombreux players mp3. Il y en a un que j'affectionne tout particulièrement car il est léger et simple d'utilisation, j'ai nommé <a href="http://www.alsacreations.fr/dewplayer">le dewplayer</a> (sélectionnez la version <strong><em>multi</em></strong>). Le seul défaut que je lui connaisse est qu'on ne peut pas modifier facilement la playlist en ligne. Il faut forcément entrer dans le code de la page, ce qui n'est pas génial à la longue. Et puis un jour, je suis tombé sur <a href="http://www.allhtml.com/articles/detail/842">cet article, sur le site all html</a>. Le souci est que la solution donnée ne fonctionne pas très efficacement. J'ai donc pris la liberté de modifier le code pour pouvoir gérer la playlist directement depuis la partie administration d'un site.</p><p id="r-338253" data-claire-element-id="338253">Pour suivre ce tuto, il vous faudra connaître le <a href="http://www.siteduzero.com/tuto-3-6-0-apprenez-a-creer-votre-site-web.html">XHTML</a>, le <a href="http://www.siteduzero.com/tuto-3-4-0-un-site-dynamique-avec-php.html">PHP et le SQL</a> et avoir des notions de<a href="http://www.siteduzero.com/tuto-3-2329-0-tout-sur-le-javascript.html"> javascript</a> (ou <a href="http://www.siteduzero.com/tuto-3-2060-0-apprenez-le-javascript.html">ici)</a>.</p>
</div><a name="Leprincipedefonctionnement"></a><h2>Le principe de fonctionnement</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/la-partie-administration">
<span class="next">La partie administration</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-338254" data-claire-element-id="338254">On va distinguer plusieurs parties :</p><ul id="r-338261" data-claire-element-id="338261"><li id="r-338256" data-claire-element-id="338256"><p id="r-338255" data-claire-element-id="338255">la partie administration avec une page pour importer les morceaux et une page pour les gérer,</p></li><li id="r-338258" data-claire-element-id="338258"><p id="r-338257" data-claire-element-id="338257">une page pour le lecteur,</p></li><li id="r-338260" data-claire-element-id="338260"><p id="r-338259" data-claire-element-id="338259">et un contrôle par JavaScript.</p></li></ul><p id="r-338262" data-claire-element-id="338262">Les morceaux seront importés via la page d'import et leur titre sera enregistré dans une base de données avec un identifiant différent pour chaque morceau.<br/> La page de gestion nous permettra de déplacer les morceaux dans la playlist, de leur attribuer une catégorie ou de les supprimer de la base (je n'ai pas codé de système permettant d'effacer le fichier mp3 sur le serveur, mais ceux qui le veulent pourront aisément le faire).<br/> La page pour le lecteur affichera le lecteur et la playlist en dessous. Il suffira de cliquer sur le titre d'un morceau pour changer celui en cours de lecture. Le nom du morceau en cours s'affichera entre le lecteur et la playlist.<br/> Petit défaut : si on utilise les flèches du lecteur, le nom du morceau en cours ne change pas :-° . Mais il suffit d'ouvrir une fenêtre de taille réduite et de faire en sorte que les flèches ne puissent pas être vues.<br/> Personnellement, je préfère dédier une page au player car cela permet de pouvoir naviguer tout en ayant de la musique (si cette page est ouverte dans une autre fenêtre grâce au JavaScript).</p><p id="r-338263" data-claire-element-id="338263">Enfin, le JavaScript est là aussi pour changer le morceau en cours de lecture sans recharger la page.</p><p id="r-338264" data-claire-element-id="338264">Vous pouvez voir le player en fonctionnement en visitant <a href="http://www.compagniedelamoisson.com/">cette page</a> (aucun commentaire quant aux morceaux. Merci. :p ).</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne">Gérer la playlist du dewplayer en ligne</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-principe-de-fonctionnement-2">
Le principe de fonctionnement
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/la-partie-administration">
La partie administration
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-lecteur-1">
Le lecteur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-javascript">
Le JavaScript
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/la-partie-administration">
<span class="next">La partie administration</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lapartieadministration"></a><h2>La partie administration</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-principe-de-fonctionnement-2">
<span class="arrow"></span>
<span class="next">Le principe de fonctionnement</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-lecteur-1">
<span class="next">Le lecteur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-la-base-de-donnees-7" data-claire-element-id="338268">La base de données</h2><p id="r-338266" data-claire-element-id="338266">Je ne vais pas m'étendre sur la base de données qui est très simple. Elle ne contient que 3 champs : l'identifiant, la catégorie et le titre du morceau.</p><pre id="r-338267" data-claire-element-id="338267"><code data-claire-semantic="sql">CREATE TABLE `sons` (
  `id_son` int(11) NOT NULL AUTO_INCREMENT,
  `categorie` tinytext NOT NULL,
  `fichier_son` text NOT NULL,
  KEY `id_son` (`id_son`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1 AUTO_INCREMENT=1;</code></pre><h2 id="r-la-page-d-importation-des-morceaux" data-claire-element-id="338297">La page d'importation des morceaux</h2><p id="r-338269" data-claire-element-id="338269">Je vous donne le code que je vais commenter au fur et à mesure. Pour simplifier et éviter des redondances dans le code, j'ai placé l'entête de ma page (partie depuis le Doctype jusqu'à la balise &lt;body&gt; incluse) dans une fonction appelée haut(). Cette fonction sera appelée sur toutes nos pages. N'oubliez donc pas de l'inclure avant de l'appeler.</p><p id="r-338270" data-claire-element-id="338270">Je vous donne un exemple basique de cette fonction. À vous de l'étoffer comme bon vous semble.</p><pre id="r-338271" data-claire-element-id="338271"><code data-claire-semantic="html+php">&lt;?php
function haut($titrepage)
{
echo'
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot;&gt;
   &lt;head&gt;
                &lt;title&gt;'.$titrepage.'&lt;/title&gt;
                
                &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=iso-8859-1&quot; /&gt;
                &lt;meta name=&quot;keywords&quot; content=&quot;&quot;/&gt;
                &lt;meta name=&quot;description&quot; content=&quot;&quot;/&gt;
                &lt;meta name=&quot;robots&quot; content=&quot;index,follow&quot;/&gt;
                &lt;meta name=&quot;author&quot; content=&quot;&quot;/&gt;
                &lt;meta name=&quot;contact&quot; content=&quot;&quot;/&gt;
                
        &lt;!-- Lien vers la favicon --&gt;
                &lt;link rel=&quot;shortcut icon&quot; type=&quot;image/x-icon&quot; href=&quot;images/design/icone.ico&quot;/&gt;
                
        &lt;!-- Ci-dessous le design &quot;par défaut&quot; du site  --&gt;
                &lt;link rel=&quot;stylesheet&quot; media=&quot;screen&quot; type=&quot;text/css&quot; title=&quot;design&quot; href=&quot;css/design_par_defaut.css&quot; /&gt;
 
        &lt;!-- Ci-dessous les designs alternatifs--&gt;      
                &lt;link rel=&quot;alternate stylesheet&quot; media=&quot;screen&quot; type=&quot;text/css&quot; title=&quot;print&quot; href=&quot;css/print.css&quot; /&gt;
 
        &lt;!-- Javascripts--&gt;
                
                &lt;script type=&quot;text/javascript&quot; src=&quot;js/fonction_nouvellefenetre.js&quot;&gt;&lt;/script&gt;
                &lt;script type=&quot;text/javascript&quot; src=&quot;js/controle_player.js&quot;&gt;&lt;/script&gt;
 
   &lt;/head&gt;
 
   &lt;body&gt;
   ';
}
?&gt;</code></pre><p id="r-338272" data-claire-element-id="338272">Même principe pour le bas de page :</p><pre id="r-338273" data-claire-element-id="338273"><code data-claire-semantic="html+php">&lt;?php
function bas()
{
 echo'
        &lt;!-- Le pied de page --&gt;
                &lt;div id=&quot;pied_de_page&quot;&gt;&lt;/div&gt;
        &lt;/body&gt;
&lt;/html&gt;
';
}
?&gt;</code></pre><p id="r-338274" data-claire-element-id="338274">Voici donc le code de la page import_song.</p><aside id="r-338276" data-claire-element-id="338276" data-claire-semantic="information"><p id="r-338275" data-claire-element-id="338275">Pour le fonctionnement de l'upload de fichiers par formulaire, je vous invite à lire <a href="http://www.siteduzero.com/tuto-3-1718-1-upload-de-fichiers-par-formulaire.html">l'excellent tuto de DHKold.</a></p></aside><p id="r-338277" data-claire-element-id="338277">On peut diviser cette page en trois étapes :</p><ul id="r-338284" data-claire-element-id="338284"><li id="r-338279" data-claire-element-id="338279"><p id="r-338278" data-claire-element-id="338278">l'initialisation des variables et l'appel des différentes fonctions,</p></li><li id="r-338281" data-claire-element-id="338281"><p id="r-338280" data-claire-element-id="338280">lorsqu'on affiche la page pour la première fois, on affiche le formulaire. Bien que cela soit la deuxième étape, cette partie du code sera rédigée en dernier ;</p></li><li id="r-338283" data-claire-element-id="338283"><p id="r-338282" data-claire-element-id="338282">si le formulaire a été complété, on vérifie et on traite le fichier envoyé.</p></li></ul><h3 id="r-initiation-des-variables-fonctions" data-claire-element-id="338286">Initiation des variables / fonctions</h3><pre id="r-338285" data-claire-element-id="338285"><code data-claire-semantic="html+php">&lt;?php
//initialisation des variables
$titrepage= 'Envoi de fichier mp3';
 
require_once('fonctionconnexionbdd.php');
require_once('fonctionshautbas.php');
 
connexionbdd();
 
$extensions_ok = array('mp3'); //Pour être sûr que l'on importe uniquement des fichiers mp3
$dest_dossier = '../musique/'; //Le dossier de destination
?&gt;</code></pre><h3 id="r-affichage-du-formulaire-par-defaut" data-claire-element-id="338290">Affichage du formulaire par défaut</h3><aside id="r-338288" data-claire-element-id="338288" data-claire-semantic="warning"><p id="r-338287" data-claire-element-id="338287">Je vous rappelle que c'est en fait la dernière partie du code (bien que son résultat s'affiche en premier).</p></aside><pre id="r-338289" data-claire-element-id="338289"><code data-claire-semantic="html+php">&lt;?php
else//À l'ouverture de la page, on affiche le formulaire
    {
     haut($titrepage);
     echo '
           &lt;div id=&quot;import&quot; style=&quot;margin-top:200px;&quot;&gt;
           &lt;h1&gt;&lt;a href=&quot;index.php&quot;&gt;'.$titrepage.'&lt;/a&gt;&lt;/h1&gt;
           &lt;p style=&quot;color:red;&quot;&gt;Le fichier n\'est pas un fichier mp3, ou il y a eu un problème lors de l\'importation !&lt;/p&gt;
               &lt;form method=&quot;post&quot; action=&quot;import_song.php&quot; enctype=&quot;multipart/form-data&quot; style=&quot;text-align:center;&quot;&gt;
                    &lt;p&gt;
                    &lt;label for=&quot;categorie&quot;&gt;Spectacle:&lt;/label&gt;
                    &lt;select name=&quot;categorie&quot; id=&quot;categorie&quot;&gt;
                           &lt;option value=&quot;pop&quot;&gt;Musique Pop&lt;/option&gt;
                           &lt;option value=&quot;rock&quot;&gt;Musique Rock&lt;/option&gt;
                           &lt;option value=&quot;classique&quot;&gt;Musique Classique&lt;/option&gt;
                     &lt;/select&gt;
                     &lt;label for=&quot;chanson&quot;&gt;Chanson&amp;nbsp;(Type&amp;nbsp;.mp3&amp;nbsp;uniquement)&amp;nbsp;:&lt;/label&gt;
                      &lt;br/&gt;
                      &lt;br/&gt;
                      &lt;input type=&quot;hidden&quot; name=&quot;MAX_FILE_SIZE&quot; value=&quot;2097152&quot;/&gt;&lt;br/&gt;//Taille maximale 2Mo
                       &lt;input type=&quot;file&quot; name=&quot;chanson&quot; id=&quot;chanson&quot;/&gt;
                      &lt;br/&gt;&lt;br/&gt;
                      &lt;input type=&quot;hidden&quot; name=&quot;soumettre&quot; value=&quot;1&quot; /&gt;
                      &lt;input type=&quot;submit&quot; name=&quot;envoi&quot; value=&quot;Envoyer le fichier .mp3&quot; /&gt;
                       &lt;/p&gt;
               &lt;/form&gt;
          &lt;/div&gt;
              ';
     }
 
bas();//On ferme les balises html
mysql_close();// On ferme la connexion Mysql
?&gt;</code></pre><h3 id="r-traitement-des-donnees-du-formulaire" data-claire-element-id="338296">Traitement des données du formulaire</h3><aside id="r-338292" data-claire-element-id="338292" data-claire-semantic="warning"><p id="r-338291" data-claire-element-id="338291">Ceci est la deuxième partie du code. :lol:</p></aside><p id="r-338293" data-claire-element-id="338293">Le code est un peu long mais il est abondamment commenté pour que vous puissiez vous y retrouver, et la dernière partie n'est que l'affichage du formulaire. Donc ne fuyez pas :D .</p><pre id="r-338294" data-claire-element-id="338294"><code data-claire-semantic="html+php">&lt;?php
if(isset($_POST['soumettre'])) // Si le formulaire est envoyé
   {
    $categorie=htmlentities(trim($_POST['categorie']),ENT_QUOTES); //Protection des données
    $dest_fichier = strtolower($_FILES['chanson']['name']); //récupération du nom du fichier qui a été envoyé
    // formatage du nom du fichier
    $dest_fichier = str_replace(' ','_',$dest_fichier);
    $dest_fichier = str_replace('-','_',$dest_fichier);
    $dest_fichier = str_replace(&quot;'&quot;,'&amp;#039;',$dest_fichier);
    // enlève les accents
    $dest_fichier = strtr($dest_fichier, 'ÀÁÂÃÄÅÇÈÉÊËÌÍÎÏÒÓÔÕÖÙÚÛÜÝàáâãäåçèéêëìíîïðòóôõöùúûüýÿ', 'AAAAAACEEEEIIIIOOOOOUUUUYaaaaaaceeeeiiiioooooouuuuyy');
    $extension=$dest_fichier;
    $extension=strtolower(substr(strrchr($_FILES['chanson']['name'],'.'),1));// Récupération de l'extension du fichier pour vérification
                                        
    if(in_array($extension, $extensions_ok)) //Si l'extension est l'extension attendue
       {
       $dest_dossier = $dest_dossier.$dest_fichier; 
       $fichier = str_replace('.'.$extension,'',$dest_fichier); //On supprime l'extension pour n'avoir que le nom du fichier dans la base de données
        $resultat =move_uploaded_file($_FILES['chanson']['tmp_name'],$dest_dossier); // On déplace le fichier sur le serveur
         if($resultat) //Si tout va bien
            {
             $sql=mysql_query('INSERT INTO sons VALUES(&quot;&quot;,&quot;'.$categorie.'&quot;,&quot;'.$fichier.'&quot;)')or die(mysql_error()); //On entre les données dans la base
             haut($titrepage); // On affiche la page
             echo 'Le fichier a bien été importé. Le chemin relatif est : &quot;'.$dest_dossier.'&quot;
             &lt;br/&gt;
             &lt;br/&gt;
             &lt;a href=&quot;index.php&quot;&gt;Retour à l\'accueil&lt;/a&gt;';
            }
          else
             {
             haut($titrepage); // On affiche la page
             echo'
                 Il y a eu un problème lors du téléchargement :
                 &lt;ul&gt;
                     &lt;li&gt;fichier '.$dest_fichier.'&lt;/li&gt;
                     &lt;li&gt;erreur fichier n'.$_FILES['chanson']['error'].' : ';
                     switch($_FILES['chanson']['error'])
                            {
                            case '1': echo'le fichier a une taille supérieure à 2Mo.'; //Le fichier téléchargé excède la taille de upload_max_filesize, configurée dans le php.ini.
                             break;
                             case '2': echo'le fichier a une taille supérieure à 2Mo.'; //Le fichier téléchargé excède la taille de MAX_FILE_SIZE, qui a été spécifiée dans le formulaire HTML.
                             break;
                             case '3': echo'le fichier n\'a été chargé que partiellement.';
                             break;
                             case '4': echo'aucun fichier n\'a été chargé.';
                             break;
                             case '6': echo'échec de l\'écriture du fichier sur le disque.';
                             break;
                             case '7': echo'l\'envoi du fichier a été arrêté.';
                             break;
                             }
                 echo'&lt;/li&gt;
                  &lt;/ul&gt;
&lt;a href=&quot;index.php&quot;&gt;Retour à l\'accueil&lt;/a&gt;';
             }
        }
      else //Si l'extension n'est pas celle attendue
        {
         haut($titrepage);//Affichage du formulaire et du message d'erreur
         echo '
         &lt;div id=&quot;import&quot; style=&quot;margin-top:200px;&quot;&gt;
         &lt;h1&gt;&lt;a href=&quot;index.php&quot;&gt;'.$titrepage.'&lt;/a&gt;&lt;/h1&gt;
         &lt;p style=&quot;color:red;&quot;&gt;Le fichier n\'est pas un fichier mp3, ou il y a eu un problème lors de l\'importation !&lt;/p&gt;
             &lt;form method=&quot;post&quot; action=&quot;import_song.php&quot; enctype=&quot;multipart/form-data&quot; style=&quot;text-align:center;&quot;&gt;
                  &lt;p&gt;
                  &lt;label for=&quot;categorie&quot;&gt;Spectacle:&lt;/label&gt;
                  &lt;select name=&quot;categorie&quot; id=&quot;categorie&quot;&gt;
                         &lt;option value=&quot;pop&quot;&gt;Musique Pop&lt;/option&gt;
                         &lt;option value=&quot;rock&quot;&gt;Musique Rock&lt;/option&gt;
                         &lt;option value=&quot;classique&quot;&gt;Musique Classique&lt;/option&gt;
                   &lt;/select&gt;
                   &lt;label for=&quot;chanson&quot;&gt;Chanson&amp;nbsp;(Type&amp;nbsp;.mp3&amp;nbsp;uniquement)&amp;nbsp;:&lt;/label&gt;
                &lt;br/&gt;
                &lt;br/&gt;
                &lt;input type=&quot;hidden&quot; name=&quot;MAX_FILE_SIZE&quot; value=&quot;2097152&quot;/&gt;&lt;br/&gt;//Taille maximale 2Mo
                &lt;input type=&quot;file&quot; name=&quot;chanson&quot; id=&quot;chanson&quot;/&gt;
                &lt;br/&gt;
                &lt;br/&gt;
                &lt;input type=&quot;hidden&quot; name=&quot;soumettre&quot; value=&quot;1&quot; /&gt;
                &lt;input type=&quot;submit&quot; name=&quot;envoi&quot; value=&quot;Envoyer le fichier .mp3&quot; /&gt;
                   &lt;/p&gt;
               &lt;/form&gt;
           &lt;/div&gt;
                ';
          }
    }
?&gt;</code></pre><p id="r-338295" data-claire-element-id="338295">En résumé, on vérifie que le formulaire a envoyé un fichier, que l'extension est la bonne, que la taille du fichier est inférieure ou égale à la taille maximale autorisée, que le transfert s'est bien passé, et si tout va bien, on entre le nom et la catégorie du fichier dans la base de données.<br/> Sinon, on affiche le formulaire avec éventuellement un message d'erreur.</p><h2 id="r-la-page-de-gestion-des-morceaux" data-claire-element-id="338352">La page de gestion des morceaux</h2><p id="r-338298" data-claire-element-id="338298">La page va être séparée en deux parties :</p><ul id="r-338303" data-claire-element-id="338303"><li id="r-338300" data-claire-element-id="338300"><p id="r-338299" data-claire-element-id="338299">la première va afficher les morceaux par catégorie,</p></li><li id="r-338302" data-claire-element-id="338302"><p id="r-338301" data-claire-element-id="338301">la deuxième va afficher les formulaires.</p></li></ul><h3 id="r-le-principe-8" data-claire-element-id="338327">Le principe</h3><p id="r-338304" data-claire-element-id="338304">Pour pouvoir afficher les morceaux en fonction de leur catégorie, on va définir 2 variables qui n'ont pas de signification particulière mais qui vont nous permettre de savoir ce que l'on doit afficher. On va les appeler $tmp et $tmp2.<br/> Au début de la boucle d'affichage (car oui, nous allons utiliser une boucle), $tmp n'aura pas de valeur particulière et $tmp2 aura pour valeur 0. On a donc :</p><pre id="r-338305" data-claire-element-id="338305"><code data-claire-semantic="html+php">$tmp = '';
$tmp2 = 0;</code></pre><p id="r-338306" data-claire-element-id="338306">Ensuite, $tmp prendra la valeur de chaque catégorie, et $tmp2 sera incrémentée de 1. Je vais vous montrer comment.</p><p id="r-338307" data-claire-element-id="338307">Commençons ! :pirate:</p><p id="r-338308" data-claire-element-id="338308">Tout d'abord, la requète sql. On demande tous les éléments de la base &quot;sons&quot; définie au début de ce tuto, et on va les classer par catégorie puis par identifiant grâce à ORDER BY. Ce qui nous donne :</p><pre id="r-338309" data-claire-element-id="338309"><code data-claire-semantic="sql">$requet=mysql_query('SELECT * FROM sons ORDER BY categorie,id_son') OR die(mysql_error());</code></pre><aside id="r-338311" data-claire-element-id="338311" data-claire-semantic="information"><p id="r-338310" data-claire-element-id="338310">Le or die(mysql_error()) nous permet de débugger la requête si l'on fait une erreur d'écriture. Bien pratique... ^^</p></aside><p id="r-338312" data-claire-element-id="338312">Ensuite vient la boucle que l'on va faire avec un while($playlist=mysql_fetch_array($requet)).</p><p id="r-338313" data-claire-element-id="338313">Avant de vous donner le code, je vais vous expliquer le principe de cette boucle un peu particulière.</p><ul id="r-338324" data-claire-element-id="338324"><li id="r-338315" data-claire-element-id="338315"><p id="r-338314" data-claire-element-id="338314">Au premier passage de la boucle, $tmp ne vaut rien et $tmp2 vaut 0 comme nous l'avons précédemment défini.</p></li><li id="r-338317" data-claire-element-id="338317"><p id="r-338316" data-claire-element-id="338316">Grâce à un condition (if), on regarde si $tmp est différent de la première catégorie rencontrée.</p></li><li id="r-338319" data-claire-element-id="338319"><p id="r-338318" data-claire-element-id="338318">Si c'est le cas, $tmp prend la valeur de la catégorie et on affiche le début de la liste (balise &lt;ul&gt;) ; $tmp2 est augmentée de 1.</p></li><li id="r-338321" data-claire-element-id="338321"><p id="r-338320" data-claire-element-id="338320">Si $tmp2 vaut 2, c'est que la catégorie a changé. Donc il faut afficher la fin de la liste (&lt;/ul&gt;). On diminue alors la valeur de $tmp2 de 1.</p></li><li id="r-338323" data-claire-element-id="338323"><p id="r-338322" data-claire-element-id="338322">Ensuite on affiche les éléments de la liste, c'est-à-dire les morceaux.</p></li></ul><p id="r-338325" data-claire-element-id="338325">Lorsque le dernier morceau de la base sera affiché, on sortira de la boucle. Il faudra donc clôturer la dernière liste en affichant une ultime balise &lt;/ul&gt;.</p><p id="r-338326" data-claire-element-id="338326">Après cette brève description, je vous donne le code. Vous y verrez plus clair.</p><h3 id="r-le-code-10" data-claire-element-id="338331">Le code</h3><pre id="r-338328" data-claire-element-id="338328"><code data-claire-semantic="html+php">&lt;?php
echo'
&lt;div id=&quot;liste_chansons&quot;&gt;';
//Initialisation des variables
        $tmp='';
        $tmp2= 0;
//La requête
        $requet=mysql_query('SELECT * FROM sons ORDER BY categorie,id_son') or die(mysql_error());
        while($playlist=mysql_fetch_array($requet))
                {       
                 if($playlist['categorie'] != $tmp)
                   {
                    $tmp = $playlist['categorie'];
                    $tmp2 = $tmp2 + 1;
                    if($tmp2 === 2)
                      {
                       $tmp2 = $tmp2 - 1;
                       echo'
                       &lt;/ul&gt;
                       &lt;br/&gt;
                           ';
                      }
                    echo'
                        &lt;span style=&quot;text-decoration:underline;&quot;&gt;Playlist '.$playlist['categorie'].'&lt;/span&gt;
                        &lt;br/&gt;
                        &lt;br/&gt;
                        &lt;ul style=&quot;list-style:decimal;&quot;&gt;
                        ';              
                   }
                   echo'
                        &lt;li&gt;chanson n&amp;deg;&lt;strong&gt;'.$playlist['id_son'].'&lt;/strong&gt; : '.$playlist['fichier_son'].'&lt;/li&gt;
                        ';
               }
               echo'
                   &lt;/ul&gt;
                   &lt;br/&gt;
                   &lt;/div&gt;';
?&gt;</code></pre><p id="r-338329" data-claire-element-id="338329">On affiche ensuite le formulaire.</p><p id="r-338330" data-claire-element-id="338330">On vérifie tout d'abord si on a des entrées dans la base, et on n'affiche le formulaire que si c'est le cas. Je ne vous détaille pas le formulaire car c'est du html de base que je vous donnerai par la suite. Sachez juste qu'il fonctionne par la méthode POST.<br/> Ce formulaire va nous permettre de déplacer ou d'effacer les morceaux dans la base. On placera en début de page les éléments qui nous permettront de réaliser ce que le formulaire ordonne.</p><h3 id="r-intervertir-la-place-de-2-morceaux" data-claire-element-id="338343">Intervertir la place de 2 morceaux</h3><p id="r-338332" data-claire-element-id="338332">On vérifie que l'on a envoyé par le formulaire les deux identifiants de morceaux à intervertir. Si c'est le cas, on sécurise les données et on récupère la catégorie de chaque morceau dans une variable. Ensuite, on change les morceaux de place.</p><p id="r-338333" data-claire-element-id="338333">On procède en trois temps.</p><ul id="r-338340" data-claire-element-id="338340"><li id="r-338335" data-claire-element-id="338335"><p id="r-338334" data-claire-element-id="338334">D'abord, on change l'identifiant du morceau à modifier et on lui donne pour valeur 10000 (pour être sûr de ne pas effacer un identifiant déjà existant, car ça m'étonnerait que vous ayez une base de 10000 morceaux o_O . Si c'est le cas, augmentez le numéro de l'identifiant d'un multiple de 10.).</p></li><li id="r-338337" data-claire-element-id="338337"><p id="r-338336" data-claire-element-id="338336">Ensuite, on intervertit les morceaux.</p></li><li id="r-338339" data-claire-element-id="338339"><p id="r-338338" data-claire-element-id="338338">Enfin, on donne à l'identifiant 10000 l'ancienne valeur de l'identifiant du deuxième morceau.</p></li></ul><p id="r-338341" data-claire-element-id="338341">Ce qui nous donne en langage informatique :</p><pre id="r-338342" data-claire-element-id="338342"><code data-claire-semantic="html+php">&lt;?php
if(isset($_POST['id_a_remplacer']) AND !empty($_POST['id_a_remplacer']) AND isset($_POST['new_id']) AND !empty($_POST['new_id']))
        {
        $id_a_modifier=intval($_POST['id_a_remplacer']);
        $new_id=intval($_POST['new_id']);
        
        $requet = mysql_query('SELECT categorie FROM sons WHERE id_son=&quot;'.$id_a_modifier.'&quot;') or die(mysql_error());
        $requet_a_modifier=mysql_fetch_array($requet);
        $cat_a_modifier = $requet_a_modifier['categorie'];    
        
        $requet = mysql_query('SELECT categorie FROM sons WHERE id_son=&quot;'.$new_id.'&quot;') or die(mysql_error());
        $new_requet=mysql_fetch_array($requet);
        $new_cat = $new_requet['categorie'];
        
        mysql_query('UPDATE sons  SET id_son=&quot;10000&quot; WHERE id_son=&quot;'.$id_a_modifier.'&quot;') or die(mysql_error());
        mysql_query('UPDATE sons  SET id_son=&quot;'.$id_a_modifier.'&quot;, categorie=&quot;'.$cat_a_modifier.'&quot; WHERE id_son=&quot;'.$new_id.'&quot;') or die(mysql_error());
        mysql_query('UPDATE sons  SET id_son=&quot;'.$new_id.'&quot;, categorie=&quot;'.$new_cat.'&quot; WHERE id_son=&quot;10000&quot;') or die(mysql_error());
        
                echo'
                &lt;p&gt;
                Les chansons ont été déplacées dans la playlist !
                &lt;/p&gt;
                '; 
        }
?&gt;</code></pre><h3 id="r-modifier-la-categorie-ou-supprimer-un-morceau" data-claire-element-id="338346">Modifier la catégorie ou supprimer un morceau</h3><p id="r-338344" data-claire-element-id="338344">Pour modifier la catégorie d'un seul morceau, ou supprimer un morceau, je vous donne directement la requête car elle est simple à comprendre.</p><pre id="r-338345" data-claire-element-id="338345"><code data-claire-semantic="html+php">&lt;?php
if(isset($_POST['id_a_modifier']) AND !empty($_POST['id_a_modifier']) AND isset($_POST['new_categorie']) AND !empty($_POST['new_categorie']))
        {
                $id_a_modifier=intval($_POST['id_a_modifier']);
                $new_categorie = htmlentities(htmlspecialchars($_POST['new_categorie']), ENT_QUOTES);
                mysql_query('UPDATE sons  SET categorie=&quot;'.$new_categorie.'&quot; WHERE id_son=&quot;'.$id_a_modifier.'&quot;') or die(mysql_error());
                
                echo'
                &lt;p&gt;
                La catégorie de la chanson n&amp;deg; '.$id_a_modifier.' a été modifiée !
                &lt;/p&gt;
                '; 
        }
        
        if(isset($_POST['supp']) AND !empty($_POST['supp']))
        {
                $supp=intval($_POST['supp']);
                mysql_query('DELETE FROM sons WHERE id_son=&quot;'.$supp.'&quot;')or die(mysql_error());
                
                echo'
                &lt;p&gt;
                La chanson a été supprimée de la playlist !
                &lt;/p&gt;
                '; 
        }
?&gt;</code></pre><h3 id="r-le-code-complet-7" data-claire-element-id="338351">Le code complet</h3><p id="r-338347" data-claire-element-id="338347">Comme vous avez été sages, je vous donne le code complet de la page. :p</p><p id="r-338348" data-claire-element-id="338348"></p><div id="r-338350" data-claire-element-id="338350"><pre id="r-338349" data-claire-element-id="338349"><code data-claire-semantic="html+php">&lt;?php
require_once('fonctionconnexionbdd.php');
require_once('fonctionshautbas.php');
 
connexionbdd();
 
 
$titrepage= 'Gestion des morceaux';
 
//--------------------------------------------------------------------------------
//--------------------------------------------------------------------------------
 
if(isset($_POST['id_a_remplacer']) AND !empty($_POST['id_a_remplacer']) AND isset($_POST['new_id']) AND !empty($_POST['new_id']))
        {
        $id_a_modifier=intval($_POST['id_a_remplacer']);
        $new_id=intval($_POST['new_id']);
        
        $requet = mysql_query('SELECT categorie FROM sons WHERE id_son=&quot;'.$id_a_modifier.'&quot;') or die(mysql_error());
        $requet_a_modifier=mysql_fetch_array($requet);
        $cat_a_modifier = $requet_a_modifier['categorie'];    
        
        $requet = mysql_query('SELECT categorie FROM sons WHERE id_son=&quot;'.$new_id.'&quot;') or die(mysql_error());
        $new_requet=mysql_fetch_array($requet);
        $new_cat = $new_requet['categorie'];
        
        mysql_query('UPDATE sons  SET id_son=&quot;10000&quot; WHERE id_son=&quot;'.$id_a_modifier.'&quot;') or die(mysql_error());
        mysql_query('UPDATE sons  SET id_son=&quot;'.$id_a_modifier.'&quot;, categorie=&quot;'.$cat_a_modifier.'&quot; WHERE id_son=&quot;'.$new_id.'&quot;') or die(mysql_error());
        mysql_query('UPDATE sons  SET id_son=&quot;'.$new_id.'&quot;, cat=&quot;'.$new_cat.'&quot; WHERE id_son=&quot;10000&quot;') or die(mysql_error());
        
                echo'
                &lt;p&gt;
                Les chansons ont été déplacées dans la playlist !
                &lt;/p&gt;
                '; 
        }
if(isset($_POST['id_a_modifier']) AND !empty($_POST['id_a_modifier']) AND isset($_POST['new_categorie']) AND !empty($_POST['new_categorie']))
        {
                $id_a_modifier=intval($_POST['id_a_modifier']);
                $new_categorie = htmlentities(htmlspecialchars($_POST['new_categorie']), ENT_QUOTES);
                mysql_query('UPDATE sons  SET categorie=&quot;'.$new_categorie.'&quot; WHERE id_son=&quot;'.$id_a_modifier.'&quot;') or die(mysql_error());
                
                echo'
                &lt;p&gt;
                La catégorie de la chanson n&amp;deg; '.$id_a_modifier.' a été modifiée !
                &lt;/p&gt;
                '; 
        }
        
        if(isset($_POST['supp']) AND !empty($_POST['supp']))
        {
                $supp=intval($_POST['supp']);
                mysql_query('DELETE FROM sons WHERE id_son=&quot;'.$supp.'&quot;')or die(mysql_error());
                
                echo'
                &lt;p&gt;
                La chanson a été supprimée de la playlist !
                &lt;/p&gt;
                '; 
        }
 
haut($titrepage);
 
echo'
        &lt;h1&gt;&lt;a href=&quot;index.php&quot;&gt;'.$titrepage.'&lt;/a&gt;&lt;/h1&gt;
                &lt;div id=&quot;liste_chansons&quot;&gt;';
        $tmp='';
        $tmp2= 0;
        $requet=mysql_query('SELECT * FROM sons ORDER BY categorie,id_son') or die(mysql_error());
        while($playlist=mysql_fetch_array($requet))
                {       
                        if($playlist['categorie'] != $tmp)
                                {
                                $tmp = $playlist['spect'];
                                $tmp2 = $tmp2 + 1;
                                if($tmp2 === 2)
                                        {
                                        $tmp2 = $tmp2 - 1;
                        echo'
                                &lt;/ul&gt;
                                &lt;br/&gt;
                                ';
                                        }
                        echo'
                                &lt;span style=&quot;text-decoration:underline;&quot;&gt;Playlist '.$playlist['categorie'].'&lt;/span&gt;
                                &lt;br/&gt;
                                &lt;br/&gt;
                                &lt;ul style=&quot;list-style:decimal;&quot;&gt;
                                ';              
                                }
                        echo'
                                &lt;li&gt;chanson n&amp;deg;&lt;strong&gt;'.$playlist['id_son'].'&lt;/strong&gt; : '.$playlist['fichier_son'].'&lt;/li&gt;
                                ';
                        }
                
                echo'
                                &lt;/ul&gt;
                                &lt;br/&gt;
                        &lt;/div&gt;
                &lt;form method=&quot;post&quot; action=&quot;liste_songs.php&quot;&gt;
                                ';
                $rekete=mysql_query('SELECT COUNT(*) AS nb_entrees FROM sons') or die(mysql_error());
                $compte=mysql_fetch_array($rekete);
                if($compte['nb_entrees'] != 0)
                echo'
                                &lt;p&gt;&lt;strong&gt;Remplacement&lt;/strong&gt;&lt;/p&gt;&lt;hr/&gt;
                                &lt;table summary=&quot;changement&quot;&gt;
                                &lt;tr&gt;
                                        &lt;td&gt;
                                        Remplacer la chanson n&amp;deg;&amp;nbsp;:
                                        &lt;/td&gt;
                                        &lt;td&gt;
                                        &lt;input type=&quot;text&quot; name=&quot;id_a_remplacer&quot; value=&quot;&quot; size=&quot;2&quot;/&gt;
                                        &lt;/td&gt;
                                &lt;/tr&gt;
                                &lt;tr&gt;
                                        &lt;td&gt;
                                        Par la chanson n&amp;deg;&amp;nbsp;:
                                        &lt;/td&gt;
                                        &lt;td&gt;
                                        &lt;input type=&quot;text&quot; name=&quot;new_id&quot; value=&quot;&quot; size=&quot;2&quot;/&gt;
                                        &lt;/td&gt;
                                &lt;/tr&gt;
                                &lt;/table&gt;
                                &lt;p&gt;&lt;strong&gt;Changement de catégorie&lt;/strong&gt;&lt;/p&gt;&lt;hr/&gt;
                                &lt;table summary=&quot;changement&quot;&gt;
                                &lt;tr&gt;
                                        &lt;td&gt;
                                        Changer la catégorie de la chanson n&amp;deg;&amp;nbsp;:
                                        &lt;/td&gt;
                                        &lt;td&gt;
                                        &lt;input type=&quot;text&quot; name=&quot;id_a_modifier&quot; value=&quot;&quot; size=&quot;2&quot;/&gt;
                                        &lt;/td&gt;
                                &lt;/tr&gt;
                                &lt;tr&gt;
                                        &lt;td&gt;
                                        Par la catégorie&amp;nbsp;:
                                        &lt;/td&gt;
                                        &lt;td&gt;
                                        &lt;select name=&quot;new_categorie&quot; id=&quot;categorie&quot;&gt;
                                          &lt;option value=&quot;categorieA&quot;&gt;Musique Pop&lt;/option&gt;
                                          &lt;option value=&quot;categorieB&quot;&gt;Musique Rock&lt;/option&gt;
                                          &lt;option value=&quot;categorieC&quot;&gt;Musique Classique&lt;/option&gt;
                                        &lt;/select&gt;
                                        &lt;/td&gt;
                                &lt;/tr&gt;
                                &lt;/table&gt;
                                &lt;p&gt;&lt;strong&gt;Suppression&lt;/strong&gt;&lt;/p&gt;&lt;hr/&gt;
                                &lt;table summary=&quot;suppression&quot;&gt;
                                &lt;tr&gt;
                                        &lt;td&gt;
                                        Supprimer la chanson n&amp;deg; :
                                        &lt;/td&gt;
                                        &lt;td&gt;
                                        &lt;input type=&quot;text&quot; name=&quot;supp&quot; value=&quot;&quot; size=&quot;2&quot;/&gt;
                                        &lt;/td&gt;
                                &lt;/tr&gt;
                                &lt;/table&gt;
                                
                                &lt;table summary=&quot;Envoi&quot;&gt;
                                &lt;tr&gt;
                                        &lt;td&gt;
                        &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Envoyer&quot;/&gt;
                                        &lt;/td&gt;
                                &lt;/tr&gt;
                                &lt;/table&gt;
                &lt;/form&gt;
        
        ';
bas();
mysql_close();
?&gt;</code></pre></div>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne">Gérer la playlist du dewplayer en ligne</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-principe-de-fonctionnement-2">
Le principe de fonctionnement
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/la-partie-administration">
La partie administration
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-lecteur-1">
Le lecteur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-javascript">
Le JavaScript
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-principe-de-fonctionnement-2">
<span class="arrow"></span>
<span class="next">Le principe de fonctionnement</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-lecteur-1">
<span class="next">Le lecteur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lelecteur"></a><h2>Le lecteur</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/la-partie-administration">
<span class="arrow"></span>
<span class="next">La partie administration</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-javascript">
<span class="next">Le JavaScript</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<aside id="r-338355" data-claire-element-id="338355" data-claire-semantic="information"><p id="r-338354" data-claire-element-id="338354">Le principe est simple : on place le code flash du lecteur dans le corps de la page, et la liste des morceaux est entrée dans une variable $son que l'on aura au préalable formatée à notre convenance.</p></aside><p id="r-338356" data-claire-element-id="338356">Pour cela, on fait une requête pour enregistrer, grâce à une boucle, tous les morceaux dans $son. Ensuite, on sépare par une barre verticale les morceaux entre eux (nécessaire pour que le lecteur fonctionne).</p><aside id="r-338358" data-claire-element-id="338358" data-claire-semantic="warning"><p id="r-338357" data-claire-element-id="338357">Si vous récrivez le code du player, faites attention à bien mettre le code après document.write sur une seule ligne. Cela permet d'avoir un code valide (même si je sais que ce n'est pas très bien) et surtout, que le lecteur fonctionne correctement.</p></aside><p id="r-338359" data-claire-element-id="338359">Je vous donne le code abondamment commenté une fois encore. Il n'y a rien de bien nouveau mis à part le code du lecteur. Le principe de fonctionnement étant équivalent à celui de la page de gestion.</p><p id="r-338360" data-claire-element-id="338360"></p><div id="r-338362" data-claire-element-id="338362"><pre id="r-338361" data-claire-element-id="338361"><code data-claire-semantic="html+php">&lt;?php
//initialisation des variables
$titrepage= 'Lecteur mp3';
 
require_once('fonctionconnexionbdd.php');
require_once('fonctionshautbas.php');
 
connexionbdd();
 
//initialisation et formatage de la variable $son
$son='';
$sql=mysql_query('SELECT * FROM sons ORDER BY id_son') or die(mysql_error());
while($result=mysql_fetch_array($sql))
    {
    $son.='musique/'.$result['fichier_son'].'.mp3';
    }
    $son=str_replace('mp3m','mp3|m',$son);
 
//Pour afficher le nom du morceau par défaut à l'ouverture du player
if (!isset($_GET['fichier'])) 
  {
  $sql=mysql_query('SELECT fichier_son FROM sons ORDER BY id_son LIMIT 0,1') or die(mysql_error());
  $result=mysql_fetch_array($sql);
 
  $nom=str_replace('.mp3','',$result['fichier_son']);
  $nom=str_replace('_',' ',$nom);
  }
 
haut($titrepage);
 //Le lecteur
echo'   
&lt;div id=&quot;lecteur&quot; style=&quot;width:240px;text-align:center;&quot;&gt;
  &lt;div id=&quot;content_dew_player&quot; style=&quot;margin-top:0px;margin-left:-10px;text-align:center;&quot;&gt;
 
  &lt;object classid=&quot;clsid:d27cdb6e-ae6d-11cf-96b8-444553540000&quot; codebase=&quot;http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0&quot; id=&quot;dewplayer&quot; type=&quot;application/x-shockwave-flash&quot; data=&quot;dewplayer-multi.swf?mp3='.$son.'&amp;amp;autostart=1&amp;amp;showtime=1&amp;amp;bgcolor=B2CC53&quot; height=&quot;20&quot; width=&quot;240&quot;&gt;
  &lt;param name=&quot;wmode&quot; value=&quot;transparent&quot;/&gt;
  &lt;param name=&quot;allowScriptAccess&quot; value=&quot;sameDomain&quot; /&gt; 
  &lt;param name=&quot;movie&quot; value=&quot;dewplayer-multi.swf?mp3='.$son.'&amp;amp;autostart=1&amp;amp;showtime=1&amp;amp;bgcolor=B2CC53&quot; /&gt;
  &lt;param name=&quot;quality&quot; value=&quot;high&quot; /&gt;
  &lt;param name=&quot;bgcolor&quot; value=&quot;B2CC53&quot; /&gt;
    &lt;script type=&quot;text/javascript&quot;&gt;
    &lt;!--
    document.write(\'&lt;embed src=&quot;dewplayer-multi.swf?mp3='.$son.'&amp;amp;autostart=1&amp;amp;showtime=1&amp;amp;bgcolor=B2CC53&quot; quality=&quot;high&quot; bgcolor=&quot;B2CC53&quot; width=&quot;240&quot; height=&quot;20&quot; name=&quot;dewplayer&quot; wmode=&quot;transparent&quot; align=&quot;middle&quot; allowScriptAccess=&quot;sameDomain&quot; type=&quot;application/x-shockwave-flash&quot; pluginspage=&quot;http://www.macromedia.com/go/getflashplayer&quot;&gt;&lt;\/embed&gt;\');
    --&gt;
    &lt;/script&gt;
  &lt;/object&gt;
&lt;br/&gt;
'.strtolower($nom).'
  &lt;/div&gt;
&lt;div id=&quot;liste_sons&quot;&gt;
        ';
 
//Affichage de la liste des morceaux selon le même principe que celui de la page de gestion
        $tmp='';
        $tmp2= 0;
        $requet=mysql_query('SELECT * FROM sons ORDER BY categorie,id_son') or die(mysql_error());
        while($playlist=mysql_fetch_array($requet))
            {       
            if($playlist['categorie'] != $tmp)
               {
               $tmp = $playlist['categorie'];
               $tmp2 = $tmp2 + 1;
               if($tmp2 === 2)
                 {
                  $tmp2 = $tmp2 - 1;
                  echo'
                     &lt;/ul&gt;
                      ';
                 }
                  echo'
                     &lt;span style=&quot;text-decoration:underline;&quot;&gt;Playlist '.$playlist['categorie'].'&lt;/span&gt;
                     &lt;ul style=&quot;list-style:decimal;height:130px;width:200px;overflow:auto;text-align:left;font-size:small;margin-left:-19px;&quot;&gt;
                      ';              
               }
            $morceau = str_replace('.mp3','',$playlist['fichier_son']);
            $morceau = str_replace('_',' ',$morceau);
            $morceau = str_replace('-',' ',$morceau);
            echo'
              &lt;li&gt;&lt;a href=&quot;lecteur.php?fichier='.$playlist['fichier_son'].'.mp3&quot;  style=&quot;color:#A22E30;text-decoration:none;&quot;&gt;'.ucfirst($morceau).'&lt;/a&gt;&lt;/li&gt;
                ';
            }
               
            echo'
               &lt;/ul&gt;
&lt;/div&gt;
';
bas();
mysql_close();
?&gt;</code></pre></div><p id="r-338363" data-claire-element-id="338363">Lorsque l'on clique sur un des liens de la liste, la variable va être passée dans l'adresse de la page, mais c'est le JavaScript -<em>et non le php</em>- qui va la traiter. Ce qui permet de changer de morceau sans recharger la page.</p><p id="r-338364" data-claire-element-id="338364">Nous allons donc voir ce code JavaScript.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne">Gérer la playlist du dewplayer en ligne</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-principe-de-fonctionnement-2">
Le principe de fonctionnement
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/la-partie-administration">
La partie administration
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-lecteur-1">
Le lecteur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-javascript">
Le JavaScript
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/la-partie-administration">
<span class="arrow"></span>
<span class="next">La partie administration</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-javascript">
<span class="next">Le JavaScript</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="LeJavaScript"></a><h2>Le JavaScript</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-lecteur-1">
<span class="arrow"></span>
<span class="next">Le lecteur</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<aside id="r-338367" data-claire-element-id="338367" data-claire-semantic="information"><p id="r-338366" data-claire-element-id="338366">Ce code est une fonction que l'on va placer dans une page appelée controle_player.js.</p></aside><p id="r-338368" data-claire-element-id="338368">Je vous laisse le soin de la placer dans le répertoire de votre choix. Mais faites attention à bien modifier le chemin relatif dans la fonction haut() que nous avons précédemment définie.</p><h3 id="r-principe-40" data-claire-element-id="338383">Principe</h3><ul id="r-338381" data-claire-element-id="338381"><li id="r-338370" data-claire-element-id="338370"><p id="r-338369" data-claire-element-id="338369">La fonction teste d'abord si le navigateur prend en charge correctement l'accès au modèle DOM, grâce à la méthode getElementById().</p></li><li id="r-338372" data-claire-element-id="338372"><p id="r-338371" data-claire-element-id="338371">Ensuite, si c'est ok, on récupère, dans une variable liste, la liste des morceaux, (<strong>située dans la balise dont l'id est liste_sons sur la page du lecteur</strong>), que l'on place ensuite les uns à la suite des autres dans la variable song (après les avoir formatés correctement en ajoutant l'extension du fichier suivie du nom du dossier dans lequel sont placés les morceaux. Ce qui nous donne .mp3|musique/).<br/> Dans mon exemple, le dossier musique/ est situé au même niveau (dans le même dossier ou à la racine du site) que la page lecteur.php. Je vous conseille d'en faire autant.</p></li><li id="r-338374" data-claire-element-id="338374"><p id="r-338373" data-claire-element-id="338373">Puis, dès que l'on clique sur un lien, on récupère l'adresse du morceau, qui est du type url=http://etc, on extrait la chaine correspondant à l'adresse seule sans url= (deux étapes), et on place dans une nouvelle variable player, le code du player.<br/> Ce code, pour qu'il fonctionne <strong>doit tenir sur une seule ligne</strong>. L'adresse des morceaux sera donnée par la variable son.</p></li><li id="r-338376" data-claire-element-id="338376"><p id="r-338375" data-claire-element-id="338375">On concatène la variable son à la variable song dans le code du player, de façon à ce que son soit en tête de liste. C'est donc le premier morceau qui sera joué par le player. Ça tombe bien car c'est celui que l'on avait sélectionné sur notre page lecteur.php. :-°</p></li><li id="r-338378" data-claire-element-id="338378"><p id="r-338377" data-claire-element-id="338377">On définit une autre variable pour que le nom du morceau sur lequel on a cliqué s'affiche sous le player. C'est la variable nom_son (original, non ? :p ) qui est en fait la première partie de la variable son.</p></li><li id="r-338380" data-claire-element-id="338380"><p id="r-338379" data-claire-element-id="338379">Il reste quelques modifications à faire sur la variable player pour que tout fonctionne bien ; ensuite, on régénère le code du player sur la page lecteur.php grâce à la propriété innerHTML.</p></li></ul><p id="r-338382" data-claire-element-id="338382">Ce qui nous donne au final :</p><h3 id="r-le-code-11" data-claire-element-id="338389">Le code</h3><pre id="r-338384" data-claire-element-id="338384"><code data-claire-semantic="javascript">function control_player(forms) 
        { 
        // Test sur les méthodes
        if (!document.getElementById || !document.getElementsByTagName){ return false; }
        var song='musique/';
        var liste=document.getElementById('liste_sons').getElementsByTagName('a');
                        for(var j=0; j&lt;liste.length; j++)
                                {
                                        var li=liste[j].innerHTML;
                                        var song=song+li+'.mp3|musique/';
                                        song=song.replace(' ','_');
                                }
        var referent=document.getElementById('liste_sons');
        var liens_son=referent.getElementsByTagName('a');
        for (i=0; i&lt;liens_son.length; ++i)
                { liens_son[i].onclick=function()
                        {
                        /* Au clic sur le lien, on récupère l'adresse absolue du son. Attention : elle sera du type [url=http://...etc...]http://...etc...[/url] */ 
                        var adresse_son=this.href;
                        // Puis on extrait la chaîne de caractères commençant à la dernière occurrence du caractère = 
                        var pre_son=adresse_son.substring(adresse_son.lastIndexOf(&quot;=&quot;)); 
                        /* Enfin, on extrait du résultat une nouvelle chaîne de caractères commençant à l'index 1 de la précédente. L'index 0 qui correspond au caractère = est donc exclu. La variable son est maintenant opérationnelle. */ 
                        var son=pre_son.substring(1);
                        var nom_son=son.substring(0,son.lastIndexOf(&quot;.&quot;));
                        nom_son=nom_son.charAt(0).toUpperCase()+nom_son.substring(1).toLowerCase();
                        
                        var player=&quot;&lt;object classid=\&quot;clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\&quot; codebase=\&quot;http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0\&quot; id=\&quot;dewplayer\&quot; type=\&quot;application/x-shockwave-flash\&quot; data=\&quot;dewplayer-multi.swf?mp3=musique/&quot;+son+'|'+song+&quot;&amp;amp;autostart=1&amp;amp;showtime=1&amp;amp;bgcolor=B2CC53\&quot; width=\&quot;240\&quot; height=\&quot;20\&quot;&gt;&lt;param name=\&quot;movie\&quot; value=\&quot;dewplayer-multi.swf?mp3=musique/&quot;+son+'|'+song+&quot;&amp;autoplay=1\&quot; /&gt;&lt;embed src=\&quot;dewplayer-multi.swf?mp3=musique/&quot;+son+'%7C'+song+&quot;&amp;amp;autostart=1&amp;amp;showtime=1&amp;amp;bgcolor=B2CC53\&quot; quality=\&quot;high\&quot; bgcolor=\&quot;B2CC53\&quot; width=\&quot;240\&quot; height=\&quot;20\&quot; name=\&quot;dewplayer\&quot; wmode=\&quot;transparent\&quot; align=\&quot;middle\&quot; allowScriptAccess=\&quot;sameDomain\&quot; type=\&quot;application/x-shockwave-flash\&quot; pluginspage=\&quot;http://www.macromedia.com/go/getflashplayer\&quot;&gt;&lt;\/embed&gt;&lt;\/object&gt;&lt;br/&gt;&quot;+nom_son;
                        
                        player=player.replace('|musique/&amp;','&amp;');
                        player=player.replace('|musique/&amp;','&amp;');
                        player=player.replace('|musique/'+son,'');
                        player=player.replace('|musique/'+son,'');
                        player=player.replace('%7Cmusique/'+son,'');
 
                        
                        /* On régénère complètement le code html du Dewplayer grâce à la propriété innerHTML */ 
                        document.getElementById('content_dew_player').innerHTML=player
                        // On annihile le lien 
                        return false;
                        }
                }
        } 
        //On lance la fonction &quot;control_player()&quot;une fois le chargement de la page effectif
        window.onload=control_player;</code></pre><p id="r-338385" data-claire-element-id="338385">Voilà. Si vous suivez bien toutes les instructions, vous devriez avoir un lecteur opérationnel.<br/> Je pense que le code peut encore être amélioré et je suis preneur de toute nouvelle fonctionnalité ou optimisation.</p><p id="r-338386" data-claire-element-id="338386">En espérant vous avoir aidés avec ce deuxième tuto.</p><p id="r-338387" data-claire-element-id="338387">Wham. :p</p><p id="r-338388" data-claire-element-id="338388">Merci aux zcorrecteurs (Guill@ume et Klouguinette) et à Arconis pour leur aide et leur intransigeance.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne">Gérer la playlist du dewplayer en ligne</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-principe-de-fonctionnement-2">
Le principe de fonctionnement
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/la-partie-administration">
La partie administration
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-lecteur-1">
Le lecteur
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-javascript">
Le JavaScript
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/gerer-la-playlist-du-dewplayer-en-ligne/le-lecteur-1">
<span class="arrow"></span>
<span class="next">Le lecteur</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/gerer-la-playlist-du-dewplayer-en-ligne.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 08:29:19 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/gerer-la-playlist-du-dewplayer-en-ligne.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:31:31 GMT -->
</html>