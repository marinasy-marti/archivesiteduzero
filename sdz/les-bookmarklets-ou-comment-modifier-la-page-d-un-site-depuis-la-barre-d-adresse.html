<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 11:06:57 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:47:37 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Les Bookmarklets ou comment modifier la page d&#039;un site depuis la barre d&#039;adresse</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Les Bookmarklets ou comment modifier la page d&#039;un site depuis la barre d&#039;adresse</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#LesBookmarkletsoucommentmodifierlapaged039unsitedepuislabarred039adresse">Les Bookmarklets ou comment modifier la page d&#039;un site depuis la barre d&#039;adresse</a><br/><a href="#Introduction">Introduction</a><br/><a href="#TPRajouterdessmileys">[TP] Rajouter des smileys</a><br/><a href="#Intercepterlesvaleursrenvoyes">Intercepter les valeurs renvoyées</a><br/><a href="#Exemplesdebookmarklets">Exemples de bookmarklets</a><br/></div>
<a name="LesBookmarkletsoucommentmodifierlapaged039unsitedepuislabarred039adresse"></a><h2>Les Bookmarklets ou comment modifier la page d&#039;un site depuis la barre d&#039;adresse</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/introduction-101">
<span class="next">Introduction</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-590234" data-claire-element-id="590234">Vous avez déjà voulu voir le code source généré par JavaScript sans ouvrir un débugger ?<br/> Pré-remplir des champs en un clic ?<br/> Connaître la valeur des champs cachés sur une page ?<br/> Ajouter quelque chose dans une page d'un site qui ne vous appartient pas pour le personnaliser sans devoir copier son code source et rendre tous ses liens absolus ?<br/> Ou vous avez tout simplement soif de connaissances ?<br/> Si oui, ce tutoriel est pour vous :)</p>
</div><a name="Introduction"></a><h2>Introduction</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/tp-rajouter-des-smileys">
<span class="next">[TP] Rajouter des smileys</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-590238" data-claire-element-id="590238">Vous avez sans doute déjà vu du JavaScript dans le <code>href</code> de &quot;liens&quot; du genre :</p><pre id="r-590239" data-claire-element-id="590239"><code data-claire-semantic="html">&lt;a href=&quot;javascript:fonction_javascript();&quot;&gt;Lien&lt;/a&gt;</code></pre><aside id="r-590241" data-claire-element-id="590241" data-claire-semantic="error"><p id="r-590240" data-claire-element-id="590240">Ce n'est pas bien ! Il ne faut pas le faire !<br/> Voir <a href="http://www.siteduzero.com/tutoriel-3-102952-bonnes-pratiques-javascript.html#ss_part_5"> le tutoriel sur les bonnes pratiques</a> de <a href="http://www.siteduzero.com/membres-294-2980.html">nod_</a>.</p></aside><p id="r-590242" data-claire-element-id="590242">Eh bien on peut aussi en mettre <strong>directement dans la barre d'adresse</strong> et donc aussi <strong>stocker le code comme favoris/signets dans son navigateur</strong>.<br/> On peut donc faire plein de trucs sympathiques, dont quelques exemples sont donnés dans la dernière partie de ce tutoriel, en cliquant simplement sur un favori/signet dans lequel on aura auparavant enregistré du code JavaScript !<br/> C'est pour cela que ces morceaux de JavaScript précédés de <code>javascript:</code> sont appelés : bookmarklets, applisignets, marque-pages scriptés ou encore favelets.</p><p id="r-590243" data-claire-element-id="590243">Les emplois de ces bookmarklets sont très variés :</p><ul id="r-590268" data-claire-element-id="590268"><li id="r-590254" data-claire-element-id="590254"><p id="r-590244" data-claire-element-id="590244">Pour les développeurs :</p><ul id="r-590253" data-claire-element-id="590253"><li id="r-590246" data-claire-element-id="590246"><p id="r-590245" data-claire-element-id="590245">Afficher le code généré par le JavaScript</p></li><li id="r-590248" data-claire-element-id="590248"><p id="r-590247" data-claire-element-id="590247">Afficher le contenu d'une variable, tester quelque chose sans avoir à se créer une page avec des balises <code data-claire-semantic="html">&lt;script&gt; </code> etc.</p></li><li id="r-590250" data-claire-element-id="590250"><p id="r-590249" data-claire-element-id="590249">Tester un code directement sur un site pour savoir s'il est envisageable de développer un <em>userscript</em> pour ce site</p></li><li id="r-590252" data-claire-element-id="590252"><p id="r-590251" data-claire-element-id="590251">Connaître la valeur d'un champ caché</p></li></ul></li><li id="r-590265" data-claire-element-id="590265"><p id="r-590255" data-claire-element-id="590255">Pour les utilisateurs lambda :</p><ul id="r-590264" data-claire-element-id="590264"><li id="r-590257" data-claire-element-id="590257"><p id="r-590256" data-claire-element-id="590256">Éviter d'attendre sur les sites comme RapidShare et autres</p></li><li id="r-590259" data-claire-element-id="590259"><p id="r-590258" data-claire-element-id="590258">Tricher dans les jeux faits en JavaScript</p></li><li id="r-590261" data-claire-element-id="590261"><p id="r-590260" data-claire-element-id="590260">Remplir des champs si on doit souvent remplir le même formulaire</p></li><li id="r-590263" data-claire-element-id="590263"><p id="r-590262" data-claire-element-id="590262">Connaître l'url d'une vidéo (par exemple sur Youtube) sans chercher dans le code source (si quelqu'un d'autre ou vous même avez pris la peine de regarder le code source pour dire au JavaScript comment y accéder avant)</p></li></ul></li><li id="r-590267" data-claire-element-id="590267"><p id="r-590266" data-claire-element-id="590266">Autres...</p></li></ul><aside id="r-590270" data-claire-element-id="590270" data-claire-semantic="information"><p id="r-590269" data-claire-element-id="590269">Des exemples concrets sont donnés dans la dernière partie de ce tutoriel.</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse">Les Bookmarklets ou comment modifier la page d&#039;un site depuis la barre d&#039;adresse</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/introduction-101">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/tp-rajouter-des-smileys">
[TP] Rajouter des smileys
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/intercepter-les-valeurs-renvoyees">
Intercepter les valeurs renvoyées
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/exemples-de-bookmarklets">
Exemples de bookmarklets
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/tp-rajouter-des-smileys">
<span class="next">[TP] Rajouter des smileys</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="TPRajouterdessmileys"></a><h2>[TP] Rajouter des smileys</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/introduction-101">
<span class="arrow"></span>
<span class="next">Introduction</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/intercepter-les-valeurs-renvoyees">
<span class="next">Intercepter les valeurs renvoyées</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-l-objectif-3" data-claire-element-id="590275">L'objectif</h2><p id="r-590272" data-claire-element-id="590272">L'objectif est de pouvoir utiliser les images présentes dans le pense-bête (montrées par la flèche rouge) comme les smileys du SdZ montrés par la flèche verte).</p><p id="r-590273" data-claire-element-id="590274"><a href="medias/uploads.siteduzero.com_files_187001_188000_187037.jpg"><img id="r-590274" data-claire-element-id="590273" src="medias/uploads.siteduzero.com_thb_187001_188000_187037.jpg" alt="Image utilisateur"/></a></p><h2 id="r-le-contenu-des-onclick" data-claire-element-id="590305">Le contenu des onclick</h2><h3 id="r-enonce-74" data-claire-element-id="590293">Énoncé</h3><p id="r-590276" data-claire-element-id="590276">Nous allons dans un premier temps chercher ce que nous allons mettre dans le <code data-claire-semantic="html">onclick</code> des images.</p><div id="r-590278" data-claire-element-id="590278" data-claire-semantic="question"><p id="r-590277" data-claire-element-id="590277">De quoi avons-nous besoin ?</p></div><ul id="r-590291" data-claire-element-id="590291"><li id="r-590282" data-claire-element-id="590282"><p id="r-590279" data-claire-element-id="590279">Tout d'abord, il faut que vous ayez activé le pense-bete. Si ce n'est pas le cas, utilisez ce bookmarklet qui va ouvrir la page et cocher la case pour vous (il ne vous restera qu'à valider):</p><div id="r-590281" data-claire-element-id="590281"><pre id="r-590280" data-claire-element-id="590280"><code data-claire-semantic="javascript">javascript:
window.open(&quot;infos-286.html&quot;).onload=function() {
	this.document.getElementById(&quot;postit_visible&quot;).checked=&quot;true&quot;;
};
void 0;</code></pre></div></li><li id="r-590286" data-claire-element-id="590286"><p id="r-590283" data-claire-element-id="590283">Ensuite, il faut des images dans le pense-bete... Si vous n'en avez pas, utilisez ce bookmarklet :</p><div id="r-590285" data-claire-element-id="590285"><pre id="r-590284" data-claire-element-id="590284"><code data-claire-semantic="javascript">javascript:
(function(){
	function i(n){
		return '&lt;img src=&quot;http://princessedesanes.free.fr/gifs/kirby/kirbysstar/kirby'+n+'.gif&quot; /&gt;';
	};
	document.getElementById('text_notepad').innerHTML=i('marche')+i('court')+i('nage')+i('epee');
})();</code></pre></div></li><li id="r-590288" data-claire-element-id="590288"><p id="r-590287" data-claire-element-id="590287">Et enfin, il nous faut aussi l'id du textarea : <code>text1</code></p></li><li id="r-590290" data-claire-element-id="590290"><p id="r-590289" data-claire-element-id="590289">Le code JavaScript que le SdZ utilise pour insérer les smileys dans le textarea : <code data-claire-semantic="javascript">balise(':p','','text1');parse('text1','prev_text1'); return false;</code><br/> Le <code data-claire-semantic="javascript">return false;</code> sert normalement à annuler une action (comme un clic sur un lien) mais là, aucune action de ce genre n'a besoin d'être annulée... donc on va s'en passer...<br/> La fonction <code data-claire-semantic="javascript">parse()</code>, on n'a pas besoin d'y toucher.<br/> Ce que l'on va devoir changer, c'est les arguments de la fonction <code data-claire-semantic="javascript">balise()</code>.</p></li></ul><p id="r-590292" data-claire-element-id="590292">A vous de jouer !</p><h3 id="r-indices-5" data-claire-element-id="590300">Indices</h3><div id="r-590299" data-claire-element-id="590299"><p id="r-590294" data-claire-element-id="590294"><code data-claire-semantic="javascript">balise(':p','','text1');</code> insère <code>:p</code> dans le textarea... c'est donc le premier argument qu'il nous faut changer.</p><p id="r-590295" data-claire-element-id="590295">Ce code sera dans le onclick de chaque image. Il faut donc qu'une variable ou qu'un attribut propre à l'image soit utilisé.</p><p id="r-590296" data-claire-element-id="590296">Comme ce code est dans le onclick, on peut utiliser <code data-claire-semantic="javascript">this</code> pour référer à l'image... et on peut donc facilement accéder à ses attributs.</p><p id="r-590297" data-claire-element-id="590297">On peut accéder au <code>src</code> de l'image avec <code data-claire-semantic="javascript">this.src</code>.</p><p id="r-590298" data-claire-element-id="590298">Il ne faut pas oublier les balises zcode <code data-claire-semantic="xml">&lt;image&gt; &lt;/image&gt;</code>.</p></div><h3 id="r-correction-205" data-claire-element-id="590304">Correction</h3><div id="r-590303" data-claire-element-id="590303"><pre id="r-590301" data-claire-element-id="590301"><code data-claire-semantic="javascript">balise('&lt;image&gt;'+this.src+'&lt;/image&gt;','','text1');parse('text1','prev_text1');</code></pre><p id="r-590302" data-claire-element-id="590302">On inclut dans le textarea la balise <code data-claire-semantic="xml">&lt;image&gt; &lt;/image&gt;</code> et l'url de l'image au milieu.</p></div><h2 id="r-rajouter-les-onclick-sur-toutes-les-images" data-claire-element-id="590327">Rajouter les onclick sur toutes les images</h2><h3 id="r-enonce-75" data-claire-element-id="590314">Énoncé</h3><div id="r-590307" data-claire-element-id="590307" data-claire-semantic="question"><p id="r-590306" data-claire-element-id="590306">De quoi avons-nous besoin ?</p></div><ul id="r-590312" data-claire-element-id="590312"><li id="r-590309" data-claire-element-id="590309"><p id="r-590308" data-claire-element-id="590308">L'id du pense-bête : <code>text_notepad</code><br/> On peut donc accéder au pense-bête par <code data-claire-semantic="javascript">document.getElementById('text_notepad')</code> et aux images par <code data-claire-semantic="javascript">document.getElementById('text_notepad').getElementsByTagName('img')</code>.</p></li><li id="r-590311" data-claire-element-id="590311"><p id="r-590310" data-claire-element-id="590310">Une boucle qui rajoute le onclick à chaque image.</p></li></ul><p id="r-590313" data-claire-element-id="590313">C'est à vous :) (N'essayez pas de mettre directement le code dans un bookmarklet. Faites comme un code normal avec sauts de lignes, indentation et tout ce qui va bien.)</p><h3 id="r-indices-6" data-claire-element-id="590322">Indices</h3><div id="r-590321" data-claire-element-id="590321"><p id="r-590315" data-claire-element-id="590315">Une boucle <code data-claire-semantic="javascript">for()</code> peut être un bon choix.</p><pre id="r-590316" data-claire-element-id="590316"><code data-claire-semantic="javascript">var images = document.getElementById('text_notepad').getElementsByTagName('img');
for(var i=0,l=images.length;i&lt;l;i++) {
	//on fait quelque chose :)
}</code></pre><p id="r-590317" data-claire-element-id="590317">Pour mettre un onclick sur l'image on fait :</p><pre id="r-590318" data-claire-element-id="590318"><code data-claire-semantic="javascript">img.onclick = function() {
	//ce qui se passe quand on clic sur l'image
};</code></pre><aside id="r-590320" data-claire-element-id="590320" data-claire-semantic="information"><p id="r-590319" data-claire-element-id="590319">Il existe d'autres façons de le faire mais c'est, de celles qui sont propres et comprises par tous les navigateurs, la plus simple.</p></aside></div><h3 id="r-correction-206" data-claire-element-id="590326">Correction</h3><div id="r-590324" data-claire-element-id="590324"><pre id="r-590323" data-claire-element-id="590323"><code data-claire-semantic="javascript">var images = document.getElementById('text_notepad').getElementsByTagName('img');
for(var i=0,l=images.length;i&lt;l;i++) {
	images[i].onclick=function() {
		balise('&lt;image&gt;'+this.src+'&lt;/image&gt;','','text');parse('text','prev_text');
	};
}</code></pre></div><p id="r-590325" data-claire-element-id="590325">Et voilà, on peut insérer des smileys facilement :) <br/> Pour tester, vous pouvez, par exemple, <a href="http://www.siteduzero.com/tutoriel-51-167589.html">aller poster un commentaire</a> :-°</p><h2 id="r-la-transformation-en-bookmarklet" data-claire-element-id="590330">La transformation en bookmarklet</h2><p id="r-590328" data-claire-element-id="590328">Maintenant, il ne reste qu'à faire tenir ça sur une seule ligne et à rajouter <code>javascript:</code>.<br/> Et voilà le travail :</p><pre id="r-590329" data-claire-element-id="590329"><code data-claire-semantic="javascript">javascript:var images=document.getElementById('text_notepad').getElementsByTagName('img');for(var i=0,l=images.length;i&lt;l;i++){images[i].onclick=function(){balise('&lt;image&gt;'+this.src+'&lt;/image&gt;','','texte');parse('texte','prev_texte');}}</code></pre><h2 id="r-ameliorations-31" data-claire-element-id="590340">Améliorations</h2><p id="r-590331" data-claire-element-id="590331">Même si ce bookmarklet est magnifique et tout et tout (et en plus, il marche !), il est encore possible de l'«améliorer».</p><p id="r-590332" data-claire-element-id="590332">On peut se passer de certains <code>;</code> (ceux qui se trouvent avant des <code>}</code> fermantes et raccourcir le nom des variables, ce qui est bien pratique pour les navigateurs qui limitent le nombre de caractères (je ne donnerai pas de nom :-° ).</p><pre id="r-590333" data-claire-element-id="590333"><code data-claire-semantic="javascript">javascript:var s=document.getElementById('text_notepad').getElementsByTagName('img');for(var i=0,l=s.length;i&lt;l;i++){s[i].onclick=function(){balise('&lt;image&gt;'+this.src+'&lt;/image&gt;','','texte');parse('texte','prev_texte')}}</code></pre><p id="r-590334" data-claire-element-id="590334">Le problème avec notre code, c'est que l'on garde une variable globale...<br/> On va donc utiliser une fonction anonyme que l'on va faire s'exécuter directement. <br/> Ainsi, la variable (<code>images</code> ou <code>s</code>) sera locale et sera donc supprimée à la fin de l'exécution et on libérera un peu de mémoire :) <br/> (De plus, mettre le code dans une closure comme cela permet de ne pas du tout agir sur les variables de la page et donc de ne pas perturber le fonctionnement des scripts)</p><pre id="r-590335" data-claire-element-id="590335"><code data-claire-semantic="javascript">javascript:(function(){var s=document.getElementById('text_notepad').getElementsByTagName('img');for(var i=0,l=s.length;i&lt;l;i++){s[i].onclick=function(){balise('&lt;image&gt;'+this.src+'&lt;/image&gt;','','texte');parse('texte','prev_texte');}}})()</code></pre><p id="r-590336" data-claire-element-id="590336">Si vous ne comprenez pas ce dernier code, vous pouvez aller voir <a href="http://www.siteduzero.com/tutoriel-3-123380-les-closures-en-javascript.html#ss_part_">le tutoriel sur les closures</a> de <a href="http://www.siteduzero.com/membres-294-28821.html">Darkodam</a>.</p><p id="r-590337" data-claire-element-id="590337">P.S. : Je ne vous l'ai pas dit avant parce que sinon, vous n'auriez sans doute pas cherché à comprendre comment on compresse, mais il existe des sites qui le font pour vous comme par exemple <a href="http://closure-compiler.appspot.com/home">http://closure-compiler.appspot.com/home</a> :-°</p><aside id="r-590339" data-claire-element-id="590339" data-claire-semantic="information"><p id="r-590338" data-claire-element-id="590338">Afin de garder les codes lisibles, je ne mettrai plus les codes sous forme de bookmarklets exception faite des codes d'une seule ligne.<br/> À vous de rajouter le préfixe <code data-claire-semantic="javascript">javascript:</code>.<br/> Pour ce qui est du fait de tout mettre sur une ligne, cela peut être faire en copiant un code sur plusieurs lignes et en le copiant directement dans la barre d'adresse (le navigateur se chargera de supprimer les retours à la ligne).<br/> Attention toutefois aux commentaires <code data-claire-semantic="javascript">//</code> qui au lieu de mettre en commentaire seulement la ligne qui suit mettrait toute la suite du code en commentaire.</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse">Les Bookmarklets ou comment modifier la page d&#039;un site depuis la barre d&#039;adresse</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/introduction-101">
Introduction
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/tp-rajouter-des-smileys">
[TP] Rajouter des smileys
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/intercepter-les-valeurs-renvoyees">
Intercepter les valeurs renvoyées
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/exemples-de-bookmarklets">
Exemples de bookmarklets
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/introduction-101">
<span class="arrow"></span>
<span class="next">Introduction</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/intercepter-les-valeurs-renvoyees">
<span class="next">Intercepter les valeurs renvoyées</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Intercepterlesvaleursrenvoyes"></a><h2>Intercepter les valeurs renvoyées</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/tp-rajouter-des-smileys">
<span class="arrow"></span>
<span class="next">[TP] Rajouter des smileys</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/exemples-de-bookmarklets">
<span class="next">Exemples de bookmarklets</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-le-probleme-22" data-claire-element-id="590350">Le problème</h2><p id="r-590342" data-claire-element-id="590342">Certains d'entre vous ont dû être très déçus en essayant de continuer tout seuls ; en essayant par exemple de changer la couleur de fond du <code data-claire-semantic="html">&lt;body&gt; </code> avec : <code data-claire-semantic="javascript">javascript:document.body.style.backgroundColor=&quot;pink&quot;; </code> (ou toute autre assignation avec le signe <code>=</code>) et en se retrouvant avec <code>pink</code> (ou la valeur assignée) écrit sur leur page... qui est devenue complètement blanche... Ils ont paniqué, rafraîchi la page et vu que ça redevenait normal.</p><div id="r-590344" data-claire-element-id="590344" data-claire-semantic="question"><p id="r-590343" data-claire-element-id="590343">Que s'est-il passé ?</p></div><p id="r-590345" data-claire-element-id="590345">En gros, quand on fait <code data-claire-semantic="javascript">document.body.style.backgroundColor=&quot;pink&quot;; </code>, le JavaScript renvoie &quot;pink&quot; car quand on affecte une valeur à une variable, la valeur renvoyée est la valeur affectée.<br/> D'où :</p><pre id="r-590346" data-claire-element-id="590346"><code data-claire-semantic="javascript">var a,b,c;
a=b=c=1;
alert(a);//1
alert(b);//1
alert(c);//1</code></pre><p id="r-590347" data-claire-element-id="590347">On peut vérifier en faisant :</p><pre id="r-590348" data-claire-element-id="590348"><code data-claire-semantic="javascript">javascript:alert(document.body.style.backgroundColor=&quot;pink&quot;);</code></pre><p id="r-590349" data-claire-element-id="590349">Et là, ô miracle, le fond devient rose.<br/> Et le <code data-claire-semantic="javascript">alert() </code> affiche bien pink.<br/> Il faut donc utiliser une fonction pour qu'elle récupère ce qu'aurait dû renvoyer le JavaScript et que rien ne soit renvoyé.</p><h2 id="r-ne-rien-renvoyer-au-navigateur" data-claire-element-id="590379">Ne rien renvoyer au navigateur</h2><p id="r-590351" data-claire-element-id="590351">Nous savons que quand on assigne une valeur, cette valeur est renvoyée.</p><pre id="r-590352" data-claire-element-id="590352"><code data-claire-semantic="javascript">javascript:document.body.style.backgroundColor=&quot;red&quot;;
//renvoie &quot;red&quot;</code></pre><p id="r-590353" data-claire-element-id="590353">Ce qui aboutit à l'affichage de ce qui est renvoyé...</p><p id="r-590354" data-claire-element-id="590354">Nous savons aussi qu'en le mettant dans un <code data-claire-semantic="javascript">alert() </code>, le code est exécuté normalement.</p><pre id="r-590355" data-claire-element-id="590355"><code data-claire-semantic="javascript">javascript:alert(document.body.style.backgroundColor=&quot;yellow&quot;);
//le alert() capture la valeur renvoyée</code></pre><p id="r-590356" data-claire-element-id="590356">Nous devons donc savoir ce que renvoie le <code data-claire-semantic="javascript">alert() </code> pour renvoyer la même chose.<br/> Nous allons donc faire :</p><pre id="r-590357" data-claire-element-id="590357"><code data-claire-semantic="javascript">javascript:alert(alert(document.body.style.backgroundColor=&quot;blue&quot;));</code></pre><p id="r-590358" data-claire-element-id="590358">Et là, on voit que c'est <code data-claire-semantic="javascript">undefined </code> qui est renvoyée.</p><h3 id="r-la-solution-simple-void" data-claire-element-id="590363">La solution simple : <code data-claire-semantic="javascript">void</code></h3><p id="r-590359" data-claire-element-id="590359">On Google-ise un peu et on voit un opérateur a été prévu pour faire ça : <code data-claire-semantic="javascript"><a href="https://developer.mozilla.org/fr/Référence_de_JavaScript_1.5_Core/Opérateurs/Opérateurs_spéciaux/L%27opérateur_void">void() </a></code>.<br/> Il évalue l'expression qui lui est donnée (donc il faut lui donner un paramètre) et renvoie <code data-claire-semantic="javascript">undefined </code>.</p><p id="r-590360" data-claire-element-id="590360">Il peut s'utiliser de plusieurs façons :</p><pre id="r-590361" data-claire-element-id="590361"><code data-claire-semantic="javascript">javascript:document.body.style.backgroundColor='green';void(0)
//ou
javascript:document.body.style.backgroundColor='purple';void 0
//ou
javascript:void(document.body.style.backgroundColor='orange')</code></pre><p id="r-590362" data-claire-element-id="590362">Les exemples ont été mis dans mon ordre de préférence.<br/> Je préfère personnellement les deux premiers, car ils sont clairs et permettent, en enlevant <code data-claire-semantic="javascript">javascript: </code> et <code data-claire-semantic="javascript">void(0) /* ou */ void 0 </code>, d'obtenir du code JavaScript pouvant être utilisé dans une page web.<br/> Après, vous choisissez. Tous marchent (en théorie) sur tous les navigateurs.</p><h3 id="r-la-solution-correcte-mais-pas-compatible-avec-tous-les-navigateurs-return-undefined" data-claire-element-id="590369">La solution correcte mais pas compatible avec tous les navigateurs : <code data-claire-semantic="javascript">return undefined</code></h3><p id="r-590364" data-claire-element-id="590364">Cet opérateur est cependant déprécié en raison du fait que dans la plupart des langages, <code>void</code> est un type de variable alors qu'en JavaScript, c'est une fonction qui renvoie <code data-claire-semantic="javascript">undefined </code> et qu'il peut donc porter à confusion.<br/> Elle n'est donc pas acceptée par <a href="http://www.jslint.com/lint.html">JSLint</a> (une sorte de vérificateur de code JavaScript fait par <a href="http://en.wikipedia.org/wiki/Douglas_Crockford">Douglas Crockford</a>, l'expert JavaScript actuel) qui permet de coder proprement et sans erreurs (enfin qui le signale si ce n'est pas le cas). <br/> Il existe bien sûr une alternative qui passe à ce &quot;validateur JavaScript&quot; : <code data-claire-semantic="javascript">return undefined </code>.</p><pre id="r-590365" data-claire-element-id="590365"><code data-claire-semantic="javascript">javascript:document.body.style.backgroundColor='black';return undefined</code></pre><p id="r-590366" data-claire-element-id="590366">Cependant, certains navigateurs (et cette fois IE n'est pas le seul :-° ) n'acceptent pas les <code data-claire-semantic="javascript">return </code> dans la barre d'adresse (enfin dans les bookmarklets quoi).</p><aside id="r-590368" data-claire-element-id="590368" data-claire-semantic="information"><p id="r-590367" data-claire-element-id="590367">Comme vous l'avez sans doute remarqué, je n'ai jusqu'à présent utilisé aucune closure dans cette partie.<br/> Cela est dû au fait que nous avons changé la valeur d'attributs déjà existants et qu'aucune variable autre n'a été créée (dans le cas contraire, une <a href="http://www.siteduzero.com/tutoriel-3-123380-les-closures-en-javascript.html">closure</a> aurait été utile pour éviter que la variable ne continue d'occuper de la mémoire après la fin de l'exécution du bookmarklet).</p></aside><h3 id="r-la-meilleure-solution-les-closures" data-claire-element-id="590378">La meilleure solution : les closures</h3><aside id="r-590371" data-claire-element-id="590371" data-claire-semantic="information"><p id="r-590370" data-claire-element-id="590370">Pour comprendre cette partie du tutoriel, il faut savoir ce que sont <a href="http://www.siteduzero.com/tutoriel-3-123380-les-closures-en-javascript.html">les closures</a>. Je vous conseil donc d'aller lire <a href="http://www.siteduzero.com/tutoriel-3-123380-les-closures-en-javascript.html">ce superbe tutoriel</a> de <a href="http://www.siteduzero.com/tutoriel-3-123380-les-closures-en-javascript.html">Darkodam</a>.</p></aside><p id="r-590372" data-claire-element-id="590372">Comme vous le savez tous, une fonction ne renvoit une valeur qui si elle comporte une instruction <code data-claire-semantic="javascript">return </code>.</p><pre id="r-590373" data-claire-element-id="590373"><code data-claire-semantic="javascript">function test() {
	alert('cette fonction ne sert à rien');
}
alert(test());//undefined</code></pre><p id="r-590374" data-claire-element-id="590374">nous pouvons donc utiliser une closure afin d'intercepter le retour et d'empêcher ce retour de s'afficher à la place de la page HTML.</p><pre id="r-590375" data-claire-element-id="590375"><code data-claire-semantic="javascript">javascript:(function(){document.body.style.backgroundColor='aqua';})();</code></pre><p id="r-590376" data-claire-element-id="590376">Cette façon de faire, bien que compliquée au premier abord permet, comme nous l'avons vu, en plus d'intercepter les retours, d'éviter de créer des variables globales qui pourraient nuire au fonctionnement du javascript déjà présent sur le site.<br/> Elle est valide du point de vue de JSlint.</p><p id="r-590377" data-claire-element-id="590377">C'est la méthode à privilégier et celle que j'emploierais dans la suite de ce tutoriel.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse">Les Bookmarklets ou comment modifier la page d&#039;un site depuis la barre d&#039;adresse</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/introduction-101">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/tp-rajouter-des-smileys">
[TP] Rajouter des smileys
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/intercepter-les-valeurs-renvoyees">
Intercepter les valeurs renvoyées
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/exemples-de-bookmarklets">
Exemples de bookmarklets
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/tp-rajouter-des-smileys">
<span class="arrow"></span>
<span class="next">[TP] Rajouter des smileys</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/exemples-de-bookmarklets">
<span class="next">Exemples de bookmarklets</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Exemplesdebookmarklets"></a><h2>Exemples de bookmarklets</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/intercepter-les-valeurs-renvoyees">
<span class="arrow"></span>
<span class="next">Intercepter les valeurs renvoyées</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-590381" data-claire-element-id="590381">Vous savez maintenant vous servir des bookmarklets (c'était dur hein :p ). Nous allons donc nous pencher sur certains exemples concrets.</p><aside id="r-590383" data-claire-element-id="590383" data-claire-semantic="information"><p id="r-590382" data-claire-element-id="590382">Si aucun exemple ne vous intéresse, sachez que si vous avez de bonnes connaissances en JavaScript (hors bookmarklets), ils ne vous apprendront rien (ou presque rien).</p></aside><h2 id="r-desactiver-un-anti-clic-droit" data-claire-element-id="590403">Désactiver un anti-clic droit</h2><p id="r-590384" data-claire-element-id="590384">Il nous fait savoir comment les sites font pour désactiver le clic droit.<br/> Il existe deux méthodes :</p><ul id="r-590389" data-claire-element-id="590389"><li id="r-590386" data-claire-element-id="590386"><p id="r-590385" data-claire-element-id="590385">Mettre une fonction contenant un <code data-claire-semantic="javascript">return false; </code> au oncontextmenu de l'élément <code data-claire-semantic="javascript">window </code> ou de <code data-claire-semantic="javascript">document.body</code></p></li><li id="r-590388" data-claire-element-id="590388"><p id="r-590387" data-claire-element-id="590387">Mettre une fonction qui fait <code data-claire-semantic="javascript">return false; </code> au onclick (après avoir vérifié que c'était un clic droit) de l'élément <code data-claire-semantic="javascript">window </code> ou de <code data-claire-semantic="javascript">document.body</code></p></li></ul><p id="r-590390" data-claire-element-id="590390">Pour information, un <code data-claire-semantic="javascript">return false </code>, lorsqu'il est renvoyé par une fonction associée à un évènement, il annule l'évènement.<br/> Ainsi, <code data-claire-semantic="html">&lt;a href=&quot;http://www.google.fr&quot; onclick=&quot;return false;&quot;&gt;Google&lt;/a&gt; </code> n'enverra jamais celui qui clic dessus sur Google si il a activé le JavaScript.</p><p id="r-590391" data-claire-element-id="590391">Il nous faut donc empêcher ces retours (et donc enlever ces fonctions) associés à ces évènements.<br/> On peut remplacer ces fonctions par :</p><ul id="r-590396" data-claire-element-id="590396"><li id="r-590393" data-claire-element-id="590393"><p id="r-590392" data-claire-element-id="590392">des fonctions vides (qu'on peut faire anonyme au passage) : <code data-claire-semantic="javascript">function(){}</code></p></li><li id="r-590395" data-claire-element-id="590395"><p id="r-590394" data-claire-element-id="590394">le mot clef <code data-claire-semantic="javascript">undefined</code></p></li></ul><p id="r-590397" data-claire-element-id="590397">Nous pouvons donc faire :</p><pre id="r-590398" data-claire-element-id="590398"><code data-claire-semantic="javascript">window.oncontextmenu = undefined; //ou function(){}
window.onclick = undefined; //ou function(){}
document.body.onclick = undefined; //ou function(){}
document.body.oncontextmenu = undefined; //ou function(){}</code></pre><p id="r-590399" data-claire-element-id="590399">Or comme <code data-claire-semantic="javascript">a = b = 1;alert(&quot;a:&quot;+a+&quot; b:&quot;+b);//a:1 b:1 </code>, on peut faire :</p><pre id="r-590400" data-claire-element-id="590400"><code data-claire-semantic="javascript">window.oncontextmenu = window.onclick = document.body.onclick = document.body.oncontextmenu = undefined; //ou function(){}</code></pre><p id="r-590401" data-claire-element-id="590401">On va stocker <code data-claire-semantic="javascript">document.body </code> dans <code data-claire-semantic="javascript">b </code> et <code data-claire-semantic="javascript">window </code> dans <code data-claire-semantic="javascript">w </code>, ce qui nous permettra de ne les écrire qu'une fois (et dans dans le cas de <code data-claire-semantic="javascript">document.body </code>, d'éviter de rechercher <code data-claire-semantic="javascript">body </code> dans <code data-claire-semantic="javascript">document </code> à chaque fois).<br/> On a donc ce bookmarklet :</p><pre id="r-590402" data-claire-element-id="590402"><code data-claire-semantic="javascript">javascript:(function(){var w=window,b=document.body;w.onclick=w.oncontextmenu=b.onclick=b.oncontextmenu=function(){}})();</code></pre><h2 id="r-afficher-le-code-html-genere-par-le-javascript-d-une-page" data-claire-element-id="590408">Afficher le code HTML généré par le javascript d'une page</h2><p id="r-590404" data-claire-element-id="590404">Pour afficher du code, le plus simple est (à l'heure où j'écris ce tutoriel) de le mettre dans un textarea.<br/> C'est donc ce que nous allons faire.<br/> On va faire en sorte que le <code data-claire-semantic="javascript">innerHTML </code> du corps de la page (<code data-claire-semantic="javascript">document.body </code>) soit entouré par <code data-claire-semantic="html">&lt;textarea&gt; </code> et <code data-claire-semantic="html">&lt;/textarea&gt; </code>.</p><p id="r-590405" data-claire-element-id="590405">On fait donc :<br/><code data-claire-semantic="javascript">javascript:document.body.innerHTML='&lt;textarea&gt;'+document.body.innerHTML+'&lt;/textarea&gt;' </code><br/> Mais là, le code est affiché dans un textarea minuscule.<br/> On va donc lui mettre un attribut <code data-claire-semantic="javascript">style </code> et écrire dedans que la largeur et la hauteur sont égales à 100% de celles de l'élément parent :<br/><code data-claire-semantic="javascript">javascript:document.body.innerHTML='&lt;textarea style=&quot;width:100%;height:100%;&quot;&gt;'+document.body.innerHTML+'&lt;/textarea&gt;' </code><br/> Et voilà le tour est joué :)</p><aside id="r-590407" data-claire-element-id="590407" data-claire-semantic="information"><p id="r-590406" data-claire-element-id="590406">Les exemples suivants s'appliquant au SdZ et le SdZ utilisant Jquery, les codes suivants utiliseront JQuery.<br/> La connaissance de JQuery n'est pas forcément necessaire à la compréhension de ces codes dans la mesure où nous ne ferons que réutiliser des morceaux de code mais peut tout de même servir.<br/> Je vous conseille cependant de lire le tutoriel de <a href="http://www.siteduzero.com/membres-294-116568.html">MisterDo</a> et <a href="http://www.siteduzero.com/membres-294-38883.html">tit_toinou</a> : <a href="http://www.siteduzero.com/tutoriel-3-160891-jquery-ecrivez-moins-pour-faire-plus.html">http://www.siteduzero.com/tutoriel-3-1 [...] ire-plus.html</a>.</p></aside><h2 id="r-vider-son-pense-bete" data-claire-element-id="590439">Vider son pense-bête</h2><aside id="r-590410" data-claire-element-id="590410" data-claire-semantic="warning"><p id="r-590409" data-claire-element-id="590409">Si vous tenez à ce que contient votre pense-bête, pensez à sauvegarder son contenu quelque part, car on ne va pas seulement vider le pense-bête sur la page actuelle, mais bien dans la BDD du SdZ !</p></aside><p id="r-590411" data-claire-element-id="590411">Vous avez sans doute souvent plein de choses qui datent dans votre pense-bête sur le SdZ...<br/> Et vous avez la flemme d'aller l'éditer...<br/> Eh bien vous pouvez le vider avec un &quot;simple&quot; bookmarklet.</p><p id="r-590412" data-claire-element-id="590412">Tout d'abord, étudions le code qui permet au SdZ de proposer l'édition du pense-bête sans recharger la page :</p><pre id="r-590413" data-claire-element-id="590413"><code data-claire-semantic="javascript">$(&quot;#menu_notepad h5 a&quot;).click(function(f){var h=&quot;&lt;p class=&amp;#92;'centre&amp;#92;'&gt;&lt;img src=&amp;#92;'Templates/images/designs/2/loading.gif&amp;#92;' /&gt;&lt;/p&gt;&quot;;f.preventDefault();$.post(&quot;ajax.php?do=xml_edit_notepad&quot;,{to_unparse:$.trim($(&quot;#text_notepad&quot;).html())},function(j){f.preventDefault();$(&quot;#text_notepad&quot;).html('&lt;textarea id=&quot;text_notepad_modify&quot; onblur=&quot;'+g+'&quot;&gt;'+j+&quot;&lt;/textarea&gt;&quot;);$(&quot;#text_notepad_modify&quot;).focus()});var e=&quot;$.trim($('#text_notepad_modify').val())&quot;;var g=&quot;event.preventDefault();$.post('ajax.php?do=xml_edit_notepad', {new_notepad:&quot;+e+&quot;}, function(data2){$('#text_notepad').html(data2);});$('#text_notepad').html('&quot;+h+&quot;');&quot;});</code></pre><p id="r-590414" data-claire-element-id="590414">Et là, vous vous dites : &quot;Cool, c'est bien parti &gt;_ &quot;.<br/> Ne vous inquiétez pas, ce n'est pas long d'indenter et d'arriver à un code lisible. Mais avant cela, nous allons vérifier que c'est bien ce code :</p><pre id="r-590415" data-claire-element-id="590415"><code data-claire-semantic="javascript">javascript:$(&quot;#menu_notepad h5 a&quot;).click()</code></pre><p id="r-590416" data-claire-element-id="590416">Eh oui, c'est bien le bon code :) <br/> On indente donc :</p><pre id="r-590417" data-claire-element-id="590417"><code data-claire-semantic="javascript">$(&quot;#menu_notepad h5 a&quot;).click(//on définit le onclick
	function(f){//c'est une fonction anonyme
		var h=&quot;&lt;p class=&amp;#92;'centre&amp;#92;'&gt;&lt;img src=&amp;#92;'Templates/images/designs/2/loading.gif&amp;#92;' /&gt;&lt;/p&gt;&quot;;//on définit le code HTML à mettre pendant le chargement
		f.preventDefault();//on évite que ça fasse des trucs implicites donc on a pas besoin
		$.post(//on post qqch en ajax
			&quot;ajax.php?do=xml_edit_notepad&quot;, //l'url
			{
				to_unparse:$.trim($(&quot;#text_notepad&quot;).html())//les valeurs envoyées (à savoir le HTML de votre notepad qui va être déparsé puis qui vous sera renvoyé comme zcode)
			},
			function(j){//la fonction de callback :
				f.preventDefault();//pareil, on évite les trucs par défaut qui peuvent nous emm*****
				$(&quot;#text_notepad&quot;).html('&lt;textarea id=&quot;text_notepad_modify&quot; onblur=&quot;'+g+'&quot;&gt;'+j+&quot;&lt;/textarea&gt;&quot;);//on met un textarea dans le notepad avec comme contenu le retour (le HTML déparssé et redevenu du zcode) et on met en onblur une fonction qui aura été définie [elle est plus bas dans le code])
				$(&quot;#text_notepad_modify&quot;).focus()//on met le focus sur le notepad
			}
		);
		var e=&quot;$.trim($('#text_notepad_modify').val())&quot;;//on vire les espaces en début et fin de ligne. (enfin on stocke ça dans une chaîne pour la rajoute r dans du HTML plus tard
		//là, on a une giga chaîne... je la met en plusieurs ligne pour pouvoir détailler.
		//mais en théorie, c'est une seule ligne. C'est ce qui est mis au onblur au textarea d'édition
		var g=&quot;
			event.preventDefault(); //tjrs pareil
			$.post(//tjrs pareil
				'ajax.php?do=xml_edit_notepad', //l'url
				{new_notepad:&quot;+e+&quot;}, //les données envoyées
				function(data2){ //la fonction callback
					$('#text_notepad').html(data2); //qui met le retour dans le notepad
				}
			);
			$('#text_notepad').html('&quot;+h+&quot;');//on met le code HTML du chargement en attendant le callback.
		&quot;
	}
);</code></pre><p id="r-590418" data-claire-element-id="590418">Bon... à ce stade-là, le code ne sert à rien...<br/> On va donc changer quelques trucs.</p><p id="r-590419" data-claire-element-id="590419">Premièrement,</p><pre id="r-590420" data-claire-element-id="590420"><code data-claire-semantic="javascript">$(&quot;#menu_notepad h5 a&quot;).click(
	function(f){</code></pre><p id="r-590421" data-claire-element-id="590421">ne nous sert à rien car on n'a pas besoin de rajouter le onclick mais d'effectuer directement la fonction donc on l'enlève.</p><p id="r-590422" data-claire-element-id="590422">Ensuite,</p><pre id="r-590423" data-claire-element-id="590423"><code data-claire-semantic="javascript">f.preventDefault();
$.post(
	&quot;ajax.php?do=xml_edit_notepad&quot;,
	{
		to_unparse:$.trim($(&quot;#text_notepad&quot;).html())
	},
	function(j){
		f.preventDefault();
		$(&quot;#text_notepad&quot;).html('&lt;textarea id=&quot;text_notepad_modify&quot; onblur=&quot;'+g+'&quot;&gt;'+j+&quot;&lt;/textarea&gt;&quot;);
		$(&quot;#text_notepad_modify&quot;).focus()
	}
);</code></pre><p id="r-590424" data-claire-element-id="590424">ne nous sert pas dans la mesure où on ne veut pas éditer mais simplement envoyer les données à modifier.</p><p id="r-590425" data-claire-element-id="590425">Enfin,</p><pre id="r-590426" data-claire-element-id="590426"><code data-claire-semantic="javascript">var e=&quot;$.trim($('#text_notepad_modify').val())&quot;;</code></pre><p id="r-590427" data-claire-element-id="590427">ne nous sert pas car on va envoyer une valeur vide...<br/> Il est donc inutile d'enlever les espaces en début ou fin de ligne...<br/> On va donc le supprimer et comme on ne veut pas insérer la valeur du <code data-claire-semantic="html">&lt;textarea&gt; </code> mais rien, on va remplacer la variable <code data-claire-semantic="javascript">e </code> par <code data-claire-semantic="javascript">'' </code> (une chaîne vide).</p><p id="r-590428" data-claire-element-id="590428">Il nous reste :</p><pre id="r-590429" data-claire-element-id="590429"><code data-claire-semantic="javascript">var h=&quot;&lt;p class=&amp;#92;'centre&amp;#92;'&gt;&lt;img src=&amp;#92;'Templates/images/designs/2/loading.gif&amp;#92;' /&gt;&lt;/p&gt;&quot;;
var g=&quot;
	event.preventDefault();
	$.post(
		'ajax.php?do=xml_edit_notepad',
		{new_notepad:&quot;+''+&quot;},
		function(data2){
			$('#text_notepad').html(data2);
		}
	);
	$('#text_notepad').html('&quot;+h+&quot;');
&quot;</code></pre><p id="r-590430" data-claire-element-id="590430">Vu qu'on ne va pas y mettre directement dans du HTML, on va les sortir des variables et on va placer <code data-claire-semantic="javascript">h </code> (le HTML pour le chargement) à l'endroit où il était normalement ajouté par le biais de sa variable.<br/> On n'oublie bien sûr pas de remplacer <code data-claire-semantic="javascript">{new_notepad:&quot;+''+&quot;}, </code> par <code data-claire-semantic="javascript">{new_notepad:''}, </code>.<br/> On obtient :</p><pre id="r-590431" data-claire-element-id="590431"><code data-claire-semantic="javascript">event.preventDefault();
$.post(
	'ajax.php?do=xml_edit_notepad',
	{new_notepad:''}, 
	function(data2){
		$('#text_notepad').html(data2);
	}
);
$('#text_notepad').html('&lt;p class=&quot;centre&quot;&gt;&lt;img src=&quot;Templates/images/designs/2/loading.gif&quot; /&gt;&lt;/p&gt;');</code></pre><p id="r-590432" data-claire-element-id="590432">Le <code data-claire-semantic="javascript">event.preventDefault(); </code> ne nous sert à rien donc on l'enlève :</p><pre id="r-590433" data-claire-element-id="590433"><code data-claire-semantic="javascript">$.post(
	'ajax.php?do=xml_edit_notepad',
	{new_notepad:''}, 
	function(data2){
		$('#text_notepad').html(data2);
	}
);
$('#text_notepad').html('&lt;p class=&quot;centre&quot;&gt;&lt;img src=&quot;Templates/images/designs/2/loading.gif&quot; /&gt;&lt;/p&gt;');</code></pre><p id="r-590434" data-claire-element-id="590434">On test... et là, magie, le pense-bête se vide !<br/> On a cependant un problème : Si on laisse le pense-bête tel quel, il va disparaître à la prochaine réactualisation de la page.<br/> On va donc remplacer la chaîne vide par une chaîne contenant un espace :</p><pre id="r-590435" data-claire-element-id="590435"><code data-claire-semantic="javascript">$.post(
	'ajax.php?do=xml_edit_notepad',
	{new_notepad:' '}, 
	function(data2){
		$('#text_notepad').html(data2);
	}
);
$('#text_notepad').html('&lt;p class=&quot;centre&quot;&gt;&lt;img src=&quot;Templates/images/designs/2/loading.gif&quot; /&gt;&lt;/p&gt;');</code></pre><p id="r-590436" data-claire-element-id="590436">Et voilà, vous pouvez vider votre pense-bête en un clic :) <br/> (D'après mes calculs, vu le temps que vous avez mis à créer ce bookmarklet, si vous venez une fois par jour sur le SdZ et en vidant votre pense-bête en arrivant, ça deviendra rentable niveau temps si vous vivez encore plus de 100 ans :-° )</p><p id="r-590437" data-claire-element-id="590437">Je tiens à remercier les validateurs pour avoir validé ce tutoriel (et plus particulièrement <a href="http://www.siteduzero.com/membres-294-1398.html">Thunderseb</a> qui l'a fait le premier) ainsi que <a href="http://www.siteduzero.com/membres-294-38883.html">tit_toinou</a> et <a href="http://www.siteduzero.com/membres-294-123919.html">Golmote</a> pour m'avoir donné des avis externes, conseillé et vous avoir évité de voir des abominations syntaxiques, orthographiques et autres et enfin <a href="http://www.siteduzero.com/membres-294-46735.html">Tiller</a> pour m'avoir fait remarquer que le <code data-claire-semantic="javascript">return undefined;</code> ne marchait pas partout.</p><p id="r-590438" data-claire-element-id="590438">Voilà, vous savez tout :) <br/> Ceci est mon premier tutoriel, donc soyez indulgents dans <a href="http://www.siteduzero.com/tutoriel-51-167589.html">les commentaires</a> :-°</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse">Les Bookmarklets ou comment modifier la page d&#039;un site depuis la barre d&#039;adresse</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/introduction-101">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/tp-rajouter-des-smileys">
[TP] Rajouter des smileys
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/intercepter-les-valeurs-renvoyees">
Intercepter les valeurs renvoyées
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/exemples-de-bookmarklets">
Exemples de bookmarklets
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse/intercepter-les-valeurs-renvoyees">
<span class="arrow"></span>
<span class="next">Intercepter les valeurs renvoyées</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 11:07:08 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/les-bookmarklets-ou-comment-modifier-la-page-d-un-site-depuis-la-barre-d-adresse.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:47:37 GMT -->
</html>