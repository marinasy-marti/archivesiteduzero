<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/un-systeme-simplifie-de-gestion-de-contenu.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:19:28 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/un-systeme-simplifie-de-gestion-de-contenu.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:33:03 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Un système simplifié de gestion de contenu</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Un système simplifié de gestion de contenu</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Unsystmesimplifidegestiondecontenu">Un système simplifié de gestion de contenu</a><br/><a href="#Structuregnraledusystmedecontenu">Structure générale du système de contenu</a><br/><a href="#Fonctionnementdtailldelamthodedegestion">Fonctionnement détaillé de la méthode de gestion</a><br/><a href="#Pourallerplusloin...">Pour aller plus loin...</a><br/></div>
<a name="Unsystmesimplifidegestiondecontenu"></a><h2>Un système simplifié de gestion de contenu</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu/structure-generale-du-systeme-de-contenu">
<span class="next">Structure générale du système de contenu</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-454508" data-claire-element-id="454508">La plupart des sites Web n'ont pas l'ambition, ni l'utilité, de faire usage d'un système de <em>templates</em> classique. Pour la plupart d'entre eux, au contraire, structure et contenu peuvent cohabiter sans problème.</p><div id="r-454510" data-claire-element-id="454510" data-claire-semantic="question"><p id="r-454509" data-claire-element-id="454509">Dans ce cas, en quoi un système simplifié de gestion de contenu peut se justifier ?</p></div><p id="r-454511" data-claire-element-id="454511">Imaginons que vous envisagiez, dans un avenir plus ou moins proche, de traduire votre site (en anglais, par exemple) : avec le système simplifié que nous allons étudier, nul besoin de reprendre une par une les différentes pages ; il vous suffit de traduire le seul fichier renfermant les contenus textuels. Autre hypothèse, vous décidez de confier le développement du script à un collègue, tandis que vous prenez en charge le contenu du projet ; dans ce cas, vous n'avez qu'à vous focaliser sur le fichier du contenu textuel.</p><p id="r-454512" data-claire-element-id="454512">D'une manière plus globale, la méthode exposée ci-après présente tous les avantages d'un développement propre, séparant structure et contenu. Commençons donc sans plus tarder !</p>
</div><a name="Structuregnraledusystmedecontenu"></a><h2>Structure générale du système de contenu</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu/fonctionnement-detaille-de-la-methode-de-gestion">
<span class="next">Fonctionnement détaillé de la méthode de gestion</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<aside id="r-454514" data-claire-element-id="454514" data-claire-semantic="warning"><p id="r-454513" data-claire-element-id="454513"><strong>Une recommandation importante avant toute chose</strong> : Pour rendre optimale cette méthode de gestion de contenu, il est vivement conseillé d'adopter un système d'<em>includes</em>, consistant en une inclusion de toutes vos pages dans le fichier index.php.</p></aside><p id="r-454515" data-claire-element-id="454515"><a href="http://www.siteduzero.com/tuto-3-1720-1-systeme-d-includes-securisees.html">Ce tutoriel sur les includes</a> peut alors vous intéresser.<br/> Si toutefois vous ne pouvez ni ne voulez utiliser ce système, une solution existe, mais elle est plus lourde à mettre en œuvre. Je la traiterai également.</p><p id="r-454516" data-claire-element-id="454516">Bien. Voyons à présent l'idée générale de notre méthode.</p><h2 id="r-prerequis-22" data-claire-element-id="454523">Prérequis</h2><h3 id="r-sur-les-acquis-theoriques" data-claire-element-id="454518">Sur les acquis théoriques</h3><p id="r-454517" data-claire-element-id="454517">Ce tutoriel ne fait pas appel à de bouleversantes nouveautés, mais il combine bon nombre de méthodes relativement avancées. Pour cette raison, il est bon d'avoir lu <a href="http://www.siteduzero.com/tuto-3-4-0-un-site-dynamique-avec-php.html">le tutoriel de M@teo21 sur le PHP</a> (un incontournable, me direz-vous), et d'être familier de <a href="http://www.php.net/">la documentation PHP</a> vers laquelle je renverrai un certain nombre de fois.</p><h3 id="r-sur-la-structure-de-votre-site" data-claire-element-id="454520">Sur la structure de votre site</h3><p id="r-454519" data-claire-element-id="454519">Outre la remarque précédente, je suppose que nous avons à disposition un fichier configuration.php, un fichier index.php, un fichier lang.php, un fichier en-tete.php et un fichier pied.php dans le même répertoire, pour simplifier.</p><h3 id="r-hebergement-web" data-claire-element-id="454522">Hébergement Web</h3><p id="r-454521" data-claire-element-id="454521">Cette méthode a été testée et appliquée avec succès chez Free. Si vous rencontrez une incompatibilité avec d'autres hébergeurs, n'hésitez pas à le signaler dans vos commentaires !</p><h2 id="r-idee-generale" data-claire-element-id="454536">Idée générale</h2><p id="r-454524" data-claire-element-id="454524">La plupart des fichiers PHP mêlent le code et le contenu. On écrira ainsi par exemple :</p><pre id="r-454525" data-claire-element-id="454525"><code data-claire-semantic="html+php">&lt;?php
$reponse = 42;
$proposition = $_GET['proposition'];

if ($reponse == $proposition)
{
	echo '&lt;p&gt;Félicitations ! Vous avez trouvé la réponse (42) !&lt;/p&gt;';
}
else
{
	echo '&lt;p&gt;Retentez votre chance !&lt;/p&gt;';
}
?&gt;</code></pre><p id="r-454526" data-claire-element-id="454526">J'en conviens, l'intérêt est ici limité, mais on voit l'idée (j'espère).</p><p id="r-454527" data-claire-element-id="454527">Eh bien le but de ce tutoriel sera d'arriver à un code qui ressemble à ceci :</p><pre id="r-454528" data-claire-element-id="454528"><code data-claire-semantic="html+php">&lt;?php
$reponse = 42;
$proposition = $_GET['proposition'];

if ($reponse == $proposition)
{
	echo '&lt;p&gt;{bonne_reponse}&lt;/p&gt;';
}
else
{
	echo '&lt;p&gt;{mauvaise_reponse}&lt;/p&gt;';
}
?&gt;</code></pre><p id="r-454529" data-claire-element-id="454529">La différence entre ce dernier extrait de code et l'extrait précédent repose sur la forme du contenu. Ici, l'on a remplacé « Félicitations ! Vous avez trouvé la réponse (42) ! » par « {bonne_reponse} », et « Retentez votre chance ! » par « {mauvaise_reponse} ».</p><div id="r-454531" data-claire-element-id="454531" data-claire-semantic="question"><p id="r-454530" data-claire-element-id="454530">Mais le visiteur ne verra donc que ces textes sans ponctuation et entre accolades ?</p></div><p id="r-454532" data-claire-element-id="454532"><em>Que nenni !</em> Le visiteur verra le texte que l'on a remplacé. En revanche, ce texte n'apparaît plus dans le code lui-même, puisque nous avons décidé de séparer structure et contenu. Il faudra donc, au moment d'afficher la page, remplacer les accolades par le texte qui correspond (objet de la deuxième partie de ce tutoriel).</p><div id="r-454534" data-claire-element-id="454534" data-claire-semantic="question"><p id="r-454533" data-claire-element-id="454533">Mais où est donc passé ce texte ?</p></div><p id="r-454535" data-claire-element-id="454535">On l'a tout bonnement stocké dans un fichier indépendant où seront également stockés tous les autres textes. C'est justement l'objet du prochain paragraphe…</p><h2 id="r-le-fichier-lang-php" data-claire-element-id="454544">Le fichier lang.php</h2><p id="r-454537" data-claire-element-id="454537">Ce fichier a une structure on ne peut plus simple. En effet, son rôle est d'associer à chaque élément entre accolades, un texte mis en forme. De fait, il convient d'utiliser un tableau associatif, ou array().</p><p id="r-454538" data-claire-element-id="454538">Reprenons l'exemple précédent : pour afficher les deux messages que nous avons vus, il nous faudra écrire :</p><pre id="r-454539" data-claire-element-id="454539"><code data-claire-semantic="html+php">&lt;?php
$fr = array(
	'bonne_reponse' =&gt; 'Félicitations ! Vous avez trouvé la réponse (42) !',
	'mauvaise_reponse' =&gt; 'Retentez votre chance !'
);
?&gt;</code></pre><p id="r-454540" data-claire-element-id="454540">Cette portion de code ne nécessitera pas d'explication supplémentaire, je pense ; notons simplement que le tableau est ici stocké dans la variable $fr, car il s'agit là des textes en français. Lorsque nous voudrons traduire notre site (et c'est là qu'apparaît l'intérêt majeur de cette méthode de gestion de contenu), il suffira de créer un deuxième tableau, $en par exemple, puis $de, $es… et de poursuivre ainsi à l'envi, car cette méthode n'est pas limitative.</p><div id="r-454542" data-claire-element-id="454542" data-claire-semantic="question"><p id="r-454541" data-claire-element-id="454541">Certes, mais comment choisir le bon tableau ?</p></div><p id="r-454543" data-claire-element-id="454543">J'y reviendrai plus tard, en troisième partie de ce tutoriel. Pour l'instant, sachez que vous pouvez ajouter une multitude de langues à votre site en toute simplicité, et surtout sans modifier vos pages.</p><h2 id="r-pour-resumer-11" data-claire-element-id="454553">Pour résumer…</h2><ul id="r-454551" data-claire-element-id="454551"><li id="r-454546" data-claire-element-id="454546"><p id="r-454545" data-claire-element-id="454545">Tous les textes, messages et de manière générale, tout ce qui est destiné à être lu et compris par vos visiteurs, disparaît de votre code.</p></li><li id="r-454548" data-claire-element-id="454548"><p id="r-454547" data-claire-element-id="454547">À la place, on pose des appels entre accolades, qui seront remplacés par le texte mis en forme à l'affichage.</p></li><li id="r-454550" data-claire-element-id="454550"><p id="r-454549" data-claire-element-id="454549">Pour procéder à ce remplacement, on stocke tous les contenus dans le fichier lang.php sous la forme d'un tableau associant les appels et le contenu.</p></li></ul><p id="r-454552" data-claire-element-id="454552">Voyons donc à présent comme mettre en œuvre ce remplacement !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu">Un système simplifié de gestion de contenu</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu/structure-generale-du-systeme-de-contenu">
Structure générale du système de contenu
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu/fonctionnement-detaille-de-la-methode-de-gestion">
Fonctionnement détaillé de la méthode de gestion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu/pour-aller-plus-loin-36">
Pour aller plus loin...
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu/fonctionnement-detaille-de-la-methode-de-gestion">
<span class="next">Fonctionnement détaillé de la méthode de gestion</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Fonctionnementdtailldelamthodedegestion"></a><h2>Fonctionnement détaillé de la méthode de gestion</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu/structure-generale-du-systeme-de-contenu">
<span class="arrow"></span>
<span class="next">Structure générale du système de contenu</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu/pour-aller-plus-loin-36">
<span class="next">Pour aller plus loin...</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-454555" data-claire-element-id="454555">Le but de cette partie est de remplacer tous les appels (entre accolades) de vos pages par les contenus textuels qui correspondent. D'ores et déjà, nous disposons d'un tableau de correspondance, stocké dans la variable $fr, dans le fichier lang.php.</p><aside id="r-454557" data-claire-element-id="454557" data-claire-semantic="warning"><p id="r-454556" data-claire-element-id="454556">Au début du tutoriel, j'indiquais qu'il était préférable d'adopter un système d'<em>includes</em> pour vos pages, centralisé dans index.php. Nous allons voir comment procéder avec ce système. Si toutefois vous n'utilisez pas d'<em>includes</em> centralisés, nous verrons comment procéder plus bas ; <strong>je vous recommande cependant de lire ce qui suit</strong>, car la méthode est identique (je ne l'exposerai donc qu'une fois), à l'exception de la dernière phase.</p></aside><h2 id="r-methode-avec-includes-centralises" data-claire-element-id="454597">Méthode avec <em>includes</em> centralisés</h2><p id="r-454558" data-claire-element-id="454558">Si vous centralisez vos <em>includes</em> sur index.php, votre fichier doit contenir ces quelques lignes (plus une bonne dose de sécurité, sur laquelle je ne reviendrai pas) :</p><pre id="r-454559" data-claire-element-id="454559"><code data-claire-semantic="html+php">&lt;?php
$p = (!empty($_GET['p'])) ? htmlentities($_GET['p']) : 'index';
 
$array_pages = array(
	'index' =&gt; 'index.php',
	'page1' =&gt; 'page1.php',
	'page2' =&gt; 'page2.html'
);

if(!array_key_exists($p, $array_pages)) $page = 'index.php';
elseif(!is_file($array_pages[$p])) $page = 'erreur.php';
else $page = $array_pages[$p];


include('configuration.php'); // Insertion du fichier de configuration
include('en-tete.php'); // Insertion de l'en-tête commun à toutes les pages
include($page); // Insertion de la page requise
include('pied.php'); // Insertion du pied de page commun à toutes les pages
?&gt;</code></pre><p id="r-454560" data-claire-element-id="454560">Ce code est une reprise adaptée du <a href="http://www.siteduzero.com/tuto-3-1720-1-systeme-d-includes-securisees.html">tutoriel de Quadehar</a> que je vous ai conseillé plus haut.</p><p id="r-454561" data-claire-element-id="454561">Pour continuer, nous allons devoir faire un tour dans le fichier configuration.php contenant les fonctions du site.</p><h3 id="r-le-fichier-de-configuration" data-claire-element-id="454575">Le fichier de configuration</h3><p id="r-454562" data-claire-element-id="454562">Le fichier de configuration contient au moins deux fonctions nécessaires à notre système : la première, que j'appelle disp_txt() ? pour <em>display text</em> ?, a un argument (<em>a</em>) ; elle appelle le fichier lang.php et retourne le texte associé à l'argument (<em>a</em> est une clef du tableau).</p><p id="r-454563" data-claire-element-id="454563">La seconde, make_txt(), a pour argument une chaîne <em>c</em>, et renvoie cette même chaîne dans laquelle elle a préalablement remplacé les appels à du texte (entre accolades) par ce texte. Je sens que vous voyez venir la solution…</p><p id="r-454564" data-claire-element-id="454564">Voici ces deux fonctions, dans leur ordre obligatoire d'apparition :</p><pre id="r-454565" data-claire-element-id="454565"><code data-claire-semantic="html+php">&lt;?php
function disp_txt($txt)
{
	include('lang.php');
	// On inclut le fichier lang.php dans lequel est définie la variable tableau $fr.
	
	$lang = $fr;
	
	if (array_key_exists($txt, $lang)) // Si le tableau a l'entrée demandée…
	{
		$return = $lang[$txt]; // … on retourne cette entrée.
	}
	else
	{
		$return = '(Texte manquant)'; // Sinon, on retourne « (Texte manquant) » (par exemple).
	}
	
	return ($return);
}
function make_txt($page)
{
	$page = preg_replace('#\{([a-z0-9_]*)\}#e', 'disp_txt($1)', $page);
	
	return $page;
}
?&gt;</code></pre><p id="r-454566" data-claire-element-id="454566">Je crois bon de m'étendre un peu sur ces deux fonctions.</p><p id="r-454567" data-claire-element-id="454567">Pour la première, disp($txt), je pense qu'un exemple suffira : disp('bonne_reponse') affichera « Félicitations ! Vous avez trouvé la réponse (42) ! », en allant, dans la variable-tableau $fr, chercher le texte correspondant à son argument (ici, 'bonne_reponse').</p><p id="r-454568" data-claire-element-id="454568">La seconde utilise une expression régulière (ou regex, de l'anglais <em>regular expression</em>) dans la fonction de capture et remplacement <a href="http://www.php.net/manual/fr/function.preg-replace.php">preg_replace()</a>. Quel est l'effet de cette fonction ? Elle cherche, dans la chaîne d'entrée, des appels signalés par des accolades (par exemple {bonne_reponse}), retire ces accolades et passe le résultat à la fonction disp() : on obtient disp('bonne_reponse').</p><div id="r-454570" data-claire-element-id="454570" data-claire-semantic="question"><p id="r-454569" data-claire-element-id="454569">Mais la regex n'ajoute pas les apostrophes autour de bonne_reponse ! D'où viennent-elles ?</p></div><p id="r-454571" data-claire-element-id="454571">C'est exact, mais les captures opérées grâce à preg_replace() renvoient des chaînes de caractères (ici, $1). Si on les réinjecte dans une fonction comme fait ici, elles se comportent comme telles.</p><div id="r-454573" data-claire-element-id="454573" data-claire-semantic="question"><p id="r-454572" data-claire-element-id="454572">Mais, mais, quelle est cette option « e » inconnue ?</p></div><p id="r-454574" data-claire-element-id="454574">Excellente question ! C'est le nœud du problème. En effet, la fonction preg_replace(), utilisée sans option, ne permet pas d'insérer une fonction au deuxième argument. Cette difficulté est contournable grâce à l'option « e », dont l'effet est de faire interpréter le contenu du deuxième argument (censé être une chaîne) comme du PHP : ainsi, je peux y insérer la fonction disp() qui sera interprétée. Tout bonnement !</p><h3 id="r-mise-en-pratique-13" data-claire-element-id="454583">Mise en pratique</h3><p id="r-454576" data-claire-element-id="454576">Voici une mise en pratique (simple, pour commencer) de ces deux fonctions (dont on ne voit que la seconde, la première travaillant en arrière-plan). Supposons qu'une variable $page contienne un bout de code XHTML et un appel entre accolades, et que l'on veuille remplacer cet appel par le texte correspondant. Voici la solution :</p><pre id="r-454577" data-claire-element-id="454577"><code data-claire-semantic="html+php">&lt;?php
$page = '&lt;p style=&quot;color: green;&quot;&gt;{bonne_reponse}&lt;/p&gt;';
echo make_txt($page);
?&gt;</code></pre><p id="r-454578" data-claire-element-id="454578">Ce code retournera cette portion de XHTML :</p><pre id="r-454579" data-claire-element-id="454579"><code data-claire-semantic="html">&lt;p style=&quot;color: green;&quot;&gt;Félicitations ! Vous avez trouvé la réponse (42) !&lt;/p&gt;</code></pre><div id="r-454581" data-claire-element-id="454581" data-claire-semantic="question"><p id="r-454580" data-claire-element-id="454580">Fort bien ! Mais à présent, comment remplacer tous les appels dans toutes nos pages ? En les faisant rentrer dans des variables $page ?</p></div><p id="r-454582" data-claire-element-id="454582"><em>Que nenni </em>! Mais encore une fois, la question est pertinente. Voyons donc l'application en conditions réelles…</p><h3 id="r-application-en-conditions-reelles" data-claire-element-id="454596">Application en conditions réelles</h3><p id="r-454584" data-claire-element-id="454584">Dans cette partie, j'ai supposé que votre site utilisait un système d'<em>includes</em> centralisés dans index.php. C'est ici que cette précision prend toute son importance. Rappelons en effet la portion de code de index.php que j'ai exposée plus haut :</p><pre id="r-454585" data-claire-element-id="454585"><code data-claire-semantic="html+php">&lt;?php
$p = (!empty($_GET['p'])) ? htmlentities($_GET['p']) : 'index';
 
$array_pages = array(
	'index' =&gt; 'index.php',
	'page1' =&gt; 'page1.php',
	'page2' =&gt; 'page2.html'
);

if(!array_key_exists($p, $array_pages)) $page = 'index.php';
elseif(!is_file($array_pages[$p])) $page = 'erreur.php';
else $page = $array_pages[$p];


include('configuration.php'); // Insertion du fichier de configuration
include('en-tete.php'); // Insertion de l'en-tête commun à toutes les pages
include($page); // Insertion de la page requise
include('pied.php'); // Insertion du pied de page commun à toutes les pages
?&gt;</code></pre><p id="r-454586" data-claire-element-id="454586">Intéressons-nous cette fois aux trois derniers <em>includes</em>. Vous remarquez que c'est dans ces trois fichiers inclus que vous aurez des appels entre accolades (dans l'en-tête, dans la page centrale, et dans le pied de page). C'est donc à ces trois fichiers qu'il faut appliquer la fonction make_txt() afin de remplacer les appels par le texte correspondant. Des idées ?</p><p id="r-454587" data-claire-element-id="454587">Eh bien nous allons temporiser la sortie, lui appliquer la fonction make_txt(), puis renvoyer les données !</p><p id="r-454588" data-claire-element-id="454588">Je vois d'ici vos yeux ébahis ; mais non, ce n'est pas compliqué, nous avons seulement besoin de deux fonctions : <a href="http://www.php.net/ob_start">ob_start()</a> et <a href="http://www.php.net/manual/fr/function.ob-end-flush.php">ob_end_flush()</a>. La première stoppe l'envoi d'informations vers le client, et la deuxième met fin à la rétention. En soi, l'intérêt peut sembler limité, mais c'est sans compter que ob_start() peut prendre en argument… une tierce fonction !</p><p id="r-454589" data-claire-element-id="454589">Mais un petit bout de code vaut sans doute mieux qu'un long discours. Voici donc, sans plus tarder, la mise en pratique de tout ce qui précède, dans index.php :</p><pre id="r-454590" data-claire-element-id="454590"><code data-claire-semantic="html+php">&lt;?php
$p = (!empty($_GET['p'])) ? htmlentities($_GET['p']) : 'index';
 
$array_pages = array(
	'index' =&gt; 'index.php',
	'page1' =&gt; 'page1.php',
	'page2' =&gt; 'page2.html'
);

if(!array_key_exists($p, $array_pages)) $page = 'index.php';
elseif(!is_file($array_pages[$p])) $page = 'erreur.php';
else $page = $array_pages[$p];


include('configuration.php'); // Insertion du fichier de configuration

ob_start('make_txt'); // On temporise et on applique la fonction make_txt() à la sortie.

include('en-tete.php'); // Insertion de l'en-tête commun à toutes les pages
include($page); // Insertion de la page requise
include('pied.php'); // Insertion du pied de page commun à toutes les pages

ob_end_flush(); // On met fin à la temporisation et on libère la sortie.
?&gt;</code></pre><p id="r-454591" data-claire-element-id="454591">Lisez bien les commentaires que j'ai ajoutés ; ils sont cruciaux pour bien comprendre le comportement de ob_start().</p><p id="r-454592" data-claire-element-id="454592">Bon, eh bien nous arrivons enfin au bout de nos peines : dans toutes les pages incluses dans index.php, entre le début et la fin de la temporisation (donc également dans l'en-tête et dans le pied de page), les appels entre accolades seront remplacés par le texte correspondant, que nos fonctions se chargent de chercher dans le tableau de lang.php.</p><div id="r-454594" data-claire-element-id="454594" data-claire-semantic="question"><p id="r-454593" data-claire-element-id="454593">Et si je n'ai pas de système d'<em>includes</em> centralisés ?</p></div><p id="r-454595" data-claire-element-id="454595">Juste remarque ; voyons donc cela.</p><h2 id="r-methode-sans-includes-centralises" data-claire-element-id="454604">Méthode sans <em>includes</em> centralisés</h2><p id="r-454598" data-claire-element-id="454598">Grande nouvelle, la méthode sans <em>includes</em> centralisés est la même que celle avec ! Oui, mais…</p><p id="r-454599" data-claire-element-id="454599">Mais voilà. Le principe même des <em>includes</em> centralisés, c'est que l'en-tête, le pied de page et la page centrale ne sont appelés qu'une fois, sur la page index.php. Si l'on ne centralise pas, il faut appeler en-tête et pied de page dans chaque fichier. Par exemple :</p><pre id="r-454600" data-claire-element-id="454600"><code data-claire-semantic="html+php">&lt;?php
include('configuration.php');
include('en-tete.php');

// Contenu de la page

include('pied.php');
?&gt;</code></pre><p id="r-454601" data-claire-element-id="454601">Pourtant, ce code ne vous évoque-t-il rien ? Remontez un peu, vers le contenu du fichier index.php… On s'en rapproche fortement. Eh bien, pour appliquer notre méthode dans le cas présent, il faut temporiser et libérer la sortie, à laquelle on a appliqué la fonction make_txt() sur toutes les pages du site, de cette manière :</p><pre id="r-454602" data-claire-element-id="454602"><code data-claire-semantic="html+php">&lt;?php
include('configuration.php');

ob_start('make_txt'); // On temporise et on applique la fonction make_txt() à la sortie.

include('en-tete.php');

// Contenu de la page

include('pied.php');

ob_end_flush(); // On met fin à la temporisation et on libère la sortie.
?&gt;</code></pre><p id="r-454603" data-claire-element-id="454603">L'inconvénient ? C'est beaucoup plus long puisqu'il faut réitérer dans chaque fichier construit de cette manière. À vous de voir…</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu">Un système simplifié de gestion de contenu</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu/structure-generale-du-systeme-de-contenu">
Structure générale du système de contenu
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu/fonctionnement-detaille-de-la-methode-de-gestion">
Fonctionnement détaillé de la méthode de gestion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu/pour-aller-plus-loin-36">
Pour aller plus loin...
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu/structure-generale-du-systeme-de-contenu">
<span class="arrow"></span>
<span class="next">Structure générale du système de contenu</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu/pour-aller-plus-loin-36">
<span class="next">Pour aller plus loin...</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Pourallerplusloin..."></a><h2>Pour aller plus loin...</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu/fonctionnement-detaille-de-la-methode-de-gestion">
<span class="arrow"></span>
<span class="next">Fonctionnement détaillé de la méthode de gestion</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-454606" data-claire-element-id="454606">Cette troisième et dernière partie rappellera la solution adoptée plus haut, puis proposera un prolongement naturel de notre méthode de gestion du contenu : un site multilingue. Enfin, nous y proposerons une méthode avancée de gestion des liens.</p><h2 id="r-rappel-de-la-solution" data-claire-element-id="454619">Rappel de la solution</h2><h3 id="r-elements-de-solution" data-claire-element-id="454615">Éléments de solution</h3><p id="r-454607" data-claire-element-id="454607">Cette solution, <em>includes</em> centralisés ou pas, requiert et fait usage :</p><ul id="r-454614" data-claire-element-id="454614"><li id="r-454609" data-claire-element-id="454609"><p id="r-454608" data-claire-element-id="454608">d'un fichier de configuration (configuration.php par exemple) dans lequel sont définies nos deux fonctions disp_txt() et make_txt() ;</p></li><li id="r-454611" data-claire-element-id="454611"><p id="r-454610" data-claire-element-id="454610">d'un fichier de langue (lang.php) où sont stockés tous les contenus textuels du site en association avec leurs clés d'appel (celles que l'on retrouve entre accolades dans les pages) ;</p></li><li id="r-454613" data-claire-element-id="454613"><p id="r-454612" data-claire-element-id="454612">des fonctions de temporisation ob_start() et ob_end_flush() que l'on utilise soit dans index.php (cas des <em>includes</em> centralisés), soit dans toutes les pages contenant du texte, respectivement avant et après toute sortie textuelle.</p></li></ul><h3 id="r-limites-diverses" data-claire-element-id="454618">Limites diverses</h3><p id="r-454616" data-claire-element-id="454616">La regex employée dans la fonction make_txt() ? #\{([a-z0-9_]*)\}#e ? limite en soi les possibilités d'appel de texte ; d'une part, ces appels sont entourés d'accolades (moyen de repérage). Ensuite, ces appels ne contiennent que des caractères de bas de casse de <em>a</em> à <em>z</em>, des chiffres et des <em>underscores</em> (_). Il est cependant tout à fait possible de s'affranchir de cette limite (qui laisse déjà le temps de voir venir), en perfectionnant la regex : acceptation des capitales, des tirets, des caractères accentués, etc.</p><p id="r-454617" data-claire-element-id="454617">Une autre limite de cette méthode consiste en le monolithisme des textes. Autrement dit, chaque texte forme un bloc, dans lequel il n'est par exemple pas possible d'insérer des liens proprement. Je propose des pistes pour résoudre ce problème au paragraphe « Une méthode avancée de gestion des liens » (<em>infra</em>).</p><h2 id="r-un-site-multilingue-sans-effort" data-claire-element-id="454634">Un site multilingue sans effort...</h2><p id="r-454620" data-claire-element-id="454620">… ou presque. Vous vous souvenez certainement de ce code, inclus dans lang.php :</p><pre id="r-454621" data-claire-element-id="454621"><code data-claire-semantic="html+php">&lt;?php
$fr = array(
	'bonne_reponse' =&gt; 'Félicitations ! Vous avez trouvé la réponse (42) !',
	'mauvaise_reponse' =&gt; 'Retentez votre chance !'
);
?&gt;</code></pre><p id="r-454622" data-claire-element-id="454622">La première étape consiste, pour le <a href="http://fr.wikipedia.org/wiki/Webmestre">webmestre</a> ou le traducteur, à copier ce tableau, le coller à la suite en le renommant (par exemple, $en pour l'anglais) et changer les valeurs associées à chaque clef <strong>sans changer ces clefs</strong>. Cela donnera par exemple :</p><pre id="r-454623" data-claire-element-id="454623"><code data-claire-semantic="html+php">&lt;?php
$fr = array(
	'bonne_reponse' =&gt; 'Félicitations ! Vous avez trouvé la réponse (42) !',
	'mauvaise_reponse' =&gt; 'Retentez votre chance !'
);
$en = array(
	'bonne_reponse' =&gt; 'Well done! You found the answer! (42)',
	'mauvaise_reponse' =&gt; 'Try again!'
);
?&gt;</code></pre><aside id="r-454625" data-claire-element-id="454625" data-claire-semantic="information"><p id="r-454624" data-claire-element-id="454624">J'ouvre à ce sujet une petite parenthèse sur la <a href="http://www.panamo.com/RESS/anglais.html">typographie anglaise</a> fort différente de la nôtre, et dans laquelle les différents signes composés ne sont notamment pas précédés d'une espace insécable. C'est un détail qui peut avoir de l'importance pour la lisibilité de votre site aux yeux d'un Anglo-saxon.</p></aside><p id="r-454626" data-claire-element-id="454626">Bref, voici traduit tout votre site, le tout sans rien changer aux différentes pages. Reste à pouvoir changer de langue au début ou en cours de visite… Reprenons notre fonction disp_txt(), voulez-vous ?</p><pre id="r-454627" data-claire-element-id="454627"><code data-claire-semantic="html+php">&lt;?php
function disp_txt($txt)
{
	include('lang.php');
	// On inclut le fichier lang.php, dans lequel est définie la variable-tableau $fr.
	
	$lang = $fr;
	
	if (array_key_exists($txt, $lang)) // Si le tableau a l'entrée demandée…
	{
		$return = $lang[$txt]; // … on retourne cette entrée.
	}
	else
	{
		$return = '(Texte manquant)'; // Sinon, on retourne « (Texte manquant) » (par exemple).
	}
	
	return ($return);
}
?&gt;</code></pre><p id="r-454628" data-claire-element-id="454628">On y voit notamment « <code data-claire-semantic="html+php">$lang = $fr; </code> » ; c'est là que l'on doit agir pour faire de votre site un polyglotte invétéré. Pour cela, il nous faut connaître la langue de l'utilisateur…</p><div id="r-454630" data-claire-element-id="454630" data-claire-semantic="question"><p id="r-454629" data-claire-element-id="454629">Au fait, d'où vient cette information : la langue du visiteur ?</p></div><p id="r-454631" data-claire-element-id="454631">Cela dépend de la manière dont est conçu votre site Web. Pour la suite, je supposerai que cette information est stockée dans une variable globale $_SESSION['visiteur_langue'], dont la valeur peut être « fr », « en », « de », etc. Bien, retournons à notre fonction. Pour sélectionner le bon tableau à parcourir (c'est-à-dire celui qui correspond à la langue de l'utilisateur), l'on procédera ainsi :</p><pre id="r-454632" data-claire-element-id="454632"><code data-claire-semantic="html+php">&lt;?php
function disp_txt($txt)
{
	include('lang.php');
	// On inclut le fichier lang.php dans lequel sont définies toutes les variables-tableaux de langue ($fr, $en…).
	
	$lang = $fr; // Par défaut, la langue est le français…
	if (isset($_SESSION['visiteur_langue'])) // … mais s'il existe une information de langue du visiteur, celle-ci prime.
	{
		$visiteur_langue = $_SESSION['visiteur_langue']; // Simplification d'écriture
		$lang = ${$visiteur_langue}; // Variable variable : $lang = $en si l'utilisateur est Anglais, car alors, $visiteur_langue vaut 'en'
	}
	
	if (array_key_exists($txt, $lang)) // Si le tableau a l'entrée demandée…
	{
		$return = $lang[$txt]; // … on retourne cette entrée.
	}
	else
	{
		$return = '(Texte manquant)'; // Sinon, on retourne « (Texte manquant) » (par exemple).
	}
	
	return ($return);
}
?&gt;</code></pre><p id="r-454633" data-claire-element-id="454633">Voilà. J'ai le plaisir de vous annoncer que vous êtes désormais à la tête d'un site Web multilingue. Rien de moins.</p><h2 id="r-une-methode-avancee-de-gestion-des-liens" data-claire-element-id="454640">Une méthode avancée de gestion des liens</h2><p id="r-454635" data-claire-element-id="454635">Je ne fais ici que donner des pistes que vous pourrez vous amuser à poursuivre, si le cœur vous en dit.</p><p id="r-454636" data-claire-element-id="454636">Partons du principe que la méthode de gestion de contenu permet de remplacer l'{appel_au_texte} par « le texte appelé ». Rien n'interdit dès lors de créer de nouvelles fonctions, ou d'enrichir make_txt() afin de remplacer un %appel_au_lien% par un « <a href="http://lien-appele.zz/">http://lien-appele.zz/</a> ». Il suffit pour cela de créer un fichier links.php contenant tous les liens nécessaires au site sous forme d'un tableau associatif (même principe que lang.php), et d'associer les clefs d'appel de liens, entourées (par exemple) de %, aux liens correspondants.</p><p id="r-454637" data-claire-element-id="454637">Plus fort : le code XHTML de ces liens pourrait être généré automatiquement grâce à une fonction annexe make_links() associant à une paire clef =&gt; valeur, le code <code>&lt;a href=&quot;...&quot;&gt;{nom_du_lien}&lt;/a&gt;</code>. Dès lors, l'on pourrait insérer des liens dans les tableaux du fichier lang.php, passer ces tableaux à la fonction make_links(), puis les traiter dans notre fonction make_txt(). Cela résout le problème de monolithisme des blocs textes.</p><p id="r-454638" data-claire-element-id="454638">À vous de trouver la suite !</p><p id="r-454639" data-claire-element-id="454639">Nous avons vu que ce <em>système simplifié de gestion de contenu</em> allie souplesse et puissance. En effet, une fois mis en place le module de remplacement, le développement d'applications prend un autre visage puisqu'il sépare clairement contenu et structure. En outre, la gestion multilingue offre un aperçu des capacités d'un tel système dont la portabilité est élevée et l'extensibilité est quasiment infinie.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu">Un système simplifié de gestion de contenu</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu/structure-generale-du-systeme-de-contenu">
Structure générale du système de contenu
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu/fonctionnement-detaille-de-la-methode-de-gestion">
Fonctionnement détaillé de la méthode de gestion
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu/pour-aller-plus-loin-36">
Pour aller plus loin...
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/un-systeme-simplifie-de-gestion-de-contenu/fonctionnement-detaille-de-la-methode-de-gestion">
<span class="arrow"></span>
<span class="next">Fonctionnement détaillé de la méthode de gestion</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/un-systeme-simplifie-de-gestion-de-contenu.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 02:19:28 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/un-systeme-simplifie-de-gestion-de-contenu.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:33:03 GMT -->
</html>