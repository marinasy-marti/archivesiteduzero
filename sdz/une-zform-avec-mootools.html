<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/une-zform-avec-mootools.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 01:47:29 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/une-zform-avec-mootools.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:28:25 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Une zForm avec Mootools</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/une-zform-avec-mootools.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Une zForm avec Mootools</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#UnezFormavecMootools">Une zForm avec Mootools</a><br/><a href="#LeZForm">Le ZForm</a><br/><a href="#Lesboutonssimples">Les boutons simples</a><br/><a href="#Lesboutonsavecchoix">Les boutons avec choix</a><br/><a href="#Leslistesdechoix">Les listes de choix</a><br/><a href="#L039auto-visualisationavecAjax">L&#039;auto-visualisation avec Ajax</a><br/></div>
<a name="UnezFormavecMootools"></a><h2>Une zForm avec Mootools</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/le-zform">
<span class="next">Le ZForm</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-591418" data-claire-element-id="591418">Bonjour à tous,<br/> Nous allons nous entraîner à utiliser des objets du framework Mootools grâce à la création d'un ZForm avec une prévisualisation <em>via</em> Ajax. Ce mini-tuto vient en complément de <a href="http://www.siteduzero.com/tutoriel-3-35490-decouvrez-mootools-ou-bien-commencer-avec-javascript.html">« Découvrez mootools, ou bien commencer avec Javascript »</a>.</p>
</div><a name="LeZForm"></a><h2>Le ZForm</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-boutons-simples-1">
<span class="next">Les boutons simples</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-591434" data-claire-element-id="591434">Téléchargez le framework Mootools en version <a href="http://mootools.net/core">core</a> et <a href="http://mootools.net/more">more</a>. Une fois que c'est fait, rassemblez les deux fichiers en un seul, appelé <em>mootools.js</em>, et placez-le dans un dossier public et un sous-dossier <code>js</code>.</p><h2 id="r-les-differents-elements" data-claire-element-id="591583">Les différents éléments</h2><p id="r-591435" data-claire-element-id="591435">Le ZForm va nous permettre d'insérer des balises destinées à mettre en forme un texte, à ajouter des images, des titres et autres. Notre ZForm va posséder plusieurs éléments HTML :</p><ul id="r-591444" data-claire-element-id="591444"><li id="r-591437" data-claire-element-id="591437"><p id="r-591436" data-claire-element-id="591436">le champ de texte : le textarea ;</p></li><li id="r-591439" data-claire-element-id="591439"><p id="r-591438" data-claire-element-id="591438">les boutons simples de mise en forme ;</p></li><li id="r-591441" data-claire-element-id="591441"><p id="r-591440" data-claire-element-id="591440">les boutons avec choix de mise en forme ;</p></li><li id="r-591443" data-claire-element-id="591443"><p id="r-591442" data-claire-element-id="591442">les listes de choix pour la mise en forme du texte.</p></li></ul><h3 id="r-les-boutons-simples" data-claire-element-id="591494">Les boutons simples</h3><aside id="r-591446" data-claire-element-id="591446" data-claire-semantic="information"><p id="r-591445" data-claire-element-id="591445">Les boutons simples vont insérer, lors d'un clic, une paire de balises de mise en forme dans le champ de texte.</p></aside><p id="r-591447" data-claire-element-id="591447">Par exemple, pour la propriété « texte en gras », lors du clic sur le bouton gras, notre ZForm va afficher à l'intérieur du champ de texte :</p><pre id="r-591448" data-claire-element-id="591448"><code>&lt;gras&gt;texte&lt;/gras&gt;</code></pre><p id="r-591449" data-claire-element-id="591449">Voici les listes des boutons simples de mise en forme dont nous aurons besoin :</p><ul id="r-591468" data-claire-element-id="591468"><li id="r-591451" data-claire-element-id="591451"><p id="r-591450" data-claire-element-id="591450">gras ;</p></li><li id="r-591453" data-claire-element-id="591453"><p id="r-591452" data-claire-element-id="591452">italique ;</p></li><li id="r-591455" data-claire-element-id="591455"><p id="r-591454" data-claire-element-id="591454">barre ;</p></li><li id="r-591457" data-claire-element-id="591457"><p id="r-591456" data-claire-element-id="591456">souligne ;</p></li><li id="r-591459" data-claire-element-id="591459"><p id="r-591458" data-claire-element-id="591458">marge ;</p></li><li id="r-591461" data-claire-element-id="591461"><p id="r-591460" data-claire-element-id="591460">erreur ;</p></li><li id="r-591463" data-claire-element-id="591463"><p id="r-591462" data-claire-element-id="591462">infos ;</p></li><li id="r-591465" data-claire-element-id="591465"><p id="r-591464" data-claire-element-id="591464">question ;</p></li><li id="r-591467" data-claire-element-id="591467"><p id="r-591466" data-claire-element-id="591466">attention.</p></li></ul><p id="r-591469" data-claire-element-id="591469">Voici les images que nous allons utiliser pour le TP :</p><figure id="r-591471" data-claire-element-id="591472"><img id="r-591470" data-claire-element-id="591470" src="medias/uploads.siteduzero.com_files_261001_262000_261016.gif" alt="Image utilisateur"/></figure><figure id="r-591474" data-claire-element-id="591475"><img id="r-591473" data-claire-element-id="591473" src="medias/uploads.siteduzero.com_files_261001_262000_261020.gif" alt="Image utilisateur"/></figure><figure id="r-591477" data-claire-element-id="591478"><img id="r-591476" data-claire-element-id="591476" src="medias/uploads.siteduzero.com_files_261001_262000_261019.gif" alt="Image utilisateur"/></figure><figure id="r-591480" data-claire-element-id="591481"><img id="r-591479" data-claire-element-id="591479" src="medias/uploads.siteduzero.com_files_261001_262000_261017.gif" alt="Image utilisateur"/></figure><figure id="r-591483" data-claire-element-id="591484"><img id="r-591482" data-claire-element-id="591482" src="medias/uploads.siteduzero.com_files_261001_262000_261023.gif" alt="Image utilisateur"/></figure><figure id="r-591486" data-claire-element-id="591487"><img id="r-591485" data-claire-element-id="591485" src="medias/uploads.siteduzero.com_files_261001_262000_261021.gif" alt="Image utilisateur"/></figure><figure id="r-591489" data-claire-element-id="591490"><img id="r-591488" data-claire-element-id="591488" src="medias/uploads.siteduzero.com_files_261001_262000_261014.gif" alt="Image utilisateur"/></figure><figure id="r-591492" data-claire-element-id="591493"><img id="r-591491" data-claire-element-id="591491" src="medias/uploads.siteduzero.com_files_261001_262000_261022.gif" alt="Image utilisateur"/></figure><h3 id="r-les-boutons-avec-choix" data-claire-element-id="591543">Les boutons avec choix</h3><p id="r-591495" data-claire-element-id="591495">La liste des boutons avec choix :</p><ul id="r-591514" data-claire-element-id="591514"><li id="r-591497" data-claire-element-id="591497"><p id="r-591496" data-claire-element-id="591496">lien ;</p></li><li id="r-591499" data-claire-element-id="591499"><p id="r-591498" data-claire-element-id="591498">lien vers une ancre ;</p></li><li id="r-591501" data-claire-element-id="591501"><p id="r-591500" data-claire-element-id="591500">ancre ;</p></li><li id="r-591503" data-claire-element-id="591503"><p id="r-591502" data-claire-element-id="591502">puce normale ;</p></li><li id="r-591505" data-claire-element-id="591505"><p id="r-591504" data-claire-element-id="591504">puce numérique ;</p></li><li id="r-591507" data-claire-element-id="591507"><p id="r-591506" data-claire-element-id="591506">tableau ;</p></li><li id="r-591509" data-claire-element-id="591509"><p id="r-591508" data-claire-element-id="591508">citation ;</p></li><li id="r-591511" data-claire-element-id="591511"><p id="r-591510" data-claire-element-id="591510">image ;</p></li><li id="r-591513" data-claire-element-id="591513"><p id="r-591512" data-claire-element-id="591512">clip.</p></li></ul><p id="r-591515" data-claire-element-id="591515">Je vous donne aussi les images correspondantes, je suis sympa :) :</p><figure id="r-591517" data-claire-element-id="591518"><img id="r-591516" data-claire-element-id="591516" src="medias/uploads.siteduzero.com_files_261001_262000_261028.gif" alt="Image utilisateur"/></figure><figure id="r-591520" data-claire-element-id="591521"><img id="r-591519" data-claire-element-id="591519" src="medias/uploads.siteduzero.com_files_261001_262000_261026.gif" alt="Image utilisateur"/></figure><figure id="r-591523" data-claire-element-id="591524"><img id="r-591522" data-claire-element-id="591522" src="medias/uploads.siteduzero.com_files_261001_262000_261025.gif" alt="Image utilisateur"/></figure><figure id="r-591526" data-claire-element-id="591527"><img id="r-591525" data-claire-element-id="591525" src="medias/uploads.siteduzero.com_files_261001_262000_261030.gif" alt="Image utilisateur"/></figure><figure id="r-591529" data-claire-element-id="591530"><img id="r-591528" data-claire-element-id="591528" src="medias/uploads.siteduzero.com_files_261001_262000_261029.gif" alt="Image utilisateur"/></figure><figure id="r-591532" data-claire-element-id="591533"><img id="r-591531" data-claire-element-id="591531" src="medias/uploads.siteduzero.com_files_261001_262000_261031.gif" alt="Image utilisateur"/></figure><figure id="r-591535" data-claire-element-id="591536"><img id="r-591534" data-claire-element-id="591534" src="medias/uploads.siteduzero.com_files_261001_262000_261027.gif" alt="Image utilisateur"/></figure><figure id="r-591538" data-claire-element-id="591539"><img id="r-591537" data-claire-element-id="591537" src="medias/uploads.siteduzero.com_files_261001_262000_261033.gif" alt="Image utilisateur"/></figure><figure id="r-591541" data-claire-element-id="591542"><img id="r-591540" data-claire-element-id="591540" src="medias/uploads.siteduzero.com_files_261001_262000_261032.gif" alt="Image utilisateur"/></figure><h3 id="r-les-listes-de-choix" data-claire-element-id="591582">Les listes de choix</h3><p id="r-591544" data-claire-element-id="591544">Ces boutons vont, lors du survol, faire apparaître un menu de choix à cliquer ; ils seront utiles pour les couleurs, polices d'écriture…<br/> Les boutons à menu :</p><ul id="r-591559" data-claire-element-id="591559"><li id="r-591546" data-claire-element-id="591546"><p id="r-591545" data-claire-element-id="591545">police ;</p></li><li id="r-591548" data-claire-element-id="591548"><p id="r-591547" data-claire-element-id="591547">taille du texte ;</p></li><li id="r-591550" data-claire-element-id="591550"><p id="r-591549" data-claire-element-id="591549">position ;</p></li><li id="r-591552" data-claire-element-id="591552"><p id="r-591551" data-claire-element-id="591551">flottant ;</p></li><li id="r-591554" data-claire-element-id="591554"><p id="r-591553" data-claire-element-id="591553">couleur ;</p></li><li id="r-591556" data-claire-element-id="591556"><p id="r-591555" data-claire-element-id="591555">avertissement : contiendra les boutons simples (question, erreur, infos, attention) ;</p></li><li id="r-591558" data-claire-element-id="591558"><p id="r-591557" data-claire-element-id="591557">titre.</p></li></ul><p id="r-591560" data-claire-element-id="591560">Les images pour les listes de choix :</p><figure id="r-591562" data-claire-element-id="591563"><img id="r-591561" data-claire-element-id="591561" src="medias/uploads.siteduzero.com_files_261001_262000_261038.gif" alt="Image utilisateur"/></figure><figure id="r-591565" data-claire-element-id="591566"><img id="r-591564" data-claire-element-id="591564" src="medias/uploads.siteduzero.com_files_261001_262000_261040.gif" alt="Image utilisateur"/></figure><figure id="r-591568" data-claire-element-id="591569"><img id="r-591567" data-claire-element-id="591567" src="medias/uploads.siteduzero.com_files_261001_262000_261039.gif" alt="Image utilisateur"/></figure><figure id="r-591571" data-claire-element-id="591572"><img id="r-591570" data-claire-element-id="591570" src="medias/uploads.siteduzero.com_files_261001_262000_261037.gif" alt="Image utilisateur"/></figure><figure id="r-591574" data-claire-element-id="591575"><img id="r-591573" data-claire-element-id="591573" src="medias/uploads.siteduzero.com_files_261001_262000_261035.gif" alt="Image utilisateur"/></figure><figure id="r-591577" data-claire-element-id="591578"><img id="r-591576" data-claire-element-id="591576" src="medias/uploads.siteduzero.com_files_261001_262000_261034.gif" alt="Image utilisateur"/></figure><figure id="r-591580" data-claire-element-id="591581"><img id="r-591579" data-claire-element-id="591579" src="medias/uploads.siteduzero.com_files_261001_262000_261041.gif" alt="Image utilisateur"/></figure><h2 id="r-le-formulaire-html" data-claire-element-id="591587">Le formulaire html</h2><pre id="r-591584" data-claire-element-id="591584"><code data-claire-semantic="html">&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;
&lt;title&gt;ZForm&lt;/title&gt;

&lt;script type=&quot;text/javascript&quot; src=&quot;public/js/mootools.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;public/js/zform.js&quot;&gt;&lt;/script&gt;

&lt;link href=&quot;public/css/zform.css&quot;  rel=&quot;stylesheet&quot; type=&quot;text/css&quot; media=&quot;all&quot; /&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

window.addEvent('domready', function () {
    var form = new ZForm();
    	form.listeningEvent();        
    });
&lt;/script&gt;

&lt;/head&gt;
&lt;body&gt;
    &lt;div id=&quot;main&quot;&gt;
        &lt;form id=&quot;zform&quot; action=&quot;&quot; method=&quot;post&quot;&gt;
            &lt;fieldset&gt;&lt;legend&gt;ZForm&lt;/legend&gt;
            
                &lt;!-- Boutons simples --&gt;
                &lt;img data-bt=&quot;gras&quot; class=&quot;splButtons bt-code&quot; src=&quot;public/images/boutons/bt-gras.gif&quot;  alt=&quot;Gras&quot; title=&quot;Gras&quot;  /&gt;
                &lt;img data-bt=&quot;italique&quot; class=&quot;splButtons bt-code&quot; src=&quot;public/images/boutons/bt-italique-black.gif&quot; alt=&quot;Itlalique&quot; title=&quot;Italique&quot;/&gt;
                &lt;img data-bt=&quot;souligne&quot; class=&quot;splButtons bt-code&quot; src=&quot;public/images/boutons/bt-souligne.gif&quot; alt=&quot;Souligné&quot; title=&quot;Souligner&quot;/&gt;
                &lt;img data-bt=&quot;barre&quot; class=&quot;splButtons bt-code&quot; src=&quot;public/images/boutons/bt-surligne.gif&quot; alt=&quot;Barré&quot; title=&quot;Barrer&quot; /&gt;
                &lt;img data-bt=&quot;marge&quot; class=&quot;splButtons bt-code&quot; src=&quot;public/images/boutons/bt-marge.gif&quot;  alt=&quot;Marge&quot; title=&quot;Marge&quot; /&gt;
                &lt;img data-bt=&quot;gras&quot; class=&quot;splButtons bt-code&quot; src=&quot;public/images/boutons/bt-gras.gif&quot;  alt=&quot;Gras&quot; title=&quot;Gras&quot;  /&gt;
            
                &lt;!-- Boutons choix --&gt;
                &lt;img data-bt=&quot;liste&quot; class=&quot;dlgButtons bt-code&quot; src=&quot;public/images/boutons/bt-puce.gif&quot; alt=&quot;Listes&quot; /&gt;
                &lt;img data-bt=&quot;listnum&quot; class=&quot;dlgButtons bt-code&quot; src=&quot;public/images/boutons/bt-pucenum.gif&quot;  alt=&quot;Listes Numériques&quot; /&gt;
                &lt;img data-bt=&quot;tableau&quot; class=&quot;dlgButtons bt-code&quot; src=&quot;public/images/boutons/bt-tableau.gif&quot;  alt=&quot;Tableau&quot; /&gt;                
                &lt;img data-bt=&quot;url&quot; class=&quot;dlgButtons bt-code&quot; src=&quot;public/images/boutons/bt-lien.gif&quot; alt=&quot;lien&quot; /&gt;
                &lt;img data-bt=&quot;ancre&quot; class=&quot;dlgButtons bt-code&quot; src=&quot;public/images/boutons/bt-ancre.gif&quot; alt=&quot;Ancre&quot; /&gt;
                &lt;img data-bt=&quot;urlancre&quot; class=&quot;dlgButtons bt-code&quot; src=&quot;public/images/boutons/bt-urlancre.gif&quot; alt=&quot;Lien vers une ancre&quot; /&gt;    
                &lt;img data-bt=&quot;citation&quot; class=&quot;dlgButtons bt-code&quot; src=&quot;public/images/boutons/bt-citation.gif&quot; alt=&quot;Citation&quot; /&gt;            
                &lt;img data-bt=&quot;image&quot; class=&quot;dlgButtons bt-code&quot; src=&quot;public/images/boutons/bt-image.gif&quot;  alt=&quot;Images&quot; /&gt;
                &lt;img data-bt=&quot;clip&quot; class=&quot;dlgButtons bt-code&quot; src=&quot;public/images/boutons/bt-clip.gif&quot;  alt=&quot;Clip Video&quot;  /&gt;
                
               &lt;!--  Boutons listes --&gt;
                &lt;img data-bt=&quot;police&quot; class=&quot;bt-code listButtons&quot; src=&quot;public/images/boutons/bt-font.gif&quot;  alt=&quot;Police&quot; title=&quot;Police&quot; /&gt;
                &lt;div class=&quot;sliderBox&quot;&gt;
                    &lt;a class=&quot;slider-link&quot; rel=&quot;Arial&quot;&gt;Arial&lt;/a&gt;
                    &lt;a class=&quot;slider-link&quot; rel=&quot;Comic Sans MS&quot;&gt;Comic Sans MS&lt;/a&gt;
                    &lt;a class=&quot;slider-link&quot; rel=&quot;Verdana&quot;&gt;Verdana&lt;/a&gt;
                    &lt;a class=&quot;slider-link&quot; rel=&quot;Times New Roman&quot; &gt;Times New Roman&lt;/a&gt;
                    &lt;a class=&quot;slider-link&quot; rel=&quot;Rockwell Extra Bold&quot;&gt;Rockwell Extra Bold&lt;/a&gt;
                &lt;/div&gt;
                
                &lt;img data-bt=&quot;taille&quot; class=&quot;bt-code listButtons&quot; src=&quot;public/images/boutons/bt-size.gif&quot;  alt=&quot;Taille de la police&quot; title=&quot;Taille de la police&quot;  /&gt;
                &lt;div class=&quot;sliderBox&quot;&gt;
                    &lt;a class=&quot;slider-link&quot; rel=&quot;xx-small&quot;&gt;Très très petit&lt;/a&gt;
                    &lt;a class=&quot;slider-link&quot; rel=&quot;x-small&quot;&gt;Très petit&lt;/a&gt;
                    &lt;a class=&quot;slider-link&quot; rel=&quot;small&quot;&gt;Petit&lt;/a&gt;
                    &lt;a class=&quot;slider-link&quot; rel=&quot;medium&quot;&gt;Normal&lt;/a&gt;
                    &lt;a class=&quot;slider-link&quot; rel=&quot;large&quot;&gt;Grand&lt;/a&gt;
                    &lt;a class=&quot;slider-link&quot; rel=&quot;x-large&quot;&gt;Très grand&lt;/a&gt;
                    &lt;a class=&quot;slider-link&quot; rel=&quot;xx-large&quot;&gt;Très très grand&lt;/a&gt;
                    
                &lt;/div&gt;
                
                &lt;img data-bt=&quot;couleur&quot; class=&quot;bt-code listButtons&quot; src=&quot;public/images/boutons/bt-color.gif&quot;  alt=&quot;Couleur de la police&quot; title=&quot;Couleur de la Police&quot; /&gt;    
                &lt;div class=&quot;sliderBox&quot;&gt;
                    &lt;a class=&quot;slider-link bgWhite&quot; rel=&quot;#FFFFFF&quot;&gt;&amp;nbsp;&lt;/a&gt;                    
                    &lt;a class=&quot;slider-link bgGray&quot; rel=&quot;#CCCCCC&quot;&gt;&amp;nbsp;&lt;/a&gt;                
                    &lt;a class=&quot;slider-link bgRed&quot; rel=&quot;#FF0000&quot;&gt;&amp;nbsp;&lt;/a&gt;
                    &lt;a class=&quot;slider-link bgOrange&quot; rel=&quot;#FF6600&quot;&gt;&amp;nbsp;&lt;/a&gt;    
                    &lt;a class=&quot;slider-link bgYellow&quot; rel=&quot;#FFCC00&quot;&gt;&amp;nbsp;&lt;/a&gt;
                    &lt;a class=&quot;slider-link bgGreen&quot; rel=&quot;#33CC00&quot;&gt;&amp;nbsp;&lt;/a&gt;
                    &lt;a class=&quot;slider-link bgBlue&quot; rel=&quot;#0000CC&quot;&gt;&amp;nbsp;&lt;/a&gt;
                    &lt;a class=&quot;slider-link bgMarine&quot; rel=&quot;#000033&quot;&gt;&amp;nbsp;&lt;/a&gt;    
                    &lt;a class=&quot;slider-link bgBlack&quot; rel=&quot;#000000&quot;&gt;&amp;nbsp;&lt;/a&gt;                
                &lt;/div&gt;
                
                &lt;img data-bt=&quot;titre&quot; class=&quot;bt-code listButtons&quot; src=&quot;public/images/boutons/bt-titre.gif&quot;  alt=&quot;Titre&quot; title=&quot;Titre&quot;   /&gt;    
                &lt;div class=&quot;sliderBox&quot;&gt;
                    &lt;a class=&quot;slider-link&quot; rel=&quot;h1&quot;&gt;Titre 1&lt;/a&gt;
                    &lt;a class=&quot;slider-link&quot; rel=&quot;h2&quot;&gt;Titre 2&lt;/a&gt;
                    &lt;a class=&quot;slider-link&quot; rel=&quot;h3&quot;&gt;Titre 3&lt;/a&gt;        
                &lt;/div&gt;
                            
                &lt;img data-bt=&quot;position&quot; class=&quot;bt-code listButtons&quot; src=&quot;public/images/boutons/bt-position.gif&quot;  alt=&quot;Position du texte&quot;  /&gt;
                &lt;div class=&quot;sliderBox&quot;&gt;
                   	&lt;a class=&quot;slider-link&quot; rel=&quot;gauche&quot;&gt;Gauche&lt;/a&gt;
                    &lt;a class=&quot;slider-link&quot; rel=&quot;center&quot;&gt;Centrer&lt;/a&gt;        
                    &lt;a class=&quot;slider-link&quot; rel=&quot;droite&quot;&gt;Droite&lt;/a&gt;
                    &lt;a class=&quot;slider-link&quot; rel=&quot;justifier&quot;&gt;Justifier&lt;/a&gt;                    
                &lt;/div&gt;
                
                &lt;img data-bt=&quot;flottant&quot; class=&quot;bt-code listButtons&quot; src=&quot;public/images/boutons/bt-float.gif&quot;  alt=&quot;Couleur de la police&quot;  /&gt;
                &lt;div class=&quot;sliderBox&quot;&gt;
                    &lt;a class=&quot;slider-link&quot; rel=&quot;gauche&quot;&gt;Flottant à gauche&lt;/a&gt;
                    &lt;a class=&quot;slider-link&quot; rel=&quot;droit&quot;&gt;Flottant à droite&lt;/a&gt;        
                &lt;/div&gt;
                
                &lt;img data-bt=&quot;avert&quot; class=&quot;bt-code listButtons&quot; src=&quot;public/images/boutons/bt-avert.gif&quot;  alt=&quot;Avertissements&quot; /&gt;
                &lt;div class=&quot;sliderBox&quot;&gt;
                    &lt;img data-bt=&quot;question&quot; class=&quot;splButtons bt-code&quot; src=&quot;public/images/boutons/bt-question.gif&quot; alt=&quot;Question&quot; /&gt;
                    &lt;img data-bt=&quot;attention&quot; class=&quot;splButtons bt-code&quot; src=&quot;public/images/boutons/bt-attention.gif&quot;  alt=&quot;Attention&quot;  /&gt;&lt;br /&gt;
                    &lt;img data-bt=&quot;infos&quot; class=&quot;splButtons bt-code&quot; src=&quot;public/images/boutons/bt-infos.gif&quot;  alt=&quot;Infos&quot;  /&gt;
                    &lt;img data-bt=&quot;erreur&quot; class=&quot;splButtons bt-code&quot; src=&quot;public/images/boutons/bt-erreur.gif&quot;  alt=&quot;Erreur&quot; /&gt;
                &lt;/div&gt;
                
                &lt;div class=&quot;block&quot;&gt;
                    &lt;textarea id=&quot;text&quot; name=&quot;text&quot; cols=&quot;100&quot; rows=&quot;10&quot;&gt;&lt;/textarea&gt;        
                &lt;/div&gt;
                &lt;div id=&quot;control&quot;&gt;
                    &lt;input type=&quot;reset&quot; value=&quot;effacer&quot; /&gt;
                    &lt;input type=&quot;submit&quot; value=&quot;Valider&quot; /&gt;        
                &lt;/div&gt;        
            &lt;/fieldset&gt;
        &lt;/form&gt;
        
        &lt;div id=&quot;prev&quot;&gt;
            &lt;h4&gt;Prévisualisation : &lt;/h4&gt;
        &lt;/div&gt;
                
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-591585" data-claire-element-id="591585">Une petite précision ici, nous instancions et utilisons notre objet de cette manière :</p><pre id="r-591586" data-claire-element-id="591586"><code data-claire-semantic="html">&lt;script type=&quot;text/javascript&quot;&gt;
// Lorsque le dom est lu
window.addEvent('domready', function () {
    var form = new ZForm(); // On crée notre objet ZForm
    form.listeningEvent();  // On écoute les événements du ZForm      
});
&lt;/script&gt;</code></pre><h2 id="r-la-feuille-de-style" data-claire-element-id="591589">La feuille de style</h2><pre id="r-591588" data-claire-element-id="591588"><code data-claire-semantic="css">#parser {
	margin: auto;
	width: 80%;
}

 fieldset {
	margin: auto;
	width: 70%;
}

#control {
	float: none;
	display: block;
	clear: both;
	margin-left : 3%;
}
table {
	background-color: #ccc;
	padding : 1%;
}
td {
	border : 1px solid #eee;
	background-color: #fff;
}

.title-citation {
	background-color: #eee;
	font-weight: bold;
	border: #ccc 1px solid;
	border-bottom: none;
	text-indent : 1%;
	width: 20%;
	margin:0;
	margin-top : 1%;
}
.citation {
	margin:0;
	border: #ccc 1px solid;
	padding: 1%;
}

#prev {
	border: 1px solid #999;
	margin: auto;
	margin-top: 1%;
	padding: 1%;
	min-height: 200px;
	-moz-border-radius: 10px;
	overflow : auto;
	width: 78%;
	
}

.bt-code {
	cursor: pointer;
	width: 30px;
	height: 30px;
	padding-left: 0;
	/*float: left;*/
}

.sliderBox {
	border: 1px solid #ccc;
	padding: 0.3%;
	background-color: #eee;
	max-width : 200px;
}

.slider-link {
	background-color: #fff;
	border: 1px solid #ccc;
	cursor: pointer;
	padding: 1%;
	margin: 1%;
	min-width: 150px;
	display : block;
}
.slider-link:hover {
	border: 1px solid #999;	
}

.parser-erreur{
	background: #eee url(public/images/zcode_erreur.png) no-repeat 10px center;
	border : 1px solid red;
	color: red;
	width: 80%;
	padding: 2%;
	margin: auto;
	padding-left: 5%;
	
}
.parser-attention{
	background: #eee url(public/images/zcode_attention.png) no-repeat 10px center;
	border : 1px solid orange;
	color: orange;
	width: 80%;
	padding: 2%;
	margin: auto;
	padding-left: 5%;
	
}
.parser-question{
	background: #eee url(public/images/zcode_question.png) no-repeat 10px center;
	border : 1px solid blue;
	color: blue;
	width: 80%;
	padding: 2%;
	margin: auto;
	padding-left: 5%;
	
}
.parser-infos{
	background: #eee url(public/images/zcode_info.png) no-repeat 10px center;
	border : 1px solid green;
	color: green;
	width: 80%;
	padding: 2%;
	margin: auto;
	padding-left: 5%;
}

.block {
	float: left;
}
.bgWhite {
	background-color: white;
}
.bgBlack {
	background-color: black;
}
.bgMarine {
	background-color: #003;
}
.bgGray {
	background-color: #ccc;
}
.bgOrange {
	background-color: orange;
}
.bgBlue {
	background-color: blue;
}
.bgRed {
	background-color: red;
}
.bgGreen {
	background-color: green;
}
.bgYellow { 
	background-color: yellow;
}</code></pre>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools">Une zForm avec Mootools</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/le-zform">
Le ZForm
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-boutons-simples-1">
Les boutons simples
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-boutons-avec-choix-1">
Les boutons avec choix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-listes-de-choix-1">
Les listes de choix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/l-auto-visualisation-avec-ajax">
L&#039;auto-visualisation avec Ajax
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-boutons-simples-1">
<span class="next">Les boutons simples</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesboutonssimples"></a><h2>Les boutons simples</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/le-zform">
<span class="arrow"></span>
<span class="next">Le ZForm</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-boutons-avec-choix-1">
<span class="next">Les boutons avec choix</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-l-objet-zform" data-claire-element-id="591599">L'objet ZForm</h2><p id="r-591591" data-claire-element-id="591591">Nous allons coder notre objet Mootools. Pour ce faire, créez un fichier nommé zform.js et placez-le dans public/js/.</p><aside id="r-591593" data-claire-element-id="591593" data-claire-semantic="information"><p id="r-591592" data-claire-element-id="591592">Le fichier est lié entre les balises <code>head</code> de votre index.html.</p></aside><h3 id="r-construction-de-l-objet-et-initialisation" data-claire-element-id="591598">Construction de l'objet et initialisation</h3><p id="r-591594" data-claire-element-id="591594">À la construction de l'objet, on initialise les paramètres qui vont servir au fonctionnement du ZForm. Voici quelques lignes de code pour commencer :</p><pre id="r-591595" data-claire-element-id="591595"><code data-claire-semantic="javascript">var ZForm = new Class({
	
	Implements : Options,

	options : {	
		textId : 'text', //	id du textarea
		preview : 'prev', // id de la div de prévisualisation
		buttons : '.splButtons', // les boutons simples			
		dlgButtons : '.dlgButtons', //	les boutons ouvrant une boîte de dialogue
		listButtons : '.listButtons', //	les boutons liste ouvrant un menu de choix
		slider : '.sliderBox', //	les boîtes contenant un menu de choix
		sliderLink : '.slider-link',  //	les liens du menu de choix
		closeDelay : 500 // temps avant fermeture de la boîte de menu en millisecondes
	},
        //Constructeur
	initialize : function(options) {
	        this.setOptions(options);
		this.input = $(this.options.textId); // getElementById(textId)
		this.preview = $(this.options.preview); // getElementById(preview)
		this.timer = 0;		
		//Buttons
		this.buttons = $$(this.options.buttons);  // tableau de tous les boutons simples
		this.dlgButtons = $$(this.options.dlgButtons); // tableau de tous les boutons ouvrant une boîte de dialogue
		this.sliders = $$(this.options.slider); // tableau de toutes les boîtes contenant un menu de choix
		this.listButtons = $$(this.options.listButtons); // tableau de tous les boutons liste ouvrant un menu de choix
		this.sliderLink = $$(this.options.sliderLink); // tableau de tous les liens de menu de choix
		this.closeDelay = this.options.closeDelay;
	},
	
	// Écoute les événements
	listeningEvent : function() {
		this.input.focus(); // On donne le focus au champ de texte
	}
});</code></pre><p id="r-591596" data-claire-element-id="591596">Les classes Mootools implémentent des options pour assigner des paramètres par défaut, ce qui vous permet, par exemple, de changer le nom de la classe CSS, ou l'id du textarea. Dans ce cas, il faudra assigner les nouveaux paramètres lors de l'instanciation :</p><pre id="r-591597" data-claire-element-id="591597"><code data-claire-semantic="javascript">var zform = new ZForm({textId: 'message'});</code></pre><h2 id="r-le-principe-des-boutons-simples" data-claire-element-id="591647">Le principe des boutons simples</h2><h3 id="r-etude-de-cas" data-claire-element-id="591621">Étude de cas</h3><p id="r-591600" data-claire-element-id="591600">Nous allons pour l'instant étudier le principe avec le bouton simple gras.</p><aside id="r-591602" data-claire-element-id="591602" data-claire-semantic="warning"><p id="r-591601" data-claire-element-id="591601">J'ai placé mes images dans un dossier public/images/.</p></aside><p id="r-591603" data-claire-element-id="591603">Mettons-nous à la place de l'utilisateur ; deux cas de figure se présentent :</p><ol id="r-591608" data-claire-element-id="591608"><li id="r-591605" data-claire-element-id="591605"><p id="r-591604" data-claire-element-id="591604">L'utilisateur tape un texte, sélectionne le texte et clique sur le bouton gras pour ajouter les balises ;</p></li><li id="r-591607" data-claire-element-id="591607"><p id="r-591606" data-claire-element-id="591606">L'utilisateur clique sur le bouton gras et tape un texte entre les balises ajoutées.</p></li></ol><p id="r-591609" data-claire-element-id="591609">Avec ces deux cas de figure, nous allons développer notre algorithme. Nous devons :</p><ol id="r-591620" data-claire-element-id="591620"><li id="r-591611" data-claire-element-id="591611"><p id="r-591610" data-claire-element-id="591610">Écouter les événements et identifier le bouton cliqué ;</p></li><li id="r-591613" data-claire-element-id="591613"><p id="r-591612" data-claire-element-id="591612">Récupérer le nom de la balise à insérer ;</p></li><li id="r-591615" data-claire-element-id="591615"><p id="r-591614" data-claire-element-id="591614">Récupérer la sélection du texte s'il y en a une ;</p></li><li id="r-591617" data-claire-element-id="591617"><p id="r-591616" data-claire-element-id="591616">Si aucun texte n'est sélectionné, placer le curseur entre les balises ajoutées ;</p></li><li id="r-591619" data-claire-element-id="591619"><p id="r-591618" data-claire-element-id="591618">Si un texte est sélectionné, placer les balises de part et d'autre la sélection.</p></li></ol><h3 id="r-regrouper-les-boutons" data-claire-element-id="591646">Regrouper les boutons</h3><p id="r-591622" data-claire-element-id="591622">Pour éviter d'avoir à réécrire une fonction pour chaque bouton simple, Mootools nous permet de regrouper des éléments sous une même classe. Ici, nous allons nommer notre classe CSS <code data-claire-semantic="css">splButtons</code> pour tous les boutons simples.</p><pre id="r-591623" data-claire-element-id="591623"><code data-claire-semantic="javascript">this.buttons = $$(this.options.buttons);
// correspond à
this.buttons = $$('.splButtons');
// et nous renvoie un tableau de tous les éléments ayant une classe CSS splButtons</code></pre><p id="r-591624" data-claire-element-id="591624">Le bouton gras se présente sous cette forme :</p><pre id="r-591625" data-claire-element-id="591625"><code data-claire-semantic="html">&lt;!-- Boutons simples --&gt;
&lt;img data-bt=&quot;gras&quot; class=&quot;splButtons bt-code&quot; src=&quot;public/images/boutons/bt-gras.gif&quot;  alt=&quot;Gras&quot; title=&quot;Gras&quot;  /&gt;</code></pre><aside id="r-591627" data-claire-element-id="591627" data-claire-semantic="information"><p id="r-591626" data-claire-element-id="591626">Pour récupérer le nom de la balise, l'astuce ici est d'utiliser <a href="http://html5doctor.com/html5-custom-data-attributes/"> une nouvelle fonctionnalité HTML</a> : l'attribut data-bt de l'image.</p></aside><p id="r-591628" data-claire-element-id="591628">Nous allons aussi utiliser la classe <code>Elements.Forms</code> et ses méthodes <code>getSelectedText</code>, <code>insertAtCursor</code> et <code>insertAroundCursor</code>, ici pour repérer où se trouve notre curseur dans le champ de texte, mais aussi quelle partie du texte l'utilisateur a sélectionnée. Codons les méthodes nécessaires au fonctionnement.<br/> Nous allons expliquer un peu la différence de comportement des méthodes d'insertion de balises :</p><ul id="r-591645" data-claire-element-id="591645"><li id="r-591630" data-claire-element-id="591630"><p id="r-591629" data-claire-element-id="591629"><code>insertAtcursor</code> insère les balises à la position du curseur. Cette méthode prend en paramètre le texte à insérer et un booléen en deuxième paramètre :</p></li><ul id="r-591635" data-claire-element-id="591635"><li id="r-591632" data-claire-element-id="591632"><p id="r-591631" data-claire-element-id="591631">s'il vaut <code>true</code> : une fois les balises insérées, la sélection englobe le contenu,</p></li><li id="r-591634" data-claire-element-id="591634"><p id="r-591633" data-claire-element-id="591633">s'il vaut <code>false</code> : une fois les balises insérées, la sélection est annulée et le curseur se positionne à la fin de la balise de fermeture ;</p></li></ul><li id="r-591637" data-claire-element-id="591637"><p id="r-591636" data-claire-element-id="591636"><code>insertAroundcursor</code> insère les balises autour du curseur. Une fois les balises insérées, la sélection s'applique au texte entre les balises. Cette méthode prend en paramètre un tableau :</p></li><ul id="r-591644" data-claire-element-id="591644"><li id="r-591639" data-claire-element-id="591639"><p id="r-591638" data-claire-element-id="591638">clé <code>after</code> : définit la balise d'ouverture,</p></li><li id="r-591641" data-claire-element-id="591641"><p id="r-591640" data-claire-element-id="591640">clé <code>before</code> : définit la balise de fermeture,</p></li><li id="r-591643" data-claire-element-id="591643"><p id="r-591642" data-claire-element-id="591642">clé <code>defaultMiddle</code> : le texte entre les balises.</p></li></ul></ul><h2 id="r-l-insertion-des-tags" data-claire-element-id="591661">L'insertion des tags</h2><p id="r-591648" data-claire-element-id="591648">Voici nos deux méthodes :</p><ul id="r-591653" data-claire-element-id="591653"><li id="r-591650" data-claire-element-id="591650"><p id="r-591649" data-claire-element-id="591649">les événements sur les boutons simples : <code>eventButton</code> ;</p></li><li id="r-591652" data-claire-element-id="591652"><p id="r-591651" data-claire-element-id="591651">l'insertion des tags : <code>insertTag</code>.</p></li></ul><aside id="r-591655" data-claire-element-id="591655" data-claire-semantic="warning"><p id="r-591654" data-claire-element-id="591654">N'oubliez pas de lancer l'appel à <code>eventButton</code>, dans l'écouteur d'événement (méthode <code>listeningEvent</code>).</p></aside><pre id="r-591656" data-claire-element-id="591656"><code data-claire-semantic="javascript">[...]
 * Events sur les boutons simples
 */
eventButtons : function() {
	//Si c'est I.E. on utilise plutôt l'event mousedown
	var event = (Browser.ie) ? 'mousedown' : 'click';
	// On écoute tous les boutons simples
	this.buttons.each(function(button){
		// Si un event est détecté
		button.addEvent(event, function(){
			//On récupère l'attribut data-bt de l'image
			var name = button.getProperty('data-bt');
			//On appelle la méthode d'insertion de tags avec les bons paramètres et la sélection du texte
			this.insertTag('&lt;'+name+'&gt;', '&lt;/'+name+'&gt;', this.input.getSelectedText());
		}.bind(this));
	}, this);
},

//Insertion des tags 
insertTag : function(startTag, endTag, select) {    
	//On donne le focus à notre champ de texte
	this.input.focus();        
	//S'il n'y a pas de sélection
	if(select === null || undefined === select) {    
		//On insère nos tags autour du curseur
		this.input.insertAroundCursor({'before' : startTag, 'after' : endTag});
	} else {
		//Sinon on insère nos tags au curseur
		this.input.insertAtCursor(startTag + select + endTag, false);    
	}    
	this.input.focus();
},
//Écoute les événements
listeningEvent : function() {
	this.input.focus();
	this.eventButtons();
}
[...]</code></pre><h3 id="r-analyse-du-code-1" data-claire-element-id="591660">Analyse du code</h3><p id="r-591657" data-claire-element-id="591657">Le code est commenté mais je vais quand même expliquer comment cela fonctionne.<br/> Dans la méthode <code>eventButton</code>, j'exécute une boucle sur mon tableau de boutons ; si un événement est détecté, je récupère le nom du bouton que j'assigne en paramètre à la méthode d'insertion des balises.<br/> La méthode <code data-claire-semantic="javascript">insertTag</code> m'indique si une partie de texte a été sélectionnée ou non dans le textarea ; en fonction des cas, les balises sont insérées au curseur ou de part et d'autre de la sélection.</p><aside id="r-591659" data-claire-element-id="591659" data-claire-semantic="warning"><p id="r-591658" data-claire-element-id="591658">Une condition est posée si on utilise Internet Explorer. En effet, un bug existe avec l'event <code>onclick</code>, car lors de la sélection du bouton, le champ de texte perd le focus et les méthodes de Mootools ne retrouvent pas la position du curseur. Pour éviter ce désagrément, on utilise l'event mousedown avec Internet Explorer.</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools">Une zForm avec Mootools</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/le-zform">
Le ZForm
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-boutons-simples-1">
Les boutons simples
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-boutons-avec-choix-1">
Les boutons avec choix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-listes-de-choix-1">
Les listes de choix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/l-auto-visualisation-avec-ajax">
L&#039;auto-visualisation avec Ajax
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/le-zform">
<span class="arrow"></span>
<span class="next">Le ZForm</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-boutons-avec-choix-1">
<span class="next">Les boutons avec choix</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesboutonsavecchoix"></a><h2>Les boutons avec choix</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-boutons-simples-1">
<span class="arrow"></span>
<span class="next">Les boutons simples</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-listes-de-choix-1">
<span class="next">Les listes de choix</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-avant-de-commencer-30" data-claire-element-id="591689">Avant de commencer</h2><h3 id="r-etude-de-cas-1" data-claire-element-id="591688">Étude de cas</h3><p id="r-591663" data-claire-element-id="591663">Ici, nous allons étudier pour l'exemple le cas d'un bouton lien.<br/> Deux cas de figure se présentent :</p><ul id="r-591668" data-claire-element-id="591668"><li id="r-591665" data-claire-element-id="591665"><p id="r-591664" data-claire-element-id="591664">l'utilisateur tape le texte du lien, sélectionne le texte et clique sur le bouton lien pour ajouter les tags, une boîte de dialogue demande d'entrer l'adresse du lien, les tags sont ajoutés de part et d'autre de texte sélectionné ;</p></li><li id="r-591667" data-claire-element-id="591667"><p id="r-591666" data-claire-element-id="591666">l'utilisateur clique sur le bouton lien, une première boîte de dialogue demande d'entrer le texte du lien et une seconde boîte de dialogue demande d'entrer l'adresse du lien, les tags sont ajoutés au curseur.</p></li></ul><p id="r-591669" data-claire-element-id="591669">La forme du tag pourra être :</p><pre id="r-591670" data-claire-element-id="591670"><code>&lt;url value=&quot;adresse du lien&quot;&gt;texte du lien&lt;/url&gt;</code></pre><p id="r-591671" data-claire-element-id="591671">Pour pouvoir récupérer les paramètres utilisateur, nous allons utiliser prompt, un pour l'adresse et un pour le texte. Si l'adresse est vide, on mettra le paramètre à <code>null</code>, idem pour le texte.<br/> Nous allons aussi essayer d'automatiser les tâches sauf que cette fois, chaque bouton ne va pas déclencher les mêmes actions.<br/> En effet, nous allons avoir besoin de différents types de balises :</p><pre id="r-591672" data-claire-element-id="591672"><code>// 1er type : citation, URL, urlancre, ancre
&lt;balise value=&quot;value&quot;&gt;text&lt;/balise&gt;

// 2e type : image
&lt;balise&gt;text&lt;/balise&gt;

// Les listes
&lt;balise-liste&gt;
    &lt;balise-puce&gt;text&lt;/balise-puce&gt;
    &lt;balise-puce&gt;text&lt;/balise-puce&gt;
&lt;/balise-liste&gt;

// Tableau
&lt;balise-tableau&gt;
   &lt;balise-tr&gt;
    &lt;balise-td&gt;text&lt;/balise-td&gt;
    &lt;balise-td&gt;text&lt;/balise-td&gt;
   &lt;/balise-tr&gt;
&lt;/balise-tableau&gt;</code></pre><p id="r-591673" data-claire-element-id="591673">Nous allons également avoir besoin de différents types de messages pour les commandes prompt. Il va falloir réfléchir un peu plus pour ces boutons.<br/> Nous allons associer les groupes de tags en fonction du type de balise et des boîtes de dialogue à afficher.</p><ul id="r-591687" data-claire-element-id="591687"><li id="r-591675" data-claire-element-id="591675"><p id="r-591674" data-claire-element-id="591674">Les tags tableau et liste auront un comportement unique : nous devrons donc les dissocier.</p></li><li id="r-591682" data-claire-element-id="591682"><p id="r-591676" data-claire-element-id="591676">Le tag image : il sera de la forme <code>&lt;tag&gt;nom_de_l_image&lt;/tag&gt;</code>.</p><ul id="r-591681" data-claire-element-id="591681"><li id="r-591678" data-claire-element-id="591678"><p id="r-591677" data-claire-element-id="591677">Si aucune partie de texte n'est sélectionnée, on devra afficher une boîte de dialogue demandant d'entrer le chemin de l'image.</p></li><li id="r-591680" data-claire-element-id="591680"><p id="r-591679" data-claire-element-id="591679">Sinon la partie de texte sélectionnée s'insérera automatiquement à l'intérieur des tags.</p></li></ul></li><li id="r-591684" data-claire-element-id="591684"><p id="r-591683" data-claire-element-id="591683">Les tags url, urlancre, et ancre : le comportement et type de balise sera identique sauf au niveau du texte des boîtes de dialogue.</p></li><li id="r-591686" data-claire-element-id="591686"><p id="r-591685" data-claire-element-id="591685">La balise citation aura un attribut nommé <code>auteur</code> et non <code>value</code>.</p></li></ul><h2 id="r-les-evenements-sur-les-boutons-de-choix" data-claire-element-id="591737">Les événements sur les boutons de choix</h2><div id="r-591691" data-claire-element-id="591691" data-claire-semantic="question"><p id="r-591690" data-claire-element-id="591690">Comment récupérer la liste de boutons de choix ?</p></div><p id="r-591692" data-claire-element-id="591692">Notre bouton :</p><pre id="r-591693" data-claire-element-id="591693"><code data-claire-semantic="html">&lt;!-- Boutons choix --&gt;
&lt;img data-bt=&quot;url&quot; class=&quot;dlgButtons bt-code&quot; src=&quot;public/images/boutons/bt-lien.gif&quot; alt=&quot;lien&quot; /&gt;</code></pre><p id="r-591694" data-claire-element-id="591694">Ici, la classe CSS qui identifie les boutons de choix se nomme <code data-claire-semantic="css">dlgButtons</code>. Nous allons procéder de la même manière que pour les boutons simples à quelque chose près. On lance une boucle sur les boutons de choix, on écoute les événements et selon le cas on récupère le texte sélectionné, les infos des commandes prompt, et enfin on assigne les bons paramètres pour construire le tag approprié pour l'insérer dans le champ de texte.</p><p id="r-591695" data-claire-element-id="591695">Étudions la méthode <code data-claire-semantic="javascript">eventMessageBox</code> :</p><pre id="r-591696" data-claire-element-id="591696"><code data-claire-semantic="javascript">/**
 * Lien ouvrant une fenêtre box pour insérer une ou des valeurs au choix
 */
eventMessageBox : function() {
	var event = (Browser.ie) ? 'mousedown' : 'click';
	this.dlgButtons.each(function(bt){
		var link = $(bt);
		var text = value = '';        
		if(undefined !== link) {
			link.addEvent(event, function(){
				var name = link.getProperty('data-bt');
				var startTag = endTag = '';
				var select = this.input.getSelectedText();
				switch(name) {                    
					case 'tableau':  
						startTag = this.setTable();
						text = '';
					break;
						
					case 'liste':
					case 'listnum' :
						startTag = this.setList(name);
						text = '';
					break;
						
					case 'image' : 
						text = (select !== '') ? select : prompt(&quot;Tapez le nom d'emplacement de l'image : &quot;);                            
						startTag = this.getSimpleTag(name, text);
					break;
						
					case 'clip':
						startTag = this.setObject(name);
					break;
					
					case 'citation' :
						value = prompt(&quot;Tapez le nom de l'auteur de la citation :&quot;);
						text = null;
						startTag = this.getTagValue(name, value, 'auteur');
					break;
					
					case 'url' :
						value = prompt(&quot;Tapez l'adresse du lien : &quot;);
						text = (select === '') ? prompt(&quot;Tapez le texte du lien : &quot;): select;
						startTag = this.getTagValue(name, value);
					break; 
					
					case 'urlancre' :
						value =  (select !== '') ? select : prompt(&quot;Tapez le nom de l'ancre : &quot;);    
						text = prompt(&quot;Tapez le texte du lien : &quot;);
						startTag = this.getTagValue(name, value);
						break;
					
					case 'ancre' :
						alert('Lier avec un lien de type:'+&quot;\n&quot;+'&lt;urlancre value=&quot;nomdeLancre&quot;&gt;Texte du lien&lt;/url&gt;');
						value = (select !== '') ? select : prompt(&quot;Tapez le nom de l'ancre : &quot;);    
						text = prompt(&quot;Tapez le texte du lien : &quot;);
						startTag = this.getTagValue(name, value);
					break;                                
				}
				endTag = '&lt;/'+name+'&gt;';
				this.insertTag(startTag, endTag, text);
			}.bind(this));
		}
	}, this);
},
[...]</code></pre><h3 id="r-analyse-du-code-2" data-claire-element-id="591698">Analyse du code</h3><p id="r-591697" data-claire-element-id="591697">On lance une boucle sur les boutons portant la classe CSS <code data-claire-semantic="css">dlgButtons</code>. Dès qu'un événement est détecté, on récupère l'attribut <code>data-bt</code> de l'image. Selon les cas, on récupère la valeur à insérer dans l'attribut de notre tag (ici adresse du lien), le texte sélectionné (ici le texte du lien). Ensuite, on construit notre tag d'ouverture (<code>startTag</code>) avec les bons paramètres, et on appelle la méthode <code>insertTag</code> avec nos paramètres assignés.<br/> Voyons maintenant les méthodes spécifiques. Nous commencerons par les méthodes <code>getTagSimple</code> et <code>getTagValue</code> :</p><h3 id="r-construction-du-tag-d-ouverture-simple-pour-le-tag-image" data-claire-element-id="591705">Construction du tag d'ouverture simple pour le tag image</h3><p id="r-591699" data-claire-element-id="591699">On doit obtenir :</p><pre id="r-591700" data-claire-element-id="591700"><code>//Si aucune sélection
&lt;image&gt;null
//Sinon 
&lt;image&gt;</code></pre><aside id="r-591702" data-claire-element-id="591702" data-claire-semantic="information"><p id="r-591701" data-claire-element-id="591701">Deux paramètres seront indispensables : le nom du tag et le texte sélectionné s'il existe.</p></aside><pre id="r-591703" data-claire-element-id="591703"><code data-claire-semantic="javascript">/**
 * Formate un tag de la forme &lt;tag&gt;text
 */
getSimpleTag : function(name, text) {
	var tag = '';
	//Si aucune sélection
	if (text === '') {
		tag = '&lt;'+name+'&gt;null';	// null entre les balises	
	} else {
		tag = '&lt;'+name+'&gt;'; // Sinon on ajoute juste le tag (pour éviter qu'il se répète avec insertTag)
	}
	return tag;
},</code></pre><p id="r-591704" data-claire-element-id="591704">Le code est commenté et très facile à comprendre.</p><h3 id="r-construction-du-tag-d-ouverture-avec-attribut" data-claire-element-id="591709">Construction du tag d'ouverture avec attribut</h3><p id="r-591706" data-claire-element-id="591706">Le but du jeu est d'obtenir un tag d'ouverture avec attribut et sa valeur si elle existe ou une valeur nulle selon le cas.</p><pre id="r-591707" data-claire-element-id="591707"><code data-claire-semantic="javascript">[...]
/**
 * Formate un tag à la forme &lt;name attribut=&quot;value&quot;&gt;text
 */
getTagValue : function(name, value, attribut) {
	var tag = '';
	//Si aucun nom d'attribut n'est assigné
	if('' === attribut || undefined === attribut) {
		attribut = 'value';// l'attribut par défaut sera value
	}
	//Si aucune valeur d'attribut n'est assignée
	if (value === '') {
		tag += '&lt;'+name+' '+attribut+'=&quot;null&quot;&gt;';// attribut a pour valeur null
		
	} else {
		//Sinon on construit notre tag d'ouverture 
		tag = '&lt;'+name+' '+attribut+'=&quot;'+ value +'&quot;&gt;';            
	}    
	return tag;
},
[...]</code></pre><p id="r-591708" data-claire-element-id="591708">Le code est assez commenté pour comprendre le principe. :)</p><h3 id="r-les-listes-et-tableaux" data-claire-element-id="591729">Les listes et tableaux</h3><p id="r-591710" data-claire-element-id="591710">Les listes et les tableaux sont un peu plus complexes car ils vont imbriquer des tags.<br/> Commençons par les listes. Nous aurons deux types de listes (normales et numériques). Les tags seront de la forme :</p><pre id="r-591711" data-claire-element-id="591711"><code>&lt;Typedeliste&gt;
        &lt;unepuce&gt;Texte de la puce&lt;/unepuce&gt;
&lt;/Typedeliste&gt;</code></pre><p id="r-591712" data-claire-element-id="591712">Les types de listes seront : liste et listnum.<br/> Je vous donne l'exemple de la puce et vous aurez le tableau à faire en exercice ;) :</p><pre id="r-591713" data-claire-element-id="591713"><code data-claire-semantic="javascript">[...]
   /**
 * Liste et liste numérique
 */
setList : function(name) {
    var i = 1;
    var tag = '';
    var puce = '';
    var message = 'Tapez le texte de la puce : (Si vous voulez arrêter, cliquez sur Annuler)';
    var insertText = this.input.getSelectedText();    
    if(insertText !== ''){
        puce = &quot;\t&lt;puce&gt;&quot; + insertText + &quot;&lt;/puce&gt;\n&quot;;
        tag = &quot;&quot; + tag + &quot;&quot; + puce + &quot;&quot;;
    } else {
        insertText = prompt(message, &quot;Puce &quot; + i);
        while (insertText) {
            i++;
            if (insertText) {
                puce = &quot;\t&lt;puce&gt;&quot; + insertText + &quot;&lt;/puce&gt;\n&quot;;
                tag = &quot;&quot; + tag + &quot;&quot; + puce + &quot;&quot;;
                insertText = prompt (message,&quot;Puce &quot; + i);
            } else {
                break;
            }
        }
    }    
    tag = &quot;\n&lt;&quot;+name+&quot;&gt;\n&quot; + tag;
    return tag;
},

[...]</code></pre><p id="r-591714" data-claire-element-id="591714">Rien de très compliqué ici, si le client sélectionne un bout de texte, on insère une liste simple, sinon on lui demande le texte de la puce et tant que l'utilisateur ne clique pas sur annuler, on récupère le texte du prompt et on ajoute des puces.</p><p id="r-591715" data-claire-element-id="591715">À vous de coder la méthode <code>setTable</code> ! Les tags seront de la forme :</p><pre id="r-591716" data-claire-element-id="591716"><code>&lt;tableaux&gt;
        &lt;lignes&gt;
                &lt;colonnes&gt;Texte de la colonne&lt;/colonne&gt;
                &lt;colonnes&gt;Texte de la colonne&lt;/colonne&gt;
        &lt;/ligne&gt;
        &lt;lignes&gt;
                &lt;colonnes&gt;Texte de la colonne&lt;/colonne&gt;
                &lt;colonnes&gt;Texte de la colonne&lt;/colonne&gt;
        &lt;/lignes&gt;
&lt;/tableaux&gt;</code></pre><aside id="r-591718" data-claire-element-id="591718" data-claire-semantic="warning"><p id="r-591717" data-claire-element-id="591717">J'ai mis le nom des tags au pluriel ici pour éviter le parsage du zCode du SdZ. :)</p></aside><ul id="r-591723" data-claire-element-id="591723"><li id="r-591720" data-claire-element-id="591720"><p id="r-591719" data-claire-element-id="591719">Il va falloir demander le nombre de lignes et de colonnes que veut l'utilisateur pour son tableau…</p></li><li id="r-591722" data-claire-element-id="591722"><p id="r-591721" data-claire-element-id="591721">… et demander quel texte l'utilisateur veut insérer entre ses colonnes.</p></li></ul><p id="r-591724" data-claire-element-id="591724"><strong>Correction de la méthode :</strong></p><p id="r-591725" data-claire-element-id="591725"></p><div id="r-591727" data-claire-element-id="591727"><pre id="r-591726" data-claire-element-id="591726"><code data-claire-semantic="javascript">[...]
    /**
     * Tableau
     */
setTable : function() {
    var tag = '';
    var lineNumber = 0;
    var rowNumber = 0;    
    var select = this.input.getSelectedText();
    if(select !== ''){
        tag += &quot;\t&lt;ligne&gt;\n&quot;;
        tag += &quot;\t\t&lt;colonne&gt;&quot; + select + &quot;&lt;/colonne&gt;\n&quot;;
        tag += &quot;\t&lt;/ligne&gt;\n&quot;;        
    } else {
        lineNumber = prompt('Tapez le nombre de lignes que contiendra le tableau :','Nombre de lignes');
        rowNumber = prompt('Tapez le nombre de colonnes que contiendra le tableau :','Nombre de colonnes');
        for ( var i = 0; i &lt; lineNumber; i++) {
            tag += &quot;\t&lt;ligne&gt;\n&quot;;
            for (var j = 1; j &lt;= rowNumber; j++) {            
                text = prompt(&quot;Ligne:&quot; + (i + 1)+ &quot;\nTapez le texte de cette colonne : &quot;, &quot;Texte colonne &quot;+ j);
                if (text) {
                    tag += &quot;\t\t&lt;colonne&gt;&quot; + text + &quot;&lt;/colonne&gt;\n&quot;;
                } else {
                    break;
                }
            }
            tag += &quot;\t&lt;/ligne&gt;\n&quot;;
        }
    }        
    tag = &quot;&lt;tableau&gt;\n&quot; + tag;
    return tag;
},
[...]</code></pre></div><p id="r-591728" data-claire-element-id="591728">Ici, si le client sélectionne du texte on insère un tableau à une ligne et une colonne, sinon je récupère le nombre de lignes et de colonnes avec un prompt. Je fais une boucle sur mes lignes et colonnes.<br/> Sur chaque colonne, je demande le texte de la colonne avec un prompt et je construis mes tags (j'ai ajouté des tabulations et retours à la ligne pour le rendu).</p><h3 id="r-les-clips-2" data-claire-element-id="591732">Les clips</h3><p id="r-591730" data-claire-element-id="591730">La méthode pour insérer des vidéos ou animations :</p><pre id="r-591731" data-claire-element-id="591731"><code data-claire-semantic="javascript">[...]
setObject : function(name) {
	var tag = '';
	var app = prompt(&quot;Saisissez le type de l'application au choix :\n\r flash|wmv|avi|mpeg&quot;);
	var video = prompt(&quot;Saisissez le chemin du clip&quot;);
	var w = prompt(&quot;Saisissez la largeur&quot;);
	var h = prompt(&quot;Saisissez la hauteur du clip&quot;);
	var autoStart = '0';
	var autoPlay = 'false';
	var type = '';
	switch(app) {
		case 'flash':
			 type =  'x-shockwave-flash';
			break;
		case 'wmv':
			 type =  'video/x-ms-wmv';
			autoPlay = '';
			break;
		case 'avi':
			 type =  'video/x-msvideo';
			autoPlay = '';
			break;
		case 'mpeg':
			 type =  'video/mpeg';
			break;
	}
	if(h ==='' || h &gt; 600) h = 200;
	if(w === '' || w &gt; 600) w = 150;
	if(app == '') {
		alert(&quot;Vous devez saisir le nom de l'application&quot;);
		app = prompt(&quot;Saisissez le type de l'application au choix :\n\r flash|wmv|avi|mpeg&quot;);
	} else {
		if(video != '') {
			tag = '&lt;'+name+'=&quot;'+type+':'+w+':'+h+':'+autoStart+':'+autoPlay+'&quot;&gt;'+video;
		} else {
			tag = '&lt;'+name+'=&quot;'+type+':'+w+':'+h+':'+autoStart+':'+autoPlay+'&quot;&gt;';
		}	
	}
	return tag;
},
[...]</code></pre><h3 id="r-ajouter-les-events-des-boutons-de-choix-a-l-ecouteur" data-claire-element-id="591736">Ajouter les events des boutons de choix à l'écouteur</h3><p id="r-591733" data-claire-element-id="591733">Pour finir il ne faut pas oublier d'ajouter la méthode à l'écouteur :</p><pre id="r-591734" data-claire-element-id="591734"><code data-claire-semantic="javascript">[...]
// Écoute les événements
listeningEvent : function() {
	this.input.focus();
	this.eventButtons();
	this.eventMessageBox();
},
[...]</code></pre><p id="r-591735" data-claire-element-id="591735">Testez chaque bouton pour voir le résultat, le tag clip correspond à une balise object.<br/> Voilà, notre objet commence à être bien complet. Il nous manque les listes de choix, allons-y de ce pas !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools">Une zForm avec Mootools</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/le-zform">
Le ZForm
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-boutons-simples-1">
Les boutons simples
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-boutons-avec-choix-1">
Les boutons avec choix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-listes-de-choix-1">
Les listes de choix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/l-auto-visualisation-avec-ajax">
L&#039;auto-visualisation avec Ajax
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-boutons-simples-1">
<span class="arrow"></span>
<span class="next">Les boutons simples</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-listes-de-choix-1">
<span class="next">Les listes de choix</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Leslistesdechoix"></a><h2>Les listes de choix</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-boutons-avec-choix-1">
<span class="arrow"></span>
<span class="next">Les boutons avec choix</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/l-auto-visualisation-avec-ajax">
<span class="next">L&#039;auto-visualisation avec Ajax</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-avant-de-commencer-31" data-claire-element-id="591745">Avant de commencer</h2><h3 id="r-le-principe-28" data-claire-element-id="591744">Le principe</h3><p id="r-591739" data-claire-element-id="591739">Nous allons créer des listes de choix à l'aide de boutons, chaque bouton survolé faisant apparaître un menu de choix. Le choix sera soit un lien textuel, soit une image. Un exemple simple : le flottement. Un texte ou un élément HTML peut être disposé flottant à gauche ou à droite.<br/> Les tags seront de la forme suivante pour un texte flottant à droite :</p><pre id="r-591740" data-claire-element-id="591740"><code>&lt;flottant value=&quot;droite&quot;&gt;texte&lt;/flottant&gt;
//Correspond à la balise
&lt;div style=&quot;float: right;&quot;&gt;Text&lt;/div&gt;</code></pre><p id="r-591741" data-claire-element-id="591741">Au clic du bouton, une boîte contenant les choix va apparaître. Au clic du choix, le tag choisi sera inséré dans le textarea.<br/> Notre bouton :</p><pre id="r-591742" data-claire-element-id="591742"><code data-claire-semantic="html">&lt;!--  Boutons listes --&gt;
&lt;img data-bt=&quot;flottant&quot; class=&quot;bt-code listButtons&quot; src=&quot;public/images/boutons/bt-float.gif&quot;  alt=&quot;Couleur de la police&quot;  /&gt;
     &lt;div class=&quot;sliderBox&quot;&gt;
          &lt;a class=&quot;slider-link&quot; rel=&quot;gauche&quot;&gt;Flottant à gauche&lt;/a&gt;
          &lt;a class=&quot;slider-link&quot; rel=&quot;droit&quot;&gt;Flottant à droite&lt;/a&gt;        
     &lt;/div&gt;</code></pre><p id="r-591743" data-claire-element-id="591743">Au survol de l'image portant un nom de classe listButtons, la div <code data-claire-semantic="html">class=&quot;slider-box&quot;</code> va apparaître, pour afficher nos deux choix. Au clic sur l'un des liens <code data-claire-semantic="html">class=&quot;slider-link&quot;</code>, on enverra le paramètre <code data-claire-semantic="html">rel</code>gauche ou droite à notre méthode. <br/> Vous saisissez ? :)</p><h2 id="r-la-sliderbox-ses-evenements-et-methodes" data-claire-element-id="591803">La sliderBox, ses événements et méthodes</h2><p id="r-591746" data-claire-element-id="591746">Avant de coder, détaillons tous les événements et le nom des méthodes choisies.</p><ul id="r-591770" data-claire-element-id="591770"><li id="r-591748" data-claire-element-id="591748"><p id="r-591747" data-claire-element-id="591747">initListButtons : au chargement de la page les box doivent être cachées.</p></li><li id="r-591757" data-claire-element-id="591757"><p id="r-591749" data-claire-element-id="591749">eventList : event sur les listes de choix :</p><ul id="r-591756" data-claire-element-id="591756"><li id="r-591751" data-claire-element-id="591751"><p id="r-591750" data-claire-element-id="591750">au survol du bouton, la box apparaît ;</p></li><li id="r-591753" data-claire-element-id="591753"><p id="r-591752" data-claire-element-id="591752">lorsque la souris quitte le bouton, la box doit disparaître ;</p></li><li id="r-591755" data-claire-element-id="591755"><p id="r-591754" data-claire-element-id="591754">mais si on survole la box et ses liens, elle ne doit pas disparaître.</p></li></ul></li><li id="r-591762" data-claire-element-id="591762"><p id="r-591758" data-claire-element-id="591758">eventLinkList : event sur les liens de la liste :</p><ul id="r-591761" data-claire-element-id="591761"><li id="r-591760" data-claire-element-id="591760"><p id="r-591759" data-claire-element-id="591759">au clic du lien, le tag doit s'insérer dans le textarea.</p></li></ul></li><li id="r-591769" data-claire-element-id="591769"><p id="r-591763" data-claire-element-id="591763">eventBoxList : event sur les boîtes à liste :</p><ul id="r-591768" data-claire-element-id="591768"><li id="r-591765" data-claire-element-id="591765"><p id="r-591764" data-claire-element-id="591764">au survol des liens, la box ne doit pas disparaître ;</p></li><li id="r-591767" data-claire-element-id="591767"><p id="r-591766" data-claire-element-id="591766">lorsque la souris quitte la box et n'est pas sur le bouton liste, la box doit disparaître.</p></li></ul></li></ul><p id="r-591771" data-claire-element-id="591771">Voilà pour les events. Il y aura aussi, si vous avez suivi, les deux méthodes suivantes :</p><ul id="r-591776" data-claire-element-id="591776"><li id="r-591773" data-claire-element-id="591773"><p id="r-591772" data-claire-element-id="591772">hide : pour cacher la box ;</p></li><li id="r-591775" data-claire-element-id="591775"><p id="r-591774" data-claire-element-id="591774">show : pour l'afficher.</p></li></ul><h3 id="r-cacher-les-boites-de-menus-au-demarrage" data-claire-element-id="591780">Cacher les boîtes de menus au démarrage</h3><p id="r-591777" data-claire-element-id="591777">Il va falloir mettre notre sliderBox en position absolue pour qu'elle s'affiche juste en dessous du bouton survolé, et donc calculer la position left de la div. Elle sera appelée au chargement de la page, on lancera l'appel dans notre constructeur.<br/> Vous devez coder la méthode initListButtons :</p><pre id="r-591778" data-claire-element-id="591778"><code data-claire-semantic="javascript">/**
* Positionne et cache les boîtes des sélecteurs de liste
*/
initListButtons : function() {
	if(undefined !== this.sliders) {
		//On fait une boucle sur toutes les boîtes à menu
		this.sliders.each(function(slider){
			//Je récupère l'attribut name de l'image
			var img = slider.getPrevious('img');
			//Sa position
			var x = img.getPosition().x.toInt();
			var y = img.getPosition().y.toInt() + img.getSize().y.toInt();
			//Positionne les box par rapport au bouton cliqué
			slider.setStyles({
				'position' : 'absolute',
				'left' : x,
				'top' : y,
				'display' : 'none',
				'visibility' : 'hidden'		
			});
		});
	}
},</code></pre><p id="r-591779" data-claire-element-id="591779">Le code est commenté pour vous expliquer le cheminement.</p><h3 id="r-la-methode-eventlist" data-claire-element-id="591782">La méthode eventList</h3><pre id="r-591781" data-claire-element-id="591781"><code data-claire-semantic="javascript">[...]
/**
 * Events sur les boutons sélecteurs
 */
eventList : function() {
	//Événements sur les listes de choix
	this.listButtons.each(function(bt){
		if(undefined !== bt) {	
			bt.addEvents({
				'mouseenter' : function(){ //On affiche la box et on écoute ses events 		
					this.eventBoxList(bt);
				}.bind(this),
				'mouseleave' : function() { //On cache la box 					
					this.timer = this.hide.delay(this.closeDelay, this, bt.getNext(this.options.slider));
				}.bind(this)
			});		
		}
	}, this);
},
[...]</code></pre><h3 id="r-la-methode-eventboxlist" data-claire-element-id="591784">La méthode eventBoxList</h3><pre id="r-591783" data-claire-element-id="591783"><code data-claire-semantic="javascript">[...]
// Event sur les menus 
eventBoxList : function(el) {
	var box = el.getNext('div');
	if(undefined !==  box) {				
		this.show(el, box); //On affiche le menu			
		box.addEvents({
			'mouseleave': function(){
				this.timer = this.hide.delay(this.closeDelay, this, box); //On cache le menu au bout de 500 millisecondes
			}.bind(this),
			'mouseenter': function(){
				clearTimeout(this.timer);//On remet le timer à 0
			}.bind(this)
		});
	}
},
[...]</code></pre><h3 id="r-la-methode-eventlinklist" data-claire-element-id="591786">La méthode eventLinkList</h3><pre id="r-591785" data-claire-element-id="591785"><code data-claire-semantic="javascript">[...]
// Event sur les liens de la liste
eventLinkList : function() {
	if(undefined !== this.sliderLink) {
		//On boucle sur tous les lien slider-link
		this.sliderLink.each(function(link){
			//Si on clique
			link.addEvent('mousedown', function(){
				//On récupère l'attribut data-bt de l'image
				var name = link.getParent('div').getPrevious('img').getProperty('data-bt');
				//On insère notre tag avec la valeur de l'attribut rel du lien cliqué
				this.insertTag('&lt;'+name+' value=&quot;'+link.get('rel')+'&quot;&gt;', '&lt;/'+name+'&gt;');
			}.bind(this));
		}, this);
	}
},		
[...]</code></pre><h3 id="r-les-methodes-show-et-hide" data-claire-element-id="591789">Les méthodes show et hide</h3><p id="r-591787" data-claire-element-id="591787">On utilisera Fx.Morph pour modifier les propriétés de style de la box :</p><pre id="r-591788" data-claire-element-id="591788"><code data-claire-semantic="javascript">/**
 * Cache les boîtes de menus
 */
hide :  function(box) {
	var fx = new Fx.Morph(box, {duration:800,transition: Fx.Transitions.linear});
	fx.start({
		opacity : [1,0],
		display : 'block',
		visibility : 'hidden'
	});
},    
/**
 * Affiche les boîtes de menus
 */
show : function(el, box) {
	var fx = new Fx.Morph(box, {duration:800,transition: Fx.Transitions.linear});
	fx.start({
		left : el.getPosition().x.toInt(),
		display : 'block',
		visibility : 'visible',
		opacity : [0,1]
	});        
},</code></pre><h3 id="r-analyse-du-code-3" data-claire-element-id="591802">Analyse du code</h3><ul id="r-591794" data-claire-element-id="591794"><li id="r-591791" data-claire-element-id="591791"><p id="r-591790" data-claire-element-id="591790">Pour hide : on assigne en paramètre la box, on fait disparaître notre box grâce aux propriétés css.</p></li><li id="r-591793" data-claire-element-id="591793"><p id="r-591792" data-claire-element-id="591792">Pour show : fonctionnement similaire sauf que nous avons besoin de la position du bouton (elle représente le bouton image et box la div) pour que la box s'affiche au bon endroit.</p></li></ul><p id="r-591795" data-claire-element-id="591795">Dans listeningEvent, il faut ajouter :</p><pre id="r-591796" data-claire-element-id="591796"><code data-claire-semantic="javascript">this.eventSelectors();
this.eventLinkList();</code></pre><p id="r-591797" data-claire-element-id="591797">Et dans la méthode initialize, il faut ajouter :</p><pre id="r-591798" data-claire-element-id="591798"><code data-claire-semantic="javascript">this.initListButtons();</code></pre><aside id="r-591800" data-claire-element-id="591800" data-claire-semantic="information"><p id="r-591799" data-claire-element-id="591799">Si le comportement de survol ne vous plaît pas et que vous préférez afficher les listes au clic du bouton, il faudra modifier la méthode eventList en conséquence, comme ajouter un event onclick et un booléen qui définit un statut ouvert ou fermé par exemple.</p></aside><p id="r-591801" data-claire-element-id="591801">Testez donc chaque bouton pour voir si tout fonctionne.<br/> Ça commence à en faire du code... Nous approchons de la fin avec le prochain chapitre : la visualisation automatique avec Ajax.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools">Une zForm avec Mootools</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/le-zform">
Le ZForm
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-boutons-simples-1">
Les boutons simples
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-boutons-avec-choix-1">
Les boutons avec choix
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-listes-de-choix-1">
Les listes de choix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/l-auto-visualisation-avec-ajax">
L&#039;auto-visualisation avec Ajax
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-boutons-avec-choix-1">
<span class="arrow"></span>
<span class="next">Les boutons avec choix</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/l-auto-visualisation-avec-ajax">
<span class="next">L&#039;auto-visualisation avec Ajax</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="L039auto-visualisationavecAjax"></a><h2>L&#039;auto-visualisation avec Ajax</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-listes-de-choix-1">
<span class="arrow"></span>
<span class="next">Les listes de choix</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-choix-du-parsage" data-claire-element-id="591806">Choix du parsage</h2><p id="r-591805" data-claire-element-id="591805">Le langage zCode fonctionne logiquement avec une visualisation PHP et XML/XSL. J'ai choisi pour le tuto un « parsage » à l'aide de PHP et des regex. Le « parsage » fait déjà l'objet de plusieurs tutoriels, ici il a seulement pour but d'avoir le rendu de notre ZForm et voir si tout fonctionne correctement.</p><h2 id="r-le-principe-29" data-claire-element-id="591812">Le principe</h2><p id="r-591807" data-claire-element-id="591807">Nous allons envoyer une requête Ajax vers un fichier PHP, ce fichier va nous parser le texte en HTML et nous le retourner afin de l'afficher dans la div id=&quot;prev&quot;. Nous aurons donc deux méthodes JavaScript à coder, une méthode parseText qui enverra la requête Ajax et une méthode previewParser qui s'occupera d'appeler la méthode parseText.</p><p id="r-591808" data-claire-element-id="591808">Un petit schéma pour être plus clair :</p><figure id="r-591810" data-claire-element-id="591811"><img id="r-591809" data-claire-element-id="591809" src="medias/uploads.siteduzero.com_files_330001_331000_330055.gif" alt="Modèle UML du système"/></figure><h2 id="r-la-requete-ajax" data-claire-element-id="591817">La requête Ajax</h2><p id="r-591813" data-claire-element-id="591813">Nous allons coder la méthode envoyant la requête Ajax : il faut récupérer le texte du textarea et l'envoyer en post vers le fichier PHP. La réponse sera insérée dans la div prev.</p><pre id="r-591814" data-claire-element-id="591814"><code data-claire-semantic="javascript">[...]
//Parse le texte via PHP pour la visualisation
parseText : function(text) {
	var prev = this.preview;
	var req = new Request({
		url : 'parse.php',
		method : 'post',
		onComplete: function() {
			prev.set('html', this.response.text);
		}			
	});
	req.send('text='+escape(text));
},	
[...]</code></pre><h3 id="r-analyse-du-code-4" data-claire-element-id="591816">Analyse du code</h3><p id="r-591815" data-claire-element-id="591815">Ma méthode reçoit donc le texte issu du champ en paramètre, on envoie la requête avec le texte. Une fois la réponse récupérée, on l'insère dans la div prev. Sur le fichier PHP, il faudra donc récupérer une variable post $_POST['text'], que nous allons « parser » grâce à un objet PHP.</p><h2 id="r-le-parser-php" data-claire-element-id="591822">Le <em>parser</em> PHP</h2><p id="r-591818" data-claire-element-id="591818">Si vous ne connaissez pas PHP, allez voir le tuto de M@teo21. Nous allons créer tout d'abord un objet pour parser notre texte en format HTML. Notre classe va donc transformer les tags zCode en balises HTML.<br/> Prenons un fichier parser.class.php, notre objet va contenir quatre attributs par défaut et des méthodes de « parsage » pour nos tags.</p><pre id="r-591819" data-claire-element-id="591819"><code data-claire-semantic="html+php">&lt;?php
/**
 * @author franckysolo
 * @see Tuto ZForm avec mootools - Site du Zéro
 * @since 24/09/2010 
 * @revision 13/02/2011
 */
class ZCodeParser
{
	/**
	 * Tags autorisés dans le ZForm
	 * @var array
	 */
	private $_authorizedTags = array(
		'attention', 'erreur', 'infos', 'question',
		'liste' , 'listnum', 'puce',
		'tableau', 'ligne', 'colonne',
		'citation', 'titre', 'image', 'clip', 
		'couleur', 'police', 'taille',
		'gras', 'italique', 'souligne', 'barre',
		'position', 'flottant', 'marge',
		'url', 'urlancre', 'ancre'	
	);
	/**
	 * Tags parsés avec str_replace
	 * @var array
	 */
	private $_replaceTags = array
	(
		//Simple Tag
		'&lt;gras&gt;' 	=&gt; '&lt;span style=&quot;font-weight: bold;&quot;&gt;',
		'&lt;/gras&gt;' 	=&gt; '&lt;/span&gt;',	
		'&lt;souligne&gt;' 	=&gt; '&lt;span style=&quot;text-decoration: underline;&quot;&gt;', 
		'&lt;/souligne&gt;' 	=&gt; '&lt;/span&gt;',
		'&lt;barre&gt;' 	=&gt; '&lt;span style=&quot;text-decoration: line-through;&quot;&gt;',
		'&lt;/barre&gt;' 	=&gt; '&lt;/span&gt;',
		//Div
		'&lt;attention&gt;' 	=&gt; '&lt;div class=&quot;parser-attention&quot;&gt;', 
		'&lt;/attention&gt;' 	=&gt; '&lt;/div&gt;',
		'&lt;erreur&gt;' 	=&gt; '&lt;div class=&quot;parser-erreur&quot;&gt;', 
		'&lt;/erreur&gt;' 	=&gt; '&lt;/div&gt;',
		'&lt;infos&gt;' 	=&gt; '&lt;div class=&quot;parser-infos&quot;&gt;', 
		'&lt;/infos&gt;' 	=&gt; '&lt;/div&gt;',
		'&lt;question&gt;' 	=&gt; '&lt;div class=&quot;parser-question&quot;&gt;',
		'&lt;/question&gt;' 	=&gt; '&lt;/div&gt;',
				
		'&lt;italique&gt;' 	=&gt; '&lt;em&gt;', 
		'&lt;/italique&gt;' 	=&gt; '&lt;/em&gt;',	
		'&lt;marge&gt;' 	=&gt; '&lt;blockquote&gt;', 	
		'&lt;/marge&gt;' 	=&gt; '&lt;/blockquote&gt;', 
		'&lt;liste&gt;' 	=&gt; '&lt;ul&gt;' , 	
		'&lt;/liste&gt;' 	=&gt; '&lt;/ul&gt;' , 
		'&lt;listnum&gt;'  	=&gt; '&lt;ol&gt;', 		
		'&lt;/listnum&gt;'  	=&gt; '&lt;/ol&gt;', 
		'&lt;puce&gt;' 	=&gt; '&lt;li&gt;', 		
		'&lt;/puce&gt;' 	=&gt; '&lt;/li&gt;',
		'&lt;tableau&gt;' 	=&gt; '&lt;table&gt;', 	
		'&lt;/tableau&gt;' 	=&gt; '&lt;/table&gt;',
		'&lt;ligne&gt;' 	=&gt; '&lt;tr&gt;', 		
		'&lt;/ligne&gt;' 	=&gt; '&lt;/tr&gt;',
		'&lt;colonne&gt;'	=&gt; '&lt;td&gt;',		
		'&lt;/colonne&gt;'	=&gt; '&lt;/td&gt;',
	
		//Attr Tag		
		'&lt;titre value=&quot;h1&quot;&gt;' 	=&gt; '&lt;h1&gt;',
		'&lt;/titre&gt;' 		=&gt; '&lt;/h1&gt;',
		'&lt;titre value=&quot;h2&quot;&gt;' 	=&gt; '&lt;h2&gt;',
		'&lt;/titre&gt;' 		=&gt; '&lt;/h2&gt;',	
		'&lt;titre value=&quot;h3&quot;&gt;' 	=&gt; '&lt;h3&gt;',
		'&lt;/titre&gt;' 		=&gt; '&lt;/h3&gt;',
	
		'&lt;position value=&quot;gauche&quot;&gt;' 	=&gt; '&lt;div style=&quot;text-align: left;&quot;&gt;',
		'&lt;position value=&quot;center&quot;&gt;' 	=&gt; '&lt;div style=&quot;text-align: center;&quot;&gt;',
		'&lt;position value=&quot;droite&quot;&gt;'	=&gt; '&lt;div style=&quot;text-align: right;&quot;&gt;',
		'&lt;position value=&quot;justifier&quot;&gt;' 	=&gt; '&lt;div style=&quot;text-align: justified;&quot;&gt;',
		'&lt;/position&gt;' 			=&gt; '&lt;/div&gt;',
	
		'&lt;flottant value=&quot;gauche&quot;&gt;' 	=&gt; '&lt;div style=&quot;float: left;&quot;&gt;',
		'&lt;flottant value=&quot;droit&quot;&gt;'	=&gt; '&lt;div style=&quot;float: right;&quot;&gt;',
		'&lt;/flottant&gt;' 			=&gt; '&lt;/div&gt;',
	
		'&lt;taille value=&quot;xx-large&quot;&gt;'	=&gt; '&lt;span style=&quot;font-size: xx-large;&quot;&gt;',
		'&lt;taille value=&quot;x-large&quot;&gt;'	=&gt; '&lt;span style=&quot;font-size: x-large;&quot;&gt;',
		'&lt;taille value=&quot;large&quot;&gt;'	=&gt; '&lt;span style=&quot;font-size: large;&quot;&gt;',
		'&lt;taille value==&quot;medium&quot;&gt;'	=&gt; '&lt;span style=&quot;font-size: medium;&quot;&gt;',
		'&lt;taille value=&quot;xx-small&quot;&gt;'	=&gt; '&lt;span style=&quot;font-size: xx-small;&quot;&gt;',
		'&lt;taille value=&quot;x-small&quot;&gt;'	=&gt; '&lt;span style=&quot;font-size: x-small;&quot;&gt;',
		'&lt;taille value=&quot;small&quot;&gt;'	=&gt; '&lt;span style=&quot;font-size: small;&quot;&gt;',	
		'&lt;/taille&gt;'   			=&gt; '&lt;/span&gt;',
		
	);
	
	/**
	 * Pattern Regex parsage avec preg_replace
	 * @var array
	 */
	private $_patterns = array(
		'`\&lt;image\&gt;(.+)\&lt;\/image\&gt;`iU',
		'`\&lt;ancre value=\&quot;(.+)\&quot;\&gt;\&lt;/ancre\&gt;`iU',
		'`\&lt;urlancre value=\&quot;(.+)\&quot;\&gt;(.+)\&lt;/urlancre\&gt;`iU',
		'`\&lt;url value=\&quot;(.+)\&quot;\&gt;(.+)\&lt;/url\&gt;`iU',
		'`\&lt;couleur value=\&quot;(\#[a-fA-F0-9]{6})\&quot;\&gt;(.+)\&lt;\/couleur\&gt;`isU',
		'`\&lt;police value=\&quot;(.+)\&quot;\&gt;(.+)\&lt;\/police\&gt;`isU',
		'`\&lt;citation auteur=\&quot;(.+)\&quot;&gt;(.+)\&lt;\/citation\&gt;`isU',
		
	);
	/**
	 * Balises HTML de remplacement. Parsage avec preg_replace
	 * @var array
	 */
	private $_remplacement = array(
		'&lt;img src=&quot;$1&quot; alt=&quot;Image utilisateur&quot; /&gt;',
		'&lt;a name=&quot;$1&quot;&gt;&lt;/a&gt;',
		'&lt;a href=&quot;#$1&quot;&gt;$2&lt;/a&gt;',
		'&lt;a href=&quot;$1&quot;&gt;$2&lt;/a&gt;',
		'&lt;span style=&quot;color:$1&quot;&gt;$2&lt;/span&gt;',
		'&lt;span style=&quot;font-family: $1&quot;&gt;$2&lt;/span&gt;',
		'&lt;div class=&quot;title-citation&quot;&gt;Citation :  $1&lt;/div&gt;&lt;div class=&quot;citation&quot;&gt;$2&lt;/div&gt;'
	);
	
	/**
	 * Enlève les \n sur tableau et liste et protège contre les failles XSS
	 * @param string $text
	 * @return string
	 */
	public function cleanText($text)
	{	
		$parseValues = array();
		//On « préparse » nos balises autorisées pour éviter la transformation des chevrons avec htmlspecialchars
		foreach($this-&gt;_authorizedTags as $key =&gt; $value) {
			$parseValues[$key] = '`&lt;([\/]?'.$value.')( )*([^&gt;]*)?&gt;`i';
		}	
		$text = preg_replace_callback($parseValues, array(&amp;$this, '_preparse'), $text); 
		//On applique la protection à tout le texte
		$text = htmlspecialchars($text, ENT_NOQUOTES);
		//On « déparse » nos balises autorisées
		foreach($this-&gt;_authorizedTags as $key =&gt; $value) {
			$parseValues[$key] = '`\[([\/]?'.$value.')( )*([^\]]*)?\]`i';
		}
		$text = preg_replace_callback($parseValues, array(&amp;$this, '_postparse'), $text);
		$text = preg_replace_callback
		(
			'`(\&lt;script(?:.*)\&gt;(?:.+)\&lt;\/script\&gt;)`isU',
			create_function('$text', 'return htmlspecialchars($text[0]);'),
			$text
		);		
		//On enlève les retours à la ligne ajoutés pour l'indentation dans le champ de texte
		$pattern = '`\&lt;(?:(tableau|listnum|liste))\&gt;(\n*)(?:.+)\&lt;\/(?:(tableau|listnum|liste))\&gt;`isU';
		$text = preg_replace_callback($pattern, array(&amp;$this, 'cleanBr'), $text);
		return $text;
	}
	
	/**
	 * Supprime le retour à la ligne de mise en forme
	 * @param string $text
	 * @return string
	 */
	public function cleanBr($text)
	{
		return str_replace(array(&quot;\n&quot;, &quot;\r&quot;), '', $text[0]);
	}
	/**
	 * Parse le texte avec str_replace
	 * @param string $text
	 * @return string
	 */
	public function parseReplace($text)
	{		
		return str_replace(array_keys($this-&gt;_replaceTags), array_values($this-&gt;_replaceTags), $text);
	}
	
	/**
	 * Parse le texte avec preg_replace
	 * @param string $text
	 */
	public function parseRegex($text)
	{
		$array = array_combine($this-&gt;_patterns, $this-&gt;_remplacement);
		foreach($array as $pattern =&gt; $replacement){
			$text = preg_replace($pattern, $replacement, $text);
		}
		return $text;
	}
	
	/**
	 * Parse le texte
	 * @param string $text
	 */	
	public function parse($text) {
		$text = stripslashes($text);
		$text = $this-&gt;cleanText($text);
		$text = $this-&gt;parseReplace($text);
		$text = $this-&gt;parseRegex($text);
		$text = $this-&gt;parserObjectTag($text);
		$text = nl2br($text);
		return $text;
	}

	/**
	 * Tag clip =&gt; &lt;object&gt;&lt;param value=value /&gt;&lt;/object&gt;
	 * @param string $text
	 */
	public function parserObjectTag($text) {
		$text = preg_replace
		(
			'`\&lt;clip=\&quot;(video/x-msvideo|video/x-ms-wmv|x-shockwave-flash|video/mpeg):([\d]{3}):([\d]{3}):(0|1):(false|true|\s)*\&quot;\&gt;(.+)\&lt;/clip\&gt;`i',
			'&lt;object type=&quot;application/$1&quot; data=&quot;$6&quot; width=&quot;$2&quot; height=&quot;$3&quot; style=&quot;margin:auto; background-color: black;&quot;&gt;
				&lt;param name=&quot;movie&quot; value=&quot;$6&quot; /&gt;	
				&lt;param name=&quot;autostart&quot; value=&quot;$4&quot; /&gt;
				&lt;param name=&quot;autoplay&quot; value=&quot;$5&quot; /&gt;
				&lt;param name=&quot;quality&quot; value=&quot;high&quot; /&gt;
				&lt;param name=&quot;loop&quot; value=&quot;false&quot;&gt; 
				&lt;param name=&quot;wmode&quot; value=&quot;transparent&quot; /&gt;
			&lt;/object&gt;', $text
		);
		return $text;
	}
			
	/**
	 * Convertit les &lt; &gt; en [ ] des balises autorisées
	 * @param array $matches
	 */
	private function _preparse($matches)
	{
		return '['.$matches[1].$matches[2].$matches[3].']';
	}
	
	/**
	 * Convertit les [ ] en &lt; &gt; des balises autorisées
	 * @param array $matches
	 */
	private function _postparse($matches)
	{
		return '&lt;'.$matches[1].$matches[2].$matches[3].'&gt;';	
	}  
}
?&gt;</code></pre><h3 id="r-analyse-du-code-5" data-claire-element-id="591821">Analyse du code</h3><p id="r-591820" data-claire-element-id="591820">Nous utiliserons str_replace pour nos tags contenus dans le tableau parseTag. Pour les autres Tags on utilisera des regex. Je vous renvoie au cours sur les regex pour les captures et remplacements de mots, ici le but n'est pas d'étudier les regex mais de parser notre texte. <br/> La méthode cleanText me permet d'éliminer les retours à la ligne ajoutés pour la bonne indentation des tags du ZForm, mais aussi protège contre les failles XSS.</p><h2 id="r-la-visualisation" data-claire-element-id="591847">La visualisation</h2><p id="r-591823" data-claire-element-id="591823">Enfin, nous allons activer l'auto-visualisation grâce à la méthode previewParser. Notre méthode parseText JavaScript envoie la requête au fichier parser.php.<br/> Créons donc ce fichier :</p><pre id="r-591824" data-claire-element-id="591824"><code data-claire-semantic="html+php">&lt;?php
include 'parser.class.php';
$text = $_POST['text'];
$parser = new ZCodeParser();
echo $parser-&gt;parse($text);</code></pre><p id="r-591825" data-claire-element-id="591825">Dernière chose à accomplir, la méthode previewParser va appeler la méthode parseText.</p><pre id="r-591826" data-claire-element-id="591826"><code data-claire-semantic="javascript">//Visualisation dans la div id=prev
previewParser : function() {
	var txt = this.input.value; 			
	this.parseText(txt);			
}</code></pre><p id="r-591827" data-claire-element-id="591827">Et si je clique ou j'écris quelque chose, je n'ai toujours pas d'aperçu !!! :(</p><aside id="r-591829" data-claire-element-id="591829" data-claire-semantic="information"><p id="r-591828" data-claire-element-id="591828">Il faut déclarer notre méthode pour qu'elle fonctionne, nous allons l'ajouter à l'insertion des tags et sur l'événement keyup du le champ de texte.</p></aside><p id="r-591830" data-claire-element-id="591830">Finalement, vous aurez les fichiers suivants :</p><ul id="r-591843" data-claire-element-id="591843"><li id="r-591832" data-claire-element-id="591832"><p id="r-591831" data-claire-element-id="591831">les images des boutons dans le dossier public/images/boutons/ ;</p></li><li id="r-591834" data-claire-element-id="591834"><p id="r-591833" data-claire-element-id="591833">un fichier zform.js contenant notre ZForm en JavaScript dans le dossier public/js/ ;</p></li><li id="r-591836" data-claire-element-id="591836"><p id="r-591835" data-claire-element-id="591835">un fichier parser.class.php contenant notre <em>parser</em> PHP à la racine ;</p></li><li id="r-591838" data-claire-element-id="591838"><p id="r-591837" data-claire-element-id="591837">un fichier parser.php pour la requête Ajax à la racine ;</p></li><li id="r-591840" data-claire-element-id="591840"><p id="r-591839" data-claire-element-id="591839">un fichier zform.css dans le dossier public/css/ ;</p></li><li id="r-591842" data-claire-element-id="591842"><p id="r-591841" data-claire-element-id="591841">notre index.html à la racine.</p></li></ul><h3 id="r-voici-le-code-complet-de-zform-js" data-claire-element-id="591846">Voici le code complet de ZForm js :</h3><pre id="r-591844" data-claire-element-id="591844"><code data-claire-semantic="javascript">/**
 * @author franckysolo
 * @see Tuto ZForm avec mootools - Site du Zéro
 * @since 24/09/2010 
 * @revision 13/02/2011
 */

var ZForm = new Class({

    Implements : Options,
    options : {    
        textId : 'text', //    id du textarea
        preview : 'prev', // id de la div de prévisualisation
        buttons : '.splButtons', //    les boutons simples            
        dlgButtons : '.dlgButtons', //    les boutons ouvrant une boite de dialogue
        listButtons : '.listButtons', //    les boutons listes ouvrant un menu de choix
        slider : '.sliderBox', //    les boites contenant un menu de choix
        sliderLink : '.slider-link',  //    les liens du menu de choix
        closeDelay : 500 // temps avant fermeture de la boite de menu en milliseconde
    },
    /**
     * @param options
     */
    initialize : function(options) {
        this.setOptions(options);
        this.input = $(this.options.textId); // getElementById(textId)
        this.preview = $(this.options.preview); // getElementById(preview)
        this.timer = 0;        
        //Buttons
        this.buttons = $$(this.options.buttons);  //tableau de tous les boutons simples
        this.dlgButtons = $$(this.options.dlgButtons);//tableau de tous les boutons ouvrant une boite de dialogue
        this.sliders = $$(this.options.slider);//tableau de toutes les boites contenant un menu de choix
        this.listButtons = $$(this.options.listButtons);//tableau de toutes les listes ouvrant un menu de choix
        this.sliderLink = $$(this.options.sliderLink);//tous les liens de menu de choix
        this.initListButtons();        
    },
    
    //Écoute les événements
    listeningEvent : function() {
        this.input.focus();
        this.eventButtons();
        this.eventMessageBox();
        this.eventList();
        this.eventLinkList();
        //Preview du parser
        if(undefined !== this.input) {
            this.input.addEvent('keyup', function() {
                this.previewParser();
            }.bind(this));
        }    
    },
    
    initListButtons : function() {
        if(undefined !== this.sliders) {
            //On fait une boucle sur toutes les boites à menu
            this.sliders.each(function(slider){
                //Je récupère l'attribut name de l'image
                var img = slider.getPrevious('img');
                var x = img.getPosition().x.toInt();
                var y = img.getPosition().y.toInt() + img.getSize().y.toInt();
                //Positionne les box par rapport au bouton cliqué
                slider.setStyles({
                    'position' : 'absolute',
                    'left' : x,
                    'top' : y,
                    'display' : 'none',
                    'visibility' : 'hidden'        
                });
            });
        }
    },
    
    /**
     * Events sur les boutons simples
     */
    eventButtons : function() {
        //Si c'est I.E. on utilise plutôt l'event mousedown
        var event = (Browser.ie) ? 'mousedown' : 'click';
        //On écoute tous les boutons simples
        this.buttons.each(function(button){
            //Si un event est détecté
            button.addEvent(event, function(){
                //On récupère l'attribut data-bt de l'image
                var name = button.getProperty('data-bt');
                //On appelle la méthode d'insertion de tags avec les bons paramètres
                this.insertTag('&lt;'+name+'&gt;', '&lt;/'+name+'&gt;', this.input.getSelectedText());
            }.bind(this));
        }, this);
    },
    
    //Insertion des tags 
    insertTag : function(startTag, endTag, select) {    
        //On donne le focus à notre champ de texte
        this.input.focus();        
        //S'il n'y a pas de sélection
        if(select === null || undefined === select) {    
            //On insère nos tags autour du curseur
            this.input.insertAroundCursor({'before' : startTag, 'after' : endTag});
        } else {
            //Sinon on insère nos tags au curseur
            this.input.insertAtCursor(startTag + select + endTag, false);    
        }    
        this.input.focus();
        this.previewParser();    
    },
    
    /**
     * Lien ouvrant une fenêtre box pour insérer une ou des valeurs au choix
     */
    eventMessageBox : function() {
        var event = (Browser.ie) ? 'mousedown' : 'click';
        this.dlgButtons.each(function(bt){
            var link = $(bt);
            var text = value = '';        
            if(undefined !== link) {
                link.addEvent(event, function(){
                    var name = link.getProperty('data-bt');
                    var startTag = endTag = '';
                    var select = this.input.getSelectedText();
                    switch(name) {                    
                        case 'tableau':  
                            startTag = this.setTable();
                            text = null;
                        break;
                            
                        case 'liste':
                        case 'listnum' :
                            startTag = this.setList(name);
                            text = null;
                        break;
                            
                        case 'image' : 
                            text = (select !== '') ? select : prompt(&quot;Tapez le nom d'emplacement de l'image : &quot;);                            
                            startTag = this.getSimpleTag(name, text);
                        break;
                            
                        case 'clip':
                            startTag = this.setObject(name);
                        break;
                        
                        case 'citation' :
                            value = prompt(&quot;Tapez le nom de l'auteur de la citation :&quot;);
                            text = null;
                            startTag = this.getTagValue(name, value, 'auteur');
                        break;
                        
                        case 'url' :
                            value = prompt(&quot;Tapez l'adresse du lien : &quot;);
                            text = (select === '') ? prompt(&quot;Tapez le texte du lien : &quot;): select;
                            startTag = this.getTagValue(name, value);
                        break; 
                        
                        case 'urlancre' :
                            value =  (select !== '') ? select : prompt(&quot;Tapez le nom de l'ancre : &quot;);    
                            text = prompt(&quot;Tapez le texte du lien : &quot;);
                            startTag = this.getTagValue(name, value);
                            break;
                        
                        case 'ancre' :
                            alert('Lier avec un lien de type:'+&quot;\n&quot;+'&lt;urlancre value=&quot;nomdeLancre&quot;&gt;Texte du lien&lt;/url&gt;');
                            value = (select !== '') ? select : prompt(&quot;Tapez le nom de l'ancre : &quot;);    
                            text = prompt(&quot;Tapez le texte du lien : &quot;);
                            startTag = this.getTagValue(name, value);
                        break;                                
                    }
                    endTag = '&lt;/'+name+'&gt;';
                    this.insertTag(startTag, endTag, text);
                }.bind(this));
            }
        }, this);
    },
    /**
     * Formate un tag à la forme &lt;name attribut=&quot;value&quot;&gt;text
     */
    getTagValue : function(name, value, attribut) {
        var tag = '';
        //Si aucun nom d'attribut n'est assigné
        if('' === attribut || undefined === attribut) {
            attribut = 'value'; // L'attribut par défaut sera value
        }
        //Si aucune valeur d'attribut n'est assignée
        if (value === '') {
            tag += '&lt;'+name+' '+attribut+'=&quot;null&quot;&gt;'; // attribut a pour valeur null
            
        } else {
            //Sinon on construit notre tag d'ouverture 
            tag = '&lt;'+name+' '+attribut+'=&quot;'+ value +'&quot;&gt;';            
        }    
        return tag;
    },
    /**
     * Formate un tag à la forme &lt;tag&gt;text
     */
    getSimpleTag : function(name, text) {
        var tag = '';
        //Si aucune sélection
        if (text === '') {
            tag = '&lt;'+name+'&gt;null';        //null entre les balises    
        } else {
            tag = '&lt;'+name+'&gt;'; //sinon on ajoute juste le tag
        }
        return tag;
    },
    /**
     * Tableau
     */
    setTable : function() {
        var tag = '';
        var lineNumber = rowNumber = 0;        
        lineNumber = prompt('Tapez le nombre de lignes que contiendra le tableau :','Nombre de lignes');
        rowNumber = prompt('Tapez le nombre de colonnes que contiendra le tableau :','Nombre de colonnes');
        for ( var i = 0; i &lt; lineNumber; i++) {
            tag += &quot;\t&lt;ligne&gt;\n&quot;;
            for (var j = 1; j &lt;= rowNumber; j++) {            
                var text = prompt(&quot;Ligne:&quot; + (i + 1)+ &quot;\nTapez le texte de cette colonne : &quot;, &quot;Texte colonne &quot;+ j);
                if (text) {
                    tag += &quot;\t\t&lt;colonne&gt;&quot; + text + &quot;&lt;/colonne&gt;\n&quot;;
                } else {
                    break;
                }
            }
            tag += &quot;\t&lt;/ligne&gt;\n&quot;;
        }
        tag = &quot;&lt;tableau&gt;\n&quot; + tag;
        return tag;
    },
    /**
     * Liste et liste numérique
     */
    setList : function(name) {
        var i = 1;
        var tag = '';
        var insertText = prompt (
            &quot;Tapez le texte de la puce : (Si vous voulez arrêter, cliquez sur Annuler) &quot;,
            &quot;Puce &quot; + i
        );    
        while (insertText) {
            i++;
            if (insertText) {
                var puce = &quot;\t&lt;puce&gt;&quot; + insertText + &quot;&lt;/puce&gt;\n&quot;;
                tag = &quot;&quot; + tag + &quot;&quot; + puce + &quot;&quot;;
                insertText = prompt (
                    &quot;Tapez le texte de la puce : (Si vous voulez arrêter, cliquez sur Annuler) &quot;,
                    &quot;Puce &quot; + i
                );
            } else {
                break;
            }
        }
        tag = &quot;\n&lt;&quot;+name+&quot;&gt;\n&quot; + tag;
        return tag;
    },    
    
    setObject : function(name) {
        var tag = '';
        var app = prompt(&quot;Saisissez le type de l'application au choix:\n\r flash|wmv|avi|mpeg&quot;);
        var video = prompt(&quot;Saisissez le chemin du clip&quot;);
        var w = prompt(&quot;Saisissez la largeur&quot;);
        var h = prompt(&quot;Saisissez la hauteur du clip&quot;);
        var autoStart = '0';
        var autoPlay = 'false';
        var type = '';
        switch(app) {
            case 'flash':
                 type =  'x-shockwave-flash';
                break;
            case 'wmv':
                 type =  'video/x-ms-wmv';
                autoPlay = '';
                break;
            case 'avi':
                 type =  'video/x-msvideo';
                autoPlay = '';
                break;
            case 'mpeg':
                 type =  'video/mpeg';
                break;
        }
        if(h ==='' || h &gt; 600) h = 200;
        if(w === '' || w &gt; 600) w = 150;
        if(app == '') {
            alert(&quot;Vous devez saisir le nom de l'application&quot;);
            app = prompt(&quot;Saisissez le type de l'application au choix:\n\r flash|wmv|avi|mpeg&quot;);
        } else {
            if(video != '') {
                tag = '&lt;'+name+'=&quot;'+type+':'+w+':'+h+':'+autoStart+':'+autoPlay+'&quot;&gt;'+video;
            } else {
                tag = '&lt;'+name+'=&quot;'+type+':'+w+':'+h+':'+autoStart+':'+autoPlay+'&quot;&gt;';
            }    
        }
        return tag;
    },
    
    // Cache les boites à menu
    hide :  function(box) {        
        var fx = new Fx.Morph(box, {duration : 800, transition: Fx.Transitions.linear});
        fx.start({
            opacity : [1,0],
            display : 'block',
            visibility : 'hidden'
        });
    },    
    // Affiche les boites à menu
    show : function(el, box) {
        var fx = new Fx.Morph(box, {duration : 800, transition: Fx.Transitions.linear});
        fx.start({
            left : el.getPosition().x.toInt(),
            display : 'block',
            visibility : 'visible',
            opacity : [0,1]
        });        
    },    
    // Event sur les boites à liste
    eventBoxList : function(el) {
        var box = el.getNext('div');
        if(undefined !==  box) {                
            this.show(el, box);            
            box.addEvents({
                'mouseleave': function(){
                    this.timer = this.hide.delay(this.closeDelay, this, box);
                }.bind(this),
                'mouseenter': function(){
                    clearTimeout(this.timer);
                }.bind(this)
            });
        }
    },
    // Event sur les liens de la liste
    eventLinkList : function() {
        if(undefined !== this.sliderLink) {
            //On boucle sur tous les lien slider-link
            this.sliderLink.each(function(link){
                //Si on clique
                link.addEvent('mousedown', function(){
                    //On récupère l'attribut data-bt de l'image
                    var name = link.getParent('div').getPrevious('img').getProperty('data-bt');
                    //On insère notre tag avec la valeur de l'attribut rel du lien cliqué
                    this.insertTag('&lt;'+name+' value=&quot;'+link.get('rel')+'&quot;&gt;', '&lt;/'+name+'&gt;');
                    this.previewParser();
                }.bind(this));
            }, this);
        }
    },    
    /**
     * Events sur les boutons sélecteurs
     */
    eventList : function() {
        //Événements sur un bouton sélecteur
        this.listButtons.each(function(bt){
            if(undefined !== bt) {    
                bt.addEvents({
                    'mouseenter' : function(){ //On affiche la box et on écoute ses events         
                        this.eventBoxList(bt);
                    }.bind(this),
                    'mouseleave' : function() { //On cache la box                     
                        this.timer = this.hide.delay(this.closeDelay, this, bt.getNext(this.options.slider));
                    }.bind(this)
                });        
            }
        }, this);
    },
    
    //Parse le texte via PHP pour la visualisation
    parseText : function(text) {
        var prev = this.preview;
        var req = new Request({
            url : 'parse.php',
            method : 'post',
            evalResponse : true,
            evalScripts : true,
            onComplete: function() {
                prev.set('html', this.response.text);
            }            
        });
        req.send('text='+escape(text));
    },    
    //Visualisation dans la div id=prev
    previewParser : function() {
        var txt = this.input.value; 
        this.parseText(txt);
    }
});</code></pre><p id="r-591845" data-claire-element-id="591845"><a href="http://www.franckysolo-productions.com/demos/zform-sdz/">Testez la démo en ligne !!!</a></p><h2 id="r-idees-d-ameliorations-5" data-claire-element-id="591850">Idées d'améliorations</h2><p id="r-591848" data-claire-element-id="591848">Il reste quelques optimisations à faire, des fonctionnalités non implémentées, par exemple l'ajout de <em>smiley</em> ou la réduction et l'agrandissement du champ de texte grâce à deux boutons. <br/> Voici, une exemple d'implémentation plus approfondis utilisant un parsage Xml, Xsl via Ajax :</p><p id="r-591849" data-claire-element-id="591849"><a href="http://www.ieditor.franckysolo-productions.com/">IEditor 1.0</a><br/> c'est un projet Open-Source pour y participer contactez-moi par mp.</p><h2 id="r-liens-utiles-6" data-claire-element-id="591860">Liens utiles</h2><ul id="r-591857" data-claire-element-id="591857"><li id="r-591852" data-claire-element-id="591852"><p id="r-591851" data-claire-element-id="591851"><a href="http://mootools.net/docs/core">Mootools</a></p></li><li id="r-591854" data-claire-element-id="591854"><p id="r-591853" data-claire-element-id="591853"><a href="http://jsfiddle.net/">Tester et déboguer vos scripts JS</a></p></li><li id="r-591856" data-claire-element-id="591856"><p id="r-591855" data-claire-element-id="591855"><a href="http://matthiasschuetz.com/javascript-framework-matrix/en/dom-ready">Comparaison des frameworks JavaScript</a></p></li></ul><p id="r-591858" data-claire-element-id="591858">Ce tutoriel se termine, en espérant vous avoir un peu éclairés sur l'utilisation de Mootools.</p><p id="r-591859" data-claire-element-id="591859"><strong>franckysolo</strong></p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools">Une zForm avec Mootools</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/le-zform">
Le ZForm
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-boutons-simples-1">
Les boutons simples
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-boutons-avec-choix-1">
Les boutons avec choix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-listes-de-choix-1">
Les listes de choix
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/l-auto-visualisation-avec-ajax">
L&#039;auto-visualisation avec Ajax
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/une-zform-avec-mootools/les-listes-de-choix-1">
<span class="arrow"></span>
<span class="next">Les listes de choix</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/une-zform-avec-mootools.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 01:47:36 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/une-zform-avec-mootools.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:28:30 GMT -->
</html>