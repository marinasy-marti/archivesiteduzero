<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/creer-un-wiki-simple-avec-les-fichiers.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 01:25:49 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/creer-un-wiki-simple-avec-les-fichiers.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:25:34 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Créer un wiki simple avec les fichiers</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Créer un wiki simple avec les fichiers</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Crerunwikisimpleaveclesfichiers">Créer un wiki simple avec les fichiers</a><br/><a href="#Unsystmequifonctionneaveclesfichiers">Un système qui fonctionne avec les fichiers ?</a><br/><a href="#Lapaged039accueil">La page d&#039;accueil</a><br/><a href="#Creretmodifierunepage">Créer et modifier une page</a><br/><a href="#Afficherunepage">Afficher une page</a><br/><a href="#Grerl039historique">Gérer l&#039;historique</a><br/></div>
<a name="Crerunwikisimpleaveclesfichiers"></a><h2>Créer un wiki simple avec les fichiers</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/un-systeme-qui-fonctionne-avec-les-fichiers">
<span class="next">Un système qui fonctionne avec les fichiers ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-561466" data-claire-element-id="561466">Bienvenue à tous dans ce tutoriel. :)</p><p id="r-561467" data-claire-element-id="561467">Au cours de celui-ci, je vais vous apprendre à créer un système de pages « wiki » (pages éditables par tout le monde) incluant bon nombre de fonctionnalités agréables.</p><p id="r-561468" data-claire-element-id="561468">Sachez que tout repose sur les fichiers ; nous n'avons pas besoin de base de données. Cet aspect facilite grandement la portabilité du code, notamment dans le cas où vous souhaitez le partager avec des amis. ;)</p><p id="r-561469" data-claire-element-id="561469"><strong>Niveau :</strong>6/10 - Intermédiaire.</p>
</div><a name="Unsystmequifonctionneaveclesfichiers"></a><h2>Un système qui fonctionne avec les fichiers ?</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/la-page-d-accueil-2">
<span class="next">La page d&#039;accueil</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-561470" data-claire-element-id="561470">Dans un premier temps, je vais vous décrire précisément le fonctionnement des scripts, et ce que je n'inclurai pas dans le tutoriel.</p><p id="r-561471" data-claire-element-id="561471">Comme dit dans l'introduction, nous n'utiliserons pas de base de données. Il s'agit d'un plus sur certains points, mais cela peut aussi compliquer la tâche du codeur.</p><p id="r-561472" data-claire-element-id="561472">L'atout principal des fichiers est qu'ils garantissent une bonne organisation grâce à la création de sous-dossiers. :)</p><h3 id="r-le-probleme-des-fichiers" data-claire-element-id="561477">Le problème des fichiers</h3><p id="r-561473" data-claire-element-id="561473">Je dois vous avertir : l'utilisation des fichiers implique un souci de taille. En effet, il faut assigner certains droits au script pour qu'il puisse créer des fichiers.</p><aside id="r-561475" data-claire-element-id="561475" data-claire-semantic="information"><p id="r-561474" data-claire-element-id="561474">Chez certains hébergeurs, le problème ne se pose pas puisqu'aucune manipulation n'est à faire, mais en général il faut que vous modifiiez le <a href="http://fr.wikipedia.org/wiki/Chmod">CHMOD</a> du fichier pour lui donner la valeur 777 (tous les droits). Si vous ne savez pas comment procéder, une petite exploration sur un moteur de recherche s'impose. ;)</p></aside><p id="r-561476" data-claire-element-id="561476">Lorsque nous aurons créé les fichiers, il faudra donc que vous changiez leur CHMOD, en particulier pour les pages amenées à créer ou modifier des fichiers. ;)</p><h3 id="r-le-fonctionnement-6" data-claire-element-id="561492">Le fonctionnement</h3><p id="r-561478" data-claire-element-id="561478">Je vais vous décrire plus en détail le fonctionnement des scripts.</p><p id="r-561479" data-claire-element-id="561479">Nous allons tout d'abord créer un dossier nommé lib, qui contiendra toutes les fonctions qui seront utilisées.</p><p id="r-561480" data-claire-element-id="561480">Ensuite, nous créerons trois pages différentes :</p><ul id="r-561487" data-claire-element-id="561487"><li id="r-561482" data-claire-element-id="561482"><p id="r-561481" data-claire-element-id="561481"><em>view.php</em> (à la racine, et non dans le dossier <em>lib</em>), qui s'occupera d'afficher la page ;</p></li><li id="r-561484" data-claire-element-id="561484"><p id="r-561483" data-claire-element-id="561483"><em>edit.php</em>, qui servira à la modification d'une page ;</p></li><li id="r-561486" data-claire-element-id="561486"><p id="r-561485" data-claire-element-id="561485"><em>restauration.php</em>, qui en permettra la restauration (comme l'indique le nom du fichier ! :-° ).</p></li></ul><div id="r-561489" data-claire-element-id="561489" data-claire-semantic="question"><p id="r-561488" data-claire-element-id="561488">Euh... restauration de la page ? Que veux-tu dire par là ?</p></div><p id="r-561490" data-claire-element-id="561490">Concrètement, à chaque modification (dont la création) d'une page, une sauvegarde sera créée. L'énorme avantage consiste, si un internaute mal intentionné efface la totalité du contenu, à pouvoir en deux clics restaurer la page telle qu'elle était avant ! :)</p><p id="r-561491" data-claire-element-id="561491">Enfin, la dernière page, <em>index.php</em>, s'occupera d'afficher la liste des pages créées.</p><h3 id="r-je-ne-parlerai-pas" data-claire-element-id="561500">Je ne parlerai pas...</h3><p id="r-561493" data-claire-element-id="561493">Dans ce mini-tuto, je n'évoquerai volontairement pas toutes les fonctions existantes en matière de wiki.<br/> On peut déjà citer la possibilité de diviser une page en plusieurs parties (tel un tutoriel sur le SdZ) ; c'est faisable, mais relativement difficile avec les fichiers.</p><p id="r-561494" data-claire-element-id="561494">Ensuite, la mise à la corbeille. Beaucoup d'entre vous connaissent certainement l'interface <a href="http://bluestorm.info/ZAP/">ZAP</a>, développée par <a href="http://www.siteduzero.com/membres-294-227.html">bluestorm</a>.<br/> Cette interface intègre notamment la fonction servant à supprimer mettre à la poubelle un document (tutoriel, news, etc.). Il s'agit d'une fonctionnalité essentielle permettant de virer de la liste les documents inutiles. :)</p><aside id="r-561496" data-claire-element-id="561496" data-claire-semantic="error"><p id="r-561495" data-claire-element-id="561495">Mais je n'en parlerai pas ici : le but de ce tutoriel est de vous aider à concevoir un système de pages wiki simple, et non quelque chose de super-sophistiqué.</p></aside><p id="r-561497" data-claire-element-id="561497"><em>Je suis désolé, mais j'ai dû faire ce choix afin de ne pas écrire un tutoriel de trente pages qui ennuierait le lecteur...</em></p><p id="r-561498" data-claire-element-id="561498">Enfin, une chose que beaucoup aimeraient pouvoir créer (mais qui ne sera pas présentée dans ce tutoriel) : une interface permettant l'insertion de balises comme le zCode.<br/> Une fois de plus, ce choix est justifié, un tutoriel <strong>très</strong> bien réalisé (par <a href="http://www.siteduzero.com/membres-294-32404.html">madmac</a>) existant déjà : <a href="http://www.siteduzero.com/tuto-3-16497-1-parser-du-xml---l-exemple-du-zcode.html">Parser du XML - L'exemple du zCode</a>.</p><p id="r-561499" data-claire-element-id="561499">Voilà, j'espère n'avoir pas déçu trop de monde. Cela dit, rassurez-vous, ce que je vais vous apprendre sera pour vous une excellente base. Libre à vous de rajouter par la suite pleins de fonctions superflues ! :p</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers">Créer un wiki simple avec les fichiers</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/un-systeme-qui-fonctionne-avec-les-fichiers">
Un système qui fonctionne avec les fichiers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/la-page-d-accueil-2">
La page d&#039;accueil
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/creer-et-modifier-une-page">
Créer et modifier une page
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/afficher-une-page">
Afficher une page
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/gerer-l-historique">
Gérer l&#039;historique
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/la-page-d-accueil-2">
<span class="next">La page d&#039;accueil</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lapaged039accueil"></a><h2>La page d&#039;accueil</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/un-systeme-qui-fonctionne-avec-les-fichiers">
<span class="arrow"></span>
<span class="next">Un système qui fonctionne avec les fichiers ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/creer-et-modifier-une-page">
<span class="next">Créer et modifier une page</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-561502" data-claire-element-id="561502">Concevons la page d'accueil.</p><p id="r-561503" data-claire-element-id="561503">Dans un premier temps, nous allons créer dans le dossier <em>lib</em> un fichier intitulé <em>liste_pages.php</em>.<br/> Il est censé contenir la fonction qui permet de lister toutes les pages existantes. :)</p><p id="r-561504" data-claire-element-id="561504">Tout d'abord, déclarons la fonction et une variable utile :</p><pre id="r-561505" data-claire-element-id="561505"><code data-claire-semantic="html+php">&lt;?php
 
function liste_pages()
        {
        GLOBAL $donnees; // Cette variable sera renseignée à la fin du script
        $repertoire = &quot;pages&quot;;
?&gt;</code></pre><p id="r-561506" data-claire-element-id="561506">Comme vous pouvez le constater, il n'y a rien de bien compliqué à cela.</p><p id="r-561507" data-claire-element-id="561507">Maintenant, nous allons récupérer tous les dossiers du répertoire <em>pages</em> (vous devez créer ce dossier ;) ) :</p><pre id="r-561508" data-claire-element-id="561508"><code data-claire-semantic="html+php">&lt;?php
$dossiers = glob($repertoire.'/*');
asort($dossiers); // On classe les noms de dossiers afin qu'ils soient affichés par ordre alphabétique / croissant
?&gt;</code></pre><p id="r-561509" data-claire-element-id="561509">Nous allons déclarer trois variables, dont deux tableaux.<br/> Le premier tableau contiendra les noms des pages, le deuxième leur <em>id</em> (identifiant) et la troisième variable sera un compteur pour le foreach qui suit. ;)</p><pre id="r-561510" data-claire-element-id="561510"><code data-claire-semantic="html+php">&lt;?php
$noms = array();
$ids = array();
$compteur = 0;
?&gt;</code></pre><p id="r-561511" data-claire-element-id="561511">Nous pouvons maintenant ajouter le foreach qui va placer le nom et l'<em>id</em> de la page dans les deux tableaux que nous avons créés précédemment. :)</p><pre id="r-561512" data-claire-element-id="561512"><code data-claire-semantic="html+php">&lt;?php
foreach($dossiers as $adresse) // On va lister tout ça
                {
                if(is_dir($adresse)) // On vérifie qu'il s'agit bien d'un dossier que l'on traite, et non un fichier !
                        {
                        $id = explode('/', $adresse);
                        $ids[$compteur] = $id[1]; // Nom du dossier = id de la page :)
                        
                        $ouverture_titre = fopen($adresse.'/titre.txt', 'r'); // On ouvre le fichier contenant le titre de la page
                        $lecture_titre = fread($ouverture_titre, filesize($adresse.'/titre.txt')); // On lit le fichier - filesize retourne la taille du fichier :)
                        
                        $noms[$compteur] = $lecture_titre; // On met le titre dans le tableau qui contient les titres des pages 
                        
                        $compteur++; // On incrémente le compteur
                        }
                }
?&gt;</code></pre><p id="r-561513" data-claire-element-id="561513">Vous souvenez-vous que j'ai déclaré comme « globale » la variable $donnees ? Eh bien, nous allons la renseigner ; elle va contenir un tableau :</p><pre id="r-561514" data-claire-element-id="561514"><code data-claire-semantic="html+php">&lt;?php
$donnees = array('Noms' =&gt; $noms, 'Id' =&gt; $ids);
?&gt;</code></pre><p id="r-561515" data-claire-element-id="561515">Voilà ! Nous disposons à présent de notre fichier <em>liste_pages.php</em>, qui contient la fonction pour lister les pages.<br/> Il ne nous reste plus qu'à afficher tout cela sur la page <em>index.php</em> :</p><pre id="r-561516" data-claire-element-id="561516"><code data-claire-semantic="html+php">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot;&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;
&lt;title&gt;Accueil du Wiki&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p&gt;
&lt;?php
 
require('lib/liste_pages.php');
 
// On va lister les pages !
 
liste_pages();
 
$compteur = 0;
foreach($donnees['Noms'] as $nom) // On explore le tableau
        {
        echo '&lt;a href=&quot;view.php?id='.$donnees['Id'][$compteur].'&quot;&gt;'.$nom.'&lt;/a&gt; [&lt;a href=&quot;edit.php?id='.$donnees['Id'][$compteur].'&quot;&gt;Editer&lt;/a&gt;]&lt;br /&gt;'; // On affiche le nom avec un lien pour l'édition
        $compteur++;
        }
echo '&lt;br /&gt;&lt;a href=&quot;creer.php&quot;&gt;Créer une page&lt;/a&gt;&lt;br /&gt;';
 
?&gt;
&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-561517" data-claire-element-id="561517">La page d'accueil est maintenant terminée. :) Au passage, vous remarquerez que tous les liens visibles sur cette page ne vous sont pas très utiles ; on va régler cela dans les parties suivantes. ;)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers">Créer un wiki simple avec les fichiers</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/un-systeme-qui-fonctionne-avec-les-fichiers">
Un système qui fonctionne avec les fichiers ?
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/la-page-d-accueil-2">
La page d&#039;accueil
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/creer-et-modifier-une-page">
Créer et modifier une page
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/afficher-une-page">
Afficher une page
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/gerer-l-historique">
Gérer l&#039;historique
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/un-systeme-qui-fonctionne-avec-les-fichiers">
<span class="arrow"></span>
<span class="next">Un système qui fonctionne avec les fichiers ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/creer-et-modifier-une-page">
<span class="next">Créer et modifier une page</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Creretmodifierunepage"></a><h2>Créer et modifier une page</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/la-page-d-accueil-2">
<span class="arrow"></span>
<span class="next">La page d&#039;accueil</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/afficher-une-page">
<span class="next">Afficher une page</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-561519" data-claire-element-id="561519">Bon, on va enfin pouvoir attaquer les pages les plus importantes. :)</p><p id="r-561520" data-claire-element-id="561520">Dans un premier temps, on va élaborer la page <em>creer.php</em>, qui aura pour but de créer une page.<br/> Ensuite, ce sera au tour de <em>edit.php</em>, qui permettra d'en modifier.</p><h3 id="r-creer-une-page" data-claire-element-id="561546">Créer une page</h3><p id="r-561521" data-claire-element-id="561521">Encore une fois, on va créer une page qui appellera le fichier <em>creer_page.php</em> (qui se trouve dans le dossier lib). ;) <br/> Si je sépare les fichiers comme cela, c'est pour que la modification des scripts soit plus aisée : ainsi, on ne se retrouve pas avec des fichiers de 300 lignes. :p</p><p id="r-561522" data-claire-element-id="561522">Commençons par déclarer la fonction :</p><pre id="r-561523" data-claire-element-id="561523"><code data-claire-semantic="html+php">&lt;?php
function creer_page($type, $titre, $contenu)
        {
        GLOBAL $id_a_creer;
?&gt;</code></pre><p id="r-561524" data-claire-element-id="561524">Pour information, sachez ceci : <br/><strong>$type</strong> contiendra normal ou protege. Si la valeur est protege, on concevra un système pour bloquer l'édition de la page. :) <br/><strong>$id_a_creer</strong> contiendra l'<em>id</em> de la page créée. ;)</p><p id="r-561525" data-claire-element-id="561525">Maintenant, on va utiliser la fonction glob(), qui dresse dans un tableau la liste des fichiers et dossiers du répertoire passé en paramètre. :)</p><pre id="r-561526" data-claire-element-id="561526"><code data-claire-semantic="html+php">&lt;?php
$liste_dossiers = glob($repertoire.'/*'); // On va lister tous les dossiers, en sachant que le nom du dossier == l'id de la page
        
        $ids; // Cette variable contiendra les id de toutes les pages
        $compteur = 0; // Compteur qui servira au foreach 
?&gt;</code></pre><p id="r-561527" data-claire-element-id="561527">Nous pouvons maintenant démarrer le foreach, afin qu'il nous trouve l'<em>id</em> de la dernière page créée. La méthode employée est très simple ; je vous laisse regarder :</p><pre id="r-561528" data-claire-element-id="561528"><code data-claire-semantic="html+php">&lt;?php
       foreach($liste_dossiers as $nom)
                {
                if(is_dir($nom))
                        {
                        $id = explode('/', $nom); // On va séparer les parties de $nom pour avoir la dernière : l'id du dossier
                        $ids[$compteur] = $id[1]; // On stocke l'id dans le tableau
                        $compteur++;
                        }
                }
        $id_a_creer = max($ids); // Grâce à la fonction max, on récupère le plus grand id du tableau
?&gt;</code></pre><p id="r-561529" data-claire-element-id="561529">À présent, on va augmenter de 1 la variable $id_a_creer, pour qu'elle contienne le nouvel id. <br/> Ensuite, nous allons créer le dossier qui aura pour nom cet id, et déclarer la variable <strong>$repertoire</strong> qui va nous servir pour toutes les actions sur les fichiers qui suivront. :)</p><pre id="r-561530" data-claire-element-id="561530"><code data-claire-semantic="html+php">&lt;?php
        $id_a_creer++;
        
        $creer_dossier = mkdir($repertoire.'/'.$id_a_creer); // On crée le dossier
        $repertoire = $repertoire.'/'.$id_a_creer;
?&gt;</code></pre><p id="r-561531" data-claire-element-id="561531">Si <strong>$type</strong> (pour rappel, il s'agit de l'un des paramètres de la fonction) est égal à protege, on crée un fichier de plus :</p><pre id="r-561532" data-claire-element-id="561532"><code data-claire-semantic="html+php">&lt;?php
if($type == &quot;protege&quot;)
                {
                $creer_fichier_protect = fopen($repertoire.'/protect', 'w+');
                fclose($creer_fichier_protect);
                }
?&gt;</code></pre><p id="r-561533" data-claire-element-id="561533">Ce fichier sera vide, mais il va exister, et il suffira de vérifier si ce fichier existe pour savoir si l'édition est interdite ou non. ;)</p><p id="r-561534" data-claire-element-id="561534">Rien de bien compliqué. :) Petit rappel à propos de fopen : il faut lui indiquer comment ouvrir le fichier (lecture, écriture, etc.). Toutes ces façons d'ouvrir le fichier sont disponibles ici : <a href="http://fr.php.net/manual/fr/function.fopen.php">DOC PHP</a>.<br/> Dans notre cas, le moyen utilisé est « en écriture, on crée le fichier s'il n'existe pas » (= w+).</p><p id="r-561535" data-claire-element-id="561535">À présent, on va créer les fichiers qui contiendront le titre et le contenu :</p><pre id="r-561536" data-claire-element-id="561536"><code data-claire-semantic="html+php">&lt;?php
        file_put_contents($repertoire.'/titre.txt', $titre); // On écrit le titre dans le fichier
        
        file_put_contents($repertoire.'/contenu.txt', $contenu); // On inscrit le contenu dans le fichier
?&gt;</code></pre><p id="r-561537" data-claire-element-id="561537">Il nous reste une dernière étape à effectuer ; elle concerne l'historique de la page : dans ce cas-ci, il faut sauvegarder à un autre endroit le titre et le contenu pour qu'il soit possible, après une modification non désirée, de remettre cette version à la place de celle qui est en ligne. ;)</p><pre id="r-561538" data-claire-element-id="561538"><code data-claire-semantic="html+php">&lt;?php
        ######################################################
        ## Partie pour les sauvegardes, pour la restauration ##
        ######################################################
        
        $timestamp_actuel = time(); // On récupère le timestamp actuel pour dater la sauvegarde
        $creer_dossier_sav = mkdir($repertoire.'/save'); // On crée le dossier qui va contenir toutes les sauvegardes de la page
        $creer_dossier_time = mkdir($repertoire.'/save/'.$timestamp_actuel); // On crée le dossier qui va contenir le titre et le contenu pour pouvoir restaurer après !
        
        $repertoire = $repertoire.'/save/'.$timestamp_actuel; // On change le répertoire de traitement
        
        ## Même étape que précédemment
        
        file_put_contents($repertoire.'/titre.txt', $titre);
        file_put_contents($repertoire.'/contenu.txt', $contenu);
 
        
        #############################################
        ## Fin de la partie pour les restaurations ##
        #############################################
?&gt;</code></pre><p id="r-561539" data-claire-element-id="561539">Et voilà ! :)</p><p id="r-561540" data-claire-element-id="561540">Il faut maintenant que l'on constitue la page <em>creer.php</em> (ne se trouvant pas dans le dossier lib) qui affichera le formulaire. ;)</p><p id="r-561541" data-claire-element-id="561541">Étant donné que le code est très simple, j'ai jugé inutile de vous en détailler le contenu. Le voici :</p><pre id="r-561542" data-claire-element-id="561542"><code data-claire-semantic="html+php">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot;&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;
&lt;title&gt;Wiki&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;?php
if(!empty($_POST['titre']) &amp;&amp; !empty($_POST['contenu'])) // Si le formulaire a été validé et qu'il n'est pas vide
        {
        $titre = htmlspecialchars($_POST['titre']); // La variable contenant le titre
        $contenu = nl2br(htmlspecialchars($_POST['contenu'])); // Le contenu
        
        require('lib/creer_page.php'); // On récupère la fonction pour créer la page
        
        if(isset($_POST['1'])) // Si on crée la page normalement
        creer_page('normal', $titre, $contenu); // On appelle la fonction pour créer la page
        if(isset($_POST['2'])) // Si on veut rendre l'édition impossible
        creer_page('protege', $titre, $contenu); // On appelle la fonction pour créer la page
        
        echo 'Votre page a bien été créée !&lt;br /&gt;
        Vous pouvez la voir ici : &lt;a href=&quot;view.php?id='.$id_a_creer.'&quot;&gt;voir ma page&lt;/a&gt;.';
        }
else // on n'a pas validé le formulaire, alors on l'affiche !
        {
        echo '&lt;form method=&quot;post&quot; action=&quot;creer.php&quot;&gt;
        &lt;p&gt;&lt;label for=&quot;titre&quot;&gt;Titre de votre page : &lt;/label&gt;&lt;br /&gt;
        &lt;input type=&quot;text&quot; name=&quot;titre&quot; id=&quot;titre&quot; /&gt;&lt;br /&gt;
        &lt;label for=&quot;contenu&quot;&gt;Contenu de votre page : &lt;/label&gt;&lt;br /&gt;
        &lt;textarea name=&quot;contenu&quot; id=&quot;contenu&quot; cols=&quot;100&quot; rows=&quot;10&quot;&gt;&lt;/textarea&gt;&lt;br /&gt;
        &lt;input type=&quot;submit&quot; name=&quot;1&quot; value=&quot;Créer ma page !&quot; /&gt;&lt;input type=&quot;submit&quot; name=&quot;2&quot; value=&quot;Créer et rendre impossible l\'édition&quot; /&gt;&lt;/p&gt;&lt;/form&gt;';
        }
?&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><aside id="r-561544" data-claire-element-id="561544" data-claire-semantic="warning"><p id="r-561543" data-claire-element-id="561543">Faites bien attention à la partie qui vérifie sur quel bouton l'on a cliqué, pour savoir si on doit empêcher l'édition ou non. ;)</p></aside><p id="r-561545" data-claire-element-id="561545">Voilà : vous avez maintenant vos deux pages et pouvez en créer. :) Essayez d'en créer deux, et rendez-vous sur la page d'accueil : magique, deux titres s'affichent !</p><h3 id="r-modification-de-la-page" data-claire-element-id="561566">Modification de la page</h3><p id="r-561547" data-claire-element-id="561547">On associe souvent le mot « ajouter » à « modifier », et c'est ce qui est fait dans ce tutoriel.<br/> Voyons un peu en quoi consistent les deux pages nécessaires à la modification d'un article. :)</p><p id="r-561548" data-claire-element-id="561548">La première se nomme <em>modifier_page.php</em> et se trouve dans le dossier lib (le fichier contient une fonction ;) ).</p><p id="r-561549" data-claire-element-id="561549">On commence par déclarer la fonction :</p><pre id="r-561550" data-claire-element-id="561550"><code data-claire-semantic="html+php">&lt;?php
function modifier_page($id, $titre = NULL, $contenu = NULL)
        {
        $repertoire = 'pages/'.$id;
?&gt;</code></pre><p id="r-561551" data-claire-element-id="561551">Je ne vais pas trop vous détailler le code suivant ; vous la comprendrez mieux lorsque je vous montrerai la deuxième page. :)</p><pre id="r-561552" data-claire-element-id="561552"><code data-claire-semantic="html+php">&lt;?php
        if($titre != NULL) // Si on veut modifier le titre
                {
                file_put_contents($repertoire.'/titre.txt', $titre); // On écrit le titre dans le fichier
                }
        if($contenu != NULL) // Si on veut modifier le contenu
                {
                file_put_contents($repertoire.'/contenu.txt', $contenu); // On met le contenu dans le fichier
                }
?&gt;</code></pre><p id="r-561553" data-claire-element-id="561553">Il ne nous reste plus qu'à nous occuper du système d'historique : nous allons créer un dossier (il aura pour nom le timestamp actuel lors de la modification) qui contiendra le titre et le contenu de la page après modification. ;)</p><pre id="r-561554" data-claire-element-id="561554"><code data-claire-semantic="html+php">&lt;?php
        ## PARTIE POUR LES SAUVEGARDES
        $timestamp_actuel = time(); // Timestamp actuel
                
        $creer_dossier_time = mkdir($repertoire.'/save/'.$timestamp_actuel); // On crée le répertoire qui aura pour nom le timestamp actuel
        
        file_put_contents($repertoire.'/save/'.$timestamp_actuel.'/titre.txt', $titre); // On crée le fichier et on écrit le titre
 
        file_put_contents($repertoire.'/save/'.$timestamp_actuel.'/contenu.txt', $contenu); // Création du fichier + écriture du contenu
        
        ## FIN PARTIE POUR LES SAUVEGARDES
?&gt;</code></pre><p id="r-561555" data-claire-element-id="561555">Ouf, fini pour cette page. :) <br/> Afin d'achever proprement la partie « modification » (il serait bête de ne pouvoir utiliser la fonction ci-dessus), nous allons construire une page <em>edit.php</em>, qui s'occupera du formulaire et du reste. :)</p><p id="r-561556" data-claire-element-id="561556">Bon, voici déjà les premières lignes du code :</p><pre id="r-561557" data-claire-element-id="561557"><code data-claire-semantic="html+php">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot;&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;
&lt;title&gt;Édition d'une page&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;?php
 
require('lib/voir_page.php'); // On a aussi besoin de cette fonction pour connaître le titre et le contenu de la page
require('lib/modifier_page.php');
 
if(!isset($_GET['id'])) // Si on n'a pas l'id de la page demandée
        {
        echo 'Vous devez fournir l\'id de la page !&lt;br /&gt;'; // Message d'erreur
        exit; // On arrête le script
        }
?&gt;</code></pre><p id="r-561558" data-claire-element-id="561558">Ces lignes sont indispensables pour que le reste du script fonctionne. ;)</p><aside id="r-561560" data-claire-element-id="561560" data-claire-semantic="warning"><p id="r-561559" data-claire-element-id="561559">Vous avez sûrement remarqué que nous avions besoin du script <em>lib/voir_page.php</em> ; c'est un code que je vous donnerai plus bas. :)</p></aside><p id="r-561561" data-claire-element-id="561561">Plus haut, je vous disais que vous comprendriez les lignes du code plus tard. Ce « plus tard » est arrivé, et voici le code qui correspond :</p><pre id="r-561562" data-claire-element-id="561562"><code data-claire-semantic="html+php">&lt;?php
if(!empty($_POST['titre']) &amp;&amp; !empty($_POST['contenu'])) // Si le formulaire n'est pas vide
        {
        if($_POST['titre'] != $_POST['titre_old'])
                {
                $modif_titre = htmlspecialchars($_POST['titre']);
                }
        else
                {
                $modif_titre = NULL;
                }
        if($_POST['contenu'] != $_POST['contenu_old'])
                {
                $modif_contenu = nl2br(htmlspecialchars($_POST['contenu']));
                }
        else
                {
                $modif_contenu = NULL;
                }
        if(!file_exists('pages/'.intval($_GET['id']).'/protect')) // Si l'édition n'est pas protégée
        {
                modifier_page(intval($_GET['id']), $modif_titre, $modif_contenu);
        }
        else //Si elle l'est
        {
                echo 'L\'édition est interdite !';
                exit;
        }
        
        echo 'Page modifiée !&lt;br /&gt;
        &lt;a href=&quot;view.php?id='.$_GET['id'].'&quot;&gt;Voir la page&lt;/a&gt;';
        }
?&gt;</code></pre><p id="r-561563" data-claire-element-id="561563">Il reste à afficher le formulaire ; vous pourrez le modifier par la suite, bien entendu. :p</p><pre id="r-561564" data-claire-element-id="561564"><code data-claire-semantic="html+php">&lt;?php
else // S'il n'a pas été posté
        {
        if(file_exists('pages/'.intval($_GET['id']).'/protect')) // Si l'édition n'est pas protégée
        {
        echo 'L\'édition est interdite !';
        exit;
        }
        affiche_page(intval($_GET['id']));
        $donnees['Contenu'] = str_replace('&lt;br /&gt;', '', $donnees['Contenu']);
        echo '&lt;form method=&quot;post&quot; action=&quot;edit.php?id='.$_GET['id'].'&quot;&gt;
        &lt;p&gt;&lt;label for=&quot;titre&quot;&gt;Titre de la page : &lt;/label&gt;&lt;br /&gt;
        &lt;input type=&quot;text&quot; name=&quot;titre&quot; id=&quot;titre&quot; value=&quot;'.$donnees['Titre'].'&quot; /&gt;
        &lt;input type=&quot;hidden&quot; name=&quot;titre_old&quot; value=&quot;'.$donnees['Titre'].'&quot; /&gt;&lt;br /&gt;
        &lt;label for=&quot;contenu&quot;&gt;Contenu de la page : &lt;/label&gt;&lt;br /&gt;
        &lt;textarea name=&quot;contenu&quot; id=&quot;contenu&quot; rows=&quot;10&quot; cols=&quot;100&quot;&gt;'.$donnees['Contenu'].'&lt;/textarea&gt;
        &lt;input type=&quot;hidden&quot; name=&quot;contenu_old&quot; value=&quot;'.$donnees['Contenu'].'&quot; /&gt;&lt;br /&gt;
        &lt;input type=&quot;submit&quot; value=&quot;Modifier la page&quot; /&gt;&lt;/p&gt;&lt;/form&gt;';
        }
?&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-561565" data-claire-element-id="561565">Bon, ben... c'est tout pour les actions sur les pages !<br/> Au cours de la partie suivante, vous allez enfin pouvoir afficher les belles pages que vous avez créées. :)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers">Créer un wiki simple avec les fichiers</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/un-systeme-qui-fonctionne-avec-les-fichiers">
Un système qui fonctionne avec les fichiers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/la-page-d-accueil-2">
La page d&#039;accueil
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/creer-et-modifier-une-page">
Créer et modifier une page
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/afficher-une-page">
Afficher une page
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/gerer-l-historique">
Gérer l&#039;historique
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/la-page-d-accueil-2">
<span class="arrow"></span>
<span class="next">La page d&#039;accueil</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/afficher-une-page">
<span class="next">Afficher une page</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Afficherunepage"></a><h2>Afficher une page</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/creer-et-modifier-une-page">
<span class="arrow"></span>
<span class="next">Créer et modifier une page</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/gerer-l-historique">
<span class="next">Gérer l&#039;historique</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-561568" data-claire-element-id="561568">Nous avons pratiquement terminé notre wiki : il ne reste plus que trois pages à créer. Courage ! :)</p><p id="r-561569" data-claire-element-id="561569">Pour le moment, je vais vous parler de deux d'entre elles : <em>voir_page.php</em> (qui se trouve dans le dossier lib) et <em>view.php</em> (qui appellera le premier fichier pour afficher la page :p ).</p><p id="r-561570" data-claire-element-id="561570">Je doute qu'il soit possible de faire plus simple pour ces deux pages : elles se composent seulement d'une dizaine de lignes !<br/> Il me faut avouer que le rendu (affichage) est moyen, mais bon, ici, on voit seulement la partie PHP ; alors, au boulot !</p><p id="r-561571" data-claire-element-id="561571">Voici le code pour <em>voir_page.php</em> :</p><pre id="r-561572" data-claire-element-id="561572"><code data-claire-semantic="html+php">&lt;?php
 
function affiche_page($id)
        {
        GLOBAL $donnees;
        $repertoire = &quot;pages/$id&quot;;
        
        $titre = file_get_contents($repertoire.'/titre.txt'); // On lit le fichier contenant le titre
        
        $contenu = file_get_contents($repertoire.'/contenu.txt'); // On lit le fichier contenant le contenu &gt;&lt;
        
        $donnees = array('Titre' =&gt; $titre, 'Contenu' =&gt; $contenu); // On met les valeurs dans un tableau
        
        return $donnees;
        }
?&gt;</code></pre><p id="r-561573" data-claire-element-id="561573">Et maintenant, passons à <em>view.php</em>.<br/> Il y a plus de lignes que dans le premier fichier, mais n'oublions pas que cette page gère l'affichage. ;)</p><p id="r-561574" data-claire-element-id="561574">Voici le script tant attendu :</p><pre id="r-561575" data-claire-element-id="561575"><code data-claire-semantic="html+php">&lt;?php
require('lib/voir_page.php'); // On récupère la fonction pour afficher la page
 
if(!isset($_GET['id'])) // Si on n'a pas fourni en paramètre l'id de la page à voir
        {
        echo 'Vous devez fournir l\'id de la page !&lt;br /&gt;';
        exit; // On arrête le script
        }
affiche_page(intval($_GET['id'])); // On appelle la fonction qui va nous renvoyer les valeurs dans $donnees[]
 
echo '&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot;&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;
&lt;title&gt;'.$donnees['Titre'].'&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;'.$donnees['Titre'];
if(!file_exists('pages/'.intval($_GET['id']).'/protect')) echo '[&lt;a href=&quot;edit.php?id='.$_GET['id'].'&quot;&gt;Éditer la page&lt;/a&gt;]'; // Si l'édition n'est pas interdite
echo '&lt;/h1&gt;&lt;p&gt; &lt;!-- Affichage du titre et du lien pour éditer --&gt;';
if(!file_exists('pages/'.intval($_GET['id']).'/protect')) echo '[&lt;a href=&quot;restauration.php?id='.$_GET['id'].'&quot;&gt;Historique&lt;/a&gt;]';
echo '&lt;br /&gt;
&lt;br /&gt;
'.$donnees['Contenu'].' &lt;!-- On affiche le contenu de la page --&gt;
&lt;br /&gt;
&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;';
?&gt;</code></pre>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers">Créer un wiki simple avec les fichiers</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/un-systeme-qui-fonctionne-avec-les-fichiers">
Un système qui fonctionne avec les fichiers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/la-page-d-accueil-2">
La page d&#039;accueil
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/creer-et-modifier-une-page">
Créer et modifier une page
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/afficher-une-page">
Afficher une page
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/gerer-l-historique">
Gérer l&#039;historique
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/creer-et-modifier-une-page">
<span class="arrow"></span>
<span class="next">Créer et modifier une page</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/gerer-l-historique">
<span class="next">Gérer l&#039;historique</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Grerl039historique"></a><h2>Gérer l&#039;historique</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/afficher-une-page">
<span class="arrow"></span>
<span class="next">Afficher une page</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-561577" data-claire-element-id="561577">C'est bien beau tout ça, mais on a quand même écrit plusieurs parties de code concernant l'historique... Il serait peut-être temps de les utiliser. :)</p><p id="r-561578" data-claire-element-id="561578">Le code qui va suivre se nomme <em>restauration.php</em> et est assez long (enfin, plus long que les autres).<br/> Pour une fois, j'ai préféré tout regrouper en un seul fichier plutôt que de tout séparer (si j'avais choisi cette dernière option, il y aurait trois fichiers, car trois actions sont possibles).</p><p id="r-561579" data-claire-element-id="561579">Dans un premier temps, on va afficher la date et l'heure de toutes les modifications (y compris la création de la page).</p><p id="r-561580" data-claire-element-id="561580">Voici le début du fichier :</p><pre id="r-561581" data-claire-element-id="561581"><code data-claire-semantic="html+php">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;fr&quot;&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;
&lt;title&gt;Historique d'une page&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p&gt;
&lt;?php
 
$rep = 'pages/'.intval($_GET['id']);
 
if(!isset($_GET['view']) &amp;&amp; !isset($_GET['up'])) // Si on n'a pas encore fait d'action (regarder ou remplacer la copie en ligne par celle qu'on a choisie)
        {
?&gt;</code></pre><p id="r-561582" data-claire-element-id="561582">À la fin de ce code, on va gérer l'action qui liste toutes les modifications effectuées. ;)</p><p id="r-561583" data-claire-element-id="561583">On commence par mettre dans un tableau tous les dossiers du répertoire pages/save/ :</p><pre id="r-561584" data-claire-element-id="561584"><code data-claire-semantic="html+php">&lt;?php
$liste_dossiers = glob($rep.'/save/*'); // On liste les dossiers du répertoire de sauvegarde
?&gt;</code></pre><p id="r-561585" data-claire-element-id="561585">Maintenant, on affiche le tout avec un foreach :</p><pre id="r-561586" data-claire-element-id="561586"><code data-claire-semantic="html+php">&lt;?php
                foreach($liste_dossiers as $key) // On explore le tableau qui contient la liste des dossiers
                {
                if(is_dir($key)) // On vérifie qu'il s'agit bien d'un dossier, car glob retourne fichiers et dossiers
                        {
                       
                        $rep = $rep.'/save/';
                        $timestamp = explode('/', $key); // On récupère le timestamp, c'est-à-dire le nom du dossier
                       
                        $date = date('d/m/Y', $timestamp[3]); // $timestamp[3] correspond au timestamp (nom du dossier)
                        $heure = date('h\Hi\m\ns\s', $timestamp[3]); // On stocke l'heure
                       
                        $titre = file_get_contents('pages/'.$_GET['id'].'/save/'.$timestamp[3].'/titre.txt');
       
                        $contenu = file_get_contents('pages/'.$_GET['id'].'/save/'.$timestamp[3].'/contenu.txt');
 
                        echo '&lt;a href=&quot;restauration.php?id='.$_GET['id'].'&amp;view='.$timestamp[3].'&quot;&gt;Le '.$date.' à  '.$heure.'&lt;/a&gt;'; // On affiche un lien (pour voir la copie) avec l'heure et la date de sa création
                        echo '&lt;br /&gt;';
                        }
                }
        echo '&lt;br /&gt;=&gt; &lt;a class=&quot;a&quot; href=&quot;view.php?id='.$_GET['id'].'&quot;&gt;Retour a la page&lt;/a&gt;'; // Si on veut retourner à la page que l'on consultait
}
?&gt;</code></pre><p id="r-561587" data-claire-element-id="561587">Passons à la gestion de la deuxième action, celle qui regarde la version sauvée (l'action qui suit lorsque l'on clique sur un des liens de l'historique).</p><p id="r-561588" data-claire-element-id="561588">La voici :</p><pre id="r-561589" data-claire-element-id="561589"><code data-claire-semantic="html+php">&lt;?php
elseif(!isset($_GET['up']) &amp;&amp; isset($_GET['view'])) //si on veut voir la copie
        {
        $lecture_titre = file_get_contents($rep.'/save/'.intval($_GET['view']).'/titre.txt');
        $lecture_contenu = file_get_contents($rep.'/save/'.intval($_GET['view']).'/contenu.txt');
       
        echo '&lt;fieldset&gt;
       &lt;legend align=top&gt; '.$lecture_titre.' - &lt;a href=&quot;restauration.php?id='.$_GET['id'].'&amp;up='.$_GET['view'].'&quot;&gt;Remplacer la version actuelle par celle-là&lt;/a&gt;&lt;/legend&gt;';
        echo $lecture_contenu; // On affiche le contenu
        echo '&lt;/fieldset&gt;';
        }
?&gt;</code></pre><p id="r-561590" data-claire-element-id="561590">Et enfin, nous allons gérer la dernière action, celle qui s'occupe de remplacer la version en ligne par celle que l'on a choisie. :)</p><p id="r-561591" data-claire-element-id="561591">Voici donc la fin du script :</p><pre id="r-561592" data-claire-element-id="561592"><code data-claire-semantic="html+php">&lt;?php
else // Si on veut remplacer la version actuelle par la copie
        {
        $up = intval($_GET['up']); //On récupère le timestamp de la copie que l'on veut remettre en ligne
 
        $copy = copy($rep.'/save/'.$up.'/titre.txt', $rep.'/titre.txt'); // On remplace le titre actuel par celui de la copie
        $copy = copy($rep.'/save/'.$up.'/contenu.txt', $rep.'/contenu.txt'); // On remplace le contenu actuel par celui de la copie
       
        echo 'La copie a été restaurée, elle est maintenant visible à la place de l\'autre.&lt;br /&gt;
       &lt;a href=&quot;view.php?id='.$_GET['id'].'&quot;&gt;Voir la page&lt;/a&gt;&lt;br /&gt;';
        }
 
?&gt;
&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-561593" data-claire-element-id="561593">Et voilà, vous avez un historique pour chacune de vos pages !</p><p id="r-561594" data-claire-element-id="561594">Nous voici à la fin de ce tutoriel !</p><p id="r-561595" data-claire-element-id="561595">Il fut un peu long, mais l'utilisation des fichiers complique un peu la tâche. <br/> Mais voyez plutôt les intérêts :</p><ul id="r-561602" data-claire-element-id="561602"><li id="r-561597" data-claire-element-id="561597"><p id="r-561596" data-claire-element-id="561596">code facilement modifiable ;</p></li><li id="r-561599" data-claire-element-id="561599"><p id="r-561598" data-claire-element-id="561598">chargement rapide des pages ;</p></li><li id="r-561601" data-claire-element-id="561601"><p id="r-561600" data-claire-element-id="561600">une bonne portabilité du système (pas de base de données).</p></li></ul><aside id="r-561604" data-claire-element-id="561604" data-claire-semantic="information"><p id="r-561603" data-claire-element-id="561603">Quelques fois (la dernière, c'est trois lignes plus haut), j'ai déclaré qu'utiliser les fichiers n'est pas chose facile. Il est sûr et certain que je verrai dans les commentaires des messages du genre <em>« Mais c'est super facile de les utiliser ! »</em>. Je suis d'accord avec eux mais, si vous essayez de faire tout ce que nous avons fait version SQL, vous verrez bien que l'utilisation des fichiers rallonge un peu le code. ;)</p></aside><p id="r-561605" data-claire-element-id="561605">Si vous avez une remarque (positive ou négative) à formuler, je vous conseille de le faire dans la partie « commentaires » plutôt qu'en MP. :)</p><p id="r-561606" data-claire-element-id="561606"><em>Je tiens à remercier <a href="http://www.siteduzero.com/membres-294-736.html">Mickael Knight</a> pour avoir lu, corrigé et validé mon tutoriel. ;)</em></p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers">Créer un wiki simple avec les fichiers</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/un-systeme-qui-fonctionne-avec-les-fichiers">
Un système qui fonctionne avec les fichiers ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/la-page-d-accueil-2">
La page d&#039;accueil
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/creer-et-modifier-une-page">
Créer et modifier une page
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/afficher-une-page">
Afficher une page
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/gerer-l-historique">
Gérer l&#039;historique
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/creer-un-wiki-simple-avec-les-fichiers/afficher-une-page">
<span class="arrow"></span>
<span class="next">Afficher une page</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/creer-un-wiki-simple-avec-les-fichiers.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 01:25:49 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/creer-un-wiki-simple-avec-les-fichiers.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:25:34 GMT -->
</html>