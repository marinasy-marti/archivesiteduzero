<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/imestamp-messages-lus-non-lus.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 20:06:05 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/imestamp-messages-lus-non-lus.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:47:17 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : [Timestamp] Messages lus / non lus</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/timestamp-messages-lus-non-lus.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : [Timestamp] Messages lus / non lus</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#TimestampMessageslus_nonlus">[Timestamp] Messages lus / non lus</a><br/><a href="#Commentva-t-onfaire">Comment va-t-on faire ?</a><br/><a href="#Letempsdesmessages">Le temps des messages</a><br/><a href="#RappelEnregistrementdesvariablesdurantlavisite">[Rappel] Enregistrement des variables durant la visite</a><br/><a href="#Dernirevisite">Dernière visite</a><br/><a href="#Alorsc039estluounonlu">Alors, c&#039;est lu ou non lu ?</a><br/><a href="#Maisj039aidjlua">Mais j&#039;ai déjà lu ça !</a><br/><a href="#Update">Update</a><br/><a href="#Marquertouslesmessagescommelus">Marquer tous les messages comme lus</a><br/></div>
<a name="TimestampMessageslus_nonlus"></a><h2>[Timestamp] Messages lus / non lus</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/comment-va-t-on-faire">
<span class="next">Comment va-t-on faire ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-344561" data-claire-element-id="344561">Bonjour à tous.</p><p id="r-344562" data-claire-element-id="344562">Je vais vous présenter de manière théorique et pratique une méthode pour différencier les messages, news, annonces, etc. lus et non lus. Nous allons utiliser une méthode dont le fondement est le timestamp UNIX.</p><p id="r-344563" data-claire-element-id="344563">Pour information, le timestamp UNIX retourne le temps mesuré en secondes depuis le début de l'époque UNIX. Il s'agit donc d'un nombre qui s'incrémente toutes les secondes.</p>
</div><a name="Commentva-t-onfaire"></a><h2>Comment va-t-on faire ?</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/le-temps-des-messages">
<span class="next">Le temps des messages</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-principe-de-base-2" data-claire-element-id="344576">Principe de base</h2><p id="r-344564" data-claire-element-id="344564">Le principe de base est le suivant :</p><ul id="r-344570" data-claire-element-id="344570"><li id="r-344566" data-claire-element-id="344566"><p id="r-344565" data-claire-element-id="344565">si un message est plus <strong>ancien</strong> que notre dernière visite, on le considère comme <strong>lu</strong> ;</p></li><li id="r-344568" data-claire-element-id="344568"><p id="r-344567" data-claire-element-id="344567">si un message est plus <strong>récent</strong> que notre dernière visite, on le considère comme <strong>non lu</strong>.</p></li><p id="r-344569" data-claire-element-id="344569">(Ce sera un peu plus compliqué que ça, mais je l'expliquerai le moment venu.)</p></ul><p id="r-344571" data-claire-element-id="344571">Le tout pour nous sera d'enregistrer notre temps de dernière visite et le temps d'ajout de nos messages.</p><h3 id="r-pour-vous-aider-a-bien-visualiser-voici-un-petit-schema" data-claire-element-id="344575">Pour vous aider à bien visualiser, voici un petit schéma</h3><figure id="r-344573" data-claire-element-id="344574"><img id="r-344572" data-claire-element-id="344572" src="medias/uploads.siteduzero.com_files_11001_12000_11859.jpg" alt="Image utilisateur"/></figure><h2 id="r-exemple-concret-1-1" data-claire-element-id="344647">Exemple concret 1</h2><p id="r-344577" data-claire-element-id="344577">J'ai visité un site pour la dernière fois le 18 juin.</p><p id="r-344578" data-claire-element-id="344578">Le site contient deux messages :</p><ul id="r-344583" data-claire-element-id="344583"><li id="r-344580" data-claire-element-id="344580"><p id="r-344579" data-claire-element-id="344579">un a été posté le 15 mai ;</p></li><li id="r-344582" data-claire-element-id="344582"><p id="r-344581" data-claire-element-id="344581">l'autre a été posté le 19 juin.</p></li></ul><p id="r-344584" data-claire-element-id="344584">Le premier sera marqué comme lu, et le second comme non lu. ;)</p><table id="r-344614" data-claire-element-id="344614"><thead id="r-344594" data-claire-element-id="344594"><tr id="r-344593" data-claire-element-id="344593"><th id="r-344586" data-claire-element-id="344586"><p id="r-344585" data-claire-element-id="344585">Temps du post (t1)</p></th><th id="r-344588" data-claire-element-id="344588"><p id="r-344587" data-claire-element-id="344587">Temps de dernière visite (t2)</p></th><th id="r-344590" data-claire-element-id="344590"><p id="r-344589" data-claire-element-id="344589">(t1 &lt; t2)</p></th><th id="r-344592" data-claire-element-id="344592"><p id="r-344591" data-claire-element-id="344591">Attribution</p></th></tr></thead><tbody id="r-344613" data-claire-element-id="344613"><tr id="r-344603" data-claire-element-id="344603"><td id="r-344596" data-claire-element-id="344596"><p id="r-344595" data-claire-element-id="344595">15 mai</p></td><td id="r-344598" data-claire-element-id="344598"><p id="r-344597" data-claire-element-id="344597">18 juin</p></td><td id="r-344600" data-claire-element-id="344600"><p id="r-344599" data-claire-element-id="344599">TRUE</p></td><td id="r-344602" data-claire-element-id="344602"><p id="r-344601" data-claire-element-id="344601">Message lu</p></td></tr><tr id="r-344612" data-claire-element-id="344612"><td id="r-344605" data-claire-element-id="344605"><p id="r-344604" data-claire-element-id="344604">19 juin</p></td><td id="r-344607" data-claire-element-id="344607"><p id="r-344606" data-claire-element-id="344606">18 juin</p></td><td id="r-344609" data-claire-element-id="344609"><p id="r-344608" data-claire-element-id="344608">FALSE</p></td><td id="r-344611" data-claire-element-id="344611"><p id="r-344610" data-claire-element-id="344610">Message non lu</p></td></tr></tbody></table><aside id="r-344616" data-claire-element-id="344616" data-claire-semantic="error"><p id="r-344615" data-claire-element-id="344615">Un jour, c'est très long ; on va donc enregistrer nos temps à la seconde près pour une grande précision.</p></aside><table id="r-344646" data-claire-element-id="344646"><thead id="r-344626" data-claire-element-id="344626"><tr id="r-344625" data-claire-element-id="344625"><th id="r-344618" data-claire-element-id="344618"><p id="r-344617" data-claire-element-id="344617">Temps du post (t1)</p></th><th id="r-344620" data-claire-element-id="344620"><p id="r-344619" data-claire-element-id="344619">Temps de dernière visite (t2)</p></th><th id="r-344622" data-claire-element-id="344622"><p id="r-344621" data-claire-element-id="344621">(t1 &lt; t2)</p></th><th id="r-344624" data-claire-element-id="344624"><p id="r-344623" data-claire-element-id="344623">Attribution</p></th></tr></thead><tbody id="r-344645" data-claire-element-id="344645"><tr id="r-344635" data-claire-element-id="344635"><td id="r-344628" data-claire-element-id="344628"><p id="r-344627" data-claire-element-id="344627">18 juin</p></td><td id="r-344630" data-claire-element-id="344630"><p id="r-344629" data-claire-element-id="344629">18 juin</p></td><td id="r-344632" data-claire-element-id="344632"><p id="r-344631" data-claire-element-id="344631">Eh ?</p></td><td id="r-344634" data-claire-element-id="344634"><p id="r-344633" data-claire-element-id="344633">Indéfinie</p></td></tr><tr id="r-344644" data-claire-element-id="344644"><td id="r-344637" data-claire-element-id="344637"><p id="r-344636" data-claire-element-id="344636">18 juin 2006 à 15 h 30 min 45 s</p></td><td id="r-344639" data-claire-element-id="344639"><p id="r-344638" data-claire-element-id="344638">18 juin 2006 à 15 h 30 min 05 s</p></td><td id="r-344641" data-claire-element-id="344641"><p id="r-344640" data-claire-element-id="344640">FALSE</p></td><td id="r-344643" data-claire-element-id="344643"><p id="r-344642" data-claire-element-id="344642">Message non lu</p></td></tr></tbody></table><h2 id="r-exemple-concret-2-1" data-claire-element-id="344686">Exemple concret 2</h2><p id="r-344648" data-claire-element-id="344648">J'ai visité un site pour la dernière fois le 18 juin 2006 à 13 h 45 min 18 s.</p><p id="r-344649" data-claire-element-id="344649">Le site contient deux messages :</p><ul id="r-344654" data-claire-element-id="344654"><li id="r-344651" data-claire-element-id="344651"><p id="r-344650" data-claire-element-id="344650">un a été posté le 15 mai 2006 à 18 h 5 min 27 s ;</p></li><li id="r-344653" data-claire-element-id="344653"><p id="r-344652" data-claire-element-id="344652">l'autre a été posté le 19 juin 2006 à 01 h 24 min 57 s.</p></li></ul><p id="r-344655" data-claire-element-id="344655">Le premier sera marqué comme lu, et le second comme non lu.</p><table id="r-344685" data-claire-element-id="344685"><thead id="r-344665" data-claire-element-id="344665"><tr id="r-344664" data-claire-element-id="344664"><th id="r-344657" data-claire-element-id="344657"><p id="r-344656" data-claire-element-id="344656">Temps du post (t1)</p></th><th id="r-344659" data-claire-element-id="344659"><p id="r-344658" data-claire-element-id="344658">Temps de dernière visite (t2)</p></th><th id="r-344661" data-claire-element-id="344661"><p id="r-344660" data-claire-element-id="344660">(t1 &lt; t2)</p></th><th id="r-344663" data-claire-element-id="344663"><p id="r-344662" data-claire-element-id="344662">Attribution</p></th></tr></thead><tbody id="r-344684" data-claire-element-id="344684"><tr id="r-344674" data-claire-element-id="344674"><td id="r-344667" data-claire-element-id="344667"><p id="r-344666" data-claire-element-id="344666">15 mai 2006 à 18 h 05 min 27 s</p></td><td id="r-344669" data-claire-element-id="344669"><p id="r-344668" data-claire-element-id="344668">18 juin 2006 à 13 h 45 min 18 s</p></td><td id="r-344671" data-claire-element-id="344671"><p id="r-344670" data-claire-element-id="344670">TRUE</p></td><td id="r-344673" data-claire-element-id="344673"><p id="r-344672" data-claire-element-id="344672">Message lu</p></td></tr><tr id="r-344683" data-claire-element-id="344683"><td id="r-344676" data-claire-element-id="344676"><p id="r-344675" data-claire-element-id="344675">19 juin 2006 à 01 h 24 min 57 s</p></td><td id="r-344678" data-claire-element-id="344678"><p id="r-344677" data-claire-element-id="344677">18 juin 2006 à 13 h 45 min 18 s</p></td><td id="r-344680" data-claire-element-id="344680"><p id="r-344679" data-claire-element-id="344679">FALSE</p></td><td id="r-344682" data-claire-element-id="344682"><p id="r-344681" data-claire-element-id="344681">Message non lu</p></td></tr></tbody></table>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus">[Timestamp] Messages lus / non lus</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/comment-va-t-on-faire">
Comment va-t-on faire ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/le-temps-des-messages">
Le temps des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/rappel-enregistrement-des-variables-durant-la-visite">
[Rappel] Enregistrement des variables durant la visite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/derniere-visite">
Dernière visite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/alors-c-est-lu-ou-non-lu">
Alors, c&#039;est lu ou non lu ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/mais-j-ai-deja-lu-ca">
Mais j&#039;ai déjà lu ça !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/update">
Update
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/marquer-tous-les-messages-comme-lus">
Marquer tous les messages comme lus
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/le-temps-des-messages">
<span class="next">Le temps des messages</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Letempsdesmessages"></a><h2>Le temps des messages</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/comment-va-t-on-faire">
<span class="arrow"></span>
<span class="next">Comment va-t-on faire ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/rappel-enregistrement-des-variables-durant-la-visite">
<span class="next">[Rappel] Enregistrement des variables durant la visite</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-notre-table-de-messages" data-claire-element-id="344775">Notre table de messages</h2><p id="r-344688" data-claire-element-id="344688">On va faire simple et partir du principe qu'on enregistre le <strong>timestamp UNIX</strong> de chaque post, messages, annonces, news... C'est très important. Comme ça, on pourra positionner les messages dans le temps et vérifier s'il s'agit d'un nouveau ou d'un ancien message.</p><p id="r-344689" data-claire-element-id="344689">Il est plus ennuyeux pour nous d'enregistrer les dates sous une forme mm/jj/aaaa hh/mm/ss.<br/> Le <strong>timestamp UNIX</strong> est un nombre pur, c'est donc très facile pour nous de l'utiliser et de faire des comparaisons.</p><p id="r-344690" data-claire-element-id="344690">Allez, on démarre et on crée notre table « <strong>table_post</strong> ». C'est elle qui contiendra nos posts.<br/>(Il aurait pu s'agir de news, annonces, messages, signatures de livre d'or, etc. Je rappelle que ça s'applique à tout.)</p><pre id="r-344691" data-claire-element-id="344691"><code data-claire-semantic="sql">CREATE TABLE `table_post` (
  `id` int(8) UNSIGNED NOT NULL AUTO_INCREMENT,
  `temps` int(11) UNSIGNED DEFAULT '0',
  `titre` varchar(64) NOT NULL,
  `message` text NOT NULL,
  PRIMARY KEY  (`id`)
);</code></pre><ul id="r-344700" data-claire-element-id="344700"><li id="r-344693" data-claire-element-id="344693"><p id="r-344692" data-claire-element-id="344692">id : numéro d’identification du message ;</p></li><li id="r-344695" data-claire-element-id="344695"><p id="r-344694" data-claire-element-id="344694">temps : timestamp UNIX ;</p></li><li id="r-344697" data-claire-element-id="344697"><p id="r-344696" data-claire-element-id="344696">titre : titre du message ;</p></li><li id="r-344699" data-claire-element-id="344699"><p id="r-344698" data-claire-element-id="344698">message : message.</p></li></ul><table id="r-344766" data-claire-element-id="344766"><thead id="r-344710" data-claire-element-id="344710"><tr id="r-344709" data-claire-element-id="344709"><th id="r-344702" data-claire-element-id="344702"><p id="r-344701" data-claire-element-id="344701">id</p></th><th id="r-344704" data-claire-element-id="344704"><p id="r-344703" data-claire-element-id="344703">temps</p></th><th id="r-344706" data-claire-element-id="344706"><p id="r-344705" data-claire-element-id="344705">titre</p></th><th id="r-344708" data-claire-element-id="344708"><p id="r-344707" data-claire-element-id="344707">message</p></th></tr></thead><tbody id="r-344765" data-claire-element-id="344765"><tr id="r-344719" data-claire-element-id="344719"><td id="r-344712" data-claire-element-id="344712"><p id="r-344711" data-claire-element-id="344711">1</p></td><td id="r-344714" data-claire-element-id="344714"><p id="r-344713" data-claire-element-id="344713">1137239489</p></td><td id="r-344716" data-claire-element-id="344716"><p id="r-344715" data-claire-element-id="344715">Exemple de titre</p></td><td id="r-344718" data-claire-element-id="344718"><p id="r-344717" data-claire-element-id="344717">Exemple de message</p></td></tr><tr id="r-344728" data-claire-element-id="344728"><td id="r-344721" data-claire-element-id="344721"><p id="r-344720" data-claire-element-id="344720">2</p></td><td id="r-344723" data-claire-element-id="344723"><p id="r-344722" data-claire-element-id="344722">1128167402</p></td><td id="r-344725" data-claire-element-id="344725"><p id="r-344724" data-claire-element-id="344724">Exemple de titre 2</p></td><td id="r-344727" data-claire-element-id="344727"><p id="r-344726" data-claire-element-id="344726">Exemple de message 2</p></td></tr><tr id="r-344737" data-claire-element-id="344737"><td id="r-344730" data-claire-element-id="344730"><p id="r-344729" data-claire-element-id="344729">...</p></td><td id="r-344732" data-claire-element-id="344732"><p id="r-344731" data-claire-element-id="344731">...</p></td><td id="r-344734" data-claire-element-id="344734"><p id="r-344733" data-claire-element-id="344733">...</p></td><td id="r-344736" data-claire-element-id="344736"><p id="r-344735" data-claire-element-id="344735">...</p></td></tr><tr id="r-344746" data-claire-element-id="344746"><td id="r-344739" data-claire-element-id="344739"><p id="r-344738" data-claire-element-id="344738">2853</p></td><td id="r-344741" data-claire-element-id="344741"><p id="r-344740" data-claire-element-id="344740">1128167402</p></td><td id="r-344743" data-claire-element-id="344743"><p id="r-344742" data-claire-element-id="344742">Exemple de titre 3</p></td><td id="r-344745" data-claire-element-id="344745"><p id="r-344744" data-claire-element-id="344744">Exemple de message 3</p></td></tr><tr id="r-344755" data-claire-element-id="344755"><td id="r-344748" data-claire-element-id="344748"><p id="r-344747" data-claire-element-id="344747">2854</p></td><td id="r-344750" data-claire-element-id="344750"><p id="r-344749" data-claire-element-id="344749">1131133339</p></td><td id="r-344752" data-claire-element-id="344752"><p id="r-344751" data-claire-element-id="344751">Exemple de titre 4</p></td><td id="r-344754" data-claire-element-id="344754"><p id="r-344753" data-claire-element-id="344753">Exemple de message 4</p></td></tr><tr id="r-344764" data-claire-element-id="344764"><td id="r-344757" data-claire-element-id="344757"><p id="r-344756" data-claire-element-id="344756">...</p></td><td id="r-344759" data-claire-element-id="344759"><p id="r-344758" data-claire-element-id="344758">...</p></td><td id="r-344761" data-claire-element-id="344761"><p id="r-344760" data-claire-element-id="344760">...</p></td><td id="r-344763" data-claire-element-id="344763"><p id="r-344762" data-claire-element-id="344762">...</p></td></tr></tbody></table><aside id="r-344768" data-claire-element-id="344768" data-claire-semantic="information"><p id="r-344767" data-claire-element-id="344767">Il est évident qu'on aurait pu avoir d'autres champs : auteur, nombre_d_affichages, categorie...</p></aside><p id="r-344769" data-claire-element-id="344769">Ici, vous pouvez voir des nombres tels que « 1131133339 » : il s'agit de notre <strong>timestamp UNIX</strong>, on pourra facilement l'insérer dans notre table grâce à la fonction time(); de PHP. C'est vraiment le plus important pour nous, il nous servira à différencier nos messages dans le temps. <br/>Voir aussi : <a href="http://be.php.net/manual/fr/function.time.php">Bibliothèque PHP, fonction time()</a>.</p><pre id="r-344770" data-claire-element-id="344770"><code data-claire-semantic="html+php">&lt;?php
 
$tmp = time(); // Contient le timestamp UNIX de l'instant où la variable est initialisée
echo $tmp; // Affiche un nombre du type : 1131133339
 
?&gt;</code></pre><p id="r-344771" data-claire-element-id="344771">Voici un petit exemple :</p><pre id="r-344772" data-claire-element-id="344772"><code data-claire-semantic="html+php">&lt;?php
 
// Connexion à MySQL
// J'ai mis des addslashes, c'est un petit rappel de sécurité (attention, ils ne sont pas forcément nécessaires, reportez-vous à votre php.ini ou à votre hébergeur).
 
$req = 'INSERT INTO `table_post` (`temps`,`titre`,`message`) VALUES (&quot;'.time().'&quot;,&quot;'.addslashes($_POST['titre']).'&quot;,&quot;'.addslashes($_POST['message']).'&quot;)';
 
mysql_query($req);</code></pre><aside id="r-344774" data-claire-element-id="344774" data-claire-semantic="information"><p id="r-344773" data-claire-element-id="344773">Il existe un type TIMESTAMP pour les tables MySQL, mais je préfère ne pas l'utiliser pour des raisons de contrôle (on ne veut pas forcément updater le temps).</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus">[Timestamp] Messages lus / non lus</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/comment-va-t-on-faire">
Comment va-t-on faire ?
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/le-temps-des-messages">
Le temps des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/rappel-enregistrement-des-variables-durant-la-visite">
[Rappel] Enregistrement des variables durant la visite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/derniere-visite">
Dernière visite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/alors-c-est-lu-ou-non-lu">
Alors, c&#039;est lu ou non lu ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/mais-j-ai-deja-lu-ca">
Mais j&#039;ai déjà lu ça !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/update">
Update
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/marquer-tous-les-messages-comme-lus">
Marquer tous les messages comme lus
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/comment-va-t-on-faire">
<span class="arrow"></span>
<span class="next">Comment va-t-on faire ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/rappel-enregistrement-des-variables-durant-la-visite">
<span class="next">[Rappel] Enregistrement des variables durant la visite</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="RappelEnregistrementdesvariablesdurantlavisite"></a><h2>[Rappel] Enregistrement des variables durant la visite</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/le-temps-des-messages">
<span class="arrow"></span>
<span class="next">Le temps des messages</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/derniere-visite">
<span class="next">Dernière visite</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-les-variables-session-php4" data-claire-element-id="344779">Les variables session php4</h2><p id="r-344777" data-claire-element-id="344777">On va avoir besoin d'enregistrer des variables durant la visite : pour ce faire, on va utiliser les <strong>session php4</strong> pour des raisons pratiques.</p><p id="r-344778" data-claire-element-id="344778">On pourrait s'en passer, mais les <strong>session php4</strong> sont de plus en plus disponibles sur les différents hébergeurs PHP et on ne va donc pas s'en priver.</p><h2 id="r-exemple-et-rappel" data-claire-element-id="344784">Exemple et rappel</h2><p id="r-344780" data-claire-element-id="344780">Pour information, les sessions s'écrivent comme ceci :</p><pre id="r-344781" data-claire-element-id="344781"><code data-claire-semantic="html+php">&lt;?php
 
// À placer avant toute sortie de code à l'écran
session_name('Session_sdz'); // Cette ligne n'est pas obligatoire
session_start(); // Démarrage de la session
 
?&gt;</code></pre><p id="r-344782" data-claire-element-id="344782">On peut ensuite initialiser des <strong>variables</strong> qui seront <strong>disponibles tout au long de la session</strong> (autrement dit, tant que le navigateur n'est pas fermé (ou dépassement de temps)).</p><pre id="r-344783" data-claire-element-id="344783"><code data-claire-semantic="html+php">&lt;?php
 
// Une seule fois, je répète ici ;)
session_name('Session_sdz'); // Cette ligne n'est pas obligatoire
session_start(); // Démarrage de la session
 
$_SESSION['ma_var'] = 'test';
 
echo $_SESSION['ma_var'];
 
?&gt;</code></pre>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus">[Timestamp] Messages lus / non lus</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/comment-va-t-on-faire">
Comment va-t-on faire ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/le-temps-des-messages">
Le temps des messages
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/rappel-enregistrement-des-variables-durant-la-visite">
[Rappel] Enregistrement des variables durant la visite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/derniere-visite">
Dernière visite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/alors-c-est-lu-ou-non-lu">
Alors, c&#039;est lu ou non lu ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/mais-j-ai-deja-lu-ca">
Mais j&#039;ai déjà lu ça !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/update">
Update
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/marquer-tous-les-messages-comme-lus">
Marquer tous les messages comme lus
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/le-temps-des-messages">
<span class="arrow"></span>
<span class="next">Le temps des messages</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/derniere-visite">
<span class="next">Dernière visite</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Dernirevisite"></a><h2>Dernière visite</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/rappel-enregistrement-des-variables-durant-la-visite">
<span class="arrow"></span>
<span class="next">[Rappel] Enregistrement des variables durant la visite</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/alors-c-est-lu-ou-non-lu">
<span class="next">Alors, c&#039;est lu ou non lu ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-derniere-visite-courante-et-precedente" data-claire-element-id="344795">Dernière visite courante et précédente</h2><p id="r-344786" data-claire-element-id="344786">On va distinguer <strong>deux</strong> temps pour la dernière visite :</p><ul id="r-344791" data-claire-element-id="344791"><li id="r-344788" data-claire-element-id="344788"><p id="r-344787" data-claire-element-id="344787">un qu'on mettra dans nos variables session php4 ;</p></li><li id="r-344790" data-claire-element-id="344790"><p id="r-344789" data-claire-element-id="344789">un autre qu'on enregistrera dans un cookie ou dans une base de données.</p></li></ul><p id="r-344792" data-claire-element-id="344792">Le premier, celui qu'on initialisera comme variable session, ne sera <strong>pas mis à jour durant la visite du site</strong>, il servira de point de repère pour distinguer les différents temps de messages.</p><p id="r-344793" data-claire-element-id="344793">L'autre, on le <strong>mettra à jour aussi souvent que possible</strong>, il nous servira de point de repère pour des visites futures.</p><p id="r-344794" data-claire-element-id="344794">SESSION : le temps de dernière visite précédent (repère).<br/>COOKIE ou SQL : le temps de dernière visite courant.</p><h2 id="r-exemple-81" data-claire-element-id="344809">Exemple</h2><p id="r-344796" data-claire-element-id="344796">Voici un exemple de gestion de ces deux « types » de temps.</p><p id="r-344797" data-claire-element-id="344797">Le script procède comme suit :</p><p id="r-344798" data-claire-element-id="344798">1/ on vérifie si l’on a déjà créé la variable session ;<br/> 1.1/ si le cookie n'existe pas, on le crée,<br/> 1.2/ si l’on n'a pas créé la variable session, on la crée,<br/> 1.3/ ensuite, on incrémente la variable cookie ou sql ;<br/> 2/ on incrémente la variable cookie ou sql.</p><pre id="r-344799" data-claire-element-id="344799"><code data-claire-semantic="html+php">&lt;?php
 
// Ce code doit être placé au début de chaque page qui affiche nos messages, news, annonces...
// Un require ou include peut être très utile
 
session_name('Nom_d_exemple');
session_start(); // Démarrage de la session
 
 
// POINT [1]
// On doit impérativement connaître le temps de visite précédent, et donc on vérifie si on l'a déjà
// Enregistré dans une variable session : si ce n'est pas fait, on l'enregistre
if( !isset( $_SESSION['tmp_derniere_visite'] ) ) {
 
        // Ici, on part du principe que le temps de dernière visite est dans un cookie
        // On aurait tout aussi bien pu enregistrer ce temps dans une BDD
        
        // POINT [1.1]
        // Si le temps de dernière visite (cookie) n'existe pas, on le crée.
        if( !isset($_COOKIE['tmp_der_visite']) ) setcookie('tmp_der_visite',time(), time() + (3600*24*365));
                
        // POINT [1.2]
        // On enregistre le temps de dernière visite de la session
        $_SESSION['tmp_derniere_visite'] = $_COOKIE['tmp_der_visite'];
        
        // POINT [1.3]
        // On met le temps de dernière visite à jour, pour les prochaines visites
        setcookie('tmp_der_visite',time(), time() + (3600*24*365));
 
        
}
// POINT [2]
// On met le temps de dernière visite à jour, pour les prochaines visites
else setcookie('tmp_der_visite',time(), time() + (3600*24*365));
 
 
?&gt;</code></pre><h3 id="r-exemple-80" data-claire-element-id="344800">Exemple</h3><h3 id="r-schema-des-points-1-2-et-1-3" data-claire-element-id="344804">Schéma des points 1.2 et 1.3</h3><figure id="r-344802" data-claire-element-id="344803"><img id="r-344801" data-claire-element-id="344801" src="medias/uploads.siteduzero.com_files_11001_12000_11841.png" alt="Image utilisateur"/></figure><h3 id="r-schema-du-point-2" data-claire-element-id="344808">Schéma du point 2</h3><figure id="r-344806" data-claire-element-id="344807"><img id="r-344805" data-claire-element-id="344805" src="medias/uploads.siteduzero.com_files_11001_12000_11842.png" alt="Image utilisateur"/></figure>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus">[Timestamp] Messages lus / non lus</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/comment-va-t-on-faire">
Comment va-t-on faire ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/le-temps-des-messages">
Le temps des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/rappel-enregistrement-des-variables-durant-la-visite">
[Rappel] Enregistrement des variables durant la visite
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/derniere-visite">
Dernière visite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/alors-c-est-lu-ou-non-lu">
Alors, c&#039;est lu ou non lu ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/mais-j-ai-deja-lu-ca">
Mais j&#039;ai déjà lu ça !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/update">
Update
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/marquer-tous-les-messages-comme-lus">
Marquer tous les messages comme lus
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/rappel-enregistrement-des-variables-durant-la-visite">
<span class="arrow"></span>
<span class="next">[Rappel] Enregistrement des variables durant la visite</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/alors-c-est-lu-ou-non-lu">
<span class="next">Alors, c&#039;est lu ou non lu ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Alorsc039estluounonlu"></a><h2>Alors, c&#039;est lu ou non lu ?</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/derniere-visite">
<span class="arrow"></span>
<span class="next">Dernière visite</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/mais-j-ai-deja-lu-ca">
<span class="next">Mais j&#039;ai déjà lu ça !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-affichage-des-messages-lus-et-non-lus" data-claire-element-id="344829">Affichage des messages lus et non lus</h2><p id="r-344811" data-claire-element-id="344811">Ben voilà : maintenant, on connaît le temps de notre dernière visite et le temps des différents messages. On va donc pouvoir commencer à classer nos messages en lus et non lus.<br/> Comment va-t-on procéder pour vérifier si un message est lu ou non ? Tout simplement avec un tout petit if().</p><p id="r-344812" data-claire-element-id="344812">Voici un exemple de ce que nous aurions pu faire avec nos variables session et notre table table_post :</p><pre id="r-344813" data-claire-element-id="344813"><code data-claire-semantic="html+php">&lt;?php
 
/*******************************************************
** Gestion du temps de dernière visite
*******************************************************/
 
session_name('Nom_d_exemple');
session_start(); 
 
if( !isset( $_SESSION['tmp_derniere_visite'] ) ) {
 
        if( !isset($_COOKIE['tmp_der_visite']) ) setcookie('tmp_der_visite',time(), time() + (3600*24*365));
        $_SESSION['tmp_derniere_visite'] = $_COOKIE['tmp_der_visite'];
        setcookie('tmp_der_visite',time(), time() + (3600*24*365));        
}
 
else setcookie('tmp_der_visite',time(), time() + (3600*24*365));
 
/*******************************************************
** Affichage des messages
*******************************************************/
 
// Connexion à MySQL
$db = mysql_connect('host','user','mdp');
mysql_select_db('ma_bdd',$db);
 
// On sélectionne toute notre table et on la trie par date
$req = 'SELECT * FROM `table_post` ORDER BY `temps` DESC';
$sql = mysql_query('SELECT * FROM `table_post` ORDER BY `temps`');
 
// On va afficher une petite image qui signifie que le message est lu ou non
$msg_lu = './images/lu.png';
$msg_non_lu = './images/non_lu.png';
 
// On boucle sur nos différentes entrées
while( $data = mysql_fetch_assoc($sql) ) {
 
        echo '&lt;p&gt;';
        
        // Pour afficher une petite image qui signifie que le message est lu ou non
        // Il nous suffit simplement de comparer le temps du message et celui de notre dernière visite.
        
        if( $data['temps'] &gt;= $_SESSION['tmp_derniere_visite'] )
        echo '&lt;img src=&quot;'.$msg_non_lu.'&quot; alt=&quot;message non-lu&quot; /&gt;';
        
        else echo '&lt;img src=&quot;'.$msg_lu.'&quot; alt=&quot;message lu&quot; /&gt;';
        
        // Ensuite, on peut afficher notre message      
        echo ' &lt;b&gt;'.$data['titre'].'&lt;/b&gt;&lt;br /&gt;'.$data['message'].'&lt;/p&gt;';
 
}
 
?&gt;</code></pre><p id="r-344814" data-claire-element-id="344814">Vous voyez, c'est très simple : <strong>on compare</strong> le <strong>temps de dernière visite</strong> avec l<strong>e temps du message</strong>. ;) <br/> Bon, c'est bien joli tout ça, mais les messages non lus restent non lus même si on les affiche.</p><p id="r-344815" data-claire-element-id="344815">C'est vrai, on va donc devoir trouver une petite parade à ça, mais il y a des cas où ce n'est pas nécessaire. Par exemple si on affiche des news sur un site, quel est l'intérêt de marquer les messages comme lus alors qu'on peut voir directement le contenu ? Autant les laisser comme non lus, et on différenciera ainsi plus facilement les nouveaux des anciens.</p><p id="r-344816" data-claire-element-id="344816">Mais si d'un autre côté, on n'affichait que les titres de nos messages et s'il fallait cliquer sur un lien pour pouvoir y accéder, là, on pourrait dire que c'est intéressant de ne voir que ceux qu'on n'a réellement pas lus, pour éviter de mélanger des non lus réels et imaginaires.</p><p id="r-344817" data-claire-element-id="344817">C'est ce que nous allons voir dans le prochain chapitre.</p><p id="r-344818" data-claire-element-id="344818">J’illustre quand même ma pensée.</p><h3 id="r-exemple-de-site-1" data-claire-element-id="344822">Exemple de site 1</h3><figure id="r-344820" data-claire-element-id="344821"><img id="r-344819" data-claire-element-id="344819" src="medias/uploads.siteduzero.com_files_11001_12000_11873.png" alt="Image utilisateur"/></figure><h3 id="r-exemple-de-site-2" data-claire-element-id="344828">Exemple de site 2</h3><figure id="r-344824" data-claire-element-id="344825"><img id="r-344823" data-claire-element-id="344823" src="medias/uploads.siteduzero.com_files_11001_12000_11874.png" alt="Image utilisateur"/></figure><p id="r-344826" data-claire-element-id="344826">Vous pouvez voir pour le premier exemple qu'il est inutile de marquer les news comme lues dès le premier affichage de la page, ça se fera automatiquement lors de la prochaine visite. Dans le second cas, il serait bien que les news sur lesquelles on a cliqué soient affichées comme lues.</p><p id="r-344827" data-claire-element-id="344827">Je voulais que vous différenciez bien les deux cas pour ne pas mettre de code inutilement ; certains peuvent arrêter de lire le tuto à partir d'ici. Ceux qui sont intéressés peuvent continuer avec moi. :lol:</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus">[Timestamp] Messages lus / non lus</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/comment-va-t-on-faire">
Comment va-t-on faire ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/le-temps-des-messages">
Le temps des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/rappel-enregistrement-des-variables-durant-la-visite">
[Rappel] Enregistrement des variables durant la visite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/derniere-visite">
Dernière visite
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/alors-c-est-lu-ou-non-lu">
Alors, c&#039;est lu ou non lu ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/mais-j-ai-deja-lu-ca">
Mais j&#039;ai déjà lu ça !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/update">
Update
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/marquer-tous-les-messages-comme-lus">
Marquer tous les messages comme lus
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/derniere-visite">
<span class="arrow"></span>
<span class="next">Dernière visite</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/mais-j-ai-deja-lu-ca">
<span class="next">Mais j&#039;ai déjà lu ça !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Maisj039aidjlua"></a><h2>Mais j&#039;ai déjà lu ça !</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/alors-c-est-lu-ou-non-lu">
<span class="arrow"></span>
<span class="next">Alors, c&#039;est lu ou non lu ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/update">
<span class="next">Update</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-ne-pas-tenir-compte-des-nouveaux-messages-deja-lus" data-claire-element-id="344843">Ne pas tenir compte des nouveaux messages déjà lus</h2><p id="r-344831" data-claire-element-id="344831">Lorsqu'on a, comme dans l'exemple 2 (voir partie précédente), un affichage différé qui nécessite une action pour afficher le contenu, on peut légitimement exiger que les nouveaux messages affichés soient marqués comme lus.</p><p id="r-344832" data-claire-element-id="344832">Comment va-t-on faire ? C'est très simple : on va <strong>noter les messages visités</strong>, tout simplement.</p><p id="r-344833" data-claire-element-id="344833">Voici un exemple de script que nous pourrions utiliser lors de l'affichage du contenu d'une news par exemple.</p><pre id="r-344834" data-claire-element-id="344834"><code data-claire-semantic="html+php">&lt;?php
 
/*******************************************************
** Gestion du temps de dernière visite
*******************************************************/
 
session_name('Nom_d_exemple');
session_start(); 
 
if( !isset( $_SESSION['tmp_derniere_visite'] ) ) {
 
        if( !isset($_COOKIE['tmp_der_visite']) ) setcookie('tmp_der_visite',time(), time() + (3600*24*365));
        $_SESSION['tmp_derniere_visite'] = $_COOKIE['tmp_der_visite'];
        setcookie('tmp_der_visite',time(), time() + (3600*24*365));        
}
 
else setcookie('tmp_der_visite',time(), time() + (3600*24*365));
 
/*******************************************************
** Affichage du contenu d'un message
*******************************************************/
 
// Connexion à MySQL
$db = mysql_connect('host','user','mdp');
mysql_select_db('ma_bdd',$db);
 
// On sélectionne une entrée de notre table désignée par $_GET['id']
$req = 'SELECT * FROM `table_post` WHERE id = '.intval($_GET['id']);
$sql = mysql_query('SELECT * FROM `table_post` ORDER BY `temps`');
$data = mysql_fetch_assoc($sql);
 
        
        // On peut afficher notre message       
        echo '&lt;p&gt;&lt;b&gt;'.$data['titre'].'&lt;/b&gt;&lt;br /&gt;'.$data['message'].'&lt;/p&gt;';
        
        // On va marquer ce message pour indiquer qu'il a déjà été lu. Notez que l'ID du message fait partie intégrante du nom de la variable session, ça nous permettra de la différencier des autres.
        $_SESSION['message_lu'.$data['id']] = $data['temps'];
 
}
 
?&gt;</code></pre><aside id="r-344836" data-claire-element-id="344836" data-claire-semantic="information"><p id="r-344835" data-claire-element-id="344835">Vous pouvez voir que j'utilise une coordonnée simple pour ma variable session : j'aurais pu faire autrement, et en donner deux.</p></aside><pre id="r-344837" data-claire-element-id="344837"><code data-claire-semantic="html+php">&lt;?php
 
// Comme dans l'exemple 
$_SESSION['message_lu'.$data['id']] = $data['temps'];
 
// Autre méthode, mais elle m'a déjà généré des erreurs, donc sur le principe, je l'évite.
$_SESSION['message_lu'][$data['id']] = $data['temps'];
 
?&gt;</code></pre><p id="r-344838" data-claire-element-id="344838">Notre script d'affichage principal devient alors :</p><pre id="r-344839" data-claire-element-id="344839"><code data-claire-semantic="html+php">&lt;?php
 
/*******************************************************
** Gestion du temps de dernière visite
*******************************************************/
 
session_name('Nom_d_exemple');
session_start();
 
if( !isset( $_SESSION['tmp_derniere_visite'] ) ) {
 
        if( !isset($_COOKIE['tmp_der_visite']) ) setcookie('tmp_der_visite',time(), time() + (3600*24*365));
        $_SESSION['tmp_derniere_visite'] = $_COOKIE['tmp_der_visite'];
        setcookie('tmp_der_visite',time(), time() + (3600*24*365));       
}
 
else setcookie('tmp_der_visite',time(), time() + (3600*24*365));
 
/*******************************************************
** Affichage des messages
*******************************************************/
 
// Connexion à MySQL
$db = mysql_connect('host','user','mdp');
mysql_select_db('ma_bdd',$db);
 
// On sélectionne toute notre table et on la trie par date
$req = 'SELECT * FROM `table_post` ORDER BY `temps` DESC';
$sql = mysql_query('SELECT * FROM `table_post` ORDER BY `temps`');
 
// On va afficher une petite image qui signifie que le message est lu ou non
$msg_lu = './images/lu.png';
$msg_non_lu = './images/non_lu.png';
 
// On boucle sur nos différentes entrées
while( $data = mysql_fetch_assoc($sql) ) {
 
        echo '&lt;p&gt;';
       
        // Pour afficher une petite image qui signifie que le message est lu ou non
        // Il nous suffit simplement de comparer le temps du message et celui de notre dernière visite.
       
        if( $data['temps'] &gt;= $_SESSION['tmp_derniere_visite'] ) {
                
                        // Mais il est possible que notre message soit marqué, nous devons en tenir compte
                        // Dans ce cas, le message est bel et bien lu
                        if( isset($_SESSION['message_lu'.$data['id']]) &amp;&amp; $_SESSION['message_lu'.$data['id']] &gt; $data['temps'] )
                        echo '&lt;img src=&quot;'.$msg_lu.'&quot; alt=&quot;message lu&quot; /&gt;';
                        
                        // Autrement, c'est normal, il s'agit bien d'un nouveau message non lu
                        else echo '&lt;img src=&quot;'.$msg_non_lu.'&quot; alt=&quot;message non-lu&quot; /&gt;';
                
                }       
       
        else echo '&lt;img src=&quot;'.$msg_lu.'&quot; alt=&quot;message lu&quot; /&gt;';
       
        // Ensuite, on peut afficher notre message     
        echo ' &lt;a href=&quot;page_appelee.php?id='.$data['id'].'&quot;&gt;'.$data['titre'].'&lt;/a&gt;&lt;/p&gt;';
 
}
 
?&gt;</code></pre><aside id="r-344842" data-claire-element-id="344842" data-claire-semantic="information"><p id="r-344840" data-claire-element-id="344840">Vous pouvez voir dans le script que je ne fais pas que vérifier l'existence de notre variable session message_lu#. <br/> On aurait pu se contenter d'une simple valeur booléenne, non ?</p><p id="r-344841" data-claire-element-id="344841">La réponse est oui, mais vous allez voir que ça peut être utile en cas d'update. ;) <br/> Nous pourrons ainsi ignorer cette variable si elle est devenue gênante. (En effet, si le post a été modifié, on peut considérer qu'il faut de nouveau le prendre comme non lu.)</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus">[Timestamp] Messages lus / non lus</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/comment-va-t-on-faire">
Comment va-t-on faire ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/le-temps-des-messages">
Le temps des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/rappel-enregistrement-des-variables-durant-la-visite">
[Rappel] Enregistrement des variables durant la visite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/derniere-visite">
Dernière visite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/alors-c-est-lu-ou-non-lu">
Alors, c&#039;est lu ou non lu ?
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/mais-j-ai-deja-lu-ca">
Mais j&#039;ai déjà lu ça !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/update">
Update
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/marquer-tous-les-messages-comme-lus">
Marquer tous les messages comme lus
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/alors-c-est-lu-ou-non-lu">
<span class="arrow"></span>
<span class="next">Alors, c&#039;est lu ou non lu ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/update">
<span class="next">Update</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Update"></a><h2>Update</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/mais-j-ai-deja-lu-ca">
<span class="arrow"></span>
<span class="next">Mais j&#039;ai déjà lu ça !</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/marquer-tous-les-messages-comme-lus">
<span class="next">Marquer tous les messages comme lus</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-un-message-lu-en-cache-un-autre-non-lu" data-claire-element-id="344858">Un message lu en cache un autre non lu</h2><p id="r-344845" data-claire-element-id="344845">Il pourrait arriver qu'un message doive pour une raison ou une autre être modifié. Il est alors intéressant de le marquer de nouveau comme non lu.</p><p id="r-344846" data-claire-element-id="344846">Les cas les plus fréquents sont :</p><ul id="r-344855" data-claire-element-id="344855"><li id="r-344848" data-claire-element-id="344848"><p id="r-344847" data-claire-element-id="344847">une modification ;</p></li><li id="r-344850" data-claire-element-id="344850"><p id="r-344849" data-claire-element-id="344849">l’ajout d’un commentaire ;</p></li><li id="r-344852" data-claire-element-id="344852"><p id="r-344851" data-claire-element-id="344851">l’ajout d’une réponse ;</p></li><li id="r-344854" data-claire-element-id="344854"><p id="r-344853" data-claire-element-id="344853">etc.</p></li></ul><p id="r-344856" data-claire-element-id="344856">Pour indiquer qu'un <strong>message</strong> est <strong>de nouveau non lu</strong>, on va simplement <strong>mettre son « temps » à jour</strong> avec ce bout de script à utiliser le moment venu.</p><pre id="r-344857" data-claire-element-id="344857"><code data-claire-semantic="html+php">&lt;?php
 
// Connexion à MySQL
// On connaît le message à mettre à jour grâce à la variable $_GET['id']
 
mysql_query('UPDATE `table_post` SET `temps` = '.time().' WHERE id = '.intval($_GET['id']));
 
?&gt;</code></pre>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus">[Timestamp] Messages lus / non lus</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/comment-va-t-on-faire">
Comment va-t-on faire ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/le-temps-des-messages">
Le temps des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/rappel-enregistrement-des-variables-durant-la-visite">
[Rappel] Enregistrement des variables durant la visite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/derniere-visite">
Dernière visite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/alors-c-est-lu-ou-non-lu">
Alors, c&#039;est lu ou non lu ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/mais-j-ai-deja-lu-ca">
Mais j&#039;ai déjà lu ça !
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/update">
Update
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/marquer-tous-les-messages-comme-lus">
Marquer tous les messages comme lus
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/mais-j-ai-deja-lu-ca">
<span class="arrow"></span>
<span class="next">Mais j&#039;ai déjà lu ça !</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/marquer-tous-les-messages-comme-lus">
<span class="next">Marquer tous les messages comme lus</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Marquertouslesmessagescommelus"></a><h2>Marquer tous les messages comme lus</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/update">
<span class="arrow"></span>
<span class="next">Update</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h2 id="r-retour-vers-le-present" data-claire-element-id="344867">Retour vers le présent</h2><p id="r-344860" data-claire-element-id="344860">Alors là, c'est un cadeau, il n'y a rien de plus simple : pour faire en sorte que tous nos messages soient marqués comme lus, il suffit de <strong>revenir au présent</strong>. :D</p><pre id="r-344861" data-claire-element-id="344861"><code data-claire-semantic="html+php">&lt;?php
 
session_name('Nom_d_exemple');
session_start(); 
 
$_SESSION['tmp_derniere_visite'] = time();
 
?&gt;</code></pre><p id="r-344862" data-claire-element-id="344862">Comme ceci, il est <strong>impossible</strong> au moment où on exécute ce script <strong>qu'un message déjà présent</strong> sur le site <strong>ait un temps supérieur au nôtre.</strong></p><p id="r-344863" data-claire-element-id="344863">En conclusion, il suffit simplement de jouer avec les nombres pour savoir si un message est lu ou non. Vous devriez être capables maintenant d'appliquer les quelques principes que je viens d'exposer à vos propres scripts.</p><p id="r-344864" data-claire-element-id="344864">Si vous avez des questions, n'hésitez pas à vous renseigner sur le forum. Mais j'espère avoir été suffisamment complet. ;)</p><p id="r-344865" data-claire-element-id="344865">Vous aurez remarqué que les messages non lus lors de précédentes visites deviennent lus dans la suivante. C'est le problème de cette méthode, mais la plupart des grands forums (tels PHPBB) ont pour base ce principe de non-conservation.</p><p id="r-344866" data-claire-element-id="344866"><strong>Remarque :</strong> je n'accepte plus de support par MP ; en effet, la plupart du temps, c'est totalement infondé. Le forum est là pour ça, merci. :)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus">[Timestamp] Messages lus / non lus</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/comment-va-t-on-faire">
Comment va-t-on faire ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/le-temps-des-messages">
Le temps des messages
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/rappel-enregistrement-des-variables-durant-la-visite">
[Rappel] Enregistrement des variables durant la visite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/derniere-visite">
Dernière visite
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/alors-c-est-lu-ou-non-lu">
Alors, c&#039;est lu ou non lu ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/mais-j-ai-deja-lu-ca">
Mais j&#039;ai déjà lu ça !
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/update">
Update
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/marquer-tous-les-messages-comme-lus">
Marquer tous les messages comme lus
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/timestamp-messages-lus-non-lus/update">
<span class="arrow"></span>
<span class="next">Update</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/imestamp-messages-lus-non-lus.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 20:06:06 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/imestamp-messages-lus-non-lus.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:47:18 GMT -->
</html>