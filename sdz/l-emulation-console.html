<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/l-emulation-console.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 08:39:01 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/l-emulation-console.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:33:05 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : L&#039;émulation console</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/l-emulation-console.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : L&#039;émulation console</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#L039mulationconsole">L&#039;émulation console</a><br/><a href="#Untourd039horizon">Un tour d&#039;horizon</a><br/><a href="#Dfinitiondel039mulation">Définition de l&#039;émulation</a><br/><a href="#Lesinformationssurlesconsolesdejeu">Les informations sur les consoles de jeu</a><br/><a href="#Lgislation">Législation</a><br/><a href="#Quelleconsolemuler">Quelle console émuler ?</a><br/><a href="#Critresdeslection">Critères de sélection</a><br/><a href="#LaChip8">La Chip 8</a><br/><a href="#Labase">La base</a><br/><a href="#L039implmentationdelamachine">L&#039;implémentation de la machine</a><br/><a href="#Legraphique">Le graphique</a><br/><a href="#Simulationdesinstructions">Simulation des instructions</a><br/><a href="#LecadencementduCPUetlesFPS">Le cadencement du CPU et les FPS</a><br/><a href="#Lecturedel039opcode">Lecture de l&#039;opcode</a><br/><a href="#Identificationdel039instruction">Identification de l&#039;instruction</a><br/><a href="#Retoursurlegraphique">Retour sur le graphique</a><br/><a href="#Exemplesavecquelquesinstructions">Exemples avec quelques instructions</a><br/><a href="#Divers">Divers</a><br/><a href="#Lemodededessinintgr">Le mode de dessin intégré</a><br/><a href="#Chargerunjeu">Charger un jeu</a><br/><a href="#L039interfacehomme-machine">L&#039;interface homme-machine</a><br/><a href="#Lesentresutilisateur">Les entrées utilisateur</a><br/><a href="#Leson">Le son</a><br/><a href="#vousdejouer">À vous de jouer !</a><br/></div>
<a name="L039mulationconsole"></a><h2>L&#039;émulation console</h2><div class="content" role="article">
<div id="r-400404" data-claire-element-id="400404" data-claire-semantic="question"><p id="r-400403" data-claire-element-id="400403">Vous vous êtes toujours demandé par où commencer pour programmer un émulateur ? Vous voulez mettre en pratique vos connaissances dans un langage de programmation ? Ou vous voulez ramener à la vie votre console des années 70 ? :lol:</p></div><p id="r-400405" data-claire-element-id="400405">Ce tutoriel est alors fait pour vous. Un émulateur, en général, permet de simuler une machine spécifique. Dans notre cas, nous allons copier le fonctionnement d'une console de jeu.<br/> Étant donné l'abondance et la diversité de ces machines, il est utile de préciser que ce tutoriel n'expliquera pas tout ce qu'il faut pour émuler n'importe quelle console, mais il sera surtout un support pour bien débuter dans le passionnant domaine de l'émulation.</p><p id="r-400406" data-claire-element-id="400406">Nous allons donc voir quelques généralités sur l'émulation avant d'entrer dans le vif du sujet.</p>
</div>
<div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1358423835269-0" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1358423835269-0');
        });
    }
    </script>
</div><a name="Untourd039horizon"></a><h2>Un tour d&#039;horizon</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
<span class="next">Définition de l&#039;émulation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-400414" data-claire-element-id="400414">Nous allons commencer notre aventure avec un voyage dans les coulisses de l'émulation. Comment est-il possible de créer un émulateur ? Comment faut-il s'y prendre pour espérer en créer un ? Cette partie nous permettra de répondre à ces différentes interrogations.</p>
</div><a name="Dfinitiondel039mulation"></a><h2>Définition de l&#039;émulation</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/un-tour-d-horizon-1">
<span class="arrow"></span>
<span class="next">Un tour d&#039;horizon</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
<span class="next">Les informations sur les consoles de jeu</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-definition-de-l-emulation" data-claire-element-id="400537">Définition de l'émulation</h4><p id="r-400415" data-claire-element-id="400415">Je parie que vous avez, plusieurs fois, fait des recherches pour savoir comment programmer un émulateur et que vous vous êtes retrouvés sur des sites vous montrant comment en configurer un, déjà existant.<br/> Votre calvaire vient de prendre fin. Grâce à ce tutoriel, vous serez en mesure de programmer le vôtre de A à Z.<br/> Avant de commencer notre passionnante aventure, nous allons définir les différentes notions que nous utiliserons afin de mieux cerner nos objectifs.</p><div id="r-400417" data-claire-element-id="400417" data-claire-semantic="question"><p id="r-400416" data-claire-element-id="400416">Depuis un moment, tu nous parles d'émulateur, d'émulation, mais en quoi cela consiste-t-il réellement ?</p></div><h5 id="r-emulation" data-claire-element-id="400437">Émulation</h5><h6 id="r-definition-53" data-claire-element-id="400427">Définition</h6><p id="r-400418" data-claire-element-id="400418">D'après Wikipédia, en informatique, l'émulation consiste à substituer un élément de matériel informatique − tel un terminal informatique, un ordinateur ou une console de jeu − par un logiciel.<br/> La définition du terme <em>émuler</em> est « chercher à imiter ». Il faut voir dans l'émulation une imitation du comportement physique d'un matériel par un logiciel, et ne pas la confondre avec la simulation. <a href="http://fr.wikipedia.org/wiki/Émulation">Wikipédia</a></p><p id="r-400419" data-claire-element-id="400419">Théoriquement, il est donc possible de créer un émulateur pour toutes les machines électroniques. Pour ce faire, il suffit juste de :</p><ul id="r-400426" data-claire-element-id="400426"><li id="r-400421" data-claire-element-id="400421"><p id="r-400420" data-claire-element-id="400420">connaître ses caractéristiques ;</p></li><li id="r-400423" data-claire-element-id="400423"><p id="r-400422" data-claire-element-id="400422">trouver un support au moins aussi puissant que la machine à émuler ;</p></li><li id="r-400425" data-claire-element-id="400425"><p id="r-400424" data-claire-element-id="400424">traduire les caractéristiques.</p></li></ul><h6 id="r-difficultes" data-claire-element-id="400429">Difficultés</h6><p id="r-400428" data-claire-element-id="400428">Vous verrez tout au long de ce tutoriel que programmer un émulateur n'a rien d'extraordinaire. Le plus difficile est de connaître le fonctionnement exact de la machine que l'on désire émuler. <br/> Eh oui, les constructeurs n'ont aucun intérêt à publier les caractéristiques de leurs consoles et ce n'est pas aujourd'hui qu'ils le feront. :lol: <br/> Pour trouver les informations qu'il leur faut, les programmeurs doivent donc avoir recours à diverses méthodes que l'on abordera dans le prochain chapitre.</p><h6 id="r-comment-fonctionne-un-emulateur" data-claire-element-id="400436">Comment fonctionne un émulateur ?</h6><p id="r-400430" data-claire-element-id="400430">Un émulateur fonctionne avec une facilité qui pourrait même faire pleurer. <br/> Voyez par vous-mêmes :</p><pre id="r-400431" data-claire-element-id="400431"><code data-claire-semantic="c">while(&quot;Machine Fonctionne&quot;)
{
    regarder_ce_qu_il_faut_faire();
    Le_faire();
}</code></pre><p id="r-400432" data-claire-element-id="400432">Tous les émulateurs ont la même structure de base. Le principe consiste tout simplement à regarder l'opération qu'il faut effectuer, puis l'effectuer. Cette routine sera exécutée tant que la machine − la console de jeu − est en marche.</p><div id="r-400434" data-claire-element-id="400434" data-claire-semantic="question"><p id="r-400433" data-claire-element-id="400433">Mais où est-ce qu'on va regarder ce qu'on doit faire ? <br/> Et comment va-t-on le faire ?</p></div><p id="r-400435" data-claire-element-id="400435">Patience, patience. ;)</p><h5 id="r-les-rom" data-claire-element-id="400460">Les ROM</h5><h6 id="r-definition-54" data-claire-element-id="400454">Définition</h6><p id="r-400438" data-claire-element-id="400438">Littéralement, ROM signifie « <em>Read Only Memory</em> », ou en français « mémoire à lecture seule ». C'est un support qui ne permet que la lecture des données qu'il contient. C'est le cas pour presque tous les supports de jeux vidéo.<br/> Il existe divers moyens de copier le contenu de ces supports sur votre ordinateur. Pour ce faire, on utilise des ROM Dumper. Les fichiers binaires ainsi obtenus sont communément appelés : roms.<br/> Les roms sont donc aux émulateurs ce que les cartouches de jeu − CD, DVD, etc. − sont aux consoles de jeu.</p><table id="r-400453" data-claire-element-id="400453"><thead id="r-400444" data-claire-element-id="400444"><tr id="r-400443" data-claire-element-id="400443"><th id="r-400440" data-claire-element-id="400440"><p id="r-400439" data-claire-element-id="400439">Cartouche SNES</p></th><th id="r-400442" data-claire-element-id="400442"><p id="r-400441" data-claire-element-id="400441">Cartouche Game Boy Advance</p></th></tr></thead><tbody id="r-400452" data-claire-element-id="400452"><tr id="r-400451" data-claire-element-id="400451"><td id="r-400446" data-claire-element-id="400447"><img id="r-400447" data-claire-element-id="400446" src="medias/uploads.siteduzero.com_files_318001_319000_318767.jpg" alt="Image utilisateur"/><img id="r-400445" data-claire-element-id="400445" src="medias/uploads.siteduzero.com_files_318001_319000_318767.jpg" alt="Image utilisateur"/></td><td id="r-400449" data-claire-element-id="400450"><img id="r-400450" data-claire-element-id="400449" src="medias/uploads.siteduzero.com_files_318001_319000_318768.jpg" alt="Image utilisateur"/><img id="r-400448" data-claire-element-id="400448" src="medias/uploads.siteduzero.com_files_318001_319000_318768.jpg" alt="Image utilisateur"/></td></tr></tbody></table><h6 id="r-utilite-10" data-claire-element-id="400459">Utilité</h6><p id="r-400455" data-claire-element-id="400455">Je vous ai dit plus haut que la première étape pour créer un émulateur est de regarder ce qu'il faut faire. C'est là que les roms interviennent. Elles contiennent toutes les instructions à exécuter. C'est-à-dire que par « regarder ce qu'il faut faire », il faut comprendre « lire le contenu du fichier rom ».<br/> Et comme vous le savez, lire le contenu d'un fichier binaire, ce n'est pas le diable. Je le dis et je le répète :</p><p id="r-400456" data-claire-element-id="400456"><cite>Citation : BestCoder</cite></p><blockquote id="r-400458" data-claire-element-id="400458"><p id="r-400457" data-claire-element-id="400457">Vous verrez tout au long de ce tutoriel que programmer un émulateur n'a rien d'extraordinaire.</p></blockquote><h5 id="r-les-consoles-de-jeu" data-claire-element-id="400536">Les consoles de jeu</h5><h6 id="r-definition-55" data-claire-element-id="400494">Définition</h6><p id="r-400461" data-claire-element-id="400461">Une console de jeu est un appareil électronique conçu pour permettre de lire, interpréter et afficher les informations contenues dans un support conçu à cet effet (les cartouches, CD ou DVD de jeu).<br/> Il existe deux principaux types de consoles :</p><ul id="r-400466" data-claire-element-id="400466"><li id="r-400463" data-claire-element-id="400463"><p id="r-400462" data-claire-element-id="400462">les consoles de salon, qui se branchent sur un écran pour afficher le jeu, et auxquelles on connecte accessoirement des manettes ;</p></li><li id="r-400465" data-claire-element-id="400465"><p id="r-400464" data-claire-element-id="400464">les consoles portables, de petite taille, qui possèdent leur propre écran et sont de ce fait autonomes et facilement transportables.</p></li></ul><p id="r-400467" data-claire-element-id="400467"><a href="http://fr.wikipedia.org/wiki/Émulation">Wikipédia</a></p><table id="r-400492" data-claire-element-id="400492"><thead id="r-400477" data-claire-element-id="400477"><tr id="r-400476" data-claire-element-id="400476"><th id="r-400469" data-claire-element-id="400469"><p id="r-400468" data-claire-element-id="400468">SNES</p></th><th id="r-400471" data-claire-element-id="400471"><p id="r-400470" data-claire-element-id="400470">NDS</p></th><th id="r-400473" data-claire-element-id="400473"><p id="r-400472" data-claire-element-id="400472">Game Boy</p></th><th id="r-400475" data-claire-element-id="400475"><p id="r-400474" data-claire-element-id="400474">PSP NGP</p></th></tr></thead><tbody id="r-400491" data-claire-element-id="400491"><tr id="r-400490" data-claire-element-id="400490"><td id="r-400479" data-claire-element-id="400480"><img id="r-400480" data-claire-element-id="400479" src="medias/uploads.siteduzero.com_files_318001_319000_318770.jpg" alt="Image utilisateur"/><img id="r-400478" data-claire-element-id="400478" src="medias/uploads.siteduzero.com_files_318001_319000_318770.jpg" alt="Image utilisateur"/></td><td id="r-400482" data-claire-element-id="400483"><img id="r-400483" data-claire-element-id="400482" src="medias/uploads.siteduzero.com_files_318001_319000_318771.jpg" alt="Image utilisateur"/><img id="r-400481" data-claire-element-id="400481" src="medias/uploads.siteduzero.com_files_318001_319000_318771.jpg" alt="Image utilisateur"/></td><td id="r-400485" data-claire-element-id="400486"><img id="r-400486" data-claire-element-id="400485" src="medias/uploads.siteduzero.com_files_318001_319000_318772.jpg" alt="Image utilisateur"/><img id="r-400484" data-claire-element-id="400484" src="medias/uploads.siteduzero.com_files_318001_319000_318772.jpg" alt="Image utilisateur"/></td><td id="r-400488" data-claire-element-id="400489"><img id="r-400489" data-claire-element-id="400488" src="medias/uploads.siteduzero.com_files_318001_319000_318773.jpg" alt="Image utilisateur"/><img id="r-400487" data-claire-element-id="400487" src="medias/uploads.siteduzero.com_files_318001_319000_318773.jpg" alt="Image utilisateur"/></td></tr></tbody></table><p id="r-400493" data-claire-element-id="400493">Nos éventuelles victimes !</p><h6 id="r-caracteristiques-3" data-claire-element-id="400535">Caractéristiques</h6><p id="r-400495" data-claire-element-id="400495">La définition importe peu (je sais que vous le saviez déjà), mais je veux attirer votre attention sur les caractéristiques des consoles.<br/> Toutes les consoles de jeu sont basées sur le même principe. Elles sont constituées :</p><ul id="r-400504" data-claire-element-id="400504"><li id="r-400497" data-claire-element-id="400497"><p id="r-400496" data-claire-element-id="400496">d'un microprocesseur qui effectue les calculs ;</p></li><li id="r-400499" data-claire-element-id="400499"><p id="r-400498" data-claire-element-id="400498">de mémoire vive pour stocker les données ;</p></li><li id="r-400501" data-claire-element-id="400501"><p id="r-400500" data-claire-element-id="400500">d'une carte graphique pour afficher le rendu graphique ;</p></li><li id="r-400503" data-claire-element-id="400503"><p id="r-400502" data-claire-element-id="400502">de périphériques de contrôle et le plus souvent de manettes de jeu pour interagir avec la console.</p></li></ul><p id="r-400505" data-claire-element-id="400505">Notre travail sera donc de remplacer tous ces éléments par ceux de notre ordinateur.</p><table id="r-400527" data-claire-element-id="400527"><tbody id="r-400526" data-claire-element-id="400526"><tr id="r-400510" data-claire-element-id="400510"><td id="r-400507" data-claire-element-id="400507"><p id="r-400506" data-claire-element-id="400506">microprocesseur</p></td><td id="r-400509" data-claire-element-id="400509"><p id="r-400508" data-claire-element-id="400508">processeur</p></td></tr><tr id="r-400515" data-claire-element-id="400515"><td id="r-400512" data-claire-element-id="400512"><p id="r-400511" data-claire-element-id="400511">mémoire vive</p></td><td id="r-400514" data-claire-element-id="400514"><p id="r-400513" data-claire-element-id="400513">RAM</p></td></tr><tr id="r-400520" data-claire-element-id="400520"><td id="r-400517" data-claire-element-id="400517"><p id="r-400516" data-claire-element-id="400516">carte graphique</p></td><td id="r-400519" data-claire-element-id="400519"><p id="r-400518" data-claire-element-id="400518">carte graphique</p></td></tr><tr id="r-400525" data-claire-element-id="400525"><td id="r-400522" data-claire-element-id="400522"><p id="r-400521" data-claire-element-id="400521">périphériques de contrôle</p></td><td id="r-400524" data-claire-element-id="400524"><p id="r-400523" data-claire-element-id="400523">clavier, souris, <em>joystick</em></p></td></tr></tbody></table><p id="r-400528" data-claire-element-id="400528">Ça y est, nous venons de faire le tour de l'émulation console. Vous êtes donc en mesure de programmer votre émulateur. o_O <br/> Allez !<br/> Non je blague, je ne vais pas vous abandonner si tôt. :lol: J'ai beaucoup de choses à vous dire avant de vous lâcher dans la nature.</p><p id="r-400529" data-claire-element-id="400529">Avec cette petite présentation, nous venons de voir en gros le travail que nous aurons à faire pour réaliser notre émulateur.<br/> Cette définition assez simpliste nous permet de mieux cerner la notion d'émulation et plusieurs questions doivent vous traverser l'esprit :</p><div id="r-400531" data-claire-element-id="400531" data-claire-semantic="question"><p id="r-400530" data-claire-element-id="400530">Comment doit-on s'y prendre pour remplacer les composants de la console ?</p></div><div id="r-400533" data-claire-element-id="400533" data-claire-semantic="question"><p id="r-400532" data-claire-element-id="400532">Et tant qu'on y est, est-ce que l'on a le droit de le faire ?</p></div><p id="r-400534" data-claire-element-id="400534">Pas de panique, vous serez éclairés sous peu.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console">L&#039;émulation console</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Notre premier émulateur
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/un-tour-d-horizon-1">Un tour d&#039;horizon</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
Définition de l&#039;émulation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
Les informations sur les consoles de jeu
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
Législation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">Quelle console émuler ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
Critères de sélection
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
La Chip 8
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">La base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
L&#039;implémentation de la machine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
Le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">Simulation des instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
Le cadencement du CPU et les FPS
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
Lecture de l&#039;opcode
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
Identification de l&#039;instruction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
Retour sur le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">Exemples avec quelques instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
Divers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
Le mode de dessin intégré
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
Charger un jeu
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">L&#039;interface homme-machine</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
Les entrées utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
Le son
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/a-vous-de-jouer-21">
À vous de jouer !
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/un-tour-d-horizon-1">
<span class="arrow"></span>
<span class="next">Un tour d&#039;horizon</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
<span class="next">Les informations sur les consoles de jeu</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesinformationssurlesconsolesdejeu"></a><h2>Les informations sur les consoles de jeu</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
<span class="arrow"></span>
<span class="next">Définition de l&#039;émulation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
<span class="next">Législation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-informations-sur-les-consoles-de-jeu" data-claire-element-id="400621">Les informations sur les consoles de jeu</h4><p id="r-400538" data-claire-element-id="400538">Maintenant que nous savons à peu près comment programmer notre émulateur, certains se sont rués sur leur moteur de recherche (ou pas). Bon réflexe ! Pour simuler une machine, il faut connaître ses caractéristiques au maximum pour espérer des résultats satisfaisants. Ici, « connaître » veut juste dire qu'il faut avoir sous la main des documents qui décrivent exhaustivement la machine à émuler. Si vous possédez toutes les informations qu'il vous faut, il ne restera plus qu'à traduire ces informations dans un langage de programmation, sans même les comprendre si cela vous chante. <br/> Mais la compréhension sera un atout majeur si vous ne voulez pas passer des journées à chercher un bug. Rassurez-vous, on n'y est pas encore.</p><h5 id="r-par-ou-commencer-6" data-claire-element-id="400551">Par où commencer</h5><p id="r-400539" data-claire-element-id="400539">C'est beau de dire « chercher », mais que faut-il chercher ? Si vous vous rendez sur un moteur de recherche et que vous tapez « caractéristiques de la Gameboy », vous obtiendrez des informations loin d'être suffisantes pour programmer votre émulateur.<br/> Si vous êtes malchanceux, vous verrez des liens vers des sites pour configurer des émulateurs déjà existants.</p><h6 id="r-savoir-ce-que-vous-voulez" data-claire-element-id="400542">Savoir ce que vous voulez</h6><p id="r-400540" data-claire-element-id="400540">C'est bizarre de savoir ce qu'on est censé chercher, mais c'est la vie. Imaginez-vous dans un supermarché et que vous ne savez pas ce que vous souhaitez acheter. C'est la même chose que de lancer son moteur de recherche sans savoir ce que vous cherchez.</p><p id="r-400541" data-claire-element-id="400541">Donc pour obtenir des résultats qui correspondent à vos attentes, il faut connaître un tout petit peu le jargon de l'émulation.</p><h6 id="r-prendre-le-maximum-possible" data-claire-element-id="400550">Prendre le maximum possible</h6><p id="r-400543" data-claire-element-id="400543">Si vous faites vos recherches, prenez le maximum d'informations possible : soyez « boulimiques ». Cela vous permettra de faire des comparaisons et de voir celles qui sont le plus utilisées. En outre, la plupart des documentations ne sont pas claires sur tous les points. Elles seront donc complémentaires, ce qui facilitera grandement l'implémentation de notre émulateur.</p><p id="r-400544" data-claire-element-id="400544">Jetons maintenant un coup d'œil sur quelques mots clefs pour trouver notre bonheur :</p><ul id="r-400549" data-claire-element-id="400549"><li id="r-400546" data-claire-element-id="400546"><p id="r-400545" data-claire-element-id="400545"><em>opcode</em> ;</p></li><li id="r-400548" data-claire-element-id="400548"><p id="r-400547" data-claire-element-id="400547">CPU.</p></li></ul><h5 id="r-ce-qu-il-faut-rechercher" data-claire-element-id="400579">Ce qu'il faut rechercher</h5><p id="r-400552" data-claire-element-id="400552">Dans le chapitre précédent, j'avais dit :</p><p id="r-400553" data-claire-element-id="400553"><cite>Citation : BestCoder</cite></p><blockquote id="r-400555" data-claire-element-id="400555"><p id="r-400554" data-claire-element-id="400554">C'est-à-dire que par « regarder ce qu'il faut faire », il faut comprendre « lire le contenu du fichier rom ».</p></blockquote><div id="r-400557" data-claire-element-id="400557" data-claire-semantic="question"><p id="r-400556" data-claire-element-id="400556">Comment se passe réellement cette lecture ?</p></div><p id="r-400558" data-claire-element-id="400558">Lorsque le fichier <strong>binaire</strong> est à notre disposition, on le lit en entier et on le stocke dans un tableau. Je précise quand même que cela ne se passera pas comme cela pour un DVD : on n'interprétera pas le contenu d'un seul coup mais bout par bout, étape par étape. Ces « bouts » sont appelés opcodes.<br/> Par exemple, nous pouvons avoir un fichier de 1 000 ko, mais les informations seront lues à coups de 1 ko. Chaque ko représentera notre <em>opcode</em>.</p><h6 id="r-opcode-operation-code" data-claire-element-id="400561"><em>Opcode : Operation Code</em></h6><p id="r-400559" data-claire-element-id="400559">L'<em>opcode</em> définit en quelque sorte toute action que peut effectuer une console du point de vue calcul et rendu graphique.<br/> Si vous regardez par exemple les <em>opcodes</em> de la Chip 8, vous en verrez 35. La Chip 8 ne peut donc effectuer que 35 opérations, et c'est tout. Ce sera au programmeur de voir comment faire son jeu avec 35 opérations. Il va de soi qu'une console récente aura des centaines d'<em>opcodes</em> ! o_O Eh oui, plus c'est récent, plus vous allez en baver avant d'élaborer votre émulateur.</p><p id="r-400560" data-claire-element-id="400560">Selon la console qu'on émule, les <em>opcodes</em> ne sont pas de la même taille (en bits), mais le principe d'interprétation reste le même.</p><h6 id="r-cpu-central-processing-unit" data-claire-element-id="400578">CPU : <em>Central Processing Unit</em></h6><figure id="r-400563" data-claire-element-id="400564"><img id="r-400562" data-claire-element-id="400562" src="medias/uploads.siteduzero.com_files_318001_319000_318774.jpg" alt="Image utilisateur"/></figure><div id="r-400567" data-claire-element-id="400567"><p id="r-400565" data-claire-element-id="400565">Comme son nom l'indique, le CPU gère le fonctionnement de votre console de jeu. Il effectue les différentes opérations définies par les <em>opcodes</em>.<br/> Cette exécution se fait toujours à une vitesse donnée : on parle de cadencement de la console. C'est une valeur qui est donnée en hertz (Hz). Par exemple, mon PC est cadencé à 2.0 GHz, soit 2 imes 10^9 cycles d'horloge par seconde.</p><p id="r-400566" data-claire-element-id="400566">Si vous désirez des informations portant sur la vitesse d'interprétation des <em>opcodes</em>, jetez un coup d'œil sur le CPU. <br/> Si vous avez déjà testé des émulateurs et qu'ils vont trop vite ou trop lentement, le problème vient du fait que le CPU est mal implémenté (à moins que votre PC ne soit du dixième siècle). :lol:</p></div><p id="r-400568" data-claire-element-id="400568">Il faudra toujours axer ses recherches autour de ces mots. J'utilise en priorité « <em>opcode</em> » parce que les résultats sont le plus souvent très fructueux. Mais « CPU » donne aussi des informations très complètes.</p><p id="r-400569" data-claire-element-id="400569">Preuves à l'appui, recherchez :</p><ul id="r-400576" data-claire-element-id="400576"><li id="r-400571" data-claire-element-id="400571"><p id="r-400570" data-claire-element-id="400570">« Gameboy caractéristiques » ;</p></li><li id="r-400573" data-claire-element-id="400573"><p id="r-400572" data-claire-element-id="400572">puis « Gameboy opcode » ;</p></li><li id="r-400575" data-claire-element-id="400575"><p id="r-400574" data-claire-element-id="400574">et enfin « Gameboy CPU ».</p></li></ul><p id="r-400577" data-claire-element-id="400577">Vous verrez par vous-mêmes qu'il n'y a aucune comparaison à faire. Si vous trouvez des documents avec des choses peu courantes, n'ayez pas peur, vous serez en mesure de tout déchiffrer à la fin de ce tutoriel.</p><h5 id="r-les-obstacles-lies-aux-nouvelles-consoles" data-claire-element-id="400620">Les obstacles liés aux nouvelles consoles</h5><h6 id="r-le-manque-d-informations" data-claire-element-id="400582">Le manque d'informations</h6><p id="r-400580" data-claire-element-id="400580">Un gros obstacle à la programmation d'émulateurs reste le manque d'informations concernant la machine à émuler. En effet, pour bien développer son programme, il faut réunir un maximum d'informations avant de débuter. Pour ce faire, il existe des moyens comme la rétro-ingénierie <em>(reverse engineering)</em> que l'on ne va pas aborder ici. Je ne la maîtrise d'ailleurs pas. :lol: En gros, la <a href="http://fr.wikipedia.org/wiki/Rétro-ingénierie">rétro-ingénierie</a> permet de retrouver les caractéristiques d'une machine en effectuant divers tests sur celle-ci.<br/> Pour les machines anciennes, vous trouverez votre bonheur sur le Net étant donné que d'autres auront déjà fait les investigations à votre place. Cependant, vous pourrez trouver des caractéristiques différentes pour une même machine, chaque auteur pouvant avoir une compréhension différente de son fonctionnement. Malgré ces divergences, les principales caractéristiques restent le plus souvent les mêmes dans la plupart des documentations disponibles.</p><p id="r-400581" data-claire-element-id="400581">Maintenant, pour les machines récentes, le problème est tout autre. Vous pourrez obtenir des résultats, mais il n'y aura sûrement pas assez d'informations pour créer votre émulateur. Des séances de tâtonnement ne seront pas à exclure, ce qui rendra le travail particulièrement difficile. À moins que vous ne fassiez le <em>reverse engineering</em> vous-mêmes. :-°</p><h6 id="r-des-consoles-de-plus-en-plus-performantes" data-claire-element-id="400619">Des consoles de plus en plus performantes</h6><p id="r-400583" data-claire-element-id="400583">Mis à part la récupération des informations essentielles, il existe un plus gros obstacle devant vous : l'évolution des consoles.<br/> Faisons une petite comparaison :</p><table id="r-400614" data-claire-element-id="400614"><thead id="r-400591" data-claire-element-id="400591"><tr id="r-400590" data-claire-element-id="400590"><th id="r-400585" data-claire-element-id="400585"><p id="r-400584" data-claire-element-id="400584">Caractéristique</p></th><th id="r-400587" data-claire-element-id="400587"><p id="r-400586" data-claire-element-id="400586">Game Boy</p></th><th id="r-400589" data-claire-element-id="400589"><p id="r-400588" data-claire-element-id="400588">PSP</p></th></tr></thead><tbody id="r-400613" data-claire-element-id="400613"><tr id="r-400598" data-claire-element-id="400598"><td id="r-400593" data-claire-element-id="400593"><p id="r-400592" data-claire-element-id="400592">Cadence</p></td><td id="r-400595" data-claire-element-id="400595"><p id="r-400594" data-claire-element-id="400594">2,2 Mhz</p></td><td id="r-400597" data-claire-element-id="400597"><p id="r-400596" data-claire-element-id="400596">333 Mhz</p></td></tr><tr id="r-400605" data-claire-element-id="400605"><td id="r-400600" data-claire-element-id="400600"><p id="r-400599" data-claire-element-id="400599">Résolution</p></td><td id="r-400602" data-claire-element-id="400602"><p id="r-400601" data-claire-element-id="400601">160 × 144 pixels</p></td><td id="r-400604" data-claire-element-id="400604"><p id="r-400603" data-claire-element-id="400603">480 × 272 pixels</p></td></tr><tr id="r-400612" data-claire-element-id="400612"><td id="r-400607" data-claire-element-id="400607"><p id="r-400606" data-claire-element-id="400606">Couleur</p></td><td id="r-400609" data-claire-element-id="400609"><p id="r-400608" data-claire-element-id="400608">14 nuances de gris</p></td><td id="r-400611" data-claire-element-id="400611"><p id="r-400610" data-claire-element-id="400610">16,77 millions de couleurs</p></td></tr></tbody></table><p id="r-400615" data-claire-element-id="400615">Ces chiffres parlent d'eux-mêmes : les nouvelles consoles sont de plus en plus puissantes. Donc, pour que votre émulateur ne tourne pas à deux à l'heure, il faudra une machine très, <strong>très</strong> puissante. Je doute même que l'émulation puisse suivre l'évolution fulgurante des consoles de jeu (avis personnel) : la XBOX 360 et la PS3 sont déjà cadencées à 3,2 GHz (plus que mon ordinateur à 2 GHz).</p><p id="r-400616" data-claire-element-id="400616">En plus de cela, l'organisation de ces consoles est tellement complexe qu'il est très difficile de tout implémenter en solo. Mais avec tout ce qu'il existe comme consoles à émuler, je vous assure qu'une vie entière ne suffirait pas. Jetez un coup d'œil <a href="http://fr.wikipedia.org/wiki/Liste_de_consoles_de_jeux_vidéo">ici</a> pour en avoir le cœur net.</p><p id="r-400617" data-claire-element-id="400617">Voilà, nous savons maintenant ce qu'il faudra rechercher comme documentation autour des consoles de jeu pour les émuler toutes une par une.</p><p id="r-400618" data-claire-element-id="400618">À votre moteur de recherche ; prêts ? Partez !</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console">L&#039;émulation console</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Notre premier émulateur
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/un-tour-d-horizon-1">Un tour d&#039;horizon</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
Définition de l&#039;émulation
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
Les informations sur les consoles de jeu
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
Législation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">Quelle console émuler ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
Critères de sélection
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
La Chip 8
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">La base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
L&#039;implémentation de la machine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
Le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">Simulation des instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
Le cadencement du CPU et les FPS
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
Lecture de l&#039;opcode
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
Identification de l&#039;instruction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
Retour sur le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">Exemples avec quelques instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
Divers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
Le mode de dessin intégré
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
Charger un jeu
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">L&#039;interface homme-machine</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
Les entrées utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
Le son
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/a-vous-de-jouer-21">
À vous de jouer !
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
<span class="arrow"></span>
<span class="next">Définition de l&#039;émulation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
<span class="next">Législation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lgislation"></a><h2>Législation</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
<span class="arrow"></span>
<span class="next">Les informations sur les consoles de jeu</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">
<span class="next">Quelle console émuler ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-legislation" data-claire-element-id="400660">Législation</h4><figure id="r-400623" data-claire-element-id="400624"><img id="r-400622" data-claire-element-id="400622" src="medias/uploads.siteduzero.com_files_318001_319000_318776.png" alt="Image utilisateur"/></figure><p id="r-400625" data-claire-element-id="400625">Est-ce que vous avez déjà vu un domaine dans lequel les juristes ne sont pas impliqués ? Bien qu'il n'existe pas encore, à ma connaissance, de lois spécifiques à l'émulation, il en existe qui défendent le droit d'auteur et la propriété intellectuelle.<br/> Les consoles de jeu sont toutes sous licences propriétaires et sources de revenus. Le marché est très lucratif et ne cesse de s'étendre. Dès lors, créer un outil gratuit pour les substituer peut susciter des débats.</p><div id="r-400627" data-claire-element-id="400627" data-claire-semantic="question"><p id="r-400626" data-claire-element-id="400626">A-t-on réellement le droit de créer un émulateur console ?</p></div><h5 id="r-les-obstacles" data-claire-element-id="400640">Les obstacles</h5><p id="r-400628" data-claire-element-id="400628">L'un des plus gros problèmes pour l'émulation est sans doute le respect du droit d'auteur (<em>copyright</em>). En plus de ne divulguer aucune information sur les caractéristiques techniques de leurs consoles, les constructeurs les protègent jalousement. Ainsi, avec les licences utilisées, il est formellement interdit de prendre ou d'utiliser une partie ou la totalité de leur travail.<br/> D'ailleurs, les discussions sur la légalité de l'émulation font couler beaucoup d'encre.</p><figure id="r-400630" data-claire-element-id="400631"><img id="r-400629" data-claire-element-id="400629" src="medias/uploads.siteduzero.com_files_318001_319000_318777.jpg" alt="Image utilisateur"/></figure><p id="r-400632" data-claire-element-id="400632">Nous pouvons cependant retenir que la programmation d'un émulateur <strong>est totalement légale</strong> tant qu'on <strong>ne fait pas usage de ressources sous droits d'auteur</strong> (le BIOS, par exemple).</p><p id="r-400633" data-claire-element-id="400633">Ce genre de symboles vous est sûrement familier, ils sont présents sur presque tous les jeux vidéo pour signifier qu'ils sont sous droits d'auteur.</p><p id="r-400634" data-claire-element-id="400634">Tout au long de ce tutoriel, nous ferons du HLE (<em>High Level Emulation</em>), c'est-à-dire que nous programmerons tout ce dont nous aurons besoin.</p><aside id="r-400636" data-claire-element-id="400636" data-claire-semantic="information"><p id="r-400635" data-claire-element-id="400635">En résumé, votre émulateur restera légal tant que vous le développez avec vos propres ressources et que vous le redistribuez sans aucun jeu sous droits d'auteur.</p></aside><p id="r-400637" data-claire-element-id="400637">Cependant, l'utilisation d'un émulateur nécessite des jeux ou roms qui sont le plus souvent difficiles d'accès et non libres d'utilisation. (Sinon : illégalité. :euh: )</p><div id="r-400639" data-claire-element-id="400639" data-claire-semantic="question"><p id="r-400638" data-claire-element-id="400638">Mais donc, ça sert à quoi de programmer un émulateur si on ne peut pas l'utiliser ?</p></div><h5 id="r-une-lueur-d-espoir" data-claire-element-id="400659">Une lueur d'espoir</h5><p id="r-400641" data-claire-element-id="400641">Après ce que l'on vient de voir, il est légitime de se poser cette question. Mais il existe toujours des exceptions à toute règle. :magicien: <br/> Certains jeux (notamment ceux que nous allons utiliser) sont dans le domaine public et sont dès lors libres d'utilisation et de redistribution.<br/> En plus de cela, vous êtes autorisés à posséder une rom à condition d'être en possession du jeu original, cette rom étant considérée comme une sauvegarde.</p><p id="r-400642" data-claire-element-id="400642">À défaut de tout cela, vous pourrez utiliser un <em>homebrew</em>. Un <em>homebrew</em> est un jeu de console créé par un amateur et ces jeux sont le plus souvent libres. Pour éviter de faire un cours de droit ici, je vous laisse creuser si cela vous chante.<br/> Pour de plus amples explications ou preuves, vous pouvez consulter :</p><ul id="r-400649" data-claire-element-id="400649"><li id="r-400644" data-claire-element-id="400644"><p id="r-400643" data-claire-element-id="400643"><a href="http://fr.wikipedia.org/wiki/Émulation">Wikipédia : Émulation</a> ;</p></li><li id="r-400646" data-claire-element-id="400646"><p id="r-400645" data-claire-element-id="400645"><a href="http://fr.wikipedia.org/wiki/Domaine_public_en_droit_de_la_propriété_intellectuelle_français">Wikipédia : Propriété intellectuelle</a> ;</p></li><li id="r-400648" data-claire-element-id="400648"><p id="r-400647" data-claire-element-id="400647">et pour les plus téméraires, <a href="http://www.legifrance.gouv.fr/affichTexte.do?cidTexte=LEGITEXT000006055121&amp;dateTexte=20110206">Legifrance</a>.</p></li></ul><aside id="r-400651" data-claire-element-id="400651" data-claire-semantic="information"><p id="r-400650" data-claire-element-id="400650">Il existe des jeux avec des mentions « Non utilisable en dehors du support d'origine », donc attention !</p></aside><p id="r-400652" data-claire-element-id="400652">Une dernière chose, je vous laisse le fameux :</p><aside id="r-400654" data-claire-element-id="400654" data-claire-semantic="error"><p id="r-400653" data-claire-element-id="400653">Je, BestCoder, décline toute responsabilité sur des agissements qui pourraient survenir à la suite de la lecture de ce tutoriel.<br/> BestCoder ne pourrait être tenu responsable sur aucun plan et ce en aucun cas. :zorro:</p></aside><p id="r-400655" data-claire-element-id="400655">Je vous invite à accorder une grande importance à la législation pour éviter des ennuis inutiles.<br/> Après ce long discours, j'espère que vous avez bien cerné le sujet et que votre curiosité a été bien assouvie. À présent, nous allons voir ce qu'il nous faut comme bagage pour nous lancer dans notre périlleuse aventure.</p><p id="r-400656" data-claire-element-id="400656">Nous voilà fin prêts et <strong>avertis</strong> pour nous lancer dans notre aventure. Puisque nous savons à la fois ce que nous voulons et comment l'obtenir, la moitié du travail est déjà effectué, il ne reste plus qu'à passer à l'action.</p><aside id="r-400658" data-claire-element-id="400658" data-claire-semantic="warning"><p id="r-400657" data-claire-element-id="400657">Je signale qu'il faut une certaine maîtrise de l'hexadécimal, du binaire et des opérations logiques pour suivre ce tutoriel sans trop de difficultés.</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console">L&#039;émulation console</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Notre premier émulateur
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/un-tour-d-horizon-1">Un tour d&#039;horizon</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
Définition de l&#039;émulation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
Les informations sur les consoles de jeu
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
Législation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">Quelle console émuler ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
Critères de sélection
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
La Chip 8
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">La base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
L&#039;implémentation de la machine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
Le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">Simulation des instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
Le cadencement du CPU et les FPS
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
Lecture de l&#039;opcode
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
Identification de l&#039;instruction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
Retour sur le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">Exemples avec quelques instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
Divers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
Le mode de dessin intégré
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
Charger un jeu
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">L&#039;interface homme-machine</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
Les entrées utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
Le son
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/a-vous-de-jouer-21">
À vous de jouer !
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
<span class="arrow"></span>
<span class="next">Les informations sur les consoles de jeu</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">
<span class="next">Quelle console émuler ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Quelleconsolemuler"></a><h2>Quelle console émuler ?</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
<span class="arrow"></span>
<span class="next">Législation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
<span class="next">Critères de sélection</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-400662" data-claire-element-id="400662">Pour construire un gratte-ciel, il faut des fondations solides. Nous aussi, pour faire des prouesses en émulation, nous allons débuter par des choses simples.<br/> Ça ne sert à rien d'attaquer la NDS ou la PSP NGP en premier, vous allez vous casser les dents et détester l'émulation à jamais. :D <br/> Nous allons donc progresser lentement mais sûrement.</p>
</div><a name="Critresdeslection"></a><h2>Critères de sélection</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">
<span class="arrow"></span>
<span class="next">Quelle console émuler ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
<span class="next">La Chip 8</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-criteres-de-selection" data-claire-element-id="400670">Critères de sélection</h4><p id="r-400663" data-claire-element-id="400663">Dans tous les domaines où l'on évolue, il est toujours préférable de procéder du plus facile au plus compliqué. Pour l'émulation, cette règle reste valable et la « machine » qui me paraît la plus appropriée est la Chip 8.</p><p id="r-400664" data-claire-element-id="400664">En effet, avec un faible nombre d'instructions (35 pour être plus précis) et un rendu graphique de 64 × 32 pixels en noir et blanc, la Chip 8 est l'un des meilleurs supports pour débuter en émulation.<br/> En plus de sa facilité d'implémentation, un bon nombre de jeux Chip 8 sont dans le domaine public, ce qui limite (supprime même) les problèmes liés à la légalité.</p><div id="r-400666" data-claire-element-id="400666" data-claire-semantic="question"><p id="r-400665" data-claire-element-id="400665">Mais c'est quoi la Chip 8 en réalité ?</p></div><div id="r-400668" data-claire-element-id="400668" data-claire-semantic="question"><p id="r-400667" data-claire-element-id="400667">Pourquoi as-tu mis « machine » entre guillemets ?</p></div><p id="r-400669" data-claire-element-id="400669">Vous serez éclairés sous peu.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console">L&#039;émulation console</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Notre premier émulateur
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/un-tour-d-horizon-1">Un tour d&#039;horizon</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
Définition de l&#039;émulation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
Les informations sur les consoles de jeu
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
Législation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">Quelle console émuler ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
Critères de sélection
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
La Chip 8
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">La base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
L&#039;implémentation de la machine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
Le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">Simulation des instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
Le cadencement du CPU et les FPS
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
Lecture de l&#039;opcode
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
Identification de l&#039;instruction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
Retour sur le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">Exemples avec quelques instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
Divers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
Le mode de dessin intégré
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
Charger un jeu
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">L&#039;interface homme-machine</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
Les entrées utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
Le son
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/a-vous-de-jouer-21">
À vous de jouer !
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">
<span class="arrow"></span>
<span class="next">Quelle console émuler ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
<span class="next">La Chip 8</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="LaChip8"></a><h2>La Chip 8</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
<span class="arrow"></span>
<span class="next">Critères de sélection</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">
<span class="next">La base</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-la-chip-8" data-claire-element-id="400902">La Chip 8</h4><h5 id="r-definition-56" data-claire-element-id="400676">Définition</h5><figure id="r-400672" data-claire-element-id="400673"><img id="r-400671" data-claire-element-id="400671" src="medias/uploads.siteduzero.com_files_310001_311000_310963.jpg" alt="Image utilisateur"/></figure><p id="r-400674" data-claire-element-id="400674">La Chip 8 est en réalité un langage interprété qui a été utilisé sur le RCA TELMAC-1800 et le COSMAC VIP en 1977. Elle est constituée d'un ensemble d'instructions qui permettent une programmation facile pour lesdites machines.</p><p id="r-400675" data-claire-element-id="400675">Remodelée, la Chip 8 fut utilisée plus tard pour créer des calculatrices graphiques. D'ailleurs, plusieurs jeux ont été développés pour ce système et on ne manquera pas d'en discuter plus tard.</p><h5 id="r-caracteristiques-de-la-chip-8" data-claire-element-id="400887">Caractéristiques de la Chip 8</h5><p id="r-400677" data-claire-element-id="400677">Voici les principales caractéristiques de la Chip 8. Le document est une traduction de la <a href="http://en.wikipedia.org/wiki/CHIP-8">présentation de Wikipédia</a>.</p><h6 id="r-la-memoire-3" data-claire-element-id="400679">La mémoire</h6><p id="r-400678" data-claire-element-id="400678">Les adresses mémoire de la Chip 8 vont de $200 à $FFF (l'hexadécimal revient), faisant ainsi 3 584 octets. La raison pour laquelle la mémoire commence à partir de $200 est que sur le VIP et Cosmac Telmac 1800, les 512 premiers octets sont réservés pour l'interpréteur. Sur ces machines, les 256 octets les plus élevés ($F00-$FFF sur une machine 4K) ont été réservés pour le rafraîchissement de l'écran, et les 96 octets inférieurs ($EA0-$EFF) ont été réservés pour la pile d'appels, à usage interne, et les variables.</p><h6 id="r-les-registres-1" data-claire-element-id="400681">Les registres</h6><p id="r-400680" data-claire-element-id="400680">La Chip 8 comporte 16 registres de 8 bits dont les noms vont de V0 à VF (F = 15, encore l'hexadécimal). Le registre VF est utilisé pour toutes les retenues lors des calculs.<br/> En plus de ces 16 registres, nous avons le registre d'adresse, nommé I, qui est de 16 bits et qui est utilisé avec plusieurs <em>opcodes</em> qui impliquent des opérations de mémoire.</p><h6 id="r-la-pile-2" data-claire-element-id="400683">La pile</h6><p id="r-400682" data-claire-element-id="400682">La pile sert uniquement à stocker des adresses de retour lorsque les sous-programmes sont appelés. Les implémentations modernes doivent normalement avoir au moins 16 niveaux.</p><h6 id="r-les-compteurs-1" data-claire-element-id="400686">Les compteurs</h6><p id="r-400684" data-claire-element-id="400684">La Chip 8 est composée deux compteurs. Ils décomptent tous les deux à 60 hertz, jusqu'à ce qu'ils atteignent 0.</p><p id="r-400685" data-claire-element-id="400685"><strong>Minuterie système</strong> : cette minuterie est destinée à la synchronisation des événements de jeux. Sa valeur peut être réglée et lue.<br/><strong>Minuterie sonore</strong> : cette minuterie est utilisée pour les effets sonores. Lorsque sa valeur est différente de zéro, un signal sonore est émis. Sa valeur peut être réglée et lue.</p><h6 id="r-les-controles-4" data-claire-element-id="400688">Les contrôles</h6><p id="r-400687" data-claire-element-id="400687">L'entrée est faite avec un clavier qui possède 16 touches allant de 0 à F. Les touches « 8 », « 4 », « 6 » et « 2 » sont généralement utilisées pour l'entrée directionnelle.</p><h6 id="r-le-graphique-2" data-claire-element-id="400690">Le graphique</h6><p id="r-400689" data-claire-element-id="400689">La résolution de l'écran est de 64 × 32 pixels, et la couleur est monochrome. Les dessins sont établis à l'écran uniquement par l'intermédiaire de <em>sprites</em>, qui font 8 pixels de large et avec une hauteur qui peut varier de 1 à 15 pixels. Les <em>sprites</em> sont codés en binaire. Pour une valeur de 1, le pixel correspondant est allumé et pour une valeur 0, aucune opération n'est effectuée. Si un pixel d'un <em>sprite</em> est dessiné sur un pixel de l'écran déjà allumé, alors les deux pixels sont éteints. Le registre de retenue (VF) est mis à 1 à cet effet.</p><h6 id="r-liste-des-instructions" data-claire-element-id="400886">Liste des instructions</h6><p id="r-400691" data-claire-element-id="400691">La Chip 8 possède 35 <em>opcodes</em>, qui sont tous de deux octets de long.<br/> Ils sont énumérés ci-dessous, en hexadécimal et avec les symboles suivants :</p><ul id="r-400700" data-claire-element-id="400700"><li id="r-400693" data-claire-element-id="400693"><p id="r-400692" data-claire-element-id="400692">NNN : adresse de 12 bits ;</p></li><li id="r-400695" data-claire-element-id="400695"><p id="r-400694" data-claire-element-id="400694">NN : constante de 8 bits ;</p></li><li id="r-400697" data-claire-element-id="400697"><p id="r-400696" data-claire-element-id="400696">N : constante de 4 bits ;</p></li><li id="r-400699" data-claire-element-id="400699"><p id="r-400698" data-claire-element-id="400698">X et Y : identifiant registre de 4 bits.</p></li></ul><aside id="r-400702" data-claire-element-id="400702" data-claire-semantic="information"><p id="r-400701" data-claire-element-id="400701"><strong>Rappel</strong> : un <em>opcode</em> est la valeur lue à partir de la mémoire.</p></aside><table id="r-400885" data-claire-element-id="400885"><thead id="r-400708" data-claire-element-id="400708"><tr id="r-400707" data-claire-element-id="400707"><th id="r-400704" data-claire-element-id="400704"><p id="r-400703" data-claire-element-id="400703"><em>Opcode</em></p></th><th id="r-400706" data-claire-element-id="400706"><p id="r-400705" data-claire-element-id="400705">Explication, description</p></th></tr></thead><tbody id="r-400884" data-claire-element-id="400884"><tr id="r-400713" data-claire-element-id="400713"><td id="r-400710" data-claire-element-id="400710"><p id="r-400709" data-claire-element-id="400709">0NNN</p></td><td id="r-400712" data-claire-element-id="400712"><p id="r-400711" data-claire-element-id="400711">Appelle le programme de la RCA 1802 à l'adresse NNN. (Voir plus bas.)</p></td></tr><tr id="r-400718" data-claire-element-id="400718"><td id="r-400715" data-claire-element-id="400715"><p id="r-400714" data-claire-element-id="400714">00E0</p></td><td id="r-400717" data-claire-element-id="400717"><p id="r-400716" data-claire-element-id="400716">Efface l'écran.</p></td></tr><tr id="r-400723" data-claire-element-id="400723"><td id="r-400720" data-claire-element-id="400720"><p id="r-400719" data-claire-element-id="400719">00EE</p></td><td id="r-400722" data-claire-element-id="400722"><p id="r-400721" data-claire-element-id="400721">Retourne à partir d'une sous-fonction.</p></td></tr><tr id="r-400728" data-claire-element-id="400728"><td id="r-400725" data-claire-element-id="400725"><p id="r-400724" data-claire-element-id="400724">1NNN</p></td><td id="r-400727" data-claire-element-id="400727"><p id="r-400726" data-claire-element-id="400726">Effectue un saut à l'adresse NNN.</p></td></tr><tr id="r-400733" data-claire-element-id="400733"><td id="r-400730" data-claire-element-id="400730"><p id="r-400729" data-claire-element-id="400729">2NNN</p></td><td id="r-400732" data-claire-element-id="400732"><p id="r-400731" data-claire-element-id="400731">Exécute le sous-programme à l'adresse NNN.</p></td></tr><tr id="r-400738" data-claire-element-id="400738"><td id="r-400735" data-claire-element-id="400735"><p id="r-400734" data-claire-element-id="400734">3XNN</p></td><td id="r-400737" data-claire-element-id="400737"><p id="r-400736" data-claire-element-id="400736">Saute l'instruction suivante si VX est égal à NN.</p></td></tr><tr id="r-400743" data-claire-element-id="400743"><td id="r-400740" data-claire-element-id="400740"><p id="r-400739" data-claire-element-id="400739">4XNN</p></td><td id="r-400742" data-claire-element-id="400742"><p id="r-400741" data-claire-element-id="400741">Saute l'instruction suivante si VX et NN ne sont pas égaux.</p></td></tr><tr id="r-400748" data-claire-element-id="400748"><td id="r-400745" data-claire-element-id="400745"><p id="r-400744" data-claire-element-id="400744">5XY0</p></td><td id="r-400747" data-claire-element-id="400747"><p id="r-400746" data-claire-element-id="400746">Saute l'instruction suivante si VX et VY sont égaux.</p></td></tr><tr id="r-400753" data-claire-element-id="400753"><td id="r-400750" data-claire-element-id="400750"><p id="r-400749" data-claire-element-id="400749">6XNN</p></td><td id="r-400752" data-claire-element-id="400752"><p id="r-400751" data-claire-element-id="400751">Définit VX à NN.</p></td></tr><tr id="r-400758" data-claire-element-id="400758"><td id="r-400755" data-claire-element-id="400755"><p id="r-400754" data-claire-element-id="400754">7XNN</p></td><td id="r-400757" data-claire-element-id="400757"><p id="r-400756" data-claire-element-id="400756">Ajoute NN à VX.</p></td></tr><tr id="r-400763" data-claire-element-id="400763"><td id="r-400760" data-claire-element-id="400760"><p id="r-400759" data-claire-element-id="400759">8XY0</p></td><td id="r-400762" data-claire-element-id="400762"><p id="r-400761" data-claire-element-id="400761">Définit VX à la valeur de VY.</p></td></tr><tr id="r-400768" data-claire-element-id="400768"><td id="r-400765" data-claire-element-id="400765"><p id="r-400764" data-claire-element-id="400764">8XY1</p></td><td id="r-400767" data-claire-element-id="400767"><p id="r-400766" data-claire-element-id="400766">Définit VX à VX OR VY.</p></td></tr><tr id="r-400773" data-claire-element-id="400773"><td id="r-400770" data-claire-element-id="400770"><p id="r-400769" data-claire-element-id="400769">8XY2</p></td><td id="r-400772" data-claire-element-id="400772"><p id="r-400771" data-claire-element-id="400771">Définit VX à VX AND VY.</p></td></tr><tr id="r-400778" data-claire-element-id="400778"><td id="r-400775" data-claire-element-id="400775"><p id="r-400774" data-claire-element-id="400774">8XY3</p></td><td id="r-400777" data-claire-element-id="400777"><p id="r-400776" data-claire-element-id="400776">Définit VX à VX XOR VY.</p></td></tr><tr id="r-400783" data-claire-element-id="400783"><td id="r-400780" data-claire-element-id="400780"><p id="r-400779" data-claire-element-id="400779">8XY4</p></td><td id="r-400782" data-claire-element-id="400782"><p id="r-400781" data-claire-element-id="400781">Ajoute VY à VX. VF est mis à 1 quand il y a un dépassement de mémoire <em>(carry)</em>, à 0 quand il n'y en a pas.</p></td></tr><tr id="r-400788" data-claire-element-id="400788"><td id="r-400785" data-claire-element-id="400785"><p id="r-400784" data-claire-element-id="400784">8XY5</p></td><td id="r-400787" data-claire-element-id="400787"><p id="r-400786" data-claire-element-id="400786">VY est soustrait de VX. VF est mis à 0 quand il y a un emprunt et à 1 quand il n'y en a pas.</p></td></tr><tr id="r-400793" data-claire-element-id="400793"><td id="r-400790" data-claire-element-id="400790"><p id="r-400789" data-claire-element-id="400789">8XY6</p></td><td id="r-400792" data-claire-element-id="400792"><p id="r-400791" data-claire-element-id="400791">Décale <em>(shift)</em> VX à droite de 1 bit. VF est fixé à la valeur du bit de poids faible de VX avant le décalage.</p></td></tr><tr id="r-400798" data-claire-element-id="400798"><td id="r-400795" data-claire-element-id="400795"><p id="r-400794" data-claire-element-id="400794">8XY7</p></td><td id="r-400797" data-claire-element-id="400797"><p id="r-400796" data-claire-element-id="400796">VX = VY - VX, VF est mis à 0 quand il y a un emprunt, et à 1 quand il n'y en a pas.</p></td></tr><tr id="r-400803" data-claire-element-id="400803"><td id="r-400800" data-claire-element-id="400800"><p id="r-400799" data-claire-element-id="400799">8XYE</p></td><td id="r-400802" data-claire-element-id="400802"><p id="r-400801" data-claire-element-id="400801">Décale <em>(shift)</em> VX à gauche de 1 bit. VF est fixé à la valeur du bit de poids fort de VX avant le décalage.</p></td></tr><tr id="r-400808" data-claire-element-id="400808"><td id="r-400805" data-claire-element-id="400805"><p id="r-400804" data-claire-element-id="400804">9XY0</p></td><td id="r-400807" data-claire-element-id="400807"><p id="r-400806" data-claire-element-id="400806">Saute l'instruction suivante si VX et VY ne sont pas égaux.</p></td></tr><tr id="r-400813" data-claire-element-id="400813"><td id="r-400810" data-claire-element-id="400810"><p id="r-400809" data-claire-element-id="400809">ANNN</p></td><td id="r-400812" data-claire-element-id="400812"><p id="r-400811" data-claire-element-id="400811">Affecte NNN à I.</p></td></tr><tr id="r-400818" data-claire-element-id="400818"><td id="r-400815" data-claire-element-id="400815"><p id="r-400814" data-claire-element-id="400814">BNNN</p></td><td id="r-400817" data-claire-element-id="400817"><p id="r-400816" data-claire-element-id="400816">Passe à l'adresse NNN + V0.</p></td></tr><tr id="r-400823" data-claire-element-id="400823"><td id="r-400820" data-claire-element-id="400820"><p id="r-400819" data-claire-element-id="400819">CXNN</p></td><td id="r-400822" data-claire-element-id="400822"><p id="r-400821" data-claire-element-id="400821">Définit VX à un nombre aléatoire inférieur à NN.</p></td></tr><tr id="r-400828" data-claire-element-id="400828"><td id="r-400825" data-claire-element-id="400825"><p id="r-400824" data-claire-element-id="400824">DXYN</p></td><td id="r-400827" data-claire-element-id="400827"><p id="r-400826" data-claire-element-id="400826">Dessine un <em>sprite</em> aux coordonnées (VX, VY).<br/> Le <em>sprite</em> a une largeur de 8 pixels et une hauteur en pixels N. <br/> Chaque rangée de 8 pixels est lue comme codée en binaire à partir de l'emplacement mémoire I.<br/> I ne change pas de valeur après l'exécution de cette instruction.</p></td></tr><tr id="r-400833" data-claire-element-id="400833"><td id="r-400830" data-claire-element-id="400830"><p id="r-400829" data-claire-element-id="400829">EX9E</p></td><td id="r-400832" data-claire-element-id="400832"><p id="r-400831" data-claire-element-id="400831">Saute l'instruction suivante si la clé stockée dans VX est pressée.</p></td></tr><tr id="r-400838" data-claire-element-id="400838"><td id="r-400835" data-claire-element-id="400835"><p id="r-400834" data-claire-element-id="400834">EXA1</p></td><td id="r-400837" data-claire-element-id="400837"><p id="r-400836" data-claire-element-id="400836">Saute l'instruction suivante si la clé stockée dans VX n'est pas pressée.</p></td></tr><tr id="r-400843" data-claire-element-id="400843"><td id="r-400840" data-claire-element-id="400840"><p id="r-400839" data-claire-element-id="400839">FX07</p></td><td id="r-400842" data-claire-element-id="400842"><p id="r-400841" data-claire-element-id="400841">Définit VX à la valeur de la temporisation.</p></td></tr><tr id="r-400848" data-claire-element-id="400848"><td id="r-400845" data-claire-element-id="400845"><p id="r-400844" data-claire-element-id="400844">FX0A</p></td><td id="r-400847" data-claire-element-id="400847"><p id="r-400846" data-claire-element-id="400846">L'appui sur une touche est attendu, puis stocké dans VX.</p></td></tr><tr id="r-400853" data-claire-element-id="400853"><td id="r-400850" data-claire-element-id="400850"><p id="r-400849" data-claire-element-id="400849">FX15</p></td><td id="r-400852" data-claire-element-id="400852"><p id="r-400851" data-claire-element-id="400851">Définit la temporisation à VX.</p></td></tr><tr id="r-400858" data-claire-element-id="400858"><td id="r-400855" data-claire-element-id="400855"><p id="r-400854" data-claire-element-id="400854">FX18</p></td><td id="r-400857" data-claire-element-id="400857"><p id="r-400856" data-claire-element-id="400856">Définit la minuterie sonore à VX.</p></td></tr><tr id="r-400863" data-claire-element-id="400863"><td id="r-400860" data-claire-element-id="400860"><p id="r-400859" data-claire-element-id="400859">FX1E</p></td><td id="r-400862" data-claire-element-id="400862"><p id="r-400861" data-claire-element-id="400861">Ajoute VX à I. VF est mis à 1 quand il y a <em>overflow</em> (I+VX&gt;0xFFF), et à 0 si ce n'est pas le cas.</p></td></tr><tr id="r-400868" data-claire-element-id="400868"><td id="r-400865" data-claire-element-id="400865"><p id="r-400864" data-claire-element-id="400864">FX29</p></td><td id="r-400867" data-claire-element-id="400867"><p id="r-400866" data-claire-element-id="400866">Définit I à l'emplacement du caractère stocké dans VX. Les caractères 0-F (en hexadécimal) sont représentés par une police 4x5.</p></td></tr><tr id="r-400873" data-claire-element-id="400873"><td id="r-400870" data-claire-element-id="400870"><p id="r-400869" data-claire-element-id="400869">FX33</p></td><td id="r-400872" data-claire-element-id="400872"><p id="r-400871" data-claire-element-id="400871">Stocke dans la mémoire le code décimal représentant VX (dans I, I+1, I+2).</p></td></tr><tr id="r-400878" data-claire-element-id="400878"><td id="r-400875" data-claire-element-id="400875"><p id="r-400874" data-claire-element-id="400874">FX55</p></td><td id="r-400877" data-claire-element-id="400877"><p id="r-400876" data-claire-element-id="400876">Stocke V0 à VX en mémoire à partir de l'adresse I.</p></td></tr><tr id="r-400883" data-claire-element-id="400883"><td id="r-400880" data-claire-element-id="400880"><p id="r-400879" data-claire-element-id="400879">FX65</p></td><td id="r-400882" data-claire-element-id="400882"><p id="r-400881" data-claire-element-id="400881">Remplit V0 à VX avec les valeurs de la mémoire à partir de l'adresse I.</p></td></tr></tbody></table><h5 id="r-la-rca-1802" data-claire-element-id="400901">La RCA 1802</h5><table id="r-400894" data-claire-element-id="400894"><tbody id="r-400893" data-claire-element-id="400893"><tr id="r-400892" data-claire-element-id="400892"><td id="r-400889" data-claire-element-id="400889"><p id="r-400888" data-claire-element-id="400888">0NNN</p></td><td id="r-400891" data-claire-element-id="400891"><p id="r-400890" data-claire-element-id="400890">Appelle le programme de la RCA 1802 à l'adresse NNN.</p></td></tr></tbody></table><p id="r-400895" data-claire-element-id="400895">Cette instruction ne nous intéresse pas. En réalité, la RCA 1802 est un microprocesseur 8 bits qui a été utilisé dans certains micro-ordinateurs et consoles de jeu tels que la RCA Studio II. Ce microprocesseur possédait un jeu d'instructions intégrées que les nouvelles implémentations ignorent. Nous allons donc faire de même. :-°</p><div id="r-400897" data-claire-element-id="400897" data-claire-semantic="question"><p id="r-400896" data-claire-element-id="400896">Mais ça m'avance à quoi, tous ces détails ?</p></div><p id="r-400898" data-claire-element-id="400898">Ne paniquez pas si cette description ne vous éclaire pas, nous allons expliquer ligne par ligne tout ce qui a été dit ci-dessus.<br/> C'est grâce à ce document que nous allons programmer notre émulateur ; nous allons le traduire en langage machine. ;) <br/> Vous pouvez lancer votre IDE, et que la programmation commence !</p><aside id="r-400900" data-claire-element-id="400900" data-claire-semantic="information"><p id="r-400899" data-claire-element-id="400899">Pour créer l'émulateur, je donne des explications par rapport à une citation dans la présentation de la Chip 8 puis le code C/SDL pour le réaliser. Je vous conseille donc d'essayer avec les explications de créer votre propre code pour mieux comprendre. Vous pourrez éventuellement jeter un coup d'œil sur le code proposé pour vous faire une idée plus précise.</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console">L&#039;émulation console</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Notre premier émulateur
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/un-tour-d-horizon-1">Un tour d&#039;horizon</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
Définition de l&#039;émulation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
Les informations sur les consoles de jeu
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
Législation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">Quelle console émuler ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
Critères de sélection
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
La Chip 8
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">La base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
L&#039;implémentation de la machine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
Le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">Simulation des instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
Le cadencement du CPU et les FPS
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
Lecture de l&#039;opcode
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
Identification de l&#039;instruction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
Retour sur le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">Exemples avec quelques instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
Divers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
Le mode de dessin intégré
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
Charger un jeu
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">L&#039;interface homme-machine</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
Les entrées utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
Le son
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/a-vous-de-jouer-21">
À vous de jouer !
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
<span class="arrow"></span>
<span class="next">Critères de sélection</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">
<span class="next">La base</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Labase"></a><h2>La base</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
<span class="arrow"></span>
<span class="next">La Chip 8</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
<span class="next">L&#039;implémentation de la machine</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-400904" data-claire-element-id="400904">Voici la première partie liée à de la programmation pure et dure. Ouvrez grand vos yeux ! La partie de plaisir peut <em>enfin</em> commencer. <br/> Je fournirai le code pour presque toutes les actions à effectuer, mais il est inutile de préciser qu'il vaut mieux comprendre et écrire son propre code que d'effectuer des copier-coller.<br/><em>Let's gooo!</em></p>
</div><a name="L039implmentationdelamachine"></a><h2>L&#039;implémentation de la machine</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">
<span class="arrow"></span>
<span class="next">La base</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
<span class="next">Le graphique</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-l-implementation-de-la-machine" data-claire-element-id="400940">L'implémentation de la machine</h4><p id="r-400905" data-claire-element-id="400905">Nous allons commencer par récupérer une citation dans la description de la Chip 8, que nous nous contenterons de traduire en langage machine.<br/> Cette partie concernera le CPU de la Chip 8. Le CPU est l'organe central de notre émulateur : c'est le chef d'orchestre.<br/><em>Are you ready?</em></p><h5 id="r-la-memoire-4" data-claire-element-id="400918">La mémoire</h5><p id="r-400906" data-claire-element-id="400906"><cite>Citation</cite></p><blockquote id="r-400908" data-claire-element-id="400908"><p id="r-400907" data-claire-element-id="400907">Les adresses mémoire de la Chip 8 vont de $200 à $FFF (l'hexadécimal revient), faisant ainsi 3 584 octets. La raison pour laquelle la mémoire commence à partir de $200 est que sur le VIP et Cosmac Telmac 1800, les 512 premiers octets sont réservés pour l'interpréteur. Sur ces machines, les 256 octets les plus élevés ($F00-$FFF sur une machine 4K) ont été réservés pour le rafraîchissement de l'écran, et les 96 octets inférieurs ($EA0-$EFF) ont été réservés pour la pile d'appels, à usage interne, et les variables.</p></blockquote><p id="r-400909" data-claire-element-id="400909">Bien que cette citation soit assez longue, ce qui nous intéresse est : « Les adresses mémoire vont de $200 à $FFF, faisant ainsi 3 584 octets » et « les 512 premiers octets sont réservés ». Je rappelle que <code>$200 = 512</code>.<br/> On peut déduire de ces deux informations que la Chip 8 a une mémoire de <code>3 584 + 512 = 4 096 octets</code> (un octet = huit bits, ne l'oubliez jamais). Le reste n'est que culture générale. <br/> Et comme nous allons simuler le fonctionnement de notre machine, le rafraîchissement sera géré par une autre méthode. Il existe des fonctions dédiées pour toutes les bibliothèques graphiques (<code>update</code>, <code>repaint</code>, <code>SDL_Flip</code>, etc). Les 512 premiers octets ne serviront donc à rien (pour le moment).</p><p id="r-400910" data-claire-element-id="400910">Dans mon cas, la variable mémoire prendra la forme d'un tableau de <code>4 096</code>octets.</p><aside id="r-400912" data-claire-element-id="400912" data-claire-semantic="information"><p id="r-400911" data-claire-element-id="400911">La mémoire est utilisée pour charger les jeux (roms) et pour la gestion des périphériques de la machine.<br/> J'en profite pour vous dire qu'il faut bien prendre en compte la taille spécifiée pour chaque variable. En plus, elles sont toutes non signées. En cas de non-respect de ces indications, votre programme buggera à coup sûr.</p></aside><p id="r-400913" data-claire-element-id="400913">Je parle en connaissance de cause. :honte:</p><p id="r-400914" data-claire-element-id="400914">Donc, à nous les unsigned dans tous les sens ! Pour ma part, j'utilise SDL, donc à moi les Uint.</p><p id="r-400915" data-claire-element-id="400915">Déclaration de la mémoire :</p><p id="r-400916" data-claire-element-id="400916"><code>Uint8 memoire[4096]; // la mémoire est en octets (8 bits), soit un tableau de 4096 Uint8</code>.</p><p id="r-400917" data-claire-element-id="400917">Maintenant, pour pointer sur une adresse donnée, il faut une autre variable qui sera initialisée à <code>$200 = 512</code> comme nous le dit la description.<br/> Nous la nommerons <code>pc</code> comme « <em>program counter</em> ». La variable doit être de 16 bits au minimum car nous devons être en mesure de parcourir tout le tableau mémoire qui va de <code>0 à 4095</code>.</p><h5 id="r-les-registres-2" data-claire-element-id="400923">Les registres</h5><p id="r-400919" data-claire-element-id="400919"><cite>Citation</cite></p><blockquote id="r-400921" data-claire-element-id="400921"><p id="r-400920" data-claire-element-id="400920">La Chip 8 comporte 16 registres de 8 bits dont les noms vont de V0 à VF (F = 15, encore l'hexadécimal). Le registre VF est utilisé pour toutes les retenues lors des calculs.<br/> En plus de ces 16 registres, nous avons le registre d'adresse, nommé I, qui est de 16 bits et qui est utilisé avec plusieurs <em>opcodes</em> qui impliquent des opérations de mémoire.</p></blockquote><p id="r-400922" data-claire-element-id="400922">Ici, il n'y a rien de compliqué, nous nous contenterons donc juste de déclarer les variables. Les registres permettent à la Chip 8 − et à tout processeur en général − de manipuler les données. Ils servent en gros d'intermédiaires entre la mémoire et l'unité de calcul, ou l'<a href="http://fr.wikipedia.org/wiki/Unité_arithmétique_et_logique">UAL</a> (Unité Arithmétique et Logique) pour les intimes. Le processeur gagne en vitesse d'exécution en manipulant les registres au lieu de modifier directement la mémoire.</p><h5 id="r-la-pile-ou-stack" data-claire-element-id="400928">La pile ou <em>stack</em></h5><p id="r-400924" data-claire-element-id="400924"><cite>Citation</cite></p><blockquote id="r-400926" data-claire-element-id="400926"><p id="r-400925" data-claire-element-id="400925">La pile sert uniquement à stocker des adresses de retour lorsque les sous-programmes sont appelés. Les implémentations modernes doivent normalement avoir au moins 16 niveaux.</p></blockquote><p id="r-400927" data-claire-element-id="400927">Lorsque le programme chargé dans la mémoire s'exécute, il se peut qu'il fasse des sauts d'une adresse mémoire à une autre.<br/> Pour revenir de ces sauts, il faut sauvegarder l'adresse où il se trouvait avant ce saut (<code>pc</code>) : c'est le rôle de la pile, appelée <em>stack</em> en anglais. Elle autorise seize niveaux, il nous faudra donc un tableau de seize variables pour stocker les seize dernières valeurs de <code>pc</code> ; on le nommera <code>saut</code>.<br/> Et comme pour la mémoire, on aura besoin d'une autre variable afin de parcourir ce tableau. Cette fois-ci, le type <code data-claire-semantic="c">Uint8</code> fera l'affaire puisqu'on ne parcourt que seize valeurs. Je l'ai nommée <code>nbrsaut</code>.</p><h5 id="r-les-compteurs-2" data-claire-element-id="400939">Les compteurs</h5><p id="r-400929" data-claire-element-id="400929"><cite>Citation</cite></p><blockquote id="r-400932" data-claire-element-id="400932"><p id="r-400930" data-claire-element-id="400930">La Chip 8 est composée deux compteurs. Ils décomptent tous les deux à 60 hertz, jusqu'à ce qu'ils atteignent 0.</p><p id="r-400931" data-claire-element-id="400931"><strong>Minuterie système</strong> : cette minuterie est destinée à la synchronisation des événements de jeux. Sa valeur peut être réglée et lue.<br/><strong>Minuterie sonore</strong> : cette minuterie est utilisée pour les effets sonores. Lorsque sa valeur est différente de zéro, un signal sonore est émis. Sa valeur peut être réglée et lue.</p></blockquote><p id="r-400933" data-claire-element-id="400933">La Chip 8 a besoin de deux variables pour se charger de la synchronisation et du son. Nous les appellerons respectivement <code>compteurJeu</code> et <code>compteurSon</code>.<br/> Puisqu'elles doivent décompter à 60 hertz, il faut trouver une méthode pour les décrémenter toutes les <code>1 / 60 = 0,016 = 16 millisecondes</code>. Les <em>timers</em> restent une bonne solution pour effectuer ce genre d'opération. En SDL, on implémente cette action avec <code data-claire-semantic="c">SDL_Delay</code>.</p><p id="r-400934" data-claire-element-id="400934">Toutes les caractéristiques de la Chip 8 seront stockées dans une structure qui représentera le CPU.</p><div id="r-400937" data-claire-element-id="400937"><pre id="r-400935" data-claire-element-id="400935"><code data-claire-semantic="c">#ifndef CPU_H
#define CPU_H

#define TAILLEMEMOIRE 4096
#define ADRESSEDEBUT 512


    typedef struct
    {
        Uint8 memoire[TAILLEMEMOIRE];
        Uint8 V[16]; //le registre
        Uint16 I; //stocke une adresse mémoire ou dessinateur
        Uint16 saut[16]; //pour gérer les sauts dans « mémoire », 16 au maximum
        Uint8 nbrsaut; //stocke le nombre de sauts effectués pour ne pas dépasser 16
        Uint8 compteurJeu; //compteur pour la synchronisation 
        Uint8 compteurSon; //compteur pour le son
        Uint16 pc; //pour parcourir le tableau « mémoire »
    } CPU;

CPU cpu;  //déclaration de notre CPU

void initialiserCpu() ;
void decompter() ;

#endif</code></pre><pre id="r-400936" data-claire-element-id="400936"><code data-claire-semantic="c">#include &quot;cpu.h&quot;


void initialiserCpu()
{
  //On initialise le tout

    Uint16 i=0;

    for(i=0;i&lt;TAILLEMEMOIRE;i++) //faisable avec memset, mais je n'aime pas cette fonction ^_^
    {
        cpu.memoire[i]=0;
    }

     for(i=0;i&lt;16;i++)
     {
        cpu.V[i]=0;
        cpu.saut[i]=0;
     }

    cpu.pc=ADRESSEDEBUT;
    cpu.nbrsaut=0;
    cpu.compteurJeu=0;
    cpu.compteurSon=0;
    cpu.I=0;

}


void decompter()
{
    if(cpu.compteurJeu&gt;0)
    cpu.compteurJeu--;

    if(cpu.compteurSon&gt;0)
    cpu.compteurSon--;
}</code></pre></div><p id="r-400938" data-claire-element-id="400938">Maintenant, attaquons le graphique, cela nous permettra de voir rapidement les différents résultats. L'ordre d'implémentation des caractéristiques importe peu, vous pourriez commencer par le graphique ou même l'exécution des instructions si vous le vouliez (par contre, je ne vous le conseille pas). :-° <br/> Cet ordre nous permettra de faire des tests le plus tôt possible.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console">L&#039;émulation console</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Notre premier émulateur
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/un-tour-d-horizon-1">Un tour d&#039;horizon</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
Définition de l&#039;émulation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
Les informations sur les consoles de jeu
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
Législation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">Quelle console émuler ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
Critères de sélection
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
La Chip 8
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">La base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
L&#039;implémentation de la machine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
Le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">Simulation des instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
Le cadencement du CPU et les FPS
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
Lecture de l&#039;opcode
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
Identification de l&#039;instruction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
Retour sur le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">Exemples avec quelques instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
Divers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
Le mode de dessin intégré
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
Charger un jeu
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">L&#039;interface homme-machine</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
Les entrées utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
Le son
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/a-vous-de-jouer-21">
À vous de jouer !
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">
<span class="arrow"></span>
<span class="next">La base</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
<span class="next">Le graphique</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Legraphique"></a><h2>Le graphique</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
<span class="arrow"></span>
<span class="next">L&#039;implémentation de la machine</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">
<span class="next">Simulation des instructions</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-le-graphique-3" data-claire-element-id="400997">Le graphique</h4><p id="r-400941" data-claire-element-id="400941">Jetons un coup d'œil à la description de la Chip 8 :</p><p id="r-400942" data-claire-element-id="400942"><cite>Citation</cite></p><blockquote id="r-400944" data-claire-element-id="400944"><p id="r-400943" data-claire-element-id="400943">La résolution de l'écran est de 64 × 32 pixels, et la couleur est monochrome .</p></blockquote><p id="r-400945" data-claire-element-id="400945">Pour simuler notre écran, nous allons créer un panneau divisé en 64 × 32 pixels.</p><h5 id="r-creation-des-pixels" data-claire-element-id="400988">Création des pixels</h5><p id="r-400946" data-claire-element-id="400946">Un pixel est un petit carré (ou rectangle) caractérisé par son abscisse, son ordonnée et sa couleur (ici, elle sera noire ou blanche car l'écran est monochrome). Dans notre cas, j'ai choisi des pixels carrés de côté 8. Vous pouvez fixer une dimension qui vous convient.</p><p id="r-400947" data-claire-element-id="400947">Voici le code C/SDL qui permet de définir notre pixel. (Un vrai zéro se doit de maîtriser la SDL.) :D</p><p id="r-400948" data-claire-element-id="400948"></p><div id="r-400950" data-claire-element-id="400950"><pre id="r-400949" data-claire-element-id="400949"><code data-claire-semantic="c">#ifndef PIXEL_H
#define PIXEL_H
#include &lt;SDL/SDL.h&gt;


typedef struct
{
    SDL_Rect position; //regroupe l'abscisse et l'ordonnée
    Uint8 couleur;   //comme son nom l'indique, c'est la couleur
} PIXEL;


#endif</code></pre></div><p id="r-400951" data-claire-element-id="400951">Après la création de notre pixel, nous allons maintenant créer l'écran en tant que tel, qui sera constitué de <code>64 × 32</code> pixels.<br/> Nous allons donc d'abord déclarer un tableau de <code>64 × 32</code> pixels et l'écran qui les contiendra. Cet écran aura des dimensions proportionnelles au nombre de pixels et à leur largeur.</p><p id="r-400952" data-claire-element-id="400952"></p><div id="r-400954" data-claire-element-id="400954"><pre id="r-400953" data-claire-element-id="400953"><code data-claire-semantic="c">#ifndef PIXEL_H
#define PIXEL_H
#include &lt;SDL/SDL.h&gt;

#define NOIR  0
#define BLANC 1
#define l 64      //nombre de pixels suivant la largeur
#define L 32       //nombre de pixels suivant la longueur
#define DIMPIXEL 8  //pixel carré de côté 8
#define WIDTH   l*DIMPIXEL      //largeur de l'écran
#define HEIGHT  L*DIMPIXEL       //longueur de l'écran

typedef struct
{
    SDL_Rect position; //regroupe l'abscisse et l'ordonnée
    Uint8 couleur;   //comme son nom l'indique, c'est la couleur
} PIXEL;


SDL_Surface *ecran,*carre[2];
PIXEL pixel[l][L];

#endif</code></pre></div><aside id="r-400956" data-claire-element-id="400956" data-claire-semantic="information"><p id="r-400955" data-claire-element-id="400955">Le tableau <code data-claire-semantic="c">carre</code> nous permettra de définir nos deux types de pixels : Noir et Blanc. Il sera utilisé pour dessiner à l'écran (avec la SDL, c'est le tableau que l'on va <em>blitter</em> sur l'écran à différentes positions).</p></aside><p id="r-400957" data-claire-element-id="400957">Maintenant que nous avons déclaré notre tableau de pixels, le premier petit problème pointe le bout de son nez.</p><div id="r-400959" data-claire-element-id="400959" data-claire-semantic="question"><p id="r-400958" data-claire-element-id="400958">Comment calculer les coordonnées de notre pixel à partir de l'indice du tableau ?</p></div><p id="r-400960" data-claire-element-id="400960">La technique est assez utilisée et connue mais un petit rappel est toujours le bienvenu.<br/> Jetons un coup d'œil sur notre futur panneau avec tous ses pixels.</p><figure id="r-400962" data-claire-element-id="400963"><img id="r-400961" data-claire-element-id="400961" src="medias/uploads.siteduzero.com_files_318001_319000_318238.gif" alt="Image utilisateur"/></figure><p id="r-400964" data-claire-element-id="400964">Chaque carré représente un pixel. Le pixel en (0,0) a pour coordonnées (0,0). De même, le pixel en (2,0) a pour coordonnées (2*8,0) soit (16,0). Enfin, le pixel en (0,1) a pour coordonnées (0,1*8) soit (0,8).<br/> D'une manière générale, pour trouver l'abscisse et l'ordonnée d'un pixel, il suffit de multiplier ses indices respectifs (X,Y) par la largeur et la longueur d'un pixel. Nous les avons fixés tous les deux à 8 (les pixels sont carrés).<br/> Voici donc comment j'ai procédé pour le calcul :</p><p id="r-400965" data-claire-element-id="400965"></p><div id="r-400968" data-claire-element-id="400968"><pre id="r-400966" data-claire-element-id="400966"><code data-claire-semantic="c">#ifndef PIXEL_H
#define PIXEL_H
#include &lt;SDL/SDL.h&gt;

#define NOIR  0
#define BLANC 1
#define l 64      //nombre de pixels suivant la largeur
#define L 32       //nombre de pixels suivant la longueur
#define DIMPIXEL 8  //pixel carré de côté 8
#define WIDTH   l*DIMPIXEL      //largeur de l'écran
#define HEIGHT  L*DIMPIXEL       //longueur de l'écran

typedef struct
{
    SDL_Rect position; //regroupe l'abscisse et l'ordonnée
    Uint8 couleur;   //comme son nom l'indique, c'est la couleur
} PIXEL;


SDL_Surface *ecran,*carre[2];
PIXEL pixel[l][L];

void initialiserPixel() ;
#endif</code></pre><pre id="r-400967" data-claire-element-id="400967"><code data-claire-semantic="c">#include &quot;pixel.h&quot;

void initialiserPixel()
{
    Uint8 x=0,y=0;
 
    for(x=0;x&lt;l;x++)
    {
        for(y=0;y&lt;L;y++)
        {
            pixel[x][y].position.x=x*DIMPIXEL;
            pixel[x][y].position.y=y*DIMPIXEL;
            pixel[x][y].couleur=NOIR; //on met par défaut les pixels en noir
        }
    }
 
}</code></pre></div><p id="r-400969" data-claire-element-id="400969">Pour la couleur des pixels, j'ai adopté le même codage que la Chip 8, à savoir :</p><ul id="r-400974" data-claire-element-id="400974"><li id="r-400971" data-claire-element-id="400971"><p id="r-400970" data-claire-element-id="400970">0 pour le noir ou éteint ;</p></li><li id="r-400973" data-claire-element-id="400973"><p id="r-400972" data-claire-element-id="400972">1 pour le blanc ou allumé.</p></li></ul><div id="r-400976" data-claire-element-id="400976" data-claire-semantic="question"><p id="r-400975" data-claire-element-id="400975">Envie de faire quelques tests ?</p></div><p id="r-400977" data-claire-element-id="400977">Rajoutons des fonctions pour initialiser les variables <code data-claire-semantic="c">ecran</code> et <code data-claire-semantic="c">carre</code> et pour dessiner sur notre écran.</p><p id="r-400978" data-claire-element-id="400978"></p><div id="r-400982" data-claire-element-id="400982"><pre id="r-400979" data-claire-element-id="400979"><code data-claire-semantic="c">#ifndef PIXEL_H
#define PIXEL_H
#include &lt;SDL/SDL.h&gt;

#define NOIR  0
#define BLANC 1
#define l 64
#define L 32
#define DIMPIXEL 8
#define WIDTH   l*DIMPIXEL
#define HEIGHT  L*DIMPIXEL

typedef struct
{
    SDL_Rect position; //regroupe l'abscisse et l'ordonnée
    Uint8 couleur;   //comme son nom l'indique, c'est la couleur
} PIXEL;

SDL_Surface *ecran,*carre[2];
PIXEL pixel[l][L];
SDL_Event event; //pour gérer la pause

void initialiserEcran() ;
void initialiserPixel() ;
void dessinerPixel(PIXEL pixel) ;
void effacerEcran() ;
void updateEcran() ;

#endif</code></pre><pre id="r-400980" data-claire-element-id="400980"><code data-claire-semantic="c">#include &quot;pixel.h&quot;

void initialiserPixel()
{
    Uint8 x=0,y=0;

    for(x=0;x&lt;l;x++)
    {
        for(y=0;y&lt;L;y++)
        {
            pixel[x][y].position.x=x*DIMPIXEL;
            pixel[x][y].position.y=y*DIMPIXEL;
            pixel[x][y].couleur=NOIR;
        }
    }

}

void initialiserEcran()
{
    ecran=NULL;
    carre[0]=NULL;
    carre[1]=NULL;

    ecran=SDL_SetVideoMode(WIDTH,HEIGHT,32,SDL_HWSURFACE);
    SDL_WM_SetCaption(&quot;BC-Chip8 By BestCoder&quot;,NULL);

    if(ecran==NULL)
    {
        fprintf(stderr,&quot;Erreur lors du chargement du mode vidéo %s&quot;,SDL_GetError());
        exit(EXIT_FAILURE);
    }


    carre[0]=SDL_CreateRGBSurface(SDL_HWSURFACE,DIMPIXEL,DIMPIXEL,32,0,0,0,0); //le pixel noir
    if(carre[0]==NULL)
    {
       fprintf(stderr,&quot;Erreur lors du chargement de la surface %s&quot;,SDL_GetError());
       exit(EXIT_FAILURE);
    }

    SDL_FillRect(carre[0],NULL,SDL_MapRGB(carre[0]-&gt;format,0x00,0x00,0x00)); //le pixel noir

    carre[1]=SDL_CreateRGBSurface(SDL_HWSURFACE,DIMPIXEL,DIMPIXEL,32,0,0,0,0); //le pixel blanc
    if(carre[1]==NULL)
    {
       fprintf(stderr,&quot;Erreur lors du chargement de la surface %s&quot;,SDL_GetError());
       exit(EXIT_FAILURE);
    }

    SDL_FillRect(carre[1],NULL,SDL_MapRGB(carre[1]-&gt;format,0xFF,0xFF,0xFF));  //le pixel blanc

}

void dessinerPixel(PIXEL pixel)
{
 /* pixel.couleur peut prendre deux valeurs : 0, auquel cas on dessine le pixel en noir, ou 1, on dessine alors le pixel en blanc */

    SDL_BlitSurface(carre[pixel.couleur],NULL,ecran,&amp;pixel.position);
}

void effacerEcran()
{
    //Pour effacer l'écran, on remet tous les pixels en noir

    Uint8 x=0,y=0;
    for(x=0;x&lt;l;x++)
    {
        for(y=0;y&lt;L;y++)
        {
            pixel[x][y].couleur=NOIR;
        }
    }

  //on repeint l'écran en noir
    SDL_FillRect(ecran,NULL,NOIR);
}
void updateEcran()
{
  //On dessine tous les pixels à l'écran
Uint8 x=0,y=0;

 for(x=0;x&lt;l;x++)
    {
        for(y=0;y&lt;L;y++)
        {
             dessinerPixel(pixel[x][y]);
        }
    }

 SDL_Flip(ecran); //on affiche les modifications
}</code></pre><pre id="r-400981" data-claire-element-id="400981"><code data-claire-semantic="c">#include &lt;SDL/SDL.h&gt;
#include &quot;cpu.h&quot;

void initialiserSDL();
void quitterSDL();
void pause();

int main(int argc, char *argv[])
{
    initialiserSDL();
    initialiserEcran();
    initialiserPixel();

     updateEcran();

     pause();


return EXIT_SUCCESS;
}


void initialiserSDL()
{
    atexit(quitterSDL);

    if(SDL_Init(SDL_INIT_VIDEO)==-1)
    {
        fprintf(stderr,&quot;Erreur lors de l'initialisation de la SDL %s&quot;,SDL_GetError());
        exit(EXIT_FAILURE);
    }


}


void quitterSDL()
{

    SDL_FreeSurface(carre[0]);
    SDL_FreeSurface(carre[1]);
    SDL_Quit();
}

void pause()
{

    Uint8 continuer=1;

    do
    {
        SDL_WaitEvent(&amp;event);

        switch(event.type)
         {
             case SDL_QUIT:
                    continuer=0;
                    break;
             case SDL_KEYDOWN:
                    continuer=0;
                    break;
             default: break;
         }
    }while(continuer==1);

}</code></pre></div><p id="r-400983" data-claire-element-id="400983">Et voilà le résultat de tout ce travail. :-°</p><figure id="r-400985" data-claire-element-id="400986"><img id="r-400984" data-claire-element-id="400984" src="medias/uploads.siteduzero.com_files_318001_319000_318251.gif" alt="Image utilisateur"/></figure><p id="r-400987" data-claire-element-id="400987">o_O Quoi ? Tout ce travail pour cette merde ! Un simple <code data-claire-semantic="c">SDL_FillRect</code> aurait fait l'affaire.</p><h5 id="r-modifier-l-ecran" data-claire-element-id="400996">Modifier l'écran</h5><p id="r-400989" data-claire-element-id="400989">Derrière tout ce travail se cache un grand secret. Je vous donne ce bout de code qui va vous éclaircir les idées. Remplacez la fonction <code data-claire-semantic="c">initialiserPixel()</code> par celle-ci :</p><pre id="r-400990" data-claire-element-id="400990"><code data-claire-semantic="c">void initialiserPixel()
{

    Uint8 x=0,y=0;

    for(x=0;x&lt;l;x++)
    {
        for(y=0;y&lt;L;y++)
        {
            pixel[x][y].position.x=x*DIMPIXEL;
            pixel[x][y].position.y=y*DIMPIXEL;

            if(x%(y+1)==0)
              pixel[x][y].couleur=NOIR;
            else
              pixel[x][y].couleur=BLANC;
        }
    }
}</code></pre><div id="r-400992" data-claire-element-id="400993"><img id="r-400993" data-claire-element-id="400992" src="medias/uploads.siteduzero.com_files_318001_319000_318253.gif" alt="Image utilisateur"/><p id="r-400991" data-claire-element-id="400991">Et voilà le travail. :soleil:</p></div><p id="r-400994" data-claire-element-id="400994">Vous pouvez même changer la condition pour voir ce que donne le résultat. C'est tout simplement <em>AMAZING!</em><br/> C'est comme ça que le jeu se dessinera à l'écran. Il n'y aura pas de fichier image à charger ni quoi que ce soit ! Tout se fera en positionnant les pixels noirs et blancs comme il faut et en effectuant les différentes instructions requises. Nous les aborderons dans la partie suivante. <br/> En revanche, n'oubliez pas de rétablir l'ancienne fonction <code data-claire-semantic="c">initialiserPixel()</code>. :-°</p><p id="r-400995" data-claire-element-id="400995">Nous avons fini de remplacer le matériel utilisé, il suffit maintenant de simuler les différents calculs que peut effectuer la Chip 8 et notre émulateur sera fini et opérationnel. Je sais : vous vous dites que c'est trop facile pour être vrai, mais c'est comme ça.<br/> La suite… au prooochain numérooo !</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console">L&#039;émulation console</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Notre premier émulateur
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/un-tour-d-horizon-1">Un tour d&#039;horizon</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
Définition de l&#039;émulation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
Les informations sur les consoles de jeu
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
Législation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">Quelle console émuler ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
Critères de sélection
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
La Chip 8
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">La base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
L&#039;implémentation de la machine
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
Le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">Simulation des instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
Le cadencement du CPU et les FPS
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
Lecture de l&#039;opcode
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
Identification de l&#039;instruction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
Retour sur le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">Exemples avec quelques instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
Divers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
Le mode de dessin intégré
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
Charger un jeu
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">L&#039;interface homme-machine</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
Les entrées utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
Le son
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/a-vous-de-jouer-21">
À vous de jouer !
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
<span class="arrow"></span>
<span class="next">L&#039;implémentation de la machine</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">
<span class="next">Simulation des instructions</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Simulationdesinstructions"></a><h2>Simulation des instructions</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
<span class="arrow"></span>
<span class="next">Le graphique</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
<span class="next">Le cadencement du CPU et les FPS</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-400999" data-claire-element-id="400999">La Chip 8 ne sait exécuter que 35 opérations. o_O Si, si, vous avez bien entendu, ce sera aux programmeurs des jeux et applications de combiner les différentes opérations pour arriver à leurs fins. Nous nous contenterons d'implémenter les 35 opérations et notre émulateur sera opérationnel. C'est parti, nous abordons le dernier virage.</p>
</div><a name="LecadencementduCPUetlesFPS"></a><h2>Le cadencement du CPU et les FPS</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">
<span class="arrow"></span>
<span class="next">Simulation des instructions</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
<span class="next">Lecture de l&#039;opcode</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-le-cadencement-du-cpu-et-les-fps" data-claire-element-id="401020">Le cadencement du CPU et les FPS</h4><p id="r-401000" data-claire-element-id="401000">Il y a deux choses qu'il faut absolument connaître quand on veut programmer un émulateur :</p><ul id="r-401005" data-claire-element-id="401005"><li id="r-401002" data-claire-element-id="401002"><p id="r-401001" data-claire-element-id="401001">la vitesse d'exécution des instructions ou le cadencement de la machine ;</p></li><li id="r-401004" data-claire-element-id="401004"><p id="r-401003" data-claire-element-id="401003">la période de rafraîchissement de l'écran ou le nombre de FPS.</p></li></ul><h5 id="r-comment-allons-nous-proceder-1" data-claire-element-id="401010">Comment allons-nous procéder ?</h5><p id="r-401006" data-claire-element-id="401006">Nous savons qu'une console de jeu est un système embarqué et ceux qui ont déjà programmé pour de l'embarqué (microprocesseur, microcontrôleur, etc.) savent que dans le code, il faut systématiquement une boucle infinie ou un système de <em>timer</em> car le code doit s'exécuter aussi longtemps que la console est en marche.</p><pre id="r-401007" data-claire-element-id="401007"><code data-claire-semantic="c">while(&quot;Machine Fonctionne&quot;)
{
      regarder_ce_qu_il_faut_faire();
      Le_faire();
}</code></pre><p id="r-401008" data-claire-element-id="401008">La fréquence d'exécution des instructions reste assez méconnue. Dans notre cas, nous allons utiliser une fréquence de 250 hertz. Cette fréquence nous donne une période de 4 ms (rappel mathématique : f=1/T avec T la période en secondes et f la fréquence en hertz).<br/> Donc toutes les quatre millisecondes, nous devons effectuer une opération. Soit quatre opérations, toutes les seize millisecondes.</p><p id="r-401009" data-claire-element-id="401009">Pour les FPS aussi, la valeur est assez méconnue ( :-° ), on prendra donc la valeur la plus courante, à savoir 60. Soixante images par seconde, c'est une image toutes les 16,67 ms (1000 / 60 = 16,67). Un <em>timer</em> SDL aussi précis n'existe pas, on se limitera donc à une image toutes les 16 ms.</p><h5 id="r-recapitulatif-10" data-claire-element-id="401019">Récapitulatif</h5><p id="r-401011" data-claire-element-id="401011">Il faut quatre opérations et une nouvelle image toutes les seize millisecondes. Donc la fonction <code data-claire-semantic="c">updateEcran</code> sera appelée après l'exécution de quatre opérations. Je gère le tout dans le <em>main</em>. Nous allons nous contenter de la boucle principale (le fameux <code data-claire-semantic="c">while(continuer)</code>) et des <code data-claire-semantic="c">SDL_Delay</code>.</p><p id="r-401012" data-claire-element-id="401012"></p><div id="r-401014" data-claire-element-id="401014"><pre id="r-401013" data-claire-element-id="401013"><code data-claire-semantic="c">#include &lt;SDL/SDL.h&gt;
#include &quot;cpu.h&quot;

#define VITESSECPU 4 //nombre d'opérations par tour
#define FPS 16      //pour le rafraîchissement

void initialiserSDL() ;
void quitterSDL() ;
void pause() ;

int main(int argc, char *argv[])
{
    initialiserSDL() ;
    initialiserEcran() ;
    initialiserPixel() ;

    
    Uint8 continuer=1;

    do
    {
        //On effectuera quatre opérations ici
        
        updateEcran() ;
        SDL_Delay(FPS) ; //une pause de 16 ms
    }while(continuer==1);

   pause();


return EXIT_SUCCESS;
}


void initialiserSDL()
{
    atexit(quitterSDL) ;

    if(SDL_Init(SDL_INIT_VIDEO)==-1)
    {
        fprintf(stderr,&quot;Erreur lors de l'initialisation de la SDL %s&quot;,SDL_GetError());
        exit(EXIT_FAILURE);
    }

}


void quitterSDL()
{
    SDL_FreeSurface(carre[0]) ;
    SDL_FreeSurface(carre[1]) ;
    SDL_Quit() ;
}

void pause()
{

    Uint8 continuer=1 ;

    do
    {
        SDL_WaitEvent(&amp;event) ;

        switch(event.type)
         {
             case SDL_QUIT:
                    continuer=0;
                    break;
             case SDL_KEYDOWN:
                    continuer=0;
                    break;
             default: break ;
         }
    }while(continuer==1);

}</code></pre></div><aside id="r-401016" data-claire-element-id="401016" data-claire-semantic="warning"><p id="r-401015" data-claire-element-id="401015">Ne testez surtout pas ce code. :lol:</p></aside><aside id="r-401018" data-claire-element-id="401018" data-claire-semantic="information"><p id="r-401017" data-claire-element-id="401017">Le choix de 250 Hz et 60 FPS est subjectif. Le problème est que les caractéristiques de la Chip 8 sont très méconnues, mais pour beaucoup d'autres consoles, vous trouverez facilement la fréquence exacte de cadencement du CPU. Et 250 Hz, c'est relativement facile à simuler. (Je sais, je suis paresseux. :D )</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console">L&#039;émulation console</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Notre premier émulateur
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/un-tour-d-horizon-1">Un tour d&#039;horizon</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
Définition de l&#039;émulation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
Les informations sur les consoles de jeu
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
Législation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">Quelle console émuler ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
Critères de sélection
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
La Chip 8
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">La base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
L&#039;implémentation de la machine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
Le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">Simulation des instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
Le cadencement du CPU et les FPS
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
Lecture de l&#039;opcode
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
Identification de l&#039;instruction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
Retour sur le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">Exemples avec quelques instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
Divers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
Le mode de dessin intégré
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
Charger un jeu
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">L&#039;interface homme-machine</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
Les entrées utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
Le son
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/a-vous-de-jouer-21">
À vous de jouer !
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">
<span class="arrow"></span>
<span class="next">Simulation des instructions</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
<span class="next">Lecture de l&#039;opcode</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lecturedel039opcode"></a><h2>Lecture de l&#039;opcode</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
<span class="arrow"></span>
<span class="next">Le cadencement du CPU et les FPS</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
<span class="next">Identification de l&#039;instruction</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-lecture-de-l-opcode" data-claire-element-id="401031">Lecture de l'opcode</h4><p id="r-401021" data-claire-element-id="401021">Pour connaître l'action à effectuer, il faut lire dans la mémoire. Mais le problème est qu'elle est en octets (8 bits) et que les <em>opcodes</em>sont, eux, de 16 bits.<br/> Par exemple, pour l'<em>opcode</em> 8XY0 − qui, je le rappelle, est en hexadécimal − on a : 4 bits pour le « 0 » + 4 bits pour le « X » + 4 bits pour le « Y » + 4 bits pour le « 0 ». Ce qui nous donne <code>4 × 4 = 16 bits</code>.<br/> Si on effectue <code data-claire-semantic="c">opcode=cpu.memoire[cpu.pc]</code>, il nous manquerait 8 bits. Il faut alors récupérer 16 bits dans la mémoire, à savoir <code>cpu.memoire[cpu.pc]</code> et <code>cpu.memoire[cpu.pc+1]</code>.<br/> Maintenant, il faut juste trouver un moyen pour les mettre « côte à côte » pour ne former qu'un unique nombre de 16 bits.</p><div id="r-401023" data-claire-element-id="401023" data-claire-semantic="question"><p id="r-401022" data-claire-element-id="401022">Les décalages <em>(bit shift)</em>, ça vous dit quelque chose ?</p></div><p id="r-401024" data-claire-element-id="401024">Eh bien, ce sont eux qui vont nous faciliter la vie. Il suffit de décaler vers la gauche cpu.memoire[cpu.pc] de 8 bits et de faire la somme avec cpu.memoire[cpu.pc+1]. On aura ainsi un <em>opcode</em> de 16 bits.<br/> Donc, on aura en définitive <code data-claire-semantic="c">opcode=cpu.memoire[cpu.pc]&lt;&lt;8+cpu.memoire[cpu.pc+1]</code>.</p><figure id="r-401026" data-claire-element-id="401027"><img id="r-401025" data-claire-element-id="401025" src="medias/uploads.siteduzero.com_files_311001_312000_311428.gif" alt="Image utilisateur"/></figure><p id="r-401028" data-claire-element-id="401028">La fonction pour effectuer ce calcul sera introduite dans cpu.h et cpu.c.</p><pre id="r-401029" data-claire-element-id="401029"><code data-claire-semantic="c">Uint16 recupererOpcode() ; //prototype dans cpu.h

Uint16 recupererOpcode()   //dans cpu.c
{  
    return (cpu.memoire[cpu.pc]&lt;&lt;8)+cpu.memoire[cpu.pc+1];
}</code></pre><p id="r-401030" data-claire-element-id="401030">On vient de passer une étape, mais il reste encore deux ou trois détails et le tour sera joué.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console">L&#039;émulation console</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Notre premier émulateur
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/un-tour-d-horizon-1">Un tour d&#039;horizon</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
Définition de l&#039;émulation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
Les informations sur les consoles de jeu
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
Législation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">Quelle console émuler ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
Critères de sélection
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
La Chip 8
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">La base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
L&#039;implémentation de la machine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
Le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">Simulation des instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
Le cadencement du CPU et les FPS
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
Lecture de l&#039;opcode
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
Identification de l&#039;instruction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
Retour sur le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">Exemples avec quelques instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
Divers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
Le mode de dessin intégré
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
Charger un jeu
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">L&#039;interface homme-machine</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
Les entrées utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
Le son
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/a-vous-de-jouer-21">
À vous de jouer !
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
<span class="arrow"></span>
<span class="next">Le cadencement du CPU et les FPS</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
<span class="next">Identification de l&#039;instruction</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Identificationdel039instruction"></a><h2>Identification de l&#039;instruction</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
<span class="arrow"></span>
<span class="next">Lecture de l&#039;opcode</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
<span class="next">Retour sur le graphique</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-identification-de-l-instruction" data-claire-element-id="401103">Identification de l'instruction</h4><p id="r-401032" data-claire-element-id="401032">Après avoir récupéré notre <em>opcode</em>, il ne reste plus qu'à l'interpréter. Par interpréter, il faut comprendre effectuer l'opération qui lui est associée.</p><p id="r-401033" data-claire-element-id="401033">Jetons un coup d'œil à nos <em>opcodes</em> (qui sont en hexadécimal) : 0NNN, 00E0, 00EE, 1NNN, 2NNN, 3XNN, 4XNN, 5XY0, 6XNN, 7XNN, 8XY0, 8XY1, 8XY2, 8XY3, 8XY4, 8XY5, etc. (ces valeurs proviennent du tableau de la partie <a href="http://www.siteduzero.com/tutoriel-3-465683-1-quelle-console-emuler.html#ss_part_3">Quelle machine émuler ?</a>).</p><p id="r-401034" data-claire-element-id="401034">Tous les X, Y et N sont supposés inconnus. Pour connaître l'action à exécuter, il faut donc trouver un moyen d'identifier chaque <em>opcode</em> en ne tenant pas compte de ces valeurs. Pour ce faire, nous allons utiliser les opérations bits à bits combinées à une grosse amélioration de Pouet_forever.</p><h5 id="r-notre-table-de-correspondance" data-claire-element-id="401102">Notre table de correspondance</h5><p id="r-401035" data-claire-element-id="401035">Nous avons 35 opérations à effectuer. Pour chacune d'elles, j'ai donc associé un nombre unique compris entre 0 et 34. <br/> Ensuite, suivant le nombre obtenu, on effectuera l'opération souhaitée en utilisant un bloc <code data-claire-semantic="c">switch</code>.</p><h6 id="r-trouver-le-masque-et-l-identifiant-de-l-opcode" data-claire-element-id="401077">Trouver le masque et l'identifiant de l'<em>opcode</em></h6><p id="r-401036" data-claire-element-id="401036">Prenons l'<em>opcode</em><code data-claire-semantic="c">0x8XY2</code> comme exemple. Pour l'identifier, on doit vérifier que les 4 bits de poids fort donnent 8 et les 4 bits de poids faible donnent 2.<br/> Pour ce faire, on peut effectuer l'opération <code data-claire-semantic="c">0x8XY2 &amp; 0xF00F</code> qui nous donne <code data-claire-semantic="c">8002</code>. À chaque fois que l'on effectue <code data-claire-semantic="c">opcode_quelconque &amp; 0xF00F</code> et qu'on trouve <code data-claire-semantic="c">8002</code>, il s'agit donc de <code data-claire-semantic="c">8XY2</code>. Ingénieux, n'est-ce pas ? (Honte à moi, grand copieur de Pouet_Forever. :honte: ) L'<em>opcode</em> 8XY2 a donc pour masque <code data-claire-semantic="c">0xF00F</code> et pour identifiant <code data-claire-semantic="c">0x8002</code>.<br/> Pour tous les autres <em>opcodes</em>, le principe reste le même. Exemples :</p><table id="r-401074" data-claire-element-id="401074"><thead id="r-401044" data-claire-element-id="401044"><tr id="r-401043" data-claire-element-id="401043"><th id="r-401038" data-claire-element-id="401038"><p id="r-401037" data-claire-element-id="401037"><em>Opcode</em></p></th><th id="r-401040" data-claire-element-id="401040"><p id="r-401039" data-claire-element-id="401039">Masque</p></th><th id="r-401042" data-claire-element-id="401042"><p id="r-401041" data-claire-element-id="401041">Identifiant</p></th></tr></thead><tbody id="r-401073" data-claire-element-id="401073"><tr id="r-401051" data-claire-element-id="401051"><td id="r-401046" data-claire-element-id="401046"><p id="r-401045" data-claire-element-id="401045">00E0</p></td><td id="r-401048" data-claire-element-id="401048"><p id="r-401047" data-claire-element-id="401047">FFFF</p></td><td id="r-401050" data-claire-element-id="401050"><p id="r-401049" data-claire-element-id="401049">00E0</p></td></tr><tr id="r-401058" data-claire-element-id="401058"><td id="r-401053" data-claire-element-id="401053"><p id="r-401052" data-claire-element-id="401052">1NNN</p></td><td id="r-401055" data-claire-element-id="401055"><p id="r-401054" data-claire-element-id="401054">F000</p></td><td id="r-401057" data-claire-element-id="401057"><p id="r-401056" data-claire-element-id="401056">1000</p></td></tr><tr id="r-401065" data-claire-element-id="401065"><td id="r-401060" data-claire-element-id="401060"><p id="r-401059" data-claire-element-id="401059">8XY3</p></td><td id="r-401062" data-claire-element-id="401062"><p id="r-401061" data-claire-element-id="401061">F00F</p></td><td id="r-401064" data-claire-element-id="401064"><p id="r-401063" data-claire-element-id="401063">8003</p></td></tr><tr id="r-401072" data-claire-element-id="401072"><td id="r-401067" data-claire-element-id="401067"><p id="r-401066" data-claire-element-id="401066">FX15</p></td><td id="r-401069" data-claire-element-id="401069"><p id="r-401068" data-claire-element-id="401068">F0FF</p></td><td id="r-401071" data-claire-element-id="401071"><p id="r-401070" data-claire-element-id="401070">F015</p></td></tr></tbody></table><p id="r-401075" data-claire-element-id="401075">Je stocke le tout dans une structure que j'ai appelée JUMP.</p><pre id="r-401076" data-claire-element-id="401076"><code data-claire-semantic="c">//Dans cpu.h
#define NBROPCODE 35

typedef struct
{
    Uint16 masque [NBROPCODE];   //la Chip 8 peut effectuer 35 opérations, chaque opération possédant son masque
    Uint16 id[NBROPCODE];   //idem, chaque opération possède son propre identifiant

}JUMP;

JUMP jp;

void initialiserJump () ;


//Dans cpu.c


void initialiserJump ()
{

  jp.masque[0]= 0x0000; jp.id[0]=0x0FFF;          /* 0NNN */
  jp.masque[1]= 0xFFFF; jp.id[1]=0x00E0;          /* 00E0 */
  jp.masque[2]= 0xFFFF; jp.id[2]=0x00EE;          /* 00EE */
  jp.masque[3]= 0xF000; jp.id[3]=0x1000;          /* 1NNN */
  jp.masque[4]= 0xF000; jp.id[4]=0x2000;          /* 2NNN */
  jp.masque[5]= 0xF000; jp.id[5]=0x3000;          /* 3XNN */
  jp.masque[6]= 0xF000; jp.id[6]=0x4000;          /* 4XNN */
  jp.masque[7]= 0xF00F; jp.id[7]=0x5000;          /* 5XY0 */
  jp.masque[8]= 0xF000; jp.id[8]=0x6000;          /* 6XNN */
  jp.masque[9]= 0xF000; jp.id[9]=0x7000;          /* 7XNN */
  jp.masque[10]= 0xF00F; jp.id[10]=0x8000;          /* 8XY0 */
  jp.masque[11]= 0xF00F; jp.id[11]=0x8001;          /* 8XY1 */
  jp.masque[12]= 0xF00F; jp.id[12]=0x8002;          /* 8XY2 */
  jp.masque[13]= 0xF00F; jp.id[13]=0x8003;          /* BXY3 */
  jp.masque[14]= 0xF00F; jp.id[14]=0x8004;          /* 8XY4 */
  jp.masque[15]= 0xF00F; jp.id[15]=0x8005;          /* 8XY5 */
  jp.masque[16]= 0xF00F; jp.id[16]=0x8006;          /* 8XY6 */
  jp.masque[17]= 0xF00F; jp.id[17]=0x8007;          /* 8XY7 */
  jp.masque[18]= 0xF00F; jp.id[18]=0x800E;          /* 8XYE */
  jp.masque[19]= 0xF00F; jp.id[19]=0x9000;          /* 9XY0 */
  jp.masque[20]= 0xF000; jp.id[20]=0xA000;          /* ANNN */
  jp.masque[21]= 0xF000; jp.id[21]=0xB000;          /* BNNN */
  jp.masque[22]= 0xF000; jp.id[22]=0xC000;          /* CXNN */
  jp.masque[23]= 0xF000; jp.id[23]=0xD000;          /* DXYN */
  jp.masque[24]= 0xF0FF; jp.id[24]=0xE09E;          /* EX9E */
  jp.masque[25]= 0xF0FF; jp.id[25]=0xE0A1;          /* EXA1 */
  jp.masque[26]= 0xF0FF; jp.id[26]=0xF007;          /* FX07 */
  jp.masque[27]= 0xF0FF; jp.id[27]=0xF00A;          /* FX0A */
  jp.masque[28]= 0xF0FF; jp.id[28]=0xF015;          /* FX15 */
  jp.masque[29]= 0xF0FF; jp.id[29]=0xF018;          /* FX18 */
  jp.masque[30]= 0xF0FF; jp.id[30]=0xF01E;          /* FX1E */
  jp.masque[31]= 0xF0FF; jp.id[31]=0xF029;          /* FX29 */
  jp.masque[32]= 0xF0FF; jp.id[32]=0xF033;          /* FX33 */
  jp.masque[33]= 0xF0FF; jp.id[33]=0xF055;          /* FX55 */
  jp.masque[34]= 0xF0FF; jp.id[34]=0xF065;          /* FX65 */

}</code></pre><h6 id="r-trouver-l-opcode-a-interpreter" data-claire-element-id="401101">Trouver l'<em>opcode</em> à interpréter</h6><p id="r-401078" data-claire-element-id="401078">Le plus difficile est fait, il ne reste plus qu'à implémenter un algorithme nous permettant de retrouver le nombre associé à un <em>opcode</em>. Pour chaque <em>opcode</em>, il faut récupérer son identifiant en appliquant un <code data-claire-semantic="c">&amp;</code> avec le masque et le comparer avec ceux de notre structure JUMP. Un exemple vaut mieux que mille discours.<br/> Prenons le nombre <code data-claire-semantic="c">0x8475</code>. Grâce à notre structure JUMP, nous devons être en mesure de retrouver 15, qui est le nombre associé aux <em>opcodes</em> 0x8XY5.</p><div id="r-401080" data-claire-element-id="401080" data-claire-semantic="question"><p id="r-401079" data-claire-element-id="401079">Comment ?</p></div><p id="r-401081" data-claire-element-id="401081">Il faut parcourir la structure JUMP pour trouver à quel indice <code data-claire-semantic="c">i</code> la condition <code data-claire-semantic="c">0x8475 &amp; jp.masque[i]== jp.id[i]</code> est vraie.<br/> Pour ce cas-ci, <code data-claire-semantic="c">i</code> vaut 15, on a donc <code data-claire-semantic="c">0x8475 &amp; jp.masque[15] == jp.id[15]</code>, soit <code data-claire-semantic="c">0x8475 &amp; 0xF00F == 0x8005</code>, ce qui est vrai. Pour toutes les autres valeurs de <code data-claire-semantic="c">i</code>, cette condition sera toujours fausse. Vérifiez par vous-mêmes pour voir. ^^ <br/> Voici le code de cet algorithme :</p><pre id="r-401082" data-claire-element-id="401082"><code data-claire-semantic="c">//Dans cpu.h
Uint8 recupererAction(Uint16) ;


//Dans cpu.c


Uint8 recupererAction(Uint16 opcode)
{
    Uint8 action;
    Uint16 resultat;

    for(action=0;action&lt;NBROPCODE;action++)
    {
        resultat= (jp.masque[action]&amp;opcode);  /* On récupère les bits concernés par le test, l'identifiant de l'opcode */

        if(resultat == jp.id[action]) /* On a trouvé l'action à effectuer */
           break; /* Plus la peine de continuer la boucle car la condition n'est vraie qu'une seule fois*/
    }

    return action;  //on renvoie l'indice de l'action à effectuer
}</code></pre><aside id="r-401084" data-claire-element-id="401084" data-claire-semantic="warning"><p id="r-401083" data-claire-element-id="401083">Cas spécial : si vous regardez le masque et l'identifiant de l'<em>opcode</em> 0NNN, vous verrez que opcode&amp;0x0000 − qui est toujours égal à 0x0000 − est toujours différent de 0xFFFF. En gros, on ne pourra jamais retrouver action=0. Comme je l'avais dit dans la partie de présentation de la Chip 8, « 0NNN appelle le programme de la RCA 1802 à l'adresse NNN. », cela ne nous intéresse donc pas.</p></aside><p id="r-401085" data-claire-element-id="401085">À présent, pour simuler une instruction, il suffit de placer notre bloc <code data-claire-semantic="c">switch</code>.</p><pre id="r-401086" data-claire-element-id="401086"><code data-claire-semantic="c">//Dans cpu.h

void interpreterOpcode(Uint16) ;


//Dans cpu.c

void interpreterOpcode(Uint16 opcode)
{
    Uint8 b4;

    b4= recupererAction(opcode);   //permet de connaître l'action à effectuer
 
    switch(b4)
    {
     case 0:{
               //Cet opcode n'est pas implémenté
                break;
              }
     case 1:{
               //00E0 : efface l'écran
                break;
               }

     case 2:{//00EE : revient du saut

               
                break;
            }
     case 3:{ //1NNN : effectue un saut à l'adresse 1NNN
                break;
            }
     case 4:{
            //2NNN : appelle le sous-programme en NNN, mais on revient ensuite
                break;
            }
   
          // etc. jusqu'à 34</code></pre><aside id="r-401088" data-claire-element-id="401088" data-claire-semantic="information"><p id="r-401087" data-claire-element-id="401087">Il n'y a aucune condition à poser sur <code>X</code>, <code>Y</code>, <code>N</code>, <code>NN</code> et <code>NNN</code>, ces valeurs seront utilisées pour réaliser l'instruction souhaitée.</p></aside><p id="r-401089" data-claire-element-id="401089">Par exemple, pour l'<em>opcode</em> 0x8XY2, on aura :</p><table id="r-401096" data-claire-element-id="401096"><tbody id="r-401095" data-claire-element-id="401095"><tr id="r-401094" data-claire-element-id="401094"><td id="r-401091" data-claire-element-id="401091"><p id="r-401090" data-claire-element-id="401090">8XY2</p></td><td id="r-401093" data-claire-element-id="401093"><p id="r-401092" data-claire-element-id="401092">Définit VX à VX AND VY.</p></td></tr></tbody></table><p id="r-401097" data-claire-element-id="401097">Le code pour le réaliser est le suivant : il faut récupérer X et Y et effectuer <code>V[X]=V[X]&amp;V[Y]; //C'est trop simple, non ?!</code>.</p><p id="r-401098" data-claire-element-id="401098">Pour récupérer les valeurs de X, Y, NN et NNN, il faut prendre les 12 bits de poids faible et les associer si l'opération en a besoin.</p><pre id="r-401099" data-claire-element-id="401099"><code data-claire-semantic="c">//Ce code sera placé dans la fonction interpreterOpcode
    Uint8 b3,b2,b1;

    b3=(opcode&amp;(0x0F00))&gt;&gt;8;  //on prend les 4 bits, b3 représente X
    b2=(opcode&amp;(0x00F0))&gt;&gt;4;  //idem, b2 représente Y
    b1=(opcode&amp;(0x000F));     //on prend les 4 bits de poids faible

   /*
      Pour obtenir NNN par exemple, il faut faire (b3&lt;&lt;8) + (b2&lt;&lt;4) + (b1)

   */</code></pre><p id="r-401100" data-claire-element-id="401100">Passons maintenant au clou du spectacle : le graphique.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console">L&#039;émulation console</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Notre premier émulateur
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/un-tour-d-horizon-1">Un tour d&#039;horizon</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
Définition de l&#039;émulation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
Les informations sur les consoles de jeu
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
Législation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">Quelle console émuler ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
Critères de sélection
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
La Chip 8
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">La base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
L&#039;implémentation de la machine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
Le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">Simulation des instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
Le cadencement du CPU et les FPS
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
Lecture de l&#039;opcode
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
Identification de l&#039;instruction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
Retour sur le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">Exemples avec quelques instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
Divers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
Le mode de dessin intégré
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
Charger un jeu
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">L&#039;interface homme-machine</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
Les entrées utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
Le son
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/a-vous-de-jouer-21">
À vous de jouer !
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
<span class="arrow"></span>
<span class="next">Lecture de l&#039;opcode</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
<span class="next">Retour sur le graphique</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Retoursurlegraphique"></a><h2>Retour sur le graphique</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
<span class="arrow"></span>
<span class="next">Identification de l&#039;instruction</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">
<span class="next">Exemples avec quelques instructions</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-retour-sur-le-graphique" data-claire-element-id="401148">Retour sur le graphique</h4><p id="r-401104" data-claire-element-id="401104">Mesdames, messieurs, veuillez attacher vos ceintures : nous allons entrer dans une zone de turbulences. :diable: <br/> Pour dessiner à l'écran, la Chip 8 dispose d'un unique <em>opcode</em> (une seule instruction permet de dessiner à l'écran).</p><p id="r-401105" data-claire-element-id="401105"><cite>Citation</cite></p><blockquote id="r-401113" data-claire-element-id="401113"><table id="r-401112" data-claire-element-id="401112"><tbody id="r-401111" data-claire-element-id="401111"><tr id="r-401110" data-claire-element-id="401110"><td id="r-401107" data-claire-element-id="401107"><p id="r-401106" data-claire-element-id="401106">DXYN</p></td><td id="r-401109" data-claire-element-id="401109"><p id="r-401108" data-claire-element-id="401108">Dessine un <em>sprite</em> aux coordonnées (VX, VY).<br/> Le <em>sprite</em> a une largeur de 8 pixels et une hauteur de pixels N.<br/> Chaque rangée de 8 pixels est lue comme codée en binaire à partir de l'emplacement mémoire.<br/> I ne change pas de valeur après l'exécution de cette instruction.</p></td></tr></tbody></table></blockquote><p id="r-401114" data-claire-element-id="401114"><cite>Citation</cite></p><blockquote id="r-401116" data-claire-element-id="401116"><p id="r-401115" data-claire-element-id="401115">Les dessins sont établis à l'écran uniquement par l'intermédiaire de <em>sprites</em>, qui font 8 pixels de large et avec une hauteur qui peut varier de 1 à 15 pixels. Les <em>sprites</em> sont codés en binaire. Pour une valeur de 1, le pixel correspondant est allumé et pour une valeur 0, aucune opération n'est effectuée. Si un pixel d'un <em>sprite</em> est dessiné sur un pixel de l'écran déjà allumé, alors les deux pixels sont éteints. Le registre de retenue (VF) est mis à 1 à cet effet.</p></blockquote><figure id="r-401118" data-claire-element-id="401119"><img id="r-401117" data-claire-element-id="401117" src="medias/uploads.siteduzero.com_files_318001_319000_318793.gif" alt="Image utilisateur"/></figure><p id="r-401120" data-claire-element-id="401120">Comme vous le voyez sur l'image, chaque <em>sprite</em> peut être considéré comme un tableau à deux dimensions. Pour parcourir tout le <em>sprite</em>, il faudra donc deux boucles imbriquées.</p><p id="r-401121" data-claire-element-id="401121">Pour le codage des lignes, on récupère les valeurs dans la mémoire en commençant à l'adresse I. Si par exemple, on doit dessiner un <em>sprite</em> en (0,0) avec une hauteur de 3 et le codage <code>memoire[I]=11010101, memoire[I+1]=00111100 et memoire[I+2]=11100011  //ces nombres sont en binaire</code>, nous devrons obtenir :</p><figure id="r-401123" data-claire-element-id="401124"><img id="r-401122" data-claire-element-id="401122" src="medias/uploads.siteduzero.com_files_322001_323000_322721.gif" alt="Image utilisateur"/></figure><p id="r-401125" data-claire-element-id="401125">Ensuite, si l'on souhaite dessiner un autre <em>sprite</em> en (0,0) avec une hauteur de 2 et le codage <code>memoire[I]=01110101, memoire[I+1]=01110000</code>, nous devrons obtenir :</p><figure id="r-401127" data-claire-element-id="401128"><img id="r-401126" data-claire-element-id="401126" src="medias/uploads.siteduzero.com_files_322001_323000_322722.gif" alt="Image utilisateur"/></figure><p id="r-401129" data-claire-element-id="401129">Pour réaliser tout cela, il faut donc récupérer la couleur du pixel à dessiner, la comparer avec son ancienne valeur et agir en conséquence. On gardera en tête que pour « 0 », la couleur désirée est le noir, et pour « 1 », le blanc. <br/> Voici le code C/SDL qui permet de réaliser tout ce bazar.</p><p id="r-401130" data-claire-element-id="401130"></p><div id="r-401132" data-claire-element-id="401132"><pre id="r-401131" data-claire-element-id="401131"><code data-claire-semantic="c">void dessinerEcran(Uint8 b1,Uint8 b2, Uint8 b3)
{
    Uint8 x=0,y=0,k=0,codage=0,j=0,decalage=0;
    cpu.V[0xF]=0;

     for(k=0;k&lt;b1;k++)
        {
            codage=cpu.memoire[cpu.I+k];//on récupère le codage de la ligne à dessiner

            y=(cpu.V[b2]+k)%L;//on calcule l'ordonnée de la ligne à dessiner, on ne doit pas dépasser L

            for(j=0,decalage=7;j&lt;8;j++,decalage--)
             {
                x=(cpu.V[b3]+j)%l; //on calcule l'abscisse, on ne doit pas dépasser l

                        if(((codage)&amp;(0x1&lt;&lt;decalage))!=0)//on récupère le bit correspondant
                        {   //si c'est blanc
                            if( pixel[x][y].couleur==BLANC)//le pixel était blanc
                            {
                                pixel[x][y].couleur=NOIR; //on l'éteint
                                cpu.V[0xF]=1; //il y a donc collusion

                            }
                            else //sinon
                            {
                                 pixel[x][y].couleur=BLANC;//on l'allume
                            }


                        }

            }
        }

}</code></pre></div><h5 id="r-ligne-importante" data-claire-element-id="401147">Ligne importante</h5><p id="r-401133" data-claire-element-id="401133"><code>(codage)&amp;(0x1&lt;&lt;decalage)</code></p><p id="r-401134" data-claire-element-id="401134">Les décalages pointent encore le bout de leur nez. :p</p><p id="r-401135" data-claire-element-id="401135">Tout d'abord, il faut savoir que <code>0x1=00000001</code> en binaire sur 8 bits. L'instruction <code>0x1&lt;&lt;decalage</code> permet de placer le « 1 » à l'endroit correspondant au codage de notre pixel.</p><p id="r-401136" data-claire-element-id="401136">Si par exemple, nous voulons dessiner le troisième pixel de la ligne, <code>j</code> vaut 2 (l'indice commence par 0) et <code>decalage</code> vaut 5. Donc <code>0x1&lt;&lt;decalage=00100000</code> en binaire sur 8 bits. Le « 1 » se place au troisième rang (il faut compter en partant de la gauche).<br/> Donc, pour récupérer le bit correspondant à notre pixel, il suffit d'appliquer le <code>and ou &amp;</code> et le tour est joué.</p><p id="r-401137" data-claire-element-id="401137">Je vous donne en prime tout le bloc <code data-claire-semantic="c">switch</code> de notre émulateur. Je vous préviens, il fait peur ce bloc. :lol:</p><p id="r-401138" data-claire-element-id="401138"></p><div id="r-401140" data-claire-element-id="401140"><pre id="r-401139" data-claire-element-id="401139"><code data-claire-semantic="c">void interpreter(Uint16 opcode)
{
    Uint8 b4,b3,b2,b1;

    b3=(opcode&amp;(0x0F00))&gt;&gt;8;  //on prend les 4 bits représentant X
    b2=(opcode&amp;(0x00F0))&gt;&gt;4;  //idem pour Y
    b1=(opcode&amp;(0x000F));     //les 4 bits de poids faible

    b4= recupererAction(opcode);

   switch(b4)
    {
     case 0:{
               //Cet opcode n'est pas implémenté.
                break;
              }
     case 1:{
                //00E0 efface l'écran.
                break;
               }

     case 2:{//00EE revient du saut.

               
                break;
            }
    case 3:{ //1NNN effectue un saut à l'adresse 1NNN.

               
                break;
            }
    case 4:{
            //2NNN appelle le sous-programme en NNN, mais on revient ensuite.

                
                break;
            }
    case 5:{//3XNN saute l'instruction suivante si VX est égal à NN.

                

                break;
            }
    case 6:{//4XNN saute l'instruction suivante si VX et NN ne sont pas égaux.
                

                break;
            }
    case 7:{
           //5XY0 saute l'instruction suivante si VX et VY sont égaux.
                
                break;
            }

    case 8:{
            //6XNN définit VX à NN.
               
                break;
            }
    case 9:{
                //7XNN ajoute NN à VX.
                

                break;
            }
    case 10:{
                //8XY0 définit VX à la valeur de VY.
                

                break;
            }
    case 11:{
                //8XY1 définit VX à VX OR VY.

                break;
            }
    case 12:{
                //8XY2 définit VX à VX AND VY.
                
                break;
            }
    case 13:{
                //8XY3 définit VX à VX XOR VY.
               
                break;
            }
    case 14:{
                //8XY4 ajoute VY à VX. VF est mis à 1 quand il y a un dépassement de mémoire (carry), et à 0 quand il n'y en pas.
               

                break;
            }
    case 15:{
                //8XY5 VY est soustraite de VX. VF est mis à 0 quand il y a un emprunt, et à 1 quand il n'y a en pas.
                

                break;
            }
    case 16:{

                //8XY6 décale (shift) VX à droite de 1 bit. VF est fixé à la valeur du bit de poids faible de VX avant le décalage.
               

                break;
            }
    case 17:{
                //8XY7 VX = VY - VX. VF est mis à 0 quand il y a un emprunt et à 1 quand il n'y en a pas.
                break;
            }
    case 18:{
                //8XYE décale (shift) VX à gauche de 1 bit. VF est fixé à la valeur du bit de poids fort de VX avant le décalage.
                

                break;
             }

    case 19:{

                //9XY0 saute l'instruction suivante si VX et VY ne sont pas égaux.
                
                break;
            }
    case 20:{
            //ANNN affecte NNN à I.

                

                break;
            }
    case 21:{
            //BNNN passe à l'adresse NNN + V0.

            

            break;

            }
    case 22:{

            //CXNN définit VX à un nombre aléatoire inférieur à NN.
           

            break;

            }

    case 23:{
            //DXYN dessine un sprite aux coordonnées (VX, VY).

            dessinerEcran(b1,b2,b3);

            break;

            }
    case 24:{
                //EX9E saute l'instruction suivante si la clé stockée dans VX est pressée.
               

                break;
            }
    case 25:{
            //EXA1 saute l'instruction suivante si la clé stockée dans VX n'est pas pressée.
               
                break;
            }

    case 26:{
                //FX07 définit VX à la valeur de la temporisation.
               

                break;
            }
    case 27:{
                //FX0A attend l'appui sur une touche et la stocke ensuite dans VX.
               

                break;
            }


    case 28:{
                //FX15 définit la temporisation à VX.
               

                break;
            }
    case 29:{
                //FX18 définit la minuterie sonore à VX.
                

                break;
            }
    case 30:{
            //FX1E ajoute à VX I. VF est mis à 1 quand il y a overflow (I+VX&gt;0xFFF), et à 0 si tel n'est pas le cas.


                break;
            }

    case 31:{
                //FX29 définit I à l'emplacement du caractère stocké dans VX. Les caractères 0-F (en hexadécimal) sont représentés par une police 4x5.
                

                break;
            }

    case 32:{
                //FX33 stocke dans la mémoire le code décimal représentant VX (dans I, I+1, I+2).

               

                break;
            }
    case 33:{

                //FX55 stocke V0 à VX en mémoire à partir de l'adresse I.
               

                break;
            }
    case 34:{
                //FX65 remplit V0 à VX avec les valeurs de la mémoire à partir de l'adresse I.

               

                break;
            }

    default: {//si ça arrive, il y un truc qui cloche

                    break;
             }

}
    cpu.pc+=2; //on passe au prochain opcode
   
}</code></pre></div><aside id="r-401142" data-claire-element-id="401142" data-claire-semantic="information"><p id="r-401141" data-claire-element-id="401141">Je vous fais remarquer le <code data-claire-semantic="c">pc+=2</code> à la fin du bloc <code data-claire-semantic="c">switch</code>. Après avoir exécuté l'<em>opcode</em>, il faut passer au suivant en incrémentant <code data-claire-semantic="c">pc</code> de 2 et non pas de 1. En effet, dans la fonction de récupération de l'<em>opcode</em>, on prend <code data-claire-semantic="c">memoire[pc]</code><em>et</em><code data-claire-semantic="c">memoire[pc+1]</code></p></aside><figure id="r-401144" data-claire-element-id="401145"><img id="r-401143" data-claire-element-id="401143" src="medias/uploads.siteduzero.com_files_318001_319000_318794.gif" alt="Image utilisateur"/></figure><p id="r-401146" data-claire-element-id="401146">Le gros du travail vient d'être effectué. Il ne nous reste plus qu'à remplir les cases vides de notre <code data-claire-semantic="c">switch</code> avec les instructions qu'il faut, puis le tour est joué. Courage, on entrevoit le bout du tunnel ! :)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console">L&#039;émulation console</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Notre premier émulateur
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/un-tour-d-horizon-1">Un tour d&#039;horizon</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
Définition de l&#039;émulation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
Les informations sur les consoles de jeu
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
Législation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">Quelle console émuler ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
Critères de sélection
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
La Chip 8
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">La base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
L&#039;implémentation de la machine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
Le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">Simulation des instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
Le cadencement du CPU et les FPS
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
Lecture de l&#039;opcode
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
Identification de l&#039;instruction
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
Retour sur le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">Exemples avec quelques instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
Divers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
Le mode de dessin intégré
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
Charger un jeu
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">L&#039;interface homme-machine</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
Les entrées utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
Le son
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/a-vous-de-jouer-21">
À vous de jouer !
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
<span class="arrow"></span>
<span class="next">Identification de l&#039;instruction</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">
<span class="next">Exemples avec quelques instructions</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Exemplesavecquelquesinstructions"></a><h2>Exemples avec quelques instructions</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
<span class="arrow"></span>
<span class="next">Retour sur le graphique</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
<span class="next">Divers</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-401150" data-claire-element-id="401150">Maintenant que le terrain a été bien préparé, il ne nous reste plus qu'à simuler les instructions de calcul une par une. Si vous avez suivi jusque-là, vous n'aurez aucun souci puisque cette partie est la plus facile.</p><aside id="r-401152" data-claire-element-id="401152" data-claire-semantic="information"><p id="r-401151" data-claire-element-id="401151">Pour effectuer les tests, vous n'avez pas besoin d'implémenter les <em>opcodes</em> qui traitent les entrées utilisateur et le son. On les verra plus tard.</p></aside>
</div><a name="Divers"></a><h2>Divers</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">
<span class="arrow"></span>
<span class="next">Exemples avec quelques instructions</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
<span class="next">Le mode de dessin intégré</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-divers-32" data-claire-element-id="401290">Divers</h4><h6 id="r-00E0" data-claire-element-id="401163">00E0</h6><p id="r-401153" data-claire-element-id="401153"><cite>Citation</cite></p><blockquote id="r-401161" data-claire-element-id="401161"><table id="r-401160" data-claire-element-id="401160"><tbody id="r-401159" data-claire-element-id="401159"><tr id="r-401158" data-claire-element-id="401158"><td id="r-401155" data-claire-element-id="401155"><p id="r-401154" data-claire-element-id="401154">00E0</p></td><td id="r-401157" data-claire-element-id="401157"><p id="r-401156" data-claire-element-id="401156">Efface l'écran.</p></td></tr></tbody></table></blockquote><p id="r-401162" data-claire-element-id="401162">Pour effacer l'écran, il suffit de mettre tous les pixels en noir. Et comme nous avions déjà défini une méthode pour modifier les pixels, il faudra juste l'appeler dans la bonne case du <code data-claire-semantic="c">switch</code>.</p><h6 id="r-1nnn" data-claire-element-id="401178">1NNN</h6><p id="r-401164" data-claire-element-id="401164"><cite>Citation</cite></p><blockquote id="r-401172" data-claire-element-id="401172"><table id="r-401171" data-claire-element-id="401171"><tbody id="r-401170" data-claire-element-id="401170"><tr id="r-401169" data-claire-element-id="401169"><td id="r-401166" data-claire-element-id="401166"><p id="r-401165" data-claire-element-id="401165">1NNN</p></td><td id="r-401168" data-claire-element-id="401168"><p id="r-401167" data-claire-element-id="401167">Effectue un saut à l'adresse NNN.</p></td></tr></tbody></table></blockquote><p id="r-401173" data-claire-element-id="401173">La variable qui permet de pointer sur une adresse est le <em>program counter</em> : <code data-claire-semantic="c">pc</code>. Il faudra l'affecter de la valeur NNN-2. Le « -2 » vient du fait qu'il faut aussi prendre en compte l'incrémentation de <code data-claire-semantic="c">pc</code> à la fin du bloc <code data-claire-semantic="c">switch</code>.</p><figure id="r-401175" data-claire-element-id="401176"><img id="r-401174" data-claire-element-id="401174" src="medias/uploads.siteduzero.com_files_318001_319000_318799.png" alt="Image utilisateur"/></figure><pre id="r-401177" data-claire-element-id="401177"><code data-claire-semantic="c">cpu.pc=(b3&lt;&lt;8)+(b2&lt;&lt;4)+b1; //on prend le nombre NNN (pour le saut)
cpu.pc-=2; //n'oublions pas le pc+=2 à la fin du bloc switch</code></pre><h6 id="r-2nnn" data-claire-element-id="401193">2NNN</h6><p id="r-401179" data-claire-element-id="401179"><cite>Citation</cite></p><blockquote id="r-401187" data-claire-element-id="401187"><table id="r-401186" data-claire-element-id="401186"><tbody id="r-401185" data-claire-element-id="401185"><tr id="r-401184" data-claire-element-id="401184"><td id="r-401181" data-claire-element-id="401181"><p id="r-401180" data-claire-element-id="401180">2NNN</p></td><td id="r-401183" data-claire-element-id="401183"><p id="r-401182" data-claire-element-id="401182">Exécute le sous-programme à l'adresse NNN.</p></td></tr></tbody></table></blockquote><p id="r-401188" data-claire-element-id="401188">Cette instruction est proche de la 1NNN. Mais dans ce cas-ci, il faudra récupérer l'ancienne valeur de <code data-claire-semantic="c">pc</code> afin d'y revenir après. La variable <code data-claire-semantic="c">saut</code> sera utilisée.</p><figure id="r-401190" data-claire-element-id="401191"><img id="r-401189" data-claire-element-id="401189" src="medias/uploads.siteduzero.com_files_318001_319000_318800.gif" alt="Image utilisateur"/></figure><pre id="r-401192" data-claire-element-id="401192"><code data-claire-semantic="c">cpu.saut[cpu.nbrsaut]=cpu.pc; //on reste là où on était 

if(cpu.nbrsaut&lt;15)
{
   cpu.nbrsaut++;
}
//sinon, on a effectué trop de sauts
            
cpu.pc=(b3&lt;&lt;8)+(b2&lt;&lt;4)+b1; //on prend le nombre NNN (pour le saut)
cpu.pc-=2; //n'oublions pas le pc+=2 à la fin du block switch</code></pre><h6 id="r-00ee" data-claire-element-id="401208">00EE</h6><p id="r-401194" data-claire-element-id="401194"><cite>Citation</cite></p><blockquote id="r-401202" data-claire-element-id="401202"><table id="r-401201" data-claire-element-id="401201"><tbody id="r-401200" data-claire-element-id="401200"><tr id="r-401199" data-claire-element-id="401199"><td id="r-401196" data-claire-element-id="401196"><p id="r-401195" data-claire-element-id="401195">00EE</p></td><td id="r-401198" data-claire-element-id="401198"><p id="r-401197" data-claire-element-id="401197">Retourne à partir d'un sous-programme.</p></td></tr></tbody></table></blockquote><p id="r-401203" data-claire-element-id="401203">La variable <code data-claire-semantic="c">pc</code> reçoit son ancienne valeur stockée dans <code data-claire-semantic="c">saut</code>.</p><figure id="r-401205" data-claire-element-id="401206"><img id="r-401204" data-claire-element-id="401204" src="medias/uploads.siteduzero.com_files_318001_319000_318807.gif" alt="Image utilisateur"/></figure><pre id="r-401207" data-claire-element-id="401207"><code data-claire-semantic="c">if(cpu.nbrsaut&gt;0)
{
    cpu.nbrsaut--;
    cpu.pc=cpu.saut[cpu.nbrsaut];
}
//sinon, on a effectué plus de retours que de sauts</code></pre><h6 id="r-3xnn" data-claire-element-id="401223">3XNN</h6><p id="r-401209" data-claire-element-id="401209"><cite>Citation</cite></p><blockquote id="r-401217" data-claire-element-id="401217"><table id="r-401216" data-claire-element-id="401216"><tbody id="r-401215" data-claire-element-id="401215"><tr id="r-401214" data-claire-element-id="401214"><td id="r-401211" data-claire-element-id="401211"><p id="r-401210" data-claire-element-id="401210">3XNN</p></td><td id="r-401213" data-claire-element-id="401213"><p id="r-401212" data-claire-element-id="401212">Saute l'instruction suivante si VX est égal à NN.</p></td></tr></tbody></table></blockquote><p id="r-401218" data-claire-element-id="401218">Pour sauter une instruction, il faut juste incrémenter <code data-claire-semantic="c">pc</code> de 2 dans la condition « VX est égal à NN ».<br/> Avec l'incrémentation de <code data-claire-semantic="c">pc</code> à la fin du bloc <code data-claire-semantic="c">switch</code>, on se retrouvera à <code data-claire-semantic="c">pc + 4</code>.</p><figure id="r-401220" data-claire-element-id="401221"><img id="r-401219" data-claire-element-id="401219" src="medias/uploads.siteduzero.com_files_318001_319000_318802.gif" alt="Image utilisateur"/></figure><pre id="r-401222" data-claire-element-id="401222"><code data-claire-semantic="c">if(cpu.V[b3]==((b2&lt;&lt;4)+b1))
 {
    cpu.pc+=2;
 }</code></pre><h6 id="r-8xy0" data-claire-element-id="401235">8XY0</h6><p id="r-401224" data-claire-element-id="401224"><cite>Citation</cite></p><blockquote id="r-401232" data-claire-element-id="401232"><table id="r-401231" data-claire-element-id="401231"><tbody id="r-401230" data-claire-element-id="401230"><tr id="r-401229" data-claire-element-id="401229"><td id="r-401226" data-claire-element-id="401226"><p id="r-401225" data-claire-element-id="401225">8XY0</p></td><td id="r-401228" data-claire-element-id="401228"><p id="r-401227" data-claire-element-id="401227">Définit VX à la valeur de VY.</p></td></tr></tbody></table></blockquote><p id="r-401233" data-claire-element-id="401233">VX reçoit VY.</p><pre id="r-401234" data-claire-element-id="401234"><code data-claire-semantic="c">cpu.V[b3]=cpu.V[b2];</code></pre><h6 id="r-cxnn" data-claire-element-id="401247">CXNN</h6><p id="r-401236" data-claire-element-id="401236"><cite>Citation</cite></p><blockquote id="r-401244" data-claire-element-id="401244"><table id="r-401243" data-claire-element-id="401243"><tbody id="r-401242" data-claire-element-id="401242"><tr id="r-401241" data-claire-element-id="401241"><td id="r-401238" data-claire-element-id="401238"><p id="r-401237" data-claire-element-id="401237">CXNN</p></td><td id="r-401240" data-claire-element-id="401240"><p id="r-401239" data-claire-element-id="401239">Définit VX à un nombre aléatoire inférieur à NN.</p></td></tr></tbody></table></blockquote><p id="r-401245" data-claire-element-id="401245">Avec <code data-claire-semantic="c">(nombre_aleatoire)%(NN+1)</code>, le résultat ne pourra jamais dépasser NN. :magicien: <br/>Je vous épargne la démonstration que vous connaissez sûrement.</p><pre id="r-401246" data-claire-element-id="401246"><code data-claire-semantic="c">cpu.V[b3]=(rand())%((b2&lt;&lt;4)+b1+1);</code></pre><h6 id="r-8xy4" data-claire-element-id="401263">8XY4</h6><p id="r-401248" data-claire-element-id="401248"><cite>Citation</cite></p><blockquote id="r-401256" data-claire-element-id="401256"><table id="r-401255" data-claire-element-id="401255"><tbody id="r-401254" data-claire-element-id="401254"><tr id="r-401253" data-claire-element-id="401253"><td id="r-401250" data-claire-element-id="401250"><p id="r-401249" data-claire-element-id="401249">8XY4</p></td><td id="r-401252" data-claire-element-id="401252"><p id="r-401251" data-claire-element-id="401251">Ajoute VY à VX. VF est mis à 1 quand il y a un dépassement de mémoire (<em>carry</em>), et à 0 quand il n'y en pas.</p></td></tr></tbody></table></blockquote><p id="r-401257" data-claire-element-id="401257">Je profite de cette instruction pour parler un peu de la notion de <em>carry</em>. Lors des calculs, il se peut que le résultat obtenu ne puisse pas être contenu dans notre variable. On parle alors de « dépassement » ou de « <em>carry</em> ». Par exemple, si nous devons effectuer la somme <code data-claire-semantic="c">0xF5+0x12</code>, tout en étant sur 8 bits, le résultat est : <code>0x107</code>. Cette valeur ne peut être contenue sur 8 bits, il y a donc un dépassement en mémoire (<em>carry</em>). Voici un petit schéma pour illustrer le tout :</p><figure id="r-401259" data-claire-element-id="401260"><img id="r-401258" data-claire-element-id="401258" src="medias/uploads.siteduzero.com_files_321001_322000_321878.gif" alt="Image utilisateur"/></figure><p id="r-401261" data-claire-element-id="401261">Dans ce cas-ci, il y a un dépassement si le résultat de l'opération ne peut tenir sur 8 bits (taille des variables Vi). Il faut donc vérifier si la somme VX+VY est inférieure ou supérieure à 0xFF. 0xFF = 255, c'est la valeur maximale que peut prendre un nombre non signé sur 8 bits.</p><pre id="r-401262" data-claire-element-id="401262"><code data-claire-semantic="c">if((cpu.V[b3]+cpu.V[b2])&gt;0xFF)
{
   cpu.V[0xF]=1; //V[15]
}
else
{
    cpu.V[0xF]=0; //V[15]
}
    cpu.V[b3]+=cpu.V[b2];</code></pre><h6 id="r-8xy7" data-claire-element-id="401275">8XY7</h6><p id="r-401264" data-claire-element-id="401264"><cite>Citation</cite></p><blockquote id="r-401272" data-claire-element-id="401272"><table id="r-401271" data-claire-element-id="401271"><tbody id="r-401270" data-claire-element-id="401270"><tr id="r-401269" data-claire-element-id="401269"><td id="r-401266" data-claire-element-id="401266"><p id="r-401265" data-claire-element-id="401265">8XY7</p></td><td id="r-401268" data-claire-element-id="401268"><p id="r-401267" data-claire-element-id="401267">VX = VY - VX. VF est mis à 0 quand il y a un emprunt et à 1 quand il n'y en a pas.</p></td></tr></tbody></table></blockquote><p id="r-401273" data-claire-element-id="401273">Il y a un emprunt si le résultat de l'opération est négatif. I faut alors vérifier que VX &gt; VY ou VY &lt; VX, c'est vous qui voyez. Puisque nous avons déclaré nos variables comme étant non signées, les <em>casts</em> seront effectués pour nous.</p><pre id="r-401274" data-claire-element-id="401274"><code data-claire-semantic="c">if((cpu.V[b2]&lt;cpu.V[b3]))     // /!\ VF est mis à 0 quand il y a emprunt !
  {
      cpu.V[0xF]=0; //cpu.V[15]
  }
  else
  {
      cpu.V[0xF]=1; //cpu.V[15]
  }

cpu.V[b3]=cpu.V[b2]-cpu.V[b3];</code></pre><h6 id="r-fx33" data-claire-element-id="401289">FX33</h6><p id="r-401276" data-claire-element-id="401276"><cite>Citation</cite></p><blockquote id="r-401284" data-claire-element-id="401284"><table id="r-401283" data-claire-element-id="401283"><tbody id="r-401282" data-claire-element-id="401282"><tr id="r-401281" data-claire-element-id="401281"><td id="r-401278" data-claire-element-id="401278"><p id="r-401277" data-claire-element-id="401277">FX33</p></td><td id="r-401280" data-claire-element-id="401280"><p id="r-401279" data-claire-element-id="401279">Stocke dans la mémoire le code décimal représentant VX (dans I, I+1, I+2).</p></td></tr></tbody></table></blockquote><p id="r-401285" data-claire-element-id="401285">Le code décimal communément appelé BCD est la représentation d'un nombre en base 10.<br/> Pour cette instruction, on doit stocker dans <code data-claire-semantic="c">memoire[I]</code> les centaines, dans <code data-claire-semantic="c">memoire[I+1]</code> les dizaines et dans <code data-claire-semantic="c">memoire[I+2]</code> les unités. Le nombre ne peut avoir de milliers ou plus puisqu'il est sur 8 bits. (La valeur maximale est donc 255 non signé.)</p><pre id="r-401286" data-claire-element-id="401286"><code data-claire-semantic="c">cpu.memoire[cpu.I]=(cpu.V[b3]-cpu.V[b3]%100)/100; //stocke les centaines
cpu.memoire[cpu.I+1]=(((cpu.V[b3]-cpu.V[b3]%10)/10)%10);//les dizaines
cpu.memoire[cpu.I+2]=cpu.V[b3]-cpu.memoire[cpu.I]*100-cpu.memoire[cpu.I+1]*10;//les unités</code></pre><aside id="r-401288" data-claire-element-id="401288" data-claire-semantic="warning"><p id="r-401287" data-claire-element-id="401287">Pour ceux qui ont opté pour Java, les variables sont signées. C'est à vous de vérifier que vous ne dépassez pas la capacité des variables non signées ou que votre variable est négative en faisant des <em>casts</em>.<br/> Par exemple, l'instruction <code data-claire-semantic="java">nombre&amp;=0xFFFF</code> permet de maintenir la variable <code data-claire-semantic="java">nombre</code> sur 16 bits.</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console">L&#039;émulation console</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Notre premier émulateur
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/un-tour-d-horizon-1">Un tour d&#039;horizon</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
Définition de l&#039;émulation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
Les informations sur les consoles de jeu
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
Législation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">Quelle console émuler ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
Critères de sélection
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
La Chip 8
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">La base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
L&#039;implémentation de la machine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
Le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">Simulation des instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
Le cadencement du CPU et les FPS
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
Lecture de l&#039;opcode
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
Identification de l&#039;instruction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
Retour sur le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">Exemples avec quelques instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
Divers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
Le mode de dessin intégré
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
Charger un jeu
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">L&#039;interface homme-machine</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
Les entrées utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
Le son
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/a-vous-de-jouer-21">
À vous de jouer !
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">
<span class="arrow"></span>
<span class="next">Exemples avec quelques instructions</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
<span class="next">Le mode de dessin intégré</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lemodededessinintgr"></a><h2>Le mode de dessin intégré</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
<span class="arrow"></span>
<span class="next">Divers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
<span class="next">Charger un jeu</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-le-mode-de-dessin-integre" data-claire-element-id="401322">Le mode de dessin intégré</h4><p id="r-401291" data-claire-element-id="401291"><cite>Citation</cite></p><blockquote id="r-401299" data-claire-element-id="401299"><table id="r-401298" data-claire-element-id="401298"><tbody id="r-401297" data-claire-element-id="401297"><tr id="r-401296" data-claire-element-id="401296"><td id="r-401293" data-claire-element-id="401293"><p id="r-401292" data-claire-element-id="401292">FX29</p></td><td id="r-401295" data-claire-element-id="401295"><p id="r-401294" data-claire-element-id="401294">Définit I à l'emplacement du caractère stocké dans VX. Les caractères 0-F (en hexadécimal) sont représentés par une police 4x5.</p></td></tr></tbody></table></blockquote><div id="r-401301" data-claire-element-id="401301" data-claire-semantic="question"><p id="r-401300" data-claire-element-id="401300">Mais c'est quoi cette histoire ?</p></div><p id="r-401302" data-claire-element-id="401302">Il est vrai que si on se limite à la description, on peut ne pas comprendre de quoi il s'agit (comme je l'avais dit les documentations, ne sont pas très exhaustives sur tous les plans). Après un petit détour <a href="http://devernay.free.fr/hacks/chip8/C8TECH10.HTM#font">sur le Web</a>, on voit que la Chip 8 possède en mémoire les caractères 0, 1, 2, 3, 4, 5, 6, 7, 8, A, B, C, D, E et F.<br/> Comme pour le graphique, ces caractères sont codés en binaire et ont tous une largeur de 4 pixels et une longueur de 5 pixels.<br/> Voici un petit schéma pour éclaircir les idées.</p><figure id="r-401304" data-claire-element-id="401305"><img id="r-401303" data-claire-element-id="401303" src="medias/uploads.siteduzero.com_files_318001_319000_318787.gif" alt="Image utilisateur"/></figure><p id="r-401306" data-claire-element-id="401306">Tous ces caractères seront stockés dans <code data-claire-semantic="c">memoire</code> à partir de l'adresse 0. Si vous vous souvenez, les 512 premiers octets sont inutilisés. Chaque chiffre occupera cinq cases en mémoire.<br/> Le caractère 0 occupera donc : <code data-claire-semantic="c">memoire[0], memoire[1], memoire[2], memoire[3] et memoire[4]</code>.<br/> De même, le caractère 1 occupera : <code data-claire-semantic="c">memoire[5], memoire[6], memoire[7], memoire[8] et memoire[9]</code>.</p><p id="r-401307" data-claire-element-id="401307">N'imaginez même pas la patience qu'il faut pour écrire tout ça sans erreur ni péter un câble. :lol:</p><pre id="r-401308" data-claire-element-id="401308"><code data-claire-semantic="c">void chargerFont()
{
    cpu.memoire[0]=0xF0;cpu.memoire[1]=0x90;cpu.memoire[2]=0x90;cpu.memoire[3]=0x90; cpu.memoire[4]=0xF0; // O

    cpu.memoire[5]=0x20;cpu.memoire[6]=0x60;cpu.memoire[7]=0x20;cpu.memoire[8]=0x20;cpu.memoire[9]=0x70; // 1

    cpu.memoire[10]=0xF0;cpu.memoire[11]=0x10;cpu.memoire[12]=0xF0;cpu.memoire[13]=0x80; cpu.memoire[14]=0xF0; // 2

    cpu.memoire[15]=0xF0;cpu.memoire[16]=0x10;cpu.memoire[17]=0xF0;cpu.memoire[18]=0x10;cpu.memoire[19]=0xF0; // 3

    cpu.memoire[20]=0x90;cpu.memoire[21]=0x90;cpu.memoire[22]=0xF0;cpu.memoire[23]=0x10;cpu.memoire[24]=0x10; // 4

    cpu.memoire[25]=0xF0;cpu.memoire[26]=0x80;cpu.memoire[27]=0xF0;cpu.memoire[28]=0x10;cpu.memoire[29]=0xF0; // 5

    cpu.memoire[30]=0xF0;cpu.memoire[31]=0x80;cpu.memoire[32]=0xF0;cpu.memoire[33]=0x90;cpu.memoire[34]=0xF0; // 6

    cpu.memoire[35]=0xF0;cpu.memoire[36]=0x10;cpu.memoire[37]=0x20;cpu.memoire[38]=0x40;cpu.memoire[39]=0x40; // 7

    cpu.memoire[40]=0xF0;cpu.memoire[41]=0x90;cpu.memoire[42]=0xF0;cpu.memoire[43]=0x90;cpu.memoire[44]=0xF0; // 8

    cpu.memoire[45]=0xF0;cpu.memoire[46]=0x90;cpu.memoire[47]=0xF0;cpu.memoire[48]=0x10;cpu.memoire[49]=0xF0; // 9

    cpu.memoire[50]=0xF0;cpu.memoire[51]=0x90;cpu.memoire[52]=0xF0;cpu.memoire[53]=0x90;cpu.memoire[54]=0x90; // A

    cpu.memoire[55]=0xE0;cpu.memoire[56]=0x90;cpu.memoire[57]=0xE0;cpu.memoire[58]=0x90;cpu.memoire[59]=0xE0; // B

    cpu.memoire[60]=0xF0;cpu.memoire[61]=0x80;cpu.memoire[62]=0x80;cpu.memoire[63]=0x80;cpu.memoire[64]=0xF0; // C

    cpu.memoire[65]=0xE0;cpu.memoire[66]=0x90;cpu.memoire[67]=0x90;cpu.memoire[68]=0x90;cpu.memoire[69]=0xE0; // D

    cpu.memoire[70]=0xF0;cpu.memoire[71]=0x80;cpu.memoire[72]=0xF0;cpu.memoire[73]=0x80;cpu.memoire[74]=0xF0; // E

    cpu.memoire[75]=0xF0;cpu.memoire[76]=0x80;cpu.memoire[77]=0xF0;cpu.memoire[78]=0x80;cpu.memoire[79]=0x80; // F

    //OUF !

}</code></pre><p id="r-401309" data-claire-element-id="401309">En définitive :</p><p id="r-401310" data-claire-element-id="401310"><cite>Citation</cite></p><blockquote id="r-401318" data-claire-element-id="401318"><table id="r-401317" data-claire-element-id="401317"><tbody id="r-401316" data-claire-element-id="401316"><tr id="r-401315" data-claire-element-id="401315"><td id="r-401312" data-claire-element-id="401312"><p id="r-401311" data-claire-element-id="401311">FX29</p></td><td id="r-401314" data-claire-element-id="401314"><p id="r-401313" data-claire-element-id="401313">Définit I à l'emplacement du caractère stocké dans VX.</p></td></tr></tbody></table></blockquote><p id="r-401319" data-claire-element-id="401319">… revient à faire <code data-claire-semantic="c">cpu.I=5*cpu.V[X];</code>.</p><p id="r-401320" data-claire-element-id="401320">Exemple<br/> Si V[X] contient 1, I vaudra 5 qui est l'adresse de début de stockage du caractère 1. <br/> Si V[X] contient 2, I vaudra 10 qui est l'adresse de début de stockage du caractère 2.</p><p id="r-401321" data-claire-element-id="401321">Pour pratiquer un peu, je vous laisse finir les autres instructions. Cette phrase est courte mais ne soyez pas surpris si cela prend quelques heures. :diable:</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console">L&#039;émulation console</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Notre premier émulateur
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/un-tour-d-horizon-1">Un tour d&#039;horizon</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
Définition de l&#039;émulation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
Les informations sur les consoles de jeu
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
Législation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">Quelle console émuler ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
Critères de sélection
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
La Chip 8
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">La base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
L&#039;implémentation de la machine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
Le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">Simulation des instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
Le cadencement du CPU et les FPS
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
Lecture de l&#039;opcode
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
Identification de l&#039;instruction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
Retour sur le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">Exemples avec quelques instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
Divers
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
Le mode de dessin intégré
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
Charger un jeu
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">L&#039;interface homme-machine</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
Les entrées utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
Le son
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/a-vous-de-jouer-21">
À vous de jouer !
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
<span class="arrow"></span>
<span class="next">Divers</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
<span class="next">Charger un jeu</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Chargerunjeu"></a><h2>Charger un jeu</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
<span class="arrow"></span>
<span class="next">Le mode de dessin intégré</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">
<span class="next">L&#039;interface homme-machine</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-charger-un-jeu" data-claire-element-id="401369">Charger un jeu</h4><p id="r-401323" data-claire-element-id="401323">Il ne reste plus qu'à charger nos jeux afin de faire nos premiers tests.<br/> Les <em>roms</em> contiennent toutes les instructions à exécuter, il faudra donc charger le contenu du fichier binaire dans la mémoire.</p><aside id="r-401325" data-claire-element-id="401325" data-claire-semantic="warning"><p id="r-401324" data-claire-element-id="401324">Dans notre cas, les jeux sont chargés à partir de l'adresse <code>512 = 0x200</code>.</p></aside><p id="r-401326" data-claire-element-id="401326">Voici un lien pour télécharger ceux qui nous intéressent : <a href="http://www.rockbox.org/twiki/pub/Main/PluginChip8/GAMES.zip">jeux Chip8</a>. J'ai programmé une <em>rom</em> pour vous afin de tester quelques <em>opcodes</em>. Vous pourrez l'utiliser pour déboguer votre émulateur. Le voici : <a href="http://dl.free.fr/n6gQ2o30Y">BC_Chip8Test</a>.</p><pre id="r-401327" data-claire-element-id="401327"><code data-claire-semantic="c">Uint8 chargerJeu(char *nomJeu)
{
    FILE *jeu=NULL;
    jeu=fopen(nomJeu,&quot;rb&quot;); /* Fichier binaire, donc rb */

    if(jeu!=NULL)
    {
        fread(&amp;cpu.memoire[ADRESSEDEBUT],sizeof(Uint8)*(TAILLEMEMOIRE-ADRESSEDEBUT), 1, jeu);
        fclose(jeu);
        return 1;
    }
    else
    {
      fprintf(stderr,&quot;Problème d'ouverture du fichier&quot;);
      return 0;
    }

}</code></pre><p id="r-401328" data-claire-element-id="401328">Nous sommes fin prêts pour faire nos premiers tests avec la BC-Chip8.</p><p id="r-401329" data-claire-element-id="401329">Voici le code mis à jour.</p><div id="r-401335" data-claire-element-id="401335"><pre id="r-401330" data-claire-element-id="401330"><code data-claire-semantic="c">#ifndef PIXEL_H
#define PIXEL_H
#include &lt;SDL/SDL.h&gt;

#define NOIR  0
#define BLANC 1
#define l 64
#define L 32
#define DIMPIXEL 8
#define WIDTH   l*DIMPIXEL
#define HEIGHT  L*DIMPIXEL

typedef struct
{
    SDL_Rect position; //regroupe l'abscisse et l'ordonnée
    Uint32 couleur;   //comme son nom l'indique, c'est la couleur
} PIXEL;

SDL_Surface *ecran,*carre[2];
PIXEL pixel[l][L];
SDL_Event event;

void initialiserEcran() ;
void initialiserPixel() ;
void dessinerPixel(PIXEL pixel) ;
void effacerEcran() ;
void updateEcran() ;

#endif</code></pre><pre id="r-401331" data-claire-element-id="401331"><code data-claire-semantic="c">#include &quot;pixel.h&quot;

void initialiserPixel()
{

    Uint8 x=0,y=0;

    for(x=0;x&lt;l;x++)
    {
        for(y=0;y&lt;L;y++)
        {
            pixel[x][y].position.x=x*DIMPIXEL;
            pixel[x][y].position.y=y*DIMPIXEL;
            pixel[x][y].couleur=NOIR;
        }
    }

}


void initialiserEcran()
{
    ecran=NULL;
    carre[0]=NULL;
    carre[1]=NULL;

    ecran=SDL_SetVideoMode(WIDTH,HEIGHT,32,SDL_HWSURFACE);
    SDL_WM_SetCaption(&quot;BC-Chip8 By BestCoder&quot;,NULL);

     if(ecran==NULL)
    {
        fprintf(stderr,&quot;Erreur lors du chargement du mode vidéo %s&quot;,SDL_GetError());
        exit(EXIT_FAILURE);
    }


     carre[0]=SDL_CreateRGBSurface(SDL_HWSURFACE,DIMPIXEL,DIMPIXEL,32,0,0,0,0); //le pixel noir
     if(carre[0]==NULL)
     {
	fprintf(stderr,&quot;Erreur lors du chargement de la surface %s&quot;,SDL_GetError());
        exit(EXIT_FAILURE);
     }
     SDL_FillRect(carre[0],NULL,SDL_MapRGB(carre[0]-&gt;format,0x00,0x00,0x00)); //le pixel noir

     carre[1]=SDL_CreateRGBSurface(SDL_HWSURFACE,DIMPIXEL,DIMPIXEL,32,0,0,0,0); //le pixel blanc
     if(carre[1]==NULL)
     {
	fprintf(stderr,&quot;Erreur lors du chargement de la surface %s&quot;,SDL_GetError());
        exit(EXIT_FAILURE);
     }
     SDL_FillRect(carre[1],NULL,SDL_MapRGB(carre[1]-&gt;format,0xFF,0xFF,0xFF));  //le pixel blanc

}

void dessinerPixel(PIXEL pixel)
{
 /* pixel.couleur peut prendre deux valeurs : 0, auquel cas on dessine le pixel en noir, ou 1, on dessine alors le pixel en blanc */
    SDL_BlitSurface(carre[pixel.couleur],NULL,ecran,&amp;pixel.position);
}

void effacerEcran()
{
    //Pour effacer l'écran, on remet tous les pixels en noir
    Uint8 x=0,y=0;
    for(x=0;x&lt;l;x++)
    {
        for(y=0;y&lt;L;y++)
        {
            pixel[x][y].couleur=NOIR;
        }
    }

  //on repeint l'écran en noir
    SDL_FillRect(ecran,NULL,NOIR);
}

void updateEcran()
{
  //On dessine tous les pixels à l'écran
Uint8 x=0,y=0;

 for(x=0;x&lt;l;x++)
    {
        for(y=0;y&lt;L;y++)
        {
             dessinerPixel(pixel[x][y]);
        }
    }

 SDL_Flip(ecran); //on affiche les modifications
}</code></pre><pre id="r-401332" data-claire-element-id="401332"><code data-claire-semantic="c">#ifndef CPU_H
#define CPU_H
#include &quot;pixel.h&quot;

#define TAILLEMEMOIRE 4096
#define ADRESSEDEBUT 512
#define NBROPCODE 35

    typedef struct
    {
        Uint8 memoire[TAILLEMEMOIRE];
        Uint8 V[16]; //le registre
        Uint16 I; //stocke une adresse mémoire ou dessinateur
        Uint16 saut[16]; //pour gérer les sauts dans memoire, 16 au maximum
        Uint8 nbrsaut; //stocke le nombre de sauts effectués pour ne pas dépasser 16
        Uint8 compteurJeu; //compteur pour le graphisme (fréquence de rafraîchissement)
        Uint8 compteurSon; //compteur pour le son
        Uint16 pc; //pour parcourir le tableau memoire
    } CPU;

CPU cpu;


typedef struct
{
    Uint16 masque[NBROPCODE];   //la Chip 8 peut effectuer 35 opérations, chaque opération possédant son masque
    Uint16 id[NBROPCODE];   //idem, chaque opération possède son propre identifiant

}JUMP;

JUMP jp;

void initialiserJump() ;
void initialiserCpu() ;
void decompter() ;
Uint16 recupererOpcode() ;
Uint8 recupererAction(Uint16) ;
void interpreterOpcode(Uint16) ;
void dessinerEcran(Uint8,Uint8,Uint8) ;
void chargerFont() ;
#endif</code></pre><pre id="r-401333" data-claire-element-id="401333"><code data-claire-semantic="c">#include &quot;cpu.h&quot;


void initialiserCpu()
{
  //On initialise le tout

    Uint16 i=0;

    for(i=0;i&lt;TAILLEMEMOIRE;i++)
    {
        cpu.memoire[i]=0;
    }


     for(i=0;i&lt;16;i++)
     {
        cpu.V[i]=0;
        cpu.saut[i]=0;
     }

    cpu.pc=ADRESSEDEBUT;
    cpu.nbrsaut=0;
    cpu.compteurJeu=0;
    cpu.compteurSon=0;
    cpu.I=0;

    initialiserJump(); //n'oubliez surtout pas cette fonction
}


void decompter()
{
    if(cpu.compteurJeu&gt;0)
    cpu.compteurJeu--;

    if(cpu.compteurSon&gt;0)
    cpu.compteurSon--;
}

Uint16 recupererOpcode()
{
    return (cpu.memoire[cpu.pc]&lt;&lt;8)+cpu.memoire[cpu.pc+1];
}


Uint8 recupererAction(Uint16 opcode)
{
    Uint8 action;
    Uint16 resultat;

    for(action=0; action&lt;NBROPCODE;action++)
    {
        resultat= (jp.masque[action]&amp;opcode);  /* On récupère les bits concernés par le test */

        if(resultat == jp.id[action]) /* On a trouvé l'action à effectuer */
           break; /* Plus la peine de continuer la boucle*/
    }

    return action;
}


void interpreterOpcode(Uint16 opcode)
{
   Uint8 b4,b3,b2,b1;

    b3=(opcode&amp;(0x0F00))&gt;&gt;8;  //on prend les 4 bits suivants
    b2=(opcode&amp;(0x00F0))&gt;&gt;4;  //idem
    b1=(opcode&amp;(0x000F));     //idem

    b4= recupererAction(opcode);

    switch(b4)
    {
     case 0:{
               //Cet opcode n'est pas implémenté.
                break;
              }
     case 1:{
            //00E0 efface l'écran.
                effacerEcran();
                break;
               }

     case 2:{
            //00EE revient du saut.

                if(cpu.nbrsaut&gt;0)
                {
                    cpu.nbrsaut--;
                    cpu.pc=cpu.saut[cpu.nbrsaut];
                }
                break;
            }
    case 3:{
            //1NNN effectue un saut à l'adresse 1NNN.

                cpu.pc=(b3&lt;&lt;8)+(b2&lt;&lt;4)+b1; //on prend le nombre NNN (pour le saut)
                cpu.pc-=2; //on verra pourquoi à la fin

                break;
            }
    case 4:{
            //2NNN appelle le sous-programme en NNN, mais on revient ensuite.

                cpu.saut[cpu.nbrsaut]=cpu.pc; //on reste là où on était

                if(cpu.nbrsaut&lt;15)
                {
                    cpu.nbrsaut++;
                }

                cpu.pc=(b3&lt;&lt;8)+(b2&lt;&lt;4)+b1; //on prend le nombre NNN (pour le saut)
                cpu.pc-=2; //on verra pourquoi à la fin

                break;
            }
    case 5:{
            //3XNN saute l'instruction suivante si VX est égal à NN.

                if(cpu.V[b3]==((b2&lt;&lt;4)+b1))
                {
                    cpu.pc+=2;
                }

                break;
            }
    case 6:{
            //4XNN saute l'instruction suivante si VX et NN ne sont pas égaux.
                if(cpu.V[b3]!=((b2&lt;&lt;4)+b1))
                {
                    cpu.pc+=2;
                }

                break;
            }
    case 7:{
           //5XY0 saute l'instruction suivante si VX et VY sont égaux.
                if(cpu.V[b3]==cpu.V[b2])
                {
                    cpu.pc+=2;
                }

                break;
            }

    case 8:{
            //6XNN définit VX à NN.
                cpu.V[b3]=(b2&lt;&lt;4)+b1;
                break;
            }
    case 9:{
                //7XNN ajoute NN à VX.
                cpu.V[b3]+=(b2&lt;&lt;4)+b1;

                break;
            }
    case 10:{
                //8XY0 définit VX à la valeur de VY.
                cpu.V[b3]=cpu.V[b2];

                break;
            }
    case 11:{
                //8XY1 définit VX à VX OR VY.
                cpu.V[b3]=cpu.V[b3]|cpu.V[b2];

                break;
            }
    case 12:{
                //8XY2 définit VX à VX AND VY.
                cpu.V[b3]=cpu.V[b3]&amp;cpu.V[b2];

                break;
            }
    case 13:{
                //8XY3 définit VX à VX XOR VY.
                cpu.V[b3]=cpu.V[b3]^cpu.V[b2];

                break;
            }
    case 14:{
                //8XY4 ajoute VY à VX. VF est mis à 1 quand il y a un dépassement de mémoire (carry), et à 0 quand il n'y en pas.
                if((cpu.V[b3]+cpu.V[b2])&gt;255)
                {
                    cpu.V[0xF]=1; //cpu.V[15]
                }
                else
                {
                    cpu.V[0xF]=0; //cpu.V[15]
                }
                cpu.V[b3]+=cpu.V[b2];

                break;
            }
    case 15:{
                //8XY5 VY est soustraite de VX. VF est mis à 0 quand il y a un emprunt, et à 1 quand il n'y a en pas.

                if((cpu.V[b3]&lt;cpu.V[b2]))
                {
                    cpu.V[0xF]=0; //cpu.V[15]
                }
                else
                {
                    cpu.V[0xF]=1; //cpu.V[15]
                }
                cpu.V[b3]-=cpu.V[b2];

                break;
            }
    case 16:{
                //8XY6 décale (shift) VX à droite de 1 bit. VF est fixé à la valeur du bit de poids faible de VX avant le décalage.
                cpu.V[0xF]=(cpu.V[b3]&amp;(0x01));
                cpu.V[b3]=(cpu.V[b3]&gt;&gt;1);

                break;
            }
    case 17:{
                //8XY7 VX = VY - VX. VF est mis à 0 quand il y a un emprunt et à 1 quand il n'y en a pas.
                if((cpu.V[b2]&lt;cpu.V[b3]))
                {
                    cpu.V[0xF]=0; //cpu.V[15]
                }
                else
                {
                    cpu.V[0xF]=1; //cpu.V[15]
                }
                cpu.V[b3]=cpu.V[b2]-cpu.V[b3];

                break;
            }
    case 18:{
                //8XYE décale (shift) VX à gauche de 1 bit. VF est fixé à la valeur du bit de poids fort de VX avant le décalage.
                cpu.V[0xF]=(cpu.V[b3]&gt;&gt;7);
                cpu.V[b3]=(cpu.V[b3]&lt;&lt;1);

                break;
             }

    case 19:{
                //9XY0 saute l'instruction suivante si VX et VY ne sont pas égaux.
                if(cpu.V[b3]!=cpu.V[b2])
                    {
                        cpu.pc+=2;
                    }

                break;
            }
    case 20:{
            //ANNN affecte NNN à I.

                cpu.I=(b3&lt;&lt;8)+(b2&lt;&lt;4)+b1;

                break;
            }
    case 21:{
           //BNNN passe à l'adresse NNN + V0.

            cpu.pc=(b3&lt;&lt;8)+(b2&lt;&lt;4)+b1+cpu.V[0];
            cpu.pc-=2;

            break;

            }
    case 22:{
            //CXNN définit VX à un nombre aléatoire inférieur à NN.
            cpu.V[b3]=(rand())%((b2&lt;&lt;4)+b1+1);

            break;

            }

    case 23:{
           //DXYN dessine un sprite aux coordonnées (VX, VY).


            dessinerEcran(b1,b2,b3) ;

            break;

            }
    case 24:{
                 //EX9E saute l'instruction suivante si la clé stockée dans VX est pressée.
               

                break;
            }
    case 25:{
                //EXA1 saute l'instruction suivante si la clé stockée dans VX n'est pas pressée.
                

                break;
            }

    case 26:{
                 //FX07 définit VX à la valeur de la temporisation.
                cpu.V[b3]=cpu.compteurJeu;

                break;
            }
    case 27:{
                //FX0A attend l'appui sur une touche et stocke ensuite la donnée dans VX.
                

                break;
            }


    case 28:{
               //FX15 définit la temporisation à VX.
                cpu.compteurJeu=cpu.V[b3];

                break;
            }
    case 29:{
                //FX18 définit la minuterie sonore à VX.
                cpu.compteurSon=cpu.V[b3];

                break;
            }
    case 30:{
             //FX1E ajoute VX à I. VF est mis à 1 quand il y a overflow (I+VX&gt;0xFFF), et à 0 si tel n'est pas le cas.

                if((cpu.I+cpu.V[b3])&gt;0xFFF)
                {
                    cpu.V[0xF]=1;
                }
                else
                {
                    cpu.V[0xF]=0;
                }
                cpu.I+=cpu.V[b3];


                break;
            }

    case 31:{
                 //FX29 définit I à l'emplacement du caractère stocké dans VX. Les caractères 0-F (en hexadécimal) sont représentés par une police 4x5.
                cpu.I=cpu.V[b3]*5;

                break;
            }

    case 32:{
                //FX33 stocke dans la mémoire le code décimal représentant VX (dans I, I+1, I+2).

                cpu.memoire[cpu.I]=(cpu.V[b3]-cpu.V[b3]%100)/100;
                cpu.memoire[cpu.I+1]=(((cpu.V[b3]-cpu.V[b3]%10)/10)%10);
                cpu.memoire[cpu.I+2]=cpu.V[b3]-cpu.memoire[cpu.I]*100-10*cpu.memoire[cpu.I+1];

                break;
            }
    case 33:{
                //FX55 stocke V0 à VX en mémoire à partir de l'adresse I.
                Uint8 i=0;
                for(i=0;i&lt;=b3;i++)
                {
                    cpu.memoire[cpu.I+i]=cpu.V[i];
                }

                break;
            }
    case 34:{
                 //FX65 remplit V0 à VX avec les valeurs de la mémoire à partir de l'adresse I.

                Uint8 i=0;

                for(i=0;i&lt;=b3;i++)
                {
                  cpu.V[i]=cpu.memoire[cpu.I+i];
                }

                break;
            }

    default: { //si ça arrive, il y un truc qui cloche

                    break;
             }

   }
    cpu.pc+=2; //on passe au prochain opcode
   
}

void dessinerEcran(Uint8 b1,Uint8 b2, Uint8 b3)
{
    Uint8 x=0,y=0,k=0,codage=0,j=0,decalage=0;
    cpu.V[0xF]=0;

     for(k=0;k&lt;b1;k++)
        {
            codage=cpu.memoire[cpu.I+k]; //on récupère le codage de la ligne à dessiner

            y=(cpu.V[b2]+k)%L; //on calcule l'ordonnée de la ligne à dessiner, on ne doit pas dépasser L

            for(j=0,decalage=7;j&lt;8;j++,decalage--)
             {
                x=(cpu.V[b3]+j)%l; //on calcule l'abscisse, on ne doit pas dépasser l

                        if(((codage)&amp;(0x1&lt;&lt;decalage))!=0) //on récupère le bit correspondant
                        {   //si c'est blanc
                            if( pixel[x][y].couleur==BLANC) //le pixel était blanc
                            {
                                pixel[x][y].couleur=NOIR; //on l'éteint
                                cpu.V[0xF]=1; //il y a donc collusion

                            }
                            else //sinon
                            {
                                 pixel[x][y].couleur=BLANC; //on l'allume
                            }

                        }
              }
        }
}</code></pre><pre id="r-401334" data-claire-element-id="401334"><code data-claire-semantic="c">#include &lt;SDL/SDL.h&gt;
#include &quot;cpu.h&quot;

#define VITESSECPU 4 //nombre d'opérations par tour
#define FPS 16      //pour le rafraîchissement

void initialiserSDL();
void quitterSDL();
void pause();
Uint8 chargerJeu(char *);
Uint8 listen();

int main(int argc, char *argv[])
{
    initialiserSDL() ;
    initialiserEcran() ;
    initialiserPixel() ;

    Uint8 continuer=1,demarrer=0,compteur=0;

    demarrer=chargerJeu(&quot;MAZE.ch8&quot;) ;

    if(demarrer==1)
    {
      do
      {
          continuer=listen() ; //afin de pouvoir quitter l'émulateur

          for(compteur=0;compteur&lt;VITESSECPU;compteur++)
          {
           interpreterOpcode(recupererOpcode()) ;
          }

         updateEcran();
         decompter();
         SDL_Delay(FPS); //une pause de 16 ms

      }while(continuer==1);

   }

   pause();


return EXIT_SUCCESS;
}


void initialiserSDL()
{
    atexit(quitterSDL) ;

    if(SDL_Init(SDL_INIT_VIDEO)==-1)
    {
        fprintf(stderr,&quot;Erreur lors de l'initialisation de la SDL %s&quot;,SDL_GetError());
        exit(EXIT_FAILURE) ;
    }

}


void quitterSDL()
{

    SDL_FreeSurface(carre[0]) ;
    SDL_FreeSurface(carre[1]) ;
    SDL_Quit() ;
}

void pause()
{

    Uint8 continuer=1;

    do
    {
        SDL_WaitEvent(&amp;event) ;

        switch(event.type)
         {
             case SDL_QUIT:
                    continuer=0;
                    break;
             case SDL_KEYDOWN:
                    continuer=0;
                    break;
             default: break;
         }
    }while(continuer==1);

}


Uint8 chargerJeu(char *nomJeu)
{
    FILE *jeu=NULL;
    jeu=fopen(nomJeu,&quot;rb&quot;) ;

    if(jeu!=NULL)
    {
        fread(&amp;cpu.memoire[ADRESSEDEBUT],sizeof(Uint8)*(TAILLEMEMOIRE-ADRESSEDEBUT), 1, jeu) ;
        fclose(jeu) ;
        return 1 ;
    }
    else
    {
      fprintf(stderr,&quot;Problème d'ouverture du fichier&quot;) ;
      return 0;
    }

}


Uint8 listen()
{

Uint8 continuer=1;
while(SDL_PollEvent(&amp;event))
{
        switch(event.type)
            {
                case SDL_QUIT: {continuer = 0;break;}
                case SDL_KEYDOWN:{continuer=0 ;break;}

                default:{ break;}
            }
}
    return continuer;
}</code></pre></div><h6 id="r-quelques-explications-13" data-claire-element-id="401368">Quelques explications</h6><p id="r-401336" data-claire-element-id="401336">Jetez un coup d'œil dans le <em>main</em> (et rien que le <em>main</em>, O.K. ?! :p ). Vous pourrez remarquer une fonction <code data-claire-semantic="c">listen()</code>. Cette fonction n'a rien à voir avec l'émulation : elle nous permet de quitter la boucle principale.<br/> Ensuite, nous avons :</p><pre id="r-401337" data-claire-element-id="401337"><code data-claire-semantic="c">for(compteur=0;compteur&lt;VITESSECPU;compteur++) //on effectue quatre opérations
{
  interpreterOpcode(recupererOpcode());
}

 updateEcran();
 decompter(); //les timers

 SDL_Delay(FPS); //une pause de 16 ms</code></pre><p id="r-401338" data-claire-element-id="401338">C'est ici que réside le code qui illustre la partie « Le cadencement du CPU et les FPS ».<br/> Pour chaque tour de boucle, nous avons :</p><ul id="r-401345" data-claire-element-id="401345"><li id="r-401340" data-claire-element-id="401340"><p id="r-401339" data-claire-element-id="401339">les quatre opérations à effectuer grâce au <code data-claire-semantic="c">for</code> ;</p></li><li id="r-401342" data-claire-element-id="401342"><p id="r-401341" data-claire-element-id="401341">l'actualisation de l'écran grâce à <code data-claire-semantic="c">updateEcran()</code> ;</p></li><li id="r-401344" data-claire-element-id="401344"><p id="r-401343" data-claire-element-id="401343">et la pause de 16 ms grâce à <code data-claire-semantic="c">SDL_Delay()</code>.</p></li></ul><p id="r-401346" data-claire-element-id="401346">N'oubliez pas non plus d'appeler la fonction <code data-claire-semantic="c">decompter();</code> qui nous permet de décompter à 60 Hz.<br/> Ainsi, on respecte les spécifications que l'on s'est fixées au début. ;)</p><p id="r-401347" data-claire-element-id="401347">Après cela, on est aux anges. :ange:</p><table id="r-401362" data-claire-element-id="401362"><thead id="r-401353" data-claire-element-id="401353"><tr id="r-401352" data-claire-element-id="401352"><th id="r-401349" data-claire-element-id="401349"><p id="r-401348" data-claire-element-id="401348">MAZE</p></th><th id="r-401351" data-claire-element-id="401351"><p id="r-401350" data-claire-element-id="401350">Test/C8PIC</p></th></tr></thead><tbody id="r-401361" data-claire-element-id="401361"><tr id="r-401360" data-claire-element-id="401360"><td id="r-401355" data-claire-element-id="401356"><img id="r-401356" data-claire-element-id="401355" src="medias/uploads.siteduzero.com_files_318001_319000_318327.gif" alt="Image utilisateur"/><img id="r-401354" data-claire-element-id="401354" src="medias/uploads.siteduzero.com_files_318001_319000_318327.gif" alt="Image utilisateur"/></td><td id="r-401358" data-claire-element-id="401359"><img id="r-401359" data-claire-element-id="401358" src="medias/uploads.siteduzero.com_files_318001_319000_318328.gif" alt="Image utilisateur"/><img id="r-401357" data-claire-element-id="401357" src="medias/uploads.siteduzero.com_files_318001_319000_318328.gif" alt="Image utilisateur"/></td></tr></tbody></table><p id="r-401363" data-claire-element-id="401363">Ça fait beaucoup de bien d'obtenir ces résultats. Je dirais que l'émulation est vraiment magique. :magicien: <br/> Avec des décalages par-ci, des XOR par-là, on arrive à faire des choses incroyables !</p><p id="r-401364" data-claire-element-id="401364">Tout est bien qui finit bien. Notre émulateur donne des résultats plus que satisfaisants. Il ne nous reste plus qu'à implémenter le son et les entrées utilisateur, et ce sera terminé.</p><div id="r-401366" data-claire-element-id="401366" data-claire-semantic="question"><p id="r-401365" data-claire-element-id="401365">Qui a vu de l'assembleur ici ?</p></div><p id="r-401367" data-claire-element-id="401367">Pas moi, en tout cas. ^^</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console">L&#039;émulation console</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Notre premier émulateur
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/un-tour-d-horizon-1">Un tour d&#039;horizon</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
Définition de l&#039;émulation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
Les informations sur les consoles de jeu
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
Législation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">Quelle console émuler ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
Critères de sélection
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
La Chip 8
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">La base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
L&#039;implémentation de la machine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
Le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">Simulation des instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
Le cadencement du CPU et les FPS
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
Lecture de l&#039;opcode
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
Identification de l&#039;instruction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
Retour sur le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">Exemples avec quelques instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
Divers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
Le mode de dessin intégré
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
Charger un jeu
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">L&#039;interface homme-machine</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
Les entrées utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
Le son
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/a-vous-de-jouer-21">
À vous de jouer !
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
<span class="arrow"></span>
<span class="next">Le mode de dessin intégré</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">
<span class="next">L&#039;interface homme-machine</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="L039interfacehomme-machine"></a><h2>L&#039;interface homme-machine</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
<span class="arrow"></span>
<span class="next">Charger un jeu</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
<span class="next">Les entrées utilisateur</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-401371" data-claire-element-id="401371">Maintenant que notre émulateur donne des résultats palpables, nous allons nous occuper des entrées utilisateur et du son.<br/> Allez… plus que quelques lignes et c'est fini !</p>
</div><a name="Lesentresutilisateur"></a><h2>Les entrées utilisateur</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">
<span class="arrow"></span>
<span class="next">L&#039;interface homme-machine</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
<span class="next">Le son</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-entrees-utilisateur" data-claire-element-id="401423">Les entrées utilisateur</h4><h6 id="r-entrees-utilisateur" data-claire-element-id="401386">Entrées utilisateur</h6><p id="r-401372" data-claire-element-id="401372"><cite>Citation</cite></p><blockquote id="r-401374" data-claire-element-id="401374"><p id="r-401373" data-claire-element-id="401373">L'entrée est faite avec un clavier qui possède 16 touches allant de 0 à F. Les touches « 8 », « 4 », « 6 » et « 2 » sont généralement utilisées pour l'entrée directionnelle.</p></blockquote><figure id="r-401376" data-claire-element-id="401377"><img id="r-401375" data-claire-element-id="401375" src="medias/uploads.siteduzero.com_files_318001_319000_318796.gif" alt="Image utilisateur"/></figure><p id="r-401378" data-claire-element-id="401378">Pour simuler ce clavier, nous allons utiliser le pavé numérique et la touche de direction droite. Ce choix est purement subjectif. Vous pourrez le modifier à votre guise si vous avez bien compris. <a href="medias/uploads.siteduzero.com_files_327001_328000_327725.gif">http://uploads.siteduzero.com/files/32 [...] 00/327725.gif</a></p><figure id="r-401380" data-claire-element-id="401381"><img id="r-401379" data-claire-element-id="401379" src="medias/uploads.siteduzero.com_files_318001_319000_318797.gif" alt="Image utilisateur"/></figure><p id="r-401382" data-claire-element-id="401382">Il nous faudra une variable pour connaître l'état des boutons (pressés ou non). Pour ma part, j'ai utilisé un tableau de 16 Uint8 pour nos 16 boutons.<br/> Et pour gérer les changements d'état de nos touches (pressé ou relâché), nous allons utiliser les événements « KEYDOWN » et « KEYUP » de SDL. On aura quelque chose qui ressemblera à ceci (les variables touches seront insérées dans la structure CPU).</p><pre id="r-401383" data-claire-element-id="401383"><code data-claire-semantic="c">Uint8 listen()
{

Uint8 continuer=1;
 while( SDL_PollEvent(&amp;event))
   {
                    switch(event.type)
                    {
                        case SDL_QUIT: {continuer = 0;break;}
                        case SDL_KEYDOWN:{
                                            switch(event.key.keysym.sym)
                                            {
                                                case SDLK_KP0:{ cpu.touche[0x0]=1;break;}
                                                case SDLK_KP7:{ cpu.touche[0x1]=1;break;}
                                                case SDLK_KP8:{ cpu.touche[0x2]=1;break;}
                                                /*
                                                  Et toutes les autres touches
                                                */
                                                default:{ break;}
                                            } ;break;}
                            case SDL_KEYUP:{
                                            switch(event.key.keysym.sym)
                                            {
                                                case SDLK_KP0:{ cpu.touche[0x0]=0;break;}
                                                case SDLK_KP7:{ cpu.touche[0x1]=0;break;}
                                                case SDLK_KP8:{ cpu.touche[0x2]=0;break;}
                                                 /* 
                                                   Et toutes les autres touches
                                                 */
                                                default:{ break;}
                                            } ;break;}

                        default:{ break;}
                    }

     }
        
return continuer;
}</code></pre><aside id="r-401385" data-claire-element-id="401385" data-claire-semantic="information"><p id="r-401384" data-claire-element-id="401384">J'ai adopté la convention suivante : « 0 » signifie que la touche est relâchée, « 1 » que la touche est pressée.</p></aside><h6 id="r-traitement-des-opcodes" data-claire-element-id="401417">Traitement des <em>opcodes</em></h6><p id="r-401387" data-claire-element-id="401387">On peut maintenant revenir sur tous les <em>opcodes</em> qui traitent les entrées utilisateur.</p><p id="r-401388" data-claire-element-id="401388"><cite>Citation</cite></p><blockquote id="r-401401" data-claire-element-id="401401"><table id="r-401400" data-claire-element-id="401400"><tbody id="r-401399" data-claire-element-id="401399"><tr id="r-401393" data-claire-element-id="401393"><td id="r-401390" data-claire-element-id="401390"><p id="r-401389" data-claire-element-id="401389">EXA1</p></td><td id="r-401392" data-claire-element-id="401392"><p id="r-401391" data-claire-element-id="401391">Saute l'instruction suivante si la clé stockée dans VX n'est pas pressée.</p></td></tr><tr id="r-401398" data-claire-element-id="401398"><td id="r-401395" data-claire-element-id="401395"><p id="r-401394" data-claire-element-id="401394">EX9E</p></td><td id="r-401397" data-claire-element-id="401397"><p id="r-401396" data-claire-element-id="401396">Saute l'instruction suivante si la clé stockée dans VX est pressée.</p></td></tr></tbody></table></blockquote><p id="r-401402" data-claire-element-id="401402">Ces deux instructions sont relativement simples. La variable <code data-claire-semantic="c">VX</code> contiendra un nombre variant de 0 à 15 (pour nos 16 touches). Il faudra vérifier la valeur de <code data-claire-semantic="c">touche[VX]</code> et agir en conséquence. Comme nous l'avons déjà vu précédemment pour sauter une instruction, il suffit d'incrémenter <code data-claire-semantic="c">pc</code> de 2.</p><pre id="r-401403" data-claire-element-id="401403"><code data-claire-semantic="c">//EX9E saute l'instruction suivante si la clé stockée dans VX est pressée.
if(cpu.touche[V[b3]]==1) //1 = pressé ; 0 = relâché
{
   cpu.pc+=2;
}

//EXA1 saute l'instruction suivante si la clé stockée dans VX n'est pas pressée.
if(cpu.touche[V[b3]]==0) //1 = pressé ; 0 = relâché
{
  cpu.pc+=2;
}</code></pre><p id="r-401404" data-claire-element-id="401404">Et pour finir avec le clavier, on a :</p><p id="r-401405" data-claire-element-id="401405"><cite>Citation</cite></p><blockquote id="r-401413" data-claire-element-id="401413"><table id="r-401412" data-claire-element-id="401412"><tbody id="r-401411" data-claire-element-id="401411"><tr id="r-401410" data-claire-element-id="401410"><td id="r-401407" data-claire-element-id="401407"><p id="r-401406" data-claire-element-id="401406">FX0A</p></td><td id="r-401409" data-claire-element-id="401409"><p id="r-401408" data-claire-element-id="401408">L'appui sur une touche est attendu, puis la valeur correspondante est stockée dans VX.</p></td></tr></tbody></table></blockquote><p id="r-401414" data-claire-element-id="401414">Pour attendre l'appui sur une touche, on peut utiliser la fonction <code data-claire-semantic="c">SDL_WaitEvent</code>. Cette fonction s'exécute tant qu'aucune touche du jeu n'est appuyée. Si une touche quelconque est pressée, on inscrit sa valeur dans VX.<br/> Voici le code correspondant :</p><pre id="r-401415" data-claire-element-id="401415"><code data-claire-semantic="c">Uint8 attendAppui(Uint8 b3)
{
    Uint8 attend=1,continuer=1;

    while(attend)
    {
        SDL_WaitEvent(&amp;event);

            switch(event.type)
            {
                 case SDL_QUIT:{ continuer=0; attend=0; break;}

                case SDL_KEYDOWN:{

                    switch(event.key.keysym.sym)
                    {

                            case SDLK_KP0:{ cpu.V[b3]=0x0;cpu.touche[0x0]=1;attend=0;break;}
                            case SDLK_KP7:{ cpu.V[b3]=0x1;cpu.touche[0x1]=1;attend=0;break;}
                            case SDLK_KP8:{ cpu.V[b3]=0x2;cpu.touche[0x2]=1;attend=0;break;}
                            /* Et le reste des touches */
                            default:{ break;}
                    } break;}

          default:{ break;}
      }
    }

 return continuer;
}</code></pre><p id="r-401416" data-claire-element-id="401416">J'ai inséré quelques attributs supplémentaires car je ne voulais pas que l'utilisateur n'ait pas la possibilité de quitter l'émulateur lorsque la fonction est en cours d'exécution. Mais si vous avez compris le principe, le code ne devrait pas poser de problème.</p><h6 id="r-testons-le-tout" data-claire-element-id="401422">Testons le tout</h6><p id="r-401418" data-claire-element-id="401418">Vous pouvez maintenant lancer un jeu comme « Breakout », par exemple. Si tout se passe bien, vous devriez obtenir quelque chose ressemblant à ceci :</p><figure id="r-401420" data-claire-element-id="401421"><img id="r-401419" data-claire-element-id="401419" src="medias/uploads.siteduzero.com_files_327001_328000_327725.gif" alt="Image utilisateur"/></figure>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console">L&#039;émulation console</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Notre premier émulateur
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/un-tour-d-horizon-1">Un tour d&#039;horizon</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
Définition de l&#039;émulation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
Les informations sur les consoles de jeu
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
Législation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">Quelle console émuler ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
Critères de sélection
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
La Chip 8
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">La base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
L&#039;implémentation de la machine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
Le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">Simulation des instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
Le cadencement du CPU et les FPS
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
Lecture de l&#039;opcode
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
Identification de l&#039;instruction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
Retour sur le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">Exemples avec quelques instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
Divers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
Le mode de dessin intégré
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
Charger un jeu
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">L&#039;interface homme-machine</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
Les entrées utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
Le son
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/a-vous-de-jouer-21">
À vous de jouer !
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">
<span class="arrow"></span>
<span class="next">L&#039;interface homme-machine</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
<span class="next">Le son</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Leson"></a><h2>Le son</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
<span class="arrow"></span>
<span class="next">Les entrées utilisateur</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/a-vous-de-jouer-21">
<span class="next">À vous de jouer !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-le-son-1" data-claire-element-id="401430">Le son</h4><p id="r-401424" data-claire-element-id="401424"><cite>Citation : Minuterie sonore</cite></p><blockquote id="r-401426" data-claire-element-id="401426"><p id="r-401425" data-claire-element-id="401425">Cette minuterie est utilisée pour les effets sonores. Lorsque sa valeur est différente de zéro, un signal sonore est émis.</p></blockquote><p id="r-401427" data-claire-element-id="401427">Le système sonore de la Chip 8 est relativement simple. Nous avions déjà déclaré notre minuterie sonore ; il suffit juste de poser une condition sur la variable <code>compteurSon</code> et de jouer un bip sonore de préférence si sa valeur est différente de zéro. Je ne vais pas détailler les méthodes pour charger un son. Personnellement, j'utilise SDL_Mixer.</p><pre id="r-401428" data-claire-element-id="401428"><code data-claire-semantic="c">if(cpu.compteurSon!=0)
 {
    Mix_PlayChannel(0, son, 0); //permet de jouer le bip sonore
    cpu.compteurSon=0;
 }
//Rien de plus simple ^_^</code></pre><p id="r-401429" data-claire-element-id="401429">Pour ceux qui utilisent des bibliothèques haut niveau, il arrivera un moment où émuler le son deviendra impossible. N'hésitez donc pas à faire des recherches sur le son numérique en général pour vos futurs émulateurs.<br/> Si toutes les caractéristiques essentielles ont été implémentées, il ne reste plus qu'à mettre en place l'interface homme-machine et apporter d'éventuelles améliorations à notre émulateur. À partir de là, c'est chacun pour soi ! :lol:</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console">L&#039;émulation console</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Notre premier émulateur
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/un-tour-d-horizon-1">Un tour d&#039;horizon</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
Définition de l&#039;émulation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
Les informations sur les consoles de jeu
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
Législation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">Quelle console émuler ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
Critères de sélection
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
La Chip 8
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">La base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
L&#039;implémentation de la machine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
Le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">Simulation des instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
Le cadencement du CPU et les FPS
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
Lecture de l&#039;opcode
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
Identification de l&#039;instruction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
Retour sur le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">Exemples avec quelques instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
Divers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
Le mode de dessin intégré
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
Charger un jeu
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">L&#039;interface homme-machine</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
Les entrées utilisateur
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
Le son
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/a-vous-de-jouer-21">
À vous de jouer !
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
<span class="arrow"></span>
<span class="next">Les entrées utilisateur</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/a-vous-de-jouer-21">
<span class="next">À vous de jouer !</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="vousdejouer"></a><h2>À vous de jouer !</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
<span class="arrow"></span>
<span class="next">Le son</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-a-vous-de-jouer-21" data-claire-element-id="401489">À vous de jouer !</h4><h5 id="r-ameliorations-20" data-claire-element-id="401449">Améliorations</h5><p id="r-401431" data-claire-element-id="401431">Pour finir notre émulateur, j'ai rajouté quelques fonctionnalités, à savoir :</p><ul id="r-401436" data-claire-element-id="401436"><li id="r-401433" data-claire-element-id="401433"><p id="r-401432" data-claire-element-id="401432">faire une pause ;</p></li><li id="r-401435" data-claire-element-id="401435"><p id="r-401434" data-claire-element-id="401434">redémarrer un jeu.</p></li></ul><p id="r-401437" data-claire-element-id="401437">Je ne détaillerai pas les actions effectuées, mais vous pouvez ajouter plein d'autres choses à votre émulateur : créer un système de sauvegarde, faire un écran de taille réglable, élaborer une interface pour faciliter le lancement des jeux, etc.</p><p id="r-401438" data-claire-element-id="401438">Voici le code final de notre projet.</p><p id="r-401439" data-claire-element-id="401439"></p><div id="r-401445" data-claire-element-id="401445"><pre id="r-401440" data-claire-element-id="401440"><code data-claire-semantic="c">#ifndef PIXEL_H
#define PIXEL_H
#include &lt;SDL/SDL.h&gt;

#define NOIR  0
#define BLANC 1
#define l 64
#define L 32
#define DIMPIXEL 8
#define WIDTH   l*DIMPIXEL
#define HEIGHT  L*DIMPIXEL

typedef struct
{
    SDL_Rect position; //regroupe l'abscisse et l'ordonnée
    Uint32 couleur;   //comme son nom l'indique, c'est la couleur
} PIXEL;

SDL_Surface *ecran,*carre[2];
PIXEL pixel[l][L];
SDL_Event event;

void initialiserEcran();
void initialiserPixel();
void dessinerPixel(PIXEL pixel);
void effacerEcran();
void updateEcran();


#endif</code></pre><pre id="r-401441" data-claire-element-id="401441"><code data-claire-semantic="c">#include &quot;pixel.h&quot;

void initialiserPixel()
{

    Uint8 x=0,y=0;

    for(x=0;x&lt;l;x++)
    {
        for(y=0;y&lt;L;y++)
        {
            pixel[x][y].position.x=x*DIMPIXEL;
            pixel[x][y].position.y=y*DIMPIXEL;
            pixel[x][y].couleur=NOIR;
        }
    }

}


void initialiserEcran()
{
    ecran=NULL;
    carre[0]=NULL;
    carre[1]=NULL;

    ecran=SDL_SetVideoMode(WIDTH,HEIGHT,32,SDL_HWSURFACE);
    SDL_WM_SetCaption(&quot;BC-Chip8 By BestCoder&quot;,NULL);

    if(ecran==NULL)
    {
        fprintf(stderr,&quot;Erreur lors du chargement du mode vidéo %s&quot;,SDL_GetError());
        exit(EXIT_FAILURE);
    }


    carre[0]=SDL_CreateRGBSurface(SDL_HWSURFACE,DIMPIXEL,DIMPIXEL,32,0,0,0,0); //le pixel noir
	
    if(carre[0]==NULL)
    {
       fprintf(stderr,&quot;Erreur lors du chargement de la surface %s&quot;,SDL_GetError());
       exit(EXIT_FAILURE);
    }

    SDL_FillRect(carre[0],NULL,SDL_MapRGB(carre[0]-&gt;format,0x00,0x00,0x00)); //le pixel noir

    carre[1]=SDL_CreateRGBSurface(SDL_HWSURFACE,DIMPIXEL,DIMPIXEL,32,0,0,0,0); //le pixel blanc
	
     if(carre[1]==NULL)
     {
	fprintf(stderr,&quot;Erreur lors du chargement de la surface %s&quot;,SDL_GetError());
        exit(EXIT_FAILURE);
     }

    SDL_FillRect(carre[1],NULL,SDL_MapRGB(carre[1]-&gt;format,0xFF,0xFF,0xFF));  //le pixel blanc
}

void dessinerPixel(PIXEL pixel)
{
 /* pixel.couleur peut prendre deux valeurs : 0, auquel cas on dessine le pixel en noir, ou 1, on dessine alors le pixel en blanc */
    SDL_BlitSurface(carre[pixel.couleur],NULL,ecran,&amp;pixel.position);
}

void effacerEcran()
{
    //Pour effacer l'écran, on remet tous les pixels en noir
    Uint8 x=0,y=0;
    for(x=0;x&lt;l;x++)
    {
        for(y=0;y&lt;L;y++)
        {
            pixel[x][y].couleur=NOIR;
        }
    }

  //on repeint l'écran en noir
    SDL_FillRect(ecran,NULL,NOIR);
}

void updateEcran()
{
  //On dessine tous les pixels à l'écran
   Uint8 x=0,y=0;

	for(x=0;x&lt;l;x++)
	{
	   for(y=0;y&lt;L;y++)
                {
                   dessinerPixel(pixel[x][y]);
		}
	}

  SDL_Flip(ecran); //on affiche les modifications
}</code></pre><pre id="r-401442" data-claire-element-id="401442"><code data-claire-semantic="c">#ifndef CPU_H
#define CPU_H
#include &quot;pixel.h&quot;

#define TAILLEMEMOIRE 4096
#define ADRESSEDEBUT 512
#define NBROPCODE 35

    typedef struct
    {
        Uint8 memoire[TAILLEMEMOIRE];
        Uint8 V[16]; //le registre
        Uint16 I; //stocke une adresse mémoire ou dessinateur
        Uint16 saut[16]; //pour gérer les sauts dans memoire, 16 au maximum
        Uint8 nbrsaut; //stocke le nombre de sauts effectués pour ne pas dépasser 16
        Uint8 compteurJeu; //compteur pour le graphisme (fréquence de rafraîchissement)
        Uint8 compteurSon; //compteur pour le son
        Uint16 pc; //pour parcourir le tableau memoire
        Uint8 touche[16]; //pour stocker l'état des touches
    } CPU;

CPU cpu;

typedef struct
{
    Uint16 masque[NBROPCODE];   //la Chip 8 peut effectuer 35 opérations, chaque opération possédant son masque
    Uint16 id[NBROPCODE];   //idem, chaque opération possède son propre identifiant

}JUMP;

JUMP jp;

void initialiserJump();
void initialiserCpu();
void decompter();
void chargerFont();
void dessinerEcran(Uint8,Uint8,Uint8);
void reset();

Uint16 recupererOpcode();
Uint8 interpreterOpcode(Uint16);
Uint8 recupererAction(Uint16);
Uint8 attendAppui(Uint8);

#endif</code></pre><pre id="r-401443" data-claire-element-id="401443"><code data-claire-semantic="c">#include &quot;cpu.h&quot;


void initialiserCpu()
{
  //On initialise le tout
    Uint16 i=0;

    for(i=0;i&lt;TAILLEMEMOIRE;i++)
    {
        cpu.memoire[i]=0;
    }

    for(i=0;i&lt;16;i++)
    {
        cpu.V[i]=0;
        cpu.saut[i]=0;
        cpu.touche[i]=0;
    }

    cpu.pc=ADRESSEDEBUT;
    cpu.nbrsaut=0;
    cpu.compteurJeu=0;
    cpu.compteurSon=0;
    cpu.I=0;

    initialiserJump();
}

void reset()
{
    Uint8 i=0;
    for(i=0;i&lt;16;i++)
    {
        cpu.V[i]=0;
        cpu.saut[i]=0;
        cpu.touche[i]=0;
    }

    cpu.pc=ADRESSEDEBUT;
    cpu.nbrsaut=0;
    cpu.compteurJeu=0;
    cpu.compteurSon=0;
    cpu.I=0;
    initialiserPixel();
    updateEcran();

}


void initialiserJump()
{

  jp.masque[0]= 0x0000; jp.id[0]=0x0FFF;          /* 0NNN */
  jp.masque[1]= 0xFFFF; jp.id[1]=0x00E0;          /* 00E0 */
  jp.masque[2]= 0xFFFF; jp.id[2]=0x00EE;          /* 00EE */
  jp.masque[3]= 0xF000; jp.id[3]=0x1000;          /* 1NNN */
  jp.masque[4]= 0xF000; jp.id[4]=0x2000;          /* 2NNN */
  jp.masque[5]= 0xF000; jp.id[5]=0x3000;          /* 3XNN */
  jp.masque[6]= 0xF000; jp.id[6]=0x4000;          /* 4XNN */
  jp.masque[7]= 0xF00F; jp.id[7]=0x5000;          /* 5XY0 */
  jp.masque[8]= 0xF000; jp.id[8]=0x6000;          /* 6XNN */
  jp.masque[9]= 0xF000; jp.id[9]=0x7000;          /* 7XNN */
  jp.masque[10]= 0xF00F; jp.id[10]=0x8000;          /* 8XY0 */
  jp.masque[11]= 0xF00F; jp.id[11]=0x8001;          /* 8XY1 */
  jp.masque[12]= 0xF00F; jp.id[12]=0x8002;          /* 8XY2 */
  jp.masque[13]= 0xF00F; jp.id[13]=0x8003;          /* BXY3 */
  jp.masque[14]= 0xF00F; jp.id[14]=0x8004;          /* 8XY4 */
  jp.masque[15]= 0xF00F; jp.id[15]=0x8005;          /* 8XY5 */
  jp.masque[16]= 0xF00F; jp.id[16]=0x8006;          /* 8XY6 */
  jp.masque[17]= 0xF00F; jp.id[17]=0x8007;          /* 8XY7 */
  jp.masque[18]= 0xF00F; jp.id[18]=0x800E;          /* 8XYE */
  jp.masque[19]= 0xF00F; jp.id[19]=0x9000;          /* 9XY0 */
  jp.masque[20]= 0xF000; jp.id[20]=0xA000;          /* ANNN */
  jp.masque[21]= 0xF000; jp.id[21]=0xB000;          /* BNNN */
  jp.masque[22]= 0xF000; jp.id[22]=0xC000;          /* CXNN */
  jp.masque[23]= 0xF000; jp.id[23]=0xD000;          /* DXYN */
  jp.masque[24]= 0xF0FF; jp.id[24]=0xE09E;          /* EX9E */
  jp.masque[25]= 0xF0FF; jp.id[25]=0xE0A1;          /* EXA1 */
  jp.masque[26]= 0xF0FF; jp.id[26]=0xF007;          /* FX07 */
  jp.masque[27]= 0xF0FF; jp.id[27]=0xF00A;          /* FX0A */
  jp.masque[28]= 0xF0FF; jp.id[28]=0xF015;          /* FX15 */
  jp.masque[29]= 0xF0FF; jp.id[29]=0xF018;          /* FX18 */
  jp.masque[30]= 0xF0FF; jp.id[30]=0xF01E;          /* FX1E */
  jp.masque[31]= 0xF0FF; jp.id[31]=0xF029;          /* FX29 */
  jp.masque[32]= 0xF0FF; jp.id[32]=0xF033;          /* FX33 */
  jp.masque[33]= 0xF0FF; jp.id[33]=0xF055;          /* FX55 */
  jp.masque[34]= 0xF0FF; jp.id[34]=0xF065;          /* FX65 */

}

Uint8 recupererAction(Uint16 opcode)
{
    Uint8 action;
    Uint16 resultat;

    for(action=0; action&lt;NBROPCODE;action++)
    {
        resultat= (jp.masque[action]&amp;opcode);  /* On récupère les bits concernés par le test */

        if(resultat == jp.id[action]) /* On a trouvé l'action à effectuer */
           break; /* Plus la peine de continuer la boucle */
    }

    return action;
}

void decompter()
{
    if(cpu.compteurJeu&gt;0)
    cpu.compteurJeu--;

    if(cpu.compteurSon&gt;0)
    cpu.compteurSon--;
}

Uint16 recupererOpcode()
{
    return (cpu.memoire[cpu.pc]&lt;&lt;8)+cpu.memoire[cpu.pc+1];
}


Uint8 interpreterOpcode(Uint16 opcode)
{
    Uint8 continuer=1;
    Uint8 b4,b3,b2,b1;

    b3=(opcode&amp;(0x0F00))&gt;&gt;8;  //on prend les 4 bits représentant X
    b2=(opcode&amp;(0x00F0))&gt;&gt;4;  //idem pour Y
    b1=(opcode&amp;(0x000F));     //idem

    b4= recupererAction(opcode);

    switch(b4)
    {
     case 0:{
               //Cet opcode n'est pas implémenté.
                break;
              }
     case 1:{
            //00E0 efface l'écran.
                effacerEcran();
                break;
               }

     case 2:{
            //00EE revient du saut.

                if(cpu.nbrsaut&gt;0)
                {
                    cpu.nbrsaut--;
                    cpu.pc=cpu.saut[cpu.nbrsaut];
                }
                break;
            }
    case 3:{
            //1NNN effectue un saut à l'adresse 1NNN.

                cpu.pc=(b3&lt;&lt;8)+(b2&lt;&lt;4)+b1; //on prend le nombre NNN (pour le saut)
                cpu.pc-=2; //on verra pourquoi à la fin

                break;
            }
    case 4:{
            //2NNN appelle le sous-programme en NNN, mais on revient ensuite.

                cpu.saut[cpu.nbrsaut]=cpu.pc; //on reste là où on était

                if(cpu.nbrsaut&lt;15)
                {
                    cpu.nbrsaut++;
                }

                cpu.pc=(b3&lt;&lt;8)+(b2&lt;&lt;4)+b1; //on prend le nombre NNN (pour le saut)
                cpu.pc-=2; //on verra pourquoi à la fin

                break;
            }
    case 5:{
            //3XNN saute l'instruction suivante si VX est égal à NN.

                if(cpu.V[b3]==((b2&lt;&lt;4)+b1))
                {
                    cpu.pc+=2;
                }

                break;
            }
    case 6:{
            //4XNN saute l'instruction suivante si VX et NN ne sont pas égaux.
                if(cpu.V[b3]!=((b2&lt;&lt;4)+b1))
                {
                    cpu.pc+=2;
                }

                break;
            }
    case 7:{
           //5XY0 saute l'instruction suivante si VX et VY sont égaux.
                if(cpu.V[b3]==cpu.V[b2])
                {
                    cpu.pc+=2;
                }

                break;
            }

    case 8:{
            //6XNN définit VX à NN.
                cpu.V[b3]=(b2&lt;&lt;4)+b1;
                break;
            }
    case 9:{
                //7XNN ajoute NN à VX.
                cpu.V[b3]+=(b2&lt;&lt;4)+b1;

                break;
            }
    case 10:{
                //8XY0 définit VX à la valeur de VY.
                cpu.V[b3]=cpu.V[b2];

                break;
            }
    case 11:{
                //8XY1 définit VX à VX OR VY.
                cpu.V[b3]=cpu.V[b3]|cpu.V[b2];

                break;
            }
    case 12:{
                //8XY2 définit VX à VX AND VY.
                cpu.V[b3]=cpu.V[b3]&amp;cpu.V[b2];

                break;
            }
    case 13:{
                //8XY3 définit VX à VX XOR VY.
                cpu.V[b3]=cpu.V[b3]^cpu.V[b2];

                break;
            }
    case 14:{
                //8XY4 ajoute VY à VX. VF est mis à 1 quand il y a un dépassement de mémoire (carry), et à 0 quand il n'y en pas.
                if((cpu.V[b3]+cpu.V[b2])&gt;255)
                {
                    cpu.V[0xF]=1; //cpu.V[15]
                }
                else
                {
                    cpu.V[0xF]=0; //cpu.V[15]
                }
                cpu.V[b3]+=cpu.V[b2];

                break;
            }
    case 15:{
                //8XY5 VY est soustraite de VX. VF est mis à 0 quand il y a un emprunt, et à 1 quand il n'y a en pas.

                if((cpu.V[b3]&lt;cpu.V[b2]))
                {
                    cpu.V[0xF]=0; //cpu.V[15]
                }
                else
                {
                    cpu.V[0xF]=1; //cpu.V[15]
                }
                cpu.V[b3]-=cpu.V[b2];

                break;
            }
    case 16:{
                //8XY6 décale (shift) VX à droite de 1 bit. VF est fixé à la valeur du bit de poids faible de VX avant le décalage.
                cpu.V[0xF]=(cpu.V[b3]&amp;(0x01));
                cpu.V[b3]=(cpu.V[b3]&gt;&gt;1);

                break;
            }
    case 17:{
                //8XY7 VX = VY - VX. VF est mis à 0 quand il y a un emprunt et à 1 quand il n'y en a pas.
                if((cpu.V[b2]&lt;cpu.V[b3]))
                {
                    cpu.V[0xF]=0; //cpu.V[15]
                }
                else
                {
                    cpu.V[0xF]=1; //cpu.V[15]
                }
                cpu.V[b3]=cpu.V[b2]-cpu.V[b3];

                break;
            }
    case 18:{
                //8XYE décale (shift) VX à gauche de 1 bit. VF est fixé à la valeur du bit de poids fort de VX avant le décalage.
                cpu.V[0xF]=(cpu.V[b3]&gt;&gt;7);
                cpu.V[b3]=(cpu.V[b3]&lt;&lt;1);

                break;
             }

    case 19:{
                //9XY0 saute l'instruction suivante si VX et VY ne sont pas égaux.
                if(cpu.V[b3]!=cpu.V[b2])
                    {
                        cpu.pc+=2;
                    }

                break;
            }
    case 20:{
            //ANNN affecte NNN à I.

                cpu.I=(b3&lt;&lt;8)+(b2&lt;&lt;4)+b1;

                break;
            }
    case 21:{
           //BNNN passe à l'adresse NNN + V0.

            cpu.pc=(b3&lt;&lt;8)+(b2&lt;&lt;4)+b1+cpu.V[0];
            cpu.pc-=2;

            break;

            }
    case 22:{
            //CXNN définit VX à un nombre aléatoire inférieur à NN.
            cpu.V[b3]=(rand())%((b2&lt;&lt;4)+b1+1);

            break;

            }

    case 23:{
           //DXYN dessine un sprite aux coordonnées (VX, VY).


            dessinerEcran(b1,b2,b3) ;

            break;

            }
    case 24:{
               //EX9E saute l'instruction suivante si la clé stockée dans VX est pressée.
                if(cpu.touche[cpu.V[b3]]==1)//1 pressé, 0 relaché
                {
                    cpu.pc+=2;
                }

                break;
            }
    case 25:{
            //EXA1 saute l'instruction suivante si la clé stockée dans VX n'est pas pressée.
                if(cpu.touche[cpu.V[b3]]==0)//1 pressé, 0 relaché
                {
                    cpu.pc+=2;
                }

                break;
            }

    case 26:{
                 //FX07 définit VX à la valeur de la temporisation.
                cpu.V[b3]=cpu.compteurJeu;

                break;
            }
    case 27:{
                //FX0A attend l'appui sur une touche et stocke ensuite la donnée dans VX.
                continuer=attendAppui(b3);

                break;
            }


    case 28:{
               //FX15 définit la temporisation à VX.
                cpu.compteurJeu=cpu.V[b3];

                break;
            }
    case 29:{
                //FX18 définit la minuterie sonore à VX.
                cpu.compteurSon=cpu.V[b3];

                break;
            }
    case 30:{
             //FX1E ajoute VX à I. VF est mis à 1 quand il y a overflow (I+VX&gt;0xFFF), et à 0 si tel n'est pas le cas.

                if((cpu.I+cpu.V[b3])&gt;0xFFF)
                {
                    cpu.V[0xF]=1;
                }
                else
                {
                    cpu.V[0xF]=0;
                }
                cpu.I+=cpu.V[b3];


                break;
            }

    case 31:{
                 //FX29 définit I à l'emplacement du caractère stocké dans VX. Les caractères 0-F (en hexadécimal) sont représentés par une police 4x5.
                cpu.I=cpu.V[b3]*5;

                break;
            }

    case 32:{
                //FX33 stocke dans la mémoire le code décimal représentant VX (dans I, I+1, I+2).

                cpu.memoire[cpu.I]=(cpu.V[b3]-cpu.V[b3]%100)/100;
                cpu.memoire[cpu.I+1]=(((cpu.V[b3]-cpu.V[b3]%10)/10)%10);
                cpu.memoire[cpu.I+2]=cpu.V[b3]-cpu.memoire[cpu.I]*100-10*cpu.memoire[cpu.I+1];

                break;
            }
    case 33:{
                //FX55 stocke V0 à VX en mémoire à partir de l'adresse I.
                Uint8 i=0;
                for(i=0;i&lt;=b3;i++)
                {
                    cpu.memoire[cpu.I+i]=cpu.V[i];
                }

                break;
            }
    case 34:{
                 //FX65 remplit V0 à VX avec les valeurs de la mémoire à partir de l'adresse I.

                Uint8 i=0;

                for(i=0;i&lt;=b3;i++)
                {
                  cpu.V[i]=cpu.memoire[cpu.I+i];
                }

                break;
            }

    default: { //si ça arrive, il y un truc qui cloche

                    break;
             }

}
    cpu.pc+=2; //on passe au prochain opcode
    return continuer;
}



void dessinerEcran(Uint8 b1,Uint8 b2, Uint8 b3)
{
    Uint8 x=0,y=0,k=0,codage=0,j=0,decalage=0;
    cpu.V[0xF]=0;

     for(k=0;k&lt;b1;k++)
        {
            codage=cpu.memoire[cpu.I+k]; //on récupère le codage de la ligne à dessiner

            y=(cpu.V[b2]+k)%L; //on calcule l'ordonnée de la ligne à dessiner, on ne doit pas dépasser L

            for(j=0,decalage=7;j&lt;8;j++,decalage--)
             {
                x=(cpu.V[b3]+j)%l; //on calcule l'abscisse, on ne doit pas dépasser l

                        if(((codage)&amp;(0x1&lt;&lt;decalage))!=0) //on récupère le bit correspondant
                        {   //si c'est blanc
                            if( pixel[x][y].couleur==BLANC) //le pixel était blanc
                            {
                                pixel[x][y].couleur=NOIR; //on l'éteint
                                cpu.V[0xF]=1; //il y a donc collusion
                            }
                            else //sinon
                            {
                                 pixel[x][y].couleur=BLANC; //on l'allume
                            }


                        }
            }
        }

}

void chargerFont()
{
     cpu.memoire[0]=0xF0;cpu.memoire[1]=0x90;cpu.memoire[2]=0x90;cpu.memoire[3]=0x90; cpu.memoire[4]=0xF0; //O

    cpu.memoire[5]=0x20;cpu.memoire[6]=0x60;cpu.memoire[7]=0x20;cpu.memoire[8]=0x20;cpu.memoire[9]=0x70; //1

    cpu.memoire[10]=0xF0;cpu.memoire[11]=0x10;cpu.memoire[12]=0xF0;cpu.memoire[13]=0x80; cpu.memoire[14]=0xF0; //2

    cpu.memoire[15]=0xF0;cpu.memoire[16]=0x10;cpu.memoire[17]=0xF0;cpu.memoire[18]=0x10;cpu.memoire[19]=0xF0; //3

    cpu.memoire[20]=0x90;cpu.memoire[21]=0x90;cpu.memoire[22]=0xF0;cpu.memoire[23]=0x10;cpu.memoire[24]=0x10; //4

    cpu.memoire[25]=0xF0;cpu.memoire[26]=0x80;cpu.memoire[27]=0xF0;cpu.memoire[28]=0x10;cpu.memoire[29]=0xF0; //5

    cpu.memoire[30]=0xF0;cpu.memoire[31]=0x80;cpu.memoire[32]=0xF0;cpu.memoire[33]=0x90;cpu.memoire[34]=0xF0; //6

    cpu.memoire[35]=0xF0;cpu.memoire[36]=0x10;cpu.memoire[37]=0x20;cpu.memoire[38]=0x40;cpu.memoire[39]=0x40; //7

    cpu.memoire[40]=0xF0;cpu.memoire[41]=0x90;cpu.memoire[42]=0xF0;cpu.memoire[43]=0x90;cpu.memoire[44]=0xF0; //8

    cpu.memoire[45]=0xF0;cpu.memoire[46]=0x90;cpu.memoire[47]=0xF0;cpu.memoire[48]=0x10;cpu.memoire[49]=0xF0; //9

    cpu.memoire[50]=0xF0;cpu.memoire[51]=0x90;cpu.memoire[52]=0xF0;cpu.memoire[53]=0x90;cpu.memoire[54]=0x90; //A

    cpu.memoire[55]=0xE0;cpu.memoire[56]=0x90;cpu.memoire[57]=0xE0;cpu.memoire[58]=0x90;cpu.memoire[59]=0xE0; //B

    cpu.memoire[60]=0xF0;cpu.memoire[61]=0x80;cpu.memoire[62]=0x80;cpu.memoire[63]=0x80;cpu.memoire[64]=0xF0; //C

    cpu.memoire[65]=0xE0;cpu.memoire[66]=0x90;cpu.memoire[67]=0x90;cpu.memoire[68]=0x90;cpu.memoire[69]=0xE0; //D

    cpu.memoire[70]=0xF0;cpu.memoire[71]=0x80;cpu.memoire[72]=0xF0;cpu.memoire[73]=0x80;cpu.memoire[74]=0xF0; //E

    cpu.memoire[75]=0xF0;cpu.memoire[76]=0x80;cpu.memoire[77]=0xF0;cpu.memoire[78]=0x80;cpu.memoire[79]=0x80; //F

    //OUF !

}


Uint8 attendAppui(Uint8 b3)
{
    Uint8 attend=1,continuer=1;

    while(attend)
    {
        SDL_WaitEvent(&amp;event);

            switch(event.type)
            {
                case SDL_QUIT:{ continuer=0;attend=0; break;}

                case SDL_KEYDOWN:{

                    switch(event.key.keysym.sym)
                    {

                            case SDLK_KP0:{ cpu.V[b3]=0x0; cpu.touche[0x0]=1; attend=0;break;}
                            case SDLK_KP7:{ cpu.V[b3]=0x1; cpu.touche[0x1]=1; attend=0;break;}
                            case SDLK_KP8:{ cpu.V[b3]=0x2; cpu.touche[0x2]=1; attend=0;break;}
                            case SDLK_KP9:{ cpu.V[b3]=0x3; cpu.touche[0x3]=1; attend=0;break;}
                            case SDLK_KP4:{ cpu.V[b3]=0x4; cpu.touche[0x4]=1; attend=0;break;}
                            case SDLK_KP5:{ cpu.V[b3]=0x5; cpu.touche[0x5]=1; attend=0;break;}
                            case SDLK_KP6:{ cpu.V[b3]=0x6; cpu.touche[0x6]=1; attend=0;break;}
                            case SDLK_KP1:{ cpu.V[b3]=0x7; cpu.touche[0x7]=1; attend=0;break;}
                            case SDLK_KP2:{ cpu.V[b3]=0x8; cpu.touche[0x8]=1; attend=0;break;}
                            case SDLK_KP3:{ cpu.V[b3]=0x9; cpu.touche[0x9]=1; attend=0;break;}
                            case SDLK_RIGHT:{        cpu.V[b3]=0xA;       cpu.touche[0xA]=1;  attend=0;break;}
                            case SDLK_KP_PERIOD:{    cpu.V[b3]=0xB;     cpu.touche[0xB]=1;  attend=0;break;}
                            case SDLK_KP_MULTIPLY:{  cpu.V[b3]=0xC;     cpu.touche[0xC]=1;  attend=0;break;}
                            case SDLK_KP_MINUS:{     cpu.V[b3]=0xD;     cpu.touche[0xD]=1;  attend=0;break;}
                            case SDLK_KP_PLUS:{      cpu.V[b3]=0xE;     cpu.touche[0xE]=1;  attend=0;break;}
                            case SDLK_KP_ENTER:{     cpu.V[b3]=0xF;     cpu.touche[0xF]=1;  attend=0;break;}
                            default:{ break;}
                    } break;}

          default:{ break;}
      }
    }


 return continuer;
}</code></pre><pre id="r-401444" data-claire-element-id="401444"><code data-claire-semantic="c">#include &lt;SDL/SDL_mixer.h&gt;
#include &quot;cpu.h&quot;

#define VITESSECPU 4 //nombre d'opérations par tour
#define FPS 16      //pour le rafraîchissement


void initialiserSDL();
void quitterSDL();
void pause();

Uint8 chargerJeu(char *);
Uint8 listen();

Mix_Chunk *son;


int main(int argc, char *argv[])
{
    initialiserSDL();
    initialiserEcran();
    initialiserPixel();
    initialiserCpu();
    chargerFont();

    Uint8 continuer=1,demarrer=0,compteur=0;

    son=NULL;

    son = Mix_LoadWAV(&quot;SON/beep.wav&quot;);
	
        if(son==NULL)
        {
            fprintf(stderr,&quot;Problème avec le son&quot;);
            exit(EXIT_FAILURE);
        }

    if(argc&gt;=2) //Permet de charger un jeu en ligne de commande ou en le plaçant dans l'exécutable
    {
      demarrer=chargerJeu(argv[1]);
    }

    if(demarrer==1)
    {
	do
	{
	   continuer=listen(); //pour les entrées utilisateur

	   for(compteur=0;compteur&lt;VITESSECPU &amp;&amp; continuer==1;compteur++)  //Si continuer=0, on quitte l'émulateur
	   {
		continuer=interpreterOpcode(recupererOpcode());
	   }

	   if(cpu.compteurSon!=0)
	   {
		Mix_PlayChannel(0, son, 0);
		cpu.compteurSon=0;
	   }

			updateEcran();
			decompter();
			
           SDL_Delay(FPS); //une pause de 16 ms
		   
	}while(continuer==1);

    }

return EXIT_SUCCESS;
}


void initialiserSDL()
{
    atexit(quitterSDL);

    if(SDL_Init(SDL_INIT_VIDEO|SDL_INIT_AUDIO)==-1)
    {
        fprintf(stderr,&quot;Erreur lors de l'initialisation de la SDL %s&quot;,SDL_GetError());
        exit(EXIT_FAILURE);
    }

     if(Mix_OpenAudio(22050, MIX_DEFAULT_FORMAT, MIX_DEFAULT_CHANNELS, 1024) == -1) //Initialisation de Mixer
     {
        fprintf(stderr,&quot;Problème d'initialisation de SDL_MIXER: %s&quot;,Mix_GetError());
        exit(EXIT_FAILURE);
     }
     Mix_AllocateChannels(1);

}


void quitterSDL()
{
    SDL_FreeSurface(carre[0]);
    SDL_FreeSurface(carre[1]);
    Mix_FreeChunk(son);
    Mix_CloseAudio();
    SDL_Quit();
}

Uint8 chargerJeu(char *nomJeu)
{
    FILE *jeu=NULL;
    jeu=fopen(nomJeu,&quot;rb&quot;);

    if(jeu!=NULL)
    {
        fread(&amp;cpu.memoire[ADRESSEDEBUT],sizeof(Uint8)*(TAILLEMEMOIRE-ADRESSEDEBUT), 1, jeu);
        fclose(jeu);
        return 1;
    }
    else
    {
      fprintf(stderr,&quot;Problème d'ouverture du fichier&quot;);
      return 0;
    }

}



Uint8 listen()
{
    Uint8 continuer=1;
	
      while(SDL_PollEvent(&amp;event))
      {
            switch(event.type)
            {
                case SDL_QUIT: {continuer = 0;break;}
                case SDL_KEYDOWN:{
                                    switch(event.key.keysym.sym)
                                    {
                                        case SDLK_KP0:{ cpu.touche[0x0]=1;break;}
                                        case SDLK_KP7:{ cpu.touche[0x1]=1;break;}
                                        case SDLK_KP8:{ cpu.touche[0x2]=1;break;}
                                        case SDLK_KP9:{ cpu.touche[0x3]=1;break;}
                                        case SDLK_KP4:{ cpu.touche[0x4]=1;break;}
                                        case SDLK_KP5:{ cpu.touche[0x5]=1;break;}
                                        case SDLK_KP6:{ cpu.touche[0x6]=1;break;}
                                        case SDLK_KP1:{ cpu.touche[0x7]=1;break;}
                                        case SDLK_KP2:{ cpu.touche[0x8]=1;break;}
                                        case SDLK_KP3:{ cpu.touche[0x9]=1;break;}
                                        case SDLK_RIGHT:{ cpu.touche[0xA]=1;break;}
                                        case SDLK_KP_PERIOD:{cpu.touche[0xB]=1;break;}
                                        case SDLK_KP_MULTIPLY:{cpu.touche[0xC]=1;break;}
                                        case SDLK_KP_MINUS:{cpu.touche[0xD]=1;break;}
                                        case SDLK_KP_PLUS:{cpu.touche[0xE]=1;break;}
                                        case SDLK_KP_ENTER:{cpu.touche[0xF]=1;break;}
                                        case SDLK_p:{pause();break;}
                                        case SDLK_r:{reset();break;}
                                        default:{ break;}
                                    } 									
			        break;}		
                case SDL_KEYUP:{
                                    switch(event.key.keysym.sym)
                                    {
                                        case SDLK_KP0:{ cpu.touche[0x0]=0;break;}
                                        case SDLK_KP7:{ cpu.touche[0x1]=0;break;}
                                        case SDLK_KP8:{ cpu.touche[0x2]=0;break;}
                                        case SDLK_KP9:{ cpu.touche[0x3]=0;break;}
                                        case SDLK_KP4:{ cpu.touche[0x4]=0;break;}
                                        case SDLK_KP5:{ cpu.touche[0x5]=0;break;}
                                        case SDLK_KP6:{ cpu.touche[0x6]=0;break;}
                                        case SDLK_KP1:{ cpu.touche[0x7]=0;break;}
                                        case SDLK_KP2:{ cpu.touche[0x8]=0;break;}
                                        case SDLK_KP3:{ cpu.touche[0x9]=0;break;}
                                        case SDLK_RIGHT:{ cpu.touche[0xA]=0;break;}
                                        case SDLK_KP_PERIOD:{cpu.touche[0xB]=0;break;}
                                        case SDLK_KP_MULTIPLY:{cpu.touche[0xC]=0;break;}
                                        case SDLK_KP_MINUS:{cpu.touche[0xD]=0;break;}
                                        case SDLK_KP_PLUS:{cpu.touche[0xE]=0;break;}
                                        case SDLK_KP_ENTER:{cpu.touche[0xF]=0;break;}
                                        default:{ break;}
                                    } 
				break;}
								
                        default:{ break;}
            }
      }
     
 return continuer;
}


void pause()
{
    Uint8 continuer=1;
	
    do
    {
        SDL_WaitEvent(&amp;event);

        switch(event.type)
         {
             case SDL_QUIT:
			 
                    continuer=0;
                    break;
					
             case SDL_KEYDOWN:
			 
                        if(event.key.keysym.sym==SDLK_p)
                           continuer=0;
                    break;
					
             default:   break;
         }
    }while(continuer==1);
	
    SDL_Delay(200); //on fait une petite pause pour ne pas prendre le joueur au dépourvu
}</code></pre></div><aside id="r-401447" data-claire-element-id="401447" data-claire-semantic="warning"><p id="r-401446" data-claire-element-id="401446">Le code final <strong>diffère</strong> légèrement des codes vus plus haut car j'ai moi-même ajouté de nouvelles fonctionnalités à mon émulateur. Vous verrez de nouvelles variables et fonctions qui ne sont pas indispensables. Essayez d'écrire votre propre code afin de vous améliorer.</p></aside><p id="r-401448" data-claire-element-id="401448">Si vous désirez tester le code, il suffit de créer un dossier dans le même emplacement que l'exécutable. Nommez-le « SON » et placez-y un fichier son au format WAV. Le fichier son devra être nommé « beep ».</p><h5 id="r-la-compatibilite-1" data-claire-element-id="401455">La compatibilité</h5><p id="r-401450" data-claire-element-id="401450">Si vous testez certains jeux, notamment blinky et blitz, vous verrez que l'émulateur ne peut pas les faire fonctionner. C'est un problème de compatibilité qui se pose.</p><div id="r-401452" data-claire-element-id="401452" data-claire-semantic="question"><p id="r-401451" data-claire-element-id="401451">« Pourquoi ? », me diriez-vous…</p></div><p id="r-401453" data-claire-element-id="401453">Je le dis et je le répète, les informations sur lesquelles nous nous basons pour construire notre émulateur ne sont pas unanimes. Certains jeux utilisent donc vraisemblablement des propriétés que nous n'avons pas implémentées. &gt;_<br/> Mais en <em>bidouillant</em>, j'ai remarqué que le jeu blitz bugguait à cause du modulo dans la fonction de dessin sur l'écran. Donc pour ce jeu, tout ce qui sort de l'écran ne doit pas être redessiné. <br/> De même pour blinky, il faut augmenter la vitesse de jeu pour obtenir un bon rendu ; d'où l'intérêt de développer un émulateur <strong>configurable</strong>.</p><p id="r-401454" data-claire-element-id="401454">Je ne laisse pas de fichier .zip à télécharger pour la bonne et simple raison qu'un émulateur Chip 8, ce n'est pas ce qui manque, et vous êtes censés programmer le vôtre. Allez, au boulot ! ;)</p><h5 id="r-a-suivre" data-claire-element-id="401488">À suivre</h5><p id="r-401456" data-claire-element-id="401456">Vous n'avez là qu'une petite esquisse de l'émulation console. Plusieurs notions n'ont pas été abordées puisque n'étant pas utilisées par la Chip 8. En vous souhaitant une bonne continuation, je vous donne quelques pistes à suivre…</p><h6 id="r-le-son-2" data-claire-element-id="401458">Le son</h6><p id="r-401457" data-claire-element-id="401457">L'émulation du son n'est pas aussi facile qu'on pourrait l'imaginer. La Chip 8 est un mauvais exemple dans ce domaine. Gardez en tête qu'il faut, dans la plupart des cas, générer le son grâce aux instructions du jeu sans faire appel à une ressource externe.</p><h6 id="r-les-cycles" data-claire-element-id="401460">Les cycles</h6><p id="r-401459" data-claire-element-id="401459">Dans notre bloc <code data-claire-semantic="c">switch</code>, nous avons défini le même temps d'exécution pour tous les <em>opcodes</em> ; toutefois, certaines consoles introduisent la notion de cycle d'horloge.<br/> En effet, il se peut que certaines instructions prennent plus de temps à être exécutées que d'autres. Il faudra dans ce cas trouver des astuces afin d'assurer une émulation optimale.</p><h6 id="r-debugguer" data-claire-element-id="401462">Débugguer</h6><p id="r-401461" data-claire-element-id="401461">Le nombre d'instructions de la Chip 8 est relativement faible. C'est d'ailleurs ce qui a motivé mon choix de la traiter. Pour les nouvelles consoles (même des anciennes), le nombre d'instructions est énorme, il sera donc utile de créer un débuggueur pour voir quels sont les <em>opcodes</em> qui ne fonctionnent pas comme vous le souhaitez. Cela vous facilitera grandement la tâche.</p><h6 id="r-optimisation-2" data-claire-element-id="401464">Optimisation</h6><p id="r-401463" data-claire-element-id="401463">Certaines consoles sont cadencées à une fréquence tellement élevée qu'une simple approche avec un bloc <code data-claire-semantic="c">switch</code> ne pourrait satisfaire. Il existe une méthode appelée <a href="http://en.wikipedia.org/wiki/Dynamic_recompilation">recompilation dynamique</a> (dynarec) qui permet de contourner cet obstacle. Cette méthode, bien qu'un peu compliquée, offre des performances inégalables !</p><h6 id="r-plus-loin" data-claire-element-id="401487">Plus loin</h6><p id="r-401465" data-claire-element-id="401465">Vous avez fini le tutoriel et vous en voulez encore plus ?</p><p id="r-401466" data-claire-element-id="401466">La Chip 8 a un descendant appelé SuperChip8. Vous pourrez facilement trouver tout ce qu'il vous faut pour l'émuler.<br/> D'ailleurs, la SuperChip8 partage beaucoup d'instructions identiques avec la Chip 8, vous pourrez donc mettre à jour votre émulateur Chip 8 avec seulement quelques modifications.<br/>La Superchip 8 a aussi un descendant appelé Mégachip 8. :lol:</p><aside id="r-401468" data-claire-element-id="401468" data-claire-semantic="information"><p id="r-401467" data-claire-element-id="401467">Voici un système tout nouveau, <a href="http://www.siteduzero.com/forum-83-610513-p2-emulation-chip16.html#r6121354">CHIP 16</a>, qui est conçu spécialement pour les débutants en émulation. C'est pas mal pour un second émulateur (un membre du SdZ, timmehboy, fait partie des contributeurs). Le système est en couleur et est très agréable. Toutes les informations qu'il faut pour l'implémenter sont disponibles. Vous pourrez donc espérer une compatibilité de 100 %.</p></aside><p id="r-401469" data-claire-element-id="401469">Bonne chasse. ;)</p><p id="r-401470" data-claire-element-id="401470">Nous voici à la fin de notre premier épisode. ;) Vous venez de faire vos premiers pas dans le monde de l'émulation console et j'espère que ce tutoriel vous a été utile.<br/> Merci de m'avoir lu, je vous donne rendez-vous bientôt pour une nouvelle aventure.</p><p id="r-401471" data-claire-element-id="401471">Si vous regroupez toutes les citations utilisées, vous retrouverez la présentation entière de Wikipédia. Eh oui, on vient de traduire le document en langage machine. :magicien: Donc, lorsque je disais :</p><p id="r-401472" data-claire-element-id="401472"><cite>Citation : BestCoder</cite></p><blockquote id="r-401474" data-claire-element-id="401474"><p id="r-401473" data-claire-element-id="401473">C'est grâce à ce document que nous allons programmer notre émulateur ; nous allons le traduire en langage machine. ;)</p></blockquote><p id="r-401475" data-claire-element-id="401475">… j'avais entièrement raison et vous pouvez en témoigner.</p><p id="r-401476" data-claire-element-id="401476">Vous voilà fin prêts pour vous aventurer dans le monde de l'émulation console.<br/> Ce tutoriel, loin d'être exhaustif, ne représente qu'un aperçu de ce vaste domaine. Après cette initiation, vous êtes en mesure de programmer des émulateurs bien plus complexes du point de vue architectural sans problème.</p><div id="r-401478" data-claire-element-id="401478" data-claire-semantic="question"><p id="r-401477" data-claire-element-id="401477">Comment programmer un émulateur ?</p></div><p id="r-401479" data-claire-element-id="401479">Vous devez me dire sans hésiter qu'il suffit de :</p><ul id="r-401484" data-claire-element-id="401484"><li id="r-401481" data-claire-element-id="401481"><p id="r-401480" data-claire-element-id="401480">trouver les caractéristiques de la machine ;</p></li><li id="r-401483" data-claire-element-id="401483"><p id="r-401482" data-claire-element-id="401482">traduire le tout dans le langage de programmation de votre choix.</p></li></ul><p id="r-401485" data-claire-element-id="401485">Mais j'insiste : pour réaliser un émulateur Sony Next Generation Portable (NGP) ou Nintendo 3DS (ou même PS3 ou XBOX 360 pour les plus téméraires :lol: ), il faudra creuser un peu plus.</p><p id="r-401486" data-claire-element-id="401486">Deux ou trois autres TP verront bientôt le jour. Ce sera l'occasion pour vous d'apprendre des notions plus avancées et de passer en mode couleur.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console">L&#039;émulation console</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Notre premier émulateur
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/un-tour-d-horizon-1">Un tour d&#039;horizon</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/definition-de-l-emulation">
Définition de l&#039;émulation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-informations-sur-les-consoles-de-jeu">
Les informations sur les consoles de jeu
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/legislation">
Législation
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/quelle-console-emuler">Quelle console émuler ?</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/criteres-de-selection">
Critères de sélection
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-chip-8">
La Chip 8
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/la-base-1">La base</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-implementation-de-la-machine">
L&#039;implémentation de la machine
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-graphique-3">
Le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/simulation-des-instructions">Simulation des instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-cadencement-du-cpu-et-les-fps">
Le cadencement du CPU et les FPS
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/lecture-de-l-opcode">
Lecture de l&#039;opcode
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/identification-de-l-instruction">
Identification de l&#039;instruction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/retour-sur-le-graphique">
Retour sur le graphique
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/exemples-avec-quelques-instructions">Exemples avec quelques instructions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/divers-32">
Divers
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-mode-de-dessin-integre">
Le mode de dessin intégré
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/charger-un-jeu">
Charger un jeu
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/l-interface-homme-machine">L&#039;interface homme-machine</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/les-entrees-utilisateur">
Les entrées utilisateur
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
Le son
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/a-vous-de-jouer-21">
À vous de jouer !
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/l-emulation-console/le-son-1">
<span class="arrow"></span>
<span class="next">Le son</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/l-emulation-console.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 08:39:18 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/l-emulation-console.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:33:11 GMT -->
</html>