<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 20:56:35 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:55:12 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Faire un système de droits d&#039;accès grâce aux opérateurs binaires</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Faire un système de droits d&#039;accès grâce aux opérateurs binaires</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#Faireunsystmededroitsd039accsgrceauxoprateursbinaires">Faire un système de droits d&#039;accès grâce aux opérateurs binaires</a><br/><a href="#Informationsetcrationdestables">Informations et création des tables</a><br/><a href="#Ajoutermodifieretsupprimerlesgroupes">Ajouter, modifier et supprimer les groupes</a><br/><a href="#L039ajoutd039unutilisateuretlaconnexion">L&#039;ajout d&#039;un utilisateur et la connexion</a><br/><a href="#Ajouterdespermissions">Ajouter des permissions</a><br/></div>
<a name="Faireunsystmededroitsd039accsgrceauxoprateursbinaires"></a><h2>Faire un système de droits d&#039;accès grâce aux opérateurs binaires</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/informations-et-creation-des-tables">
<span class="next">Informations et création des tables</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-351629" data-claire-element-id="351629">Bienvenue dans ce tutoriel !</p><p id="r-351630" data-claire-element-id="351630">Dans ce tuto, vous apprendrez à donner / enlever des droits à des utilisateurs.<br/> Cela est très utile dans le cas de la gestion d'un site à plusieurs (admins, rédacteurs, modérateurs...).</p><p id="r-351631" data-claire-element-id="351631">Si vous voulez que la page nouvel_article.php ne soit accessible qu'aux administrateurs et aux rédacteurs, ce tuto est fait pour vous.</p><p id="r-351632" data-claire-element-id="351632">Vous pourrez aussi créer des groupes de permissions qu'il sera possible de modifier ou de supprimer par la suite.</p><aside id="r-351639" data-claire-element-id="351639" data-claire-semantic="warning"><p id="r-351633" data-claire-element-id="351633">Mises à jour :</p><ul id="r-351638" data-claire-element-id="351638"><li id="r-351635" data-claire-element-id="351635"><p id="r-351634" data-claire-element-id="351634">29/09/07 : utilisation des opérateurs binaires pour les droits.</p></li><li id="r-351637" data-claire-element-id="351637"><p id="r-351636" data-claire-element-id="351636">17/10/07 : correction des fautes d'orthographe présentes.</p></li></ul></aside><p id="r-351640" data-claire-element-id="351640">En avant ! :pirate:</p><p id="r-351641" data-claire-element-id="351641"><strong>Niveau : </strong>8/10 — Avancé.</p><aside id="r-351643" data-claire-element-id="351643" data-claire-semantic="information"><p id="r-351642" data-claire-element-id="351642">Ce tutoriel n'est pas adressé aux codeurs qui viennent juste de sortir du tutoriel de M@teo21 ! Mais n'ayez pas peur, j'ai tout mis en œuvre pour expliquer le mieux possible. :) Cependant, la notion principale abordée (les opérateurs binaires) n'est pas simple à comprendre si l'on n'a pas le bon tuto sous la main ; heureusement pour vous, je suis là. :p</p></aside>
</div><a name="Informationsetcrationdestables"></a><h2>Informations et création des tables</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/ajouter-modifier-et-supprimer-les-groupes">
<span class="next">Ajouter, modifier et supprimer les groupes</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h3 id="r-informations" data-claire-element-id="351670">Informations</h3><p id="r-351644" data-claire-element-id="351644">Dans cette première partie, je vais vous indiquer précisément ce que nous allons faire et aussi vous donner le code SQL pour créer les deux tables. ;)</p><p id="r-351645" data-claire-element-id="351645">Comme je vous l'ai dit dans l'introduction, vous allez apprendre à gérer les permissions (les accès aux pages, en quelque sorte) des utilisateurs.<br/> Cela sera peut-être utile pour un site avec un forum, un site de news...</p><p id="r-351646" data-claire-element-id="351646">Voici les pages que nous allons créer :</p><ul id="r-351655" data-claire-element-id="351655"><li id="r-351648" data-claire-element-id="351648"><p id="r-351647" data-claire-element-id="351647">ajouter_gr_perm.php : cette page sert à créer un groupe de permissions ;</p></li><li id="r-351650" data-claire-element-id="351650"><p id="r-351649" data-claire-element-id="351649">modifier_gr_perm.php : avec cette page, il sera possible de modifier un groupe de permissions ;</p></li><li id="r-351652" data-claire-element-id="351652"><p id="r-351651" data-claire-element-id="351651">del_gr_perm.php : là, c'est pour supprimer un groupe de permissions ;</p></li><li id="r-351654" data-claire-element-id="351654"><p id="r-351653" data-claire-element-id="351653">add_user.php : vous pourrez ajouter un utilisateur sur cette page.</p></li></ul><aside id="r-351657" data-claire-element-id="351657" data-claire-semantic="information"><p id="r-351656" data-claire-element-id="351656">Vous pouvez modifier ces noms, il n'y a aucun problème. ;)</p></aside><p id="r-351658" data-claire-element-id="351658">Vous aurez aussi à modifier la page PHP qui vous permet de vous connecter à l'administration de votre site (/forum).</p><aside id="r-351660" data-claire-element-id="351660" data-claire-semantic="information"><p id="r-351659" data-claire-element-id="351659"><strong>Définition d’un groupe de permissions</strong> : ensemble de droits d'accès (aux pages) pouvant être attribués à un utilisateur.</p></aside><p id="r-351661" data-claire-element-id="351661">Prenez en note que dans ce tutoriel, je ne gérerai que trois permissions :</p><ul id="r-351668" data-claire-element-id="351668"><li id="r-351663" data-claire-element-id="351663"><p id="r-351662" data-claire-element-id="351662">ajouter un article ;</p></li><li id="r-351665" data-claire-element-id="351665"><p id="r-351664" data-claire-element-id="351664">modifier un article ;</p></li><li id="r-351667" data-claire-element-id="351667"><p id="r-351666" data-claire-element-id="351666">supprimer un article.</p></li></ul><p id="r-351669" data-claire-element-id="351669">Par la suite, vous pourrez modifier mon script afin d'ajouter des permissions, pas de souci également. :D</p><h3 id="r-creation-des-tables-1" data-claire-element-id="351680">Création des tables</h3><p id="r-351671" data-claire-element-id="351671">Pour que tous nos fichiers fonctionnent bien, il leur faut deux tables SQL. Si vous ne savez pas ce que c'est, <a href="http://www.siteduzero.com/tuto-3-4-0-un-site-dynamique-avec-php.html">lisez le tuto de M@teo21 (sur le PHP)</a>.</p><p id="r-351672" data-claire-element-id="351672">Il est possible de créer la table très facilement, <em>via</em><em><strong>phpmyadmin</strong></em>. phpmyadmin est un logiciel utilisé par la plupart des hébergeurs, il vous sert à créer / modifier / supprimer des tables <em>via</em> une interface. :)</p><p id="r-351673" data-claire-element-id="351673">Procédons à la création de la table 'permissions', celle qui sera utilisée pour tous les groupes.</p><p id="r-351674" data-claire-element-id="351674">Rendez-vous donc sur « le » phpmyadmin de votre hébergeur et cliquez sur l'onglet « SQL ».<br/> Vous devriez arriver sur une page avec une boîte de texte ; copiez-collez ce code dedans :</p><pre id="r-351675" data-claire-element-id="351675"><code data-claire-semantic="sql">CREATE TABLE `permissions` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `nom` varchar(255) NOT NULL,
  `permissions` INT(11) NOT NULL,
  KEY `id` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;</code></pre><p id="r-351676" data-claire-element-id="351676">Normalement, après avoir cliqué sur « <strong>Exécuter</strong> », la table est créée ! :)</p><p id="r-351677" data-claire-element-id="351677">Refaites les mêmes opérations, mais avec le code ci-dessous.<br/> Il va créer la table 'users', utilisée pour la gestion des utilisateurs.</p><p id="r-351678" data-claire-element-id="351678">Le code :</p><pre id="r-351679" data-claire-element-id="351679"><code data-claire-semantic="sql">CREATE TABLE `users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `pseudo` varchar(255) NOT NULL,
  `password` varchar(255) NOT NULL,
  `id_groupe` int(11) NOT NULL,
  KEY `id` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;</code></pre><h3 id="r-informations-supplementaires-a-la-suite-de-la-mise-a-jour" data-claire-element-id="351700">Informations supplémentaires à la suite de la mise à jour</h3><p id="r-351681" data-claire-element-id="351681">Eh oui, ce tutoriel a été mis à jour !<br/> Avant la mise à jour, pour gérer les droits, on utilisait un champ SQL pour chaque droit.</p><p id="r-351682" data-claire-element-id="351682">Dorénavant, nous utiliserons un champ qui contiendra tous les droits !<br/> Si l'on peut faire ça, c'est grâce aux opérateurs de bits.</p><aside id="r-351684" data-claire-element-id="351684" data-claire-semantic="information"><p id="r-351683" data-claire-element-id="351683">Vous pouvez lire un tutoriel qui en parle ici : <a href="http://www.siteduzero.com/tuto-3-6518-1-introduction-aux-operateurs-de-bits.html">http://www.siteduzero.com/tuto-3-6518- [...] -de-bits.html</a>. <br/> Je précise aussi qu'il est bon de le lire avant de lire celui-ci, mais ce n'est pas une obligation !</p></aside><p id="r-351685" data-claire-element-id="351685">Plutôt que d'expliquer après chaque script à quoi sert telle ou telle ligne bizarre utilisant les opérateurs de bits, je vais tout vous expliquer ici. :) <br/> Voici ceux que nous utiliserons :</p><ul id="r-351698" data-claire-element-id="351698"><li id="r-351689" data-claire-element-id="351689"><p id="r-351686" data-claire-element-id="351686">ajout de droit(s) : quand j'aurai à ajouter un droit (= une permission), je ferai quelque chose dans ce style :</p><pre id="r-351687" data-claire-element-id="351687"><code data-claire-semantic="html+php">&lt;?php
$droits |= Add_article;
?&gt;</code></pre><p id="r-351688" data-claire-element-id="351688">Ici, nous mettons un « OU » ( | ) juste avant le signe « égal ». Add_article est <a href="http://fr.php.net/define">une constante</a>.</p></li><li id="r-351693" data-claire-element-id="351693"><p id="r-351690" data-claire-element-id="351690">suppression d'un droit : dans la modification des groupes de permissions, j'aurai besoin de supprimer des droits. Je mettrai ce code :</p><pre id="r-351691" data-claire-element-id="351691"><code data-claire-semantic="html+php">&lt;?php
$droits &amp;= ~(Mod_article | Add_article); 
?&gt;</code></pre><p id="r-351692" data-claire-element-id="351692">Je précise que le nom des constantes pourra changer. ;)</p></li><li id="r-351697" data-claire-element-id="351697"><p id="r-351694" data-claire-element-id="351694">vérification d'un droit : pour protéger vos pages, vous devrez faire une condition. Cette condition ressemblera à celle-ci :</p><pre id="r-351695" data-claire-element-id="351695"><code data-claire-semantic="html+php">&lt;?php
  if (((int)$_SESSION['droits'] &amp; LIRE_ARTICLE)) 
  {
        echo 'Lire article : OK&lt;br /&gt;';
  }
?&gt;</code></pre><p id="r-351696" data-claire-element-id="351696">Je vous en reparlerai plus précisément quand nous aurons à l'utiliser. ;)</p></li></ul><p id="r-351699" data-claire-element-id="351699">Vous voilà maintenant rapidement initié aux opérateurs de bits. Encore une fois, si vous voulez en savoir plus, je vous conseille d'aller lire ce tutoriel :<br/><a href="http://www.siteduzero.com/tuto-3-6518-1-introduction-aux-operateurs-de-bits.html">http://www.siteduzero.com/tuto-3-6518- [...] -de-bits.html</a>.</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires">Faire un système de droits d&#039;accès grâce aux opérateurs binaires</a>
</li>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/informations-et-creation-des-tables">
Informations et création des tables
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/ajouter-modifier-et-supprimer-les-groupes">
Ajouter, modifier et supprimer les groupes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/l-ajout-d-un-utilisateur-et-la-connexion">
L&#039;ajout d&#039;un utilisateur et la connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/ajouter-des-permissions">
Ajouter des permissions
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/ajouter-modifier-et-supprimer-les-groupes">
<span class="next">Ajouter, modifier et supprimer les groupes</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Ajoutermodifieretsupprimerlesgroupes"></a><h2>Ajouter, modifier et supprimer les groupes</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/informations-et-creation-des-tables">
<span class="arrow"></span>
<span class="next">Informations et création des tables</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/l-ajout-d-un-utilisateur-et-la-connexion">
<span class="next">L&#039;ajout d&#039;un utilisateur et la connexion</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-351702" data-claire-element-id="351702">Fini le bla-bla... on passe aux choses sérieuses. :p</p><aside id="r-351704" data-claire-element-id="351704" data-claire-semantic="warning"><p id="r-351703" data-claire-element-id="351703">On va enfin pouvoir créer des groupes : c'est pas trop tôt, depuis le temps que je suis arrivé sur cette page !</p></aside><p id="r-351705" data-claire-element-id="351705">Eh oui, il fallait bien que j'explique. :)</p><h3 id="r-creer-un-groupe-de-permissions" data-claire-element-id="351712">Créer un groupe de permissions</h3><p id="r-351706" data-claire-element-id="351706">Pour faire cette action, nous allons créer la page ajouter_gr_perm.php.<br/> Dans cette page, on trouvera le formulaire ainsi que le traitement en PHP !</p><p id="r-351707" data-claire-element-id="351707">Voici le code :</p><pre id="r-351708" data-claire-element-id="351708"><code data-claire-semantic="html+php">&lt;?php 
// On démarre la session
session_start();
 
mysql_connect('localhost', 'root', ''); // Vos identifiants
mysql_select_db('tuto_perm');
 
define ('ECRIRE_ARTICLE', 0x01); // Nous définissons les constantes de droits
define ('SUPPRIMER_ARTICLE', 0x02); // Une constante = un droit
define ('MODIFIER_ARTICLE', 0x08); // Pour savoir à quoi correspondent les valeurs des constantes, allez ici : http://www.siteduzero.com/tuto-3-6518-1-introduction-aux-operateurs-de-bits.html#ss_part_6
 
 
if(isset($_POST['Nom'])) // Si le formulaire a été validé, on peut effectuer les actions PHP
{
 
        $nom = $_POST['Nom']; // Le nom du groupe
        
        if( $_POST['Add_article'] == 'add_article_oui')  // Si dans le formulaire, on a indiqué que ce groupe pouvait ajouter un article...
        {
                $droits |= ECRIRE_ARTICLE; // On ajoute la permission dans la variable $droits
        }
                                                ## Mêmes actions ci-dessous avec Modifier un article et Supprimer un article ##
        if( $_POST['Mod_article'] == 'mod_article_oui') 
        {
                $droits |= MODIFIER_ARTICLE;
        }
 
        if( $_POST['Del_article'] == 'del_article_oui')  
        {
                $droits |= SUPPRIMER_ARTICLE;
        }
 
        
        $requete = 'INSERT INTO permissions(nom, permissions) 
        VALUES (&quot;'.$nom.'&quot;, &quot;'.@$droits.'&quot;)'; // On prépare la requête, ça va ajouter les permissions stockées dans $droits, ainsi que le nom
        
        $ex_requete = mysql_query($requete)or die(mysql_error()); // On exécute la requête ou on affiche une erreur
        if($ex_requete) echo 'Le groupe a bien été ajouté !&lt;br /&gt;'; // Si c'est OK, on affiche un message disant que c'est bon
        else echo 'Le groupe n\'a pu être ajouté !&lt;br /&gt;'; // Sinon, on en affiche un disant que ce n'est pas bon...
}
                                        ########### FORMULAIRE ###########
?&gt;
&lt;p&gt;Bienvenue dans la gestion des permissions.&lt;br /&gt;
Sur cette page, vous pouvez ajouter un groupe de permissions.&lt;br /&gt;
Pour cela, il vous suffit de remplir les cases ci-dessous.&lt;br /&gt;
&lt;/p&gt;
&lt;form name=&quot;add_groupe&quot; method=&quot;post&quot;&gt;
&lt;label for=&quot;Nom&quot;&gt;Nom du groupe : &lt;/label&gt;&lt;input type=&quot;text&quot; name=&quot;Nom&quot; /&gt;&lt;br /&gt;
 
&lt;label for=&quot;Add_article&quot;&gt;Possibilité d'ajouter un article : &lt;/label&gt;
       &lt;select name=&quot;Add_article&quot; id=&quot;Add_article&quot;&gt;
           &lt;option value=&quot;add_article_oui&quot;&gt;Oui&lt;/option&gt;
                   &lt;option value=&quot;add_article_non&quot;&gt;Non&lt;/option&gt;
       &lt;/select&gt;&lt;br /&gt;
 
&lt;label for=&quot;Mod_article&quot;&gt;Possibilité de modifier un article : &lt;/label&gt;
       &lt;select name=&quot;Mod_article&quot; id=&quot;Mod_article&quot;&gt;
           &lt;option value=&quot;mod_article_oui&quot;&gt;Oui&lt;/option&gt;
                   &lt;option value=&quot;mod_article_non&quot;&gt;Non&lt;/option&gt;
       &lt;/select&gt;&lt;br /&gt;
 
&lt;label for=&quot;Del_article&quot;&gt;Possibilité de supprimer un article :  &lt;/label&gt;
       &lt;select name=&quot;Del_article&quot; id=&quot;Del_article&quot;&gt;
           &lt;option value=&quot;del_article_oui&quot;&gt;Oui&lt;/option&gt;
                   &lt;option value=&quot;del_article_non&quot;&gt;Non&lt;/option&gt;
       &lt;/select&gt;&lt;br /&gt;
 
&lt;input type=&quot;submit&quot; name=&quot;creer&quot; value=&quot;Créer le groupe de permissions !&quot; /&gt;&lt;/form&gt;</code></pre><aside id="r-351710" data-claire-element-id="351710" data-claire-semantic="information"><p id="r-351709" data-claire-element-id="351709">Malgré mes commentaires, vous pouvez ne pas comprendre certaines actions : dans ce cas, envoyez-moi un MP. ;)</p></aside><p id="r-351711" data-claire-element-id="351711">Si vous testez la page, vous verrez le formulaire. :) <br/> Vous pouvez même entrer les informations et valider, ça marche ! :)</p><h3 id="r-modification-suppression-des-groupes" data-claire-element-id="351723">Modification / suppression des groupes</h3><p id="r-351713" data-claire-element-id="351713">Passons à la modification et à la suppression des groupes.</p><p id="r-351714" data-claire-element-id="351714">Pour la modification des groupes (le script le plus dur de tous ceux du tuto :p ), voici le code :</p><pre id="r-351715" data-claire-element-id="351715"><code data-claire-semantic="html+php">&lt;?php 
// On démarre la session
session_start();
 
mysql_connect('localhost', 'root', ''); // Vos identifiants
mysql_select_db('tuto_perm');
 
define ('ECRIRE_ARTICLE', 0x01); // Nous définissons les constantes de droits
define ('SUPPRIMER_ARTICLE', 0x02); // Une constante = un droit
define ('MODIFIER_ARTICLE', 0x08); // Pour savoir à quoi correspondent les valeurs des constantes, allez ici : http://www.siteduzero.com/tuto-3-6518-1-introduction-aux-operateurs-de-bits.html#ss_part_6
 
$select = mysql_query('SELECT * FROM permissions WHERE id = &quot;'.$_REQUEST['id'].'&quot; ')or die(mysql_error()); // On sélectionne les infos
$donnees = mysql_fetch_assoc($select); // On met tout ça dans un tableau
if(!isset($_REQUEST['id'])) // Si on n'a pas choisi le groupe à modifier
{
        $select = mysql_query('SELECT * FROM permissions')or die(mysql_error());
        echo 'Veuillez sélectionner le groupe à modifier : &lt;br /&gt;&lt;ul&gt;';
        while($nom = mysql_fetch_assoc($select))
        {
                echo '&lt;li&gt;&lt;a href=&quot;?id='.$nom['id'].'&quot;&gt;'.$nom['nom'].'&lt;/a&gt;&lt;/li&gt;&lt;br /&gt;';
        }
        echo '&lt;/ul&gt;';
}
elseif(!isset($_POST['id'])) // Si le formulaire n'est pas posté
{
        if (((int)$donnees['permissions'] &amp; ECRIRE_ARTICLE)) 
        {
                $selected_add_article = 1;
        }
        else
        {
                $selected_add_article = 0;
        }
        if (((int)$donnees['permissions'] &amp; SUPPRIMER_ARTICLE)) 
    {
                $selected_del_article = 1;
    }
        else
        {
                $seleted_del_article = 0;
        }
    if (((int)$donnees['permissions'] &amp; MODIFIER_ARTICLE)) 
    {
                $selected_mod_article = 1;
    }
        else
        {
                $selected_mod_article = 0;
        }
 
        
?&gt;&lt;p&gt;Vous pouvez modifier, si vous le souhaitez, les infos et permissions de ce groupe : &lt;/p&gt;&lt;br /&gt;
&lt;form name=&quot;add_groupe&quot; method=&quot;post&quot; &gt;
&lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;&lt;?php echo $_GET['id']; ?&gt;&quot; /&gt;
&lt;label for=&quot;Nom&quot;&gt;Nom du groupe : &lt;/label&gt;&lt;input type=&quot;text&quot; name=&quot;Nom&quot; value=&quot;&lt;?php echo $donnees['nom']; ?&gt;&quot;/&gt;&lt;br /&gt;
   &lt;label for=&quot;Add_article&quot;&gt;Possibilité d'ajouter un article : &lt;/label&gt;
       &lt;select name=&quot;Add_article&quot; id=&quot;Add_article&quot;&gt;
           &lt;option value=&quot;add_article_oui&quot; &lt;?php if($selected_add_article == 1) echo 'selected=&quot;selected&quot;'; ?&gt;&gt;Oui&lt;/option&gt;
                   &lt;option value=&quot;add_article_non&quot; &lt;?php if($selected_add_article == 0) echo 'selected=&quot;selected&quot;'; ?&gt;&gt;Non&lt;/option&gt;
       &lt;/select&gt;&lt;br /&gt;
   &lt;label for=&quot;Mod_article&quot;&gt;Possibilité de modifier un article : &lt;/label&gt;
       &lt;select name=&quot;Mod_article&quot; id=&quot;Mod_article&quot;&gt;
           &lt;option value=&quot;mod_article_oui&quot; &lt;?php if($selected_mod_article == 1) echo 'selected=&quot;selected&quot;'; ?&gt;&gt;Oui&lt;/option&gt;
                   &lt;option value=&quot;mod_article_non&quot; &lt;?php if($selected_mod_article == 0) echo 'selected=&quot;selected&quot;'; ?&gt;&gt;Non&lt;/option&gt;
       &lt;/select&gt;&lt;br /&gt;
  &lt;label for=&quot;Del_article&quot;&gt;Possibilité de supprimer un article : &lt;/label&gt;
       &lt;select name=&quot;Del_article&quot; id=&quot;Del_article&quot;&gt;
           &lt;option value=&quot;del_article_oui&quot; &lt;?php if($selected_del_article == 1) echo 'selected=&quot;selected&quot;'; ?&gt;&gt;Oui&lt;/option&gt;
                   &lt;option value=&quot;del_article_non&quot; &lt;?php if($selected_del_article == 0) echo 'selected=&quot;selected&quot;'; ?&gt;&gt;Non&lt;/option&gt;
       &lt;/select&gt;&lt;br /&gt;
&lt;input type=&quot;submit&quot; name=&quot;creer&quot; value=&quot;Modifier le groupe de permissions !&quot; /&gt;&lt;/form&gt;&lt;?php
        
 
}
else
{
        
        $nom = $_POST['Nom']; // Le nom du groupe
        
        $droits = ''; // On déclare la variable qui va contenir toutes les permissions
        
        if( $_POST['Add_article'] == 'add_article_oui')  // Si dans le formulaire, on a indiqué que ce groupe pouvait ajouter un article...
        {
                $droits |= ECRIRE_ARTICLE; // On ajoute la permission dans la variable $droits
        }
                                                ## Mêmes actions ci-dessous avec Modifier un article et Supprimer un article ##
        if( $_POST['Mod_article'] == 'mod_article_oui') 
        {
                $droits |= MODIFIER_ARTICLE;
        }
 
        if( $_POST['Del_article'] == 'del_article_oui')  
        {
                $droits |= SUPPRIMER_ARTICLE;
        }
        
        $requete = 'UPDATE permissions SET nom = &quot;'.$nom.'&quot;, permissions = &quot;'.$droits.'&quot; WHERE id = &quot;'.htmlspecialchars($_GET['id']).'&quot; '; // On prépare la requête
 
        $ex_requete = mysql_query($requete)or die(mysql_error()); // On exécute la requête, c'est-à-dire que l'on va changer les informations du groupe stockées dans la table
        if($ex_requete)
        {
                echo 'Le groupe a bien été modifié !&lt;br /&gt;'; // Message OK
        }
        else
        {
                echo 'Le groupe n\'a pu être modifié !&lt;br /&gt;';  // Message ERREUR
        }
}
?&gt;</code></pre><p id="r-351716" data-claire-element-id="351716">Le code pour la suppression d'un groupe va être beaucoup moins long, il suffit d'une petite requête. :-° <br/> Allez, voici le code :</p><pre id="r-351717" data-claire-element-id="351717"><code data-claire-semantic="html+php">&lt;?php 
// On démarre la session
session_start();
 
mysql_connect('localhost', 'root', ''); // Vos identifiants
mysql_select_db('tuto_perm');
 
        
if(!isset($_GET['id'])) // Si le groupe à supprimer n'a pas été choisi
{
        $select = mysql_query('SELECT * FROM permissions'); // Requête pour sélectionner tous les groupes
        echo '&lt;i&gt;Veuillez sélectionner le groupe à supprimer : &lt;/i&gt;&lt;br /&gt;&lt;ul&gt;';
        while($do = mysql_fetch_assoc($select)) // Une boucle pour afficher
        {
                echo '&lt;li&gt;&lt;a href=&quot;?id='.$do['id'].'&quot;&gt;'.$do['nom'].'&lt;/a&gt;&lt;/li&gt;&lt;br /&gt;'; // Lien avec le nom
        }
        echo '&lt;/ul&gt;';
}
if(isset($_GET['id']) &amp;&amp; !isset($_GET['confirm'])) // Si le groupe a été sélectionné, on affiche un message de confirmation...
{
        echo 'Êtes-vous sûr de votre choix ?&lt;br /&gt;
        &lt;a href=&quot;?id='.$_GET['id'].'&amp;confirm&quot;&gt;Oui&lt;/a&gt;';
}
if(isset($_GET['id']) &amp;&amp; isset($_GET['confirm'])) // Si le groupe est choisi ET validé, on va pouvoir supprimer
{
        $requete = 'DELETE FROM permissions WHERE id = &quot;'.$_GET['id'].'&quot; '; // Préparation de la requête
 
        $delete = mysql_query($requete)or die(mysql_error()); // On exécute la requête
        if($delete) 
        {
                echo 'Le groupe a bien été supprimé !'; // Si c'est OK...
        }
        else
        {       
                echo 'Le groupe n\'a pu être supprimé !';  // S'il y a une erreur...
        }
}
 
?&gt;</code></pre><p id="r-351718" data-claire-element-id="351718">Cette partie est finie, vous pouvez maintenant ajouter, modifier et supprimer des groupes de permissions !</p><div id="r-351720" data-claire-element-id="351720" data-claire-semantic="question"><p id="r-351719" data-claire-element-id="351719">Mais comment les utiliser ?</p></div><aside id="r-351722" data-claire-element-id="351722" data-claire-semantic="information"><p id="r-351721" data-claire-element-id="351721">C'est ce que nous allons voir dans la partie suivante !</p></aside>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires">Faire un système de droits d&#039;accès grâce aux opérateurs binaires</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/informations-et-creation-des-tables">
Informations et création des tables
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/ajouter-modifier-et-supprimer-les-groupes">
Ajouter, modifier et supprimer les groupes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/l-ajout-d-un-utilisateur-et-la-connexion">
L&#039;ajout d&#039;un utilisateur et la connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/ajouter-des-permissions">
Ajouter des permissions
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/informations-et-creation-des-tables">
<span class="arrow"></span>
<span class="next">Informations et création des tables</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/l-ajout-d-un-utilisateur-et-la-connexion">
<span class="next">L&#039;ajout d&#039;un utilisateur et la connexion</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="L039ajoutd039unutilisateuretlaconnexion"></a><h2>L&#039;ajout d&#039;un utilisateur et la connexion</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/ajouter-modifier-et-supprimer-les-groupes">
<span class="arrow"></span>
<span class="next">Ajouter, modifier et supprimer les groupes</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/ajouter-des-permissions">
<span class="next">Ajouter des permissions</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-351725" data-claire-element-id="351725">Nous voilà dans la dernière partie de ce tutoriel.</p><p id="r-351726" data-claire-element-id="351726">Ici, nous verrons comment ajouter un utilisateur à un groupe (que vous aurez préalablement créé) et mettre ses permissions en session. ;)</p><h3 id="r-ajout-d-un-utilisateur-2" data-claire-element-id="351730">Ajout d'un utilisateur</h3><p id="r-351727" data-claire-element-id="351727">Le code est très simple, un formulaire et une requête !<br/> Vous verrez qu'une partie du formulaire est dynamique, c'est celle qui concerne les groupes, mais mieux vaut regarder le code :</p><pre id="r-351728" data-claire-element-id="351728"><code data-claire-semantic="html+php">&lt;?php session_start(); // On démarre les sessions
 
mysql_connect('localhost', 'root', ''); // Vos identifiants
mysql_select_db('tuto_perm');
 
$select = mysql_query('SELECT * FROM permissions')or die(mysql_error()); // On sélectionne les groupes
 
if(isset($_POST['submit'])) // Si le formulaire a été validé
{
        $pseudo = htmlspecialchars($_POST['Pseudo']); // Son pseudo
        $password = sha1($_POST['Password']); // Son mot de passe, hashé grâce à la fonction sha1()
 
        $id_groupe = $_POST['groupe']; // L’ID du groupe
 
 
        $insert = mysql_query('INSERT INTO users(id, pseudo, password, id_groupe) VALUES(&quot;&quot;, &quot;'.$pseudo.'&quot;, &quot;'.$password.'&quot;, &quot;'.$id_groupe.'&quot;)')or die(mysql_error()); // On insère le tout !
         
        if($insert) echo 'L\'ajout de l\'utilisateur a réussi !'; // Si c'est bon, message OK
        else echo 'L\'ajout de l\'utilisateur a raté !'; // Sinon, on affiche un message d'erreur
}
?&gt;
&lt;p&gt;Si vous souhaitez ajouter un utilisateur, veuillez remplir les champs ci-dessous : &lt;/p&gt;&lt;br /&gt;
&lt;form name=&quot;add_user&quot; method=&quot;post&quot;&gt;
&lt;label for=&quot;Pseudo&quot;&gt;Pseudo : &lt;/label&gt;&lt;input type=&quot;text&quot; name=&quot;Pseudo&quot; /&gt;&lt;br /&gt;
&lt;label for=&quot;Password&quot;&gt;Password : &lt;/label&gt;&lt;input type=&quot;password&quot; name=&quot;Password&quot; /&gt;&lt;br /&gt;
   &lt;label for=&quot;Groupe&quot;&gt;Groupe de permission : &lt;/label&gt;
       &lt;select name=&quot;groupe&quot; id=&quot;groupe&quot;&gt;
        &lt;?php 
                while($noms = mysql_fetch_assoc($select)) // Partie dynamique du formulaire : pour chaque groupe, on ajoute une option
                {
                        echo '&lt;option value=&quot;'.$noms['id'].'&quot;&gt;'.$noms['nom'].'&lt;/option&gt;'; 
                }
        ?&gt;
       &lt;/select&gt;&lt;br /&gt;
           &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Créer l'utilisateur&quot; /&gt;&lt;/form&gt;</code></pre><p id="r-351729" data-claire-element-id="351729">Essayez ce code, il fonctionne. ;) <br/> Petite remarque à propos du mot de passe : il est hashé (et non crypté) grâce à la fonction <strong><a href="http://fr.php.net/sha1">sha1()</a></strong>.<br/> Elle génère une suite de 40 caractères, et en matière de sécurité, je vous la conseille. :)</p><h3 id="r-la-connexion-1" data-claire-element-id="351752">La connexion</h3><p id="r-351731" data-claire-element-id="351731">Si vous gérez déjà votre équipe ou avez déjà développé votre site, vous devriez avoir une page de connexion, utilisée pour s'identifier à l'administration.<br/> Cette page crée des sessions, permettant ainsi aux utilisateurs d'accéder aux pages de l'admin !</p><p id="r-351732" data-claire-element-id="351732">Plutôt que de faire une requête par page pour sélectionner les permissions, j'ai décidé de stocker tous les droits dans une session. Cela est beaucoup plus optimisé. ^^</p><aside id="r-351734" data-claire-element-id="351734" data-claire-semantic="warning"><p id="r-351733" data-claire-element-id="351733">Je ne vous expliquerai pas comment créer une page de connexion, simplement le code à ajouter à votre script !</p></aside><p id="r-351735" data-claire-element-id="351735">Partons du principe que votre script ressemble à ça :</p><pre id="r-351736" data-claire-element-id="351736"><code data-claire-semantic="html+php">&lt;?php
 
### Récupération des données ###
 
### Requêtes &amp; conditions ###
 
### Création des sessions si c'est bon ###
 
### Formulaire ###
 
?&gt;</code></pre><p id="r-351737" data-claire-element-id="351737">(C'est juste la structure, hein. :p )</p><p id="r-351738" data-claire-element-id="351738">Nous n'aurons à modifier que la partie sur la création des sessions. ;)</p><p id="r-351739" data-claire-element-id="351739">Voici ce que vous devez ajouter :</p><pre id="r-351740" data-claire-element-id="351740"><code data-claire-semantic="html+php">&lt;?php
 
$pseudo = $_POST['pseudo']; // Le pseudo récupéré dans le formulaire
 
$select2 = mysql_query(&quot;SELECT * FROM users WHERE AND pseudo = '$pseudo' &quot;)or die(mysql_error());
$don = mysql_fetch_assoc($select2);
 
$select = mysql_query('SELECT * FROM permissions WHERE id = &quot;'.$don['id_groupe'].'&quot; ')or die(mysql_error());
$donnees = mysql_fetch_assoc($select);
 
$_SESSION['pseudo'] = $don['pseudo'];
$_SESSION['droits'] = addslashes($donnees['permissions']); // ATTENTION : remarquez ici l'utilisation de la fonction addslashes : sans elle, je ne récupérerais qu'une partie des permissions. Les permissions sont comme ça : 0\0\0\0\etc. Sans addslashes, je ne récupèrerais que le premier 0 !
 
?&gt;</code></pre><aside id="r-351742" data-claire-element-id="351742" data-claire-semantic="warning"><p id="r-351741" data-claire-element-id="351741">Ce code n'est pas sécurisé ! À vous de le modifier selon votre page de connexion actuelle.</p></aside><p id="r-351743" data-claire-element-id="351743">Voilà, j'espère que vous avez suivi. :p</p><p id="r-351744" data-claire-element-id="351744">Si je récapitule bien, nous avons fait l'ajout d'un groupe, la modification d'un groupe, la suppression d'un groupe, l'ajout d'un utilisateur et la création des sessions de permission !<br/> Vous vous direz que c'est fini, mais en fait non !</p><p id="r-351745" data-claire-element-id="351745">Il nous reste un petit détail à régler : la sécurité de vos pages.<br/> En effet, c'est bien beau de faire tout ça mais si vous ne protégez pas vos pages, cela ne servira à rien.</p><p id="r-351746" data-claire-element-id="351746">Voici ce que vous devez ajouter en haut de votre page pour créer un article (si vous avez une page qui effectue cette action) :</p><pre id="r-351747" data-claire-element-id="351747"><code data-claire-semantic="html+php">&lt;?php session_start();
 
define ('ECRIRE_ARTICLE', 0x01); // Nous définissons les constantes de droits
define ('SUPPRIMER_ARTICLE', 0x02); // Une constante = un droit
define ('MODIFIER_ARTICLE', 0x08); // Pour savoir à quoi correspondent les valeurs des constantes, allez ici : http://www.siteduzero.com/tuto-3-6518-1-introduction-aux-operateurs-de-bits.html#ss_part_6
 
  if (!((int)$_SESSION['droits'] &amp; ECRIRE_ARTICLE)) 
  {
        echo 'Vous ne pouvez pas accéder à cette page !&lt;br /&gt;';
        exit;
  }
?&gt;</code></pre><p id="r-351748" data-claire-element-id="351748">Notez que dans la condition, <strong>ECRIRE_ARTICLE</strong> est la constante qui s'occupe du droit pour écrire un article. Vous devez donc remplacer ECRIRE_ARTICLE par le nom d'une autre constante pour les autres pages.<br/> Par exemple, dans la page pour modifier un article, vous devrez mettre ce code :</p><pre id="r-351749" data-claire-element-id="351749"><code data-claire-semantic="html+php">&lt;?php session_start();
 
define ('ECRIRE_ARTICLE', 0x01); // Nous définissons les constantes de droits
define ('SUPPRIMER_ARTICLE', 0x02); // Une constante = un droit
define ('MODIFIER_ARTICLE', 0x08); // Pour savoir à quoi correspondent les valeurs des constantes, allez ici : http://www.siteduzero.com/tuto-3-6518-1-introduction-aux-operateurs-de-bits.html#ss_part_6
 
  if (!((int)$_SESSION['droits'] &amp; MODIFIER_ARTICLE)) 
  {
        echo 'Vous ne pouvez pas accéder à cette page !&lt;br /&gt;';
        exit;
  }
?&gt;</code></pre><p id="r-351750" data-claire-element-id="351750">Et voilà !</p><p id="r-351751" data-claire-element-id="351751">Tout fonctionne parfaitement, mais je vais vous indiquer dans la partie suivante comment ajouter des permissions au script. :)</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires">Faire un système de droits d&#039;accès grâce aux opérateurs binaires</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/informations-et-creation-des-tables">
Informations et création des tables
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/ajouter-modifier-et-supprimer-les-groupes">
Ajouter, modifier et supprimer les groupes
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/l-ajout-d-un-utilisateur-et-la-connexion">
L&#039;ajout d&#039;un utilisateur et la connexion
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/ajouter-des-permissions">
Ajouter des permissions
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/ajouter-modifier-et-supprimer-les-groupes">
<span class="arrow"></span>
<span class="next">Ajouter, modifier et supprimer les groupes</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/ajouter-des-permissions">
<span class="next">Ajouter des permissions</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Ajouterdespermissions"></a><h2>Ajouter des permissions</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/l-ajout-d-un-utilisateur-et-la-connexion">
<span class="arrow"></span>
<span class="next">L&#039;ajout d&#039;un utilisateur et la connexion</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<p id="r-351754" data-claire-element-id="351754">Bon, tous les scripts sont finis ; mais nous allons les modifier.</p><div id="r-351756" data-claire-element-id="351756" data-claire-semantic="question"><p id="r-351755" data-claire-element-id="351755">Eh, mais pourquoi nous dis-tu de créer la page avec ce contenu si après tu veux le modifier ? :colere2:</p></div><aside id="r-351758" data-claire-element-id="351758" data-claire-semantic="information"><p id="r-351757" data-claire-element-id="351757">Parce que je ne vous ai pas montré comment vous pouviez ajouter des droits !</p></aside><p id="r-351759" data-claire-element-id="351759">Ici, nous allons modifier deux pages : ajouter_gr_perm.php (ajout d'un groupe) et modifier_gr_perm.php (modification d'un groupe).</p><h3 id="r-ajouter-un-groupe" data-claire-element-id="351773">Ajouter un groupe</h3><p id="r-351760" data-claire-element-id="351760">Premièrement, nous allons modifier les déclarations de constantes en haut de la page :</p><pre id="r-351761" data-claire-element-id="351761"><code data-claire-semantic="html+php">&lt;?php
define ('ECRIRE_ARTICLE', 0x01); // Nous définissons les constantes de droits
define ('SUPPRIMER_ARTICLE', 0x02); // Une constante = un droit
define ('MODIFIER_ARTICLE', 0x08); // Pour savoir à quoi correspondent les valeurs des constantes, allez ici : http://www.siteduzero.com/tuto-3-6518-1-introduction-aux-operateurs-de-bits.html#ss_part_6
define ('Add_gr_perm', 0x10);
define ('Mod_gr_perm', 0x20);
define ('Add_user', 0x40);
?&gt;</code></pre><p id="r-351762" data-claire-element-id="351762">Ici, j'ai ajouté trois constantes : deux pour ajouter / modifier un groupe de permissions, et la troisième pour ajouter un utilisateur.<br/> Si l'on regarde plus précisément, on voit que les valeurs des constantes ont elles aussi changé !</p><p id="r-351763" data-claire-element-id="351763">En effet, à chaque nouvelle permission, nous devons changer la valeur de la constante, logique.<br/> Voici les différentes valeurs que vous pouvez mettre :</p><p id="r-351764" data-claire-element-id="351764">&lt;tableau&gt; <br/> &lt;ligne&gt;<br/> &lt;entete&gt;0x01&lt;/entete&gt;<br/> &lt;entete&gt;0x02&lt;/entete&gt;<br/> &lt;entete&gt;0x04&lt;/entete&gt;<br/> &lt;entete&gt;0x08&lt;/entete&gt;<br/> &lt;entete&gt;0x10&lt;/entete&gt;<br/> &lt;entete&gt;0x20&lt;/entete&gt;<br/> &lt;entete&gt;0x40&lt;/entete&gt;<br/> &lt;entete&gt;0x80&lt;/entete&gt;<br/> &lt;entete&gt;0x100&lt;/entete&gt;<br/> &lt;entete&gt;0x200&lt;/entete&gt;<br/> &lt;entete&gt;0x400&lt;/entete&gt;<br/> &lt;entete&gt;0x800&lt;/entete&gt;<br/> &lt;entete&gt;0x1000&lt;/entete&gt;<br/> &lt;entete&gt;0x2000&lt;/entete&gt;<br/> &lt;entete&gt;0x4000&lt;/entete&gt;<br/> &lt;entete&gt;0x8000&lt;/entete&gt;<br/> &lt;/ligne&gt;<br/> &lt;/tableau&gt;<br/> Vous savez donc maintenant quoi mettre en contenu !</p><p id="r-351765" data-claire-element-id="351765">Maintenant, passons à la deuxième modification de cette page.<br/> Cela concerne la partie qui récupère vos choix du formulaire ; ce que vous devez ajouter se situe après cette ligne :</p><pre id="r-351766" data-claire-element-id="351766"><code data-claire-semantic="html+php">&lt;?php
        if( $_POST['Del_article'] == 'del_article_oui')  
        {
                $droits |= SUPPRIMER_ARTICLE;
        }
?&gt;</code></pre><p id="r-351767" data-claire-element-id="351767">Voici le code (à ajouter) :</p><pre id="r-351768" data-claire-element-id="351768"><code data-claire-semantic="html+php">&lt;?php
        if( $_POST['Add_gr_perm'] == 'Add_gr_perm_oui')  
        {
                $droits |= Add_gr_perm;
        }
        if( $_POST['Mod_gr_perm'] == 'Mod_gr_perm_oui')
        {
                $droits |= Mod_gr_perm;
        }
        if( $_POST['Add_user'] == 'Add_user_oui')
        {
                $droits |= Add_user;
        }
?&gt;</code></pre><p id="r-351769" data-claire-element-id="351769">Bon. Dernière partie à modifier : le formulaire.</p><p id="r-351770" data-claire-element-id="351770">Nous allons ajouter trois listes, une pour chaque action. Voici le code HTML à ajouter au formulaire :</p><pre id="r-351771" data-claire-element-id="351771"><code data-claire-semantic="html">&lt;label for=&quot;Add_gr_perm&quot;&gt;Possibilité d'ajouter un groupe de permissions : &lt;/label&gt;
       &lt;select name=&quot;Add_gr_perm&quot; id=&quot;Add_gr_perm&quot;&gt;
           &lt;option value=&quot;Add_gr_perm_oui&quot;&gt;Oui&lt;/option&gt;
                   &lt;option value=&quot;Add_gr_perm_non&quot;&gt;Non&lt;/option&gt;
       &lt;/select&gt;&lt;br /&gt;
&lt;label for=&quot;Mod_gr_perm&quot;&gt;Possibilité de modifier / supprimer un groupe de permissions : &lt;/label&gt;
       &lt;select name=&quot;Mod_gr_perm&quot; id=&quot;Mod_gr_perm&quot;&gt;
           &lt;option value=&quot;Mod_gr_perm_oui&quot;&gt;Oui&lt;/option&gt;
                   &lt;option value=&quot;Mod_gr_perm_non&quot;&gt;Non&lt;/option&gt;
       &lt;/select&gt;&lt;br /&gt;
&lt;label for=&quot;Add_user&quot;&gt;Possibilité d'ajouter un utilisateur : &lt;/label&gt;
       &lt;select name=&quot;Add_user&quot; id=&quot;Add_user&quot;&gt;
           &lt;option value=&quot;Add_user_oui&quot;&gt;Oui&lt;/option&gt;
                   &lt;option value=&quot;Add_user_non&quot;&gt;Non&lt;/option&gt;
       &lt;/select&gt;&lt;br /&gt;</code></pre><p id="r-351772" data-claire-element-id="351772">Et voilà ! :)</p><h3 id="r-modification-d-un-groupe" data-claire-element-id="351799">Modification d'un groupe</h3><p id="r-351774" data-claire-element-id="351774">Dans cette page, nous allons modifier à peu près les mêmes parties que pour l'ajout d'un groupe.</p><p id="r-351775" data-claire-element-id="351775">En premier, ajoutez au début les constantes à la suite de celles déjà existantes :</p><pre id="r-351776" data-claire-element-id="351776"><code data-claire-semantic="html+php">&lt;?php define ('Add_gr_perm', 0x10);
        define ('Mod_gr_perm', 0x20);
        define ('Add_user', 0x40); ?&gt;</code></pre><p id="r-351777" data-claire-element-id="351777">Deuxièmement, à la suite de la ligne contenant cette condition :</p><pre id="r-351778" data-claire-element-id="351778"><code data-claire-semantic="html+php">&lt;?php
    if (((int)$donnees['permissions'] &amp; MODIFIER_ARTICLE)) 
    {
                $selected_mod_article = 1;
    }
?&gt;</code></pre><p id="r-351779" data-claire-element-id="351779">Vous devez ajouter :</p><pre id="r-351780" data-claire-element-id="351780"><code data-claire-semantic="html+php">&lt;?php
          if (((int)$donnees['permissions'] &amp; Add_gr_perm)) 
          {
                $selected_add_gr_perm = 1;
          }
        else
        {
                $selected_add_gr_perm = 0;
        }
        if (((int)$donnees['permissions'] &amp; Mod_gr_perm)) 
          {
                $selected_mod_gr_perm = 1;
          }
        else
        {
                $selected_mod_gr_perm = 0;
        }
        if (((int)$donnees['permissions'] &amp; Add_user)) 
          {
                $selected_add_user = 1;
          }
        else
        {
                $selected_add_user = 0;
        }       
?&gt;</code></pre><p id="r-351781" data-claire-element-id="351781">Troisièmement, vous devez (encore) modifier le formulaire pour ajouter :</p><pre id="r-351782" data-claire-element-id="351782"><code data-claire-semantic="html+php">&lt;label for=&quot;Add_gr_perm&quot;&gt;Possibilité d'ajouter un groupe de permissions : &lt;/label&gt;
       &lt;select name=&quot;Add_gr_perm&quot; id=&quot;Add_gr_perm&quot;&gt;
           &lt;option value=&quot;Add_gr_perm_oui&quot; &lt;?php if($selected_add_gr_perm == 1) echo 'selected=&quot;selected&quot;'; ?&gt;&gt;Oui&lt;/option&gt;
                   &lt;option value=&quot;Add_gr_perm_non&quot; &lt;?php if($selected_add_gr_perm == 0) echo 'selected=&quot;selected&quot;'; ?&gt;&gt;Non&lt;/option&gt;
       &lt;/select&gt;&lt;br /&gt;
&lt;label for=&quot;Mod_gr_perm&quot;&gt;Possibilité de modifier / supprimer un groupe de permissions : &lt;/label&gt;
       &lt;select name=&quot;Mod_gr_perm&quot; id=&quot;Mod_gr_perm&quot;&gt;
           &lt;option value=&quot;Mod_gr_perm_oui&quot; &lt;?php if($selected_mod_gr_perm == 1) echo 'selected=&quot;selected&quot;'; ?&gt;&gt;Oui&lt;/option&gt;
                   &lt;option value=&quot;Mod_gr_perm_non&quot; &lt;?php if($selected_mod_gr_perm == 0) echo 'selected=&quot;selected&quot;'; ?&gt;&gt;Non&lt;/option&gt;
       &lt;/select&gt;&lt;br /&gt;
&lt;label for=&quot;Add_user&quot;&gt;Possibilité d'ajouter un utilisateur : &lt;/label&gt;
       &lt;select name=&quot;Add_user&quot; id=&quot;Add_user&quot;&gt;
           &lt;option value=&quot;Add_user_oui&quot; &lt;?php if($selected_add_user == 1) echo 'selected=&quot;selected&quot;'; ?&gt;&gt;Oui&lt;/option&gt;
                   &lt;option value=&quot;Add_user_non&quot; &lt;?php if($selected_add_user == 0) echo 'selected=&quot;selected&quot;'; ?&gt;&gt;Non&lt;/option&gt;
       &lt;/select&gt;&lt;br /&gt;</code></pre><p id="r-351783" data-claire-element-id="351783">Enfin, au niveau du traitement du formulaire, juste après :</p><pre id="r-351784" data-claire-element-id="351784"><code data-claire-semantic="html+php">&lt;?php
        if( $_POST['Del_article'] == 'del_article_oui')  
        {
                $droits |= SUPPRIMER_ARTICLE;
        }
?&gt;</code></pre><p id="r-351785" data-claire-element-id="351785">vous devez ajouter :</p><pre id="r-351786" data-claire-element-id="351786"><code data-claire-semantic="html+php">&lt;?php
        if( $_POST['Add_gr_perm'] == 'Add_gr_perm_oui')  
        {
                $droits |= Add_gr_perm;
        }
        if( $_POST['Mod_gr_perm'] == 'Mod_gr_perm_oui')
        {
                $droits |= Mod_gr_perm;
        }
        if( $_POST['Add_user'] == 'Add_user_oui')
        {
                $droits |= Add_user;
        }
?&gt;</code></pre><p id="r-351787" data-claire-element-id="351787">Voilà.<br/> J'espère que vous avez compris comment ajouter des droits.<br/> J'avoue que cela peut paraître déroutant au début (quand on voit ce qu'il faut modifier ^^ ), mais après la gestion se passe très bien, et vous serez contents d'avoir fait tout ça !</p><p id="r-351788" data-claire-element-id="351788">D'autant plus que vous pourrez améliorer votre site en créant des groupes « publics » :</p><ul id="r-351795" data-claire-element-id="351795"><li id="r-351790" data-claire-element-id="351790"><p id="r-351789" data-claire-element-id="351789"><em><strong>Visiteurs</strong></em> : ceux n'étant pas inscrits, vous pouvez indiquer ce qu'ils peuvent faire ;</p></li><li id="r-351792" data-claire-element-id="351792"><p id="r-351791" data-claire-element-id="351791"><em><strong>Bannis</strong></em> : créez le groupe en ne mettant aucune permission !</p></li><li id="r-351794" data-claire-element-id="351794"><p id="r-351793" data-claire-element-id="351793"><em><strong>Lecture seule</strong></em> : je pense que vous avez compris à quoi ce groupe servait. ^^</p></li></ul><p id="r-351796" data-claire-element-id="351796">Il me semble que maintenant ce tutoriel est entièrement fini, j'espère donc qu'il vous a bien instruits.</p><p id="r-351797" data-claire-element-id="351797">Pour toute question, commentaire, vous pouvez poster un message grâce aux « commentaires de tuto ». :)</p><p id="r-351798" data-claire-element-id="351798">Bonne chance pour la mise en place des scripts sur votre site !</p>
<aside class="aside-menu">
<ul class="content-menu subchapter" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires">Faire un système de droits d&#039;accès grâce aux opérateurs binaires</a>
</li>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/informations-et-creation-des-tables">
Informations et création des tables
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/ajouter-modifier-et-supprimer-les-groupes">
Ajouter, modifier et supprimer les groupes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/l-ajout-d-un-utilisateur-et-la-connexion">
L&#039;ajout d&#039;un utilisateur et la connexion
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/ajouter-des-permissions">
Ajouter des permissions
</a>
</li>
</ul>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires/l-ajout-d-un-utilisateur-et-la-connexion">
<span class="arrow"></span>
<span class="next">L&#039;ajout d&#039;un utilisateur et la connexion</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires.html by HTTrack Website Copier/3.x [XR&CO'2013], Sat, 26 Oct 2013 20:56:35 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/faire-un-systeme-de-droits-d-acces-grace-aux-operateurs-binaires.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 03:55:12 GMT -->
</html>