<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/la-programmation-systeme-en-c-sous-unix.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 09:14:47 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/la-programmation-systeme-en-c-sous-unix.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:37:57 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : La programmation système en C sous Unix</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : La programmation système en C sous Unix</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#LaprogrammationsystmeenCsousUnix">La programmation système en C sous Unix</a><br/><a href="#Avant-propos">Avant-propos</a><br/><a href="#Introduction">Introduction</a><br/><a href="#GnralitssurledveloppementsousUnix">Généralités sur le développement sous Unix</a><br/><a href="#Conventionstypographiques">Conventions typographiques</a><br/><a href="#Gestiondeserreurs">Gestion des erreurs</a><br/><a href="#Lesprocessus">Les processus</a><br/><a href="#Prsentationdesprocessus">Présentation des processus</a><br/><a href="#Notions">Notions</a><br/><a href="#Crationd039unnouveauprocessus">Création d&#039;un nouveau processus</a><br/><a href="#Terminaisond039unprocessus">Terminaison d&#039;un processus</a><br/><a href="#Excuterunprogramme">Exécuter un programme</a><br/><a href="#Notionspr-requises">Notions pré-requises</a><br/><a href="#Lesfonctionsdelafamilleexec">Les fonctions de la famille exec</a><br/><a href="#Lafonctionsystem">La fonction system</a><br/><a href="#Lesthreads">Les threads</a><br/><a href="#Qu039estcequ039unthread">Qu&#039;est ce qu&#039;un thread ?</a><br/><a href="#Compilation">Compilation</a><br/><a href="#Manipulationdesthreads">Manipulation des threads</a><br/><a href="#Exclusionsmutuelles">Exclusions mutuelles</a><br/><a href="#Lesconditions">Les conditions</a><br/><a href="#Lestubes">Les tubes</a><br/><a href="#Qu039estcequ039untube">Qu&#039;est ce qu&#039;un tube ?</a><br/><a href="#Manipulerlestubes">Manipuler les tubes</a><br/><a href="#Pratique">Pratique</a><br/><a href="#Notionscomplmentairessurlestubes">Notions complémentaires sur les tubes</a><br/></div>
<a name="LaprogrammationsystmeenCsousUnix"></a><h2>La programmation système en C sous Unix</h2><div class="content" role="article">
<p id="r-477752" data-claire-element-id="477752">Bienvenue à toutes et à tous !</p><p id="r-477753" data-claire-element-id="477753">Alors comme ça, vous êtes tentés par la <em>programmation système en C sous Unix</em> ?<br/> Peut-être ne savez-vous pas ce que c'est, et avez cliqué par curiosité. C'est pourquoi, avant de commencer, nous allons répondre à la question :</p><div id="r-477755" data-claire-element-id="477755" data-claire-semantic="question"><p id="r-477754" data-claire-element-id="477754">Qu'est-ce que la programmation système ?</p></div><p id="r-477756" data-claire-element-id="477756">Lorsque l'on dispose d'un système d'exploitation, ce dernier permet de différencier deux types de programmes :</p><ul id="r-477761" data-claire-element-id="477761"><li id="r-477758" data-claire-element-id="477758"><p id="r-477757" data-claire-element-id="477757">les <strong>programmes d'application</strong> des utilisateurs. Ces programmes sont réalisés lors de la programmation dite « classique », celle que vous avez fait par exemple pendant le tutoriel sur le C de M@teo21.</p></li><li id="r-477760" data-claire-element-id="477760"><p id="r-477759" data-claire-element-id="477759">Les <strong>programmes systèmes</strong> qui permettent le fonctionnement de l'ordinateur. C'est ce type de programme que nous allons créer dans ce cours.</p></li></ul><p id="r-477762" data-claire-element-id="477762">Le système d'exploitation sur lequel vous travaillerez devra faire partie de la « famille Unix », dont font partie GNU/Linux, Mac OS, Free BSD... Vous trouverez une schématisation plus ou moins exhaustive <a href="http://upload.wikimedia.org/wikipedia/commons/c/ce/Unix_history.en.svg">ici</a>.<br/> Il faut savoir que le langage C, à partir duquel nous programmerons, a été créé spécialement pour la programmation système, plus précisément pour le développement du système d'exploitation... UNIX. Il est donc particulièrement adapté à ce type de programmation.</p><p id="r-477763" data-claire-element-id="477763">Le seul prérequis nécessaire à la lecture de ce cours est de connaître les bases du langage C. Les deux première parties du <a href="http://www.siteduzero.com/tutoriel-3-14189-apprenez-a-programmer-en-c.html">tutoriel C</a> du site seront suffisantes.<br/> Avoir quelques connaissances sur les systèmes d'exploitation de type Unix est également préférable (bien que de nombreuses explications seront reprises dans ce cours).</p><p id="r-477764" data-claire-element-id="477764">Eh bien, fini les bavardages, on passe à la pratique !</p>
</div>
<div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1358423835269-0" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1358423835269-0');
        });
    }
    </script>
</div><a name="Avant-propos"></a><h2>Avant-propos</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
<span class="next">Introduction</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-477767" data-claire-element-id="477767">Avant de nous jeter corps et âme dans la programmation système, commençons par étudier quelques notions théoriques sur la programmation système et sur la famille Unix. <br/> A la fin de ce premier chapitre, vous saurez :</p><ul id="r-477774" data-claire-element-id="477774"><li id="r-477769" data-claire-element-id="477769"><p id="r-477768" data-claire-element-id="477768">définir précisément la programmation système ;</p></li><li id="r-477771" data-claire-element-id="477771"><p id="r-477770" data-claire-element-id="477770">le fonctionnement général de la programmation sous Unix ;</p></li><li id="r-477773" data-claire-element-id="477773"><p id="r-477772" data-claire-element-id="477772">gérer correctement vos erreurs.</p></li></ul>
</div><a name="Introduction"></a><h2>Introduction</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">
<span class="arrow"></span>
<span class="next">Avant-propos</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
<span class="next">Généralités sur le développement sous Unix</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-introduction-72" data-claire-element-id="477783">Introduction</h4><div id="r-477776" data-claire-element-id="477776" data-claire-semantic="question"><p id="r-477775" data-claire-element-id="477775">Quel est le but de ce tutoriel ?</p></div><p id="r-477777" data-claire-element-id="477777">Ce cours a pour but de vous apprendre à maîtriser toutes les finesses de la programmation système.</p><div id="r-477779" data-claire-element-id="477779" data-claire-semantic="question"><p id="r-477778" data-claire-element-id="477778">Qu'est-ce que nous allons savoir faire ?</p></div><p id="r-477780" data-claire-element-id="477780">La programmation système permet de <em>créer des drivers</em>, <em>communiquer avec les périphériques</em>, voire même <em>créer un système d'exploitation</em> !</p><p id="r-477781" data-claire-element-id="477781">(mais bon on en est pas encore là hein :honte: )</p><p id="r-477782" data-claire-element-id="477782">Par exemple, les emblématiques <a href="http://fr.wikipedia.org/wiki/Apache_HTTP_Server">Apache</a>, <a href="http://fr.wikipedia.org/wiki/Emacs">Emacs</a>, <a href="http://fr.wikipedia.org/wiki/GNU_Compiler_Collection">gcc</a>, <a href="http://fr.wikipedia.org/wiki/GNU_Debugger">gdb</a> ou encore <a href="http://fr.wikipedia.org/wiki/Glibc">glibc</a> sont des programmes systèmes.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">
<span class="arrow"></span>
<span class="next">Avant-propos</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
<span class="next">Généralités sur le développement sous Unix</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="GnralitssurledveloppementsousUnix"></a><h2>Généralités sur le développement sous Unix</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
<span class="arrow"></span>
<span class="next">Introduction</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
<span class="next">Conventions typographiques</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-generalites-sur-le-developpement-sous-unix" data-claire-element-id="477792">Généralités sur le développement sous Unix</h4><p id="r-477784" data-claire-element-id="477784">Dans cette troisième partie, nous allons aborder quelques termes de vocabulaire indispensables pour la suite du cours.</p><p id="r-477785" data-claire-element-id="477785">Les systèmes <em>Unix</em> sont des systèmes d'exploitation qui sont constitués de plusieurs programmes, et chacun d'eux fournit un service au système. Tous les programmes qui fournissent des services similaires sont regroupés dans une <strong>couche logicielle</strong>.</p><p id="r-477786" data-claire-element-id="477786">Une couche logicielle qui a accès au matériel informatique s'appelle une couche d'<strong>abstraction matérielle</strong>.</p><p id="r-477787" data-claire-element-id="477787">Le <strong>noyau </strong>est une sorte de logiciel d'arrière-plan qui assure les communications entre ces programmes. C'est donc par lui qu'il va nous falloir passer pour avoir accès aux informations du système.</p><p id="r-477788" data-claire-element-id="477788">Pour accéder à ces informations, nous allons utiliser des fonctions qui permettent de communiquer avec le noyau. Ces fonctions s'appellent des <strong>appels-systèmes</strong>.<br/> De manière plus théorique, le terme « appel-système » désigne l'appel d'une fonction, qui, depuis l'espace utilisateur, demande des services ou des ressources au système d'exploitation. Par exemple, les fonctions <code data-claire-semantic="c">read</code> et <code data-claire-semantic="c">write</code> sont des appels-systèmes.</p><p id="r-477789" data-claire-element-id="477789">Chaque architecture matérielle ne supporte que sa propre liste d'appels-systèmes, c'est pourquoi les appels-systèmes diffèrent d'une machine à l'autre. Heureusement, la plupart d'entre eux (90% environ) sont implémentés sur toutes les machines. Les 10% restants ne seront pas utilisés dans ce cours. ;)</p><p id="r-477790" data-claire-element-id="477790">Pour des raisons de sécurité évidentes, les applications de l'espace utilisateur ne peuvent pas directement exécuter le code du noyau ou manipuler ses données. Par conséquent, un mécanisme de signaux a été mis en place. Quand une application exécute un appel-système, elle peut alors effectuer un <strong><a href="http://en.wikipedia.org/wiki/Trap_(computing)">trap</a></strong>, et peut exécuter le code, du moment que le noyau le lui autorise.</p><p id="r-477791" data-claire-element-id="477791">On peut également qualifier le système de <strong>multitâche</strong>, ce qui signifie qu'il est capable de gérer l'exécution de plusieurs programmes en simultanée et de <strong>multi-utilisateur</strong> car il permet que plusieurs utilisateurs aient accès au même ordinateur en même temps, et qu'ils puissent profiter des mêmes ressources.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
<span class="arrow"></span>
<span class="next">Introduction</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
<span class="next">Conventions typographiques</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Conventionstypographiques"></a><h2>Conventions typographiques</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
<span class="arrow"></span>
<span class="next">Généralités sur le développement sous Unix</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
<span class="next">Gestion des erreurs</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-conventions-typographiques" data-claire-element-id="477802">Conventions typographiques</h4><p id="r-477793" data-claire-element-id="477793">Derrière ce titre un peu barbare, je vais vous montrer comment ce cours va être administré pour mettre en valeur les expressions :</p><h6 id="r-noms-propres-materiaux-en-italique" data-claire-element-id="477795">Noms propres, matériaux en italique</h6><p id="r-477794" data-claire-element-id="477794">Exemple : Sous un environnement <em>GNOME </em>de <em>Linux</em>, quand j'ai ouvert l'<em>analyseur d'utilisation des disques</em>, rien ne s'est passé.</p><h6 id="r-police-courrier-pour-les-chemins-ou-noms-de-repertoire-fichiers" data-claire-element-id="477797">Police courrier pour les chemins ou noms de répertoire/fichiers</h6><p id="r-477796" data-claire-element-id="477796">Exemple : Rendez-vous dans le répertoire /usr/include et ouvrez le fichier nommé passwd.</p><h6 id="r-mots-importants-en-gras" data-claire-element-id="477799">Mots importants en gras</h6><p id="r-477798" data-claire-element-id="477798">Exemple : Nous allons utiliser un <strong>appel-système</strong> qui va dupliquer le <strong>processus</strong> appelant.</p><h6 id="r-constantes-definies-par-le-systeme-en-violet" data-claire-element-id="477801">Constantes définies par le système en violet</h6><p id="r-477800" data-claire-element-id="477800">Exemple : Il existe deux constantes pour cela : STDIN_FILENO et STDOUT_FILENO.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
<span class="arrow"></span>
<span class="next">Généralités sur le développement sous Unix</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
<span class="next">Gestion des erreurs</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Gestiondeserreurs"></a><h2>Gestion des erreurs</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
<span class="arrow"></span>
<span class="next">Conventions typographiques</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">
<span class="next">Les processus</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-gestion-des-erreurs-3" data-claire-element-id="477819">Gestion des erreurs</h4><p id="r-477803" data-claire-element-id="477803">Avec la programmation système, nous allons étudier et manipuler tout ce qui touche à votre système d'exploitation. <br/> Ainsi, nous devrons faire face assez souvent à des codes d'erreurs. La gestion des erreurs est donc un élément primordial dans la programmation système.</p><h6 id="r-la-variable-globale-errno" data-claire-element-id="477809">La variable globale <code data-claire-semantic="c">errno</code></h6><p id="r-477804" data-claire-element-id="477804">Pour signaler une erreur, les fonctions renvoient une valeur spéciale, indiquée dans leur documentation. Celle-ci est généralement <strong>-1</strong> (sauf pour quelques exceptions). La valeur d'erreur alerte l'appelant de la survenance d'une erreur, mais elle ne fournit pas la description de ce qui s'est produit. La variable globale <code data-claire-semantic="c"><strong>errno</strong></code> est alors utilisée pour en trouver la cause.</p><p id="r-477805" data-claire-element-id="477805">Cette variable est définie dans &lt;errno.h&gt; comme suit :</p><pre id="r-477806" data-claire-element-id="477806"><code data-claire-semantic="c">#include &lt;errno.h&gt;

extern int errno;</code></pre><p id="r-477807" data-claire-element-id="477807">Sa valeur est valable uniquement juste après l'utilisation de la fonction que l'on veut tester. En effet, si on utilise une autre fonction entre le retour que l'on veut tester et l'exploitation de la variable de <code data-claire-semantic="c">errno</code>, la valeur de <code data-claire-semantic="c">errno</code> peut être modifiée entre temps.</p><p id="r-477808" data-claire-element-id="477808">A chaque valeur possible de <code data-claire-semantic="c">errno</code> correspond une constante du préprocesseur. Pour les connaître, je vous conseille de taper la commande <code data-claire-semantic="console">man errno</code>. Une description de chaque erreur y est disponible (en anglais ! :ange: ).</p><h6 id="r-la-fonction-perror" data-claire-element-id="477818">La fonction <code data-claire-semantic="c">perror</code></h6><p id="r-477810" data-claire-element-id="477810">La bibliothèque C met également à notre disposition une fonction permettant d'associer à l'utilisation d'une fonction une description de l'erreur (si il y en a eu une) qui s'est produite. Cette fonction, la voici :</p><pre id="r-477811" data-claire-element-id="477811"><code data-claire-semantic="c">#include &lt;stdio.h&gt;

void perror(const char *s);</code></pre><p id="r-477812" data-claire-element-id="477812">Cette fonction affiche sur <code data-claire-semantic="c">stderr</code> (sortie d'erreur standard) une représentation en une chaîne de caractère de l'erreur décrite par errno, précédée par la chaîne de caractère pointée par <code data-claire-semantic="c">s</code> ainsi que d'un espace.</p><p id="r-477813" data-claire-element-id="477813">Par convention, le nom de la fonction qui a produit cette erreur doit être inclus dans la chaîne. Par exemple :</p><p id="r-477814" data-claire-element-id="477814">Exemple :</p><pre id="r-477815" data-claire-element-id="477815"><code data-claire-semantic="c">if (fork() == -1) {
    perror(&quot;fork&quot;);
}</code></pre><p id="r-477816" data-claire-element-id="477816">Eh bien voilà, ce premier chapitre est terminé.<br/> Nous avons fait un tour d'horizon de ce qui nous attend, et comment l'aborder.</p><p id="r-477817" data-claire-element-id="477817">Dans le prochain chapitre, on entre enfin la programmation système, avec une étude des <em>processus</em>.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
<span class="arrow"></span>
<span class="next">Conventions typographiques</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">
<span class="next">Les processus</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesprocessus"></a><h2>Les processus</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
<span class="arrow"></span>
<span class="next">Gestion des erreurs</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
<span class="next">Présentation des processus</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-477821" data-claire-element-id="477821">Dans ce chapitre, nous allons apprendre à maîtriser les processus de bout en bout, de leur création jusqu'à leur terminaison.</p>
</div><a name="Prsentationdesprocessus"></a><h2>Présentation des processus</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">
<span class="arrow"></span>
<span class="next">Les processus</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
<span class="next">Notions</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-presentation-des-processus" data-claire-element-id="477857">Présentation des processus</h4><p id="r-477822" data-claire-element-id="477822">Dans cette première sous-partie, nous allons découvrir la notion de processus de façon généraliste, c'est-à-dire les concepts de ces derniers présents dans tous les systèmes d'exploitation qui les utilisent.</p><h5 id="r-parallelisme-et-pseudo-parallelisme" data-claire-element-id="477824">Parallélisme et pseudo-parallélisme</h5><p id="r-477823" data-claire-element-id="477823">La base des ordinateurs modernes, c'est le parallélisme. Il est désormais inconcevable qu'un ordinateur ne puisse exécuter plusieurs programmes en même temps. <br/> Du point de vue matériel, le processeur passe d'un programme à un autre en quelques millisecondes, ce qui va donner à l'utilisateur une impression de simultanéité. C'est le <strong>pseudo-parallélisme</strong>, à différencier avec le véritable <strong>parallélisme</strong> des systèmes multiprocesseurs.<br/> Les processus sont la base du pseudo-parallélisme.</p><h5 id="r-programmes-et-processus" data-claire-element-id="477826">Programmes et processus</h5><p id="r-477825" data-claire-element-id="477825">Il est très important de différencier la notion de <em>programme</em> et la notion de <em>processus</em>.<br/> La définition exacte d'un processus, c'est <em>programme en cours d'exécution auquel est associé un environnement processeur et un environnement mémoire</em>. En effet, au cours de son exécution, les instructions d'un programme modifient les valeurs des registres (le compteur ordinal, le registre d'état...) ainsi que le contenu de la pile. <br/> Un programme, c'est une suite d'instructions (notion <strong>statique</strong>), tandis qu'un processus, c'est l'image du contenu des registres et de la mémoire centrale (notion <strong>dynamique</strong>).</p><h5 id="r-espace-d-adressage-des-processus" data-claire-element-id="477845">Espace d’adressage des processus</h5><p id="r-477827" data-claire-element-id="477827">Chaque processus possède un <strong>espace d'adressage</strong>, c'est-à-dire un ensemble d'adresses mémoires dans lesquelles il peut lire et écrire.<br/> Cet espace est divisé en trois parties :</p><ul id="r-477834" data-claire-element-id="477834"><li id="r-477829" data-claire-element-id="477829"><p id="r-477828" data-claire-element-id="477828">le <strong>segment de texte</strong> (le code du programme) ;</p></li><li id="r-477831" data-claire-element-id="477831"><p id="r-477830" data-claire-element-id="477830">le <strong>segment de données</strong> (les variables) ;</p></li><li id="r-477833" data-claire-element-id="477833"><p id="r-477832" data-claire-element-id="477832">la <strong>pile</strong>.</p></li></ul><p id="r-477835" data-claire-element-id="477835">Voici une schématisation d'un espace d'adressage :</p><figure id="r-477837" data-claire-element-id="477838"><img id="r-477836" data-claire-element-id="477836" src="medias/uploads.siteduzero.com_files_309001_310000_309559.png" alt="Image utilisateur"/></figure><div id="r-477840" data-claire-element-id="477840" data-claire-semantic="question"><p id="r-477839" data-claire-element-id="477839">Hep, minute ! C'est quoi ce vide au milieu ?</p></div><p id="r-477841" data-claire-element-id="477841">Eh bien, c'est un trou. La pile empiète sur cet espace de manière automatique et l'extension du segment de données commence lors d'une allocation dynamique.<br/> Le segment de texte (le code), quant à lui, ne bouge pas.</p><figure id="r-477843" data-claire-element-id="477844"><img id="r-477842" data-claire-element-id="477842" src="medias/uploads.siteduzero.com_files_309001_310000_309558.png" alt="Image utilisateur"/></figure><h5 id="r-ordonnancement-des-processus" data-claire-element-id="477856">Ordonnancement des processus</h5><p id="r-477846" data-claire-element-id="477846">Lorsqu'un processus est lancé, le système doit gérer la mémoire et l'allocation du processeur lui étant accordée. Il fait appel à l'<strong>ordonnanceur</strong> (<em>scheduler </em>en anglais).</p><p id="r-477847" data-claire-element-id="477847">Un système d'exploitation est <strong>préemptif </strong>lorsqu'il peut arrêter à tout moment n'importe quelle application pour passer à la suivante (exemple : Windows XP, Windows 7 et GNU/Linux sont des systèmes préemptifs). Il peut aussi être <strong>coopératif </strong>quand il permet à plusieurs applications de fonctionner et d'occuper la mémoire, et leur laissant le soin de gérer cette occupation (exemple : Windows 95, 98 et Millénium sont des systèmes coopératifs).</p><p id="r-477848" data-claire-element-id="477848">En résumé :</p><ul id="r-477853" data-claire-element-id="477853"><li id="r-477850" data-claire-element-id="477850"><p id="r-477849" data-claire-element-id="477849"><strong>multitâche préemptif</strong> : le système d'exploitation garde le contrôle et se réserve le droit de fermer l'application.</p></li><li id="r-477852" data-claire-element-id="477852"><p id="r-477851" data-claire-element-id="477851"><strong>multitâche coopératif</strong> : le système d'exploitation laisse les applications gérer.</p></li></ul><p id="r-477854" data-claire-element-id="477854">Vous aurez donc compris que le multitâche coopératif est plus « dangereux » pour le système, car risque de blocage si une application fait des siennes. ^^</p><p id="r-477855" data-claire-element-id="477855">Enfin, dernière chose à retenir : <strong>les systèmes basés sur Unix sont des systèmes préemptifs</strong>.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">
<span class="arrow"></span>
<span class="next">Les processus</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
<span class="next">Notions</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Notions"></a><h2>Notions</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
<span class="arrow"></span>
<span class="next">Présentation des processus</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
<span class="next">Création d&#039;un nouveau processus</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-notions" data-claire-element-id="477953">Notions</h4><p id="r-477858" data-claire-element-id="477858">Nous allons maintenant voir certaines notions et termes de vocabulaire relatifs aux processus, en étudiant leur implémentation sous Unix.</p><h5 id="r-particularites-de-la-gestion-des-processus-sous-unix" data-claire-element-id="477860">Particularités de la gestion des processus sous Unix</h5><p id="r-477859" data-claire-element-id="477859">Dans les systèmes basés sur Unix tout particulièrement, les processus jouent un rôle très important. Le concept de processus a été mis au point dès les débuts de ce système : il a ainsi participé à sa gloire et à sa célébrité. Une des particularités de la gestion des processus sous Unix consiste à séparer la création d'un processus et l'exécution d'une image binaire. Bien que la plupart du temps ces deux tâches sont exécutées ensemble, cette division a permis de nouvelles libertés quant à la gestion des tâches. Par exemple, cela permet d'avoir plusieurs processus pour un même programme.<br/> Autrement dit, sous les autres systèmes d'exploitation (mis à part quelques exceptions), processus = nouveau programme, alors que sous Unix ce n'est pas forcément le cas.<br/> Ce principe, peu utilisé dans les autres systèmes, a survécu de nos jours. Alors que la plupart des systèmes d'exploitation offrent un seul appel-système pour exécuter un nouveau programme, Unix en possède deux : <code data-claire-semantic="c">fork</code> et <code data-claire-semantic="c">exec</code> (nous étudierons ce dernier dans le troisième chapitre).</p><h5 id="r-pid" data-claire-element-id="477865">PID</h5><p id="r-477861" data-claire-element-id="477861">Chaque processus peut être identifié par son numéro de processus, ou <strong>PID </strong>(<em>Process IDentifier</em>). <br/> Un numéro de PID est unique dans le système : il est impossible que deux processus aient un même PID au même moment.</p><p id="r-477862" data-claire-element-id="477862">Lorsque l'on crée un processus (nous verrons comment faire dans la suite du chapitre), on utilise une fonction qui permet de dupliquer le processus appelant. On distingue alors les deux processus par leur PID. Le processus appelant est alors nommé <strong>processus père</strong> et le nouveau processus <strong>processus fils</strong>. Quant on s'occupe du processus fils, le PID du processus père est noté <strong>PPID</strong> (<em>Parent PID</em>).</p><h6 id="r-attribution-du-pid" data-claire-element-id="477864">Attribution du PID</h6><p id="r-477863" data-claire-element-id="477863">Par défaut, le noyau attribue un PID avec une valeur inférieure à 32768. Le 32768ème processus créé reçoit la plus petite valeur de PID libéré par un processus mort entre-temps (paix à son âme... :p ). Par ailleurs, cette valeur maximale peut être changée par l'administrateur en modifiant la valeur du fichier /proc/sys/kernel/pid_max.<br/> De plus, les PID sont attribués de façon linéaire. Par exemple, si 17 est le PID le plus élevé affecté, un processus créé à cet instant aura comme PID 18. Le noyau réutilise les PID de processus n'existant plus uniquement quand la valeur de pid_max est atteinte.</p><h5 id="r-uid" data-claire-element-id="477892">UID</h5><p id="r-477866" data-claire-element-id="477866">Les systèmes basés sur Unix sont particulièrement axés sur le côté multi-utilisateur. Ainsi, il existe de très nombreuses sécurités sur les permissions nécessaires pour exécuter telle ou telle action.<br/> C'est pour cela que chaque utilisateur possède un identifiant, sous forme numérique, nommé <strong>UID</strong> (<em>User IDentifier</em>).<br/> En conséquence, nous pouvons également distinguer les processus entre eux par l'UID de l'utilisateur qui les a lancés.</p><h6 id="r-quelques-remarques-sur-la-valeur-de-l-uid" data-claire-element-id="477874">Quelques remarques sur la valeur de l'UID</h6><ul id="r-477873" data-claire-element-id="477873"><li id="r-477868" data-claire-element-id="477868"><p id="r-477867" data-claire-element-id="477867">La valeur de l'UID est comprise entre les constantes UID_MIN et UID_MAX du fichier /etc/login.defs.</p></li><li id="r-477870" data-claire-element-id="477870"><p id="r-477869" data-claire-element-id="477869">Conventionnellement, plus l'UID est bas, plus l'utilisateur a des privilèges. Néanmoins, l'attribution de l'UID est de la compétence de l'administrateur du système. Ainsi, cette règle n'est pas toujours vérifiable.</p></li><li id="r-477872" data-claire-element-id="477872"><p id="r-477871" data-claire-element-id="477871">Les valeurs inférieures à 100 sont généralement réservées aux utilisateurs standards (« par défaut » si vous préférez).</p></li></ul><h6 id="r-differents-uid" data-claire-element-id="477887">Différents UID</h6><p id="r-477875" data-claire-element-id="477875">On distingue trois identifiants d'utilisateur par processus :</p><ul id="r-477882" data-claire-element-id="477882"><li id="r-477877" data-claire-element-id="477877"><p id="r-477876" data-claire-element-id="477876">l'UID <strong>réel </strong>: il correspond à l'UID de l'utilisateur qui a lancé le processus ;</p></li><li id="r-477879" data-claire-element-id="477879"><p id="r-477878" data-claire-element-id="477878">l'UID <strong>effectif </strong>: il correspond aux privilèges accordés à cet utilisateur ;</p></li><li id="r-477881" data-claire-element-id="477881"><p id="r-477880" data-claire-element-id="477880">l'UID <strong>sauvé </strong>: c'est la copie de l'ancien UID réel quand celui-ci a été modifié par un processus.</p></li></ul><p id="r-477883" data-claire-element-id="477883">Pour examiner tous les utilisateurs de l'ordinateur, allez dans /etc et ouvrez le fichier texte nommé passwd.</p><p id="r-477884" data-claire-element-id="477884">Ce fichier rassemble des informations sur tous les utilisateurs ayant un compte sur le système ; une ligne par utilisateur et 7 champs par ligne, séparés par le caractère deux-points ( <strong>:</strong> ).</p><p id="r-477885" data-claire-element-id="477885"><strong>NOM : MOT DE PASSE : UID : GID : COMMENTAIRE : RÉPERTOIRE : COMMANDE</strong></p><p id="r-477886" data-claire-element-id="477886">En fait, l'analyse de ce fichier ne nous importe peu mais cela peut vous permettre de connaître les différents utilisateurs de l'ordinateur (les plus connus étant <strong>root </strong>et vous-même ; mais vous pouvez remarquer qu'il en existe plein d'autres!).</p><h6 id="r-permission-set-uid" data-claire-element-id="477891">Permission Set – UID</h6><p id="r-477888" data-claire-element-id="477888">Il existe une permission spéciale, uniquement pour les exécutables binaires, appelée la permission <strong>Set – UID</strong>. Cette permission permet à l'utilisateur ayant les droits d'exécution sur ce fichier d'exécuter le fichier avec les privilèges de son propriétaire. On met les droits Set - UID avec la commande <code data-claire-semantic="console">chmod</code> et l'argument <code data-claire-semantic="console">+s</code>. On passe en second argument le nom du fichier.</p><p id="r-477889" data-claire-element-id="477889">Exemple :</p><pre id="r-477890" data-claire-element-id="477890"><code data-claire-semantic="console">$ ls -l 
total 4 
-rw-r--r-- 1 lucas lucas 290 2010-12-01 15:39 zombie.sh 
$ chmod +s zombie.sh
$ ls -l 
total 4 
-rwSr-Sr-- 1 lucas lucas 290 2010-12-01 15:39 zombie.sh</code></pre><h5 id="r-gid" data-claire-element-id="477895">GID</h5><p id="r-477893" data-claire-element-id="477893">Chaque utilisateur du système appartient à un ou plusieurs groupes. Ces derniers sont définis dans le fichier /etc/groups. Un processus fait donc également partie des groupes de l'utilisateur qui l'a lancé. Comme nous l'avons vu avec les UID, un processus dispose donc de plusieurs <strong>GID </strong>(<em>Group IDentifier</em>) <strong>réel</strong>, <strong>effectif</strong>, <strong>sauvé</strong>, ainsi que de GID supplémentaires si l'utilisateur qui a lancé le processus appartient à plusieurs groupes.</p><p id="r-477894" data-claire-element-id="477894">Connaître le GID d'un processus n'est pas capital, c'est pourquoi nous ne nous arrêterons pas sur ce point.</p><h5 id="r-organisation-des-processus" data-claire-element-id="477901">Organisation des processus</h5><p id="r-477896" data-claire-element-id="477896">Les processus sont organisés en <strong>hiérarchie</strong>. Chaque processus doit être lancé par un autre (rappelez-vous les notions sur processus père et processus fils). La racine de cette hiérarchie est le <strong>programme initial</strong>. En voici quelques explications.</p><p id="r-477897" data-claire-element-id="477897">Le <strong>processus inactif du système</strong> (<em>System idle process</em> : le processus que le noyau exécute tant qu'il n'y a pas d'autres processus en cours d'exécution) a le PID 0. C'est celui-ci qui lance le premier processus que le noyau exécute, le <strong>programme initial</strong>. Généralement, sous les systèmes basés sous Unix, le programme initial se nomme <strong>init</strong>, et il a le PID 1.</p><p id="r-477898" data-claire-element-id="477898">Si l'utilisateur indique au noyau le programme initial à exécuter, celui-ci tente alors de le faire avec quatre exécutables, dans l'ordre suivant : /sbin/init, /etc/init puis /bin/init.</p><p id="r-477899" data-claire-element-id="477899">Le premier de ces processus qui existe est exécuté en tant que programme initial. <br/> Si les quatre programmes n'ont pas pu être exécutés, le système s'arrête : <a href="http://fr.wikipedia.org/wiki/Panique_du_noyau">panique du noyau</a>...</p><p id="r-477900" data-claire-element-id="477900">Après son chargement, le programme initial gère le reste du démarrage : initialisation du système, lancement d'un programme de connexion... Il va également se charger de lancer les <strong>démons</strong>. Un démon (du terme anglais <em>daemon</em>) est un processus qui est constamment en activité et fournit des services au système.</p><h5 id="r-les-etats-d-un-processus" data-claire-element-id="477917">Les états d'un processus</h5><p id="r-477902" data-claire-element-id="477902">Un processus peut avoir plusieurs états :</p><ul id="r-477911" data-claire-element-id="477911"><li id="r-477904" data-claire-element-id="477904"><p id="r-477903" data-claire-element-id="477903"><strong>exécution </strong>(<strong>R</strong> pour <em>running</em>) : le processus est en cours d'exécution ;</p></li><li id="r-477906" data-claire-element-id="477906"><p id="r-477905" data-claire-element-id="477905"><strong>sommeil</strong> (<strong>S</strong> pour <em>sleeping</em>) : dans un multitâche coopératif, quand il rend la main ; ou dans un multitâche préemptif, quand il est interrompu au bout d'un quantum de temps ;</p></li><li id="r-477908" data-claire-element-id="477908"><p id="r-477907" data-claire-element-id="477907"><strong>arrêt </strong>(<strong>T</strong> pour <em>stopped</em>) : le processus a été temporairement arrêté par un signal. Il ne s'exécute plus et ne réagira qu'à un signal de redémarrage ;</p></li><li id="r-477910" data-claire-element-id="477910"><p id="r-477909" data-claire-element-id="477909"><strong>zombie </strong>(<strong>Z</strong> pour … <em>zombie</em>) : le processus s'est terminé, mais son père n'a pas encore lu son code de retour.</p></li></ul><p id="r-477912" data-claire-element-id="477912">De plus, sous Unix, un processus peut évoluer dans deux modes différents : le mode <strong>noyau</strong> et le mode <strong>utilisateur</strong>. Généralement, un processus utilisateur entre dans le mode noyau quand il effectue un appel-système.</p><p id="r-477913" data-claire-element-id="477913">En guise de résumé, voici un diagramme d'états des processus sous Unix.</p><figure id="r-477915" data-claire-element-id="477916"><img id="r-477914" data-claire-element-id="477914" src="medias/uploads.siteduzero.com_files_308001_309000_308337.png" alt="Image utilisateur"/></figure><h5 id="r-implementation-des-processus" data-claire-element-id="477935">Implémentation des processus</h5><p id="r-477918" data-claire-element-id="477918">Pour implémenter les processus, le système d'exploitation utilise un tableau de structure, appelé <strong>table des processus</strong>. Cette dernière comprend une entrée par processus, allouée dynamiquement, correspondant au processus associé à ce programme : c'est le <strong>bloc de contrôle du processus</strong> (<em>Process Control Block</em>, souvent abrégé <strong>PCB</strong>). Ce bloc contient, entres autres, les informations suivantes :</p><ul id="r-477933" data-claire-element-id="477933"><li id="r-477920" data-claire-element-id="477920"><p id="r-477919" data-claire-element-id="477919">le PID, le PPID, l'UID et le GID du processus ;</p></li><li id="r-477922" data-claire-element-id="477922"><p id="r-477921" data-claire-element-id="477921">l'état du processus ;</p></li><li id="r-477924" data-claire-element-id="477924"><p id="r-477923" data-claire-element-id="477923">les fichiers ouverts par le processus ;</p></li><li id="r-477926" data-claire-element-id="477926"><p id="r-477925" data-claire-element-id="477925">le répertoire courant du processus ;</p></li><li id="r-477928" data-claire-element-id="477928"><p id="r-477927" data-claire-element-id="477927">le terminal attaché au processus ;</p></li><li id="r-477930" data-claire-element-id="477930"><p id="r-477929" data-claire-element-id="477929">les signaux reçus par le processus ;</p></li><li id="r-477932" data-claire-element-id="477932"><p id="r-477931" data-claire-element-id="477931">le contexte processeur et mémoire du processus (c'est-à-dire l'état des registres et des données mémoires du processus).</p></li></ul><p id="r-477934" data-claire-element-id="477934">Grâce à ces informations stockées dans la table des processus, un processus bloqué pourra redémarrer ultérieurement avec les mêmes caractéristiques.</p><h5 id="r-commandes-de-gestion-des-processus" data-claire-element-id="477952">Commandes de gestion des processus</h5><p id="r-477936" data-claire-element-id="477936">Pour afficher ses propres processus en cours d'exécution, on utilise la commande :</p><pre id="r-477937" data-claire-element-id="477937"><code data-claire-semantic="console">$ ps</code></pre><p id="r-477938" data-claire-element-id="477938">Pour afficher tous les processus en cours d'exécution, on peut utiliser l'option <code data-claire-semantic="console">aux</code> (a : processus de tous les utilisateurs ; u : affichage détaillé ; y : démons) :</p><pre id="r-477939" data-claire-element-id="477939"><code data-claire-semantic="console">$ ps aux</code></pre><p id="r-477940" data-claire-element-id="477940">Dans le résultat qui s'affiche, vous pouvez voir la liste de tous vos processus en cours d'exécution.</p><ul id="r-477951" data-claire-element-id="477951"><li id="r-477942" data-claire-element-id="477942"><p id="r-477941" data-claire-element-id="477941">La première colonne <strong>USER</strong> correspond à l'utilisateur qui a lancé le processus.</p></li><li id="r-477944" data-claire-element-id="477944"><p id="r-477943" data-claire-element-id="477943">La deuxième colonne <strong>PID </strong>indique le numéro de PID du processus.</p></li><li id="r-477946" data-claire-element-id="477946"><p id="r-477945" data-claire-element-id="477945">La huitième colonne <strong>STAT </strong>correspond à l'état du processus.</p></li><li id="r-477948" data-claire-element-id="477948"><p id="r-477947" data-claire-element-id="477947">La neuvième colonne <strong>START </strong>correspond à l'heure du lancement du processus.</p></li><li id="r-477950" data-claire-element-id="477950"><p id="r-477949" data-claire-element-id="477949">Enfin, la dernière colonne <strong>COMMAND </strong>correspond au chemin complet de la commande lancée par l'utilisateur (car même si vous lancez un exécutable en mode graphique, vous avez une commande qui s'exécute).</p></li></ul>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
<span class="arrow"></span>
<span class="next">Présentation des processus</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
<span class="next">Création d&#039;un nouveau processus</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Crationd039unnouveauprocessus"></a><h2>Création d&#039;un nouveau processus</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
<span class="arrow"></span>
<span class="next">Notions</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
<span class="next">Terminaison d&#039;un processus</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-creation-d-un-nouveau-processus" data-claire-element-id="478023">Création d'un nouveau processus</h4><p id="r-477954" data-claire-element-id="477954">Bon maintenant, nous allons pouvoir passer à la pratique !</p><aside id="r-477957" data-claire-element-id="477957" data-claire-semantic="information"><p id="r-477955" data-claire-element-id="477955">Bon nombre de fonctions utilisées avec la programmation système (notamment les appels-système) nécessiterons l'inclusion de la bibliothèque <code data-claire-semantic="c">&lt;unistd.h&gt;</code>. Donc, pensez bien de mettre, au début de vos fichiers :</p><pre id="r-477956" data-claire-element-id="477956"><code data-claire-semantic="c">#include &lt;unistd.h&gt;</code></pre></aside><h5 id="r-la-fonction-fork" data-claire-element-id="477990">La fonction <code data-claire-semantic="c">fork</code></h5><p id="r-477958" data-claire-element-id="477958">Pour créer un nouveau processus à partir d'un programme, on utilise la fonction <code data-claire-semantic="c"><strong>fork</strong></code> (qui est un <em>appel-système</em>). Pour rappel, le processus d'origine est nommé processus père et le nouveau processus créé processus fils, qui possède un nouveau PID. Les deux ont le <strong>même code source</strong>, mais la valeur retournée par <code data-claire-semantic="c">fork</code> nous permet de savoir si l'on est dans le processus père ou dans le processus fils. Ceci permet de faire deux choses différentes dans le processus père et le processus fils (en utilisant une structure de condition, <code data-claire-semantic="c">if</code> ou <code data-claire-semantic="c">switch</code>).</p><h6 id="r-que-fait-un-fork-au-niveau-du-systeme-d-exploitation" data-claire-element-id="477989">Que fait un <code data-claire-semantic="c">fork</code> au niveau du système d'exploitation ?</h6><p id="r-477959" data-claire-element-id="477959">Lors de l'exécution de l'appel-système <code data-claire-semantic="c">fork</code>, le noyau effectue les opérations suivantes :</p><ul id="r-477970" data-claire-element-id="477970"><li id="r-477961" data-claire-element-id="477961"><p id="r-477960" data-claire-element-id="477960">il alloue un bloc de contrôle dans la table des processus.</p></li><li id="r-477963" data-claire-element-id="477963"><p id="r-477962" data-claire-element-id="477962">il copie les informations contenues dans le bloc de contrôle du père dans celui du fils sauf les identificateurs (PID, PPID...).</p></li><li id="r-477965" data-claire-element-id="477965"><p id="r-477964" data-claire-element-id="477964">il alloue un PID au processus fils.</p></li><li id="r-477967" data-claire-element-id="477967"><p id="r-477966" data-claire-element-id="477966">il associe au processus fils un segment de texte dans son espace d'adressage. Le segment de données et la pile ne lui seront attribués uniquement lorsque celui-ci tentera de les modifier. Cette technique, nommée « <em>copie on write</em> », permet de réduire le temps de création du processus.</p></li><li id="r-477969" data-claire-element-id="477969"><p id="r-477968" data-claire-element-id="477968">l'état du processus est mis à l'état <em>exécution</em>.</p></li></ul><aside id="r-477972" data-claire-element-id="477972" data-claire-semantic="information"><p id="r-477971" data-claire-element-id="477971">Au passage, je vous propose un lien expliquant autrement ce que fait un <code data-claire-semantic="c">fork</code> : cliquez <a href="http://www.commentcamarche.net/faq/10611-que-fait-un-fork">ici</a>.</p></aside><p id="r-477973" data-claire-element-id="477973">Bref, revenons à la programmation. La fonction <code data-claire-semantic="c">fork</code> retourne une valeur de type <code data-claire-semantic="c"><strong>pid_t</strong></code>. Il s'agit généralement d'un <code data-claire-semantic="c">int</code> ; il et déclaré dans &lt;sys/types.h&gt;. <br/> Bref, donc... La valeur renvoyée par <code data-claire-semantic="c">fork</code> est de :</p><ul id="r-477980" data-claire-element-id="477980"><li id="r-477975" data-claire-element-id="477975"><p id="r-477974" data-claire-element-id="477974"><strong>-1</strong> si il y a eu une erreur ;</p></li><li id="r-477977" data-claire-element-id="477977"><p id="r-477976" data-claire-element-id="477976"><strong>0</strong> si on est dans le processus fils ;</p></li><li id="r-477979" data-claire-element-id="477979"><p id="r-477978" data-claire-element-id="477978">Le PID du fils si on est dans le processus père. Cela permet ainsi au père de connaître le PID de son fils.</p></li></ul><p id="r-477981" data-claire-element-id="477981">Dans le cas où la fonction a renvoyé <code data-claire-semantic="c">-1</code> et donc qu'il y a eu une erreur, le code de l'erreur est contenue dans la variable globale <code data-claire-semantic="c">errno</code>, déclarée dans le fichier <code data-claire-semantic="c">errno.h</code> (n'oubliez pas le <code data-claire-semantic="c">#include</code>...). Ce code peut correspondre à deux constantes :</p><ul id="r-477986" data-claire-element-id="477986"><li id="r-477983" data-claire-element-id="477983"><p id="r-477982" data-claire-element-id="477982">ENOMEM : le noyau n'a plus assez de mémoire disponible pour créer un nouveau processus ;</p></li><li id="r-477985" data-claire-element-id="477985"><p id="r-477984" data-claire-element-id="477984">EAGAIN : ce code d'erreur peut être dû à deux raisons : soit il n'y a pas suffisamment de ressources systèmes pour créer le processus, soit l'utilisateur a déjà trop de processus en cours d'exécution. Ainsi, que ce soit pour l'une ou pour l'autre raison, vous pouvez rééditer votre demande tant que <code data-claire-semantic="c">fork</code> renvoie EAGAIN.</p></li></ul><p id="r-477987" data-claire-element-id="477987">Bon, en résumé, voici le prototype de la fonction <code data-claire-semantic="c">fork</code> :</p><pre id="r-477988" data-claire-element-id="477988"><code data-claire-semantic="c">#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;

pid_t fork(void);</code></pre><h5 id="r-autres-fonctions-1" data-claire-element-id="478006">Autres fonctions :</h5><ul id="r-478003" data-claire-element-id="478003"><li id="r-477993" data-claire-element-id="477993"><p id="r-477991" data-claire-element-id="477991">La fonction <code data-claire-semantic="c">getpid</code> retourne le PID du processus appelant.</p><pre id="r-477992" data-claire-element-id="477992"><code data-claire-semantic="c">#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;

pid_t getpid(void);</code></pre></li><li id="r-477996" data-claire-element-id="477996"><p id="r-477994" data-claire-element-id="477994">La fonction <code data-claire-semantic="c">getppid</code> retourne le PPID du processus appelant.</p><pre id="r-477995" data-claire-element-id="477995"><code data-claire-semantic="c">#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;

pid_t getppid(void);</code></pre></li><li id="r-477999" data-claire-element-id="477999"><p id="r-477997" data-claire-element-id="477997">La fonction <code data-claire-semantic="c">getuid</code> retourne l'UID du processus appelant.</p><pre id="r-477998" data-claire-element-id="477998"><code data-claire-semantic="c">#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;

uid_t getuid(void);</code></pre></li><li id="r-478002" data-claire-element-id="478002"><p id="r-478000" data-claire-element-id="478000">La fonction <code data-claire-semantic="c">getgid</code> retourne le GID du processus appelant.</p><pre id="r-478001" data-claire-element-id="478001"><code data-claire-semantic="c">#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;

gid_t getgid(void);</code></pre></li></ul><aside id="r-478005" data-claire-element-id="478005" data-claire-semantic="information"><p id="r-478004" data-claire-element-id="478004">En passant, si vous avez déjà fait de l'anglais au moins une fois dans votre vie, vous devriez savoir que <em>get </em>peut se traduire par <em>obtenir</em>. C'est un bon moyen mnémotechnique pour retenir ces deux fonctions (<code data-claire-semantic="c">getpid</code> : <em>obtenir PID</em>, <code data-claire-semantic="c">getppid</code> : <em>obtenir PPID</em>, <code data-claire-semantic="c">getuid</code> : <em>obtenir UID</em> et <code data-claire-semantic="c">getgid</code> : <em>obtenir GID</em>).</p></aside><h5 id="r-code-complet-5" data-claire-element-id="478013">Code complet :</h5><p id="r-478007" data-claire-element-id="478007">Bon, maintenant, voici le code complet permettant de créer un nouveau processus et d'afficher des informations le concernant.</p><pre id="r-478008" data-claire-element-id="478008"><code data-claire-semantic="c">/* Pour les constantes EXIT_SUCCESS et EXIT_FAILURE */
#include &lt;stdlib.h&gt;
/* Pour fprintf() */
#include &lt;stdio.h&gt;
/* Pour fork() */
#include &lt;unistd.h&gt;
/* Pour perror() et errno */
#include &lt;errno.h&gt;
/* Pour le type pid_t */
#include &lt;sys/types.h&gt;

/* La fonction create_process duplique le processus appelant et retourne
   le PID du processus fils ainsi créé */
pid_t create_process(void)
{
    /* On crée une nouvelle valeur de type pid_t */
    pid_t pid;

    /* On fork() tant que l'erreur est EAGAIN */
    do {
	pid = fork();
    } while ((pid == -1) &amp;&amp; (errno == EAGAIN));

    /* On retourne le PID du processus ainsi créé */
    return pid;
}

/* La fonction child_process effectue les actions du processus fils */
void child_process(void)
{
    printf(&quot; Nous sommes dans le fils !\n&quot;
	   &quot; Le PID du fils est %d.\n&quot;
	   &quot; Le PPID du fils est %d.\n&quot;, (int) getpid(), (int) getppid());
}

/* La fonction father_process effectue les actions du processus père */
void father_process(int child_pid)
{
    printf(&quot; Nous sommes dans le père !\n&quot;
	   &quot; Le PID du fils est %d.\n&quot;
	   &quot; Le PID du père est %d.\n&quot;, (int) child_pid, (int) getpid());
}

int main(void)
{
    pid_t pid = create_process();

    switch (pid) {
    /* Si on a une erreur irrémédiable (ENOMEM dans notre cas) */
    case -1:
	perror(&quot;fork&quot;);
	return EXIT_FAILURE;
	break;
    /* Si on est dans le fils */
    case 0:
	child_process();
	break;
    /* Si on est dans le père */
    default:
	father_process(pid);
	break;
    }

    return EXIT_SUCCESS;
}</code></pre><p id="r-478009" data-claire-element-id="478009">Résultat :</p><pre id="r-478010" data-claire-element-id="478010"><code data-claire-semantic="console">$ ./a.out

Nous sommes dans le père
Le PID du fils est 2972
Le PID du père est 2971
Nous sommes dans le fils
Le PID du fils est 2972
Le PPID du fils est 2971</code></pre><aside id="r-478012" data-claire-element-id="478012" data-claire-semantic="error"><p id="r-478011" data-claire-element-id="478011">En réalité, il est impossible de savoir exactement quel résultat on va avoir quand plusieurs processus exécutent leur code en même temps dans un même terminal.</p></aside><h5 id="r-le-cast" data-claire-element-id="478022">Le cast</h5><p id="r-478014" data-claire-element-id="478014">Ceci vous a peut-être surpris :</p><pre id="r-478015" data-claire-element-id="478015"><code data-claire-semantic="c">(int) getpid()</code></pre><p id="r-478016" data-claire-element-id="478016">Cette manipulation, bien que très utilisée dans le monde de la programmation, est étrangement peu connue dans les rangs de ce site.<br/> Même si ce n'est pas vraiment le but du tutoriel, je vais y revenir dessus, car nous l'utiliserons assez souvent.</p><p id="r-478017" data-claire-element-id="478017">Cette technique est appelée <strong>cast</strong> (en français, on traduit par <em>conversion de type</em>). Elle permet de convertir une variable d'un type vers un autre type. La syntaxe utilisée est :</p><pre id="r-478018" data-claire-element-id="478018"><code data-claire-semantic="c">type nouvelle_variable = (type) ancienne_variable;</code></pre><p id="r-478019" data-claire-element-id="478019">Dans notre cas, <code data-claire-semantic="c">getpid</code> renvoie une variable de type <code data-claire-semantic="c">pid_t</code>. Or, il n'existe aucune certitude quand au type standard que symbolise <code data-claire-semantic="c">pid_t</code> (il n'existe pas de formateur spécial pour <code data-claire-semantic="c">scanf</code> et <code data-claire-semantic="c">printf</code> dans le but d'afficher une variable de type <code data-claire-semantic="c">pid_t</code>).<br/> Mais comme nous savons que, généralement, <code data-claire-semantic="c">pid_t</code> prend la forme d'un <code data-claire-semantic="c">int</code>, on va donc convertir la variable <code data-claire-semantic="c">pid</code> en type <code data-claire-semantic="c">int</code>, afin de pouvoir l'afficher grâce à <code data-claire-semantic="c">%d</code>.</p><aside id="r-478021" data-claire-element-id="478021" data-claire-semantic="warning"><p id="r-478020" data-claire-element-id="478020">Je finis sur un dernier <em>Warning</em> avant de nous quitter pour ce deuxième chapitre : attention à ne pas placer <code data-claire-semantic="c">fork</code> dans des boucles infinies (évitez de le mettre dans une boucle tout court d'ailleurs...). En effet, il n'y a aucune sécurité sur le système : imaginez un peu le désastre si vous vous créiez des milliers de processus...</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
<span class="arrow"></span>
<span class="next">Notions</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
<span class="next">Terminaison d&#039;un processus</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Terminaisond039unprocessus"></a><h2>Terminaison d&#039;un processus</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
<span class="arrow"></span>
<span class="next">Création d&#039;un nouveau processus</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">
<span class="next">Exécuter un programme</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-terminaison-d-un-processus" data-claire-element-id="478195">Terminaison d'un processus</h4><h5 id="r-terminaison-d-un-programme" data-claire-element-id="478058">Terminaison d'un programme</h5><p id="r-478024" data-claire-element-id="478024">Un programme peut se terminer de façon normale (volontaire) ou anormale (erreurs).</p><h6 id="r-terminaison-normale-d-un-processus" data-claire-element-id="478038">Terminaison normale d'un processus</h6><p id="r-478025" data-claire-element-id="478025">Un programme peut se terminer de deux façons différentes. La plus simple consiste à laisser le processus finir le <code data-claire-semantic="c">main</code> avec l'instruction <code data-claire-semantic="c">return</code> suivie du code de retour du programme. Une autre est de terminer le programme grâce à la fonction :</p><pre id="r-478026" data-claire-element-id="478026"><code data-claire-semantic="c">#include &lt;stdlib.h&gt;

void exit(status);</code></pre><p id="r-478027" data-claire-element-id="478027">Celle-ci a pour avantage de quitter le programme quel que soit la fonction dans laquelle on se trouve.<br/> Par exemple, avec ce code :</p><pre id="r-478028" data-claire-element-id="478028"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

void quit(void)
{
    printf(&quot; Nous sommes dans la fonction quit().\n&quot;);
    exit(EXIT_SUCCESS);
}

int main(void)
{
    quit();
    printf(&quot; Nous sommes dans le main.\n&quot;);
    return EXIT_SUCCESS;
}</code></pre><p id="r-478029" data-claire-element-id="478029">Le résultat est sans appel :</p><pre id="r-478030" data-claire-element-id="478030"><code data-claire-semantic="console">$ ./a.out
 Nous sommes dans la fonction quitterProgramme.</code></pre><p id="r-478031" data-claire-element-id="478031">L'exécution montre que l'instruction <code data-claire-semantic="c">printf(&quot;Nous sommes dans le main. &quot;);</code> n'est pas exécutée. Le programme s'est arrêté à la lecture de <code data-claire-semantic="c">exit(EXIT_SUCCESS);</code>.</p><aside id="r-478037" data-claire-element-id="478037" data-claire-semantic="error"><p id="r-478032" data-claire-element-id="478032">Pour autant, cela ne vous dispense pas de mettre un <code data-claire-semantic="c">return</code> à la fin du main. Si vous ne le faites pas, vous risquez d'avoir un Warning à la compilation. Exemple, avec ce code :</p><pre id="r-478033" data-claire-element-id="478033"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

void quit(void) 
{
    printf(&quot; Nous sommes dans la fonction quit().\n&quot;);
    exit(EXIT_SUCCESS);
}

int main(void) 
{
    quit();
    printf(&quot; Nous sommes dans le main.\n&quot;);
}</code></pre><p id="r-478034" data-claire-element-id="478034">Qui produit ce Warning à la compilation :</p><pre id="r-478035" data-claire-element-id="478035"><code data-claire-semantic="console">$ gcc essai.c -Wall
essai.c: In function ‘main’:
essai.c:16: warning: control reaches end of non-void function
$</code></pre><p id="r-478036" data-claire-element-id="478036">Ajoutez un petit <code data-claire-semantic="c">return EXIT_SUCCESS;</code> à la fin du main, ça ne coûte rien (et pas de <code data-claire-semantic="c">void main(void)</code> qui produit un <code data-claire-semantic="console">warning: return type of ‘main’ is not ‘int’</code> à la compilation).</p></aside><h6 id="r-terminaison-anormale-d-un-processus" data-claire-element-id="478057">Terminaison anormale d'un processus</h6><p id="r-478039" data-claire-element-id="478039">Pour quitter, de manière propre, un programme, lorsqu'un bug a été détecté, on utilise la fonction :</p><pre id="r-478040" data-claire-element-id="478040"><code data-claire-semantic="c">#include &lt;stdlib.h&gt;

void abort(void);</code></pre><p id="r-478041" data-claire-element-id="478041">Un prototype simple pour une fonction qui possède un défaut majeur : il est difficile de savoir à quel endroit du programme le bug a eu lieu.<br/> Pour y remédier, il est préférable d'utiliser la macro <code data-claire-semantic="c">assert</code>, déclarée qui fonctionne comme suit.</p><ul id="r-478048" data-claire-element-id="478048"><li id="r-478043" data-claire-element-id="478043"><p id="r-478042" data-claire-element-id="478042">Elle prend en argument une condition.</p></li><li id="r-478045" data-claire-element-id="478045"><p id="r-478044" data-claire-element-id="478044">Si cette condition est vraie, <code data-claire-semantic="c">assert</code> ne fait rien.</p></li><li id="r-478047" data-claire-element-id="478047"><p id="r-478046" data-claire-element-id="478046">Si elle est fausse, la macro écrit un message contenant la condition concernée, puis quitte le programme. Cela permet d'obtenir une bonne gestion des erreurs.</p></li></ul><aside id="r-478050" data-claire-element-id="478050" data-claire-semantic="warning"><p id="r-478049" data-claire-element-id="478049">N'utilisez <code data-claire-semantic="c">assert</code> que dans les cas critiques, dans lesquels votre programme ne peut pas continuer si la condition est fausse.</p></aside><p id="r-478051" data-claire-element-id="478051">Voici un exemple de son utilisation avec la fonction <code data-claire-semantic="c">fork</code>.</p><pre id="r-478052" data-claire-element-id="478052"><code data-claire-semantic="c">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;errno.h&gt;
#include &lt;assert.h&gt;
#include &lt;sys/types.h&gt;

int main(void)
{
    pid_t pid_fils;

    do {
	pid_fils = fork();
    } while (pid_fils == -1 &amp;&amp; (errno == EAGAIN));

    assert(pid_fils != -1);

    if (pid_fils == 0) {
	printf(&quot;\n Je suis le fils !\n&quot;);
    } else {
	printf(&quot;\n Je suis le père !\n&quot;);
    }

    return EXIT_SUCCESS;
}</code></pre><p id="r-478053" data-claire-element-id="478053">Vous pouvez remarquer que cette utilisation ne sert pas à grand chose, car il est aussi facile et rapide d'utiliser un <code data-claire-semantic="c">if</code> suivi d'un <code data-claire-semantic="c">perror</code> et d'un <code data-claire-semantic="c">exit</code>. Néanmoins, vous vous rendrez compte par la suite que, parfois, <code data-claire-semantic="c">assert</code> est très pratique. Par exemple, il permet de remplacer une suite d'instruction du style :</p><pre id="r-478054" data-claire-element-id="478054"><code data-claire-semantic="c">if (*n == NULL) {
    exit(EXIT_FAILURE);
}</code></pre><p id="r-478055" data-claire-element-id="478055">en :</p><pre id="r-478056" data-claire-element-id="478056"><code data-claire-semantic="c">assert(*n != NULL);</code></pre><h5 id="r-execution-de-routines-de-terminaison" data-claire-element-id="478085">Exécution de routines de terminaison</h5><p id="r-478059" data-claire-element-id="478059">Grâce à la programmation système, il est possible d'exécuter automatiquement telle ou telle fonction au moment où le programme se termine normalement, c'est-à-dire à l'aide des instructions <code data-claire-semantic="c">exit</code> et <code data-claire-semantic="c">return</code>.<br/> Pour cela, deux fonctions sont disponibles : <code data-claire-semantic="c">atexit</code> et <code data-claire-semantic="c">on_exit</code>.</p><h6 id="r-atexit" data-claire-element-id="478071">atexit</h6><p id="r-478060" data-claire-element-id="478060">Voici le prototype de cette fonction :</p><pre id="r-478061" data-claire-element-id="478061"><code data-claire-semantic="c">#include &lt;stdlib.h&gt;

int atexit(void (*function) (void));</code></pre><p id="r-478062" data-claire-element-id="478062">Le paramètre est un <a href="http://www.siteduzero.com/tutoriel-3-314203-les-pointeurs-sur-fonctions.html">pointeur de fonction</a> vers la fonction à exécuter lors de la terminaison. Elle renvoie <strong>0</strong> en cas de réussite ou <strong>-1</strong> sinon.</p><p id="r-478063" data-claire-element-id="478063">Vous pouvez également enregistrer plusieurs fonctions à la terminaison. Si c'est le cas, lors de la fin du programme, les fonctions mémorisées sont invoquées dans l'<strong>ordre inverse</strong> de l'enregistrement.</p><p id="r-478064" data-claire-element-id="478064">Par exemple, voici deux codes qui affichent respectivement « <em>Au revoir</em> » et « <em>1</em> », « <em>2</em> », « <em>3</em> » lors de la terminaison.</p><p id="r-478065" data-claire-element-id="478065">Premier code :</p><pre id="r-478066" data-claire-element-id="478066"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

void routine(void)
{
    printf(&quot; Au revoir !\n&quot;);
}

int main(void)
{
    if (atexit(routine) == -1) {
	perror(&quot;atexit :&quot;);
	return EXIT_FAILURE;
    }

    printf(&quot; Allez, maintenant, on quitte ! :D\n&quot;);

    return EXIT_SUCCESS;
}</code></pre><pre id="r-478067" data-claire-element-id="478067"><code data-claire-semantic="console">$ ./a.out 
 Allez, maintenant, on quitte ! :D
 Au revoir !
$</code></pre><p id="r-478068" data-claire-element-id="478068">Deuxième code :</p><pre id="r-478069" data-claire-element-id="478069"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

void routine1(void)
{
    printf(&quot; 1\n&quot;);
}

void routine2(void)
{
    printf(&quot; 2\n&quot;);
}

void routine3(void)
{
    printf(&quot; 3\n&quot;);
}

int main(void)
{
    if (atexit(routine3) == -1) {
	perror(&quot;atexit :&quot;);
	return EXIT_FAILURE;
    }

    if (atexit(routine2) == -1) {
	perror(&quot;atexit :&quot;);
	return EXIT_FAILURE;
    }

    if (atexit(routine1) == -1) {
	perror(&quot;atexit :&quot;);
	return EXIT_FAILURE;
    }

    printf(&quot; Allez, maintenant, on quitte ! :D\n&quot;);

    return EXIT_SUCCESS;
}</code></pre><pre id="r-478070" data-claire-element-id="478070"><code data-claire-semantic="console">$ ./a.out 
 Allez, maintenant, on quitte ! :D
 1
 2
 3
$</code></pre><h6 id="r-on-exit" data-claire-element-id="478084">on_exit</h6><p id="r-478072" data-claire-element-id="478072">La deuxième fonction qui permet d'effectuer une routine de terminaison est :</p><pre id="r-478073" data-claire-element-id="478073"><code data-claire-semantic="c">#include &lt;stdlib.h&gt;

int on_exit(void (*function) (int, void *), void *arg);</code></pre><p id="r-478074" data-claire-element-id="478074">La fonction prend donc en paramètre deux arguments :</p><ul id="r-478079" data-claire-element-id="478079"><li id="r-478076" data-claire-element-id="478076"><p id="r-478075" data-claire-element-id="478075">un pointeur sur la fonction à exécuter, qui sera, cette fois, de la forme <code data-claire-semantic="c">void fonction(int codeRetour, void* argument)</code>. Le premier paramètre de cette routine est un entier correspondant au code transmis avec l'utilisation de <code data-claire-semantic="c">return</code> ou de <code data-claire-semantic="c">exit</code>.</p></li><li id="r-478078" data-claire-element-id="478078"><p id="r-478077" data-claire-element-id="478077">L'argument à passer à la fonction.</p></li></ul><p id="r-478080" data-claire-element-id="478080">Elle renvoie <strong>0</strong> en cas de réussite ou <strong>-1</strong> sinon.</p><p id="r-478081" data-claire-element-id="478081">Votre fonction de routine de terminaison recevra alors deux arguments : le premier est un <code data-claire-semantic="c">int</code> correspondant au code transmis à <code data-claire-semantic="c">return</code> ou à <code data-claire-semantic="c">exit</code> et le second est un pointeur générique correspondant à l'argument que l'on souhaitait faire parvenir à la routine grâce à <code data-claire-semantic="c">on_exit</code>.</p><aside id="r-478083" data-claire-element-id="478083" data-claire-semantic="information"><p id="r-478082" data-claire-element-id="478082">Il est à noter qu'il est préférable d'utiliser <code data-claire-semantic="c">atexit</code> plutôt que <code data-claire-semantic="c">on_exit</code>, la première étant conforme C89, ce qui n'est pas le cas de la seconde.</p></aside><h5 id="r-synchronisation-entre-pere-et-fils" data-claire-element-id="478194">Synchronisation entre père et fils</h5><h6 id="r-gare-aux-zombies" data-claire-element-id="478104">Gare aux zombies !</h6><p id="r-478086" data-claire-element-id="478086">Lorsque le processus fils se termine avant le processus père, il devient un <strong>zombie</strong> (pour ceux à qui ce terme ne dit rien, remontez un peu plus haut dans la page... :p ). Pour permettre à un processus fils en état zombie de disparaître complètement, on utilise la fonction <code data-claire-semantic="c">wait</code>, qui se trouve dans la bibliothèque sys/wait.h, déclarée comme ceci :</p><pre id="r-478087" data-claire-element-id="478087"><code data-claire-semantic="c">#include &lt;sys/types.h&gt;
#include &lt;sys/wait.h&gt;

pid_t wait(int *status);</code></pre><p id="r-478088" data-claire-element-id="478088">Je vais détailler un petit peu son fonctionnement. Lorsque l'on appelle cette fonction, cette dernière bloque le processus à partir duquel elle a été appelée jusqu'à ce qu'un de ses fils se termine. Elle renvoie alors le PID de ce dernier. <br/> En cas d'erreur, la fonction renvoie la valeur <strong>-1</strong>.</p><div id="r-478090" data-claire-element-id="478090" data-claire-semantic="question"><p id="r-478089" data-claire-element-id="478089">Hep, minute ! On met quoi pour le paramètre de la fonction ? :ange:</p></div><p id="r-478091" data-claire-element-id="478091">Le paramètre <code data-claire-semantic="c"><strong>status</strong></code> correspond au code de retour du processus. Autrement dit, la variable que l'on y passera aura la valeur du code de retour du processus (ce code de retour est généralement indiquée avec la fonction exit). Nous verrons, à la fin de cette sous-partie, comment interpréter cette valeur.</p><aside id="r-478093" data-claire-element-id="478093" data-claire-semantic="information"><p id="r-478092" data-claire-element-id="478092">De manière plus précise, l'octet de poids faible est un code indiquant pourquoi le processus s'est arrêté et, si ce dernier a fait appel à exit, l'octet précédent contient le code de retour.</p></aside><div id="r-478095" data-claire-element-id="478095" data-claire-semantic="question"><p id="r-478094" data-claire-element-id="478094">Et si j'oublie de mettre <code data-claire-semantic="c">wait</code>, il se passe quoi ?</p></div><p id="r-478096" data-claire-element-id="478096">Votre ordinateur explose Si le processus père s'arrête sans avoir lu le code de retour de son fils, c'est un processus <code data-claire-semantic="c">init</code> (vous vous souvenez, le fameux processus au PID 1) qui va le faire afin de le libérer de cet état de zombie.</p><pre id="r-478097" data-claire-element-id="478097"><code data-claire-semantic="c">/* Pour les constantes EXIT_SUCCESS et EXIT_FAILURE */
#include &lt;stdlib.h&gt;
/* Pour fprintf() */
#include &lt;stdio.h&gt;
/* Pour fork() */
#include &lt;unistd.h&gt;
/* Pour perror() et errno */
#include &lt;errno.h&gt;
/* Pour le type pid_t */
#include &lt;sys/types.h&gt;
/* Pour wait() */
#include &lt;sys/wait.h&gt;

/* La fonction create_process duplique le processus appelant et retourne
   le PID du processus fils ainsi créé */
pid_t create_process(void)
{
    /* On crée une nouvelle valeur de type pid_t */
    pid_t pid;

    /* On fork() tant que l'erreur est EAGAIN */
    do {
	pid = fork();
    } while ((pid == -1) &amp;&amp; (errno == EAGAIN));

    /* On retourne le PID du processus ainsi créé */
    return pid;
}

/* La fonction child_process effectue les actions du processus fils */
void child_process(void)
{
    printf(&quot; Nous sommes dans le fils !\n&quot;
	   &quot; Le PID du fils est %d.\n&quot;
	   &quot; Le PPID du fils est %d.\n&quot;, (int) getpid(), (int) getppid());
}

/* La fonction father_process effectue les actions du processus père */
void father_process(int child_pid)
{
    printf(&quot; Nous sommes dans le père !\n&quot;
	   &quot; Le PID du fils est %d.\n&quot;
	   &quot; Le PID du père est %d.\n&quot;, (int) child_pid, (int) getpid());

    if (wait(NULL) == -1) {
	perror(&quot;wait :&quot;);
	exit(EXIT_FAILURE);
    }
}

int main(void)
{
    pid_t pid = create_process();

    switch (pid) {
	/* Si on a une erreur irrémédiable (ENOMEM dans notre cas) */
    case -1:
	perror(&quot;fork&quot;);
	return EXIT_FAILURE;
	break;
	/* Si on est dans le fils */
    case 0:
	child_process();
	break;
	/* Si on est dans le père */
    default:
	father_process(pid);
	break;
    }

    return EXIT_SUCCESS;
}</code></pre><aside id="r-478103" data-claire-element-id="478103" data-claire-semantic="warning"><p id="r-478098" data-claire-element-id="478098">Attention : il faut mettre autant de <code data-claire-semantic="c">wait</code> qu'il y a de fils, car comme je l'ai expliqué dans le fonctionnement :</p><p id="r-478099" data-claire-element-id="478099"><cite>Citation : Le cours</cite></p><blockquote id="r-478101" data-claire-element-id="478101"><p id="r-478100" data-claire-element-id="478100">Lorsque l'on appelle cette fonction, cette dernière bloque le processus à partir duquel elle a été appelée jusqu'à ce qu'un de ses fils se termine.</p></blockquote><p id="r-478102" data-claire-element-id="478102">.</p></aside><h6 id="r-attendre-la-fin-de-n-importe-quel-processus" data-claire-element-id="478127">Attendre la fin de n'importe quel processus</h6><p id="r-478105" data-claire-element-id="478105">Il existe également une fonction qui permet de suspendre l'exécution d'un processus père jusqu'à ce qu'un de ses fils, dont on doit passer le PID en paramètre, se termine. Il s'agit de la fonction <code data-claire-semantic="c"><strong>waitpid</strong></code> :</p><pre id="r-478106" data-claire-element-id="478106"><code data-claire-semantic="c">#include &lt;sys/wait.h&gt;

pid_t waitpid(pid_t pid, int *status, int options);</code></pre><p id="r-478107" data-claire-element-id="478107">Plus précisément, la valeur de <code data-claire-semantic="c">pid</code> est interprétée comme suit :</p><ul id="r-478116" data-claire-element-id="478116"><li id="r-478109" data-claire-element-id="478109"><p id="r-478108" data-claire-element-id="478108">si <em>pid &gt; 0</em>, le processus père est suspendu jusqu'à la fin d'un processus fils dont le PID est égal à la valeur <em>pid</em> ;</p></li><li id="r-478111" data-claire-element-id="478111"><p id="r-478110" data-claire-element-id="478110">si <em>pid = 0</em>, le processus père est suspendu jusqu'à la fin de n'importe lequel de ses fils appartenant à son groupe ;</p></li><li id="r-478113" data-claire-element-id="478113"><p id="r-478112" data-claire-element-id="478112">si <em>pid = -1</em>, le processus père est suspendu jusqu'à la fin de n'importe lequel de ses fils ;</p></li><li id="r-478115" data-claire-element-id="478115"><p id="r-478114" data-claire-element-id="478114">si <em>pid &lt; -1</em>, le processus père est suspendu jusqu'à la mort de n'importe lequel de ses fils dont le GID est égal.</p></li></ul><p id="r-478117" data-claire-element-id="478117">Le second argument, <code data-claire-semantic="c">status</code>, a le même rôle qu'avec <code data-claire-semantic="c">wait</code>.</p><p id="r-478118" data-claire-element-id="478118">Le troisième argument permet de préciser le comportement de waitpid. On peut utiliser deux constantes :</p><ul id="r-478123" data-claire-element-id="478123"><li id="r-478120" data-claire-element-id="478120"><p id="r-478119" data-claire-element-id="478119">WNOHANG : ne pas bloquer si aucun fils ne s'est terminé.</p></li><li id="r-478122" data-claire-element-id="478122"><p id="r-478121" data-claire-element-id="478121">WUNTRACED : recevoir l'information concernant également les fils bloqués si on ne l'a pas encore reçue.</p></li></ul><p id="r-478124" data-claire-element-id="478124">Dans le cas où cela ne vous intéresse pas, il suffit de mettre le paramètre 0.</p><aside id="r-478126" data-claire-element-id="478126" data-claire-semantic="information"><p id="r-478125" data-claire-element-id="478125">Notez que <code data-claire-semantic="c">waitpid(-1, status, 0)</code> correspond à la fonction <code data-claire-semantic="c">wait</code>.</p></aside><h6 id="r-les-macros-status" data-claire-element-id="478193">Les macros status</h6><p id="r-478128" data-claire-element-id="478128">Si l'on résume : un processus peut se terminer de façon normale (<code data-claire-semantic="c">return</code> ou <code data-claire-semantic="c">exit</code>) ou bien anormale (<code data-claire-semantic="c">assert</code>). Le processus existe toujours mais devient un zombie jusqu'à ce que <code data-claire-semantic="c">wait</code> soit appelé ou que le père meure.<br/> Le code de retour du processus est stocké dans l'emplacement pointé par <code data-claire-semantic="c">status</code>.</p><p id="r-478129" data-claire-element-id="478129">Pour avoir toutes ces informations, nous pouvons utiliser les macros suivantes :</p><table id="r-478161" data-claire-element-id="478161"><thead id="r-478135" data-claire-element-id="478135"><tr id="r-478134" data-claire-element-id="478134"><th id="r-478131" data-claire-element-id="478131"><p id="r-478130" data-claire-element-id="478130">Macro</p></th><th id="r-478133" data-claire-element-id="478133"><p id="r-478132" data-claire-element-id="478132">Description</p></th></tr></thead><tbody id="r-478160" data-claire-element-id="478160"><tr id="r-478140" data-claire-element-id="478140"><td id="r-478137" data-claire-element-id="478137"><p id="r-478136" data-claire-element-id="478136"><code data-claire-semantic="c">WIFEXITED(status)</code></p></td><td id="r-478139" data-claire-element-id="478139"><p id="r-478138" data-claire-element-id="478138">Elle renvoie vrai si le statut provient d'un processus fils qui s'est terminé en quittant le main avec <code data-claire-semantic="c">return</code> ou avec un appel à <code data-claire-semantic="c">exit</code>.</p></td></tr><tr id="r-478147" data-claire-element-id="478147"><td id="r-478142" data-claire-element-id="478142"><p id="r-478141" data-claire-element-id="478141"><code data-claire-semantic="c">WEXITSTATUS(status)</code></p></td><td id="r-478146" data-claire-element-id="478146"><p id="r-478143" data-claire-element-id="478143">Elle renvoie le code de retour du processus fils passé à <code data-claire-semantic="c">exit</code> ou à <code data-claire-semantic="c">return</code>.</p><aside id="r-478145" data-claire-element-id="478145" data-claire-semantic="warning"><p id="r-478144" data-claire-element-id="478144">Cette macro est utilisable uniquement si vous avez utilisé <code data-claire-semantic="c">WIFEXITED</code> avant, et que cette dernière a renvoyé vrai.</p></aside></td></tr><tr id="r-478152" data-claire-element-id="478152"><td id="r-478149" data-claire-element-id="478149"><p id="r-478148" data-claire-element-id="478148"><code data-claire-semantic="c">WIFSIGNALED(status)</code></p></td><td id="r-478151" data-claire-element-id="478151"><p id="r-478150" data-claire-element-id="478150">Elle renvoie vrai si le statut provient d'un processus fils qui s'est terminé à cause d'un signal.</p></td></tr><tr id="r-478159" data-claire-element-id="478159"><td id="r-478154" data-claire-element-id="478154"><p id="r-478153" data-claire-element-id="478153"><code data-claire-semantic="c">WTERMSIG(status)</code></p></td><td id="r-478158" data-claire-element-id="478158"><p id="r-478155" data-claire-element-id="478155">Elle renvoie la valeur du signal qui a provoqué la terminaison du processus fils.</p><aside id="r-478157" data-claire-element-id="478157" data-claire-semantic="warning"><p id="r-478156" data-claire-element-id="478156">Cette macro est utilisable uniquement si vous avez utilisé <code data-claire-semantic="c">WIFSIGNALED</code> avant, et que cette dernière a renvoyé vrai.</p></aside></td></tr></tbody></table><aside id="r-478163" data-claire-element-id="478163" data-claire-semantic="warning"><p id="r-478162" data-claire-element-id="478162">Ces macros utilisent le <code data-claire-semantic="c">status</code>, et non un pointeur sur ce <code data-claire-semantic="c">status</code>.</p></aside><p id="r-478164" data-claire-element-id="478164">Ces quatre macros sont les plus utilisées et les plus utiles. Il en existe d'autres : pour plus d'infos, un petit <code data-claire-semantic="console">man 2 wait</code> devrait vous aider.</p><p id="r-478165" data-claire-element-id="478165">Un petit exemple pour mettre en application l'étude de ces macros ?<br/> Nous allons tester plusieurs codes.</p><p id="r-478166" data-claire-element-id="478166">Premier code :</p><pre id="r-478167" data-claire-element-id="478167"><code data-claire-semantic="c">/* Pour les constantes EXIT_SUCCESS et EXIT_FAILURE */
#include &lt;stdlib.h&gt;
/* Pour fprintf() */
#include &lt;stdio.h&gt;
/* Pour fork() */
#include &lt;unistd.h&gt;
/* Pour perror() et errno */
#include &lt;errno.h&gt;
/* Pour le type pid_t */
#include &lt;sys/types.h&gt;
/* Pour wait() */
#include &lt;sys/wait.h&gt;

/* Pour faire simple, on déclare status en globale à la barbare */
int status;

/* La fonction create_process duplique le processus appelant et retourne
   le PID du processus fils ainsi créé */
pid_t create_process(void)
{
    /* On crée une nouvelle valeur de type pid_t */
    pid_t pid;

    /* On fork() tant que l'erreur est EAGAIN */
    do {
	pid = fork();
    } while ((pid == -1) &amp;&amp; (errno == EAGAIN));

    /* On retourne le PID du processus ainsi créé */
    return pid;
}

/* La fonction child_process effectue les actions du processus fils */
void child_process(void)
{
    printf(&quot; Nous sommes dans le fils !\n&quot;
	   &quot; Le PID du fils est %d.\n&quot;
	   &quot; Le PPID du fils est %d.\n&quot;, (int) getpid(), (int) getppid());
}

/* La fonction father_process effectue les actions du processus père */
void father_process(int child_pid)
{
    printf(&quot; Nous sommes dans le père !\n&quot;
	   &quot; Le PID du fils est %d.\n&quot;
	   &quot; Le PID du père est %d.\n&quot;, (int) child_pid, (int) getpid());

    if (wait(&amp;status) == -1) {
	    perror(&quot;wait :&quot;);
	    exit(EXIT_FAILURE);
    }

    if (WIFEXITED(status)) {
	printf(&quot; Terminaison normale du processus fils.\n&quot;
	       &quot; Code de retour : %d.\n&quot;, WEXITSTATUS(status));
    }

    if (WIFSIGNALED(status)) {
	printf(&quot; Terminaison anormale du processus fils.\n&quot;
	       &quot; Tué par le signal : %d.\n&quot;, WTERMSIG(status));
    }

}

int main(void)
{
    pid_t pid = create_process();

    switch (pid) {
	/* Si on a une erreur irrémédiable (ENOMEM dans notre cas) */
    case -1:
	perror(&quot;fork&quot;);
	return EXIT_FAILURE;
	break;
	/* Si on est dans le fils */
    case 0:
	child_process();
	break;
	/* Si on est dans le père */
    default:
	father_process(pid);
	break;
    }

    return EXIT_SUCCESS;
}</code></pre><p id="r-478168" data-claire-element-id="478168">Résultat :</p><pre id="r-478169" data-claire-element-id="478169"><code data-claire-semantic="console">$ ./a.out
 Nous sommes dans le père
 Le PID du fils est 1510
 Le PID du père est 1508
 Nous sommes dans le fils
 Le PID du fils est 1510
 Le PPID du fils est 1508
 Terminaison normale du processus fils.
 Code de retour : 0.
$</code></pre><p id="r-478170" data-claire-element-id="478170">Deuxième code :</p><pre id="r-478171" data-claire-element-id="478171"><code data-claire-semantic="c">/* Pour les constantes EXIT_SUCCESS et EXIT_FAILURE */
#include &lt;stdlib.h&gt;
/* Pour fprintf() */
#include &lt;stdio.h&gt;
/* Pour fork() */
#include &lt;unistd.h&gt;
/* Pour perror() et errno */
#include &lt;errno.h&gt;
/* Pour le type pid_t */
#include &lt;sys/types.h&gt;
/* Pour wait() */
#include &lt;sys/wait.h&gt;

/* La fonction create_process duplique le processus appelant et retourne
   le PID du processus fils ainsi créé */
pid_t create_process(void)
{
    /* On crée une nouvelle valeur de type pid_t */
    pid_t pid;

    /* On fork() tant que l'erreur est EAGAIN */
    do {
	pid = fork();
    } while ((pid == -1) &amp;&amp; (errno == EAGAIN));

    /* On retourne le PID du processus ainsi créé */
    return pid;
}

/* La fonction child_process effectue les actions du processus fils */
void child_process(void)
{
    printf(&quot; Nous sommes dans le fils !\n&quot;
	   &quot; Le PID du fils est %d.\n&quot;
	   &quot; Le PPID du fils est %d.\n&quot;, (int) getpid(), (int) getppid());
    exit(EXIT_FAILURE);
}

/* La fonction father_process effectue les actions du processus père */
void father_process(int child_pid)
{
    int status;

    printf(&quot; Nous sommes dans le père !\n&quot;
	   &quot; Le PID du fils est %d.\n&quot;
	   &quot; Le PID du père est %d.\n&quot;, (int) child_pid, (int) getpid());

    if (wait(&amp;status) == -1) {
	    perror(&quot;wait :&quot;);
	    exit(EXIT_FAILURE);
    }

    if (WIFEXITED(status)) {
	printf(&quot; Terminaison normale du processus fils.\n&quot;
	       &quot; Code de retour : %d.\n&quot;, WEXITSTATUS(status));
    }

    if (WIFSIGNALED(status)) {
	printf(&quot; Terminaison anormale du processus fils.\n&quot;
	       &quot; Tué par le signal : %d.\n&quot;, WTERMSIG(status));
    }

}

int main(void)
{
    pid_t pid = create_process();

    switch (pid) {
	/* Si on a une erreur irrémédiable (ENOMEM dans notre cas) */
    case -1:
	perror(&quot;fork&quot;);
	return EXIT_FAILURE;
	break;
	/* Si on est dans le fils */
    case 0:
	child_process();
	break;
	/* Si on est dans le père */
    default:
	father_process(pid);
	break;
    }

    return EXIT_SUCCESS;
}</code></pre><p id="r-478172" data-claire-element-id="478172">Résultat :</p><pre id="r-478173" data-claire-element-id="478173"><code data-claire-semantic="console">$ ./a.out
 Nous sommes dans le père
 Le PID du fils est 11433
 Le PID du père est 11431
 Nous sommes dans le fils 
 Le PID du fils est 11433
 Le PPID du fils est 11431
 Terminaison normale du processus fils.
 Code de retour : 1.
$</code></pre><p id="r-478174" data-claire-element-id="478174">Troisième code :</p><pre id="r-478175" data-claire-element-id="478175"><code data-claire-semantic="c">/* Pour les constantes EXIT_SUCCESS et EXIT_FAILURE */
#include &lt;stdlib.h&gt;
/* Pour fprintf() */
#include &lt;stdio.h&gt;
/* Pour fork() */
#include &lt;unistd.h&gt;
/* Pour perror() et errno */
#include &lt;errno.h&gt;
/* Pour le type pid_t */
#include &lt;sys/types.h&gt;
/* Pour wait() */
#include &lt;sys/wait.h&gt;

/* La fonction create_process duplique le processus appelant et retourne
   le PID du processus fils ainsi créé */
pid_t create_process(void)
{
    /* On crée une nouvelle valeur de type pid_t */
    pid_t pid;

    /* On fork() tant que l'erreur est EAGAIN */
    do {
	pid = fork();
    } while ((pid == -1) &amp;&amp; (errno == EAGAIN));

    /* On retourne le PID du processus ainsi créé */
    return pid;
}

/* La fonction child_process effectue les actions du processus fils */
void child_process(void)
{
    printf(&quot; Nous sommes dans le fils !\n&quot;
	   &quot; Le PID du fils est %d.\n&quot;
	   &quot; Le PPID du fils est %d.\n&quot;, (int) getpid(), (int) getppid());
    sleep(20);
}

/* La fonction father_process effectue les actions du processus père */
void father_process(int child_pid)
{
    int status;

    printf(&quot; Nous sommes dans le père !\n&quot;
	   &quot; Le PID du fils est %d.\n&quot;
	   &quot; Le PID du père est %d.\n&quot;, (int) child_pid, (int) getpid());

    if (wait(&amp;status) == -1) {
	    perror(&quot;wait :&quot;);
	    exit(EXIT_FAILURE);
    }

    if (WIFEXITED(status)) {
	printf(&quot; Terminaison normale du processus fils.\n&quot;
	       &quot; Code de retour : %d.\n&quot;, WEXITSTATUS(status));
    }

    if (WIFSIGNALED(status)) {
	printf(&quot; Terminaison anormale du processus fils.\n&quot;
	       &quot; Tué par le signal : %d.\n&quot;, WTERMSIG(status));
    }

}

int main(void)
{
    pid_t pid = create_process();

    switch (pid) {
	/* Si on a une erreur irrémédiable (ENOMEM dans notre cas) */
    case -1:
	perror(&quot;fork&quot;);
	return EXIT_FAILURE;
	break;
	/* Si on est dans le fils */
    case 0:
	child_process();
	break;
	/* Si on est dans le père */
    default:
	father_process(pid);
	break;
    }

    return EXIT_SUCCESS;
}</code></pre><p id="r-478176" data-claire-element-id="478176">Résultat :</p><p id="r-478177" data-claire-element-id="478177">Dans un premier terminal (début de l'exécution) :</p><pre id="r-478178" data-claire-element-id="478178"><code data-claire-semantic="console">$ ./a.out
 Le PID du fils est 18745
 Le PID du père est 18743
 Nous sommes dans le fils
 Le PID du fils est 18745
 Le PPID du fils est 18743</code></pre><p id="r-478179" data-claire-element-id="478179">Dans un second terminal :</p><pre id="r-478180" data-claire-element-id="478180"><code data-claire-semantic="console">$ kill 18745
$</code></pre><p id="r-478181" data-claire-element-id="478181">Dans le premier terminal, fin de l'exécution :</p><pre id="r-478182" data-claire-element-id="478182"><code data-claire-semantic="console">$ ./a.out
 Le PID du fils est 18745
 Le PID du père est 18743
 Nous sommes dans le fils
 Le PID du fils est 18745
 Le PPID du fils est 18743
 Terminaison anormale du processus fils.
 Tué par le signal : 15.
$</code></pre><p id="r-478183" data-claire-element-id="478183">Très facile, le QCM, n'est-ce pas ? ^^</p><p id="r-478184" data-claire-element-id="478184">Bon, pour clore ce chapitre, voici un exercice très facile que vous pouvez réaliser si vous avez bien suivi ce chapitre.</p><p id="r-478185" data-claire-element-id="478185">Écrire un programme qui crée un fils. Le père doit afficher « Je suis le père » et le fils doit afficher « Je suis le fils ».</p><p id="r-478186" data-claire-element-id="478186">Correction :</p><p id="r-478187" data-claire-element-id="478187"></p><div id="r-478189" data-claire-element-id="478189"><pre id="r-478188" data-claire-element-id="478188"><code data-claire-semantic="c">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;errno.h&gt;
#include &lt;sys/wait.h&gt;
#include &lt;sys/types.h&gt;

int main(void)
{
    pid_t pid_fils;

    do {
	pid_fils = fork();
    } while ((pid_fils == -1) &amp;&amp; (errno == EAGAIN));

    if (pid_fils == -1) {
	perror(&quot;fork&quot;);
    } else if (pid_fils == 0) {
	printf(&quot;Je suis le fils&quot;);
    } else {
	printf(&quot;Je suis le père&quot;);

	if (wait(NULL) == -1) {
	    perror(&quot;wait :&quot;);
	}
    }

    return EXIT_SUCCESS;
}</code></pre></div><p id="r-478190" data-claire-element-id="478190">Vous pouvez aussi vous amuser à créer plusieurs processus, qui exécutent chacun une tâche spécifique.</p><p id="r-478191" data-claire-element-id="478191">Bon, nous avons appris pleins de choses, mais les processus c'est pas très impressionnant n'est ce pas ?</p><p id="r-478192" data-claire-element-id="478192">C'est ce que nous allons voir dans le prochain chapitre : on va apprendre à lancer un programme à partir de notre programme bien aimé. ;)</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
<span class="arrow"></span>
<span class="next">Création d&#039;un nouveau processus</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">
<span class="next">Exécuter un programme</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Excuterunprogramme"></a><h2>Exécuter un programme</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
<span class="arrow"></span>
<span class="next">Terminaison d&#039;un processus</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
<span class="next">Notions pré-requises</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-478197" data-claire-element-id="478197">Voici un chapitre (enfin !) intéressant. Nous allons apprendre à exécuter un programme externe à partir de <em>notre </em>programme.</p>
</div><a name="Notionspr-requises"></a><h2>Notions pré-requises</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">
<span class="arrow"></span>
<span class="next">Exécuter un programme</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
<span class="next">Les fonctions de la famille exec</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-notions-pre-requises" data-claire-element-id="478263">Notions pré-requises</h4><h5 id="r-arguments-en-ligne-de-commande" data-claire-element-id="478212">Arguments en ligne de commande</h5><p id="r-478198" data-claire-element-id="478198">La fonction <code data-claire-semantic="c">main</code> d'un programme peut prendre des arguments en ligne de commande. En effet, voici un exemple :</p><pre id="r-478199" data-claire-element-id="478199"><code data-claire-semantic="console">$ ./a.out argument1 argument2 argument3</code></pre><p id="r-478200" data-claire-element-id="478200">Pour récupérer les arguments dans un programme en C, on utilise les paramètres <code data-claire-semantic="c">argc</code> et <code data-claire-semantic="c">argv</code> de la fonction <code data-claire-semantic="c">main</code>. Souvenez-vous de vos premiers cours de C en compagnie de M@teo21, ce dernier vous harassant à utiliser un prototype de <code data-claire-semantic="c">main</code> incompréhensible et impossible à retenir ! Voilà à quoi ces paramètres servent...</p><ul id="r-478205" data-claire-element-id="478205"><li id="r-478202" data-claire-element-id="478202"><p id="r-478201" data-claire-element-id="478201"><code data-claire-semantic="c">Argc</code> est un entier de type <code data-claire-semantic="c">int</code> qui donne le nombre d'arguments passés en ligne de commande <strong>plus 1</strong>.</p></li><li id="r-478204" data-claire-element-id="478204"><p id="r-478203" data-claire-element-id="478203"><code data-claire-semantic="c">Argv</code> est un tableau de pointeurs. <code data-claire-semantic="c">Argv[0]</code> contient de nom du fichier exécutable du programme. Les cases suivantes <code data-claire-semantic="c">argv[1]</code>, <code data-claire-semantic="c">argv[2]</code>, etc. contiennent les arguments passés en ligne de commande. Enfin, <code data-claire-semantic="c">argv[argc]</code> doit obligatoirement être NULL.</p></li></ul><p id="r-478206" data-claire-element-id="478206">Fort de ces indications, écrivez un programme qui prend des arguments et qui affiche :</p><pre id="r-478207" data-claire-element-id="478207"><code data-claire-semantic="console">Argument 1 : ...
Argument 2 : ...
etc.</code></pre><p id="r-478208" data-claire-element-id="478208">C'est bon ?<br/> Correction !</p><pre id="r-478209" data-claire-element-id="478209"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

/* Les deux paramètres de la fonction main() pour récupérer les
   arguments de la ligne de commande */
int main(int argc, char *argv[])
{
    /* Déclaration de la variable pour parcourir le tableau argv  */
    int i;
    /* Si le programme n'a pas reçu d'argument (rappelez vous argc est
       égal au nombre d'argument + 1) */
    if (argc &lt;= 1) {
	printf(&quot;\nLe programme n'a reçu aucun argument\n&quot;);
    }

    /* Si il en a reçu un ou plus  */
    else {
	for (i = 1; i &lt; argc; i++) {
	    printf(&quot;Argument %d : %s\n&quot;, i, argv[i]);
	}
    }

    return EXIT_SUCCESS;
}</code></pre><p id="r-478210" data-claire-element-id="478210">Résultat :</p><pre id="r-478211" data-claire-element-id="478211"><code data-claire-semantic="console">$ ./a.out je mange de la choucroute

Argument 1 : je
Argument 2 : mange
Argument 3 : de
Argument 4 : la
Argument 5 : choucroute
$</code></pre><h5 id="r-la-variable-path" data-claire-element-id="478217">La variable PATH</h5><p id="r-478213" data-claire-element-id="478213">La variable <strong>PATH </strong>contient une série de chemin vers des répertoires qui contiennent des exécutables ou des scripts de commande.</p><p id="r-478214" data-claire-element-id="478214">Comme toute variable qui se respecte, on peut afficher sa valeur avec la commande :</p><pre id="r-478215" data-claire-element-id="478215"><code data-claire-semantic="console">$ echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games</code></pre><p id="r-478216" data-claire-element-id="478216">Lorsqu'on lance une commande dans la console, le système va chercher l'exécutable dans les chemins donnés dans le <strong>PATH</strong>. Pour le <strong>PATH </strong>donné en exemple, le noyau ira chercher l'exécutable dans /usr/local/sbin, puis dans /usr/local/bin, etc... En conséquence, si deux commandes portent le même nom, c'est la première trouvée qui sera exécutée.</p><h5 id="r-l-environnement-1" data-claire-element-id="478262">L'environnement</h5><p id="r-478218" data-claire-element-id="478218">Une application peut être exécutée dans des contextes différents : terminaux, répertoire de travail...<br/> C'est pourquoi le programmeur système a souvent besoin d'accéder à l'<strong>environnement</strong>. Celui-ci est définit sous la forme de <strong>variables d'environnement</strong>.</p><h6 id="r-variables-d-environnement" data-claire-element-id="478229">Variables d'environnement</h6><p id="r-478219" data-claire-element-id="478219">Elles sont définies sous la forme suivante : <strong>NOM = VALEUR</strong>.<br/> Lorsqu'un programme en C démarre, ces variables sont automatiquement copiées dans un tableau de <code data-claire-semantic="c">char</code>. Vous pouvez y accéder en déclarant la variable externe globale <code data-claire-semantic="c"><strong>environ</strong></code> au début de votre fichier, comme ceci :</p><pre id="r-478220" data-claire-element-id="478220"><code data-claire-semantic="c">extern char **environ;</code></pre><p id="r-478221" data-claire-element-id="478221">Ce tableau contient des chaînes de caractères se terminant par NULL, et lui-même se termine par un pointeur nul. Un petit schéma peut-être ?</p><figure id="r-478223" data-claire-element-id="478224"><img id="r-478222" data-claire-element-id="478222" src="medias/uploads.siteduzero.com_files_303001_304000_303383.png" alt="Image utilisateur"/></figure><p id="r-478225" data-claire-element-id="478225">Bien, maintenant, on va écrire un petit programme qui affiche toutes les variables d'environnement.</p><pre id="r-478226" data-claire-element-id="478226"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

extern char **environ;

int main(void)
{
    int i;

    for (i = 0; environ[i] != NULL; i++) {
	printf(&quot;%s\n&quot;, environ[i]);
    }

    return EXIT_SUCCESS;
}</code></pre><p id="r-478227" data-claire-element-id="478227">Voici un exemple de résultat :</p><pre id="r-478228" data-claire-element-id="478228"><code data-claire-semantic="console">ORBIT_SOCKETDIR=/tmp/orbit-lucas
SSH_AGENT_PID=1412
GPG_AGENT_INFO=/tmp/gpg-oRe8EV/S.gpg-agent:1413:1
TERM=xterm
SHELL=/bin/bash
XDG_SESSION_COOKIE=66803415d39a03f0d150db3d0000000f-1300522273.896593-1253931584
WINDOWID=119537667
GNOME_KEYRING_CONTROL=/tmp/keyring-noSBVu
GTK_MODULES=canberra-gtk-module:gail:atk-bridge
USER=lucas
SSH_AUTH_SOCK=/tmp/keyring-noSBVu/ssh
SESSION_MANAGER=local/lucas-Deskstop:@/tmp/.ICE-unix/1352,unix/lucas-Deskstop:/tmp/.ICE-unix/1352
USERNAME=lucas
DEFAULTS_PATH=/usr/share/gconf/gnome.default.path
XDG_CONFIG_DIRS=/etc/xdg/xdg-gnome:/etc/xdg
DESKTOP_SESSION=gnome
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games
PWD=/home/lucas/Documents
GDM_KEYBOARD_LAYOUT=fr        oss
LANG=fr_FR.UTF-8
MANDATORY_PATH=/usr/share/gconf/gnome.mandatory.path
GDM_LANG=fr_FR.UTF-8
GDMSESSION=gnome
SHLVL=1
HOME=/home/lucas
GNOME_DESKTOP_SESSION_ID=this-is-deprecated
LOGNAME=lucas
XDG_DATA_DIRS=/usr/share/gnome:/usr/local/share/:/usr/share/
DBUS_SESSION_BUS_ADDRESS=unix:abstract=/tmp/dbus-XTApH2KvXM,guid=7d07bc72de6da00b353c54e400000013
LESSOPEN=| /usr/bin/lesspipe %s
WINDOWPATH=7
DISPLAY=:0.0
LESSCLOSE=/usr/bin/lesspipe %s %s
XAUTHORITY=/var/run/gdm/auth-for-lucas-N38PVj/database
COLORTERM=gnome-terminal
OLDPWD=/home/lucas
_=./a.out</code></pre><h6 id="r-variables-d-environnement-classiques" data-claire-element-id="478244">Variables d'environnement classiques</h6><p id="r-478230" data-claire-element-id="478230">Voici une explication des variables d'environnement couramment utilisées :</p><ul id="r-478243" data-claire-element-id="478243"><li id="r-478232" data-claire-element-id="478232"><p id="r-478231" data-claire-element-id="478231"><strong>HOME</strong> : contient le répertoire personnel de l'utilisateur ;</p></li><li id="r-478234" data-claire-element-id="478234"><p id="r-478233" data-claire-element-id="478233"><strong>PATH</strong> : Tiens donc ! Comme on se retrouve... :p ;</p></li><li id="r-478236" data-claire-element-id="478236"><p id="r-478235" data-claire-element-id="478235"><strong>PWD</strong> : contient le répertoire de travail ;</p></li><li id="r-478238" data-claire-element-id="478238"><p id="r-478237" data-claire-element-id="478237"><strong>USER</strong> (ou <strong>LOGNAME</strong>) : nom de l'utilisateur ;</p></li><li id="r-478240" data-claire-element-id="478240"><p id="r-478239" data-claire-element-id="478239"><strong>TERM</strong> : type de terminal utilisé ;</p></li><li id="r-478242" data-claire-element-id="478242"><p id="r-478241" data-claire-element-id="478241"><strong>SHELL</strong> : shell de connexion utilisé.</p></li></ul><h6 id="r-creer-modifier-rechercher-et-supprimer-une-variable" data-claire-element-id="478261">Créer, modifier, rechercher et supprimer une variable</h6><p id="r-478245" data-claire-element-id="478245">La fonction :</p><pre id="r-478246" data-claire-element-id="478246"><code data-claire-semantic="c">int putenv(const char *string);</code></pre><p id="r-478247" data-claire-element-id="478247">sert à créer une variable d'environnement. Elle prend en argument une chaîne de caractère du type « NOM=VALEUR ».</p><p id="r-478248" data-claire-element-id="478248">La fonction :</p><pre id="r-478249" data-claire-element-id="478249"><code data-claire-semantic="c">int setenv(const char *name, const char *value, int overwrite);</code></pre><p id="r-478250" data-claire-element-id="478250">sert à modifier une variable d'environnement. Elle prend en argument le nom de la variable, la valeur à affecter et si on écrase la précédente valeur de la variable (si il y en a une) ou pas (1 pour l'écraser, 0 sinon).</p><p id="r-478251" data-claire-element-id="478251">La fonction <code data-claire-semantic="c">getenv</code>, ainsi déclarée dans <code data-claire-semantic="c">stdlib.h</code> :</p><pre id="r-478252" data-claire-element-id="478252"><code data-claire-semantic="c">char *getenv(const char *name);</code></pre><p id="r-478253" data-claire-element-id="478253">permet de rechercher une variable d'environnement.</p><p id="r-478254" data-claire-element-id="478254">Enfin, la fonction :</p><pre id="r-478255" data-claire-element-id="478255"><code data-claire-semantic="c">void unsetenv(const char *name);</code></pre><p id="r-478256" data-claire-element-id="478256">permet de supprimer une variable d'environnement.</p><p id="r-478257" data-claire-element-id="478257">Créez un programme permettant de rechercher les variables d'environnement passées en paramètre de la fonction <code data-claire-semantic="c">main</code>.</p><pre id="r-478258" data-claire-element-id="478258"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int main(int argc, char *argv[])
{
    int i;
    char *variable;

    if (argc &lt;= 1) {
	fprintf(stderr, &quot;Le programme n'a reçu aucun argument.\n&quot;);
	return EXIT_FAILURE;
    }

    for (i = 1; i &lt; argc; i++) {
	variable = getenv(argv[i]);

	if (!variable) {
	    printf(&quot;%s : n'existe pas\n&quot;, argv[i]);
	} else {
	    printf(&quot;%s : %s\n&quot;, argv[i], variable);
	}
    }

    return EXIT_SUCCESS;
}</code></pre><p id="r-478259" data-claire-element-id="478259">Exemple d'exécution :</p><pre id="r-478260" data-claire-element-id="478260"><code data-claire-semantic="console">$ ./a.out DISPLAY HOME
DISPLAY : :0.0
HOME : /home/lucas</code></pre>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">
<span class="arrow"></span>
<span class="next">Exécuter un programme</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
<span class="next">Les fonctions de la famille exec</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesfonctionsdelafamilleexec"></a><h2>Les fonctions de la famille exec</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
<span class="arrow"></span>
<span class="next">Notions pré-requises</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
<span class="next">La fonction system</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-fonctions-de-la-famille-exec" data-claire-element-id="478301">Les fonctions de la famille exec</h4><p id="r-478264" data-claire-element-id="478264">Bien, nous allons maintenant rentrer dans le vif du sujet de ce chapitre : dans cette sous-partie, vous allez pouvoir lancer des programmes.<br/> Pour cela, je dois vous présenter une famille de fonction nous permettant de réaliser cela : la famille <code data-claire-semantic="c">exec</code>. En réalité, il existe six fonctions appartenant à cette famille : <code data-claire-semantic="c">execl</code>, <code data-claire-semantic="c">execle</code>, <code data-claire-semantic="c">execlp</code>, <code data-claire-semantic="c">execv</code>, <code data-claire-semantic="c">execve</code> et <code data-claire-semantic="c">execvp</code>. Parmi eux, seule la fonction <code data-claire-semantic="c">execve</code> est un appel-système, les autres sont implémentées à partir de celui-ci. Ces fonctions permettent de remplacer un programme en cours par un autre programme sans en changer le PID. Autrement dit, on peut remplacer le code source d'un programme par celui d'un autre programme en faisant appel à une fonction <code data-claire-semantic="c">exec</code>.<br/> Voici leurs prototypes :</p><pre id="r-478265" data-claire-element-id="478265"><code data-claire-semantic="c">int execve(const char *filename, char *const argv[], char *const envp[]);</code></pre><pre id="r-478266" data-claire-element-id="478266"><code data-claire-semantic="c">int execl(const char *path, const char *arg,  ...);</code></pre><pre id="r-478267" data-claire-element-id="478267"><code data-claire-semantic="c">int execlp(const char *file, const char *arg, ...);</code></pre><pre id="r-478268" data-claire-element-id="478268"><code data-claire-semantic="c">int execle(const char *file, const char *arg, ..., char *const envp[]);</code></pre><pre id="r-478269" data-claire-element-id="478269"><code data-claire-semantic="c">int execv(const char *path, char *const argv[]);</code></pre><pre id="r-478270" data-claire-element-id="478270"><code data-claire-semantic="c">int execvp(const char *file, char *const argv[]);</code></pre><ul id="r-478283" data-claire-element-id="478283"><li id="r-478272" data-claire-element-id="478272"><p id="r-478271" data-claire-element-id="478271">Suffixe en <strong>-v</strong> : les arguments sont passés sous forme de tableau ;</p></li><li id="r-478274" data-claire-element-id="478274"><p id="r-478273" data-claire-element-id="478273">Suffixe en <strong>-l</strong> : les arguments sont passés sous forme de liste ;</p></li><li id="r-478276" data-claire-element-id="478276"><p id="r-478275" data-claire-element-id="478275">Suffixe en <strong>-p</strong> : le fichier à exécuter est recherché à l'aide de la variable d'environnement <strong>PATH</strong> ;</p></li><li id="r-478278" data-claire-element-id="478278"><p id="r-478277" data-claire-element-id="478277">Pas de suffixe en <strong>-p</strong> : le fichier à exécuter est recherché relativement au répertoire de travail du processus père ;</p></li><li id="r-478280" data-claire-element-id="478280"><p id="r-478279" data-claire-element-id="478279">Suffixe en <strong>-e</strong> : un nouvel environnement est transmis au processus fils ;</p></li><li id="r-478282" data-claire-element-id="478282"><p id="r-478281" data-claire-element-id="478281">Pas de suffixe en <strong>-e</strong> : l'environnement du nouveau processus est déterminé à partir de la variable d'environnement externe <code data-claire-semantic="c">environ</code> du processus père.</p></li></ul><p id="r-478284" data-claire-element-id="478284">Je vous explique rapidement à quoi correspond chaque caractéristique.<br/> Le premier argument correspond au chemin complet d'un fichier objet exécutable (si <code data-claire-semantic="c">path</code>) ou le nom de ce fichier (si <code data-claire-semantic="c">file</code>). Le second argument correspond aux paramètres envoyés au fichier à exécuter : soit sous forme de liste de pointeurs sur des chaînes de caractères, soit sous forme de tableau. Le premier élément de la liste ou du tableau est le nom du fichier à exécuter, le dernier est un pointeur NULL. <br/> Le troisième argument éventuel est une liste ou un tableau de pointeurs d'environnement.<br/> De plus, toutes ces fonctions renvoient <strong>-1</strong>. <code data-claire-semantic="c">errno</code> peut correspondre à plusieurs constantes, dont EACCESS (vous n'avez pas les permissions nécessaires pour exécuter le programme), E2BIG (la liste d'argument est trop grande), ENOENT (le programme n'existe pas), ETXTBSY (le programme a été ouvert en écriture par d'autres processus), ENOMEM (pas assez de mémoire), ENOEXEC (le fichier exécutable n'a pas le bon format) ou encore ENOTDIR (le chemin d'accès contient un nom de répertoire incorrect).</p><p id="r-478285" data-claire-element-id="478285">Comme je l'ai dit tout à l'heure, seul <code data-claire-semantic="c">execve</code> est un appel-système, et les autres ne sont que ses dérivés. La logique de mon sadisme ( :diable: ) voudrait qu'on l'utilise « par défaut », mais je vous conseille plutôt la fonction <code data-claire-semantic="c">execv</code> qui fonctionne de la même manière que execve, mis à part que vous n'avez pas à vous soucier de l'environnement.</p><p id="r-478286" data-claire-element-id="478286">Maintenant, écrivez un programme qui lance la commande ps. Vous pouvez la trouver dans le dossier /bin.</p><p id="r-478287" data-claire-element-id="478287">Correction :</p><pre id="r-478288" data-claire-element-id="478288"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

int main(void)
{
    /* Tableau de char contenant les arguments (là aucun : le nom du
       programme et NULL sont obligatoires)  */
    char *arguments[] = { &quot;ps&quot;, NULL };

    /* Lancement de la commande */
    if (execv(&quot;/bin/ps&quot;, arguments) == -1) {
	perror(&quot;execv&quot;);
        return EXIT_FAILURE;
    }

    return EXIT_SUCCESS;
}</code></pre><pre id="r-478289" data-claire-element-id="478289"><code data-claire-semantic="console">$ ./a.out
PID TTY TIME CMD
1762 pts/0 00:00:00 bash
1845 pts/0 00:00:00 ps</code></pre><p id="r-478290" data-claire-element-id="478290">Maintenant que vous pouvez remarquer que ça a marché, créez un programme qui prend en argument le chemin complet d'un répertoire et qui ouvre l'<em>analyseur d'utilisation des disques</em> pour ce chemin. La commande permettant de lancer ce programme se nomme baobab, elle prend en argument le chemin du répertoire devant être analysé et elle se situe dans le répertoire /usr/bin/baobab.</p><pre id="r-478291" data-claire-element-id="478291"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

/* On récupère les arguments */
int main(int argc, char *argv[])
{
    /* On crée un tableau contenant le nom du programme, l'argument et le 
       dernier &quot;NULL&quot; obligatoire  */
    char *arguments[] = { &quot;baobab&quot;, argv[1], NULL };

    /* On lance le programme  */
    if (execv(&quot;/usr/bin/baobab&quot;, arguments) == -1) {
	perror(&quot;execv&quot;);
        return EXIT_FAILURE;
    }

    return EXIT_SUCCESS;
}</code></pre><p id="r-478292" data-claire-element-id="478292">Maintenant, exécutez ce programme. Si vous avez tapé un chemin valide, l'<em>analyseur d'utilisation des disques</em> s'ouvre. Ensuite, ne fermez pas la fenêtre et retournez dans la console. Et là, stupeur ! On ne peut plus rentrer de commande, et s'il l'on fait <kbd>CRTL</kbd> + <kbd>C</kbd>, l'<em>AUD </em>se ferme ! Imaginez aussi que vous voulez exécuter un code à la suite de l'ouverture du programme...</p><p id="r-478293" data-claire-element-id="478293">Maintenant, réfléchissez. Il nous faut trouver une solution à ce problème : exécuter un nouveau programme tout en pouvant réaliser d'autres actions pendant ce temps. Vous avez compris ? Eh oui, il faut utiliser les processus !</p><p id="r-478294" data-claire-element-id="478294">Créez un programme qui règle notre problème...</p><pre id="r-478295" data-claire-element-id="478295"><code data-claire-semantic="c">/* Pour les constantes EXIT_SUCCESS et EXIT_FAILURE */
#include &lt;stdlib.h&gt;
/* Pour fprintf() */
#include &lt;stdio.h&gt;
/* Pour fork() */
#include &lt;unistd.h&gt;
/* Pour perror() et errno */
#include &lt;errno.h&gt;
/* Pour le type pid_t */
#include &lt;sys/types.h&gt;
/* Pour wait() */
#include &lt;sys/wait.h&gt;

/* La fonction create_process duplique le processus appelant et retourne
   le PID du processus fils ainsi créé */
pid_t create_process(void)
{
    /* On crée une nouvelle valeur de type pid_t */
    pid_t pid;

    /* On fork() tant que l'erreur est EAGAIN */
    do {
	pid = fork();
    } while ((pid == -1) &amp;&amp; (errno == EAGAIN));

    /* On retourne le PID du processus ainsi créé */
    return pid;
}

/* La fonction son_process effectue les actions du processus fils */
void son_process(char *arg[])
{
    if (execv(&quot;/usr/bin/baobab&quot;, arg) == -1) {
  	perror(&quot;execv&quot;);
	exit(EXIT_FAILURE);
    }
}

/* La fonction father_process effectue les actions du processus père */
void father_process(void)
{
    printf(&quot;\nSi ce texte s'affiche, nous avons résolu notre problème !\n&quot;);
}

int main(int argc, char *argv[])
{
    char *arg[] = { &quot;baobab&quot;, argv[1], NULL };
    pid_t pid = create_process();

    switch (pid) {
    /* Si on a une erreur irrémédiable (ENOMEM dans notre cas) */
    case -1:
	perror(&quot;fork&quot;);
	return EXIT_FAILURE;
	break;
    /* Si on est dans le fils */
    case 0:
	son_process(arg);
	break;
    /* Si on est dans le père */
    default:
	father_process();
	break;
    }

    return EXIT_SUCCESS;
}</code></pre><p id="r-478296" data-claire-element-id="478296">Compilez, exécutez, résultat :</p><figure id="r-478298" data-claire-element-id="478299"><img id="r-478297" data-claire-element-id="478297" src="medias/uploads.siteduzero.com_files_280001_281000_280550.jpg" alt="Image utilisateur"/></figure><p id="r-478300" data-claire-element-id="478300">C'est gagné ! C'est gagné !</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
<span class="arrow"></span>
<span class="next">Notions pré-requises</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
<span class="next">La fonction system</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lafonctionsystem"></a><h2>La fonction system</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
<span class="arrow"></span>
<span class="next">Les fonctions de la famille exec</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">
<span class="next">Les threads</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-la-fonction-system-1" data-claire-element-id="478320">La fonction system</h4><p id="r-478302" data-claire-element-id="478302">La fonction <code data-claire-semantic="c">system</code> est semblable aux <code data-claire-semantic="c">exec</code>, mais elle est beaucoup plus simple d'utilisation. En revanche, on ne peut pas y passer d'arguments. Son prototype est</p><pre id="r-478303" data-claire-element-id="478303"><code data-claire-semantic="c">#include &lt;stdlib.h&gt;

int system(const char *command);</code></pre><p id="r-478304" data-claire-element-id="478304">Écrivez un programme qui lance la commande <em>clear</em> qui permet d'effacer le contenu de la console.</p><pre id="r-478305" data-claire-element-id="478305"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int main(void)
{
    system(&quot;clear&quot;);
    return EXIT_SUCCESS;
}</code></pre><p id="r-478306" data-claire-element-id="478306">Vous avez vu comme c'est simple ? ^^</p><p id="r-478307" data-claire-element-id="478307">Mais c'est trop beau pour être vrai !<br/> En effet, la fonction <code data-claire-semantic="c">system</code> comporte des failles de sécurité <strong>très importantes</strong>.</p><p id="r-478308" data-claire-element-id="478308">Nous devons donc nous fixer la règle suivante :</p><table id="r-478313" data-claire-element-id="478313"><tbody id="r-478312" data-claire-element-id="478312"><tr id="r-478311" data-claire-element-id="478311"><td id="r-478310" data-claire-element-id="478310"><p id="r-478309" data-claire-element-id="478309">Il ne faut jamais utiliser la fonction <code data-claire-semantic="c">system</code></p></td></tr></tbody></table><aside id="r-478315" data-claire-element-id="478315" data-claire-semantic="information"><p id="r-478314" data-claire-element-id="478314">Pour en savoir plus sur les failles de sécurité de <code data-claire-semantic="c">system,</code><a href="http://ghostsinthestack.org/article-14-la-faille-de-system.html">cliquez ici</a>.</p></aside><p id="r-478316" data-claire-element-id="478316">Pffiiou !</p><p id="r-478317" data-claire-element-id="478317">Voilà le chapitre enfin terminé ! :)</p><p id="r-478318" data-claire-element-id="478318">Il a été riche en découverte, et vous pouvez enfin créer des programmes à peu près intéressant...</p><p id="r-478319" data-claire-element-id="478319">Prochain chapitre en vu : les <em>threads</em>.<br/> Au programme : exécuter des fonctions en même temps...</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
<span class="arrow"></span>
<span class="next">Les fonctions de la famille exec</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">
<span class="next">Les threads</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesthreads"></a><h2>Les threads</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
<span class="arrow"></span>
<span class="next">La fonction system</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
<span class="next">Qu&#039;est ce qu&#039;un thread ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-478322" data-claire-element-id="478322">Voici un chapitre à ne manquer sous aucun prétexte car c'est une des bases de la programmation système sous Unix : l'étude des <em>threads</em><em>Posix</em> (<em>Posix </em>est le nom d'une famille de standards qui indique un code standard).</p>
</div><a name="Qu039estcequ039unthread"></a><h2>Qu&#039;est ce qu&#039;un thread ?</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">
<span class="arrow"></span>
<span class="next">Les threads</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
<span class="next">Compilation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-qu-est-ce-qu-un-thread" data-claire-element-id="478328">Qu'est ce qu'un thread ?</h4><p id="r-478323" data-claire-element-id="478323">Dans la plupart des systèmes d'exploitation, chaque processus possède un espace d'adressage et un <strong>thread</strong> de contrôle unique, le <strong>thread principal</strong>. Du point de vue programmation, ce dernier exécute le <code data-claire-semantic="c">main</code>.</p><p id="r-478324" data-claire-element-id="478324">Vous avez pu remarquer, lors de notre étude des processus, qu'en général, le système réserve un processus à chaque application, sauf quelques exceptions. Beaucoup de programmes exécutent plusieurs activités en parallèle, du moins en apparent parallélisme, comme nous l'avons vu précédemment. Comme à l'échelle des processus, certaines de ces activités peuvent se bloquer, et ainsi réserver ce blocage à un seul thread séquentiel, permettant par conséquent de ne pas stopper toute l'application.<br/> Ensuite, il faut savoir que le principal avantage des threads par rapport aux processus, c'est la facilité et la rapidité de leur création. En effet, tous les threads d'un même processus partagent le même espace d'adressage, et donc toutes les variables. Cela évite donc l'allocation de tous ces espaces lors de la création, et il est à noter que, sur de nombreux systèmes, la création d'un thread est environ cent fois plus rapide que celle d'un processus.<br/> Au-delà de la création, la superposition de l'exécution des activités dans une même application permet une importante accélération quant au fonctionnement de cette dernière.</p><p id="r-478325" data-claire-element-id="478325">Sachez également que la communication entre les threads est plus aisée que celle entre les processus, pour lesquels on doit utiliser des notions compliquées comme les tubes (voir chapitre suivant).</p><aside id="r-478327" data-claire-element-id="478327" data-claire-semantic="information"><p id="r-478326" data-claire-element-id="478326">Le mot « <em>thread</em> » est un terme anglais qui peut se traduire par « <em>fil d'exécution</em> ». L'appellation de « <em>processus léger</em> » est également utilisée.</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">
<span class="arrow"></span>
<span class="next">Les threads</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
<span class="next">Compilation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Compilation"></a><h2>Compilation</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
<span class="arrow"></span>
<span class="next">Qu&#039;est ce qu&#039;un thread ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
<span class="next">Manipulation des threads</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-compilation-9" data-claire-element-id="478335">Compilation</h4><p id="r-478329" data-claire-element-id="478329">Toutes les fonctions relatives aux <em>threads </em>sont incluses dans le fichier d'en-tête <code data-claire-semantic="c">&lt;pthread.h&gt;</code> et dans la bibliothèque <code data-claire-semantic="c">libpthread.a</code> (soit <code data-claire-semantic="console">-lpthread</code> à la compilation).</p><h6 id="r-exemple-135" data-claire-element-id="478334">Exemple :</h6><p id="r-478330" data-claire-element-id="478330">Écrivez la ligne de commande qui vous permet de compiler votre programme sur les <em>threads </em>constitué d'un seul fichier <code data-claire-semantic="c">main.c</code> et avoir en sortie un exécutable nommé <code data-claire-semantic="c">monProgramme</code>.</p><p id="r-478331" data-claire-element-id="478331">Correction :</p><pre id="r-478332" data-claire-element-id="478332"><code data-claire-semantic="console">gcc -lpthread main.c -o monProgramme</code></pre><p id="r-478333" data-claire-element-id="478333">Et n'oubliez pas d'ajouter <code data-claire-semantic="c">#include &lt;pthread.h&gt;</code> au début de vos fichiers.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
<span class="arrow"></span>
<span class="next">Qu&#039;est ce qu&#039;un thread ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
<span class="next">Manipulation des threads</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Manipulationdesthreads"></a><h2>Manipulation des threads</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
<span class="arrow"></span>
<span class="next">Compilation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
<span class="next">Exclusions mutuelles</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-manipulation-des-threads" data-claire-element-id="478368">Manipulation des threads</h4><h5 id="r-creer-un-thread-1" data-claire-element-id="478350">Créer un thread</h5><p id="r-478336" data-claire-element-id="478336">Pour créer un thread, il faut déjà déclarer une variable le représentant. Celle-ci sera de type <code data-claire-semantic="c">pthread_t</code> (qui est, sur la plupart des systèmes, un <code data-claire-semantic="c">typedef</code> d'<code data-claire-semantic="c">unsigned long int</code>).<br/> Ensuite, pour créer la tâche elle-même, il suffit d'utiliser la fonction :</p><pre id="r-478337" data-claire-element-id="478337"><code data-claire-semantic="c">#include &lt;pthread.h&gt;

int pthread_create(pthread_t * thread, pthread_attr_t * attr,
		   void *(*start_routine) (void *), void *arg);</code></pre><p id="r-478338" data-claire-element-id="478338">Ce prototype est un peu compliqué, c'est pourquoi nous allons récapituler ensemble.</p><ul id="r-478349" data-claire-element-id="478349"><li id="r-478340" data-claire-element-id="478340"><p id="r-478339" data-claire-element-id="478339">La fonction renvoie une valeur de type <code data-claire-semantic="c">int</code> : 0 si la création a été réussie ou une autre valeur si il y a eu une erreur.</p></li><li id="r-478342" data-claire-element-id="478342"><p id="r-478341" data-claire-element-id="478341">Le premier argument est un pointeur vers l'identifiant du thread (valeur de type <code data-claire-semantic="c">pthread_t</code>).</p></li><li id="r-478344" data-claire-element-id="478344"><p id="r-478343" data-claire-element-id="478343">Le second argument désigne les attributs du thread. Vous pouvez choisir de mettre le thread en état joignable (par défaut) ou détaché, et choisir sa politique d'ordonnancement (usuelle, temps-réel...). Dans nos exemple, on mettra généralement NULL.</p></li><li id="r-478346" data-claire-element-id="478346"><p id="r-478345" data-claire-element-id="478345">Le troisième argument est un pointeur vers la fonction à exécuter dans le thread. Cette dernière devra être de la forme <code data-claire-semantic="c">void *fonction(void* arg)</code> et contiendra le code à exécuter par le thread.</p></li><li id="r-478348" data-claire-element-id="478348"><p id="r-478347" data-claire-element-id="478347">Enfin, le quatrième et dernier argument est l'argument à passer au thread.</p></li></ul><h5 id="r-supprimer-un-thread" data-claire-element-id="478354">Supprimer un thread</h5><p id="r-478351" data-claire-element-id="478351">Et qui dit créer dit supprimer à la fin de l'utilisation.<br/> Cette fois, ce n'est pas une fonction casse-tête :</p><pre id="r-478352" data-claire-element-id="478352"><code data-claire-semantic="c">#include &lt;pthread.h&gt;

void pthread_exit(void *ret);</code></pre><p id="r-478353" data-claire-element-id="478353">Elle prend en argument la valeur qui doit être retournée par le thread, et doit être placée en dernière position dans la fonction concernée.</p><h5 id="r-premiere-application" data-claire-element-id="478358">Première application</h5><p id="r-478355" data-claire-element-id="478355">Voici un premier code qui réutilise toutes les notions des threads que nous avons vu jusque là.</p><pre id="r-478356" data-claire-element-id="478356"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;pthread.h&gt;

void *thread_1(void *arg)
{
    printf(&quot;Nous sommes dans le thread.\n&quot;);

    /* Pour enlever le warning */
    (void) arg;
    pthread_exit(NULL);
}

int main(void)
{
    pthread_t thread1;

    printf(&quot;Avant la création du thread.\n&quot;);

    if(pthread_create(&amp;thread1, NULL, thread_1, NULL) == -1) {
	perror(&quot;pthread_create&quot;);
	return EXIT_FAILURE;
    }

    printf(&quot;Après la création du thread.\n&quot;);

    return EXIT_SUCCESS;
}</code></pre><p id="r-478357" data-claire-element-id="478357">On compile, on exécute. Et là, zut... Le résultat, dans le meilleur des cas, affiche le message de thread en dernier. Dans le pire des cas, celui-ci ne s'affiche même pas (ce qui veut dire que le <code data-claire-semantic="c">return</code> s'est exécuté avant le thread...).<br/> Ce qui normal, puisqu'en théorie, comme avec les processus, le thread principal ne va pas attendre de lui-même que le thread se termine avant d'exécuter le reste de son code.<br/> Par conséquent, il va falloir lui en faire la demande. :zorro: Pour cela, Dieu pthread a créé la fonction <code data-claire-semantic="c">pthread_join</code>.</p><h5 id="r-attendre-la-fin-d-un-thread" data-claire-element-id="478362">Attendre la fin d'un thread</h5><p id="r-478359" data-claire-element-id="478359">Voici le prototype de cette fameuse fonction :</p><pre id="r-478360" data-claire-element-id="478360"><code data-claire-semantic="c">#include &lt;pthread.h&gt;

int pthread_join(pthread_t th, void **thread_return);</code></pre><p id="r-478361" data-claire-element-id="478361">Elle prend donc en paramètre l'identifiant du thread et son second paramètre, un pointeur, permet de récupérer la valeur retournée par la fonction dans laquelle s'exécute le thread (c'est-à-dire l'argument de <code data-claire-semantic="c">pthread_exit</code>).</p><h5 id="r-exercice-resume" data-claire-element-id="478367">Exercice résumé</h5><p id="r-478363" data-claire-element-id="478363">Écrivez un programme qui crée un thread demandant un nombre à l'utilisateur, l'incrémentant une fois puis l'affichant dans le main.</p><pre id="r-478364" data-claire-element-id="478364"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;pthread.h&gt;

void *thread_1(void *arg)
{
    printf(&quot;Nous sommes dans le thread.\n&quot;);

    /* Pour enlever le warning */
    (void) arg;
    pthread_exit(NULL);
}

int main(void)
{
    pthread_t thread1;

    printf(&quot;Avant la création du thread.\n&quot;);

    if (pthread_create(&amp;thread1, NULL, thread_1, NULL)) {
	perror(&quot;pthread_create&quot;);
	return EXIT_FAILURE;
    }

    if (pthread_join(thread1, NULL)) {
	perror(&quot;pthread_join&quot;);
	return EXIT_FAILURE;
    }

    printf(&quot;Après la création du thread.\n&quot;);

    return EXIT_SUCCESS;
}</code></pre><p id="r-478365" data-claire-element-id="478365">Et le résultat est enfin uniforme :</p><pre id="r-478366" data-claire-element-id="478366"><code data-claire-semantic="console">Avant la création du thread.
Nous sommes dans le thread.
Après la création du thread.</code></pre>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
<span class="arrow"></span>
<span class="next">Compilation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
<span class="next">Exclusions mutuelles</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Exclusionsmutuelles"></a><h2>Exclusions mutuelles</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
<span class="arrow"></span>
<span class="next">Manipulation des threads</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
<span class="next">Les conditions</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-exclusions-mutuelles" data-claire-element-id="478389">Exclusions mutuelles</h4><h5 id="r-problematique-3" data-claire-element-id="478370">Problématique</h5><p id="r-478369" data-claire-element-id="478369">Avec les threads, toutes les variables sont partagées : c'est la <strong>mémoire partagée</strong>.<br/> Mais cela pose des problèmes. En effet, quand deux threads cherchent à modifier deux variables en même temps, que se passe-t-il ? Et si un thread lit une variable quand un autre thread la modifie ?<br/> C'est assez problématique. Par conséquent, nous allons voir une mécanisme de synchronisation : les <strong>mutex</strong>, un des outils permettant l'<strong>exclusion mutuelle</strong>.</p><h5 id="r-les-mutex-3" data-claire-element-id="478376">Les mutex</h5><p id="r-478371" data-claire-element-id="478371">Concrètement, un <strong>mutex</strong> est en C une variable de type <code data-claire-semantic="c">pthread_mutex_t</code>. Elle va nous servir de verrou, pour nous permettre de protéger des données. Ce verrou peut donc prendre deux états : <strong>disponible</strong> et <strong>verrouillé</strong>. <br/> Quand un thread a accès à une variable protégée par un mutex, on dit qu'<em>il tient le mutex</em>. Bien évidemment, il ne peut y avoir qu'un seul thread qui tient le mutex en même temps.</p><p id="r-478372" data-claire-element-id="478372">Le problème, c'est qu'il faut que le mutex soit accessible en même temps que la variable et dans tout le fichier (vu que différents threads s'exécutent dans différentes fonctions). La solution la plus simple consiste à déclarer les mutex en variable globale. Mais nous ne sommes pas des barbares ! :pirate: Par conséquent, j'ai choisi de vous montrer une autre solution : déclarer le mutex dans une structure avec la donnée à protéger.<br/> Allez, un petit exemple ne vous fera pas de mal :</p><pre id="r-478373" data-claire-element-id="478373"><code data-claire-semantic="c">typedef struct data {
    int var;
    pthread_mutex_t mutex;
} data;</code></pre><p id="r-478374" data-claire-element-id="478374">Ainsi, nous pourrons passer la structure en paramètre à nos threads, grâce à la fonction <code data-claire-semantic="c">pthread_create</code>. ;)</p><p id="r-478375" data-claire-element-id="478375">Passons à la pratique : comment manipuler les mutex grâce à pthread ?</p><h5 id="r-initialiser-un-mutex" data-claire-element-id="478379">Initialiser un mutex</h5><p id="r-478377" data-claire-element-id="478377">Conventionnellement, on initialise un mutex avec la valeur de la constante PTHREAD_MUTEX_INITIALIZER, déclarée dans <code data-claire-semantic="c">pthread.h</code>.</p><pre id="r-478378" data-claire-element-id="478378"><code data-claire-semantic="c">#include &lt;stdlib.h&gt;
#include &lt;pthread.h&gt;

typedef struct data {
    int var;
    pthread_mutex_t mutex;
} data;

int main(void)
{
    data new_data;

    new_data.mutex = PTHREAD_MUTEX_INITIALIZER;

    return EXIT_SUCCESS;
}</code></pre><h5 id="r-verrouiller-un-mutex" data-claire-element-id="478382">Verrouiller un mutex</h5><p id="r-478380" data-claire-element-id="478380">L'étape suivante consiste à établir une <strong>zone critique</strong>, c'est-à-dire la zone où plusieurs threads ont l'occasion de modifier ou de lire une même variable en même temps.<br/> Une fois cela fait, on verrouille le mutex grâce à la fonction :</p><pre id="r-478381" data-claire-element-id="478381"><code data-claire-semantic="c">#include &lt;pthread.h&gt;

int pthread_mutex_lock(pthread_mutex_t *mut);</code></pre><h5 id="r-deverrouiller-un-mutex" data-claire-element-id="478385">Déverrouiller un mutex</h5><p id="r-478383" data-claire-element-id="478383">A la fin de la zone critique, il suffit de déverrouiller le mutex.</p><pre id="r-478384" data-claire-element-id="478384"><code data-claire-semantic="c">#include &lt;pthread.h&gt;

int pthread_mutex_unlock(pthread_mutex_t *mut);</code></pre><h5 id="r-detruire-un-mutex" data-claire-element-id="478388">Détruire un mutex</h5><p id="r-478386" data-claire-element-id="478386">Une fois le travail du mutex terminé, on peut le détruire :</p><pre id="r-478387" data-claire-element-id="478387"><code data-claire-semantic="c">#include &lt;pthread.h&gt;

int pthread_mutex_destroy(pthread_mutex_t *mut);</code></pre>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
<span class="arrow"></span>
<span class="next">Manipulation des threads</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
<span class="next">Les conditions</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesconditions"></a><h2>Les conditions</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
<span class="arrow"></span>
<span class="next">Exclusions mutuelles</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">
<span class="next">Les tubes</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-conditions-27" data-claire-element-id="478423">Les conditions</h4><p id="r-478390" data-claire-element-id="478390">Lorsqu'un <em>thread </em>doit patienter jusqu'à ce qu'un événement survienne dans un autre <em>thread</em>, on emploie une technique appelée la condition.</p><p id="r-478391" data-claire-element-id="478391">Quand un <em>thread </em>est en attente d'une condition, il reste bloqué tant que celle-ci n'est pas réalisée par un autre <em>thread</em>.</p><p id="r-478392" data-claire-element-id="478392">Comme avec les <em>mutex</em>, on déclare la condition en variable globale, de cette manière :</p><pre id="r-478393" data-claire-element-id="478393"><code data-claire-semantic="c">pthread_cond_t nomCondition = PTHREAD_COND_INITIALIZER;</code></pre><p id="r-478394" data-claire-element-id="478394">Pour attendre une condition, il faut utiliser un <em>mutex </em>:</p><pre id="r-478395" data-claire-element-id="478395"><code data-claire-semantic="c">int pthread_cond_wait(pthread_cond_t *nomCondition, pthread_mutex_t *nomMutex);</code></pre><p id="r-478396" data-claire-element-id="478396">Pour réveiller un <em>thread </em>en attente d'une condition, on utilise la fonction :</p><pre id="r-478397" data-claire-element-id="478397"><code data-claire-semantic="c">int pthread_cond_signal(pthread_cond_t *nomCondition);</code></pre><h6 id="r-exemple-136" data-claire-element-id="478422">Exemple :</h6><p id="r-478398" data-claire-element-id="478398">Créez un code qui crée deux <em>threads </em>: un qui incrémente une variable compteur par un nombre tiré au hasard entre 0 et 10, et l'autre qui affiche un message lorsque la variable compteur dépasse 20.</p><p id="r-478399" data-claire-element-id="478399">Correction :</p><pre id="r-478400" data-claire-element-id="478400"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;pthread.h&gt;

pthread_cond_t condition = PTHREAD_COND_INITIALIZER; /* Création de la condition */
pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER; /* Création du mutex */

void* threadAlarme (void* arg);
void* threadCompteur (void* arg);

int main (void)
{
	pthread_t monThreadCompteur;
	pthread_t monThreadAlarme;

	pthread_create (&amp;monThreadCompteur, NULL, threadCompteur, (void*)NULL);
	pthread_create (&amp;monThreadAlarme, NULL, threadAlarme, (void*)NULL); /* Création des threads */

	pthread_join (monThreadCompteur, NULL);
	pthread_join (monThreadAlarme, NULL); /* Attente de la fin des threads */

	return 0;
}

void* threadCompteur (void* arg)
{
	int compteur = 0, nombre = 0;
	
	srand(time(NULL));

	while(1) /* Boucle infinie */
	{
		nombre = rand()%10; /* On tire un nombre entre 0 et 10 */
		compteur += nombre; /* On ajoute ce nombre à la variable compteur */

		printf(&quot;\n%d&quot;, compteur);
		
		if(compteur &gt;= 20) /* Si compteur est plus grand ou égal à 20 */
		{
			pthread_mutex_lock (&amp;mutex); /* On verrouille le mutex */
			pthread_cond_signal (&amp;condition); /* On délivre le signal : condition remplie */
			pthread_mutex_unlock (&amp;mutex); /* On déverrouille le mutex */

			compteur = 0; /* On remet la variable compteur à 0 */
		}

		sleep (1); /* On laisse 1 seconde de repos */
	}
	
	pthread_exit(NULL); /* Fin du thread */
}

void* threadAlarme (void* arg)
{
	while(1) /* Boucle infinie */
	{
		pthread_mutex_lock(&amp;mutex); /* On verrouille le mutex */
		pthread_cond_wait (&amp;condition, &amp;mutex); /* On attend que la condition soit remplie */
		printf(&quot;\nLE COMPTEUR A DÉPASSÉ 20.&quot;); 
		pthread_mutex_unlock(&amp;mutex); /* On déverrouille le mutex */
	}
	
	pthread_exit(NULL); /* Fin du thread */
}</code></pre><p id="r-478401" data-claire-element-id="478401">Résultat :</p><pre id="r-478402" data-claire-element-id="478402"><code data-claire-semantic="console">lucas@lucas-Deskstop:~/Documents$ ./monprog 

4
9
18
26
LE COMPTEUR A DÉPASSÉ 20.
9
18
23
LE COMPTEUR A DÉPASSÉ 20.
0
3
5
9
12
19
23
LE COMPTEUR A DÉPASSÉ 20.
0
8
9
10
17
25
LE COMPTEUR A DÉPASSÉ 20.
2
10
10
16
25
LE COMPTEUR A DÉPASSÉ 20.
8
10
18
26
LE COMPTEUR A DÉPASSÉ 20.
0
7
9
^C</code></pre><p id="r-478403" data-claire-element-id="478403">Terminons ce chapitre par quelques moyen mnémotechniques qui peuvent vous permettre de retenir toutes les notions que l'on a apprises :</p><ul id="r-478420" data-claire-element-id="478420"><li id="r-478405" data-claire-element-id="478405"><p id="r-478404" data-claire-element-id="478404">Vous pouvez remarquer que toutes les variables et les fonctions sur les threads commencent par <strong>pthread_</strong></p></li><li id="r-478407" data-claire-element-id="478407"><p id="r-478406" data-claire-element-id="478406">pthread_create : <em>create</em> = <em>créer</em> en anglais (donc <em>créer le thread)</em></p></li><li id="r-478409" data-claire-element-id="478409"><p id="r-478408" data-claire-element-id="478408">pthread_exit : <em>exit</em> = <em>sortir</em> (donc <em>sortir du thread</em>)</p></li><li id="r-478411" data-claire-element-id="478411"><p id="r-478410" data-claire-element-id="478410">pthread_join : <em>join</em> = <em>joindre</em> (donc<em> joindre le thread</em>)</p></li><li id="r-478413" data-claire-element-id="478413"><p id="r-478412" data-claire-element-id="478412">PTHREAD_MUTEX_INITIALIZER : <em>initializer</em> = <em>initialiser</em> (donc <em>initialiser le mutex</em>)</p></li><li id="r-478415" data-claire-element-id="478415"><p id="r-478414" data-claire-element-id="478414">pthread_mutex_lock : <em>lock</em> = <em>vérouiller</em> (donc <em>vérouiller le mutex</em>)</p></li><li id="r-478417" data-claire-element-id="478417"><p id="r-478416" data-claire-element-id="478416">pthread_mutex_unlock : <em>unlock</em> = <em>dévérouiller</em> (donc <em>dévérouiller le mutex</em>)</p></li><li id="r-478419" data-claire-element-id="478419"><p id="r-478418" data-claire-element-id="478418">pthread_cond_wait : <em>wait </em>= <em>attendre </em>(donc <em>attendre la condition</em>)</p></li></ul><p id="r-478421" data-claire-element-id="478421">(Comme quoi l'anglais ça sert des fois :p )</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
<span class="arrow"></span>
<span class="next">Exclusions mutuelles</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">
<span class="next">Les tubes</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lestubes"></a><h2>Les tubes</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
<span class="arrow"></span>
<span class="next">Les conditions</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
<span class="next">Qu&#039;est ce qu&#039;un tube ?</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-478425" data-claire-element-id="478425">Dans ce cinquième chapitre, nous allons découvrir comment communiquer entre processus, et avec cela une nouvelle notion : les <strong>tubes</strong>.</p>
</div><a name="Qu039estcequ039untube"></a><h2>Qu&#039;est ce qu&#039;un tube ?</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">
<span class="arrow"></span>
<span class="next">Les tubes</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
<span class="next">Manipuler les tubes</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-qu-est-ce-qu-un-tube" data-claire-element-id="478439">Qu'est ce qu'un tube ?</h4><h5 id="r-definition-69" data-claire-element-id="478427">Définition</h5><p id="r-478426" data-claire-element-id="478426">Un <strong>tube</strong> (en anglais <em>pipe</em>) peut être représenté comme un tuyau (imaginaire, bien sûr ! ;) ) dans lequel circulent des informations.</p><h5 id="r-utilite-13" data-claire-element-id="478429">Utilité</h5><p id="r-478428" data-claire-element-id="478428">Les tubes servent à faire communiquer plusieurs processus entre eux.</p><h5 id="r-vocabulaire-3" data-claire-element-id="478438">Vocabulaire</h5><p id="r-478430" data-claire-element-id="478430">On distingue alors les deux processus par leur action :</p><ul id="r-478435" data-claire-element-id="478435"><li id="r-478432" data-claire-element-id="478432"><p id="r-478431" data-claire-element-id="478431">Un écrit des informations dans le tube. Celui-ci est appelé <strong>entrée</strong> du tube ;</p></li><li id="r-478434" data-claire-element-id="478434"><p id="r-478433" data-claire-element-id="478433">L'autre lit les informations dans le tube. Il est nommé <strong>sortie</strong> du tube.</p></li></ul><aside id="r-478437" data-claire-element-id="478437" data-claire-semantic="warning"><p id="r-478436" data-claire-element-id="478436">Le processus qui écrit ne peut pas lire des informations, et inversement. Il faut donc créer deux tubes si on veut que les processus établissent réellement un dialogue.</p></aside>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">
<span class="arrow"></span>
<span class="next">Les tubes</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
<span class="next">Manipuler les tubes</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Manipulerlestubes"></a><h2>Manipuler les tubes</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
<span class="arrow"></span>
<span class="next">Qu&#039;est ce qu&#039;un tube ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
<span class="next">Pratique</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-manipuler-les-tubes" data-claire-element-id="478474">Manipuler les tubes</h4><h5 id="r-creer" data-claire-element-id="478454">Créer</h5><p id="r-478440" data-claire-element-id="478440">Pour commencer, il nous faudrait créer le tube. Pour cela, on utilise la fonction :</p><pre id="r-478441" data-claire-element-id="478441"><code data-claire-semantic="c">int pipe(int descripteur[2]);</code></pre><p id="r-478442" data-claire-element-id="478442">Voici ses caractéristiques :</p><ul id="r-478452" data-claire-element-id="478452"><li id="r-478444" data-claire-element-id="478444"><p id="r-478443" data-claire-element-id="478443">Elle renvoie une valeur de type <code data-claire-semantic="c">int</code>, qui est de <code data-claire-semantic="c">0</code> si elle réussit, ou une autre valeur dans le cas contraire.</p></li><li id="r-478451" data-claire-element-id="478451"><p id="r-478445" data-claire-element-id="478445">Elle prend en argument un tableau de <code data-claire-semantic="c">int</code>, comprenant :</p><ul id="r-478450" data-claire-element-id="478450"><li id="r-478447" data-claire-element-id="478447"><p id="r-478446" data-claire-element-id="478446"><code data-claire-semantic="c">descripteur[0]</code>: désigne la sortie du tube ;</p></li><li id="r-478449" data-claire-element-id="478449"><p id="r-478448" data-claire-element-id="478448"><code data-claire-semantic="c">descripteur[1]</code> : désigne l'entrée du tube.</p></li></ul></li></ul><p id="r-478453" data-claire-element-id="478453">Mais là, nous devons faire face à notre premier problème. En effet, on ne crée le tube que dans un seul processus. L'autre ne peut donc pas en connaître l'entrée ou la sortie !<br/> En conséquence, il faut utiliser <code data-claire-semantic="c">pipe</code>avant d'utiliser <code data-claire-semantic="c">fork</code>. Ensuite, le père et le fils auront les mêmes valeurs dans leur tableau <code data-claire-semantic="c">descripteur</code>, et pourront donc communiquer.</p><h5 id="r-ecrire-3" data-claire-element-id="478460">Écrire</h5><p id="r-478455" data-claire-element-id="478455">Pour écrire dans un tube :</p><pre id="r-478456" data-claire-element-id="478456"><code data-claire-semantic="c">ssize_t write(int entreeTube, const void *elementAEcrire, size_t nombreOctetsAEcrire);</code></pre><p id="r-478457" data-claire-element-id="478457">La fonction prend en paramètre l'<strong>entrée du tube</strong> (on lui enverra <code data-claire-semantic="c">descripteur[1]</code>), un <strong>pointeur générique vers la mémoire contenant l'élément à écrire</strong> (hummm, ça rappelle des souvenirs, non ? ^^ ) ainsi que le <strong>nombre d'octets de cet élément</strong>. Elle renvoie une valeur de type <code data-claire-semantic="c">ssize_t</code> correspondant au nombre d'octets effectivement écrits.</p><p id="r-478458" data-claire-element-id="478458">Exemple : Pour écrire le message &quot;Bonjour&quot; dans un tube, depuis le père :</p><pre id="r-478459" data-claire-element-id="478459"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/wait.h&gt;

#define TAILLE_MESSAGE 256 /* Correspond à la taille de la chaîne à écrire */

int main(void)
{
    pid_t pid_fils;
    int descripteurTube[2];

    char messageEcrire[TAILLE_MESSAGE];

    pipe(descripteurTube);

    pid_fils = fork();

    if(pid_fils != 0) /* Processus père */
    {
        sprintf(messageEcrire, &quot;Bonjour, fils. Je suis ton père !&quot;); /* La fonction sprintf permet de remplir une chaîne de caractère avec un texte donné */
        write(descripteurTube[1], messageEcrire, TAILLE_MESSAGE);
    }

    return EXIT_SUCCESS;
}</code></pre><h5 id="r-lire-2" data-claire-element-id="478466">Lire</h5><p id="r-478461" data-claire-element-id="478461">Et pour lire dans un tube :</p><pre id="r-478462" data-claire-element-id="478462"><code data-claire-semantic="c">ssize_t read(int sortieTube, void *elementALire, size_t nombreOctetsALire);</code></pre><p id="r-478463" data-claire-element-id="478463">La fonction prend en paramètre la <strong>sortie du tube</strong> (ce qui correspond à... descripteur[0]), un <strong>pointeur vers la mémoire contenant l'élément à lire</strong> et le <strong>nombre d'octets de cet élément</strong>. Elle renvoie une valeur de type <code data-claire-semantic="c">ssize_t</code> qui correspond au nombre d'octets effectivement lus. On pourra ainsi comparer le troisième paramètre (<code data-claire-semantic="c">nombreOctetsALire</code>) à la valeur renvoyée pour vérifier qu'il n'y a pas eu d'erreurs.</p><p id="r-478464" data-claire-element-id="478464">Exemple : Pour lire un message envoyé par le père à un fils :</p><pre id="r-478465" data-claire-element-id="478465"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/wait.h&gt;

#define TAILLE_MESSAGE 256 /* Correspond à la taille de la chaîne à lire */

int main(void)
{
    pid_t pid_fils;
    int descripteurTube[2];
    char messageLire[TAILLE_MESSAGE];

    pipe(descripteurTube);

    pid_fils = fork();

    if(pid_fils == 0) /* Processus fils */
    {
        read(descripteurTube[0], messageLire, TAILLE_MESSAGE);
        printf(&quot;Message reçu = \&quot;%s\&quot;&quot;, messageLire);
    }

    return EXIT_SUCESS;
}</code></pre><h5 id="r-fermer" data-claire-element-id="478473">Fermer</h5><p id="r-478467" data-claire-element-id="478467">Lorsque nous utilisons un tube pour faire communiquer deux processus, il est important de fermer l'entrée du tube qui lit et la sortie du tube qui écrit. <br/> En effet, il faut que le noyau voie qu'il n'y a plus de processus disposant d'un descripteur sur l'entrée du tube. Ainsi, dès qu'un processus tentera de lire à nouveau, il lui enverra <code data-claire-semantic="c">EOF</code> (fin de fichier).</p><p id="r-478468" data-claire-element-id="478468">Pour fermer une entrée ou une sortie :</p><pre id="r-478469" data-claire-element-id="478469"><code data-claire-semantic="c">int close(int descripteur);</code></pre><p id="r-478470" data-claire-element-id="478470">La valeur prise en paramètre correspond au descripteur de l'entrée ou de la sortie à fermer.</p><p id="r-478471" data-claire-element-id="478471">Exemple : Pour fermer l'entrée du processus fils et la sortie du processus père :</p><pre id="r-478472" data-claire-element-id="478472"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

int main(void)
{
    pid_t pid_fils;
    int descripteurTube[2];

    pipe(descripteurTube);

    pid_fils = fork();
	
    if(pid_fils == 0) /* Processus fils */
        close(descripteurTube[1]);

    else /* Processus père */
	close(descripteurTube[0]);

    return EXIT_SUCESS;
}</code></pre>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
<span class="arrow"></span>
<span class="next">Qu&#039;est ce qu&#039;un tube ?</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
<span class="next">Pratique</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Pratique"></a><h2>Pratique</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
<span class="arrow"></span>
<span class="next">Manipuler les tubes</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
<span class="next">Notions complémentaires sur les tubes</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-pratique-13" data-claire-element-id="478481">Pratique</h4><p id="r-478475" data-claire-element-id="478475">On passe à la pratique.</p><p id="r-478476" data-claire-element-id="478476">Écrivez un programme qui crée deux processus : le père écrit le message « Bonjour, fils. Je suis ton père ! ». Le fils le récupère, puis l'affiche.</p><p id="r-478477" data-claire-element-id="478477">Correction :</p><pre id="r-478478" data-claire-element-id="478478"><code data-claire-semantic="c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/wait.h&gt;

#define TAILLE_MESSAGE 256 /* Correspond à la taille de la chaîne à lire et à écrire */

int main(void)
{
    pid_t pid_fils;
    int descripteurTube[2];

    unsigned char messageLire[TAILLE_MESSAGE], messageEcrire[TAILLE_MESSAGE];

    printf(&quot;Création du tube.\n&quot;);
    
    if(pipe(descripteurTube) != 0)
    {
        fprintf(stderr, &quot;Erreur de création du tube.\n&quot;);
        return EXIT_FAILURE;
    }

    pid_fils = fork();

    if(pid_fils == -1)    
    {
        fprintf(stderr, &quot;Erreur de création du processus.\n&quot;);
        return 1;
    }

    if(pid_fils == 0)
    {
        printf(&quot;Fermeture de l'entrée dans le fils.\n\n&quot;);
        close(descripteurTube[1]);
        
        read(descripteurTube[0], messageLire, TAILLE_MESSAGE);
        printf(&quot;Nous sommes dans le fils (pid = %d).\nIl a reçu le message suivant du père : \&quot;%s\&quot;.\n\n\n&quot;, getpid(), messageLire);
    }

    else
    {
        printf(&quot;\nFermeture de la sortie dans le père.\n&quot;);
        close(descripteurTube[0]);

        sprintf(messageEcrire, &quot;Bonjour, fils. Je suis ton père !&quot;);

        printf(&quot;Nous sommes dans le père (pid = %d).\nIl envoie le message suivant au fils : \&quot;%s\&quot;.\n\n\n&quot;, getpid(), messageEcrire);

        write(descripteurTube[1], messageEcrire, TAILLE_MESSAGE);

        wait(NULL);
    }

    return 0;
}</code></pre><p id="r-478479" data-claire-element-id="478479">Résultat :</p><pre id="r-478480" data-claire-element-id="478480"><code data-claire-semantic="console">Création du tube.

Fermeture de la sortie dans le père.
Fermeture de l'entrée dans le fils.

Nous sommes dans le père (pid = 2584).
Il envoie le message suivant au fils : &quot;Bonjour, fils. Je suis ton père !&quot;.


Nous sommes dans le fils (pid = 2585).
Il a reçu le message suivant du père : &quot;Bonjour, fils. Je suis ton père !&quot;.</code></pre>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
<span class="arrow"></span>
<span class="next">Manipuler les tubes</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
<span class="next">Notions complémentaires sur les tubes</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Notionscomplmentairessurlestubes"></a><h2>Notions complémentaires sur les tubes</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
<span class="arrow"></span>
<span class="next">Pratique</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-notions-complementaires-sur-les-tubes" data-claire-element-id="478580">Notions complémentaires sur les tubes</h4><h5 id="r-entrees-sorties-et-tubes" data-claire-element-id="478505">Entrées/Sorties et tubes</h5><p id="r-478482" data-claire-element-id="478482">On peut lier la sortie d'un tube à <code data-claire-semantic="c">stdin</code> ou l'entrée d'un tube à <code data-claire-semantic="c">stdout</code>. Ensuite :</p><ul id="r-478487" data-claire-element-id="478487"><li id="r-478484" data-claire-element-id="478484"><p id="r-478483" data-claire-element-id="478483">Dans le premier cas : toutes les informations qui sortent du tube arrivent dans le flot d'entrée standard et peuvent être lues avec <code data-claire-semantic="c">scanf</code>, <code data-claire-semantic="c">fgets</code>, etc...</p></li><li id="r-478486" data-claire-element-id="478486"><p id="r-478485" data-claire-element-id="478485">Dans le second cas : toutes les informations qui sortent par <code data-claire-semantic="c">stdout</code> sont écrites dans le tube. On peut utiliser <code data-claire-semantic="c">printf</code>, <code data-claire-semantic="c">puts</code>, etc...</p></li></ul><p id="r-478488" data-claire-element-id="478488">Pour faire cela, il suffit d'utiliser la fonction :</p><pre id="r-478489" data-claire-element-id="478489"><code data-claire-semantic="c">int dup2(int ancienDescripteur, int nouveauDescripteur);</code></pre><p id="r-478490" data-claire-element-id="478490">Le premier paramètre est facilement compréhensible, on lui enverra :</p><ul id="r-478495" data-claire-element-id="478495"><li id="r-478492" data-claire-element-id="478492"><p id="r-478491" data-claire-element-id="478491"><code data-claire-semantic="c">descripteur[0]</code> si on veut lier la sortie ;</p></li><li id="r-478494" data-claire-element-id="478494"><p id="r-478493" data-claire-element-id="478493"><code data-claire-semantic="c">descripteur[1]</code> si on veut lier l'entrée.</p></li></ul><p id="r-478496" data-claire-element-id="478496">Le second paramètre correspond au nouveau descripteur que l'on veut lier au tube.<br/> Il existe deux constantes, déclarées dans unistd.h :</p><ul id="r-478501" data-claire-element-id="478501"><li id="r-478498" data-claire-element-id="478498"><p id="r-478497" data-claire-element-id="478497"><code data-claire-semantic="c">STDIN_FILENO</code> ;</p></li><li id="r-478500" data-claire-element-id="478500"><p id="r-478499" data-claire-element-id="478499"><code data-claire-semantic="c">STDOUT_FILENO</code>.</p></li></ul><p id="r-478502" data-claire-element-id="478502">On utilise <code data-claire-semantic="c">STDIN_FILENO</code> lorsqu'on veut lier la sortie à <code data-claire-semantic="c">stdin</code>, et <code data-claire-semantic="c">STDOUT_FILENO</code>lorsqu'on veut lier l'entrée à <code data-claire-semantic="c">stdout</code>.</p><p id="r-478503" data-claire-element-id="478503">Exemple : Si on veut lier l'entrée d'un tube d'entrée et de sortie définies dans un tableau descripteur à <code data-claire-semantic="c">stdout</code> :</p><pre id="r-478504" data-claire-element-id="478504"><code data-claire-semantic="c">dup2(tube[1], STDOUT_FILENO);</code></pre><h5 id="r-tubes-nommes" data-claire-element-id="478579">Tubes nommés</h5><p id="r-478506" data-claire-element-id="478506">Cependant, un problème se pose avec l'utilisation des tubes classiques. En effet, il faut obligatoirement que les processus connaissent le processus qui a créé le tube. Avec les tubes tout simples, il n'est pas possible de lancer des programmes indépendants, puis qu'ils établissent un dialogue.</p><p id="r-478507" data-claire-element-id="478507">C'est pourquoi on a créé une &quot;extension&quot; des tubes, appelée &quot;<strong>tube nommé</strong>&quot; (<em>named pipe</em>). Son concept est assez simple : comme son nom l'indique, le tube dispose d'un nom dans le système de fichier. Il suffit qu'un processus l'appelle par son nom, et hop, il accourt pour laisser le processus lire ou écrire en son intérieur. Sympa, hein ! :p</p><h6 id="r-creer-1" data-claire-element-id="478542">Créer</h6><p id="r-478508" data-claire-element-id="478508">Pour commencer, il faut créer le tube. Concrètement, nous allons créer un fichier.</p><p id="r-478509" data-claire-element-id="478509">Pour créer un tube nommé, on utilise la fonction <code data-claire-semantic="c">mkfifo</code>, dont voici le prototype :</p><pre id="r-478510" data-claire-element-id="478510"><code data-claire-semantic="c">int mkfifo (const char* nom, mode_t mode);</code></pre><p id="r-478511" data-claire-element-id="478511">Le premier argument est le nom du tube nommé. On donne généralement l'extension « .fifo » au nom du tube nommé. Ne vous souciez pas pour l'instant de savoir à quoi correspond ce nom bizarre, vous le saurez en temps voulu. <br/> Voici un exemple de nom pour un tube : « <em>essai.fifo</em> ».</p><p id="r-478512" data-claire-element-id="478512">Bon, jusque là pas de gros problèmes. En revanche, vous allez peut-être regretter d'avoir connu le deuxième paramètre... :p En fait, il s'agit concrètement des droits d'accès du tube.</p><div id="r-478514" data-claire-element-id="478514" data-claire-semantic="question"><p id="r-478513" data-claire-element-id="478513">Euh... Et on est sensé trouver ça où ? o_O</p></div><p id="r-478515" data-claire-element-id="478515">Deux solutions :</p><ul id="r-478520" data-claire-element-id="478520"><li id="r-478517" data-claire-element-id="478517"><p id="r-478516" data-claire-element-id="478516">La première, c'est de lire la <a href="http://pubs.opengroup.org/onlinepubs/007908799/xsh/sysstat.h.html">documentation du fichier <code data-claire-semantic="c">sys/stat.h</code></a>. Eh oui, c'est en anglais ! :diable: Rendez-vous dans la section « File mode bits ». Vous y trouverez des constantes correspondant aux droits d'accès (<code data-claire-semantic="c">S_IRUSR</code>, <code data-claire-semantic="c">S_IWUSR</code>...). Vous pouvez combiner ces constantes avec le symbole « <code data-claire-semantic="c">|</code> ».</p></li><li id="r-478519" data-claire-element-id="478519"><p id="r-478518" data-claire-element-id="478518">Deuxième solution, pour les allergiques à l'anglais et pour ceux qui savent faire des additions : fabriquer des valeurs de droits tout seul, comme des grands ! :D <br/> Les valeurs des droits comprennent quatre chiffres, sont sous mode octal : elles commencent donc par un zéro. Le premier chiffre correspond au propriétaire (vous en l'occurrence), le deuxième correspond au groupe du propriétaire (<a href="http://www.siteduzero.com/tutoriel-3-385547-les-processus.html#ss_part_2">Souvenir, souvenir !</a> ^^ ) et le troisième correspond à tous les autres. Une valeur est attribuée à chaque permission : 1 pour l'exécution, 2 pour l'écriture et 4 pour la lecture. On fait une somme quand on veut combiner plusieurs permissions. Bon, un petit exemple, parce que je sens que vous n'avez pas tout compris ( :lol: ) :<br/> Pour attribuer toutes les permissions à vous, seule la lecture pour le groupe, et aucune pour les autres, la valeur correspondante est 0720 (Premier chiffre = 0 (obligatoire) ; Deuxième chiffre = 1 (Exécution) + 2 (Ecriture) + 4 (Lecture) ; Troisième chiffre = 0 (aucune permission)).</p></li></ul><p id="r-478521" data-claire-element-id="478521">Ouf ! Tout ça pour un petit paramètre... :-°</p><p id="r-478522" data-claire-element-id="478522">Enfin, dernière petite ( :-° ) chose : la fonction renvoie 0 si elle réussit, ou -1 en cas d'erreur. Vous pouvez aussi consulter la variable <code data-claire-semantic="c">errno</code>, qui peut contenir :</p><ul id="r-478533" data-claire-element-id="478533"><li id="r-478524" data-claire-element-id="478524"><p id="r-478523" data-claire-element-id="478523"><strong>EACCES</strong> : le programme n'a pas les droits suffisants pour accéder au chemin de création du tube nommé ;</p></li><li id="r-478526" data-claire-element-id="478526"><p id="r-478525" data-claire-element-id="478525"><strong>EEXIST</strong> : le tube nommé existe déjà ;</p></li><li id="r-478528" data-claire-element-id="478528"><p id="r-478527" data-claire-element-id="478527"><strong>ENAMETOOLONG</strong> : dépassement de la limitation en taille du nom de fichier (assez rare ^^ ) ;</p></li><li id="r-478530" data-claire-element-id="478530"><p id="r-478529" data-claire-element-id="478529"><strong>ENOENT</strong> : le chemin du tube nommé n'existe pas ;</p></li><li id="r-478532" data-claire-element-id="478532"><p id="r-478531" data-claire-element-id="478531"><strong>ENOSPC</strong> : il n'y a plus assez de place sur le système de fichiers.</p></li></ul><p id="r-478534" data-claire-element-id="478534">Comme vous pouvez le voir, il y a beaucoup de constantes possibles, donc généralement on ne les utilise pas dans un programme classique. Mais cela peut servir si votre programme ne marche pas très bien.</p><p id="r-478535" data-claire-element-id="478535">Bon, un petit exercice :</p><p id="r-478536" data-claire-element-id="478536">Créez un tube nommé que vous appellerez « <em>essai</em> », dont vous vous aurez toutes les permissions, dont le groupe aura les permissions de lecture et d'écriture et dont les autres n'auront aucun droits.</p><p id="r-478537" data-claire-element-id="478537">Deux solutions de possibles, pour chacune présentées pour les droits d'accès :</p><p id="r-478538" data-claire-element-id="478538">1)</p><pre id="r-478539" data-claire-element-id="478539"><code data-claire-semantic="c">if (mkfifo((&quot;essai.fifo&quot;), S_IRWXU | S_IRGRP | S_IWGRP) == -1)
{
	fprintf(stderr, &quot;Erreur de création du tube&quot;);
	exit(EXIT_FAILURE);
}</code></pre><p id="r-478540" data-claire-element-id="478540">2)</p><pre id="r-478541" data-claire-element-id="478541"><code data-claire-semantic="c">if (mkfifo((&quot;essai.fifo&quot;), 0760) == -1)
{
	fprintf(stderr, &quot;Erreur de création du tube&quot;);
	exit(EXIT_FAILURE);
}</code></pre><h6 id="r-ouvrir" data-claire-element-id="478578">Ouvrir</h6><p id="r-478543" data-claire-element-id="478543">Ensuite, il faut ouvrir l'entrée/la sortie du tube avec la fonction <code data-claire-semantic="c">open</code> :</p><pre id="r-478544" data-claire-element-id="478544"><code data-claire-semantic="c">int open (const char* cheminFichier, int options);</code></pre><p id="r-478545" data-claire-element-id="478545">La fonction renvoie une valeur de type <code data-claire-semantic="c">int</code> que l'on attribue à l'extrémité du tube en question. <br/> Le premier argument est le nom du fichier (on mettra le nom du tube nommé, bien évidemment).<br/> Le second argument indique si c'est l'entrée ou la sortie du tube. Il existe deux constantes pour cela, déclarées dans <code data-claire-semantic="c">fcntl.h</code> :</p><ul id="r-478550" data-claire-element-id="478550"><li id="r-478547" data-claire-element-id="478547"><p id="r-478546" data-claire-element-id="478546"><code data-claire-semantic="c">O_WRONLY</code> : pour l'entrée ;</p></li><li id="r-478549" data-claire-element-id="478549"><p id="r-478548" data-claire-element-id="478548"><code data-claire-semantic="c">O_RDONLY</code> : pour la sortie.</p></li></ul><p id="r-478551" data-claire-element-id="478551">Exemple : Pour ouvrir l'entrée d'un tube « <em>essai.fifo</em> » :</p><pre id="r-478552" data-claire-element-id="478552"><code data-claire-semantic="c">descripteur[1] = open(&quot;essai.fifo&quot;, O_WRONLY);</code></pre><p id="r-478553" data-claire-element-id="478553">Ensuite, vous pouvez écrire et lire avec <code data-claire-semantic="c">write</code> et <code data-claire-semantic="c">read</code> comme si c'était des tubes classiques.</p><p id="r-478554" data-claire-element-id="478554">Bon, un dernier exercice avant de nous quitter pour ce chapitre :</p><p id="r-478555" data-claire-element-id="478555">Écrivez deux programmes indépendants : un écrit un message dans un tube nommé, et l'autre le lit, puis l'affiche. Exécutez ces deux programmes en même temps.</p><p id="r-478556" data-claire-element-id="478556">Correction :</p><p id="r-478557" data-claire-element-id="478557"><strong>Ecrivain.c</strong> :</p><pre id="r-478558" data-claire-element-id="478558"><code data-claire-semantic="c">#include &lt;fcntl.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

#define TAILLE_MESSAGE	256

int main(void)
{
	int entreeTube;
	char nomTube[] = &quot;essai.fifo&quot;;

	char chaineAEcrire[TAILLE_MESSAGE] = &quot;Bonjour&quot;;

	if(mkfifo(nomTube, 0644) != 0) 
	{
		fprintf(stderr, &quot;Impossible de créer le tube nommé.\n&quot;);
		exit(EXIT_FAILURE);
	}

	if((entreeTube = open(nomTube, O_WRONLY)) == -1) 
	{
		fprintf(stderr, &quot;Impossible d'ouvrir l'entrée du tube nommé.\n&quot;);
		exit(EXIT_FAILURE);
	}

	write(entreeTube, chaineAEcrire, TAILLE_MESSAGE);


	return EXIT_SUCCESS;
}</code></pre><p id="r-478559" data-claire-element-id="478559"><strong>Lecteur.c</strong> :</p><pre id="r-478560" data-claire-element-id="478560"><code data-claire-semantic="c">#include &lt;fcntl.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

#define TAILLE_MESSAGE	256

int main(void)
{
	int sortieTube;
	char nomTube[] = &quot;essai.fifo&quot;;

	char chaineALire[TAILLE_MESSAGE];

	if((sortieTube = open (&quot;essai.fifo&quot;, O_RDONLY)) == -1) 
	{
		fprintf(stderr, &quot;Impossible d'ouvrir la sortie du tube nommé.\n&quot;);
		exit(EXIT_FAILURE);
	}

	read(sortieTube, chaineALire, TAILLE_MESSAGE);
        printf(&quot;%s&quot;, chaineALire);

	return EXIT_SUCCESS;
}</code></pre><p id="r-478561" data-claire-element-id="478561">Résultat :</p><p id="r-478562" data-claire-element-id="478562"><strong>Premier terminal</strong> :</p><pre id="r-478563" data-claire-element-id="478563"><code data-claire-semantic="console">lucas@lucas-Deskstop:~/Documents$ ./ecrivain
_</code></pre><p id="r-478564" data-claire-element-id="478564"><strong>Deuxième terminal</strong> :</p><pre id="r-478565" data-claire-element-id="478565"><code data-claire-semantic="console">lucas@lucas-Deskstop:~/Documents$ ./lecteur
Bonjour</code></pre><p id="r-478566" data-claire-element-id="478566">Félicitations !<br/> Vous venez de terminer le chapitre 5 !</p><p id="r-478567" data-claire-element-id="478567">Et bah dites donc ! On dirait que vous n'êtes plus des débutants en la matière maintenant : vous savez créer des processus et les faire communiquer, manipuler des <em>threads</em> et exécuter des programmes.<br/> Il nous reste encore à maîtriser les signaux, les sémaphores, et bien d'autres choses encore avant de pouvoir passer dans une seconde partie plus difficile. Ça donne envie, hein ? :-°</p><aside id="r-478569" data-claire-element-id="478569" data-claire-semantic="information"><p id="r-478568" data-claire-element-id="478568">Ce tutoriel est en cours de construction.</p></aside><p id="r-478570" data-claire-element-id="478570">Je suis ouvert à <strong>toute remarque ou critique constructive</strong>.</p><ul id="r-478577" data-claire-element-id="478577"><li id="r-478572" data-claire-element-id="478572"><p id="r-478571" data-claire-element-id="478571">N'hésitez pas à donner votre avis sur le sujet du forum consacré à ce tutoriel (<a href="http://www.siteduzero.com/forum-83-591203-p2-beta-on-la-programmation-systeme-en-c-sous-linux.html#r5847439">ici</a> ou <a href="http://www.siteduzero.com/forum-83-593501-p1-commentaires-la-programmation-systeme-en-c-sous-linux.html">là</a>) ou dans ses commentaires.</p></li><li id="r-478574" data-claire-element-id="478574"><p id="r-478573" data-claire-element-id="478573">Faites moi part de vos suggestions par <a href="http://www.siteduzero.com/mp-273-257072.html">MP </a>en débutant le titre de votre message par [PROGRAMMATION SYSTÈME UNIX].</p></li><li id="r-478576" data-claire-element-id="478576"><p id="r-478575" data-claire-element-id="478575">Si il y a une notion que vous ne comprenez pas bien, posez votre question sur le <a href="http://www.siteduzero.com/forum-81-126-langage-c.html">forum</a>.</p></li></ul>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix">La programmation système en C sous Unix</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Les bases de la programmation système
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/avant-propos-9">Avant-propos</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/introduction-72">
Introduction
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/generalites-sur-le-developpement-sous-unix">
Généralités sur le développement sous Unix
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/conventions-typographiques">
Conventions typographiques
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/gestion-des-erreurs-3">
Gestion des erreurs
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-processus-1">Les processus</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/presentation-des-processus">
Présentation des processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions">
Notions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/creation-d-un-nouveau-processus">
Création d&#039;un nouveau processus
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/terminaison-d-un-processus">
Terminaison d&#039;un processus
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/executer-un-programme-1">Exécuter un programme</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-pre-requises">
Notions pré-requises
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-fonctions-de-la-famille-exec">
Les fonctions de la famille exec
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/la-fonction-system-1">
La fonction system
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-threads-4">Les threads</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-thread">
Qu&#039;est ce qu&#039;un thread ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/compilation-9">
Compilation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipulation-des-threads">
Manipulation des threads
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/exclusions-mutuelles">
Exclusions mutuelles
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-conditions-27">
Les conditions
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/les-tubes">Les tubes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/qu-est-ce-qu-un-tube">
Qu&#039;est ce qu&#039;un tube ?
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/manipuler-les-tubes">
Manipuler les tubes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
Pratique
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/notions-complementaires-sur-les-tubes">
Notions complémentaires sur les tubes
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/la-programmation-systeme-en-c-sous-unix/pratique-13">
<span class="arrow"></span>
<span class="next">Pratique</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/la-programmation-systeme-en-c-sous-unix.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 09:14:50 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/la-programmation-systeme-en-c-sous-unix.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 05:37:58 GMT -->
</html>