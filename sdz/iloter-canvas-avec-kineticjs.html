<html>

<!-- Mirrored from 62.4.17.167/sdz/sdz/iloter-canvas-avec-kineticjs.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 03:03:15 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/iloter-canvas-avec-kineticjs.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:40:28 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tutoriel : Piloter canvas avec KineticJS</title>
<link href="medias/sdz_main.css" type="text/css" rel="stylesheet" media="all"/>
</head>
        <body>
<a href="../www.siteduzero.com/informatique/tutoriels/piloter-canvas-avec-kineticjs.html" class="version_en_ligne">Version en ligne</a>
<h1>Tutoriel : Piloter canvas avec KineticJS</h1>
<h2>Table des matières</h2><div class="table_des_matieres"><a href="#PilotercanvasavecKineticJS">Piloter canvas avec KineticJS</a><br/><a href="#Premiresformes">Premières formes</a><br/><a href="#Miseenroute">Mise en route</a><br/><a href="#Formesprdfinies">Formes prédéfinies</a><br/><a href="#Texte">Texte</a><br/><a href="#Tracsetimages">Tracés et images</a><br/><a href="#Lignes">Lignes</a><br/><a href="#Shapeuneclassetoutfaire">Shape : une classe à tout faire</a><br/><a href="#Images">Images</a><br/><a href="#Style">Style</a><br/><a href="#Traitsetremplissage">Traits et remplissage</a><br/><a href="#Opacitetombre">Opacité et ombre</a><br/><a href="#Manipulations">Manipulations</a><br/><a href="#Modifications">Modifications</a><br/><a href="#Groupements">Groupements</a><br/><a href="#TP">TP</a><br/><a href="#Unpaysage">Un paysage</a><br/><a href="#Unevague">Une vague</a><br/><a href="#Encorelepaysage">Encore le paysage</a><br/><a href="#Fleurs">Fleurs</a><br/><a href="#Interactions">Interactions</a><br/><a href="#Evnements">Evénements</a><br/><a href="#Glisser-dposer">Glisser-déposer</a><br/><a href="#TP">TP</a><br/><a href="#Unexempled039application">Un exemple d&#039;application</a><br/><a href="#Prsentation">Présentation</a><br/><a href="#Ledessin">Le dessin</a><br/><a href="#Slectionetdition">Sélection et édition</a><br/><a href="#Apparenceetenregistrement">Apparence et enregistrement</a><br/><a href="#Animations">Animations</a><br/><a href="#Lestransitions">Les transitions</a><br/><a href="#Lessprites">Les sprites</a><br/><a href="#Lesanimations">Les animations</a><br/></div>
<a name="PilotercanvasavecKineticJS"></a><h2>Piloter canvas avec KineticJS</h2><div class="content" role="article">
<p id="r-427788" data-claire-element-id="427788"><strong>KineticJS </strong>est un framework <strong>Javascript </strong>qui permet d'utiliser plus facilement l'API <strong>Canvas </strong>du <strong>HTML5</strong>. Il étend les possibilités de <strong>Canvas </strong>: groupes, calques, événements... Il permet également de réaliser des animations très fluides par un système de buffers.</p><p id="r-427789" data-claire-element-id="427789">Pour suivre ce tutoriel, vous avez besoin de connaître <strong>Javascript</strong>. Si ce n'est pas le cas, commencez par vous initier à ce langage, par exemple avec <a href="http://www.siteduzero.com/tutoriel-3-309961-dynamisez-vos-sites-web-avec-javascript.html">ce tutoriel</a>. Je ne donne aucune indication quant au fonctionnement de ce langage dans ce cours qui est axé uniquement sur l'utilisation de <strong>KineticJS </strong>.</p>
</div>
<div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1358423835269-0" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1358423835269-0');
        });
    }
    </script>
</div><a name="Premiresformes"></a><h2>Premières formes</h2><div class="paginate-tuto">
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
<span class="next">Mise en route</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-427791" data-claire-element-id="427791">Dans ce premier chapitre nous allons voir comment démarrer avec <strong>KineticJS</strong> et dessiner des formes prédéfinies.</p>
</div><a name="Miseenroute"></a><h2>Mise en route</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">
<span class="arrow"></span>
<span class="next">Premières formes</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
<span class="next">Formes prédéfinies</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-mise-en-route-3" data-claire-element-id="427962">Mise en route</h4><h5 id="r-presentation-110" data-claire-element-id="427820">Présentation</h5><p id="r-427792" data-claire-element-id="427792"><strong>Canvas </strong>est une nouvelle fonctionnalité introduite avec le <strong>HTML5</strong>. Pour être honnête, c'est <strong>Apple </strong>qui l'a inventée et elle a été intégrée dans les <a href="http://dev.w3.org/html5/spec/the-canvas-element.html">spécifications du W3C</a> et <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html">celles du WhatWG</a>.</p><p id="r-427793" data-claire-element-id="427793">Il existe de nombreuses librairies <strong>Javascript </strong>pour piloter <strong>Canvas </strong>:</p><ul id="r-427816" data-claire-element-id="427816"><li id="r-427795" data-claire-element-id="427795"><p id="r-427794" data-claire-element-id="427794"><a href="http://www.createjs.com/#!/EaselJS">EaselJS</a></p></li><li id="r-427797" data-claire-element-id="427797"><p id="r-427796" data-claire-element-id="427796"><a href="http://jcscript.com/">jCanvaScript</a></p></li><li id="r-427799" data-claire-element-id="427799"><p id="r-427798" data-claire-element-id="427798"><a href="http://calebevans.me/projects/jcanvas/index.php">jCanvas</a></p></li><li id="r-427801" data-claire-element-id="427801"><p id="r-427800" data-claire-element-id="427800"><a href="http://artisanjs.com/">Artisan JS</a></p></li><li id="r-427803" data-claire-element-id="427803"><p id="r-427802" data-claire-element-id="427802"><a href="http://ocanvas.org/">oCanvas</a></p></li><li id="r-427805" data-claire-element-id="427805"><p id="r-427804" data-claire-element-id="427804"><a href="http://jcotton.sourceforge.net/index.htm">jcotton</a></p></li><li id="r-427807" data-claire-element-id="427807"><p id="r-427806" data-claire-element-id="427806"><a href="http://kangax.github.com/fabric.js/">Fabric</a></p></li><li id="r-427809" data-claire-element-id="427809"><p id="r-427808" data-claire-element-id="427808"><a href="http://canvasxpress.org/">canvasxpress</a></p></li><li id="r-427811" data-claire-element-id="427811"><p id="r-427810" data-claire-element-id="427810"><a href="http://guryjs.org/">gury</a></p></li><li id="r-427813" data-claire-element-id="427813"><p id="r-427812" data-claire-element-id="427812"><a href="http://www.bhivecanvas.com/">bHive</a></p></li><li id="r-427815" data-claire-element-id="427815"><p id="r-427814" data-claire-element-id="427814">...</p></li></ul><p id="r-427817" data-claire-element-id="427817">Il me semble que <strong>KineticJS </strong>, créée et maintenue par Eric Drowell, est l'une des plus efficaces et elle est d'autre part bien documentée.</p><p id="r-427818" data-claire-element-id="427818"><a href="http://www.kineticjs.com/">Le site</a> est plutôt bien fait et comporte de nombreuses démonstrations. Il y a avait un forum dédié que j'aimais bien, mais il a disparu au profit de <a href="http://stackoverflow.com/search?q=kineticjs">stackoverflow</a>. <a href="http://www.html5canvastutorials.com/kineticjs/">Les tutoriels</a> sont bien organisés et couvrent presque toutes les fonctionnalités, on peut toutefois regretter le fait qu'ils soient souvent en retard sur les options proposées.</p><p id="r-427819" data-claire-element-id="427819">Vous n'avez pas forcément besoin de savoir manipuler les commandes de base de l'API <strong>Canvas </strong>pour utiliser <strong>KineticJS </strong>mais il est évident que vous utiliserez cette librairie de façon beaucoup plus efficace si vous avez des notions concernant cette API.</p><h5 id="r-installation-57" data-claire-element-id="427830">Installation</h5><p id="r-427821" data-claire-element-id="427821">Pour utiliser <strong>KineticJS </strong>vous devez d'abord télécharger la librairie sur <a href="http://www.kineticjs.com/">le site</a> pour obtenir à coup sûr la dernière version et la placer dans un répertoire de votre site. Au moment où j'écris ce tutoriel, la dernière version est la 4.0.4.</p><p id="r-427822" data-claire-element-id="427822">Le lien ouvre directement le fichier dans votre navigateur :</p><figure id="r-427824" data-claire-element-id="427825"><img id="r-427823" data-claire-element-id="427823" src="medias/uploads.siteduzero.com_files_409001_410000_409653.png" alt="Image utilisateur"/></figure><p id="r-427826" data-claire-element-id="427826">Il suffit de faire un &quot;Enregistrer sous...&quot; pour placer le fichier dans un répertoire (&quot;js&quot; ou &quot;librairies&quot; ou autre). Pour ce tutoriel je le place dans un répertoire &quot;js&quot;. Il suffit ensuite de le référencer sur les pages web :</p><pre id="r-427827" data-claire-element-id="427827"><code data-claire-semantic="html">&lt;script src=&quot;js/kinetic-v4.0.4.min.js&quot;&gt;&lt;/script&gt;</code></pre><p id="r-427828" data-claire-element-id="427828">J'utilise la syntaxe <strong>HTML5 </strong>pour tout ce tutoriel, c'est pour cette raison que je n'ai pas précisé le type de script dans la balise <strong>&lt;script&gt;</strong> puisque <strong>Javascript </strong>est le type par défaut.</p><p id="r-427829" data-claire-element-id="427829">Il peut également être utile de récupérer le fichier source avec le code en clair et les commentaires pour utiliser la librairie de façon plus efficace. Etant donné le décalage entre la mise à jour de la documentation et les fonctionnalités proposées c'est même presque indispensable. Le mieux est sans doute d'aller voir sur la <a href="https://github.com/ericdrowell/KineticJS/">page de GitHub consacrée au projet</a>.</p><h5 id="r-structure-de-base-1" data-claire-element-id="427855">Structure de base</h5><p id="r-427831" data-claire-element-id="427831">Pour tous les exemples de ce tutoriel, nous allons avoir besoin d'une structure <strong>HTML </strong>de base. Ça va être tout simple parce que ça se limite à créer un conteneur avec un identifiant :</p><pre id="r-427832" data-claire-element-id="427832"><code data-claire-semantic="html">&lt;body&gt;
   &lt;div id=&quot;kinetic&quot;&gt;&lt;/div&gt;
&lt;/body&gt;</code></pre><p id="r-427833" data-claire-element-id="427833">Il faut ensuite une structure <strong>Javascript </strong>de base :</p><pre id="r-427834" data-claire-element-id="427834"><code data-claire-semantic="javascript">window.onload = function() {
    
  var scène = new Kinetic.Stage({
    container: &quot;kinetic&quot;,
    width: 600,
    height: 400
  });

  var calque = new Kinetic.Layer();

    // Ici on dessine sur le calque !

  scène.add(calque);

};</code></pre><p id="r-427835" data-claire-element-id="427835"><strong>Kinetic </strong>est l'espace de nom qui permet d'isoler tout ce que nous allons faire avec cette librairie. La première action est de créer une scène (<strong>Stage</strong>) pour contenir nos créations. Le constructeur de cet objet attend 3 paramètres. Le premier est l'identifiant du contenant <strong>HTML</strong>, dans notre cas cet identifiant est &quot;kinetic&quot;. Les deux paramètres suivants définissent la largeur et la hauteur de la scène.</p><figure id="r-427837" data-claire-element-id="427838"><img id="r-427836" data-claire-element-id="427836" src="medias/uploads.siteduzero.com_files_404001_405000_404893.png" alt="Image utilisateur"/></figure><p id="r-427839" data-claire-element-id="427839">Il faut ensuite définir au moins un calque pour dessiner :</p><pre id="r-427840" data-claire-element-id="427840"><code data-claire-semantic="javascript">var calque = new Kinetic.Layer();</code></pre><p id="r-427841" data-claire-element-id="427841">Et ajouter ensuite ce calque dans la scène :</p><pre id="r-427842" data-claire-element-id="427842"><code data-claire-semantic="javascript">scène.add(calque);</code></pre><p id="r-427843" data-claire-element-id="427843">Il est aussi judicieux de repérer les limites de la scène en créant une bordure avec une touche de style :</p><pre id="r-427844" data-claire-element-id="427844"><code data-claire-semantic="css">canvas {border-style:solid;}</code></pre><div id="r-427846" data-claire-element-id="427846" data-claire-semantic="question"><p id="r-427845" data-claire-element-id="427845">Mais où se trouve la balise canvas ?</p></div><p id="r-427847" data-claire-element-id="427847">On ne met pas cette balise de façon explicite dans le code <strong>HTML </strong>mais elle est générée automatiquement par la librairie.</p><p id="r-427848" data-claire-element-id="427848">Reprenons tous ces éléments pour obtenir la structure de base de tous nos exemples :</p><pre id="r-427849" data-claire-element-id="427849"><code data-claire-semantic="html">&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;script src=&quot;js/kinetic-v4.0.4.min.js&quot;&gt;&lt;/script&gt;
&lt;style&gt;
canvas {border-style:solid;}
&lt;/style&gt;
&lt;script&gt;
window.onload = function() {
   var scène = new Kinetic.Stage({
      container: &quot;kinetic&quot;,
      width: 500,
      height: 300
   });
	
   var calque = new Kinetic.Layer();
	
	//  ...
	
   scène.add(calque);
};
&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
   &lt;div id=&quot;kinetic&quot;&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p id="r-427850" data-claire-element-id="427850"><a href="http://tutozero.free.fr/kinetic/tutos01/cadre_01.html">Tester !</a><br/> Maintenant nous avons tout ce qui est nécessaire pour commencer à dessiner ;)</p><aside id="r-427854" data-claire-element-id="427854" data-claire-semantic="information"><p id="r-427851" data-claire-element-id="427851">Pour ceux qui ont la curiosité de voir le code généré :</p><pre id="r-427852" data-claire-element-id="427852"><code data-claire-semantic="html">&lt;body&gt;
&lt;div id=&quot;kinetic&quot;&gt;
  &lt;div style=&quot;position: relative; display: inline-block; width: 500px; height: 300px; &quot; class=&quot;kineticjs-content&quot;&gt;
    &lt;canvas style=&quot;position: absolute; display: none; &quot; class=&quot;kineticjs-buffer-layer&quot; width=&quot;500&quot; height=&quot;300&quot;&gt;&lt;/canvas&gt;
    &lt;canvas style=&quot;position: absolute; display: none; &quot; class=&quot;kineticjs-path-layer&quot; width=&quot;500&quot; height=&quot;300&quot;&gt;&lt;/canvas&gt;
    &lt;canvas style=&quot;position: absolute; &quot; width=&quot;500&quot; height=&quot;300&quot;&gt;&lt;/canvas&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;</code></pre><p id="r-427853" data-claire-element-id="427853">On se rend compte que trois balises <strong>canvas </strong>sont créées dont deux sont masquées.</p></aside><h5 id="r-les-classes-7" data-claire-element-id="427961">Les classes</h5><p id="r-427856" data-claire-element-id="427856"><strong>KineticJS </strong>est organisé en classes hiérarchisées. Voici une illustration de sa structure :</p><figure id="r-427858" data-claire-element-id="427859"><img id="r-427857" data-claire-element-id="427857" src="medias/uploads.siteduzero.com_files_404001_405000_404892.png" alt="Image utilisateur"/></figure><p id="r-427860" data-claire-element-id="427860">Ce diagramme est issu de mes investigations dans le fichier de <strong>KineticJS </strong>étant donné que la documentation a un peu de retard.</p><p id="r-427861" data-claire-element-id="427861">Voici une description sommaire de ces classes :</p><table id="r-427959" data-claire-element-id="427959"><thead id="r-427867" data-claire-element-id="427867"><tr id="r-427866" data-claire-element-id="427866"><th id="r-427863" data-claire-element-id="427863"><p id="r-427862" data-claire-element-id="427862">Classe</p></th><th id="r-427865" data-claire-element-id="427865"><p id="r-427864" data-claire-element-id="427864">Description</p></th></tr></thead><tbody id="r-427958" data-claire-element-id="427958"><tr id="r-427872" data-claire-element-id="427872"><td id="r-427869" data-claire-element-id="427869"><p id="r-427868" data-claire-element-id="427868"><strong>Node</strong></p></td><td id="r-427871" data-claire-element-id="427871"><p id="r-427870" data-claire-element-id="427870">C'est la classe principale qui offre les propriétés et méthodes de base pour créer des objets graphiques</p></td></tr><tr id="r-427877" data-claire-element-id="427877"><td id="r-427874" data-claire-element-id="427874"><p id="r-427873" data-claire-element-id="427873"><strong>Container</strong></p></td><td id="r-427876" data-claire-element-id="427876"><p id="r-427875" data-claire-element-id="427875">Cette classe offre des fonctionnalités pour contenir des Nodes</p></td></tr><tr id="r-427882" data-claire-element-id="427882"><td id="r-427879" data-claire-element-id="427879"><p id="r-427878" data-claire-element-id="427878"><strong>Group</strong></p></td><td id="r-427881" data-claire-element-id="427881"><p id="r-427880" data-claire-element-id="427880">Permet de regrouper des objets graphiques pour leur appliquer des actions</p></td></tr><tr id="r-427887" data-claire-element-id="427887"><td id="r-427884" data-claire-element-id="427884"><p id="r-427883" data-claire-element-id="427883"><strong>Stage</strong></p></td><td id="r-427886" data-claire-element-id="427886"><p id="r-427885" data-claire-element-id="427885">Permet de créer une scène pour dessiner et animer</p></td></tr><tr id="r-427892" data-claire-element-id="427892"><td id="r-427889" data-claire-element-id="427889"><p id="r-427888" data-claire-element-id="427888"><strong>Layer</strong></p></td><td id="r-427891" data-claire-element-id="427891"><p id="r-427890" data-claire-element-id="427890">Pour créer des calques indépendants</p></td></tr><tr id="r-427897" data-claire-element-id="427897"><td id="r-427894" data-claire-element-id="427894"><p id="r-427893" data-claire-element-id="427893"><strong>Shape</strong></p></td><td id="r-427896" data-claire-element-id="427896"><p id="r-427895" data-claire-element-id="427895">Classe qui permet de dessiner</p></td></tr><tr id="r-427902" data-claire-element-id="427902"><td id="r-427899" data-claire-element-id="427899"><p id="r-427898" data-claire-element-id="427898"><strong>Path</strong></p></td><td id="r-427901" data-claire-element-id="427901"><p id="r-427900" data-claire-element-id="427900">Pour dessiner en SVG</p></td></tr><tr id="r-427907" data-claire-element-id="427907"><td id="r-427904" data-claire-element-id="427904"><p id="r-427903" data-claire-element-id="427903"><strong>Sprite</strong></p></td><td id="r-427906" data-claire-element-id="427906"><p id="r-427905" data-claire-element-id="427905">Pour gérer des images regroupées sur une seule image</p></td></tr><tr id="r-427912" data-claire-element-id="427912"><td id="r-427909" data-claire-element-id="427909"><p id="r-427908" data-claire-element-id="427908"><strong>Rect</strong></p></td><td id="r-427911" data-claire-element-id="427911"><p id="r-427910" data-claire-element-id="427910">Pour dessiner des rectangles</p></td></tr><tr id="r-427917" data-claire-element-id="427917"><td id="r-427914" data-claire-element-id="427914"><p id="r-427913" data-claire-element-id="427913"><strong>Circle</strong></p></td><td id="r-427916" data-claire-element-id="427916"><p id="r-427915" data-claire-element-id="427915">Pour dessiner des cercles</p></td></tr><tr id="r-427922" data-claire-element-id="427922"><td id="r-427919" data-claire-element-id="427919"><p id="r-427918" data-claire-element-id="427918"><strong>Ellipse</strong></p></td><td id="r-427921" data-claire-element-id="427921"><p id="r-427920" data-claire-element-id="427920">Pour dessiner des ellipses et donc aussi des cercles</p></td></tr><tr id="r-427927" data-claire-element-id="427927"><td id="r-427924" data-claire-element-id="427924"><p id="r-427923" data-claire-element-id="427923"><strong>Polygone</strong></p></td><td id="r-427926" data-claire-element-id="427926"><p id="r-427925" data-claire-element-id="427925">Pour dessiner des polygones quelconques</p></td></tr><tr id="r-427932" data-claire-element-id="427932"><td id="r-427929" data-claire-element-id="427929"><p id="r-427928" data-claire-element-id="427928"><strong>Star</strong></p></td><td id="r-427931" data-claire-element-id="427931"><p id="r-427930" data-claire-element-id="427930">Pour dessiner des étoiles</p></td></tr><tr id="r-427937" data-claire-element-id="427937"><td id="r-427934" data-claire-element-id="427934"><p id="r-427933" data-claire-element-id="427933"><strong>Line</strong></p></td><td id="r-427936" data-claire-element-id="427936"><p id="r-427935" data-claire-element-id="427935">Pour dessiner des lignes en gérant les liaisons et les extrémités</p></td></tr><tr id="r-427942" data-claire-element-id="427942"><td id="r-427939" data-claire-element-id="427939"><p id="r-427938" data-claire-element-id="427938"><strong>Text</strong></p></td><td id="r-427941" data-claire-element-id="427941"><p id="r-427940" data-claire-element-id="427940">Pour dessiner du texte</p></td></tr><tr id="r-427947" data-claire-element-id="427947"><td id="r-427944" data-claire-element-id="427944"><p id="r-427943" data-claire-element-id="427943"><strong>Image</strong></p></td><td id="r-427946" data-claire-element-id="427946"><p id="r-427945" data-claire-element-id="427945">Pour afficher des images</p></td></tr><tr id="r-427952" data-claire-element-id="427952"><td id="r-427949" data-claire-element-id="427949"><p id="r-427948" data-claire-element-id="427948"><strong>Transition</strong></p></td><td id="r-427951" data-claire-element-id="427951"><p id="r-427950" data-claire-element-id="427950">Une classe isolée pour faire des transitions de position, taille, rotation, etc...</p></td></tr><tr id="r-427957" data-claire-element-id="427957"><td id="r-427954" data-claire-element-id="427954"><p id="r-427953" data-claire-element-id="427953"><strong>Animation</strong></p></td><td id="r-427956" data-claire-element-id="427956"><p id="r-427955" data-claire-element-id="427955">Une classe isolée pour faire des animations</p></td></tr></tbody></table><p id="r-427960" data-claire-element-id="427960">Il est à noter que le développeur de cette librairie est assez réactif et sort souvent des correctifs, quelques fois un peu rapidement d'ailleurs et je conseille de suivre l'évolution des versions en attendant quelque temps pour que les bugs soient corrigés :p .</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">
<span class="arrow"></span>
<span class="next">Premières formes</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
<span class="next">Formes prédéfinies</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Formesprdfinies"></a><h2>Formes prédéfinies</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
<span class="arrow"></span>
<span class="next">Mise en route</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
<span class="next">Texte</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-formes-predefinies" data-claire-element-id="428070">Formes prédéfinies</h4><h5 id="r-rectangles" data-claire-element-id="427999">Rectangles</h5><h6 id="r-notre-premier-dessin" data-claire-element-id="427970">Notre premier dessin</h6><p id="r-427963" data-claire-element-id="427963">Pour commencer tranquillement on va dessiner un rectangle bleu avec la classe <strong>Rect</strong>. Le constructeur attend au minimum une largeur et une hauteur. Mais si on se contente de ça, on ne voit pas grand-chose à l'écran :D . Voyons le code :</p><pre id="r-427964" data-claire-element-id="427964"><code data-claire-semantic="javascript">window.onload = function() {
   var scène = new Kinetic.Stage({
      container: &quot;kinetic&quot;,
      width: 500,
      height: 300
   });
	
   var calque = new Kinetic.Layer();
	
   var rectangle = new Kinetic.Rect({
      width: 100,
      height: 60,
      fill: &quot;blue&quot;
   });
	
   calque.add(rectangle);	
	
   scène.add(calque);
};</code></pre><p id="r-427965" data-claire-element-id="427965"><a href="http://tutozero.free.fr/kinetic/tutos01/rect_01.html">Tester !</a></p><figure id="r-427967" data-claire-element-id="427968"><img id="r-427966" data-claire-element-id="427966" src="medias/uploads.siteduzero.com_files_409001_410000_409453.png" alt="Image utilisateur"/></figure><p id="r-427969" data-claire-element-id="427969">C'est la propriété <strong>fill </strong>qui permet le remplissage. Ici je me suis contenté de la remplir d'un bleu uniforme, on verra qu'on peut également utiliser une image ou des dégradés. Ici j'ai écrit le nom de la couleur, on peut aussi utiliser le code hexadécimal comme pour les propriétés <strong>CSS</strong>. On peut également utiliser la fonction <strong>rgb </strong>comme nous le verrons plus loin.</p><h6 id="r-positionnement-1" data-claire-element-id="427983">Positionnement</h6><p id="r-427971" data-claire-element-id="427971">Vous avez sans doute aussi remarqué que le rectangle bleu vient se caler en haut et à gauche du cadre. Pour comprendre ce comportement, il faut déjà connaître le système de coordonnées utilisé. L'origine des axes est justement située en haut et à gauche :</p><figure id="r-427973" data-claire-element-id="427974"><img id="r-427972" data-claire-element-id="427972" src="medias/uploads.siteduzero.com_files_409001_410000_409454.png" alt="Image utilisateur"/></figure><p id="r-427975" data-claire-element-id="427975">L'axe des <strong>X</strong> s'étire horizontalement vers la droite et celui des <strong>Y</strong> verticalement vers le bas.</p><p id="r-427976" data-claire-element-id="427976">La référence de positionnement d'un rectangle est également située en haut à gauche. D'autre part les valeurs par défaut de x et y sont à 0. On comprend donc pourquoi notre rectangle bleu va se caler dans le coin haut gauche.</p><p id="r-427977" data-claire-element-id="427977">On va maintenant positionner différemment le rectangle en lui fixant des valeurs pour <strong>x</strong> et <strong>y</strong> :</p><pre id="r-427978" data-claire-element-id="427978"><code data-claire-semantic="javascript">var rect1 = new Kinetic.Rect({
  x: 150,
  y: 100,
  width: 100,
  height: 60,
  fill: &quot;blue&quot;
});</code></pre><p id="r-427979" data-claire-element-id="427979"><a href="http://tutozero.free.fr/kinetic/tutos01/rect_02.html">Tester !</a></p><figure id="r-427981" data-claire-element-id="427982"><img id="r-427980" data-claire-element-id="427980" src="medias/uploads.siteduzero.com_files_409001_410000_409456.png" alt="Image utilisateur"/></figure><h6 id="r-la-bordure" data-claire-element-id="427991">La bordure</h6><p id="r-427984" data-claire-element-id="427984">On peut aussi gérer la bordure du rectangle. Voici un exemple :</p><pre id="r-427985" data-claire-element-id="427985"><code data-claire-semantic="javascript">window.onload = function() {
    var scène = new Kinetic.Stage({
      container: &quot;kinetic&quot;,
      width: 500,
      height: 300
    });

    var calque = new Kinetic.Layer();

    var rect1 = new Kinetic.Rect({
       x: 150,
       y: 100,
       width: 200,
       height: 100,
       stroke: &quot;black&quot;,
       strokeWidth: 6
    });
	
    calque.add(rect1);

    scène.add(calque);
};</code></pre><p id="r-427986" data-claire-element-id="427986"><a href="http://tutozero.free.fr/kinetic/tutos01/rect_03.html">Tester !</a></p><figure id="r-427988" data-claire-element-id="427989"><img id="r-427987" data-claire-element-id="427987" src="medias/uploads.siteduzero.com_files_409001_410000_409457.png" alt="Image utilisateur"/></figure><p id="r-427990" data-claire-element-id="427990">On voit que le trait est géré par la propriété <strong>stroke</strong>. Ici j'ai choisi la couleur noire (black) et une épaisseur de 6 pixels.</p><h6 id="r-arrondir-les-angles" data-claire-element-id="427998">Arrondir les angles</h6><p id="r-427992" data-claire-element-id="427992">Les rectangles que nous avons dessinés jusqu'à présent ont des angles aigus. Il est possible de les arrondir avec la propriété <strong>cornerRadius </strong>qui fixe la valeur du rayon de courbure qui est par défaut à 0.</p><pre id="r-427993" data-claire-element-id="427993"><code data-claire-semantic="javascript">var rect1 = new Kinetic.Rect({
  x: 150,
  y: 100,
  width: 200,
  height: 100,
  stroke: &quot;#F90&quot;,
  strokeWidth: 2,
  cornerRadius: 20
});</code></pre><p id="r-427994" data-claire-element-id="427994"><a href="http://tutozero.free.fr/kinetic/tutos01/rect_04.html">Tester !</a></p><figure id="r-427996" data-claire-element-id="427997"><img id="r-427995" data-claire-element-id="427995" src="medias/uploads.siteduzero.com_files_409001_410000_409458.png" alt="Image utilisateur"/></figure><h5 id="r-cercles-et-ellipses" data-claire-element-id="428030">Cercles et ellipses</h5><h6 id="r-rayon" data-claire-element-id="428006">Rayon</h6><p id="r-428000" data-claire-element-id="428000">La classe <strong>Circle </strong>permet évidemment de dessiner des cercles. La dimension d'un cercle est fixée par la longueur de son rayon donnée par la propriété <strong>radius</strong>. Le trait est géré comme celui des rectangles. Voici un premier exemple :</p><pre id="r-428001" data-claire-element-id="428001"><code data-claire-semantic="javascript">var cercle = new Kinetic.Circle({
  radius: 80,
  stroke: &quot;darkgreen&quot;,
  strokeWidth: 5
});
calque.add(cercle);</code></pre><p id="r-428002" data-claire-element-id="428002"><a href="http://tutozero.free.fr/kinetic/tutos01/ellipse_01.html">Tester !</a></p><figure id="r-428004" data-claire-element-id="428005"><img id="r-428003" data-claire-element-id="428003" src="medias/uploads.siteduzero.com_files_409001_410000_409460.png" alt="Image utilisateur"/></figure><h6 id="r-position-3" data-claire-element-id="428013">Position</h6><p id="r-428007" data-claire-element-id="428007">On s'attendait à voir un cercle et on en obtient qu'un morceau. Le point de référence est le centre du cercle qui vient tout naturellement se fixer à l'origine des coordonnées. Seule la partie tracée à l’intérieur de la scène apparaît. Pour avoir le cercle entier, nous devons définir la position du centre :</p><pre id="r-428008" data-claire-element-id="428008"><code data-claire-semantic="javascript">var cercle = new Kinetic.Circle({
  x: 140,
  y: 120,
  radius: 80,
  stroke: &quot;darkgreen&quot;,
  strokeWidth: 5
});
calque.add(cercle);</code></pre><p id="r-428009" data-claire-element-id="428009"><a href="http://tutozero.free.fr/kinetic/tutos01/ellipse_02.html">Tester !</a></p><figure id="r-428011" data-claire-element-id="428012"><img id="r-428010" data-claire-element-id="428010" src="medias/uploads.siteduzero.com_files_409001_410000_409462.png" alt="Image utilisateur"/></figure><h6 id="r-remplissage-1" data-claire-element-id="428020">Remplissage</h6><p id="r-428014" data-claire-element-id="428014">La même propriété que le rectangle permet de remplir le cercle (ici avec une couleur cyan unie):</p><pre id="r-428015" data-claire-element-id="428015"><code data-claire-semantic="javascript">var cercle = new Kinetic.Circle({
  x: 140,
  y: 120,
  radius: 80,
  fill: &quot;#0ff&quot;
});</code></pre><p id="r-428016" data-claire-element-id="428016"><a href="http://tutozero.free.fr/kinetic/tutos01/ellipse_03.html">Tester !</a></p><figure id="r-428018" data-claire-element-id="428019"><img id="r-428017" data-claire-element-id="428017" src="medias/uploads.siteduzero.com_files_409001_410000_409465.png" alt="Image utilisateur"/></figure><h6 id="r-une-ellipse" data-claire-element-id="428029">Une ellipse</h6><p id="r-428021" data-claire-element-id="428021">Bon on va quand même dessiner une ellipse :</p><pre id="r-428022" data-claire-element-id="428022"><code data-claire-semantic="javascript">var ellipse = new Kinetic.Ellipse({
  x: 140,
  y: 120,
  radius: [120, 80],
  stroke: &quot;darkgreen&quot;,
  strokeWidth: 5
});</code></pre><p id="r-428023" data-claire-element-id="428023"><a href="http://tutozero.free.fr/kinetic/tutos01/ellipse_04.html">Tester !</a></p><figure id="r-428025" data-claire-element-id="428026"><img id="r-428024" data-claire-element-id="428024" src="medias/uploads.siteduzero.com_files_409001_410000_409468.png" alt="Image utilisateur"/></figure><p id="r-428027" data-claire-element-id="428027">On voit qu'il suffit de définir la longueur du grand et du petit rayon dans un tableau. On peut aussi utiliser un objet avec les propriétés x et y. Donc ce code est équivalent :</p><pre id="r-428028" data-claire-element-id="428028"><code data-claire-semantic="javascript">var ellipse = new Kinetic.Ellipse({
  x: 140,
  y: 120,
  radius: {x: 120, y: 80},
  stroke: &quot;darkgreen&quot;,
  strokeWidth: 5
});</code></pre><h5 id="r-polygones" data-claire-element-id="428046">Polygones</h5><h6 id="r-triangle" data-claire-element-id="428038">Triangle</h6><p id="r-428031" data-claire-element-id="428031">Pour tracer des polygones, il faut utiliser la classe <strong>Polygon</strong>. Elle permet de dessiner des polygones avec autant de côtés que l'on veut, il suffit de définir la position de chaque point. Voici par exemple un triangle :</p><pre id="r-428032" data-claire-element-id="428032"><code data-claire-semantic="javascript">var triangle = new Kinetic.Polygon({
   points : [{x:40,y:60},{x:180,y:20},{x:240,y:160}],
  fill: &quot;#fa0&quot;,
  stroke: &quot;red&quot;,
  strokeWidth: 4
});
calque.add(triangle);</code></pre><p id="r-428033" data-claire-element-id="428033"><a href="http://tutozero.free.fr/kinetic/tutos01/triangle_01.html">Tester !</a></p><figure id="r-428035" data-claire-element-id="428036"><img id="r-428034" data-claire-element-id="428034" src="medias/uploads.siteduzero.com_files_409001_410000_409470.png" alt="Image utilisateur"/></figure><p id="r-428037" data-claire-element-id="428037">On voit que la définition du trait et du remplissage sont encore les mêmes.</p><h6 id="r-polygones-varies" data-claire-element-id="428045">Polygones variés</h6><p id="r-428039" data-claire-element-id="428039">On est pas limités en nombre de points et les côtés peuvent se croiser, le remplissage se fait toujours de façon efficace :</p><pre id="r-428040" data-claire-element-id="428040"><code data-claire-semantic="javascript">var polygone = new Kinetic.Polygon({
  points : [{x:40,y:60},{x:150,y:40},{x:180,y:220},{x:40,y:200},{x:250,y:260}], 
  stroke: &quot;magenta&quot;,
  strokeWidth: 4,
  fill: &quot;#05f&quot;
});
calque.add(polygone);</code></pre><p id="r-428041" data-claire-element-id="428041"><a href="http://tutozero.free.fr/kinetic/tutos01/polygone_01a.html">Tester !</a></p><figure id="r-428043" data-claire-element-id="428044"><img id="r-428042" data-claire-element-id="428042" src="medias/uploads.siteduzero.com_files_409001_410000_409471.png" alt="Image utilisateur"/></figure><h5 id="r-polygones-reguliers" data-claire-element-id="428069">Polygones réguliers</h5><h6 id="r-carre" data-claire-element-id="428053">Carré</h6><p id="r-428047" data-claire-element-id="428047">On peut dessiner des polygones réguliers avec la classe <strong>RegularPolygon</strong>. Il faut définir le nombre de côtés avec la propriété <strong>sides</strong>. Voici par exemple un carré :</p><pre id="r-428048" data-claire-element-id="428048"><code data-claire-semantic="javascript">var carré = new Kinetic.RegularPolygon({
  x: 160,
  y: 140,
  sides: 4,
  radius: 100,
  fill: &quot;darkslateblue&quot;,
});
calque.add(carré);</code></pre><p id="r-428049" data-claire-element-id="428049"><a href="http://tutozero.free.fr/kinetic/tutos01/regularpolygone_01.html">Tester !</a></p><figure id="r-428051" data-claire-element-id="428052"><img id="r-428050" data-claire-element-id="428050" src="medias/uploads.siteduzero.com_files_409001_410000_409472.png" alt="Image utilisateur"/></figure><h6 id="r-heptagone" data-claire-element-id="428061">Heptagone</h6><p id="r-428054" data-claire-element-id="428054">On choisit le nombre de côtés comme on veut. Voici par exemple un heptagone :</p><pre id="r-428055" data-claire-element-id="428055"><code data-claire-semantic="javascript">var heptagone = new Kinetic.RegularPolygon({
  x: 120,
  y: 120,
  sides: 7,
  radius: 70,
  stroke: &quot;firebrick&quot;,
  strokeWidth: 3
});
calque.add(heptagone);</code></pre><p id="r-428056" data-claire-element-id="428056"><a href="http://tutozero.free.fr/kinetic/tutos01/regularpolygone_02.html">Tester !</a></p><figure id="r-428058" data-claire-element-id="428059"><img id="r-428057" data-claire-element-id="428057" src="medias/uploads.siteduzero.com_files_409001_410000_409473.png" alt="Image utilisateur"/></figure><p id="r-428060" data-claire-element-id="428060">On voit que les traits sont encore gérés de la même manière.</p><h6 id="r-etoile" data-claire-element-id="428068">Étoile</h6><p id="r-428062" data-claire-element-id="428062">Il y a également une classe pour dessiner des étoiles, c'est la classe <strong>Star</strong>. Voici une étoile avec 5 branches :</p><pre id="r-428063" data-claire-element-id="428063"><code data-claire-semantic="javascript">var étoile = new Kinetic.Star({
  x: 100,
  y: 100,
  numPoints: 5,
  innerRadius: 40,
  outerRadius: 80,
  fill: &quot;orange&quot;,
  stroke: &quot;orangered&quot;,
  strokeWidth: 2
});
calque.add(étoile);</code></pre><p id="r-428064" data-claire-element-id="428064"><a href="http://tutozero.free.fr/kinetic/tutos01/etoile_01.html">Tester !</a></p><figure id="r-428066" data-claire-element-id="428067"><img id="r-428065" data-claire-element-id="428065" src="medias/uploads.siteduzero.com_files_409001_410000_409474.png" alt="Image utilisateur"/></figure>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
<span class="arrow"></span>
<span class="next">Mise en route</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
<span class="next">Texte</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Texte"></a><h2>Texte</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
<span class="arrow"></span>
<span class="next">Formes prédéfinies</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">
<span class="next">Tracés et images</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-texte-2" data-claire-element-id="428159">Texte</h4><h5 id="r-ecrire-avec-style" data-claire-element-id="428077">Écrire avec style</h5><p id="r-428071" data-claire-element-id="428071">On peut considérer le texte comme un ensemble de formes prédéfinies. Il y a une classe <strong>Text </strong>qui permet de réaliser de belles choses. Voici un premier exemple :</p><pre id="r-428072" data-claire-element-id="428072"><code data-claire-semantic="javascript">var text = new Kinetic.Text({
  x: 40,
  y: 30,
  text: &quot;Je sais écrire&quot;,
  fontSize: 26,
  fontFamily: &quot;Garamond&quot;,
  textFill: &quot;#c16&quot;
});
calque.add(text);</code></pre><p id="r-428073" data-claire-element-id="428073"><a href="http://tutozero.free.fr/kinetic/tutos01/texte_01.html">Tester !</a></p><figure id="r-428075" data-claire-element-id="428076"><img id="r-428074" data-claire-element-id="428074" src="medias/uploads.siteduzero.com_files_409001_410000_409475.png" alt="Image utilisateur"/></figure><h5 id="r-contour-du-texte" data-claire-element-id="428090">Contour du texte</h5><p id="r-428078" data-claire-element-id="428078">Dans l'exemple précédent, nous avons rempli chaque caractère avec une couleur unie avec la propriété <strong>textFill</strong>. Il est aussi possible de tracer uniquement le contour avec la propriété <strong>textStroke</strong> :</p><pre id="r-428079" data-claire-element-id="428079"><code data-claire-semantic="javascript">var text = new Kinetic.Text({
  x: 40,
  y: 30,
  text: &quot;Je sais écrire&quot;,
  fontSize: 36,
  fontFamily: &quot;Georgia&quot;,
  textStroke: &quot;blue&quot;,
});
calque.add(text);</code></pre><p id="r-428080" data-claire-element-id="428080"><a href="http://tutozero.free.fr/kinetic/tutos01/texte_02.html">Tester !</a></p><figure id="r-428082" data-claire-element-id="428083"><img id="r-428081" data-claire-element-id="428081" src="medias/uploads.siteduzero.com_files_409001_410000_409476.png" alt="Image utilisateur"/></figure><p id="r-428084" data-claire-element-id="428084">On peut régler l'épaisseur du contour avec la propriété <strong>textStrokeWidth </strong>dont la valeur par défaut est 2 :</p><pre id="r-428085" data-claire-element-id="428085"><code data-claire-semantic="javascript">var text = new Kinetic.Text({
  x: 40,
  y: 30,
  text: &quot;Je sais écrire&quot;,
  fontSize: 36,
  fontFamily: &quot;Georgia&quot;,
  textStroke: &quot;blue&quot;,
  textStrokeWidth: 1
});
calque.add(text);</code></pre><p id="r-428086" data-claire-element-id="428086"><a href="http://tutozero.free.fr/kinetic/tutos01/texte_03.html">Tester !</a></p><figure id="r-428088" data-claire-element-id="428089"><img id="r-428087" data-claire-element-id="428087" src="medias/uploads.siteduzero.com_files_409001_410000_409477.png" alt="Image utilisateur"/></figure><h5 id="r-style-du-texte" data-claire-element-id="428097">Style du texte</h5><p id="r-428091" data-claire-element-id="428091">On peut définir le style du texte avec la propriété <strong>fontStyle</strong>. Elle peut prendre les valeurs <strong>italic </strong>ou <strong>bold</strong> :</p><pre id="r-428092" data-claire-element-id="428092"><code data-claire-semantic="javascript">var text1 = new Kinetic.Text({
  x: 40,
  y: 30,
  text: &quot;Je suis en italique&quot;,
  fontSize: 34,
  fontFamily: &quot;Georgia&quot;,
  fontStyle: &quot;italic&quot;,
  textFill: &quot;rgb(200,50,10)&quot;
});

var text2 = new Kinetic.Text({
  x: 40,
  y: 80,
  text: &quot;Je suis en gras&quot;,
  fontSize: 34,
  fontFamily: &quot;Georgia&quot;,
  fontStyle: &quot;bold&quot;,
  textFill: &quot;rgb(200,50,10)&quot;
});
calque.add(text1);
calque.add(text2);</code></pre><p id="r-428093" data-claire-element-id="428093"><a href="http://tutozero.free.fr/kinetic/tutos01/texte_04.html">Tester !</a></p><figure id="r-428095" data-claire-element-id="428096"><img id="r-428094" data-claire-element-id="428094" src="medias/uploads.siteduzero.com_files_409001_410000_409478.png" alt="Image utilisateur"/></figure><h5 id="r-paragraphes" data-claire-element-id="428110">Paragraphes</h5><p id="r-428098" data-claire-element-id="428098">On peut se demander ce qu'il se passe si le texte à afficher est plus large que la scène. Voici un exemple :</p><pre id="r-428099" data-claire-element-id="428099"><code data-claire-semantic="javascript">var text = new Kinetic.Text({
  x: 40,
  y: 40,
  text: &quot;On peut se demander ce qu'il se passe avec un long texte&quot;,
  fontSize: 18,
  fontFamily: &quot;Fraktur&quot;,
  textFill: &quot;darkgreen&quot;,
});
calque.add(text);</code></pre><p id="r-428100" data-claire-element-id="428100"><a href="http://tutozero.free.fr/kinetic/tutos01/texte_05.html">Tester !</a></p><figure id="r-428102" data-claire-element-id="428103"><img id="r-428101" data-claire-element-id="428101" src="medias/uploads.siteduzero.com_files_409001_410000_409479.png" alt="Image utilisateur"/></figure><p id="r-428104" data-claire-element-id="428104">On se rend compte qu'on perd le texte qui ne rentre pas dans le cadre. On peut arranger ça avec la propriété <strong>width </strong>qui limite la largeur du texte et provoque un renvoi à la ligne :</p><pre id="r-428105" data-claire-element-id="428105"><code data-claire-semantic="javascript">var text = new Kinetic.Text({
  x: 40,
  y: 40,
  text: &quot;On peut se demander ce qu'il se passe avec un long texte&quot;,
  fontSize: 18,
  fontFamily: &quot;Fraktur&quot;,
  textFill: &quot;darkgreen&quot;,
  width: 300
});
calque.add(text);</code></pre><p id="r-428106" data-claire-element-id="428106"><a href="http://tutozero.free.fr/kinetic/tutos01/texte_06.html">Tester !</a></p><figure id="r-428108" data-claire-element-id="428109"><img id="r-428107" data-claire-element-id="428107" src="medias/uploads.siteduzero.com_files_409001_410000_409481.png" alt="Image utilisateur"/></figure><h5 id="r-alignement-3" data-claire-element-id="428117">Alignement</h5><p id="r-428111" data-claire-element-id="428111">On a vu qu'on peut créer des paragraphes, on peut aussi <strong>aligne</strong>r le texte avec la propriété align qui est par défaut à <strong>left</strong>. Les autres valeurs sont <strong>center </strong>et <strong>right</strong>. voici le texte précédent centré :</p><pre id="r-428112" data-claire-element-id="428112"><code data-claire-semantic="javascript">var text = new Kinetic.Text({
  x: 40,
  y: 40,
  text: &quot;On peut se demander ce qu'il se passe avec un long texte&quot;,
  fontSize: 18,
  fontFamily: &quot;Fraktur&quot;,
  textFill: &quot;darkgreen&quot;,
  width: 300,
  align: &quot;center&quot;
});
calque.add(text);</code></pre><p id="r-428113" data-claire-element-id="428113"><a href="http://tutozero.free.fr/kinetic/tutos01/texte_07.html">Tester !</a></p><figure id="r-428115" data-claire-element-id="428116"><img id="r-428114" data-claire-element-id="428114" src="medias/uploads.siteduzero.com_files_409001_410000_409482.png" alt="Image utilisateur"/></figure><h5 id="r-hauteur-de-ligne" data-claire-element-id="428124">Hauteur de ligne</h5><p id="r-428118" data-claire-element-id="428118">La hauteur des lignes est fixée par défaut à 1.2, on peut la modifier avec la propriété <strong>lineHeight </strong>:</p><pre id="r-428119" data-claire-element-id="428119"><code data-claire-semantic="javascript">var text = new Kinetic.Text({
  x: 40,
  y: 40,
  text: &quot;On peut aérer un peu le texte en jouant sur la hauteur des lignes&quot;,
  fontSize: 16,
  fontFamily: &quot;Verdana&quot;,
  textFill: &quot;blue&quot;,
  width: 300,
  lineHeight: 1.6
});
calque.add(text);</code></pre><p id="r-428120" data-claire-element-id="428120"><a href="http://tutozero.free.fr/kinetic/tutos01/texte_12.html">Tester !</a></p><figure id="r-428122" data-claire-element-id="428123"><img id="r-428121" data-claire-element-id="428121" src="medias/uploads.siteduzero.com_files_409001_410000_409483.png" alt="Image utilisateur"/></figure><h5 id="r-boites" data-claire-element-id="428149">Boîtes</h5><p id="r-428125" data-claire-element-id="428125">On peut matérialiser visuellement la boîte qui contient le texte. Voici un exemple élémentaire :</p><pre id="r-428126" data-claire-element-id="428126"><code data-claire-semantic="javascript">var text = new Kinetic.Text({
  x: 40,
  y: 40,
  text: &quot;On peut visualiser la boîte qui contient le texte&quot;,
  fontSize: 20,
  fontFamily: &quot;Verdana&quot;,
  textFill: &quot;#3aa&quot;,
  width: 300,
  align: &quot;center&quot;,
  stroke: '#177',
  strokeWidth: 3,
});
calque.add(text);</code></pre><p id="r-428127" data-claire-element-id="428127"><a href="http://tutozero.free.fr/kinetic/tutos01/texte_08.html">Tester !</a></p><figure id="r-428129" data-claire-element-id="428130"><img id="r-428128" data-claire-element-id="428128" src="medias/uploads.siteduzero.com_files_409001_410000_409484.png" alt="Image utilisateur"/></figure><p id="r-428131" data-claire-element-id="428131">Il est possible de régler la distance entre le texte et la boîte avec la propriété <strong>padding </strong>:</p><pre id="r-428132" data-claire-element-id="428132"><code data-claire-semantic="javascript">var text = new Kinetic.Text({
  x: 40,
  y: 40,
  text: &quot;On peut aussi régler la distance entre le texte et la bordure&quot;,
  fontSize: 16,
  fontFamily: &quot;Verdana&quot;,
  textFill: &quot;#3aa&quot;,
  width: 300,
  align: &quot;center&quot;,
  stroke: '#177',
  strokeWidth: 3,
  padding: 10
});	
calque.add(text);</code></pre><p id="r-428133" data-claire-element-id="428133"><a href="http://tutozero.free.fr/kinetic/tutos01/texte_09.html">Tester !</a></p><figure id="r-428135" data-claire-element-id="428136"><img id="r-428134" data-claire-element-id="428134" src="medias/uploads.siteduzero.com_files_409001_410000_409486.png" alt="Image utilisateur"/></figure><p id="r-428137" data-claire-element-id="428137">Il est aussi plus joli d'arrondir les coins avec la propriété <strong>cornerRadius </strong>:</p><pre id="r-428138" data-claire-element-id="428138"><code data-claire-semantic="javascript">var text = new Kinetic.Text({
  x: 40,
  y: 40,
  text: &quot;C'est plus joli avec des arrondis&quot;,
  fontSize: 16,
  fontFamily: &quot;Verdana&quot;,
  textFill: &quot;magenta&quot;,
  width: 300,
  align: &quot;center&quot;,
  stroke: &quot;blueviolet&quot;,
  strokeWidth: 3,
  padding: 10,
  cornerRadius: 20
});
calque.add(text);</code></pre><p id="r-428139" data-claire-element-id="428139"><a href="http://tutozero.free.fr/kinetic/tutos01/texte_10.html">Tester !</a></p><figure id="r-428141" data-claire-element-id="428142"><img id="r-428140" data-claire-element-id="428140" src="medias/uploads.siteduzero.com_files_409001_410000_409487.png" alt="Image utilisateur"/></figure><p id="r-428143" data-claire-element-id="428143">Il est possible de remplir la boîte avec une couleur de fond avec la propriété <strong>fill </strong>:</p><pre id="r-428144" data-claire-element-id="428144"><code data-claire-semantic="javascript">var text = new Kinetic.Text({
  x: 40,
  y: 40,
  text: &quot;On peut aussi avoir un fond coloré&quot;,
  fontSize: 16,
  fontFamily: &quot;Verdana&quot;,
  textFill: &quot;magenta&quot;,
  width: 300,
  align: &quot;center&quot;,
  stroke: &quot;blueviolet&quot;,
  strokeWidth: 3,
  padding: 10,
  cornerRadius: 20,
  fill: &quot;lightgrey&quot;
});
calque.add(text);</code></pre><p id="r-428145" data-claire-element-id="428145"><a href="http://tutozero.free.fr/kinetic/tutos01/texte_11.html">Tester !</a></p><figure id="r-428147" data-claire-element-id="428148"><img id="r-428146" data-claire-element-id="428146" src="medias/uploads.siteduzero.com_files_409001_410000_409488.png" alt="Image utilisateur"/></figure><h5 id="r-suivre-un-chemin-svg" data-claire-element-id="428158">Suivre un chemin SVG</h5><p id="r-428150" data-claire-element-id="428150">Vous avez la possibilité de faire en sorte qu'un texte suive un chemin au format SVG de la forme que vous voulez avec la classe <strong>TextPath</strong>. Voici un exemple simple :</p><pre id="r-428151" data-claire-element-id="428151"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	var textpath = new Kinetic.TextPath({
		textFill: 'red',
		fontSize: '12',
		text: &quot;Un petit texte très sinueux&quot;,
		data: &quot;M 60,110 C 160,160 120,60 200,60&quot;,
		scale: 2
	});
	
	calque.add(textpath);
	scène.add(calque);
};</code></pre><p id="r-428152" data-claire-element-id="428152"><a href="http://tutozero.free.fr/kinetic/tutos01/texte_13.html">Tester !</a></p><figure id="r-428154" data-claire-element-id="428155"><img id="r-428153" data-claire-element-id="428153" src="medias/uploads.siteduzero.com_files_409001_410000_409489.png" alt="Image utilisateur"/></figure><p id="r-428156" data-claire-element-id="428156">Si vous vous posez des questions sur la mystérieuse valeur <strong>&quot;M 60,110 C 160,160 120,60 200,60&quot;</strong>, je vous conseille <a href="http://www.w3.org/TR/SVG/paths.html">cette lecture bénéfique</a> même si elle n'est pas vraiment très digeste :D .</p><p id="r-428157" data-claire-element-id="428157">Maintenant que notre infrastructure est en place nous allons pouvoir commencer à dessiner.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
<span class="arrow"></span>
<span class="next">Formes prédéfinies</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">
<span class="next">Tracés et images</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Tracsetimages"></a><h2>Tracés et images</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
<span class="arrow"></span>
<span class="next">Texte</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
<span class="next">Lignes</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-428161" data-claire-element-id="428161">Maintenant, nous allons voir comment dessiner en traçant des lignes, des courbes et également comment afficher des images.</p>
</div><a name="Lignes"></a><h2>Lignes</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">
<span class="arrow"></span>
<span class="next">Tracés et images</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
<span class="next">Shape : une classe à tout faire</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-lignes-1" data-claire-element-id="428207">Lignes</h4><h5 id="r-dessiner-une-ligne" data-claire-element-id="428168">Dessiner une ligne</h5><p id="r-428162" data-claire-element-id="428162">Voici un exemple :</p><pre id="r-428163" data-claire-element-id="428163"><code data-claire-semantic="javascript">var ligne = new Kinetic.Line({
  points: [60, 60, 140, 40, 370, 120, 320, 220],
  stroke: &quot;navy&quot;,
  strokeWidth: 4,
});
calque.add(ligne);</code></pre><p id="r-428164" data-claire-element-id="428164"><a href="http://tutozero.free.fr/kinetic/tutos01/ligne_01.html">Tester !</a></p><figure id="r-428166" data-claire-element-id="428167"><img id="r-428165" data-claire-element-id="428165" src="medias/uploads.siteduzero.com_files_409001_410000_409517.png" alt="Image utilisateur"/></figure><h5 id="r-jointures-3" data-claire-element-id="428183">Jointures</h5><p id="r-428169" data-claire-element-id="428169">Il y a 3 façons de raccorder les lignes qui sont définies avec la propriété <strong>lineJoin</strong>. Les valeurs sont :</p><ul id="r-428176" data-claire-element-id="428176"><li id="r-428171" data-claire-element-id="428171"><p id="r-428170" data-claire-element-id="428170">miter (valeur par défaut)</p></li><li id="r-428173" data-claire-element-id="428173"><p id="r-428172" data-claire-element-id="428172">round</p></li><li id="r-428175" data-claire-element-id="428175"><p id="r-428174" data-claire-element-id="428174">bevel</p></li></ul><p id="r-428177" data-claire-element-id="428177">Pour visualiser la différence, voici 3 lignes identiques avec des jointures différentes :</p><pre id="r-428178" data-claire-element-id="428178"><code data-claire-semantic="javascript">var ligne1 = new Kinetic.Line({
  points: [60, 80, 140, 40, 220, 80],
  stroke: &quot;hotpink&quot;,
  strokeWidth: 30,
  lineJoin: &quot;miter&quot;
});

var ligne2 = new Kinetic.Line({
  points: [60, 140, 140, 100, 220, 140],
  stroke: &quot;indianred&quot;,
  strokeWidth: 30,
  lineJoin: &quot;round&quot;
});

var ligne3 = new Kinetic.Line({
  points: [60, 200, 140, 160, 220, 200],
  stroke: &quot;indigo&quot;,
  strokeWidth: 30,
  lineJoin: &quot;bevel&quot;
});

calque.add(ligne1);
calque.add(ligne2);
calque.add(ligne3);</code></pre><p id="r-428179" data-claire-element-id="428179"><a href="http://tutozero.free.fr/kinetic/tutos01/ligne_02.html">Tester !</a></p><figure id="r-428181" data-claire-element-id="428182"><img id="r-428180" data-claire-element-id="428180" src="medias/uploads.siteduzero.com_files_409001_410000_409518.png" alt="Image utilisateur"/></figure><h5 id="r-extremites-de-lignes" data-claire-element-id="428198">Extrémités de lignes</h5><p id="r-428184" data-claire-element-id="428184">Il y a 3 façons de finir les lignes qui sont définies avec la propriété <strong>lineCap</strong>. Les valeurs sont :</p><ul id="r-428191" data-claire-element-id="428191"><li id="r-428186" data-claire-element-id="428186"><p id="r-428185" data-claire-element-id="428185">butt (valeur par défaut)</p></li><li id="r-428188" data-claire-element-id="428188"><p id="r-428187" data-claire-element-id="428187">round</p></li><li id="r-428190" data-claire-element-id="428190"><p id="r-428189" data-claire-element-id="428189">square</p></li></ul><p id="r-428192" data-claire-element-id="428192">Pour visualiser la différence voilà 3 lignes identiques avec des extrémités différentes :</p><pre id="r-428193" data-claire-element-id="428193"><code data-claire-semantic="javascript">var ligne1 = new Kinetic.Line({
  points: [60, 80, 140, 80],
  stroke: &quot;darkturquoise&quot;,
  strokeWidth: 30,
  lineCap: &quot;butt&quot;
});

var ligne2 = new Kinetic.Line({
  points: [60, 140, 140, 140],
  stroke: &quot;darkviolet&quot;,
  strokeWidth: 30,
  lineCap: &quot;round&quot;
});

var ligne3 = new Kinetic.Line({
  points: [60, 200, 140, 200],
  stroke: &quot;deeppink&quot;,
  strokeWidth: 30,
  lineCap: &quot;square&quot;
});

calque.add(ligne1);
calque.add(ligne2);
calque.add(ligne3);</code></pre><p id="r-428194" data-claire-element-id="428194"><a href="http://tutozero.free.fr/kinetic/tutos01/ligne_03.html">Tester !</a></p><figure id="r-428196" data-claire-element-id="428197"><img id="r-428195" data-claire-element-id="428195" src="medias/uploads.siteduzero.com_files_409001_410000_409519.png" alt="Image utilisateur"/></figure><h5 id="r-interruptions-de-lignes" data-claire-element-id="428206">Interruptions de lignes</h5><p id="r-428199" data-claire-element-id="428199">Nous avons vu jusque-là des lignes continues. Il est aussi possible de créer des interruptions pour obtenir des pointillés ou traits d'axe avec la propriété <strong>dashArray</strong>. Voici un exemple :</p><pre id="r-428200" data-claire-element-id="428200"><code data-claire-semantic="javascript">var ligne1 = new Kinetic.Line({
  points: [60, 80, 350, 40],
  stroke: &quot;seagreen&quot;,
  strokeWidth: 5,
  dashArray: [30, 5]
});

var ligne2 = new Kinetic.Line({
  points: [60, 140, 350, 100],
  stroke: &quot;skyblue&quot;,
  strokeWidth: 5,
  dashArray: [40, 20, 10, 20]
});

var ligne3 = new Kinetic.Line({
  points: [60, 200, 350, 160],
  stroke: &quot;teal&quot;,
  strokeWidth: 5,
  lineCap: &quot;round&quot;,
  dashArray: [30, 20, 0, 20]
});

calque.add(ligne1);
calque.add(ligne2);
calque.add(ligne3);</code></pre><p id="r-428201" data-claire-element-id="428201"><a href="http://tutozero.free.fr/kinetic/tutos01/ligne_04.html">Tester !</a></p><figure id="r-428203" data-claire-element-id="428204"><img id="r-428202" data-claire-element-id="428202" src="medias/uploads.siteduzero.com_files_409001_410000_409520.png" alt="Image utilisateur"/></figure><p id="r-428205" data-claire-element-id="428205">Il suffit de définir un tableau de valeurs pour la propriété <strong>dashArray</strong>. Les valeurs sont par couples de lignes visibles puis invisibles. Par exemple la ligne 1 ci-dessus a des zones visibles de 30 pixels suivies de zones invisibles de 5 pixels. Pour la ligne 2 on a deux couples de valeurs, ce qui permet d'obtenir un effet de trait d'axe. Pour la ligne 3 il a fallu définir un <strong>lineCap </strong>arrondi pour rendre les points visibles (valeurs à 0).</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">
<span class="arrow"></span>
<span class="next">Tracés et images</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
<span class="next">Shape : une classe à tout faire</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Shapeuneclassetoutfaire"></a><h2>Shape : une classe à tout faire</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
<span class="arrow"></span>
<span class="next">Lignes</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
<span class="next">Images</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-shape-une-classe-a-tout-faire" data-claire-element-id="428274">Shape : une classe à tout faire</h4><h5 id="r-arcs" data-claire-element-id="428235">Arcs</h5><h6 id="r-arc" data-claire-element-id="428223">arc()</h6><p id="r-428208" data-claire-element-id="428208">Au chapitre précédent nous avons vu comment créer des cercles en jouant sur le rayon, le style du trait et le remplissage. Maintenant, voyons comment dessiner des arcs de cercle, autrement dit des morceaux de cercle. La classe utilisée est maintenant <strong>Shape</strong> qui est une classe très générale qui permet d'utiliser les commandes génériques de l'API de <strong>Canvas</strong>. Cette classe attend comme propriété une fonction de dessin. <strong>Canvas </strong>propose deux méthodes pour dessiner des arcs de cercle, voici la première :</p><pre id="r-428209" data-claire-element-id="428209"><code data-claire-semantic="javascript">var arc = new Kinetic.Shape({
  drawFunc: function(context) {
	context.arc(160, 140, 120, Math.PI, 2 * Math.PI);
	this.stroke(context);
  },
  stroke: &quot;rgb(160,60,0)&quot;,
  strokeWidth: 4,
});

calque.add(arc);</code></pre><p id="r-428210" data-claire-element-id="428210"><a href="http://tutozero.free.fr/kinetic/tutos01/shape_01.html">Tester !</a></p><figure id="r-428212" data-claire-element-id="428213"><img id="r-428211" data-claire-element-id="428211" src="medias/uploads.siteduzero.com_files_409001_410000_409521.png" alt="Image utilisateur"/></figure><p id="r-428214" data-claire-element-id="428214">Pour le dessin d'un arc, la librairie utilise la méthode de l'API de <strong>Canvas</strong>. Le contexte est récupéré comme paramètre de la fonction de dessin :</p><pre id="r-428215" data-claire-element-id="428215"><code data-claire-semantic="javascript">drawFunc: function(context)</code></pre><p id="r-428216" data-claire-element-id="428216">Le contexte est ensuite utilisé pour appeler la méthode <strong>arc </strong>de <strong>Canvas </strong>qui est de cette forme :</p><p id="r-428217" data-claire-element-id="428217">context.arc(Position X du centre, Position Y du centre, Rayon, Angle de départ, Angle d'arrivée, Sens de rotation (optionnel));<br/> Voyons maintenant un autre exemple avec une rotation inversée et d'autres angles :</p><pre id="r-428218" data-claire-element-id="428218"><code data-claire-semantic="javascript">var arc = new Kinetic.Shape({
  drawFunc: function(context) {
	context.arc(160, 140, 120, 3 * Math.PI / 4, Math.PI / 4, true);
	this.stroke(context);
  },
  stroke: &quot;rgb(160,60,0)&quot;,
  strokeWidth: 4,
});
calque.add(arc);</code></pre><p id="r-428219" data-claire-element-id="428219"><a href="http://tutozero.free.fr/kinetic/tutos01/shape_02.html">Tester !</a></p><figure id="r-428221" data-claire-element-id="428222"><img id="r-428220" data-claire-element-id="428220" src="medias/uploads.siteduzero.com_files_409001_410000_409522.png" alt="Image utilisateur"/></figure><h6 id="r-arcto" data-claire-element-id="428234">arcTo()</h6><p id="r-428224" data-claire-element-id="428224">La deuxième possibilité pour dessiner un arc de cercle avec <strong>Canvas </strong>est la méthode <strong>arcTo </strong>:</p><pre id="r-428225" data-claire-element-id="428225"><code data-claire-semantic="javascript">var arc = new Kinetic.Shape({
  drawFunc: function(context) {
	context.moveTo(100, 240);
	context.arcTo(200, 140, 20, 40, 60);
	this.stroke(context);
  },
  stroke: &quot;rgb(160,60,0)&quot;,
  strokeWidth: 4,
});
calque.add(arc);</code></pre><p id="r-428226" data-claire-element-id="428226"><a href="http://tutozero.free.fr/kinetic/tutos01/shape_03.html">Tester !</a></p><figure id="r-428228" data-claire-element-id="428229"><img id="r-428227" data-claire-element-id="428227" src="medias/uploads.siteduzero.com_files_409001_410000_409523.png" alt="Image utilisateur"/></figure><p id="r-428230" data-claire-element-id="428230">Cette méthode est moins évidente à comprendre que la précédente. Voyons ça de plus près. On commence par positionner le stylo sur le point de référence de la première tangente :</p><pre id="r-428231" data-claire-element-id="428231"><code data-claire-semantic="javascript">context.moveTo(100, 240);</code></pre><p id="r-428232" data-claire-element-id="428232">Ensuite on utilise la méthode <strong>arcTo </strong>qui référence dans l'ordre : le point d'intersection des deux tangentes, le point de référence de la deuxième tangente et le rayon de courbure de l'arc :</p><pre id="r-428233" data-claire-element-id="428233"><code data-claire-semantic="javascript">context.arcTo(200, 140, 20, 40, 60);</code></pre><h5 id="r-courbes" data-claire-element-id="428255">Courbes</h5><h6 id="r-courbe-quadratique" data-claire-element-id="428247">Courbe quadratique</h6><p id="r-428236" data-claire-element-id="428236">Un arc de cercle c'est bien, mais il faut parfois dessiner des courbes un peu plus élaborées. Une première option consiste à tracer une courbe quadratique :</p><pre id="r-428237" data-claire-element-id="428237"><code data-claire-semantic="javascript">var arc = new Kinetic.Shape({
  drawFunc: function(context) {
	context.moveTo(150, 180);
	context.quadraticCurveTo(200, 10, 400, 160);
	this.stroke(context);
  },
  stroke: &quot;rgb(160,60,0)&quot;,
  strokeWidth: 4,
});

calque.add(arc);</code></pre><p id="r-428238" data-claire-element-id="428238"><a href="http://tutozero.free.fr/kinetic/tutos01/shape_04.html">Tester !</a></p><figure id="r-428240" data-claire-element-id="428241"><img id="r-428239" data-claire-element-id="428239" src="medias/uploads.siteduzero.com_files_409001_410000_409524.png" alt="Image utilisateur"/></figure><p id="r-428242" data-claire-element-id="428242">On commence par positionner le premier point de la courbe avec la commande :</p><pre id="r-428243" data-claire-element-id="428243"><code data-claire-semantic="javascript">context.moveTo(150, 180);</code></pre><p id="r-428244" data-claire-element-id="428244">Il faut imaginer que vous avez un stylo à disposition et que vous le positionnez sur ce point. Ensuite la courbe est dessinée en précisant le point d'arrivée et le point de contrôle (intersection des deux tangentes) :</p><pre id="r-428245" data-claire-element-id="428245"><code data-claire-semantic="javascript">context.quadraticCurveTo(200, 10, 400, 160);</code></pre><p id="r-428246" data-claire-element-id="428246">Si vous désirez en savoir plus sur les courbes quadratiques, il y a pas mal d'information sur Internet par exemple <a href="http://pilatinfo.org/learnsvg/html/chapitre04/page04-1.htm">ici</a>.</p><h6 id="r-courbe-de-bezier" data-claire-element-id="428254">Courbe de Bézier</h6><p id="r-428248" data-claire-element-id="428248">On peut créer des courbes encore plus élaborées en utilisant des courbes de Bézier. Cette fois on a deux points de contrôle :</p><pre id="r-428249" data-claire-element-id="428249"><code data-claire-semantic="javascript">var arc = new Kinetic.Shape({
  drawFunc: function(context) {
	context.moveTo(150, 220);
	context.bezierCurveTo(160, 60, 400, 20, 440, 170);
	this.stroke(context);
  },
  stroke: &quot;rgb(160,60,0)&quot;,
  strokeWidth: 4,
});

calque.add(arc);</code></pre><p id="r-428250" data-claire-element-id="428250"><a href="http://tutozero.free.fr/kinetic/tutos01/shape_05.html">Tester !</a></p><figure id="r-428252" data-claire-element-id="428253"><img id="r-428251" data-claire-element-id="428251" src="medias/uploads.siteduzero.com_files_409001_410000_409525.png" alt="Image utilisateur"/></figure><h5 id="r-combinaisons" data-claire-element-id="428273">Combinaisons</h5><h6 id="r-un-parapluie" data-claire-element-id="428265">Un parapluie</h6><p id="r-428256" data-claire-element-id="428256">On va partir de la base de la forme précédente pour dessiner un parapluie. Voici le code complet (le code ajouté est surligné) :</p><pre id="r-428257" data-claire-element-id="428257"><code data-claire-semantic="javascript">var parapluie = new Kinetic.Shape({
  drawFunc: function(context) {
	context.beginPath();
	context.arc(160, 140, 120, 1.1 * Math.PI, 1.9 * Math.PI);
	context.closePath();
	this.fill(context),
	context.moveTo(160, 104),
	context.arc(175, 240, 15, Math.PI, 2 * Math.PI, true);
	this.stroke(context);
  },
  fill: &quot;rgb(240,140,0)&quot;,
  stroke: &quot;rgb(160,60,0)&quot;,
  strokeWidth: 4,
});
calque.add(parapluie);</code></pre><p id="r-428258" data-claire-element-id="428258"><a href="http://tutozero.free.fr/kinetic/tutos01/shape_07.html">Tester !</a></p><figure id="r-428260" data-claire-element-id="428261"><img id="r-428259" data-claire-element-id="428259" src="medias/uploads.siteduzero.com_files_409001_410000_409526.png" alt="Image utilisateur"/></figure><p id="r-428262" data-claire-element-id="428262">A la fin du dessin du morceau de disque, le stylo se trouve à l'extrémité gauche (représenté par le point noir). Il faut donc le déplacer au milieu pour tracer le manche :</p><pre id="r-428263" data-claire-element-id="428263"><code data-claire-semantic="javascript">context.moveTo(160, 104),</code></pre><p id="r-428264" data-claire-element-id="428264">Ensuite le fait de dessiner l'arc de cercle de la crosse provoque la liaison par un trait entre la position du stylo et le début de l'arc. Il est donc inutile de se préoccuper de ce trait.</p><h6 id="r-un-panier" data-claire-element-id="428272">Un panier</h6><p id="r-428266" data-claire-element-id="428266">Voyons maintenant un autre exemple simple avec un panier stylisé composé d'une courbe quadratique pour l'anse et un polygone pour le corps :</p><pre id="r-428267" data-claire-element-id="428267"><code data-claire-semantic="javascript">var anse = new Kinetic.Shape({
  drawFunc: function(context) {
	context.moveTo(100, 120);
	context.quadraticCurveTo(180, -80, 260, 120);
	this.stroke(context);
  },
  stroke: &quot;orange&quot;,
  strokeWidth: 10,
});


var corps = new Kinetic.Polygon({
  points: [60, 110, 300, 110, 280, 240, 80, 240],
  fill: &quot;#00D2FF&quot;,
  fill: &quot;#b90&quot;,
});

calque.add(anse);
calque.add(corps);</code></pre><p id="r-428268" data-claire-element-id="428268"><a href="http://tutozero.free.fr/kinetic/tutos01/shape_08.html">Tester !</a></p><figure id="r-428270" data-claire-element-id="428271"><img id="r-428269" data-claire-element-id="428269" src="medias/uploads.siteduzero.com_files_409001_410000_409527.png" alt="Image utilisateur"/></figure>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
<span class="arrow"></span>
<span class="next">Lignes</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
<span class="next">Images</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Images"></a><h2>Images</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
<span class="arrow"></span>
<span class="next">Shape : une classe à tout faire</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">
<span class="next">Style</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-images-3" data-claire-element-id="428293">Images</h4><h5 id="r-exemple-de-base" data-claire-element-id="428281">Exemple de base</h5><p id="r-428275" data-claire-element-id="428275">Voici un exemple :</p><pre id="r-428276" data-claire-element-id="428276"><code data-claire-semantic="javascript">var img = new Image();
img.onload = function() {
  var image = new Kinetic.Image({
     x: 40,
     y: 40,
     image: img,
     width: 120,
     height: 120
  });

  calque.add(image);
  scène.add(calque);
};
img.src = &quot;images/kineticjs-bolt-sticker.png&quot;;</code></pre><p id="r-428277" data-claire-element-id="428277"><a href="http://tutozero.free.fr/kinetic/tutos01/image_01.html">Tester !</a></p><figure id="r-428279" data-claire-element-id="428280"><img id="r-428278" data-claire-element-id="428278" src="medias/uploads.siteduzero.com_files_409001_410000_409528.png" alt="Image utilisateur"/></figure><h5 id="r-charger-plusieurs-images" data-claire-element-id="428288">Charger plusieurs images</h5><p id="r-428282" data-claire-element-id="428282">Lorsqu'il y a plusieurs <strong>images</strong> à charger il faut prendre la précaution d'attendre le chargement complet des images avant d'initialiser les objets image de <strong>KineticJS</strong>. Voici un exemple avec 3 images :</p><pre id="r-428283" data-claire-element-id="428283"><code data-claire-semantic="javascript">// Chargement des images
function load_images(sources, callback) {
	var images = new Array();
	var loadedImages = 0;
	sources.forEach(function(value, index) {
		images[index] = new Image();
		images[index].onload = function() {
			if(++loadedImages &gt;= sources.length) callback(images);
		};
		images[index].src = value;
	});
}	
// Initialisation de la scène
function init_scène(images) {
	var scène = new Kinetic.Stage({
		container: &quot;kinetic&quot;,
		width: 500,
		height: 300
	});
	var calque = new Kinetic.Layer();
	images.forEach(function(value, index) {
		var image = new Kinetic.Image({
			x: 40 + index * 144,
			y: 80,
			image: value,
			width: 128,
			height: 128
		});
		calque.add(image);
	});
	scène.add(calque);
}
// Chargement de la page
window.onload = function() {
	var sources_img =  [
		&quot;images/img01.jpg&quot;,
		&quot;images/img02.jpg&quot;,
		&quot;images/img03.jpg&quot;,
	];
	load_images(sources_img, init_scène);
}</code></pre><p id="r-428284" data-claire-element-id="428284"><a href="http://tutozero.free.fr/kinetic/tutos01/image_03.html">Tester !</a></p><figure id="r-428286" data-claire-element-id="428287"><img id="r-428285" data-claire-element-id="428285" src="medias/uploads.siteduzero.com_files_409001_410000_409529.png" alt="Image utilisateur"/></figure><h5 id="r-utilisation-d-un-plugin-pour-le-chargement-des-images" data-claire-element-id="428292">Utilisation d'un plugin pour le chargement des images</h5><p id="r-428289" data-claire-element-id="428289">J'ai trouvé un petit plugin intéressant pour le chargement des images. Vous pouvez le charger <a href="../../raw.githubusercontent.com/BlackScorp/tiled2crafty/gh-pages/kinetic/js/libs/Loader.js">ici</a>. Lorsqu'on l'utilise le code devient tout de suite plus léger pour le même résultat que le code précédent :</p><pre id="r-428290" data-claire-element-id="428290"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
		container: &quot;kinetic&quot;,
		width: 500,
		height: 300
	});
	var calque = new Kinetic.Layer();
	scène.add(calque);
		
	var toLoad = [
		{id:&quot;myImage1&quot;,src:&quot;images/img01.jpg&quot;},
		{id:&quot;myImage2&quot;,src:&quot;images/img02.jpg&quot;},
		{id:&quot;myImage3&quot;,src:&quot;images/img03.jpg&quot;},
	];
	
	var loader = new Kinetic.Loader(toLoad);
	
	loader.onComplete(function(){
		var index = 0;
		for(var key in Kinetic.Assets) {
			var image = new Kinetic.Image({
				x: 40 + index,
				y: 80,
				image: Kinetic.Assets[key],
				width: 128,
				height: 128
			});
			index += 144;
			calque.add(image);	
		}
		calque.draw();
	});
	
	loader.load();
 }</code></pre><p id="r-428291" data-claire-element-id="428291"><a href="http://tutozero.free.fr/kinetic/tutos01/image_03a.html">Tester !</a><br/> Notez que ce plugin permet aussi de connaître le pourcentage de chargement, le nombre d'images chargées et le nombre total d'images à charger avec son événement <strong>onProgress</strong>.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
<span class="arrow"></span>
<span class="next">Shape : une classe à tout faire</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">
<span class="next">Style</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Style"></a><h2>Style</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
<span class="arrow"></span>
<span class="next">Images</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
<span class="next">Traits et remplissage</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-428295" data-claire-element-id="428295">Dans cette partie, nous allons voir comment remplir des formes avec des couleurs unies ou des dégradés et comment donner des effets de transparence et des ombrages.</p>
</div><a name="Traitsetremplissage"></a><h2>Traits et remplissage</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">
<span class="arrow"></span>
<span class="next">Style</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
<span class="next">Opacité et ombre</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-traits-et-remplissage" data-claire-element-id="428381">Traits et remplissage</h4><h5 id="r-traits-1" data-claire-element-id="428311">Traits</h5><p id="r-428296" data-claire-element-id="428296">Nous avons déjà vu comment dessiner des traits. voici un nouvel exemple simple :</p><pre id="r-428297" data-claire-element-id="428297"><code data-claire-semantic="javascript">var ligne = new Kinetic.Line({
  points: [60, 60, 360, 60],
  stroke: &quot;#aa4&quot;,
  strokeWidth: 6
});
calque.add(ligne);</code></pre><p id="r-428298" data-claire-element-id="428298"><a href="http://tutozero.free.fr/kinetic/tutos02/style_stroke_01.html">Tester !</a></p><figure id="r-428300" data-claire-element-id="428301"><img id="r-428299" data-claire-element-id="428299" src="medias/uploads.siteduzero.com_files_409001_410000_409531.png" alt="Image utilisateur"/></figure><p id="r-428302" data-claire-element-id="428302">L'épaisseur du trait est donnée par la propriété <strong>strokeWidth </strong>et sa couleur par la propriété <strong>stroke</strong>. Voici un nouveau code pour un résultat identique :</p><pre id="r-428303" data-claire-element-id="428303"><code data-claire-semantic="javascript">var ligne = new Kinetic.Line({
  points: [60, 60, 360, 60]
});
		
ligne.setStrokeWidth(6);
ligne.setStroke(&quot;#aa4&quot;);

calque.add(ligne);</code></pre><p id="r-428304" data-claire-element-id="428304"><a href="http://tutozero.free.fr/kinetic/tutos02/style_stroke_02.html">Tester !</a><br/> Cette fois on a pas utilisé les propriétés dans le constructeur, mais des setters ensuite dans le code. Pratiquement toutes les propriétés dans <strong>KineticJS </strong>bénéficient de getters et setters.</p><p id="r-428305" data-claire-element-id="428305">Voici un autre exemple :</p><pre id="r-428306" data-claire-element-id="428306"><code data-claire-semantic="javascript">var ligne1 = new Kinetic.Line({
  points: [60, 60, 360, 60],
  stroke: &quot;blue&quot;,
  strokeWidth: 4
});

var ligne2 = new Kinetic.Line({
  points: [60, 160, 360, 160],
});

ligne2.setStrokeWidth(ligne1.getStrokeWidth() + 4);
ligne2.setStroke(ligne1.getStroke());

calque.add(ligne1);
calque.add(ligne2);</code></pre><p id="r-428307" data-claire-element-id="428307"><a href="http://tutozero.free.fr/kinetic/tutos02/style_stroke_03.html">Tester !</a></p><figure id="r-428309" data-claire-element-id="428310"><img id="r-428308" data-claire-element-id="428308" src="medias/uploads.siteduzero.com_files_409001_410000_409532.png" alt="Image utilisateur"/></figure><h5 id="r-remplissage-uni" data-claire-element-id="428326">Remplissage uni</h5><p id="r-428312" data-claire-element-id="428312">Nous avons également vu précédemment comment effectuer un remplissage uni. Par exemple comme ceci :</p><pre id="r-428313" data-claire-element-id="428313"><code data-claire-semantic="javascript">var rectangle = new Kinetic.Rect({
  x: 50,
  y: 50,
  width: 140,
  height: 60,
  fill: &quot;blue&quot;
});
calque.add(rectangle);</code></pre><p id="r-428314" data-claire-element-id="428314"><a href="http://tutozero.free.fr/kinetic/tutos02/style_fill_01.html">Tester !</a></p><figure id="r-428316" data-claire-element-id="428317"><img id="r-428315" data-claire-element-id="428315" src="medias/uploads.siteduzero.com_files_409001_410000_409533.png" alt="Image utilisateur"/></figure><p id="r-428318" data-claire-element-id="428318">Il suffit de renseigner la propriété <strong>fill </strong>avec au choix : un nom de couleur, une valeur hexadécimale ou une valeur obtenue avec la fonction <strong>rgb</strong>. Voici un nouveau code pour un résultat identique :</p><pre id="r-428319" data-claire-element-id="428319"><code data-claire-semantic="javascript">var rectangle = new Kinetic.Rect({
  x: 50,
  y: 50,
  width: 140,
  height: 60
});

rectangle.setFill(&quot;blue&quot;);

calque.add(rectangle);</code></pre><p id="r-428320" data-claire-element-id="428320"><a href="http://tutozero.free.fr/kinetic/tutos02/style_fill_02.html">Tester !</a><br/> Cette fois on a fait appel à un setter. Voici un autre exemple :</p><pre id="r-428321" data-claire-element-id="428321"><code data-claire-semantic="javascript">var rectangle = new Kinetic.Rect({
  x: 50,
  y: 50,
  width: 140,
  height: 60,
  fill: &quot;orange&quot;
});

var ellipse = new Kinetic.Ellipse({
  x: 120,
  y: 200,
  radius: {
	  x: 80,
	  y: 50
	}
});

ellipse.setFill(rectangle.getFill());

calque.add(rectangle);
calque.add(ellipse);</code></pre><p id="r-428322" data-claire-element-id="428322"><a href="http://tutozero.free.fr/kinetic/tutos02/style_fill_03.html">Tester !</a></p><figure id="r-428324" data-claire-element-id="428325"><img id="r-428323" data-claire-element-id="428323" src="medias/uploads.siteduzero.com_files_409001_410000_409535.png" alt="Image utilisateur"/></figure><h5 id="r-degrade-lineaire" data-claire-element-id="428360">Dégradé linéaire</h5><p id="r-428327" data-claire-element-id="428327">Voici un premier exemple :</p><pre id="r-428328" data-claire-element-id="428328"><code data-claire-semantic="javascript">var forme = new Kinetic.Rect({
  width: 500,
  height: 300,
  fill: {
	start: {
	  x: 0,
	  y: 150
	},
	end: {
	  x: 500,
	  y: 150
	},
	colorStops: [0, &quot;red&quot;, .5, &quot;yellow&quot;, 1, &quot;green&quot;]
  },
  stroke: &quot;black&quot;,
  strokeWidth: 2,
});
calque.add(forme);</code></pre><p id="r-428329" data-claire-element-id="428329"><a href="http://tutozero.free.fr/kinetic/tutos02/style_fill_04.html">Tester !</a></p><figure id="r-428331" data-claire-element-id="428332"><img id="r-428330" data-claire-element-id="428330" src="medias/uploads.siteduzero.com_files_409001_410000_409536.png" alt="Image utilisateur"/></figure><p id="r-428333" data-claire-element-id="428333">Il faut définir le point de départ avec la propriété <strong>start</strong> et le point d'arrivée avec la propriété <strong>end</strong>. Il faut aussi définir les couleurs utilisées et leur positionnement avec une valeur allant de 0 à 1.</p><p id="r-428334" data-claire-element-id="428334">On peut obtenir un dégradé vertical tout simplement en choisissant judicieusement les points de départ et d'arrivée :</p><pre id="r-428335" data-claire-element-id="428335"><code data-claire-semantic="javascript">fill: {
	start: {
	  x: 250,
	  y: 0
	},
	end: {
	  x: 250,
	  y: 300
	},
	colorStops: [0, &quot;red&quot;, .5, &quot;yellow&quot;, 1, &quot;green&quot;]
  }</code></pre><p id="r-428336" data-claire-element-id="428336"><a href="http://tutozero.free.fr/kinetic/tutos02/style_fill_05.html">Tester !</a></p><figure id="r-428338" data-claire-element-id="428339"><img id="r-428337" data-claire-element-id="428337" src="medias/uploads.siteduzero.com_files_409001_410000_409537.png" alt="Image utilisateur"/></figure><p id="r-428340" data-claire-element-id="428340">Et pourquoi pas en oblique ? Cette fois pour changer un peu j'utilise un setter :</p><pre id="r-428341" data-claire-element-id="428341"><code data-claire-semantic="javascript">var forme = new Kinetic.Rect({
  width: 500,
  height: 300,
  stroke: &quot;black&quot;,
  strokeWidth: 2,
});

forme.setFill({
	start: {
	  x: 0,
	  y: 0
	},
	end: {
	  x: 500,
	  y: 300
	},
	colorStops: [0, &quot;red&quot;, .5, &quot;yellow&quot;, 1, &quot;green&quot;]
  });
calque.add(forme);</code></pre><p id="r-428342" data-claire-element-id="428342"><a href="http://tutozero.free.fr/kinetic/tutos02/style_fill_06.html">Tester !</a></p><figure id="r-428344" data-claire-element-id="428345"><img id="r-428343" data-claire-element-id="428343" src="medias/uploads.siteduzero.com_files_409001_410000_409538.png" alt="Image utilisateur"/></figure><p id="r-428346" data-claire-element-id="428346">Jusque là j'ai fait en sorte que les points d'arrivée et de départ coïncident avec la limite du dessin. Que se passe-t-il si ce n'est pas le cas ?</p><pre id="r-428347" data-claire-element-id="428347"><code data-claire-semantic="javascript">fill: {
   start: {
     x: -200,
     y: 150
   },
   end: {
     x: 700,
     y: 150
   },
   colorStops: [0, &quot;red&quot;, .5, &quot;yellow&quot;, 1, &quot;green&quot;]
}</code></pre><p id="r-428348" data-claire-element-id="428348"><a href="http://tutozero.free.fr/kinetic/tutos02/style_fill_07.html">Tester !</a></p><figure id="r-428350" data-claire-element-id="428351"><img id="r-428349" data-claire-element-id="428349" src="medias/uploads.siteduzero.com_files_409001_410000_409539.png" alt="Image utilisateur"/></figure><p id="r-428352" data-claire-element-id="428352">On se rend compte que le dégradé s'étale au-delà de la surface visible, on n'en voit donc qu'une partie.</p><p id="r-428353" data-claire-element-id="428353">Est-ce qu'on peut faire un joli arc-en-ciel aussi ?</p><pre id="r-428354" data-claire-element-id="428354"><code data-claire-semantic="javascript">fill: {
	start: {
	  x: 0,
	  y: 150
	},
	end: {
	  x: 500,
	  y: 150
	},
	colorStops: [
		0, &quot;#f77&quot;,
		.25, &quot;#ff7&quot;,
		.5, &quot;#7f7&quot;,
		.75, &quot;#7ff&quot;,
		1, &quot;#77f&quot;
	]
  },</code></pre><p id="r-428355" data-claire-element-id="428355"><a href="http://tutozero.free.fr/kinetic/tutos02/style_fill_08.html">Tester !</a></p><figure id="r-428357" data-claire-element-id="428358"><img id="r-428356" data-claire-element-id="428356" src="medias/uploads.siteduzero.com_files_409001_410000_409540.png" alt="Image utilisateur"/></figure><p id="r-428359" data-claire-element-id="428359">Plutôt joli non ? :p</p><h5 id="r-degrade-radial" data-claire-element-id="428380">Dégradé radial</h5><p id="r-428361" data-claire-element-id="428361">Voyons maintenant les dégradés radiaux. Voici un premier exemple :</p><pre id="r-428362" data-claire-element-id="428362"><code data-claire-semantic="javascript">var forme = new Kinetic.Rect({
  width: 500,
  height: 300,
  fill: {
	start: {
	  x: 250,
	  y: 150,
	  radius: 0
	},
	end: {
	  x: 250,
	  y: 150,
	  radius: 250
	},
	colorStops: [0, &quot;blue&quot;, .5, &quot;cyan&quot;, 1, &quot;green&quot;]
  },
  stroke: &quot;black&quot;,
  strokeWidth: 2,
});</code></pre><p id="r-428363" data-claire-element-id="428363"><a href="http://tutozero.free.fr/kinetic/tutos02/style_fill_09.html">Tester !</a></p><figure id="r-428365" data-claire-element-id="428366"><img id="r-428364" data-claire-element-id="428364" src="medias/uploads.siteduzero.com_files_409001_410000_409542.png" alt="Image utilisateur"/></figure><p id="r-428367" data-claire-element-id="428367">Ici encore on définit un départ et une arrivée, mais ce n'est plus seulement un point comme pour le dégradé linéaire, maintenant c'est un cercle dont on définit le centre et le rayon.</p><p id="r-428368" data-claire-element-id="428368">Voici un autre exemple en changeant les rayons :</p><pre id="r-428369" data-claire-element-id="428369"><code data-claire-semantic="javascript">fill: {
	start: {
	  x: 250,
	  y: 150,
	  radius: 50
	},
	end: {
	  x: 250,
	  y: 150,
	  radius: 200
	},
	colorStops: [0, &quot;blue&quot;, .5, &quot;cyan&quot;, 1, &quot;green&quot;]
  },</code></pre><p id="r-428370" data-claire-element-id="428370"><a href="http://tutozero.free.fr/kinetic/tutos02/style_fill_10.html">Tester !</a></p><figure id="r-428372" data-claire-element-id="428373"><img id="r-428371" data-claire-element-id="428371" src="medias/uploads.siteduzero.com_files_409001_410000_409543.png" alt="Image utilisateur"/></figure><p id="r-428374" data-claire-element-id="428374">On peut créer des effets sympathiques en jouant sur les valeurs :</p><pre id="r-428375" data-claire-element-id="428375"><code data-claire-semantic="javascript">fill: {
	start: {
	  x: 250,
	  y: 0,
	  radius: 30
	},
	end: {
	  x: 250,
	  y: 450,
	  radius: 200
	},
	colorStops: [0, &quot;blue&quot;, .5, &quot;cyan&quot;, 1, &quot;green&quot;]
  },</code></pre><p id="r-428376" data-claire-element-id="428376"><a href="http://tutozero.free.fr/kinetic/tutos02/style_fill_11.html">Tester !</a></p><figure id="r-428378" data-claire-element-id="428379"><img id="r-428377" data-claire-element-id="428377" src="medias/uploads.siteduzero.com_files_409001_410000_409544.png" alt="Image utilisateur"/></figure>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">
<span class="arrow"></span>
<span class="next">Style</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
<span class="next">Opacité et ombre</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Opacitetombre"></a><h2>Opacité et ombre</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
<span class="arrow"></span>
<span class="next">Traits et remplissage</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">
<span class="next">Manipulations</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-opacite-et-ombre" data-claire-element-id="428432">Opacité et ombre</h4><h5 id="r-opacite-1" data-claire-element-id="428394">Opacité</h5><p id="r-428382" data-claire-element-id="428382">On peut rendre une forme transparente en jouant sur sa propriété <strong>opacity </strong>avec une valeur allant de 0 (totalement transparent) à 1 (opaque):</p><pre id="r-428383" data-claire-element-id="428383"><code data-claire-semantic="javascript">var cercle = new Kinetic.Ellipse({
  x: 140,
  y: 100,
  radius: 80,
  fill: &quot;#f00&quot;,
  opacity: .5
});

var rectangle = new Kinetic.Rect({
  x: 160,
  y: 100,
  width: 200,
  height: 120,
  fill: &quot;yellow&quot;,
  opacity: .8
});

calque.add(rectangle);
calque.add(cercle);</code></pre><p id="r-428384" data-claire-element-id="428384"><a href="http://tutozero.free.fr/kinetic/tutos02/style_alpha_01.html">Tester !</a></p><figure id="r-428386" data-claire-element-id="428387"><img id="r-428385" data-claire-element-id="428385" src="medias/uploads.siteduzero.com_files_409001_410000_409545.png" alt="Image utilisateur"/></figure><p id="r-428388" data-claire-element-id="428388">On peut utiliser les setters pour définir la valeur de la transparence comme je l'ai fait dans cet exemple évoquant la synthèse soustractive des couleurs :</p><pre id="r-428389" data-claire-element-id="428389"><code data-claire-semantic="javascript">for(i = 0; i &lt; 3; ++i) {
	var cercle = new Kinetic.Ellipse({
	  radius: 80,
	  opacity: .33
	});	
	switch(i) {
		case 0:
			cercle.setX(140);
			cercle.setY(100);
			cercle.setFill(&quot;#f00&quot;);
		break;	
		case 1:
			cercle.setX(240);
			cercle.setY(100);
			cercle.setFill(&quot;#0f0&quot;);
		break;
		case 2:
			cercle.setX(190);
			cercle.setY(200);
			cercle.setFill(&quot;#00f&quot;);
	}
	calque.add(cercle);
}</code></pre><p id="r-428390" data-claire-element-id="428390"><a href="http://tutozero.free.fr/kinetic/tutos02/style_alpha_02.html">Tester !</a></p><figure id="r-428392" data-claire-element-id="428393"><img id="r-428391" data-claire-element-id="428391" src="medias/uploads.siteduzero.com_files_409001_410000_409546.png" alt="Image utilisateur"/></figure><h5 id="r-ombre" data-claire-element-id="428431">Ombre</h5><p id="r-428395" data-claire-element-id="428395">Il y a la propriété <strong>shadow </strong>pour créer une ombre :</p><pre id="r-428396" data-claire-element-id="428396"><code data-claire-semantic="javascript">var cercle = new Kinetic.Ellipse({
  x: 100,
  y: 80,
  radius: 40,
  fill: &quot;black&quot;,
  shadow: {
	  color: &quot;grey&quot;,
	  blur: 12,
	  offset: [8, 8],
	  opacity: 0.7
  }
});

var rectangle = new Kinetic.Rect({
  x: 90,
  y: 100,
  width: 200,
  height: 70,
  fill: &quot;yellow&quot;,
  opacity: .7
});

rectangle.setShadow({
	color: &quot;grey&quot;,
	blur: 12,
	offset: [8, 8],
	opacity: 0.7
});
	
calque.add(rectangle);
calque.add(cercle);</code></pre><p id="r-428397" data-claire-element-id="428397"><a href="http://tutozero.free.fr/kinetic/tutos02/style_border_01.html">Tester !</a></p><figure id="r-428399" data-claire-element-id="428400"><img id="r-428398" data-claire-element-id="428398" src="medias/uploads.siteduzero.com_files_409001_410000_409547.png" alt="Image utilisateur"/></figure><p id="r-428401" data-claire-element-id="428401">Pour le cercle j'ai utilisé directement la propriété dans le constructeur et pour le rectangle j'ai utilisé un setter.</p><p id="r-428402" data-claire-element-id="428402">La propriété <strong>shadow </strong>est un objet composé lui même de 4 propriétés :</p><table id="r-428430" data-claire-element-id="428430"><thead id="r-428408" data-claire-element-id="428408"><tr id="r-428407" data-claire-element-id="428407"><th id="r-428404" data-claire-element-id="428404"><p id="r-428403" data-claire-element-id="428403">Propriété</p></th><th id="r-428406" data-claire-element-id="428406"><p id="r-428405" data-claire-element-id="428405">Effet</p></th></tr></thead><tbody id="r-428429" data-claire-element-id="428429"><tr id="r-428413" data-claire-element-id="428413"><td id="r-428410" data-claire-element-id="428410"><p id="r-428409" data-claire-element-id="428409"><strong>color</strong></p></td><td id="r-428412" data-claire-element-id="428412"><p id="r-428411" data-claire-element-id="428411">Couleur de l'ombre</p></td></tr><tr id="r-428418" data-claire-element-id="428418"><td id="r-428415" data-claire-element-id="428415"><p id="r-428414" data-claire-element-id="428414"><strong>blur</strong></p></td><td id="r-428417" data-claire-element-id="428417"><p id="r-428416" data-claire-element-id="428416">Flou de l'ombre</p></td></tr><tr id="r-428423" data-claire-element-id="428423"><td id="r-428420" data-claire-element-id="428420"><p id="r-428419" data-claire-element-id="428419"><strong>offset</strong></p></td><td id="r-428422" data-claire-element-id="428422"><p id="r-428421" data-claire-element-id="428421">Décalage de l'ombre (tableau avec les valeurs x et y)</p></td></tr><tr id="r-428428" data-claire-element-id="428428"><td id="r-428425" data-claire-element-id="428425"><p id="r-428424" data-claire-element-id="428424"><strong>opacity</strong></p></td><td id="r-428427" data-claire-element-id="428427"><p id="r-428426" data-claire-element-id="428426">Transparence de l'ombre</p></td></tr></tbody></table>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
<span class="arrow"></span>
<span class="next">Traits et remplissage</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">
<span class="next">Manipulations</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Manipulations"></a><h2>Manipulations</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
<span class="arrow"></span>
<span class="next">Opacité et ombre</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
<span class="next">Modifications</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-428434" data-claire-element-id="428434">Dessiner des formes, c'est bien, mais pouvoir les transformer, c'est encore mieux. Petite visite guidée...</p>
</div><a name="Modifications"></a><h2>Modifications</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">
<span class="arrow"></span>
<span class="next">Manipulations</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
<span class="next">Groupements</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-modifications-2" data-claire-element-id="428505">Modifications</h4><h5 id="r-positionnement-2" data-claire-element-id="428450">Positionnement</h5><p id="r-428435" data-claire-element-id="428435">Voici un exemple simple :</p><pre id="r-428436" data-claire-element-id="428436"><code data-claire-semantic="javascript">var poly = new Kinetic.RegularPolygon({
  x: 100,
  y: 100,
  sides: 8,
  radius: 60,
  strokeWidth: 10
});
calque.add(poly);</code></pre><p id="r-428437" data-claire-element-id="428437"><a href="http://tutozero.free.fr/kinetic/tutos02/transformation_position_01.html">Tester !</a></p><figure id="r-428439" data-claire-element-id="428440"><img id="r-428438" data-claire-element-id="428438" src="medias/uploads.siteduzero.com_files_409001_410000_409551.png" alt="Image utilisateur"/></figure><p id="r-428441" data-claire-element-id="428441">La position est donnée par les propriétés <strong>x</strong> et <strong>y</strong>. Voici un nouveau code pour un résultat identique :</p><pre id="r-428442" data-claire-element-id="428442"><code data-claire-semantic="javascript">var poly = new Kinetic.RegularPolygon({
  sides: 8,
  radius: 60,
  strokeWidth: 10
});

poly.setX(100);
poly.setY(100);

calque.add(poly);</code></pre><p id="r-428443" data-claire-element-id="428443"><a href="http://tutozero.free.fr/kinetic/tutos02/transformation_position_02.html">Tester !</a><br/> Cette fois on a pas utilisé les propriétés dans le constructeur, mais des setters ensuite dans le code. Pratiquement toutes les propriétés dans <strong>KineticJS </strong>bénéficient de getters et setters.</p><p id="r-428444" data-claire-element-id="428444">Voici un autre exemple cette fois avec un setter qui permet de définir simultanément <strong>x</strong> et <strong>y</strong> :</p><pre id="r-428445" data-claire-element-id="428445"><code data-claire-semantic="javascript">var poly1 = new Kinetic.RegularPolygon({
  x: 100,
  y: 100,
  sides: 8,
  radius: 60,
  strokeWidth: 10
});

var poly2 = new Kinetic.RegularPolygon({
  sides: 3,
  radius: 60,
  strokeWidth: 10
});

poly2.setPosition(poly1.getX() + 160, poly1.getY() + 10);
 
calque.add(poly1);
calque.add(poly2);</code></pre><p id="r-428446" data-claire-element-id="428446"><a href="http://tutozero.free.fr/kinetic/tutos02/transformation_position_03.html">Tester !</a></p><figure id="r-428448" data-claire-element-id="428449"><img id="r-428447" data-claire-element-id="428447" src="medias/uploads.siteduzero.com_files_409001_410000_409552.png" alt="Image utilisateur"/></figure><h5 id="r-rotation-12" data-claire-element-id="428481">Rotation</h5><h6 id="r-rotation-simple" data-claire-element-id="428466">Rotation simple</h6><pre id="r-428451" data-claire-element-id="428451"><code data-claire-semantic="javascript">var ellipse = new Kinetic.Ellipse({
  x: 120,
  y: 120,
  radius: [100, 50],
  stroke: &quot;orange&quot;,
  strokeWidth: 5,
  rotation: Math.PI / 4
});</code></pre><p id="r-428452" data-claire-element-id="428452"><a href="http://tutozero.free.fr/kinetic/tutos02/transformation_rotate_01.html">Tester !</a></p><figure id="r-428454" data-claire-element-id="428455"><img id="r-428453" data-claire-element-id="428453" src="medias/uploads.siteduzero.com_files_409001_410000_409553.png" alt="Image utilisateur"/></figure><p id="r-428456" data-claire-element-id="428456">La valeur de l'angle est en radian. Mais si vous préférez les degrés, il y a une méthode qui va vous plaire :</p><pre id="r-428457" data-claire-element-id="428457"><code data-claire-semantic="javascript">var ellipse = new Kinetic.Ellipse({
  x: 120,
  y: 120,
  radius: [100, 50],
  stroke: &quot;orange&quot;,
  strokeWidth: 5,
  rotationDeg: 45
});</code></pre><p id="r-428458" data-claire-element-id="428458"><a href="http://tutozero.free.fr/kinetic/tutos02/transformation_rotate_01a.html">Tester !</a><br/> Avec un résultat identique au précédent ;) .</p><p id="r-428459" data-claire-element-id="428459">En jouant sur cette rotation on peut créer des figures intéressantes avec simplicité :</p><pre id="r-428460" data-claire-element-id="428460"><code data-claire-semantic="javascript">for(var i = 0; i &lt; 2 * Math.PI; i += Math.PI / 8) {
	calque.add(
		new Kinetic.Ellipse({
		  x: 120,
		  y: 120,
		  radius: [100, 50],
		  stroke: &quot;rgb(240, 160, 0)&quot;,
		  strokeWidth: 2,
		  rotation: i
		})
	);
}</code></pre><p id="r-428461" data-claire-element-id="428461"><a href="http://tutozero.free.fr/kinetic/tutos02/transformation_rotate_02.html">Tester !</a></p><figure id="r-428463" data-claire-element-id="428464"><img id="r-428462" data-claire-element-id="428462" src="medias/uploads.siteduzero.com_files_409001_410000_409554.png" alt="Image utilisateur"/></figure><p id="r-428465" data-claire-element-id="428465">Mais évidemment cette propriété prendra tout son sens avec les animations.</p><h6 id="r-rotation-avec-offset" data-claire-element-id="428480">Rotation avec offset</h6><p id="r-428467" data-claire-element-id="428467">Les rotations que nous avons faites jusque-là étaient centrées sur le point de référence de la forme, pour une ellipse c'est le centre, pour un rectangle ce serait le coin supérieur gauche. Il y a la propriété <strong>offset </strong>pour décaler ce point de référence, c'est un tableau avec les valeurs <strong>x</strong> et <strong>y</strong> de décalage :</p><pre id="r-428468" data-claire-element-id="428468"><code data-claire-semantic="javascript">var ellipse0 = new Kinetic.Ellipse({
  x: 120,
  y: 120,
  radius: [100, 50],
  stroke: &quot;grey&quot;,
  strokeWidth: 5,
});

var ellipse1 = new Kinetic.Ellipse({
  x: 120,
  y: 120,
  radius: [100, 50],
  stroke: &quot;orange&quot;,
  strokeWidth: 5,
  rotationDeg: 45
});

var ellipse2 = new Kinetic.Ellipse({
  x: 120,
  y: 120,
  radius: [100, 50],
  stroke: &quot;blue&quot;,
  strokeWidth: 5,
  rotationDeg: 45,
  offset: [40, 0]
});

calque.add(ellipse0);	
calque.add(ellipse1);
calque.add(ellipse2);</code></pre><p id="r-428469" data-claire-element-id="428469"><a href="http://tutozero.free.fr/kinetic/tutos02/transformation_rotate_03.html">Tester !</a></p><figure id="r-428471" data-claire-element-id="428472"><img id="r-428470" data-claire-element-id="428470" src="medias/uploads.siteduzero.com_files_409001_410000_409555.png" alt="Image utilisateur"/></figure><p id="r-428473" data-claire-element-id="428473">Ça permet d'envisager de jolies figures en jouant avec tous ces paramètres :</p><pre id="r-428474" data-claire-element-id="428474"><code data-claire-semantic="javascript">for(var i = 0; i &lt; 360; i += 6) {
	calque.add(
		new Kinetic.Ellipse({
		  x: 250,
		  y: 150,
		  radius: [i / 4, i / 5],
		  stroke: &quot;rgb(240, 120, 100)&quot;,
		  strokeWidth: 2,
		  rotationDeg: i,
		  offset: i / 4
		})
	);
}</code></pre><p id="r-428475" data-claire-element-id="428475"><a href="http://tutozero.free.fr/kinetic/tutos02/transformation_rotate_04.html">Tester !</a></p><figure id="r-428477" data-claire-element-id="428478"><img id="r-428476" data-claire-element-id="428476" src="medias/uploads.siteduzero.com_files_409001_410000_409556.png" alt="Image utilisateur"/></figure><p id="r-428479" data-claire-element-id="428479">Remarquez que si on définit une seule valeur pour l'offset, et non plus un tableau de deux valeurs comme précédemment, elle est prise en compte pour <strong>x</strong> et <strong>y</strong>.</p><h5 id="r-dimension" data-claire-element-id="428504">Dimension</h5><h6 id="r-principe-de-base-3" data-claire-element-id="428489">Principe de base</h6><p id="r-428482" data-claire-element-id="428482">Voici un premier exemple :</p><pre id="r-428483" data-claire-element-id="428483"><code data-claire-semantic="javascript">for(var i = 0; i &lt; 1; i += .12) {
	calque.add(new Kinetic.Rect({
	  x: 90 + i * 80,
	  y: 40 + i * 80,
	  width: 150,
	  height: 150,
	  fill: &quot;brown&quot;,
	  scale: i
	  })
	);
}
scène.add(calque);</code></pre><p id="r-428484" data-claire-element-id="428484"><a href="http://tutozero.free.fr/kinetic/tutos02/transformation_scale_01.html">Tester !</a></p><figure id="r-428486" data-claire-element-id="428487"><img id="r-428485" data-claire-element-id="428485" src="medias/uploads.siteduzero.com_files_409001_410000_409557.png" alt="Image utilisateur"/></figure><p id="r-428488" data-claire-element-id="428488">Ici j'ai augmenté progressivement la taille d'un rectangle en le décalant, ce qui crée cette forme en créneaux. La propriété <strong>scale </strong>attend soit une valeur unique, auquel cas elle affecte le rapport de proportion aux deux dimensions, soit un tableau indiquant le rapport pour <strong>x</strong> et <strong>y</strong>.</p><h6 id="r-changement-dynamique" data-claire-element-id="428503">Changement dynamique</h6><p id="r-428490" data-claire-element-id="428490">On peut agir de façon dynamique sur cette propriété (comme sur toutes les autres) avec un setter. Voici un exemple :</p><pre id="r-428491" data-claire-element-id="428491"><code data-claire-semantic="html">&lt;script&gt;
window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	var rectangle = new Kinetic.Rect({
	  x: 90,
	  y: 40,
	  width: 300,
	  height: 200,
	  fill: &quot;orange&quot;
	});

	calque.add(rectangle);
	scène.add(calque);

	var petit = document.getElementById(&quot;petit&quot;);
	var moyen = document.getElementById(&quot;moyen&quot;);
	var grand = document.getElementById(&quot;grand&quot;);
	
	petit.onclick = function() {
	  rectangle.setScale(.2);
	  calque.draw();
	};
	moyen.onclick = function() {
	  rectangle.setScale(.5);
	  calque.draw();
	};
	grand.onclick = function() {
	  rectangle.setScale(1);
	  calque.draw();
	};
};
&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div id=&quot;kinetic&quot;&gt;&lt;/div&gt;
&lt;input id=&quot;petit&quot; type=&quot;button&quot; value=&quot;Petit&quot;&gt;
&lt;input id=&quot;moyen&quot; type=&quot;button&quot; value=&quot;Moyen&quot;&gt;
&lt;input id=&quot;grand&quot; type=&quot;button&quot; value=&quot;Grand&quot;&gt;
&lt;/body&gt;</code></pre><p id="r-428492" data-claire-element-id="428492"><a href="http://tutozero.free.fr/kinetic/tutos02/transformation_scale_02.html">Tester !</a></p><figure id="r-428494" data-claire-element-id="428495"><img id="r-428493" data-claire-element-id="428493" src="medias/uploads.siteduzero.com_files_409001_410000_409558.png" alt="Image utilisateur"/></figure><p id="r-428496" data-claire-element-id="428496">Remarquez qu'il faut utiliser la méthode <strong>draw </strong>du calque pour actualiser la modification en redessinant le rectangle.</p><p id="r-428497" data-claire-element-id="428497">Le point point de référence pour le redimensionnement est le même que pour la position. Pour obtenir un effet différent, par exemple centrer le redimensionnement sur le centre du rectangle il faut jouer sur la propriété <strong>offset</strong>. Voici le même exemple avec un offset qui permet un centrage de l'effet :</p><pre id="r-428498" data-claire-element-id="428498"><code data-claire-semantic="javascript">var rectangle = new Kinetic.Rect({
  x: 240,
  y: 140,
  width: 300,
  height: 200,
  fill: &quot;orange&quot;,
  offset: [150, 100]
});</code></pre><p id="r-428499" data-claire-element-id="428499"><a href="http://tutozero.free.fr/kinetic/tutos02/transformation_scale_03.html">Tester !</a></p><figure id="r-428501" data-claire-element-id="428502"><img id="r-428500" data-claire-element-id="428500" src="medias/uploads.siteduzero.com_files_409001_410000_409559.png" alt="Image utilisateur"/></figure>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">
<span class="arrow"></span>
<span class="next">Manipulations</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
<span class="next">Groupements</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Groupements"></a><h2>Groupements</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
<span class="arrow"></span>
<span class="next">Modifications</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">
<span class="next">TP</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-groupements" data-claire-element-id="428521">Groupements</h4><h5 id="r-principe-de-base-4" data-claire-element-id="428512">Principe de base</h5><p id="r-428506" data-claire-element-id="428506">Voici un objet sommaire composé d'un cercle et d'un trait groupés :</p><pre id="r-428507" data-claire-element-id="428507"><code data-claire-semantic="javascript">var groupe = new Kinetic.Group({
  x: 100,
  y: 50
});

(function() {
	var cercle = new Kinetic.Ellipse({
		radius: 20,
		stroke: &quot;grey&quot;,
		strokeWidth: 3
	});
	var ligne = new Kinetic.Line({
	        points: [0, 20, 0, 80],
	        stroke: &quot;grey&quot;,
	        strokeWidth: 3
	});
	groupe.add(cercle);
	groupe.add(ligne);
})();
 
calque.add(groupe);</code></pre><p id="r-428508" data-claire-element-id="428508"><a href="http://tutozero.free.fr/kinetic/tutos02/transformation_group_01.html">Tester !</a></p><figure id="r-428510" data-claire-element-id="428511"><img id="r-428509" data-claire-element-id="428509" src="medias/uploads.siteduzero.com_files_409001_410000_409560.png" alt="Image utilisateur"/></figure><h5 id="r-exemple-de-creation-d-objets" data-claire-element-id="428520">Exemple de création d'objets</h5><p id="r-428513" data-claire-element-id="428513">Partons de la base du groupement précédent pour créer une figure composée de plusieurs éléments groupés :</p><pre id="r-428514" data-claire-element-id="428514"><code data-claire-semantic="javascript">for(var i = 0; i &lt; 360; i += 45) {
	var groupe = new Kinetic.Group({
	  x: 250,
	  y: 150,
	  offset: [0, 80],
	  rotationDeg: i
	});

	(function() {
		var couleur = &quot;rgb(&quot; 
		+ (Math.floor(Math.random() * 256)) + &quot;,&quot; 
		+ (Math.floor(Math.random() * 256)) + &quot;,&quot; 
		+ (Math.floor(Math.random() * 256)) + &quot;)&quot;;
		var cercle = new Kinetic.Ellipse({
			radius: 20,
			fill: couleur
		});
		var ligne = new Kinetic.Line({
		        points: [0, 20, 0, 80],
		        strokeWidth: 3
		});
		groupe.add(cercle);
		groupe.add(ligne);
	})();
	calque.add(groupe);
}</code></pre><p id="r-428515" data-claire-element-id="428515"><a href="http://tutozero.free.fr/kinetic/tutos02/transformation_group_02.html">Tester !</a></p><figure id="r-428517" data-claire-element-id="428518"><img id="r-428516" data-claire-element-id="428516" src="medias/uploads.siteduzero.com_files_409001_410000_409561.png" alt="Image utilisateur"/></figure><p id="r-428519" data-claire-element-id="428519">J'ai ajouté un offset à l'objet pour avoir comme point de référence la pointe de la tige. Ensuite je crée 8 objets en changeant la rotation de 45 degrés pour obtenir ce dessin symétrique. Pour l'esthétique je génère aléatoirement la couleur du disque. On voit ici l'intérêt du groupement qui permet d'appliquer un effet à plusieurs formes avec un code concis.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
<span class="arrow"></span>
<span class="next">Modifications</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">
<span class="next">TP</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="TP"></a><h2>TP</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
<span class="arrow"></span>
<span class="next">Groupements</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
<span class="next">Un paysage</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-428523" data-claire-element-id="428523">Vous avez désormais tout en main pour faire quelques TP.</p>
</div><a name="Unpaysage"></a><h2>Un paysage</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">
<span class="arrow"></span>
<span class="next">TP</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
<span class="next">Une vague</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-un-paysage" data-claire-element-id="428536">Un paysage</h4><p id="r-428524" data-claire-element-id="428524">Voici le résultat que l'on veut obtenir :</p><figure id="r-428526" data-claire-element-id="428527"><img id="r-428525" data-claire-element-id="428525" src="medias/uploads.siteduzero.com_files_404001_405000_404941.png" alt="Image utilisateur"/></figure><p id="r-428528" data-claire-element-id="428528"><a href="http://tutozero.free.fr/kinetic/tutos01/tp_01.html">Tester !</a><br/> Tout cela réalisé avec les classes que l'on a vues jusqu'ici.</p><p id="r-428529" data-claire-element-id="428529"></p><div id="r-428532" data-claire-element-id="428532"><pre id="r-428530" data-claire-element-id="428530"><code data-claire-semantic="html">&lt;style&gt;
canvas {
	border-style:solid;
	border-color:#aaa;
	box-shadow: 5px 5px 3px #999;
}
&lt;/style&gt;
&lt;script&gt;
window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	// Ciel
	calque.add(
		new Kinetic.Rect({
		  width: 500,
		  height: 140,
		  fill: &quot;blue&quot;
		})
	);
	
	// Sol
	calque.add(
		new Kinetic.Rect({
		  y: 140,
		  width: 500,
		  height: 160,
		  fill: &quot;#641&quot;
		})
	);
	
	// Soleil
	calque.add(
		new Kinetic.Ellipse({
		  x: 40,
		  y: 40,
		  radius: 24,
		  fill: &quot;yellow&quot;
		})
	);

	// Route
	calque.add(
		new Kinetic.Polygon({
		  points: [235, 140, 245, 140, 300, 300, 180, 300],
		  fill: &quot;#666&quot;
		})
	);
	calque.add(
		new Kinetic.Line({
		  points: [240, 140, 240, 300],
		  stroke: &quot;#ba5&quot;,
		  strokeWidth: 1,
		  dashArray: [8, 3]
		})
	);
	
	// Panneau
	calque.add(
		new Kinetic.Line({
		  points: [280, 180, 280, 220],
		  stroke: &quot;#222&quot;,
		  strokeWidth: 4
		})
	);
	calque.add(
		new Kinetic.RegularPolygon({
		  x: 280,
		  y: 168,
		  sides: 4,
		  radius: 15,
		  stroke: &quot;black&quot;,
		  fill: &quot;#bb3&quot;,
		})
	);
	
	// Arbre
	calque.add(
		new Kinetic.Line({
		  points: [130, 220, 130, 260],
		  stroke: &quot;#420&quot;,
		  strokeWidth: 10
		})
	);
	calque.add(
		new Kinetic.Ellipse({
		  x: 130,
		  y: 190,
		  radius: [30,33],
		  fill: &quot;green&quot;
		})
	);

	scène.add(calque);
};
&lt;/script&gt;</code></pre><p id="r-428531" data-claire-element-id="428531">J'ai ajouté un peu de style au <strong>canvas </strong>pour l'esthétique.</p></div><p id="r-428533" data-claire-element-id="428533">Bien sûr ce n'est qu'un exercice de style parce qu'il n'est pas vraiment nécessaire d'utiliser des objets pour des éléments graphiques qui doivent rester immobiles. Il est alors évidemment bien plus simple d'utiliser une image :</p><pre id="r-428534" data-claire-element-id="428534"><code data-claire-semantic="html">&lt;style&gt;
canvas {
	border-style:solid;
	border-color:#aaa;
	box-shadow: 5px 5px 3px #999;
}
&lt;/style&gt;
&lt;script&gt;
window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	var img = new Image();
	img.onload = function() {
	  var image = new Kinetic.Image({
		image: img
	  });

	  calque.add(image);

	  scène.add(calque);
	};
	img.src = &quot;images/img01_47.png&quot;;
};
&lt;/script&gt;</code></pre><p id="r-428535" data-claire-element-id="428535"><a href="http://tutozero.free.fr/kinetic/tutos01/image_02.html">Tester !</a></p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">
<span class="arrow"></span>
<span class="next">TP</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
<span class="next">Une vague</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Unevague"></a><h2>Une vague</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
<span class="arrow"></span>
<span class="next">Un paysage</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
<span class="next">Encore le paysage</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-une-vague" data-claire-element-id="428545">Une vague</h4><p id="r-428537" data-claire-element-id="428537">L'objectif est de créer cette figuration de vague :</p><figure id="r-428539" data-claire-element-id="428540"><img id="r-428538" data-claire-element-id="428538" src="medias/uploads.siteduzero.com_files_404001_405000_404968.png" alt="Image utilisateur"/></figure><p id="r-428541" data-claire-element-id="428541"><a href="http://tutozero.free.fr/kinetic/tutos01/tp_02.html">Tester !</a></p><div id="r-428544" data-claire-element-id="428544"><pre id="r-428542" data-claire-element-id="428542"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	var vague = new Kinetic.Shape({
	  drawFunc: function(context) {
		context.beginPath();
		context.arc(160, 140, 120, .8 * Math.PI, 2.2 * Math.PI);
		context.arcTo(40, 210, 140, 160, 40);
		context.bezierCurveTo(130, 30, 50, 130, 64, 210);	
		context.closePath();
		this.fill(context);
		this.stroke(context);
	  },
	  lineJoin: &quot;round&quot;,
	  fill: &quot;lightblue&quot;,
	  stroke: &quot;blue&quot;,
  	  strokeWidth: 8,
	});
		
	calque.add(vague);
	
	scène.add(calque);
};</code></pre><p id="r-428543" data-claire-element-id="428543">Il y a bien entendu d'autres façons d'obtenir ce résultat :p</p></div>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
<span class="arrow"></span>
<span class="next">Un paysage</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
<span class="next">Encore le paysage</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Encorelepaysage"></a><h2>Encore le paysage</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
<span class="arrow"></span>
<span class="next">Une vague</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
<span class="next">Fleurs</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-encore-le-paysage" data-claire-element-id="428554">Encore le paysage</h4><p id="r-428546" data-claire-element-id="428546">Je vous propose de reprendre le paysage du premier TP en créant une ambiance nocturne :</p><figure id="r-428548" data-claire-element-id="428549"><img id="r-428547" data-claire-element-id="428547" src="medias/uploads.siteduzero.com_files_409001_410000_409563.png" alt="Image utilisateur"/></figure><p id="r-428550" data-claire-element-id="428550"><a href="http://tutozero.free.fr/kinetic/tutos02/tp_01.html">Tester !</a><br/> Bon d'accord ce n'est pas du grand art mais suffisant pour s'amuser avec les dégradés et les ombres :p</p><p id="r-428551" data-claire-element-id="428551"></p><div id="r-428553" data-claire-element-id="428553"><pre id="r-428552" data-claire-element-id="428552"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	// Ciel
	calque.add(
		new Kinetic.Rect({
		  width: 500,
		  height: 140,
		  fill: {
			start: {
			  x: 200,
			  y: 134,
			  radius: 0
			},
			end: {
			  x: 200,
			  y: 134,
			  radius: 260
			},
			colorStops: [0,&quot;#f03&quot;, 1,  &quot;#50f&quot;]
		  }
		})
	);
		
	// Soleil
	calque.add(
		new Kinetic.Ellipse({
		  x: 200,
		  y: 140,
		  radius: 24,
		  opacity: .7,
		  fill: {
			start: {
			  x: 0,
			  y: 0,
			  radius: 10
			},
			end: {
			  x: 0,
			  y: 0,
			  radius: 20
			},
			colorStops: [0, &quot;#dd0&quot;, 1, &quot;#ff0&quot;]
		  },
		})
	);
	
	// Sol
	calque.add(
		new Kinetic.Rect({
		  y: 140,
		  width: 500,
		  height: 160,
		  fill: &quot;#530&quot;
		})
	);
	// Route
	calque.add(
		new Kinetic.Polygon({
		  points: [235, 140, 245, 140, 300, 300, 180, 300],
		  fill: &quot;#666&quot;
		})
	);
	calque.add(
		new Kinetic.Line({
		  points: [240, 140, 240, 300],
		  stroke: &quot;#ba5&quot;,
		  strokeWidth: 1,
		  dashArray: [8, 3]
		})
	);
	
	// Panneau
	calque.add(
		new Kinetic.Line({
		  points: [280, 180, 280, 220],
		  stroke: &quot;#222&quot;,
		  strokeWidth: 4,
		  opacity: .6,
		  shadow: {
			  color: &quot;black&quot;,
			  blur: 6,
			  offset: [-2, 38],
			  opacity: .6
      	 }
		})
	);
	calque.add(
		new Kinetic.RegularPolygon({
		  x: 280,
		  y: 168,
		  sides: 4,
		  radius: 15,
		  stroke: &quot;black&quot;,
		  fill: &quot;#bb3&quot;,
		  alpha: .6,
		  shadow: {
			  color: &quot;black&quot;,
			  blur: 6,
			  offset: [0, 90],
			  opacity: .6
      	 }
		})
	);
	
	// Arbre
	calque.add(
		new Kinetic.Line({
		  points: [130, 220, 130, 260],
		  stroke: &quot;#420&quot;,
		  strokeWidth: 10,
		  opacity: .6,
		  shadow: {
		      color: &quot;black&quot;,
			  blur: 16,
			  offset: [0, 38],
			  opacity: .7
      	 },

	   })
	);
	calque.add(
		new Kinetic.Ellipse({
		  x: 130,
		  y: 190,
		  radius: [30,33],
		  fill: &quot;green&quot;,
		  opacity: .6
		})
	);
	
	scène.add(calque);
};</code></pre></div>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
<span class="arrow"></span>
<span class="next">Une vague</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
<span class="next">Fleurs</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Fleurs"></a><h2>Fleurs</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
<span class="arrow"></span>
<span class="next">Encore le paysage</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">
<span class="next">Interactions</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-fleurs" data-claire-element-id="428565">Fleurs</h4><p id="r-428555" data-claire-element-id="428555">Le but est d'obtenir une image de ce genre :</p><figure id="r-428557" data-claire-element-id="428558"><img id="r-428556" data-claire-element-id="428556" src="medias/uploads.siteduzero.com_files_409001_410000_409564.png" alt="Image utilisateur"/></figure><p id="r-428559" data-claire-element-id="428559"><a href="http://tutozero.free.fr/kinetic/tutos02/tp_02.html">Tester !</a><br/> Avec évidemment une génération aléatoire des positions, dimensions et couleurs pour obtenir un effet réaliste et varié. Rafraîchissez l'écran pour obtenir de nouvelles compositions.</p><p id="r-428560" data-claire-element-id="428560">Ne sautez pas sur ma solution tout de suite, le but est de vous entraîner à utiliser la librairie ;) .</p><p id="r-428561" data-claire-element-id="428561"></p><div id="r-428564" data-claire-element-id="428564"><pre id="r-428562" data-claire-element-id="428562"><code data-claire-semantic="javascript">function getColor() {
	return &quot;rgb(&quot; + getInteger(256) + &quot;,&quot; + getInteger(256) + &quot;,&quot; + getInteger(256) + &quot;)&quot;;	
}
function getInteger(valmax) {
	return Math.floor(Math.random() * (valmax + 1));	
}
window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	// Fond vert
	var fond = new Kinetic.Rect({
	  width: scène.getWidth(),
	  height: scène.getHeight(),
	  fill: &quot;#141&quot;,
	});
	calque.add(fond);
	
	// Génération des fleurs
	for(var i = 0; i &lt; 20; ++i) {
		var groupe = new Kinetic.Group({
		  x: getInteger(400) + 50,
		  y: getInteger(180) + 30,
		});
		(function() {	
			// Tige		
			var tige = new Kinetic.Line({
				points: [0, 0, 20 - getInteger(40), 120],
				stroke: &quot;black&quot;,
				strokeWidth: 4
			});
			groupe.add(tige);
			// Pétales
			var couleur = getColor();
			for(var j = 0; j &lt; 360; j += 30) { 
				var pétale = new Kinetic.Ellipse({
					radius: [36, 8],
					fill: couleur,
					rotationDeg: j,
                                        offset: [14, 0]
				});
				groupe.add(pétale);
			}
			// Pistil
			var pistil = new Kinetic.Ellipse({
				radius: 15,
				fill: getColor(),
			});
			groupe.add(pistil);
			groupe.setScale(Math.random() * .7 + .3);
		})();
		calque.add(groupe);
	}
	
	scène.add(calque);
};</code></pre><p id="r-428563" data-claire-element-id="428563">Je ne commente pas ce code, je vous laisse l'analyser et comparer avec ce que vous avec produit.</p></div>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
<span class="arrow"></span>
<span class="next">Encore le paysage</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">
<span class="next">Interactions</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Interactions"></a><h2>Interactions</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
<span class="arrow"></span>
<span class="next">Fleurs</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
<span class="next">Evénements</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-428569" data-claire-element-id="428569">Nous allons voir à présent comment agir, avec la souris, sur les formes que nous avons dessinées.</p>
</div><a name="Evnements"></a><h2>Evénements</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">
<span class="arrow"></span>
<span class="next">Interactions</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
<span class="next">Glisser-déposer</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-evenements-6" data-claire-element-id="428719">Evénements</h4><p id="r-428570" data-claire-element-id="428570">La classe <strong>Node </strong>de <strong>KineticJS </strong>est équipée pour gérer les principaux événements de la souris :</p><table id="r-428623" data-claire-element-id="428623"><thead id="r-428576" data-claire-element-id="428576"><tr id="r-428575" data-claire-element-id="428575"><th id="r-428572" data-claire-element-id="428572"><p id="r-428571" data-claire-element-id="428571">Evénement</p></th><th id="r-428574" data-claire-element-id="428574"><p id="r-428573" data-claire-element-id="428573">Description</p></th></tr></thead><tbody id="r-428622" data-claire-element-id="428622"><tr id="r-428581" data-claire-element-id="428581"><td id="r-428578" data-claire-element-id="428578"><p id="r-428577" data-claire-element-id="428577"><strong>click</strong></p></td><td id="r-428580" data-claire-element-id="428580"><p id="r-428579" data-claire-element-id="428579">Se produit lorsqu'on clique sur l'élément associé à l'événement.</p></td></tr><tr id="r-428586" data-claire-element-id="428586"><td id="r-428583" data-claire-element-id="428583"><p id="r-428582" data-claire-element-id="428582"><strong>dblclick</strong></p></td><td id="r-428585" data-claire-element-id="428585"><p id="r-428584" data-claire-element-id="428584">Se produit lorsqu'on fait un double clic sur l'élément associé à l'événement.</p></td></tr><tr id="r-428591" data-claire-element-id="428591"><td id="r-428588" data-claire-element-id="428588"><p id="r-428587" data-claire-element-id="428587"><strong>mousedown</strong></p></td><td id="r-428590" data-claire-element-id="428590"><p id="r-428589" data-claire-element-id="428589">Se produit lorsqu'on appuie sur le bouton sur l'élément associé à l'événement.</p></td></tr><tr id="r-428596" data-claire-element-id="428596"><td id="r-428593" data-claire-element-id="428593"><p id="r-428592" data-claire-element-id="428592"><strong>mouseup</strong></p></td><td id="r-428595" data-claire-element-id="428595"><p id="r-428594" data-claire-element-id="428594">Se produit lorsqu'on relâche le bouton sur l'élément associé à l'événement.</p></td></tr><tr id="r-428601" data-claire-element-id="428601"><td id="r-428598" data-claire-element-id="428598"><p id="r-428597" data-claire-element-id="428597"><strong>mouseover</strong></p></td><td id="r-428600" data-claire-element-id="428600"><p id="r-428599" data-claire-element-id="428599">Se produit lorsqu'on positionne le curseur sur l'élément associé à l'événement.</p></td></tr><tr id="r-428606" data-claire-element-id="428606"><td id="r-428603" data-claire-element-id="428603"><p id="r-428602" data-claire-element-id="428602"><strong>mouseout</strong></p></td><td id="r-428605" data-claire-element-id="428605"><p id="r-428604" data-claire-element-id="428604">Se produit lorsque le curseur quitte l'élément associé à l'événement.</p></td></tr><tr id="r-428611" data-claire-element-id="428611"><td id="r-428608" data-claire-element-id="428608"><p id="r-428607" data-claire-element-id="428607"><strong>mousemove</strong></p></td><td id="r-428610" data-claire-element-id="428610"><p id="r-428609" data-claire-element-id="428609">Se produit lorsque le curseur se déplace sur l'élément associé à l'événement.</p></td></tr><tr id="r-428616" data-claire-element-id="428616"><td id="r-428613" data-claire-element-id="428613"><p id="r-428612" data-claire-element-id="428612"><strong>mouseenter</strong></p></td><td id="r-428615" data-claire-element-id="428615"><p id="r-428614" data-claire-element-id="428614">Se produit lorsque le curseur se place sur l'élément associé à l'événement.</p></td></tr><tr id="r-428621" data-claire-element-id="428621"><td id="r-428618" data-claire-element-id="428618"><p id="r-428617" data-claire-element-id="428617"><strong>mouseleave</strong></p></td><td id="r-428620" data-claire-element-id="428620"><p id="r-428619" data-claire-element-id="428619">Se produit lorsque le curseur quitte l'élément associé à l'événement.</p></td></tr></tbody></table><div id="r-428625" data-claire-element-id="428625" data-claire-semantic="question"><p id="r-428624" data-claire-element-id="428624">Mais c'est quoi la différence entre <strong>mouseout </strong>et <strong>mouseleave</strong> ?</p></div><p id="r-428626" data-claire-element-id="428626">Voilà une bonne question, vous avez une excellente réponse <a href="http://www.basical.fr/jquery/difference-mouseleave-mouseout/">ici</a>. Remarquez que c'est la même chose pour les événements <strong>mouseover </strong>et <strong>mouseenter</strong>. Tant que vous n'avez pas d'éléments imbriqués, le fonctionnement est identique, mais dès que vous en avez alors les événements <strong>mouseenter </strong>et <strong>mouseleave </strong>sont vraiment très pratiques ;) .</p><p id="r-428627" data-claire-element-id="428627">Elle permet également de gérer les événements des terminaux mobiles comme les smartphones et les tablettes :</p><table id="r-428660" data-claire-element-id="428660"><thead id="r-428633" data-claire-element-id="428633"><tr id="r-428632" data-claire-element-id="428632"><th id="r-428629" data-claire-element-id="428629"><p id="r-428628" data-claire-element-id="428628">Evénement</p></th><th id="r-428631" data-claire-element-id="428631"><p id="r-428630" data-claire-element-id="428630">Description</p></th></tr></thead><tbody id="r-428659" data-claire-element-id="428659"><tr id="r-428638" data-claire-element-id="428638"><td id="r-428635" data-claire-element-id="428635"><p id="r-428634" data-claire-element-id="428634"><strong>touchstart</strong></p></td><td id="r-428637" data-claire-element-id="428637"><p id="r-428636" data-claire-element-id="428636">Se produit lorsque le doigt est placé sur l'élément associé à l'événement.</p></td></tr><tr id="r-428643" data-claire-element-id="428643"><td id="r-428640" data-claire-element-id="428640"><p id="r-428639" data-claire-element-id="428639"><strong>touchmove</strong></p></td><td id="r-428642" data-claire-element-id="428642"><p id="r-428641" data-claire-element-id="428641">Se produit lorsque le doigt est déplacé sur l'élément associé à l'événement.</p></td></tr><tr id="r-428648" data-claire-element-id="428648"><td id="r-428645" data-claire-element-id="428645"><p id="r-428644" data-claire-element-id="428644"><strong>touchend</strong></p></td><td id="r-428647" data-claire-element-id="428647"><p id="r-428646" data-claire-element-id="428646">Se produit lorsque le doigt est retiré de l'élément associé à l'événement.</p></td></tr><tr id="r-428653" data-claire-element-id="428653"><td id="r-428650" data-claire-element-id="428650"><p id="r-428649" data-claire-element-id="428649"><strong>tap</strong></p></td><td id="r-428652" data-claire-element-id="428652"><p id="r-428651" data-claire-element-id="428651">Se produit lors d'un toucher rapide sur l'élément associé à l'événement.</p></td></tr><tr id="r-428658" data-claire-element-id="428658"><td id="r-428655" data-claire-element-id="428655"><p id="r-428654" data-claire-element-id="428654"><strong>dbltap</strong></p></td><td id="r-428657" data-claire-element-id="428657"><p id="r-428656" data-claire-element-id="428656">Se produit lors d'un double toucher rapide sur l'élément associé à l'événement.</p></td></tr></tbody></table><p id="r-428661" data-claire-element-id="428661">On peut facilement gérer ces événements sur les formes dessinées.</p><h5 id="r-mise-en-place-19" data-claire-element-id="428668">Mise en place</h5><p id="r-428662" data-claire-element-id="428662">La mise en place de l'écoute d'un événement se fait simplement. Il suffit d'utiliser la méthode <strong>on </strong>et de renseigner les deux paramètres : le type d'événement à écouter et une fonction à exécuter lorsque cet événement survient. Voici un exemple simple où on détecte le clic de la souris sur un disque coloré :</p><pre id="r-428663" data-claire-element-id="428663"><code data-claire-semantic="javascript">window.onload = function() {
	function setText(text, color) {
	  Texte.setText(text);
	  Texte.setTextFill(color);
	  calque.draw();
	}
	
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	var Texte = new Kinetic.Text({
	  x: 10,
	  y: 10,
	  text: &quot;Cliquez sur le disque rouge&quot;,
	  fontSize: 18,
	  fontFamily: &quot;verdana&quot;,
	  textFill: &quot;grey&quot;
	});
		
	var disque = new Kinetic.Ellipse({
	  x: 250,
	  y: 150,
	  radius: 70,
	  fill: &quot;red&quot;,
	});
	
	disque.on(&quot;click&quot;, function() {
	  setText(&quot;On a cliqué sur le disque rouge !&quot;, &quot;red&quot;);
	  setTimeout(function(){
		  setText(&quot;Cliquez sur le disque rouge&quot;, &quot;grey&quot;);
	  }, 2000);
	});
	
	calque.add(disque);
	calque.add(Texte);
	scène.add(calque);
};</code></pre><p id="r-428664" data-claire-element-id="428664"><a href="http://tutozero.free.fr/kinetic/tutos03/evenements_01.html">Tester !</a></p><figure id="r-428666" data-claire-element-id="428667"><img id="r-428665" data-claire-element-id="428665" src="medias/uploads.siteduzero.com_files_405001_406000_405004.png" alt="Image utilisateur"/></figure><h5 id="r-empilement-d-evenements" data-claire-element-id="428676">Empilement d'événements</h5><p id="r-428669" data-claire-element-id="428669">On est pas limité à un seul événement sur une forme. Pour en gérer plusieurs c'est tout simple, il suffit de les inscrire en les séparant par un espace. Voici l'exemple d'un disque qui change de couleur sur <strong>mousedown </strong>et <strong>mouseup </strong>:</p><pre id="r-428670" data-claire-element-id="428670"><code data-claire-semantic="javascript">function getColor() {
	return &quot;rgb(&quot; + getInteger(256) + &quot;,&quot; + getInteger(256) + &quot;,&quot; + getInteger(256) + &quot;)&quot;;	
}
function getInteger(valmax) {
	return Math.floor(Math.random() * (valmax + 1));	
}
window.onload = function() {
	function setText(text, color) {
		Texte.setText(text);
		Texte.setTextFill(color);
		calque.draw();
	}
	
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	var Texte = new Kinetic.Text({
	  x: 10,
	  y: 10,
	  text: &quot;Cliquez sur le disque, il change de couleur sur mousedown et mouseup&quot;,
	  fontSize: 14,
	  fontFamily: &quot;verdana&quot;,
	  textFill: &quot;grey&quot;,
	  lineHeight: 2,
	  width: 480,
	  align: &quot;center&quot;
	});
		
	var disque = new Kinetic.Ellipse({
	  x: 250,
	  y: 170,
	  radius: 70,
	  fill: getColor(),
	});
	
	disque.on(&quot;mousedown mouseup&quot;, function() {
	  disque.setFill(getColor());
	  calque.draw();
	});
	
	calque.add(disque);
	calque.add(Texte);
	scène.add(calque);
};</code></pre><p id="r-428671" data-claire-element-id="428671"><a href="http://tutozero.free.fr/kinetic/tutos03/evenements_07.html">Tester !</a></p><figure id="r-428673" data-claire-element-id="428674"><img id="r-428672" data-claire-element-id="428672" src="medias/uploads.siteduzero.com_files_405001_406000_405005.png" alt="Image utilisateur"/></figure><p id="r-428675" data-claire-element-id="428675">Cette possibilité est utile pour créer des applications qui doivent fonctionner sur écran normal et terminal mobile en associant par exemple <strong>mousedown </strong>et <strong>touchstart</strong>.</p><h5 id="r-supprimer-un-evenement" data-claire-element-id="428683">Supprimer un événement</h5><p id="r-428677" data-claire-element-id="428677">La suppression d'un événement est aussi aisée que sa mise en place, il suffit d'utiliser la méthode <strong>off </strong>en indiquant quel événement on veut supprimer. Voici un exemple avec un disque que l'on peut cliquer 3 fois. Au bout de ces trois clics, l'événement est supprimé :</p><pre id="r-428678" data-claire-element-id="428678"><code data-claire-semantic="javascript">window.onload = function() {
	function setText() {
	  var text = &quot;Cliquez sur le disque rouge\nVous avez encore &quot; + i + &quot; possibilité&quot;;
	  if(i &gt; 1) text += &quot;s&quot;;
	  text += &quot;...&quot;;
	  Texte.setText(text);
	  calque.draw();
	}
	
	var i = 3;
	
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	var Texte = new Kinetic.Text({
	  x: 10,
	  y: 10,
	  text: &quot;Cliquez sur le disque rouge\nVous avez encore 3 possibilités...&quot;,
	  fontSize: 14,
	  fontFamily: &quot;verdana&quot;,
	  textFill: &quot;grey&quot;,
	  lineHeight: 2
	});
		
	var disque = new Kinetic.Ellipse({
	  x: 250,
	  y: 150,
	  radius: 70,
	  fill: &quot;red&quot;,
	});
	
	disque.on(&quot;click&quot;, function() {
	  if(--i)  setText();
	  else {
	    disque.off(&quot;click&quot;);
	    Texte.setText(&quot;Vous ne pouvez plus cliquer !&quot;);
	    calque.draw();
	  }
	});
	
	calque.add(disque);
	calque.add(Texte);
	scène.add(calque);
};</code></pre><p id="r-428679" data-claire-element-id="428679"><a href="http://tutozero.free.fr/kinetic/tutos03/evenements_02.html">Tester !</a></p><figure id="r-428681" data-claire-element-id="428682"><img id="r-428680" data-claire-element-id="428680" src="medias/uploads.siteduzero.com_files_405001_406000_405006.png" alt="Image utilisateur"/></figure><h5 id="r-suspendre-un-evenement" data-claire-element-id="428690">Suspendre un événement</h5><p id="r-428684" data-claire-element-id="428684">La suppression totale d'un événement n'est pas toujours judicieuse. Parfois on a juste besoin de suspendre l'écoute pour la réactiver par la suite. La propriété <strong>listening </strong>nous permet de réaliser cela, il suffit de la renseigner avec la valeur <strong>true </strong>pour activer l'événement et la valeur <strong>false </strong>pour le désactiver. Voici un exemple avec l'événement <strong>mouseover </strong>qui permet de changer la couleur d'un disque lorsque le curseur de la souris passe dessus. Un clic sur le triangle situé à côté permet de désactiver et activer cet événement :</p><pre id="r-428685" data-claire-element-id="428685"><code data-claire-semantic="javascript">function getColor() {
	return &quot;rgb(&quot; + getInteger(256) + &quot;,&quot; + getInteger(256) + &quot;,&quot; + getInteger(256) + &quot;)&quot;;	
}
function getInteger(valmax) {
	return Math.floor(Math.random() * (valmax + 1));	
}
window.onload = function() {
	function setText(text) {
		Texte.setText(text);
		calque.draw();
	}
	
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var état = true;
	
	var calque = new Kinetic.Layer();
	
	var Texte = new Kinetic.Text({
	  x: 10,
	  y: 10,
	  text: &quot;Passez sur le disque pour changer sa couleur et cliquez sur le triangle pour désactiver l'événement&quot;,
	  fontSize: 14,
	  fontFamily: &quot;verdana&quot;,
	  textFill: &quot;grey&quot;,
	  lineHeight: 2,
	  width : 480
	});
		
	var disque = new Kinetic.Ellipse({
	  x: 150,
	  y: 180,
	  radius: 70,
	  fill: getColor(),
	});
	
	var triangle = new Kinetic.RegularPolygon({
	  x: 350,
	  y: 200,
	  sides: 3,
	  radius: 90,
	  fill: &quot;red&quot;,
	});
		
	disque.on(&quot;mouseover&quot;, function() {
		  disque.setFill(getColor());
		  calque.draw();
	});
	
	triangle.on(&quot;click&quot;, function() {
		état = !état;
		disque.setListening(état);
		if(état) setText(&quot;Passez sur le disque pour changer sa couleur et cliquez sur le triangle pour désactiver l'événement&quot;);
		else setText(&quot;L'événement est désactivé&quot;);
	});
	
	calque.add(disque);
	calque.add(triangle);
	calque.add(Texte);
	scène.add(calque);
};</code></pre><p id="r-428686" data-claire-element-id="428686"><a href="http://tutozero.free.fr/kinetic/tutos03/evenements_03.html">Tester !</a></p><figure id="r-428688" data-claire-element-id="428689"><img id="r-428687" data-claire-element-id="428687" src="medias/uploads.siteduzero.com_files_405001_406000_405007.png" alt="Image utilisateur"/></figure><h5 id="r-position-du-curseur" data-claire-element-id="428705">Position du curseur</h5><h6 id="r-position-absolue-1" data-claire-element-id="428697">Position absolue</h6><p id="r-428691" data-claire-element-id="428691">Voici un premier exemple :</p><pre id="r-428692" data-claire-element-id="428692"><code data-claire-semantic="javascript">window.onload = function() {
	function setText() {
		var mousePos = scène.getMousePosition();
		var text = &quot;Le curseur de la souris est en X = &quot; + mousePos.x + &quot; Y = &quot; + mousePos.y;
		Texte.setText(text);
		calque.draw();
	}
	
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	var Rectangle = new Kinetic.Rect({
	  width: scène.getWidth(),
	  height: scène.getHeight(),
	  fill: &quot;#ade&quot;,
	});
		
	var Texte = new Kinetic.Text({
	  x: 10,
	  y: 10,
	  text: &quot;Bougez la souris&quot;,
	  fontSize: 14,
	  fontFamily: &quot;verdana&quot;,
	  textFill: &quot;grey&quot;,
	  lineHeight: 2,
	  width: 480,
	  align: &quot;center&quot;
	});
		
	scène.on(&quot;mousemove&quot;, function() {
	  setText();
	});
	
	calque.add(Rectangle);
	calque.add(Texte);
	scène.add(calque);
};</code></pre><p id="r-428693" data-claire-element-id="428693"><a href="http://tutozero.free.fr/kinetic/tutos03/evenements_08.html">Tester !</a></p><figure id="r-428695" data-claire-element-id="428696"><img id="r-428694" data-claire-element-id="428694" src="medias/uploads.siteduzero.com_files_405001_406000_405009.png" alt="Image utilisateur"/></figure><h6 id="r-position-relative" data-claire-element-id="428704">Position relative</h6><p id="r-428698" data-claire-element-id="428698">Remarquez que dans l'exemple précédent j'ai créé un rectangle de la dimension de la scène pour faire fonctionner l’événement, en effet par défaut la détection se fait sur les formes, il faut donc en créer une. Pour déterminer la position de la souris sur une forme de dimension plus réduite que la scène, il faut ajuster avec l'offset de positionnement :</p><pre id="r-428699" data-claire-element-id="428699"><code data-claire-semantic="javascript">window.onload = function() {
	function setText() {
		var mousePos = scène.getMousePosition();
		var x = mousePos.x - Rectangle.getX();
		var y = mousePos.y - Rectangle.getY();
		var text = &quot;Le curseur de la souris est en X = &quot; + x + &quot; Y = &quot; + y;
		Texte.setText(text);
		calque.draw();
	}
	
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	var Rectangle = new Kinetic.Rect({
	  x: scène.getWidth() / 4,
	  y: scène.getHeight() / 4,
	  width: scène.getWidth() / 2,
	  height: scène.getHeight() / 2,
	  fill: &quot;#ade&quot;,
	});
		
	var Texte = new Kinetic.Text({
	  x: 10,
	  y: 10,
	  text: &quot;Bougez la souris&quot;,
	  fontSize: 14,
	  fontFamily: &quot;verdana&quot;,
	  textFill: &quot;grey&quot;,
	  lineHeight: 2,
	  width: 480,
	  align: &quot;center&quot;
	});
	
	Rectangle.on(&quot;mousemove&quot;, function() {
		setText();  	
	});
	
	Rectangle.on(&quot;mouseout&quot;, function() {
		Texte.setText(&quot;Curseur en dehors du rectangle&quot;);
		calque.draw();	  	
	});
	
	calque.add(Rectangle);
	calque.add(Texte);
	scène.add(calque);
};</code></pre><p id="r-428700" data-claire-element-id="428700"><a href="http://tutozero.free.fr/kinetic/tutos03/evenements_09.html">Tester !</a></p><figure id="r-428702" data-claire-element-id="428703"><img id="r-428701" data-claire-element-id="428701" src="medias/uploads.siteduzero.com_files_405001_406000_405010.png" alt="Image utilisateur"/></figure><h5 id="r-detecter-des-pixels" data-claire-element-id="428718">Détecter des pixels</h5><h6 id="r-detecter-sur-une-image" data-claire-element-id="428713">Détecter sur une image</h6><p id="r-428706" data-claire-element-id="428706">Voici un exemple avec l'image d'une voiture et la mise en œuvre d'un événement <strong>click </strong>comme nous l'avons précédemment fait :</p><pre id="r-428707" data-claire-element-id="428707"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	var img = new Image();
	img.onload = function() {
	  var image = new Kinetic.Image({
		x: 100,
		y: 100,
		image: img,
		width: 120,
		height: 120,
	  });

	  image.on(&quot;click&quot;, function() {
		Texte.setText(&quot;Image cliquée&quot;);
		calque.draw();	
		setTimeout(function(){
		  	Texte.setText(&quot;Cliquez sur l'image&quot;);
			calque.draw();
	  	  }, 2000);
	  });
		  
	  calque.add(image);
	  calque.draw();
	};
	img.src = &quot;images/voiture.png&quot;;
		
	var Texte = new Kinetic.Text({
	  y: 10,
	  text: &quot;Cliquez sur l'image&quot;,
	  fontSize: 14,
	  fontFamily: &quot;verdana&quot;,
	  textFill: &quot;grey&quot;,
	  lineHeight: 2,
	  width: 480,
	  align: &quot;center&quot;
	});
	
	calque.add(Texte);
	scène.add(calque);
};</code></pre><p id="r-428708" data-claire-element-id="428708"><a href="http://tutozero.free.fr/kinetic/tutos03/evenements_10.html">Tester !</a></p><figure id="r-428710" data-claire-element-id="428711"><img id="r-428709" data-claire-element-id="428709" src="medias/uploads.siteduzero.com_files_405001_406000_405011.png" alt="Image utilisateur"/></figure><p id="r-428712" data-claire-element-id="428712">Vous vous rendez compte que le <strong>clic </strong>fonctionne bien, mais on détecte aussi les zones transparentes !</p><h6 id="r-amelioration-de-la-detection" data-claire-element-id="428717">Amélioration de la détection</h6><p id="r-428714" data-claire-element-id="428714">Pour résoudre le problème vu précédemment il faut modifier un peu le code. Le voici corrigé :</p><pre id="r-428715" data-claire-element-id="428715"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	var img = new Image();
	img.onload = function() {
	  var image = new Kinetic.Image({
		x: 100,
		y: 100,
		image: img,
		width: 120,
		height: 120
	  });
	  image.createImageBuffer();
	  
	  image.on(&quot;click&quot;, function() {
		Texte.setText(&quot;Image cliquée&quot;);
		calque.draw();	
		setTimeout(function(){
		  	Texte.setText(&quot;Cliquez sur l'image&quot;);
			calque.draw();
	  	  }, 2000);
	  });
		  
	  calque.add(image);
	  calque.draw();
	  image.saveImageData();
	};
	img.src = &quot;images/voiture.png&quot;;
		
	var Texte = new Kinetic.Text({
	  y: 10,
	  text: &quot;Cliquez sur l'image&quot;,
	  fontSize: 14,
	  fontFamily: &quot;verdana&quot;,
	  textFill: &quot;grey&quot;,
	  lineHeight: 2,
	  width: 480,
	  align: &quot;center&quot;
	});
	
	calque.add(Texte);
	scène.add(calque);
};</code></pre><p id="r-428716" data-claire-element-id="428716"><a href="http://tutozero.free.fr/kinetic/tutos03/evenements_11.html">Tester !</a><br/> On sauvegarde les pixels avec la méthode <strong>createImageBuffer</strong> pour gagner en précision et ne plus déclencher l'événement sur des zones transparentes.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">
<span class="arrow"></span>
<span class="next">Interactions</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
<span class="next">Glisser-déposer</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Glisser-dposer"></a><h2>Glisser-déposer</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
<span class="arrow"></span>
<span class="next">Evénements</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
<span class="next">TP</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-glisser-deposer" data-claire-element-id="428801">Glisser-déposer</h4><p id="r-428720" data-claire-element-id="428720">Voyons maintenant un outil très pratique : le glisser-déposer, autrement appelé drag-and-drop par nos amis anglophones. C'est une procédure qui permet de manipuler visuellement des éléments à l'écran et de gérer ce déplacement avec des événements appropriés.</p><h5 id="r-activation-simple" data-claire-element-id="428728">Activation simple</h5><p id="r-428721" data-claire-element-id="428721">Il y a la propriété <strong>draggable </strong>pour activer le glisser-déposer. Par défaut elle a la valeur <strong>false</strong>, mais on peut définir la valeur <strong>true </strong>pour la rendre opérationnelle. Voici un exemple avec une génération aléatoire de 10 étoiles toutes &quot;draggables&quot; et un peu transparentes pour faciliter la visualisation :</p><pre id="r-428722" data-claire-element-id="428722"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
		
	for(var i = 0; i &lt; 10; ++i) {
	  var étoile = new Kinetic.Star({
		  x: Math.random() * scène.getWidth(),
		  y: Math.random() * scène.getHeight(),
		  numPoints: 5,
		  innerRadius: 40,
		  outerRadius: 80,
		  fill: '#823',
		  stroke: '#612',
		  opacity: 0.7,
		  strokeWidth: 10,
		  draggable: true,
		  scale: (Math.random() * .8) + .2,
		  rotationDeg: Math.random() * 180
      });
	  calque.add(étoile);
	}
	
	scène.add(calque);
};</code></pre><p id="r-428723" data-claire-element-id="428723"><a href="http://tutozero.free.fr/kinetic/tutos03/drag_drop_01.html">Tester !</a></p><figure id="r-428725" data-claire-element-id="428726"><img id="r-428724" data-claire-element-id="428724" src="medias/uploads.siteduzero.com_files_405001_406000_405014.png" alt="Image utilisateur"/></figure><p id="r-428727" data-claire-element-id="428727">Vous constatez que vous pouvez déplacer toutes les étoiles individuellement avec la souris.</p><h5 id="r-un-exemple-avec-des-lignes" data-claire-element-id="428735">Un exemple avec des lignes</h5><p id="r-428729" data-claire-element-id="428729">Voici un autre exemple avec des lignes :</p><pre id="r-428730" data-claire-element-id="428730"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
		
	var ligne = new Kinetic.Line({
	  points: [50, 50, 200, 100, 320, 20, 450, 200],
	  stroke: &quot;darkred&quot;,
	  strokeWidth: 14,
	  lineCap: &quot;round&quot;,
	  lineJoin: &quot;round&quot;,
	  draggable: true
	});
	
	calque.add(ligne);
	scène.add(calque);
};</code></pre><p id="r-428731" data-claire-element-id="428731"><a href="http://tutozero.free.fr/kinetic/tutos03/drag_drop_03.html">Tester !</a></p><figure id="r-428733" data-claire-element-id="428734"><img id="r-428732" data-claire-element-id="428732" src="medias/uploads.siteduzero.com_files_405001_406000_405015.png" alt="Image utilisateur"/></figure><h5 id="r-activation-pour-un-groupe" data-claire-element-id="428739">Activation pour un groupe</h5><p id="r-428736" data-claire-element-id="428736">Comment déplacer d'un bloc toutes les étoiles créées par le code précédent ? Il suffit de les grouper, comme nous l'avons vu dans un chapitre précédent et de déclarer ce groupe &quot;draggable&quot;. voici le code modifié en conséquence :</p><pre id="r-428737" data-claire-element-id="428737"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();

	var groupe = new Kinetic.Group({
		draggable: true
	});
		
	for(var i = 0; i &lt; 10; ++i) {
	  var étoile = new Kinetic.Star({
		  x: Math.random() * scène.getWidth(),
		  y: Math.random() * scène.getHeight(),
		  numPoints: 5,
		  innerRadius: 40,
		  outerRadius: 80,
		  fill: '#823',
		  stroke: '#612',
		  opacity: 0.7,
		  strokeWidth: 10,
		  scale: (Math.random() * .8) + .2,
		  rotationDeg: Math.random() * 180
      });
	  groupe.add(étoile);
	}
	
	calque.add(groupe);
	scène.add(calque);
};</code></pre><p id="r-428738" data-claire-element-id="428738"><a href="http://tutozero.free.fr/kinetic/tutos03/drag_drop_02.html">Tester !</a><br/> Cette fois c'est bien l'ensemble des étoiles qu'on peut déplacer en bloc.</p><h5 id="r-evenements-du-glisser-deposer" data-claire-element-id="428771">Événements du glisser-déposer</h5><p id="r-428740" data-claire-element-id="428740">Il y a 3 événements pour le glisser-déposer :</p><table id="r-428763" data-claire-element-id="428763"><thead id="r-428746" data-claire-element-id="428746"><tr id="r-428745" data-claire-element-id="428745"><th id="r-428742" data-claire-element-id="428742"><p id="r-428741" data-claire-element-id="428741">Événement</p></th><th id="r-428744" data-claire-element-id="428744"><p id="r-428743" data-claire-element-id="428743">Description</p></th></tr></thead><tbody id="r-428762" data-claire-element-id="428762"><tr id="r-428751" data-claire-element-id="428751"><td id="r-428748" data-claire-element-id="428748"><p id="r-428747" data-claire-element-id="428747"><strong>dragstart</strong></p></td><td id="r-428750" data-claire-element-id="428750"><p id="r-428749" data-claire-element-id="428749">Se produit lorsqu'on commence à déplacer l'élément associé à l'événement.</p></td></tr><tr id="r-428756" data-claire-element-id="428756"><td id="r-428753" data-claire-element-id="428753"><p id="r-428752" data-claire-element-id="428752"><strong>dragmove</strong></p></td><td id="r-428755" data-claire-element-id="428755"><p id="r-428754" data-claire-element-id="428754">Se produit lorsqu'on déplace l'élément associé à l'événement.</p></td></tr><tr id="r-428761" data-claire-element-id="428761"><td id="r-428758" data-claire-element-id="428758"><p id="r-428757" data-claire-element-id="428757"><strong>dragend</strong></p></td><td id="r-428760" data-claire-element-id="428760"><p id="r-428759" data-claire-element-id="428759">Se produit lorsqu'on dépose l'élément associé à l'événement.</p></td></tr></tbody></table><p id="r-428764" data-claire-element-id="428764">Voyons maintenant un exemple : on trace une ligne avec un disque à son extrémité. On veut pouvoir déplacer le disque avec la souris et que la ligne s'adapte automatiquement pour que son extrémité coïncide avec le disque :</p><pre id="r-428765" data-claire-element-id="428765"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
		
	var ligne = new Kinetic.Line({
	  points: [250, 150, 100, 100],
	  strokeWidth: 10,
	  lineCap: &quot;round&quot;,
	  lineJoin: &quot;round&quot;,
	  draggable: true
	});
	
	var disque = new Kinetic.Ellipse({
	  x: 100,
	  y: 100,
	  radius: 20,
	  fill: &quot;red&quot;,
	  draggable: true
	});
	
	disque.on(&quot;dragmove&quot;, function() {
          var pos = this.getPosition();
	  ligne.setPoints(250, 150, pos.x, pos.y);
          calque.draw();
        });
	
        calque.add(ligne);
        calque.add(disque);
        scène.add(calque);
};</code></pre><p id="r-428766" data-claire-element-id="428766"><a href="http://tutozero.free.fr/kinetic/tutos03/drag_drop_05.html">Tester !</a></p><figure id="r-428768" data-claire-element-id="428769"><img id="r-428767" data-claire-element-id="428767" src="medias/uploads.siteduzero.com_files_405001_406000_405016.png" alt="Image utilisateur"/></figure><p id="r-428770" data-claire-element-id="428770">J'ai utilisé encore l'événement <strong>dragmove</strong>. On récupère la position du disque avec la méthode <strong>getPosition </strong>qui renvoie les coordonnées qu'il suffit ensuite d'appliquer à la ligne en définissant une nouvelle série de points de traçage.</p><h5 id="r-contraintes-de-deplacement" data-claire-element-id="428773">Contraintes de déplacement</h5><p id="r-428772" data-claire-element-id="428772">On veut parfois interdire à la forme déplacée de dépasser une certaine limite, ou alors de rester dans un espace particulier, en un mot contraindre le déplacement selon nos besoins. <strong>KineticJS </strong>dans ses précédentes versions ne prévoyait que deux possibilités : une contrainte linéaire horizontale ou verticale, ou une limite de déplacement. La version 4.02 a amélioré les choses, désormais on dispose d'une fonction pour écrire le code que l'on veut :) . La propriété à utiliser est <strong>dragBoundFunc</strong>. Elle prend comme valeur la fonction à utiliser pour effectuer la contrainte.</p><h5 id="r-contrainte-lineaire" data-claire-element-id="428787">Contrainte linéaire</h5><p id="r-428774" data-claire-element-id="428774">On peut facilement contraindre le déplacement sur un trajet linéaire, par exemple horizontal et vertical. Voici un exemple :</p><pre id="r-428775" data-claire-element-id="428775"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	var trame_flèche = [{x:50,y:50},{x:90,y:90},{x:60,y:90},{x:60,y:190},{x:90,y:190},
                            {x:50,y:230},{x:10,y:190},{x:40,y:190},{x:40,y:90},{x:10,y:90}]; 
	
	var flèche1 = new Kinetic.Polygon({
	  points: trame_flèche,
	  fill: &quot;#00D2FF&quot;,
	  stroke: &quot;black&quot;,
	  strokeWidth: 5,
	  offset: [-50, 0],
	  draggable: true,
	  dragBoundFunc: function(pos) {
		return {
			x: this.getAbsolutePosition().x, 
			y: pos.y
		}
	  }
	});
	
	var flèche2 = new Kinetic.Polygon({
	  points: trame_flèche,
	  fill: &quot;red&quot;,
	  stroke: &quot;darkred&quot;,
	  strokeWidth: 5,
	  offset: [-100, 500],
	  rotationDeg: 90,
	  draggable: true,
	  dragBoundFunc: function(pos) {
		return {
			x: pos.x, 
			y: this.getAbsolutePosition().y
		}
	  }
	});
	
	calque.add(flèche1);
	calque.add(flèche2);
	scène.add(calque);
};</code></pre><p id="r-428776" data-claire-element-id="428776"><a href="http://tutozero.free.fr/kinetic/tutos03/drag_drop_06a.html">Tester !</a></p><figure id="r-428778" data-claire-element-id="428779"><img id="r-428777" data-claire-element-id="428777" src="medias/uploads.siteduzero.com_files_405001_406000_405018.png" alt="Image utilisateur"/></figure><p id="r-428780" data-claire-element-id="428780">La flèche bleue ne peut être déplacée que verticalement et la rouge seulement horizontalement.</p><p id="r-428781" data-claire-element-id="428781">On peut aussi contraindre un déplacement oblique :</p><pre id="r-428782" data-claire-element-id="428782"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	var trame_flèche = [{x:50,y:50},{x:90,y:90},{x:60,y:90},{x:60,y:190},{x:90,y:190},
                            {x:50,y:230},{x:10,y:190},{x:40,y:190},{x:40,y:90},{x:10,y:90}]; 
		
	var flèche = new Kinetic.Polygon({
	  points: trame_flèche,
	  fill: &quot;#00D2FF&quot;,
	  stroke: &quot;#00f&quot;,
	  strokeWidth: 5,
	  offset: [-150, 150],
	  draggable: true,
	  rotation: Math.PI / 4,
	  dragBoundFunc: function(pos) {
		if(pos.x &lt; -85) pos.x = -85;
		else if(pos.x &gt; 70) pos.x = 70;
		return {
			x: pos.x, 
			y: -pos.x
		}
	  }
	});
	
	calque.add(flèche);
	scène.add(calque);
};</code></pre><p id="r-428783" data-claire-element-id="428783"><a href="http://tutozero.free.fr/kinetic/tutos03/drag_drop_09.html">Tester !</a></p><figure id="r-428785" data-claire-element-id="428786"><img id="r-428784" data-claire-element-id="428784" src="medias/uploads.siteduzero.com_files_405001_406000_405020.png" alt="Image utilisateur"/></figure><h5 id="r-limite-de-deplacement" data-claire-element-id="428800">Limite de déplacement</h5><p id="r-428788" data-claire-element-id="428788">On peut aussi définir des limites de déplacement dans les 4 directions de l'espace. Voici un premier exemple avec un carré dont on limite les déplacements à l'intérieur de la scène pour éviter le débordement :</p><pre id="r-428789" data-claire-element-id="428789"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	var carré = new Kinetic.Rect({
	  x: 150,
	  y: 100,
	  width: 60,
	  height: 60,
	  fill: &quot;orange&quot;,
	  draggable: true,
	  dragBoundFunc: function(pos) {
		  if(pos.x &lt; 0) pos.x = 0;
		  else if(pos.x &gt; scène.getWidth() - 60) pos.x = scène.getWidth() - 60;
		  if(pos.y &lt; 0) pos.y = 0;
		  else if(pos.y &gt; scène.getHeight() - 60) pos.y = scène.getHeight() - 60;		  
		  return {
			x: pos.x,
			y: pos.y
		  };
	  }
	});
	
	calque.add(carré);
	scène.add(calque);
};</code></pre><p id="r-428790" data-claire-element-id="428790"><a href="http://tutozero.free.fr/kinetic/tutos03/drag_drop_07a.html">Tester !</a></p><figure id="r-428792" data-claire-element-id="428793"><img id="r-428791" data-claire-element-id="428791" src="medias/uploads.siteduzero.com_files_405001_406000_405021.png" alt="Image utilisateur"/></figure><p id="r-428794" data-claire-element-id="428794">Voici un autre exemple avec 4 flèches, chacune est limitée en déplacement dans la direction qu'elle indique pour ne pas déborder de la scène :</p><pre id="r-428795" data-claire-element-id="428795"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	var trame_flèche = [{x:50,y:50},{x:90,y:90},{x:60,y:90},{x:60,y:160},{x:40,y:160},{x:40,y:90},{x:10,y:90}];
		
	var flèche1 = new Kinetic.Polygon({
	  points: trame_flèche,
	  fill: &quot;#00D2FF&quot;,
	  stroke: &quot;#00f&quot;,
	  strokeWidth: 5,
	  offset: [-50, 0],
	  draggable: true,
	  dragBoundFunc: function(pos) {
		var Y = pos.y &lt; -50 ? -50 : pos.y;
		return {
			x: this.getAbsolutePosition().x, 
			y: Y
		}
	  }
	});
	
	var flèche2 = new Kinetic.Polygon({
	  points: trame_flèche,
	  fill: &quot;red&quot;,
	  stroke: &quot;darkred&quot;,
	  strokeWidth: 5,
	  offset: [-100, 500],
	  rotationDeg: 90,
	  draggable: true,
	  dragBoundFunc: function(pos) {
		var X = pos.x &gt; 50 ? 50 : pos.x;
		return {
			x: X, 
			y: this.getAbsolutePosition().y,
		}
	  }
	});
	
	var flèche3 = new Kinetic.Polygon({
	  points: trame_flèche,
	  fill: &quot;green&quot;,
	  stroke: &quot;darkgreen&quot;,
	  strokeWidth: 5,
	  offset: [300, 300],
	  rotationDeg: 180,
	  draggable: true,
	  dragBoundFunc: function(pos) {
		var Y = pos.y &gt; 50 ? 50 : pos.y;
		return {
			x: this.getAbsolutePosition().x, 
			y: Y
		}
	  }
	});
	
	var flèche4 = new Kinetic.Polygon({
	  points: trame_flèche,
	  fill: &quot;yellow&quot;,
	  stroke: &quot;#550&quot;,
	  strokeWidth: 5,
	  offset: [300, 0],
	  rotationDeg: 270,
	  draggable: true,
	  dragBoundFunc: function(pos) {
		var X = pos.x &lt; -50 ? -50 : pos.x;
		return {
			x: X, 
			y: this.getAbsolutePosition().y,
		}
	  }
	});
	
	calque.add(flèche1);
	calque.add(flèche2);
	calque.add(flèche3);
	calque.add(flèche4);
	scène.add(calque);
};</code></pre><p id="r-428796" data-claire-element-id="428796"><a href="http://tutozero.free.fr/kinetic/tutos03/drag_drop_08a.html">Tester !</a></p><figure id="r-428798" data-claire-element-id="428799"><img id="r-428797" data-claire-element-id="428797" src="medias/uploads.siteduzero.com_files_405001_406000_405022.png" alt="Image utilisateur"/></figure>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
<span class="arrow"></span>
<span class="next">Evénements</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
<span class="next">TP</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="TP"></a><h2>TP</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
<span class="arrow"></span>
<span class="next">Glisser-déposer</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">
<span class="next">Un exemple d&#039;application</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-tp-1" data-claire-element-id="428830">TP</h4><h5 id="r-un-petit-jeu" data-claire-element-id="428820">Un petit jeu</h5><p id="r-428802" data-claire-element-id="428802">Je vous propose de réaliser un petit jeu qu'on va faire en deux étapes. Dans la première étape, on dessine un disque et on doit pouvoir le pousser avec le curseur de la souris de telle façon qu'il s'échappe à mesure qu'on le touche avec le curseur :</p><figure id="r-428804" data-claire-element-id="428805"><img id="r-428803" data-claire-element-id="428803" src="medias/uploads.siteduzero.com_files_405001_406000_405035.png" alt="Image utilisateur"/></figure><p id="r-428806" data-claire-element-id="428806"><a href="http://tutozero.free.fr/kinetic/tutos03/tp_01.html">Tester !</a><br/> Il y a bien sûr des tas de façons de réaliser ça, mais vous allez être obligé de choisir le bon événement et de le coder correctement ainsi que tous les éléments à dessiner à l'écran. Vous devez effacer le texte dès que vous commencez le jeu. Il y a la propriété <strong>hide </strong>pour réaliser cela.</p><p id="r-428807" data-claire-element-id="428807"></p><div id="r-428810" data-claire-element-id="428810"><pre id="r-428808" data-claire-element-id="428808"><code data-claire-semantic="javascript">function getRandom() {
	if(Math.random() &gt; .5) return 1; else return -1;
}
function getPos(val, maxi) {
	if(val &lt; 20) return (val + 20);
	if(val &gt; maxi - 20) return (val - 20);
	return val + 20 * getRandom();	
}
window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	var Disque = new Kinetic.Ellipse({
	  x: 250,
	  y: 150,
	  radius: 20,
	  fill: &quot;red&quot;
	});
		
	var Texte = new Kinetic.Text({
	  y: 10,
	  text: &quot;Attrapez le disque !&quot;,
	  fontSize: 14,
	  fontFamily: &quot;verdana&quot;,
	  textFill: &quot;grey&quot;,
	  lineHeight: 2,
	  width: 480,
	  align: &quot;center&quot;
	});
	
	Disque.on(&quot;mousemove&quot;, function() {
		Texte.hide();
		Disque.setX(getPos(Disque.getX(), 500));
		Disque.setY(getPos(Disque.getY(), 300));
		calque.draw();
	});
	
	calque.add(Disque);
	calque.add(Texte);
	scène.add(calque);
};</code></pre><p id="r-428809" data-claire-element-id="428809">J'ai choisi l'événement <strong>mousemove </strong>qui me paraît adapté, je vous laisse analyser le code.</p></div><p id="r-428811" data-claire-element-id="428811">Passons à la deuxième étape de notre jeu. cette fois on va un peu améliorer en donnant un objectif, pousser le disque dans un carré :</p><figure id="r-428813" data-claire-element-id="428814"><img id="r-428812" data-claire-element-id="428812" src="medias/uploads.siteduzero.com_files_405001_406000_405036.png" alt="Image utilisateur"/></figure><p id="r-428815" data-claire-element-id="428815"><a href="http://tutozero.free.fr/kinetic/tutos03/tp_02.html">Tester !</a><br/> Vous pouvez afficher un message de félicitation à la fin en changeant le texte et en le faisant réapparaître avec la méthode <strong>show</strong>. Vous aurez un peu plus de travail de codage, mais rien de bien difficile :p.</p><p id="r-428816" data-claire-element-id="428816"></p><div id="r-428819" data-claire-element-id="428819"><pre id="r-428817" data-claire-element-id="428817"><code data-claire-semantic="javascript">function getRandom() {
	if(Math.random() &gt; .5) return 1; else return -1;
}
function getPos(val, maxi) {
	if(val &lt; 20) return (val + 20);
	if(val &gt; maxi - 20) return (val - 20);
	return val + 20 * getRandom();	
}
function getPosBis(val, ref, maxi) {
	if(val &lt; 20) return (val + 20);
	if(val &gt; maxi - 20) return (val - 20);
	if(ref - val &gt; 0) return val - 20;
	else return val + 20;	
}
function testGain(x, y) {
	return (Math.abs(x - 75) &lt; 20) &amp;&amp; (Math.abs(y - 75) &lt; 20);
}
window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	var Rectangle = new Kinetic.Rect({
	  x: 40,
	  y: 40,
	  width: 70,
	  height: 70,
	  stroke: &quot;black&quot;,
	  strokeWidth: 4
	});
	
	var Disque = new Kinetic.Ellipse({
	  x: 250,
	  y: 150,
	  radius: 20,
	  fill: &quot;red&quot;
	});
		
	var Texte = new Kinetic.Text({
	  y: 10,
	  text: &quot;Poussez le disque dans le carré !&quot;,
	  fontSize: 14,
	  fontFamily: &quot;verdana&quot;,
	  textFill: &quot;grey&quot;,
	  lineHeight: 2,
	  width: 480,
	  align: &quot;center&quot;
	});
	
	Disque.on(&quot;mousemove&quot;, function() {
		Texte.hide();
		var mousePos = scène.getMousePosition();
		if(Math.random() &lt; .5) {
			Disque.setX(getPos(Disque.getX(), 500));
			Disque.setY(getPos(Disque.getY(), 300));
		}
		else {
			Disque.setX(getPosBis(Disque.getX(), mousePos.x, 500));
			Disque.setY(getPosBis(Disque.getY(), mousePos.y, 300));			
		}
		if(testGain(Disque.getX(), Disque.getY())) {
			Texte.setText(&quot;Bravo vous avez gagné !&quot;);
			Texte.show();
			Disque.setX(75);
			Disque.setY(75);
			Disque.off(&quot;mousemove&quot;);
		}
		calque.draw();
	});
	
	calque.add(Rectangle);
	calque.add(Disque);
	calque.add(Texte);
	scène.add(calque);
};</code></pre><p id="r-428818" data-claire-element-id="428818">Je n'ai pas particulièrement cherché à optimiser le code, le but n'est pas un exercice de style de <strong>Javascript</strong> mais de manipuler les objets de <strong>KineticJS</strong>. J'ai créé quelques sautes d'humeur aléatoires pour le déplacement du disque pour corser un peu le jeu.</p></div><h5 id="r-un-tool-tip" data-claire-element-id="428829">Un tool-tip</h5><p id="r-428821" data-claire-element-id="428821">Je vous propose maintenant de reprendre l'exemple où on détectait la position du curseur de la souris, mais cette fois en faisant apparaître les valeurs dans un tooltip :</p><figure id="r-428823" data-claire-element-id="428824"><img id="r-428822" data-claire-element-id="428822" src="medias/uploads.siteduzero.com_files_405001_406000_405037.png" alt="Image utilisateur"/></figure><p id="r-428825" data-claire-element-id="428825"><a href="http://tutozero.free.fr/kinetic/tutos03/tp_04.html">Tester !</a><br/> Ce qui serait bien c'est que le tooltip n'apparaisse que lorsque le curseur est au-dessus de la scène. Il existe la propriété <strong>visible </strong>qui peut prend les valeurs <strong>true </strong>ou <strong>false </strong>pour gérer la visibilité d'un objet. On peut changer cette valeur ensuite avec les méthodes <strong>show </strong>et <strong>hide</strong>.</p><p id="r-428826" data-claire-element-id="428826"></p><div id="r-428828" data-claire-element-id="428828"><pre id="r-428827" data-claire-element-id="428827"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	var Rectangle = new Kinetic.Rect({
	  width: scène.getWidth(),
	  height: scène.getHeight(),
	  fill: &quot;#ade&quot;,
	});
		
	var Tooltip = new Kinetic.Text({
		text: &quot;&quot;,
		textFill: &quot;yellow&quot;,
		fontFamily: &quot;Arial&quot;,
		fontSize: 10,
		padding: 4,
		fill: &quot;grey&quot;,
		opacity: 0.9,
		shadow: {
			color: &quot;grey&quot;,
			blur: 14,
			offset: [2, 2],
			opacity: 0.7
		},
		visible: false
	});
	
	scène.on(&quot;mousemove&quot;, function() {
		var mousePos = scène.getMousePosition();
		var x = mousePos.x;
		var y = mousePos.y;
		var text = &quot;X = &quot; + x + &quot; Y = &quot; + y;
		if(x &gt; 400) x = 400;
		if(y &gt; 280) y = 280;
		with(Tooltip) {
			show();
			setPosition(x, y);
			setText(text);
		}
		calque.draw();
	});
	
	scène.on(&quot;mouseout&quot;, function() {
		Tooltip.hide();
		calque.draw();
	});
	
	calque.add(Rectangle);
	calque.add(Tooltip);
	scène.add(calque);
};</code></pre></div>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
<span class="arrow"></span>
<span class="next">Glisser-déposer</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">
<span class="next">Un exemple d&#039;application</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Unexempled039application"></a><h2>Un exemple d&#039;application</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
<span class="arrow"></span>
<span class="next">TP</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
<span class="next">Présentation</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-428832" data-claire-element-id="428832">Maintenant que nous avons vu les principales fonctionnalités de <strong>KineticJS</strong>, en dehors de ses capacités d'animation, je vous propose d'analyser une application de création graphique modeste, mais qui permet de voir un certain nombre des possibilités de cette librairie dans un environnement pratique.</p>
</div><a name="Prsentation"></a><h2>Présentation</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">
<span class="arrow"></span>
<span class="next">Un exemple d&#039;application</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
<span class="next">Le dessin</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-presentation-111" data-claire-element-id="428887">Présentation</h4><p id="r-428833" data-claire-element-id="428833">Cette application utilise le kit <strong>CSS Bootstrap de Twitter</strong>, elle me sert également d'exemple pour <a href="http://www.siteduzero.com/tutoriel-3-683140-bootstrap-un-kit-css-et-plus.html">mon tutoriel sur ce kit</a>. C'est dans ce tutoriel qu'est abordée la partie <strong>HTML </strong>et <strong>CSS</strong>.</p><p id="r-428834" data-claire-element-id="428834">Vous pouvez <a href="http://bootstrap.twit.free.fr/tuto/editeur_v1.html">tester l'éditeur en ligne</a> pour voir son fonctionnement.</p><h5 id="r-aspect-de-l-interface" data-claire-element-id="428839">Aspect de l'interface</h5><p id="r-428835" data-claire-element-id="428835">L'interface se présente ainsi :</p><figure id="r-428837" data-claire-element-id="428838"><img id="r-428836" data-claire-element-id="428836" src="medias/uploads.siteduzero.com_files_405001_406000_405024.png" alt="Image utilisateur"/></figure><h5 id="r-les-menus-7" data-claire-element-id="428844">Les menus</h5><p id="r-428840" data-claire-element-id="428840">Les menus regroupent un certain nombre de fonctionnalités : réglage du niveau de visibilité des formes dessinées, copier-coller :</p><figure id="r-428842" data-claire-element-id="428843"><img id="r-428841" data-claire-element-id="428841" src="medias/uploads.siteduzero.com_files_405001_406000_405025.png" alt="Image utilisateur"/></figure><h5 id="r-les-barres-de-boutons-1" data-claire-element-id="428849">Les barres de boutons</h5><p id="r-428845" data-claire-element-id="428845">Ces boutons sont regroupés en deux catégories : une pour le dessin, l'autre pour l'édition:</p><figure id="r-428847" data-claire-element-id="428848"><img id="r-428846" data-claire-element-id="428846" src="medias/uploads.siteduzero.com_files_405001_406000_405026.png" alt="Image utilisateur"/></figure><h5 id="r-la-barre-inferieure" data-claire-element-id="428854">La barre inférieure</h5><p id="r-428850" data-claire-element-id="428850">La barre inférieure rassemble les contrôles pour le réglage de l'épaisseur des lignes, leur couleur, et aussi le remplissage des formes :</p><figure id="r-428852" data-claire-element-id="428853"><img id="r-428851" data-claire-element-id="428851" src="medias/uploads.siteduzero.com_files_405001_406000_405027.png" alt="Image utilisateur"/></figure><h5 id="r-il-sait-faire-quoi" data-claire-element-id="428877">Il sait faire quoi ?</h5><p id="r-428855" data-claire-element-id="428855">Pour le fonctionnement on retrouve les opérations standards de ce type d'application :</p><ul id="r-428876" data-claire-element-id="428876"><li id="r-428857" data-claire-element-id="428857"><p id="r-428856" data-claire-element-id="428856">Mode sélection ou dessin (ligne, rectangle ou ellipse)</p></li><li id="r-428859" data-claire-element-id="428859"><p id="r-428858" data-claire-element-id="428858">Sélection au clic avec apparition de sélecteurs pour changer les dimensions</p></li><li id="r-428861" data-claire-element-id="428861"><p id="r-428860" data-claire-element-id="428860">Formes &quot;draggables&quot; lorsqu’elles sont sélectionnées</p></li><li id="r-428863" data-claire-element-id="428863"><p id="r-428862" data-claire-element-id="428862">Copier-coller des formes</p></li><li id="r-428865" data-claire-element-id="428865"><p id="r-428864" data-claire-element-id="428864">Annulation-répétition de toutes les formes</p></li><li id="r-428867" data-claire-element-id="428867"><p id="r-428866" data-claire-element-id="428866">Changement dynamique de l'épaisseur et de la couleur des traits</p></li><li id="r-428869" data-claire-element-id="428869"><p id="r-428868" data-claire-element-id="428868">Changement dynamique du remplissage</p></li><li id="r-428871" data-claire-element-id="428871"><p id="r-428870" data-claire-element-id="428870">Réglage de l'ordre de superposition des formes</p></li><li id="r-428873" data-claire-element-id="428873"><p id="r-428872" data-claire-element-id="428872">Enregistrement au format &quot;image&quot;</p></li><li id="r-428875" data-claire-element-id="428875"><p id="r-428874" data-claire-element-id="428874">Enregistrement au format JSON</p></li></ul><h5 id="r-principe-de-fonctionnement-5" data-claire-element-id="428886">Principe de fonctionnement</h5><p id="r-428878" data-claire-element-id="428878">Dans ce type d'application il faut considérer deux états : les formes déjà dessinées et les formes en cours de dessin ainsi que les sélecteurs. Pour gérer efficacement ces deux types d'objets on va utiliser deux calques. Un calque inférieur (calque_bottom) pour contenir les formes déjà dessinées, et un calque supérieur (calque_top) pour contenir les formes transitoires en cours de création et les sélecteurs servant à changer leur dimension. Voici une illustration de cette organisation :</p><figure id="r-428880" data-claire-element-id="428881"><img id="r-428879" data-claire-element-id="428879" src="medias/uploads.siteduzero.com_files_405001_406000_405028.png" alt="Image utilisateur"/></figure><p id="r-428882" data-claire-element-id="428882">Ces deux calques sont évidemment contenus dans une scène. On trouve donc au niveau du code ces éléments de base :</p><pre id="r-428883" data-claire-element-id="428883"><code data-claire-semantic="javascript">// Création de la scène
var scène = new Kinetic.Stage({
  container: &quot;kinetic&quot;,
  width: 850,
  height: 400
});

// Création des calques
var calque_top = new Kinetic.Layer();
var calque_bottom = new Kinetic.Layer();

// Ajout des calques à la scène	
scène.add(calque_bottom);
scène.add(calque_top);</code></pre><p id="r-428884" data-claire-element-id="428884">Les variables globales sont rassemblées dans un objet pour plus de clarté au niveau du code :</p><pre id="r-428885" data-claire-element-id="428885"><code data-claire-semantic="javascript">// Paramètres globaux
var params = {
	modes: ['selection','ligne','rectangle','ellipse'],
	id_mode: 0,
	line_color: 'black',
	line_width: 2,
	fill_color: 'white',
	line_type: 'Unie',
	fill_type: 'Sans',
	en_cours: false,
	start_point: [],
	objet_modif: {},
	selecteurs: [],
	box: {},
	objets_effaces: [],
	objet_copie: null,
	inhibe_selection: false
};</code></pre>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">
<span class="arrow"></span>
<span class="next">Un exemple d&#039;application</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
<span class="next">Le dessin</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Ledessin"></a><h2>Le dessin</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
<span class="arrow"></span>
<span class="next">Présentation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
<span class="next">Sélection et édition</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-le-dessin-1" data-claire-element-id="428930">Le dessin</h4><p id="r-428888" data-claire-element-id="428888">Lorsqu'on veut dessiner l'une des trois formes à disposition (ligne, rectangle ou ellipse) on commence par choisir cette forme en cliquant sur le bouton correspondant :</p><figure id="r-428890" data-claire-element-id="428891"><img id="r-428889" data-claire-element-id="428889" src="medias/uploads.siteduzero.com_files_405001_406000_405029.png" alt="Image utilisateur"/></figure><p id="r-428892" data-claire-element-id="428892">Ce qui a pour effet de transformer le curseur pour afficher une croix. Le processus de dessin peut alors avoir lieu, il s'effectue en 3 étapes :</p><ol id="r-428899" data-claire-element-id="428899"><li id="r-428894" data-claire-element-id="428894"><p id="r-428893" data-claire-element-id="428893">Un appui sur le bouton de la souris pour fixer le point initial de la forme</p></li><li id="r-428896" data-claire-element-id="428896"><p id="r-428895" data-claire-element-id="428895">Un mouvement de la souris pour dessiner une forme transitoire tout en gardant le bouton enfoncé</p></li><li id="r-428898" data-claire-element-id="428898"><p id="r-428897" data-claire-element-id="428897">Un relâchement du bouton de la souris pour dessiner définitivement la forme</p></li></ol><p id="r-428900" data-claire-element-id="428900">Nous avons vu que les événements de la souris peuvent être captés sur les <strong>nodes </strong>de <strong>KineticJS</strong>, par contre lorsqu'on est sur une zone vide du <strong>canvas </strong>ça ne marche plus. Il faut donc prévoir les événements de la souris directement sur les <strong>canvas </strong>:</p><pre id="r-428901" data-claire-element-id="428901"><code data-claire-semantic="javascript">// Evénements de souris sur le canvas
$('canvas')
   .mousedown(function(e){

      // Etape 1

   })
   .mousemove(function(e){

      // Etape 2

   })
   .mouseup(function(e){

      // Etape 3

   })
});</code></pre><h5 id="r-etape-1-fixation-du-point-initial" data-claire-element-id="428905">Etape 1 : fixation du point initial</h5><p id="r-428902" data-claire-element-id="428902">Lorsqu'on clique pour commencer à dessiner une forme il nous faut déterminer les coordonnées du curseur et les mémoriser :</p><pre id="r-428903" data-claire-element-id="428903"><code data-claire-semantic="javascript">// Position de la souris
var offset = $('.kineticjs-content').offset();
var x = e.pageX - offset.left;
var y = e.pageY - offset.top;
// Mémorisation de la position
params.start_point = [x, y];
params.en_cours = true;</code></pre><p id="r-428904" data-claire-element-id="428904">Les coordonnées sont enregistrées dans la variable <strong>start_point</strong> et on renseigne aussi la variable <strong>en_cours</strong> qui indique qu'on est en train de dessiner une forme.</p><h5 id="r-etape-2-positionnement-sur-le-point-final" data-claire-element-id="428923">Etape 2 : positionnement sur le point final</h5><p id="r-428906" data-claire-element-id="428906">Dans cette étape on garde le bouton de la souris pressé et on la déplace, la forme doit suivre de façon dynamique à l'écran sur le calque <strong>calque_top</strong> prévu pour les éléments transitoires. Extrayons de l'événement <strong>mousemove </strong>les éléments essentiels :</p><pre id="r-428907" data-claire-element-id="428907"><code data-claire-semantic="javascript">.mousemove(function(e){
	// Si mode sélection
	if(params.modes[params.id_mode] == 'selection') {

           // Mode sélection que nous voyons plus loin
			
	}
	// Si mode dessin
	else if(params.en_cours) {

		// Position de la souris
		var offset = $('.kineticjs-content').offset();
		var x = e.pageX - offset.left;
		var y = e.pageY - offset.top;
		
                ...
		
		if(params.modes[params.id_mode] == 'ligne') {

                   // Dessin d'une ligne

		}
		// Cas du rectangle
		else if(params.modes[params.id_mode] == 'rectangle') {

                   // Dessin d'un rectangle

		}
		// Cas de l'ellipse
		else if(params.modes[params.id_mode] == 'ellipse') {

                   // Dessin d'une ellipse

		}
		calque_top.draw();
	}		
})</code></pre><p id="r-428908" data-claire-element-id="428908">On récupère bien sûr encore les coordonnées de la souris. On veut ensuite savoir ce qu'on a à dessiner, on prévoit donc 3 cas, et en dernier on rafraîchit le calque avec sa méthode <strong>draw</strong>. prenons par exemple le cas d'une ligne, voilà un autre extrait de code :</p><pre id="r-428909" data-claire-element-id="428909"><code data-claire-semantic="javascript">// Shape en cours
var shapes = calque_top.getChildren();
// Cas de la ligne
if(params.modes[params.id_mode] == 'ligne') {
	// Ligne déjà créée
	if(shapes.length) {
		shapes[0].setPoints(params.start_point.concat([x, y]));
	}
	// Création de la ligne
	else {
		var ligne = new Kinetic.Line({
			points: params.start_point.concat([x, y]),
			stroke: params.line_color,
			strokeWidth: params.line_width
		});		
		calque_top.add(ligne);
	}
}</code></pre><p id="r-428910" data-claire-element-id="428910">On doit envisager deux situations :</p><ol id="r-428915" data-claire-element-id="428915"><li id="r-428912" data-claire-element-id="428912"><p id="r-428911" data-claire-element-id="428911">la ligne n'a pas encore été créée : il faut donc le faire</p></li><li id="r-428914" data-claire-element-id="428914"><p id="r-428913" data-claire-element-id="428913">la ligne a déjà été créée : on peut alors se contenter d'actualiser sa position</p></li></ol><p id="r-428916" data-claire-element-id="428916">La méthode <strong>getChildren </strong>permet de récupérer un tableau de tous les <strong>nodes </strong>présents sur un calque. Donc avec cette ligne :</p><pre id="r-428917" data-claire-element-id="428917"><code data-claire-semantic="javascript">var shapes = calque_top.getChildren();</code></pre><p id="r-428918" data-claire-element-id="428918">On obtient dans le tableau <strong>shapes </strong>ce qu'on a déjà dessiné, autrement dit rien si c'est juste le début, ou une <strong>shape </strong>si on a commencé le tracé. Donc si la ligne est déjà créée :</p><pre id="r-428919" data-claire-element-id="428919"><code data-claire-semantic="javascript">// Ligne déjà créée
if(shapes.length) {
	shapes[0].setPoints(params.start_point.concat([x, y]));
}</code></pre><p id="r-428920" data-claire-element-id="428920">On se contente de mettre à jour sa propriété <strong>points</strong>. Par contre si elle n'a jamais été créée il faut le faire en prenant les paramètres <strong>line_color</strong> et <strong>line_width</strong> actuels :</p><pre id="r-428921" data-claire-element-id="428921"><code data-claire-semantic="javascript">// Création de la ligne
else {
	var ligne = new Kinetic.Line({
		points: params.start_point.concat([x, y]),
		stroke: params.line_color,
		strokeWidth: params.line_width
	});		
	calque_top.add(ligne);
}</code></pre><p id="r-428922" data-claire-element-id="428922">C'est évidemment le même scénario pour les carrés et les ellipses...</p><h5 id="r-etape-3-dessin-definitif" data-claire-element-id="428929">Etape 3 : dessin définitif</h5><p id="r-428924" data-claire-element-id="428924">Lorsqu'on est satisfait de la dimension et de la position de la forme dessinée, on relâche le bouton de la souris. Cela doit effacer la forme du calque <strong>calque_top</strong> pour la transférer sur le calque <strong>calque_bottom</strong>. On doit aussi passer en mode &quot;sélection&quot; pour cette forme. Il faut aussi actualiser les boutons de mode dans la barre verticale. Voyons cela :</p><pre id="r-428925" data-claire-element-id="428925"><code data-claire-semantic="javascript">// Tansfert sur calque inférieur
params.objet_modif = calque_top.getChildren()[0];
params.objet_modif.moveTo(calque_bottom);
params.objet_modif.setDraggable(true);
calque_bottom.draw();

...

reset_dessin();</code></pre><p id="r-428926" data-claire-element-id="428926">La variable <strong>objet_modif</strong> doit référencer la forme en cours de sélection, c'est ce qui est fait sur la ligne 2. Ensuite la méthode <strong>moveTo </strong>de la <strong>shape </strong>permet son transfert sur le calque <strong>calque_bottom</strong>. On veut qu'un objet sélectionné soit &quot;<strong>draggable&quot;</strong>, c'est l'objet de la ligne 4 où on met la propriété draggable à <strong>true</strong>. Il suffit au final d'actualiser ce calque avec sa méthode <strong>draw</strong>. La fonction <strong>reset_dessin</strong> a pour but d'actualiser des variables et de passer en mode &quot;sélection&quot; :</p><pre id="r-428927" data-claire-element-id="428927"><code data-claire-semantic="javascript">// Reset du dessin
function reset_dessin() {
	params.en_cours = false;
	params.id_mode = 0;
	$('canvas').css('cursor', 'default');
	$('#mode .active').removeClass('active');
	$('#mode .btn:first').addClass('active');	
}</code></pre><p id="r-428928" data-claire-element-id="428928">La variable <strong>en_cours </strong>doit être à <strong>false </strong>puisqu'on ne dessine plus. La variable <strong>id_mode</strong> à 0 indique qu'on est en mode &quot;sélection&quot;. Le curseur est remis normal. Et enfin on rend actif le bouton de sélection dans la barre de boutons verticale.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
<span class="arrow"></span>
<span class="next">Présentation</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
<span class="next">Sélection et édition</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Slectionetdition"></a><h2>Sélection et édition</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
<span class="arrow"></span>
<span class="next">Le dessin</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
<span class="next">Apparence et enregistrement</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-selection-et-edition" data-claire-element-id="428993">Sélection et édition</h4><h5 id="r-selection-automatique-de-la-forme-qu-on-vient-de-dessiner" data-claire-element-id="428945">Sélection automatique de la forme qu'on vient de dessiner</h5><p id="r-428931" data-claire-element-id="428931">On a vu que lorsqu'on dessine une forme elle passe en mode &quot;sélection&quot;, il doit en être de même lorsqu'on clique sur une forme dans ce mode. Voyons déjà le premier cas que nous avons laissé en suspens :</p><pre id="r-428932" data-claire-element-id="428932"><code data-claire-semantic="javascript">.mouseup(function(e){
	// Dessin effectif
	if(params.modes[params.id_mode] != 'selection' &amp;&amp; params.en_cours) {
		// Tansfert sur calque inférieur

                   ...

		// Mise en place événements de drag
		params.objet_modif.on(&quot;dragstart&quot;, function() {
			calque_top.removeChildren();
			calque_top.draw();
		});
		params.objet_modif.on(&quot;dragend&quot;, function() {
			select_object();
			calque_top.draw();
		});
		select_object();
		calque_top.draw();	

		...
	}
});</code></pre><p id="r-428933" data-claire-element-id="428933">Commençons par nous intéresser à la fonction <strong>select_object</strong> qui est surlignée. Le but de cette fonction est de dessiner les sélecteurs pour modifier la forme à l'écran. Ces sélecteurs doivent évidemment se trouver sur le calque <strong>calque_top</strong> :</p><pre id="r-428934" data-claire-element-id="428934"><code data-claire-semantic="javascript">// Sélection d'un objet
function select_object() {
	if(params.objet_modif.shapeType == &quot;Line&quot;) {
		var points = params.objet_modif.getPoints();
		var pos = params.objet_modif.getPosition();
		params.selecteurs = [];
		params.selecteurs.push(build_selector(points[0].x + pos.x, points[0].y + pos.y));
		params.selecteurs.push(build_selector(points[1].x + pos.x, points[1].y + pos.y));
	}
	if(params.objet_modif.shapeType == &quot;Rect&quot;) {

           ...

	}
	if(params.objet_modif.shapeType == &quot;Ellipse&quot;) {

           ...

	}
	$('canvas').css('cursor', 'default');
}</code></pre><p id="r-428935" data-claire-element-id="428935">On procède évidemment différemment selon qu'il s'agit d'une ligne, d'un rectangle ou d'une ellipse. J'ai juste gardé le cas de la ligne dans le code ci-dessus. On se rend compte qu'on récupère la valeur de la propriété points de la ligne sélectionnée dans la variable <strong>points</strong>. On récupère aussi sa position dans la variable <strong>pos</strong>.</p><div id="r-428937" data-claire-element-id="428937" data-claire-semantic="question"><p id="r-428936" data-claire-element-id="428936">Mais pourquoi aller chercher cette propriété <strong>position </strong>? On a dit qu'une ligne est parfaitement définie avec sa propriété <strong>points </strong>!</p></div><p id="r-428938" data-claire-element-id="428938">Oui et non. Lorsqu'on dessine une ligne en général on ne s'inquiète pas de sa position puisqu'on renseigne les points mais... si la <strong>shape </strong>est &quot;draggable&quot; et qu'on la bouge à l'écran la propriété <strong>points </strong>n'est pas modifiée, c'est la propriété <strong>position </strong>qui l'est ! Et comme on a dit que la <strong>shape </strong>sélectionnée est draggable il vaut mieux récupérer cette information pour dessiner les sélecteurs au bon endroit ;) .</p><p id="r-428939" data-claire-element-id="428939">Quand on a cette position, on peut dessiner les sélecteurs et les mémoriser dans la variable <strong>selecteurs</strong>. C'est la fonction <strong>build_selector</strong> qui est chargée de ce dessin :</p><pre id="r-428940" data-claire-element-id="428940"><code data-claire-semantic="javascript">// Création des sélecteurs
function build_selector(x, y) {
	var selector = new Kinetic.Circle({
		x: x,
		y: y,
		radius: 5,
		stroke: &quot;#666&quot;,
		fill: &quot;#ddd&quot;,
		strokeWidth: 2,
		draggable: true,
		name: 'selector'
	});
	
	selector.on(&quot;mouseover&quot;, function() {
		$('canvas').css('cursor', 'pointer');
		this.setOpacity(.1);
		inhibe_selection = true;
		calque_top.draw();
	});
	selector.on(&quot;mouseout&quot;, function() {
		$('canvas').css('cursor', 'default');
		this.setOpacity(1);
		inhibe_selection = false;
		calque_top.draw();
	});
	
	calque_top.add(selector);
	return selector;
}</code></pre><p id="r-428941" data-claire-element-id="428941">Dans la première partie, on dessine un cercle en le rendant &quot;draggable&quot;. On met ensuite en place deux événements. Lorsque le curseur est sur le sélecteur (<strong>mouseover</strong>) on change son aspect, on réduit l'opacité pour presque faire disparaître le sélecteur (comme ça on voit mieux ou on bouge l’extrémité dune ligne), on met à <strong>true </strong>la variable <strong>inhibe_selection</strong>, ce qui va nous éviter de sélectionner une autre shape alors qu'on veut en modifier une, et enfin on actualise le calque. Évidemment dans l'événement opposé (<strong>mouseout</strong>) on fait exactement l'inverse :) .</p><p id="r-428942" data-claire-element-id="428942">Revenons maintenant un peu au moment où on a lâché le bouton de la souris pour dessiner la <strong>shape </strong>:</p><pre id="r-428943" data-claire-element-id="428943"><code data-claire-semantic="javascript">.mouseup(function(e){
	// Dessin effectif
	if(params.modes[params.id_mode] != 'selection' &amp;&amp; params.en_cours) {

                   ...

		// Mise en place événements de drag
		params.objet_modif.on(&quot;dragstart&quot;, function() {
			calque_top.removeChildren();
			calque_top.draw();
		});
		params.objet_modif.on(&quot;dragend&quot;, function() {
			select_object();
			calque_top.draw();
		});

                   ...
	}
});</code></pre><p id="r-428944" data-claire-element-id="428944">C'est là qu'on met en place les événements du &quot;glisser&quot; pour supprimer les sélecteurs au début du mouvement et en redessiner à la fin de ce mouvement.</p><h5 id="r-cas-de-l-ellipse" data-claire-element-id="428955">Cas de l'ellipse</h5><p id="r-428946" data-claire-element-id="428946">L'ellipse nécessite plus que des sélecteurs pour son édition étant donné sa forme particulière. Il est judicieux de représenter visuellement le cadre qui l'enveloppe :</p><figure id="r-428948" data-claire-element-id="428949"><img id="r-428947" data-claire-element-id="428947" src="medias/uploads.siteduzero.com_files_405001_406000_405030.png" alt="Image utilisateur"/></figure><p id="r-428950" data-claire-element-id="428950">Vous retrouvez cela au niveau du code pour l'ellipse :</p><pre id="r-428951" data-claire-element-id="428951"><code data-claire-semantic="javascript">if(params.objet_modif.shapeType == &quot;Ellipse&quot;) {
	var x = params.objet_modif.getX();
	var y = params.objet_modif.getY();
	var radius = params.objet_modif.getRadius();
	params.selecteurs = [];
	params.box = build_box(x - radius.x, y - radius.y, x + radius.x, y + radius.y);
	params.selecteurs.push(build_selector(x - radius.x, y - radius.y));
	params.selecteurs.push(build_selector(x + radius.x, y + radius.y));
}</code></pre><p id="r-428952" data-claire-element-id="428952">J'ai surligné le code particulier. On voit la création de ce cadre avec la fonction <strong>build_box</strong> :</p><pre id="r-428953" data-claire-element-id="428953"><code data-claire-semantic="javascript">// Création du cadre en pointillés
function build_box(x1, y1, x2, y2) {
	var box = new Kinetic.Line({
		points: [x1, y1, x2 , y1, x2, y2, x1, y2, x1, y1],
		dashArray: [5, 5],
		strokeWidth: 1,
		stroke: &quot;#666&quot;,
		lineCap: &quot;round&quot;,
		id: &quot;box&quot;,
		opacity: 0.6
	});	
	calque_top.add(box);
	return box;
}</code></pre><p id="r-428954" data-claire-element-id="428954">Un tracé classique de ligne en renseignant correctement la propriété <strong>points</strong>.</p><h5 id="r-selection-d-une-forme-avec-un-clic" data-claire-element-id="428960">Sélection d'une forme avec un clic</h5><p id="r-428956" data-claire-element-id="428956">On doit pouvoir sélectionner n'importe qu'elle forme dessinée en cliquant dessus. Alors petit retour en arrière sur l'événement <strong>mousedown </strong>:</p><pre id="r-428957" data-claire-element-id="428957"><code data-claire-semantic="javascript">$('canvas')
.mousedown(function(e){
	// Si mode sélection
	if(params.modes[params.id_mode] == 'selection') {
		if(!inhibe_selection) {
			var offset = $('.kineticjs-content').offset();
			var p = [e.pageX - offset.left, e.pageY - offset.top];
			var shapes = scène.getIntersections(p);
			if(shapes.length &amp;&amp; shapes[0].getLayer() != calque_top &amp;&amp; shapes[0] != params.objet_modif) {
				calque_top.removeChildren();
				shapes[0].setDraggable(true);
				params.objet_modif = shapes[0];
				select_object();
				sync_controls();
				calque_top.draw();
			}
		}
	}
	// Si mode dessin
	else {

           ...

	}
})</code></pre><p id="r-428958" data-claire-element-id="428958">J'ai surligné la ligne de code la plus importante. Elle contient la méthode <strong>getIntersections </strong>qui permet de connaître les shapes dont le point passé en paramètre fait partie de leur tracé. On obtient au retour un tableau des <strong>shapes </strong>concernées. Dans notre cas on demande les <strong>shapes </strong>qui se trouvent à la position du curseur. Pour simplifier, on ne considère que la première du tableau, celle avec l'index 0.</p><p id="r-428959" data-claire-element-id="428959">Si on en trouve une, on commence par enlever les sélecteurs éventuellement présents sur le calque calque_top avec la méthode <strong>removeChildren </strong>de ce calque. On met la <strong>shape </strong>qu'on veut sélectionner &quot;draggable&quot;. On renseigne la variable <strong>objet_modif</strong> avec cette <strong>shape</strong>. On active la sélection avec la fonction <strong>select_object</strong> que nous avons vue ci-dessus. Pour ce qui concerne la synchronisation des contrôles nous le verrons plus loin. On finit par rafraîchir le calque. On se retrouve alors exactement dans la même situation que vu juste avant de la <strong>shape </strong>sélectionnée après son tracé.</p><h5 id="r-desactivation-de-la-selection-par-touche-d-echappement" data-claire-element-id="428964">Désactivation de la sélection par touche d'échappement</h5><p id="r-428961" data-claire-element-id="428961">On veut ne plus avoir de forme sélectionnée en appuyant sur la touche d'échappement :</p><pre id="r-428962" data-claire-element-id="428962"><code data-claire-semantic="javascript">// Annulation sur escape, ou destruction sur del
$(document).keydown(function(e) {
	// Annulation
	if(e.keyCode == 27) {
		if(params.modes[params.id_mode] == 'selection' || params.en_cours) {
			reset_dessin();	
			params.objet_modif = {};
			calque_top.removeChildren();
			calque_top.draw();		
		}
	}
	// Delete
	else if(e.keyCode == 46) del_object();
});</code></pre><p id="r-428963" data-claire-element-id="428963">Là c'est plus simple : &quot;reset&quot; du dessin, vidage de la variable <strong>objet_modif </strong>puisque plus rien ne va être sélectionné, effacement des sélecteurs et rafraîchissement du calque.</p><h5 id="r-edition-1" data-claire-element-id="428992">Édition</h5><p id="r-428965" data-claire-element-id="428965">J'ai rassemblé ces commandes parce qu'elles partagent un certain nombre de concepts. Elles sont mises en œuvre à partir de la barre de boutons :</p><figure id="r-428967" data-claire-element-id="428968"><img id="r-428966" data-claire-element-id="428966" src="medias/uploads.siteduzero.com_files_405001_406000_405031.png" alt="Image utilisateur"/></figure><p id="r-428969" data-claire-element-id="428969">Ou du menu :</p><figure id="r-428971" data-claire-element-id="428972"><img id="r-428970" data-claire-element-id="428970" src="medias/uploads.siteduzero.com_files_405001_406000_405032.png" alt="Image utilisateur"/></figure><h6 id="r-annuler" data-claire-element-id="428976">Annuler</h6><p id="r-428973" data-claire-element-id="428973">Voici la fonction qui effectue cette opération :</p><pre id="r-428974" data-claire-element-id="428974"><code data-claire-semantic="javascript">// Annuler dernière création d'objet
function annuler_objet() {
	reset_dessin();	
	calque_top.removeChildren();
	calque_top.draw();	
	var shapes = calque_bottom.getChildren();
	if(shapes.length) {
		params.objets_effaces.push(shapes[shapes.length - 1]);
		calque_bottom.remove(shapes[shapes.length - 1]);
		calque_bottom.draw();
	}
}</code></pre><p id="r-428975" data-claire-element-id="428975">On fait un &quot;reset&quot; du dessin et on enlève tout ce qui se trouve sur le calque supérieur puisqu'on retire la <strong>shape </strong>sélectionnée. Ensuite on récupère un tableau de toutes les <strong>shapes </strong>présentes sur le calque<strong> calque_bottom</strong> avec la méthode <strong>getChildren</strong>. Un petit test pour voir s'il y en a (des petits malins peuvent cliquer sur le bouton alors que rien n'est dessiné) et on envoie une référence de la dernière <strong>shape </strong>dessinée (celle qui est à la fin du tableau avec l'index <em>length - 1</em>) dans le tableau <strong>objets_effaces</strong> qui contient les objets... effacés. On peut alors retirer la <strong>shape </strong>du calque avec la méthode <strong>remove</strong>. On finit évidemment avec un rafraichissement du calque.</p><h6 id="r-repeter" data-claire-element-id="428980">Répéter</h6><p id="r-428977" data-claire-element-id="428977">Cette commande est exactement l'inverse de la précédente puisqu'on veut faire passer une <strong>shape </strong>du tableau des effacées vers le calque <strong>calque_bottom</strong> :</p><pre id="r-428978" data-claire-element-id="428978"><code data-claire-semantic="javascript">// Répéter dernière création d'objet
function repete_objet() {
	if(params.objets_effaces.length) {
		reset_dessin();	
		calque_top.removeChildren();
		calque_top.draw();
		params.objet_modif = {};	
		var shape = params.objets_effaces.pop();
		calque_bottom.add(shape);
		// Nécessaire pour retrouver la détection
		Kinetic.Global.shapes[shape.colorKey] = shape;
		calque_bottom.draw();	
	}
}</code></pre><p id="r-428979" data-claire-element-id="428979">J'ai surligné les deux lignes importantes : on récupère la forme dans la variable <strong>shape </strong>avec un <strong>pop </strong>du tableau <strong>objets_effaces</strong>. Il suffit ensuite d'ajouter cette <strong>shape </strong>avec la méthode <strong>add</strong>. Il y a également une ligne de code un peu spéciale à cause d'une particularité de <strong>KineticJS </strong>qui fait que l'on perd la possibilité de sélection d'une forme quand on l'enlève et la remet sur un calque. Cette ligne est destinée à faire en sorte que la forme soit toujours repérable, en particulier pour le &quot;glisser&quot;.</p><h6 id="r-copier" data-claire-element-id="428984">Copier</h6><p id="r-428981" data-claire-element-id="428981">La copie se contente de mémoriser la forme sélectionnée dans la variable<strong> objet_copie</strong> et le code tient en une seule ligne :</p><pre id="r-428982" data-claire-element-id="428982"><code data-claire-semantic="javascript">params.objet_copie = params.objet_modif.clone();</code></pre><p id="r-428983" data-claire-element-id="428983">La méthode <strong>clone </strong>crée un nouvel objet identique.</p><h6 id="r-coller" data-claire-element-id="428987">Coller</h6><p id="r-428985" data-claire-element-id="428985">Le collage est l'inverse de la copie et le code se passe de commentaire :</p><pre id="r-428986" data-claire-element-id="428986"><code data-claire-semantic="javascript">if(params.objet_copie != null) {
	calque_bottom.add(params.objet_copie.clone());
	calque_bottom.draw();	
}</code></pre><h6 id="r-supprimer-4" data-claire-element-id="428991">Supprimer</h6><p id="r-428988" data-claire-element-id="428988">La suppression est très proche de l'annulation, si cette dernière enlève la dernière forme tracée, la suppression quant à elle enlève la forme sélectionnée :</p><pre id="r-428989" data-claire-element-id="428989"><code data-claire-semantic="javascript">// Suppression d'un objet
function del_object() {
	if(test_select()) {
		params.objets_effaces.push(params.objet_modif);
		calque_bottom.remove(params.objet_modif);
		calque_bottom.draw();
		reset_dessin();	
		calque_top.removeChildren();
		calque_top.draw();
	}	
}</code></pre><p id="r-428990" data-claire-element-id="428990">Le code se passe de commentaire parce qu'il reprend ce que nous avons déjà vu.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
<span class="arrow"></span>
<span class="next">Le dessin</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
<span class="next">Apparence et enregistrement</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Apparenceetenregistrement"></a><h2>Apparence et enregistrement</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
<span class="arrow"></span>
<span class="next">Sélection et édition</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">
<span class="next">Animations</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-apparence-et-enregistrement" data-claire-element-id="429025">Apparence et enregistrement</h4><h5 id="r-controle-de-l-apparence" data-claire-element-id="429002">Contrôle de l'apparence</h5><p id="r-428994" data-claire-element-id="428994">Nous allons voir à présent comment s'effectue le réglage de l'épaisseur des traits, leur couleur, ainsi que le traitement du remplissage. Lorsqu'on sélectionne une forme, il faut que les contrôles se mettent à jour :</p><pre id="r-428995" data-claire-element-id="428995"><code data-claire-semantic="javascript">// Si mode sélection
if(params.modes[params.id_mode] == 'selection') {
	if(!inhibe_selection) {

                   ...

		if(shapes.length &amp;&amp; shapes[0].getLayer() != calque_top &amp;&amp; shapes[0] != params.objet_modif) {

                           ...

			sync_controls();
			
                           ...
		}
	}
}</code></pre><p id="r-428996" data-claire-element-id="428996">Voyons cette fonction <strong>sync_controls</strong> :</p><pre id="r-428997" data-claire-element-id="428997"><code data-claire-semantic="javascript">// Synchronisation des contrôles avec la shape sélectionnée
function sync_controls() {
	// Largeur de ligne
	if(params.objet_modif.getStrokeWidth() != undefined) 
		$('#width').val(params.objet_modif.getStrokeWidth());
	// Couleur de ligne
	if(params.objet_modif.getStroke() != undefined) {
		$('#typeligne').val('Unie');
		$('#colorligne').val(params.objet_modif.getStroke());
		$('#couleurligne i').css('background-color', params.objet_modif.getStroke()); 
		$('#couleurligne').removeClass('hide');
		$('#widthline').removeClass('hide');
	}
	else {
		$('#typeligne').val('Sans');
		$('#couleurligne').addClass('hide');
		$('#widthline').addClass('hide');
	}
	// Couleur de remplissage
	if(params.objet_modif.getFill() != undefined) {
		$('#typefond').val('Uni');
		$('#couleurfond').removeClass('hide');
		$('#colorremplissage').val(params.objet_modif.getFill());
		$('#couleurfond i').css('background-color', params.objet_modif.getFill());
	}
	else {
		$('#couleurfond').addClass('hide');	
		$('#typefond').val('Sans');	
	}
}</code></pre><p id="r-428998" data-claire-element-id="428998">Une utilisation intensive de <strong>jQuery </strong>permet de renseigner les contrôles correspondants, de les cacher ou les afficher quand c'est nécessaire. On utilise des <strong>setter </strong>de <strong>kineticJS </strong>pour récupérer les informations : <strong>getStrokeWidth</strong>, <strong>getStroke</strong>, <strong>getFill</strong>.</p><p id="r-428999" data-claire-element-id="428999">Je ne vais pas rentrer dans le détail du processus inverse, c'est à dire du changement au niveau de la <strong>shape </strong>sélectionnée quand on modifie la valeur d'un contrôle. Voici par exemple le cas de l'épaisseur de la ligne :</p><pre id="r-429000" data-claire-element-id="429000"><code data-claire-semantic="javascript">// Largeur de ligne
$('#width').change(function() {
	params.line_width = $(this).val();
	if(test_select() &amp;&amp; params.objet_modif.getStrokeWidth() != 'undefined') {
		params.objet_modif.setStrokeWidth(params.line_width);
		calque_bottom.draw();
	}
});</code></pre><p id="r-429001" data-claire-element-id="429001">Le setter <strong>setStrokeWidth </strong>permet de mettre à jour la <strong>shape</strong>. C'est le même principe pour les autres contrôles.</p><h5 id="r-ordre-de-superposition-des-formes" data-claire-element-id="429010">Ordre de superposition des formes</h5><p id="r-429003" data-claire-element-id="429003">L'ordre de superposition des formes peut être changé par le menu :</p><figure id="r-429005" data-claire-element-id="429006"><img id="r-429004" data-claire-element-id="429004" src="medias/uploads.siteduzero.com_files_405001_406000_405033.png" alt="Image utilisateur"/></figure><p id="r-429007" data-claire-element-id="429007"><strong>KineticJS </strong>nous permet de faire cela très simplement :</p><pre id="r-429008" data-claire-element-id="429008"><code data-claire-semantic="javascript">$('#go_front').click(function() {
	if(test_select()) {
		params.objet_modif.moveToTop();
		calque_bottom.draw();
	}
});
$('#go_back').click(function() {
	if(test_select()) {
		params.objet_modif.moveToBottom();
		calque_bottom.draw();
	}
});
$('#go_up').click(function() {
	if(test_select()) {
		params.objet_modif.moveUp();
		calque_bottom.draw();
	}
});
$('#go_down').click(function() {
	if(test_select()){ 
		params.objet_modif.moveDown();
		calque_bottom.draw();
	}
});</code></pre><p id="r-429009" data-claire-element-id="429009">Les méthodes <strong>moveToTop</strong>, <strong>moveToBottom</strong>, <strong>moveUp </strong>et <strong>moveDown </strong>effectuent ces opérations.</p><h5 id="r-enregistrement-en-image-ou-en-json" data-claire-element-id="429024">Enregistrement en image ou en JSON</h5><p id="r-429011" data-claire-element-id="429011">Pour terminer, j'ai prévu l'enregistrement du dessin au format &quot;image&quot; ou <strong>JSON</strong>.</p><h6 id="r-image-1" data-claire-element-id="429015">Image</h6><p id="r-429012" data-claire-element-id="429012">L'enregistrement direct d'une image est évidemment impossible avec <strong>Javascript</strong> mais on peut par contre envoyer le dessin sur une page, il ne reste plus alors qu'à enregistrer l'image :</p><pre id="r-429013" data-claire-element-id="429013"><code data-claire-semantic="javascript">$('#enregistrer_image').click(function() {
	reset_dessin();	
	calque_top.removeChildren();
	calque_top.draw();	
	scène.toDataURL({
		callback: function(dataUrl) {
		  window.open(dataUrl);
		}
	});
});</code></pre><p id="r-429014" data-claire-element-id="429014">On commence par enlever ce qui pourrait se trouver sur la calque <strong>calque_top</strong>. On utilise ensuite la méthode <strong>toDataURL</strong> et dans le callback on ouvre une fenêtre avec l'image.</p><h6 id="r-json" data-claire-element-id="429023">JSON</h6><p id="r-429016" data-claire-element-id="429016">Pour le JSON j'ai utilisé une fenêtre modale :</p><figure id="r-429018" data-claire-element-id="429019"><img id="r-429017" data-claire-element-id="429017" src="medias/uploads.siteduzero.com_files_405001_406000_405034.png" alt="Image utilisateur"/></figure><p id="r-429020" data-claire-element-id="429020">Le code est aussi assez simple :</p><pre id="r-429021" data-claire-element-id="429021"><code data-claire-semantic="javascript">$('#enregistrer_json').click(function() {
	reset_dessin();	
	calque_top.removeChildren();
	calque_top.draw();	
	$('#text_json').text(scène.toJSON());
	$('#modal_save').modal();
});</code></pre><p id="r-429022" data-claire-element-id="429022">La méthode utilisée est <strong>toJSON</strong>.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
<span class="arrow"></span>
<span class="next">Sélection et édition</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">
<span class="next">Animations</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Animations"></a><h2>Animations</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
<span class="arrow"></span>
<span class="next">Apparence et enregistrement</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
<span class="next">Les transitions</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div class="content">
<p id="r-429027" data-claire-element-id="429027">Nous allons maintenant voir la partie la plus intéressante avec les possibilités d'interaction de <strong>KineticJS </strong>et ses capacités d’animation.</p>
</div><a name="Lestransitions"></a><h2>Les transitions</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">
<span class="arrow"></span>
<span class="next">Animations</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
<span class="next">Les sprites</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-transitions-1" data-claire-element-id="429247">Les transitions</h4><h5 id="r-une-transition-simple-pour-commencer" data-claire-element-id="429036">Une transition simple pour commencer</h5><p id="r-429028" data-claire-element-id="429028">Pour réaliser une transition sur une forme on utilise la méthode <strong>transitionTo</strong> qui attend un objet contenant les propriétés à changer avec leur valeur à atteindre. On ajoute la durée du phénomène et le tour est joué :) .</p><p id="r-429029" data-claire-element-id="429029">Voici un premier exemple où on part d'une étoile, on fait varier sa position, sa rotation, sa taille, le tout sur une durée de 6 secondes :</p><pre id="r-429030" data-claire-element-id="429030"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
		
	var étoile = new Kinetic.Star({
	  x: 100,
	  y: 100,
	  numPoints: 5,
	  innerRadius: 20,
	  outerRadius: 50,
	  fill: &quot;#a30&quot;,
	  stroke: &quot;orangered&quot;,
	  scale: 1,
	  strokeWidth: 4
	});
	
	calque.add(étoile);
	scène.add(calque);
	
	document.getElementById(&quot;animer&quot;).addEventListener(&quot;click&quot;, function() {
		étoile.transitionTo({
			x: 400,
			y: 200,
			rotation: Math.PI,
			scale: {x: 1.6, y: 1.6},
			duration: 6
		});
	}, false);

	document.getElementById(&quot;reset&quot;).addEventListener(&quot;click&quot;, function() {
		with(étoile) {
			setX(100);
			setY(100);
			setRotation(0);
			setScale({x: 1, y: 1});
		}
		calque.draw();
	}, false);
};</code></pre><p id="r-429031" data-claire-element-id="429031"><a href="http://tutozero.free.fr/kinetic/tutos04/transitions_01.html">Tester !</a></p><figure id="r-429033" data-claire-element-id="429034"><img id="r-429032" data-claire-element-id="429032" src="medias/uploads.siteduzero.com_files_405001_406000_405040.png" alt="Image utilisateur"/></figure><p id="r-429035" data-claire-element-id="429035">J'ai utilisé deux boutons, un pour l'animation et un autre pour retrouver l'état initial. La partie intéressante est celle qui est surlignée dans le code, avec l'utilisation de la méthode <strong>transitionTo</strong>. On se rend compte qu'on se contente de renseigner les propriétés et qu'on ajoute la durée de la transition. La transformation est linéaire, il existe une propriété pour obtenir un effet non linéaire, c'est ce que nous allons voir à présent. Comme nous abordons les animations, nous allons aussi commencer à utiliser plusieurs calques pour séparer les éléments fixes et les éléments mobiles et éviter ainsi de dessiner des choses inutiles lors des mouvements.</p><h5 id="r-les-effets-de-mouvement" data-claire-element-id="429204">Les effets de mouvement</h5><p id="r-429037" data-claire-element-id="429037">Il y a trois catégories d'effets :</p><ul id="r-429044" data-claire-element-id="429044"><li id="r-429039" data-claire-element-id="429039"><p id="r-429038" data-claire-element-id="429038">Amortissement</p></li><li id="r-429041" data-claire-element-id="429041"><p id="r-429040" data-claire-element-id="429040">Élastique</p></li><li id="r-429043" data-claire-element-id="429043"><p id="r-429042" data-claire-element-id="429042">Rebond</p></li></ul><p id="r-429045" data-claire-element-id="429045">Nous allons voir des exemples de ces effets.</p><h6 id="r-amortissement" data-claire-element-id="429141">Amortissement</h6><p id="r-429046" data-claire-element-id="429046">L'amortissement est une variation sinusoïdale des valeurs changées. On peut définir cet amortissement en début de mouvement, en fin, ou les deux. Il suffit de renseigner correctement la propriété <strong>easing </strong>:</p><table id="r-429069" data-claire-element-id="429069"><thead id="r-429052" data-claire-element-id="429052"><tr id="r-429051" data-claire-element-id="429051"><th id="r-429048" data-claire-element-id="429048"><p id="r-429047" data-claire-element-id="429047">Valeur</p></th><th id="r-429050" data-claire-element-id="429050"><p id="r-429049" data-claire-element-id="429049">effet</p></th></tr></thead><tbody id="r-429068" data-claire-element-id="429068"><tr id="r-429057" data-claire-element-id="429057"><td id="r-429054" data-claire-element-id="429054"><p id="r-429053" data-claire-element-id="429053"><strong>ease-in</strong></p></td><td id="r-429056" data-claire-element-id="429056"><p id="r-429055" data-claire-element-id="429055">Amortissement en début de transition</p></td></tr><tr id="r-429062" data-claire-element-id="429062"><td id="r-429059" data-claire-element-id="429059"><p id="r-429058" data-claire-element-id="429058"><strong>ease-out</strong></p></td><td id="r-429061" data-claire-element-id="429061"><p id="r-429060" data-claire-element-id="429060">Amortissement en fin de transition</p></td></tr><tr id="r-429067" data-claire-element-id="429067"><td id="r-429064" data-claire-element-id="429064"><p id="r-429063" data-claire-element-id="429063"><strong>ease-in-out</strong></p></td><td id="r-429066" data-claire-element-id="429066"><p id="r-429065" data-claire-element-id="429065">Amortissement en début et fin de transition</p></td></tr></tbody></table><p id="r-429070" data-claire-element-id="429070">Voici un exemple illustratif :</p><pre id="r-429071" data-claire-element-id="429071"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var trame = new Kinetic.Layer();
	var balles = new Kinetic.Layer();
	var texte = [&quot;ease-in&quot;,&quot;ease-out&quot;,&quot;ease-in-out&quot;];

	// Trame de fond
	var rectangle = new Kinetic.Rect({
		width: 500,
		height: 300,
		fill: &quot;#eee&quot;,
	});
	trame.add(rectangle)
	for(var i = 100; i &lt; 300; i += 100) {
		trame.add(
			new Kinetic.Line({
				points: [0, i, 500, i],
				strokeWidth: 3
			})
		);
	}
	for(var i = 0; i &lt; 3; ++i) {
		trame.add(
			new Kinetic.Text({
			  y: 78 + i * 100,
			  text: texte[i],
			  fontSize: 12,
			  fontFamily: &quot;Verdana&quot;,
			  textFill: &quot;#3aa&quot;,
			  width: 180,
			  strokeWidth: 3,
			  padding: 4
			})	
		);		
	}
	scène.add(trame);
	
	// Balles
	for(var i = 0; i &lt; 3; ++i) {
		balles.add(
			new Kinetic.Ellipse({
			  x: 100,
			  y: i * 100 + 40,
			  radius: 20,
			  fill: &quot;#c66&quot;,
			  name: &quot;balle&quot;
			})
		);
	}

	scène.add(balles);
	
	document.getElementById(&quot;animer&quot;).addEventListener(&quot;click&quot;, function() {
		for(var i = 0; i &lt; 3; ++i) {
                    var balle = scène.get(&quot;.balle&quot;)[i];
                    balle.transitionTo({
                       x: 400,
                       duration: 2,
	               easing: texte[i]
                    });
	        }
	}, false);

	document.getElementById(&quot;reset&quot;).addEventListener(&quot;click&quot;, function() {
		for(var i = 0; i &lt; 3; ++i) {
                    var balle = scène.get(&quot;.balle&quot;)[i];
                    balle.setX(100);
		    balles.draw();
		}
	}, false);
};</code></pre><p id="r-429072" data-claire-element-id="429072"><a href="http://tutozero.free.fr/kinetic/tutos04/transitions_02.html">Tester !</a></p><figure id="r-429074" data-claire-element-id="429075"><img id="r-429073" data-claire-element-id="429073" src="medias/uploads.siteduzero.com_files_405001_406000_405041.png" alt="Image utilisateur"/></figure><p id="r-429076" data-claire-element-id="429076">Il y a d'autres éléments intéressants dans ce code comme par exemple le référencement des 3 balles. Lors de leur création, on leur donne le même nom :</p><pre id="r-429077" data-claire-element-id="429077"><code data-claire-semantic="javascript">name: &quot;balle&quot;</code></pre><p id="r-429078" data-claire-element-id="429078">On peut ensuite obtenir un référence de chaque balle en utilisant la méthode <strong>get </strong>appliquée à la scène en passant en paramètre le nom (remarquez la syntaxe qui impose de faire précéder avec un point) :</p><pre id="r-429079" data-claire-element-id="429079"><code data-claire-semantic="javascript">var balle = scène.get(&quot;.balle&quot;)[i];</code></pre><p id="r-429080" data-claire-element-id="429080">La valeur de retour est un tableau indicé, il est ainsi facile de référencer les balles.</p><p id="r-429081" data-claire-element-id="429081">Le librairie prévoit une variation de l'amortissement avec un effet plus tonique :</p><table id="r-429104" data-claire-element-id="429104"><thead id="r-429087" data-claire-element-id="429087"><tr id="r-429086" data-claire-element-id="429086"><th id="r-429083" data-claire-element-id="429083"><p id="r-429082" data-claire-element-id="429082">Valeur</p></th><th id="r-429085" data-claire-element-id="429085"><p id="r-429084" data-claire-element-id="429084">effet</p></th></tr></thead><tbody id="r-429103" data-claire-element-id="429103"><tr id="r-429092" data-claire-element-id="429092"><td id="r-429089" data-claire-element-id="429089"><p id="r-429088" data-claire-element-id="429088"><strong>strong-ease-in</strong></p></td><td id="r-429091" data-claire-element-id="429091"><p id="r-429090" data-claire-element-id="429090">Amortissement tonique en début de transition</p></td></tr><tr id="r-429097" data-claire-element-id="429097"><td id="r-429094" data-claire-element-id="429094"><p id="r-429093" data-claire-element-id="429093"><strong>strong-ease-out</strong></p></td><td id="r-429096" data-claire-element-id="429096"><p id="r-429095" data-claire-element-id="429095">Amortissement tonique en fin de transition</p></td></tr><tr id="r-429102" data-claire-element-id="429102"><td id="r-429099" data-claire-element-id="429099"><p id="r-429098" data-claire-element-id="429098"><strong>strong-ease-in-out</strong></p></td><td id="r-429101" data-claire-element-id="429101"><p id="r-429100" data-claire-element-id="429100">Amortissement tonique en début et fin de transition</p></td></tr></tbody></table><p id="r-429105" data-claire-element-id="429105">Voici le même code que précédemment, mais en utilisant les nouvelles valeurs, on se contente de modifier cette ligne :</p><pre id="r-429106" data-claire-element-id="429106"><code data-claire-semantic="javascript">var texte = [&quot;strong-ease-in&quot;,&quot;strong-ease-out&quot;,&quot;strong-ease-in-out&quot;];</code></pre><p id="r-429107" data-claire-element-id="429107"><a href="http://tutozero.free.fr/kinetic/tutos04/transitions_03.html">Tester !</a></p><figure id="r-429109" data-claire-element-id="429110"><img id="r-429108" data-claire-element-id="429108" src="medias/uploads.siteduzero.com_files_405001_406000_405042.png" alt="Image utilisateur"/></figure><p id="r-429111" data-claire-element-id="429111">Une troisième possibilité d'amortissement consiste à obtenir un effet de recul avec ces valeurs :</p><table id="r-429134" data-claire-element-id="429134"><thead id="r-429117" data-claire-element-id="429117"><tr id="r-429116" data-claire-element-id="429116"><th id="r-429113" data-claire-element-id="429113"><p id="r-429112" data-claire-element-id="429112">Valeur</p></th><th id="r-429115" data-claire-element-id="429115"><p id="r-429114" data-claire-element-id="429114">effet</p></th></tr></thead><tbody id="r-429133" data-claire-element-id="429133"><tr id="r-429122" data-claire-element-id="429122"><td id="r-429119" data-claire-element-id="429119"><p id="r-429118" data-claire-element-id="429118"><strong>back-ease-in</strong></p></td><td id="r-429121" data-claire-element-id="429121"><p id="r-429120" data-claire-element-id="429120">Amortissement avec recul en début de transition</p></td></tr><tr id="r-429127" data-claire-element-id="429127"><td id="r-429124" data-claire-element-id="429124"><p id="r-429123" data-claire-element-id="429123"><strong>back-ease-out</strong></p></td><td id="r-429126" data-claire-element-id="429126"><p id="r-429125" data-claire-element-id="429125">Amortissement avec dépassement en fin de transition</p></td></tr><tr id="r-429132" data-claire-element-id="429132"><td id="r-429129" data-claire-element-id="429129"><p id="r-429128" data-claire-element-id="429128"><strong>back-ease-in-out</strong></p></td><td id="r-429131" data-claire-element-id="429131"><p id="r-429130" data-claire-element-id="429130">Amortissement avec recul en début et dépassement en fin de transition</p></td></tr></tbody></table><p id="r-429135" data-claire-element-id="429135">Reprenons le même code avec les nouvelles valeurs, on se contente de modifier cette ligne :</p><pre id="r-429136" data-claire-element-id="429136"><code data-claire-semantic="javascript">var texte = [&quot;back-ease-in&quot;,&quot;back-ease-out&quot;,&quot;back-ease-in-out&quot;];</code></pre><p id="r-429137" data-claire-element-id="429137"><a href="http://tutozero.free.fr/kinetic/tutos04/transitions_04.html">Tester !</a></p><figure id="r-429139" data-claire-element-id="429140"><img id="r-429138" data-claire-element-id="429138" src="medias/uploads.siteduzero.com_files_405001_406000_405043.png" alt="Image utilisateur"/></figure><h6 id="r-elastique" data-claire-element-id="429172">Elastique</h6><p id="r-429142" data-claire-element-id="429142">Le deuxième effet disponible est un effet élastique. Il se produit une oscillation autour du point de départ, d'arrivée ou les deux :</p><table id="r-429165" data-claire-element-id="429165"><thead id="r-429148" data-claire-element-id="429148"><tr id="r-429147" data-claire-element-id="429147"><th id="r-429144" data-claire-element-id="429144"><p id="r-429143" data-claire-element-id="429143">Valeur</p></th><th id="r-429146" data-claire-element-id="429146"><p id="r-429145" data-claire-element-id="429145">effet</p></th></tr></thead><tbody id="r-429164" data-claire-element-id="429164"><tr id="r-429153" data-claire-element-id="429153"><td id="r-429150" data-claire-element-id="429150"><p id="r-429149" data-claire-element-id="429149"><strong>elastic-ease-out</strong></p></td><td id="r-429152" data-claire-element-id="429152"><p id="r-429151" data-claire-element-id="429151">Oscillation en début de transition</p></td></tr><tr id="r-429158" data-claire-element-id="429158"><td id="r-429155" data-claire-element-id="429155"><p id="r-429154" data-claire-element-id="429154"><strong>elastic-ease-out</strong></p></td><td id="r-429157" data-claire-element-id="429157"><p id="r-429156" data-claire-element-id="429156">Oscillation en fin de transition</p></td></tr><tr id="r-429163" data-claire-element-id="429163"><td id="r-429160" data-claire-element-id="429160"><p id="r-429159" data-claire-element-id="429159"><strong>elastic-ease-in-out</strong></p></td><td id="r-429162" data-claire-element-id="429162"><p id="r-429161" data-claire-element-id="429161">Oscillation en début et fin de transition</p></td></tr></tbody></table><p id="r-429166" data-claire-element-id="429166">Reprenons notre code d'exemple pour tester cet effet :</p><pre id="r-429167" data-claire-element-id="429167"><code data-claire-semantic="javascript">var texte = [&quot;elastic-ease-in&quot;,&quot;elastic-ease-out&quot;,&quot;elastic-ease-in-out&quot;];</code></pre><p id="r-429168" data-claire-element-id="429168"><a href="http://tutozero.free.fr/kinetic/tutos04/transitions_05.html">Tester !</a></p><figure id="r-429170" data-claire-element-id="429171"><img id="r-429169" data-claire-element-id="429169" src="medias/uploads.siteduzero.com_files_405001_406000_405044.png" alt="Image utilisateur"/></figure><h6 id="r-rebond" data-claire-element-id="429203">Rebond</h6><p id="r-429173" data-claire-element-id="429173">Le dernier effet disponible est un effet de rebond qui se produit sur le point de départ, d'arrivée ou les deux :</p><table id="r-429196" data-claire-element-id="429196"><thead id="r-429179" data-claire-element-id="429179"><tr id="r-429178" data-claire-element-id="429178"><th id="r-429175" data-claire-element-id="429175"><p id="r-429174" data-claire-element-id="429174">Valeur</p></th><th id="r-429177" data-claire-element-id="429177"><p id="r-429176" data-claire-element-id="429176">effet</p></th></tr></thead><tbody id="r-429195" data-claire-element-id="429195"><tr id="r-429184" data-claire-element-id="429184"><td id="r-429181" data-claire-element-id="429181"><p id="r-429180" data-claire-element-id="429180"><strong>bounce-ease-in</strong></p></td><td id="r-429183" data-claire-element-id="429183"><p id="r-429182" data-claire-element-id="429182">Rebond en début de transition</p></td></tr><tr id="r-429189" data-claire-element-id="429189"><td id="r-429186" data-claire-element-id="429186"><p id="r-429185" data-claire-element-id="429185"><strong>bounce-ease-out</strong></p></td><td id="r-429188" data-claire-element-id="429188"><p id="r-429187" data-claire-element-id="429187">Rebond en fin de transition</p></td></tr><tr id="r-429194" data-claire-element-id="429194"><td id="r-429191" data-claire-element-id="429191"><p id="r-429190" data-claire-element-id="429190"><strong>bounce-ease-in-out</strong></p></td><td id="r-429193" data-claire-element-id="429193"><p id="r-429192" data-claire-element-id="429192">Rebond en début et fin de transition</p></td></tr></tbody></table><p id="r-429197" data-claire-element-id="429197">Reprenons notre code d'exemple pour tester cet effet :</p><pre id="r-429198" data-claire-element-id="429198"><code data-claire-semantic="javascript">var texte = [&quot;bounce-ease-in&quot;,&quot;bounce-ease-out&quot;,&quot;bounce-ease-in-out&quot;];</code></pre><p id="r-429199" data-claire-element-id="429199"><a href="http://tutozero.free.fr/kinetic/tutos04/transitions_06.html">Tester !</a></p><figure id="r-429201" data-claire-element-id="429202"><img id="r-429200" data-claire-element-id="429200" src="medias/uploads.siteduzero.com_files_405001_406000_405045.png" alt="Image utilisateur"/></figure><h5 id="r-fonction-de-rappel" data-claire-element-id="429212">Fonction de rappel</h5><p id="r-429205" data-claire-element-id="429205">Il est possible de prévoir une fonction de rappel (callback) en fin de transition, ce qui est bien pratique par exemple pour poursuivre un mouvement. Pour illustrer cette possibilité, je vous propose la réalisation d'un simple pendule. Je vais en profiter pour rappeler la possibilité de grouper deux formes. Ici ça sera le fil constitué avec une ligne et la boule créée avec une ellipse. Rien de bien nouveau si ce n'est une autre manière de mettre les éléments en action :</p><pre id="r-429206" data-claire-element-id="429206"><code data-claire-semantic="javascript">window.onload = function() {
	var sens = -1;
	
	// Transition avec fonction de rappel
	function transition() {
		sens *= -1;
		pendule.transitionTo({
			rotation: sens * Math.PI / 4, 
			duration: 2,
			easing: &quot;ease-in-out&quot;,
			callback: function() {transition();}
		});		
	}
	
	// Scène
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	// Construction du pendule avec un groupe
	var pendule = new Kinetic.Group( {
		x: 250,
		y: 50
	});
	var boule = new Kinetic.Ellipse({
		x: 0,
		y: 180,
		radius: 20,
		fill: &quot;blue&quot;
	});
	var fil = new Kinetic.Line({
		points: [0, 0, 0, 180],
		stroke: &quot;black&quot;
	});
	
	pendule.add(fil);
	pendule.add(boule);
	calque.add(pendule);
	scène.add(calque);
	
	transition();
};</code></pre><p id="r-429207" data-claire-element-id="429207"><a href="http://tutozero.free.fr/kinetic/tutos04/transitions_07.html">Tester !</a></p><figure id="r-429209" data-claire-element-id="429210"><img id="r-429208" data-claire-element-id="429208" src="medias/uploads.siteduzero.com_files_405001_406000_405046.png" alt="Image utilisateur"/></figure><p id="r-429211" data-claire-element-id="429211">Quelle facilité pour créer un mouvement pendulaire ! :p</p><h5 id="r-stopper-et-reprendre-une-animation" data-claire-element-id="429220">Stopper et reprendre une animation</h5><p id="r-429213" data-claire-element-id="429213">Une autre possibilité intéressante pour l'interactivité est qu'une transition peut être <strong>stopp</strong>ée et reprise facilement en utilisant les méthodes stop et <strong>resume</strong>. On va donc appliquer cette possibilité à notre pendule en prévoyant deux boutons pour agir sur son mouvement :</p><pre id="r-429214" data-claire-element-id="429214"><code data-claire-semantic="javascript">window.onload = function() {
	var sens = -1;
	var trans;
	
	// Transition avec fonction de rappel
	function transition() {
		sens *= -1;
		trans = pendule.transitionTo({
			rotation: sens * Math.PI / 4, 
			duration: 2,
			easing: &quot;ease-in-out&quot;,
			callback: function() {transition();}
		});		
	}
	
	// Scène
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	// Construction du pendule avec un groupe
	var pendule = new Kinetic.Group( {
		x: 250,
		y: 50
	});
	var boule = new Kinetic.Ellipse({
		x: 0,
		y: 180,
		radius: 20,
		fill: &quot;blue&quot;
	});
	var fil = new Kinetic.Line({
		points: [0, 0, 0, 180],
		stroke: &quot;black&quot;
	});
	
	pendule.add(fil);
	pendule.add(boule);
	calque.add(pendule);
	scène.add(calque);
	
	transition();
	
	document.getElementById(&quot;animer&quot;).addEventListener(&quot;click&quot;, function() {
		trans.resume();
	}, false);
 
	document.getElementById(&quot;stopper&quot;).addEventListener(&quot;click&quot;, function() {
		trans.stop();
	}, false);
};</code></pre><p id="r-429215" data-claire-element-id="429215"><a href="http://tutozero.free.fr/kinetic/tutos04/transitions_08.html">Tester !</a></p><figure id="r-429217" data-claire-element-id="429218"><img id="r-429216" data-claire-element-id="429216" src="medias/uploads.siteduzero.com_files_405001_406000_405047.png" alt="Image utilisateur"/></figure><p id="r-429219" data-claire-element-id="429219">J'ai surligné le code modifié. Pour utiliser les méthodes <strong>stop </strong>et <strong>resume </strong>on a besoin d'avoir une référence de la <strong>transi</strong>tion, d'où la création de la variable trans pour pointer sur celle-ci.</p><h5 id="r-tp-2" data-claire-element-id="429246">TP</h5><p id="r-429221" data-claire-element-id="429221">Pour récapituler ce que nous avons vu dans ce chapitre, je vous propose de réaliser une animation d'icônes. Plutôt qu'un grand discours, allez voir directement le résultat :</p><p id="r-429222" data-claire-element-id="429222"><a href="http://tutozero.free.fr/kinetic/tutos04/tp_01.html">Tester !</a></p><figure id="r-429224" data-claire-element-id="429225"><img id="r-429223" data-claire-element-id="429223" src="medias/uploads.siteduzero.com_files_405001_406000_405048.png" alt="Image utilisateur"/></figure><p id="r-429226" data-claire-element-id="429226">Comme vous le constatez, on affiche 5 icônes et quand le curseur de la souris passe sur l'une d'elles déjà il change d'aspect et en plus l'icône augmente de taille avec un effet esthétique au niveau du mouvement. Une bonne occasion de revoir comment on charge des images par la même occasion.</p><p id="r-429227" data-claire-element-id="429227"></p><div id="r-429229" data-claire-element-id="429229"><pre id="r-429228" data-claire-element-id="429228"><code data-claire-semantic="javascript">// Chargement des images
function load_images(sources, callback) {
	var images = new Array();
	var loadedImages = 0;
	sources.forEach(function(value, index) {
		images[index] = new Image();
		images[index].onload = function() {
			if(++loadedImages &gt;= sources.length) callback(images);
		};
		images[index].src = value;
	});
}	
// Initialisation de la scène
function init_scène(images) {
	var scène = new Kinetic.Stage({
		container: &quot;kinetic&quot;,
		width: 500,
		height: 300
	});
	var fond = new Kinetic.Layer();
	var calque = new Kinetic.Layer();
	var rectangle = new Kinetic.Rect({
		width: 500,
		height: 300,
		fill: &quot;#bbb&quot;,
	});
	fond.add(rectangle)
	images.forEach(function(value, index) {
		var image = new Kinetic.Image({
			x: 82 + index * 80,
			y: 252,
			offset: [32, 32],
			image: value,
			width: 64,
			height: 64
		});
		image.on(&quot;mouseover&quot;,function() {
			document.body.style.cursor = &quot;pointer&quot;;
			this.transitionTo({
				scale: {x: 1.6, y: 1.6},
				duration: .4,
				easing: &quot;ease-in-out&quot;
			});
		}); 
		image.on(&quot;mouseout&quot;,function() {
			document.body.style.cursor = &quot;default&quot;;
			this.transitionTo({
				scale: {x: 1, y: 1},
				duration: .4,
				easing: &quot;ease-in-out&quot;
			});
		});
		calque.add(image);
	});
	scène.add(fond);
	scène.add(calque);
}
// Chargement de la page
window.onload = function() {
	var sources_icônes =  [
		&quot;images/icone01.png&quot;,
		&quot;images/icone02.png&quot;,
		&quot;images/icone03.png&quot;,
		&quot;images/icone04.png&quot;,
		&quot;images/icone05.png&quot;
	];
	load_images(sources_icônes, init_scène);
}</code></pre></div><p id="r-429230" data-claire-element-id="429230">Je vous propose d'aller un peu plus loin dans cet exemple. Maintenant on va prendre 10 icônes. Donc trop pour pouvoir les afficher en même temps. On va donc créer une barre d'icônes &quot;draggables&quot;. Une petite astuce pour vous éviter un codage furieux : on peut rendre tout un calque &quot;draggable&quot; ;)</p><p id="r-429231" data-claire-element-id="429231"><a href="http://tutozero.free.fr/kinetic/tutos04/tp_01a.html">Tester !</a></p><figure id="r-429233" data-claire-element-id="429234"><img id="r-429232" data-claire-element-id="429232" src="medias/uploads.siteduzero.com_files_405001_406000_405050.png" alt="Image utilisateur"/></figure><p id="r-429235" data-claire-element-id="429235"></p><div id="r-429237" data-claire-element-id="429237"><pre id="r-429236" data-claire-element-id="429236"><code data-claire-semantic="javascript">// Chargement des images
function load_images(sources, callback) {
	var images = new Array();
	var loadedImages = 0;
	sources.forEach(function(value, index) {
		images[index] = new Image();
		images[index].onload = function() {
			if(++loadedImages &gt;= sources.length) callback(images);
		};
		images[index].src = value;
	});
}	
// Initialisation de la scène
function init_scène(images) {
	var scène = new Kinetic.Stage({
		container: &quot;kinetic&quot;,
		width: 500,
		height: 300
	});
	var fond = new Kinetic.Layer();
	var calque = new Kinetic.Layer({
			draggable: true,
			dragConstraint: &quot;horizontal&quot;,
			dragBounds: {
				left: -320,
				right : 0
			},
			offset:[-250, 0]
		}
	);
	var rectangle = new Kinetic.Rect({
		width: 500,
		height: 300,
		fill: &quot;#bbb&quot;,
	});
	fond.add(rectangle)
	images.forEach(function(value, index) {
		var image = new Kinetic.Image({
			x: -200 + index * 80,
			y: 252,
			offset: [32, 32],
			image: value,
			width: 64,
			height: 64
		});
		image.on(&quot;mouseover&quot;,function() {
			document.body.style.cursor = &quot;pointer&quot;;
			this.transitionTo({
				scale: {x: 1.6, y: 1.6},
				duration: .4,
				easing: &quot;ease-in-out&quot;
			});
		}); 
		image.on(&quot;mouseout&quot;,function() {
			document.body.style.cursor = &quot;default&quot;;
			this.transitionTo({
				scale: {x: 1, y: 1},
				duration: .4,
				easing: &quot;ease-in-out&quot;
			});
		});
		calque.add(image);
	});	
	scène.add(fond);
	scène.add(calque);

}
// Chargement de la page
window.onload = function() {
	var sources_icônes =  [
		&quot;images/icone01.png&quot;,
		&quot;images/icone02.png&quot;,
		&quot;images/icone03.png&quot;,
		&quot;images/icone04.png&quot;,
		&quot;images/icone05.png&quot;,
		&quot;images/icone06.png&quot;,
		&quot;images/icone07.png&quot;,
		&quot;images/icone08.png&quot;,
		&quot;images/icone09.png&quot;,
		&quot;images/icone10.png&quot;
	];
	load_images(sources_icônes, init_scène);
}</code></pre></div><p id="r-429238" data-claire-element-id="429238">Comme je vous sens en forme, on va aller encore plus loin. On va ajouter une zone de texte, un double clic sur une icône doit afficher son index dans la zone de texte :</p><p id="r-429239" data-claire-element-id="429239"><a href="http://tutozero.free.fr/kinetic/tutos04/tp_01b.html">Tester !</a></p><figure id="r-429241" data-claire-element-id="429242"><img id="r-429240" data-claire-element-id="429240" src="medias/uploads.siteduzero.com_files_405001_406000_405049.png" alt="Image utilisateur"/></figure><p id="r-429243" data-claire-element-id="429243"></p><div id="r-429245" data-claire-element-id="429245"><pre id="r-429244" data-claire-element-id="429244"><code data-claire-semantic="javascript">// Chargement des images
function load_images(sources, callback) {
	var images = new Array();
	var loadedImages = 0;
	sources.forEach(function(value, index) {
		images[index] = new Image();
		images[index].onload = function() {
			if(++loadedImages &gt;= sources.length) callback(images);
		};
		images[index].src = value;
	});
}		
// Initialisation de la scène
function init_scène(images) {
	var scène = new Kinetic.Stage({
		container: &quot;kinetic&quot;,
		width: 500,
		height: 300
	});
	var fond = new Kinetic.Layer();
	var calque = new Kinetic.Layer({
			draggable: true,
			dragConstraint: &quot;horizontal&quot;,
			dragBounds: {
				left: -320,
				right : 0
			},
			offset:[-250, 0]
		}
	);
	var rectangle = new Kinetic.Rect({
		width: 500,
		height: 300,
		fill: &quot;#bbb&quot;,
	});
	var text = new Kinetic.Text({
		x: 50,
		y: 50,
		text: &quot;Choisissez une option avec un double clic. Faites défiler transversalement les boutons...&quot;,
		fontSize: 16,
		fontFamily: &quot;Verdana&quot;,
		textFill: &quot;magenta&quot;,
		width: 400,
		align: &quot;center&quot;,
		stroke: &quot;blueviolet&quot;,
		strokeWidth: 3,
		padding: 10,
		cornerRadius: 20,
		fill: &quot;lightgrey&quot;,
		lineHeight: 1.6
	});
	fond.add(rectangle)
	fond.add(text)
	images.forEach(function(value, index) {
		var image = new Kinetic.Image({
			x: -200 + index * 80,
			y: 252,
			offset: [32, 32],
			image: value,
			width: 64,
			height: 64,
			id: index
		});
		image.on(&quot;mouseover&quot;,function() {
			document.body.style.cursor = &quot;pointer&quot;;
			this.transitionTo({
				scale: {x: 1.6, y: 1.6},
				duration: .4,
				easing: &quot;ease-in-out&quot;
			});
		}); 
		image.on(&quot;mouseout&quot;,function() {
			document.body.style.cursor = &quot;default&quot;;
			this.transitionTo({
				scale: {x: 1, y: 1},
				duration: .4,
				easing: &quot;ease-in-out&quot;
			});
		});
		image.on(&quot;dblclick&quot;,function() {
			text.setText(&quot;Vous avez sélectionné le bouton avec le numéro d'index &quot; + this.getId());
			fond.draw();
		});
		calque.add(image);
	});	
	scène.add(fond);
	scène.add(calque);

}
// Chargement de la page
window.onload = function() {
	var sources_icônes =  [
		&quot;images/icone01.png&quot;,
		&quot;images/icone02.png&quot;,
		&quot;images/icone03.png&quot;,
		&quot;images/icone04.png&quot;,
		&quot;images/icone05.png&quot;,
		&quot;images/icone06.png&quot;,
		&quot;images/icone07.png&quot;,
		&quot;images/icone08.png&quot;,
		&quot;images/icone09.png&quot;,
		&quot;images/icone10.png&quot;
	];
	load_images(sources_icônes, init_scène);
}</code></pre></div>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">
<span class="arrow"></span>
<span class="next">Animations</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
<span class="next">Les sprites</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lessprites"></a><h2>Les sprites</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
<span class="arrow"></span>
<span class="next">Les transitions</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
<span class="next">Les animations</span>
<span class="arrow"></span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-sprites-2" data-claire-element-id="429328">Les sprites</h4><p id="r-429248" data-claire-element-id="429248">Les sprites sont des images d'une animation regroupées sur une seule image.</p><h5 id="r-le-principe-des-sprites" data-claire-element-id="429257">Le principe des sprites</h5><p id="r-429249" data-claire-element-id="429249">Voici le sprite qui va nous servir pour les exemples (recueilli sur <a href="http://addyosmani.com/blog/jquery-sprite-animation/">ce blog</a>) :</p><figure id="r-429251" data-claire-element-id="429252"><img id="r-429250" data-claire-element-id="429250" src="medias/uploads.siteduzero.com_files_409001_410000_409637.png" alt="Image utilisateur"/></figure><p id="r-429253" data-claire-element-id="429253">Il est composé de 6 images, chacune étant une étape de l'animation. La lecture normale des images se fait en partant de la première en haut à gauche et en se déplaçant ensuite vers la droite et ainsi de suite :</p><figure id="r-429255" data-claire-element-id="429256"><img id="r-429254" data-claire-element-id="429254" src="medias/uploads.siteduzero.com_files_409001_410000_409638.png" alt="Image utilisateur"/></figure><h5 id="r-animation-d-un-sprite" data-claire-element-id="429298">Animation d'un sprite</h5><p id="r-429258" data-claire-element-id="429258">C'est la classe <strong>Sprite </strong>qui nous permet d’animer des sprites. Son constructeur attend un positionnement, une image, des animations et éventuellement une vitesse. Voici le code pour mettre en mouvement la petite taupe :</p><pre id="r-429259" data-claire-element-id="429259"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	
	var animations = {
	  sortie: [{
		x: 10,
		y: 8,
		width: 158,
		height: 130
	  }, {
		x: 175,
		y: 8,
		width: 158,
		height: 130
	  }, {
		x: 340,
		y: 8,
		width: 158,
		height: 130
	  }, {
		x: 340,
		y: 145,
		width: 158,
		height: 130
	  }, {
		x: 175,
		y: 145,
		width: 158,
		height: 130
	  }, {
		x: 10,
		y: 145,
		width: 158,
		height: 130
	  }]
	};
	
	var imageObj = new Image();
	imageObj.onload = function() {
	  var animal = new Kinetic.Sprite({
		x: 50,
		y: 50,
		image: imageObj,
		animation: &quot;sortie&quot;,
		animations: animations,
		frameRate: 4
	  });
	
	  calque.add(animal);
	  scène.add(calque);
	  animal.start();
	  
	};
	imageObj.src = &quot;images/gopher.jpg&quot;;
};</code></pre><p id="r-429260" data-claire-element-id="429260"><a href="http://tutozero.free.fr/kinetic/tutos04/sprite_01.html">Tester !</a></p><figure id="r-429262" data-claire-element-id="429263"><img id="r-429261" data-claire-element-id="429261" src="medias/uploads.siteduzero.com_files_409001_410000_409639.png" alt="Image utilisateur"/></figure><p id="r-429264" data-claire-element-id="429264">Regardons la partie animation. On crée un objet <strong>animations </strong>qui contient une seule propriété (sortie) qui est en fait le nom d'une animation. Celle-ci est composée d'un tableau d'objets dont chacun est constitué de 4 propriétés :</p><table id="r-429292" data-claire-element-id="429292"><thead id="r-429270" data-claire-element-id="429270"><tr id="r-429269" data-claire-element-id="429269"><th id="r-429266" data-claire-element-id="429266"><p id="r-429265" data-claire-element-id="429265">Propriété</p></th><th id="r-429268" data-claire-element-id="429268"><p id="r-429267" data-claire-element-id="429267">Fonction</p></th></tr></thead><tbody id="r-429291" data-claire-element-id="429291"><tr id="r-429275" data-claire-element-id="429275"><td id="r-429272" data-claire-element-id="429272"><p id="r-429271" data-claire-element-id="429271"><strong>x</strong></p></td><td id="r-429274" data-claire-element-id="429274"><p id="r-429273" data-claire-element-id="429273">Position sur l'axe X du point de référence (coin haut gauche)</p></td></tr><tr id="r-429280" data-claire-element-id="429280"><td id="r-429277" data-claire-element-id="429277"><p id="r-429276" data-claire-element-id="429276"><strong>y</strong></p></td><td id="r-429279" data-claire-element-id="429279"><p id="r-429278" data-claire-element-id="429278">Position sur l'axe Y du point de référence (coin haut gauche)</p></td></tr><tr id="r-429285" data-claire-element-id="429285"><td id="r-429282" data-claire-element-id="429282"><p id="r-429281" data-claire-element-id="429281"><strong>width</strong></p></td><td id="r-429284" data-claire-element-id="429284"><p id="r-429283" data-claire-element-id="429283">Largeur en pixels de l'image élémentaire</p></td></tr><tr id="r-429290" data-claire-element-id="429290"><td id="r-429287" data-claire-element-id="429287"><p id="r-429286" data-claire-element-id="429286"><strong>height</strong></p></td><td id="r-429289" data-claire-element-id="429289"><p id="r-429288" data-claire-element-id="429288">Hauteur en pixels de l'image élémentaire</p></td></tr></tbody></table><p id="r-429293" data-claire-element-id="429293">Vous avez compris qu'il faut donc connaître l'organisation de l'image. En particulier il faut absolument que les images élémentaires soient uniformément réparties pour éviter des prises de tête sur la détermination des valeurs. En voici quelques-unes reportées sur le sprite :</p><figure id="r-429295" data-claire-element-id="429296"><img id="r-429294" data-claire-element-id="429294" src="medias/uploads.siteduzero.com_files_409001_410000_409640.png" alt="Image utilisateur"/></figure><p id="r-429297" data-claire-element-id="429297">C'est une méthode efficace, mais un peu laborieuse. On se rend compte de la répétition des largeurs et hauteurs et aussi de la répartition harmonieuse. On peut donc améliorer notre script en évitant toutes ces répétitions aussi pénibles qu'inesthétiques.</p><h5 id="r-ou-on-ameliore-notre-script" data-claire-element-id="429306">Où on améliore notre script</h5><p id="r-429299" data-claire-element-id="429299">L'amélioration consiste essentiellement à optimiser la création du tableau des animations :</p><pre id="r-429300" data-claire-element-id="429300"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();	

	// Génération des frames
	function frames(base_x, base_y, offset_x, offset_y, nbr_x, nbr_y, width, height) {
		var frames_tab = new Array();
		for(var i = 0; i &lt; nbr_x * nbr_y; ++i) {
			frames_tab.push({
				x: base_x + offset_x * ((i + nbr_x) % nbr_x),
				y: base_y + offset_y * parseInt(i / nbr_x),
				width: width,
				height: height
			});
		}
		return frames_tab;
	}
	
	// Animations
	var animations = {
	  sortie: frames(10, 8, 165, 137, 3, 2, 158, 130)
	};
	
	// Image
	var imageObj = new Image();
	imageObj.onload = function() {
	  var animal = new Kinetic.Sprite({
		x: 50,
		y: 50,
		image: imageObj,
		animation: &quot;sortie&quot;,
		animations: animations,
		frameRate: 4
	  });
	
	  calque.add(animal);
	  scène.add(calque);
	  animal.start();
	  
	};
	imageObj.src = &quot;images/gopher.jpg&quot;;
};</code></pre><p id="r-429301" data-claire-element-id="429301"><a href="http://tutozero.free.fr/kinetic/tutos04/sprite_02.html">Tester !</a><br/> Une fonction <strong>frames </strong>est chargée de faire le calcul du positionnement des images élémentaires. Elle attend 6 paramètres dont voici une visualisation :</p><figure id="r-429303" data-claire-element-id="429304"><img id="r-429302" data-claire-element-id="429302" src="medias/uploads.siteduzero.com_files_409001_410000_409641.png" alt="Image utilisateur"/></figure><p id="r-429305" data-claire-element-id="429305">C'est déjà moins prise de tête pour constituer une animation :p .</p><h5 id="r-plusieurs-animations" data-claire-element-id="429317">Plusieurs animations</h5><p id="r-429307" data-claire-element-id="429307">Jusque-là, nous nous sommes contentés de créer une seule animation avec toutes les images prévues dans l'ordre. On pourrait aussi avoir envie de créer des animations avec certaines images à chaque fois, et pas forcément dans l'ordre. Notre code alors ne convient plus et il nous faut le rendre plus générique. Voici un exemple avec deux animations déclenchées par des boutons :</p><pre id="r-429308" data-claire-element-id="429308"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();	

	// Génération d'une frame
	function frame(id, base_x, base_y, offset_x, offset_y, nbr_x, width, height) {
		return {
					x: base_x + offset_x * ((id + nbr_x) % nbr_x),
					y: base_y + offset_y * parseInt(id / nbr_x),
					width: width,
					height: height
			   };
	}	
	
	// Génération des frames
	function frames(ids, base_x, base_y, offset_x, offset_y, nbr_x, nbr_y, width, height) {
		var frames_tab = new Array();
		for(var i = 0; i &lt; ids.length; ++i) 
			frames_tab.push(frame(ids[i], base_x, base_y, offset_x, offset_y, nbr_x, width, height));
		return frames_tab;
	}
	
	// Animations
	var animations = {
	  sortie: frames([0,1,2], 10, 8, 165, 137, 3, 2, 158, 130),
	  veille: frames([3,4,5,4], 10, 8, 165, 137, 3, 2, 158, 130)
	};
	
	// Image
	var imageObj = new Image();
	imageObj.onload = function() {
		var animal = new Kinetic.Sprite({
			x: 50,
			y: 50,
			image: imageObj,
			animation: &quot;sortie&quot;,
			animations: animations,
			frameRate: 4
		});
		
		calque.add(animal);
		scène.add(calque);
		// Sortie initiale
		animal.afterFrame(2, function() {
        	animal.stop();
        });
		animal.start();
		
		// Commandes
		document.getElementById(&quot;sortie&quot;).addEventListener(&quot;click&quot;, function() {
			if(animal.getAnimation() != &quot;sortie&quot;) {
				animal.stop();
				animal.setAnimation(&quot;sortie&quot;);
				animal.start();
				animal.afterFrame(2, function() {
              		             animal.stop();
            	                });
			}
		}, false);
		document.getElementById(&quot;veille&quot;).addEventListener(&quot;click&quot;, function() {
			if(animal.getAnimation() != &quot;veille&quot;) {
				animal.stop();
				animal.setAnimation(&quot;veille&quot;);
				animal.start();
				animal.afterFrame(5, function() {
              		             animal.stop();
            	                });
			}
		}, false);	  
	};
	imageObj.src = &quot;images/gopher.jpg&quot;;
};</code></pre><p id="r-429309" data-claire-element-id="429309"><a href="http://tutozero.free.fr/kinetic/tutos04/sprite_03.html">Tester !</a></p><figure id="r-429311" data-claire-element-id="429312"><img id="r-429310" data-claire-element-id="429310" src="medias/uploads.siteduzero.com_files_409001_410000_409642.png" alt="Image utilisateur"/></figure><p id="r-429313" data-claire-element-id="429313">Le code devient un peu plus lourd. Remarquez déjà les deux méthodes <strong>start </strong>et <strong>stop </strong>pour démarrer et arrêter l'animation. Remarquez également l'événement <strong>afterFrame</strong> qui permet d’exécuter du code après une certaine image. J'ai utilisé également la méthode <strong>setAnimation</strong> qui affecte l'animation en cours avec son nom.</p><p id="r-429314" data-claire-element-id="429314">Mais c'est surtout la fonction <strong>frames </strong>qui a été chamboulée. Maintenant elle attend non seulement les paramètres de positionnement et dimension des images, mais également un tableau des index des images composant l'animation dans l'ordre. Du coup l'écriture du code des animations devient un jeu d'enfant :</p><pre id="r-429315" data-claire-element-id="429315"><code data-claire-semantic="javascript">var animations = {
    sortie: frames([0,1,2], 10, 8, 165, 137, 3, 2, 158, 130),
    veille: frames([3,4,5,4], 10, 8, 165, 137, 3, 2, 158, 130)
};</code></pre><p id="r-429316" data-claire-element-id="429316">On se contente d'envoyer un tableau avec les index des images que l'on veut :) .</p><h5 id="r-tp-3" data-claire-element-id="429327">TP</h5><p id="r-429318" data-claire-element-id="429318">Maintenant vous êtes prêts à faire un petit TP dans la lignée des scripts précédents. Cette fois on désire 3 animations : une pour la sortie de la taupe, une pour la faire regarder autour d'elle, et enfin une dernière pour qu'elle retourne dans son trou. On utilise trois boutons qui ne doivent apparaître que lorsqu'ils sont utiles. Voici l'exemple traité qui sera beaucoup mieux que toutes mes explications :</p><p id="r-429319" data-claire-element-id="429319"><a href="http://tutozero.free.fr/kinetic/tutos04/tp_03.html">Tester !</a></p><figure id="r-429321" data-claire-element-id="429322"><img id="r-429320" data-claire-element-id="429320" src="medias/uploads.siteduzero.com_files_409001_410000_409643.png" alt="Image utilisateur"/></figure><p id="r-429323" data-claire-element-id="429323">Au départ la taupe peut seulement sortir, donc seulement le bouton &quot;Sortie&quot; doit apparaître. Lorsqu'elle est sortie, elle peut alors soit surveiller, soit rentrer, donc les deux autres boutons doivent être affichés. Lorsqu'elle surveille, elle ne peut plus que rentrer... Au niveau du code il vous faut bien gérer l'événement <strong>afterFrame </strong>pour éviter les surprises.</p><p id="r-429324" data-claire-element-id="429324"></p><div id="r-429326" data-claire-element-id="429326"><pre id="r-429325" data-claire-element-id="429325"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();	

	// Génération d'une frame
	function frame(id, base_x, base_y, offset_x, offset_y, nbr_x, width, height) {
		return {
					x: base_x + offset_x * ((id + nbr_x) % nbr_x),
					y: base_y + offset_y * parseInt(id / nbr_x),
					width: width,
					height: height
			   };
	}	
	
	// Génération des frames
	function frames(ids, base_x, base_y, offset_x, offset_y, nbr_x, nbr_y, width, height) {
		var frames_tab = new Array();
		for(var i = 0; i &lt; ids.length; ++i) 
			frames_tab.push(frame(ids[i], base_x, base_y, offset_x, offset_y, nbr_x, width, height));
		return frames_tab;
	}
	
	// Animations
	var animations = {
	  sortie: frames([0,1,2], 10, 8, 165, 137, 3, 2, 158, 130),
	  veille: frames([3,4,5,4], 10, 8, 165, 137, 3, 2, 158, 130),
	  entrée: frames([2,1,0], 10, 8, 165, 137, 3, 2, 158, 130)
	};
	
	// Image
	var imageObj = new Image();
	imageObj.onload = function() {
		var animal = new Kinetic.Sprite({
			x: 50,
			y: 50,
			image: imageObj,
			animation: &quot;sortie&quot;,
			animations: animations,
			frameRate: 4
		});
		
		calque.add(animal);
		scène.add(calque);
		
		// Commandes
		document.getElementById(&quot;sortie&quot;).addEventListener(&quot;click&quot;, function() {
			set_animation(&quot;sortie&quot;, 2, &quot;inline&quot;, &quot;none&quot;, &quot;inline&quot;);
		}, false);
		document.getElementById(&quot;veille&quot;).addEventListener(&quot;click&quot;, function() {
			set_animation(&quot;veille&quot;, 5, &quot;none&quot;, &quot;none&quot;, &quot;inline&quot;);
		}, false);	  
		document.getElementById(&quot;entrée&quot;).addEventListener(&quot;click&quot;, function() {
			set_animation(&quot;entrée&quot;, 2, &quot;none&quot;, &quot;inline&quot;, &quot;none&quot;);
		}, false);		
		
		// Gestion de l'animation et des boutons
		function set_animation(animation, index, veille, sortie, entrée) {
			animal.stop();
			animal.setAnimation(animation);
			animal.start();
			animal.afterFrame(index, function() {animal.stop();});
			document.getElementById(&quot;veille&quot;).style.display=veille;
			document.getElementById(&quot;entrée&quot;).style.display=entrée;
			document.getElementById(&quot;sortie&quot;).style.display=sortie;			
		}
	};
	imageObj.src = &quot;images/gopher.jpg&quot;;
};</code></pre></div>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
<span class="arrow"></span>
<span class="next">Les transitions</span>
</a>
<a class="after" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
<span class="next">Les animations</span>
<span class="arrow"></span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div><a name="Lesanimations"></a><h2>Les animations</h2><div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
<span class="arrow"></span>
<span class="next">Les sprites</span>
</a>
</div>
<hr class="top"/>
<div class="clear"></div> <div id="content" role="article">
<h4 id="r-les-animations-4" data-claire-element-id="429456">Les animations</h4><p id="r-429329" data-claire-element-id="429329">Nous allons pour terminer aborder les animations libres. C'est sans doute l'aspect le plus créatif de cette librairie, mais en même temps elle va peu nous aider, parce qu'il faut écrire le code pour l'animation, mais elle nous offre une infrastructure performante.</p><h5 id="r-quand-on-retrouve-les-transitions" data-claire-element-id="429338">Quand on retrouve les transitions</h5><p id="r-429330" data-claire-element-id="429330">Chaque fois qu'il est possible d'utiliser les transitions, il est évidemment judicieux de les utiliser plutôt que d'écrire le code du calcul du déplacement. Voici un exemple élémentaire avec une balle qui se déplace de façon aléatoire :</p><pre id="r-429331" data-claire-element-id="429331"><code data-claire-semantic="javascript">window.onload = function() {
	function animation() {
		balle.transitionTo({
			x: Math.random() * 460 + 20,
			y: Math.random() * 260 + 20,
			duration: Math.random() * 2,
			callback: function() {
				animation();
			}
		});	
	}
	
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();

	var balle = new Kinetic.Ellipse({
		x: 100,
		y: 100,
		radius: 20,
		fill: &quot;#6b9&quot;
	});
			
	calque.add(balle);
	scène.add(calque);
	
	animation();
};</code></pre><p id="r-429332" data-claire-element-id="429332"><a href="http://tutozero.free.fr/kinetic/tutos04/animation_01.html">Tester !</a></p><figure id="r-429334" data-claire-element-id="429335"><img id="r-429333" data-claire-element-id="429333" src="medias/uploads.siteduzero.com_files_409001_410000_409644.png" alt="Image utilisateur"/></figure><p id="r-429336" data-claire-element-id="429336">Les positions x et y ainsi que la durée sont générées de façon aléatoire et une fonction de rappel commence une nouvelle transition.</p><p id="r-429337" data-claire-element-id="429337">Cette façon de procéder est efficace, mais elle est évidemment assez rigide et devient vite obsolète pour des animations plus spécifiques.</p><h5 id="r-deplacement-sur-une-ellipse" data-claire-element-id="429373">Déplacement sur une ellipse</h5><p id="r-429339" data-claire-element-id="429339">Dans cet exemple on déplace une balle le long d'une ellipse :</p><pre id="r-429340" data-claire-element-id="429340"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	var fond = new Kinetic.Layer();
	
	var a = 150;
	var b = 80;
	var centre_x = scène.getWidth() / 2;
	var centre_y = scène.getHeight() / 2;
	
	var balle = new Kinetic.Ellipse({
		radius: 10,
		fill: &quot;red&quot;
	});
	
	var ellipse = new Kinetic.Ellipse({
	  x: centre_x,
	  y: centre_y,
	  radius: [a, b],
	  stroke: &quot;black&quot;,
	  strokeWidth: .7
	});
			
	calque.add(balle);
	fond.add(ellipse);
	scène.add(fond);
	scène.add(calque);
	
	var animation = new Kinetic.Animation({
		func: function(frame) {
			var x = a * Math.cos(frame.time / 2000);
			var y = b * Math.sin (frame.time / 2000); 
			balle.setX(centre_x + x);
			balle.setY(centre_y + y);
		},
		node: calque
	});
			
	animation.start();
};</code></pre><p id="r-429341" data-claire-element-id="429341"><a href="http://tutozero.free.fr/kinetic/tutos04/animation_03.html">Tester !</a></p><figure id="r-429343" data-claire-element-id="429344"><img id="r-429342" data-claire-element-id="429342" src="medias/uploads.siteduzero.com_files_409001_410000_409645.png" alt="Image utilisateur"/></figure><p id="r-429345" data-claire-element-id="429345">Nous allons nous intéresser à la vitesse de déplacement de cette balle. Vous remarquez dans le code l'utilisation de la propriété <strong>time </strong>du paramètre <strong>frame</strong>. Celui-ci nous donne le temps écoulé depuis le début de l'animation en millisecondes. Il existe une deuxième propriété qui nous donne le temps écoulé depuis le dernier rafraîchissement. Voici ces deux paramètres :</p><table id="r-429363" data-claire-element-id="429363"><thead id="r-429351" data-claire-element-id="429351"><tr id="r-429350" data-claire-element-id="429350"><th id="r-429347" data-claire-element-id="429347"><p id="r-429346" data-claire-element-id="429346">Paramètre</p></th><th id="r-429349" data-claire-element-id="429349"><p id="r-429348" data-claire-element-id="429348">Valeur</p></th></tr></thead><tbody id="r-429362" data-claire-element-id="429362"><tr id="r-429356" data-claire-element-id="429356"><td id="r-429353" data-claire-element-id="429353"><p id="r-429352" data-claire-element-id="429352"><strong>time</strong></p></td><td id="r-429355" data-claire-element-id="429355"><p id="r-429354" data-claire-element-id="429354">Temps écoulé depuis le début de l'animation en millisecondes</p></td></tr><tr id="r-429361" data-claire-element-id="429361"><td id="r-429358" data-claire-element-id="429358"><p id="r-429357" data-claire-element-id="429357"><strong>timeDiff</strong></p></td><td id="r-429360" data-claire-element-id="429360"><p id="r-429359" data-claire-element-id="429359">Temps écoulé depuis le dernier rafraîchissement en millisecondes</p></td></tr></tbody></table><p id="r-429364" data-claire-element-id="429364">Ce sont ces propriétés qui vont nous permettre de gérer efficacement le temps. Voyons cela avec notre balle, voici le code de calcul de la position :</p><pre id="r-429365" data-claire-element-id="429365"><code data-claire-semantic="javascript">var x = a * Math.cos(frame.time / 2000);
var y = b * Math.sin (frame.time / 2000); 
balle.setX(centre_x + x);
balle.setY(centre_y + y);</code></pre><p id="r-429366" data-claire-element-id="429366">On sait que la fonction cosinus de <strong>Javascript </strong>attend une valeur en radians. Autrement dit un tour complet est effectué quand on passe d'une valeur de 0 à 2 * PI, autrement dit de 0 à 6,28. Comme je divise le temps par 2000 j'ai une progression de 0,5 à chaque seconde, il me faut donc 6,28 / 0,5 = 12,56 secondes pour effectuer un tour complet. A condition évidemment que le rafraîchissement s'effectue à une vitesse suffisante :) . On va d'ailleurs vérifier cela en ajoutant un contrôle du temps :</p><pre id="r-429367" data-claire-element-id="429367"><code data-claire-semantic="javascript">func: function(frame) {
	document.getElementById(&quot;texte&quot;).innerHTML = &quot;Temps écoulé en secondes : &quot; + frame.time / 1000 
                                                     + &quot;&lt;br&gt;fps : &quot; + parseInt(1000 / frame.timeDiff);
	var x = a * Math.cos(frame.time / 2000);
	var y = b * Math.sin (frame.time / 2000); 
	balle.setX(centre_x + x);
	balle.setY(centre_y + y);
},</code></pre><p id="r-429368" data-claire-element-id="429368"><a href="http://tutozero.free.fr/kinetic/tutos04/animation_03a.html">Tester !</a></p><figure id="r-429370" data-claire-element-id="429371"><img id="r-429369" data-claire-element-id="429369" src="medias/uploads.siteduzero.com_files_409001_410000_409646.png" alt="Image utilisateur"/></figure><p id="r-429372" data-claire-element-id="429372">J'ai ajouté un <strong>&lt;div&gt;</strong> pour afficher le temps écoulé et le fps (frames par secondes). Vous pouvez ainsi vérifier si je ne vous ai pas menti pour la durée de révolution ;) .</p><h5 id="r-mettre-en-mouvement-plusieurs-formes" data-claire-element-id="429437">Mettre en mouvement plusieurs formes</h5><h6 id="r-un-cas-simple" data-claire-element-id="429381">Un cas simple</h6><p id="r-429374" data-claire-element-id="429374">Nous avons fait déplacer une balle sur une ellipse, ajoutons maintenant un axe qui s'adapte automatiquement au mouvement :</p><pre id="r-429375" data-claire-element-id="429375"><code data-claire-semantic="javascript">window.onload = function() {
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
	
	var calque = new Kinetic.Layer();
	var fond = new Kinetic.Layer();
	
	var a = 150;
	var b = 80;
	var centre_x = scène.getWidth() / 2;
	var centre_y = scène.getHeight() / 2;
	
	var axe = new Kinetic.Line({
	  points: [centre_x, centre_y],
	  stroke: &quot;red&quot;,
	  strokeWidth: 3,
	  lineCap: &quot;round&quot;
	});
		
	var balle = new Kinetic.Ellipse({
		radius: 10,
		fill: &quot;red&quot;
	});
	
	var ellipse = new Kinetic.Ellipse({
	  x: centre_x,
	  y: centre_y,
	  radius: [a, b],
	  stroke: &quot;black&quot;,
	  strokeWidth: .7
	});
			
	calque.add(balle);
	calque.add(axe);
	fond.add(ellipse);
	scène.add(fond);
	scène.add(calque);

	var animation = new Kinetic.Animation({
		func: function(frame) {
			var x = a * Math.cos(frame.time / 2000);
			var y = b * Math.sin (frame.time / 2000); 
			balle.setX(centre_x + x);
			balle.setY(centre_y + y);
			axe.setPoints([centre_x, centre_y, centre_x + x, centre_y + y]);
		},
		node: calque
	});
	animation.start();
};</code></pre><p id="r-429376" data-claire-element-id="429376"><a href="http://tutozero.free.fr/kinetic/tutos04/animation_03b.html">Tester !</a></p><figure id="r-429378" data-claire-element-id="429379"><img id="r-429377" data-claire-element-id="429377" src="medias/uploads.siteduzero.com_files_409001_410000_409647.png" alt="Image utilisateur"/></figure><p id="r-429380" data-claire-element-id="429380">Rien de bien compliqué là-dedans, on gère les deux formes.</p><h6 id="r-un-cas-un-peu-plus-delicat" data-claire-element-id="429391">Un cas un peu plus délicat</h6><p id="r-429382" data-claire-element-id="429382">Maintenant nous allons faire tourner des images le long de l'ellipse en créant une impression de profondeur en jouant sur la dimension et la transparence des images :</p><pre id="r-429383" data-claire-element-id="429383"><code data-claire-semantic="javascript">// Chargement des images
function load_images(sources, callback) {
	var images = new Array();
	var loadedImages = 0;
	sources.forEach(function(value, index) {
		images[index] = new Image();
		images[index].onload = function() {
			if(++loadedImages &gt;= sources.length) callback(images);
		};
		images[index].src = &quot;images/&quot; + value;
	});
}		
// Initialisation de la scène
function init_scène(images) {
	var scène = new Kinetic.Stage({
		container: &quot;kinetic&quot;,
		width: 500,
		height: 300
	});
	var fond = new Kinetic.Layer();
	var calque = new Kinetic.Layer();
	var rectangle = new Kinetic.Rect({
		width: 500,
		height: 300,
		fill: &quot;#bbb&quot;,
	});
	fond.add(rectangle)
	images.forEach(function(value, index) {
		var image = new Kinetic.Image({
			x: 82 + index * 80,
			y: 252,
			offset: [32, 32],
			image: value,
			width: 64,
			height: 64,
			name: &quot;image&quot;
		});
		calque.add(image);
	});	
	scène.add(fond);
	scène.add(calque);
	
	var a = 170;
	var b = 80;
	var centre_x = scène.getWidth() / 2;
	var centre_y = scène.getHeight() / 2;
	
	var animation = new Kinetic.Animation({
		func: function(frame) {
			var images = scène.get(&quot;.image&quot;);
			var angle = frame.time / 2000;
			var offset = Math.PI * 2 / images.length;
			for(var i = 0; i &lt; images.length; ++i) {
				var img = images[i];
				var x = a * Math.cos(angle + i * offset);
				var y = b * Math.sin (angle + i * offset); 
				var posX = centre_x + x;
				var posY = centre_y + y;
				img.setX(posX);
				img.setY(posY);
				var scale = .5 + (posY - 80) / 160;
				img.setScale(scale);
				img.setOpacity(scale - .2);
			}	
		},
		node: calque
	});
	animation.start()
}

// Chargement de la page
window.onload = function() {
	var sources_icônes =  [
		&quot;img01.jpg&quot;,
		&quot;img02.jpg&quot;,
		&quot;img03.jpg&quot;,
		&quot;img04.jpg&quot;,
		&quot;img05.jpg&quot;,
		&quot;img06.jpg&quot;,
		&quot;img07.jpg&quot;,
		&quot;img08.jpg&quot;,
		&quot;img09.jpg&quot;,
		&quot;img10.jpg&quot;
	];
	load_images(sources_icônes, init_scène);
}</code></pre><p id="r-429384" data-claire-element-id="429384"><a href="http://tutozero.free.fr/kinetic/tutos04/animation_04.html">Tester !</a></p><figure id="r-429386" data-claire-element-id="429387"><img id="r-429385" data-claire-element-id="429385" src="medias/uploads.siteduzero.com_files_409001_410000_409648.png" alt="Image utilisateur"/></figure><p id="r-429388" data-claire-element-id="429388">La seule astuce du code consiste à calculer un offset d'angle pour répartir les images de façon équilibrée sur toute la longueur de l'ellipse. J'ai aussi nommé les images pour pouvoir facilement les référencer par la suite. Comme il n'y a pas d'autres formes sur ce calque, j'aurais aussi pu utiliser la méthode <strong>getChildren </strong>et ne plus avoir à nommer les images :</p><pre id="r-429389" data-claire-element-id="429389"><code data-claire-semantic="javascript">func: function(frame) {
	var images = calque.getChildren();
	var angle = frame.time / 2000;
	var offset = Math.PI * 2 / images.length;
	images.forEach(function(value, index) {
		var img = value;
		var x = a * Math.cos(angle + index * offset);
		var y = b * Math.sin (angle + index * offset); 
		var posX = centre_x + x;
		var posY = centre_y + y;
		img.setX(posX);
		img.setY(posY);
		var scale = .5 + (posY - 80) / 160;
		img.setScale(scale);
		img.setOpacity(scale - .2);
	});	
},</code></pre><p id="r-429390" data-claire-element-id="429390"><a href="http://tutozero.free.fr/kinetic/tutos04/animation_04a.html">Tester !</a></p><h6 id="r-modifier-l-ordre-de-dessin-des-formes" data-claire-element-id="429436">Modifier l'ordre de dessin des formes</h6><p id="r-429392" data-claire-element-id="429392">Les formes se dessinent dans l'ordre du script, ce qui est en général satisfaisant. Mais lors d'une animation, il peut s'avérer judicieux de modifier cet ordre pour changer la superposition des formes. <strong>KineticJS </strong>prévoit cette possibilité avec quelques méthodes :</p><table id="r-429425" data-claire-element-id="429425"><thead id="r-429398" data-claire-element-id="429398"><tr id="r-429397" data-claire-element-id="429397"><th id="r-429394" data-claire-element-id="429394"><p id="r-429393" data-claire-element-id="429393">Méthode</p></th><th id="r-429396" data-claire-element-id="429396"><p id="r-429395" data-claire-element-id="429395">Effet</p></th></tr></thead><tbody id="r-429424" data-claire-element-id="429424"><tr id="r-429403" data-claire-element-id="429403"><td id="r-429400" data-claire-element-id="429400"><p id="r-429399" data-claire-element-id="429399"><strong>moveToTop()</strong></p></td><td id="r-429402" data-claire-element-id="429402"><p id="r-429401" data-claire-element-id="429401">Passe au premier plan</p></td></tr><tr id="r-429408" data-claire-element-id="429408"><td id="r-429405" data-claire-element-id="429405"><p id="r-429404" data-claire-element-id="429404"><strong>moveToBottom()</strong></p></td><td id="r-429407" data-claire-element-id="429407"><p id="r-429406" data-claire-element-id="429406">Passe au dernier plan</p></td></tr><tr id="r-429413" data-claire-element-id="429413"><td id="r-429410" data-claire-element-id="429410"><p id="r-429409" data-claire-element-id="429409"><strong>moveUp()</strong></p></td><td id="r-429412" data-claire-element-id="429412"><p id="r-429411" data-claire-element-id="429411">Monte sur le plan au-dessus</p></td></tr><tr id="r-429418" data-claire-element-id="429418"><td id="r-429415" data-claire-element-id="429415"><p id="r-429414" data-claire-element-id="429414"><strong>moveDown()</strong></p></td><td id="r-429417" data-claire-element-id="429417"><p id="r-429416" data-claire-element-id="429416">Descend au plan inférieur</p></td></tr><tr id="r-429423" data-claire-element-id="429423"><td id="r-429420" data-claire-element-id="429420"><p id="r-429419" data-claire-element-id="429419"><strong>setZIndex(x)</strong></p></td><td id="r-429422" data-claire-element-id="429422"><p id="r-429421" data-claire-element-id="429421">Passe sur le plan x</p></td></tr></tbody></table><p id="r-429426" data-claire-element-id="429426">Pour ceux qui ont besoin de visualiser ça :</p><figure id="r-429428" data-claire-element-id="429429"><img id="r-429427" data-claire-element-id="429427" src="medias/uploads.siteduzero.com_files_409001_410000_409649.png" alt="Image utilisateur"/></figure><p id="r-429430" data-claire-element-id="429430">Pour illustrer cette possibilité sur un cas pratique nous allons poursuivre l'exemple des photos tournoyantes en donnant la possibilité de cliquer sur une d'elles pour l'envoyer élégamment au premier plan grâce à la méthode <strong>moveToTop </strong>et une transition élastique pour centrer la photo et changer sa taille, on arrête aussi l'animation le temps de la transition :</p><pre id="r-429431" data-claire-element-id="429431"><code data-claire-semantic="javascript">// Chargement des images
function load_images(sources, callback) {
	var images = new Array();
	var loadedImages = 0;
	sources.forEach(function(value, index) {
		images[index] = new Image();
		images[index].onload = function() {
			if(++loadedImages &gt;= sources.length) callback(images);
		};
		images[index].src = &quot;images/&quot; + value;
	});
}		
// Initialisation de la scène
function init_scène(images) {
	var scène = new Kinetic.Stage({
		container: &quot;kinetic&quot;,
		width: 500,
		height: 300
	});
	var fond = new Kinetic.Layer();
	var calque = new Kinetic.Layer();
	var rectangle = new Kinetic.Rect({
		width: 500,
		height: 300,
		fill: &quot;#bbb&quot;,
	});
	fond.add(rectangle)
	images.forEach(function(value, index) {
		var image = new Kinetic.Image({
			x: 82 + index * 80,
			y: 252,
			offset: [32, 32],
			image: value,
			width: 64,
			height: 64,
			name: &quot;image&quot;
		});
		image.on(&quot;click&quot;, function() {
		  	animation.stop();
			with(this) {
				setScale(5);
				moveToTop();
				setOpacity(1);
				transitionTo({
					x: centre_x,
					y: centre_y,
					duration: 2,
					easing: 'elastic-ease-out',
					callback: function() {
						animation.start();
					}
				});
			}
		});
		calque.add(image);
	});	
	scène.add(fond);
	scène.add(calque);
	
	var a = 170;
	var b = 80;
	var centre_x = scène.getWidth() / 2;
	var centre_y = scène.getHeight() / 2;
	
	var animation = new Kinetic.Animation({
		func: function(frame) {
			var images = scène.get(&quot;.image&quot;);
			var angle = frame.time / 2000;
			var offset = Math.PI * 2 / images.length;
			images.forEach(function(value, index) {
				var img = value;
				var x = a * Math.cos(angle + index * offset);
				var y = b * Math.sin (angle + index * offset); 
				var posX = centre_x + x;
				var posY = centre_y + y;
				img.setX(posX);
				img.setY(posY);
				var scale = .5 + (posY - 80) / 160;
				img.setScale(scale);
				img.setOpacity(scale - .2);
			});	
		},
		node: calque
	});
	animation.start()
}

// Chargement de la page
window.onload = function() {
	var sources_icônes =  [
		&quot;img01.jpg&quot;,
		&quot;img02.jpg&quot;,
		&quot;img03.jpg&quot;,
		&quot;img04.jpg&quot;,
		&quot;img05.jpg&quot;,
		&quot;img06.jpg&quot;,
		&quot;img07.jpg&quot;,
		&quot;img08.jpg&quot;,
		&quot;img09.jpg&quot;,
		&quot;img10.jpg&quot;
	];
	load_images(sources_icônes, init_scène);
}</code></pre><p id="r-429432" data-claire-element-id="429432"><a href="http://tutozero.free.fr/kinetic/tutos04/animation_04b.html">Tester !</a></p><figure id="r-429434" data-claire-element-id="429435"><img id="r-429433" data-claire-element-id="429433" src="medias/uploads.siteduzero.com_files_409001_410000_409650.png" alt="Image utilisateur"/></figure><h5 id="r-tp-4" data-claire-element-id="429455">TP</h5><p id="r-429438" data-claire-element-id="429438">Pour faire le point je vous propose un petit TP. Le but est d'obtenir cet effet :</p><figure id="r-429440" data-claire-element-id="429441"><img id="r-429439" data-claire-element-id="429439" src="medias/uploads.siteduzero.com_files_409001_410000_409651.png" alt="Image utilisateur"/></figure><p id="r-429442" data-claire-element-id="429442"><a href="http://tutozero.free.fr/kinetic/tutos04/tp_02.html">Tester !</a><br/> C'est une forme allongée qui va en rétrécissant en formant une queue qui suit une ellipse. Pour constituer ce genre d'effet le plus simple est d'empiler des disque colorés. A vous de jouer ;) .</p><p id="r-429443" data-claire-element-id="429443"></p><div id="r-429445" data-claire-element-id="429445"><pre id="r-429444" data-claire-element-id="429444"><code data-claire-semantic="javascript">window.onload = function() {
	// Scène
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
		
	// Constitution du fond dégradé
	var fond = new Kinetic.Layer();
	var calque = new Kinetic.Layer();
	var rectangle = new Kinetic.Rect({
		width: 500,
		height: 300,
		fill: {
			start: {
			  x: scène.getWidth() / 2,
			  y: 0
			},
			end: {
			  x: scène.getWidth() / 2,
			  y: scène.getHeight()
			},
			colorStops: [0, &quot;#27f&quot;, 1, &quot;#016&quot;]
		},
	});
	fond.add(rectangle);
	
	// Constitution des balles
	var calque = new Kinetic.Layer();
	var a = 150;
	var b = 80;
	var centre_x = scène.getWidth() / 2;
	var centre_y = scène.getHeight() / 2;
	var ball_number = 40;
	var offset = .035;
	var red = 140;
	var green = 50;
	var blue = 70;
	for(var i = 1; i &lt;= ball_number; ++i) {
		var balle = new Kinetic.Ellipse({
			radius: 10,
			fill: &quot;rgb(&quot; + (red + 3 * i) + &quot;,&quot; + (green + 3 * i) + &quot;,&quot; + (blue + i) + &quot;)&quot;,
			opacity: .8 - (i / ball_number) * .8,
			scale: 1 - i / ball_number
		});
		calque.add(balle);
	}
	
	scène.add(fond);
	scène.add(calque);

	// Animation
	var animation = new Kinetic.Animation({
		func: function(frame) {
			var balles = calque.getChildren();
			var angle = frame.time / 500;
			for(var i = 0; i &lt; balles.length; ++i) {
				var balle = balles[i];
				var angle_ball = angle - i * offset;
				var x = a * Math.cos(angle_ball);
				var y = b * Math.sin (angle_ball); 
				var posX = centre_x + x;
				var posY = centre_y + y;
				balle.setX(posX);
				balle.setY(posY);
			}	
		},
		node: calque
	});
	animation.start()
};</code></pre></div><p id="r-429446" data-claire-element-id="429446">Comme je vous sens encore en forme, on va améliorer l'effet :</p><figure id="r-429448" data-claire-element-id="429449"><img id="r-429447" data-claire-element-id="429447" src="medias/uploads.siteduzero.com_files_409001_410000_409652.png" alt="Image utilisateur"/></figure><p id="r-429450" data-claire-element-id="429450"><a href="http://tutozero.free.fr/kinetic/tutos04/tp_02a.html">Tester !</a><br/> Cette fois la forme est plus volumineuse, avec un dégradé, un halo et elle suit un huit (un peu de maths en passant). J'ai aussi ajouté le contrôle du rafraîchissement pour juger les performances de la librairie.</p><p id="r-429451" data-claire-element-id="429451"></p><div id="r-429453" data-claire-element-id="429453"><pre id="r-429452" data-claire-element-id="429452"><code data-claire-semantic="javascript">window.onload = function() {
	// Scène
	var scène = new Kinetic.Stage({
	  container: &quot;kinetic&quot;,
	  width: 500,
	  height: 300
	});
		
	// Constitution du fond dégradé
	var fond = new Kinetic.Layer();
	var calque = new Kinetic.Layer();
	var rectangle = new Kinetic.Rect({
		width: 500,
		height: 300,
		fill: {
			start: {
			  x: scène.getWidth() / 2,
			  y: 0
			},
			end: {
			  x: scène.getWidth() / 2,
			  y: scène.getHeight()
			},
			colorStops: [0, &quot;#27f&quot;, 1, &quot;#016&quot;]
		},
	});
	fond.add(rectangle);
	
	// Constitution des balles
	var calque = new Kinetic.Layer();
	var a = 150;
	var b = 80;
	var centre_x = scène.getWidth() / 2;
	var centre_y = scène.getHeight() / 2;
	var ball_number = 40;
	var offset = .03;
	// Halo
	for(var i = 1; i &lt;= ball_number; ++i) {
		var balle = new Kinetic.Ellipse({
			radius: 20,
			fill: &quot;yellow&quot;,
			opacity: .04,
			scale: (1 - i / ball_number) + .4
		});
		calque.add(balle);
	}
	// Corps
	for(var i = 1; i &lt;= ball_number; ++i) {
		var balle = new Kinetic.Ellipse({
			radius: 20,
			fill: {
				start: {
				  x: 0,
				  y: 0,
				  radius: 3
				},
				end: {
				  x: 0,
				  y: 0,
				  radius: 20
				},
				colorStops: [.6, &quot;red&quot;, .8, &quot;#cc2&quot;]
			},
			opacity: .8 - (i / ball_number) * .8,
			scale: 1 - i / ball_number
		});
		calque.add(balle);
	}
	
	scène.add(fond);
	scène.add(calque);

	// Animation
	var k = 2;
	var animation = new Kinetic.Animation({
		func: function(frame) {
			document.getElementById(&quot;texte&quot;).innerHTML = &quot;fps : &quot; + parseInt(1000 / frame.timeDiff);
			var balles = calque.getChildren();
			var angle = frame.time / 500;
			for(var i = 0; i &lt; balles.length / 2; ++i) {
				var balle1 = balles[i];
				var balle2 = balles[i + balles.length / 2];
				var angle_ball = angle - i * offset;
				var x = a * Math.cos(angle_ball);
				var y = b * Math.sin (k * angle_ball); 
				var posX = centre_x + x;
				var posY = centre_y + y;
				balle1.setX(posX);
				balle1.setY(posY);
				balle2.setX(posX);
				balle2.setY(posY);
			}	
		},
		node: calque
	});
	animation.start()
};</code></pre></div><p id="r-429454" data-claire-element-id="429454">Nous voici arrivés au bout de ce cours. Je suis loin d'avoir été exhaustif, mais vous avez déjà les bases pour créer de belles choses. Si vous voulez vous perfectionner, le mieux est d'analyser <a href="http://www.html5canvastutorials.com/labs/">les exemples</a> sur le site de l'auteur.</p>
<aside class="aside-menu">
<ul class="content-menu" role="navigation">
<li class="tuto">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs">Piloter canvas avec KineticJS</a>
</li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 1</span>
Dessiner
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/premieres-formes">Premières formes</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/mise-en-route-3">
Mise en route
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/formes-predefinies">
Formes prédéfinies
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/texte-2">
Texte
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traces-et-images">Tracés et images</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/lignes-1">
Lignes
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/shape-une-classe-a-tout-faire">
Shape : une classe à tout faire
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/images-3">
Images
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/style-1">Style</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/traits-et-remplissage">
Traits et remplissage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/opacite-et-ombre">
Opacité et ombre
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/manipulations-1">Manipulations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/modifications-2">
Modifications
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/groupements">
Groupements
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp">TP</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-paysage">
Un paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/une-vague">
Une vague
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/encore-le-paysage">
Encore le paysage
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/fleurs">
Fleurs
</a>
</li>
</ul> </li></ul> </li>
<li class="chapter">
 
<a class="chapterLink" onmouseover="$(this).addClass('box-shadow-summary').next().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').next().removeClass('box-shadow-summary');">
<span>Partie 2</span>
Animer
</a>
<a class="chapterOpen" href="#" onmouseover="$(this).addClass('box-shadow-summary').prev().addClass('box-shadow-summary');" onmouseout="$(this).removeClass('box-shadow-summary').prev().removeClass('box-shadow-summary');">
<span>+</span>
</a>
 
<ul class="subchapters">
<li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/interactions-1">Interactions</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/evenements-6">
Evénements
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/glisser-deposer">
Glisser-déposer
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/tp-1">
TP
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/un-exemple-d-application-1">Un exemple d&#039;application</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/presentation-111">
Présentation
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/le-dessin-1">
Le dessin
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/selection-et-edition">
Sélection et édition
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/apparence-et-enregistrement">
Apparence et enregistrement
</a>
</li>
</ul> </li> <li class="subchapter">
<div>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/animations-1">Animations</a>
<a class="subchapterOpen" href="#">
<span>+</span>
</a>
</div>
<ul class="subchapter-parts">
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-transitions-1">
Les transitions
</a>
</li>
<li>
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
Les sprites
</a>
</li>
<li class="active">
<a href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-animations-4">
Les animations
</a>
</li>
</ul>
</li>
</ul>
</li>
</li>
</ul>
</aside>
</div>
<div id="content-bottom-menu"></div>
<hr/>
<div class="paginate-tuto">
<a class="before" href="http://62.4.17.167/informatique/tutoriels/piloter-canvas-avec-kineticjs/les-sprites-2">
<span class="arrow"></span>
<span class="next">Les sprites</span>
</a>
</div>
<hr class="bottom"/>
<div class="clear"></div> <div class="adBan">
<script type='text/javascript'>
    if (window.innerWidth >= 728)
    {
        document.write('<div id="div-gpt-ad-1350977194635-8" class="megaban"></div>');
        googletag.cmd.push(function() {
            googletag.display('div-gpt-ad-1350977194635-8');
        });
    }
            else
        {
            document.write('<div id="div-gpt-ad-1350977284180-8" class="miniban"></div>');
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-1350977284180-8');
            });
        }
    </script>
</div>
<div class="clear"></div>
</body>
<!-- Mirrored from 62.4.17.167/sdz/sdz/iloter-canvas-avec-kineticjs.html by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 27 Oct 2013 03:04:39 GMT -->

<!-- Mirrored from sdz.tdct.org/sdz/iloter-canvas-avec-kineticjs.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 30 Nov 2015 04:40:56 GMT -->
</html>